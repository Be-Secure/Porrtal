/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[342],{10342:(W,T,e)=>{e.r(T),e.d(T,{default:()=>J});var p=e(15861),l=e(17626),g=e(26584),m=e(62208),O=e(32917),h=e(77712),L=(e(85931),e(8314),e(90912),e(76898)),E=e(19702),v=e(50916),P=e(31498),a=e(88879),u=e(13812),r=e(28594),M=e(10023);const D=o=>{let i=class extends o{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return(0,r._D)((0,m.Wg)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(t){return!!this.projectFullExtent(t)}projectFullExtent(t){const n=(0,m.Wg)(this.layer.fullExtent),s=(0,r._D)(n,t,!1);return(0,r.tB)(n,t,s)}fetchPopupFeatures(t,n){var s=this;return(0,p.Z)(function*(){const{layer:d}=s;if(!t)throw new g.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:d});const{popupEnabled:c}=d,R=(0,M.V)(d,n);if(!c||(0,m.Wi)(R))throw new g.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:c,popupTemplate:R});const f=[],{value:b,magdirValue:C}=yield d.identify(t,{timeExtent:s.timeExtent});let K="";if(b&&b.length){K="imagery-tile"===d.type&&d.hasStandardTime()&&null!=b[0]?b.map(B=>d.getStandardTimeValue(B)).join(", "):b.join(", ");const S={ObjectId:0},z="Raster.ServicePixelValue";S[z]=s._formatAttributeValue(K,z);const F=d.rasterInfo?.attributeTable?.features;if(F&&F.length>0){const B=F.filter(U=>String(U.attributes.value||U.attributes.Value||U.attributes.VALUE)===K);if(B.length>0){const U=B[0];if(U)for(const A in U.attributes)if(U.attributes.hasOwnProperty(A)){const G=s._rasterFieldPrefix+A;S[G]=s._formatAttributeValue(U.attributes[A],G)}}}const V=d.rasterInfo.dataType;"vector-magdir"!==V&&"vector-uv"!==V||(S["Raster.Magnitude"]=C?.[0],S["Raster.Direction"]=C?.[1]);const x=new a.Z(s.fullExtent.clone(),null,S);x.layer=d,x.sourceLayer=x.layer,f.push(x)}return f})()}_formatAttributeValue(t,n){if("string"==typeof t){const d=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n),c=d&&d.format;if(c){let R,f;return t.trim().includes(",")?(R=",",f=R+" ",this._formatDelimitedString(t,R,f,c)):t.trim().includes(" ")?(R=f=" ",this._formatDelimitedString(t,R,f,c)):this._formatNumberFromString(t,c)}}return t}_getFieldInfo(t,n){if(!t||!t.length||!n)return;const s=n.toLowerCase();let d;return t.some(c=>!(!c.fieldName||c.fieldName.toLowerCase()!==s&&c.fieldName.toLowerCase()!==s.replace(/ /g,"_")||(d=c,0))),d}_formatDelimitedString(t,n,s,d){return t&&n&&s&&d?t.trim().split(n).map(c=>this._formatNumberFromString(c,d)).join(s):t}_formatNumberFromString(t,n){if(!t||!n)return t;const s=Number(t);return isNaN(s)?t:n.format(s)}};return(0,l._)([(0,h.Cb)()],i.prototype,"layer",void 0),(0,l._)([(0,h.Cb)(u.qG)],i.prototype,"timeExtent",void 0),(0,l._)([(0,h.Cb)()],i.prototype,"view",void 0),(0,l._)([(0,h.Cb)()],i.prototype,"fullExtent",null),(0,l._)([(0,h.Cb)()],i.prototype,"tileInfo",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],i.prototype,"hasTilingEffects",null),i=(0,l._)([(0,L.j)("esri.views.layers.ImageryTileLayerView")],i),i};var N=e(45611),Z=e(94421),w=e(94672),H=e(31637);let j=class extends(D((0,Z.Z)((0,v.r)((0,E.A)(N.Z))))){constructor(){super(...arguments),this.type="imagery-tile-3d",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new g.Z("layerview:spatial-reference-incompatible","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})));const o=(0,O.N1)(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const i=this.view.basemapTerrain.tilingScheme,{tileInfo:t}=this.layer,n=["png","png24","png32","jpg","mixed"].includes(t.format)&&i.compatibleWith(t);this.isAlignedMapTile=n;const s=n?t:i.toTileInfo();this.tileInfo=s,this.updatingHandles.add(()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition],()=>this.refresh())});this.addResolvingPromise(o)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const o=document.createElement("canvas"),i=o.getContext("2d"),[t,n]=this.tileInfo.size;return o.width=t,o.height=n,i.clearRect(0,0,t,n),i.getImageData(0,0,t,n)}get imageFormatIsOpaque(){return"jpg"===this.layer.tileInfo.format}get hasMixedImageFormats(){return"mixed"===this.layer.tileInfo.format}get dataLevelRange(){const i=this.layer.tileInfo.lods;return this.levelRangeFromScaleRange(this.tileInfo.lods[0].scale,i[i.length-1].scale)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain&&null!==this.view.basemapTerrain.spatialReference?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}fetchTile(o,i,t,n){var s=this;return(0,p.Z)(function*(){const d=s.tileInfo,c=s._canSymbolizeInWebGL(),R={tileInfo:d,requestRawData:c,signal:(0,m.Wg)(n.signal),requestAsImageElement:s.isAlignedMapTile},f=yield s.layer.fetchTile(o,i,t,R);if(f instanceof HTMLImageElement)return f;let b=f&&f.pixelBlock;if((0,m.Wi)(b)||!c&&(b=yield s.layer.applyRenderer(f),(0,m.Wi)(b)))return s._blankTile;const C=new P.H([o,i,t],b,d.size[0],d.size[1]);return c?(C.symbolizerRenderer=s.layer.symbolizer.rendererJSON,C.symbolizerParameters=s.layer.symbolizer.generateWebGLParameters(s._getSymbolizerOptions(o)),C.transformGrid=f.transformGrid):C.isRendereredSource=!0,C.interpolation=s.layer.interpolation,C.bandIds=s.layer.bandIds,C})()}_getSymbolizerOptions(o){const i=this.tileInfo.lodAt(o).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:i,y:i},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(o){this._canSymbolizeInWebGL()&&JSON.stringify(o.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(o.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(o.lij[0])))}createFetchPopupFeaturesQueryGeometry(o,i){return(0,w.K)(o,i,this.view)}refresh(){this.emit("data-changed")}doRefresh(){var o=this;return(0,p.Z)(function*(){o.suspended||o.emit("data-changed")})()}_canSymbolizeInWebGL(){return(0,H.hc)("3d").supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};(0,l._)([(0,h.Cb)({readOnly:!0})],j.prototype,"_blankTile",null),(0,l._)([(0,h.Cb)({readOnly:!0})],j.prototype,"imageFormatIsOpaque",null),(0,l._)([(0,h.Cb)({readOnly:!0})],j.prototype,"hasMixedImageFormats",null),(0,l._)([(0,h.Cb)({readOnly:!0})],j.prototype,"dataLevelRange",null),j=(0,l._)([(0,L.j)("esri.views.3d.layers.ImageryTileLayerView3D")],j);const J=j},19702:(W,T,e)=>{e.d(T,{A:()=>v});var p=e(15861),l=e(17626),g=e(54024),m=e(10699),O=e(32917),h=e(77712),L=(e(85931),e(8314),e(90912),e(76898)),E=e(36947);const v=P=>{let a=class extends P{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(u){super.postscript(u),(0,E.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var u=this;return(0,p.Z)(function*(){const r=new AbortController,M=r.signal;u.handles.add((0,g.kB)(()=>r.abort())),yield(0,O.N1)(()=>u.view.defaultsFromMap?.heightModelInfoReady,M),(0,m.k_)(M);const D=(0,E.Wt)(u.layer,u.view.heightModelInfo,u.supportsHeightUnitConversion);if(D)throw D})()}canResume(){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!u||!u.minScale||!u.maxScale||u.minScale>=u.maxScale)}getSuspendInfo(){const u=super.getSuspendInfo(),r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return r&&r.minScale&&r.maxScale&&r.minScale<r.maxScale&&(u.outsideScaleRange=!0),u}};return(0,l._)([(0,h.Cb)()],a.prototype,"view",void 0),(0,l._)([(0,h.Cb)()],a.prototype,"slicePlaneEnabled",void 0),a=(0,l._)([(0,L.j)("esri.views.3d.layers.LayerView3D")],a),a}},45611:(W,T,e)=>{e.d(T,{Z:()=>u});var p=e(17626),l=e(14517),g=e(61885),m=e(80542),O=e(61996),h=e(63290),_=e(62208),I=e(60330),y=e(77712),P=(e(85931),e(8314),e(90912),e(76898));let a=class extends((0,m.p)((0,O.IG)((0,I.v)(g.Z.EventedMixin(l.Z))))){constructor(r){super(r),this.layer=null,this.parent=null}initialize(){this.when().catch(r=>{if("layerview:create-error"!==r.name){const M=this.layer&&this.layer.id||"no id",D=this.layer&&this.layer.title||"no title";h.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${D}', id: '${M}')`,r)}})}get fullOpacity(){return(0,_.Pt)(this.get("layer.opacity"),1)*(0,_.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(r){void 0!==r?this._override("visible",r):this._clearOverride("visible")}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const r=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(r.viewNotReady=!0),this.layer&&this.layer.loaded||(r.layerNotLoaded=!0),this.visible||(r.layerInvisible=!0),r}isUpdating(){return!1}};(0,p._)([(0,y.Cb)()],a.prototype,"fullOpacity",null),(0,p._)([(0,y.Cb)()],a.prototype,"layer",void 0),(0,p._)([(0,y.Cb)()],a.prototype,"parent",void 0),(0,p._)([(0,y.Cb)({readOnly:!0})],a.prototype,"suspended",null),(0,p._)([(0,y.Cb)({readOnly:!0})],a.prototype,"suspendInfo",null),(0,p._)([(0,y.Cb)({readOnly:!0})],a.prototype,"legendEnabled",null),(0,p._)([(0,y.Cb)({type:Boolean,readOnly:!0})],a.prototype,"updating",null),(0,p._)([(0,y.Cb)({readOnly:!0})],a.prototype,"updatingProgress",null),(0,p._)([(0,y.Cb)()],a.prototype,"visible",null),(0,p._)([(0,y.Cb)()],a.prototype,"view",void 0),a=(0,p._)([(0,P.j)("esri.views.layers.LayerView")],a);const u=a},94421:(W,T,e)=>{e.d(T,{Z:()=>L});var p=e(17626),l=e(63290),g=e(10699),m=e(32917),O=e(77712),y=(e(85931),e(8314),e(90912),e(76898));const L=E=>{let v=class extends E{initialize(){this.handles.add((0,m.on)(()=>this.layer,"refresh",P=>{this.doRefresh(P.dataChanged).catch(a=>{(0,g.D_)(a)||l.Z.getLogger(this.declaredClass).error(a)})}),"RefreshableLayerView")}};return(0,p._)([(0,O.Cb)()],v.prototype,"layer",void 0),v=(0,p._)([(0,y.j)("esri.layers.mixins.RefreshableLayerView")],v),v}},10023:(W,T,e)=>{e.d(T,{V:()=>h,e:()=>m});var p=e(15861),l=e(62208),g=e(36630);function m(_){return O.apply(this,arguments)}function O(){return(O=(0,p.Z)(function*(_,I=_.popupTemplate){if((0,l.Wi)(I))return[];const y=yield I.getRequiredFields(_.fieldsIndex),{lastEditInfoEnabled:L}=I,{objectIdField:E,typeIdField:v,globalIdField:P,relationships:a}=_;if(y.includes("*"))return["*"];const u=L?yield(0,g.CH)(_):[],r=(0,g.Q0)(_.fieldsIndex,[...y,...u]);return v&&r.push(v),r&&E&&_.fieldsIndex.has(E)&&!r.includes(E)&&r.push(E),r&&P&&_.fieldsIndex.has(P)&&!r.includes(P)&&r.push(P),a&&a.forEach(M=>{const{keyField:D}=M;r&&D&&_.fieldsIndex.has(D)&&!r.includes(D)&&r.push(D)}),r})).apply(this,arguments)}function h(_,I){return _.popupTemplate?_.popupTemplate:(0,l.pC)(I)&&I.defaultPopupTemplateEnabled&&(0,l.pC)(_.defaultPopupTemplate)?_.defaultPopupTemplate:null}}}]);