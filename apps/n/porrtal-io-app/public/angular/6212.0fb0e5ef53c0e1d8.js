/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[6212],{50978:(Ee,X,n)=>{n.d(X,{M:()=>N,b:()=>se});var o=n(2166),D=n(69960),l=n(65787),d=n(17625),ge=n(22355),U=n(16396);function se(ne){const S=new ge.kG;(0,o.S)(S,ne),S.vertex.uniforms.add(new l.p("width",f=>f.width)),S.attributes.add(U.T.POSITION,"vec3"),S.attributes.add(U.T.NORMAL,"vec3"),S.attributes.add(U.T.UV0,"vec2"),S.attributes.add(U.T.AUXPOS1,"float"),S.varyings.add("vtc","vec2"),S.varyings.add("vlength","float"),S.varyings.add("vradius","float"),S.vertex.code.add(d.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),S.fragment.uniforms.add([new l.p("outlineSize",f=>f.outlineSize),new D.N("outlineColor",f=>f.outlineColor),new l.p("stripeLength",f=>f.stripeLength),new D.N("stripeEvenColor",f=>f.stripeEvenColor),new D.N("stripeOddColor",f=>f.stripeOddColor)]);const V=1/Math.sqrt(2);return S.fragment.code.add(d.H`
    const float INV_SQRT2 = ${d.H.float(V)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),S}const N=Object.freeze(Object.defineProperty({__proto__:null,build:se},Symbol.toStringTag,{value:"Module"}))},96212:(Ee,X,n)=>{n.r(X),n.d(X,{default:()=>yt});var o=n(17626),D=n(14517),l=n(62208),d=n(77712),N=(n(85931),n(8314),n(90912),n(76898)),ne=n(39691),S=n(1437),V=n(74554),f=n(72392),Oe=n(63290),_=n(15572),C=n(32917),L=n(84161),P=n(28093),Ae=n(44766),Me=n(55214),T=n(55915),ae=n(12080),re=n(10049),ve=n(54865),Ve=n(68);const ze=Oe.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");let x=class extends D.Z{constructor(e){super(e),this._unitNormalizer=new Ve.D,this._handles=new f.Z,this._tempStartPosition=(0,P.c)(),this._tempEndPosition=(0,P.c)(),this._tempCornerPosition=(0,P.c)()}initialize(){this._handles.add((0,C.gx)(()=>this.view?.ready,()=>this._initialize(),{once:!0,sync:!0,initial:!0}))}destroy(){this._handles=(0,l.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,ae.rS)(e),i=t===ae.GG?ae.wY:t;this._sphericalPCPF=i;const a=(0,T.Up)(e,i);this._unitNormalizer.spatialReference=a?i:e,this._handles.add([(0,C.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:s,startPoint:r})=>{s.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(r)},C.tX),(0,C.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:s,endPoint:r})=>{s.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(r)},C.tX),(0,C.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:s,viewData:r})=>{r.result=s},C.tX)])}_applyProjectionAndElevationAlignment(e){if((0,l.Wi)(e))return e;const t=(0,ve.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,l.Wi)(t)?((0,ve.e)(this.analysis,e.spatialReference,ze),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,l.Wi)(e)||(0,l.Wi)(t))return null;const a=this._euclideanDistances(e,t),s=this._geodesicDistance(e,t,a.horizontal.value),r=i===V.e.Geodesic||i===V.e.Auto&&a.horizontal.value>1e5?"geodesic":"euclidean";return{mode:r,distance:"euclidean"===r?a.direct:s,directDistance:a.direct,horizontalDistance:a.horizontal,verticalDistance:a.vertical,geodesicDistance:s}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const a=this._tempStartPosition,s=this._tempEndPosition,r=this._tempCornerPosition,g=this.view.spatialReference,c=this._sphericalPCPF,h=(0,T.Up)(g,c)?c:g;(0,T.KC)(e,a,h),(0,T.KC)(t,s,h),(0,T.KC)(i,r,h);const u=(0,L.i)(a,s),v=(0,L.i)(r,s),b=Math.abs(t.z-e.z),w=q=>this._unitNormalizer.normalizeDistance(q),E=w(u),B=w(v),k=w(b);return{direct:(0,_.EV)(E,"meters"),horizontal:(0,_.EV)(B,"meters"),vertical:(0,_.EV)(k,"meters")}}_geodesicDistance(e,t,i){const a=e.spatialReference,s=new Me.Z({spatialReference:a});s.addPath([e,t]);const r=a.isGeographic&&(0,re.Gb)(a)?(0,re.Jf)([s],"meters")[0]:a.isWebMercator?(0,Ae.geodesicLength)(s,"meters"):null,g=(0,l.pC)(r)?r:this._fallbackGeodesicDistance(e,t,i);return(0,_.EV)(g,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,T.UY)(e,me)&&(0,T.UY)(t,pe)){const a={distance:0};return(0,re.cA)(a,me,pe),a.distance}return i}};(0,o._)([(0,d.Cb)()],x.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],x.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],x.prototype,"viewData",void 0),(0,o._)([(0,d.Cb)()],x.prototype,"_computedResult",null),x=(0,o._)([(0,N.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],x);const me=(0,P.c)(),pe=(0,P.c)();var p,M,e,_e=n(15861),W=(n(52515),n(21286)),O=n(84600),I=n(23841),ye=n(16730),Ce=n(67831),Te=n(67709);(e=p||(p={}))[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(M||(M={}));var oe=n(495),H=n(68063),K=n(87469),xe=n(43703),le=n(4794),Y=n(26242),Re=n(53928),Ge=n(57521),R=n(40723),We=n(19625),je=n(6945),Z=n(42743),Ue=n(60881),Ne=n(5894),z=n(16396),Ie=n(651),He=n(91056),de=n(87601),Be=n(39114),be=n(88569),Fe=n(12407),Xe=n(41528),Ke=n(50978),we=n(67969),he=n(2078);class Q extends He.A{constructor(t,i,a){super(t,i,a)}initializeProgram(t){const i=Q.shader.get().build(this.configuration);return new Fe.$(t.rctx,i,Be.i)}_setPipelineState(t){return(0,he.sm)({blending:this.configuration.transparent?t===Z.Am.NONE?be.wu:(0,be.j7)(t):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:we.wb.LESS},depthWrite:he.LZ,colorWrite:he.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return we.MX.TRIANGLE_STRIP}}Q.shader=new Ie.J(Ke.M,()=>n.e(3368).then(n.bind(n,3368)));class $ extends Xe.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=Z.Am.NONE}}(0,o._)([(0,de.o)()],$.prototype,"polygonOffsetEnabled",void 0),(0,o._)([(0,de.o)()],$.prototype,"transparent",void 0),(0,o._)([(0,de.o)({count:Z.Am.COUNT})],$.prototype,"transparencyPassType",void 0);class Ye extends R.F5{constructor(t){super(t,new Qe),this.techniqueConfig=new $}getConfiguration(t,i){return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=i?.transparencyPassType??Z.Am.NONE,this.techniqueConfig}dispose(){}intersect(){}requiresSlot(t){return t===Ne.r.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===je.H.Color?new Ze(t):null}createBufferWriter(){return new it}}class Ze extends Ue.Z{beginSlot(t){return this.ensureTechnique(Q,t)}}class Qe extends R.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=[1,.5,0,1],this.stripeLength=1,this.stripeEvenColor=[1,1,1,1],this.stripeOddColor=[1,.5,0,1],this.polygonOffset=!1}}const $e=(0,We.U$)().vec3f(z.T.POSITION).vec3f(z.T.NORMAL).vec2f(z.T.UV0).f32(z.T.AUXPOS1),Je=(0,P.c)(),ke=(0,P.c)(),qe=(0,P.c)(),et=(0,P.c)(),tt=(0,P.c)();class it{constructor(){this.vertexBufferLayout=$e}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 2*(t.indices.get(z.T.POSITION).length/2+1)}write(t,i,a,s){const r=i.vertexAttributes.get(z.T.POSITION).data,g=i.vertexAttributes.get(z.T.NORMAL).data,c=r.length/3,h=i&&i.indices&&i.indices.get(z.T.POSITION);h&&h.length!==2*(c-1)&&console.warn("MeasurementArrowMaterial does not support indices");const u=Je,v=ke,b=qe,w=et,E=tt,B=t.transformation,k=t.invTranspTransformation,q=a.position,fe=a.normal,ee=a.uv0;let te=0;for(let A=0;A<c;++A){const ue=3*A;if((0,L.s)(u,r[ue],r[ue+1],r[ue+2]),A<c-1){const j=3*(A+1);(0,L.s)(v,r[j],r[j+1],r[j+2]),(0,L.s)(E,g[j],g[j+1],g[j+2]),(0,L.n)(E,E),(0,L.b)(b,v,u),(0,L.n)(b,b),(0,L.f)(w,E,b),(0,L.n)(w,w)}const bt=(0,L.i)(u,v);B&&k&&((0,L.m)(u,u,B),(0,L.m)(v,v,B),(0,L.m)(w,w,k));const F=s+2*A,ie=F+1;q.setVec(F,u),q.setVec(ie,u),fe.setVec(F,w),fe.setVec(ie,w),ee.set(F,0,te),ee.set(F,1,-1),ee.set(ie,0,te),ee.set(ie,1,1),A<c-1&&(te+=bt)}const Ct=a.auxpos1;for(let A=0;A<2*c;++A)Ct.set(s+A,te)}}class st extends Re._{constructor(t){super(t),this._parameters=nt,this._handles=null,this._origin=(0,P.c)(),this._originTransform=(0,xe.c)(),this._arrowCenter=(0,P.c)(),this._renderOccluded=R.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const i=this.opacity,{arrowStripeEvenColor:a,arrowStripeOddColor:s}=this._parameters,r=(0,W.H)(Le,this._stripesEnabled?a:s,i);this._arrowMaterial.setParameters({stripeEvenColor:r})}}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:a}=this._parameters;this._arrowMaterial=new Ye({outlineColor:a,stripeEvenColor:this._stripesEnabled?t:i,stripeOddColor:i,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new f.Z,this._handles.add((0,C.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(t){t(this._arrowMaterial)}createGeometries(t){if((0,l.Wi)(this._geometry)||(0,l.Wi)(this._geometry.startRenderSpace)||(0,l.Wi)(this._geometry.endRenderSpace))return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.addGeometry(i,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(t,i,a,s){const r=this.view.renderCoordsHelper,g=[],c=[],h=(u,v)=>{const b=Y.WM.get();(0,L.b)(b,u,a),g.push(b),c.push(v)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const u=Y.WM.get();r.worldUpAtPosition(this._arrowCenter,u),h(t,u),h(i,u)}else{s.eval(.5,this._arrowCenter);const u=this._parameters.arrowSubdivisions+1&-2;for(let v=0;v<u;++v){const b=v/(u-1),w=Y.WM.get(),E=Y.WM.get();s.eval(b,w),r.worldUpAtPosition(w,E),h(w,E)}}return Ge.Z.createPolylineGeometry(g,c)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,l.pC)(this._geometry)){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*t})}}_updateArrowOpacity(){const t=this.opacity,{arrowStripeEvenColor:i,arrowStripeOddColor:a,arrowOutlineColor:s}=this._parameters,r=(0,W.H)(Le,this._stripesEnabled?i:a,t),g=(0,W.H)(at,s,t),c=(0,W.H)(rt,a,t);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:g,stripeOddColor:c})}}const nt={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},Le=(0,le.c)(),at=(0,le.c)(),rt=(0,le.c)();var Pe,ot=n(77603),G=n(64770),ce=n(54889),lt=n(56683),dt=n(41840);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Pe||(Pe={}));let y=class extends D.Z{constructor(e){super(e),this._params={...ct},this._handles=new f.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,P.c)(),this._endPosition=(0,P.c)(),this._cornerPosition=(0,P.c)(),this._startPositionAtSeaLevel=(0,P.c)(),this._endPositionAtSeaLevel=(0,P.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=M.Auto,this.triangleCollapseRatioThreshold=.03}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,l.Wi)(e)||(0,l.Wi)(t)||e.equals(t))return p.None;const i=this.analysisView.result;if((0,l.Wi)(i))return p.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?p.ProjectedGeodesic:p.Direct;const{verticalDistance:a,horizontalDistance:s}=i,r=a.value,g=s.value;return Math.min(r/g,g/r)<this.triangleCollapseRatioThreshold?p.Direct:p.Triangle}get actualVisualizedMeasurement(){if((0,l.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case V.e.Auto:case V.e.Euclidean:default:return"euclidean";case V.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,l.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,l.Wi)(this._triangleOrientationOverride)!==e&&(this._triangleOrientationOverride=(0,l.Wi)(this._triangleOrientationOverride)?this._actualVisualElementsOrientation:null)}get labels(){return{direct:this._segmentLabel,horizontal:"geodesic"===this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}initialize(){var e=this;const t=this._params,i={attached:!0,view:this.view};this._segmentVisualElement=new st({...i,geometry:null,renderOccluded:R.yD.OccludeAndTransparent}),this._triangleVisualElement=new K.r({...i,width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:R.yD.OccludeAndTransparent}),this._rightAngleQuad=new ot.R({...i,color:J,renderOccluded:R.yD.OccludeAndTransparent});const a={...i,polygonOffset:!0,renderOccluded:R.yD.OccludeAndTransparent};this._projectedGeodesicLine=new K.r({...a,width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,ce.z5)(t.guideStippleLengthPixels)}),this._geodesicStartHint=new K.r({...a,width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,ce.z5)(t.guideStippleLengthPixels)}),this._geodesicEndHint=new K.r({...a,width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,ce.z5)(t.guideStippleLengthPixels)}),this._segmentLabel=new H.Kc({...i,fontSize:t.direcLabelFontSize}),this._verticalLabel=new H.Kc({...i,fontSize:t.verticalLabelFontSize}),this._horizontalLabel=new H.Kc({...i,fontSize:t.horizontalLabelFontSize}),this._handles.add([(0,C.YP)(()=>{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r}=this.analysisView,g=this.view;return{view:g,camera:g.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},s=>this._updateGeometryAndViewMode(s),C.tX),(0,C.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),s=>this._updateVisualElementVisibility(s),C.tX),(0,C.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),s=>this._updateLabelText(s),C.tX),(0,C.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),s=>this._updateLabelVisibility(s),C.tX),(0,C.YP)(()=>this._measurementArrowStripeLength,s=>this._updateSegmentStripeLength(s),C.tX),(0,lt.qe)((0,_e.Z)(function*(){return e._updateMessageBundle()}))]),this._updateMessageBundle()}destroy(){this._handles=(0,l.SC)(this._handles),this._segmentVisualElement=(0,l.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,l.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,l.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,l.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,l.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,l.SC)(this._geodesicEndHint),this._segmentLabel=(0,l.SC)(this._segmentLabel),this._verticalLabel=(0,l.SC)(this._verticalLabel),this._horizontalLabel=(0,l.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case p.None:break;case p.Direct:this._segmentVisualElement.visible=!0;break;case p.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case p.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,orientation:r,visualizedMeasurement:g,stripeLength:c}){const h=e.renderCoordsHelper;if((0,l.Wi)(h)||(0,l.Wi)(a)||(0,l.Wi)(s)||a.equals(s))return;let u=this._startPosition,v=this._endPosition;h.toRenderCoords(a,u),h.toRenderCoords(s,v);const b=r===M.AboveSegment?1:-1,w=b*(h.getAltitude(v)-h.getAltitude(u));w<0&&(u=this._endPosition,v=this._startPosition);const E="geodesic"===g?new G.u4(this._startPosition,this._endPosition,h.spatialReference):new G.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=E,this._updateSegmentStripeLength(c),i){case p.Direct:this._updateSegment(E,r);break;case p.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:E,orientation:r,startPosition:u,endPosition:v,deltaSign:b,altitudeDelta:w});break;case p.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:r,startPosition:u,endPosition:v})}}_updateSegment(e,t){this._segmentLabel.anchor=t===M.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:a,startPosition:s,endPosition:r,deltaSign:g,altitudeDelta:c}){const h=this._cornerPosition;e.worldUpAtPosition(s,h),(0,L.g)(h,h,g*Math.abs(c)),(0,L.a)(h,h,s),this._triangleVisualElement.geometry=[[[s[0],s[1],s[2]],[h[0],h[1],h[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:s,center:h,next:r};const u=new G.y$(s,h),v=new G.y$(h,r),b=function ht(e,t,i,a,s){const r=ut,g=gt;s.projectToRenderScreen(i,r),s.projectToRenderScreen(t,g);const c={segment:"bottom",horizontal:"top",vertical:r[0]<g[0]?"left":"right"};{const h=vt,u=mt;if((0,oe.c)(e,i,h,s),(0,oe.c)(e,t,u,s),(0,Ce.h)(h,u)>=Se){const v=Math.sign(h[1])===Math.sign(u[1]);c.segment=v?(0,H.jB)(c.vertical):c.vertical}else{const v=pt;(0,oe.c)(i,t,v,s),(0,Ce.h)(v,u)>=Se&&(c.segment=Math.sign(v[0])===Math.sign(u[0])?(0,H.jB)(c.horizontal):c.horizontal)}}if(a===M.BelowSegment){const h=u=>"top"===u?"bottom":"top";c.segment=h(c.segment),c.horizontal=h(c.horizontal),c.vertical=h(c.vertical)}return c}(s,r,h,a,t);this._segmentLabel.anchor=b.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._verticalLabel.anchor=b.vertical,this._horizontalLabel.geometry={type:"segment",segment:v,sampleLocation:"center"},this._horizontalLabel.anchor=b.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:a}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,a);const s=new G.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(s),this._geodesicStartHint.setGeometryFromSegment(new G.y$(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new G.y$(this._endPositionAtSeaLevel,a)),this._segmentLabel.geometry={type:"segment",segment:s,sampleLocation:"center"},this._segmentLabel.anchor=t===M.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,l.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,a=this._horizontalLabel,s=this._verticalLabel;if(i.visible=!1,a.visible=!1,s.visible=!1,e)switch(t){case p.Direct:i.visible=!0;break;case p.Triangle:i.visible=!0,a.visible=!0,s.visible=!0;break;case p.ProjectedGeodesic:i.visible=!0}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,l.Wi)(t)||(0,l.Wi)(e))return null;const{directDistance:i,horizontalDistance:a,verticalDistance:s,geodesicDistance:r}=t,g=this.analysisView.unit,c=h=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...h});switch(g){case"metric":return c({euclideanDistance:i&&(0,O.Rd)(e,i),geodesicDistance:r&&(0,O.Rd)(e,r),horizontalDistance:a&&(0,O.Rd)(e,a),verticalDistance:s&&(0,O.Wv)(e,s)});case"imperial":return c({euclideanDistance:i&&(0,O.Ud)(e,i),geodesicDistance:r&&(0,O.Ud)(e,r),horizontalDistance:a&&(0,O.Ud)(e,a),verticalDistance:s&&(0,O.Zv)(e,s)});default:return c({euclideanDistance:i&&(0,O.VG)(e,i,g),geodesicDistance:r&&(0,O.VG)(e,r,g),horizontalDistance:a&&(0,O.VG)(e,a,g),verticalDistance:s&&(0,O.VG)(e,s,g)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,l.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,l.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===M.Auto?this.view.state.camera.aboveGround?M.AboveSegment:M.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const a=t.renderCoordsHelper,s=t.state.camera.computeScreenPixelSizeAt(e);return a.getAltitude(e)/s>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,l.Wi)(e))return null;let i=null;const a=e.directDistance;switch(t){case"metric":i=a&&(0,_.nn)(a,"meters");break;case"imperial":i=a&&(0,_.nn)(a,(0,ye.FN)(a.value,a.unit));break;default:i=a&&(0,_.nn)(a,t)}return(0,l.Wi)(i)?null:(0,W.sk)(i.value/30)*(0,ye.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,dt.ME)("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,o._)([(0,d.Cb)()],y.prototype,"_triangleOrientationOverride",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"messages",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"analysisView",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"loadingMessages",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"visible",null),(0,o._)([(0,d.Cb)()],y.prototype,"viewMode",null),(0,o._)([(0,d.Cb)()],y.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],y.prototype,"visualElementOrientation",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"triangleCollapseRatioThreshold",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],y.prototype,"labels",null),(0,o._)([(0,d.Cb)()],y.prototype,"_labelsText",null),(0,o._)([(0,d.Cb)()],y.prototype,"_actualVisualElementsOrientation",null),(0,o._)([(0,d.Cb)()],y.prototype,"_measurementArrowStripeLength",null),y=(0,o._)([(0,N.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],y);const J=(0,Te.f)(1,.5,0,.75),ct={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:J,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:J,guideLineWidth:2,guideLineColor:J,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Se=Math.cos((0,W.Vl)(12)),ut=(0,I.J$)(),gt=(0,I.J$)(),vt=(0,I.gX)(),mt=(0,I.gX)(),pt=(0,I.gX)();let m=class extends((0,S.p)(D.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=V.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new y({view:e,analysis:t,analysisView:this}),this._analysisController=new x({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,l.SC)(this._analysisController),this._analysisVisualization=(0,l.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get unit(){return(0,l.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,o._)([(0,d.Cb)()],m.prototype,"updating",null),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"type",void 0),(0,o._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],m.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"result",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"measurementMode",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"elevationAlignedStartPoint",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"elevationAlignedEndPoint",void 0),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"viewMode",null),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],m.prototype,"visualElementOrientation",null),(0,o._)([(0,d.Cb)()],m.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],m.prototype,"triangleCollapseRatioThreshold",null),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"directLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"horizontalLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],m.prototype,"verticalLabelText",null),(0,o._)([(0,d.Cb)()],m.prototype,"_analysisVisualization",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"_analysisController",void 0),(0,o._)([(0,d.Cb)()],m.prototype,"unit",null),(0,o._)([(0,d.Cb)(ne.Y)],m.prototype,"_defaultUnit",void 0),m=(0,o._)([(0,N.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],m);const yt=m}}]);