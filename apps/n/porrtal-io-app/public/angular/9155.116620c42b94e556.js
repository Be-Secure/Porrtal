/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[9155],{36592:(ne,U,d)=>{d.d(U,{Q:()=>D});var F=d(85931),W=d(62208),R=d(77029),P=d(14259);class D{constructor(e=9,s){this._compareMinX=Y,this._compareMinY=g,this._toBBox=i=>i,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),z.prune(),J.prune(),A.prune(),k.prune()}all(e){this._all(this._data,e)}search(e,s){let i=this._data;const l=this._toBBox;if(V(e,i))for(z.clear();i;){for(let h=0,f=i.children.length;h<f;h++){const I=i.children[h],v=i.leaf?l(I):I;V(e,v)&&(i.leaf?s(I):S(e,v)?this._all(I,s):z.push(I))}i=z.pop()}}collides(e){let s=this._data;const i=this._toBBox;if(!V(e,s))return!1;for(z.clear();s;){for(let l=0,h=s.children.length;l<h;l++){const f=s.children[l],I=s.leaf?i(f):f;if(V(e,I)){if(s.leaf||S(e,I))return!0;z.push(f)}}s=z.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let i=0,l=e.length;i<l;i++)this.insert(e[i]);return this}let s=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const i=this._data;this._data=s,s=i}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new q([]),this}remove(e){if(!e)return this;let s,i=this._data,l=null,h=0,f=!1;const I=this._toBBox(e);for(A.clear(),k.clear();i||A.length>0;){if(i||(i=(0,W.j0)(A.pop()),l=A.data[A.length-1],h=k.pop()??0,f=!0),i.leaf&&(s=(0,F.cq)(i.children,e,i.children.length,i.indexHint),-1!==s))return i.children.splice(s,1),A.push(i),this._condense(A),this;f||i.leaf||!S(i,I)?l?(h++,i=l.children[h],f=!1):i=null:(A.push(i),k.push(h),h=0,l=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,s){let i=e;for(J.clear();i;){if(!0===i.leaf)for(const l of i.children)s(l);else J.pushArray(i.children);i=J.pop()??null}}_build(e,s,i,l){const h=i-s+1;let f=this._maxEntries;if(h<=f){const O=new q(e.slice(s,i+1));return B(O,this._toBBox),O}l||(l=Math.ceil(Math.log(h)/Math.log(f)),f=Math.ceil(h/f**(l-1)));const I=new ee([]);I.height=l;const v=Math.ceil(h/f),C=v*Math.ceil(Math.sqrt(f));re(e,s,i,C,this._compareMinX);for(let O=s;O<=i;O+=C){const Z=Math.min(O+C-1,i);re(e,O,Z,v,this._compareMinY);for(let Q=O;Q<=Z;Q+=v){const ae=Math.min(Q+v-1,Z);I.children.push(this._build(e,Q,ae,l-1))}}return B(I,this._toBBox),I}_chooseSubtree(e,s,i,l){for(;l.push(s),!0!==s.leaf&&l.length-1!==i;){let h,f=1/0,I=1/0;for(let v=0,C=s.children.length;v<C;v++){const O=s.children[v],Z=y(O),Q=x(e,O)-Z;Q<I?(I=Q,f=Z<f?Z:f,h=O):Q===I&&Z<f&&(f=Z,h=O)}s=h||s.children[0]}return s}_insert(e,s,i){const h=i?e:(0,this._toBBox)(e);A.clear();const f=this._chooseSubtree(h,this._data,s,A);for(f.children.push(e),L(f,h);s>=0&&A.data[s].children.length>this._maxEntries;)this._split(A,s),s--;this._adjustParentBBoxes(h,A,s)}_split(e,s){const i=e.data[s],l=i.children.length,h=this._minEntries;this._chooseSplitAxis(i,h,l);const f=this._chooseSplitIndex(i,h,l);if(!f)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const I=i.children.splice(f,i.children.length-f),v=i.leaf?new q(I):new ee(I);v.height=i.height,B(i,this._toBBox),B(v,this._toBBox),s?e.data[s-1].children.push(v):this._splitRoot(i,v)}_splitRoot(e,s){this._data=new ee([e,s]),this._data.height=e.height+1,B(this._data,this._toBBox)}_chooseSplitIndex(e,s,i){let l,h,f;l=h=1/0;for(let I=s;I<=i-s;I++){const v=b(e,0,I,this._toBBox),C=b(e,I,i,this._toBBox),O=N(v,C),Z=y(v)+y(C);O<l?(l=O,f=I,h=Z<h?Z:h):O===l&&Z<h&&(h=Z,f=I)}return f}_chooseSplitAxis(e,s,i){const l=e.leaf?this._compareMinX:Y,h=e.leaf?this._compareMinY:g;this._allDistMargin(e,s,i,l)<this._allDistMargin(e,s,i,h)&&e.children.sort(l)}_allDistMargin(e,s,i,l){e.children.sort(l);const h=this._toBBox,f=b(e,0,s,h),I=b(e,i-s,i,h);let v=o(f)+o(I);for(let C=s;C<i-s;C++){const O=e.children[C];L(f,e.leaf?h(O):O),v+=o(f)}for(let C=i-s-1;C>=s;C--){const O=e.children[C];L(I,e.leaf?h(O):O),v+=o(I)}return v}_adjustParentBBoxes(e,s,i){for(let l=i;l>=0;l--)L(s.data[l],e)}_condense(e){for(let s=e.length-1;s>=0;s--){const i=e.data[s];if(0===i.children.length)if(s>0){const l=e.data[s-1],h=l.children;h.splice((0,F.cq)(h,i,h.length,l.indexHint),1)}else this.clear();else B(i,this._toBBox)}}_initFormat(e){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(e[0])),this._compareMinY=new Function("a","b",s.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function B(u,e){b(u,0,u.children.length,e,u)}function b(u,e,s,i,l){l||(l=new q([])),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let h,f=e;f<s;f++)h=u.children[f],L(l,u.leaf?i(h):h);return l}function L(u,e){u.minX=Math.min(u.minX,e.minX),u.minY=Math.min(u.minY,e.minY),u.maxX=Math.max(u.maxX,e.maxX),u.maxY=Math.max(u.maxY,e.maxY)}function Y(u,e){return u.minX-e.minX}function g(u,e){return u.minY-e.minY}function y(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function o(u){return u.maxX-u.minX+(u.maxY-u.minY)}function x(u,e){return(Math.max(e.maxX,u.maxX)-Math.min(e.minX,u.minX))*(Math.max(e.maxY,u.maxY)-Math.min(e.minY,u.minY))}function N(u,e){const s=Math.max(u.minX,e.minX),i=Math.max(u.minY,e.minY),l=Math.min(u.maxX,e.maxX),h=Math.min(u.maxY,e.maxY);return Math.max(0,l-s)*Math.max(0,h-i)}function S(u,e){return u.minX<=e.minX&&u.minY<=e.minY&&e.maxX<=u.maxX&&e.maxY<=u.maxY}function V(u,e){return e.minX<=u.maxX&&e.minY<=u.maxY&&e.maxX>=u.minX&&e.maxY>=u.minY}function re(u,e,s,i,l){const h=[e,s];for(;h.length;){const f=(0,W.j0)(h.pop()),I=(0,W.j0)(h.pop());if(f-I<=i)continue;const v=I+Math.ceil((f-I)/i/2)*i;(0,P.q)(u,v,I,f,l),h.push(I,v,v,f)}}const z=new R.Z,J=new R.Z,A=new R.Z,k=new R.Z({deallocator:void 0});class oe{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class ie extends oe{constructor(){super(...arguments),this.height=1,this.indexHint=new F.SO}}class q extends ie{constructor(e){super(),this.children=e,this.leaf=!0}}class ee extends ie{constructor(e){super(),this.children=e,this.leaf=!1}}},61256:(ne,U,d)=>{d.d(U,{H:()=>L});var F=d(8314),W=d(36592),R=d(65401);const D={minX:0,minY:0,maxX:0,maxY:0};class L{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new W.Q(9,(0,F.Z)("esri-csp-restrictions")?g=>({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const g=new Array(this._idByBounds.size);let y=0;this._idByBounds.forEach((o,x)=>{g[y++]=x}),this._indexInvalid=!1,this._index.clear(),this._index.load(g)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(g=>this._idByBounds.has(g))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const g=(0,R.cS)();for(const y of this._boundsById.values())y&&(g[0]=Math.min(y[0],g[0]),g[1]=Math.min(y[1],g[1]),g[2]=Math.max(y[2],g[2]),g[3]=Math.max(y[3],g[3]));return g}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(g){const y=this._boundsById.get(g);this._boundsById.delete(g),y&&(this._idByBounds.delete(y),this._indexInvalid||this._index.remove(y))}forEachInBounds(g,y){this._loadIndex(),function b(Y,g,y){(function B(Y){D.minX=Y[0],D.minY=Y[1],D.maxX=Y[2],D.maxY=Y[3]})(g),Y.search(D,y)}(this._index,g,o=>y(this._idByBounds.get(o)))}get(g){return this._boundsById.get(g)}has(g){return this._boundsById.has(g)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(g,y){if(!this._indexInvalid){const o=this._boundsById.get(g);o&&(this._index.remove(o),this._idByBounds.delete(o))}this._boundsById.set(g,y),y&&(this._idByBounds.set(y,g),this._indexInvalid||(this._boundsToLoad.push(y),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(ne,U,d)=>{d.d(U,{Z:()=>g});var F=d(26584),W=d(61885),R=d(63290),P=d(62208),D=d(5548),B=d(65401),b=d(82054),L=d(61256),Y=d(92794);class g{constructor(o){this.geometryInfo=o,this._boundsStore=new L.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new W.Z,this.featureAdapter=Y.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let o=0;return this._featuresById.forEach(x=>{(0,P.pC)(x.geometry)&&x.geometry.coords&&(o+=x.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:o/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(o){this._add(o),this._emitChanged()}addMany(o){for(const x of o)this._add(x);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(o){const x=this._featuresById.get(o);return x?(this._remove(x),this._emitChanged(),x):null}removeManyById(o){this._boundsStore.invalidateIndex();for(const x of o){const N=this._featuresById.get(x);N&&this._remove(N)}this._emitChanged()}forEachBounds(o,x,N){for(const S of o){const V=this._boundsStore.get(S.objectId);V&&x((0,D.JR)(N,V))}}getFeature(o){return this._featuresById.get(o)}has(o){return this._featuresById.has(o)}toArray(){return Array.from(this._featuresById.values())}forEach(o){this._featuresById.forEach(x=>o(x))}forEachInBounds(o,x){this._boundsStore.forEachInBounds(o,N=>{x(this._featuresById.get(N))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let o=!1;this._featuresById.forEach((x,N)=>{this._markedIds.has(N)||(o=!0,this._remove(x))}),this._markedIds.clear(),o&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(o){if(!o)return;const x=o.objectId;if(null==x)return void R.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new F.Z("featurestore:invalid-feature","feature id is missing",{feature:o}));const N=this._featuresById.get(x);let S;if(this._markedIds.add(x),N?(o.displayId=N.displayId,S=this._boundsStore.get(x),this._boundsStore.delete(x)):(0,P.pC)(this.onFeatureAdd)&&this.onFeatureAdd(o),(0,P.Wi)(o.geometry)||!o.geometry.coords||!o.geometry.coords.length)return this._boundsStore.set(x,null),void this._featuresById.set(x,o);S=(0,b.$)((0,P.pC)(S)?S:(0,B.Ue)(),o.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,P.pC)(S)&&this._boundsStore.set(x,S),this._featuresById.set(x,o)}_remove(o){return(0,P.pC)(this.onFeatureRemove)&&this.onFeatureRemove(o),this._markedIds.delete(o.objectId),this._boundsStore.delete(o.objectId),this._featuresById.delete(o.objectId),o}}},92794:(ne,U,d)=>{d.d(U,{n:()=>D});var F=d(62208),W=d(77044),R=d(66385),P=d(88071);const D={getObjectId:B=>B.objectId,getAttributes:B=>B.attributes,getAttribute:(B,b)=>B.attributes[b],cloneWithGeometry:(B,b)=>new R.u_(b,B.attributes,null,B.objectId),getGeometry:B=>B.geometry,getCentroid:(B,b)=>((0,F.Wi)(B.centroid)&&(B.centroid=(0,W.Y)(new P.Z,B.geometry,b.hasZ,b.hasM)),B.centroid)}},39155:(ne,U,d)=>{d.r(U),d.d(U,{default:()=>Be});var F=d(15861),R=(d(29132),d(84792)),P=d(59213),D=d(26584),B=d(63290),b=d(10699),L=d(21726),Y=d(55915),g=d(15994),y=d(37053),o=d(46367),x=d(66385),N=d(88071),S=d(3579),V=d(82959),re=d(58175),z=d(75327);const J=/^\s*"([\S\s]*)"\s*$/,A=/""/g,oe=[","," ",";","|","\t"];function*ie(c,r,t){let n=0;for(;n<=c.length;){const a=c.indexOf(r,n),m=c.substring(n,a>-1?a:void 0);n+=m.length+r.length,t&&!m.trim()||(yield m)}}function q(c){const r=c.includes("\r\n")?"\r\n":"\n";return ie(c,r,!0)}function ee(c,r){return ie(c,r,!1)}function*e(c,r,t,n=(()=>Object.create(null))){const a=q(c);a.next();let m="",_="",E=0,M=n(),j=0;e:for(const H of a){const K=ee(H,t);for(const w of K)if(m+=_+w,_="",E+=l(w),E%2==0){if(E>0){const $=J.exec(m);if(!$){M=n(),j=0,m="",E=0;continue e}M[r[j]]=$[1].replace(A,'"'),j++}else M[r[j]]=m,j++;m="",E=0}else _=t;0===E?(yield M,M=n(),j=0):_="\n"}}function s(c,r){const t=i(c,r).filter(a=>null!=a),n=t.map(a=>le(a));for(let a=n.length-1;a>=0;a--)n[a]||(n.splice(a,1),t.splice(a,1));return{names:n,aliases:t}}function i(c,r){if(!c?.length)return[];const t=[];let n="",a="",m=0;const _=ee(c,r);for(const E of _)if(n+=a+E,a="",m+=l(E),m%2==0){if(m>0){const M=J.exec(n);M&&t.push(M[1].replace(A,'"'))}else t.push(n);n="",m=0}else a=r;return t}function l(c){let r=0,t=0;for(t=c.indexOf('"',t);t>=0;)r++,t=c.indexOf('"',t+1);return r}function h(c,r,t){r=le(r)?.toLowerCase(),t=le(t)?.toLowerCase();const n=c.map(_=>_.toLowerCase()),a=r?c[n.indexOf(r)]:null,m=t?c[n.indexOf(t)]:null;return{longitudeFieldName:a||c[n.indexOf(ae.find(_=>n.includes(_)))],latitudeFieldName:m||c[n.indexOf(Q.find(_=>n.includes(_)))]}}function I(c){if(!c.length)return"string";const r=/[^+-.,0-9]/;return c.map(t=>{let n=!1;if(""!==t){if(r.test(t))n=!0;else{let a=C(t);if(!isNaN(a))return/[.,]/.test(t)||!Number.isInteger(a)||a>214783647||a<-214783648?"double":"integer";if(t.includes("E")){if(a=Number(t),!isNaN(a))return"double";if(t.includes(",")){if(t=t.replace(",","."),a=Number(t),!isNaN(a))return"double";n=!0}else n=!0}else n=!0}return n?/^[-]?\d*[.,]?\d*$/.test(t)?"string":v(new Date(t),t)?"date":"string":"string"}}).reduce((t,n)=>void 0===t?n:void 0===n?t:t===n?n:"string"===t||"string"===n?"string":"double"===t||"double"===n?"double":void 0)}function v(c,r){if(!c||"[object Date]"!==Object.prototype.toString.call(c)||isNaN(c.getTime()))return!1;let t=!0;if(!Z&&/\d+\W*$/.test(r)){const n=r.match(/[a-zA-Z]{2,}/);if(n){let a=!1,m=0;for(;!a&&m<=n.length;)a=!O.test(n[m]),m++;t=!a}}return t}const C=function(){const c=(0,z.lt)(),r=new RegExp("^"+c.regexp+"$"),t=new RegExp("["+c.group+"\\s\\xa0]","g"),n=c.factor;return a=>{const m=r.exec(a);if(c.factor=n,!m)return NaN;let _=m[1];if(!m[1]){if(!m[2])return NaN;_=m[2],c.factor*=-1}return _=_.replace(t,"").replace(c.decimal,"."),+_*c.factor}}(),O=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,Z=Number.isNaN(new Date("technology 10").getTime()),Q=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],ae=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"],he=/^([0-9])/,ce=/[^A-Za-z0-9_\u0080-\uffff]/g,me=/_{2,}/g,fe=/^_/,_e=/_$/;function le(c){return c?c.trim().replace(ce,"_").replace(me,"_").replace(fe,"").replace(_e,"").replace(he,"F$1"):null}var de=d(56554),ue=d(60466),pe=d(36630),ge=d(65234);const ye=(0,de.bU)("esriGeometryPoint"),Ie=["csv"],xe=[0,0];class Ee{constructor(r,t){this.x=r,this.y=t}}class Be{constructor(){var r=this;this._queryEngine=null,this._snapshotFeatures=function(){var t=(0,F.Z)(function*(n){const a=yield r._fetch(n);return r._createFeatures(a)});return function(n){return t.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(r,t={}){var n=this;return(0,F.Z)(function*(){n._loadOptions=r;const[a]=yield Promise.all([n._fetch(t.signal),n._checkProjection(r?.parsingOptions?.spatialReference)]),m=function ve(c,r){const t=r.parsingOptions||{},n={delimiter:t.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}},a=n.layerDefinition={name:(0,L.vt)(r.url,Ie)||"csv",drawingInfo:ye,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:t.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:102100}}},m=q(c),_=m.next().value?.trim(),E=m.next().value?.trim();if(!_)throw new D.Z("csv-layer:empty-csv","CSV is empty",{csv:c});const{delimiter:M,locationInfo:j}=function u(c,r,t){c=c.trim(),r=r?.trim();const n=[],a=Array.from(new Set([t?.delimiter,...oe])).filter(_=>null!=_);for(const _ of a){const E=i(c,_).length,M=i(r,_).length??E;E>1&&n.push({weight:Math.min(E,M),delimiter:_})}const m=n.sort(({weight:_},{weight:E})=>E-_).map(({delimiter:_})=>_);for(const _ of m){const E=h(s(c,_).names,t?.longitudeField,t?.latitudeField);if(E.longitudeFieldName&&E.latitudeFieldName)return{delimiter:_,locationInfo:E}}return{delimiter:m[0],locationInfo:null}}(_,E,t);if(!M)throw new D.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:_,secondLine:E,parsingOptions:t});if(!j)throw new D.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file",{firstLine:_,secondLine:E,parsingOptions:t});n.locationInfo=j,n.delimiter=M;const{names:H,aliases:K}=s(_,M),w=function f(c,r,t,n,a){const m=[],_=e(c,t,r),E=[];for(const M of _){if(10===E.length)break;E.push(M)}for(let M=0;M<t.length;M++){const j=t[M],H=n[M];if(j===a.longitudeFieldName||j===a.latitudeFieldName)m.push({name:j,type:"esriFieldTypeDouble",alias:H});else{let K,w;switch(I(E.map($=>$[j]))){case"integer":K="esriFieldTypeInteger";break;case"double":K="esriFieldTypeDouble";break;case"date":K="esriFieldTypeDate",w=36;break;default:K="esriFieldTypeString",w=255}m.push({name:j,type:K,alias:H,length:w})}}return m}(c,n.delimiter,H,K,n.locationInfo);if(t.fields?.length){const T=new ue.Z(t.fields);for(const p of w){const G=T.get(p.name);G&&Object.assign(p,G)}}if(!w.some(T=>"esriFieldTypeOID"===T.type&&(a.objectIdField=T.name,!0))){const T={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};a.objectIdField=T.name,w.unshift(T)}a.fields=w;const $=new ue.Z(a.fields);if(n.locationInfo&&(n.locationInfo.latitudeFieldName=$.get(n.locationInfo.latitudeFieldName).name,n.locationInfo.longitudeFieldName=$.get(n.locationInfo.longitudeFieldName).name),a.timeInfo){const T=a.timeInfo;if(T.startTimeField){const p=$.get(T.startTimeField);p?(T.startTimeField=p.name,p.type="esriFieldTypeDate"):T.startTimeField=null}if(T.endTimeField){const p=$.get(T.endTimeField);p?(T.endTimeField=p.name,p.type="esriFieldTypeDate"):T.endTimeField=null}if(T.trackIdField){const p=$.get(T.trackIdField);T.trackIdField=p?p.name:null}T.startTimeField||T.endTimeField||(a.timeInfo=null)}return n}(a,r);n._locationInfo=m.locationInfo,n._delimiter=m.delimiter,n._queryEngine=n._createQueryEngine(m);const _=yield n._createFeatures(a);if(n._queryEngine.featureStore.addMany(_),m.layerDefinition.extent=n._queryEngine.fullExtent,m.layerDefinition.timeInfo){const{start:E,end:M}=n._queryEngine.timeExtent;m.layerDefinition.timeInfo.timeExtent=[E,M]}return m})()}applyEdits(){return(0,F.Z)(function*(){throw new D.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(r={},t={}){var n=this;return(0,F.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQuery(r,t.signal)})()}queryFeatureCount(r={},t={}){var n=this;return(0,F.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForCount(r,t.signal)})()}queryObjectIds(r={},t={}){var n=this;return(0,F.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForIds(r,t.signal)})()}queryExtent(r={},t={}){var n=this;return(0,F.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForExtent(r,t.signal)})()}querySnapping(r,t={}){var n=this;return(0,F.Z)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForSnapping(r,t.signal)})()}refresh(r){var t=this;return(0,F.Z)(function*(){return t._loadOptions.customParameters=r,t._snapshotTask?.abort(),t._snapshotTask=(0,P.vr)(t._snapshotFeatures),t._snapshotTask.promise.then(n=>{t._queryEngine.featureStore.clear(),n&&t._queryEngine.featureStore.addMany(n)},n=>{t._queryEngine.featureStore.clear(),(0,b.D_)(n)||B.Z.getLogger("esri.layers.CSVLayer").error(new D.Z("csv-layer:refresh","An error occurred during refresh",{error:n}))}),yield t._waitSnapshotComplete(),{extent:t._queryEngine.fullExtent,timeExtent:t._queryEngine.timeExtent}})()}_waitSnapshotComplete(){var r=this;return(0,F.Z)(function*(){if(r._snapshotTask&&!r._snapshotTask.finished){try{yield r._snapshotTask.promise}catch{}return r._waitSnapshotComplete()}})()}_fetch(r){var t=this;return(0,F.Z)(function*(){const{url:n,customParameters:a}=t._loadOptions;if(!n)throw new D.Z("csv-layer:invalid-source","url not defined");const m=(0,L.mN)(n);return(yield(0,R.default)(m.path,{query:{...m.query,...a},responseType:"text",signal:r})).data})()}_createQueryEngine(r){const{objectIdField:t,fields:n,extent:a,timeInfo:m}=r.layerDefinition,_=new S.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new re.q({fields:n,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:m,objectIdField:t,spatialReference:a.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:_})}_createFeatures(r){var t=this;return(0,F.Z)(function*(){const{latitudeFieldName:n,longitudeFieldName:a}=t._locationInfo,{objectIdField:m,fieldsIndex:_,spatialReference:E}=t._queryEngine;let M=[];const j=[],H=_.fields.filter(p=>p.name!==m).map(p=>p.name);let K=0;const w={};for(const p of _.fields)if("esriFieldTypeOID"!==p.type&&"esriFieldTypeGlobalID"!==p.type){const G=(0,pe.os)(p);void 0!==G&&(w[p.name]=G)}const $=e(r,H,t._delimiter,(0,de.Dm)(w,m));for(const p of $){const G=t._parseCoordinateValue(p[n]),te=t._parseCoordinateValue(p[a]);if(null!=te&&null!=G&&!isNaN(G)&&!isNaN(te)){p[n]=G,p[a]=te;for(const X in p)if(X!==n&&X!==a)if(_.isDateField(X)){const se=new Date(p[X]);p[X]=v(se,p[X])?se.getTime():null}else if(_.isNumericField(X)){const se=C(p[X]);p[X]=isNaN(se)?null:se}p[m]=K,K++,M.push(new Ee(te,G)),j.push(p)}}if(!(0,y.fS)({wkid:4326},E))if((0,y.sS)(E))for(const p of M)[p.x,p.y]=(0,o.hG)(p.x,p.y,xe);else M=(0,Y.oj)(g.N,M,ge.Z.WGS84,E,null,null);const T=[];for(let p=0;p<M.length;p++){const{x:G,y:te}=M[p],X=j[p];X[m]=p+1,T.push(new x.u_(new N.Z([],[G,te]),X,null,X[m]))}return T})()}_parseCoordinateValue(r){if(null==r||""===r)return null;let t=C(r);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(r)),t}_checkProjection(r){return(0,F.Z)(function*(){try{yield(0,V._W)(y.Zn,r)}catch{throw new D.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}},56554:(ne,U,d)=>{d.d(U,{Dm:()=>L,Hq:()=>Y,MS:()=>g,bU:()=>D});var F=d(8314),W=d(58817),R=d(87757),P=d(24837);function D(y){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===y||"esriGeometryMultipoint"===y?P.I4:"esriGeometryPolyline"===y?P.ET:P.lF}}}const B=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let b=1;function L(y,o){if((0,F.Z)("esri-csp-restrictions"))return()=>({[o]:null,...y});try{let x=`this.${o} = null;`;for(const S in y)x+=`this${B.test(S)?`.${S}`:`["${S}"]`} = ${JSON.stringify(y[S])};`;const N=new Function(`\n      return class AttributesClass$${b++} {\n        constructor() {\n          ${x};\n        }\n      }\n    `)();return()=>new N}catch{return()=>({[o]:null,...y})}}function Y(y={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,W.d9)(y)}}]}function g(y,o){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:y},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:o,supportsDelete:o,supportsEditing:o,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:o,supportsExceedsLimitStatistics:!0},query:R.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:o,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);