"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[2701],{12701:(he,R,o)=>{o.r(R),o.d(R,{default:()=>de});var B=o(15861),n=o(17626),G=(o(29132),o(46160)),D=o(46882),x=o(62208),Q=o(99959),V=o(10699),L=o(32917),J=o(21726),u=o(77712),U=(o(85931),o(8314),o(90912)),I=o(68653),K=o(76898),X=o(99433),F=o(65234),$=o(44917),w=o(552),k=o(49286),q=o(6647),_=o(30346),ee=o(99555),te=o(13812),se=o(61885),re=o(86810),le=o(47996),oe=o(77275),ne=o(66656),ie=o(59318),z=o(24263),ae=(o(73281),o(84792)),P=o(58817),v=o(5548),O=o(32442);o(33474),o(17253);const ye={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function H(e){const r=e.folders||[],s=r.slice(),l=new Map,a=new Map,d=new Map,c=new Map,C=new Map,b={esriGeometryPoint:a,esriGeometryPolyline:d,esriGeometryPolygon:c};(e.featureCollection&&e.featureCollection.layers||[]).forEach(i=>{const S=(0,P.d9)(i);S.featureSet.features=[];const h=i.featureSet.geometryType;l.set(h,S);const N=i.layerDefinition.objectIdField;"esriGeometryPoint"===h?M(a,N,i.featureSet.features):"esriGeometryPolyline"===h?M(d,N,i.featureSet.features):"esriGeometryPolygon"===h&&M(c,N,i.featureSet.features)}),e.groundOverlays&&e.groundOverlays.forEach(i=>{C.set(i.id,i)}),r.forEach(i=>{i.networkLinkIds.forEach(S=>{const h=function pe(e,r,s){const l=function ue(e,r){let s;return r.some(l=>l.id===e&&(s=l,!0)),s}(e,s);return l&&(l.parentFolderId=r,l.networkLink=l),l}(S,i.id,e.networkLinks);h&&s.push(h)})}),s.forEach(i=>{if(i.featureInfos){i.points=(0,P.d9)(l.get("esriGeometryPoint")),i.polylines=(0,P.d9)(l.get("esriGeometryPolyline")),i.polygons=(0,P.d9)(l.get("esriGeometryPolygon")),i.mapImages=[];for(const S of i.featureInfos)switch(S.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const h=b[S.type].get(S.id);h&&i[ye[S.type]].featureSet.features.push(h);break}case"GroundOverlay":{const h=C.get(S.id);h&&i.mapImages.push(h);break}}i.fullExtent=Z([i])}});const g=Z(s);return{folders:r,sublayers:s,extent:g}}function Y(e,r,s,l){const a=z.id&&z.id.findCredential(e);return e=(0,J.fl)(e,{token:a&&a.token}),(0,ae.default)(ie.Z.kmlServiceUrl,{query:{url:e,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(r)},responseType:"json",signal:l})}function A(e,r,s=null,l=[]){const a=[],d={},c=r.sublayers,C=r.folders.map(b=>b.id);return c.forEach(b=>{const g=new e;if(s?g.read(b,s):g.read(b),l.length&&C.includes(g.id)&&(g.visible=l.includes(g.id)),d[b.id]=g,null!=b.parentFolderId&&-1!==b.parentFolderId){const i=d[b.parentFolderId];i.sublayers||(i.sublayers=[]),i.sublayers.unshift(g)}else a.unshift(g)}),a}function M(e,r,s){s.forEach(l=>{e.set(l.attributes[r],l)})}function Z(e){const r=(0,v.Ue)(v.Gv),s=(0,v.Ue)(v.Gv);for(const l of e){if(l.polygons&&l.polygons.featureSet&&l.polygons.featureSet.features)for(const a of l.polygons.featureSet.features)(0,O.Yg)(r,a.geometry),(0,v.TC)(s,r);if(l.polylines&&l.polylines.featureSet&&l.polylines.featureSet.features)for(const a of l.polylines.featureSet.features)(0,O.Yg)(r,a.geometry),(0,v.TC)(s,r);if(l.points&&l.points.featureSet&&l.points.featureSet.features)for(const a of l.points.featureSet.features)(0,O.Yg)(r,a.geometry),(0,v.TC)(s,r);if(l.mapImages)for(const a of l.mapImages)(0,O.Yg)(r,a.extent),(0,v.TC)(s,r)}return(0,v.fS)(s,v.Gv)?null:{xmin:s[0],ymin:s[1],zmin:s[2],xmax:s[3],ymax:s[4],zmax:s[5],spatialReference:F.Z.WGS84}}var E,j=o(2004);let f=E=class extends(se.Z.EventedMixin((0,re.eC)(le.Z))){constructor(){super(...arguments),this._sublayersHandles=null,this.description=null,this.id=null,this.networkLink=null,this.title=null,this.sourceJSON=null,this.fullExtent=null}initialize(){(0,L.N1)(()=>this.networkLink).then(()=>(0,L.N1)(()=>!0===this.visible)).then(()=>this.load())}load(e){if(!this.networkLink||this.networkLink.viewFormat)return;const r=(0,x.pC)(e)?e.signal:null,s=this._fetchService(this._get("networkLink").href,r).then(l=>{const a=Z(l.sublayers);this.fullExtent=j.Z.fromJSON(a),this.sourceJSON=l;const d=(0,U.se)(G.Z.ofType(E),A(E,l));this.sublayers?this.sublayers.addMany(d):this.sublayers=d,this.layer.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")});return this.addResolvingPromise(s),Promise.resolve(this)}set sublayers(e){const r=this._get("sublayers");r&&(r.forEach(s=>{s.parent=null,s.layer=null}),this._sublayersHandles.forEach(s=>s.remove()),this._sublayersHandles=null),e&&(e.forEach(s=>{s.parent=this,s.layer=this.layer}),this._sublayersHandles=[e.on("after-add",({item:s})=>{s.parent=this,s.layer=this.layer}),e.on("after-remove",({item:s})=>{s.parent=null,s.layer=null})]),this._set("sublayers",e)}castSublayers(e){return(0,U.se)(G.Z.ofType(E),e)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,r){return!!r.visibility}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(r=>r.layer=e)}_fetchService(e,r){return Y(e,this.layer.outSpatialReference,this.layer.refreshInterval,r).then(s=>H(s.data))}};(0,n._)([(0,u.Cb)()],f.prototype,"description",void 0),(0,n._)([(0,u.Cb)()],f.prototype,"id",void 0),(0,n._)([(0,u.Cb)({readOnly:!0,value:null})],f.prototype,"networkLink",void 0),(0,n._)([(0,u.Cb)({json:{write:{allowNull:!0}}})],f.prototype,"parent",void 0),(0,n._)([(0,u.Cb)({value:null,json:{write:{allowNull:!0}}})],f.prototype,"sublayers",null),(0,n._)([(0,ne.p)("sublayers")],f.prototype,"castSublayers",null),(0,n._)([(0,u.Cb)({value:null,json:{read:{source:"name",reader:e=>(0,oe.Cb)(e)}}})],f.prototype,"title",void 0),(0,n._)([(0,u.Cb)({value:!0})],f.prototype,"visible",null),(0,n._)([(0,I.r)("visible",["visibility"])],f.prototype,"readVisible",null),(0,n._)([(0,u.Cb)()],f.prototype,"sourceJSON",void 0),(0,n._)([(0,u.Cb)({value:null})],f.prototype,"layer",null),(0,n._)([(0,u.Cb)({type:j.Z})],f.prototype,"fullExtent",void 0),f=E=(0,n._)([(0,K.j)("esri.layers.support.KMLSublayer")],f);const W=f,fe=["kml","xml"];let p=class extends((0,w.h)((0,_.Q)((0,ee.M)((0,k.q)((0,q.I)((0,Q.R)($.Z))))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new D.Z({getCollections:()=>[this.sublayers],getChildrenFunction:r=>r.sublayers}),this.outSpatialReference=F.Z.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.own([(0,L.YP)(()=>this.sublayers,(e,r)=>{r&&r.forEach(s=>{s.parent=null,s.layer=null}),e&&e.forEach(s=>{s.parent=this,s.layer=this})},L.Z_),this.on("sublayer-update",()=>this.notifyChange("fullExtent"))])}normalizeCtorArgs(e,r){return"string"==typeof e?{url:e,...r}:e}readSublayersFromItemOrWebMap(e,r){this._visibleFolders=r.visibleFolders}readSublayers(e,r,s){return A(W,r,s,this._visibleFolders)}writeSublayers(e,r){const s=[],l=e.toArray();for(;l.length;){const a=l[0];a.networkLink||(a.visible&&s.push(a.id),a.sublayers&&l.push(...a.sublayers.toArray())),l.shift()}r.visibleFolders=s}get title(){const e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?(0,J.vt)(this.url,fe)||"KML":e||""}set title(e){this._set("title",e)}get visibleSublayers(){const e=this.sublayers,r=[],s=l=>{l.visible&&(r.push(l),l.sublayers&&l.sublayers.forEach(s))};return e&&e.forEach(s),r}get fullExtent(){return this._recomputeFullExtent()}load(e){const r=(0,x.pC)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"]},e).catch(V.r9).then(()=>this._fetchService(r))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}_fetchService(e){var r=this;return(0,B.Z)(function*(){const l=H((yield Promise.resolve().then(()=>r.resourceInfo?{ssl:!1,data:r.resourceInfo}:Y(r.url,r.outSpatialReference,r.refreshInterval,e))).data);l&&r.read(l,{origin:"service"})})()}_recomputeFullExtent(){let e=null;(0,x.pC)(this.extent)&&(e=this.extent.clone());const r=s=>{if(s.sublayers)for(const l of s.sublayers.items)r(l),l.visible&&l.fullExtent&&((0,x.pC)(e)?e.union(l.fullExtent):e=l.fullExtent.clone())};return r(this),e}};(0,n._)([(0,u.Cb)({readOnly:!0})],p.prototype,"allSublayers",void 0),(0,n._)([(0,u.Cb)({type:F.Z})],p.prototype,"outSpatialReference",void 0),(0,n._)([(0,u.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0),(0,n._)([(0,u.Cb)({readOnly:!0,json:{read:!1,write:!1}})],p.prototype,"legendEnabled",void 0),(0,n._)([(0,u.Cb)({type:["show","hide","hide-children"]})],p.prototype,"listMode",void 0),(0,n._)([(0,u.Cb)({type:["KML"]})],p.prototype,"operationalLayerType",void 0),(0,n._)([(0,u.Cb)({})],p.prototype,"resourceInfo",void 0),(0,n._)([(0,u.Cb)({type:G.Z.ofType(W),json:{write:{ignoreOrigin:!0}}})],p.prototype,"sublayers",void 0),(0,n._)([(0,I.r)(["web-map","portal-item"],"sublayers",["visibleFolders"])],p.prototype,"readSublayersFromItemOrWebMap",null),(0,n._)([(0,I.r)("service","sublayers",["sublayers"])],p.prototype,"readSublayers",null),(0,n._)([(0,X.c)("sublayers")],p.prototype,"writeSublayers",null),(0,n._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],p.prototype,"type",void 0),(0,n._)([(0,u.Cb)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],p.prototype,"title",null),(0,n._)([(0,u.Cb)(te.HQ)],p.prototype,"url",void 0),(0,n._)([(0,u.Cb)({readOnly:!0})],p.prototype,"visibleSublayers",null),(0,n._)([(0,u.Cb)({type:j.Z})],p.prototype,"extent",void 0),(0,n._)([(0,u.Cb)()],p.prototype,"fullExtent",null),p=(0,n._)([(0,K.j)("esri.layers.KMLLayer")],p);const de=p}}]);