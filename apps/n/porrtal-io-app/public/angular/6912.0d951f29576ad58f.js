"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[6912],{52489:(M,E,o)=>{o.d(E,{D:()=>c});var i=o(22558);function c(p){p&&p.writtenProperties&&p.writtenProperties.forEach(({target:h,propName:y,newOrigin:f})=>{(0,i.l)(h)&&f&&h.originOf(y)!==f&&h.updateOrigin(y,f)})}},22558:(M,E,o)=>{function i(c){return c&&"getAtOrigin"in c&&"originOf"in c}o.d(E,{l:()=>i})},36912:(M,E,o)=>{o.r(E),o.d(E,{save:()=>ut,saveAll:()=>pt,saveAs:()=>dt});var i=o(15861),c=o(85931),p=o(26584),h=o(63290),y=o(62208),f=o(10699),D=o(52489),I=o(80415),L=o(38305),U=o(17196),O=o(72469),x=o(84687),d=o(55463),u=o(88755),l=o(37281);const P=h.Z.getLogger("esri.layers.FeatureLayer"),A="Feature Service";function v(t,e){return`Layer (title: ${t.title}, id: ${t.id}) of type '${t.declaredClass}' ${e}`}function z(t,e){if(e.type!==A)throw new p.Z("feature-layer:portal-item-wrong-type",v(t,`should have portal item of type "${A}"`))}function G(t){return K.apply(this,arguments)}function K(){return(K=(0,i.Z)(function*(t){if(yield t.load(),(0,O.rQ)(t))throw new p.Z("feature-layer:save",v(t,"using an in-memory source cannot be saved to a portal item"))})).apply(this,arguments)}function q(t,e){let a=(t.messages??[]).filter(({type:r})=>"error"===r).map(({name:r,message:s,details:n})=>new p.Z(r,s,n));if(e?.ignoreUnsupported&&(a=a.filter(({name:r})=>"layer:unsupported"!==r&&"symbol:unsupported"!==r&&"symbol-layer:unsupported"!==r&&"property:unsupported"!==r&&"url:unsupported"!==r)),a.length>0)throw new p.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}function T(t,e,a){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)(function*(t,e,a){"beforeSave"in t&&"function"==typeof t.beforeSave&&(yield t.beforeSave());const r=t.write({},e);return q(e,a),r})).apply(this,arguments)}function Y(t){const{layer:e,layerJSON:a}=t;return e.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function R(t){(0,l.qj)(t,l.Kz.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,a,r)=>r.indexOf(e)===a))}function tt(t){const e=t.portalItem;if(!e)throw P.error("save: requires the portalItem property to be set"),new p.Z("feature-layer:portal-item-not-set",v(t,"requires the portalItem property to be set"));if(!e.loaded)throw new p.Z("feature-layer:portal-item-not-loaded",v(t,"cannot be saved to a portal item that does not exist or is inaccessible"));z(t,e)}function F(t,e){return j.apply(this,arguments)}function j(){return(j=(0,i.Z)(function*(t,e){return/\/\d+\/?$/.test(t.url??"")?Y(e[0]):et(t,e)})).apply(this,arguments)}function et(t,e){return C.apply(this,arguments)}function C(){return(C=(0,i.Z)(function*(t,e){const{layer:{url:a,customParameters:r,apiKey:s}}=e[0];let n=yield t.fetchData("json");n&&null!=n.layers&&null!=n.tables||(n=yield rt(n,{url:a??"",customParameters:r,apiKey:s},e.map(_=>_.layer.layerId)));for(const _ of e)V(_.layer,_.layerJSON,n);return n})).apply(this,arguments)}function rt(t,e,a){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.Z)(function*(t,e,a){var r,s;t||(t={}),(r=t).layers||(r.layers=[]),(s=t).tables||(s.tables=[]);const{url:n,customParameters:_,apiKey:m}=e,{serviceJSON:g,layersJSON:$}=yield(0,U.V)(n,{customParameters:_,apiKey:m}),X=Q(t.layers,g.layers,a),k=Q(t.tables,g.tables,a);t.layers=X.itemResources,t.tables=k.itemResources;const ct=[...X.added,...k.added],ft=$?[...$.layers,...$.tables]:[];return yield at(t,ct,n,ft),t})).apply(this,arguments)}function Q(t,e,a){const r=(0,c.e5)(t,e,(n,_)=>n.id===_.id);t=t.filter(n=>!r.removed.some(_=>_.id===n.id));const s=r.added.map(({id:n})=>({id:n}));return s.forEach(({id:n})=>{t.push({id:n})}),{itemResources:t,added:s.filter(({id:n})=>!a.includes(n))}}function at(t,e,a,r){return B.apply(this,arguments)}function B(){return(B=(0,i.Z)(function*(t,e,a,r){const s=e.map(({id:n})=>new I.default({url:a,layerId:n,sourceJSON:r.find(({id:_})=>_===n)}));yield(0,f.as)(s.map(n=>n.load())),s.forEach(n=>{const{layerId:_,loaded:m,defaultPopupTemplate:g}=n;!m||(0,y.Wi)(g)||V(n,{id:_,popupInfo:g.toJSON()},t)})})).apply(this,arguments)}function V(t,e,a){!function H(t,e){if(!t)return;const a=t.findIndex(({id:r})=>r===e.id);-1===a?t.push(e):t[a]=e}(t.isTable?a.tables:a.layers,e)}function nt(t){const{portalItem:e}=t;return(0,O.y2)(t)&&!t.dynamicDataSource&&!!e?.loaded&&e.type===A}function w(){return(w=(0,i.Z)(function*(t){if(!t?.length)throw new p.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");yield Promise.all(t.map(r=>r.load()));for(const r of t)if(!nt(r))throw new p.Z("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${v(r,"does not conform")}`,{layer:r});const e=t.map(r=>r.portalItem.id);if(new Set(e).size>1)throw new p.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=t.map(r=>r.layerId);if(new Set(a).size!==a.length)throw new p.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")})).apply(this,arguments)}function st(t,e){var a,r;let s=d.default.from(e);return s.id&&(s=s.clone(),s.id=null),(a=s).type??(a.type=A),(r=s).portal??(r.portal=x.Z.getDefault()),z(t,s),s}function lt(t,e){return W.apply(this,arguments)}function W(){return(W=(0,i.Z)(function*(t,e){const{url:a,layerId:r,title:s,fullExtent:n,isTable:_}=t,m=(0,L.Qc)(a),g=(0,y.pC)(m)&&"FeatureServer"===m.serverType;e.url=g?a:`${a}/${r}`,e.title||(e.title=s),e.extent=null,!_&&(0,y.pC)(n)&&(e.extent=yield(0,l.$o)(n)),(0,l.ck)(e,l.Kz.METADATA),(0,l.ck)(e,l.Kz.MULTI_LAYER),(0,l.qj)(e,l.Kz.SINGLE_LAYER),_&&(0,l.qj)(e,l.Kz.TABLE),R(e)})).apply(this,arguments)}function it(t,e,a){return b.apply(this,arguments)}function b(){return(b=(0,i.Z)(function*(t,e,a){const r=t.portal;yield r?._signIn(),yield r?.user?.addItem({item:t,data:e,folder:a?.folder})})).apply(this,arguments)}const ut=(0,f.Ds)(function _t(t,e){return N.apply(this,arguments)});function N(){return(N=(0,i.Z)(function*(t,e){yield G(t),tt(t);const a=t.portalItem,r=(0,u.Y)(a),s=yield T(t,r,e),n=yield F(a,[{layer:t,layerJSON:s}]);return R(a),yield a.update({data:n}),(0,D.D)(r),a})).apply(this,arguments)}const pt=(0,f.Ds)(function(){var t=(0,i.Z)(function*(e,a){yield function ot(t){return w.apply(this,arguments)}(e);const r=e[0].portalItem,s=(0,u.Y)(r),n=yield Promise.all(e.map(m=>T(m,s,a))),_=yield F(r,e.map((m,g)=>({layer:m,layerJSON:n[g]})));return R(r),yield r.update({data:_}),yield Promise.all(e.slice(1).map(m=>m.portalItem.reload())),(0,D.D)(s),r.clone()});return function(e,a){return t.apply(this,arguments)}}()),dt=(0,f.Ds)(function yt(t,e,a){return J.apply(this,arguments)});function J(){return(J=(0,i.Z)(function*(t,e,a){yield G(t);const r=st(t,e),s=(0,u.Y)(r),n=Y({layer:t,layerJSON:yield T(t,s,a)});return yield lt(t,r),yield it(r,n,a),t.portalItem=r,(0,D.D)(s),r})).apply(this,arguments)}},88755:(M,E,o)=>{o.d(E,{Y:()=>h,h:()=>p});var i=o(21726),c=o(84687);function p(y){return{origin:"portal-item",url:(0,i.mN)(y.itemUrl),portal:y.portal||c.Z.getDefault(),portalItem:y,readResourcePaths:[]}}function h(y){return{origin:"portal-item",messages:[],writtenProperties:[],url:y.itemUrl?(0,i.mN)(y.itemUrl):null,portal:y.portal||c.Z.getDefault(),portalItem:y}}},37281:(M,E,o)=>{o.d(E,{$o:()=>U,Kz:()=>x,_$:()=>I,ck:()=>L,qj:()=>D});var i=o(15861),c=o(55915),p=o(65234),h=o(46367);function y(d){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)(function*(d){const u=d.spatialReference;if(u.isWGS84)return d.clone();if(u.isWebMercator)return(0,h.Sx)(d);const l=p.Z.WGS84;return yield(0,c.iQ)(u,l),(0,c.iV)(d,l)})).apply(this,arguments)}function D(d,u){if(!I(d,u)){const l=d.typeKeywords;l?l.push(u):d.typeKeywords=[u]}}function I(d,u){return!!d.typeKeywords?.includes(u)}function L(d,u){const l=d.typeKeywords;if(l){const P=l.indexOf(u);P>-1&&l.splice(P,1)}}function U(d){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)(function*(d){const u=d.clone().normalize();let l;if(u.length>1)for(const P of u)l?P.width>l.width&&(l=P):l=P;else l=u[0];return y(l)})).apply(this,arguments)}const x={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}}]);