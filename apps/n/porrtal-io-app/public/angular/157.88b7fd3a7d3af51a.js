/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[157,587],{52489:(G,P,s)=>{s.d(P,{D:()=>u});var c=s(22558);function u(_){_&&_.writtenProperties&&_.writtenProperties.forEach(({target:y,propName:x,newOrigin:O})=>{(0,c.l)(y)&&O&&y.originOf(x)!==O&&y.updateOrigin(x,O)})}},22558:(G,P,s)=>{function c(u){return u&&"getAtOrigin"in u&&"originOf"in u}s.d(P,{l:()=>c})},10157:(G,P,s)=>{s.d(P,{xp:()=>J,Vt:()=>te});var c=s(15861),u=s(17626),_=s(84792),y=s(26584),O=(s(8314),s(63290)),R=s(62208),U=s(10699),g=s(21726),m=s(77712),E=(s(85931),s(90912),s(68653)),N=s(76898),A=s(99433),b=s(52489),w=s(2004),C=s(79334),B=s(65234),j=s(38305),a=s(13812),p=s(60595),h=s(84687),f=s(55463),T=s(59213),V=s(35948),M=s(10587);function K(l,i,r){return D.apply(this,arguments)}function D(){return(D=(0,c.Z)(function*(l,i,r){if(!i||!i.resources)return;const e=i.portalItem===l.portalItem?new Set(l.paths):new Set;l.paths.length=0,l.portalItem=i.portalItem;const t=new Set(i.resources.toKeep.map(d=>d.resource.path)),o=new Set,n=[];t.forEach(d=>{e.delete(d),l.paths.push(d)});for(const d of i.resources.toUpdate)if(e.delete(d.resource.path),t.has(d.resource.path)||o.has(d.resource.path)){const{resource:Q,content:ne,finish:oe,error:se}=d,ee=(0,M.getSiblingOfSameTypeI)(Q,(0,V.D)());l.paths.push(ee.path),n.push(S({resource:ee,content:ne,compress:d.compress,finish:oe,error:se},r))}else l.paths.push(d.resource.path),n.push(X(d,r)),o.add(d.resource.path);for(const d of i.resources.toAdd)n.push(S(d,r)),l.paths.push(d.resource.path);if(e.forEach(d=>{const Q=i.portalItem.resourceFromPath(d);n.push(Q.portalItem.removeResource(Q).catch(()=>{}))}),0===n.length)return;const v=yield(0,U.as)(n);(0,U.k_)(r);const I=v.filter(d=>"error"in d).map(d=>d.error);if(I.length>0)throw new y.Z("save:resources","Failed to save one or more resources",{errors:I})})).apply(this,arguments)}function S(l,i){return W.apply(this,arguments)}function W(){return(W=(0,c.Z)(function*(l,i){const r={...(0,R.pC)(i)?i:{},compress:l.compress},e=yield(0,T.q6)(l.resource.portalItem.addResource(l.resource,l.content,r));if(!0!==e.ok)throw l.error&&l.error(e.error),e.error;l.finish&&l.finish(l.resource)})).apply(this,arguments)}function X(l,i){return z.apply(this,arguments)}function z(){return(z=(0,c.Z)(function*(l,i){const r=yield(0,T.q6)(l.resource.update(l.content,i));if(!0!==r.ok)throw l.error(r.error),r.error;l.finish(l.resource)})).apply(this,arguments)}const k="esri.layers.mixins.SceneService",F=O.Z.getLogger(k),te=l=>{let i=class extends l{constructor(){var r;super(...arguments),r=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,U.Ds)(function(){var e=(0,c.Z)(function*(t,o,n){switch(t){case J.SAVE:return r._save(o);case J.SAVE_AS:return r._saveAs(n,o)}});return function(t,o,n){return e.apply(this,arguments)}}())}readSpatialReference(r,e){return this._readSpatialReference(e)}_readSpatialReference(r){if(null!=r.spatialReference)return B.Z.fromJSON(r.spatialReference);{const e=r.store,t=e.indexCRS||e.geographicCRS,o=t&&parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10);return null!=o?new B.Z(o):null}}readFullExtent(r,e,t){if(null!=r&&"object"==typeof r){const v=null==r.spatialReference?{...r,spatialReference:this._readSpatialReference(e)}:r;return w.Z.fromJSON(v,t)}const o=e.store,n=this._readSpatialReference(e);return null==n||null==o||null==o.extent||!Array.isArray(o.extent)||o.extent.some(v=>v<Y)?null:new w.Z({xmin:o.extent[0],ymin:o.extent[1],xmax:o.extent[2],ymax:o.extent[3],spatialReference:n})}parseVersionString(r){const e={major:Number.NaN,minor:Number.NaN,versionString:r},t=r.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(r,e){const t=e.store,o=null!=t.version?t.version.toString():"";return this.parseVersionString(o)}readTitlePortalItem(r){return"item-title"!==this.sublayerTitleMode?void 0:r}readTitleService(r,e){const t=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,j.a7)(this.url,e.name);let o=e.name;if(!o&&this.url){const n=(0,j.Qc)(this.url);(0,R.pC)(n)&&(o=n.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(o=t+" - "+o),(0,j.ld)(o)}set url(r){const e=(0,j.XG)({layer:this,url:r,nonStandardUrlAllowed:!1,logger:F});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(r,e,t,o){(0,j.wH)(this,r,"layers",e,o)}get parsedUrl(){const r=this._get("url"),e=(0,g.mN)(r);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(r,e){var t=this;return(0,c.Z)(function*(){t.indexInfo=(0,p.T)(t.parsedUrl.path,t.rootNode,r,t.apiKey,F,e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(r){if("page"===r?.type){const t=r.rootPage?.nodes?.[r.rootIndex%r.pageSize];if(null==t||null==t.obb||null==t.obb.center||null==t.obb.halfSize)throw new y.Z("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<Y||null==this.fullExtent||this.fullExtent.hasZ)return;const o=t.obb.halfSize,n=t.obb.center[2],v=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);this.fullExtent.zmin=n-v,this.fullExtent.zmax=n+v}else if("node"===r?.type){const e=r.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<Y)return;const t=e[2],o=e[3],{fullExtent:n}=this;n&&(n.zmin=t-o,n.zmax=t+o)}}_fetchService(r){var e=this;return(0,c.Z)(function*(){if(null==e.url)throw new y.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(r);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(r)})()}_fetchFirstLayerId(r){var e=this;return(0,c.Z)(function*(){const t=yield(0,_.default)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:r});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(r){var e=this;return(0,c.Z)(function*(){const t=yield(0,_.default)(e.parsedUrl?.path??"",{query:{f:"json",token:e.apiKey},responseType:"json",signal:r});t.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let o=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(o=!0),o)return e._fetchVoxelServiceLayer();const n=t.data;e.read(n,{origin:"service",url:e.parsedUrl}),e.validateLayer(n)})()}_fetchVoxelServiceLayer(r){var e=this;return(0,c.Z)(function*(){const t=(yield(0,_.default)(e.parsedUrl?.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:r})).data;e.read(t,{origin:"service",url:e.parsedUrl}),e.validateLayer(t)})()}_ensureLoadBeforeSave(){var r=this;return(0,c.Z)(function*(){yield r.load(),"beforeSave"in r&&"function"==typeof r.beforeSave&&(yield r.beforeSave())})()}validateLayer(r){}_updateTypeKeywords(r,e,t){r.typeKeywords||(r.typeKeywords=[]);const o=e.getTypeKeywords();for(const n of o)r.typeKeywords.push(n);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((n,v,I)=>I.indexOf(n)===v),t===$.newItem&&(r.typeKeywords=r.typeKeywords.filter(n=>"Hosted Service"!==n)))}_saveAs(r,e){var t=this;return(0,c.Z)(function*(){const o={...q,...e};let n=f.default.from(r);n||(F.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new y.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const v=n.portal||h.Z.getDefault();yield t._ensureLoadBeforeSave(),n.type=H,n.portal=v;const I={origin:"portal-item",url:null,messages:[],portal:v,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},d={layers:[t.write({},I)]};return yield Promise.all(I.resources?.pendingOperations??[]),yield t._validateAgainstJSONSchema(d,I,o),n.url=t.url,n.title||(n.title=t.title),t._updateTypeKeywords(n,o,$.newItem),yield v._signIn(),yield v.user?.addItem({item:n,folder:o&&o.folder,data:d}),yield K(t.resourceReferences,I,null),t.portalItem=n,(0,b.D)(I),I.portalItem=n,n})()}_save(r){var e=this;return(0,c.Z)(function*(){const t={...q,...r};if(!e.portalItem)throw F.error("_save(): requires the .portalItem property to be set"),new y.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(e.portalItem.type!==H)throw F.error("_save(): Non-matching portal item type. Got "+e.portalItem.type+", expected "+H),new y.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${H}"`);yield e._ensureLoadBeforeSave();const o={origin:"portal-item",url:e.portalItem.itemUrl&&(0,g.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||h.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[e.write({},o)]};return yield Promise.all(o.resources?.pendingOperations??[]),yield e._validateAgainstJSONSchema(n,o,t),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,t,$.existingItem),yield e.portalItem.update({data:n}),yield K(e.resourceReferences,o,null),(0,b.D)(o),e.portalItem})()}_validateAgainstJSONSchema(r,e,t){return(0,c.Z)(function*(){let o=e.messages?.filter(n=>"error"===n.type).map(n=>new y.Z(n.name,n.message,n.details))??[];if(t&&t.validationOptions?.ignoreUnsupported&&(o=o.filter(n=>"layer:unsupported"!==n.name&&"symbol:unsupported"!==n.name&&"symbol-layer:unsupported"!==n.name&&"property:unsupported"!==n.name&&"url:unsupported"!==n.name&&"scenemodification:unsupported"!==n.name)),t.validationOptions?.enabled||re){const n=(yield s.e(5496).then(s.bind(s,15496))).validate(r,t.portalItemLayerType);if(n.length>0){const v=`Layer item did not validate:\n${n.join("\n")}`;if(F.error(`_validateAgainstJSONSchema(): ${v}`),"throw"===t.validationOptions?.failPolicy){const I=n.map(d=>new y.Z("sceneservice:schema-validation",d)).concat(o);throw new y.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:I})}}}if(o.length>0)throw new y.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:o})})()}};return(0,u._)([(0,m.Cb)(a.id)],i.prototype,"id",void 0),(0,u._)([(0,m.Cb)({type:B.Z})],i.prototype,"spatialReference",void 0),(0,u._)([(0,E.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readSpatialReference",null),(0,u._)([(0,m.Cb)({type:w.Z})],i.prototype,"fullExtent",void 0),(0,u._)([(0,E.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readFullExtent",null),(0,u._)([(0,m.Cb)({readOnly:!0,type:C.Z})],i.prototype,"heightModelInfo",void 0),(0,u._)([(0,m.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],i.prototype,"minScale",void 0),(0,u._)([(0,m.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],i.prototype,"maxScale",void 0),(0,u._)([(0,m.Cb)({readOnly:!0})],i.prototype,"version",void 0),(0,u._)([(0,E.r)("version",["store.version"])],i.prototype,"readVersion",null),(0,u._)([(0,m.Cb)({type:String,json:{read:{source:"copyrightText"}}})],i.prototype,"copyright",void 0),(0,u._)([(0,m.Cb)({type:String,json:{read:!1}})],i.prototype,"sublayerTitleMode",void 0),(0,u._)([(0,m.Cb)({type:String})],i.prototype,"title",void 0),(0,u._)([(0,E.r)("portal-item","title")],i.prototype,"readTitlePortalItem",null),(0,u._)([(0,E.r)("service","title",["name"])],i.prototype,"readTitleService",null),(0,u._)([(0,m.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],i.prototype,"layerId",void 0),(0,u._)([(0,m.Cb)(a.HQ)],i.prototype,"url",null),(0,u._)([(0,A.c)("url")],i.prototype,"writeUrl",null),(0,u._)([(0,m.Cb)()],i.prototype,"parsedUrl",null),(0,u._)([(0,m.Cb)({readOnly:!0})],i.prototype,"store",void 0),(0,u._)([(0,m.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],i.prototype,"rootNode",void 0),i=(0,u._)([(0,N.j)(k)],i),i},Y=-1e38,re=!1;var $,l;(l=$||($={}))[l.existingItem=0]="existingItem",l[l.newItem=1]="newItem";const H="Scene Service",q={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var J;!function(l){l[l.SAVE=0]="SAVE",l[l.SAVE_AS=1]="SAVE_AS"}(J||(J={}))},60595:(G,P,s)=>{s.d(P,{T:()=>x});var c=s(15861),u=s(84792),_=s(26584),y=s(62208);function x(R,U,g,m,Z,L){return O.apply(this,arguments)}function O(){return(O=(0,c.Z)(function*(R,U,g,m,Z,L){let E=null;if((0,y.pC)(g)){const b=`${R}/nodepages/`,w=b+Math.floor(g.rootIndex/g.nodesPerPage);try{return{type:"page",rootPage:(yield(0,u.default)(w,{query:{f:"json",token:m},responseType:"json",signal:L})).data,rootIndex:g.rootIndex,pageSize:g.nodesPerPage,lodMetric:g.lodSelectionMetricType,urlPrefix:b}}catch(C){(0,y.pC)(Z)&&Z.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",w,C),E=C}}if(!U)return null;const N=`${R}/nodes/`,A=N+(U&&U.split("/").pop());try{return{type:"node",rootNode:(yield(0,u.default)(A,{query:{f:"json",token:m},responseType:"json",signal:L})).data,urlPrefix:N}}catch(b){throw new _.Z("sceneservice:root-node-missing","Root node missing.",{pageError:E,nodeError:b,url:A})}})).apply(this,arguments)}},10587:(G,P,s)=>{s.r(P),s.d(P,{addOrUpdateResource:()=>U,contentToBlob:()=>w,fetchResources:()=>O,getSiblingOfSameType:()=>B,getSiblingOfSameTypeI:()=>j,removeAllResources:()=>L,removeResource:()=>m,splitPrefixFileNameAndExtension:()=>A});var c=s(15861),u=s(84792),_=s(26584),y=s(62208),x=s(21726);function O(a){return R.apply(this,arguments)}function R(){return(R=(0,c.Z)(function*(a,p={},h){yield a.load(h);const f=(0,x.v_)(a.itemUrl,"resources"),{start:T=1,num:V=10,sortOrder:M="asc",sortField:K="created"}=p,D={query:{start:T,num:V,sortOrder:M,sortField:K,token:a.apiKey},signal:(0,y.U2)(h,"signal")},S=yield a.portal._request(f,D);return{total:S.total,nextStart:S.nextStart,resources:S.resources.map(({created:W,size:X,resource:z})=>({created:new Date(W),size:X,resource:a.resourceFromPath(z)}))}})).apply(this,arguments)}function U(a,p,h,f){return g.apply(this,arguments)}function g(){return(g=(0,c.Z)(function*(a,p,h,f){if(!a.hasPath())throw new _.Z(`portal-item-resource-${p}:invalid-path`,"Resource does not have a valid path");const T=a.portalItem;yield T.load(f);const V=(0,x.v_)(T.userItemUrl,"add"===p?"addResources":"updateResources"),[M,K]=N(a.path),D=yield w(h),S=new FormData;return M&&"."!==M&&S.append("resourcesPrefix",M),(0,y.pC)(f)&&f.compress&&S.append("compress","true"),S.append("fileName",K),S.append("file",D,K),S.append("f","json"),(0,y.pC)(f)&&f.access&&S.append("access",f.access),yield T.portal._request(V,{method:"post",body:S,signal:(0,y.U2)(f,"signal")}),a})).apply(this,arguments)}function m(a,p,h){return Z.apply(this,arguments)}function Z(){return(Z=(0,c.Z)(function*(a,p,h){if(!p.hasPath())throw new _.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield a.load(h);const f=(0,x.v_)(a.userItemUrl,"removeResources");yield a.portal._request(f,{method:"post",query:{resource:p.path},signal:(0,y.U2)(h,"signal")}),p.portalItem=null})).apply(this,arguments)}function L(a,p){return E.apply(this,arguments)}function E(){return(E=(0,c.Z)(function*(a,p){yield a.load(p);const h=(0,x.v_)(a.userItemUrl,"removeResources");return a.portal._request(h,{method:"post",query:{deleteAll:!0},signal:(0,y.U2)(p,"signal")})})).apply(this,arguments)}function N(a){const p=a.lastIndexOf("/");return-1===p?[".",a]:[a.slice(0,p),a.slice(p+1)]}function A(a){const[p,h]=function b(a){const p=(0,x.Ml)(a);return(0,y.Wi)(p)?[a,""]:[a.slice(0,a.length-p.length-1),`.${p}`]}(a),[f,T]=N(p);return[f,T,h]}function w(a){return C.apply(this,arguments)}function C(){return(C=(0,c.Z)(function*(a){return a instanceof Blob?a:(yield(0,u.default)(a.url,{responseType:"blob"})).data})).apply(this,arguments)}function B(a,p){if(!a.hasPath())return null;const[h,,f]=A(a.path);return a.portalItem.resourceFromPath((0,x.v_)(h,p+f))}function j(a,p){if(!a.hasPath())return null;const[h,,f]=A(a.path);return a.portalItem.resourceFromPath((0,x.v_)(h,p+f))}}}]);