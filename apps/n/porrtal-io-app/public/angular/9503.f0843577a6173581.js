"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[9503],{59503:(J,N,g)=>{g.r(N),g.d(N,{default:()=>Qn});var x=g(15861),m=g(17626),R=g(14517),O=g(46160),u=g(62208),C=g(32917),f=g(77712),X=(g(85931),g(8314),g(90912)),A=g(76898),se=g(1437),Z=g(54024),S=g(26242),T=g(91558);g(29132);var It=g(79608),At=g(23719),zt=g(66656),gt=g(2004),ve=g(49672);let q=class extends It.j{constructor(l){super(l),this.type="length",this.startPoint=null,this.endPoint=null,this.axis="horizontal",this.offset=0,this.heading=0}get extent(){if((0,u.Wi)(this.startPoint))return null;const l=gt.Z.fromPoint(this.startPoint);return(0,u.pC)(this.endPoint)&&l.union(gt.Z.fromPoint(this.endPoint)),l}};(0,m._)([(0,f.Cb)({type:["length"]})],q.prototype,"type",void 0),(0,m._)([(0,f.Cb)({type:ve.Z})],q.prototype,"startPoint",void 0),(0,m._)([(0,f.Cb)({type:ve.Z})],q.prototype,"endPoint",void 0),(0,m._)([(0,f.Cb)({type:["horizontal","vertical","direct"],nonNullable:!0})],q.prototype,"axis",void 0),(0,m._)([(0,f.Cb)({type:Number,nonNullable:!0})],q.prototype,"offset",void 0),(0,m._)([(0,f.Cb)({type:Number,nonNullable:!0}),(0,zt.p)(l=>At.BV.normalize((0,X.q9)(l),0,!0))],q.prototype,"heading",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],q.prototype,"extent",null),q=(0,m._)([(0,A.j)("esri.analysis.LengthDimension")],q);const jt=q;var we=g(80542),We=g(72392),le=g(10699),Ne=g(84786),ye=g(23841);const Wt={main:new T.Z([255,127,0])};class Nt{constructor(){this.color=Wt.main,this.opacity=.5,this.radius=5}}class Ut{constructor(){this.fontSize=14}get height(){return 1.5*(0,ye.F2)(this.fontSize)}get offset(){return this.height+20}}const be=new class Gt{constructor(){this.pointManipulators=new Nt,this.labels=new Ut}};var Ft=g(35754),M=g(84161),H=g(28093),de=g(993),Ue=g(67709),Ge=g(85072),Zt=g(8834),ee=g(13777),Fe=g(70562),Bt=g(23018),ft=g(53928),at=g(57521),ce=g(40723),vt=g(16396),yt=g(92222);class Xt extends ft._{constructor(o){super(o),this._ray=(0,Fe.Ue)(),this._externalResources=null,this._handles=new We.Z,this._isWorldDown=!1,this._start=(0,H.c)(),this._end=(0,H.f)(1,0,0),this._width=1,this._color=(0,Ue.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Ue.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=$.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ce.yD.OccludeAndTransparent,this._fadedExtensions=St,this.applyProps(o)}createExternalResources(){const o=new yt.U(this.materialParameters);this._handles.add((0,C.YP)(()=>this.view.state.camera,()=>{this._updateGeometry()}));const d=new Bt.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:o,laserline:d}}destroyExternalResources(){(0,u.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(o){(0,u.pC)(this._externalResources)&&o(this._externalResources.material)}createGeometries(o){const d=[(0,H.c)(),(0,H.c)()],c=this.extensionType===$.FADED;c&&d.push((0,H.c)(),(0,H.c)());const h=c?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,p=at.Z.createPolylineGeometry(d,null,h);o.addGeometry(p,(0,u.Wg)(this._externalResources).material),this._updateVertices(o)}updateVisibility(o){super.updateVisibility(o),(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.visible=o)}setStartEndFromWorldDownAtLocation(o){this._isWorldDown=!0,(0,M.c)(this._start,o),this.view.renderCoordsHelper.worldUpAtPosition(o,this._end),(0,M.b)(this._end,o,this._end),(0,Fe.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(o){this._isWorldDown=!1,(0,M.k)(this._start,o)||((0,M.c)(this._start,o),(0,Fe.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(o){this._isWorldDown=!1,(0,M.k)(this._end,o)||((0,M.c)(this._end,o),(0,Fe.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get color(){return this._color}set color(o){(0,de.g)(o,this._color)||((0,de.c)(this._color,o),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(o){o!==this._polygonOffset&&(this._polygonOffset=o,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(o){this._writeDepthEnabled!==o&&(this._writeDepthEnabled=o,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(o){o!==this._innerWidth&&(this._innerWidth=o,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(o){(0,de.g)(o,this._innerColor)||((0,de.c)(this._innerColor,o),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(o){const d=(0,u.pC)(o)!==(0,u.pC)(this._stipplePattern);this._stipplePattern=o,d?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(o){((0,u.Wi)(o)||(0,u.Wi)(this._stippleOffColor)||!(0,de.g)(o,this._stippleOffColor))&&(this._stippleOffColor=(0,u.pC)(o)?(0,Ue.a)(o):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(o){o!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=o,this._updateMaterial())}get falloff(){return this._falloff}set falloff(o){o!==this._falloff&&(this._falloff=o,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(o){o!==this._extensionType&&(this._extensionType=o,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,u.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(o){this._laserlineStyle=o,(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,u.pC)(o)&&(this._externalResources.laserline.style=o))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(o){this._laserlineEnabled!==o&&(this._laserlineEnabled=o,(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(o){this._fadedExtensions=(0,u.Pt)(o,St),this.recreateGeometry()}_updateMaterial(){(0,u.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,u.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(o){const d=this._extensionType===$.FADED?this._updateLineSegmentFinite(mt):this._updateLineSegmentInfinite(this._extensionType,mt);this._updateVertexAttributes(o,d),(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=d)}_updateLineSegmentFinite(o){return(0,ee.zk)(this._start,this._end,o)}_updateLineSegmentInfinite(o,d){const c=this.view.state.camera;switch((0,Ge.iL)(this._ray,oe),o){case $.LINE:oe.c0=-Number.MAX_VALUE;break;case $.RAY:case $.GROUND_RAY:{const y=this._ray.origin,v=(0,u.Pt)(this.view.elevationProvider.getElevation(y[0],y[1],y[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),_=this.view.renderCoordsHelper.getAltitude(y);this._isWorldDown&&_<v&&(0,M.o)(oe.ray.direction,oe.ray.direction),this._extensionType===$.GROUND_RAY&&null!=v&&(oe.c1=Math.abs(_-v));break}}if(!(0,Zt.zq)(c.frustum,oe))return(0,ee.zk)(this._start,this._end,d);const h=(0,Ge.Ws)(oe,he),p=(0,Ge.S$)(oe,Yt);return(0,ee.zk)(h,p,d)}_updateVertexAttributes(o,d){const c=o.geometries[0].getMutableAttribute(vt.T.POSITION).data;if(this.extensionType===$.FADED){const h=(0,ee.KU)(d,-this.fadedExtensions.start,he);c[0]=h[0],c[1]=h[1],c[2]=h[2];const p=(0,ee.KU)(d,0,he);c[3]=p[0],c[4]=p[1],c[5]=p[2];const y=(0,ee.KU)(d,1,he);c[6]=y[0],c[7]=y[1],c[8]=y[2];const v=(0,ee.KU)(d,1+this.fadedExtensions.end,he);c[9]=v[0],c[10]=v[1],c[11]=v[2]}else{const h=(0,ee.KU)(d,0,he);c[0]=h[0],c[1]=h[1],c[2]=h[2];const p=(0,ee.KU)(d,1,he);c[3]=p[0],c[4]=p[1],c[5]=p[2]}o.geometryVertexAttrsUpdated(o.geometryRecords[0])}}const oe=(0,Ge.Ue)(),he=(0,H.c)(),Yt=(0,H.c)(),mt=(0,ee.Ue)();var $,l;(l=$||($={}))[l.LINE=0]="LINE",l[l.RAY=1]="RAY",l[l.GROUND_RAY=2]="GROUND_RAY",l[l.FADED=3]="FADED";const _t=1/3,St={start:_t,end:_t};var V=g(67831);class Kt extends ft._{constructor(o){super(o),this._handles=new We.Z,this._location=(0,H.c)(),this._direction=(0,H.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Ue.f)(1,0,1,1),this._renderOccluded=ce.yD.OccludeAndTransparent,this.applyProps(o)}get location(){return this._location}set location(o){(0,M.k)(this._location,o)||((0,M.c)(this._location,o),this._updateGeometry())}get direction(){return this._direction}set direction(o){(0,M.k)(this._direction,o)||((0,M.c)(this._direction,o),this._updateGeometry())}setDirectionFromPoints(o,d){(0,M.n)(this._direction,(0,M.b)(this._direction,d,o)),this._updateGeometry()}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get offset(){return this._offset}set offset(o){o!==this._offset&&(this._offset=o,this._updateGeometry())}get length(){return this._length}set length(o){o!==this._length&&(this._length=o,this._updateGeometry())}get color(){return this._color}set color(o){(0,de.g)(o,this._color)||((0,de.c)(this._color,o),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}createExternalResources(){const o=new yt.U(this.materialParameters);this._handles.add((0,C.YP)(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:o}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(o){const d=at.Z.createPolylineGeometry([(0,H.c)(),(0,H.c)()]),c=at.Z.createPolylineGeometry([(0,H.c)(),(0,H.c)()]),h=(0,u.Wg)(this._externalResources).material;o.addGeometry(d,h),o.addGeometry(c,h),this._updateVertices(o)}forEachExternalMaterial(o){(0,u.pC)(this._externalResources)&&o(this._externalResources.material)}_updateMaterial(){(0,u.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const o=this.object;(0,u.Wi)(o)||this._updateVertices(o)}_updateVertices(o){const d=this.view.state.camera;d.projectToScreen(this.location,Ze),(0,M.a)(te,this.location,this.direction),d.projectToScreen(te,me),(0,V.i)(me,(0,V.g)(me,me,Ze)),this._updateVertexAttributes(d,o,0,Ze,me,1),this._updateVertexAttributes(d,o,1,Ze,me,-1)}_updateVertexAttributes(o,d,c,h,p,y){const v=d.geometryRecords[c],_=v.geometry.getMutableAttribute(vt.T.POSITION).data,E=(0,V.f)(Ct,(0,V.a)(Ct,p[1]*y,p[0]*-y),this.offset+this.width/2),w=(0,V.b)(Be,(0,V.b)(Be,(0,V.b)(Be,h,(0,V.f)(Be,p,this.length/2)),E),E),P=(0,V.b)(Et,w,(0,V.f)(Et,p,-this.length));o.unprojectFromScreen(w,te),_[0]=te[0],_[1]=te[1],_[2]=te[2],o.unprojectFromScreen(P,te),_[3]=te[0],_[4]=te[1],_[5]=te[2],d.geometryVertexAttrsUpdated(v)}}const te=(0,H.c)(),Ze=(0,ye.s1)(),me=(0,ye.s1)(),Ct=(0,ye.s1)(),Be=(0,ye.s1)(),Et=(0,ye.s1)();var xt=g(21232),kt=g(77603),W=g(36460),D=g(44725),lt=g(5286);class Xe extends lt.r{constructor(o,d){super(d),this.intersectionPoint=o}equals(o){return o instanceof Xe&&(0,D.Xv)(this.intersectionPoint,o.intersectionPoint)}}var re=g(62160),Pt=g(63290);Pt.Z.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class Ye extends lt.r{constructor(o,d,c){super(c),this.lineStart=o,this.lineEnd=d}equals(o){return o instanceof Ye&&(0,D.Xv)(this.lineStart,o.lineStart)&&(0,D.Xv)(this.lineEnd,o.lineEnd)}}var $t=g(19038);Pt.Z.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class Te extends lt.r{constructor(o,d,c,h){super(h),this.previousVertex=o,this.centerVertex=d,this.nextVertex=c}equals(o){return o instanceof Te&&(0,D.Xv)(this.previousVertex,o.previousVertex)&&(0,D.Xv)(this.centerVertex,o.centerVertex)&&(0,D.Xv)(this.nextVertex,o.nextVertex)}}class Qt{draw(o,d){const c=this._getUniqueHints(o),h=[];for(const p of c)p instanceof Xe&&h.push(this.visualizeIntersectionPoint(p,d)),p instanceof re.w&&h.push(this.visualizeLine(p,d)),p instanceof Ye&&h.push(this.visualizeParallelSign(p,d)),p instanceof Te&&h.push(this.visualizeRightAngleQuad(p,d)),p instanceof $t.n&&h.push(this.visualizePoint(p,d));return(0,Z.AL)(h)}_getUniqueHints(o){const d=[];for(const c of o){let h=!0;for(const p of d)if(c.equals(p)){h=!1;break}h&&d.push(c)}return d}}var I=g(25858);class Jt extends Qt{visualizeIntersectionPoint(o,d){const{coordinateHelper:c,view:h}=d;return(0,Z.ed)(new xt.L({view:h,primitive:"circle",geometry:c.vectorToPoint(o.intersectionPoint),elevationInfo:(0,u.Pt)(o.elevationInfo,d.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:T.Z.toUnitRGBA(W.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(o,d){const{coordinateHelper:c,view:h}=d;return(0,Z.ed)(new xt.L({view:h,primitive:"circle",geometry:c.vectorToPoint(o.point),elevationInfo:(0,u.Pt)(o.elevationInfo,d.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:T.Z.toUnitRGBA(W.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(o,d){const{coordinateHelper:c,view:h}=d;return(0,Z.ed)(this._createLineSegmentHintFromMap(o.type,o.lineStart,o.lineEnd,c,(0,u.Pt)(o.elevationInfo,d.elevationInfo),h,o.fadeLeft,o.fadeRight))}visualizeParallelSign(o,d){const{coordinateHelper:c,view:h}=d,p=(0,u.Pt)(o.elevationInfo,d.elevationInfo),y=(0,I.$r)(o.lineStart,c,p,d.view),v=(0,I.$r)(o.lineEnd,c,p,d.view),_=(0,M.h)(v,y,v,.5),E=new Kt({view:h,attached:!1,offset:W.c.parallelLineHintOffset,length:W.c.parallelLineHintLength,width:W.c.parallelLineHintWidth,color:T.Z.toUnitRGBA(W.c.orange),location:_,renderOccluded:ce.yD.Opaque});return E.setDirectionFromPoints(y,_),E.attached=!0,(0,Z.ed)(E)}visualizeRightAngleQuad(o,d){const{coordinateHelper:c,view:h}=d,p=(0,u.Pt)(o.elevationInfo,d.elevationInfo);return(0,Z.ed)(new kt.R({view:h,attached:!0,color:T.Z.toUnitRGBA(W.c.orange),renderOccluded:ce.yD.Transparent,outlineRenderOccluded:ce.yD.Opaque,outlineColor:T.Z.toUnitRGBA(W.c.orange),outlineSize:W.c.rightAngleHintOutlineSize,size:W.c.rightAngleHintSize,geometry:{previous:(0,I.$r)(o.previousVertex,c,p,h),center:(0,I.$r)(o.centerVertex,c,p,h),next:(0,I.$r)(o.nextVertex,c,p,h)}}))}_createLineSegmentHintFromMap(o,d,c,h,p,y,v=!0,_=!0){const E=(0,H.c)(),w=(0,H.c)();return(0,I.By)(d,c,h,p,y,E,w),this._createLineSegmentHint(o,y,E,w,v,_)}_createLineSegmentHint(o,d,c,h,p=!0,y=!0){const v=new Xt({view:d,extensionType:$.FADED,start:c,end:h,color:T.Z.toUnitRGBA(W.c.orange),renderOccluded:ce.yD.Opaque});switch(o){case D.ze.TARGET:v.width=W.c.lineHintWidthTarget,v.fadedExtensions={start:0,end:W.c.lineHintFadedExtensions};break;case D.ze.REFERENCE_EXTENSION:v.width=W.c.lineHintWidthReference,v.fadedExtensions={start:0,end:0};break;case D.ze.REFERENCE:v.width=W.c.lineHintWidthReference,v.fadedExtensions={start:p?W.c.lineHintFadedExtensions:0,end:y?W.c.lineHintFadedExtensions:0}}return v.attached=!0,v}}var wt=g(8859),qt=g(50017),Ke=g(30260),en=g(466),tn=g(97737),nn=g(79682),ke=g(83308);let pe=class extends R.Z{constructor(l){super(l),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,m._)([(0,f.Cb)({constructOnly:!0})],pe.prototype,"layer",void 0),(0,m._)([(0,f.Cb)()],pe.prototype,"enabled",void 0),(0,m._)([(0,f.Cb)()],pe.prototype,"updating",void 0),(0,m._)([(0,f.Cb)()],pe.prototype,"availability",void 0),pe=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SnappingLayerSource")],pe);const bt=pe;var sn=g(14171),rn=g(42930),on=g(97126),Tt=g(60507),Ot=g(75897),an=g(70211);let ue=class extends we.r{constructor(l){super(l),this.availability=0,this._ids=new Set,this.tmpP=(0,H.c)()}destroy(){this.workerHandle.destroy(),this.workerHandle=null}initialize(){this.workerHandle=new ln(this.schedule,{fetchAllEdgeLocations:(l,o)=>this._fetchAllEdgeLocations(l,o)})}fetchCandidates(l,o){var d=this;return(0,x.Z)(function*(){const c=l.coordinateHelper.toXYZ(l.point);d.view.renderCoordsHelper.toRenderCoords(c,l.coordinateHelper.spatialReference,c);const h="number"==typeof l.distance?l.distance:l.distance.pixelSize,p=yield d.workerHandle.invoke({bounds:(0,on.f)(c[0],c[1],c[2],h),types:l.types},o),y=l.coordinateHelper;return p.candidates.sort((v,_)=>v.distance-_.distance),p.candidates.map(v=>d._convertCandidate(y,v))})()}add(l,o){var d=this;return(0,x.Z)(function*(){d._ids.add(l.id),yield d.workerHandle.invokeMethod("add",l,o)})()}remove(l,o){var d=this;return(0,x.Z)(function*(){d._ids.delete(l.id),yield d.workerHandle.invokeMethod("remove",l,o)})()}_convertCandidate(l,o){switch(o.type){case"edge":return new Ot.L({coordinateHelper:l,objectId:o.objectId,targetPoint:this._convertRenderCoordinate(l,o.target),edgeStart:this._convertRenderCoordinate(l,o.start),edgeEnd:this._convertRenderCoordinate(l,o.end),elevationInfo:Tt.jG});case"vertex":return new an.x({coordinateHelper:l,objectId:o.objectId,targetPoint:this._convertRenderCoordinate(l,o.target),elevationInfo:Tt.jG})}}_convertRenderCoordinate(l,o){return this.view.renderCoordsHelper.fromRenderCoords(o,this.tmpP,l.spatialReference),l.fromXYZ(this.tmpP)}_fetchAllEdgeLocations(l,o){var d=this;return(0,x.Z)(function*(){const c=[],h=[];for(const{id:p,uid:y}of l.components)d._ids.has(p)&&c.push((0,x.Z)(function*(){const v=yield d.fetchEdgeLocations(p,o.signal);return h.push(v.locations.buffer),{id:p,uid:y,objectIds:v.objectIds,locations:v.locations.buffer,origin:v.origin,type:v.type}})());return{result:{components:(yield Promise.all(c)).filter(({id:p})=>d._ids.has(p))},transferList:h}})()}};(0,m._)([(0,f.Cb)({constructOnly:!0})],ue.prototype,"view",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],ue.prototype,"fetchEdgeLocations",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],ue.prototype,"schedule",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],ue.prototype,"availability",void 0),ue=(0,m._)([(0,A.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],ue);class ln extends rn.q{constructor(o,d){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},o,{strategy:"dedicated",client:d})}}let ge=class extends we.r{constructor(l){super(l),this.availability=1,this.abortController=new AbortController}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){this.abortController=(0,u.IM)(this.abortController)}initialize(){var l=this;const o=this.view.resourceController;var d;this.edgeWorker=new sn.Z(d=>o.schedule(d)),this.workerHandle=new ue({view:this.view,schedule:d=>o.schedule(d),fetchEdgeLocations:(d=(0,x.Z)(function*(c,h){if((0,u.Wi)(l.tracker))throw new Error("tracker-not-initialized");return l.tracker.fetchEdgeLocations(c,l.edgeWorker,h)}),function(h,p){return d.apply(this,arguments)})}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([(0,Z.ed)(this.workerHandle),(0,Z.ed)(this.edgeWorker)])}fetchCandidates(l,o){var d=this;return(0,x.Z)(function*(){return d.workerHandle.fetchCandidates(l,o)})()}refresh(){}_setupLayerView(){var l=this;return(0,x.Z)(function*(){const o=yield l.view.whenLayerView(l.layer);if("scene-layer-graphics-3d"===o.type)return;const d={add:(c,h)=>l.updatingHandles.addPromise(l.workerHandle.add({id:c,bounds:h},l.abortController.signal)),remove:c=>l.updatingHandles.addPromise(l.workerHandle.remove({id:c},l.abortController.signal))};l.tracker=o.trackSnappingSources(d),l.handles.add(l.tracker)})()}};(0,m._)([(0,f.Cb)({constructOnly:!0})],ge.prototype,"layerSource",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],ge.prototype,"view",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],ge.prototype,"updating",null),(0,m._)([(0,f.Cb)({readOnly:!0})],ge.prototype,"availability",void 0),ge=(0,m._)([(0,A.j)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],ge);let fe=class extends R.Z{constructor(l){super(l),this.options=null,this._snappingSources=new O.Z}initialize(){this.own([this.view.on("layerview-create",({layerView:l})=>this._createSource(l)),this.view.on("layerview-destroy",({layerView:l})=>this._removeSource(l))]);for(const l of this.view.allLayerViews.items)this._createSource(l)}destroy(){this.options=null,this._snappingSources.drain(l=>l.destroy())}get updating(){return this._snappingSources.some(l=>l.updating)}get _types(){return ke.r.EDGE|ke.r.VERTEX}fetchCandidates(l,o,d){var c=this;return(0,x.Z)(function*(){const{view:h,options:p}=c,{coordinateHelper:y,elevationInfo:v}=o,_=(0,u.pC)(p)?p.distance:1,E=(0,I.$r)(l,y,v,h,S.WM.get()),w=_*h.state.camera.computeScreenPixelSizeAt(E),P=c._types,L=c._snappingSources.items.map(G=>G.fetchCandidates({point:l,coordinateHelper:y,distance:w,types:P},d)),b=(yield Promise.all(L)).flat();return(0,D.lQ)(l,b),b})()}_createSource(l){if("scene-layer-3d"!==l.type)return;const o=new ge({layerSource:new bt({layer:l.layer}),view:this.view});this._snappingSources.push(o)}_removeSource(l){const o=this._snappingSources.findIndex(d=>d.layerSource.layer===l.layer);-1!==o&&this._snappingSources.removeAt(o).destroy()}};(0,m._)([(0,f.Cb)({constructOnly:!0})],fe.prototype,"view",void 0),(0,m._)([(0,f.Cb)()],fe.prototype,"updating",null),(0,m._)([(0,f.Cb)()],fe.prototype,"options",void 0),(0,m._)([(0,f.Cb)()],fe.prototype,"_snappingSources",void 0),fe=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SceneSnappingEngine")],fe);var Se,dn=g(61885),cn=g(88159),_e=g(33351),hn=g(97979),Oe=g(22823);class Mt extends Oe.j{constructor({coordinateHelper:o,targetPoint:d,constraint:c,previousVertex:h,otherVertex:p,otherVertexType:y,objectId:v,elevationInfo:_}){super(o,d,c,_),this.previousVertex=h,this.otherVertex=p,this.otherVertexType=y,this.objectId=v}get hints(){const o=this.previousVertex,d=this.otherVertexType===Se.CENTER?this.otherVertex:this.targetPoint,c=this.otherVertexType===Se.CENTER?this.targetPoint:this.otherVertex,h=this.elevationInfo;return[new re.w(D.ze.TARGET,d,c,h),new re.w(D.ze.REFERENCE,o,d,h),new Te(this.previousVertex,d,c,h)]}}!function(l){l[l.NEXT=0]="NEXT",l[l.CENTER=1]="CENTER"}(Se||(Se={}));let ae=class extends we.r{constructor(l){super(l),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return(0,cn.oE)(this.snappingSources,({snappingSource:l})=>l.updating)||this.updatingHandles.updating}get snappingSources(){const l=this._get("snappingSources")||new Map,o=new Map;if((0,u.pC)(this.options)&&(0,u.pC)(this.options.featureSources))for(const d of this.options.featureSources.items){const c=d.layer.uid,h=l.get(c);if(h){l.delete(c),o.set(c,h);continue}if(!d.layer.loaded){this.updatingHandles.addPromise(d.layer.load());continue}const p=this._createSourceInfo(d);(0,u.pC)(p)&&o.set(c,p)}for(const[,d]of l)d.destroy();return o}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),C.Z_),(0,u.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",l=>this._updateLayerView(l.layer,l.layerView)),this.view.on("layerview-destroy",l=>this._updateLayerView(l.layer,null))])}_updateLayerView(l,o){for(const[,d]of this.snappingSources)d.snappingSource.layerSource.layer===l&&(d.layerView=o)}destroy(){this._set("options",null);for(const[,l]of this.snappingSources)l.destroy()}fetchCandidates(l,o,d){var c=this;return(0,x.Z)(function*(){if((0,u.Wi)(c.options)||!c.options.effectiveFeatureEnabled)return[];const h=[],p=c._computeScreeenSizeDistanceParameters(l,o),y={distance:p,point:l,coordinateHelper:o.coordinateHelper,types:c.types,filter:null};for(const[,{snappingSource:_,layerView:E}]of c.snappingSources)!_.layerSource.enabled||(0,u.pC)(E)&&E.suspended||h.push(_.fetchCandidates(y,d).then(w=>w.filter(P=>!c._candidateIsExcluded(_,P,o.excludeFeature))));const v=(yield(0,le.WW)(h)).flat();return c._addRightAngleCandidates(v,l,p,o),(0,le.k_)(d),(0,D.lQ)(l,v),v})()}_addRightAngleCandidates(l,o,d,c){const h=(0,u.pC)(c.vertexHandle)?c.vertexHandle.rightEdge?.rightVertex?.pos:(0,u.pC)(c.editGeometryOperations)&&"polygon"===c.editGeometryOperations.data.type?(0,u.Wg)(c.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,p=(0,u.pC)(c.vertexHandle)?c.vertexHandle.leftEdge?.leftVertex?.pos:(0,u.pC)(c.editGeometryOperations)?(0,u.Wg)(c.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,y=l.length;for(let v=0;v<y;v++)this._addRightAngleCandidate(l[v],p,o,d,c,l),this._addRightAngleCandidate(l[v],h,o,d,c,l)}_addRightAngleCandidate(l,o,d,c,h,p){if((0,u.Wi)(o)||!(l instanceof Ot.L))return;const y=l.constraint.closestTo(o),v=(y[0]-d[0])/c.x,_=(y[1]-d[1])/c.y;if(v*v+_*_<=1){const E=h.coordinateHelper;p.push(new Mt({coordinateHelper:E,targetPoint:y,otherVertex:o,otherVertexType:Se.NEXT,previousVertex:l.constraint.start,constraint:new _e.yG(E,o,y),objectId:l.objectId,elevationInfo:l.elevationInfo}))}}_computeScreeenSizeDistanceParameters(l,o){const d=(0,u.pC)(this.options)?this.options.distance*("touch"===o.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,u.Wi)(this.view))return{x:d,y:d,pixelSize:d};if("2d"===this.view.type){const c=d*this.view.resolution;return{x:c,y:c,pixelSize:c}}return this._computeScreenSizeDistanceParameters3D(l,d,this.view,o)}_computeScreenSizeDistanceParameters3D(l,o,d,c){const{coordinateHelper:h,elevationInfo:p}=c,y=d.state.camera.computeScreenPixelSizeAt((0,I.$r)(l,h,p,d,un)),v=y*d.renderCoordsHelper.unitInMeters/d.mapCoordsHelper.unitInMeters,_=o*v;return{x:_/this._computeScreenMagnitudeOfMapOffset(l,v,0,d,c),y:_/this._computeScreenMagnitudeOfMapOffset(l,0,v,d,c),pixelSize:y}}_computeScreenMagnitudeOfMapOffset(l,o,d,c,{coordinateHelper:h,elevationInfo:p}){const y=h.clone(l);y[0]+=o,y[1]+=d;const v=(0,I.a7)(l,h,p,c),_=(0,I.a7)(y,h,p,c),E=_.x-v.x,w=_.y-v.y;return Math.sqrt(E*E+w*w)}get types(){return ke.r.EDGE|ke.r.VERTEX}_candidateIsExcluded(l,o,d){if((0,u.Wi)(d))return!1;const c=this._getCandidateObjectId(o);if((0,u.Wi)(c))return!1;const h=l.layerSource.layer;return"graphics"===h.type?d.uid===c:d.sourceLayer===h&&!(!d.attributes||!("objectIdField"in h))&&d.attributes[h.objectIdField]===c}_getCandidateObjectId(l){return l instanceof hn.a?l.objectId:null}_createSourceInfo(l){const o=this._createFeatureSnappingSourceType(l);if((0,u.Wi)(o))return null;if("loading"in o)return this.updatingHandles.addPromise(o.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const d=(0,u.pC)(this.view)?this.view.allLayerViews.find(c=>c.layer===l.layer):null;return new pn(o.source,d)}_createFeatureSnappingSourceType(l){switch(l.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(l);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(l)}return null}_createFeatureSnappingSourceFeatureLayer(l){switch(l.layer.source.type){case"feature-layer":{const o=this._getSourceModule("featureService");return(0,u.pC)(o.module)?{source:new o.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===l.layer.geometryType)return null;const o=this._getSourceModule("featureCollection");return(0,u.pC)(o.module)?{source:new o.module.FeatureCollectionSnappingSource({layerSource:l})}:{loading:o.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(l){const o=this._getSourceModule("graphics");return(0,u.pC)(o.module)?{source:new o.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}_getSourceModule(l){const o=this.sourceModules[l];if((0,u.Wi)(o.loader)){const d=this._loadSourceModule(l).then(c=>{o.module=c});return o.loader=d,{module:o.module,loader:d}}return{module:o.module,loader:o.loader}}_loadSourceModule(l){switch(l){case"featureService":return this.updatingHandles.addPromise(Promise.all([g.e(8592),g.e(8740)]).then(g.bind(g,78740)));case"featureCollection":return this.updatingHandles.addPromise(Promise.all([g.e(8592),g.e(8176)]).then(g.bind(g,78176)));case"graphics":return this.updatingHandles.addPromise(Promise.all([g.e(3464),g.e(8592),g.e(6269)]).then(g.bind(g,66269)))}return null}};(0,m._)([(0,f.Cb)({constructOnly:!0})],ae.prototype,"spatialReference",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],ae.prototype,"view",void 0),(0,m._)([(0,f.Cb)()],ae.prototype,"options",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],ae.prototype,"updating",null),(0,m._)([(0,f.Cb)({readOnly:!0})],ae.prototype,"snappingSources",null),ae=(0,m._)([(0,A.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],ae);class pn{constructor(o,d){this.snappingSource=o,this.layerView=d,this.handles=new We.Z;const c=this.snappingSource.layerSource.layer;"refresh"in c&&this.handles.add(c.on("refresh",()=>o.refresh())),this.handles.add([(0,C.YP)(()=>o.updating,h=>o.layerSource.updating=h,C.tX),(0,C.YP)(()=>o.availability,h=>o.layerSource.availability=h,C.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const un=(0,H.c)();var ne=g(99770);class $e{constructor(o,d){this.view=o,this.options=d,this.squaredShortLineThreshold=W.c.shortLineThreshold*W.c.shortLineThreshold}snap(o,d){return(0,u.pC)(d.vertexHandle)?"vertex"!==d.vertexHandle.type?[]:this.snapExistingVertex(o,d):this.snapNewVertex(o,d)}edgeExceedsShortLineThreshold(o,d){return this.exceedsShortLineThreshold(o.leftVertex.pos,o.rightVertex.pos,d)}exceedsShortLineThreshold(o,d,{elevationInfo:c,editGeometryOperations:h}){const p=h.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,D.tp)((0,I.a7)(d,p,c,this.view),(0,I.a7)(o,p,c,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(o){return"touch"===o?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:o,touchSensitivityMultiplier:d}=this.options,c=o*d;return c*c}}class gn extends Oe.j{constructor({coordinateHelper:o,lineStart:d,lineEnd:c,targetPoint:h,elevationInfo:p}){super(o,h,new _e.ku(o,d,c),p),this.referenceLineHint=new re.w(D.ze.REFERENCE_EXTENSION,d,c,p)}get hints(){return[this.referenceLineHint,new re.w(D.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const o=this.constraint.start,d=this.constraint.end;return Math.sign((0,V.h)((0,V.g)(vn,d,o),(0,V.g)(fn,this.targetPoint,o)))>0?d:o}}const fn=(0,ne.a)(),vn=(0,ne.a)();var Me=g(396);class yn extends $e{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.edges.length,p=[];if(h<1)return p;const v=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),_=c.edges[h-1];let E=_;do{this.edgeExceedsShortLineThreshold(E,d)&&this._processCandidateProposal(E.leftVertex.pos,E.rightVertex.pos,o,v,d,p),E=E.leftVertex.leftEdge}while(E&&E!==_);return p}snapExistingVertex(o,d){const c=[],h=(0,u.Wg)(d.vertexHandle),p=h.component;if(p.edges.length<2)return c;const v=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),_=h.leftEdge,E=h.rightEdge;_&&E&&this.edgeExceedsShortLineThreshold(_,d)&&this.edgeExceedsShortLineThreshold(E,d)&&this._processCandidateProposal(_.leftVertex.pos,E.rightVertex.pos,o,v,d,c);const w=p.edges[0];let P=w;do{P!==h.leftEdge&&P!==h.rightEdge&&this.edgeExceedsShortLineThreshold(P,d)&&this._processCandidateProposal(P.leftVertex.pos,P.rightVertex.pos,o,v,d,c),P=P.rightVertex.rightEdge}while(P&&P!==w);return c}_processCandidateProposal(o,d,c,h,p,y){const v=(0,Me.k0)((0,ne.a)(),c,o,d),{coordinateHelper:_,elevationInfo:E,pointer:w}=p,P=_.fromXYZ(v,_.getZ(c,0));(0,D.tp)(h,(0,I.a7)(P,_,E,this.view))<this.squaredProximityTreshold(w)&&y.push(new gn({coordinateHelper:_,lineStart:o,lineEnd:d,targetPoint:P,elevationInfo:E}))}}class mn extends Oe.j{constructor({coordinateHelper:o,referenceLine:d,lineStart:c,targetPoint:h,elevationInfo:p}){const y=o.clone(c);(0,V.g)(y,(0,V.b)(y,y,d.rightVertex.pos),d.leftVertex.pos),super(o,h,new _e.ku(o,c,y),p),this._referenceLines=[{edge:d,fadeLeft:!0,fadeRight:!0}]}get hints(){const o=this.elevationInfo;return[new re.w(D.ze.TARGET,this.constraint.start,this.targetPoint,o),new Ye(this.constraint.start,this.targetPoint,o),...this._referenceLines.map(d=>new re.w(D.ze.REFERENCE,d.edge.leftVertex.pos,d.edge.rightVertex.pos,o,d.fadeLeft,d.fadeRight))]}addReferenceLine(o){const d={edge:o,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(c=>{o.rightVertex.rightEdge===c.edge&&(c.fadeLeft=!1,d.fadeRight=!1),o.leftVertex.leftEdge===c.edge&&(c.fadeRight=!1,d.fadeLeft=!1)}),this._referenceLines.push(d)}}class _n extends $e{constructor(){super(...arguments),this._tmpProjection=(0,ne.a)()}snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.edges.length,p=c.vertices.length,y=[];if(h<2)return y;const v=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),_=c.vertices[p-1],E=c.vertices[0],w=c.edges[h-1];let P=w;do{this.edgeExceedsShortLineThreshold(P,d)&&(this._checkEdgeForParalleLines(P,_.pos,o,v,d,y),this._checkEdgeForParalleLines(P,E.pos,o,v,d,y)),P=P.leftVertex.leftEdge}while(P&&P!==w);return y}snapExistingVertex(o,d){const c=[],h=(0,u.Wg)(d.vertexHandle),p=h.component;if(p.edges.length<3)return c;const y=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),v=h.leftEdge,_=h.rightEdge,E=p.vertices[0],P=p.vertices[p.vertices.length-1],L=p.edges[0];let b=L;do{b!==v&&b!==_&&this.edgeExceedsShortLineThreshold(b,d)&&(v&&this._checkEdgeForParalleLines(b,v.leftVertex.pos,o,y,d,c),_&&this._checkEdgeForParalleLines(b,_.rightVertex.pos,o,y,d,c),h===E?this._checkEdgeForParalleLines(b,P.pos,o,y,d,c):h===P&&this._checkEdgeForParalleLines(b,E.pos,o,y,d,c)),b=b.rightVertex.rightEdge}while(b&&b!==L);return c}_checkEdgeForParalleLines(o,d,c,h,p,y){const v=o.leftVertex.pos,_=o.rightVertex.pos;if((0,Me.k0)(this._tmpProjection,d,v,_),(0,V.s)(this._tmpProjection,d)<W.c.parallelLineThreshold)return;(0,Me.k0)(this._tmpProjection,c,v,_,d);const{coordinateHelper:E,elevationInfo:w,pointer:P}=p,L=E.fromXYZ(this._tmpProjection,E.getZ(c,0));if((0,D.tp)(h,(0,I.a7)(L,E,w,this.view))<this.squaredProximityTreshold(P)){if(this._parallelToPreviousCandidate(o,y))return;y.push(new mn({coordinateHelper:E,referenceLine:o,lineStart:d,targetPoint:L,elevationInfo:w}))}}_parallelToPreviousCandidate(o,d){const c=o.leftVertex.pos,h=o.rightVertex.pos;for(const p of d)if((0,Me.k0)(this._tmpProjection,h,p.constraint.start,p.constraint.end,c),(0,V.s)(this._tmpProjection,h)<W.c.parallelLineThreshold)return p.addReferenceLine(o),!0;return!1}}class Sn extends $e{constructor(){super(...arguments),this._tmp=(0,ne.a)()}snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.vertices.length,p=[];if(h<2)return p;const y=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),v=c.vertices[h-1];this._checkForSnappingCandidate(p,v.leftEdge,v.pos,o,v.leftEdge.leftVertex.pos,v.pos,d,o,y);const _=c.vertices[0];return this._checkForSnappingCandidate(p,_.rightEdge,_.pos,o,_.rightEdge.rightVertex.pos,_.pos,d,o,y),p}snapExistingVertex(o,d){const c=[],h=(0,u.Wg)(d.vertexHandle),p=h.component,y=p.vertices.length;if(y<3)return c;const v=(0,I.a7)(o,d.coordinateHelper,d.elevationInfo,this.view),_=h.leftEdge,E=h.rightEdge,w=p.vertices[0],P=p.vertices[y-1];if(!_)return this._checkForSnappingCandidate(c,w.rightEdge.rightVertex.rightEdge,w.rightEdge.rightVertex.pos,o,w.rightEdge.rightVertex.rightEdge.rightVertex.pos,w.rightEdge.rightVertex.pos,d,o,v),c;if(!E)return this._checkForSnappingCandidate(c,P.leftEdge.leftVertex.leftEdge,P.leftEdge.leftVertex.pos,o,P.leftEdge.leftVertex.leftEdge.leftVertex.pos,P.leftEdge.leftVertex.pos,d,o,v),c;if(_&&_.leftVertex.leftEdge){const L=_.leftVertex.leftEdge;this._checkForSnappingCandidate(c,L,_.leftVertex.pos,o,L.leftVertex.pos,_.leftVertex.pos,d,o,v)}if(E&&E.rightVertex.rightEdge){const L=E.rightVertex.rightEdge;this._checkForSnappingCandidate(c,L,E.rightVertex.pos,o,L.rightVertex.pos,E.rightVertex.pos,d,o,v)}return c}_checkForSnappingCandidate(o,d,c,h,p,y,v,_,E){if(!this.edgeExceedsShortLineThreshold(d,v))return;(0,V.g)(this._tmp,d.rightVertex.pos,d.leftVertex.pos);const w=(0,ne.f)(this._tmp[1],-this._tmp[0]),P=(0,V.h)(w,(0,V.g)(this._tmp,h,c))/(0,V.u)(w),{coordinateHelper:L,elevationInfo:b,pointer:G}=v,k=L.fromXYZ((0,V.v)((0,ne.a)(),y,w,P),L.getZ(_,0));(0,D.tp)(E,(0,I.a7)(k,L,b,this.view))<this.squaredProximityTreshold(G)&&o.push(new Mt({coordinateHelper:L,targetPoint:k,constraint:new _e.yG(L,y,(0,V.v)(L.createVector(),y,w,Math.sign(P))),previousVertex:p,otherVertex:y,otherVertexType:Se.CENTER,elevationInfo:b}))}}class Cn extends Oe.j{constructor({coordinateHelper:o,targetPoint:d,point1:c,point2:h,elevationInfo:p}){super(o,d,new _e.UL(o,(0,V.l)(En,c,h,.5),.5*(0,V.j)(c,h)),p),this.p1=c,this.p2=h}get hints(){const o=this.elevationInfo;return[new re.w(D.ze.REFERENCE,this.targetPoint,this.p1,o),new re.w(D.ze.REFERENCE,this.targetPoint,this.p2,o),new Te(this.p1,this.targetPoint,this.p2,o)]}}const En=(0,ne.a)();class xn extends $e{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=[],p=c.vertices.length;return"polygon"!==d.editGeometryOperations.data.type||p<2||this._processCandidateProposal(c.vertices[0].pos,c.vertices[p-1].pos,o,d,h),h}snapExistingVertex(o,d){const c=[],h=(0,u.Wg)(d.vertexHandle),p=h.component;return p.edges.length<2||("polyline"!==d.editGeometryOperations.data.type||0!==h.index&&h.index!==p.vertices.length-1)&&this._processCandidateProposal(h.leftEdge.leftVertex.pos,h.rightEdge.rightVertex.pos,o,d,c),c}_processCandidateProposal(o,d,c,h,p){if(!this.exceedsShortLineThreshold(o,d,h))return;const y=(0,V.l)((0,ne.a)(),o,d,.5),v=.5*(0,V.j)(o,d),_=(0,Me.xO)((0,ne.a)(),c,y,v),{coordinateHelper:E,elevationInfo:w,pointer:P}=h,L=E.fromXYZ(_,E.getZ(c,0)),b=(0,I.a7)(c,E,w,this.view);(0,D.tp)(b,(0,I.a7)(L,E,w,this.view))<this.squaredProximityTreshold(P)&&p.push(new Cn({coordinateHelper:E,targetPoint:L,point1:o,point2:d,elevationInfo:w}))}}let Ce=class extends R.Z{constructor(l){super(l),this.updating=!1,this._snappers=new O.Z}initialize(){this._snappers.push(new _n(this.view,this.options),new yn(this.view,this.options),new Sn(this.view,this.options),new xn(this.view,this.options))}set options(l){this._set("options",l);for(const o of this._snappers)o.options=l}fetchCandidates(l,o){var d=this;return(0,x.Z)(function*(){if(!d.options.effectiveSelfEnabled)return[];const c=[];for(const h of d._snappers.items)c.push(...h.snap(l,o));return(0,D.lQ)(l,c),c})()}};function Pn(l,o){return[new Ce({view:l,options:o}),new ae({view:l,options:o,spatialReference:l.spatialReference})]}(0,m._)([(0,f.Cb)({readOnly:!0})],Ce.prototype,"updating",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],Ce.prototype,"view",void 0),(0,m._)([(0,f.Cb)()],Ce.prototype,"options",null),Ce=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SelfSnappingEngine")],Ce);let Y=class extends R.Z{constructor(l){super(l),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new O.Z,this.distance=W.c.distance,this.touchSensitivityMultiplier=W.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,m._)([(0,f.Cb)()],Y.prototype,"enabled",void 0),(0,m._)([(0,f.Cb)()],Y.prototype,"enabledToggled",void 0),(0,m._)([(0,f.Cb)()],Y.prototype,"selfEnabled",void 0),(0,m._)([(0,f.Cb)()],Y.prototype,"featureEnabled",void 0),(0,m._)([(0,f.Cb)({type:O.Z.ofType(bt)})],Y.prototype,"featureSources",void 0),(0,m._)([(0,f.Cb)()],Y.prototype,"distance",void 0),(0,m._)([(0,f.Cb)()],Y.prototype,"touchSensitivityMultiplier",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],Y.prototype,"effectiveEnabled",null),(0,m._)([(0,f.Cb)({readOnly:!0})],Y.prototype,"effectiveSelfEnabled",null),(0,m._)([(0,f.Cb)({readOnly:!0})],Y.prototype,"effectiveFeatureEnabled",null),Y=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SnappingOptions")],Y);const wn=Y;class Qe extends Oe.j{constructor(o,d,c,h,p){super(o,d,new _e.Bq(o,d,c.constraint,h.constraint),p),this.first=c,this.second=h}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Xe(this.targetPoint,this.elevationInfo)]}}let ie=class extends(dn.Z.EventedMixin(we.r)){constructor(l){super(l),this.options=new wn,this.snappingEnginesFactory=Pn,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([(0,C.YP)(()=>{const{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:d,distance:c}=this.options;return{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:d,distance:c}},()=>{this.doneSnapping(),this.emit("changed")},C.Z_),(0,C.YP)(()=>this.options,l=>{for(const o of this._engines)o.options=l},C.Z_),(0,C.YP)(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:l,snappingEnginesFactory:o})=>this._recreateEngines(l,o),C.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(l=>l.updating)}_recreateEngines(l,o){if(this._destroyEngines(),!l)return;const{view:d,options:c}=this;this._engines=o(d,c)}_destroyEngines(){for(const l of this._engines)l.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:l,touchSensitivityMultiplier:o}=this.options,d=l*o;return d*d}snap(l,o,d){var c=this;return(0,x.Z)(function*(){const h=o.coordinateHelper.pointToVector(l),p=yield c._fetchCandidates(h,o,d);return{get valid(){return!(0,le.Hc)(d)},apply:()=>{const{snappedPoint:y,hints:v}=c._processCandidates(h,p,o);return c._removeVisualization(),(0,u.pC)(o.visualizer)&&c.handles.add(o.visualizer.draw(v,{coordinateHelper:o.coordinateHelper,elevationInfo:o.elevationInfo,view:c.view}),Je),y}}})()}update(l,o){this._removeVisualization();let d=l;const c=[];if((0,u.pC)(this._currentMainCandidate)){const h=o.coordinateHelper,p=h.pointToVector(l),y=this._currentMainCandidate.constraint.closestTo(p);if((0,D.tp)((0,I.a7)(p,h,o.elevationInfo,this.view),(0,I.a7)(y,h,o.elevationInfo,this.view))<this._squaredPointProximityThreshold(o.pointer)){d=h.vectorToDehydratedPoint(y),this._currentMainCandidate.targetPoint=y,c.push(...this._currentMainCandidate.hints);for(const v of this._currentOtherActiveCandidates)v.targetPoint=y,c.push(...v.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,u.pC)(o.visualizer)&&this.handles.add(o.visualizer.draw(c,{coordinateHelper:o.coordinateHelper,elevationInfo:o.elevationInfo,view:this.view}),Je),d}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(Je)}_fetchCandidates(l,o,d){var c=this;return(0,x.Z)(function*(){return(yield Promise.all(c._engines.map(h=>h.fetchCandidates(l,o,d)))).flat()})()}_processCandidates(l,o,d){if(o.length<1)return this.doneSnapping(),{snappedPoint:d.coordinateHelper.vectorToDehydratedPoint(l),hints:[]};(0,D.lQ)(l,o);const c=this._currentMainCandidate;if((0,u.pC)(c)){const h=this._findOldConstraintInNewCandidates(c,o);if(h>=0){if(!(o[h]instanceof Qe))return this._intersectWithOtherCandidates(h,o,l,d);if((0,V.s)(l,c.targetPoint)<this._squaredPointProximityThreshold(d.pointer))return this._updateSnappingCandidate(c,o,d)}}return this._intersectWithOtherCandidates(0,o,l,d)}_findOldConstraintInNewCandidates(l,o){return l instanceof Qe?this._findOldCandidateIndex(o,l.first)>=0&&this._findOldCandidateIndex(o,l.second)>=0?0:-1:this._findOldCandidateIndex(o,l)}_intersectWithOtherCandidates(l,o,d,c){const h=o[l],p=[],y=c.coordinateHelper;for(let v=0;v<o.length;++v){if(v===l)continue;const _=o[v];for(const E of h.constraint.intersect(_.constraint)){const w=y.fromXYZ(E.intersection,h.targetPoint[2]);p.push([new Qe(y,w,h,_,_.elevationInfo),(0,D.tp)((0,I.a7)(d,c.coordinateHelper,c.elevationInfo,this.view),(0,I.a7)(w,c.coordinateHelper,c.elevationInfo,this.view))])}}return p.length>0&&(p.sort((v,_)=>v[1]-_[1]),p[0][1]<this._squaredPointProximityThreshold(c.pointer))?this._updateSnappingCandidate(p[0][0],o,c):this._updateSnappingCandidate(h,o,c)}_updateSnappingCandidate(l,o,d){this.doneSnapping(),this._currentMainCandidate=l;const c=this._currentMainCandidate.targetPoint,h=[];h.push(...l.hints);for(const p of o){if(l instanceof Qe){if(p.constraint.objectEqual(l.first.constraint)||p.constraint.objectEqual(l.second.constraint))continue}else if(p.constraint.objectEqual(l.constraint))continue;p.constraint.check(c)&&(p.targetPoint=c,this._currentOtherActiveCandidates.push(p),h.push(...p.hints))}return{snappedPoint:d.coordinateHelper.vectorToDehydratedPoint(c),hints:h}}_squaredPointProximityThreshold(l){return"touch"===l?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(l,o){let d=-1;for(let c=0;c<l.length;++c)if(o.constraint.objectEqual(l[c].constraint)){d=c;break}return d}get test(){return{visualizationsActive:this.handles.has(Je),engines:this._engines}}};(0,m._)([(0,f.Cb)({constructOnly:!0})],ie.prototype,"view",void 0),(0,m._)([(0,f.Cb)()],ie.prototype,"options",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],ie.prototype,"updating",null),(0,m._)([(0,f.Cb)()],ie.prototype,"snappingEnginesFactory",void 0),(0,m._)([(0,f.Cb)()],ie.prototype,"_engines",void 0),(0,m._)([(0,f.Cb)()],ie.prototype,"squaredMouseProximityTreshold",null),(0,m._)([(0,f.Cb)()],ie.prototype,"squaredTouchProximityThreshold",null),ie=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SnappingManager")],ie);const Je="visualization-handle",qe=new Map;function On(l){return new ie({view:l,snappingEnginesFactory:(o,d)=>[new fe({view:l,options:d})]})}class Rt{constructor(o){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=o.editGeometryOperations,this.elevationInfo=o.elevationInfo,this.pointer=o.pointer,this.vertexHandle=o.vertexHandle,this.excludeFeature=o.excludeFeature,this.visualizer=o.visualizer}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}var Mn=g(53639),et=g(87091);class Rn{constructor(){this.next=new Ke.hM}createSnapDragEventPipelineStep({predicate:o=(()=>!0),cancel:d,snappingManager:c,snappingContext:h,updatingHandles:p}){var y=this;if((0,u.Wi)(c))return b=>b;let v=null,_=null;const E=()=>{v=(0,u.IM)(v),c.doneSnapping(),(0,u.pC)(_)&&_.frameTask.remove(),_=null};d.next(b=>(E(),b)),this.next=new Ke.hM;const w=(0,le.Ds)(function(){var b=(0,x.Z)(function*({frameTask:G,point:k,context:Ie,event:Ae,dx:ut,dy:ze},je){const Ht=yield G.schedule(()=>c.snap(k,Ie,je),je);if(Ht.valid){let rt=yield G.schedule(()=>Ht.apply(),je);k!==P&&(rt=c.update(P,Ie)),(0,Mn.k)(rt,L)||(Ae.mapEnd.x=rt.x+ut,Ae.mapEnd.y=rt.y+ze,y.next.execute(Ae))}});return function(G,k){return b.apply(this,arguments)}}());let P,L;return b=>{if(!o(b))return b;if("start"===b.action){const G="3d"===c.view.type?c.view.resourceController.scheduler.registerTask(et.T8.SNAPPING):et.sq;_={context:new Rt({editGeometryOperations:h.editGeometryOperations,elevationInfo:h.elevationInfo,pointer:h.pointer,vertexHandle:(0,u.pC)(b.info)?b.info.handle:null,excludeFeature:h.excludeFeature,visualizer:h.visualizer}),originalPos:(0,u.pC)(b.snapOrigin)?h.coordinateHelper.vectorToDehydratedPoint(b.snapOrigin):b.mapStart,frameTask:G}}if((0,u.pC)(_)){const G=_.context.coordinateHelper.vectorToDehydratedPoint(_.context.coordinateHelper.arrayToVector([_.originalPos.x,_.originalPos.y,_.originalPos.z]));G.x+=b.mapEnd.x-b.mapStart.x,G.y+=b.mapEnd.y-b.mapStart.y;const k=b.mapStart.x-_.originalPos.x,Ie=b.mapStart.y-_.originalPos.y,Ae={...b,action:"update"},ut=_.context,ze=c.update(G,_.context);if(L=ze,b.mapEnd.x=ze.x+k,b.mapEnd.y=ze.y+Ie,P=G,"end"!==b.action){const je=_.frameTask;(0,u.pC)(v)||(v=new AbortController),p.addPromise((0,le.R8)(w({frameTask:je,event:Ae,context:ut,point:G,dx:k,dy:Ie},v.signal)))}}return"end"===b.action&&E(),b}}}let Re=class extends R.Z{constructor(l){var o;super(l),o=this,this.stagedPoint=null,this._abortController=null,this._snap=(0,le.Ds)(function(){var d=(0,x.Z)(function*(c,h,p,y){const v=yield o._frameTask.schedule(()=>h.snap(c,p,y),y);v.valid&&(yield o._frameTask.schedule(()=>{o.stagedPoint=v.apply(),c!==o._snapMapPoint&&(o.stagedPoint=h.update(o._snapMapPoint,p))},y))});return function(c,h,p,y){return d.apply(this,arguments)}}())}initialize(){const l="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,u.pC)(l)?l.registerTask(et.T8.SNAPPING):et.sq}destroy(){this._abortController=(0,u.IM)(this._abortController),this._frameTask=(0,u.hw)(this._frameTask)}snap(l,o,d){var c=this;return(0,x.Z)(function*(){return c.stagedPoint=o.update(l,d),c._snapMapPoint=l,(0,u.Wi)(c._abortController)&&(c._abortController=new AbortController),c._snap(l,o,d,c._abortController.signal)})()}abort(){this._abortController=(0,u.IM)(this._abortController)}};(0,m._)([(0,f.Cb)({constructOnly:!0})],Re.prototype,"view",void 0),(0,m._)([(0,f.Cb)()],Re.prototype,"stagedPoint",void 0),Re=(0,m._)([(0,A.j)("esri.views.interactive.snapping.SnappingOperation")],Re);let Ee=class extends we.r{constructor(l){super(l),this.stagedDimension=null,this._dimensionManipulators=new Map,this._dimensionHandles=new We.Z,this._snappingPipeline=new Rn,this._snappingManagerResult=function bn(l){qe.has(l)||qe.set(l,{referenceCount:0,snappingManager:On(l)});const o=qe.get(l);o.referenceCount++;const d=(0,Z.kB)(()=>function Tn(l,o){o.referenceCount--,o.referenceCount>0||(0,nn.Y)(()=>{0===o.referenceCount&&(o.snappingManager.destroy(),qe.delete(l))})}(l,o));return{snappingManager:o.snappingManager,...d}}(l.view),this.own(this._snappingManagerResult)}initialize(){this._snappingOperation=new Re({view:this.view}),this.own([this._dimensionHandles,(0,C.YP)(()=>this._snappingOperation.stagedPoint,l=>{(0,u.pC)(this.stagedDimension)&&(this.stagedDimension.endPoint=(0,u.yw)(l,o=>(0,Ne.WG)(o,new ve.Z)))},C.Z_)])}destroy(){this._snappingOperation=(0,u.SC)(this._snappingOperation)}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get _snappingManager(){return this._snappingManagerResult.snappingManager}addDimension(l,o){if(this._dimensionManipulators.has(l))return;const d=this._createPointManipulator(l,{isStart:!0}),c=this._createPointManipulator(l,{isStart:!1}),h={startManipulator:d,endManipulator:c};this._setupDimensionToManipulatorsSync(l,h),this._dimensionManipulators.set(l,h),o.add(d),o.add(c)}removeDimension(l,o){const d=this._dimensionManipulators.get(l);if((0,u.Wi)(d))return;this._dimensionHandles.remove(l);const{startManipulator:c,endManipulator:h}=d;this._dimensionManipulators.delete(l),o.remove(c),o.remove(h)}getManipulatorsForDimension(l){return this._dimensionManipulators.get(l)}onDeactivate(){this._snappingManager.doneSnapping()}onUnstagedClick({mapPoint:l,pointerType:o}){const d=this._snappingContext(o),c=(0,Ne.WG)(this._snappingManager.update(l,d),new ve.Z),h=new jt({startPoint:c,endPoint:null});return this.stagedDimension=h,this._snappingManager.doneSnapping(),h}onStagedClick({mapPoint:l,pointerType:o}){if((0,u.Wi)(this.stagedDimension))return;const d=this._snappingContext(o),c=(0,Ne.WG)(this._snappingManager.update(l,d),new ve.Z);this.stagedDimension.endPoint=c,this.stagedDimension=null,this._snappingManager.doneSnapping()}onPointerMove({mapPoint:l,pointerType:o}){const d=this._snappingContext(o);this.updatingHandles.addPromise((0,le.R8)(this._snappingOperation.snap(l,this._snappingManager,d)))}_setupDimensionToManipulatorsSync(l,o){const{startManipulator:d,endManipulator:c}=o;this._dimensionHandles.add([(0,C.YP)(()=>({startPoint:l.startPoint,endPoint:l.endPoint,stagedDimension:this.stagedDimension}),({startPoint:h,endPoint:p,stagedDimension:y})=>{(0,u.pC)(h)?(d.available=(0,u.Wi)(y)||y===l,d.location=h):d.available=!1,(0,u.pC)(p)?(c.available=(0,u.Wi)(y),c.location=p):c.available=!1},C.tX)],l)}_createPointManipulator(l,o){const{isStart:d}=o,c=d?"startPoint":"endPoint",h=(0,Ft.aD)(this.view,T.Z.toUnitRGB(be.pointManipulators.color),be.pointManipulators.opacity);h.available=!1,h.radius=be.pointManipulators.radius;const p=(0,Ke.Xd)(h,(y,v,_,E)=>{const w=(0,wt.J4)(y);v.next(w).next((0,wt.gv)(this.view)).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(E),snappingManager:this._snappingManager,cancel:_,updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(P=>{const L=(0,Ne.WG)(P.mapEnd,new ve.Z);l[c]=L}),_.next(w).next((0,Ke.di)(l,[c]))});return this._dimensionHandles.add(p,l),h}_snappingContext(l){return new Rt({elevationInfo:{mode:"absolute-height",offset:0},pointer:l,editGeometryOperations:new tn.c(new en.XE("point",(0,qt.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Jt})}};(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Ee.prototype,"view",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],Ee.prototype,"updating",null),(0,m._)([(0,f.Cb)()],Ee.prototype,"stagedDimension",void 0),Ee=(0,m._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],Ee);var xe,Ln=g(62483),Vn=g(67857),Dn=g(58997),Hn=g(41900);!function(l){l.Ready="ready",l.Creating="creating",l.Created="created"}(xe||(xe={}));let K=class extends Dn.f{constructor(l){super(l),this.preferManipulatorCursor=!0,this.analysisViewData=null}initialize(){this._intersector=(0,Ln.Z8)(this.view.state.viewingMode),this._intersector.options.store=Vn.eC.MIN,this._lengthDimensionSubTool=new Ee({view:this.view}),this.own((0,Z.ed)(this._lengthDimensionSubTool));for(const l of this.analysis.dimensions.items)this._addDimension(l);this.own(this.analysis.dimensions.on("change",l=>{for(const o of l.added)this._addDimension(o);for(const o of l.removed)this._removeDimension(o)})),this.own((0,C.YP)(()=>this.state,l=>{l===xe.Created&&this.finishToolCreation()},C.tX))}get state(){return this.analysis.dimensions.some(l=>"length"===l.type)?(0,u.pC)(this._activeSubTool)?xe.Creating:xe.Created:xe.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}getManipulatorsForDimension(l){return this._lengthDimensionSubTool.getManipulatorsForDimension(l)}onInputEvent(l){switch(l.type){case"immediate-click":this._clickHandler(l);break;case"immediate-double-click":this._doubleClickHandler(l);break;case"pointer-move":this._pointerMoveHandler(l)}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,u.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),(0,u.pC)(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null)}_clickHandler(l){if((0,u.Wi)(this._activeSubTool))return;const o=this._intersectScreen(l);if(!(0,u.Wi)(o)){if((0,u.Wi)(this._activeSubTool.stagedDimension)){const d=this._activeSubTool.onUnstagedClick({mapPoint:o,pointerType:l.pointerType});this.analysis.dimensions.add(d)}else this._activeSubTool.onStagedClick({mapPoint:o,pointerType:l.pointerType});l.stopPropagation()}}_doubleClickHandler(l){this.view.activeTool=null,l.stopPropagation()}_pointerMoveHandler(l){if((0,u.Wi)(this._activeSubTool)||this.hasFocusedManipulators)return;const o=this._intersectScreen(l);(0,u.Wi)(o)||this._activeSubTool.onPointerMove({mapPoint:o,pointerType:l.pointerType})}_intersectScreen(l){const o=(0,Hn.Sj)(l);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(o,this._intersector);const d=this._intersector.results.min,c=S.WM.get();return d.getIntersectionPoint(c)?this.view.renderCoordsHelper.fromRenderCoords(c,this.view.spatialReference):null}_addDimension(l){this._lengthDimensionSubTool.addDimension(l,this.manipulators)}_removeDimension(l){this._lengthDimensionSubTool.removeDimension(l,this.manipulators)}};(0,m._)([(0,f.Cb)({constructOnly:!0})],K.prototype,"view",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],K.prototype,"analysis",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],K.prototype,"state",null),(0,m._)([(0,f.Cb)({readOnly:!0})],K.prototype,"updating",null),(0,m._)([(0,f.Cb)({readOnly:!0})],K.prototype,"cursor",null),(0,m._)([(0,f.Cb)({readOnly:!0})],K.prototype,"preferManipulatorCursor",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0})],K.prototype,"analysisViewData",void 0),(0,m._)([(0,f.Cb)()],K.prototype,"_activeSubTool",void 0),(0,m._)([(0,f.Cb)()],K.prototype,"_lengthDimensionSubTool",void 0),K=(0,m._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.DimensioningTool")],K);var tt=g(15572),In=g(4794),An=g(78172),zn=g(15348),jn=g(68063),dt=g(87469),Le=g(64770),Wn=g(54889);let Ve=class extends R.Z{constructor(l){super(l),this._directSegment=new Le.y$,this._dimensionSegment=new Le.y$,this._offsetAxis=(0,H.c)(),this._startOffsetSegment=new Le.y$(this._directSegment.startRenderSpace,this._dimensionSegment.startRenderSpace),this._endOffsetSegment=new Le.y$(this._directSegment.endRenderSpace,this._dimensionSegment.endRenderSpace),this._labelSegment=new Le.y$,this._hasValidGeometry=!1;const o={view:l.view,attached:!0,width:1,color:(0,In.f)(1,.5,0,1),renderOccluded:ce.yD.OccludeAndTransparent},d={...o,stipplePattern:(0,Wn.z5)(5)};this._dimensionVisualElement=new dt.r(o),this._startOffsetVisualElement=new dt.r(d),this._endOffsetVisualElement=new dt.r(d),this._label=new jn.Kc({view:l.view,attached:!0,distance:0,fontSize:be.labels.fontSize})}initialize(){this.own([(0,Z.ed)(this._dimensionVisualElement),(0,Z.ed)(this._startOffsetVisualElement),(0,Z.ed)(this._endOffsetVisualElement),(0,Z.ed)(this._label)]);const{computation:l,view:o}=this,{dimension:d}=l;this.own([(0,C.YP)(()=>({startPoint:d.startPoint,endPoint:d.endPoint,offset:d.offset,axis:d.axis,heading:d.heading}),c=>{this._updateGeometry(c),this._updateLines(),this._updateLabelGeometry(o.state.camera)},C.nn),(0,C.YP)(()=>l.length,c=>this._updateLabelContent(c),C.nn),(0,C.YP)(()=>o.state.camera,c=>this._updateLabelGeometry(c),C.nn)])}get testInfo(){return{dimensionVisualElement:this._dimensionVisualElement,label:this._label}}_updateGeometry({startPoint:l,endPoint:o,offset:d,axis:c}){const{renderCoordsHelper:h}=this.view,p=this._directSegment;if((0,u.Wi)(l)||(0,u.Wi)(o)||!h.toRenderCoords(l,p.startRenderSpace)||!h.toRenderCoords(o,p.endRenderSpace))return void(this._hasValidGeometry=!1);const{startRenderSpace:y,endRenderSpace:v}=p,_=p.eval(.5,S.WM.get()),E=h.worldUpAtPosition(_,S.WM.get()),w=h.worldBasisAtPosition(_,An.R.X,S.WM.get()),P=this._offsetAxis;!function Nn(l,o,d,c,h,p){switch(h){case"horizontal":return(0,M.c)(l,c);case"vertical":return(0,M.e)(o,c)<(0,M.e)(d,c)?(0,M.v)(l,d,o):(0,M.v)(l,o,d),(0,M.f)(l,l,c),(0,M.z)(l,H.Z)?(0,M.c)(l,p):((0,M.f)(l,l,c),(0,M.n)(l,l),l);case"direct":(0,M.e)(o,p)>(0,M.e)(d,p)?(0,M.v)(l,d,o):(0,M.v)(l,o,d),(0,M.f)(l,l,c),(0,M.z)(l,H.Z)?(0,M.c)(l,p):(0,M.n)(l,l)}}(P,y,v,E,c,w);const L=d/h.unitInMeters,[b,G]=function Un(l,o,d,c=0){const h=(0,M.e)(o,d),p=(0,M.e)(l,d),y=Math.abs(h-p)+c;return h>p?[y,c]:[c,y]}(y,v,P,L),k=this._dimensionSegment;(0,M.C)(k.startRenderSpace,p.startRenderSpace,P,b),(0,M.C)(k.endRenderSpace,p.endRenderSpace,P,G),this._hasValidGeometry=!0}_updateLines(){if(!this._hasValidGeometry)return this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,void(this._endOffsetVisualElement.visible=!1);this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=!0,this._endOffsetVisualElement.visible=!0}_updateLabelContent(l){if((0,u.Wi)(l)||!this._hasValidGeometry)return this._label.text="",void(this._label.visible=!1);const{value:o}=(0,tt.nn)(l,"meters");this._label.text=`${(0,zn.uf)(o,{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this._label.visible=!0}_updateLabelGeometry(l){if(!this._hasValidGeometry)return void(this._label.visible=!1);const{offset:o}=this.computation.dimension,d=l.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,S.WM.get())),c=(Math.sign(o)>=0?1:-1)*be.labels.offset*d;(function Gn(l,o,d,c){(0,M.C)(l.startRenderSpace,o.startRenderSpace,d,c),(0,M.C)(l.endRenderSpace,o.endRenderSpace,d,c)})(this._labelSegment,this._dimensionSegment,this._offsetAxis,c),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}};(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Ve.prototype,"computation",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Ve.prototype,"view",void 0),Ve=(0,m._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],Ve);let De=class extends R.Z{constructor(l){super(l),this._dimensionVisualizations=new Map}initialize(){for(const l of this.computations)this._addComputation(l);this.own(this.computations.on("change",({added:l,removed:o})=>{for(const d of o)this._removeComputation(d);for(const d of l)this._addComputation(d)}))}destroy(){this._dimensionVisualizations.forEach(l=>{l.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values())}}_addComputation(l){this._dimensionVisualizations.has(l)||this._dimensionVisualizations.set(l,new Ve({computation:l,view:this.view}))}_removeComputation(l){const o=this._dimensionVisualizations.get(l);(0,u.Wi)(o)||(o.destroy(),this._dimensionVisualizations.delete(l))}};(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],De.prototype,"view",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],De.prototype,"computations",void 0),De=(0,m._)([(0,A.j)("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],De);let nt=class extends R.Z{constructor(l){super(l),this.dimension=null}};(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],nt.prototype,"dimension",void 0),nt=(0,m._)([(0,A.j)("esri.views.3d.analysis.LengthDimensionResult")],nt);const Fn=nt;var Zn=g(16730),ct=g(55915),Bn=g(37053),Xn=g(66601);function Yn(l,o){const{spatialReference:d}=l;return(0,Bn.fS)(d,o.spatialReference)?(z[0]=l.x,z[1]=l.y,z[2]=l.hasZ?l.z:0,U[0]=o.x,U[1]=o.y,U[2]=o.hasZ?o.z:0,function Kn(l,o,d){const c=function He(l,o,d,c){const h=(0,Xn.m)(d),p=(0,Zn.j5)(h);if((0,u.Wi)(p))return null;const y=o[2]-l[2];if("vertical"===c)return{verticalSigned:y,unit:p};if(!(0,ct.SH)(l,d,ht,h)||!(0,ct.SH)(o,d,it,h))return null;if("direct"===c)return{direct:(0,M.i)(it,ht),unit:p};if((0,M.s)(st,l[0],l[1],o[2]),!(0,ct.SH)(st,d,st,h))return null;const v=(0,M.i)(st,it);return"horizontal"===c?{horizontal:v,unit:p}:{direct:(0,M.i)(it,ht),horizontal:v,vertical:Math.abs(y),unit:p}}(l,o,d);return(0,u.pC)(c)?{direct:(0,tt.yG)(c.direct,c.unit),horizontal:(0,tt.yG)(c.horizontal,c.unit),vertical:(0,tt.yG)(c.vertical,c.unit)}:null}(z,U,d)):null}const z=(0,H.c)(),U=(0,H.c)(),ht=(0,H.c)(),it=(0,H.c)(),st=(0,H.c)();let Pe=class extends R.Z{constructor(l){super(l)}initialize(){this._set("result",new Fn({dimension:this.dimension}))}get length(){const{startPoint:l,endPoint:o,axis:d}=this.dimension;if((0,u.Wi)(l)||(0,u.Wi)(o))return null;const c=Yn(l,o);return(0,u.Wi)(c)?null:c[d]}};(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Pe.prototype,"dimension",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Pe.prototype,"result",void 0),(0,m._)([(0,f.Cb)()],Pe.prototype,"length",null),Pe=(0,m._)([(0,A.j)("esri.views.3d.analysis.LengthDimensionComputation")],Pe);var pt=g(95925);let Q=class extends((0,se.p)(R.Z)){constructor(l){super(l),this.type="dimensioning-view-3d",this.tool=null,this._computations=new O.Z,this._dimensionsToResults=new Map,this._placementTask=null}initialize(){this.own([(0,pt.Lp)(this,K),(0,C.on)(()=>this.analysis.dimensions,"change",({added:l,removed:o})=>{for(const d of o)this._removeDimension(d);for(const d of l)this._addDimension(d)},{onListenerAdd:l=>{for(const o of l)this._addDimension(o)},onListenerRemove:l=>{for(const o of l)this._removeDimension(o)}})]),this._analysisVisualization=new De({view:this.view,computations:this._computations})}destroy(){this._placementTask=(0,u.IM)(this._placementTask),this._analysisVisualization=(0,u.SC)(this._analysisVisualization),this._computations.drain(l=>l.destroy()),(0,pt.Yq)(this)}get results(){return this.analysis.dimensions.map(l=>this._dimensionsToResults.get(l))}get testInfo(){return{visualization:this._analysisVisualization}}createLengthDimensions(l){var o=this;return(0,x.Z)(function*(){return o._placementTask=(0,u.IM)(o._placementTask),o._placementTask=(0,pt.P9)(o,K,l),o._placementTask.promise})()}_addDimension(l){const o=this._dimensionsToResults;if(o.has(l))return;const d=this._computations,c=new Pe({dimension:l});d.add(c),o.set(l,c.result)}_removeDimension(l){const o=this._computations,d=this._dimensionsToResults,c=o.findIndex(p=>p.dimension===l),h=o.removeAt(c);d.delete(l),(0,u.SC)(h)}};(0,m._)([(0,f.Cb)({readOnly:!0})],Q.prototype,"type",void 0),(0,m._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Q.prototype,"analysis",void 0),(0,m._)([(0,f.Cb)()],Q.prototype,"tool",void 0),(0,m._)([(0,f.Cb)({readOnly:!0})],Q.prototype,"results",null),(0,m._)([(0,f.Cb)()],Q.prototype,"_analysisVisualization",void 0),(0,m._)([(0,f.Cb)()],Q.prototype,"_computations",void 0),(0,m._)([(0,f.Cb)()],Q.prototype,"_dimensionsToResults",void 0),(0,m._)([(0,f.Cb)()],Q.prototype,"_placementTask",void 0),Q=(0,m._)([(0,A.j)("esri.views.3d.analysis.DimensioningAnalysisView3D")],Q);const Qn=Q},36460:(J,N,g)=>{g.d(N,{c:()=>j});var x=g(17626),m=g(91558),R=g(86810),O=g(77712),u=g(76898);let C=class extends R.wq{constructor(){super(...arguments),this.enabled=!0}};(0,x._)([(0,O.Cb)({type:Boolean})],C.prototype,"enabled",void 0),C=(0,x._)([(0,u.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],C);let f=class extends R.wq{constructor(B){super(B),this.lineSnapper=new C,this.parallelLineSnapper=new C,this.rightAngleSnapper=new C,this.rightAngleTriangleSnapper=new C,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new m.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,x._)([(0,O.Cb)({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],f.prototype,"lineSnapper",void 0),(0,x._)([(0,O.Cb)({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],f.prototype,"parallelLineSnapper",void 0),(0,x._)([(0,O.Cb)({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],f.prototype,"rightAngleSnapper",void 0),(0,x._)([(0,O.Cb)({type:C,constructOnly:!0,nonNullable:!0,json:{write:!0}})],f.prototype,"rightAngleTriangleSnapper",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],f.prototype,"shortLineThreshold",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],f.prototype,"distance",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],f.prototype,"pointThreshold",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],f.prototype,"intersectionParallelLineThreshold",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],f.prototype,"parallelLineThreshold",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],f.prototype,"touchSensitivityMultiplier",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],f.prototype,"pointOnLineThreshold",void 0),(0,x._)([(0,O.Cb)({type:m.Z,nonNullable:!0})],f.prototype,"orange",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],f.prototype,"lineHintWidthReference",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],f.prototype,"lineHintWidthTarget",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"lineHintFadedExtensions",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],f.prototype,"parallelLineHintWidth",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],f.prototype,"parallelLineHintLength",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],f.prototype,"parallelLineHintOffset",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],f.prototype,"rightAngleHintSize",void 0),(0,x._)([(0,O.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],f.prototype,"rightAngleHintOutlineSize",void 0),f=(0,x._)([(0,u.j)("esri.views.interactive.snapping.Settings.Defaults")],f);const j=new f},33351:(J,N,g)=>{g.d(N,{Bq:()=>A,Hk:()=>f,UL:()=>se,ku:()=>X,yG:()=>B});var x=g(67831),m=g(99770),R=g(36460),O=g(44725),u=g(396);class C{constructor(S){this.coordinateHelper=S}}class f extends C{constructor(S,T){super(S),this.point=T}objectEqual(S){return S instanceof f&&(0,O.Xv)(this.point,S.point)}check(S){return(0,x.s)(S,this.point)<R.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(S){const T=[];return S instanceof j?T.push(...(0,u.pk)({start:S.start,end:S.end,type:S instanceof X?u.SP.LINE:u.SP.RAY},this.point)):S instanceof se&&T.push(...(0,u.l0)(S.center,S.radius,this.point)),T.map(F=>new A(this.coordinateHelper,F,this,S))}}class j extends C{constructor(S,T,F){super(S),this.start=T,this.end=F}objectEqual(S){return S instanceof j&&(0,O.Xv)(this.start,S.start)&&(0,O.Xv)(this.end,S.end)}intersect(S){const T=[];return S instanceof f?T.push(...(0,u.pk)({start:this.start,end:this.end,type:this instanceof X?u.SP.LINE:u.SP.RAY},S.point)):S instanceof j?T.push(...(0,u.dU)({start:this.start,end:this.end,type:this instanceof X?u.SP.LINE:u.SP.RAY},{start:S.start,end:S.end,type:S instanceof X?u.SP.LINE:u.SP.RAY})):S instanceof se&&T.push(...(0,u.UG)({start:this.start,end:this.end,type:this instanceof X?u.SP.LINE:u.SP.RAY},S.center,S.radius)),T.map(F=>new A(this.coordinateHelper,F,this,S))}}class B extends j{constructor(S,T,F){super(S,T,F),this.dir=(0,m.a)(),this.p=(0,m.a)()}objectEqual(S){return S instanceof B&&super.objectEqual(S)}check(S){return(0,x.g)(this.dir,this.end,this.start),(0,x.g)(this.p,S,this.start),(0,x.h)(this.dir,this.p)>=0&&(0,u.Oy)(S,this.start,this.end)<R.c.pointOnLineThreshold}closestTo(S){const T=this.coordinateHelper.clone(S);return(0,u.aW)(T,S,this.start,this.end),T}}class X extends j{constructor(S,T,F){super(S,T,F)}objectEqual(S){return S instanceof X&&super.objectEqual(S)}check(S){return(0,u.Oy)(S,this.start,this.end)<R.c.pointOnLineThreshold}closestTo(S){const T=this.coordinateHelper.clone(S);return(0,u.k0)(T,S,this.start,this.end),T}}class A extends C{constructor(S,T,F,ot){super(S),this.intersection=T,this.first=F,this.second=ot}objectEqual(S){return S instanceof A&&this.first.objectEqual(S.first)&&this.second.objectEqual(S.second)}check(){return!1}closestTo(S){const T=this.coordinateHelper.clone(S);return(0,x.c)(T,this.intersection),T}intersect(){return[]}}class se extends C{constructor(S,T,F){super(S),this.center=T,this.radius=F}objectEqual(S){return S instanceof se&&this.center[0]===S.center[0]&&this.center[1]===S.center[1]&&this.radius===S.radius}check(){return!1}closestTo(S){const T=this.coordinateHelper.clone(S);return(0,u.xO)(T,S,this.center,this.radius),T}intersect(S){const T=[];return S instanceof j?T.push(...(0,u.UG)({start:S.start,end:S.end,type:S instanceof X?u.SP.LINE:u.SP.RAY},this.center,this.radius)):S instanceof f&&T.push(...(0,u.l0)(this.center,this.radius,S.point)),T.map(F=>new A(this.coordinateHelper,F,this,S))}}},75897:(J,N,g)=>{g.d(N,{L:()=>u});var x=g(33351),m=g(44725),R=g(97979),O=g(62160);class u extends R.a{constructor(f){super({...f,constraint:new x.ku(f.coordinateHelper,f.edgeStart,f.edgeEnd)})}get hints(){return[new O.w(m.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}},97979:(J,N,g)=>{g.d(N,{a:()=>m});var x=g(22823);class m extends x.j{constructor({coordinateHelper:O,targetPoint:u,objectId:C,constraint:f,elevationInfo:j}){super(O,u,f,j),this.objectId=C}}},22823:(J,N,g)=>{g.d(N,{j:()=>x});class x{constructor(R,O,u,C){this.coordinateHelper=R,this.targetPoint=O,this.constraint=u,this.elevationInfo=C}}},70211:(J,N,g)=>{g.d(N,{x:()=>O});var x=g(33351),m=g(97979),R=g(19038);class O extends m.a{constructor(C){super({...C,constraint:new x.Hk(C.coordinateHelper,C.targetPoint)})}get hints(){return[new R.n(this.targetPoint,this.elevationInfo)]}}},62160:(J,N,g)=>{g.d(N,{w:()=>u}),g(8314);var m=g(63290),R=g(44725),O=g(5286);m.Z.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class u extends O.r{constructor(f,j,B,X,A=!0,se=!0){super(X),this.type=f,this.lineStart=j,this.lineEnd=B,this.fadeLeft=A,this.fadeRight=se}equals(f){return f instanceof u&&this.type===f.type&&(0,R.Xv)(this.lineStart,f.lineStart)&&(0,R.Xv)(this.lineEnd,f.lineEnd)&&this.fadeLeft===f.fadeLeft&&this.fadeRight===f.fadeRight}}},19038:(J,N,g)=>{g.d(N,{n:()=>R});var x=g(44725),m=g(5286);class R extends m.r{constructor(u,C){super(C),this.point=u}equals(u){return u instanceof R&&(0,x.Xv)(this.point,u.point)}}},5286:(J,N,g)=>{g.d(N,{r:()=>x});class x{constructor(R){this.elevationInfo=R}}},44725:(J,N,g)=>{g.d(N,{Xv:()=>R,lQ:()=>O,tp:()=>m,ze:()=>u});var u,C,x=g(67831);function m(C,f){const j=C.x-f.x,B=C.y-f.y;return j*j+B*B}function R(C,f){const j=C.length===f.length&&C[0]===f[0]&&C[1]===f[1];switch(C.length){case 2:return j;case 3:return j&&C[2]===f[2];case 4:return j&&C[3]===f[3]}return!1}function O(C,f){f.sort((j,B)=>(0,x.s)(j.targetPoint,C)-(0,x.s)(B.targetPoint,C))}(C=u||(u={}))[C.TARGET=0]="TARGET",C[C.REFERENCE=1]="REFERENCE",C[C.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}}]);