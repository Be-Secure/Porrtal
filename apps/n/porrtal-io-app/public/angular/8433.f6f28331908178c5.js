"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[8433],{19702:(w,P,t)=>{t.d(P,{A:()=>A});var _=t(15861),r=t(17626),C=t(54024),x=t(10699),D=t(32917),o=t(77712),p=(t(85931),t(8314),t(90912),t(76898)),R=t(36947);const A=I=>{let v=class extends I{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(f){super.postscript(f),(0,R.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var f=this;return(0,_.Z)(function*(){const l=new AbortController,y=l.signal;f.handles.add((0,C.kB)(()=>l.abort())),yield(0,D.N1)(()=>f.view.defaultsFromMap?.heightModelInfoReady,y),(0,x.k_)(y);const c=(0,R.Wt)(f.layer,f.view.heightModelInfo,f.supportsHeightUnitConversion);if(c)throw c})()}canResume(){const f=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!f||!f.minScale||!f.maxScale||f.minScale>=f.maxScale)}getSuspendInfo(){const f=super.getSuspendInfo(),l=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return l&&l.minScale&&l.maxScale&&l.minScale<l.maxScale&&(f.outsideScaleRange=!0),f}};return(0,r._)([(0,o.Cb)()],v.prototype,"view",void 0),(0,r._)([(0,o.Cb)()],v.prototype,"slicePlaneEnabled",void 0),v=(0,r._)([(0,p.j)("esri.views.3d.layers.LayerView3D")],v),v}},22229:(w,P,t)=>{t.d(P,{Z:()=>O});var _=t(17626),r=t(14517),C=t(61885),x=t(72392),D=t(62208),o=t(32917),S=t(77712),R=(t(85931),t(8314),t(90912),t(76898)),A=t(77029),I=t(65401),v=t(87091);class l{constructor(){this._extents=new A.Z({allocator:d=>d||(0,I.Ue)()}),this._tmpExtent=(0,I.Ue)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(d){this._contains(d)||(this._removeContained(d),(0,I.JG)(this._extents.pushNew(),d),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(d){return this._mergeTight(d),d.hasProgressed}_mergeTight(d=v.G5){const g=this._extents,m=new Set;let U=0;for(;U!==g.length;){g.sort((M,V)=>M[0]-V[0]),U=g.length,m.clear();for(let M=0;M<g.length;++M){if(d.done)return;const V=g.getItemAt(M);for(let j=M+1;j<g.length;++j){const T=g.getItemAt(j);if(T[0]>=V[2])break;m.add(T)}m.forEach(j=>{if(V===j)return;if(j[2]<=V[0])return void m.delete(j);const T=(0,I.SO)(V),Q=(0,I.SO)(j),F=this._tmpExtent;(0,I.jn)(V,j,F);const K=T+Q;((0,I.SO)(F)-K)/K<.05&&((0,I.JG)(V,F),m.delete(j),g.remove(j),d.madeProgress())}),m.add(V)}}this._dirty=!1}_contains(d){return this._extents.some(g=>(0,I.r3)(g,d))}_removeContained(d){this._extents.filterInPlace(g=>!(0,I.r3)(d,g))}get test(){const d=this;return{containsPoint:g=>d._extents.some(m=>(0,I.BD)(m,g))}}}var y=t(42743);let c=class extends r.Z{constructor(){super(...arguments),this.dirtyExtents=new l,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new x.Z,this.updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new C.Z}setup(a,d,g,m){this.graphicsCoreOwner=a,this.queryGraphicUIDsInExtent=d,this.graphicsCore=g,this.elevationProvider=m;const U=this.graphicsCoreOwner.view.resourceController.scheduler;this.handles.add([m.on("elevation-change",M=>this._elevationChanged(M)),(0,o.YP)(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),U.registerTask(v.T8.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(a){for(this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress()),a.run(()=>this.dirtyExtents.merge(a));this.running&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);this.graphicsCoreOwner.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(a){const d=this.graphicsCoreOwner.view.renderCoordsHelper,g=this.graphicsCore.effectiveUpdatePolicy===y.jq.ASYNC;for(const m of this.dirtyGraphicsSet.keys()){const U=this.graphicsCore.getGraphics3DGraphicById(m);if(this.dirtyGraphicsSet.delete(m),(0,D.pC)(U)&&(U.alignWithElevation(this.elevationProvider,d,g),a.madeProgress()),a.done)return}}_updateDirtyExtents(a){for(;!this.dirtyExtents.empty&&!a.done;){const d=this.dirtyExtents.pop(),g=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:d,spatialReference:g});const m=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(d,g,U=>{const M=this.graphicsCore.getGraphics3DGraphicById(U);(0,D.pC)(M)&&M.needsElevationUpdates()&&this.dirtyGraphicsSet.add(U)}),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-m)+.9*this.averageExtentUpdateSize,a.madeProgress()}}_markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((a,d)=>this.dirtyGraphicsSet.add(d))}_elevationChanged(a){if("scene"===a.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:d,spatialReference:g}=a;if(this.graphicsCoreOwner.suspended){if(!this.updateElevation){const m=this.graphicsCore.computedExtent;m&&d[2]>m.xmin&&d[0]<m.xmax&&d[3]>m.ymin&&d[1]<m.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:d,spatialReference:g})}else d[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(d),this.notifyChange("updating")}};(0,_._)([(0,S.Cb)({readOnly:!0})],c.prototype,"updating",null),(0,_._)([(0,S.Cb)({readOnly:!0})],c.prototype,"updatingRemaining",null),c=(0,_._)([(0,R.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c);const O=c},79650:(w,P,t)=>{t.d(P,{Z:()=>$});var _=t(15861),r=t(17626),C=t(88879),x=t(94573),D=t(80542),o=t(62208),S=t(10699),i=t(32917),s=t(77712),I=(t(85931),t(8314),t(90912),t(76898)),v=t(84682),f=t(46367),l=t(39256),y=t(84952),c=t(62600),O=t(80960),a=t(1191),d=t(22229),g=t(14517),m=t(72392),U=t(63290),M=t(73234),V=t(98624),j=t(59990),T=t(79721),Q=t(34675),F=t(87091);const K=U.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");let G=class extends g.Z{constructor(...e){super(...e),this._dirty=!1,this._querying=!1,this._handles=new m.Z}get updating(){return this._dirty||this._querying||(0,o.pC)(this._queryResult)}setup(e,n){this._layerView=e,this._core=n,this._objectIdField=e.layer.objectIdField,this._queryEngine=new Q.q({layerView:this._layerView,priority:F.T8.FILTER_VISIBILITY}),this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(F.T8.FILTER_VISIBILITY,this)),this._handles.add((0,i.on)(()=>n.owner?.loadedGraphics,"after-changes",u=>this._graphicsChanged(u),{onListenerAdd:()=>this.dirty=!0})),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(e=>e.clearVisibilityFlag(T.P.FILTER)),this._queryResult=null,this._querying=!1),this.dirty=!1}_graphicsChanged(e){this._queryEngine&&0==(e.type&M.y.ADD)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(T.P.FILTER,T.E.GRAPHIC)||e.setVisibilityFlag(T.P.FILTER,!1,T.E.GRAPHIC),this.dirty=!0)}filterChanged(){const e=this._recomputeFilter();e!==this._featureFilter&&(this._featureFilter=e,this.dirty=!0);const n="layerFilter"in this._layerView?this._layerView.layerFilter:null;n!==this._sceneFilter&&(this._sceneFilter=n,this.dirty=!0)}get active(){return(this._featureFilter||this._sceneFilter)&&this._core.graphics3DGraphics.size>0}_recomputeFilter(){const e="filter"in this._layerView?this._layerView.filter:null,n="timeExtent"in this._layerView?this._layerView.timeExtent:null,h=(0,j.c)(this._layerView);if((0,o.Wi)(n)&&(0,o.Wi)(h))return e;const u=(0,o.pC)(e)?e.clone():new V.Z;return(0,o.pC)(n)&&(u.timeExtent=(0,o.pC)(u.timeExtent)?u.timeExtent.intersection(n):n),(0,o.pC)(h)&&(u.where=null==u.where||""===u.where?h:`(${u.where}) AND (${h})`),u}get running(){return this._dirty&&!this._querying||(0,o.pC)(this._queryResult)}runTask(e){if(!this.active)return void this.clear();!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._featureFilter,this._sceneFilter).then(h=>{this._queryResult=h,this._querying=!1}).catch(h=>{if(!(0,S.D_)(h)){K.warn("FeatureFilter query failed: "+h,{error:h});const u=new Set;this._core.graphics3DGraphics.forEach(b=>u.add(this._getFeatureId(b.graphic))),this._queryResult=u,this._querying=!1}}),e.madeProgress());const n=this._queryResult;(0,o.pC)(n)&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(h=>{if(e.done)return!1;const u=n.has(this._getFeatureId(h.graphic));return!!h.setVisibilityFlag(T.P.FILTER,u,T.E.GRAPHIC)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null))}_getFeatureId(e){return e.objectId??e.attributes[this._objectIdField]}set dirty(e){this._dirty=e}};(0,r._)([(0,s.Cb)({readOnly:!0})],G.prototype,"updating",null),(0,r._)([(0,s.Cb)({readOnly:!0})],G.prototype,"running",null),(0,r._)([(0,s.Cb)()],G.prototype,"_dirty",void 0),(0,r._)([(0,s.Cb)()],G.prototype,"_querying",void 0),(0,r._)([(0,s.Cb)()],G.prototype,"_queryResult",void 0),G=(0,r._)([(0,I.j)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],G);var N=t(83518),J=t(14752),z=t(67873),Y=t(67225),H=t(97445),L=t(42743);let E=class extends D.r{constructor(e){super(e),this.type="graphics-3d",this.elevationFeatureExpressionEnabled=!1,this.dataExtent=null,this.drapeSourceType=c.L.Features,this.preferredUpdatePolicy=L.jq.ASYNC,this.suspendResumeExtent=null}normalizeCtorArgs(e){const n=e.frustumVisibilityEnabled?new N.Z:null,h=e.scaleVisibilityEnabled?new z.Z:null,u=(e.filterVisibilityEnabled||e.timeExtentEnabled)&&"multipatch"!==e.owner.layer.geometryType?new G:null,b=e.elevationAlignmentEnabled?new d.Z:null,{owner:B,updateClippingExtent:W,dataExtent:k,elevationFeatureExpressionEnabled:q,preferredUpdatePolicy:ee}=e;return{owner:B,updateClippingExtent:W,dataExtent:k,frustumVisibility:n,scaleVisibility:h,filterVisibility:u,elevationAlignment:b,elevationFeatureExpressionEnabled:q,preferredUpdatePolicy:ee}}initialize(){const e=new a.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:this.owner.hasZ,hasM:this.owner.hasM});this._set("graphicsCore",e),this.scaleVisibility&&this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());const n=this.filterVisibility;(0,o.pC)(n)&&(this.updatingHandles.add(()=>"filter"in this.owner&&this.owner.filter,()=>n.filterChanged()),this.updatingHandles.add(()=>"timeExtent"in this.owner&&this.owner.timeExtent,()=>n.filterChanged()),this.updatingHandles.add(()=>"layerFilter"in this.owner&&this.owner.layerFilter,()=>n.filterChanged())),this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(h,u)=>{(0,v.Hg)(h,u)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}),this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo()),this.updatingHandles.add(()=>this.layer.labelingInfo,(h,u)=>{(0,v.Hg)(h,u)&&this.graphicsCore.updateLabelingInfo()}),this.updatingHandles.add(()=>this.preferredUpdatePolicy,h=>this.graphicsCore.preferredUpdatePolicy=h)}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("frustumVisibility",(0,o.SC)(this.frustumVisibility)),this._set("scaleVisibility",(0,o.SC)(this.scaleVisibility)),this._set("filterVisibility",(0,o.SC)(this.filterVisibility)),this._set("elevationAlignment",(0,o.SC)(this.elevationAlignment)),this._set("objectStates",(0,o.SC)(this.objectStates)),this._set("graphicsCore",(0,o.SC)(this.graphicsCore)),this._set("owner",null)}get layer(){return this.owner.layer}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){return this.scaleVisibility?.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return(0,o.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended}get suspendInfo(){const e={};return this.scaleVisibility?.suspended&&(e.outsideScaleRange=!0),(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e}get updating(){return!!(this.graphicsCore?.updating||(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles?.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const e=this.view.resourceController.memoryController.memoryFactor,n=this.graphicsCore?.displayFeatureLimit;if(1===e)return n;const h=Math.ceil(n.maximumNumberOfFeatures*e),u=Math.ceil(n.maximumTotalNumberOfFeatures*e),b=Math.ceil(n.minimumTotalNumberOfFeatures*e);return{...n,maximumNumberOfFeatures:h,maximumTotalNumberOfFeatures:u,minimumTotalNumberOfFeatures:b}}get usedMemory(){return this.graphicsCore?.usedMemory??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:(0,o.Wi)(this.frustumVisibility)||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibility.suspended}}setup(){var e=this;return(0,_.Z)(function*(){(0,o.pC)(e.frustumVisibility)&&e.frustumVisibility.setup(e);const n=e.owner,u=(b,B,W)=>e.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,B,W);e.scaleVisibility&&e.scaleVisibility.setup(e,e.layer,u,e.graphicsCore,e.owner.view.basemapTerrain),(0,o.pC)(e.filterVisibility)&&("filter"in n||"timeExtent"in n)&&e.filterVisibility.setup(n,e.graphicsCore),e.elevationAlignment&&e.elevationAlignment.setup(e,u,e.graphicsCore,n.view.elevationProvider),e._set("objectStates",new J.d(e.graphicsCore)),e._set("labeling",e.owner.view.labeler.addGraphicsOwner(e.graphicsCore,e.scaleVisibility)),e._set("deconfliction",n.view.deconflictor.addGraphicsOwner(e.graphicsCore)),yield(0,S.U3)(e.graphicsCore.setup({elevationAlignment:e.elevationAlignment,scaleVisibility:e.scaleVisibility,filterVisibility:e.filterVisibility,deconflictor:e.deconfliction,labeler:e.labeling,objectStates:e.objectStates})),e.updatingHandles.add(()=>e.layer.renderer,b=>e.updatingHandles.addPromise(e.graphicsCore.rendererChange(b))),e.updatingHandles.add(()=>n.fullOpacity,()=>e.graphicsCore.opacityChange()),e._setupSuspendResumeExtent(),e.updateClippingExtent&&(e.updatingHandles.add(()=>n.view.clippingArea,()=>e._updateClippingExtent()),e._updateClippingExtent()),e.graphicsCore.startCreateGraphics(),e.graphicsCore.labelsEnabled&&(yield(0,S.U3)(e.graphicsCore.updateLabelingInfo()))})()}maskOccludee(e){const{set:n,handle:h}=this.objectStates.acquireSet(L.V_.MaskOccludee,null);return this.objectStates.setUid(n,e.uid),h}highlight(e,n){if(e instanceof y.Z){const{set:h,handle:u}=this.objectStates.acquireSet(L.V_.Highlight,n);return this.owner.queryObjectIds(e).then(b=>this.objectStates.setObjectIds(h,b)),u}if("number"==typeof e||"string"==typeof e)return this.highlight([e],n);if(e instanceof C.Z)return this.highlight([e],n);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof C.Z){const h=e;if(null==(0,H.g)(this.layer.fieldsIndex,h[0].attributes,n)){const u=h.map(W=>W.uid),{set:b,handle:B}=this.objectStates.acquireSet(L.V_.Highlight,null);return this.objectStates.setUids(b,u),B}e=h.map(u=>(0,H.g)(this.layer.fieldsIndex,u.attributes,n))}if("number"==typeof e[0]||"string"==typeof e[0]){const h=e,{set:u,handle:b}=this.objectStates.acquireSet(L.V_.Highlight,n);return this.objectStates.setObjectIds(u,h),b}}return X}whenGraphicBounds(e,n){return this.graphicsCore?.whenGraphicBounds(e,n)}computeAttachmentOrigin(e,n){return this.graphicsCore?.computeAttachmentOrigin(e,n)}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,n,h){const u=(0,l.Kb)(e,{renderer:n,arcade:h});if((0,o.pC)(u)&&u.color){const b=u.color;b[0]=b[0]/255,b[1]=b[1]/255,b[2]=b[2]/255}return u}getRenderingInfoAsync(e,n,h,u){return(0,l.xn)(e,{renderer:n,arcade:h,...u})}getSymbolLayerSize(e,n){return this.graphicsCore?.getSymbolLayerSize(e,n)}setObjectIdVisibility(e,n){this.graphicsCore?.setObjectIdVisibility(e,n)}_updateClippingExtent(){const e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add((0,i.YP)(()=>this.suspendResumeExtentMode,()=>{switch(this.handles.remove(Z),this.suspendResumeExtentMode){case"computed":this.handles.add([(0,i.YP)(()=>this.graphicsCore.computedExtent,e=>this._updateSuspendResumeExtent(e),i.nn),(0,i.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],Z);break;case"data":this.handles.add([(0,i.gx)(()=>this.dataExtent,e=>this._updateSuspendResumeExtent(e),i.nn),(0,i.YP)(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent((0,o.Wg)(this.dataExtent)))],Z);break;default:(0,x.Bg)(this.suspendResumeExtentMode)}},i.nn))}_updateSuspendResumeExtent(e){this._suspendResumeExtentChanged(e?this._extentToSuspendResumeRect(e,this.suspendResumeExtent):null)}_extentToSuspendResumeRect(e,n){const h=this.owner.view.spatialReference;if(!e.spatialReference.equals(h)){if(!(0,f.Q8)(e,h))return;e=(0,f.iV)(e,h)}return(0,Y.Go)(e,n,O.ZF,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(e){(0,o.pC)(this.frustumVisibility)&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)}};(0,r._)([(0,s.Cb)()],E.prototype,"type",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"owner",void 0),(0,r._)([(0,s.Cb)()],E.prototype,"layer",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"updateClippingExtent",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"elevationFeatureExpressionEnabled",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"graphicsCore",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"scaleVisibility",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"filterVisibility",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"elevationAlignment",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],E.prototype,"frustumVisibility",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],E.prototype,"deconfliction",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],E.prototype,"labeling",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],E.prototype,"objectStates",void 0),(0,r._)([(0,s.Cb)()],E.prototype,"suspendResumeExtentMode",null),(0,r._)([(0,s.Cb)()],E.prototype,"dataExtent",void 0),(0,r._)([(0,s.Cb)()],E.prototype,"scaleVisibilitySuspended",null),(0,r._)([(0,s.Cb)()],E.prototype,"suspended",null),(0,r._)([(0,s.Cb)()],E.prototype,"legendEnabled",null),(0,r._)([(0,s.Cb)()],E.prototype,"suspendInfo",null),(0,r._)([(0,s.Cb)()],E.prototype,"updating",null),(0,r._)([(0,s.Cb)()],E.prototype,"updatingRemaining",null),(0,r._)([(0,s.Cb)()],E.prototype,"featureStore",null),(0,r._)([(0,s.Cb)()],E.prototype,"view",null),(0,r._)([(0,s.Cb)()],E.prototype,"loadedGraphics",null),(0,r._)([(0,s.Cb)()],E.prototype,"fullOpacity",null),(0,r._)([(0,s.Cb)()],E.prototype,"filter",null),(0,r._)([(0,s.Cb)()],E.prototype,"slicePlaneEnabled",null),(0,r._)([(0,s.Cb)()],E.prototype,"drapeSourceType",void 0),(0,r._)([(0,s.Cb)()],E.prototype,"updatePolicy",null),(0,r._)([(0,s.Cb)()],E.prototype,"preferredUpdatePolicy",void 0),(0,r._)([(0,s.Cb)()],E.prototype,"displayFeatureLimit",null),E=(0,r._)([(0,I.j)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],E);const $=E,Z="suspendResumeExtentMode",X={remove(){},pause(){},resume(){}}},83518:(w,P,t)=>{t.d(P,{Z:()=>f});var _=t(17626),r=t(14517),C=t(72392),x=t(32917),D=t(77712),s=(t(85931),t(8314),t(90912),t(76898)),p=t(12080),R=t(37810),A=t(87091);let v=class extends r.Z{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new C.Z,this.graphicsCoreOwner=null,this.updating=!0}setup(l){this.graphicsCoreOwner=l,this.extentIntersection=new R.q({renderCoordsHelper:l.view.renderCoordsHelper});const y=l.view,c=y.basemapTerrain,O=y.resourceController.scheduler;this.handles.add([y.on("resize",()=>this._viewChange()),(0,x.YP)(()=>y.state.camera,()=>this._viewChange(),x.Z_),O.registerTask(A.T8.FRUSTUM_VISIBILITY,this),c.on("elevation-bounds-change",()=>this._elevationBoundsChange())]),"local"===y.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([(0,x.YP)(()=>[c.baseOpacity,c.wireframe,y.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),x.nn)])}destroy(){this.graphicsCoreOwner=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(l){this.extent=l,this.extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(l){this._isVisibleBelowSurface=l,this._setDirty(),this.extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const l=this.graphicsCoreOwner.view;this.isVisibleBelowSurface="local"===l.viewingMode||!l.basemapTerrain.opaque||l.map.ground&&l.map.ground.navigationConstraint&&"none"===l.map.ground.navigationConstraint.type}_updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const l=this.graphicsCoreOwner.view;let y;if(this._isVisibleBelowSurface)y=-.3*(0,p.Iu)(l.spatialReference).radius;else{const{min:c,max:O}=l.basemapTerrain.elevationBounds;y=c-Math.max(1,(O-c)*(1.2-1))}this.extentIntersection.update(this.extent,l.spatialReference,y)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this._updateExtentIntersection();const l=this.graphicsCoreOwner.view.frustum,y=(0,p.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(l,y))}};(0,_._)([(0,D.Cb)({readOnly:!0})],v.prototype,"suspended",void 0),(0,_._)([(0,D.Cb)({readOnly:!0})],v.prototype,"updating",void 0),v=(0,_._)([(0,s.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],v);const f=v},14752:(w,P,t)=>{t.d(P,{d:()=>o});var C,S,_=t(54024),r=t(42743);(S=C||(C={}))[S.Object=0]="Object",S[S.RenderGeometry=1]="RenderGeometry",S[S.External=2]="External",S[S.COUNT=3]="COUNT";class x{constructor(){this.items=[]}addObject(i,s){this.items.push({type:C.Object,objectStateId:s,object:i})}addRenderGeometry(i,s,p){this.items.push({type:C.RenderGeometry,objectStateId:s,renderGeometry:i,owner:p})}addExternal(i,s){this.items.push({type:C.External,objectStateId:s,remove:i})}remove(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.objectStateId===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeObject(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.type===C.Object&&p.object===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeRenderGeometry(i){for(let s=this.items.length-1;s>=0;--s){const p=this.items[s];p.type===C.RenderGeometry&&p.renderGeometry===i&&(this._removeObjectStateItem(p),this.items.splice(s,1))}}removeAll(){this.items.forEach(i=>{this._removeObjectStateItem(i)}),this.items=[]}_removeObjectStateItem(i){switch(i.type){case C.Object:i.objectStateId.channel===r.V_.Highlight?i.object.removeHighlight(i.objectStateId):i.objectStateId.channel===r.V_.MaskOccludee&&i.object.removeOcclude(i.objectStateId);break;case C.RenderGeometry:i.owner.removeRenderGeometryObjectState(i.renderGeometry,i.objectStateId);break;case C.External:i.remove(i.objectStateId)}}}class D{constructor(i,s){this.stateType=i,this.objectIdField=s,this.objectStateSet=new x,this.ids=new Set,this.paused=!1}hasGraphic(i){return this.ids.has(this.objectIdField?i.graphic.attributes[this.objectIdField]:i.graphic.uid)}}class o{constructor(i){this._graphicsCore=i,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach(i=>i.objectStateSet.removeAll()),this._stateSets=null}acquireSet(i,s){const p=new D(i,s);this._stateSets.push(p);const R=(0,_.kB)(()=>this.releaseSet(p));return{set:p,handle:R}}releaseSet(i){i.objectStateSet.removeAll();const s=this._stateSets?this._stateSets.indexOf(i):-1;-1!==s&&this._stateSets.splice(s,1)}_addObjectStateSet(i,s){i.addObjectStateSet(s.stateType,s.objectStateSet)}_removeObjectStateSet(i,s){i.removeObjectState(s.objectStateSet)}setUid(i,s){i.ids.add(s);const p=this._graphicsCore.graphics3DGraphics.get(s);p&&this._addObjectStateSet(p,i)}setUids(i,s){s.forEach(p=>this.setUid(i,p))}setObjectIds(i,s){s.forEach(p=>i.ids.add(p)),this._initializeSet(i)}addGraphic(i){this._stateSets.forEach(s=>{!s.paused&&s.hasGraphic(i)&&this._addObjectStateSet(i,s)})}removeGraphic(i){this._stateSets.forEach(s=>{s.hasGraphic(i)&&this._removeObjectStateSet(i,s)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(i=>i.objectStateSet.removeAll())}_initializeSet(i){const s=this._graphicsCore.graphics3DGraphics;i.objectIdField?s.forEach(p=>{p&&i.hasGraphic(p)&&this._addObjectStateSet(p,i)}):i.ids.forEach(p=>{const R=s.get(p);R&&this._addObjectStateSet(R,i)})}get test(){return{states:this._stateSets}}}},34675:(w,P,t)=>{t.d(P,{q:()=>y});var _=t(15861),r=t(17626),x=(t(29132),t(14517)),D=t(62208),o=t(77712),p=(t(85931),t(8314),t(90912),t(76898)),R=t(2004),A=t(58175),I=t(17253),v=t(84952),f=t(71774);const l=A.q;let y=class extends x.Z{constructor(c){super(c),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new v.Z({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this._ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}executeQueryForIdSet(c,O){var a=this;return(0,_.Z)(function*(){return a.dataQueryEngine.executeQueryForIdSet(a._ensureQueryJSON(c,O))})()}executeQueryForCount(c,O){var a=this;return(0,_.Z)(function*(){return a.dataQueryEngine.executeQueryForCount(a._ensureQueryJSON(c),O)})()}executeQueryForExtent(c,O){var a=this;return(0,_.Z)(function*(){const{count:d,extent:g}=yield a.dataQueryEngine.executeQueryForExtent(a._ensureQueryJSON(c),O);return{count:d,extent:R.Z.fromJSON(g)}})()}executeQueryForIds(c,O){var a=this;return(0,_.Z)(function*(){return a.dataQueryEngine.executeQueryForIds(a._ensureQueryJSON(c),O)})()}executeQueryForLatestObservations(c,O){var a=this;return(0,_.Z)(function*(){const d=yield a.dataQueryEngine.executeQueryForLatestObservations(a._ensureQueryJSON(c),O),g=I.default.fromJSON(d);return g.features.forEach(m=>{m.layer=a.layer,m.sourceLayer=a.layer}),g})()}executeQuery(c,O){var a=this;return(0,_.Z)(function*(){const d=yield a.dataQueryEngine.executeQuery(a._ensureQueryJSON(c),O),g=I.default.fromJSON(d);return g.features.forEach(m=>{m.layer=a.layer,m.sourceLayer=a.layer}),g})()}_ensureQueryJSON(c,O){let a=this.defaultQueryJSON;return(0,D.pC)(c)&&("outSpatialReference"in c&&!c.outSpatialReference&&(c.outSpatialReference=this.spatialReference),a=c.toJSON()),(0,D.pC)(O)&&(a={...a,sceneFilter:{...O,geometry:O.geometry.toJSON()}}),a}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const c="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,O=this.layer.objectIdField,a=f.Mk.toJSON(this.queryGeometryType),d=this.layer.fields.map(T=>T.toJSON()),g=this.layerView.view.resourceController.scheduler,m=this.priority,U=this.spatialReference.toJSON(),M=this.layerView.processor.featureStore,{hasZ:V,hasM:j}=this.layerView;return this._dataQueryEngineInstance=new l({hasZ:V,hasM:j,geometryType:a,fields:d,timeInfo:c,spatialReference:U,objectIdField:O,featureStore:M,scheduler:g,priority:m}),this._dataQueryEngineInstance}};(0,r._)([(0,o.Cb)({constructOnly:!0})],y.prototype,"layerView",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],y.prototype,"priority",void 0),(0,r._)([(0,o.Cb)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],y.prototype,"spatialReference",void 0),(0,r._)([(0,o.Cb)({readOnly:!0,aliasOf:"layerView.layer"})],y.prototype,"layer",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],y.prototype,"queryGeometryType",null),(0,r._)([(0,o.Cb)({readOnly:!0})],y.prototype,"defaultQueryJSON",null),y=(0,r._)([(0,p.j)("esri.views.3d.layers.graphics.QueryEngine")],y)},97445:(w,P,t)=>{function _(C,x,D){if(!D||null==x)return null;if(!C)return function r(C,x){const D=x.toLowerCase();for(const o in C)if(o.toLowerCase()===D)return C[o];return null}(x,D);const o=C.get(D);return o?x[o.name]:null}t.d(P,{g:()=>_})},45611:(w,P,t)=>{t.d(P,{Z:()=>f});var _=t(17626),r=t(14517),C=t(61885),x=t(80542),D=t(61996),o=t(63290),S=t(62208),i=t(60330),s=t(77712),I=(t(85931),t(8314),t(90912),t(76898));let v=class extends((0,x.p)((0,D.IG)((0,i.v)(C.Z.EventedMixin(r.Z))))){constructor(l){super(l),this.layer=null,this.parent=null}initialize(){this.when().catch(l=>{if("layerview:create-error"!==l.name){const y=this.layer&&this.layer.id||"no id",c=this.layer&&this.layer.title||"no title";o.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${c}', id: '${y}')`,l)}})}get fullOpacity(){return(0,S.Pt)(this.get("layer.opacity"),1)*(0,S.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(l){void 0!==l?this._override("visible",l):this._clearOverride("visible")}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const l=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(l.viewNotReady=!0),this.layer&&this.layer.loaded||(l.layerNotLoaded=!0),this.visible||(l.layerInvisible=!0),l}isUpdating(){return!1}};(0,_._)([(0,s.Cb)()],v.prototype,"fullOpacity",null),(0,_._)([(0,s.Cb)()],v.prototype,"layer",void 0),(0,_._)([(0,s.Cb)()],v.prototype,"parent",void 0),(0,_._)([(0,s.Cb)({readOnly:!0})],v.prototype,"suspended",null),(0,_._)([(0,s.Cb)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,_._)([(0,s.Cb)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,_._)([(0,s.Cb)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,_._)([(0,s.Cb)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,_._)([(0,s.Cb)()],v.prototype,"visible",null),(0,_._)([(0,s.Cb)()],v.prototype,"view",void 0),v=(0,_._)([(0,I.j)("esri.views.layers.LayerView")],v);const f=v}}]);