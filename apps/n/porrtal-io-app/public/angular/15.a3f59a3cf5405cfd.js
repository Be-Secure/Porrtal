"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[15],{80015:(w,h,r)=>{r.r(h),r.d(h,{default:()=>m});var l=r(17626),C=r(88879),I=r(63290),i=r(62208),E=r(32917),a=r(77712),D=(r(85931),r(8314),r(90912),r(76898)),f=r(10410),v=r(98624),P=r(59990),d=r(84952),M=r(14341),u=r(52836),F=r(19702),y=r(3493),A=r(2694),c=r(22498),p=r(52565),L=r(94443),S=r(72537),U=r(41941),g=r(42964),j=r(89476),R=r(67966),W=r(40465),T=r(57610),K=r(41632),B=r(78465),x=r(87091);const Q=I.Z.getLogger("esri.views.3d.layers.SceneLayerView3D"),O=(0,R.v)();let n=class extends((0,M.N)((0,j.l)((0,W.i)((0,F.A)(B.Z))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.lodFactor=1,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get filter(){return this._get("filter")}set filter(e){this._set("filter",c.z.checkSupport(e)?e:null)}get viewFilter(){const e=this.filter;if((0,i.Wi)(e)&&(0,i.Wi)(this.layerFilter))return null;const t=this._get("viewFilter");return(0,i.Wi)(t)?new c.z({layerFilter:this.layerFilter,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:s=>this._loadAsyncModule(s),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(s,o)=>this.addSqlFilter(s,o,this.logError)}):(t.viewFilter=this.filter,t.layerFilter=this.layerFilter,this.notifyChange("viewFilter"),t)}get requiredFields(){return this.fieldsHelper?.requiredFields??[]}get floorFilterClause(){const e=(0,P.c)(this);return(0,i.pC)(e)?f.WhereClause.create(e,this.layer.fieldsIndex):null}get excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((t,s)=>t-s):null}get lodCrossfadeinDuration(){return this.view?.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration??0}get lodCrossfadeoutDuration(){return this.view?.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration??0}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration??0}initialize(){this.fieldsHelper=new T.K({layerView:this}),this.updatingHandles.add(()=>this.layer.rangeInfos,e=>this._rangeInfosChanged(e),E.nn),this.updatingHandles.add(()=>this.layer.renderer,e=>this.updatingHandles.addPromise(this._rendererChange(e)),E.nn),this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this.filter,this.layer.filter,this.floorFilterClause,this.excludeObjectIdsSorted,(0,i.yw)(this.viewFilter,e=>[e.parsedWhereClause,e.parsedGeometry,e.sortedObjectIds])],()=>this._filterChange()),this.updatingHandles.add(()=>[this.filter,(0,i.yw)(this.viewFilter,e=>e.parsedGeometry)],()=>this._geometryFilterChange()),this.handles.add(this.layer.on("apply-edits",e=>this.updatingHandles.addPromise(e.result))),this.handles.add(this.layer.on("edits",e=>this._handleEdits(e)))}destroy(){this.fieldsHelper=(0,i.SC)(this.fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&Q.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,i.pC)(this.filter)?this.filter.createQuery(e):new d.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),t?.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),t?.signal).then(s=>{if(!s?.features)return s;const o=this.layer;for(const _ of s.features)_.layer=o,_.sourceLayer=o;return s})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),t?.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=(0,A.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new L.u({layerView:this,priority:x.T8.FEATURE_QUERY_ENGINE,spatialIndex:new U.I({featureAdapter:new S.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:e}),toArray:()=>{const t=new Array;return this._forAllFeatures((s,o,_)=>(t.push({id:s,index:o,meta:_}),u.K.CONTINUE),null,u.u.ALL_IN_CLIPPING_AREA),t},forAllFeatures:(t,s)=>this._forAllFeatures((o,_,b)=>t({id:o,index:_,meta:b}),s,u.u.ALL_IN_CLIPPING_AREA),getFeatureExtent:e,sourceSpatialReference:(0,g.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof d.Z){const{set:s,handle:o}=t.acquireSet();return this.queryObjectIds(e).then(_=>t.setFeatureIds(s,_)),o}return super.highlight(e)}createInteractiveEditSession(e){return(0,y.s)(this.attributeEditingContext,e)}_createLayerGraphic(e){const t=new C.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters(),t=this.excludeObjectIdsSorted;return(0,i.pC)(t)&&e.push(s=>(0,g.Yb)(t,!1,s)),this.floorFilterClause&&this.addSqlFilter(e,this.floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,i.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}isUpdating(){return super.isUpdating()||this.layerFilterUpdating}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,i.Wi)(e)?this.createQuery():d.Z.from(e))}get attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:e=>this._forAllNodes(t=>(0,i.pC)(t)?e(t.node,t.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){(0,y.Z)(this.attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return(0,i.pC)(e)&&(0,i.pC)(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter;return(0,i.Wi)(t)||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?p.U_.Unmodified:p.U_.Culled}};(0,l._)([(0,a.Cb)({aliasOf:"layer"})],n.prototype,"i3slayer",void 0),(0,l._)([(0,a.Cb)(K.q)],n.prototype,"updatingProgress",void 0),(0,l._)([(0,a.Cb)({type:v.Z})],n.prototype,"filter",null),(0,l._)([(0,a.Cb)({readOnly:!0})],n.prototype,"viewFilter",null),(0,l._)([(0,a.Cb)(O.requiredFields)],n.prototype,"requiredFields",null),(0,l._)([(0,a.Cb)(O.availableFields)],n.prototype,"availableFields",void 0),(0,l._)([(0,a.Cb)()],n.prototype,"fieldsHelper",void 0),(0,l._)([(0,a.Cb)()],n.prototype,"floorFilterClause",null),(0,l._)([(0,a.Cb)()],n.prototype,"excludeObjectIdsSorted",null),(0,l._)([(0,a.Cb)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],n.prototype,"lodFactor",void 0),(0,l._)([(0,a.Cb)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],n.prototype,"updatingProgressValue",void 0),n=(0,l._)([(0,D.j)("esri.views.3d.layers.SceneLayerView3D")],n);const m=n}}]);