/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[9973],{76825:(z,N,i)=>{i.d(N,{cn:()=>p,j:()=>b,lK:()=>n});const p="updating";function n(A){return"updating"===A?null:A}function b(A){return"updating"===A}},39988:(z,N,i)=>{i.r(N),i.d(N,{default:()=>_e});var p=i(15861),n=i(17626),b=i(88879),A=i(85931),T=i(63290),a=i(62208),M=i(32917),h=i(77712),W=(i(90912),i(76898)),x=i(84161),g=i(28093),y=i(55915),v=i(33190),se=i(33696),ie=i(5437),B=i(38114),oe=i(84786),ae=i(66607),ne=i(98624),Y=i(96854),de=i(42930);class J extends de.q{constructor(t){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:r=>[r.geometryBuffer]},t,{hasInitialize:!0})}}var le=i(19702),he=i(33816),ue=i(34675),X=i(3493),ce=i(86152),H=i(42964),pe=i(89476),ge=i(67966),ye=i(40465),fe=i(57610),Q=i(93605),me=i(44554),ve=i(93394),Ee=i(41632),be=i(42743),Ce=i(78465),xe=i(87091);const k=(0,ge.v)();let l=class extends((0,pe.l)((0,ye.i)((0,le.A)(Ce.Z)))){constructor(){super(...arguments),this.type="scene-layer-graphics-3d",this._nodesAddedToStage=new Map,this._queryEngine=null,this._memCache=null,this._interactiveEditingSessions=new Map,this.loadedGraphics=new me.f,this.holeFilling="always",this.progressiveLoadFactor=1,this.supportsHeightUnitConversion=!0,this._coordinatesOutsideExtentErrors=0,this._maxCoordinatesOutsideExtentErrors=20}initialize(){const e=this.layer;this.addResolvingPromise(e.indexInfo),this._i3sOverrides=new ce.v({view:this.view,layer:this.layer,memoryController:this.view.resourceController?.memoryController}),(0,H.OJ)(e,this.view.spatialReference,this.view.viewingMode),this._fieldsHelper=new fe.K({layerView:this}),this.updatingHandles.add(()=>e.rangeInfos,t=>this._rangeInfosChanged(t),M.nn),this.updatingHandles.add(()=>e.renderer,(t,r)=>this._rendererChange(t,r)),this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange()),this.handles.add((0,M.YP)(()=>Q.Z.I3S_TREE_SHOW_TILES,t=>{if(t&&!this._treeDebugger){const r=this._controller.crsIndex;Promise.all([i.e(8592),i.e(3109)]).then(i.bind(i,3109)).then(({I3STreeDebugger:s})=>{!this._treeDebugger&&Q.Z.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new s({lv:this,view:this.view,nodeSR:r}))})}else t||!this._treeDebugger||Q.Z.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},M.nn)),this._set("processor",new he.Z({owner:this,preferredUpdatePolicy:be.jq.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:e.fullExtent,updateClippingExtent:t=>this._updateClippingExtent(t)})),this.processor.elevationAlignment?.events.on("invalidate-elevation",t=>this._controller.updateElevationChanged(t.extent,t.spatialReference)),this.supportsHeightUnitConversion&&(this._verticalScale=(0,se.k)("point",e.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.initializePromise),this._memCache=this.view.resourceController.memoryController.newCache(e.uid),this._controller=new ae.Z({layerView:this,scaleVisibilityEnabled:!1}),(0,H.X5)(this.layer.geometryDefinitions)&&(this._worker=new J(t=>this.view.resourceController.schedule(t))),this.handles.add(this.layer.on("apply-edits",t=>this.updatingHandles.addPromise(t.result))),this.handles.add(this.layer.on("edits",t=>this._handleEdits(t))),this.when(()=>{const t=()=>this.processor.featureStore;this._queryEngine=new ue.q({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return t()},hasZ:this.hasZ,hasM:this.hasM},priority:xe.T8.FEATURE_QUERY_ENGINE}),this.updatingHandles.add(()=>this.maximumNumberOfFeatures,r=>this._controller.featureTarget=r,M.nn),this.updatingHandles.add(()=>this.suspended,r=>{r&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=(0,a.SC)(this._treeDebugger),this._i3sOverrides=(0,a.SC)(this._i3sOverrides),this._set("processor",(0,a.SC)(this.processor)),this._controller=(0,a.SC)(this._controller),this._queryEngine=(0,a.SC)(this._queryEngine),this._worker=(0,a.SC)(this._worker),this._memCache=(0,a.SC)(this._memCache),this._nodesAddedToStage.clear(),this._fieldsHelper=(0,a.SC)(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return!this.suspended&&!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}get _excludeObjectIdsSorted(){const e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((t,r)=>t-r):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}whenGraphicAttributes(e,t){var r=this;return(0,p.Z)(function*(){return(0,H.bf)(r.layer,e,r._getObjectIdField(),t,()=>[...r._nodesAddedToStage.values()])})()}getHit(e){if(!this.loadedGraphics)return null;const t=(0,oe.mW)(this.loadedGraphics.find(s=>s.uid===e),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,{type:"graphic",graphic:t,layer:t.layer}):null}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.processor.computeAttachmentOrigin(e,t)}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}isUpdating(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(e){return this.processor.highlight(e,this.layer.objectIdField)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(e){return(0,X.sw)(this._attributeEditingContext,e)}_extractBinaryPointData(e,t){var r=this;return(0,p.Z)(function*(){const s={geometryBuffer:e.geometryBuffer};return(0,a.Wi)(r._worker)&&(r._worker=new J(o=>r.view.resourceController.schedule(o))),r._worker.invoke(s,t).then(o=>{if((0,a.pC)(o))return{positionData:o.positions,featureIds:o.featureIds};throw new Error("Failed to decompress Draco point data")})})()}_checkExtent(e,t){e&&!(0,v.Qg)(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&T.Z.getLogger(this.declaredClass).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&T.Z.getLogger(this.declaredClass).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)}addNode(e,t,r){var s=this;return(0,p.Z)(function*(){if(!ee(t)&&!q(t))throw new Error;if(s._nodesAddedToStage.has(e.index))return void T.Z.getLogger(s.declaredClass).error("I3S node "+e.id+" already added");const o=(0,a.pC)(s.layer.fullExtent)?function De(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}(s.layer.fullExtent.clone(),.5):null,c=s._controller.crsVertex,u=[],d={graphics:null,featureIds:null,attributeInfo:t.attributeDataInfo,node:e};if(ee(t)?yield s._addNodeBinaryPointData(e,d,t,o,u,r):q(t)&&s._addNodeLegacyPointData(e,d,t,o,u),yield s._i3sOverrides.apply(d.featureIds,t.attributeDataInfo,r),e.numFeatures=d.graphics.length,s._updateNodeMemory(e),te(d),u.length>0&&(s._computeObb(e,u,c),s._controller.updateVisibility(e.index)),!s._controller.isGeometryVisible(e))return void s._cacheNodeData(d);if((0,a.pC)(s._verticalScale))for(const m of d.graphics)s._verticalScale(m.geometry);const f=s.view._stage.renderView._objectAndLayerIdRenderHelper;if(f)for(let m=0;m<d.featureIds.length;m++)f.setUidToObjectAndLayerId(d.featureIds[m],d.graphics[m].uid,s.layer.id,s.layer.uid,s.layer.popupEnabled,d.node.resources.attributes,m);s._nodesAddedToStage.set(e.index,d),s.loadedGraphics.addMany(d.graphics),s._controller.updateLoadStatus(e.index,!0),s._filterNode(d),s._treeDebugger&&s._treeDebugger.update()})()}_computeObb(e,t,r){const s=this._controller.crsIndex,o=s.isGeographic?this.view.renderSpatialReference:s;(0,y.CM)(t,r,0,t,o,0,t.length/3),e.serviceObb=(0,ve.Qb)({data:t,size:3}),s.isGeographic&&(0,y.SH)(e.serviceObb.center,o,e.serviceObb.center,s)}isNodeLoaded(e){return this._nodesAddedToStage.has(e)}isNodeReloading(){return!1}updateNodeState(){}_addNodeBinaryPointData(e,t,r,s,o,c){var u=this;return(0,p.Z)(function*(){const d=yield u._extractBinaryPointData(r,c);if(null==d)throw new Error;const f=u._getObjectIdField(),m=u._controller.crsVertex,D=u.view.spatialReference,L=u.processor.graphicsCore,{positionData:I,featureIds:F}=d,w=I.length/3,Z=new Array,V=(0,a.pC)(e.serviceObb)?e.serviceObb.center:[0,0,0],G=Math.abs(V[2])*2**-20;for(let S=0;S<w;S++){const R=3*S,E=(0,g.f)(I[R+0],I[R+1],I[R+2]);(0,x.a)(E,E,V),Math.abs(E[2])<G&&(E[2]=0),e.serviceObb||o.push(E[0],E[1],E[2]),(0,a.pC)(s)&&u._checkExtent(s,E);const j=F[S],O={};null!=j&&(O[f]=j);const re=j??b.Z.generateUID();(0,y.CM)(E,m,0,_,D,0,1);const K=(0,B.Tx)(_[0],_[1],_[2],D),U=u.loadedGraphics.get(re);if((0,a.pC)(U))U.level<e.level&&(C.property="geometry",C.graphic=U,C.oldValue=(0,a.Wg)(U.geometry),C.newValue=K,U.geometry=K,L.graphicUpdateHandler(C)),Z.push(U);else{const Se=b.Z.generateUID();Z.push({objectId:re,uid:Se,geometry:K,attributes:O,visible:!0,level:e.level})}}t.graphics=Z,t.featureIds=Array.from(F)})()}_addNodeLegacyPointData(e,t,r,s,o){const c=this._getObjectIdField(),u=this._controller.crsVertex,d=this.view.spatialReference,f=[0,0,0],m=new Array,D=new Array;for(const L of r.pointData){const I=L.featureDataPosition,F=I.length,P=L.geometries&&L.geometries[0]||Ie[F],w=L.featureIds[0];if("points"!==P.params.type)continue;(0,a.pC)(s)&&this._checkExtent(s,I);const Z={};null!=w&&(Z[c]=w);const V=w??b.Z.generateUID();let G;"Embedded"===P.type&&(G=P.params.vertexAttributes.position);for(let S=0;S<G.length;S+=F){for(let O=0;O<F;O++)f[O]=I[O]+G[S+O];const R=3===F;e.serviceObb||o.push(f[0],f[1],R?f[2]:0),(0,y.CM)(f,u,0,_,d,0,1);const E=(0,B.Tx)(_[0],_[1],R?_[2]:void 0,d),j=this.loadedGraphics.get(V);(0,a.pC)(j)?D.push(j):D.push({objectId:V,uid:b.Z.generateUID(),geometry:E,attributes:Z,visible:!0})}m.push(w)}t.graphics=D,t.featureIds=m}_updateNodeMemory(e){e.memory=4096+((0,a.pC)(e.numFeatures)?e.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(e){const t=e.graphics.reduce((r,s)=>(0,B.Xw)(s)+r,512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}_getMemCacheKey(e){return`${e.index}`}_removeAllNodeData(){this._nodesAddedToStage.forEach((e,t)=>{e&&(this._updateNodeMemory(e.node),this._cacheNodeData(e)),this._controller.updateLoadStatus(t,!1)}),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}removeNode(e){const t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}_removeNodeStageData(e){const t=this._nodesAddedToStage.get(e);return t?(this._controller.updateLoadStatus(e,!1),this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}loadCachedNodeData(e){var t=this;return(0,p.Z)(function*(){return t._memCache.pop(t._getMemCacheKey(e))})()}addCachedNodeData(e,t,r,s){var o=this;return(0,p.Z)(function*(){o._nodesAddedToStage.has(e.index)?T.Z.getLogger(o.declaredClass).error("I3S node "+e.id+" already added"):(o.loadedGraphics.addMany(t.graphics),o._nodesAddedToStage.set(e.index,t),o._controller.updateLoadStatus(e.index,!0),o._updateNodeMemory(e),yield o.updateAttributes(e.index,r,s),o._filterNode(t),o._treeDebugger&&o._treeDebugger.update())})()}getLoadedNodeIds(){const e=[];return this._nodesAddedToStage.forEach(t=>e.push(t.node.id)),e.sort()}getVisibleNodes(){const e=new Array;return this._nodesAddedToStage.forEach(t=>e.push(t.node)),e}getLoadedNodeIndices(e){this._nodesAddedToStage.forEach((t,r)=>e.push(r))}getLoadedAttributes(e){const t=this._nodesAddedToStage.get(e);if(t&&(0,a.pC)(t.attributeInfo))return t.attributeInfo.loadedAttributes}getAttributeData(e){const t=this._nodesAddedToStage.get(e);if(t&&(0,a.pC)(t.attributeInfo))return t.attributeInfo.attributeData}_setAttributeData(e,t){const r=this._nodesAddedToStage.get(e);r&&!(0,a.Wi)(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}updateAttributes(e,t,r){var s=this;return(0,p.Z)(function*(){const o=s._nodesAddedToStage.get(e);o&&(yield s._i3sOverrides.apply(o.featureIds,t,r),o.attributeInfo=t,s._attributeValuesChanged(o))})()}_attributeValuesChanged(e){if(te(e),this._filterNode(e),this.processor.graphicsCore.labelsEnabled){const t=e.graphics.map(r=>r.uid);this.processor.graphicsCore.updateLabelingInfo(t)}}_updateClippingExtent(e){return this._controller&&this._controller.updateClippingArea(e),!1}_getObjectIdField(){return this.layer.objectIdField||ie.d}_rendererChange(e,t){var r=this;return(0,p.Z)(function*(){const{layer:{fieldsIndex:s}}=r,o=new Set;let c,u;e?(yield e.collectRequiredFields(o,s),c=Array.from(o).sort()):c=[],o.clear(),t?(yield t.collectRequiredFields(o,s),u=Array.from(o).sort()):u=[],c.length===u.length&&c.every((d,f)=>c[f]===u[f])||r._reloadAllNodes()})()}_rangeInfosChanged(e){null!=e&&e.length>0&&T.Z.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this._nodesAddedToStage.forEach(e=>this._filterNode(e))}_reloadAllNodes(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}_filterNode(e){const t=this.parsedDefinitionExpression,r=this._excludeObjectIdsSorted,s=this._getObjectIdField();for(const o of e.graphics){const c=o.visible,u=!t||this._evaluateClause(t,o),d=(0,a.Wi)(r)||(0,A.$A)(r,o.attributes[s])<0;o.visible=u&&d,c!==o.visible&&(C.graphic=o,C.property="visible",C.oldValue=c,C.newValue=o.visible,this.processor.graphicsCore.graphicUpdateHandler(C))}}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return(0,a.pC)(this.filter)?this.filter.createQuery(e):new Y.Z(e)}queryFeatures(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),t?.signal)}queryObjectIds(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),t?.signal)}queryExtent(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t?.signal)}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,a.Wi)(e)?this.createQuery():Y.Z.from(e))}getUsedMemory(){return this.processor?.graphicsCore?.usedMemory??0}getUnloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}_handleEdits(e){(0,X.Z6)(this._attributeEditingContext,e)}get _attributeEditingContext(){const e=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:e,forEachNode:t=>this._nodesAddedToStage.forEach(r=>t(r.node,r.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,i3sOverrides:this._i3sOverrides,getAttributeData:t=>this.getAttributeData(t),setAttributeData:(t,r,s)=>{this._setAttributeData(t,r);const o=this._nodesAddedToStage.get(t);if((0,a.pC)(s)){const c=this.loadedGraphics.get(s.attributes[e]);(0,a.pC)(c)&&this.processor.graphicsCore.recreateGraphics([c])}else(0,a.pC)(o)&&this.processor.graphicsCore.recreateGraphics(o.graphics)},clearMemCache:()=>{}}}get performanceInfo(){const e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}get test(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}};(0,n._)([(0,h.Cb)()],l.prototype,"processor",void 0),(0,n._)([(0,h.Cb)({type:ne.Z})],l.prototype,"filter",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"loadedGraphics",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"i3slayer",null),(0,n._)([(0,h.Cb)()],l.prototype,"_controller",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"updating",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"suspended",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"holeFilling",void 0),(0,n._)([(0,h.Cb)(Ee.q)],l.prototype,"updatingProgress",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"updatingProgressValue",null),(0,n._)([(0,h.Cb)(k.requiredFields)],l.prototype,"requiredFields",null),(0,n._)([(0,h.Cb)(k.availableFields)],l.prototype,"availableFields",void 0),(0,n._)([(0,h.Cb)()],l.prototype,"_fieldsHelper",void 0),(0,n._)([(0,h.Cb)({type:Number})],l.prototype,"maximumNumberOfFeatures",null),(0,n._)([(0,h.Cb)({readOnly:!0})],l.prototype,"maximumNumberOfFeaturesExceeded",null),(0,n._)([(0,h.Cb)()],l.prototype,"_excludeObjectIdsSorted",null),(0,n._)([(0,h.Cb)({readOnly:!0})],l.prototype,"lodFactor",null),(0,n._)([(0,h.Cb)({readOnly:!0})],l.prototype,"hasM",null),(0,n._)([(0,h.Cb)({readOnly:!0})],l.prototype,"hasZ",null),l=(0,n._)([(0,W.j)("esri.views.3d.layers.SceneLayerGraphicsView3D")],l);const _e=l;function q(e){return"pointData"in e}function ee(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function te(e){const t=e.attributeInfo;for(let r=0;r<e.graphics.length;r++){const s=e.graphics[r];if(s.attributes||(s.attributes={}),(0,a.pC)(t)&&(0,a.pC)(t.loadedAttributes))for(const{name:o}of t.loadedAttributes)t.attributeData[o]&&(s.attributes[o]=(0,H.Jx)(t.attributeData[o],r))}}const Ie={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},_=(0,g.c)(),C={graphic:null,property:null,oldValue:null,newValue:null}},89476:(z,N,i)=>{i.d(N,{l:()=>$});var p=i(17626),n=i(63290),b=i(77712),a=(i(85931),i(90912),i(76898)),M=i(10410),h=i(42964);const $=W=>{let x=class extends W{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=g=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&n.Z.getLogger(this.declaredClass).error("Error while evaluating definitionExpression: "+g),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&n.Z.getLogger(this.declaredClass).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const g=M.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!g.isStandardized)return n.Z.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;const y=[];return(0,h.e8)(g.fieldNames,this.i3slayer.fields,{missingFields:y}),y.length>0?(n.Z.getLogger(this.declaredClass).error(`definitionExpression references unknown fields: ${y.join(", ")}`),null):(this._definitionExpressionErrors=0,g)}catch(g){return n.Z.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+g),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}_evaluateClause(g,y){try{return g.testFeature(y)}catch(v){return this.logError(v),!1}}_addDefinitionExpressionToQuery(g){if(!this.parsedDefinitionExpression)return g;const y=this.i3slayer.definitionExpression,v=g.clone();return v.where=v.where?`(${y}) AND (${v.where})`:y,v}};return(0,p._)([(0,b.Cb)()],x.prototype,"i3slayer",void 0),(0,p._)([(0,b.Cb)({readOnly:!0})],x.prototype,"parsedDefinitionExpression",null),(0,p._)([(0,b.Cb)({readOnly:!0})],x.prototype,"definitionExpressionFields",null),x=(0,p._)([(0,a.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],x),x}}}]);