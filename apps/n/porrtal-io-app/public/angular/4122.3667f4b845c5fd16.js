/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[4122],{34013:(At,q,a)=>{a.d(q,{I:()=>X,b:()=>ht});var _=a(62208),g=a(99770),et=a(6945),c=a(78925),D=a(24255),G=a(10109),H=a(67022),F=a(33726),x=a(2166),E=a(95285),it=a(65787),k=a(17625),ut=a(22355),Z=a(35387),dt=a(42743),N=a(16396);function ht($){const j=new ut.kG;(0,x.S)(j,$),j.include(D.w),j.attributes.add(N.T.POSITION,"vec3"),j.attributes.add(N.T.UV0,"vec2"),j.varyings.add("vpos","vec3"),$.hasMultipassTerrain&&j.varyings.add("depth","float");const{vertex:ct,fragment:U}=j;return ct.uniforms.add(new E.A("textureCoordinateScaleFactor",m=>(0,_.pC)(m.texture)&&(0,_.pC)(m.texture.descriptor.textureCoordinateScaleFactor)?m.texture.descriptor.textureCoordinateScaleFactor:g.O)),ct.code.add(k.H`
    void main(void) {
      vpos = position;
      ${$.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),j.include(c.f5,$),j.include(G.l,$),U.uniforms.add([new Z.A("tex",m=>m.texture),new it.p("opacity",m=>m.opacity)]),j.varyings.add("vTexCoord","vec2"),$.output===et.H.Alpha?U.code.add(k.H`
    void main() {
      discardBySlice(vpos);
      ${$.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${k.H.float(H.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(U.include(F.Y),U.code.add(k.H`
    void main() {
      discardBySlice(vpos);
      ${$.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${k.H.float(H.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${$.transparencyPassType===dt.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),j}const X=Object.freeze(Object.defineProperty({__proto__:null,build:ht},Symbol.toStringTag,{value:"Module"}))},30750:(At,q,a)=>{a.d(q,{S:()=>F,b:()=>H});var _=a(2166),g=a(69960),et=a(65787),c=a(17625),D=a(22355),G=a(16396);function H(x){const E=new D.kG;return E.extensions.add("GL_OES_standard_derivatives"),(0,_.S)(E,x),E.attributes.add(G.T.POSITION,"vec3"),E.attributes.add(G.T.UV0,"vec2"),E.varyings.add("vUV","vec2"),E.vertex.code.add(c.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),E.fragment.uniforms.add([new g.N("backgroundColor",it=>it.backgroundColor),new g.N("gridColor",it=>it.gridColor),new et.p("gridWidth",it=>it.gridWidth)]),E.fragment.code.add(c.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),E}const F=Object.freeze(Object.defineProperty({__proto__:null,build:H},Symbol.toStringTag,{value:"Module"}))},40405:(At,q,a)=>{a.d(q,{B:()=>ht});var _=a(15861),g=a(62208),et=a(22558),c=a(21726),D=a(35948),G=a(34117),H=a(31283),F=a(77712);function x(f){return k[function E(f){return f instanceof Blob?f.type:function it(f){const y=(0,c.Ml)(f);return dt[y]||ut}(f.url)}(f)]||Z}const k={},ut="text/plain",Z=k[ut],dt={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const f in dt)k[dt[f]]=f;var N=a(29840);function ht(f){const y=(0,g.pC)(f)&&f.origins?f.origins:[void 0];return(l,P)=>{const R=function X(f,y,l){if((0,g.pC)(f)&&"resource"===f.type)return function $(f,y,l){const P=(0,G.VZ)(y,l);return{type:String,read:(R,L,T)=>{const S=(0,N.r)(R,L,T);return P.type===String?S:"function"==typeof P.type?new P.type({url:S}):void 0},write:{writer(R,L,T,S){if(!S||!S.resources)return"string"==typeof R?void(L[T]=(0,N.t)(R,S)):void(L[T]=R.write({},S));const yt=function vt(f){return(0,g.Wi)(f)?null:"string"==typeof f?f:f.url}(R),p=yt?(0,N.t)(yt,{...S,verifyItemRelativeUrls:S&&S.verifyItemRelativeUrls?{writtenUrls:S.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},N.M.NO):null,K=P.type!==String&&(!(0,et.l)(this)||S&&S.origin&&this.originIdOf(l)>(0,H.M9)(S.origin));S&&S.portalItem&&(0,g.pC)(p)&&!(0,c.YP)(p)?K?function ct(f,y,l,P,R,L,T,S){const yt=T.portalItem.resourceFromPath(P),p=Tt(l,P,T);x(p)===(0,c.Ml)(yt.path)?(m(f,y,yt,p,T.resources.toUpdate),R[L]=P):j(f,y,l,P,R,L,T,S)}(this,l,R,p,L,T,S,f):function U(f,y,l,P){P.resources.toKeep.push({resource:P.portalItem.resourceFromPath(f)}),y[l]=f}(p,L,T,S):S&&S.portalItem&&((0,g.Wi)(p)||(0,g.pC)((0,N.i)(p))||(0,c.jc)(p)||K)?j(this,l,R,p,L,T,S,f):L[T]=p}}}}(f,y,l);switch((0,g.pC)(f)&&f.type?f.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:P,write:R}=N.p;return{read:P,write:R}}}}(f,l,P);for(const L of y){const T=(0,F.CJ)(l,L,P);for(const S in R)T[S]=R[S]}}}function j(f,y,l,P,R,L,T,S){const yt=(0,D.D)(),p=Tt(l,P,T),K=(0,c.v_)((0,g.U2)(S,"prefix"),yt),Rt=`${K}.${x(p)}`,Ct=T.portalItem.resourceFromPath(Rt);(0,c.jc)(P)&&T.resources.pendingOperations.push(function at(f){return pt.apply(this,arguments)}(P).then(Kt=>{Ct.path=`${K}.${x(Kt)}`,R[L]=Ct.itemRelativeUrl}).catch(()=>{})),m(f,y,Ct,p,T.resources.toAdd),R[L]=Ct.itemRelativeUrl}function m(f,y,l,P,R){R.push({resource:l,content:P,finish:L=>{!function W(f,y,l){"string"==typeof f[y]?f[y]=l.url:f[y].url=l.url}(f,y,L)}})}function Tt(f,y,l){return"string"==typeof f?{url:y}:new Blob([JSON.stringify(f.toJSON(l))],{type:"application/json"})}function pt(){return(pt=(0,_.Z)(function*(f){const y=(yield Promise.resolve().then(a.bind(a,84792))).default,{data:l}=yield y(f,{responseType:"blob"});return l})).apply(this,arguments)}},22558:(At,q,a)=>{function _(g){return g&&"getAtOrigin"in g&&"originOf"in g}a.d(q,{l:()=>_})},60595:(At,q,a)=>{a.d(q,{T:()=>D});var _=a(15861),g=a(84792),et=a(26584),c=a(62208);function D(H,F,x,E,it,k){return G.apply(this,arguments)}function G(){return(G=(0,_.Z)(function*(H,F,x,E,it,k){let ut=null;if((0,c.pC)(x)){const N=`${H}/nodepages/`,ht=N+Math.floor(x.rootIndex/x.nodesPerPage);try{return{type:"page",rootPage:(yield(0,g.default)(ht,{query:{f:"json",token:E},responseType:"json",signal:k})).data,rootIndex:x.rootIndex,pageSize:x.nodesPerPage,lodMetric:x.lodSelectionMetricType,urlPrefix:N}}catch(X){(0,c.pC)(it)&&it.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",ht,X),ut=X}}if(!F)return null;const Z=`${H}/nodes/`,dt=Z+(F&&F.split("/").pop());try{return{type:"node",rootNode:(yield(0,g.default)(dt,{query:{f:"json",token:E},responseType:"json",signal:k})).data,urlPrefix:Z}}catch(N){throw new et.Z("sceneservice:root-node-missing","Root node missing.",{pageError:ut,nodeError:N,url:dt})}})).apply(this,arguments)}},95680:(At,q,a)=>{a.r(q),a.d(q,{default:()=>va});var _=a(15861),g=a(17626),et=a(14517),c=a(62208),D=a(77712),H=(a(85931),a(8314)),F=a(90912),x=a(76898),E=a(1437),k=(a(29132),a(79608)),ut=a(23719),Z=a(86810),dt=a(66656),N=a(40405),ht=a(49672);let X=class extends((0,k.J)(Z.wq)){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&(0,c._W)(this.position,t.position)&&this.width===t.width&&this.height===t.height}};(0,g._)([(0,D.Cb)({readOnly:!0,json:{read:!1,write:!0}})],X.prototype,"type",void 0),(0,g._)([(0,D.Cb)({type:ht.Z}),(0,N.B)()],X.prototype,"position",void 0),(0,g._)([(0,D.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,N.B)(),(0,dt.p)(t=>ut.BV.normalize((0,F.q9)(t),0,!0))],X.prototype,"heading",void 0),(0,g._)([(0,D.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,N.B)(),(0,dt.p)(t=>ut.BV.normalize((0,F.q9)(t),0,!0))],X.prototype,"tilt",void 0),(0,g._)([(0,D.Cb)({type:Number,nonNullable:!0}),(0,N.B)()],X.prototype,"width",void 0),(0,g._)([(0,D.Cb)({type:Number,nonNullable:!0}),(0,N.B)()],X.prototype,"height",void 0),X=(0,g._)([(0,x.j)("esri.analysis.SlicePlane")],X);const $=X;var j=a(72392),ct=a(63290),U=a(32917),m=a(41743),Tt=a(44917),at=a(49410),pt=a(21286),vt=a(23841),W=a(28347),f=a(43703),y=a(48977),l=a(84161),P=a(28093),R=a(55915),L=a(78172),T=a(90014),S=a(70562),yt=a(34054),p=a(26242),K=a(4794);const Rt=(0,H.Z)("mac")?"Meta":"Control",Ct="Shift",Ge=Math.cos((0,pt.Vl)(45)),ne=Math.cos((0,pt.Vl)(5)),St=(0,P.f)(1,.5,0),Vt=(0,K.b)([...St,.7]),_t=[0,0,0,.04],le=(0,K.b)([...St,.5]),Ze=(0,K.b)([...St,1]),Ye=(0,K.f)(1,1,1,1),Xe=(0,K.f)(1,.8,.6,1),Je=(0,K.f)(1,.93,.86,1),ke=(0,K.b)([...St,1]),$e=(0,K.b)([...St,1]),ii=(0,K.b)([...St,1]);var ge=a(54865),Zt=a(45403),ve=a(35754),hi=a(87469),ye=a(993),ci=a(53928),ft=a(57521),lt=a(40723),ui=a(6945),pi=a(87601),gi=a(60881),vi=a(5894),fe=a(60909),yi=a(57623),fi=a(17625),mi=a(651),Pi=a(91056),Mi=a(39114),Di=a(12407),Ci=a(30750),Wt=a(67969),Yt=a(2078);class wi extends fi.K{constructor(){super(...arguments),this.backgroundColor=(0,K.f)(1,0,0,.5),this.gridColor=(0,K.f)(0,1,0,.5),this.gridWidth=4}}class Ut extends Pi.A{initializeProgram(e){const i=Ut.shader.get().build(this.configuration);return new Di.$(e.rctx,i,Mi.i)}initializePipeline(){return(0,Yt.sm)({blending:(0,Yt.wK)(Wt.zi.ONE,Wt.zi.ONE,Wt.zi.ONE_MINUS_SRC_ALPHA,Wt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Wt.wb.LESS},colorWrite:Yt.BK})}}Ut.shader=new mi.J(Ci.S,()=>a.e(5175).then(a.bind(a,15175)));class Ai extends lt.F5{constructor(e){super(e,new Ei),this._config=new pi.m}intersect(e,i,s,d,h,u,v){return(0,yi.Bw)(e,i,d,h,u,void 0,v)}createBufferWriter(){return new fe.G_(fe.W1)}requiresSlot(e){return e===vi.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(e){return e.output===ui.H.Color?new Ti(e):null}getConfiguration(){return this._config}}class Ti extends gi.Z{constructor(e){super(e),this.ensureTechnique(Ut,null)}beginSlot(){return(0,c.Wg)(this.technique)}}class Ei extends wi{constructor(){super(...arguments),this.renderOccluded=lt.yD.Occlude}}class bi extends ci._{constructor(e){super(e),this._material=null,this._renderOccluded=lt.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,K.f)(1,0,0,1),this._backgroundColor=(0,K.f)(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){(0,ye.c)(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){(0,ye.c)(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new Ai(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){(0,c.pC)(this._material)&&e(this._material)}createGeometries(e){if((0,c.pC)(this._material)){const i=ft.Z.createSquareGeometry();e.addGeometry(i,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){(0,c.pC)(this._material)&&this._material.setParameters(this.materialParameters)}}var me=a(60011),Pe=a(26046),Ht=a(42743),Oi=a(52107),zt=a(16396),Nt=a(92972),Si=a(79967),Xt=a(49580),Vi=a(92222),tt=a(33786);a(2004);const _i=ct.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Me(t,e){return(0,ve.Aq)(t.basis1,t.basis2,t.origin,e)}function De(t,e,i,s){const d=e.worldUpAtPosition(t.origin,p.WM.get()),h=p.WM.get();switch(i){case It.HEADING:(0,l.c)(h,d);break;case It.TILT:(0,l.c)(h,t.basis1)}return(0,T.Yq)(t.origin,h,s)}var Mt,t;function Jt(t,e){switch(e){case Mt.POSITIVE_X:return{basis:t.basis1,direction:1,position:(0,l.a)(p.WM.get(),t.origin,t.basis1),edge:e};case Mt.POSITIVE_Y:return{basis:t.basis2,direction:1,position:(0,l.a)(p.WM.get(),t.origin,t.basis2),edge:e};case Mt.NEGATIVE_X:return{basis:t.basis1,direction:-1,position:(0,l.b)(p.WM.get(),t.origin,t.basis1),edge:e};case Mt.NEGATIVE_Y:return{basis:t.basis2,direction:-1,position:(0,l.b)(p.WM.get(),t.origin,t.basis2),edge:e}}}function Ce(t,e,i){const s=i.projectToRenderScreen((0,l.a)(p.WM.get(),t,e),(0,vt.Wv)(p.WM.get())),d=i.projectToRenderScreen((0,l.b)(p.WM.get(),t,e),(0,vt.Wv)(p.WM.get()));return(0,l.p)((0,l.b)(s,s,d))}function we(t){const e=(0,l.l)(t.basis1),i=(0,l.l)(t.basis2);return.3*Math.min(e,i)}function kt(t){return we(t)}function $t(t){return 0!==t.direction[0]&&0!==t.direction[1]}function Ae(t,e){const i=new Si.j({transparent:!0,writeDepth:!1,textureId:e.id,renderOccluded:lt.yD.Opaque}),s=40,h=27*1.1,u=C=>{const B=new Uint32Array([0,1,2,2,3,0]);return new Oi.Z([[zt.T.POSITION,{size:3,data:[s-C,-C,0,s+C,-C,0,s+C,C,0,s-C,C,0],exclusive:!0}],[zt.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[zt.T.POSITION,B],[zt.T.UV0,B]])},v=ft.Z.createPolylineGeometry([[0,0,0],[13,0,0]]),w=ft.Z.createPolylineGeometry([[0,0,0],[s-h,0,0]]),O=new Xt.Y({color:Ze,renderOccluded:lt.yD.OccludeAndTransparent}),A=[{geometry:u(27),material:i,stateMask:tt.Q9.Unfocused|J},{geometry:v,material:O,stateMask:tt.Q9.Unfocused|J},{geometry:u(h),material:i,stateMask:tt.Q9.Focused|J},{geometry:w,material:O,stateMask:tt.Q9.Focused|J}];return new Zt.Z({view:t,renderObjects:A,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[s,0,0]},collisionPriority:1,radius:13.5,state:J})}function Te(t){return new hi.r({view:t,attached:!0,color:Vt,width:1,writeDepthEnabled:!1,renderOccluded:lt.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Ee(t){return new bi({view:t,attached:!0,backgroundColor:[..._t],gridColor:le,gridWidth:4,renderOccluded:lt.yD.OccludeAndTransparent})}function Ki(t,e,i){const s=[];if((0,c.pC)(e))s.push([t,e.thickness/2],[-t,e.thickness/2],[-t,-e.thickness/2],[t,-e.thickness/2]);else for(let h=0;h<12;h++){const u=h/12*2*Math.PI;s.push([Math.cos(u)*t,Math.sin(u)*t])}return ft.Z.createPathExtrusionGeometry(s,i,[],[],!1)}function be(t,e,i,s=new $){if((0,c.Wi)(t))return null;const{renderCoordsHelper:d}=e,h=d.fromRenderCoords(t.origin,e.spatialReference);if((0,c.Wi)(h))return null;const u=(0,R.fM)(h,i);if((0,c.Wi)(u))return null;s.position=u;const v=d.worldUpAtPosition(t.origin,p.WM.get()),w=d.worldBasisAtPosition(t.origin,L.R.Y,p.WM.get()),O=2*(0,l.l)(t.basis1),A=2*(0,l.l)(t.basis2),C=me.Z.renderUnitScaleFactor(e.spatialReference,i);return s.width=O*C,s.height=A*C,s.tilt=(0,pt.BV)(qt(t,v)),s.heading=(0,pt.BV)(function Xi(t,e,i){return(0,yt.cp)(t.basis1,i,e)-Et}(t,v,w)),s}function qt(t,e){return(0,yt.cp)(e,t.basis2,t.basis1)+Et}(t=Mt||(Mt={}))[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y";const J=tt.jg.Custom1;var It,gt;(function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"})(It||(It={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(gt||(gt={}));const jt=tt.jg.Custom2,Bt=(0,S.Ue)(),Et=Math.PI/2,te=tt.jg.Custom1,$i=tt.jg.Custom2;var Gt;function qi(t){return(0,c.pC)("building-scene-3d"===t.type?t:null)}!function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Gt||(Gt={}));var ta=a(61779);const ee=ct.Z.getLogger("esri.views.3d.analysis.Slice.SliceController");let Dt=class extends et.Z{constructor(t){super(t),this._handles=new j.Z,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",t=>{const e=t.item;null!=e&&(e instanceof Tt.Z||e instanceof at.Z)?e instanceof Tt.Z&&(0,ta.xk)(e)?(ee.error("excludedLayers",`Layer '${e.title}, id:${e.id}' of type '${e.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),t.preventDefault()):this.analysis.excludedLayers.includes(e)&&t.preventDefault():(ee.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),t.preventDefault())})),function ia(t,e){bt.has(t)||bt.set(t,{all:[],activeController:null}),bt.get(t).all.push(e)}(this.view,this),this._handles.add([(0,U.YP)(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),(0,U.YP)(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),(0,U.YP)(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),(0,U.YP)(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([(0,U.YP)(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){"destroyed"!==this.state&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function aa(t,e){if(!bt.has(t))throw new Error("view expected in global slice register");const i=bt.get(t),s=i.all.lastIndexOf(e);if(-1===s)throw new Error("controller expected in global slice register");i.all.splice(s,1),0===i.all.length&&bt.delete(t)}(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"))}whenReady(){var t=this;return(0,_.Z)(function*(){return yield(0,U.N1)(()=>t.ready),t})()}get _allLayerAndSubLayerViews(){const t=this.view.allLayerViews.items;return t.concat(t.filter(qi).flatMap(({sublayerViews:e})=>e.items))}_updateBoundedPlaneFromSlicePlane(){const t=this.analysis.shape,e=this._currentSlicePlane;if((0,c.Wi)(e)&&(0,c.Wi)(t)||(0,c.pC)(e)&&(0,c.pC)(t)&&t.equals(e))return;let i=null,s=null;if((0,c.pC)(t)&&(0,c.pC)(t.position)){const d=t.position.spatialReference,h=function Oe(t,e){if((0,c.Wi)(t)||(0,c.Wi)(t.position))return null;const i=(0,ge.G)(t.position,e.spatialReference,e.elevationProvider);if((0,c.Wi)(i))return null;const s=me.Z.renderUnitScaleFactor(t.position.spatialReference,e.spatialReference);return{position:i,heading:t.heading,tilt:t.tilt,renderWidth:t.width*s,renderHeight:t.height*s}}(t,this.view);(0,c.Wi)(h)&&(0,ge.e)(this.analysis,d,ee),i=function Se(t,e,i,s=(0,m.c)()){if((0,c.Wi)(t))return null;const d=function Ji(t,e,i,s,d,h,u=(0,m.c)()){return h.toRenderCoords(t,u.origin)?(h.worldBasisAtPosition(u.origin,L.R.X,u.basis1),h.worldBasisAtPosition(u.origin,L.R.Y,u.basis2),(0,T.my)(u.basis2,u.basis1,u.origin,u.plane),(0,m.r)(u,-(0,pt.Vl)(e),(0,m.n)(u),u),(0,m.r)(u,(0,pt.Vl)(i),u.basis1,u),(0,l.g)(u.basis1,u.basis1,s/2),(0,l.g)(u.basis2,u.basis2,d/2),(0,m.u)(u),u):(_i.error(`Failed to project slice plane position, projection from ${t.spatialReference.wkid} is not supported`),null)}(t.position,t.heading,t.tilt,t.renderWidth,t.renderHeight,e.renderCoordsHelper,s);return!i.tiltEnabled&&(0,c.pC)(d)&&function Wi(t,e,i){const s=e.worldUpAtPosition(t.origin,p.WM.get()),d=t.basis1,h=qt(t,s),u=Math.round(h/Et)*Et;(0,m.r)(t,u-h,d,i)}(d,e.renderCoordsHelper,d),d}(h,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,m.c)()),(0,c.pC)(i)&&(s={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height})}this._currentSlicePlane=s,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=be(this.analysisViewData.plane,this.view,this.view.spatialReference,new $);let i=null;(0,c.pC)(e)&&(i={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=e,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(ie)return;const t=Ve(this.view);if(this.analysisViewData.active)(0,c.pC)(t.activeController)&&t.activeController!==this?(ie=!0,t.activeController.analysisViewData.active=!1,ie=!1):(0,c.pC)(t.activeController),this._updateLayerViews(),t.activeController=this;else{if((0,c.pC)(t.activeController)&&t.activeController!==this)return;(0,c.pC)(t.activeController)&&t.activeController===this&&(t.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&function ea(t){const e=Ve(t).activeController;t.slicePlane=(0,c.pC)(e)&&(0,c.pC)(e.analysisViewData.plane)&&e.analysisViewData.visible?e.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const t=(0,c.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,e=[],i=s=>{"layers"in s?s.layers.forEach(i):e.push(s)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(s=>{s.destroyed||("slicePlaneEnabled"in s&&(s.slicePlaneEnabled=t&&!e.includes(s.layer)),"sublayerViews"in s&&s.sublayerViews.forEach(d=>{d.slicePlaneEnabled=t&&!e.includes(d.sublayer)}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=t&&!this.analysis.excludeGroundSurface)}};(0,g._)([(0,D.Cb)({readOnly:!0})],Dt.prototype,"state",void 0),(0,g._)([(0,D.Cb)()],Dt.prototype,"view",void 0),(0,g._)([(0,D.Cb)()],Dt.prototype,"analysis",void 0),(0,g._)([(0,D.Cb)()],Dt.prototype,"analysisViewData",void 0),(0,g._)([(0,D.Cb)()],Dt.prototype,"ready",null),(0,g._)([(0,D.Cb)()],Dt.prototype,"_allLayerAndSubLayerViews",null),Dt=(0,g._)([(0,x.j)("esri.views.3d.analysis.Slice.SliceController")],Dt);const bt=new Map;let ie=!1;function Ve(t){return bt.get(t)}var sa=a(84244),na=a(50618);const _e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",Ie="data:image/png;base64,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";var Re=a(81695);const We={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};var ae,Ft=a(8859),la=a(62483),da=a(67857),ha=a(58997),Qt=a(30260),Lt=a(41900);let st=ae=class extends ha.f{constructor(t){super(t),this.clock=sa.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new j.Z,this._viewHandles=new j.Z,this._frameTask=null,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,m.c)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,vt.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,la.Z8)(t.view.state.viewingMode),this._intersector.options.store=da.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this.rotateHeadingImage=function ra(t){return t.fromData(_e,()=>new Re.x(_e,We))}(this.view.toolViewManager.textures),this.rotateTiltImage=function oa(t){return t.fromData(Ie,()=>new Re.x(Ie,We))}(this.view.toolViewManager.textures);const t=i=>{this._updateManipulatorsInteractive(i),i.grabbing||((0,c.pC)(this.analysisViewData.plane)&&(0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=function Gi(t,e=Gt.CENTER_ON_ARROW){const i=e===Gt.CENTER_ON_CALLOUT?40:0,s=[(0,P.f)(i,0,-24),(0,P.f)(i,0,24)],d=function Zi(t,e){const i=(0,l.b)((0,P.c)(),t[t.length-1],t[t.length-2]);if((0,l.n)(i,i),(0,l.g)(i,i,12),(0,l.a)(i,i,t[t.length-1]),e){const s=(0,l.b)((0,P.c)(),t[0],t[1]);return(0,l.n)(s,s),(0,l.g)(s,s,12),(0,l.a)(s,s,t[0]),[s,...t,i]}return[...t,i]}(s,!0),h=(b,Y)=>function Qi(t,e,i){const s=d=>{const h=(d?e:t).slice(0),u=(0,l.b)(p.WM.get(),h[0],h[1]);(0,l.n)(u,u);const v=(0,l.b)(p.WM.get(),h[h.length-1],h[h.length-2]);if((0,l.n)(v,v),i.padding>0){const ot=(0,l.g)((0,P.c)(),v,-i.padding);if(h[h.length-1]=(0,l.a)(ot,ot,h[h.length-1]),i.bothEnds){const wt=(0,l.g)((0,P.c)(),u,-i.padding);h[0]=(0,l.a)(wt,wt,h[0])}}const w=d?i.tipFocusMultiplier:1,O=i.tipLength*(i.focusTipLength?w:1),A=i.tipRadius*w,C=(0,W.i)(p.MP.get());if(i.padding>0){const ot=O/4,wt=(0,l.s)(p.WM.get(),0,ot,0),Ot=1+i.padding/ot;(0,W.j)(C,C,wt),(0,W.h)(C,C,(0,l.s)(p.WM.get(),Ot,Ot,Ot)),(0,W.j)(C,C,(0,l.g)(wt,wt,-1/Ot))}const B=(0,W.i)((0,f.c)()),nt=(0,P.f)(0,1,0),Q=(0,W.k)((0,f.c)(),(0,y.r)(p.vD.get(),nt,v));Q[12]=h[h.length-1][0],Q[13]=h[h.length-1][1],Q[14]=h[h.length-1][2],(0,W.m)(Q,Q,C);const b=[{part:"tube",geometry:Ki(i.tubeRadius*(d?i.tubeFocusMultiplier:1)+i.padding,i.flat,h),transform:B}];let Y,rt;if((0,c.pC)(i.flat)?Y=ft.Z.createExtrudedTriangle(O,A,A,i.flat.thickness):(Y=ft.Z.createConeGeometry(O,A,24,!1,!1,!0),rt=ft.Z.createConeGeometry(O,A,24,!1,!0,!1)),b.push({part:"tip",geometry:Y,transform:Q}),rt&&b.push({part:"cap",geometry:rt,transform:Q}),i.bothEnds){const ot=(0,W.k)((0,f.c)(),(0,y.r)(p.vD.get(),nt,u));ot[12]=h[0][0],ot[13]=h[0][1],ot[14]=h[0][2],(0,W.m)(ot,ot,C),b.push({part:"tip",geometry:Y,transform:ot}),rt&&b.push({part:"cap",geometry:rt,transform:ot})}return b};return{normal:s(!1),focused:s(!0)}}(s,s,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:b,bothEnds:!0,flat:null,focusTipLength:!0,addCap:Y}),u=h(0,!1),v=h(2.25,!0),w=new Nt.E({color:Ye,cullFace:Ht.Vr.Back,renderOccluded:lt.yD.Opaque}),O=new Nt.E({color:Xe,cullFace:Ht.Vr.Back,renderOccluded:lt.yD.Opaque}),A=new Nt.E({color:Je,cullFace:Ht.Vr.Back,renderOccluded:lt.yD.Opaque}),C=new Nt.E({color:$e,transparent:!0,writeDepth:!1,cullFace:Ht.Vr.Front,renderOccluded:lt.yD.Transparent}),B=ft.Z.createPolylineGeometry([[i,0,0],[i-40,0,0]]),nt=ft.Z.createPolylineGeometry([[i,0,0],[i-40,0,0]]),Q=new Xt.Y({color:ke,renderOccluded:lt.yD.OccludeAndTransparent});return new Zt.Z({view:t,renderObjects:[...u.normal.map(({part:b,geometry:Y,transform:rt})=>({geometry:Y,material:"tip"===b?w:"cap"===b?O:A,transform:rt,stateMask:tt.Q9.Unfocused|J})),...v.normal.map(({geometry:b,transform:Y})=>({geometry:b,material:C,transform:Y,stateMask:tt.Q9.Unfocused|J})),{geometry:B,material:Q,stateMask:tt.Q9.Unfocused|J|jt},...u.focused.map(({part:b,geometry:Y,transform:rt})=>({geometry:Y,material:"tip"===b?w:"cap"===b?O:A,transform:rt,stateMask:tt.Q9.Focused|J})),...v.focused.map(({geometry:b,transform:Y})=>({geometry:b,material:C,transform:Y,stateMask:tt.Q9.Focused|J})),{geometry:nt,material:Q,stateMask:tt.Q9.Focused|J|jt}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[d]},collisionPriority:1,radius:11,state:J})}(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",i=>{this._onShiftGrab(i),t(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=Ae(this.view,this.rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",i=>{this._onRotateHeadingGrab(i),t(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=Ae(this.view,this.rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",i=>{this._onRotateTiltGrab(i),t(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((i,s)=>{const d=function Fi(t,e){const i=$t(e),s=i?[(0,P.f)(1,0,0),(0,P.f)(0,0,0),(0,P.f)(0,1,0)]:[(0,P.f)(1,0,0),(0,P.f)(-1,0,0)],d=ft.Z.createPolylineGeometry(s),h=ii,w=i?4:1,O=2*w,C=Q=>Q>1?(Q=>new Vi.U({color:h,width:Q,renderOccluded:lt.yD.OccludeAndTransparent}))(Q):new Xt.Y({color:h,renderOccluded:lt.yD.OccludeAndTransparent}),B=[{geometry:d,material:C(w),stateMask:tt.Q9.Unfocused|te},{geometry:d,material:C(O),stateMask:tt.Q9.Focused|te},{geometry:d,material:C(1),stateMask:$i}],nt=new Zt.Z({view:t,renderObjects:B,collisionType:{type:"line",paths:[s]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4});return nt.state=te,nt}(this.view,i);return d.events.on("grab-changed",h=>{this._onResizeGrab(h,s),t(d)}),this._handles.add(this._createResizeDragPipeline(d)),d}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Ee(this.view),this._previewPlaneOutlineVisualElement=Te(this.view),this._previewPlaneOutlineVisualElement.width=2,this._handles.add((0,U.YP)(()=>this.analysisViewData.plane,()=>this._updateManipulators(),U.Z_));const e=(0,U.YP)(()=>this.state,i=>{"sliced"===i&&this.finishToolCreation()},U.tX);this._handles.add([e,(0,U.YP)(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this.rotateHeadingImage=(0,c.RY)(this.rotateHeadingImage),this.rotateTiltImage=(0,c.RY)(this.rotateTiltImage),this._handles=(0,c.SC)(this._handles),this._viewHandles=(0,c.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,c.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,c.SC)(this._previewPlaneGridVisualElement)}get state(){const t=!!this.analysisViewData.plane,e=!!this.inputState;return t?t&&e?"slicing":t&&!e?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,c.pC)(this._creatingPointerId)?"grabbing":null}set analysis(t){if(null==t)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",t)}get inputState(){return this._get("inputState")}set inputState(t){this._set("inputState",t),this.analysisViewData.showGrid=(0,c.pC)(t)&&"resize"===t.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,c.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,c.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,c.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(t){this.shiftManipulator&&(this._updateManipulators(),t||this._clearPointerMoveTimeout())}onInputEvent(t){switch(t.type){case"pointer-drag":if(!se(t))return;this._isPlacingSlicePlane?this._onClickPlacePlane(t)&&t.stopPropagation():this._onPointerDrag(t)&&t.stopPropagation();break;case"pointer-move":this._onPointerMove(t);break;case"pointer-up":this._onPointerUp(t)&&t.stopPropagation();break;case"immediate-click":if(!se(t))return;this._onClickPlacePlane(t)&&t.stopPropagation();break;case"click":if(!se(t))return;this._onClickExcludeLayer(t)&&t.stopPropagation();break;case"drag":this.inputState&&t.stopPropagation();break;case"key-down":this._onKeyDown(t)&&t.stopPropagation();break;case"key-up":this._onKeyUp(t)&&t.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.editable}_onPointerDrag(t){const e=this.inputState;if(t.pointerId===this._creatingPointerId&&(0,c.pC)(e)&&"shift"===e.type){const i=(0,Lt.vT)(t);return this.shiftManipulator.events.emit("drag",{action:e.hasBeenDragged?"update":"start",pointerType:t.pointerType,start:i,screenPoint:i}),e.hasBeenDragged=!0,!0}return!1}_onPointerMove(t){this._lastCursorPosition.x=t.x,this._lastCursorPosition.y=t.y,this._resetPointerMoveTimeout(),"touch"!==t.pointerType&&this._updatePreviewPlane((0,Lt.vT)(t),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(t){if(t.pointerId===this._creatingPointerId&&(0,c.pC)(this.analysisViewData.plane)){const e=(0,Lt.vT)(t);return this.shiftManipulator.events.emit("drag",{action:"end",start:e,screenPoint:e}),(0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(t){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const e=(0,Lt.vT)(t),i=(0,m.c)();if(this._pickPlane(e,!1,this._activeKeyModifiers,i)){if((0,m.a)(i,this._startPlane),this.analysis.shape=be(i,this.view,this.view.spatialReference,new $),"pointer-drag"===t.type){const s=this._calculatePickRay(e);this.inputState=Le(s,t.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(t){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,Lt.vT)(t)).then(e=>{if(e.results.length){const i=e.results[0],s="graphic"===i?.type&&i.graphic;if(s){const d=s.sourceLayer||s.layer;d&&this.analysis.excludedLayers.push(d)}}else e.ground.layer?this.analysis.excludedLayers.push(e.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),0))}_onKeyDown(t){return(t.key===Ct||t.key===Rt)&&(this._activeKeyModifiers[t.key]=!0,(0,c.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(t){return!(t.key!==Ct&&t.key!==Rt||!this._activeKeyModifiers[t.key]||(delete this._activeKeyModifiers[t.key],(0,c.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(t){if("start"!==t.action||(0,c.Wi)(this.analysisViewData.plane))return;const e=this._calculatePickRay(t.screenPoint);(0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState=Le(e,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(t){return(0,Qt.Xd)(t,(e,i,s)=>{const d=this.inputState;if((0,c.Wi)(d)||"shift"!==d.type)return;const h=(0,c.pC)(this.analysisViewData.plane)?(0,m.a)(this.analysisViewData.plane,(0,m.c)()):null;i.next((0,Ft._N)(this.view,d.shiftPlane)).next(this._shiftDragAdjustSensitivity(d)).next(this._shiftDragUpdatePlane(d)),s.next(()=>{(0,c.pC)(h)&&this._updateBoundedPlane(h)})})}_shiftDragAdjustSensitivity(t){return e=>{if((0,c.Wi)(this.analysisViewData.plane))return null;const s=Math.min((1-Math.abs((0,l.e)((0,m.n)(this.analysisViewData.plane),e.ray.direction)/(0,l.l)(e.ray.direction)))/.001,1),d=-(0,T.jH)(this._startPlane.plane,e.renderEnd),h=-(0,T.jH)(this._startPlane.plane,t.startPoint);return t.depth=t.depth*(1-s)+d*s-h,e}}_shiftDragUpdatePlane(t){return()=>{if((0,c.Wi)(this.analysisViewData.plane))return;const e=(0,l.c)(p.WM.get(),this._startPlane.origin),i=(0,l.c)(p.WM.get(),(0,m.n)(this._startPlane));(0,l.g)(i,i,-t.depth),(0,l.a)(i,i,e);const s=(0,m.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,m.c)());this._updateBoundedPlane(s)}}_onRotateHeadingGrab(t){if("start"!==t.action||(0,c.Wi)(this.analysisViewData.plane))return;const e=De(this.analysisViewData.plane,this.view.renderCoordsHelper,It.HEADING,(0,T.Ue)()),i=this._calculatePickRay(t.screenPoint),s=(0,P.c)();(0,T.BR)(e,i,s)&&((0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:s})}_createRotateHeadingDragPipeline(t){return(0,Qt.Xd)(t,(e,i,s)=>{const d=this.inputState;if((0,c.Wi)(d)||"rotate"!==d.type)return;const h=(0,c.pC)(this.analysisViewData.plane)?(0,m.a)(this.analysisViewData.plane,(0,m.c)()):null;i.next((0,Ft._N)(this.view,d.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(d)).next(this._rotateDragUpdatePlaneFromRotate()),s.next(()=>{(0,c.pC)(h)&&this._updateBoundedPlane(h)})})}_onRotateTiltGrab(t){if("start"!==t.action||(0,c.Wi)(this.analysisViewData.plane))return;const e=De(this.analysisViewData.plane,this.view.renderCoordsHelper,It.TILT,(0,T.Ue)()),i=this._calculatePickRay(t.screenPoint),s=(0,P.c)();(0,T.BR)(e,i,s)&&((0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:s})}_createRotateTiltDragPipeline(t){return(0,Qt.Xd)(t,(e,i,s)=>{const d=this.inputState;if((0,c.Wi)(d)||"rotate"!==d.type)return;const h=(0,c.pC)(this.analysisViewData.plane)?(0,m.a)(this.analysisViewData.plane,(0,m.c)()):null;i.next((0,Ft._N)(this.view,d.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(d)).next(this._rotateDragUpdatePlaneFromRotate()),s.next(()=>{(0,c.pC)(h)&&this._updateBoundedPlane(h)})})}_rotateDragRenderPlaneToRotate(t){return e=>{if((0,c.Wi)(this.analysisViewData.plane))return null;const i=(0,T.mJ)(t.rotatePlane),s=(0,ve.Gd)(t.startPoint,e.renderEnd,this.analysisViewData.plane.origin,i);return{...e,rotateAxis:i,rotateAngle:s}}}_rotateDragUpdatePlaneFromRotate(){return t=>{if((0,c.Wi)(this.analysisViewData.plane))return;const e=(0,W.d)(p.MP.get(),t.rotateAngle,t.rotateAxis);if((0,c.Wi)(e))return;const i=(0,l.m)(p.WM.get(),this._startPlane.basis1,e),s=(0,l.m)(p.WM.get(),this._startPlane.basis2,e),d=(0,m.f)(this.analysisViewData.plane.origin,i,s,(0,m.c)());this._updateBoundedPlane(d)}}_onResizeGrab(t,e){if("start"!==t.action||(0,c.Wi)(this.analysisViewData.plane))return;const i=this._calculatePickRay(t.screenPoint),s=p.WM.get();(0,T.BR)(this.analysisViewData.plane.plane,i,s)&&((0,m.a)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:e,startPoint:(0,P.a)(s)})}_createResizeDragPipeline(t){return(0,Qt.Xd)(t,(e,i,s)=>{const d=this.inputState;if((0,c.Wi)(d)||"resize"!==d.type||(0,c.Wi)(this.analysisViewData.plane))return;const h=(0,m.a)(this.analysisViewData.plane,(0,m.c)());i.next((0,Ft._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(d)),s.next(()=>{this._updateBoundedPlane(h)})})}_resizeDragUpdatePlane(t){return e=>{if((0,c.Wi)(this.analysisViewData.plane))return;const s=function Li(t,e,i,s,d,h){const u=(0,l.c)(p.WM.get(),d.origin);(0,l.a)(u,u,(0,l.g)(p.WM.get(),d.basis1,t.direction[0]<0?1:-1)),(0,l.a)(u,u,(0,l.g)(p.WM.get(),d.basis2,t.direction[1]<0?1:-1));const v=(0,l.l)(d.basis1),w=(0,l.l)(d.basis2),O=(0,l.b)(p.WM.get(),i,u),A=(0,l.b)(p.WM.get(),e,u);let C=0,B=0;if($t(t)){const ot=kt(d),wt=kt(h);C=v-.5*t.direction[0]*(0,l.e)(d.basis1,A)/v,B=w-.5*t.direction[1]*(0,l.e)(d.basis2,A)/w;const Ot=wt/ot;C*=Ot,B*=Ot}const nt=C+.5*t.direction[0]*(0,l.e)(d.basis1,O)/v,Q=B+.5*t.direction[1]*(0,l.e)(d.basis2,O)/w,b=(0,l.g)(p.WM.get(),d.basis1,nt/v),Y=(0,l.g)(p.WM.get(),d.basis2,Q/w);(nt<=0||Ce(h.origin,b,s)<=1600)&&(0,l.c)(b,h.basis1),(Q<=0||Ce(h.origin,Y,s)<=1600)&&(0,l.c)(Y,h.basis2);const rt=(0,l.c)(p.WM.get(),u);return(0,l.a)(rt,rt,(0,l.g)(p.WM.get(),b,t.direction[0]<0?-1:1)),(0,l.a)(rt,rt,(0,l.g)(p.WM.get(),Y,t.direction[1]<0?-1:1)),(0,m.f)(rt,b,Y,h)}(this._resizeHandles[t.activeHandleIdx],t.startPoint,e.renderEnd,this.view.state.camera,this._startPlane,(0,m.a)(this.analysisViewData.plane));this._updateBoundedPlane(s)}}_updateBoundedPlane(t){const e=this.analysisViewData;if(!(0,c.pC)(e))throw new Error("valid internal object expected");e.plane=t}_updatePreviewPlane(t,e={}){let i=this._previewPlane;if(this._previewPlane=null,(0,c.Wi)(t))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const s=(0,c.pC)(i)?i:(0,m.c)();if(i=(0,c.pC)(i)?(0,m.a)(i,ca):null,this._pickPlane(t,!0,e,s)){const d=.95;let h=!1;(0,c.pC)(i)&&(h=(0,l.e)(i.plane,s.plane)<d||(0,l.e)((0,l.n)(p.WM.get(),i.basis1),(0,l.n)(p.WM.get(),s.basis1))<d),h&&(this._previewPlaneOpacity=0),this._previewPlane=s}}(0,c.pC)(this._previewPlane)&&(0,c.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,na.A)({update:({deltaTime:s})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+s/300,1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,c.Wi)(this._previewPlane)&&(0,c.pC)(this._frameTask)?this._removeFrameTask():(0,c.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,c.hw)(this._frameTask)}_calculatePickRay(t){const e=(0,S.Ue)(),i=(0,vt.md)(t,ua);return(0,Pe.u4)(this.view.state.camera,i,e),(0,l.n)(e.direction,e.direction),e}_pickMinResult(t){const e=(0,vt.md)(t,p.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector),this._intersector.results.min}_pickPlane(t,e,i,s){const d=this._pickMinResult(t),h=p.WM.get();if(!d.getIntersectionPoint(h))return!1;const u=d.getTransformedNormal(p.WM.get()),v=this.view.state.camera;(0,l.e)(u,v.viewForward)>0&&(0,l.g)(u,u,-1);const w=function xi(t,e){return.4*Math.min(e.width,e.height)*e.computeRenderPixelSizeAt(t)}(h,v),O=(e?1:-1)*w*.02,A=(0,l.g)(p.WM.get(),u,O);return(0,l.a)(A,A,h),function Ii(t,e,i,s,d,h,u,v){return function Ri(t,e,i,s,d,h){const u=(0,l.e)(t,e),v=p.WM.get(),w=p.WM.get();switch(s===gt.HORIZONTAL_OR_VERTICAL?Math.abs(u)>Ge?gt.HORIZONTAL:gt.VERTICAL:s){case gt.VERTICAL:{const A=Math.abs(u)<=ne?t:i.viewUp;(0,l.f)(v,A,e),(0,l.c)(w,e);break}case gt.HORIZONTAL:(0,l.f)(v,i.viewUp,e),(0,l.f)(w,e,v);break;case gt.TILTED:{const A=Math.abs(u)<=ne?e:i.viewUp;(0,l.f)(v,A,t),(0,l.f)(w,t,v);break}}const O=(0,l.f)(p.WM.get(),v,w);(0,l.e)(O,i.viewForward)>0&&(0,l.g)(w,w,-1),(0,l.n)(d,v),(0,l.n)(h,w)}(e,u.worldUpAtPosition(t,p.WM.get()),d,h,v.basis1,v.basis2),(0,l.g)(v.basis1,v.basis1,i),(0,l.g)(v.basis2,v.basis2,s),(0,l.c)(v.origin,t),(0,T.my)(v.basis2,v.basis1,v.origin,v.plane),v}(A,u,w,w,v,i[Ct]?gt.VERTICAL:i[Rt]?gt.HORIZONTAL:this.analysis.tiltEnabled?gt.TILTED:gt.HORIZONTAL_OR_VERTICAL,this.view.renderCoordsHelper,s),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,c.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=J,this.rotateHeadingManipulator.state|=J,this.rotateTiltManipulator.state|=J,this._prevPointerMoveTimeout=this.clock.setTimeout(()=>{this.shiftManipulator.state&=~J,this.rotateHeadingManipulator.state&=~J,this.rotateTiltManipulator.state&=~J},this._pointerMoveTimerMs)}_updateManipulators(){if(ae.disableEngineLayers)return;let t=null,e=!1;if((0,c.pC)(this.analysisViewData.plane))t=this.analysisViewData.plane,e=!1;else{if(!(0,c.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(u=>u.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,e=!0}const i=Me(t,p.MP.get());e?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(u=>u.available=!1),this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(u=>u.available=!0),function Hi(t,e,i,s){const d=Jt(i,Mt.NEGATIVE_X),h=p.MP.get();(0,W.g)(h,e,d.edge*Math.PI/2);const u=(0,l.n)(p.WM.get(),d.basis);let v=(0,l.g)(p.WM.get(),u,d.direction*s.computeScreenPixelSizeAt(d.position)*40);(0,l.a)(v,v,d.position);const w=s.projectToRenderScreen(v,(0,vt.Wv)(p.WM.get())),O=function zi(t,e){const[i,s,d,h]=t.viewport,u=Math.min(d,h)/16;let v=!0;return e[0]<i+u?(e[0]=i+u,v=!1):e[0]>i+d-u&&(e[0]=i+d-u,v=!1),e[1]<s+u?(e[1]=s+u,v=!1):e[1]>s+h-u&&(e[1]=s+h-u,v=!1),v}(s,w);(0,Pe.Bh)(s,w,Bt),(0,l.n)(Bt.direction,Bt.direction);const A=p.WM.get();!O&&(0,m.i)(i,Bt,A)&&(v=A),h[12]=0,h[13]=0,h[14]=0,t.modelTransform=h,t.renderLocation=(0,P.a)(v),O?t.state|=jt:t.state&=~jt}(this.shiftManipulator,i,t,this.view.state.camera),function ji(t,e,i,s){const d=s.worldUpAtPosition(i.origin,p.WM.get()),h=Jt(i,Mt.POSITIVE_X),u=(0,W.b)(p.MP.get(),h.edge*Math.PI/2);(0,W.r)(u,u,-qt(i,d)),(0,W.m)(u,e,u),u[12]=0,u[13]=0,u[14]=0,t.modelTransform=u,t.renderLocation=h.position}(this.rotateHeadingManipulator,i,t,this.view.renderCoordsHelper),function Bi(t,e,i){const s=Jt(i,Mt.POSITIVE_Y),d=(0,W.b)(p.MP.get(),s.edge*Math.PI/2);(0,W.r)(d,d,Et),(0,W.m)(d,e,d),d[12]=0,d[13]=0,d[14]=0,t.modelTransform=d,t.renderLocation=s.position}(this.rotateTiltManipulator,i,t),this.resizeManipulators.forEach((u,v)=>function Ni(t,e,i,s){const d=(0,l.l)(s.basis1),h=(0,l.l)(s.basis2),u=we(s),v=kt(s),w=(0,l.s)(p.WM.get(),0,0,0);(0,l.a)(w,(0,l.g)(p.WM.get(),s.basis1,e.direction[0]),(0,l.g)(p.WM.get(),s.basis2,e.direction[1])),(0,l.a)(w,s.origin,w);let O=0,A=1;if($t(e))1===e.direction[0]&&-1===e.direction[1]?O=Et:1===e.direction[0]&&1===e.direction[1]?O=Math.PI:-1===e.direction[0]&&1===e.direction[1]&&(O=3*Math.PI/2),A=v;else{const B=0!==e.direction[0]?1:2;O=1===B?Et:0,A=(1===B?h:d)-u}const C=(0,W.b)(p.MP.get(),O);(0,W.h)(C,C,(0,l.s)(p.WM.get(),A,A,A)),(0,W.m)(C,i,C),C[12]=0,C[13]=0,C[14]=0,t.modelTransform=C,t.renderLocation=w}(u,this._resizeHandles[v],i,t)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const s=(0,l.s)(p.WM.get(),(0,l.l)(t.basis1),(0,l.l)(t.basis2),1),d=(0,W.u)(p.MP.get(),s),h=(0,W.m)(d,i,d);this._previewPlaneOutlineVisualElement.transform=h,this._previewPlaneGridVisualElement.transform=h,this._updateMaterials()}_updateMaterials(){this._previewPlaneOutlineVisualElement.color=[Vt[0],Vt[1],Vt[2],Vt[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.backgroundColor=[_t[0],_t[1],_t[2],_t[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}_updateManipulatorsInteractive(t){if(!t.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(e=>{e.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===t,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===t,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===t,this.resizeManipulators.forEach(e=>{e.interactive=e===t})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:t=>{this._pointerMoveTimerMs=t}}}};function Le(t,e,i,s){const d=function Ui(t,e,i,s){const d=(0,l.f)(p.WM.get(),e,i);return(0,l.f)(d,d,e),(0,T.Yq)(t,d,s)}(i,(0,m.n)(s),t.direction,(0,T.Ue)()),h=(0,P.c)();return(0,T.BR)(d,t,h)?{type:"shift",creatingPointerId:e,hasBeenDragged:!1,shiftPlane:d,depth:0,startPoint:h}:null}function se(t){return"mouse"!==t.pointerType||0===t.button}st.disableEngineLayers=!1,(0,g._)([(0,D.Cb)()],st.prototype,"clock",void 0),(0,g._)([(0,D.Cb)({constructOnly:!0})],st.prototype,"view",void 0),(0,g._)([(0,D.Cb)()],st.prototype,"analysisViewData",void 0),(0,g._)([(0,D.Cb)({readOnly:!0})],st.prototype,"state",null),(0,g._)([(0,D.Cb)({readOnly:!0})],st.prototype,"cursor",null),(0,g._)([(0,D.Cb)()],st.prototype,"analysis",null),(0,g._)([(0,D.Cb)()],st.prototype,"removeIncompleteOnCancel",void 0),(0,g._)([(0,D.Cb)({readOnly:!0})],st.prototype,"layersMode",void 0),(0,g._)([(0,D.Cb)({value:null})],st.prototype,"inputState",null),(0,g._)([(0,D.Cb)()],st.prototype,"_isPlacingSlicePlane",null),(0,g._)([(0,D.Cb)()],st.prototype,"_creatingPointerId",null),st=ae=(0,g._)([(0,x.j)("esri.views.3d.analysis.Slice.SliceTool")],st);const ca=(0,m.c)(),ua=(0,vt.s1)(),pa=st;var ga=a(54889);let mt=class extends et.Z{constructor(t){super(t),this._handles=new j.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.preview=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}_initialize(){var t=this;return(0,_.Z)(function*(){if("destroyed"===t.state||"ready"===t.state)return;yield(0,U.N1)(()=>t.view.ready);const e=t.analysisViewData;if((0,c.Wi)(e))throw new Error("expected internal object to be valid");t._gridVisualElement=Ee(t.view),t._outlineVisualElement=Te(t.view),t._handles.add([(0,U.YP)(()=>({visible:(0,c.pC)(e.plane)&&t.analysisViewData.visible,active:t.analysisViewData.active,preview:t.preview,showGrid:t.showGrid}),i=>t._updateMaterials(i),U.tX),(0,U.YP)(()=>e.plane,i=>t._updatePlane(i),U.tX)],"internal"),t._set("state","ready")})()}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=(0,c.SC)(this._gridVisualElement),this._outlineVisualElement=(0,c.SC)(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}whenReady(){var t=this;return(0,_.Z)(function*(){yield(0,U.N1)(()=>t.view.ready)})()}_updatePlane(t){if((0,c.Wi)(t))return;const e=(0,l.s)(p.WM.get(),(0,l.l)(t.basis1),(0,l.l)(t.basis2),1),i=(0,W.u)(p.MP.get(),e),s=Me(t,p.MP.get()),d=(0,W.m)(i,s,i);this._outlineVisualElement.transform=d,this._gridVisualElement.transform=d}_updateMaterials({visible:t,active:e,preview:i,showGrid:s}){this._outlineVisualElement.color=Vt,this._outlineVisualElement.width=i?2:1,this._outlineVisualElement.stipplePattern=e?null:(0,ga.z5)(5),this._gridVisualElement.backgroundColor=_t,this._gridVisualElement.gridColor=s?le:K.Z,this._gridVisualElement.visible=t,this._outlineVisualElement.visible=t}};(0,g._)([(0,D.Cb)({readOnly:!0})],mt.prototype,"state",void 0),(0,g._)([(0,D.Cb)()],mt.prototype,"view",void 0),(0,g._)([(0,D.Cb)()],mt.prototype,"analysis",void 0),(0,g._)([(0,D.Cb)()],mt.prototype,"analysisViewData",void 0),(0,g._)([(0,D.Cb)()],mt.prototype,"ready",null),(0,g._)([(0,D.Cb)()],mt.prototype,"showGrid",void 0),(0,g._)([(0,D.Cb)()],mt.prototype,"preview",void 0),mt=(0,g._)([(0,x.j)("esri.views.3d.analysis.Slice.SliceVisualization")],mt);var xe=a(95925);let Pt=class extends((0,E.p)(et.Z)){constructor(t){super(t),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1}initialize(){this.analysisVisualization=new mt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new Dt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.own((0,xe.Lp)(this,pa))}destroy(){(0,xe.Yq)(this),this.analysisVisualization=(0,c.SC)(this.analysisVisualization),this.analysisController=(0,c.SC)(this.analysisController)}get editable(){return!this.analysisVisualization.preview}set editable(t){this.analysisVisualization.preview=!t}when(){var t=this;return(0,_.Z)(function*(){return yield t.analysisVisualization.whenReady(),yield t.analysisController.whenReady(),t})()}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,c.Wg)(this.tool)}}};(0,g._)([(0,D.Cb)({readOnly:!0})],Pt.prototype,"type",void 0),(0,g._)([(0,D.Cb)({constructOnly:!0,nonNullable:!0})],Pt.prototype,"analysis",void 0),(0,g._)([(0,D.Cb)()],Pt.prototype,"tool",void 0),(0,g._)([(0,D.Cb)()],Pt.prototype,"plane",void 0),(0,g._)([(0,D.Cb)()],Pt.prototype,"active",void 0),(0,g._)([(0,D.Cb)({aliasOf:"analysisVisualization.showGrid"})],Pt.prototype,"showGrid",void 0),(0,g._)([(0,D.Cb)()],Pt.prototype,"editable",null),Pt=(0,g._)([(0,x.j)("esri.views.3d.analysis.SliceAnalysisView3D")],Pt);const va=Pt},54865:(At,q,a)=>{a.d(q,{G:()=>c,e:()=>D});var _=a(62208),g=a(55915),et=a(53929);function c(G,H,F,x=!1){const E=(0,g.fM)(G,H);return(0,_.Wi)(E)?null:(E.hasZ&&!x||!(0,_.pC)(F)||(E.z=(0,_.Pt)((0,et.KO)(F,E),0)),E)}function D(G,H,F){F.warnOnce(`Failed to project analysis geometry (id: '${G.id}'), projection from spatial reference (wkid: '${H.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},79967:(At,q,a)=>{a.d(q,{j:()=>pt});var _=a(6945),g=a(42743),et=a(32393),c=a(33470),D=a(40723),G=a(88569),H=a(5894),F=a(60909),x=a(57623),E=a(17626),k=(a(17625),a(651)),ut=a(91056),Z=a(87601),dt=a(39114),N=a(12407),ht=a(64127),X=a(41528),$=a(34013),j=a(67969),ct=a(2078);class m extends ut.A{initializeProgram(y){const l=m.shader.get().build(this.configuration);return new N.$(y.rctx,l,dt.i)}_setPipelineState(y,l){const P=this.configuration,R=y===g.Am.NONE,L=y===g.Am.FrontFace;return(0,ct.sm)({blending:P.output!==_.H.Color&&P.output!==_.H.Alpha||!P.transparent?null:R?Tt:(0,G.j7)(y),culling:(0,ct.zp)(P.cullFace),depthTest:{func:(0,G.Bh)(y)},depthWrite:R?P.writeDepth&&ct.LZ:(0,G.K5)(y),colorWrite:ct.BK,stencilWrite:P.hasOccludees?ht.s3:null,stencilTest:P.hasOccludees?l?ht.eD:ht.RY:null,polygonOffset:R||L?null:(0,G.je)(P.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(y,l){return l?this._occludeePipelineState:super.getPipelineState(y,l)}}m.shader=new k.J($.I,()=>a.e(8586).then(a.bind(a,18586)));const Tt=(0,ct.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA);class at extends X.W{constructor(){super(...arguments),this.output=_.H.Color,this.cullFace=g.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=g.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,E._)([(0,Z.o)({count:_.H.COUNT})],at.prototype,"output",void 0),(0,E._)([(0,Z.o)({count:g.Vr.COUNT})],at.prototype,"cullFace",void 0),(0,E._)([(0,Z.o)()],at.prototype,"hasSlicePlane",void 0),(0,E._)([(0,Z.o)()],at.prototype,"transparent",void 0),(0,E._)([(0,Z.o)()],at.prototype,"enableOffset",void 0),(0,E._)([(0,Z.o)()],at.prototype,"writeDepth",void 0),(0,E._)([(0,Z.o)()],at.prototype,"hasOccludees",void 0),(0,E._)([(0,Z.o)({count:g.Am.COUNT})],at.prototype,"transparencyPassType",void 0),(0,E._)([(0,Z.o)()],at.prototype,"hasMultipassTerrain",void 0),(0,E._)([(0,Z.o)()],at.prototype,"cullAboveGround",void 0);class pt extends D.F5{constructor(y){super(y,new W),this.supportsEdges=!0,this.techniqueConfig=new at}getConfiguration(y,l){return this.techniqueConfig.output=y,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=l.transparencyPassType,this.techniqueConfig.enableOffset=l.camera.relativeElevation<G.ve,this.techniqueConfig.hasMultipassTerrain=l.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=l.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(y,l,P,R,L,T,S){(0,x.Bw)(y,l,R,L,T,void 0,S)}requiresSlot(y,l){return y===H.r.DRAPED_MATERIAL||((0,et.S)(l)===_.H.Highlight?y===H.r.OPAQUE_MATERIAL:y===(this.parameters.transparent?this.parameters.writeDepth?H.r.TRANSPARENT_MATERIAL:H.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:H.r.OPAQUE_MATERIAL))}createGLMaterial(y){return y.output===_.H.Color||y.output===_.H.Alpha||y.output===_.H.Highlight?new vt(y):void 0}createBufferWriter(){return new F.G_(F.W1)}}class vt extends c.F{constructor(y){super({...y,...y.material.parameters})}_updateParameters(y){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(m,y)}_updateOccludeeState(y){y.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:y.hasOccludees}),this._updateParameters(y))}beginSlot(y){return this._output!==_.H.Color&&this._output!==_.H.Alpha||this._updateOccludeeState(y),this._updateParameters(y)}}class W extends D.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=g.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}}}]);