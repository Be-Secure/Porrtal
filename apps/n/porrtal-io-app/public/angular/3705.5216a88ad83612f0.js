"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[3705],{88755:(O,f,o)=>{o.d(f,{Y:()=>d,h:()=>m});var y=o(21726),c=o(84687);function m(p){return{origin:"portal-item",url:(0,y.mN)(p.itemUrl),portal:p.portal||c.Z.getDefault(),portalItem:p,readResourcePaths:[]}}function d(p){return{origin:"portal-item",messages:[],writtenProperties:[],url:p.itemUrl?(0,y.mN)(p.itemUrl):null,portal:p.portal||c.Z.getDefault(),portalItem:p}}},83705:(O,f,o)=>{o.r(f),o.d(f,{getFirstLayerOrTableId:()=>B,getNumLayersAndTables:()=>T,getSubtypeGroupLayerIds:()=>S,load:()=>P,preprocessFSItemData:()=>K});var y=o(15861),c=o(26584),m=o(44917),d=o(38305),p=o(84687),h=o(55463),b=o(88755),M=o(37281),U=o(39683),D=o(45205);function P(e,r){return L.apply(this,arguments)}function L(){return(L=(0,y.Z)(function*(e,r){const t=e.instance.portalItem;if(t&&t.id)return yield t.load(r),i(e),_(e,r)})).apply(this,arguments)}function i(e){const r=e.instance.portalItem;if(!e.supportedTypes.includes(r.type))throw new c.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:r.type,expectedType:e.supportedTypes.join(", ")})}function _(e,r){return l.apply(this,arguments)}function l(){return(l=(0,y.Z)(function*(e,r){const t=e.instance,n=t.portalItem,{url:a,title:s}=n,u=(0,b.h)(n);if("group"===t.type)return t.read({title:s},u),E(t,e);a&&t.read({url:a},u);const g=yield C(e,r);return g&&t.read(g,u),t.resourceReferences={portalItem:n,paths:u.readResourcePaths},"subtype-group"!==t.type&&t.read({title:s},u),(0,U.y)(t,u)})).apply(this,arguments)}function E(e,r){let t;const n=e.portalItem.type,a=r.layerModuleTypeMap,s=(0,M._$)(e.portalItem,"Oriented Imagery Layer")??!1;switch(n){case"Feature Service":t=s?a.OrientedImageryLayer:a.FeatureLayer;break;case"Stream Service":t=a.StreamLayer;break;case"Scene Service":t=a.SceneLayer;break;case"Feature Collection":t=a.FeatureLayer;break;default:throw new c.Z("portal:unsupported-item-type-as-group",`The item type '${n}' is not supported as a 'IGroupLayer'`)}let u;return t().then(g=>(u=g,C(r))).then(function(){var g=(0,y.Z)(function*(I){let v=()=>u;if("Feature Service"===n){if(S(I=yield K(I,e.portalItem.url)).length){const F=a.SubtypeGroupLayer,$=yield F();v=N=>"SubtypeGroupLayer"===N.layerType?$:u}return A(e,v,I)}return T(I)>0?A(e,v,I):function W(e,r){return e.portalItem.url?(0,D.b)(e.portalItem.url).then(t=>{function n(a){return{id:a.id,name:a.name}}t&&A(e,r,{layers:t.layers?.map(n),tables:t.tables?.map(n)})}):Promise.resolve()}(e,v)});return function(I){return g.apply(this,arguments)}}())}function A(e,r,t){let n=t.layers||[];const a=t.tables||[];if("Feature Collection"===e.portalItem.type&&(n.forEach(s=>{"Table"===s?.layerDefinition?.type&&a.push(s)}),n=n.filter(s=>"Table"!==s?.layerDefinition?.type)),"coverage"in t){const s=function x(e){const{coverage:r}=e;if(!r)return null;const t=new URL(r);if(r.toLowerCase().includes("item.html")){const n=t.searchParams.get("id");return m.Z.fromPortalItem({portalItem:new h.default({id:n,url:t.origin})})}if((0,d.B5)(r))return m.Z.fromArcGISServerUrl({url:r});throw new c.Z("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}(t);e.add(s)}n.reverse().forEach(s=>{const u=j(e,r(s),t,s);e.add(u)}),a.reverse().forEach(s=>{const u=j(e,r(s),t,s);e.tables.add(u)})}function j(e,r,t,n){const a=new r({portalItem:e.portalItem.clone(),layerId:n.id});if("subtype-group"!==a.type&&(a.sublayerTitleMode="service-name"),"Feature Collection"===e.portalItem.type){const s={origin:"portal-item",portal:e.portalItem.portal||p.Z.getDefault()};a.read(n,s);const u=t.showLegend;null!=u&&a.read({showLegend:u},s)}return a}function C(e,r){if(!1===e.supportsData)return Promise.resolve(void 0);const t=e.instance;return t.portalItem.fetchData("json",r).catch(()=>null).then(n=>{if(function w(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}(t)){let a,s=!0;if(n&&T(n)>0){if(null==t.layerId){const u=S(n);t.layerId="subtype-group"===t.type?u?.[0]:B(n)}a=function Z(e,r){const{layerId:t}=r,n=e.layers?.find(a=>a.id===t)||e.tables?.find(a=>a.id===t);return n&&function G(e,r){return!("feature"===r.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===r.type&&!("layerType"in e))}(n,r)?n:null}(n,t),a&&(1===T(n)&&(s=!1),null!=n.showLegend&&(a.showLegend=n.showLegend))}return s&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),a}return n})}function K(e,r){return R.apply(this,arguments)}function R(){return(R=(0,y.Z)(function*(e,r){if(null==e?.layers||null==e?.tables){const t=yield(0,D.b)(r);(e=e||{}).layers=e.layers||t?.layers,e.tables=e.tables||t?.tables}return e})).apply(this,arguments)}function B(e){const r=e.layers;if(r&&r.length)return r[0].id;const t=e.tables;return t&&t.length?t[0].id:null}function T(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function S(e){const r=[];return e?.layers?.forEach(t=>{"SubtypeGroupLayer"===t.layerType&&r.push(t.id)}),r}},37281:(O,f,o)=>{o.d(f,{$o:()=>D,Kz:()=>L,_$:()=>M,ck:()=>U,qj:()=>b});var y=o(15861),c=o(55915),m=o(65234),d=o(46367);function p(i){return h.apply(this,arguments)}function h(){return(h=(0,y.Z)(function*(i){const _=i.spatialReference;if(_.isWGS84)return i.clone();if(_.isWebMercator)return(0,d.Sx)(i);const l=m.Z.WGS84;return yield(0,c.iQ)(_,l),(0,c.iV)(i,l)})).apply(this,arguments)}function b(i,_){if(!M(i,_)){const l=i.typeKeywords;l?l.push(_):i.typeKeywords=[_]}}function M(i,_){return!!i.typeKeywords?.includes(_)}function U(i,_){const l=i.typeKeywords;if(l){const E=l.indexOf(_);E>-1&&l.splice(E,1)}}function D(i){return P.apply(this,arguments)}function P(){return(P=(0,y.Z)(function*(i){const _=i.clone().normalize();let l;if(_.length>1)for(const E of _)l?E.width>l.width&&(l=E):l=E;else l=_[0];return p(l)})).apply(this,arguments)}const L={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}},45205:(O,f,o)=>{o.d(f,{b:()=>m});var y=o(15861),c=o(84792);function m(p){return d.apply(this,arguments)}function d(){return(d=(0,y.Z)(function*(p){const{data:h}=yield(0,c.default)(p,{responseType:"json",query:{f:"json"}});return h})).apply(this,arguments)}}}]);