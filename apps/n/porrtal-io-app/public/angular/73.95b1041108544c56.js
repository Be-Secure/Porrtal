"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[73],{10073:(Le,$,m)=>{m.r($),m.d($,{default:()=>Io});var J,l,A=m(15861),y=m(17626),Y=m(14517),T=m(46160),W=m(63290),g=m(62208),M=m(32917),C=m(77712),ee=(m(85931),m(90912),m(76898)),We=m(1437),B=m(97662),ge=m(72392),Ee=m(16730),F=m(21286),k=m(15572),Q=m(28347),he=m(43703),w=m(84161),R=m(28093),Ne=m(78172),Z=m(26242),Se=m(38114),oe=m(84786),ce=m(64770),me=m(55915),Re=m(37053),be=m(66601);function re(l,o,d){const c=function pe(l,o,d,c){const h=(0,be.m)(d),p=(0,Ee.j5)(h);if((0,g.Wi)(p))return null;const u=o[2]-l[2];if(c===J.Vertical)return{verticalSigned:u,unit:p};if(!(0,me.SH)(l,d,Fe,h)||!(0,me.SH)(o,d,zt,h))return null;if(c===J.Direct)return{direct:(0,w.i)(zt,Fe),unit:p};if((0,w.s)(Ht,l[0],l[1],o[2]),!(0,me.SH)(Ht,d,Ht,h))return null;const f=(0,w.i)(Ht,zt);return c===J.Horizontal?{horizontal:f,unit:p}:{direct:(0,w.i)(zt,Fe),horizontal:f,vertical:Math.abs(u),unit:p}}(l,o,d,J.Direct);return(0,g.pC)(c)?(0,k.yG)(c.direct,c.unit):null}(l=J||(J={}))[l.Direct=0]="Direct",l[l.Horizontal=1]="Horizontal",l[l.Vertical=2]="Vertical";const j=(0,R.c)(),K=(0,R.c)(),Fe=(0,R.c)(),zt=(0,R.c)(),Ht=(0,R.c)();function Vt(l){const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:d,dimension:{offset:c,measureType:h,orientation:p}}=l;return{elevationAlignedStartPoint:o,elevationAlignedEndPoint:d,offset:c,measureType:h,orientation:p}}function It({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o,offset:d,measureType:c,orientation:h},p,u=null){if((0,g.Wi)(l)||(0,g.Wi)(o))return null;const f=Pn((0,g.pC)(u)?u.directSegment:new ce.y,{elevationAlignedStartPoint:l,elevationAlignedEndPoint:o},p),v=(0,g.pC)(u)?u.primaryOffsetAxis:(0,R.c)();Zt(v,{measureType:c,elevationAlignedStartPoint:l,elevationAlignedEndPoint:o,directSegment:f,orientation:h,renderCoordsHelper:p});const S=(0,g.pC)(u)?u.dimensionSegment:new ce.y;return sn({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o})&&c===B.n.Vertical?((0,w.c)(S.startRenderSpace,f.startRenderSpace),(0,w.c)(S.endRenderSpace,f.endRenderSpace)):En(S,{offsetAxis:v,offset:d,relativeToSegment:f,renderCoordsHelper:p}),{directSegment:f,dimensionSegment:S,primaryOffsetAxis:v,spatialReference:p.spatialReference}}function Sn(l,o,d,c){return o===Pt.Start?((0,w.c)(l.startRenderSpace,d.startRenderSpace),(0,w.c)(l.endRenderSpace,c.startRenderSpace)):((0,w.c)(l.startRenderSpace,d.endRenderSpace),(0,w.c)(l.endRenderSpace,c.endRenderSpace)),l}var Pt;function Cn(l,o,d,c){switch(o){case B.n.Direct:return Pn(l,d,c);case B.n.Horizontal:case B.n.Vertical:{const{elevationAlignedStartPoint:h,elevationAlignedEndPoint:p,dimension:u,geometry:f}=d;let v;u.measureType===B.n.Direct?(v=function mi(l,o){const d=l.directSegment.eval(.5,Z.WM.get()),c=o.worldUpAtPosition(d,Z.WM.get()),h=l.dimensionSegment.eval(.5,Z.WM.get()),p=(0,w.y)(Z.WM.get(),h,d);return!(0,w.F)(p,R.Z)&&(0,w.e)(p,c)>0}(f,c)===h.z>p.z,o===B.n.Horizontal&&(v=!v)):v=!function vi(l){const{startRenderSpace:o,endRenderSpace:d}=l.dimensionSegment,{startRenderSpace:c,endRenderSpace:h}=l.directSegment;return(0,w.E)(c,o)<(0,w.E)(h,d)}(f);const[S,P]=v?[h,p]:[p,h],x=(0,oe.WG)(P,_i);return o===B.n.Horizontal?x.z=S.z:(x.x=S.x,x.y=S.y),c.toRenderCoords(S,l.startRenderSpace),c.toRenderCoords(x,l.endRenderSpace),l}}}function Pn(l,o,d){return d.toRenderCoords(o.elevationAlignedStartPoint,l.startRenderSpace),d.toRenderCoords(o.elevationAlignedEndPoint,l.endRenderSpace),l}!function(l){l[l.Start=0]="Start",l[l.End=1]="End"}(Pt||(Pt={}));const _i=(0,Se.Tx)(0,0,0,null),Si=new ce.y;function Zt(l,o){const{measureType:d,elevationAlignedStartPoint:c,elevationAlignedEndPoint:h,directSegment:{startRenderSpace:p,endRenderSpace:u},directSegment:f,renderCoordsHelper:v}=o,S=f.eval(.5,Z.WM.get()),P=v.worldUpAtPosition(S,Z.WM.get()),x=v.worldBasisAtPosition(S,Ne.R.Y,Z.WM.get());switch(d){case B.n.Horizontal:(0,w.c)(l,P);break;case B.n.Vertical:(0,w.e)(p,P)<(0,w.e)(u,P)?(0,w.y)(l,u,p):(0,w.y)(l,p,u),(0,w.f)(l,l,P),(0,w.f)(l,l,P);break;case B.n.Direct:{const L=(0,g.Pt)(o.orientation,0);if(sn({elevationAlignedStartPoint:c,elevationAlignedEndPoint:h}))(0,Q.d)(Wt,-(0,F.Vl)(L),P),(0,w.m)(l,x,Wt);else{const z=(0,w.y)(Z.WM.get(),u,p),V=(0,w.f)(Z.WM.get(),z,P);(0,w.f)(V,V,z),(0,Q.d)(Wt,(0,F.Vl)(L),z),(0,w.m)(l,V,Wt)}break}}return(0,w.F)(l,R.Z)?(0,w.c)(l,x):(0,w.n)(l,l)}const Wt=(0,he.c)();function sn({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o}){return(0,g.pC)(l)&&(0,g.pC)(o)&&l.x===o.x&&l.y===o.y}function En(l,o){const{offsetAxis:d,offset:c,relativeToSegment:{startRenderSpace:h,endRenderSpace:p},relativeToSegment:u,renderCoordsHelper:f}=o,v=c/f.unitInMeters,[S,P]=function Ci(l,o,d,c=0){const h=(0,w.e)(o,d),p=(0,w.e)(l,d),u=Math.abs(h-p)+c;return h>p?[u,c]:[c,u]}(h,p,d,v);return(0,w.z)(l.startRenderSpace,u.startRenderSpace,d,S),(0,w.z)(l.endRenderSpace,u.endRenderSpace,d,P),l}function Ft(l,o,d){const c=o.directSegment.eval(.5,Z.WM.get());return d.worldUpAtPosition(c,l)}function on(l,o){const{startRenderSpace:d,endRenderSpace:c}=o.directSegment;return(0,w.y)(l,c,d)}function rn(l,o,d={invert:!1}){const{startRenderSpace:c,endRenderSpace:h}=o.dimensionSegment;return d.invert?(0,w.y)(l,c,h):(0,w.y)(l,h,c)}function an(l,o){const d=l.directSegment.eval(.5,Z.WM.get());return o.headingAtPosition(d,l.primaryOffsetAxis)}const Ei=(0,R.c)();function Mn(l){const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:d}=l;if((0,g.Wi)(o)||(0,g.Wi)(d))return!1;const c=function _(l,o){const{spatialReference:d}=l;return(0,Re.fS)(d,o.spatialReference)?(j[0]=l.x,j[1]=l.y,j[2]=l.hasZ?l.z:0,K[0]=o.x,K[1]=o.y,K[2]=o.hasZ?o.z:0,re(j,K,d)):null}(o,d);return(0,g.pC)(c)&&(0,k.nn)(c,"meters").value>xn}const xn=1e5;function Et(l){return(0,g.pC)(l.geometry)}let tt=class extends Y.Z{constructor(l){super(l),this._handles=new ge.Z}initialize(){const{computations:l}=this.analysisViewData;for(const o of l)this._addComputation(o);this.addHandles(l.on("change",({added:o,removed:d})=>{for(const c of d)this._removeComputation(c);for(const c of o)this._addComputation(c)}))}destroy(){this._handles=(0,g.SC)(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,Ee.RG)(this.view)}_addComputation(l){this._handles.has(l)||this._handles.add((0,M.YP)(()=>Vt(l),o=>{const{measureType:d}=o;if(Mn(o)&&d!==B.n.Direct){const h=Math.round((0,Ee.En)(xn,"meters","kilometers"));return W.Z.getLogger(this.declaredClass).warnOnce(`A ${d} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${h} km. Update the measureType of the affected dimension to "direct" to display it.`),void(l.geometry=null)}const c=It(o,this.view.renderCoordsHelper,l.geometry);l.geometry=c,l.result.length=function gi(l,o,d){if((0,g.Wi)(l))return null;const p=re(l.dimensionSegment.startRenderSpace,l.dimensionSegment.endRenderSpace,l.spatialReference);if((0,g.Wi)(p))return null;const u=o===B.n.Vertical?(0,Ee.ov)(p.value,p.unit,d):(0,Ee.iS)(p.value,p.unit,d);return(0,k.nn)(p,u)}(c,d,this._defaultUnit)},M.tX),l)}_removeComputation(l){this._handles.remove(l)}};(0,y._)([(0,C.Cb)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],tt.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],tt.prototype,"analysis",null),(0,y._)([(0,C.Cb)()],tt.prototype,"_defaultUnit",null),tt=(0,y._)([(0,ee.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],tt);var Mi=m(84244),Ve=m(54024),ae=m(91558),ln=(m(29132),m(23719)),Ce=m(23841),Ye=m(90014);const wn={main:new ae.Z([255,127,0])};class xi{constructor(){this.color=wn.main,this.opacity=.5,this.radius=5}}class wi{constructor(){this.color=new ae.Z([127,127,127]),this.opacity=.5,this.radius=5}}class Oi{constructor(){this.lineSizeFraction=.8}}class Ti{constructor(){this.color=wn.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}}class Li{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}class Di{constructor(){this.lineSizeFraction=.25}}class Ri{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}}class bi{constructor(){this.color=new ae.Z([255,127,0,.5])}}const te=new class Ai{constructor(){this.pointManipulators=new xi,this.offsetManipulator=new Ti,this.orientationManipulator=new Li,this.markers=new Oi,this.labels=new Ri,this.offsetLine=new Di,this.constraint=new bi,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new wi,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};var On=m(45403),Be=m(19142),ct=m(8859),Tn=m(81805),nt=m(57521),Ie=m(30260),ht=m(33786),Mt=m(72642);class zi{constructor(o){this.start=o.start,this.end=o.end,this.offset=o.offset,this.heading=o.heading,this.rotation=o.rotation,this.direct=o.direct,this.horizontal=o.horizontal,this.vertical=o.vertical}manipulatorName(o){return Object.keys(this).find(d=>this.hasOwnProperty(d)&&o===this[d])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(o){for(const d of B.V)o(this.manipulatorForMeasureType(d),d)}manipulatorForMeasureType(o){switch(o){case B.n.Direct:return this.direct;case B.n.Horizontal:return this.horizontal;case B.n.Vertical:return this.vertical}}}function Ln(l,{lineSizePt:o,material:d}){const{calloutOffsetPx:c,calloutOpacity:h,calloutWidth:p,discScale:u,focusMultiplier:f}=te.orientationManipulator;return{calloutLength:.25*Tn._Z*te.markers.lineSizeFraction*(0,Ce.F2)(o)+c,calloutOpacity:h,calloutWidth:p,customStateMask:Xe,discScale:u,focusMultiplier:f,material:d,metadata:l}}function Dn(l,o){return(0,Be.Ju)(l,Ln(o.metadata,o))}function Rn(l,o){(0,Be.Bz)(l,Ln(l.metadata,o))}function bn(l){const{cancel:o,computation:d,settingHeading:c,steps:h,view:p}=l;if(!Et(d))return;const{renderCoordsHelper:u}=p,{dimension:f,geometry:v}=d,S=(0,R.c)(),P=Vn((0,R.c)(),v,v.directSegment,u),x=In(Z.WM.get(),{forHeading:c,geometry:v,renderCoordsHelper:u}),L=(0,Ye.Yq)(P,x,(0,Ye.Ue)()),z=(0,g.Pt)(f.orientation,c?()=>an(v,p.renderCoordsHelper):0);h.next((0,ct._N)(p,L)).next(V=>{"start"===V.action&&(0,w.c)(S,V.renderStart);const U=(0,Ye.mJ)(L),X=(0,Be.Gd)(S,V.renderEnd,P,U);let fe=z-(0,F.BV)(X);c||(fe=function Gi(l){const o=ln.BV.normalize(l)%90;return o<te.orientationSnapThresholdDegrees?l-o:90-o<te.orientationSnapThresholdDegrees?l+(90-o):l}(fe)),f.orientation=fe}),o.next((0,Ie.di)(f,["orientation"]))}function An(l,o,d,c){const h=(0,w.b)(Z.WM.get(),d.endRenderSpace,d.startRenderSpace);(0,w.f)(h,h,c);const p=(0,Ye.Yq)(d.startRenderSpace,h,(0,Ye.Ue)()),u=(0,Ye.Yq)(d.startRenderSpace,c,(0,Ye.Ue)()),f=o.offset;let v,S=0;const P=new Ie.hM;return P.next((0,ct._N)(l,p)).next(x=>{"start"===x.action&&(S=(0,Ye.jH)(u,x.renderStart));const L=((0,Ye.jH)(u,x.renderEnd)-S)*l.renderCoordsHelper.unitInMeters;o.offset=f+L,v=x}),x=>(P.execute(x),v)}function zn(l,o){const{directSegment:d}=l,{renderCoordsHelper:c}=o,h=Ft(Z.WM.get(),l,c),p=on(Z.WM.get(),l),u=(0,w.f)(Z.WM.get(),p,h),{viewForward:f}=o.state.camera;(0,w.e)(u,f)>0&&(0,w.g)(u,u,-1);const v=d.eval(.5,Z.WM.get());return c.headingAtPosition(v,u)}function Hn(l,o,d,{forHeading:c}){const{dimension:h,geometry:p}=o,{primaryOffsetAxis:u}=p,f=(0,w.g)(ki,u,h.offset>=0?1:-1),v=In(Ki,{forHeading:c,geometry:p,renderCoordsHelper:d});(0,w.f)(v,v,f);const S=(0,Be.Aq)(f,v,R.Z,Ut);l.modelTransform=S,l.renderLocation=Vn(xt,p,p.dimensionSegment,d)}const ki=(0,R.c)(),Ki=(0,R.c)();function Vn(l,o,d,c){const{startRenderSpace:h,endRenderSpace:p}=d,u=function Ji(l,o){const d=on($i,l),c=Ft(qi,l,o);return(0,w.e)(d,c)>0}(o,c)?h:p;return(0,w.c)(l,u)}function In(l,{forHeading:o,geometry:d,renderCoordsHelper:c}){return o?Ft(l,d,c):rn(l,d,{invert:!0})}const $i=(0,R.c)(),qi=(0,R.c)();function dn(l){return(0,Ce.F2)(l)+te.offsetManipulator.focusedLinePaddingPx}const Xe=ht.jg.Custom1,xt=(0,R.c)(),cn=(0,R.c)(),Ut=(0,he.c)(),Zn=new ce.y;var Ae,ts=m(69186),hn=m(80542),jt=m(58817),it=m(10699);function Gt(l,o){if(Mn(l))return Ae.Direct;const{geometry:d}=l;if((0,g.Wi)(d)||(0,w.k)(d.directSegment.startRenderSpace,d.directSegment.endRenderSpace))return null;const{constraintThresholdPx:c}=te,{camera:h}=o.state,p=Ft(Z.WM.get(),d,o.renderCoordsHelper),u=on(Z.WM.get(),d),f=(0,w.g)(Z.WM.get(),p,(0,w.e)(u,p)),v=(0,w.b)(Z.WM.get(),u,f),S=(0,w.p)(v),P=(0,w.p)(f),{startRenderSpace:x,endRenderSpace:L}=d.directSegment,z=Math.max(h.computeRenderPixelSizeAt(x)*c,h.computeRenderPixelSizeAt(L)*c)**2;return S<z?Ae.Vertical:P<z?Ae.Horizontal:null}m(8314),function(l){l[l.Horizontal=0]="Horizontal",l[l.Vertical=1]="Vertical",l[l.Direct=2]="Direct"}(Ae||(Ae={}));var is=m(25601),Ze=m(993),pt=m(67709),Nt=m(85072),ss=m(8834),Ue=m(13777),Yt=m(70562),os=m(23018),Bt=m(53928),ne=m(40723),Wn=m(16396),st=m(92222);class rs extends Bt._{constructor(o){super(o),this._ray=(0,Yt.Ue)(),this._externalResources=null,this._handles=new ge.Z,this._isWorldDown=!1,this._start=(0,R.c)(),this._end=(0,R.f)(1,0,0),this._width=1,this._color=(0,pt.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,pt.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=we.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ne.yD.OccludeAndTransparent,this._fadedExtensions=jn,this.applyProps(o)}createExternalResources(){const o=new st.U(this.materialParameters);this._handles.add((0,M.YP)(()=>this.view.state.camera,()=>{this._updateGeometry()}));const d=new os.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:o,laserline:d}}destroyExternalResources(){(0,g.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(o){(0,g.pC)(this._externalResources)&&o(this._externalResources.material)}createGeometries(o){const d=[(0,R.c)(),(0,R.c)()],c=this.extensionType===we.FADED;c&&d.push((0,R.c)(),(0,R.c)());const h=c?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,p=(0,nt.rh)(d,null,h);o.addGeometry(p,(0,g.Wg)(this._externalResources).material),this._updateVertices(o)}updateVisibility(o){super.updateVisibility(o),(0,g.pC)(this._externalResources)&&(this._externalResources.laserline.visible=o)}setStartEndFromWorldDownAtLocation(o){this._isWorldDown=!0,(0,w.c)(this._start,o),this.view.renderCoordsHelper.worldUpAtPosition(o,this._end),(0,w.b)(this._end,o,this._end),(0,Yt.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(o){this._isWorldDown=!1,(0,w.k)(this._start,o)||((0,w.c)(this._start,o),(0,Yt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(o){this._isWorldDown=!1,(0,w.k)(this._end,o)||((0,w.c)(this._end,o),(0,Yt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get color(){return this._color}set color(o){(0,Ze.g)(o,this._color)||((0,Ze.c)(this._color,o),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(o){o!==this._polygonOffset&&(this._polygonOffset=o,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(o){this._writeDepthEnabled!==o&&(this._writeDepthEnabled=o,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(o){o!==this._innerWidth&&(this._innerWidth=o,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(o){(0,Ze.g)(o,this._innerColor)||((0,Ze.c)(this._innerColor,o),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(o){const d=(0,g.pC)(o)!==(0,g.pC)(this._stipplePattern);this._stipplePattern=o,d?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(o){((0,g.Wi)(o)||(0,g.Wi)(this._stippleOffColor)||!(0,Ze.g)(o,this._stippleOffColor))&&(this._stippleOffColor=(0,g.pC)(o)?(0,pt.a)(o):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(o){o!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=o,this._updateMaterial())}get falloff(){return this._falloff}set falloff(o){o!==this._falloff&&(this._falloff=o,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(o){o!==this._extensionType&&(this._extensionType=o,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,g.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(o){this._laserlineStyle=o,(0,g.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,g.pC)(o)&&(this._externalResources.laserline.style=o))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(o){this._laserlineEnabled!==o&&(this._laserlineEnabled=o,(0,g.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(o){this._fadedExtensions=(0,g.Pt)(o,jn),this.recreateGeometry()}_updateMaterial(){(0,g.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,g.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(o){const d=this._extensionType===we.FADED?this._updateLineSegmentFinite(Fn):this._updateLineSegmentInfinite(this._extensionType,Fn);this._updateVertexAttributes(o,d),(0,g.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=d)}_updateLineSegmentFinite(o){return(0,Ue.zk)(this._start,this._end,o)}_updateLineSegmentInfinite(o,d){const c=this.view.state.camera;switch((0,Nt.iL)(this._ray,Je),o){case we.LINE:Je.c0=-Number.MAX_VALUE;break;case we.RAY:case we.GROUND_RAY:{const u=this._ray.origin,f=(0,g.Pt)(this.view.elevationProvider.getElevation(u[0],u[1],u[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),v=this.view.renderCoordsHelper.getAltitude(u);this._isWorldDown&&v<f&&(0,w.o)(Je.ray.direction,Je.ray.direction),this._extensionType===we.GROUND_RAY&&null!=f&&(Je.c1=Math.abs(v-f));break}}if(!(0,ss.zq)(c.frustum,Je))return(0,Ue.zk)(this._start,this._end,d);const h=(0,Nt.Ws)(Je,ot),p=(0,Nt.S$)(Je,as);return(0,Ue.zk)(h,p,d)}_updateVertexAttributes(o,d){const c=o.geometries[0].getMutableAttribute(Wn.T.POSITION).data;if(this.extensionType===we.FADED){const h=(0,Ue.KU)(d,-this.fadedExtensions.start,ot);c[0]=h[0],c[1]=h[1],c[2]=h[2];const p=(0,Ue.KU)(d,0,ot);c[3]=p[0],c[4]=p[1],c[5]=p[2];const u=(0,Ue.KU)(d,1,ot);c[6]=u[0],c[7]=u[1],c[8]=u[2];const f=(0,Ue.KU)(d,1+this.fadedExtensions.end,ot);c[9]=f[0],c[10]=f[1],c[11]=f[2]}else{const h=(0,Ue.KU)(d,0,ot);c[0]=h[0],c[1]=h[1],c[2]=h[2];const p=(0,Ue.KU)(d,1,ot);c[3]=p[0],c[4]=p[1],c[5]=p[2]}o.geometryVertexAttrsUpdated(o.geometryRecords[0])}}const Je=(0,Nt.Ue)(),ot=(0,R.c)(),as=(0,R.c)(),Fn=(0,Ue.Ue)();var we;!function(l){l[l.LINE=0]="LINE",l[l.RAY=1]="RAY",l[l.GROUND_RAY=2]="GROUND_RAY",l[l.FADED=3]="FADED"}(we||(we={}));const Un=1/3,jn={start:Un,end:Un};var le=m(67831);class ls extends Bt._{constructor(o){super(o),this._handles=new ge.Z,this._location=(0,R.c)(),this._direction=(0,R.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,pt.f)(1,0,1,1),this._renderOccluded=ne.yD.OccludeAndTransparent,this.applyProps(o)}get location(){return this._location}set location(o){(0,w.k)(this._location,o)||((0,w.c)(this._location,o),this._updateGeometry())}get direction(){return this._direction}set direction(o){(0,w.k)(this._direction,o)||((0,w.c)(this._direction,o),this._updateGeometry())}setDirectionFromPoints(o,d){(0,w.n)(this._direction,(0,w.b)(this._direction,d,o)),this._updateGeometry()}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get offset(){return this._offset}set offset(o){o!==this._offset&&(this._offset=o,this._updateGeometry())}get length(){return this._length}set length(o){o!==this._length&&(this._length=o,this._updateGeometry())}get color(){return this._color}set color(o){(0,Ze.g)(o,this._color)||((0,Ze.c)(this._color,o),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}createExternalResources(){const o=new st.U(this.materialParameters);this._handles.add((0,M.YP)(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:o}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(o){const d=(0,nt.rh)([(0,R.c)(),(0,R.c)()]),c=(0,nt.rh)([(0,R.c)(),(0,R.c)()]),h=(0,g.Wg)(this._externalResources).material;o.addGeometry(d,h),o.addGeometry(c,h),this._updateVertices(o)}forEachExternalMaterial(o){(0,g.pC)(this._externalResources)&&o(this._externalResources.material)}_updateMaterial(){(0,g.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const o=this.object;(0,g.Wi)(o)||this._updateVertices(o)}_updateVertices(o){const d=this.view.state.camera;d.projectToScreen(this.location,Xt),(0,w.a)(je,this.location,this.direction),d.projectToScreen(je,ut),(0,le.f)(ut,(0,le.a)(ut,ut,Xt)),this._updateVertexAttributes(d,o,0,Xt,ut,1),this._updateVertexAttributes(d,o,1,Xt,ut,-1)}_updateVertexAttributes(o,d,c,h,p,u){const f=d.geometryRecords[c],v=f.geometry.getMutableAttribute(Wn.T.POSITION).data,S=(0,le.b)(Gn,(0,le.s)(Gn,p[1]*u,p[0]*-u),this.offset+this.width/2),P=(0,le.j)(kt,(0,le.j)(kt,(0,le.j)(kt,h,(0,le.b)(kt,p,this.length/2)),S),S),x=(0,le.j)(Nn,P,(0,le.b)(Nn,p,-this.length));o.unprojectFromScreen(P,je),v[0]=je[0],v[1]=je[1],v[2]=je[2],o.unprojectFromScreen(x,je),v[3]=je[0],v[4]=je[1],v[5]=je[2],d.geometryVertexAttrsUpdated(f)}}const je=(0,R.c)(),Xt=(0,Ce.s1)(),ut=(0,Ce.s1)(),Gn=(0,Ce.s1)(),kt=(0,Ce.s1)(),Nn=(0,Ce.s1)();var Yn=m(21232),ds=m(77603),ie=m(36460),Pe=m(26352),I=m(44725),pn=m(5286);class Kt extends pn.r{constructor(o,d,c=Pe.B.ALL){super(d,c),this.intersectionPoint=o}equals(o){return o instanceof Kt&&(0,I.Xv)(this.intersectionPoint,o.intersectionPoint)}}var ke=m(62160);class Qt extends pn.r{constructor(o,d,c,h=Pe.B.ALL){super(c,h),this.lineStart=o,this.lineEnd=d}equals(o){return o instanceof Qt&&(0,I.Xv)(this.lineStart,o.lineStart)&&(0,I.Xv)(this.lineEnd,o.lineEnd)}}var cs=m(19038);class wt extends pn.r{constructor(o,d,c,h,p=Pe.B.ALL){super(h,p),this.previousVertex=o,this.centerVertex=d,this.nextVertex=c}equals(o){return o instanceof wt&&(0,I.Xv)(this.previousVertex,o.previousVertex)&&(0,I.Xv)(this.centerVertex,o.centerVertex)&&(0,I.Xv)(this.nextVertex,o.nextVertex)}}class hs{draw(o,d){const c=this._getUniqueHints(o),h=[];for(const p of c)p instanceof Kt&&h.push(this.visualizeIntersectionPoint(p,d)),p instanceof ke.w&&h.push(this.visualizeLine(p,d)),p instanceof Qt&&h.push(this.visualizeParallelSign(p,d)),p instanceof wt&&h.push(this.visualizeRightAngleQuad(p,d)),p instanceof cs.n&&h.push(this.visualizePoint(p,d));return(0,Ve.AL)(h)}_getUniqueHints(o){const d=[];for(const c of o){let h=!0;for(const p of d)if(c.equals(p)){h=!1;break}h&&d.push(c)}return d}}var de=m(25858);class ps extends hs{visualizeIntersectionPoint(o,d){const{coordinateHelper:c,view:h}=d;return(0,Ve.ed)(new Yn.L({view:h,primitive:"circle",geometry:c.vectorToPoint(o.intersectionPoint),elevationInfo:(0,g.Pt)(o.elevationInfo,d.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ae.Z.toUnitRGBA(ie.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(o,d){const{view:c,coordinateHelper:h}=d,p=this._alignPoint(o.point,o.domain,d);return(0,Ve.ed)(new Yn.L({view:c,primitive:"circle",geometry:h.vectorToPoint(p),elevationInfo:this._hintElevationInfo(o,d),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ae.Z.toUnitRGBA(ie.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(o,d){const{view:c,coordinateHelper:h}=d,p=this._alignPoint(o.lineStart,o.domain,d),u=this._alignPoint(o.lineEnd,o.domain,d);return(0,Ve.ed)(this._createLineSegmentHintFromMap(o.type,p,u,h,this._hintElevationInfo(o,d),c,o.fadeLeft,o.fadeRight))}visualizeParallelSign(o,d){const{view:c,coordinateHelper:h}=d,p=this._hintElevationInfo(o,d),u=this._alignPoint(o.lineStart,o.domain,d),f=this._alignPoint(o.lineEnd,o.domain,d),v=(0,de.$r)(u,h,p,c),S=(0,de.$r)(f,h,p,c),P=(0,w.h)(S,v,S,.5),x=new ls({view:c,attached:!1,offset:ie.c.parallelLineHintOffset,length:ie.c.parallelLineHintLength,width:ie.c.parallelLineHintWidth,color:ae.Z.toUnitRGBA(ie.c.orange),location:P,renderOccluded:ne.yD.Opaque});return x.setDirectionFromPoints(v,P),x.attached=!0,(0,Ve.ed)(x)}visualizeRightAngleQuad(o,d){const{view:c,coordinateHelper:h}=d,p=this._hintElevationInfo(o,d),u=this._alignPoint(o.previousVertex,o.domain,d),f=this._alignPoint(o.centerVertex,o.domain,d),v=this._alignPoint(o.nextVertex,o.domain,d);return(0,Ve.ed)(new ds.R({view:c,attached:!0,color:ae.Z.toUnitRGBA(ie.c.orange),renderOccluded:ne.yD.Transparent,outlineRenderOccluded:ne.yD.Opaque,outlineColor:ae.Z.toUnitRGBA(ie.c.orange),outlineSize:ie.c.rightAngleHintOutlineSize,size:ie.c.rightAngleHintSize,geometry:{previous:(0,de.$r)(u,h,p,c),center:(0,de.$r)(f,h,p,c),next:(0,de.$r)(v,h,p,c)}}))}_createLineSegmentHintFromMap(o,d,c,h,p,u,f=!0,v=!0){const S=(0,R.c)(),P=(0,R.c)();return(0,de.By)(d,c,h,p,u,S,P),this._createLineSegmentHint(o,u,S,P,f,v)}_createLineSegmentHint(o,d,c,h,p=!0,u=!0){const f=new rs({view:d,extensionType:we.FADED,start:c,end:h,color:ae.Z.toUnitRGBA(ie.c.orange),renderOccluded:ne.yD.Opaque});switch(o){case I.ze.TARGET:f.width=ie.c.lineHintWidthTarget,f.fadedExtensions={start:0,end:ie.c.lineHintFadedExtensions};break;case I.ze.REFERENCE_EXTENSION:f.width=ie.c.lineHintWidthReference,f.fadedExtensions={start:0,end:0};break;case I.ze.REFERENCE:f.width=ie.c.lineHintWidthReference,f.fadedExtensions={start:p?ie.c.lineHintFadedExtensions:0,end:u?ie.c.lineHintFadedExtensions:0}}return f.attached=!0,f}_alignPoint(o,d,c){const h=this._getSelfSnappingZ(d,c);if((0,g.Wi)(h))return o;const p=c.coordinateHelper,u=p.vectorToPoint(o,us);return u.z=h,p.pointToVector(u)}_hintElevationInfo(o,d){return(0,g.pC)(this._getSelfSnappingZ(o.domain,d))?(0,g.Wg)(d.selfSnappingZ).elevationInfo:(0,g.Pt)(o.elevationInfo,d.elevationInfo)}_getSelfSnappingZ(o,{selfSnappingZ:d}){return o===Pe.B.SELF&&(0,g.pC)(d)?d.value:null}}const us=new Mt.Z;var rt=m(87469),Bn=m(78260),gt=m(4794),at=m(54889);const G={main:new ae.Z([255,127,0]),selected:new ae.Z([255,255,255]),staged:new ae.Z([12,207,255]),outline:new ae.Z([0,0,0,.5]),selectedOutline:new ae.Z([255,255,255])};function Ot(l,o){const d=l.clone();return d.a*=o,d}function gs(l,o){const d=l.clone(),c=(0,Bn._Y)(d);c.s*=o;const h=(0,Bn.xr)(c);return d.r=h.r,d.g=h.g,d.b=h.b,d}function ze(l,o){if(o)for(const d in o)l[d]=o[d]}class fs{constructor(o){this.color=G.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=ne.yD.Opaque,ze(this,o)}}class un{constructor(o){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=G.main,this.outlineColor=G.outline,this.renderOccluded=ne.yD.Opaque,this.hoverOutlineColor=G.selectedOutline,ze(this,o)}apply(o,d){const c=this[o];d.setParameters({color:$e(c),transparent:"color"!==o||c.a<1,renderOccluded:this.renderOccluded})}}class ms{constructor(o){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ot(G.main,.5),this.hoverColor=G.main,this.renderOccluded=ne.yD.Transparent,this.minSquaredEdgeLength=900,ze(this,o)}apply(o,d){const c=this[o];d.setParameters({color:$e(c),transparent:c.a<1,renderOccluded:this.renderOccluded})}}class vs{constructor(o){this.vertex=new un({color:G.main,outlineColor:G.outline}),this.edge=new un({color:gs(Ot(G.main,2/3),.5),outlineColor:Ot(G.outline,.5),size:8,collisionPadding:8}),this.selected=new un({color:G.selected,outlineColor:G.outline}),this.edgeOffset=new ms,ze(this,o)}}class gn{constructor(o){this.color=G.selected,this.width=1.5,this.stipplePattern=(0,at.z5)(5),this.stippleOffColor=G.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=G.selected,this.renderOccluded=ne.yD.OccludeAndTransparent,ze(this,o)}apply(o){o.color=$e(this.color),o.width=this.width,o.stipplePattern=this.stipplePattern,o.stippleOffColor=$e(this.stippleOffColor),o.falloff=this.falloff,o.innerWidth=this.innerWidth,o.innerColor=$e(this.innerColor),o.renderOccluded=this.renderOccluded}}class _s{constructor(o){this.color=G.selected,this.size=4,this.outlineSize=1,this.outlineColor=G.outline,this.shape="square",ze(this,o)}apply(o){o.color=$e(this.color),o.size=this.size,o.outlineSize=this.outlineSize,o.outlineColor=$e(this.outlineColor),o.primitive=this.shape}}class Jt{constructor(o){this.innerColor=G.selected,this.innerWidth=1,this.glowColor=G.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=G.main,ze(this,o)}apply(o,d=1){const c={glowColor:ae.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ae.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*d,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in o?o.style=c:o.laserlineStyle=c}}class ys{constructor(o){this.outline=new gn({color:G.outline,renderOccluded:ne.yD.OccludeAndTransparentStencil,stippleOffColor:G.selected,stipplePattern:(0,at.z5)(5),width:1.5,innerWidth:0}),this.staged=new gn({color:G.selected,renderOccluded:ne.yD.OccludeAndTransparentStencil,innerColor:G.staged,stippleOffColor:G.outline,stipplePattern:(0,at.z5)(5),width:1.5}),this.shadowStyle=new Jt({globalAlpha:.3,glowColor:G.main,glowFalloff:8,glowWidth:8,innerColor:G.selected,innerWidth:1}),ze(this,o)}}class Ss{constructor(o){this.outline=new _s({color:G.selected,outlineColor:G.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Jt({globalAlpha:.3,glowColor:G.main,glowFalloff:1.5,glowWidth:6,innerColor:G.selected,innerWidth:1,radius:2}),ze(this,o)}}class Cs extends gn{constructor(o){super(),this.extensionType=we.GROUND_RAY,ze(this,o)}}class Ps{constructor(o){this.lineGraphics=new ys,this.pointGraphics=new Ss,this.heightPlane=new Jt({globalAlpha:.3,glowColor:G.main,glowFalloff:8,glowWidth:8,innerColor:G.selected,innerWidth:1}),this.heightBox=new Jt({globalAlpha:.3,glowColor:G.main,glowFalloff:8,glowWidth:8,innerColor:G.selected,innerWidth:0,heightFillColor:G.main}),this.zVerticalLine=new Cs({color:Ot(G.main,.5),falloff:2,innerColor:Ot(G.selected,0),renderOccluded:ne.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:we.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,ze(this,o)}}function $e(l){return(0,gt.b)(ae.Z.toUnitRGBA(l))}const mt=new class Es{constructor(o){this.visualElements=new Ps,this.reshapeManipulators=new vs,this.zManipulator=new fs,ze(this,o)}colorToVec4(o){return $e(o)}};var Ms=m(79112),xs=m(81468),Xn=m(42743),kn=m(81040);class Os extends Bt._{constructor(o){super(o),this.view=null,this._renderOccluded=ne.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=mt.colorToVec4(mt.reshapeManipulators.vertex.color),this._size=mt.reshapeManipulators.vertex.size,this._outlineColor=mt.colorToVec4(mt.reshapeManipulators.vertex.outlineColor),this._outlineSize=mt.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(o)}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(o){this._vertices=o,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(o){this._spatialReference=o,this.recreateGeometry()}get color(){return this._color}set color(o){(0,Ze.g)(o,this._color)||((0,Ze.c)(this._color,o),this._updateMaterial())}get size(){return this._size}set size(o){o!==this._size&&(this._size=o,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(o){(0,Ze.g)(o,this._outlineColor)||((0,Ze.c)(this._outlineColor,o),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(o){o!==this._outlineSize&&(this._outlineSize=o,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(o){this._elevationInfo=o,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const o=this.vertices;if((0,g.Wi)(o)||0===o.length)return[];const h=function ws(l,o,d,c,h){const p=new Float64Array(3*l.length),u=new Float64Array(p.length);l.forEach((S,P)=>{p[3*P+0]=S[0],p[3*P+1]=S[1],p[3*P+2]=S.length>2?S[2]:0});const f=(0,xs.rR)(p,o,0,u,0,p,0,p.length/3,d,c,h);return{numVertices:l.length,position:p,mapPosition:u,projectionSuccess:null!=f,sampledElevation:f}}(o,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ms.o.fromElevationInfo(this.elevationInfo)),p=[],u=h.numVertices,f=h.position;for(let v=0;v<u;++v){const S=(0,w.s)(Ts,f[3*v+0],f[3*v+1],f[3*v+2]),P=Kn(.5,S),x=Kn(.5,S);p.push({vertexGeometry:P,vertexOutlineGeometry:x})}return p}createGeometries(o){const d=this._createRenderGeometries();for(const{vertexGeometry:c,vertexOutlineGeometry:h}of d)o.addGeometry(c,this._vertexMaterial),o.addGeometry(h,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new kn.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Xn.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new kn.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:Xn.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(o){o(this._vertexMaterial),o(this._vertexOutlineMaterial)}}const Ts=(0,R.c)();function Kn(l,o){return(0,nt.PI)(l,16,16,{offset:o})}var Ls=m(79967),Ds=m(50017),Rs=m(466),bs=m(97737),As=m(79682);let lt=class extends Y.Z{constructor(l){super(l),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,y._)([(0,C.Cb)({constructOnly:!0})],lt.prototype,"layer",void 0),(0,y._)([(0,C.Cb)()],lt.prototype,"enabled",void 0),(0,y._)([(0,C.Cb)()],lt.prototype,"updating",void 0),(0,y._)([(0,C.Cb)()],lt.prototype,"availability",void 0),lt=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],lt);const Qn=lt;let Oe=class extends Y.Z{constructor(l){super(l),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new T.Z,this.distance=ie.c.distance,this.touchSensitivityMultiplier=ie.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,y._)([(0,C.Cb)()],Oe.prototype,"enabled",void 0),(0,y._)([(0,C.Cb)()],Oe.prototype,"enabledToggled",void 0),(0,y._)([(0,C.Cb)()],Oe.prototype,"selfEnabled",void 0),(0,y._)([(0,C.Cb)()],Oe.prototype,"featureEnabled",void 0),(0,y._)([(0,C.Cb)({type:T.Z.ofType(Qn)})],Oe.prototype,"featureSources",void 0),(0,y._)([(0,C.Cb)()],Oe.prototype,"distance",void 0),(0,y._)([(0,C.Cb)()],Oe.prototype,"touchSensitivityMultiplier",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],Oe.prototype,"effectiveEnabled",null),(0,y._)([(0,C.Cb)({readOnly:!0})],Oe.prototype,"effectiveSelfEnabled",null),(0,y._)([(0,C.Cb)({readOnly:!0})],Oe.prototype,"effectiveFeatureEnabled",null),Oe=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.SnappingOptions")],Oe);const Jn=Oe;var _t,Hs=m(88159),$n=m(83308),q=m(60507),vt=m(33351),Vs=m(75897),Is=m(97979),Tt=m(22823);class qn extends Tt.j{constructor({coordinateHelper:o,targetPoint:d,constraint:c,previousVertex:h,otherVertex:p,otherVertexType:u,objectId:f,elevationInfo:v}){super(o,d,c,v,Pe.B.SELF),this.previousVertex=h,this.otherVertex=p,this.otherVertexType=u,this.objectId=f}get hints(){const o=this.previousVertex,d=this.otherVertexType===_t.CENTER?this.otherVertex:this.targetPoint,c=this.otherVertexType===_t.CENTER?this.targetPoint:this.otherVertex,h=this.elevationInfo;return[new ke.w(I.ze.TARGET,d,c,h,this.domain),new ke.w(I.ze.REFERENCE,o,d,h,this.domain),new wt(this.previousVertex,d,c,h,this.domain)]}}!function(l){l[l.NEXT=0]="NEXT",l[l.CENTER=1]="CENTER"}(_t||(_t={}));let Ke=class extends hn.r{constructor(l){super(l),this.options=null,this._domain=Pe.B.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}get updating(){return(0,Hs.oE)(this.snappingSources,({snappingSource:l})=>l.updating)||this.updatingHandles.updating}get snappingSources(){const l=this._get("snappingSources")||new Map,o=new Map;if((0,g.pC)(this.options)&&(0,g.pC)(this.options.featureSources))for(const d of this.options.featureSources.items){const c=d.layer.uid,h=l.get(c);if(h){l.delete(c),o.set(c,h);continue}if(!d.layer.loaded){this.updatingHandles.addPromise(d.layer.load());continue}const p=this._createSourceInfo(d);(0,g.pC)(p)&&o.set(c,p)}for(const[,d]of l)d.destroy();return o}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),M.Z_),(0,g.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",l=>this._updateLayerView(l.layer,l.layerView)),this.view.on("layerview-destroy",l=>this._updateLayerView(l.layer,null))])}_updateLayerView(l,o){for(const[,d]of this.snappingSources)d.snappingSource.layerSource.layer===l&&(d.layerView=o)}destroy(){this._set("options",null);for(const[,l]of this.snappingSources)l.destroy()}fetchCandidates(l,o,d,c){var h=this;return(0,A.Z)(function*(){if(!(o&h._domain)||(0,g.Wi)(h.options)||!h.options.effectiveFeatureEnabled)return[];const p=[],u=h._computeScreeenSizeDistanceParameters(l,d),f={distance:u,point:l,coordinateHelper:d.coordinateHelper,types:h._types};for(const[,{snappingSource:S,layerView:P}]of h.snappingSources)!S.layerSource.enabled||(0,g.pC)(P)&&P.suspended||p.push(S.fetchCandidates(f,c).then(x=>x.filter(L=>!h._candidateIsExcluded(S,L,d.excludeFeature))));const v=(yield(0,it.WW)(p)).flat();return h._addRightAngleCandidates(v,l,u,d),(0,it.k_)(c),(0,I.lQ)(l,v,d.coordinateHelper),v})()}_addRightAngleCandidates(l,o,d,c){const h=(0,g.pC)(c.vertexHandle)?c.vertexHandle.rightEdge?.rightVertex?.pos:(0,g.pC)(c.editGeometryOperations)&&"polygon"===c.editGeometryOperations.data.type?(0,g.Wg)(c.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,p=(0,g.pC)(c.vertexHandle)?c.vertexHandle.leftEdge?.leftVertex?.pos:(0,g.pC)(c.editGeometryOperations)?(0,g.Wg)(c.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,{view:u}=this,f=(0,I.Z_)(h,u,c),v=(0,I.Z_)(p,u,c),S=l.length;for(let P=0;P<S;P++)this._addRightAngleCandidate(l[P],v,o,d,c,l),this._addRightAngleCandidate(l[P],f,o,d,c,l)}_addRightAngleCandidate(l,o,d,c,h,p){const u=l instanceof Vs.L,f=u&&(0,le.o)(l.constraint.start,l.constraint.end);if((0,g.Wi)(o)||!u||f)return;const v=l.constraint.closestTo(o),S=(v[0]-d[0])/c.x,P=(v[1]-d[1])/c.y;if(S*S+P*P<=1){const x=h.coordinateHelper,L=new qn({coordinateHelper:x,targetPoint:v,otherVertex:o,otherVertexType:_t.NEXT,previousVertex:l.constraint.start,constraint:new vt.aU(x,o,v),objectId:l.objectId,elevationInfo:l.elevationInfo});p.push(L)}}_computeScreeenSizeDistanceParameters(l,o){let d=(0,g.pC)(this.options)?this.options.distance*("touch"===o.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,g.Wi)(this.view)?{x:d,y:d,z:d,distance:d}:"2d"===this.view.type?(d*=this.view.resolution,{x:d,y:d,z:d,distance:d}):this._computeScreenSizeDistanceParameters3D(l,d,this.view,o)}_computeScreenSizeDistanceParameters3D(l,o,d,c){const{coordinateHelper:h,elevationInfo:p}=c,{spatialReference:u}=h,f=h.hasZ()?q.jG:p,v=h.toXYZ(l,Ws);v[2]=(0,q.zx)(d,v,u,f,q.jG),d.renderCoordsHelper.toRenderCoords(v,u,ei);const S=d.state.camera.computeScreenPixelSizeAt(ei),P=S*d.renderCoordsHelper.unitInMeters/d.mapCoordsHelper.unitInMeters,x=o*P,L=(0,de.Rs)(v,u,q.jG,d),z=fn(L,v,P,0,0,d,c),V=fn(L,v,0,P,0,d,c),U=fn(L,v,0,0,P,d,c);return{x:0===z?0:x/z,y:0===V?0:x/V,z:0===U?0:x/U,distance:S*o}}get _types(){return $n.r.EDGE|$n.r.VERTEX}_candidateIsExcluded(l,o,d){if((0,g.Wi)(d))return!1;const c=this._getCandidateObjectId(o);if((0,g.Wi)(c))return!1;const h=l.layerSource.layer;return"graphics"===h.type?d.uid===c:d.sourceLayer===h&&!(!d.attributes||!("objectIdField"in h))&&d.attributes[h.objectIdField]===c}_getCandidateObjectId(l){return l instanceof Is.a?l.objectId:null}_createSourceInfo(l){const o=this._createFeatureSnappingSourceType(l);if((0,g.Wi)(o))return null;if("loading"in o)return this.updatingHandles.addPromise(o.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const d=(0,g.pC)(this.view)?this.view.allLayerViews.find(c=>c.layer===l.layer):null;return new Zs(o.source,d)}_createFeatureSnappingSourceType(l){switch(l.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(l);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(l);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(l);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(l)}return null}_createFeatureSnappingSourceSceneLayer(l){const{view:o}=this;if((0,g.Wi)(o)||"3d"!==o.type)return null;const d=this._getSourceModule("scene");return(0,g.pC)(d.module)?{source:new d.module.SceneLayerSnappingSource({layerSource:l,view:o})}:{loading:d.loader}}_createFeatureSnappingSourceFeatureLayer(l){switch(l.layer.source.type){case"feature-layer":case"oriented-imagery":{const o=this._getSourceModule("featureService");return(0,g.pC)(o.module)?{source:new o.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===l.layer.geometryType)return null;const o=this._getSourceModule("featureCollection");return(0,g.pC)(o.module)?{source:new o.module.FeatureCollectionSnappingSource({layerSource:l,view:this.view})}:{loading:o.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(l){const o=this._getSourceModule("graphics");return(0,g.pC)(o.module)?{source:new o.module.GraphicsSnappingSource({getGraphicsLayers:()=>[l.layer],spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}_createFeatureSnappingSourceMapNotesLayer(l){const o=this._getSourceModule("notes");return(0,g.pC)(o.module)?{source:new o.module.GraphicsSnappingSource({getGraphicsLayers:()=>(0,g.pC)(l.layer.sublayers)?l.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}_getSourceModule(l){const o=this._sourceModules[l];if((0,g.Wi)(o.loader)){const d=this._loadSourceModule(l).then(c=>{o.module=c});return o.loader=d,{module:o.module,loader:d}}return{module:o.module,loader:o.loader}}_loadSourceModule(l){const o=this.updatingHandles;switch(l){case"featureService":return o.addPromise(Promise.all([m.e(8592),m.e(8740)]).then(m.bind(m,78740)));case"featureCollection":return o.addPromise(Promise.all([m.e(8592),m.e(8176)]).then(m.bind(m,78176)));case"graphics":case"notes":return o.addPromise(Promise.all([m.e(3464),m.e(8592),m.e(6269)]).then(m.bind(m,66269)));case"scene":return o.addPromise(Promise.all([m.e(8592),m.e(7566)]).then(m.bind(m,57566)))}return null}};(0,y._)([(0,C.Cb)({constructOnly:!0})],Ke.prototype,"spatialReference",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],Ke.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],Ke.prototype,"options",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],Ke.prototype,"updating",null),(0,y._)([(0,C.Cb)({readOnly:!0})],Ke.prototype,"snappingSources",null),Ke=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],Ke);class Zs{constructor(o,d){this.snappingSource=o,this.layerView=d,this.handles=new ge.Z;const c=this.snappingSource.layerSource.layer;"refresh"in c&&this.handles.add(c.on("refresh",()=>o.refresh())),this.handles.add([(0,M.YP)(()=>o.updating,h=>o.layerSource.updating=h,M.tX),(0,M.YP)(()=>o.availability,h=>o.layerSource.availability=h,M.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function fn(l,o,d,c,h,p,{coordinateHelper:u}){const f=(0,w.c)(Fs,o);f[0]+=d,f[1]+=c,f[2]+=h;const v=(0,de.Rs)(f,u.spatialReference,q.jG,p);return(0,I.fG)(v,l)}const Ws=(0,R.c)(),ei=(0,R.c)(),Fs=(0,R.c)();var Us=m(61885);class $t{constructor(o,d){this.view=o,this.options=d,this.squaredShortLineThreshold=ie.c.shortLineThreshold*ie.c.shortLineThreshold}snap(o,d){return(0,g.pC)(d.vertexHandle)?"vertex"!==d.vertexHandle.type?[]:this.snapExistingVertex(o,d):this.snapNewVertex(o,d)}edgeExceedsShortLineThreshold(o,d){return this.exceedsShortLineThreshold(o.leftVertex.pos,o.rightVertex.pos,d)}exceedsShortLineThreshold(o,d,{elevationInfo:c,editGeometryOperations:h}){const p=h.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,I.Bb)((0,de.a7)(d,p,c,this.view),(0,de.a7)(o,p,c,this.view))>this.squaredShortLineThreshold}squaredProximityThreshold(o){return"touch"===o?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:o,touchSensitivityMultiplier:d}=this.options,c=o*d;return c*c}}class js extends Tt.j{constructor({coordinateHelper:o,lineStart:d,lineEnd:c,targetPoint:h,elevationInfo:p}){super(o,h,new vt.jg(o,d,c),p,Pe.B.SELF),this._referenceLineHint=new ke.w(I.ze.REFERENCE_EXTENSION,d,c,p,this.domain)}get hints(){return[this._referenceLineHint,new ke.w(I.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var Gs=m(26362),Lt=m(396);class Ns extends $t{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.edges.length,p=[];if(h<1)return p;const f=(0,de.a7)(o,d.coordinateHelper,q.jG,this.view),{view:v}=this,S=c.edges[h-1];let P=S;do{if(this.edgeExceedsShortLineThreshold(P,d)){const x=(0,I._j)(P,v,d);this._processCandidateProposal(x.left,x.right,o,f,d,p)}P=P.leftVertex.leftEdge}while(P&&P!==S);return p}snapExistingVertex(o,d){const c=[],h=(0,g.Wg)(d.vertexHandle),p=h.component;if(p.edges.length<2)return c;const{view:u}=this,{coordinateHelper:f}=d,v=(0,de.a7)(o,f,q.jG,u),S=h.leftEdge,P=h.rightEdge;S&&P&&this.edgeExceedsShortLineThreshold(S,d)&&this.edgeExceedsShortLineThreshold(P,d)&&this._processCandidateProposal((0,I.Z_)(S.leftVertex.pos,u,d),(0,I.Z_)(P.rightVertex.pos,u,d),o,v,d,c);const x=p.edges[0];let L=x;do{if(L!==h.leftEdge&&L!==h.rightEdge&&this.edgeExceedsShortLineThreshold(L,d)){const z=(0,I._j)(L,u,d);this._processCandidateProposal(z.left,z.right,o,v,d,c)}L=L.rightVertex.rightEdge}while(L&&L!==x);return c}_processCandidateProposal(o,d,c,h,p,u){const{coordinateHelper:f,pointer:v}=p;f.toXYZ(o,ti),f.toXYZ(d,ni);const S=f.toXYZ(c,Bs),P=(0,Gs.ZE)(S,Ys),x=f.fromXYZ(P);(0,I.Bb)(h,(0,de.a7)(x,f,q.jG,this.view))<this.squaredProximityThreshold(v)&&u.push(new js({coordinateHelper:f,lineStart:o,lineEnd:d,targetPoint:x,elevationInfo:f.hasZ()?q.jG:null}))}}const ti=(0,R.c)(),ni=(0,R.c)(),Ys={start:ti,end:ni,type:Lt.SP.LINE},Bs=(0,R.c)();var Dt=m(99770);class Xs extends Tt.j{constructor({coordinateHelper:o,referenceLine:d,lineStart:c,targetPoint:h,elevationInfo:p}){const u=o.toXYZ(c,ks),f=o.toXYZ(d.left,Ks),v=o.toXYZ(d.right,Qs);(0,w.b)(u,(0,w.a)(u,u,v),f),super(o,h,new vt.jg(o,c,o.fromXYZ(u)),p,Pe.B.SELF),this._referenceLines=[{edge:d,fadeLeft:!0,fadeRight:!0}]}get hints(){const o=this.elevationInfo;return[new ke.w(I.ze.TARGET,this.constraint.start,this.targetPoint,o,this.domain),new Qt(this.constraint.start,this.targetPoint,o,this.domain),...this._referenceLines.map(d=>new ke.w(I.ze.REFERENCE,d.edge.left,d.edge.right,o,this.domain,d.fadeLeft,d.fadeRight))]}addReferenceLine(o){const d={edge:o,fadeLeft:!0,fadeRight:!0},{coordinateHelper:c}=this;this._referenceLines.forEach(h=>{c.equals(o.right,h.edge.left)&&(h.fadeLeft=!1,d.fadeRight=!1),c.equals(o.right,h.edge.right)&&(h.fadeRight=!1,d.fadeRight=!1),c.equals(o.left,h.edge.right)&&(h.fadeRight=!1,d.fadeLeft=!1),c.equals(o.left,h.edge.left)&&(h.fadeLeft=!1,d.fadeLeft=!1)}),this._referenceLines.push(d)}}const ks=(0,R.c)(),Ks=(0,R.c)(),Qs=(0,R.c)();class Js extends $t{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.edges.length,p=c.vertices.length,u=[];if(h<2)return u;const{view:f}=this,v=(0,de.a7)(o,d.coordinateHelper,q.jG,f),S=(0,I.Z_)(c.vertices[p-1].pos,f,d),P=(0,I.Z_)(c.vertices[0].pos,f,d),x=c.edges[h-1];let L=x;do{if(this.edgeExceedsShortLineThreshold(L,d)){const z=(0,I._j)(L,f,d);this._checkEdgeForParalleLines(z,S,o,v,d,u),this._checkEdgeForParalleLines(z,P,o,v,d,u)}L=L.leftVertex.leftEdge}while(L&&L!==x);return u}snapExistingVertex(o,d){const c=[],h=(0,g.Wg)(d.vertexHandle),p=h.component;if(p.edges.length<3)return c;const{view:u}=this,f=(0,de.a7)(o,d.coordinateHelper,q.jG,u),v=h.leftEdge,S=h.rightEdge,P=p.vertices[0],x=(0,I.Z_)(P.pos,u,d),z=p.vertices[p.vertices.length-1],V=(0,I.Z_)(z.pos,u,d),U=p.edges[0];let X=U;do{if(X!==v&&X!==S&&this.edgeExceedsShortLineThreshold(X,d)){const fe=(0,I._j)(X,u,d);v&&this._checkEdgeForParalleLines(fe,(0,I.Z_)(v.leftVertex.pos,u,d),o,f,d,c),S&&this._checkEdgeForParalleLines(fe,(0,I.Z_)(S.rightVertex.pos,u,d),o,f,d,c),h===P?this._checkEdgeForParalleLines(fe,V,o,f,d,c):h===z&&this._checkEdgeForParalleLines(fe,x,o,f,d,c)}X=X.rightVertex.rightEdge}while(X&&X!==U);return c}_checkEdgeForParalleLines(o,d,c,h,p,u){const f=o.left,v=o.right;if((0,Lt.k0)(yt,d,f,v),(0,le.k)(yt,d)<ie.c.parallelLineThreshold)return;(0,Lt.k0)(yt,c,f,v,d);const{coordinateHelper:S,pointer:P}=p,x=S.fromXYZ(yt,S.getZ(c,0));if((0,I.Bb)(h,(0,de.a7)(x,S,q.jG,this.view))<this.squaredProximityThreshold(P)){if(this._parallelToPreviousCandidate(o,u))return;u.push(new Xs({coordinateHelper:S,referenceLine:o,lineStart:d,targetPoint:x,elevationInfo:S.hasZ()?q.jG:null}))}}_parallelToPreviousCandidate(o,d){const c=o.left,h=o.right;for(const p of d)if((0,Lt.k0)(yt,h,p.constraint.start,p.constraint.end,c),(0,le.k)(yt,h)<ie.c.parallelLineThreshold)return p.addReferenceLine(o),!0;return!1}}const yt=(0,Dt.a)();class $s extends $t{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=c.vertices.length,p=[];if(h<2)return p;const{view:u}=this,f=(0,de.a7)(o,d.coordinateHelper,q.jG,u),v=c.vertices[h-1];if(this.edgeExceedsShortLineThreshold(v.leftEdge,d)){const P=(0,I.Z_)(v.pos,u,d),x=(0,I._j)(v.leftEdge,u,d);this._checkForSnappingCandidate(p,x,P,o,x.left,P,d,o,f)}const S=c.vertices[0];if(this.edgeExceedsShortLineThreshold(S.rightEdge,d)){const P=(0,I.Z_)(S.pos,u,d),x=(0,I._j)(S.rightEdge,u,d);this._checkForSnappingCandidate(p,x,P,o,x.right,P,d,o,f)}return p}snapExistingVertex(o,d){const c=[],h=(0,g.Wg)(d.vertexHandle),p=h.component,u=p.vertices.length;if(u<3)return c;const{view:f}=this,v=(0,de.a7)(o,d.coordinateHelper,q.jG,f),S=h.leftEdge,P=h.rightEdge,x=p.vertices[0],L=p.vertices[u-1];if(!S){const z=x.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(z,d)){const V=(0,I._j)(z,f,d),U=(0,I.Z_)(x.rightEdge.rightVertex.pos,f,d);this._checkForSnappingCandidate(c,V,U,o,V.right,U,d,o,v)}return c}if(!P){const z=L.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(z,d)){const V=(0,I._j)(z,f,d),U=(0,I.Z_)(L.leftEdge.leftVertex.pos,f,d);this._checkForSnappingCandidate(c,V,U,o,V.left,U,d,o,v)}return c}if(S&&S.leftVertex.leftEdge){const z=S.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(z,d)){const V=(0,I._j)(z,f,d),U=(0,I.Z_)(S.leftVertex.pos,f,d);this._checkForSnappingCandidate(c,V,U,o,V.left,U,d,o,v)}}if(P&&P.rightVertex.rightEdge){const z=P.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(z,d)){const V=(0,I._j)(z,f,d),U=(0,I.Z_)(P.rightVertex.pos,f,d);this._checkForSnappingCandidate(c,V,U,o,V.right,U,d,o,v)}}return c}_checkForSnappingCandidate(o,d,c,h,p,u,f,v,S){const{coordinateHelper:P,pointer:x}=f;(0,le.a)(Rt,d.right,d.left);const L=(0,w.s)(to,Rt[1],-Rt[0],0),z=(0,le.h)(L,(0,le.a)(Rt,h,c))/(0,le.v)(L),V=P.fromXYZ((0,le.w)(Rt,u,L,z),P.getZ(v,0));if((0,I.Bb)(S,(0,de.a7)(V,P,q.jG,this.view))<this.squaredProximityThreshold(x)){const U=P.toXYZ(u,qs),X=(0,w.z)(eo,U,L,Math.sign(z)),fe=P.fromXYZ(X);o.push(new qn({coordinateHelper:P,targetPoint:V,constraint:new vt.aU(P,u,fe),previousVertex:p,otherVertex:u,otherVertexType:_t.CENTER,elevationInfo:P.hasZ()?q.jG:null}))}}}const Rt=(0,Dt.a)(),qs=(0,R.c)(),eo=(0,R.c)(),to=(0,R.c)();class no extends Tt.j{constructor({coordinateHelper:o,targetPoint:d,point1:c,point2:h,elevationInfo:p}){super(o,d,new vt.UL(o,o.arrayToVector((0,le.l)(io,c,h,.5)),.5*(0,le.d)(c,h)),p,Pe.B.SELF),this._p1=c,this._p2=h}get hints(){const o=this.elevationInfo;return[new ke.w(I.ze.REFERENCE,this.targetPoint,this._p1,o,this.domain),new ke.w(I.ze.REFERENCE,this.targetPoint,this._p2,o,this.domain),new wt(this._p1,this.targetPoint,this._p2,o,this.domain)]}}const io=(0,Dt.a)();class so extends $t{snapNewVertex(o,d){const c=d.editGeometryOperations.data.components[0],h=[],p=c.vertices.length;if("polygon"!==d.editGeometryOperations.data.type||p<2)return h;const{view:u}=this,v=c.vertices[p-1],S=(0,I.Z_)(c.vertices[0].pos,u,d),P=(0,I.Z_)(v.pos,u,d);return this._processCandidateProposal(S,P,o,d,h),h}snapExistingVertex(o,d){const c=[],h=(0,g.Wg)(d.vertexHandle),p=h.component;if(p.edges.length<2||"polyline"===d.editGeometryOperations.data.type&&(0===h.index||h.index===p.vertices.length-1))return c;const{view:u}=this,f=(0,I.Z_)(h.leftEdge.leftVertex.pos,u,d),v=(0,I.Z_)(h.rightEdge.rightVertex.pos,u,d);return this._processCandidateProposal(f,v,o,d,c),c}_processCandidateProposal(o,d,c,h,p){if(!this.exceedsShortLineThreshold(o,d,h))return;const u=(0,le.l)(oo,o,d,.5),f=.5*(0,le.d)(o,d),v=(0,Lt.xO)(ro,c,u,f),{coordinateHelper:S,pointer:P}=h,x=S.fromXYZ(v,S.getZ(c,0)),L=(0,de.a7)(c,S,q.jG,this.view);(0,I.Bb)(L,(0,de.a7)(x,S,q.jG,this.view))<this.squaredProximityThreshold(P)&&p.push(new no({coordinateHelper:S,targetPoint:x,point1:o,point2:d,elevationInfo:S.hasZ()?q.jG:null}))}}const oo=(0,Dt.a)(),ro=(0,Dt.a)();let St=class extends Y.Z{constructor(l){super(l),this.updating=!1,this._snappers=new T.Z,this._domain=Pe.B.SELF}initialize(){this._snappers.push(new Js(this.view,this.options),new Ns(this.view,this.options),new $s(this.view,this.options),new so(this.view,this.options))}set options(l){this._set("options",l);for(const o of this._snappers)o.options=l}fetchCandidates(l,o,d){var c=this;return(0,A.Z)(function*(){if(!(o&c._domain&&c.options.effectiveSelfEnabled))return[];const h=[];for(const p of c._snappers.items)for(const u of p.snap(l,d))h.push(u);return(0,I.lQ)(l,h,d.coordinateHelper),h})()}};function ao(l,o){return[new St({view:l,options:o}),new Ke({view:l,options:o,spatialReference:l.spatialReference})]}(0,y._)([(0,C.Cb)({readOnly:!0})],St.prototype,"updating",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],St.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],St.prototype,"options",null),St=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.SelfSnappingEngine")],St);class qt extends Tt.j{constructor(o,d,c,h,p){super(o,d,new vt.Bq(o,d,c.constraint,h.constraint),p,Pe.B.ALL),this.first=c,this.second=h}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Kt(this.targetPoint,this.elevationInfo,this.domain)]}}let Ge=class extends(Us.Z.EventedMixin(hn.r)){constructor(l){super(l),this.options=new Jn,this.snappingEnginesFactory=ao,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Qe.MAIN}initialize(){this.handles.add([(0,M.YP)(()=>{const{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:d,distance:c}=this.options;return{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:d,distance:c}},()=>{this.doneSnapping(),this.emit("changed")},M.Z_),(0,M.YP)(()=>this.options,l=>{for(const o of this._engines)o.options=l},M.Z_),(0,M.YP)(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:l,snappingEnginesFactory:o})=>this._recreateEngines(l,o),M.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(l=>l.updating)}_recreateEngines(l,o){if(this._destroyEngines(),!l)return;const{view:d,options:c}=this;this._engines=o(d,c)}_destroyEngines(){for(const l of this._engines)l.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:l,touchSensitivityMultiplier:o}=this.options,d=l*o;return d*d}snap(l){var o=this;return(0,A.Z)(function*(){return function lo(l){return(0,g.pC)(l.scenePoint)}(l)?o._snapMultiPoint(l):o._snapSinglePoint(l)})()}update(l){const{point:o,context:d}=l;this._removeVisualization();const c=this._currentMainCandidate;if((0,g.Wi)(c))return o;const h=this._selectUpdateInput(l);if((0,g.Wi)(h))return o;const{coordinateHelper:{spatialReference:p}}=d,u=(0,me.iV)(this._convertPointElevation(h,d),p);if((0,g.Wi)(u))return o;const{view:f}=this,{coordinateHelper:v,elevationInfo:S,visualizer:P}=d,x=[],L=v.pointToVector(u),z=c.constraint.closestTo(L);if(!this._arePointsWithinScreenThreshold(L,z,d))return this._resetSnappingState(),o;c.targetPoint=z,x.push(...c.hints);for(const U of this._currentOtherActiveCandidates)U.targetPoint=z,x.push(...U.hints);(0,g.pC)(P)&&this.handles.add(P.draw(x,{coordinateHelper:v,elevationInfo:ii(d),view:f,selfSnappingZ:d.selfSnappingZ}),en);const V=v.vectorToDehydratedPoint(z);return this._convertPointElevation(V,d,q.jG,S)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:l,scenePoint:o}){switch(this._currentSnappedType){case Qe.MAIN:return l;case Qe.SCENE:return o}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Qe.MAIN}_removeVisualization(){this.handles.remove(en)}_snapSinglePoint({point:l,context:o,signal:d}){var c=this;return(0,A.Z)(function*(){const{coordinateHelper:h}=o,{view:p}=c,u=c._convertPointElevation(l,o),f=h.pointToVector(u),v=yield c._fetchCandidates(f,Pe.B.ALL,o,d);return c._createSnapResult(f,Qe.MAIN,v,p,o,d)})()}_snapMultiPoint({point:l,scenePoint:o,context:d,signal:c}){var h=this;return(0,A.Z)(function*(){const{view:p}=h,{coordinateHelper:u}=d,{spatialReference:f}=u;yield(0,me.iQ)(o.spatialReference,f);const v=(0,me.iV)(h._convertPointElevation(o,d),f),S=u.pointToVector(v),P=yield h._fetchCandidates(S,Pe.B.FEATURE,d,c);if(P.length>0){const V=yield h._fetchCandidates(S,Pe.B.SELF,d,c);return h._createSnapResult(S,Qe.SCENE,[...P,...V],p,d,c)}const x=h._convertPointElevation(l,d),L=u.pointToVector(x),z=yield h._fetchCandidates(L,Pe.B.SELF,d,c);return h._createSnapResult(L,Qe.MAIN,z,p,d,c)})()}_fetchCandidates(l,o,d,c){var h=this;return(0,A.Z)(function*(){return(yield Promise.all(h._engines.map(p=>p.fetchCandidates(l,o,d,c)))).flat()})()}_createSnapResult(l,o,d,c,h,p){return{get valid(){return!(0,it.Hc)(p)},apply:()=>{const{elevationInfo:u,coordinateHelper:f}=h,{snappedPoint:v,hints:S}=this._processCandidates(l,o,d,h);return this._removeVisualization(),(0,g.pC)(h.visualizer)&&this.handles.add(h.visualizer.draw(S,{coordinateHelper:f,elevationInfo:ii(h),view:c,selfSnappingZ:h.selfSnappingZ}),en),this._convertPointElevation(v,h,q.jG,u)}}}_processCandidates(l,o,d,c){const{coordinateHelper:h}=c;if(d.length<1)return this.doneSnapping(),{snappedPoint:h.vectorToDehydratedPoint(l),hints:[]};this._currentSnappedType!==o&&this._resetSnappingState(),(0,I.lQ)(l,d,h);const p=this._currentMainCandidate;if((0,g.pC)(p)){const u=this._findOldConstraintInNewCandidates(p,d);if(u>=0){if(!(d[u]instanceof qt))return this._intersectWithOtherCandidates(u,d,l,o,c);if(this._arePointsWithinScreenThreshold(l,p.targetPoint,c))return this._updateSnappingCandidate(p,o,d,c)}}return this._intersectWithOtherCandidates(0,d,l,o,c)}_findOldConstraintInNewCandidates(l,o){return l instanceof qt?this._findOldCandidateIndex(o,l.first)>=0&&this._findOldCandidateIndex(o,l.second)>=0?0:-1:this._findOldCandidateIndex(o,l)}_intersectWithOtherCandidates(l,o,d,c,h){const{coordinateHelper:p}=h,u=o[l],f=[];for(let v=0;v<o.length;++v){if(v===l)continue;const S=o[v];for(const P of u.constraint.intersect(S.constraint)){const x=p.fromXYZ(P.closestTo(u.targetPoint),u.targetPoint[2]);f.push([new qt(p,x,u,S,S.elevationInfo),this._squaredScreenDistance(d,x,p)])}}return f.length>0&&(f.sort((v,S)=>v[1]-S[1]),f[0][1]<this._squaredPointProximityThreshold(h.pointer))?this._updateSnappingCandidate(f[0][0],c,o,h):this._updateSnappingCandidate(u,c,o,h)}_updateSnappingCandidate(l,o,d,c){this.doneSnapping(),this._currentMainCandidate=l,this._currentSnappedType=o;const h=this._currentMainCandidate.targetPoint,p=[];p.push(...l.hints);for(const u of d){if(l instanceof qt){if(u.constraint.equals(l.first.constraint)||u.constraint.equals(l.second.constraint))continue}else if(u.constraint.equals(l.constraint))continue;u.constraint.check(h)&&(u.targetPoint=h,this._currentOtherActiveCandidates.push(u),p.push(...u.hints))}return{snappedPoint:c.coordinateHelper.vectorToDehydratedPoint(h),hints:p}}_squaredPointProximityThreshold(l){return"touch"===l?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(l,o,d){return this._squaredScreenDistance(l,o,d.coordinateHelper)<this._squaredPointProximityThreshold(d.pointer)}_squaredScreenDistance(l,o,d){return(0,I.Bb)(this._toScreen(l,d),this._toScreen(o,d))}_toScreen(l,o){return(0,de.a7)(l,o,q.jG,this.view)}_findOldCandidateIndex(l,o){let d=-1;for(let c=0;c<l.length;++c)if(o.constraint.equals(l[c].constraint)){d=c;break}return d}_convertPointElevation(l,o,d=o.elevationInfo,c=q.jG){const{view:h}=this;if(!((0,g.pC)(l)&&o.coordinateHelper.hasZ()&&(0,g.pC)(h)&&"3d"===h.type))return l;const p=(0,jt.d9)(l);return p.z=(0,q.vQ)(h,p,d,c),p}get test(){return{visualizationsActive:this.handles.has(en),engines:this._engines}}};var Qe;(0,y._)([(0,C.Cb)({constructOnly:!0})],Ge.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],Ge.prototype,"options",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],Ge.prototype,"updating",null),(0,y._)([(0,C.Cb)()],Ge.prototype,"snappingEnginesFactory",void 0),(0,y._)([(0,C.Cb)()],Ge.prototype,"_engines",void 0),(0,y._)([(0,C.Cb)()],Ge.prototype,"_squaredMouseProximityTreshold",null),(0,y._)([(0,C.Cb)()],Ge.prototype,"_squaredTouchProximityThreshold",null),Ge=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.SnappingManager")],Ge),function(l){l[l.MAIN=0]="MAIN",l[l.SCENE=1]="SCENE"}(Qe||(Qe={}));const en="visualization-handle";function ii({coordinateHelper:l,elevationInfo:o}){return l.hasZ()?q.jG:o}const tn=new Map;class si{constructor(o){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=o.editGeometryOperations,this.elevationInfo=o.elevationInfo,this.pointer=o.pointer,this.vertexHandle=o.vertexHandle,this.excludeFeature=o.excludeFeature,this.visualizer=o.visualizer,this.selfSnappingZ=o.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}var uo=m(53639),nn=m(87091);class go{constructor(){this.next=new Ie.hM}createSnapDragEventPipelineStep({predicate:o=(()=>!0),cancel:d,snappingManager:c,snappingContext:h,updatingHandles:p,useZ:u=!0}){if((0,g.Wi)(c))return V=>V;let f=null,v=null;const S=()=>{f=(0,g.IM)(f),c.doneSnapping(),(0,g.pC)(v)&&v.frameTask.remove(),v=null};d.next(V=>(S(),V)),this.next=new Ie.hM;const P=this._createSnapFunction(c,u);let x=null,L=null,z=null;return V=>{if(!o(V))return V;if("start"===V.action){const U=this._createFrameTask(c.view);if(v=this._createSnappingInfo(h,V,U),v.context.selfSnappingZ=null,!u&&(0,g.pC)(V.info)){const X=this._extractSelfSnappingZ(h.coordinateHelper,V.info.handle.component);(0,g.pC)(X)&&(v.context.selfSnappingZ={value:X,elevationInfo:h.elevationInfo})}}if((0,g.pC)(v)){const{context:U,originalScenePos:X,originalPos:fe}=v,{mapEnd:ci,mapStart:hi,action:Zo,scenePoints:Wo}=V,_n=this._updatePosition(fe,this._computeMapDelta(ci,hi)),pi=this._computeMapDelta(hi,fe),Fo={...V,action:"update"},Uo=v.context,yn=this._updateScenePosition(X,Wo),ui=c.update({point:_n,scenePoint:yn,context:U});if(z=ui,this._applySnappedUpdate(ci,ui,pi,u),x=_n,L=yn,"end"!==Zo){const{frameTask:jo}=v;(0,g.Wi)(f)&&(f=new AbortController),p.addPromise((0,it.R8)(P({frameTask:jo,event:Fo,context:Uo,point:_n,scenePoint:yn,delta:pi,lastPos:x,lastScenePos:L,lastUpdate:z},f.signal)))}}return"end"===V.action&&S(),V}}_createSnapFunction(o,d){var c=this;return(0,it.Ds)(function(){var h=(0,A.Z)(function*({frameTask:p,point:u,scenePoint:f,context:v,event:S,delta:P,lastPos:x,lastScenePos:L,lastUpdate:z},V){const U=yield p.schedule(()=>o.snap({point:u,scenePoint:f,context:v,signal:V}),V);if(U.valid){let X=yield p.schedule(()=>U.apply(),V);u!==x&&(0,g.pC)(x)&&(X=o.update({point:x,scenePoint:L,context:v})),(0,uo.k)(X,z)||(c._applySnappedUpdate(S.mapEnd,X,P,d),c.next.execute(S))}});return function(p,u){return h.apply(this,arguments)}}())}_createFrameTask(o){return"3d"===o.type?o.resourceController.scheduler.registerTask(nn.T8.SNAPPING):nn.sq}_createSnappingInfo(o,d,c){return{context:new si({editGeometryOperations:o.editGeometryOperations,elevationInfo:o.elevationInfo,pointer:o.pointer,vertexHandle:(0,g.pC)(d.info)?d.info.handle:null,excludeFeature:o.excludeFeature,visualizer:o.visualizer}),originalPos:(0,g.pC)(d.snapOrigin)?o.coordinateHelper.vectorToDehydratedPoint(d.snapOrigin):d.mapStart,originalScenePos:(0,g.pC)(d.scenePoints)?d.scenePoints.sceneStart:null,frameTask:c}}_updatePosition(o,[d,c,h]){const p=(0,oe.WG)(o);return p.x+=d,p.y+=c,p.hasZ&&(p.z+=h),p}_updateScenePosition(o,d){return(0,g.Wi)(o)||(0,g.Wi)(d)?null:this._updatePosition(o,this._computeMapDelta(d.sceneEnd,d.sceneStart))}_computeMapDelta(o,d){return[o.x-d.x,o.y-d.y,o.hasZ&&d.hasZ?o.z-d.z:0]}_applySnappedUpdate(o,d,[c,h,p],u){o.x=d.x+c,o.y=d.y+h,u&&o.hasZ&&d.hasZ&&(o.z=d.z+p)}_extractSelfSnappingZ(o,d){if(!o.hasZ())return null;const c=d.vertices;let h=null;for(const p of c){const u=o.getZ(p.pos);if((0,g.pC)(h)&&Math.abs(u-h)>1e-6)return null;(0,g.Wi)(h)&&(h=u)}return h}}let dt=class extends Y.Z{constructor(l){var o;super(l),o=this,this.constrainResult=d=>d,this._snapPoints=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,it.Ds)(function(){var d=(0,A.Z)(function*(c,h,p,u){const f=yield o._frameTask.schedule(()=>h.snap({...c,context:p,signal:u}),u);f.valid&&(yield o._frameTask.schedule(()=>{o.stagedPoint=f.apply(),c!==o._snapPoints&&(0,g.pC)(o._snapPoints)&&(o.stagedPoint=h.update({...o._snapPoints,context:p}))},u))});return function(c,h,p,u){return d.apply(this,arguments)}}())}get stagedPoint(){return this._stagedPoint}set stagedPoint(l){this._stagedPoint=this.constrainResult(l)}initialize(){const l="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,g.pC)(l)?l.registerTask(nn.T8.SNAPPING):nn.sq}destroy(){this._abortController=(0,g.IM)(this._abortController),this._frameTask=(0,g.hw)(this._frameTask)}snap(l,o,d){var c=this;return(0,A.Z)(function*(){const{point:h,scenePoint:p}=l;return c.stagedPoint=o.update({point:h,scenePoint:p,context:d}),c._snapPoints=l,(0,g.Wi)(c._abortController)&&(c._abortController=new AbortController),c._snap(l,o,d,c._abortController.signal)})()}abort(){this._abortController=(0,g.IM)(this._abortController)}};(0,y._)([(0,C.Cb)({constructOnly:!0})],dt.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],dt.prototype,"stagedPoint",null),(0,y._)([(0,C.Cb)()],dt.prototype,"constrainResult",void 0),(0,y._)([(0,C.Cb)()],dt.prototype,"_stagedPoint",void 0),dt=(0,y._)([(0,ee.j)("esri.views.interactive.snapping.SnappingOperation")],dt);let Me=class extends hn.r{constructor(l){super(l),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new ge.Z,this._snappingPipeline=new go,this._snappingManagerResult=function co(l){if(!tn.has(l)){const c=function zs(l,o){const d=new Jn({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:o?.distance??ie.c.distance,touchSensitivityMultiplier:o?.touchSensitivityMultiplier??ie.c.touchSensitivityMultiplier});return{...(0,M.YP)(()=>l.map?.allLayers?.toArray()??[],c=>{d.featureSources=new T.Z(c.map(h=>new Qn({layer:h,enabled:!0})))},M.nn),options:d}}(l,{distance:10}),h=function po(l,o){return new Ge({view:l,options:o,snappingEnginesFactory:(d,c)=>[new Ke({view:l,spatialReference:l.spatialReference,options:c})]})}(l,c.options);tn.set(l,{referenceCount:0,snappingManager:h,remove:()=>{c.remove(),h.destroy()}})}const o=tn.get(l);o.referenceCount++;const d=(0,Ve.kB)(()=>function ho(l,o){o.referenceCount--,o.referenceCount>0||(0,As.Y)(()=>{0===o.referenceCount&&(o.remove(),tn.delete(l))})}(l,o));return{snappingManager:o.snappingManager,...d}}(l.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=mn(),this._focusedOffsetManipulatorMaterial=mn(),this._thinOffsetManipulatorMaterial=mn(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,at.z5)(2)}),this._constraintSnappingIndicator=new rt.r({view:l.view,attached:!0,width:1,color:ae.Z.toUnitRGBA(te.constraint.color),renderOccluded:ne.yD.OccludeAndTransparent,stipplePattern:(0,at.z5)(5)});const o=ae.Z.toUnitRGBA(te.disabledPointIndicator.color);o[3]*=te.disabledPointIndicator.opacity,this._stagedStartIndicator=new Os({view:l.view,attached:!1,color:o,size:2*te.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:l.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:ne.yD.OccludeAndTransparent})}initialize(){this._snappingOperation=new dt({view:this.view}),this._orientationManipulatorTexture=(0,is.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new Ls.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:ne.yD.Opaque});const{computations:l}=this.analysisViewData;for(const o of l)this._addComputation(o);this.addHandles([l.on("after-add",o=>this._addComputation(o.item)),l.on("after-remove",o=>this._removeComputation(o.item))]),this.addHandles([(0,M.YP)(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:o,stagedComputation:d})=>{if((0,g.Wi)(d)||(0,g.Wi)(o))return;const c=(0,oe.WG)(o,new Mt.Z);this._applyPointUpdate(d,{endPoint:c})},M.Z_),(0,M.YP)(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(o,d)=>{const{stagedDimension:c,selectedComputation:h,firstGrabbedManipulator:p}=o;if(c===d.stagedDimension&&p===d.firstGrabbedManipulator){for(const u of[h,d.selectedComputation])if((0,g.pC)(u)){const f=this._computationManipulators.get(u);this._updateManipulators(u,f,o)}}else for(const[u,f]of this._computationManipulators)this._updateManipulators(u,f,o)},M.tX),(0,M.YP)(()=>this.analysis.style.lineSize,o=>{this._updateManipulatorStyle(o)},M.nn),(0,M.YP)(()=>this.view.state.camera,()=>{(0,g.pC)(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)}),(0,M.YP)(()=>(0,g.yw)(this._stagedComputation,o=>{const d=o.elevationAlignedStartPoint,c=(0,R.c)();return(0,g.pC)(d)&&this.view.renderCoordsHelper.toRenderCoords(d,c)?c:null}),o=>{(0,g.pC)(o)?(this._stagedStartIndicator.vertices=[o],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles)}destroy(){this._snappingOperation=(0,g.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if((0,g.pC)(this._stagedComputation))return this._stagedComputation;const{selectedComputation:l}=this.analysisViewData;return this.hasGrabbedManipulators&&(0,g.pC)(l)?l:null}get _stagedComputation(){const l=this._stagedDimension,o=this.analysisViewData.computations.at(-1);return(0,g.Wi)(l)||(0,g.Wi)(o)||o.dimension!==l?null:o}get _constraintHandles(){return[(0,M.gx)(()=>this.analysisViewData.selectedComputation,l=>{l.previousConstraint=Gt(l,this.view)},{...M.tX,equals:jt.fS}),(0,M.YP)(()=>{const l=this._activeComputation;if((0,g.Wi)(l))return null;const{measureType:o,orientation:d}=l.dimension;return{measureType:o,orientation:d,computation:l}},(l,o)=>{if((0,g.pC)(l)&&(0,g.Wi)(o)){const{measureType:d,orientation:c,computation:h}=l;switch(h.previousConstraint){case Ae.Horizontal:h.preConstraintProperties={measureType:B.n.Horizontal,orientation:0};break;case Ae.Vertical:h.preConstraintProperties={measureType:B.n.Vertical,orientation:0};break;case Ae.Direct:h.preConstraintProperties={measureType:B.n.Direct,orientation:c};break;default:h.preConstraintProperties={measureType:d,orientation:c}}}(0,g.Wi)(l)&&(0,g.pC)(o)&&(o.computation.preConstraintProperties=null)},M.Z_)]}get _snappingIndicatorHandles(){const l="snapping-indicator-event-handles";return[(0,M.YP)(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:o,activeComputation:d})=>{const c=this._constraintSnappingIndicator;if(this.removeHandles(l),(0,g.Wi)(d))c.attached=!1;else if(d===o)c.attached=!0;else{const{start:h,end:p}=this._computationManipulators.get(d),u=()=>{c.attached=h.grabbing||p.grabbing};u(),this.addHandles([h.events.on("grab-changed",u),p.events.on("grab-changed",u)],l)}}),(0,M.YP)(()=>{const o=this._activeComputation;return(0,g.pC)(o)?{geometry:o.geometry,constraint:o.previousConstraint}:{}},({geometry:o,constraint:d})=>{const c=this._constraintSnappingIndicator;(0,g.pC)(o)&&(0,g.pC)(d)&&d!==Ae.Direct?(c.visible=!0,c.setGeometryFromSegment(o.directSegment)):c.visible=!1})]}removeStaged(){return!!(0,g.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(l){const{_stagedDimension:o}=this;if((0,g.Wi)(o)){const d=this._onUnstagedClick(l);return this.analysis.dimensions.add(d),null}return this._onStagedClick(l),o}onPointerMove({mapPoint:l,pointerType:o}){if("touch"===o)return;const d=this._snappingContext(o);this.updatingHandles.addPromise((0,it.R8)(this._snappingOperation.snap({point:l},this._snappingManager,d)))}onManipulatorSelectionChanged(){(0,g.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:l,pointerType:o}){let d=l;if("mouse"===o){const h=this._snappingContext(o);d=this._snappingManager.update({point:l,context:h})}const c=new ts.Z({startPoint:(0,oe.WG)(d,new Mt.Z),endPoint:null,measureType:B.n.Horizontal});return this._stagedDimension=c,this._resetSnappingState(),c}_onStagedClick({mapPoint:l,pointerType:o}){const d=this._stagedComputation;if((0,g.Wi)(d))return;let c=l;if("mouse"===o){const p=this._snappingContext(o);c=this._snappingManager.update({point:l,context:p})}const h=(0,oe.WG)(c,new Mt.Z);this._applyPointUpdate(d,{endPoint:h}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(l){if(this._computationManipulators.has(l))return;const o=this._setupPointManipulator(l,{isStart:!0}),d=this._setupPointManipulator(l,{isStart:!1}),c=this._setupOffsetManipulator(l),h=this._setupHeadingManipulator(l),p=this._setupRotationManipulator(l),u=this._setupMeasureTypeManipulator(l,B.n.Direct),f=this._setupMeasureTypeManipulator(l,B.n.Horizontal),v=this._setupMeasureTypeManipulator(l,B.n.Vertical),S=new zi({start:o,end:d,offset:c,heading:h,rotation:p,direct:u,horizontal:f,vertical:v});this._setupComputationToManipulatorsSync(l,S),this._computationManipulators.set(l,S),this.manipulators.addMany(S.values())}_removeComputation(l){const o=this._computationManipulators.get(l);if(!(0,g.Wi)(o)){this._computationHandles.remove(l),this._computationManipulators.delete(l);for(const d of o.values())this.manipulators.remove(d)}}_setupComputationToManipulatorsSync(l,o){this._computationHandles.add([(0,M.YP)(()=>l.geometry,()=>this._updateManipulators(l,o),{...M.tX,equals:jt.fS})],l)}_setupPointManipulator(l,o){const{view:d}=this,{dimension:c}=l,h=function Hi(l,o){const d=(0,Be.aD)(l,ae.Z.toUnitRGB(te.pointManipulators.color),te.pointManipulators.opacity,Xe);return d.available=!1,d.grabCursor="crosshair",d.radius=te.pointManipulators.radius,d.metadata=o.metadata,d.collisionPriority=1,d}(d,{metadata:c}),p=function Zi(l,{isStart:o,createSnappingPipelineStep:d,dimension:c,onUpdate:h,snappingPipeline:p,view:u}){const f=o?"startPoint":"endPoint";return[(0,Ie.Xd)(l,(S,P,x,L)=>{const z=(0,ct.J4)(S);x=x.next(z).next((0,Ie.di)(c,[f,"measureType","orientation"])),P.next(z).next((0,ct.gv)(u)).next(d(x,L),p.next).next(V=>{const U=(0,oe.WG)(V.mapEnd,new Mt.Z);h("startPoint"===f?{startPoint:U}:{endPoint:U})})})]}(h,{isStart:o.isStart,createSnappingPipelineStep:(u,f)=>this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(f),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles,cancel:u}),dimension:c,onUpdate:u=>{this._applyPointUpdate(l,u)},snappingPipeline:this._snappingPipeline,view:d});return this._computationHandles.add(p,l),h}_setupOffsetManipulator(l){const{view:o}=this,d=function Vi(l,o){const d=[(0,R.f)(-.5,0,0),(0,R.f)(.5,0,0)],{lengthFraction:c}=te.offsetManipulator,h=(0,nt.rh)(d.map(p=>(0,w.g)((0,R.c)(),p,c)));return new On.Z({view:l,renderObjects:[{geometry:h,material:o.unfocusedMaterial,stateMask:ht.Q9.Unfocused|ht.Q9.Selected|Xe},{geometry:h,material:o.focusedMaterial,stateMask:ht.Q9.Focused|Xe}],collisionType:{type:"line",paths:[d]},radius:dn(o.lineSizePt)/2,metadata:o.metadata,available:!1,...Be.X9})}(o,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:l.dimension}),c=function Wi(l,{computation:o,view:d}){return[(0,Ie.Xd)(l,(c,h,p)=>{if(!Et(o)||!c.selected)return;const{geometry:u,dimension:f}=o,v=(0,ct.J4)(c);h.next(v).next(An(d,f,u.dimensionSegment,u.primaryOffsetAxis)),p.next(v).next((0,Ie.di)(f,["offset"]))})]}(d,{computation:l,view:o});return this._computationHandles.add(c,l),d}_setupHeadingManipulator(l){const{view:o}=this,d=Dn(o,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:l.dimension}),c=function Fi(l,{computation:o,view:d}){return[(0,Ie.Xd)(l,(c,h,p)=>{bn({cancel:p,computation:o,settingHeading:!0,steps:h,view:d})})]}(d,{computation:l,view:o});return this._computationHandles.add(c,l),d}_setupRotationManipulator(l){const{view:o}=this,d=Dn(o,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:l.dimension}),c=function Ui(l,{computation:o,view:d}){return[(0,Ie.Xd)(l,(c,h,p)=>{bn({cancel:p,computation:o,settingHeading:!1,steps:h,view:d})}),l.events.on("immediate-click",c=>{!function ji(l,o,d){const{dimension:c,geometry:h}=o;if(90===c.orientation||270===c.orientation)return c.orientation=0,void l.stopPropagation();if((0,g.Wi)(h))return;const{renderCoordsHelper:p}=d,u=It({...Vt(o),orientation:90},p),f=It({...Vt(o),orientation:270},p);if((0,g.Wi)(u)||(0,g.Wi)(f))return;const v=an(u,p),S=an(f,p),P=zn(h,d),x=ln.BV.shortestSignedDiff(P,v),L=ln.BV.shortestSignedDiff(P,S);c.orientation=Math.abs(x)<Math.abs(L)?90:270,l.stopPropagation()}(c,o,d)})]}(d,{computation:l,view:o});return this._computationHandles.add(c,l),d}_setupMeasureTypeManipulator(l,o){const{view:d}=this,c=function Ii(l,o){const d=[(0,R.f)(-.5,0,0),(0,R.f)(.5,0,0)],{lengthFraction:c}=te.offsetManipulator,h=(0,nt.rh)(d),p=(0,nt.rh)(d.map(u=>(0,w.g)((0,R.c)(),u,c)));return new On.Z({view:l,renderObjects:[{geometry:p,material:o.unfocusedMaterial,stateMask:ht.Q9.Unfocused|Xe},{geometry:p,material:o.focusedMaterial,stateMask:ht.Q9.Focused|Xe},{geometry:h,material:o.thinOffsetManipulatorMaterial,stateMask:Xe}],collisionType:{type:"line",paths:[d]},radius:dn(o.lineSizePt)/2,available:!1,metadata:o.metadata,...Be.X9})}(d,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:l.dimension}),h=function Ni(l,{computation:o,manipulatorMeasureType:d,view:c}){let h=B.n.Direct,p=0,u=0;return[l.events.on("grab-changed",f=>{if("start"!==f.action||!Et(o))return;const{dimension:v,geometry:S}=o;h=v.measureType,p=v.offset,u=v.orientation;const P=(0,w.c)(Z.WM.get(),l.renderLocation);v.measureType=d,v.offset=function yi(l,o,d,c){const{directSegment:h}=d,p=Zt(Z.WM.get(),{measureType:o,directSegment:h,renderCoordsHelper:c}),u=En(Si,{offsetAxis:p,offset:0,relativeToSegment:h,renderCoordsHelper:c}).eval(.5,Z.WM.get()),f=(0,w.y)(Z.WM.get(),l,u);return(0,w.e)(f,p)*c.unitInMeters}(P,d,S,c.renderCoordsHelper),v.orientation=0}),(0,Ie.Xd)(l,(f,v,S)=>{if(!Et(o))return;const{geometry:P,dimension:x}=o,{renderCoordsHelper:L}=c,z=Cn(Zn,d,o,L),V=Zt(Z.WM.get(),{measureType:d,directSegment:P.directSegment,renderCoordsHelper:L}),U=(0,ct.J4)(f);v.next(U).next(An(c,x,z,V)),S.next(U).next(X=>(x.measureType=h,x.offset=p,x.orientation=u,X))})]}(c,{computation:l,manipulatorMeasureType:o,view:d});return this._computationHandles.add(h,l),c}_updateManipulators(l,o,d={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:c,selectedComputation:h,firstGrabbedManipulator:p}=d,{start:u,end:f,offset:v,heading:S,rotation:P}=o,x=h===l,L=Et(l),{dimension:z}=l;for(const X of o.values()){const fe=L&&(0,g.Wi)(c)&&((0,g.Wi)(p)||X===p);X===v?(X.available=fe,X.selected=x):X.available=fe&&x}if(!L)return;(0,g.pC)(Gt(l,this.view))?o.forEachMeasureTypeManipulator(X=>X.available=!1):o.manipulatorForMeasureType(z.measureType).available=!1;for(const X of[S,P])z.measureType===B.n.Direct&&0!==z.offset||(X.available=!1);sn(l)?P.available=!1:S.available=!1;const{geometry:V}=l;u.renderLocation=V.directSegment.startRenderSpace,f.renderLocation=V.directSegment.endRenderSpace;const{renderCoordsHelper:U}=this.view;(function Yi(l,o,d){const{dimensionSegment:c,primaryOffsetAxis:h}=o,p=rn(xt,o),u=(0,w.k)(p,R.Z)?(0,Q.i)(Ut):(0,Be.Aq)(p,h,R.Z,Ut),f=Math.max((0,w.l)(p),te.offsetManipulator.minLengthMeters/d.unitInMeters);(0,Q.k)(u,u,(0,w.s)(xt,f,f,f)),l.modelTransform=u,l.renderLocation=c.eval(.5,xt)})(v,V,U),S.available&&function Bi(l,o,d){Hn(l,o,d,{forHeading:!0})}(S,l,U),P.available&&function Xi(l,o,d){Hn(l,o,d,{forHeading:!1})}(P,l,U),o.forEachMeasureTypeManipulator((X,fe)=>{X.available&&function Qi(l,o,d,c){const{geometry:h}=o,p=Cn(Zn,d,o,c),u=Zt(xt,{measureType:d,directSegment:h.directSegment,renderCoordsHelper:c}),f=(0,w.y)(cn,p.endRenderSpace,p.startRenderSpace),v=(0,Be.Aq)(f,u,R.Z,Ut),S=(0,w.l)(f);(0,Q.k)(v,v,(0,w.s)(cn,S,S,S)),l.modelTransform=v,l.renderLocation=p.eval(.5,cn)}(X,l,fe,U)})}_updateManipulatorStyle(l){const o=function es(l){return(0,Ce.F2)(l)+te.offsetManipulator.linePaddingPx}(l),d=dn(l),c={lineSizePt:l,material:this._orientationManipulatorMaterial};for(const{offset:h,heading:p,rotation:u}of this._computationManipulators.values())h.radius=d/2,Rn(p,c),Rn(u,c);this._unfocusedOffsetManipulatorMaterial.setParameters({width:o}),this._focusedOffsetManipulatorMaterial.setParameters({width:d})}_snappingContext(l){return new si({elevationInfo:{mode:"absolute-height",offset:0},pointer:l,editGeometryOperations:new bs.c(new Rs.XE("point",(0,Ds.Y6)(!0,!1,this.view.spatialReference))),visualizer:new ps})}_applyPointUpdate(l,o){const{view:d}=this,c=Vt(l);"startPoint"in o&&(c.elevationAlignedStartPoint=o.startPoint),"endPoint"in o&&(c.elevationAlignedEndPoint=o.endPoint);const h=It(c,d.renderCoordsHelper);if((0,g.Wi)(h))return;const p=Gt({...c,geometry:h},d);(function ns(l,o,d){const{constraint:c,elevationAlignedStartPoint:h,elevationAlignedEndPoint:p,unconstrainedGeometry:u,view:f}=d,{dimension:v,previousConstraint:S,preConstraintProperties:P}=l;if((0,g.Wi)(h)||(0,g.Wi)(p))return;const x=()=>{"startPoint"in o?v.startPoint=o.startPoint:"endPoint"in o&&(v.endPoint=o.endPoint)};if((0,g.Wi)(c))x(),(0,g.pC)(S)&&(0,g.pC)(P)&&(v.measureType=P.measureType,v.orientation=P.orientation);else switch(v.measureType=B.n.Direct,c){case Ae.Horizontal:if(c!==S&&(v.orientation=0),"startPoint"in o){const L=o.startPoint;(0,g.pC)(L)&&(L.z=p.z),v.startPoint=L}else if("endPoint"in o){const L=o.endPoint;(0,g.pC)(L)&&(L.z=h.z),v.endPoint=L}break;case Ae.Vertical:if(c!==S&&(v.orientation=zn(u,f)),"startPoint"in o){const L=o.startPoint;(0,g.pC)(L)&&(L.x=p.x,L.y=p.y),v.startPoint=L}else if("endPoint"in o){const L=o.endPoint;(0,g.pC)(L)&&(L.x=h.x,L.y=h.y),v.endPoint=L}break;case Ae.Direct:c!==S&&(0,g.pC)(P)&&(v.orientation=P.orientation),x()}l.previousConstraint=c})(l,o,{...c,constraint:p,unconstrainedGeometry:h,view:d}),l===this._stagedComputation&&this._updateStagedDimensionOffset(l)}_updateStagedDimensionOffset(l){if((0,g.Wi)(l.geometry))return;l.geometry.directSegment.eval(.5,oi);const o=this.view.state.camera.computeRenderPixelSizeAt(oi);l.dimension.offset=te.initialOffsetPx*o}get testInfo(){const l=o=>this.analysisViewData.computations.find(d=>d.dimension===o);return{getManipulatorsForDimension:o=>this._computationManipulators.get(l(o)),getComputationForDimension:o=>l(o),getConstraintForDimension:o=>{const d=l(o);return(0,g.pC)(d)?Gt(d,this.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function mn(){const{color:l,opacity:o}=te.offsetManipulator;return new st.U({color:[...ae.Z.toUnitRGB(l),o],width:1,renderOccluded:ne.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,y._)([(0,C.Cb)({constructOnly:!0})],Me.prototype,"analysis",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],Me.prototype,"analysisViewData",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],Me.prototype,"manipulators",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],Me.prototype,"parentTool",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],Me.prototype,"view",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],Me.prototype,"updating",null),(0,y._)([(0,C.Cb)()],Me.prototype,"firstGrabbedManipulator",null),(0,y._)([(0,C.Cb)()],Me.prototype,"hasGrabbedManipulators",null),(0,y._)([(0,C.Cb)()],Me.prototype,"_stagedDimension",void 0),(0,y._)([(0,C.Cb)()],Me.prototype,"_activeComputation",null),(0,y._)([(0,C.Cb)()],Me.prototype,"_stagedComputation",null),Me=(0,y._)([(0,ee.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],Me);const oi=(0,R.c)();var fo=m(62483),mo=m(67857),vo=m(58997);const ri={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};var Ct,_o=m(41900);!function(l){l.Ready="ready",l.Creating="creating",l.Created="created"}(Ct||(Ct={}));let Te=class extends vo.f{constructor(l){super(l),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=te.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,fo.Z8)(this.view.state.viewingMode),this._intersector.options.store=mo.eC.MIN,this._lengthDimensionSubTool=new Me({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,Ve.ed)(this._lengthDimensionSubTool),(0,Ve.kB)(()=>this._clearPointerMoveTimeout()),(0,M.YP)(()=>this.state,l=>{l===Ct.Created&&this.finishToolCreation()},M.tX),(0,M.gx)(()=>this.firstGrabbedManipulator,l=>{this.selectedDimension=l.metadata},M.tX),(0,M.YP)(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),M.tX)])}get state(){return this.analysis.dimensions.some(l=>"length"===l.type)?(0,g.pC)(this._activeSubTool)?Ct.Creating:Ct.Created:Ct.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(l){this.analysisViewData.selectedDimension=l}onInputEvent(l){switch(l.type){case"immediate-click":this._clickHandler(l);break;case"immediate-double-click":this._doubleClickHandler(l);break;case"pointer-move":this._pointerMoveHandler(l);break;case"key-down":if(ri.cancel===l.key){if((0,g.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void l.stopPropagation();this.active||(this.selectedDimension=null)}else ri.delete.includes(l.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,g.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(l){if(this.hasFocusedManipulators)return void l.stopPropagation();if((0,g.Wi)(this._activeSubTool))return;const o=this._intersectScreen(l);(0,g.Wi)(o)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:o,pointerType:l.pointerType}),l.stopPropagation())}_doubleClickHandler(l){this.active&&(this.view.activeTool=null,l.stopPropagation())}_pointerMoveHandler(l){if(this._resetPointerMoveTimeout(),(0,g.Wi)(this._activeSubTool)||this.hasFocusedManipulators)return;const o=this._intersectScreen(l);(0,g.Wi)(o)||this._activeSubTool.onPointerMove({mapPoint:o,pointerType:l.pointerType})}_deleteKeyHandler(){(0,g.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(l){const o=(0,_o.Sj)(l);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(o,this._intersector);const d=this._intersector.results.min,c=Z.WM.get();return d.getIntersectionPoint(c)?this.view.renderCoordsHelper.fromRenderCoords(c,this.view.spatialReference):null}_removeSelected(){(0,g.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,g.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(l=>{l.manipulator.state|=Xe}),this._prevPointerMoveTimeout=Mi.m.setTimeout(()=>{this.manipulators.forEach(l=>{l.manipulator.state&=~Xe})},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:l=>{this._pointerMoveTimerMs=l,this._resetPointerMoveTimeout()}}}};(0,y._)([(0,C.Cb)({constructOnly:!0})],Te.prototype,"view",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0})],Te.prototype,"analysis",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],Te.prototype,"state",null),(0,y._)([(0,C.Cb)({readOnly:!0})],Te.prototype,"updating",null),(0,y._)([(0,C.Cb)({readOnly:!0})],Te.prototype,"cursor",null),(0,y._)([(0,C.Cb)({constructOnly:!0})],Te.prototype,"analysisViewData",void 0),(0,y._)([(0,C.Cb)()],Te.prototype,"selectedDimension",null),(0,y._)([(0,C.Cb)()],Te.prototype,"automaticManipulatorSelection",void 0),(0,y._)([(0,C.Cb)()],Te.prototype,"_activeSubTool",void 0),(0,y._)([(0,C.Cb)()],Te.prototype,"_lengthDimensionSubTool",void 0),Te=(0,y._)([(0,ee.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Te),m(52515);var yo=m(84600),So=m(68063),ai=m(79020),li=m(70591);class Co extends Bt._{constructor(o,d){super(o),this._hasExternalMaterial=!1,this._renderOccluded=ne.yD.OccludeAndTransparent,this._width=1,this._color=(0,pt.f)(1,0,1,1),this._placement="end",this._textureId=null,this._material=d,this._hasExternalMaterial=(0,g.pC)(d),this.applyProps(o)}setGeometryFromSegment(o,d){const c=o.endRenderSpace;this.transform=(0,Q.f)(Po,c),this._normal=d;const{points:h}=o.createRenderGeometry(c,this.view.renderCoordsHelper);this.geometry=[h]}get renderOccluded(){return(0,g.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(o){this._renderOccluded=o,(0,g.pC)(this._material)&&this._material.setParameters({renderOccluded:o})}get geometry(){return this._geometry}set geometry(o){this._geometry=o,this.recreateGeometry()}get normal(){return this._normal}set normal(o){this._normal=o,this.recreateGeometry()}get width(){return(0,g.pC)(this._material)?this._material.parameters.width:this._width}set width(o){this._width=o,(0,g.pC)(this._material)&&this._material.setParameters({width:o})}get color(){return(0,g.pC)(this._material)?this._material.parameters.color:this._color}set color(o){this._color=(0,pt.a)(o),(0,g.pC)(this._material)&&this._material.setParameters({color:this._color})}get placement(){return(0,g.pC)(this._material)?this._material.parameters.placement:this._placement}set placement(o){this._placement=o,(0,g.pC)(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return(0,g.pC)(this._material)?this._material.parameters.textureId:this._textureId}set textureId(o){this._textureId=o,(0,g.pC)(this._material)&&this._material.setParameters({textureId:o})}createExternalResources(){this._hasExternalMaterial||(this._material=new li.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(o){for(const d of(0,ai.c0)(this.geometry,this.normal)){const c=(0,ai.YU)(d);o.addGeometry(c,(0,g.Wg)(this._material))}}forEachExternalMaterial(o){this._hasExternalMaterial||o((0,g.Wg)(this._material))}}const Po=(0,he.c)();class Eo{constructor(o){this.destroyed=!1,this._handles=new ge.Z,this._messages=null,this._labelSegment=new ce.y;const{analysis:d,computation:c,view:h,messages:p}=o;this.analysis=d,this.computation=c,this.view=h,this._messages=p;const u=o.visible,f={view:h,attached:u},{fontSize:v,textColor:S,textBackgroundColor:P}=d.style;this._visualElements=new To({marker:new Co(f,o.markerMaterial),dimension:new rt.r(f,o.dimensionLineMaterial),startOffset:new rt.r(f,o.offsetLineMaterial),endOffset:new rt.r(f,o.offsetLineMaterial),dimensionSmall:new rt.r(f,o.smallDimensionLineMaterial),startOffsetSmall:new rt.r(f,o.smallOffsetLineMaterial),endOffsetSmall:new rt.r(f,o.smallOffsetLineMaterial),label:new So.Kc({view:h,attached:u,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,Ce.F2)(v),textColor:S.clone(),backgroundColor:P.clone()})}),this._handles.add([(0,M.YP)(()=>c.geometry,x=>{this.updateCameraDependentElements(h.state.camera,x,d.style),(0,g.pC)(c.geometry)&&this._updateLines(c.geometry)},{...M.nn,equals:jt.fS}),(0,M.YP)(()=>c.length,x=>this._updateLabelContent(x),M.nn)])}set visible(o){for(const d of this._visualElements.values())d.attached=o}destroy(){this.destroyed=!0,this._handles=(0,g.SC)(this._handles);for(const o of this._visualElements.values())o.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(o){const d=Sn(xo,Pt.Start,o.directSegment,o.dimensionSegment),c=Sn(wo,Pt.End,o.directSegment,o.dimensionSegment),h=this._visualElements;h.marker.setGeometryFromSegment(o.dimensionSegment,o.primaryOffsetAxis),h.dimension.setGeometryFromSegment(o.dimensionSegment),h.startOffset.setGeometryFromSegment(d),h.endOffset.setGeometryFromSegment(c),h.dimensionSmall.setGeometryFromSegment(o.dimensionSegment),h.startOffsetSmall.setGeometryFromSegment(d),h.endOffsetSmall.setGeometryFromSegment(c)}updateCameraDependentElements(o,d,c){const h=this._visualElements;if((0,g.Wi)(d)){for(const U of h.values())U.visible=!1;return}const p=o.computeScreenPixelSizeAt(d.dimensionSegment.eval(.5,Oo)),u=function Pi(l,o){return(0,w.p)(rn(Ei,l))/o**2}(d,p),f=u<((0,Ce.F2)(c.lineSize)*te.smallScreenLengthLineSizeFactor)**2,v=!f;h.marker.visible=v,h.dimension.visible=v,h.startOffset.visible=v,h.endOffset.visible=v,h.dimensionSmall.visible=f,h.startOffsetSmall.visible=f,h.endOffsetSmall.visible=f;const S=(0,Ce.F2)(c.fontSize)*te.labels.minScreenLengthFontSizeFactor,{label:P}=h;if(u<S**2)return void(P.visible=!1);P.visible=!0;const{dimensionSegment:x,primaryOffsetAxis:L}=d,{offset:z}=this.computation.dimension,V=(Math.sign(z)>=0?1:-1)*function Mo(l){return 1.5*(0,Ce.F2)(l.fontSize)+te.labels.marginPx+(0,Ce.F2)(l.lineSize/2)}(c)*p;(function fi(l,o,d,c){(0,w.z)(l.startRenderSpace,o.startRenderSpace,d,c),(0,w.z)(l.endRenderSpace,o.endRenderSpace,d,c)})(this._labelSegment,x,L,V),P.updateLabelPosition()}updateLabelStyle(o){const{label:d}=this._visualElements;d.fontSize=(0,Ce.F2)(o.fontSize),d.textColor=o.textColor,d.backgroundColor=o.textBackgroundColor}updateUnitsMessages(o){this._messages=o;const{length:d}=this.computation;this._updateLabelContent(d)}_updateLabelContent(o){const{label:d}=this._visualElements;d.text=(0,g.Wi)(o)||(0,g.Wi)(this._messages)?"":(0,yo.VG)(this._messages,o,o.unit)}}const xo=new ce.y,wo=new ce.y,Oo=(0,R.c)();class To{constructor(o){this.marker=o.marker,this.dimension=o.dimension,this.startOffset=o.startOffset,this.endOffset=o.endOffset,this.dimensionSmall=o.dimensionSmall,this.startOffsetSmall=o.startOffsetSmall,this.endOffsetSmall=o.endOffsetSmall,this.label=o.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Lo=m(52051);class Do{constructor(o,d){this._textures=o,this._textureRepository=d,this._texturesByPrimitive=new Map}acquire(o){if(!this._texturesByPrimitive.has(o)){const d=(0,Tn.uM)(this._textures,o),c=new Lo.T(this._textureRepository,d.texture.id);return this._texturesByPrimitive.set(o,{result:d,reference:c}),d.texture}return this._texturesByPrimitive.get(o).result.texture}destroy(){this._texturesByPrimitive.forEach(({result:o,reference:d})=>{d.dispose(),o.release()}),this._texturesByPrimitive.clear()}}var Ro=m(46359),bo=m(56683),Ao=m(41840);let qe=class extends Y.Z{constructor(l){super(l),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new li.X({width:1,anchor:Ro.i5.Tip,color:gt.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:ne.yD.OccludeAndTransparent}),this._dimensionLineMaterial=new st.U({width:1,color:gt.Z,renderOccluded:ne.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new st.U({width:1,color:gt.Z,renderOccluded:ne.yD.OccludeAndTransparent,stipplePattern:(0,at.z5)(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new st.U({width:1,color:gt.Z,renderOccluded:ne.yD.OccludeAndTransparent}),this._smallOffsetLineMaterial=new st.U({width:1,color:gt.Z,renderOccluded:ne.yD.OccludeAndTransparent,stipplePattern:(0,at.z5)(5),stippleScaleWithLineWidth:!0})}get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}initialize(){const{textures:l}=this.view.sharedSymbolResources;if((0,g.pC)(l)){const{textureRepository:d}=this.view._stage.renderView,c=new Do(l,d),h=c.acquire("triangle");this.addHandles((0,Ve.kB)(()=>c.destroy())),this._markerMaterial.setParameters({textureId:h.id})}for(const d of this._lineMaterials())this.view._stage.add(d),this.addHandles((0,Ve.kB)(()=>{this.view._stage.remove(d),d.dispose()}));const{computations:o}=this.analysisViewData;for(const d of o)this._addComputation(d);this.addHandles([o.on("change",({added:d,removed:c})=>{for(const h of c)this._removeComputation(h);for(const h of d)this._addComputation(h)}),(0,M.YP)(()=>ae.Z.toUnitRGBA(this.analysis.style.color),d=>{for(const c of this._lineMaterials())c.setParameters({color:d})},M.tX),(0,M.YP)(()=>this.analysis.style.lineSize,d=>{const c=(0,Ce.F2)(d);this._markerMaterial.setParameters({width:c*te.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:c,markerParameters:this._markerMaterial.parameters});const h=Math.max(c*te.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:h})},M.tX),(0,M.YP)(()=>({camera:this.view.state.camera,style:zo(this.analysis)}),({camera:d,style:c})=>{for(const[h,p]of this._dimensionVisualizations)p.updateCameraDependentElements(d,h.geometry,c),p.updateLabelStyle(c)}),(0,M.YP)(()=>this.visible,d=>{for(const c of this._dimensionVisualizations.values())c.visible=d})]),this.addHandles([(0,bo.qe)(()=>this._updateMessageBundle()),(0,M.gx)(()=>!this.loadingMessages,()=>{for(const d of this._dimensionVisualizations.values())d.updateUnitsMessages(this._messages)},M.Z_)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach(l=>{l.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const l of this._lineMaterials())l.setParameters({renderOccluded:ne.yD.Occlude})}}}_addComputation(l){this._dimensionVisualizations.has(l)||this._dimensionVisualizations.set(l,new Eo({analysis:this.analysis,computation:l,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(l){const o=this._dimensionVisualizations.get(l);(0,g.Wi)(o)||(o.destroy(),this._dimensionVisualizations.delete(l))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}_updateMessageBundle(){var l=this;return(0,A.Z)(function*(){l.loadingMessages=!0;try{l._messages=yield(0,Ao.ME)("esri/core/t9n/Units")}finally{l.loadingMessages=!1}})()}};function zo(l){const{fontSize:o,lineSize:d,textColor:c,textBackgroundColor:h}=l.style;return{fontSize:o,lineSize:d,textBackgroundColor:h.clone(),textColor:c.clone()}}(0,y._)([(0,C.Cb)({constructOnly:!0})],qe.prototype,"analysisViewData",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],qe.prototype,"view",void 0),(0,y._)([(0,C.Cb)()],qe.prototype,"analysis",null),(0,y._)([(0,C.Cb)()],qe.prototype,"visible",null),(0,y._)([(0,C.Cb)()],qe.prototype,"loadingMessages",void 0),qe=(0,y._)([(0,ee.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],qe);let bt=class extends Y.Z{constructor(l){super(l),this.dimension=null,this.length=null}};(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],bt.prototype,"dimension",void 0),(0,y._)([(0,C.Cb)()],bt.prototype,"length",void 0),bt=(0,y._)([(0,ee.j)("esri.views.3d.analysis.LengthDimensionResult")],bt);const Ho=bt;let He=class extends Y.Z{constructor(l){super(l),this.geometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(l){const{dimension:o,...d}=l;return{result:new Ho({dimension:o}),...d}}initialize(){this.addHandles([(0,M.YP)(()=>this.dimension.startPoint,l=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(l),M.tX),(0,M.YP)(()=>this.dimension.endPoint,l=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(l),M.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],He.prototype,"result",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],He.prototype,"projectAndAlignPoint",void 0),(0,y._)([(0,C.Cb)()],He.prototype,"dimension",null),(0,y._)([(0,C.Cb)()],He.prototype,"length",null),(0,y._)([(0,C.Cb)()],He.prototype,"geometry",void 0),(0,y._)([(0,C.Cb)()],He.prototype,"elevationAlignedStartPoint",void 0),(0,y._)([(0,C.Cb)()],He.prototype,"elevationAlignedEndPoint",void 0),(0,y._)([(0,C.Cb)()],He.prototype,"preConstraintProperties",void 0),(0,y._)([(0,C.Cb)()],He.prototype,"previousConstraint",void 0),He=(0,y._)([(0,ee.j)("esri.views.3d.analysis.LengthDimensionComputation")],He);var di=m(54865),vn=m(95925);const Vo=l=>{let o=class extends l{constructor(...d){super(...d),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new T.Z}createLengthDimensions(d){throw new Error("Method not implemented.")}};return(0,y._)([(0,C.Cb)({constructOnly:!0})],o.prototype,"view",void 0),(0,y._)([(0,C.Cb)({constructOnly:!0,nonNullable:!0})],o.prototype,"analysis",void 0),(0,y._)([(0,C.Cb)()],o.prototype,"tool",void 0),(0,y._)([(0,C.Cb)({readOnly:!0})],o.prototype,"results",null),(0,y._)([(0,C.Cb)()],o.prototype,"selectedDimension",void 0),(0,y._)([(0,C.Cb)()],o.prototype,"interactive",void 0),(0,y._)([(0,C.Cb)()],o.prototype,"visible",void 0),o=(0,y._)([(0,ee.j)("esri.views.analysis.DimensionAnalysisView")],o),o};let xe=class extends(Vo((0,We.p)(Y.Z))){constructor(l){super(l),this.type="dimension-view-3d",this.tool=null,this.computations=new T.Z,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=l=>{if((0,g.Wi)(l))return null;const{spatialReference:o,elevationProvider:d}=this.view,c=(0,di.G)(l,o,d);return(0,g.Wi)(c)&&(0,di.e)(this.analysis,l.spatialReference,W.Z.getLogger(this.declaredClass)),c},this.addHandles([(0,vn.Lp)(this,Te),(0,M.on)(()=>this.analysis.dimensions,"after-add",l=>this._onDimensionAdd(l.item),{onListenerAdd:l=>{for(const o of l)this._onDimensionAdd(o)},onListenerRemove:()=>{this._onDimensionsClear()}}),(0,M.on)(()=>this.analysis.dimensions,"after-remove",l=>this._onDimensionRemove(l.item))]),this._analysisVisualization=new qe({analysisViewData:this,view:this.view}),this._analysisController=new tt({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,g.IM)(this._placementTask),this._analysisVisualization=(0,g.SC)(this._analysisVisualization),(0,vn.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map(l=>this._dimensionsToComputations.get(l).result)}get selectedComputation(){const{selectedDimension:l}=this;return(0,g.Wi)(l)?null:this._dimensionsToComputations.get(l)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}createLengthDimensions(l){var o=this;return(0,A.Z)(function*(){return o.selectedDimension=null,o._placementTask=(0,g.IM)(o._placementTask),o._placementTask=(0,vn.Er)(o,l),o._placementTask.promise})()}_onDimensionAdd(l){const{computations:o,_dimensionsToComputations:d}=this;if(d.has(l))return;const c=new He({dimension:l,projectAndAlignPoint:this._projectAndAlignPoint});o.add(c),d.set(l,c)}_onDimensionRemove(l){const{computations:o,_dimensionsToComputations:d}=this,c=o.findIndex(p=>p.dimension===l),h=o.getItemAt(c);h.dimension===this.selectedDimension&&(this.selectedDimension=null),o.removeAt(c),d.delete(l),(0,g.SC)(h)}_onDimensionsClear(){this.computations.drain(l=>l.destroy()),this._dimensionsToComputations.clear()}};(0,y._)([(0,C.Cb)({readOnly:!0})],xe.prototype,"type",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"tool",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"updating",null),(0,y._)([(0,C.Cb)({readOnly:!0})],xe.prototype,"results",null),(0,y._)([(0,C.Cb)({readOnly:!0})],xe.prototype,"computations",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"selectedDimension",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"selectedComputation",null),(0,y._)([(0,C.Cb)()],xe.prototype,"_analysisVisualization",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"_analysisController",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"_dimensionsToComputations",void 0),(0,y._)([(0,C.Cb)()],xe.prototype,"_placementTask",void 0),xe=(0,y._)([(0,ee.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],xe);const Io=xe},52051:(Le,$,m)=>{m.d($,{T:()=>Y});var A=m(62208),y=m(10699);class Y{constructor(W,g){this._textureRep=W,this._disposed=!1;const M=this._textureRep.acquire(g);(0,y.y8)(M)?(M.then(C=>{this._disposed?(0,A.RY)(C):this._textureRef=C}),this.loadPromise=M):this._textureRef=M}dispose(){this._textureRef=(0,A.RY)(this._textureRef),this._disposed=!0}get glTexture(){return(0,A.pC)(this._textureRef)?this._textureRef.glTexture:null}}},36460:(Le,$,m)=>{m.d($,{c:()=>C});var A=m(17626),y=m(91558),Y=m(86810),T=m(77712),W=m(76898);let g=class extends Y.wq{constructor(){super(...arguments),this.enabled=!0}};(0,A._)([(0,T.Cb)({type:Boolean})],g.prototype,"enabled",void 0),g=(0,A._)([(0,W.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],g);let M=class extends Y.wq{constructor(De){super(De),this.lineSnapper=new g,this.parallelLineSnapper=new g,this.rightAngleSnapper=new g,this.rightAngleTriangleSnapper=new g,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new y.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,A._)([(0,T.Cb)({type:g,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"lineSnapper",void 0),(0,A._)([(0,T.Cb)({type:g,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"parallelLineSnapper",void 0),(0,A._)([(0,T.Cb)({type:g,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"rightAngleSnapper",void 0),(0,A._)([(0,T.Cb)({type:g,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"rightAngleTriangleSnapper",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],M.prototype,"shortLineThreshold",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],M.prototype,"distance",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"pointThreshold",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"intersectionParallelLineThreshold",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"parallelLineThreshold",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"touchSensitivityMultiplier",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"pointOnLineThreshold",void 0),(0,A._)([(0,T.Cb)({type:y.Z,nonNullable:!0})],M.prototype,"orange",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"lineHintWidthReference",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"lineHintWidthTarget",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],M.prototype,"lineHintFadedExtensions",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"parallelLineHintWidth",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],M.prototype,"parallelLineHintLength",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],M.prototype,"parallelLineHintOffset",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],M.prototype,"rightAngleHintSize",void 0),(0,A._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],M.prototype,"rightAngleHintOutlineSize",void 0),M=(0,A._)([(0,W.j)("esri.views.interactive.snapping.Settings.Defaults")],M);const C=new M},33351:(Le,$,m)=>{m.d($,{Bq:()=>ge,Hk:()=>ee,M8:()=>w,UL:()=>F,aU:()=>Q,jg:()=>he,ku:()=>B});var A=m(62208),y=m(67831),Y=m(99770),T=m(84161),W=m(28093),g=m(36460),M=m(44725),C=m(26362),De=m(396);class ye{constructor(_){this.coordinateHelper=_}intersect(_){return function Ne(D,_){let E=[];if(oe(D)){const{pointXYZ:O}=D;ce(_)?E=(0,C.pk)(_.lineLike,O):me(_)?E=(0,C.l0)(_.centerXYZ,_.radius,O):Re(_)?E=(0,C.hm)(_.planeLike,O):be(_)&&(E=Z(_,D))}else if(ce(D)){const{lineLike:O}=D;oe(_)?E=(0,C.pk)(O,_.pointXYZ):ce(_)?E=(0,C.Lh)(O,_.lineLike):me(_)?E=(0,C.UG)(O,_.centerXYZ,_.radius):Re(_)?E=(0,C.fK)(_.planeLike,O):be(_)&&(E=Z(_,D))}else if(me(D)){const{centerXYZ:O,radius:b}=D;ce(_)?E=(0,C.UG)(_.lineLike,O,b):oe(_)?E=(0,C.l0)(O,b,_.pointXYZ):Re(_)?E=(0,C._w)(_.planeLike,O,b):be(_)&&(E=Z(_,D))}else if(Re(D)){const{planeLike:O,coordinateHelper:b}=D;if(Re(_))return(0,C.qi)(O,_.planeLike).map(N=>new Ee(b,b.fromXYZ(N),D,_));oe(_)?E=(0,C.hm)(O,_.pointXYZ):ce(_)?E=(0,C.fK)(O,_.lineLike):me(_)?E=(0,C._w)(O,_.centerXYZ,_.radius):be(_)&&(E=Z(_,D))}else be(D)&&(E=Z(D,_));return function Se(D,_,E){const O=_.coordinateHelper;return D.map(b=>new ge(O,O.fromXYZ(b),_,E))}(E,D,_)}(this,_)}}class ee extends ye{constructor(_,E){super(_),this.point=E,this.pointXYZ=_.toXYZ(E)}equals(_){return oe(_)&&(0,M.Xv)(this.point,_.point)}check(_){const E=this.coordinateHelper.toXYZ(_,J);return(0,T.d)(E,this.pointXYZ)<g.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}}class We extends ye{constructor(_,E,O,b){super(_),this.start=E,this.end=O,this.type=b,this.startXYZ=_.toXYZ(E),this.endXYZ=_.toXYZ(O),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(_){return ce(_)&&this.type===_.type&&(0,M.Xv)(this.start,_.start)&&(0,M.Xv)(this.end,_.end)}check(_){const E=this.coordinateHelper.toXYZ(_,J);return(0,C.Mm)(this.lineLike,E)<g.c.pointOnLineThreshold}closestTo(_){const E=this.coordinateHelper,O=E.toXYZ(_,J),b=(0,C.ZE)(O,this.lineLike);return E.fromXYZ(b)}}class B extends We{constructor(_,E,O){super(_,E,O,De.SP.LINE)}}class ge extends ye{constructor(_,E,O,b){super(_),this.intersection=E,this.first=O,this.second=b}equals(_){return _ instanceof ge&&this.first.equals(_.first)&&this.second.equals(_.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}}class Ee extends ye{constructor(_,E,O,b){super(_),this.basePoint=E,this.first=O,this.second=b}equals(_){return _ instanceof Ee&&this.first.equals(_.first)&&this.second.equals(_.second)}check(){return!1}closestTo(_){const E=this.basePoint,O=this.coordinateHelper,b=O.toXYZ(_,J),N=(0,T.s)(et,E[0],E[1],b[2]);return O.fromXYZ(N)}}class F extends ye{constructor(_,E,O){super(_),this.center=E,this.radius=O,this.centerXYZ=_.toXYZ(E)}equals(_){return me(_)&&this.center[0]===_.center[0]&&this.center[1]===_.center[1]&&this.radius===_.radius}check(){return!1}closestTo(_){const E=this.coordinateHelper,O=E.toXYZ(_,J),b=(0,C.xO)(O,this.centerXYZ,this.radius);return b[2]=E.getZ(_,this.centerXYZ[2]),E.fromXYZ(b)}}class k extends ye{constructor(_,E,O,b){super(_),this.start=E,this.end=O,this.type=b,this.planeLike={start:E,end:O,type:b}}equals(_){return Re(_)&&this.type===_.type&&(0,M.Xv)(this.start,_.start)&&(0,M.Xv)(this.end,_.end)}check(_){const E=this.coordinateHelper.toXYZ(_,J);return(0,C.xb)(E,this.planeLike)<g.c.pointOnLineThreshold}closestTo(_){const E=this.coordinateHelper,O=E.toXYZ(_,J),b=(0,C.z9)(O,this.planeLike);return E.fromXYZ(b)}closestEndTo(_){const{start:E,end:O}=this;return Math.sign((0,y.h)((0,y.a)(At,O,E),(0,y.a)(H,_,E)))>0?O:E}}class Q extends k{constructor(_,E,O){super(_,E,O,C.Jk.HALF_PLANE)}}class he extends k{constructor(_,E,O){super(_,E,O,C.Jk.PLANE)}}class w extends ye{constructor(_,E,O,b){super(_),this.start=E,this.end=O,this.getZ=b,this.planeLike={start:E,end:O,type:C.Jk.HALF_PLANE}}equals(_){return be(_)&&(0,M.Xv)(this.start,_.start)&&(0,M.Xv)(this.end,_.end)&&this.getZ===_.getZ}check(_){const E=this.coordinateHelper.toXYZ(_,J),O=R(this,E);return(0,T.d)(E,O)<g.c.pointThreshold}closestTo(_){const E=this.coordinateHelper,O=R(this,E.toXYZ(_,J));return E.fromXYZ(O)}addIfOnTheGround(_,E){for(const O of E){const b=this.getZ(O[0],O[1],O[2]);(0,A.pC)(b)&&Math.abs(O[2]-b)<C.Ho&&(O[2]=b,_.push(O))}}}function R(D,_){const E=(0,C.z9)(_,D.planeLike),O=D.getZ(_[0],_[1],_[2]);return(0,A.pC)(O)&&(E[2]=O),E}function Z(D,_){const{planeLike:E,getZ:O}=D,b=[];if(oe(_))D.addIfOnTheGround(b,(0,C.hm)(E,_.pointXYZ));else if(ce(_))D.addIfOnTheGround(b,(0,C.fK)(E,_.lineLike));else if(me(_))D.addIfOnTheGround(b,(0,C._w)(E,_.centerXYZ,_.radius));else if(Re(_)||be(_))for(const[N,re]of(0,C.qi)(E,_.planeLike)){const se=O(N,re,0);(0,A.pC)(se)&&b.push((0,W.f)(N,re,se))}return b}function oe(D){return D instanceof ee}function ce(D){return D instanceof We}function me(D){return D instanceof F}function Re(D){return D instanceof k}function be(D){return D instanceof w}const J=(0,W.c)(),et=(0,W.c)(),At=(0,Y.a)(),H=(0,Y.a)()},26352:(Le,$,m)=>{var A,y;m.d($,{B:()=>A}),(y=A||(A={}))[y.FEATURE=1]="FEATURE",y[y.SELF=2]="SELF",y[y.ALL=3]="ALL"},75897:(Le,$,m)=>{m.d($,{L:()=>W});var A=m(33351),y=m(44725),Y=m(97979),T=m(62160);class W extends Y.a{constructor(M){super({...M,constraint:new A.ku(M.coordinateHelper,M.edgeStart,M.edgeEnd)})}get hints(){return[new T.w(y.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}},97979:(Le,$,m)=>{m.d($,{a:()=>Y});var A=m(26352),y=m(22823);class Y extends y.j{constructor({coordinateHelper:W,targetPoint:g,objectId:M,constraint:C,elevationInfo:De}){super(W,g,C,De,A.B.FEATURE),this.objectId=M}}},22823:(Le,$,m)=>{m.d($,{j:()=>A});class A{constructor(Y,T,W,g,M){this.coordinateHelper=Y,this.targetPoint=T,this.constraint=W,this.elevationInfo=g,this.domain=M}}},62160:(Le,$,m)=>{m.d($,{w:()=>g}),m(8314),m(63290);var Y=m(26352),T=m(44725),W=m(5286);class g extends W.r{constructor(C,De,ye,ee,We=Y.B.ALL,B=!0,ge=!0){super(ee,We),this.type=C,this.lineStart=De,this.lineEnd=ye,this.fadeLeft=B,this.fadeRight=ge}equals(C){return C instanceof g&&this.type===C.type&&(0,T.Xv)(this.lineStart,C.lineStart)&&(0,T.Xv)(this.lineEnd,C.lineEnd)&&this.fadeLeft===C.fadeLeft&&this.fadeRight===C.fadeRight}}},19038:(Le,$,m)=>{m.d($,{n:()=>Y});var A=m(44725),y=m(5286);class Y extends y.r{constructor(W,g,M){super(g,M),this.point=W}equals(W){return W instanceof Y&&(0,A.Xv)(this.point,W.point)}}},5286:(Le,$,m)=>{m.d($,{r:()=>A});class A{constructor(Y,T){this.elevationInfo=Y,this.domain=T}}},44725:(Le,$,m)=>{m.d($,{Bb:()=>g,ML:()=>Ee,Xv:()=>W,Z_:()=>B,_j:()=>ge,fG:()=>M,lQ:()=>C,rh:()=>We,ze:()=>ee});var A=m(62208),y=m(84161),Y=m(28093),T=m(60507);function W(F,k){const Q=F.length===k.length&&F[0]===k[0]&&F[1]===k[1];switch(F.length){case 2:return Q;case 3:return Q&&F[2]===k[2];case 4:return Q&&F[2]===k[2]&&F[3]===k[3]}return!1}function g(F,k){const Q=F.x-k.x,he=F.y-k.y;return Q*Q+he*he}function M(F,k){return Math.sqrt(g(F,k))}function C(F,k,Q){const he=Q.toXYZ(F,De);k.sort((w,R)=>{const Ne=Q.toXYZ(w.targetPoint,ye),Z=(0,y.d)(Ne,he),Se=Q.toXYZ(R.targetPoint,ye);return Z-(0,y.d)(Se,he)})}const De=(0,Y.c)(),ye=(0,Y.c)();var ee,F;function We(F,k){return{point:F.coordinateHelper.vectorToPoint(F.point).toJSON(),distance:F.distance,types:F.types,query:(0,A.pC)(k)?k.toJSON():{where:"1=1"}}}function B(F,k,Q,he){const{coordinateHelper:w,elevationInfo:R}=Q;if(!w.hasZ()||(0,A.Wi)(k)||"3d"!==k.type||(0,A.Wi)(F)||(0,T.BK)(R,he))return F;const Ne=(0,T.zx)(k,F,w.spatialReference,R,he),Z=w.clone(F);return Z[2]=Ne,Z}function ge(F,k,Q,he=T.jG){return{left:B(F.leftVertex.pos,k,Q,he),right:B(F.rightVertex.pos,k,Q,he)}}function Ee(F){return F.createQuery()}(F=ee||(ee={}))[F.TARGET=0]="TARGET",F[F.REFERENCE=1]="REFERENCE",F[F.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},26362:(Le,$,m)=>{m.d($,{Ho:()=>Z,Jk:()=>R,Lh:()=>k,Mm:()=>Ee,UG:()=>F,ZE:()=>ge,_w:()=>M,fK:()=>C,hm:()=>De,l0:()=>he,pk:()=>Q,qi:()=>ye,xO:()=>B,xb:()=>We,z9:()=>ee});var R,H,A=m(21286),y=m(67831),Y=m(99770),T=m(84161),W=m(28093),g=m(396);function M({start:H,end:D,type:_},E,O){const b=[],N=E,re=(0,y.a)(Se,D,H),se=(0,y.a)(oe,H,N),ue=(0,y.v)(re),ve=2*(0,y.h)(re,se),_e=ve*ve-4*ue*((0,y.v)(se)-O*O);if(0===_e){const pe=-ve/(2*ue);(_===R.PLANE||pe>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),H,re,pe))}else if(_e>0){const pe=Math.sqrt(_e),j=(-ve+pe)/(2*ue);(_===R.PLANE||j>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),H,re,j));const K=(-ve-pe)/(2*ue);(_===R.PLANE||K>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),H,re,K))}return b}function C(H,D){const _=H.start,O=(0,y.a)(Se,H.end,_),b=(0,T.s)(oe,-O[1],O[0],0),N=D.start,se=(0,T.y)(ce,D.end,N),ue=(0,T.e)(se,b),ve=(0,T.s)(me,_[0],_[1],0),_e=(0,T.y)(Re,ve,N),pe=(0,T.e)(_e,b);if(Math.abs(ue)<Z)return Math.abs(pe),[];const j=(0,T.z)(be,N,se,pe/ue);if(D.type===g.SP.RAY){const K=(0,T.y)(J,j,N);if((0,T.e)(K,se)<-Z)return[]}if(H.type===R.HALF_PLANE){const K=(0,y.e)(J,j,_);if((0,y.h)(K,O)<-Z)return[]}return[(0,W.a)(j)]}function De(H,D){return Q(w(et,D[2],H),D)}function ye(H,D){const E=k(w(et,0,H),w(At,0,D)),O=[];for(const b of E)O.push((0,Y.d)(b));return O}function ee(H,D){return ge(H,w(et,H[2],D))}function We(H,D){return Ee(w(et,H[2],D),H)}function B(H,D,_){const E=(0,T.s)(Se,H[0],H[1],D[2]),O=(0,T.b)(oe,E,D),b=_/(0,T.l)(O);return(0,T.z)((0,W.c)(),D,O,b)}function ge(H,{start:D,end:_,type:E}){const O=(0,T.y)(Se,H,D),b=(0,T.y)(oe,_,D),N=(0,T.e)(O,b)/(0,T.e)(b,b);return(0,T.z)((0,W.c)(),D,b,E===g.SP.RAY?Math.max(N,0):N)}function Ee({start:H,end:D,type:_},E){const O=(0,T.y)(Se,E,H),b=(0,T.y)(oe,D,H);if(_===g.SP.RAY&&(0,T.e)(b,O)<-Z)return(0,T.i)(H,E);const N=(0,T.f)(ce,b,O);return(0,T.u)(N)/(0,T.u)(b)}function F({start:H,end:D,type:_},E,O){const b=[];if((0,A.W8)(H[2],E[2],Z)&&(0,A.W8)(D[2],E[2],Z)){const N=H,re=E,se=(0,y.a)(Se,D,N),ue=(0,y.a)(oe,N,re),ve=(0,y.v)(se),_e=2*(0,y.h)(se,ue),pe=_e*_e-4*ve*((0,y.v)(ue)-O*O);if(0===pe){const j=-_e/(2*ve);(_===g.SP.LINE||j>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),N,se,j))}else if(pe>0){const j=Math.sqrt(pe),K=(-_e+j)/(2*ve);(_===g.SP.LINE||K>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),N,se,K));const Fe=(-_e-j)/(2*ve);(_===g.SP.LINE||Fe>=0)&&b.push((0,y.w)((0,W.f)(0,0,E[2]),N,se,Fe))}}else{const N=(0,T.y)(Se,D,H);if((0,A.W8)(N[2],0,Z))return b;const se=(0,T.z)(oe,H,N,(E[2]-H[2])/N[2]);if(_===g.SP.RAY){const ue=(0,T.y)(ce,se,H);if((0,T.e)(N,ue)<-Z)return b}for(const ue of he(E,O,se))b.push(ue)}return b}function k(H,D){const _=H.start,O=D.start,b=D.end,N=(0,T.y)(Se,H.end,_),re=(0,T.y)(oe,b,O),se=(0,T.y)(ce,O,_),ue=(0,T.f)(me,N,re),ve=(0,T.e)(se,ue);if(!(0,A.W8)(ve,0,Z))return[];const _e=(0,T.D)(ue);if((0,A.W8)(_e,0,Z))return[];const pe=(0,T.f)(Re,se,re),j=(0,T.e)(pe,ue)/_e,K=(0,T.z)(be,_,N,j);if(H.type===g.SP.RAY){const Fe=(0,T.y)(J,K,_);if((0,T.e)(N,Fe)<-Z)return[]}if(D.type===g.SP.RAY){const Fe=(0,T.y)(J,K,O);if((0,T.e)(re,Fe)<-Z)return[]}return[(0,W.a)(K)]}function Q({start:H,end:D,type:_},E){const O=(0,T.y)(Se,E,H),b=(0,T.y)(oe,D,H),N=(0,T.f)(ce,b,O);if((0,T.D)(N)/(0,T.D)(b)<Z)switch(_){case g.SP.LINE:return[(0,W.a)(E)];case g.SP.RAY:return(0,T.e)(b,O)<-Z?[]:[(0,W.a)(E)]}return[]}function he(H,D,_){return(0,A.W8)(H[2],_[2],Z)&&(0,A.W8)((0,T.d)(_,H),D*D,Z)?[(0,W.a)(_)]:[]}function w(H,D,{start:_,end:E,type:O}){return(0,T.s)(H.start,_[0],_[1],D),(0,T.s)(H.end,E[0],E[1],D),H.type=Ne[O],H}(H=R||(R={}))[H.PLANE=0]="PLANE",H[H.HALF_PLANE=1]="HALF_PLANE";const Ne={[R.PLANE]:g.SP.LINE,[R.HALF_PLANE]:g.SP.RAY},Z=1e-6,Se=(0,W.c)(),oe=(0,W.c)(),ce=(0,W.c)(),me=(0,W.c)(),Re=(0,W.c)(),be=(0,W.c)(),J=(0,W.c)(),et={start:(0,W.c)(),end:(0,W.c)(),type:g.SP.LINE},At={start:(0,W.c)(),end:(0,W.c)(),type:g.SP.LINE}}}]);