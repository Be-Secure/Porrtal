"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[9094],{34013:(K,A,e)=>{e.d(A,{I:()=>I,b:()=>c});var i=e(62208),h=e(99770),T=e(6945),v=e(78925),f=e(24255),O=e(10109),_=e(67022),U=e(33726),m=e(2166),D=e(95285),S=e(65787),P=e(17625),L=e(22355),n=e(35387),u=e(42743),d=e(16396);function c(M){const g=new L.kG;(0,m.S)(g,M),g.include(f.w),g.attributes.add(d.T.POSITION,"vec3"),g.attributes.add(d.T.UV0,"vec2"),g.varyings.add("vpos","vec3"),M.hasMultipassTerrain&&g.varyings.add("depth","float");const{vertex:R,fragment:x}=g;return R.uniforms.add(new D.A("textureCoordinateScaleFactor",E=>(0,i.pC)(E.texture)&&(0,i.pC)(E.texture.descriptor.textureCoordinateScaleFactor)?E.texture.descriptor.textureCoordinateScaleFactor:h.O)),R.code.add(P.H`
    void main(void) {
      vpos = position;
      ${M.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),g.include(v.f5,M),g.include(O.l,M),x.uniforms.add([new n.A("tex",E=>E.texture),new S.p("opacity",E=>E.opacity)]),g.varyings.add("vTexCoord","vec2"),M.output===T.H.Alpha?x.code.add(P.H`
    void main() {
      discardBySlice(vpos);
      ${M.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${P.H.float(_.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(x.include(U.Y),x.code.add(P.H`
    void main() {
      discardBySlice(vpos);
      ${M.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${P.H.float(_.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${M.transparencyPassType===u.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),g}const I=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},19702:(K,A,e)=>{e.d(A,{A:()=>P});var i=e(15861),h=e(17626),T=e(54024),v=e(10699),f=e(32917),O=e(77712),D=(e(85931),e(8314),e(90912),e(76898)),S=e(36947);const P=L=>{let n=class extends L{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(u){super.postscript(u),(0,S.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var u=this;return(0,i.Z)(function*(){const d=new AbortController,c=d.signal;u.handles.add((0,T.kB)(()=>d.abort())),yield(0,f.N1)(()=>u.view.defaultsFromMap?.heightModelInfoReady,c),(0,v.k_)(c);const I=(0,S.Wt)(u.layer,u.view.heightModelInfo,u.supportsHeightUnitConversion);if(I)throw I})()}canResume(){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!u||!u.minScale||!u.maxScale||u.minScale>=u.maxScale)}getSuspendInfo(){const u=super.getSuspendInfo(),d=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return d&&d.minScale&&d.maxScale&&d.minScale<d.maxScale&&(u.outsideScaleRange=!0),u}};return(0,h._)([(0,O.Cb)()],n.prototype,"view",void 0),(0,h._)([(0,O.Cb)()],n.prototype,"slicePlaneEnabled",void 0),n=(0,h._)([(0,D.j)("esri.views.3d.layers.LayerView3D")],n),n}},59094:(K,A,e)=>{e.r(A),e.d(A,{default:()=>y});var i=e(15861),h=e(17626),T=e(54024),v=e(62208),f=e(10699),O=e(32917),_=e(77712),S=(e(85931),e(8314),e(90912),e(76898)),P=e(65401),L=e(14517),n=e(37118),u=e(55915),d=e(65629);let c=class extends L.Z{constructor(t){super(t)}get bounds(){const t=this.coords;return(0,v.Wi)(t)?null:(0,P.oJ)(t.extent)}get coords(){const t=(0,v.Wg)(this.element.georeference)?.coords;return(0,u.dz)(t,this.spatialReference).geometry}get normalizedCoords(){return n.Z.fromJSON((0,d.Ui)(this.coords))}get normalizedBounds(){return(0,v.pC)(this.normalizedCoords)?(0,P.oJ)(this.normalizedCoords.extent):null}};(0,h._)([(0,_.Cb)()],c.prototype,"spatialReference",void 0),(0,h._)([(0,_.Cb)()],c.prototype,"element",void 0),(0,h._)([(0,_.Cb)()],c.prototype,"bounds",null),(0,h._)([(0,_.Cb)()],c.prototype,"coords",null),(0,h._)([(0,_.Cb)()],c.prototype,"normalizedCoords",null),(0,h._)([(0,_.Cb)()],c.prototype,"normalizedBounds",null),c=(0,h._)([(0,S.j)("esri.layers.support.media.MediaElementView")],c);var I=e(62600),M=e(19702),g=e(64835),R=e(42743),x=e(52107),E=e(54840),H=e(53855),C=e(81695),W=e(16396),z=e(79967),F=e(45611),B=e(67969);let a=class extends((0,M.A)(F.Z)){constructor(){var t;super(...arguments),t=this,this.type="media-3d",this.drapeSourceType=I.L.RasterImage,this.updatePolicy=R.jq.ASYNC,this._uidToElement=new Map,this._renderedElements=new Map,this._lastDrapingExtent=null,this._update=(0,f.Ds)(function(){var s=(0,i.Z)(function*(o,l,p){const j=yield t._collectMediaElements(o,l,p);t._synchronizeRenderElements(j)});return function(o,l,p){return s.apply(this,arguments)}}(),0)}initialize(){this._renderer=this.view.basemapTerrain.overlayManager.registerGeometryDrapeSource(this),this.handles.add([(0,T.kB)(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this)),(0,O.on)(()=>this.layer.source,"refresh",()=>this._updateWithLastDrapingExtent())]),this.updatingHandles.add(()=>this.suspended,()=>this._updateWithLastDrapingExtent())}setDrapingExtent(t,s){this._lastDrapingExtent={overlays:t,spatialReference:s},this._updateWithLastDrapingExtent()}getHit(t){const s=this._uidToElement.get(t);return s?{type:"media",element:s,layer:this.layer}:null}_updateWithLastDrapingExtent(){if((0,v.Wi)(this._lastDrapingExtent)||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));const{overlays:t,spatialReference:s}=this._lastDrapingExtent;this.updatingHandles.addPromise(this._update(t,s).catch(()=>{}))}_collectMediaElements(t,s,o){var l=this;return(0,i.Z)(function*(){const p=l.layer.source;return(0,v.Wi)(p)?new Set:new Set((yield Promise.all(t.map(j=>p.queryElements((0,P.HH)(j.extent,s),{signal:o})))).flat())})()}_synchronizeRenderElements(t){this._synchronizeRenderElementsRemove(t),this._synchronizeRenderElementsAdd(t)}_synchronizeRenderElementsRemove(t){const s=new Set,o=[];this._renderedElements.forEach((l,p)=>{t.has(p)||(s.add(p),(0,v.pC)(l.renderData)&&o.push(l.renderData.renderGeometry),this._removeElement(p,l))}),this._renderer.removeGeometries(o,E.$.Geometry.REMOVE)}_synchronizeRenderElementsAdd(t){for(const s of t)this._renderedElements.has(s)||this._createRenderElement(s)}_removeElement(t,{renderData:s,handle:o}){this._destroyRenderData(s),this._renderedElements.delete(t),this._uidToElement.delete(t.uid),o.remove()}_createRenderElement(t){var s=this;return(0,i.Z)(function*(){const o=new c({spatialReference:s.view.spatialReference,element:t}),l={renderData:null,handle:(0,T.AL)([s.updatingHandles.add(()=>t.opacity,p=>{(0,v.pC)(l.renderData)&&l.renderData.material.setParameters({opacity:p})}),s.updatingHandles.add(()=>o.coords,p=>{(0,v.pC)(l.renderData)?s._updateGeometry(l,l.renderData,p):s._initializeRenderData(o,l)}),s.updatingHandles.add(()=>t.content,()=>s._initializeRenderData(o,l)),(0,T.ed)(o)])};s._renderedElements.set(t,l),s._uidToElement.set(t.uid,t),s.updatingHandles.addPromise(t.load().catch(()=>{})),s._initializeRenderData(o,l)})()}_initializeRenderData(t,s){const{coords:o,element:l}=t;if((0,v.Wi)(o)||(0,v.Wi)(l.content))return void(s.renderData=this._destroyRenderData(s.renderData));if((0,v.pC)(s.renderData))return;const p=this._createTexture(l.content);this.view._stage.add(p);const j=this.view._stage.loadImmediate(p);(0,f.y8)(j)&&this.updatingHandles.addPromise(j);const G=new z.j({initTextureTransparent:!0,textureId:p.id,opacity:l.opacity,transparent:!0}),V=this._positionVertexBufferFromCoordinates(o),b=new Uint16Array([0,1,2,0,2,3]),Z=new x.Z([[W.T.POSITION,{data:V,size:3,exclusive:!0}],[W.T.UV0,{data:[0,0,1,0,1,1,0,1],size:2,exclusive:!0}]],[[W.T.POSITION,b],[W.T.UV0,b]]),N=new H.z(Z,G,{layerUid:this.layer.uid,graphicUid:l.uid});this._renderer.addGeometries([N],E.$.Geometry.ADD),s.renderData={renderGeometry:N,texture:p,material:G}}_updateGeometry(t,s,o){if((0,v.Wi)(o))return void(t.renderData=this._destroyRenderData(t.renderData));const l=this._positionVertexBufferFromCoordinates(o);s.renderGeometry.vertexAttributes.get(W.T.POSITION).data=l,this._renderer.modifyGeometries([s.renderGeometry],E.$.State.VERTEXATTRS)}_positionVertexBufferFromCoordinates(t){const[s,o,l,p]=t.rings[0];return new Float64Array([s[0],s[1],g.Rn,p[0],p[1],g.Rn,l[0],l[1],g.Rn,o[0],o[1],g.Rn])}_destroyRenderData(t){return(0,v.Wi)(t)||(this.view._stage.remove(t.texture),this._renderer.removeGeometries([t.renderGeometry],E.$.Geometry.REMOVE),t.material.dispose()),null}_createTexture(t){const s=t instanceof HTMLImageElement?t.naturalWidth:t.width,o=t instanceof HTMLImageElement?t.naturalHeight:t.height;return new C.x(t,{wrap:{s:B.e8.CLAMP_TO_EDGE,t:B.e8.CLAMP_TO_EDGE},preMultiplyAlpha:!0,width:s,height:o,mipmap:!0,powerOfTwoResizeMode:R.CE.STRETCH,updateCallback:()=>this.view.basemapTerrain.overlayManager.setDrawTexturesDirty()})}get test(){const t=this;return{get numberOfElements(){return t._renderedElements.size}}}};(0,h._)([(0,_.Cb)({readOnly:!0})],a.prototype,"type",void 0),(0,h._)([(0,_.Cb)()],a.prototype,"layer",void 0),a=(0,h._)([(0,S.j)("esri.views.3d.layers.MediaLayerView3D")],a);const y=a},79967:(K,A,e)=>{e.d(A,{j:()=>W});var i=e(6945),h=e(42743),T=e(32393),v=e(33470),f=e(40723),O=e(88569),_=e(5894),U=e(60909),m=e(57623),D=e(17626),P=(e(17625),e(651)),L=e(91056),n=e(87601),u=e(39114),d=e(12407),c=e(64127),I=e(41528),M=e(34013),g=e(67969),R=e(2078);class E extends L.A{initializeProgram(a){const y=E.shader.get().build(this.configuration);return new d.$(a.rctx,y,u.i)}_setPipelineState(a,y){const t=this.configuration,s=a===h.Am.NONE,o=a===h.Am.FrontFace;return(0,R.sm)({blending:t.output!==i.H.Color&&t.output!==i.H.Alpha||!t.transparent?null:s?H:(0,O.j7)(a),culling:(0,R.zp)(t.cullFace),depthTest:{func:(0,O.Bh)(a)},depthWrite:s?t.writeDepth&&R.LZ:(0,O.K5)(a),colorWrite:R.BK,stencilWrite:t.hasOccludees?c.s3:null,stencilTest:t.hasOccludees?y?c.eD:c.RY:null,polygonOffset:s||o?null:(0,O.je)(t.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(a,y){return y?this._occludeePipelineState:super.getPipelineState(a,y)}}E.shader=new P.J(M.I,()=>e.e(8586).then(e.bind(e,18586)));const H=(0,R.if)(g.zi.ONE,g.zi.ONE_MINUS_SRC_ALPHA);class C extends I.W{constructor(){super(...arguments),this.output=i.H.Color,this.cullFace=h.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=h.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,D._)([(0,n.o)({count:i.H.COUNT})],C.prototype,"output",void 0),(0,D._)([(0,n.o)({count:h.Vr.COUNT})],C.prototype,"cullFace",void 0),(0,D._)([(0,n.o)()],C.prototype,"hasSlicePlane",void 0),(0,D._)([(0,n.o)()],C.prototype,"transparent",void 0),(0,D._)([(0,n.o)()],C.prototype,"enableOffset",void 0),(0,D._)([(0,n.o)()],C.prototype,"writeDepth",void 0),(0,D._)([(0,n.o)()],C.prototype,"hasOccludees",void 0),(0,D._)([(0,n.o)({count:h.Am.COUNT})],C.prototype,"transparencyPassType",void 0),(0,D._)([(0,n.o)()],C.prototype,"hasMultipassTerrain",void 0),(0,D._)([(0,n.o)()],C.prototype,"cullAboveGround",void 0);class W extends f.F5{constructor(a){super(a,new F),this.supportsEdges=!0,this.techniqueConfig=new C}getConfiguration(a,y){return this.techniqueConfig.output=a,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=y.transparencyPassType,this.techniqueConfig.enableOffset=y.camera.relativeElevation<O.ve,this.techniqueConfig.hasMultipassTerrain=y.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=y.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(a,y,t,s,o,l,p){(0,m.Bw)(a,y,s,o,l,void 0,p)}requiresSlot(a,y){return a===_.r.DRAPED_MATERIAL||((0,T.S)(y)===i.H.Highlight?a===_.r.OPAQUE_MATERIAL:a===(this.parameters.transparent?this.parameters.writeDepth?_.r.TRANSPARENT_MATERIAL:_.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:_.r.OPAQUE_MATERIAL))}createGLMaterial(a){return a.output===i.H.Color||a.output===i.H.Alpha||a.output===i.H.Highlight?new z(a):void 0}createBufferWriter(){return new U.G_(U.W1)}}class z extends v.F{constructor(a){super({...a,...a.material.parameters})}_updateParameters(a){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(E,a)}_updateOccludeeState(a){a.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:a.hasOccludees}),this._updateParameters(a))}beginSlot(a){return this._output!==i.H.Color&&this._output!==i.H.Alpha||this._updateOccludeeState(a),this._updateParameters(a)}}class F extends f.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=h.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}},45611:(K,A,e)=>{e.d(A,{Z:()=>u});var i=e(17626),h=e(14517),T=e(61885),v=e(80542),f=e(61996),O=e(63290),_=e(62208),U=e(60330),m=e(77712),L=(e(85931),e(8314),e(90912),e(76898));let n=class extends((0,v.p)((0,f.IG)((0,U.v)(T.Z.EventedMixin(h.Z))))){constructor(d){super(d),this.layer=null,this.parent=null}initialize(){this.when().catch(d=>{if("layerview:create-error"!==d.name){const c=this.layer&&this.layer.id||"no id",I=this.layer&&this.layer.title||"no title";O.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${I}', id: '${c}')`,d)}})}get fullOpacity(){return(0,_.Pt)(this.get("layer.opacity"),1)*(0,_.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(d){void 0!==d?this._override("visible",d):this._clearOverride("visible")}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const d=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(d.viewNotReady=!0),this.layer&&this.layer.loaded||(d.layerNotLoaded=!0),this.visible||(d.layerInvisible=!0),d}isUpdating(){return!1}};(0,i._)([(0,m.Cb)()],n.prototype,"fullOpacity",null),(0,i._)([(0,m.Cb)()],n.prototype,"layer",void 0),(0,i._)([(0,m.Cb)()],n.prototype,"parent",void 0),(0,i._)([(0,m.Cb)({readOnly:!0})],n.prototype,"suspended",null),(0,i._)([(0,m.Cb)({readOnly:!0})],n.prototype,"suspendInfo",null),(0,i._)([(0,m.Cb)({readOnly:!0})],n.prototype,"legendEnabled",null),(0,i._)([(0,m.Cb)({type:Boolean,readOnly:!0})],n.prototype,"updating",null),(0,i._)([(0,m.Cb)({readOnly:!0})],n.prototype,"updatingProgress",null),(0,i._)([(0,m.Cb)()],n.prototype,"visible",null),(0,i._)([(0,m.Cb)()],n.prototype,"view",void 0),n=(0,i._)([(0,L.j)("esri.views.layers.LayerView")],n);const u=n}}]);