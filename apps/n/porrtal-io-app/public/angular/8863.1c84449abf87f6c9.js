(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[8863],{8863:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{AccountBillingHistoryComponent:()=>ee,AccountCreateComponent:()=>ie,AccountDetailComponent:()=>Y,AccountNavComponent:()=>H,AccountSearchComponent:()=>re,AppointmentCreateComponent:()=>Pv,AppointmentDetailComponent:()=>Tv,AppointmentLocationMapComponent:()=>Mv,AppointmentNavComponent:()=>bv,AppointmentSearchComponent:()=>Cv,BuildingSceneWithQueryComponent:()=>Wb,CollapsibleTreeComponent:()=>Kb,DigitalElevationMapComponent:()=>Nb,EarthquakeMapComponent:()=>Fb,HierarchicalBarChartComponent:()=>Zb,HurricaneMapComponent:()=>jb,VizNavComponent:()=>Ov,ZoomableCirclePackComponent:()=>Vb,ZoomableIcicleComponent:()=>Gb,ZoomableSunburstComponent:()=>zb,ZoomableTreemapComponent:()=>Hb});var D=v(36895),R=v(46485);const Z=[{accountId:1,name:"Bank of Big Money",orders:[{date:Date.now(),item:"Screen design",amount:1e3},{date:Date.now()+432e6,item:"Screen development",amount:5e3},{date:Date.now()+864e6,item:"Screen testing",amount:3e3}]},{accountId:2,name:"Bill Jones",orders:[{date:Date.now(),item:"Slide development",amount:1e3}]},{accountId:3,name:"Waffles R Us",orders:[{date:Date.now(),item:"Screen design",amount:2e3},{date:Date.now()+432e6,item:"Screen development",amount:8e3},{date:Date.now()+864e6,item:"Screen testing",amount:5e3}]},{accountId:4,name:"Waffle House",orders:[{date:Date.now(),item:"Screen design",amount:500},{date:Date.now()+432e6,item:"Screen development",amount:2e3}]},{accountId:5,name:"Crypto Bank",orders:[{date:Date.now(),item:"Slide work",amount:1e3},{date:Date.now()+432e6,item:"Computer order",amount:15e3},{date:Date.now()+864e6,item:"Programming",amount:21e3}]}];var Q=v(97392),$=v(94650);const W=function(d){return{accountId:d}};function B(d,_){if(1&d&&($.ynx(0),$.TgZ(1,"porrtal-entity-menu",4)(2,"span",5)(3,"mat-icon"),$._uU(4,"account_box"),$.qZA(),$.TgZ(5,"span",6),$._uU(6),$.qZA()()(),$.TgZ(7,"span"),$._uU(8),$.ALo(9,"number"),$.qZA(),$.BQk()),2&d){const T=_.$implicit;$.xp6(1),$.Q6J("state",$.VKq(6,W,T.accountId)),$.xp6(5),$.Oqu(T.name),$.xp6(2),$.hij(" $ ",$.xi3(9,3,T.total,"1.0-0")," ")}}class H{constructor(){this.topThreeAccounts=[],this.topThreeAccounts=[...Z.map(_=>{const T=_.orders.reduce((x,A)=>x+A.amount,0);return{..._,total:T}}).sort((_,T)=>T.total-_.total).filter((_,T)=>T<3)],console.log("top three accounts",this.topThreeAccounts)}static#e=this.\u0275fac=function(T){return new(T||H)};static#t=this.\u0275cmp=$.Xpm({type:H,selectors:[["porrtal-account-nav"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:5,vars:1,consts:[[1,"container"],[1,"title"],[1,"data-container"],[4,"ngFor","ngForOf"],["entityType","account",3,"state"],[1,"link-button",2,"display","grid","grid-template-columns","24px auto"],[2,"margin-left","5px"]],template:function(T,x){1&T&&($.TgZ(0,"div",0)(1,"h3",1),$._uU(2,"Top Three Accounts"),$.qZA(),$.TgZ(3,"div",2),$.YNc(4,B,10,8,"ng-container",3),$.qZA()()),2&T&&($.xp6(4),$.Q6J("ngForOf",x.topThreeAccounts))},dependencies:[D.ez,D.sg,D.JJ,Q.Ps,Q.Hw,R.Ak],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:2px;padding-bottom:2px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:center;margin-left:15px;margin-right:15px;margin-top:15px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"]})}var X=v(54004),te=v(30878),ae=v(15439);function oe(d,_){if(1&d&&($.ynx(0),$.TgZ(1,"span"),$._uU(2),$.qZA(),$.TgZ(3,"span"),$._uU(4),$.qZA(),$.TgZ(5,"span"),$._uU(6),$.qZA(),$.BQk()),2&d){const T=_.$implicit,x=$.oxw(3);$.xp6(2),$.Oqu(T.item),$.xp6(2),$.Oqu(x.formatAmount(T.amount)),$.xp6(2),$.Oqu(x.Moment(T.date).format("YYYY-DD-MM"))}}const le=function(d){return{accountId:d}};function de(d,_){if(1&d&&($.ynx(0),$.TgZ(1,"porrtal-entity-menu",5)(2,"span",6)(3,"mat-icon"),$._uU(4,"account_box"),$.qZA(),$.TgZ(5,"span",7),$._uU(6),$.qZA()()(),$.TgZ(7,"div",8),$.YNc(8,oe,7,3,"ng-container",4),$.qZA(),$.BQk()),2&d){const T=_.$implicit;$.xp6(1),$.Q6J("state",$.VKq(3,le,T.accountId)),$.xp6(5),$.Oqu(T.name),$.xp6(2),$.Q6J("ngForOf",T.orders)}}function se(d,_){if(1&d&&($.ynx(0),$.YNc(1,de,9,5,"ng-container",4),$.BQk()),2&d){const T=_.ngIf;$.xp6(1),$.Q6J("ngForOf",T)}}class re{constructor(_){this.searchStateService=_,this.Moment=ae,this.searchText$=_.select("debouncedSearchText"),this.filteredAccounts$=_.select("debouncedSearchText").pipe((0,X.U)(T=>Z.filter(x=>JSON.stringify(x).toLowerCase().indexOf(T.toLowerCase())>=0)))}formatAmount(_){return"$"+_.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}static#e=this.\u0275fac=function(T){return new(T||re)($.Y36(te.tx))};static#t=this.\u0275cmp=$.Xpm({type:re,selectors:[["porrtal-account-search"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:7,vars:6,consts:[[1,"container"],[1,"title"],[1,"data-container"],[4,"ngIf"],[4,"ngFor","ngForOf"],["entityType","account",3,"state"],[1,"link-button",2,"display","grid","grid-template-columns","24px auto"],[2,"margin-left","5px"],[1,"orders-data-container"]],template:function(T,x){1&T&&($.TgZ(0,"div",0)(1,"h3",1),$._uU(2),$.ALo(3,"async"),$.qZA(),$.TgZ(4,"div",2),$.YNc(5,se,2,1,"ng-container",3),$.ALo(6,"async"),$.qZA()()),2&T&&($.xp6(2),$.hij("Account Search: ",$.lcZ(3,2,x.searchText$),""),$.xp6(3),$.Q6J("ngIf",$.lcZ(6,4,x.filteredAccounts$)))},dependencies:[D.ez,D.sg,D.O5,D.Ov,Q.Ps,Q.Hw,R.Ak],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:5px;padding-bottom:4px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px;margin-top:30px}.orders-data-container[_ngcontent-%COMP%]{display:grid;justify-self:start;gap:10px;grid-template-columns:auto auto auto;margin:15px 15px 15px 45px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"],changeDetection:0})}function j(d,_){if(1&d&&($.ynx(0),$.TgZ(1,"span"),$._uU(2),$.qZA(),$.TgZ(3,"span"),$._uU(4),$.qZA(),$.TgZ(5,"span"),$._uU(6),$.qZA(),$.BQk()),2&d){const T=_.$implicit,x=$.oxw();$.xp6(2),$.Oqu(T.item),$.xp6(2),$.hij(" ",T.amountText," "),$.xp6(2),$.Oqu(x.Moment(T.date).format("YYYY-DD-MM"))}}class Y{constructor(){this.Moment=ae}set viewState(_){if(this._viewState=_,this._viewState?.state&&this._viewState?.state.accountId){const T=this._viewState?.state.accountId;this.account=Z.find(x=>x.accountId===T),this.orders=[],this.account&&(this.orders=this.account.orders.map(x=>({...x,amountText:"$"+x.amount.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")})))}}get viewState(){return this._viewState}static#e=this.\u0275fac=function(T){return new(T||Y)};static#t=this.\u0275cmp=$.Xpm({type:Y,selectors:[["porrtal-account-detail"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:5,vars:3,consts:[[1,"container"],[1,"title"],[1,"data-container"],[4,"ngFor","ngForOf"]],template:function(T,x){1&T&&($.TgZ(0,"div",0)(1,"h3",1),$._uU(2),$.qZA(),$.TgZ(3,"div",2),$.YNc(4,j,7,3,"ng-container",3),$.qZA()()),2&T&&($.xp6(2),$.AsE(" ",null==x.account?null:x.account.name," (",null==x.account?null:x.account.accountId,") - Account Detail "),$.xp6(2),$.Q6J("ngForOf",x.orders))},dependencies:[D.ez,D.sg],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:2px;padding-bottom:2px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{display:grid;justify-self:start;gap:10px;grid-template-columns:auto auto auto;margin-left:15px;margin-right:15px;margin-top:15px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"],changeDetection:0})}class ee{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||ee)};static#t=this.\u0275cmp=$.Xpm({type:ee,selectors:[["porrtal-account-billing-history"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"account-billing-history works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class ie{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||ie)};static#t=this.\u0275cmp=$.Xpm({type:ie,selectors:[["porrtal-account-create"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"account-create works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}new(v(61135).X)(void 0);const pe=[{appointmentId:1,accountId:1,date:Date.now()+72e5,item:"Kickoff Meeting",description:"Introduction to the development process.",location:"Baker Street Cafe",duration:18e5},{appointmentId:2,accountId:2,date:Date.now()+0,item:"Slide Review",description:"Review the initial slides.",location:"101 18th Street, Suite 100",duration:36e5},{appointmentId:3,accountId:4,date:Date.now()+144e5,item:"Business Overview",description:"Present the Important Business Use Cases",location:"2357 Smith Drive",duration:36e5},{appointmentId:4,accountId:1,date:Date.now()+864e5,item:"Review Screen Mockups",description:"Review the initial screen mockups for the application",location:"Baker Street Cafe",duration:18e5},{appointmentId:5,accountId:2,date:Date.now()+1008e5,item:"Final Slide Review",description:"Review the slides and receive the PowerPoint files",location:"101 18th Street, Suite 100",duration:72e5},{appointmentId:6,accountId:3,date:Date.now()+1728e5,item:"Development Process Overview",description:"Introduction to the development process",location:"Waffles R Us #6",duration:18e5},{appointmentId:7,accountId:4,date:Date.now()+1764e5,item:"Development Process Overview",description:"Introduction to the development process",location:"Waffle House #27",duration:27e5},{appointmentId:8,accountId:5,date:Date.now()+18e7,item:"Computer Inventory",description:"Review current inventory and plan new orders",location:"512 3rd Street, Suite 1520",duration:18e5},{appointmentId:9,accountId:1,date:Date.now()+2592e5,item:"Screen demo",description:"Show screens and collect feedback",location:"Baker Street Cafe",duration:36e5},{appointmentId:10,accountId:4,date:Date.now()+2664e5,item:"Screen demo",description:"Show screens and collect feedback",location:"Waffle House #27",duration:36e5}];function he(d){return d}function be(d){return"translate("+d+",0)"}function Se(d){return"translate(0,"+d+")"}function ye(d){return _=>+d(_)}function ve(d,_){return _=Math.max(0,d.bandwidth()-2*_)/2,d.round()&&(_=Math.round(_)),T=>+d(T)+_}function xe(){return!this.__axis}function ze(d,_){var T=[],x=null,A=null,U=6,ne=6,fe=3,Oe=typeof window<"u"&&window.devicePixelRatio>1?0:.5,we=1===d||4===d?-1:1,Ze=4===d||2===d?"x":"y",it=1===d||3===d?be:Se;function lt(dt){var Tt=x??(_.ticks?_.ticks.apply(_,T):_.domain()),mt=A??(_.tickFormat?_.tickFormat.apply(_,T):he),Mt=Math.max(U,0)+fe,Pt=_.range(),Nt=+Pt[0]+Oe,Bt=+Pt[Pt.length-1]+Oe,Zt=(_.bandwidth?ve:ye)(_.copy(),Oe),nr=dt.selection?dt.selection():dt,Jt=nr.selectAll(".domain").data([null]),Rr=nr.selectAll(".tick").data(Tt,_).order(),Br=Rr.exit(),$r=Rr.enter().append("g").attr("class","tick"),Yr=Rr.select("line"),cs=Rr.select("text");Jt=Jt.merge(Jt.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Rr=Rr.merge($r),Yr=Yr.merge($r.append("line").attr("stroke","currentColor").attr(Ze+"2",we*U)),cs=cs.merge($r.append("text").attr("fill","currentColor").attr(Ze,we*Mt).attr("dy",1===d?"0em":3===d?"0.71em":"0.32em")),dt!==nr&&(Jt=Jt.transition(dt),Rr=Rr.transition(dt),Yr=Yr.transition(dt),cs=cs.transition(dt),Br=Br.transition(dt).attr("opacity",1e-6).attr("transform",function(Xr){return isFinite(Xr=Zt(Xr))?it(Xr+Oe):this.getAttribute("transform")}),$r.attr("opacity",1e-6).attr("transform",function(Xr){var os=this.parentNode.__axis;return it((os&&isFinite(os=os(Xr))?os:Zt(Xr))+Oe)})),Br.remove(),Jt.attr("d",4===d||2===d?ne?"M"+we*ne+","+Nt+"H"+Oe+"V"+Bt+"H"+we*ne:"M"+Oe+","+Nt+"V"+Bt:ne?"M"+Nt+","+we*ne+"V"+Oe+"H"+Bt+"V"+we*ne:"M"+Nt+","+Oe+"H"+Bt),Rr.attr("opacity",1).attr("transform",function(Xr){return it(Zt(Xr)+Oe)}),Yr.attr(Ze+"2",we*U),cs.attr(Ze,we*Mt).text(mt),nr.filter(xe).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===d?"start":4===d?"end":"middle"),nr.each(function(){this.__axis=Zt})}return lt.scale=function(dt){return arguments.length?(_=dt,lt):_},lt.ticks=function(){return T=Array.from(arguments),lt},lt.tickArguments=function(dt){return arguments.length?(T=null==dt?[]:Array.from(dt),lt):T.slice()},lt.tickValues=function(dt){return arguments.length?(x=null==dt?null:Array.from(dt),lt):x&&x.slice()},lt.tickFormat=function(dt){return arguments.length?(A=dt,lt):A},lt.tickSize=function(dt){return arguments.length?(U=ne=+dt,lt):U},lt.tickSizeInner=function(dt){return arguments.length?(U=+dt,lt):U},lt.tickSizeOuter=function(dt){return arguments.length?(ne=+dt,lt):ne},lt.tickPadding=function(dt){return arguments.length?(fe=+dt,lt):fe},lt.offset=function(dt){return arguments.length?(Oe=+dt,lt):Oe},lt}function Fe(){}function je(d){return null==d?Fe:function(){return this.querySelector(d)}}function He(d){return null==d?[]:Array.isArray(d)?d:Array.from(d)}function Ie(){return[]}function Ge(d){return null==d?Ie:function(){return this.querySelectorAll(d)}}function Me(d){return function(){return this.matches(d)}}function Ne(d){return function(_){return _.matches(d)}}var Xe=Array.prototype.find;function Je(){return this.firstElementChild}var tt=Array.prototype.filter;function et(){return Array.from(this.children)}function _t(d){return new Array(d.length)}function vt(d,_){this.ownerDocument=d.ownerDocument,this.namespaceURI=d.namespaceURI,this._next=null,this._parent=d,this.__data__=_}function Lt(d){return function(){return d}}function jt(d,_,T,x,A,U){for(var fe,ne=0,Oe=_.length,we=U.length;ne<we;++ne)(fe=_[ne])?(fe.__data__=U[ne],x[ne]=fe):T[ne]=new vt(d,U[ne]);for(;ne<Oe;++ne)(fe=_[ne])&&(A[ne]=fe)}function $t(d,_,T,x,A,U,ne){var fe,Oe,dt,we=new Map,Ze=_.length,it=U.length,lt=new Array(Ze);for(fe=0;fe<Ze;++fe)(Oe=_[fe])&&(lt[fe]=dt=ne.call(Oe,Oe.__data__,fe,_)+"",we.has(dt)?A[fe]=Oe:we.set(dt,Oe));for(fe=0;fe<it;++fe)dt=ne.call(d,U[fe],fe,U)+"",(Oe=we.get(dt))?(x[fe]=Oe,Oe.__data__=U[fe],we.delete(dt)):T[fe]=new vt(d,U[fe]);for(fe=0;fe<Ze;++fe)(Oe=_[fe])&&we.get(lt[fe])===Oe&&(A[fe]=Oe)}function Wt(d){return d.__data__}function gr(d){return"object"==typeof d&&"length"in d?d:Array.from(d)}function sr(d,_){return d<_?-1:d>_?1:d>=_?0:NaN}vt.prototype={constructor:vt,appendChild:function(d){return this._parent.insertBefore(d,this._next)},insertBefore:function(d,_){return this._parent.insertBefore(d,_)},querySelector:function(d){return this._parent.querySelector(d)},querySelectorAll:function(d){return this._parent.querySelectorAll(d)}};var hr="http://www.w3.org/1999/xhtml";const Tr={svg:"http://www.w3.org/2000/svg",xhtml:hr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Dr(d){var _=d+="",T=_.indexOf(":");return T>=0&&"xmlns"!==(_=d.slice(0,T))&&(d=d.slice(T+1)),Tr.hasOwnProperty(_)?{space:Tr[_],local:d}:d}function Lr(d){return function(){this.removeAttribute(d)}}function Hr(d){return function(){this.removeAttributeNS(d.space,d.local)}}function Qr(d,_){return function(){this.setAttribute(d,_)}}function Jr(d,_){return function(){this.setAttributeNS(d.space,d.local,_)}}function Ss(d,_){return function(){var T=_.apply(this,arguments);null==T?this.removeAttribute(d):this.setAttribute(d,T)}}function Cs(d,_){return function(){var T=_.apply(this,arguments);null==T?this.removeAttributeNS(d.space,d.local):this.setAttributeNS(d.space,d.local,T)}}function ct(d){return d.ownerDocument&&d.ownerDocument.defaultView||d.document&&d||d.defaultView}function At(d){return function(){this.style.removeProperty(d)}}function Kt(d,_,T){return function(){this.style.setProperty(d,_,T)}}function tr(d,_,T){return function(){var x=_.apply(this,arguments);null==x?this.style.removeProperty(d):this.style.setProperty(d,x,T)}}function Or(d,_){return d.style.getPropertyValue(_)||ct(d).getComputedStyle(d,null).getPropertyValue(_)}function gs(d){return function(){delete this[d]}}function Kr(d,_){return function(){this[d]=_}}function qt(d,_){return function(){var T=_.apply(this,arguments);null==T?delete this[d]:this[d]=T}}function Sr(d){return d.trim().split(/^|\s+/)}function fs(d){return d.classList||new at(d)}function at(d){this._node=d,this._names=Sr(d.getAttribute("class")||"")}function bt(d,_){for(var T=fs(d),x=-1,A=_.length;++x<A;)T.add(_[x])}function gt(d,_){for(var T=fs(d),x=-1,A=_.length;++x<A;)T.remove(_[x])}function Gt(d){return function(){bt(this,d)}}function fr(d){return function(){gt(this,d)}}function Ar(d,_){return function(){(_.apply(this,arguments)?bt:gt)(this,d)}}function as(){this.textContent=""}function Ps(d){return function(){this.textContent=d}}function Fs(d){return function(){var _=d.apply(this,arguments);this.textContent=_??""}}function Ws(){this.innerHTML=""}function yi(d){return function(){this.innerHTML=d}}function hn(d){return function(){var _=d.apply(this,arguments);this.innerHTML=_??""}}function kn(){this.nextSibling&&this.parentNode.appendChild(this)}function Bl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Yo(d){return function(){var _=this.ownerDocument,T=this.namespaceURI;return T===hr&&_.documentElement.namespaceURI===hr?_.createElement(d):_.createElementNS(T,d)}}function qi(d){return function(){return this.ownerDocument.createElementNS(d.space,d.local)}}function jr(d){var _=Dr(d);return(_.local?qi:Yo)(_)}function ui(){return null}function kt(){var d=this.parentNode;d&&d.removeChild(this)}function Vt(){var d=this.cloneNode(!1),_=this.parentNode;return _?_.insertBefore(d,this.nextSibling):d}function yr(){var d=this.cloneNode(!0),_=this.parentNode;return _?_.insertBefore(d,this.nextSibling):d}function Os(d){return d.trim().split(/^|\s+/).map(function(_){var T="",x=_.indexOf(".");return x>=0&&(T=_.slice(x+1),_=_.slice(0,x)),{type:_,name:T}})}function $s(d){return function(){var _=this.__on;if(_){for(var U,T=0,x=-1,A=_.length;T<A;++T)U=_[T],d.type&&U.type!==d.type||U.name!==d.name?_[++x]=U:this.removeEventListener(U.type,U.listener,U.options);++x?_.length=x:delete this.__on}}}function As(d,_,T){return function(){var A,x=this.__on,U=function Ls(d){return function(_){d.call(this,_,this.__data__)}}(_);if(x)for(var ne=0,fe=x.length;ne<fe;++ne)if((A=x[ne]).type===d.type&&A.name===d.name)return this.removeEventListener(A.type,A.listener,A.options),this.addEventListener(A.type,A.listener=U,A.options=T),void(A.value=_);this.addEventListener(d.type,U,T),A={type:d.type,name:d.name,value:_,listener:U,options:T},x?x.push(A):this.__on=[A]}}function en(d,_,T){var x=ct(d),A=x.CustomEvent;"function"==typeof A?A=new A(_,T):(A=x.document.createEvent("Event"),T?(A.initEvent(_,T.bubbles,T.cancelable),A.detail=T.detail):A.initEvent(_,!1,!1)),d.dispatchEvent(A)}function Mo(d,_){return function(){return en(this,d,_)}}function na(d,_){return function(){return en(this,d,_.apply(this,arguments))}}at.prototype={add:function(d){this._names.indexOf(d)<0&&(this._names.push(d),this._node.setAttribute("class",this._names.join(" ")))},remove:function(d){var _=this._names.indexOf(d);_>=0&&(this._names.splice(_,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(d){return this._names.indexOf(d)>=0}};var An=[null];function Ki(d,_){this._groups=d,this._parents=_}function _n(){return new Ki([[document.documentElement]],An)}Ki.prototype=_n.prototype={constructor:Ki,select:function Re(d){"function"!=typeof d&&(d=je(d));for(var _=this._groups,T=_.length,x=new Array(T),A=0;A<T;++A)for(var Oe,we,U=_[A],ne=U.length,fe=x[A]=new Array(ne),Ze=0;Ze<ne;++Ze)(Oe=U[Ze])&&(we=d.call(Oe,Oe.__data__,Ze,U))&&("__data__"in Oe&&(we.__data__=Oe.__data__),fe[Ze]=we);return new Ki(x,this._parents)},selectAll:function Le(d){d="function"==typeof d?function Pe(d){return function(){return He(d.apply(this,arguments))}}(d):Ge(d);for(var _=this._groups,T=_.length,x=[],A=[],U=0;U<T;++U)for(var Oe,ne=_[U],fe=ne.length,we=0;we<fe;++we)(Oe=ne[we])&&(x.push(d.call(Oe,Oe.__data__,we,ne)),A.push(Oe));return new Ki(x,A)},selectChild:function rt(d){return this.select(null==d?Je:function Ye(d){return function(){return Xe.call(this.children,d)}}("function"==typeof d?d:Ne(d)))},selectChildren:function ot(d){return this.selectAll(null==d?et:function qe(d){return function(){return tt.call(this.children,d)}}("function"==typeof d?d:Ne(d)))},filter:function ut(d){"function"!=typeof d&&(d=Me(d));for(var _=this._groups,T=_.length,x=new Array(T),A=0;A<T;++A)for(var Oe,U=_[A],ne=U.length,fe=x[A]=[],we=0;we<ne;++we)(Oe=U[we])&&d.call(Oe,Oe.__data__,we,U)&&fe.push(Oe);return new Ki(x,this._parents)},data:function pr(d,_){if(!arguments.length)return Array.from(this,Wt);var T=_?$t:jt,x=this._parents,A=this._groups;"function"!=typeof d&&(d=Lt(d));for(var U=A.length,ne=new Array(U),fe=new Array(U),Oe=new Array(U),we=0;we<U;++we){var Ze=x[we],it=A[we],lt=it.length,dt=gr(d.call(Ze,Ze&&Ze.__data__,we,x)),Tt=dt.length,mt=fe[we]=new Array(Tt),Mt=ne[we]=new Array(Tt),Pt=Oe[we]=new Array(lt);T(Ze,it,mt,Mt,Pt,dt,_);for(var Zt,nr,Nt=0,Bt=0;Nt<Tt;++Nt)if(Zt=mt[Nt]){for(Nt>=Bt&&(Bt=Nt+1);!(nr=Mt[Bt])&&++Bt<Tt;);Zt._next=nr||null}}return(ne=new Ki(ne,x))._enter=fe,ne._exit=Oe,ne},enter:function Ct(){return new Ki(this._enter||this._groups.map(_t),this._parents)},exit:function ar(){return new Ki(this._exit||this._groups.map(_t),this._parents)},join:function Fr(d,_,T){var x=this.enter(),A=this,U=this.exit();return"function"==typeof d?(x=d(x))&&(x=x.selection()):x=x.append(d+""),null!=_&&(A=_(A))&&(A=A.selection()),null==T?U.remove():T(U),x&&A?x.merge(A).order():A},merge:function mr(d){for(var _=d.selection?d.selection():d,T=this._groups,x=_._groups,A=T.length,ne=Math.min(A,x.length),fe=new Array(A),Oe=0;Oe<ne;++Oe)for(var dt,we=T[Oe],Ze=x[Oe],it=we.length,lt=fe[Oe]=new Array(it),Tt=0;Tt<it;++Tt)(dt=we[Tt]||Ze[Tt])&&(lt[Tt]=dt);for(;Oe<A;++Oe)fe[Oe]=T[Oe];return new Ki(fe,this._parents)},selection:function Ma(){return this},order:function wt(){for(var d=this._groups,_=-1,T=d.length;++_<T;)for(var ne,x=d[_],A=x.length-1,U=x[A];--A>=0;)(ne=x[A])&&(U&&4^ne.compareDocumentPosition(U)&&U.parentNode.insertBefore(ne,U),U=ne);return this},sort:function or(d){function _(it,lt){return it&&lt?d(it.__data__,lt.__data__):!it-!lt}d||(d=sr);for(var T=this._groups,x=T.length,A=new Array(x),U=0;U<x;++U){for(var we,ne=T[U],fe=ne.length,Oe=A[U]=new Array(fe),Ze=0;Ze<fe;++Ze)(we=ne[Ze])&&(Oe[Ze]=we);Oe.sort(_)}return new Ki(A,this._parents).order()},call:function rr(){var d=arguments[0];return arguments[0]=this,d.apply(null,arguments),this},nodes:function Et(){return Array.from(this)},node:function St(){for(var d=this._groups,_=0,T=d.length;_<T;++_)for(var x=d[_],A=0,U=x.length;A<U;++A){var ne=x[A];if(ne)return ne}return null},size:function Ft(){let d=0;for(const _ of this)++d;return d},empty:function zt(){return!this.node()},each:function dr(d){for(var _=this._groups,T=0,x=_.length;T<x;++T)for(var fe,A=_[T],U=0,ne=A.length;U<ne;++U)(fe=A[U])&&d.call(fe,fe.__data__,U,A);return this},attr:function Dt(d,_){var T=Dr(d);if(arguments.length<2){var x=this.node();return T.local?x.getAttributeNS(T.space,T.local):x.getAttribute(T)}return this.each((null==_?T.local?Hr:Lr:"function"==typeof _?T.local?Cs:Ss:T.local?Jr:Qr)(T,_))},style:function _r(d,_,T){return arguments.length>1?this.each((null==_?At:"function"==typeof _?tr:Kt)(d,_,T??"")):Or(this.node(),d)},property:function Ir(d,_){return arguments.length>1?this.each((null==_?gs:"function"==typeof _?qt:Kr)(d,_)):this.node()[d]},classed:function us(d,_){var T=Sr(d+"");if(arguments.length<2){for(var x=fs(this.node()),A=-1,U=T.length;++A<U;)if(!x.contains(T[A]))return!1;return!0}return this.each(("function"==typeof _?Ar:_?Gt:fr)(T,_))},text:function xs(d){return arguments.length?this.each(null==d?as:("function"==typeof d?Fs:Ps)(d)):this.node().textContent},html:function oi(d){return arguments.length?this.each(null==d?Ws:("function"==typeof d?hn:yi)(d)):this.node().innerHTML},raise:function pn(){return this.each(kn)},lower:function yo(){return this.each(Bl)},append:function Gi(d){var _="function"==typeof d?d:jr(d);return this.select(function(){return this.appendChild(_.apply(this,arguments))})},insert:function zn(d,_){var T="function"==typeof d?d:jr(d),x=null==_?ui:"function"==typeof _?_:je(_);return this.select(function(){return this.insertBefore(T.apply(this,arguments),x.apply(this,arguments)||null)})},remove:function Qt(){return this.each(kt)},clone:function ys(d){return this.select(d?yr:Vt)},datum:function js(d){return arguments.length?this.property("__data__",d):this.node().__data__},on:function xi(d,_,T){var A,ne,x=Os(d+""),U=x.length;if(!(arguments.length<2)){for(fe=_?As:$s,A=0;A<U;++A)this.each(fe(x[A],_,T));return this}var fe=this.node().__on;if(fe)for(var Ze,Oe=0,we=fe.length;Oe<we;++Oe)for(A=0,Ze=fe[Oe];A<U;++A)if((ne=x[A]).type===Ze.type&&ne.name===Ze.name)return Ze.value},dispatch:function Po(d,_){return this.each(("function"==typeof _?na:Mo)(d,_))},[Symbol.iterator]:function*ja(){for(var d=this._groups,_=0,T=d.length;_<T;++_)for(var ne,x=d[_],A=0,U=x.length;A<U;++A)(ne=x[A])&&(yield ne)}};const Ei=_n;var nc={value:()=>{}};function Jn(){for(var x,d=0,_=arguments.length,T={};d<_;++d){if(!(x=arguments[d]+"")||x in T||/[\s.]/.test(x))throw new Error("illegal type: "+x);T[x]=[]}return new jl(T)}function jl(d){this._=d}function oc(d,_){return d.trim().split(/^|\s+/).map(function(T){var x="",A=T.indexOf(".");if(A>=0&&(x=T.slice(A+1),T=T.slice(0,A)),T&&!_.hasOwnProperty(T))throw new Error("unknown type: "+T);return{type:T,name:x}})}function Lo(d,_){for(var A,T=0,x=d.length;T<x;++T)if((A=d[T]).name===_)return A.value}function Fa(d,_,T){for(var x=0,A=d.length;x<A;++x)if(d[x].name===_){d[x]=nc,d=d.slice(0,x).concat(d.slice(x+1));break}return null!=T&&d.push({name:_,value:T}),d}jl.prototype=Jn.prototype={constructor:jl,on:function(d,_){var A,T=this._,x=oc(d+"",T),U=-1,ne=x.length;if(!(arguments.length<2)){if(null!=_&&"function"!=typeof _)throw new Error("invalid callback: "+_);for(;++U<ne;)if(A=(d=x[U]).type)T[A]=Fa(T[A],d.name,_);else if(null==_)for(A in T)T[A]=Fa(T[A],d.name,null);return this}for(;++U<ne;)if((A=(d=x[U]).type)&&(A=Lo(T[A],d.name)))return A},copy:function(){var d={},_=this._;for(var T in _)d[T]=_[T].slice();return new jl(d)},call:function(d,_){if((A=arguments.length-2)>0)for(var A,U,T=new Array(A),x=0;x<A;++x)T[x]=arguments[x+2];if(!this._.hasOwnProperty(d))throw new Error("unknown type: "+d);for(x=0,A=(U=this._[d]).length;x<A;++x)U[x].value.apply(_,T)},apply:function(d,_,T){if(!this._.hasOwnProperty(d))throw new Error("unknown type: "+d);for(var x=this._[d],A=0,U=x.length;A<U;++A)x[A].value.apply(_,T)}};const Pa=Jn;var Bn,cn,cr=0,ns=0,vs=0,Uo=0,Na=0,Ot=0,It="object"==typeof performance&&performance.now?performance:Date,Xt="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(d){setTimeout(d,17)};function ur(){return Na||(Xt(Er),Na=It.now()+Ot)}function Er(){Na=0}function Mr(){this._call=this._time=this._next=null}function Nr(d,_,T){var x=new Mr;return x.restart(d,_,T),x}function es(){Na=(Uo=It.now())+Ot,cr=ns=0;try{!function ts(){ur(),++cr;for(var _,d=Bn;d;)(_=Na-d._time)>=0&&d._call.call(void 0,_),d=d._next;--cr}()}finally{cr=0,function Ks(){for(var d,T,_=Bn,x=1/0;_;)_._call?(x>_._time&&(x=_._time),d=_,_=_._next):(T=_._next,_._next=null,_=d?d._next=T:Bn=T);cn=d,ri(x)}(),Na=0}}function hs(){var d=It.now(),_=d-Uo;_>1e3&&(Ot-=_,Uo=d)}function ri(d){cr||(ns&&(ns=clearTimeout(ns)),d-Na>24?(d<1/0&&(ns=setTimeout(es,d-It.now()-Ot)),vs&&(vs=clearInterval(vs))):(vs||(Uo=It.now(),vs=setInterval(hs,1e3)),cr=1,Xt(es)))}function Ci(d,_,T){var x=new Mr;return x.restart(A=>{x.stop(),d(A+_)},_=null==_?0:+_,T),x}Mr.prototype=Nr.prototype={constructor:Mr,restart:function(d,_,T){if("function"!=typeof d)throw new TypeError("callback is not a function");T=(null==T?ur():+T)+(null==_?0:+_),!this._next&&cn!==this&&(cn?cn._next=this:Bn=this,cn=this),this._call=d,this._time=T,ri()},stop:function(){this._call&&(this._call=null,this._time=1/0,ri())}};var Qn=Pa("start","end","cancel","interrupt"),hl=[];function eh(d,_,T,x,A,U){var ne=d.__transition;if(ne){if(T in ne)return}else d.__transition={};!function I0(d,_,T){var A,x=d.__transition;function ne(we){var Ze,it,lt,dt;if(1!==T.state)return Oe();for(Ze in x)if((dt=x[Ze]).name===T.name){if(3===dt.state)return Ci(ne);4===dt.state?(dt.state=6,dt.timer.stop(),dt.on.call("interrupt",d,d.__data__,dt.index,dt.group),delete x[Ze]):+Ze<_&&(dt.state=6,dt.timer.stop(),dt.on.call("cancel",d,d.__data__,dt.index,dt.group),delete x[Ze])}if(Ci(function(){3===T.state&&(T.state=4,T.timer.restart(fe,T.delay,T.time),fe(we))}),T.state=2,T.on.call("start",d,d.__data__,T.index,T.group),2===T.state){for(T.state=3,A=new Array(lt=T.tween.length),Ze=0,it=-1;Ze<lt;++Ze)(dt=T.tween[Ze].value.call(d,d.__data__,T.index,T.group))&&(A[++it]=dt);A.length=it+1}}function fe(we){for(var Ze=we<T.duration?T.ease.call(null,we/T.duration):(T.timer.restart(Oe),T.state=5,1),it=-1,lt=A.length;++it<lt;)A[it].call(d,Ze);5===T.state&&(T.on.call("end",d,d.__data__,T.index,T.group),Oe())}function Oe(){for(var we in T.state=6,T.timer.stop(),delete x[_],x)return;delete d.__transition}x[_]=T,T.timer=Nr(function U(we){T.state=1,T.timer.restart(ne,T.delay,T.time),T.delay<=we&&ne(we-T.delay)},0,T.time)}(d,T,{name:_,index:x,group:A,on:Qn,tween:hl,time:U.time,delay:U.delay,duration:U.duration,ease:U.ease,timer:null,state:0})}function Jf(d,_){var T=ac(d,_);if(T.state>0)throw new Error("too late; already scheduled");return T}function vo(d,_){var T=ac(d,_);if(T.state>3)throw new Error("too late; already running");return T}function ac(d,_){var T=d.__transition;if(!T||!(T=T[_]))throw new Error("transition not found");return T}function aa(d,_){return d=+d,_=+_,function(T){return d*(1-T)+_*T}}var fl,_l=180/Math.PI,up={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ny(d,_,T,x,A,U){var ne,fe,Oe;return(ne=Math.sqrt(d*d+_*_))&&(d/=ne,_/=ne),(Oe=d*T+_*x)&&(T-=d*Oe,x-=_*Oe),(fe=Math.sqrt(T*T+x*x))&&(T/=fe,x/=fe,Oe/=fe),d*x<_*T&&(d=-d,_=-_,Oe=-Oe,ne=-ne),{translateX:A,translateY:U,rotate:Math.atan2(_,d)*_l,skewX:Math.atan(Oe)*_l,scaleX:ne,scaleY:fe}}function Wy(d,_,T,x){function A(we){return we.length?we.pop()+" ":""}return function(we,Ze){var it=[],lt=[];return we=d(we),Ze=d(Ze),function U(we,Ze,it,lt,dt,Tt){if(we!==it||Ze!==lt){var mt=dt.push("translate(",null,_,null,T);Tt.push({i:mt-4,x:aa(we,it)},{i:mt-2,x:aa(Ze,lt)})}else(it||lt)&&dt.push("translate("+it+_+lt+T)}(we.translateX,we.translateY,Ze.translateX,Ze.translateY,it,lt),function ne(we,Ze,it,lt){we!==Ze?(we-Ze>180?Ze+=360:Ze-we>180&&(we+=360),lt.push({i:it.push(A(it)+"rotate(",null,x)-2,x:aa(we,Ze)})):Ze&&it.push(A(it)+"rotate("+Ze+x)}(we.rotate,Ze.rotate,it,lt),function fe(we,Ze,it,lt){we!==Ze?lt.push({i:it.push(A(it)+"skewX(",null,x)-2,x:aa(we,Ze)}):Ze&&it.push(A(it)+"skewX("+Ze+x)}(we.skewX,Ze.skewX,it,lt),function Oe(we,Ze,it,lt,dt,Tt){if(we!==it||Ze!==lt){var mt=dt.push(A(dt)+"scale(",null,",",null,")");Tt.push({i:mt-4,x:aa(we,it)},{i:mt-2,x:aa(Ze,lt)})}else(1!==it||1!==lt)&&dt.push(A(dt)+"scale("+it+","+lt+")")}(we.scaleX,we.scaleY,Ze.scaleX,Ze.scaleY,it,lt),we=Ze=null,function(dt){for(var Mt,Tt=-1,mt=lt.length;++Tt<mt;)it[(Mt=lt[Tt]).i]=Mt.x(dt);return it.join("")}}}var eC=Wy(function dp(d){const _=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(d+"");return _.isIdentity?up:Ny(_.a,_.b,_.c,_.d,_.e,_.f)},"px, ","px)","deg)"),tC=Wy(function wc(d){return null!=d&&(fl||(fl=document.createElementNS("http://www.w3.org/2000/svg","g")),fl.setAttribute("transform",d),d=fl.transform.baseVal.consolidate())?Ny((d=d.matrix).a,d.b,d.c,d.d,d.e,d.f):up},", ",")",")");function rC(d,_){var T,x;return function(){var A=vo(this,d),U=A.tween;if(U!==T)for(var ne=0,fe=(x=T=U).length;ne<fe;++ne)if(x[ne].name===_){(x=x.slice()).splice(ne,1);break}A.tween=x}}function sC(d,_,T){var x,A;if("function"!=typeof T)throw new Error;return function(){var U=vo(this,d),ne=U.tween;if(ne!==x){A=(x=ne).slice();for(var fe={name:_,value:T},Oe=0,we=A.length;Oe<we;++Oe)if(A[Oe].name===_){A[Oe]=fe;break}Oe===we&&A.push(fe)}U.tween=A}}function L0(d,_,T){var x=d._id;return d.each(function(){var A=vo(this,x);(A.value||(A.value={}))[_]=T.apply(this,arguments)}),function(A){return ac(A,x).value[_]}}function U0(d,_,T){d.prototype=_.prototype=T,T.constructor=d}function Qf(d,_){var T=Object.create(d.prototype);for(var x in _)T[x]=_[x];return T}function Hi(){}var rh=1/.7,lc="\\s*([+-]?\\d+)\\s*",rd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bo=/^#([0-9a-f]{3,8})$/,nC=new RegExp(`^rgb\\(${lc},${lc},${lc}\\)$`),Vy=new RegExp(`^rgb\\(${zo},${zo},${zo}\\)$`),qf=new RegExp(`^rgba\\(${lc},${lc},${lc},${rd}\\)$`),Cn=new RegExp(`^rgba\\(${zo},${zo},${zo},${rd}\\)$`),oC=new RegExp(`^hsl\\(${rd},${zo},${zo}\\)$`),aC=new RegExp(`^hsla\\(${rd},${zo},${zo},${rd}\\)$`),zy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Hy(){return this.rgb().formatHex()}function Jc(){return this.rgb().formatRgb()}function la(d){var _,T;return d=(d+"").trim().toLowerCase(),(_=Bo.exec(d))?(T=_[1].length,_=parseInt(_[1],16),6===T?em(_):3===T?new Qa(_>>8&15|_>>4&240,_>>4&15|240&_,(15&_)<<4|15&_,1):8===T?sh(_>>24&255,_>>16&255,_>>8&255,(255&_)/255):4===T?sh(_>>12&15|_>>8&240,_>>8&15|_>>4&240,_>>4&15|240&_,((15&_)<<4|15&_)/255):null):(_=nC.exec(d))?new Qa(_[1],_[2],_[3],1):(_=Vy.exec(d))?new Qa(255*_[1]/100,255*_[2]/100,255*_[3]/100,1):(_=qf.exec(d))?sh(_[1],_[2],_[3],_[4]):(_=Cn.exec(d))?sh(255*_[1]/100,255*_[2]/100,255*_[3]/100,_[4]):(_=oC.exec(d))?$y(_[1],_[2]/100,_[3]/100,1):(_=aC.exec(d))?$y(_[1],_[2]/100,_[3]/100,_[4]):zy.hasOwnProperty(d)?em(zy[d]):"transparent"===d?new Qa(NaN,NaN,NaN,0):null}function em(d){return new Qa(d>>16&255,d>>8&255,255&d,1)}function sh(d,_,T,x){return x<=0&&(d=_=T=NaN),new Qa(d,_,T,x)}function Gy(d){return d instanceof Hi||(d=la(d)),d?new Qa((d=d.rgb()).r,d.g,d.b,d.opacity):new Qa}function B0(d,_,T,x){return 1===arguments.length?Gy(d):new Qa(d,_,T,x??1)}function Qa(d,_,T,x){this.r=+d,this.g=+_,this.b=+T,this.opacity=+x}function Ky(){return`#${Qc(this.r)}${Qc(this.g)}${Qc(this.b)}`}function Zy(){const d=hp(this.opacity);return`${1===d?"rgb(":"rgba("}${sd(this.r)}, ${sd(this.g)}, ${sd(this.b)}${1===d?")":`, ${d})`}`}function hp(d){return isNaN(d)?1:Math.max(0,Math.min(1,d))}function sd(d){return Math.max(0,Math.min(255,Math.round(d)||0))}function Qc(d){return((d=sd(d))<16?"0":"")+d.toString(16)}function $y(d,_,T,x){return x<=0?d=_=T=NaN:T<=0||T>=1?d=_=NaN:_<=0&&(d=NaN),new Fl(d,_,T,x)}function Yy(d){if(d instanceof Fl)return new Fl(d.h,d.s,d.l,d.opacity);if(d instanceof Hi||(d=la(d)),!d)return new Fl;if(d instanceof Fl)return d;var _=(d=d.rgb()).r/255,T=d.g/255,x=d.b/255,A=Math.min(_,T,x),U=Math.max(_,T,x),ne=NaN,fe=U-A,Oe=(U+A)/2;return fe?(ne=_===U?(T-x)/fe+6*(T<x):T===U?(x-_)/fe+2:(_-T)/fe+4,fe/=Oe<.5?U+A:2-U-A,ne*=60):fe=Oe>0&&Oe<1?0:ne,new Fl(ne,fe,Oe,d.opacity)}function Fl(d,_,T,x){this.h=+d,this.s=+_,this.l=+T,this.opacity=+x}function ky(d){return(d=(d||0)%360)<0?d+360:d}function j0(d){return Math.max(0,Math.min(1,d||0))}function tm(d,_,T){return 255*(d<60?_+(T-_)*d/60:d<180?T:d<240?_+(T-_)*(240-d)/60:_)}function pp(d,_,T,x,A){var U=d*d,ne=U*d;return((1-3*d+3*U-ne)*_+(4-6*U+3*ne)*T+(1+3*d+3*U-3*ne)*x+ne*A)/6}U0(Hi,la,{copy(d){return Object.assign(new this.constructor,this,d)},displayable(){return this.rgb().displayable()},hex:Hy,formatHex:Hy,formatHex8:function lC(){return this.rgb().formatHex8()},formatHsl:function cC(){return Yy(this).formatHsl()},formatRgb:Jc,toString:Jc}),U0(Qa,B0,Qf(Hi,{brighter(d){return d=null==d?rh:Math.pow(rh,d),new Qa(this.r*d,this.g*d,this.b*d,this.opacity)},darker(d){return d=null==d?.7:Math.pow(.7,d),new Qa(this.r*d,this.g*d,this.b*d,this.opacity)},rgb(){return this},clamp(){return new Qa(sd(this.r),sd(this.g),sd(this.b),hp(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ky,formatHex:Ky,formatHex8:function uC(){return`#${Qc(this.r)}${Qc(this.g)}${Qc(this.b)}${Qc(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Zy,toString:Zy})),U0(Fl,function Xy(d,_,T,x){return 1===arguments.length?Yy(d):new Fl(d,_,T,x??1)},Qf(Hi,{brighter(d){return d=null==d?rh:Math.pow(rh,d),new Fl(this.h,this.s,this.l*d,this.opacity)},darker(d){return d=null==d?.7:Math.pow(.7,d),new Fl(this.h,this.s,this.l*d,this.opacity)},rgb(){var d=this.h%360+360*(this.h<0),_=isNaN(d)||isNaN(this.s)?0:this.s,T=this.l,x=T+(T<.5?T:1-T)*_,A=2*T-x;return new Qa(tm(d>=240?d-240:d+120,A,x),tm(d,A,x),tm(d<120?d+240:d-120,A,x),this.opacity)},clamp(){return new Fl(ky(this.h),j0(this.s),j0(this.l),hp(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const d=hp(this.opacity);return`${1===d?"hsl(":"hsla("}${ky(this.h)}, ${100*j0(this.s)}%, ${100*j0(this.l)}%${1===d?")":`, ${d})`}`}}));const F0=d=>()=>d;function rm(d,_){var T=_-d;return T?function Jy(d,_){return function(T){return d+T*_}}(d,T):F0(isNaN(d)?_:d)}const ml=function d(_){var T=function fC(d){return 1==(d=+d)?rm:function(_,T){return T-_?function pC(d,_,T){return d=Math.pow(d,T),_=Math.pow(_,T)-d,T=1/T,function(x){return Math.pow(d+x*_,T)}}(_,T,d):F0(isNaN(_)?T:_)}}(_);function x(A,U){var ne=T((A=B0(A)).r,(U=B0(U)).r),fe=T(A.g,U.g),Oe=T(A.b,U.b),we=rm(A.opacity,U.opacity);return function(Ze){return A.r=ne(Ze),A.g=fe(Ze),A.b=Oe(Ze),A.opacity=we(Ze),A+""}}return x.gamma=d,x}(1);function sm(d){return function(_){var ne,fe,T=_.length,x=new Array(T),A=new Array(T),U=new Array(T);for(ne=0;ne<T;++ne)fe=B0(_[ne]),x[ne]=fe.r||0,A[ne]=fe.g||0,U[ne]=fe.b||0;return x=d(x),A=d(A),U=d(U),fe.opacity=1,function(Oe){return fe.r=x(Oe),fe.g=A(Oe),fe.b=U(Oe),fe+""}}}sm(function dC(d){var _=d.length-1;return function(T){var x=T<=0?T=0:T>=1?(T=1,_-1):Math.floor(T*_),A=d[x],U=d[x+1];return pp((T-x/_)*_,x>0?d[x-1]:2*A-U,A,U,x<_-1?d[x+2]:2*U-A)}}),sm(function hC(d){var _=d.length;return function(T){var x=Math.floor(((T%=1)<0?++T:T)*_);return pp((T-x/_)*_,d[(x+_-1)%_],d[x%_],d[(x+1)%_],d[(x+2)%_])}});var N0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,im=new RegExp(N0.source,"g");function nm(d,_){var x,A,U,T=N0.lastIndex=im.lastIndex=0,ne=-1,fe=[],Oe=[];for(d+="",_+="";(x=N0.exec(d))&&(A=im.exec(_));)(U=A.index)>T&&(U=_.slice(T,U),fe[ne]?fe[ne]+=U:fe[++ne]=U),(x=x[0])===(A=A[0])?fe[ne]?fe[ne]+=A:fe[++ne]=A:(fe[++ne]=null,Oe.push({i:ne,x:aa(x,A)})),T=im.lastIndex;return T<_.length&&(U=_.slice(T),fe[ne]?fe[ne]+=U:fe[++ne]=U),fe.length<2?Oe[0]?function ih(d){return function(_){return d(_)+""}}(Oe[0].x):function yC(d){return function(){return d}}(_):(_=Oe.length,function(we){for(var it,Ze=0;Ze<_;++Ze)fe[(it=Oe[Ze]).i]=it.x(we);return fe.join("")})}function W0(d,_){var T;return("number"==typeof _?aa:_ instanceof la?ml:(T=la(_))?(_=T,ml):nm)(d,_)}function V0(d){return function(){this.removeAttribute(d)}}function z0(d){return function(){this.removeAttributeNS(d.space,d.local)}}function Qy(d,_,T){var x,U,A=T+"";return function(){var ne=this.getAttribute(d);return ne===A?null:ne===x?U:U=_(x=ne,T)}}function vC(d,_,T){var x,U,A=T+"";return function(){var ne=this.getAttributeNS(d.space,d.local);return ne===A?null:ne===x?U:U=_(x=ne,T)}}function EC(d,_,T){var x,A,U;return function(){var ne,Oe,fe=T(this);return null==fe?void this.removeAttribute(d):(ne=this.getAttribute(d))===(Oe=fe+"")?null:ne===x&&Oe===A?U:(A=Oe,U=_(x=ne,fe))}}function om(d,_,T){var x,A,U;return function(){var ne,Oe,fe=T(this);return null==fe?void this.removeAttributeNS(d.space,d.local):(ne=this.getAttributeNS(d.space,d.local))===(Oe=fe+"")?null:ne===x&&Oe===A?U:(A=Oe,U=_(x=ne,fe))}}function CC(d,_){return function(T){this.setAttribute(d,_.call(this,T))}}function TC(d,_){return function(T){this.setAttributeNS(d.space,d.local,_.call(this,T))}}function MC(d,_){var T,x;function A(){var U=_.apply(this,arguments);return U!==x&&(T=(x=U)&&TC(d,U)),T}return A._value=_,A}function qy(d,_){var T,x;function A(){var U=_.apply(this,arguments);return U!==x&&(T=(x=U)&&CC(d,U)),T}return A._value=_,A}function OC(d,_){return function(){Jf(this,d).delay=+_.apply(this,arguments)}}function xC(d,_){return _=+_,function(){Jf(this,d).delay=_}}function SC(d,_){return function(){vo(this,d).duration=+_.apply(this,arguments)}}function AC(d,_){return _=+_,function(){vo(this,d).duration=_}}function wC(d,_){if("function"!=typeof _)throw new Error;return function(){vo(this,d).ease=_}}function FC(d,_,T){var x,A,U=function jC(d){return(d+"").trim().split(/^|\s+/).every(function(_){var T=_.indexOf(".");return T>=0&&(_=_.slice(0,T)),!_||"start"===_})}(_)?Jf:vo;return function(){var ne=U(this,d),fe=ne.on;fe!==x&&(A=(x=fe).copy()).on(_,T),ne.on=A}}var WC=Ei.prototype.constructor;function HC(d){return function(){this.style.removeProperty(d)}}function Lx(d,_,T){return function(x){this.style.setProperty(d,_.call(this,x),T)}}function ZC(d,_,T){var x,A;function U(){var ne=_.apply(this,arguments);return ne!==A&&(x=(A=ne)&&Lx(d,ne,T)),x}return U._value=_,U}function Ux(d){return function(_){this.textContent=d.call(this,_)}}function kC(d){var _,T;function x(){var A=d.apply(this,arguments);return A!==T&&(_=(T=A)&&Ux(A)),_}return x._value=d,x}var iv=0;function Nl(d,_,T,x){this._groups=d,this._parents=_,this._name=T,this._id=x}function ov(){return++iv}var Ic=Ei.prototype;Nl.prototype=function nv(d){return Ei().transition(d)}.prototype={constructor:Nl,select:function rv(d){var _=this._name,T=this._id;"function"!=typeof d&&(d=je(d));for(var x=this._groups,A=x.length,U=new Array(A),ne=0;ne<A;++ne)for(var Ze,it,fe=x[ne],Oe=fe.length,we=U[ne]=new Array(Oe),lt=0;lt<Oe;++lt)(Ze=fe[lt])&&(it=d.call(Ze,Ze.__data__,lt,fe))&&("__data__"in Ze&&(it.__data__=Ze.__data__),we[lt]=it,eh(we[lt],_,T,lt,we,ac(Ze,T)));return new Nl(U,this._parents,_,T)},selectAll:function sv(d){var _=this._name,T=this._id;"function"!=typeof d&&(d=Ge(d));for(var x=this._groups,A=x.length,U=[],ne=[],fe=0;fe<A;++fe)for(var Ze,Oe=x[fe],we=Oe.length,it=0;it<we;++it)if(Ze=Oe[it]){for(var dt,lt=d.call(Ze,Ze.__data__,it,Oe),Tt=ac(Ze,T),mt=0,Mt=lt.length;mt<Mt;++mt)(dt=lt[mt])&&eh(dt,_,T,mt,lt,Tt);U.push(lt),ne.push(Ze)}return new Nl(U,ne,_,T)},selectChild:Ic.selectChild,selectChildren:Ic.selectChildren,filter:function UC(d){"function"!=typeof d&&(d=Me(d));for(var _=this._groups,T=_.length,x=new Array(T),A=0;A<T;++A)for(var Oe,U=_[A],ne=U.length,fe=x[A]=[],we=0;we<ne;++we)(Oe=U[we])&&d.call(Oe,Oe.__data__,we,U)&&fe.push(Oe);return new Nl(x,this._parents,this._name,this._id)},merge:function BC(d){if(d._id!==this._id)throw new Error;for(var _=this._groups,T=d._groups,x=_.length,U=Math.min(x,T.length),ne=new Array(x),fe=0;fe<U;++fe)for(var lt,Oe=_[fe],we=T[fe],Ze=Oe.length,it=ne[fe]=new Array(Ze),dt=0;dt<Ze;++dt)(lt=Oe[dt]||we[dt])&&(it[dt]=lt);for(;fe<x;++fe)ne[fe]=_[fe];return new Nl(ne,this._parents,this._name,this._id)},selection:function VC(){return new WC(this._groups,this._parents)},transition:function JC(){for(var d=this._name,_=this._id,T=ov(),x=this._groups,A=x.length,U=0;U<A;++U)for(var Oe,ne=x[U],fe=ne.length,we=0;we<fe;++we)if(Oe=ne[we]){var Ze=ac(Oe,_);eh(Oe,d,T,we,ne,{time:Ze.time+Ze.delay+Ze.duration,delay:0,duration:Ze.duration,ease:Ze.ease})}return new Nl(x,this._parents,d,T)},call:Ic.call,nodes:Ic.nodes,node:Ic.node,size:Ic.size,empty:Ic.empty,each:Ic.each,on:function Ix(d,_){var T=this._id;return arguments.length<2?ac(this.node(),T).on.on(d):this.each(FC(T,d,_))},attr:function bC(d,_){var T=Dr(d),x="transform"===T?tC:W0;return this.attrTween(d,"function"==typeof _?(T.local?om:EC)(T,x,L0(this,"attr."+d,_)):null==_?(T.local?z0:V0)(T):(T.local?vC:Qy)(T,x,_))},attrTween:function PC(d,_){var T="attr."+d;if(arguments.length<2)return(T=this.tween(T))&&T._value;if(null==_)return this.tween(T,null);if("function"!=typeof _)throw new Error;var x=Dr(d);return this.tween(T,(x.local?MC:qy)(x,_))},style:function KC(d,_,T){var x="transform"==(d+="")?eC:W0;return null==_?this.styleTween(d,function zC(d,_){var T,x,A;return function(){var U=Or(this,d),ne=(this.style.removeProperty(d),Or(this,d));return U===ne?null:U===T&&ne===x?A:A=_(T=U,x=ne)}}(d,x)).on("end.style."+d,HC(d)):"function"==typeof _?this.styleTween(d,function GC(d,_,T){var x,A,U;return function(){var ne=Or(this,d),fe=T(this),Oe=fe+"";return null==fe&&(this.style.removeProperty(d),Oe=fe=Or(this,d)),ne===Oe?null:ne===x&&Oe===A?U:(A=Oe,U=_(x=ne,fe))}}(d,x,L0(this,"style."+d,_))).each(function am(d,_){var T,x,A,fe,U="style."+_,ne="end."+U;return function(){var Oe=vo(this,d),we=Oe.on,Ze=null==Oe.value[U]?fe||(fe=HC(_)):void 0;(we!==T||A!==Ze)&&(x=(T=we).copy()).on(ne,A=Ze),Oe.on=x}}(this._id,d)):this.styleTween(d,function nh(d,_,T){var x,U,A=T+"";return function(){var ne=Or(this,d);return ne===A?null:ne===x?U:U=_(x=ne,T)}}(d,x,_),T).on("end.style."+d,null)},styleTween:function $C(d,_,T){var x="style."+(d+="");if(arguments.length<2)return(x=this.tween(x))&&x._value;if(null==_)return this.tween(x,null);if("function"!=typeof _)throw new Error;return this.tween(x,ZC(d,_,T??""))},text:function XC(d){return this.tween("text","function"==typeof d?function YC(d){return function(){var _=d(this);this.textContent=_??""}}(L0(this,"text",d)):function _p(d){return function(){this.textContent=d}}(null==d?"":d+""))},textTween:function lm(d){var _="text";if(arguments.length<1)return(_=this.tween(_))&&_._value;if(null==d)return this.tween(_,null);if("function"!=typeof d)throw new Error;return this.tween(_,kC(d))},remove:function NC(){return this.on("end.remove",function tv(d){return function(){var _=this.parentNode;for(var T in this.__transition)if(+T!==d)return;_&&_.removeChild(this)}}(this._id))},tween:function iC(d,_){var T=this._id;if(d+="",arguments.length<2){for(var ne,x=ac(this.node(),T).tween,A=0,U=x.length;A<U;++A)if((ne=x[A]).name===d)return ne.value;return null}return this.each((null==_?rC:sC)(T,d,_))},delay:function DC(d){var _=this._id;return arguments.length?this.each(("function"==typeof d?OC:xC)(_,d)):ac(this.node(),_).delay},duration:function RC(d){var _=this._id;return arguments.length?this.each(("function"==typeof d?SC:AC)(_,d)):ac(this.node(),_).duration},ease:function ev(d){var _=this._id;return arguments.length?this.each(wC(_,d)):ac(this.node(),_).ease},easeVarying:function LC(d){if("function"!=typeof d)throw new Error;return this.each(function IC(d,_){return function(){var T=_.apply(this,arguments);if("function"!=typeof T)throw new Error;vo(this,d).ease=T}}(this._id,d))},end:function cm(){var d,_,T=this,x=T._id,A=T.size();return new Promise(function(U,ne){var fe={value:ne},Oe={value:function(){0==--A&&U()}};T.each(function(){var we=vo(this,x),Ze=we.on;Ze!==d&&((_=(d=Ze).copy())._.cancel.push(fe),_._.interrupt.push(fe),_._.end.push(Oe)),we.on=_}),0===A&&U()})},[Symbol.iterator]:Ic[Symbol.iterator]};var id={time:null,delay:0,duration:250,ease:function qC(d){return((d*=2)<=1?d*d*d:(d-=2)*d*d+2)/2}};function um(d,_){for(var T;!(T=d.__transition)||!(T=T[_]);)if(!(d=d.parentNode))throw new Error(`transition ${_} not found`);return T}Ei.prototype.interrupt=function qb(d){return this.each(function(){!function Qb(d,_){var x,A,ne,T=d.__transition,U=!0;if(T){for(ne in _=null==_?null:_+"",T)(x=T[ne]).name===_?(A=x.state>2&&x.state<5,x.state=6,x.timer.stop(),x.on.call(A?"interrupt":"cancel",d,d.__data__,x.index,x.group),delete T[ne]):U=!1;U&&delete d.__transition}}(this,d)})},Ei.prototype.transition=function eT(d){var _,T;d instanceof Nl?(_=d._id,d=d._name):(_=ov(),(T=id).time=ur(),d=null==d?null:d+"");for(var x=this._groups,A=x.length,U=0;U<A;++U)for(var Oe,ne=x[U],fe=ne.length,we=0;we<fe;++we)(Oe=ne[we])&&eh(Oe,d,_,we,ne,T||um(Oe,_));return new Nl(x,this._parents,d,_)};Math;function ki(d){return{type:d}}function ad(d,_){return null==d||null==_?NaN:d<_?-1:d>_?1:d>=_?0:NaN}function jo(d,_){return null==d||null==_?NaN:_<d?-1:_>d?1:_>=d?0:NaN}function ld(d){let _,T,x;function A(fe,Oe,we=0,Ze=fe.length){if(we<Ze){if(0!==_(Oe,Oe))return Ze;do{const it=we+Ze>>>1;T(fe[it],Oe)<0?we=it+1:Ze=it}while(we<Ze)}return we}return 2!==d.length?(_=ad,T=(fe,Oe)=>ad(d(fe),Oe),x=(fe,Oe)=>d(fe)-Oe):(_=d===ad||d===jo?d:pm,T=d,x=d),{left:A,center:function ne(fe,Oe,we=0,Ze=fe.length){const it=A(fe,Oe,we,Ze-1);return it>we&&x(fe[it-1],Oe)>-x(fe[it],Oe)?it-1:it},right:function U(fe,Oe,we=0,Ze=fe.length){if(we<Ze){if(0!==_(Oe,Oe))return Ze;do{const it=we+Ze>>>1;T(fe[it],Oe)<=0?we=it+1:Ze=it}while(we<Ze)}return we}}}function pm(){return 0}["w","e"].map(ki),["n","s"].map(ki),["n","w","e","s","nw","ne","sw","se"].map(ki);var _m=Math.sqrt(50),fm=Math.sqrt(10),mm=Math.sqrt(2);function pv(d,_,T){var x=Math.abs(_-d)/Math.max(0,T),A=Math.pow(10,Math.floor(Math.log(x)/Math.LN10)),U=x/A;return U>=_m?A*=10:U>=fm?A*=5:U>=mm&&(A*=2),_<d?-A:A}const Bc=1e3,gl=6e4,eu=60*gl,tu=24*eu,ym=7*tu,vm=30*tu,el=365*tu,Vl=new Date,H0=new Date;function Oo(d,_,T,x){function A(U){return d(U=0===arguments.length?new Date:new Date(+U)),U}return A.floor=U=>(d(U=new Date(+U)),U),A.ceil=U=>(d(U=new Date(U-1)),_(U,1),d(U),U),A.round=U=>{const ne=A(U),fe=A.ceil(U);return U-ne<fe-U?ne:fe},A.offset=(U,ne)=>(_(U=new Date(+U),null==ne?1:Math.floor(ne)),U),A.range=(U,ne,fe)=>{const Oe=[];if(U=A.ceil(U),fe=null==fe?1:Math.floor(fe),!(U<ne&&fe>0))return Oe;let we;do{Oe.push(we=new Date(+U)),_(U,fe),d(U)}while(we<U&&U<ne);return Oe},A.filter=U=>Oo(ne=>{if(ne>=ne)for(;d(ne),!U(ne);)ne.setTime(ne-1)},(ne,fe)=>{if(ne>=ne)if(fe<0)for(;++fe<=0;)for(;_(ne,-1),!U(ne););else for(;--fe>=0;)for(;_(ne,1),!U(ne););}),T&&(A.count=(U,ne)=>(Vl.setTime(+U),H0.setTime(+ne),d(Vl),d(H0),Math.floor(T(Vl,H0))),A.every=U=>(U=Math.floor(U),isFinite(U)&&U>0?U>1?A.filter(x?ne=>x(ne)%U==0:ne=>A.count(0,ne)%U==0):A:null)),A}const G0=Oo(()=>{},(d,_)=>{d.setTime(+d+_)},(d,_)=>_-d);G0.every=d=>(d=Math.floor(d),isFinite(d)&&d>0?d>1?Oo(_=>{_.setTime(Math.floor(_/d)*d)},(_,T)=>{_.setTime(+_+T*d)},(_,T)=>(T-_)/d):G0:null);const lh=Oo(d=>{d.setTime(d-d.getMilliseconds())},(d,_)=>{d.setTime(+d+_*Bc)},(d,_)=>(_-d)/Bc,d=>d.getUTCSeconds()),Em=Oo(d=>{d.setTime(d-d.getMilliseconds()-d.getSeconds()*Bc)},(d,_)=>{d.setTime(+d+_*gl)},(d,_)=>(_-d)/gl,d=>d.getMinutes()),K0=Oo(d=>{d.setUTCSeconds(0,0)},(d,_)=>{d.setTime(+d+_*gl)},(d,_)=>(_-d)/gl,d=>d.getUTCMinutes()),Z0=Oo(d=>{d.setTime(d-d.getMilliseconds()-d.getSeconds()*Bc-d.getMinutes()*gl)},(d,_)=>{d.setTime(+d+_*eu)},(d,_)=>(_-d)/eu,d=>d.getHours()),Mu=Oo(d=>{d.setUTCMinutes(0,0,0)},(d,_)=>{d.setTime(+d+_*eu)},(d,_)=>(_-d)/eu,d=>d.getUTCHours()),Hn=Oo(d=>d.setHours(0,0,0,0),(d,_)=>d.setDate(d.getDate()+_),(d,_)=>(_-d-(_.getTimezoneOffset()-d.getTimezoneOffset())*gl)/tu,d=>d.getDate()-1),tl=Oo(d=>{d.setUTCHours(0,0,0,0)},(d,_)=>{d.setUTCDate(d.getUTCDate()+_)},(d,_)=>(_-d)/tu,d=>d.getUTCDate()-1),Pu=Oo(d=>{d.setUTCHours(0,0,0,0)},(d,_)=>{d.setUTCDate(d.getUTCDate()+_)},(d,_)=>(_-d)/tu,d=>Math.floor(d/tu));function ud(d){return Oo(_=>{_.setDate(_.getDate()-(_.getDay()+7-d)%7),_.setHours(0,0,0,0)},(_,T)=>{_.setDate(_.getDate()+7*T)},(_,T)=>(T-_-(T.getTimezoneOffset()-_.getTimezoneOffset())*gl)/ym)}const $0=ud(0),vl=ud(1),Ou=(ud(2),ud(3),ud(4));function Eo(d){return Oo(_=>{_.setUTCDate(_.getUTCDate()-(_.getUTCDay()+7-d)%7),_.setUTCHours(0,0,0,0)},(_,T)=>{_.setUTCDate(_.getUTCDate()+7*T)},(_,T)=>(T-_)/ym)}ud(5),ud(6);const J0=Eo(0),hh=Eo(1),ph=(Eo(2),Eo(3),Eo(4)),Xo=(Eo(5),Eo(6),Oo(d=>{d.setDate(1),d.setHours(0,0,0,0)},(d,_)=>{d.setMonth(d.getMonth()+_)},(d,_)=>_.getMonth()-d.getMonth()+12*(_.getFullYear()-d.getFullYear()),d=>d.getMonth())),fv=Oo(d=>{d.setUTCDate(1),d.setUTCHours(0,0,0,0)},(d,_)=>{d.setUTCMonth(d.getUTCMonth()+_)},(d,_)=>_.getUTCMonth()-d.getUTCMonth()+12*(_.getUTCFullYear()-d.getUTCFullYear()),d=>d.getUTCMonth()),ru=Oo(d=>{d.setMonth(0,1),d.setHours(0,0,0,0)},(d,_)=>{d.setFullYear(d.getFullYear()+_)},(d,_)=>_.getFullYear()-d.getFullYear(),d=>d.getFullYear());ru.every=d=>isFinite(d=Math.floor(d))&&d>0?Oo(_=>{_.setFullYear(Math.floor(_.getFullYear()/d)*d),_.setMonth(0,1),_.setHours(0,0,0,0)},(_,T)=>{_.setFullYear(_.getFullYear()+T*d)}):null;const xu=Oo(d=>{d.setUTCMonth(0,1),d.setUTCHours(0,0,0,0)},(d,_)=>{d.setUTCFullYear(d.getUTCFullYear()+_)},(d,_)=>_.getUTCFullYear()-d.getUTCFullYear(),d=>d.getUTCFullYear());function mv(d,_,T,x,A,U){const ne=[[lh,1,Bc],[lh,5,5e3],[lh,15,15e3],[lh,30,3e4],[U,1,gl],[U,5,5*gl],[U,15,15*gl],[U,30,30*gl],[A,1,eu],[A,3,3*eu],[A,6,6*eu],[A,12,12*eu],[x,1,tu],[x,2,2*tu],[T,1,ym],[_,1,vm],[_,3,3*vm],[d,1,el]];function Oe(we,Ze,it){const lt=Math.abs(Ze-we)/it,dt=ld(([,,Mt])=>Mt).right(ne,lt);if(dt===ne.length)return d.every(pv(we/el,Ze/el,it));if(0===dt)return G0.every(Math.max(pv(we,Ze,it),1));const[Tt,mt]=ne[lt/ne[dt-1][2]<ne[dt][2]/lt?dt-1:dt];return Tt.every(mt)}return[function fe(we,Ze,it){const lt=Ze<we;lt&&([we,Ze]=[Ze,we]);const dt=it&&"function"==typeof it.range?it:Oe(we,Ze,it),Tt=dt?dt.range(we,+Ze+1):[];return lt?Tt.reverse():Tt},Oe]}xu.every=d=>isFinite(d=Math.floor(d))&&d>0?Oo(_=>{_.setUTCFullYear(Math.floor(_.getUTCFullYear()/d)*d),_.setUTCMonth(0,1),_.setUTCHours(0,0,0,0)},(_,T)=>{_.setUTCFullYear(_.getUTCFullYear()+T*d)}):null;const[kx,_T]=mv(xu,fv,J0,Pu,Mu,K0),[fT,mT]=mv(ru,Xo,$0,Hn,Z0,Em);function Tm(d){if(0<=d.y&&d.y<100){var _=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);return _.setFullYear(d.y),_}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function Q0(d){if(0<=d.y&&d.y<100){var _=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));return _.setUTCFullYear(d.y),_}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function vp(d,_,T){return{y:d,m:_,d:T,H:0,M:0,S:0,L:0}}var s_,tD,cc={"-":"",_:" ",0:"0"},xo=/^\s*\d+/,Du=/^%/,gv=/[\\^$*+?|[\]().{}]/g;function Zi(d,_,T){var x=d<0?"-":"",A=(x?-d:d)+"",U=A.length;return x+(U<T?new Array(T-U+1).join(_)+A:A)}function yT(d){return d.replace(gv,"\\$&")}function Ep(d){return new RegExp("^(?:"+d.map(yT).join("|")+")","i")}function bp(d){return new Map(d.map((_,T)=>[_.toLowerCase(),T]))}function yv(d,_,T){var x=xo.exec(_.slice(T,T+1));return x?(d.w=+x[0],T+x[0].length):-1}function Jx(d,_,T){var x=xo.exec(_.slice(T,T+1));return x?(d.u=+x[0],T+x[0].length):-1}function vv(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.U=+x[0],T+x[0].length):-1}function vT(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.V=+x[0],T+x[0].length):-1}function q0(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.W=+x[0],T+x[0].length):-1}function ft(d,_,T){var x=xo.exec(_.slice(T,T+4));return x?(d.y=+x[0],T+x[0].length):-1}function Te(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.y=+x[0]+(+x[0]>68?1900:2e3),T+x[0].length):-1}function Ue(d,_,T){var x=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(_.slice(T,T+6));return x?(d.Z=x[1]?0:-(x[2]+(x[3]||"00")),T+x[0].length):-1}function $e(d,_,T){var x=xo.exec(_.slice(T,T+1));return x?(d.q=3*x[0]-3,T+x[0].length):-1}function st(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.m=x[0]-1,T+x[0].length):-1}function ht(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.d=+x[0],T+x[0].length):-1}function yt(d,_,T){var x=xo.exec(_.slice(T,T+3));return x?(d.m=0,d.d=+x[0],T+x[0].length):-1}function Rt(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.H=+x[0],T+x[0].length):-1}function Ut(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.M=+x[0],T+x[0].length):-1}function er(d,_,T){var x=xo.exec(_.slice(T,T+2));return x?(d.S=+x[0],T+x[0].length):-1}function vr(d,_,T){var x=xo.exec(_.slice(T,T+3));return x?(d.L=+x[0],T+x[0].length):-1}function Pr(d,_,T){var x=xo.exec(_.slice(T,T+6));return x?(d.L=Math.floor(x[0]/1e3),T+x[0].length):-1}function Ur(d,_,T){var x=Du.exec(_.slice(T,T+1));return x?T+x[0].length:-1}function qr(d,_,T){var x=xo.exec(_.slice(T));return x?(d.Q=+x[0],T+x[0].length):-1}function Zr(d,_,T){var x=xo.exec(_.slice(T));return x?(d.s=+x[0],T+x[0].length):-1}function Es(d,_){return Zi(d.getDate(),_,2)}function si(d,_){return Zi(d.getHours(),_,2)}function ei(d,_){return Zi(d.getHours()%12||12,_,2)}function Rs(d,_){return Zi(1+Hn.count(ru(d),d),_,3)}function fi(d,_){return Zi(d.getMilliseconds(),_,3)}function Pi(d,_){return fi(d,_)+"000"}function mn(d,_){return Zi(d.getMonth()+1,_,2)}function Di(d,_){return Zi(d.getMinutes(),_,2)}function qn(d,_){return Zi(d.getSeconds(),_,2)}function xa(d){var _=d.getDay();return 0===_?7:_}function Li(d,_){return Zi($0.count(ru(d)-1,d),_,2)}function Oi(d){var _=d.getDay();return _>=4||0===_?Ou(d):Ou.ceil(d)}function jn(d,_){return d=Oi(d),Zi(Ou.count(ru(d),d)+(4===ru(d).getDay()),_,2)}function Do(d){return d.getDay()}function su(d,_){return Zi(vl.count(ru(d)-1,d),_,2)}function Cp(d,_){return Zi(d.getFullYear()%100,_,2)}function Tp(d,_){return Zi((d=Oi(d)).getFullYear()%100,_,2)}function Mp(d,_){return Zi(d.getFullYear()%1e4,_,4)}function Mm(d,_){var T=d.getDay();return Zi((d=T>=4||0===T?Ou(d):Ou.ceil(d)).getFullYear()%1e4,_,4)}function e_(d){var _=d.getTimezoneOffset();return(_>0?"-":(_*=-1,"+"))+Zi(_/60|0,"0",2)+Zi(_%60,"0",2)}function Ev(d,_){return Zi(d.getUTCDate(),_,2)}function Pm(d,_){return Zi(d.getUTCHours(),_,2)}function Om(d,_){return Zi(d.getUTCHours()%12||12,_,2)}function t_(d,_){return Zi(1+tl.count(xu(d),d),_,3)}function r_(d,_){return Zi(d.getUTCMilliseconds(),_,3)}function Pp(d,_){return r_(d,_)+"000"}function xm(d,_){return Zi(d.getUTCMonth()+1,_,2)}function Op(d,_){return Zi(d.getUTCMinutes(),_,2)}function Dm(d,_){return Zi(d.getUTCSeconds(),_,2)}function Sm(d){var _=d.getUTCDay();return 0===_?7:_}function ET(d,_){return Zi(J0.count(xu(d)-1,d),_,2)}function Am(d){var _=d.getUTCDay();return _>=4||0===_?ph(d):ph.ceil(d)}function bT(d,_){return d=Am(d),Zi(ph.count(xu(d),d)+(4===xu(d).getUTCDay()),_,2)}function CT(d){return d.getUTCDay()}function a5(d,_){return Zi(hh.count(xu(d)-1,d),_,2)}function l5(d,_){return Zi(d.getUTCFullYear()%100,_,2)}function c5(d,_){return Zi((d=Am(d)).getUTCFullYear()%100,_,2)}function u5(d,_){return Zi(d.getUTCFullYear()%1e4,_,4)}function d5(d,_){var T=d.getUTCDay();return Zi((d=T>=4||0===T?ph(d):ph.ceil(d)).getUTCFullYear()%1e4,_,4)}function h5(){return"+0000"}function Qx(){return"%"}function qx(d){return+d}function eD(d){return Math.floor(+d/1e3)}!function m5(d){s_=function gT(d){var _=d.dateTime,T=d.date,x=d.time,A=d.periods,U=d.days,ne=d.shortDays,fe=d.months,Oe=d.shortMonths,we=Ep(A),Ze=bp(A),it=Ep(U),lt=bp(U),dt=Ep(ne),Tt=bp(ne),mt=Ep(fe),Mt=bp(fe),Pt=Ep(Oe),Nt=bp(Oe),Bt={a:function wr(ps){return ne[ps.getDay()]},A:function Gr(ps){return U[ps.getDay()]},b:function zr(ps){return Oe[ps.getMonth()]},B:function rs(ps){return fe[ps.getMonth()]},c:null,d:Es,e:Es,f:Pi,g:Tp,G:Mm,H:si,I:ei,j:Rs,L:fi,m:mn,M:Di,p:function ls(ps){return A[+(ps.getHours()>=12)]},q:function ms(ps){return 1+~~(ps.getMonth()/3)},Q:qx,s:eD,S:qn,u:xa,U:Li,V:jn,w:Do,W:su,x:null,X:null,y:Cp,Y:Mp,Z:e_,"%":Qx},Zt={a:function ss(ps){return ne[ps.getUTCDay()]},A:function Ms(ps){return U[ps.getUTCDay()]},b:function Hs(ps){return Oe[ps.getUTCMonth()]},B:function Js(ps){return fe[ps.getUTCMonth()]},c:null,d:Ev,e:Ev,f:Pp,g:c5,G:d5,H:Pm,I:Om,j:t_,L:r_,m:xm,M:Op,p:function Gs(ps){return A[+(ps.getUTCHours()>=12)]},q:function bs(ps){return 1+~~(ps.getUTCMonth()/3)},Q:qx,s:eD,S:Dm,u:Sm,U:ET,V:bT,w:CT,W:a5,x:null,X:null,y:l5,Y:u5,Z:h5,"%":Qx},nr={a:function Yr(ps,_s,Is){var is=dt.exec(_s.slice(Is));return is?(ps.w=Tt.get(is[0].toLowerCase()),Is+is[0].length):-1},A:function cs(ps,_s,Is){var is=it.exec(_s.slice(Is));return is?(ps.w=lt.get(is[0].toLowerCase()),Is+is[0].length):-1},b:function Xr(ps,_s,Is){var is=Pt.exec(_s.slice(Is));return is?(ps.m=Nt.get(is[0].toLowerCase()),Is+is[0].length):-1},B:function os(ps,_s,Is){var is=mt.exec(_s.slice(Is));return is?(ps.m=Mt.get(is[0].toLowerCase()),Is+is[0].length):-1},c:function br(ps,_s,Is){return Br(ps,_,_s,Is)},d:ht,e:ht,f:Pr,g:Te,G:ft,H:Rt,I:Rt,j:yt,L:vr,m:st,M:Ut,p:function $r(ps,_s,Is){var is=we.exec(_s.slice(Is));return is?(ps.p=Ze.get(is[0].toLowerCase()),Is+is[0].length):-1},q:$e,Q:qr,s:Zr,S:er,u:Jx,U:vv,V:vT,w:yv,W:q0,x:function Vr(ps,_s,Is){return Br(ps,T,_s,Is)},X:function lr(ps,_s,Is){return Br(ps,x,_s,Is)},y:Te,Y:ft,Z:Ue,"%":Ur};function Jt(ps,_s){return function(Is){var ks,ds,qs,is=[],ii=-1,Ys=0,Zs=ps.length;for(Is instanceof Date||(Is=new Date(+Is));++ii<Zs;)37===ps.charCodeAt(ii)&&(is.push(ps.slice(Ys,ii)),null!=(ds=cc[ks=ps.charAt(++ii)])?ks=ps.charAt(++ii):ds="e"===ks?" ":"0",(qs=_s[ks])&&(ks=qs(Is,ds)),is.push(ks),Ys=ii+1);return is.push(ps.slice(Ys,ii)),is.join("")}}function Rr(ps,_s){return function(Is){var Ys,Zs,is=vp(1900,void 0,1);if(Br(is,ps,Is+="",0)!=Is.length)return null;if("Q"in is)return new Date(is.Q);if("s"in is)return new Date(1e3*is.s+("L"in is?is.L:0));if(_s&&!("Z"in is)&&(is.Z=0),"p"in is&&(is.H=is.H%12+12*is.p),void 0===is.m&&(is.m="q"in is?is.q:0),"V"in is){if(is.V<1||is.V>53)return null;"w"in is||(is.w=1),"Z"in is?(Zs=(Ys=Q0(vp(is.y,0,1))).getUTCDay(),Ys=Zs>4||0===Zs?hh.ceil(Ys):hh(Ys),Ys=tl.offset(Ys,7*(is.V-1)),is.y=Ys.getUTCFullYear(),is.m=Ys.getUTCMonth(),is.d=Ys.getUTCDate()+(is.w+6)%7):(Zs=(Ys=Tm(vp(is.y,0,1))).getDay(),Ys=Zs>4||0===Zs?vl.ceil(Ys):vl(Ys),Ys=Hn.offset(Ys,7*(is.V-1)),is.y=Ys.getFullYear(),is.m=Ys.getMonth(),is.d=Ys.getDate()+(is.w+6)%7)}else("W"in is||"U"in is)&&("w"in is||(is.w="u"in is?is.u%7:"W"in is?1:0),Zs="Z"in is?Q0(vp(is.y,0,1)).getUTCDay():Tm(vp(is.y,0,1)).getDay(),is.m=0,is.d="W"in is?(is.w+6)%7+7*is.W-(Zs+5)%7:is.w+7*is.U-(Zs+6)%7);return"Z"in is?(is.H+=is.Z/100|0,is.M+=is.Z%100,Q0(is)):Tm(is)}}function Br(ps,_s,Is,is){for(var ks,ds,ii=0,Ys=_s.length,Zs=Is.length;ii<Ys;){if(is>=Zs)return-1;if(37===(ks=_s.charCodeAt(ii++))){if(ks=_s.charAt(ii++),!(ds=nr[ks in cc?_s.charAt(ii++):ks])||(is=ds(ps,Is,is))<0)return-1}else if(ks!=Is.charCodeAt(is++))return-1}return is}return Bt.x=Jt(T,Bt),Bt.X=Jt(x,Bt),Bt.c=Jt(_,Bt),Zt.x=Jt(T,Zt),Zt.X=Jt(x,Zt),Zt.c=Jt(_,Zt),{format:function(ps){var _s=Jt(ps+="",Bt);return _s.toString=function(){return ps},_s},parse:function(ps){var _s=Rr(ps+="",!1);return _s.toString=function(){return ps},_s},utcFormat:function(ps){var _s=Jt(ps+="",Zt);return _s.toString=function(){return ps},_s},utcParse:function(ps){var _s=Rr(ps+="",!0);return _s.toString=function(){return ps},_s}}}(d),tD=s_.format}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const y5=ld(ad).right,v5=(ld(function g5(d){return null===d?NaN:+d}),y5);function sD(d,_){var ne,T=_?_.length:0,x=d?Math.min(T,d.length):0,A=new Array(x),U=new Array(T);for(ne=0;ne<x;++ne)A[ne]=TT(d[ne],_[ne]);for(;ne<T;++ne)U[ne]=_[ne];return function(fe){for(ne=0;ne<x;++ne)U[ne]=A[ne](fe);return U}}function E5(d,_){var T=new Date;return d=+d,_=+_,function(x){return T.setTime(d*(1-x)+_*x),T}}function b5(d,_){var A,T={},x={};for(A in(null===d||"object"!=typeof d)&&(d={}),(null===_||"object"!=typeof _)&&(_={}),_)A in d?T[A]=TT(d[A],_[A]):x[A]=_[A];return function(U){for(A in T)x[A]=T[A](U);return x}}function C5(d,_){_||(_=[]);var A,T=d?Math.min(_.length,d.length):0,x=_.slice();return function(U){for(A=0;A<T;++A)x[A]=d[A]*(1-U)+_[A]*U;return x}}function TT(d,_){var x,T=typeof _;return null==_||"boolean"===T?F0(_):("number"===T?aa:"string"===T?(x=la(_))?(_=x,ml):nm:_ instanceof la?ml:_ instanceof Date?E5:function T5(d){return ArrayBuffer.isView(d)&&!(d instanceof DataView)}(_)?C5:Array.isArray(_)?sD:"function"!=typeof _.valueOf&&"function"!=typeof _.toString||isNaN(_)?b5:aa)(d,_)}function M5(d,_){return d=+d,_=+_,function(T){return Math.round(d*(1-T)+_*T)}}function O5(d){return+d}var iD=[0,1];function i_(d){return d}function MT(d,_){return(_-=d=+d)?function(T){return(T-d)/_}:function P5(d){return function(){return d}}(isNaN(_)?NaN:.5)}function D5(d,_,T){var x=d[0],A=d[1],U=_[0],ne=_[1];return A<x?(x=MT(A,x),U=T(ne,U)):(x=MT(x,A),U=T(U,ne)),function(fe){return U(x(fe))}}function S5(d,_,T){var x=Math.min(d.length,_.length)-1,A=new Array(x),U=new Array(x),ne=-1;for(d[x]<d[0]&&(d=d.slice().reverse(),_=_.slice().reverse());++ne<x;)A[ne]=MT(d[ne],d[ne+1]),U[ne]=T(_[ne],_[ne+1]);return function(fe){var Oe=v5(d,fe,1,x)-1;return U[Oe](A[Oe](fe))}}function I5(d,_){switch(arguments.length){case 0:break;case 1:this.range(d);break;default:this.range(_).domain(d)}return this}function U5(d){return new Date(d)}function B5(d){return d instanceof Date?+d:+new Date(+d)}function nD(d,_,T,x,A,U,ne,fe,Oe,we){var Ze=function w5(){return function R5(){var x,A,U,fe,Oe,we,d=iD,_=iD,T=TT,ne=i_;function Ze(){var lt=Math.min(d.length,_.length);return ne!==i_&&(ne=function x5(d,_){var T;return d>_&&(T=d,d=_,_=T),function(x){return Math.max(d,Math.min(_,x))}}(d[0],d[lt-1])),fe=lt>2?S5:D5,Oe=we=null,it}function it(lt){return null==lt||isNaN(lt=+lt)?U:(Oe||(Oe=fe(d.map(x),_,T)))(x(ne(lt)))}return it.invert=function(lt){return ne(A((we||(we=fe(_,d.map(x),aa)))(lt)))},it.domain=function(lt){return arguments.length?(d=Array.from(lt,O5),Ze()):d.slice()},it.range=function(lt){return arguments.length?(_=Array.from(lt),Ze()):_.slice()},it.rangeRound=function(lt){return _=Array.from(lt),T=M5,Ze()},it.clamp=function(lt){return arguments.length?(ne=!!lt||i_,Ze()):ne!==i_},it.interpolate=function(lt){return arguments.length?(T=lt,Ze()):T},it.unknown=function(lt){return arguments.length?(U=lt,it):U},function(lt,dt){return x=lt,A=dt,Ze()}}()(i_,i_)}(),it=Ze.invert,lt=Ze.domain,dt=we(".%L"),Tt=we(":%S"),mt=we("%I:%M"),Mt=we("%I %p"),Pt=we("%a %d"),Nt=we("%b %d"),Bt=we("%B"),Zt=we("%Y");function nr(Jt){return(Oe(Jt)<Jt?dt:fe(Jt)<Jt?Tt:ne(Jt)<Jt?mt:U(Jt)<Jt?Mt:x(Jt)<Jt?A(Jt)<Jt?Pt:Nt:T(Jt)<Jt?Bt:Zt)(Jt)}return Ze.invert=function(Jt){return new Date(it(Jt))},Ze.domain=function(Jt){return arguments.length?lt(Array.from(Jt,B5)):lt().map(U5)},Ze.ticks=function(Jt){var Rr=lt();return d(Rr[0],Rr[Rr.length-1],Jt??10)},Ze.tickFormat=function(Jt,Rr){return null==Rr?nr:we(Rr)},Ze.nice=function(Jt){var Rr=lt();return(!Jt||"function"!=typeof Jt.range)&&(Jt=_(Rr[0],Rr[Rr.length-1],Jt??10)),Jt?lt(function L5(d,_){var ne,T=0,x=(d=d.slice()).length-1,A=d[T],U=d[x];return U<A&&(ne=T,T=x,x=ne,ne=A,A=U,U=ne),d[T]=_.floor(A),d[x]=_.ceil(U),d}(Rr,Jt)):Ze},Ze.copy=function(){return function A5(d,_){return _.domain(d.domain()).range(d.range()).interpolate(d.interpolate()).clamp(d.clamp()).unknown(d.unknown())}(Ze,nD(d,_,T,x,A,U,ne,fe,Oe,we))},Ze}function oD(d){return"string"==typeof d?new Ki([[document.querySelector(d)]],[document.documentElement]):new Ki([[d]],An)}function n_(d,_,T){this.k=d,this.x=_,this.y=T}n_.prototype={constructor:n_,scale:function(d){return 1===d?this:new n_(this.k*d,this.x,this.y)},translate:function(d,_){return 0===d&0===_?this:new n_(this.k,this.x+this.k*d,this.y+this.k*_)},apply:function(d){return[d[0]*this.k+this.x,d[1]*this.k+this.y]},applyX:function(d){return d*this.k+this.x},applyY:function(d){return d*this.k+this.y},invert:function(d){return[(d[0]-this.x)/this.k,(d[1]-this.y)/this.k]},invertX:function(d){return(d-this.x)/this.k},invertY:function(d){return(d-this.y)/this.k},rescaleX:function(d){return d.copy().domain(d.range().map(this.invertX,this).map(d.invert,d))},rescaleY:function(d){return d.copy().domain(d.range().map(this.invertY,this).map(d.invert,d))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new n_(1,0,0);const K5=["containerRef"];class bv{constructor(_){this.shellStateService=_,this.startTime=36e5*Math.floor(Date.now()/36e5)-108e5,this.scheduleProps={margin:{top:30,right:30,bottom:30,left:50},width:180,height:400,barWidth:150,nowColor:"#EA4335",barStyle:{background:"#616161",textColor:"white",width:300,startPadding:2,endPadding:3,radius:3}}}ngAfterViewInit(){this.loadChart()}loadChart(){if(this.divRef){console.log("drawing daily schedule",this.divRef.nativeElement),oD(this.divRef.nativeElement).select("svg").remove();const _=oD(this.divRef.nativeElement).append("svg").attr("width",this.scheduleProps.width).attr("height",this.scheduleProps.height),T=pe.filter(x=>x.date>this.startTime&&x.date<this.startTime+324e5);if(T){const x=this.startTime,A=this.startTime+324e5;if(x&&A){const U=function j5(){return I5.apply(nD(fT,mT,ru,Xo,$0,Hn,Z0,Em,lh,tD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}().domain([x,A]).range([this.scheduleProps.margin.top,this.scheduleProps.height-this.scheduleProps.margin.bottom]),ne=function Be(d){return ze(4,d)}(U).ticks(24);_.append("g").attr("transform",`translate(${this.scheduleProps.margin.left},0)`).attr("opacity",.5).call(ne);const fe=function We(d){return ze(2,d)}(U).ticks(24).tickSize(this.scheduleProps.barStyle.width);_.append("g").attr("transform",`translate(${this.scheduleProps.margin.left},0)`).attr("opacity",.3).call(fe),_.selectAll("g.barGroup").data(T).join("g").attr("class","barGroup").append("rect").on("click",(we,Ze)=>this.shellStateService.dispatch({type:"launchView",viewId:"AppointmentDetailComponent",state:{appointmentId:Ze.appointmentId}})).attr("fill",we=>this.scheduleProps.barStyle.background).attr("x",this.scheduleProps.margin.left).attr("y",we=>U(new Date(we.date))+this.scheduleProps.barStyle.startPadding).attr("height",we=>{const Ze=U(new Date(we.date));return U(new Date(we.date+we.duration))-Ze-this.scheduleProps.barStyle.endPadding-this.scheduleProps.barStyle.startPadding}).attr("width",this.scheduleProps.barStyle.width).attr("rx",this.scheduleProps.barStyle.radius)}}}}static#e=this.\u0275fac=function(T){return new(T||bv)($.Y36(te.vv))};static#t=this.\u0275cmp=$.Xpm({type:bv,selectors:[["porrtal-appointment-nav"]],viewQuery:function(T,x){if(1&T&&$.Gf(K5,5),2&T){let A;$.iGM(A=$.CRH())&&(x.divRef=A.first)}},inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:5,vars:0,consts:[[1,"container"],[1,"title"],[1,"data-container"],["containerRef",""]],template:function(T,x){1&T&&($.TgZ(0,"div",0)(1,"h3",1),$._uU(2,"Daily Schedule"),$.qZA(),$._UZ(3,"div",2,3),$.qZA())},dependencies:[D.ez],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:2px;padding-bottom:2px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;margin-left:15px;margin-right:15px;margin-top:15px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"],changeDetection:0})}class Cv{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Cv)};static#t=this.\u0275cmp=$.Xpm({type:Cv,selectors:[["porrtal-appointment-search"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"appointment-search works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}function Z5(d,_){if(1&d&&($.TgZ(0,"div",2)(1,"h3",3),$._uU(2),$.qZA(),$.TgZ(3,"div",4)(4,"h4"),$._uU(5),$.qZA(),$.TgZ(6,"p"),$._uU(7),$.qZA()()()),2&d){const T=$.oxw();let x;$.xp6(2),$.AsE(" ",null==T.appointment?null:T.appointment.item," (",null==T.appointment?null:T.appointment.appointmentId,") - Appointment Detail "),$.xp6(3),$.lnq(" ",T.Moment(null==T.appointment?null:T.appointment.date).format("YYYY-MM-DD, h:mm a")," -"," "," ",(null!==(x=null==T.appointment?null:T.appointment.duration)&&void 0!==x?x:0)/6e4," minutes. "),$.xp6(2),$.Oqu(null==T.appointment?null:T.appointment.description)}}function $5(d,_){1&d&&($.ynx(0),$.TgZ(1,"div"),$._uU(2,"loading appointment data..."),$.qZA(),$.BQk())}function Y5(d,_){if(1&d&&($.ynx(0),$.TgZ(1,"div")(2,"span"),$._uU(3,"appointmentId:\xa0"),$.qZA(),$.TgZ(4,"span"),$._uU(5),$.qZA(),$.TgZ(6,"span"),$._uU(7,"\xa0not found."),$.qZA()(),$.BQk()),2&d){const T=$.oxw();$.xp6(5),$.Oqu(T.appointmentId)}}class Tv{constructor(){this.loading=!0,this.notFound=!1,this.Moment=ae}set viewState(_){console.log("appointment detail - view state",_),this._viewState=_,this._viewState?.state&&this._viewState?.state.appointmentId&&(this.loading=!1,this.appointmentId=this._viewState?.state.appointmentId,this.appointment=pe.find(T=>T.appointmentId===this.appointmentId),this.appointment||(this.notFound=!0)),console.log(`loading: ${this.loading}, notFound: ${this.notFound}`)}get viewState(){return this._viewState}static#e=this.\u0275fac=function(T){return new(T||Tv)};static#t=this.\u0275cmp=$.Xpm({type:Tv,selectors:[["porrtal-appointment-detail"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:3,vars:3,consts:[["class","container",4,"ngIf"],[4,"ngIf"],[1,"container"],[1,"title"],[1,"data-container"]],template:function(T,x){1&T&&($.YNc(0,Z5,8,6,"div",0),$.YNc(1,$5,3,0,"ng-container",1),$.YNc(2,Y5,8,1,"ng-container",1)),2&T&&($.Q6J("ngIf",!x.loading&&!x.notFound),$.xp6(1),$.Q6J("ngIf",x.loading),$.xp6(1),$.Q6J("ngIf",x.notFound))},dependencies:[D.ez,D.O5],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:2px;padding-bottom:2px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{justify-self:start;margin-left:15px;margin-right:15px;margin-top:15px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"],changeDetection:0})}class Mv{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Mv)};static#t=this.\u0275cmp=$.Xpm({type:Mv,selectors:[["porrtal-appointment-location-map"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"appointment-location-map works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Pv{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Pv)};static#t=this.\u0275cmp=$.Xpm({type:Pv,selectors:[["porrtal-appointment-create"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"appointment-create works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Ov{constructor(_){this.shellStateService=_}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Ov)($.Y36(te.vv))};static#t=this.\u0275cmp=$.Xpm({type:Ov,selectors:[["porrtal-viz-nav"]],inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:42,vars:0,consts:[[1,"container"],[1,"title"],[1,"data-container"],[1,"link-button",3,"click"]],template:function(T,x){1&T&&($.TgZ(0,"div",0)(1,"h3",1),$._uU(2,"ESRI Mapping Demos"),$.qZA(),$.TgZ(3,"div",2)(4,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"HurricaneMapComponent"})}),$._uU(5," Hurricanes on the Globe "),$.qZA(),$.TgZ(6,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"EarthquakeMapComponent"})}),$._uU(7," Earthquake Map "),$.qZA(),$.TgZ(8,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"DigitalElevationMapComponent"})}),$._uU(9," Globe with Digital Elevation "),$.qZA(),$.TgZ(10,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"BuildingSceneWithQueryComponent"})}),$._uU(11," Building Scene "),$.qZA()(),$.TgZ(12,"h3",1),$._uU(13,"D3JS Charting Demos"),$.qZA(),$.TgZ(14,"div",2)(15,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"ZoomableSunburstComponent"})}),$._uU(16," Zoomable Sunburst Chart "),$.qZA(),$.TgZ(17,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"ZoomableCirclePackComponent"})}),$._uU(18," Zoomable Circle Pack Chart "),$.qZA(),$.TgZ(19,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"ZoomableIcicleComponent"})}),$._uU(20," Zoomable Icicle Chart "),$.qZA(),$.TgZ(21,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"ZoomableTreemapComponent"})}),$._uU(22," Zoomable Treemap Chart "),$.qZA(),$.TgZ(23,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"CollapsibleTreeComponent"})}),$._uU(24," Collapsable Tree Chart "),$.qZA(),$.TgZ(25,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"HierarchicalBarChartComponent"})}),$._uU(26," Hierarchical Bar Chart "),$.qZA()(),$.TgZ(27,"h3",1),$._uU(28,"Learning"),$.qZA(),$.TgZ(29,"div",2)(30,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"YoutubePlayerComponent",state:{videoId:"Z76QlSpYcck"}})}),$._uU(31," YouTube Player "),$.qZA(),$.TgZ(32,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"MarkdownViewerComponent",state:{contentUrl:"https://raw.githubusercontent.com/datumgeek/jersey-rest-test03/master/README.md"}})}),$._uU(33," Markdown Viewer "),$.qZA(),$.TgZ(34,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"MarkdownViewerComponent",state:{id:"html",contentUrl:"docs/relative-image-test.md"}})}),$._uU(35," Markdown with Relative Images "),$.qZA(),$.TgZ(36,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"MarkdownViewerComponent",state:{id:"html",contentUrl:"https://raw.githubusercontent.com/datumgeek/ngx-popperjs/master/projects/ngx-popperjs/src/lib/ngx-popperjs-content/ngx-popperjs-content.component.html"}})}),$._uU(37," Markdown HTML "),$.qZA(),$.TgZ(38,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"MarkdownViewerComponent",state:{id:"scss",contentUrl:"https://raw.githubusercontent.com/datumgeek/ngx-popperjs/master/projects/ngx-popperjs/src/lib/ngx-popperjs-content/ngx-popperjs-content.component.scss"}})}),$._uU(39," Markdown SCSS "),$.qZA(),$.TgZ(40,"h4",3),$.NdJ("click",function(){return x.shellStateService.dispatch({type:"launchView",viewId:"MarkdownViewerComponent",state:{id:"ts",contentUrl:"https://raw.githubusercontent.com/datumgeek/ngx-popperjs/master/projects/ngx-popperjs/src/lib/ngx-popperjs-content/ngx-popper-content.component.ts"}})}),$._uU(41," Markdown TypeScript "),$.qZA()()())},dependencies:[D.ez],styles:[".container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.title[_ngcontent-%COMP%]{background-color:#b9c7da;margin:0;padding-top:2px;padding-bottom:2px;padding-left:8px;grid-column:1/-1}.data-container[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px;margin-top:15px}.link-button[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;cursor:pointer}"],changeDetection:0})}var xT,lD=v(80415),Ve=v(17626),PT=v(73386),kr=v(15861),lo=v(91558),On=v(46160),X5=v(89726),Rm=v(94573),ai=v(26584),zl=v(86810),hd=v(58817),OT=v(47996),k5=v(47877),Us=v(63290),ws=v(10699),ke=v(77712),Hl=v(90912),Wr=v(76898),wm=v(99433),pd=v(85931),So=v(8314),xp=v(55342);let xv=xT=class extends zl.wq{constructor(d){super(d),this.type="none"}clone(){return new xT({type:this.type})}};(0,Ve._)([(0,xp.J)({none:"none",stayAbove:"stay-above"})],xv.prototype,"type",void 0),xv=xT=(0,Ve._)([(0,Wr.j)("esri.ground.NavigationConstraint")],xv);var DT,Fo=v(93605),cD=v(92236);let Su=DT=class extends((0,zl.eC)(OT.Z)){constructor(d){super(d),this.opacity=1,this.shading=!Fo.Z.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new On.Z;const _=x=>{x.parent&&x.parent!==this&&"remove"in x.parent&&x.parent.remove(x),x.parent=this,"elevation"!==x.type&&"base-elevation"!==x.type&&Us.Z.getLogger(this.declaredClass).error(`Layer '${x.title}, id:${x.id}' of type '${x.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",x=>_(x.item)),this.layers.on("after-remove",x=>(x=>{x.parent=null})(x.item))}initialize(){this.when().catch(d=>{Us.Z.getLogger(this.declaredClass).error("#load()","Failed to load ground",d)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const d=this.layers.removeAll();for(const _ of d)_.destroy();this.layers.destroy()}normalizeCtorArgs(d){return d&&"resourceInfo"in d&&(this._set("resourceInfo",d.resourceInfo),delete(d={...d}).resourceInfo),d}set layers(d){this._set("layers",(0,X5.Z)(d,this._get("layers")))}writeLayers(d,_,T,x){const A=[];d&&(x={...x,layerContainerType:"ground"},d.forEach(U=>{if("write"in U){const ne={};(0,Rm.sM)(U)().write(ne,x)&&A.push(ne)}else x&&x.messages&&x.messages.push(new ai.Z("layer:unsupported",`Layers (${U.title}, ${U.id}) of type '${U.declaredClass}' cannot be persisted in the ground`,{layer:U}))})),_.layers=A}load(d){return this.addResolvingPromise(this._loadFromSource(d)),Promise.resolve(this)}loadAll(){return(0,k5.G)(this,d=>{d(this.layers)})}queryElevation(d,_){var T=this;return(0,kr.Z)(function*(){yield T.load({signal:_?.signal});const{ElevationQuery:x}=yield v.e(2493).then(v.bind(v,42493));(0,ws.k_)(_);const A=new x,U=T.layers.filter(uD).toArray();return A.queryAll(U,d,_)})()}createElevationSampler(d,_){var T=this;return(0,kr.Z)(function*(){yield T.load({signal:_?.signal});const{ElevationQuery:x}=yield v.e(2493).then(v.bind(v,42493));(0,ws.k_)(_);const A=new x,U=T.layers.filter(uD).toArray();return A.createSamplerAll(U,d,_)})()}clone(){const d={opacity:this.opacity,surfaceColor:(0,hd.d9)(this.surfaceColor),navigationConstraint:(0,hd.d9)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(d.loadStatus="loaded"),new DT({resourceInfo:this.resourceInfo}).set(d)}read(d,_){this.resourceInfo||this._set("resourceInfo",{data:d,context:_}),super.read(d,_)}_loadFromSource(d){const _=this.resourceInfo;return _?this._loadLayersFromJSON(_.data,_.context,d):Promise.resolve()}_loadLayersFromJSON(d,_,T){const x=_&&_.origin||"web-scene",A=_&&_.portal||null,U=_&&_.url||null;return Promise.all([v.e(7534),v.e(1074)]).then(v.bind(v,71074)).then(({populateOperationalLayers:ne})=>{(0,ws.k_)(T);const fe=[];return d.layers&&Array.isArray(d.layers)&&fe.push(ne(this.layers,d.layers,{context:{origin:x,url:U,portal:A,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"})),(0,ws.as)(fe)}).then(()=>{})}};function uD(d){return"elevation"===d.type||function J5(d){return d&&"createElevationSampler"in d}(d)}(0,Ve._)([(0,ke.Cb)({json:{read:!1}})],Su.prototype,"layers",null),(0,Ve._)([(0,wm.c)("layers")],Su.prototype,"writeLayers",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Su.prototype,"resourceInfo",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Hl.z8,read:{reader:cD.b,source:"transparency"},write:{writer:(d,_)=>{_.transparency=(0,cD.a)(d)},target:"transparency"}}})],Su.prototype,"opacity",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,nonNullable:!0,json:{read:!1}})],Su.prototype,"shading",void 0),(0,Ve._)([(0,ke.Cb)({type:lo.Z,json:{type:[Hl.z8],write:(d,_)=>{_.surfaceColor=d.toJSON().slice(0,3)}}})],Su.prototype,"surfaceColor",void 0),(0,Ve._)([(0,ke.Cb)({type:xv,json:{write:!0}})],Su.prototype,"navigationConstraint",void 0),Su=DT=(0,Ve._)([(0,Wr.j)("esri.Ground")],Su);const Dv=Su;var Ns=v(14517),Sv=v(46882),Va=v(61885),Qe=v(62208),ko=v(66656);function Q5(d){return!(!(d&&d.loaded&&"capabilities"in d&&d?.capabilities?.operations&&"supportsEditing"in d.capabilities.operations&&!0===d.capabilities.operations.supportsEditing)||"editingEnabled"in d&&!d.editingEnabled)}var dD=v(59318),ST=v(21726),hD=v(33954);const pD=Us.Z.getLogger("esri.support.basemapUtils");var i4=v(38953);const MD={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var o4=v(6432),a4=v(6119);let Au=class extends((0,a4.Q)((0,o4.K)(Va.Z.EventedMixin(Ns.Z)))){constructor(d){super(d),this.allLayers=new Sv.Z({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:_=>"layers"in _?_.layers:null}),this.allTables=(0,i4.a)(this),this.basemap=null,this.editableLayers=new Sv.Z({getCollections:()=>[this.allLayers],itemFilterFunction:Q5}),this.ground=new Dv,this._basemapCache={}}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),function e4(d){for(const _ in d){const T=d[_];!1===T?.destroyed&&T.destroy(),delete d[_]}}(this._basemapCache),this._basemapCache=null}castBasemap(d){return function _D(d,_){let T;if("string"==typeof d){if(!(d in hD.s)){const x=Object.entries(hD.s).filter(([A,U])=>dD.Z.apiKey&&!U.classic||!dD.Z.apiKey&&U.classic&&!U.deprecated).map(([A])=>`"${A}"`).join(", ");return pD.warn(`Unable to find basemap definition for: ${d}. Try one of these: ${x}`),null}_&&(T=_[d]),T||(T=PT.default.fromId(d),_&&(_[d]=T))}else T=(0,Hl.se)(PT.default,d);return T?.destroyed&&(pD.warn("The provided basemap is already destroyed",{basemap:T}),T=null),T}(d,this._basemapCache)}castGround(d){const _=function n4(d){let _=null;return"string"==typeof d?d in MD?_=new Dv({resourceInfo:{data:{layers:[MD[d]]}}}):Us.Z.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${d}. Try "world-elevation"`):_=(0,Hl.se)(Dv,d),_}(d);return(0,Qe.Wi)(_)?this._get("ground"):_}findLayerById(d){return this.allLayers.find(_=>_.id===d)}findTableById(d){return this.allTables.find(_=>_.id===d)}};(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:[]})],Au.prototype,"allLayers",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Au.prototype,"allTables",void 0),(0,Ve._)([(0,ke.Cb)({type:PT.default})],Au.prototype,"basemap",void 0),(0,Ve._)([(0,ko.p)("basemap")],Au.prototype,"castBasemap",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Au.prototype,"editableLayers",void 0),(0,Ve._)([(0,ke.Cb)({type:Dv,nonNullable:!0})],Au.prototype,"ground",void 0),(0,Ve._)([(0,ko.p)("ground")],Au.prototype,"castGround",null),Au=(0,Ve._)([(0,Wr.j)("esri.Map")],Au);const PD=Au;var OD=v(79608),za=v(23719),xr=v(21286),wT=v(68653),vn=v(72642);let _d=class extends((0,OD.J)(zl.wq)){constructor(...d){super(...d),this.position=new vn.Z([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(d,_,T,x){if(d&&"object"==typeof d&&("x"in d||Array.isArray(d))){const A={position:d};return null!=_&&(A.heading=_),null!=T&&(A.tilt=T),null!=x&&(A.fov=x),A}return d}writePosition(d,_,T,x){const A=d.clone();A.x=(0,Hl.q9)(d.x||0),A.y=(0,Hl.q9)(d.y||0),A.z=d.hasZ?(0,Hl.q9)(d.z||0):d.z,_[T]=A.write({},x)}readPosition(d,_){const T=new vn.Z;return T.read(d,_),T.x=(0,Hl.q9)(T.x||0),T.y=(0,Hl.q9)(T.y||0),T.z=T.hasZ?(0,Hl.q9)(T.z||0):T.z,T}equals(d){return!(0,Qe.Wi)(d)&&this.tilt===d.tilt&&this.heading===d.heading&&this.fov===d.fov&&this.position.equals(d.position)}};(0,Ve._)([(0,ke.Cb)({type:vn.Z,json:{write:{isRequired:!0}}})],_d.prototype,"position",void 0),(0,Ve._)([(0,wm.c)("position")],_d.prototype,"writePosition",null),(0,Ve._)([(0,wT.r)("position")],_d.prototype,"readPosition",null),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,ko.p)(d=>za.BV.normalize((0,Hl.q9)(d)))],_d.prototype,"heading",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,ko.p)(d=>(0,xr.uZ)((0,Hl.q9)(d),-180,180))],_d.prototype,"tilt",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_d.prototype,"fov",void 0),_d=(0,Ve._)([(0,Wr.j)("esri.Camera")],_d);const uc=_d;var IT,l4=v(29132),fd=v(88879),xD=v(91179);let _h=IT=class extends zl.wq{constructor(d){super(d),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(d){return(d%=360)<0&&(d+=360),d}clone(){return new IT({rotation:this.rotation,scale:this.scale,targetGeometry:(0,Qe.pC)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,Qe.pC)(this.camera)?this.camera.clone():null})}};function LT(){return{enabled:!this.camera}}(0,Ve._)([(0,ke.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:LT}}}}})],_h.prototype,"rotation",void 0),(0,Ve._)([(0,ko.p)("rotation")],_h.prototype,"castRotation",null),(0,Ve._)([(0,ke.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:LT}}}}})],_h.prototype,"scale",void 0),(0,Ve._)([(0,ke.Cb)({types:l4.qM,json:{read:xD.im,write:!0,origins:{"web-scene":{read:xD.im,write:{overridePolicy:LT}}}}})],_h.prototype,"targetGeometry",void 0),(0,Ve._)([(0,ke.Cb)({type:uc,json:{write:!0}})],_h.prototype,"camera",void 0),_h=IT=(0,Ve._)([(0,Wr.j)("esri.Viewpoint")],_h);const iu=_h;var md=v(40764),Dp=v(17770),Sp=v(54024),DD=v(56354),SD=v(73234),Ht=v(32917),gd=v(50618),li=v(23841),c4=v(59289),ir=v(28093),Av=v(28705),AD=v(79334),di=v(55915),Bs=v(65401),nu=v(41743),o_=v(93088),RD=v(83137),wD=v(5437),Gl=v(72469);let a_=class extends Av.a{constructor(d){super(d),this.handles.add(this.on("before-add",_=>{(0,Qe.Wi)(_.item)||_.item.parent===this.owner&&(Us.Z.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),_.preventDefault())}))}_own(d){d.parent=this.owner}_release(d){d.parent=null}};a_=(0,Ve._)([(0,Wr.j)("esri.support.AnalysesCollection")],a_);var Rv=v(35575),Ji=v(72392);const wv={widthBreakpoint:{getValue(d){const _=d.viewSize[0],T=d.breakpoints,x=this.values;return _<=T.xsmall?x.xsmall:_<=T.small?x.small:_<=T.medium?x.medium:_<=T.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(d){const _=d.viewSize[1],T=d.breakpoints,x=this.values;return _<=T.xsmall?x.xsmall:_<=T.small?x.small:_<=T.medium?x.medium:_<=T.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(d){const _=d.viewSize,A=this.values;return _[1]>=_[0]?A.portrait:A.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},UT={xsmall:544,small:768,medium:992,large:1200};function BT(d,_){return _?wv[d].valueToClassName[_].split(" "):[]}const d4=d=>{let _=class extends d{constructor(...T){super(...T),this._breakpointsHandles=new Ji.Z,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=UT}initialize(){this._breakpointsHandles.add((0,Ht.YP)(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ht.nn))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=(0,Qe.SC)(this._breakpointsHandles))}set breakpoints(T){if(T===this._get("breakpoints"))return;const x=function u4(d){return d&&d.xsmall<d.small&&d.small<d.medium&&d.medium<d.large}(T);if(!x){const A=JSON.stringify(UT,null,2);console.warn("provided breakpoints are not valid, using defaults:"+A)}T=x?T:UT,this._set("breakpoints",{...T})}_updateClassNames(){if(!this.container)return;const T=Rv.Z.acquire(),x=Rv.Z.acquire();let A,U=!1;for(A in wv){const ne=this[A],fe=wv[A].getValue({viewSize:this.size,breakpoints:this.breakpoints});ne!==fe&&(U=!0,this[A]=fe,BT(A,ne).forEach(Oe=>x.push(Oe)),BT(A,fe).forEach(Oe=>T.push(Oe)))}U&&(this._applyClassNameChanges(T,x),Rv.Z.release(T),Rv.Z.release(x))}_applyClassNameChanges(T,x){const A=this.container;A&&(x.forEach(U=>A.classList.remove(U)),T.forEach(U=>A.classList.add(U)))}_removeActiveClassNames(){const T=this.container;if(!T)return;let x;for(x in wv)BT(x,this[x]).forEach(A=>T.classList.remove(A))}};return(0,Ve._)([(0,ke.Cb)()],_.prototype,"breakpoints",null),(0,Ve._)([(0,ke.Cb)()],_.prototype,"orientation",void 0),(0,Ve._)([(0,ke.Cb)()],_.prototype,"widthBreakpoint",void 0),(0,Ve._)([(0,ke.Cb)()],_.prototype,"heightBreakpoint",void 0),_=(0,Ve._)([(0,Wr.j)("esri.views.BreakpointsOwner")],_),_};var l_=v(17760),jT=(v(50645),v(62996));let fh=class extends Ns.Z{constructor(){super(...arguments),this.items=new On.Z,this._watchUpdatingTracking=new l_.t,this._callbacks=new Map,this._projector=(0,jT.E)(),this._hiddenProjector=(0,jT.E)()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const d=document.createElement("div");d.className="esri-overlay-surface",this._set("surface",d),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),d.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,_=>{for(const T of _.added){const x=()=>T.render();this._callbacks.set(T,x),this._projector.append(this.surface,x)}for(const T of _.removed){const x=this._projector.detach(this._callbacks.get(T));this.surface.removeChild(x.domNode),this._callbacks.delete(T)}})}addItem(d){this.items.add(d)}removeItem(d){this.items.remove(d)}destroy(){this.items.removeAll(),this._callbacks.forEach(d=>this._projector.detach(d)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(d){const _=this._hiddenSurface,T=this._hiddenProjector;let x=null;const A=()=>(x=d.render(),x);T.append(_,A),T.renderNow();const U={left:0,top:0,right:0,bottom:0};if(x&&x.domNode){const ne=x.domNode.getBoundingClientRect();U.left=ne.left,U.top=ne.top,U.right=ne.right,U.bottom=ne.bottom}for(T.detach(A);_.firstChild;)_.removeChild(_.firstChild);return U}overlaps(d,_){const T=this.computeBoundingRect(d),x=this.computeBoundingRect(_);return Math.max(T.left,x.left)<=Math.min(T.right,x.right)&&Math.max(T.top,x.top)<=Math.min(T.bottom,x.bottom)}get hasVisibleItems(){return this.items.some(d=>d.visible)}prepare(){var d=this;return(0,kr.Z)(function*(){yield document.fonts.load(d._fontString()).catch(()=>{})})()}renderCanvas(d){if(!this.items.some(T=>T.visible))return;const _=d.getContext("2d");_.save(),_.font=this._fontString(),this.items.forEach(T=>{_.save(),T.renderCanvas(_),_.restore()}),_.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],fh.prototype,"surface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],fh.prototype,"items",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],fh.prototype,"needsRender",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],fh.prototype,"_watchUpdatingTracking",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],fh.prototype,"updating",null),fh=(0,Ve._)([(0,Wr.j)("esri.views.overlay.ViewOverlay")],fh);const ID=fh;function c_(d,_,T,x){let A=null,U=1e3;"number"==typeof _?(U=_,x=T):(A=_??null,U=T);let ne,fe=0;const Oe=()=>{fe=0,d.apply(x,ne)},we=(...Ze)=>{A&&A.apply(x,Ze),ne=Ze,U?fe||(fe=setTimeout(Oe,U)):Oe()};return we.remove=()=>{fe&&(clearTimeout(fe),fe=0)},we.forceUpdate=()=>{fe&&(clearTimeout(fe),Oe())},we.hasPendingUpdates=()=>!!fe,we}v(52515);var ua=v(40915),h4=v(90466),p4=v(87183),LD=v(67736),Im=v(77275),Ap=v(88411),Lm=v(15348),Iv=v(36630),_4=v(66845),UD=v(46679);const BD=Us.Z.getLogger("esri.widgets.Feature.support.featureUtils"),m4=/href=(""|'')/gi,g4=/(\{([^\{\r\n]+)\})/g,y4=/\'/g,jD=/^\s*expression\//i,v4=/(\n)/gi,E4=/[\u00A0-\u9999<>\&]/gim,b4=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,C4=/^(?:mailto:|tel:)/,FD="relationships/",FT=(0,Ap.Ze)("short-date-short-time");function ND(d){if(!(0,Qe.Wi)(d))return d.get("sourceLayer")||d.get("layer")}function Lv(d,_){return NT.apply(this,arguments)}function NT(){return(NT=(0,kr.Z)(function*(d,_){return"function"==typeof d?d.call(null,_):d})).apply(this,arguments)}function WD(d=""){if(d)return!C4.test(d.trim().toLowerCase())}function WT(d){return!!d&&jD.test(d)}function VD(d,_){const T=function T4(d,_){if(!WT(_)||!d)return null;const T=_.replace(jD,"").toLowerCase();let x;return d.some(A=>A.name.toLowerCase()===T&&(x=A,!0)),x}(_,d?.fieldName);return T?T.title||null:d?d.label||d.fieldName:null}function Um(d,_){const T=VT(_,d);return T?T.name:d}function VT(d,_){return d&&"function"==typeof d.getField?d.getField(_):null}function zD(d){return`${d}`.trim()}function Rp({attributes:d,globalAttributes:_,layer:T,text:x,expressionAttributes:A,fieldInfoMap:U}){return x?zT({formattedAttributes:_,template:A4(x,{..._,...A,...d},T),fieldInfoMap:U}):""}function zT({formattedAttributes:d,template:_,fieldInfoMap:T}){return zD(function P4(d){return d.replace(m4,"")}((0,Im.gx)((0,Im.gx)(_,x=>function M4(d,_){const T=_.get(d.toLowerCase());return`{${T&&T.fieldName||d}}`}(x,T)),d)))}function HT(d,_){return d.replace(g4,(T,x,A)=>{const U=VT(_,A);return U?`{${U.name}}`:x})}function A4(d,_,T){const x=HT(d,T);return x&&x.replace(b4,(A,U,ne)=>function S4(d,_,T){const x=(_=zD(_))&&"{"!==_[0];return(0,Im.gx)(d,function D4(d,_=!1){const T={...d};return Object.keys(T).forEach(x=>function x4(d,_,T=!1){const x=_[d];if("string"==typeof x){const A="%27",U=(T?encodeURIComponent(x):x).replace(y4,A);_[d]=U}}(x,T,_)),T}(T,x))}(A,U||ne,_))}function HD(d){return!!d?.layer}function GD(d,_){if(!d||!d.length||!_)return;const T=_.toLowerCase();let x;return d.some(A=>!(!A.fieldName||A.fieldName.toLowerCase()!==T||(x=A,0))),x}function KD(d){const _=[];if(!d)return _;const{fieldInfos:T,content:x}=d;return T&&_.push(...T),x&&Array.isArray(x)&&x.forEach(A=>{if("fields"===A.type){const U=A&&A.fieldInfos;U&&_.push(...U)}}),_}function GT(d){return d.replace(E4,_=>`&#${_.charCodeAt(0)};`)}function Bm(d){return"string"==typeof d?d.replace(v4,'<br class="esri-text-new-line" />'):d}function ZD(d){const{value:_,fieldName:T,fieldInfos:x,fieldInfoMap:A,layer:U,graphic:ne}=d;if(null==_)return"";const fe=function B4({fieldName:d,value:_,graphic:T,layer:x}){if(yd(d)||!x||"function"!=typeof x.getFieldDomain)return null;const A=x.getFieldDomain(d,{feature:T});return A&&"coded-value"===A.type?A.getName(_):null}({fieldName:T,value:_,graphic:ne,layer:U});if(fe)return fe;const Oe=function U4({fieldName:d,graphic:_,layer:T}){if(yd(d)||!T||"function"!=typeof T.getFeatureType)return null;const{typeIdField:x}=T;if(!x||d!==x)return null;const A=T.getFeatureType(_);return A?A.name:null}({fieldName:T,graphic:ne,layer:U});if(Oe)return Oe;if(A.get(T.toLowerCase()))return function L4(d,_){const x=_.fieldName,A=GD(_.fieldInfos,x)?.clone(),U=_.preventPlacesFormatting,ne=_.layer,fe=VT(ne,x);if(A&&"date"===fe?.type){const we=A.format||new _4.Z;we.dateFormat=we.dateFormat||"short-date-short-time",we.dateTimeFormatOptions=!HD(ne)&&function w4(d){return"feature"===d?.type}(ne)&&ne.datesInUnknownTimezone||HD(ne)&&function I4(d){return"map-image"===d?.type}(ne.layer)&&ne.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,A.format=we}const Oe=A&&A.format;return"string"==typeof d&&(0,Iv.Ec)(x)&&Oe?Oe.formatRasterPixelValue(d):"string"==typeof(d=function R4(d,_){if("string"==typeof d&&_&&null==_.dateFormat&&(null!=_.places||null!=_.digitSeparator)){const T=Number(d);if(!isNaN(T))return T}return d}(d,Oe))||null==d||null==Oe?Bm(d):U?(0,Lm.uf)(d,{...(0,Lm.sh)(Oe),minimumFractionDigits:0,maximumFractionDigits:20}):Oe.format(d)}(_,{fieldInfos:x||Array.from(A.values()),fieldName:T,layer:U});const we=U&&U.fieldsIndex;return we&&we.isDateField(T)?(0,Ap.p6)(_,FT):Bm(_)}function KT({fieldInfos:d,attributes:_,layer:T,graphic:x,fieldInfoMap:A,relatedInfos:U}){const ne={};return U?.forEach(fe=>function H4({attributes:d,relatedInfo:_,fieldInfoMap:T,fieldInfos:x,layer:A}){d&&_&&(_.relatedFeatures&&_.relatedFeatures&&_.relatedFeatures.forEach(U=>$D({attributes:d,graphic:U,relatedInfo:_,fieldInfoMap:T,fieldInfos:x,layer:A})),_.relatedStatsFeatures&&_.relatedStatsFeatures&&_.relatedStatsFeatures.forEach(U=>$D({attributes:d,graphic:U,relatedInfo:_,fieldInfoMap:T,fieldInfos:x,layer:A})))}({attributes:ne,relatedInfo:fe,fieldInfoMap:A,fieldInfos:d,layer:T})),Object.keys(_).forEach(fe=>{ne[fe]=ZD({fieldName:fe,fieldInfos:d,fieldInfoMap:A,layer:T,value:_[fe],graphic:x})}),ne}function N4(d,_){return ZT.apply(this,arguments)}function ZT(){return(ZT=(0,kr.Z)(function*(d,_){const{layer:T,graphic:x,outFields:A,objectIds:U,returnGeometry:ne,spatialReference:fe}=d,Oe=U[0];if("number"!=typeof Oe&&"string"!=typeof Oe)return BD.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:T,graphic:x,objectId:Oe,requiredFields:A}),null;if(!T.capabilities?.operations?.supportsQuery)return BD.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:T,graphic:x,requiredFields:A,returnGeometry:ne}),null;const we=T.createQuery();return we.objectIds=U,we.outFields=A?.length?A:[T.objectIdField],we.returnGeometry=!!ne,we.returnZ=!!ne,we.returnM=!!ne,we.outSpatialReference=fe,(yield T.queryFeatures(we,_)).features[0]})).apply(this,arguments)}function W4(d){return $T.apply(this,arguments)}function $T(){return($T=(0,kr.Z)(function*(d){if(!d.expressionInfos?.length)return!1;const _=yield(0,UD.LC)(),{arcadeUtils:{hasGeometryFunctions:T}}=_;return T(d)})).apply(this,arguments)}function YT(){return(YT=(0,kr.Z)(function*({graphic:d,popupTemplate:_,layer:T,spatialReference:x},A){if(!T||!_||("function"==typeof T.load&&(yield T.load(A)),!d.attributes))return;const U=d.attributes[T.objectIdField];if(null==U)return;const ne=[U],fe=yield _.getRequiredFields(T.fieldsIndex),Oe=(0,Iv.R9)(fe,d),we=Oe?[]:fe,Ze=_.returnGeometry||(yield W4(_));if(Oe&&!Ze)return;const it=yield N4({layer:T,graphic:d,outFields:we,objectIds:ne,returnGeometry:Ze,spatialReference:x},A);it&&(it.geometry&&(d.geometry=it.geometry),it.attributes&&(d.attributes={...d.attributes,...it.attributes}))})).apply(this,arguments)}function yd(d=""){return!!d&&d.includes(FD)}function $D({attributes:d,graphic:_,relatedInfo:T,fieldInfos:x,fieldInfoMap:A,layer:U}){d&&_&&T&&Object.keys(_.attributes).forEach(ne=>{const fe=function z4(d){return d?`${FD}${d.layerId}/${d.fieldName}`:""}({layerId:T.relation.id.toString(),fieldName:ne});d[fe]=ZD({fieldName:fe,fieldInfos:x,fieldInfoMap:A,layer:U,value:_.attributes[ne],graphic:_})})}const YD=d=>{if(!d)return!1;const _=d.toUpperCase();return _.includes("CURRENT_TIMESTAMP")||_.includes("CURRENT_DATE")||_.includes("CURRENT_TIME")},XD=({layer:d,method:_,query:T,definitionExpression:x})=>{if(!d.capabilities?.query?.supportsCacheHint||"attachments"===_)return;const A=(0,Qe.pC)(T.where)&&T.where,U=(0,Qe.pC)(T.geometry)&&T.geometry;YD(x)||YD(A)||"extent"===U?.type||"tile"===T.resultType||(T.cacheHint=!0)};function kD(d,_,T){return d.find(x=>x!==_&&"feature"===x.type&&x.url===_.url&&x.layerId===T.relatedTableId)}const JD={editing:!1,operations:{add:!0,update:!0,delete:!0}},QD=On.Z.ofType(p4.Z);let Kl=class extends Ns.Z{constructor(d){super(d),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...JD},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new QD,this.fileInfos=new On.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,Ht.YP)(()=>this.graphic,()=>this._graphicChanged(),Ht.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(d){return{...JD,...d}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:d}=this;if(!d)return!1;const _=d.layer||d.sourceLayer;return _?.loaded&&"capabilities"in _&&"operations"in _.capabilities&&"supportsResizeAttachments"in _.capabilities.operations&&_.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var d=this;return(0,kr.Z)(function*(){const{_attachmentLayer:_,attachmentInfos:T}=d;if(!_||"function"!=typeof _.queryAttachments)throw new ai.Z("invalid-layer","getAttachments(): A valid layer is required.");const x=d._getObjectId(),A=new LD.Z({objectIds:[x],returnMetadata:!0}),U=[],ne=_.queryAttachments(A).then(Oe=>Oe[x]||U).catch(()=>U);d._getAttachmentsPromise=ne,d.notifyChange("state");const fe=yield ne;return T.removeAll(),fe.length&&T.addMany(fe),d._getAttachmentsPromise=null,d.notifyChange("state"),fe})()}addAttachment(d,_=this.graphic){var T=this;return(0,kr.Z)(function*(){const{_attachmentLayer:x,attachmentInfos:A,abilities:U}=T;if(!_)throw new ai.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:_});if(!d)throw new ai.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:d});if(!U.operations.add)throw new ai.Z("invalid-abilities","addAttachment(): add abilities are required.");if(!x||"function"!=typeof x.addAttachment)throw new ai.Z("invalid-layer","addAttachment(): A valid layer is required.");const ne=x.addAttachment(_,d).then(Oe=>T._queryAttachment(Oe.objectId,_)),fe=yield ne;return A.add(fe),fe})()}deleteAttachment(d){var _=this;return(0,kr.Z)(function*(){const{_attachmentLayer:T,attachmentInfos:x,graphic:A,abilities:U}=_;if(!d)throw new ai.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:d});if(!U.operations.delete)throw new ai.Z("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!T||"function"!=typeof T.deleteAttachments)throw new ai.Z("invalid-layer","deleteAttachment(): A valid layer is required.");const ne=T.deleteAttachments(A,[d.id]).then(()=>d),fe=yield ne;return x.remove(fe),fe})()}updateAttachment(d,_=this.activeAttachmentInfo){var T=this;return(0,kr.Z)(function*(){const{_attachmentLayer:x,attachmentInfos:A,graphic:U,abilities:ne}=T;if(!d)throw new ai.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:d});if(!_)throw new ai.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:_});if(!ne.operations.update)throw new ai.Z("invalid-abilities","updateAttachment(): Update abilities are required.");const fe=A.findIndex(Ze=>Ze===_);if(!x||"function"!=typeof x.updateAttachment)throw new ai.Z("invalid-layer","updateAttachment(): A valid layer is required.");const Oe=x.updateAttachment(U,_.id,d).then(Ze=>T._queryAttachment(Ze.objectId)),we=yield Oe;return A.splice(fe,1,we),we})()}commitFiles(){var d=this;return(0,kr.Z)(function*(){return yield Promise.all(d.fileInfos.items.map(_=>d.addAttachment(_.form))),d.fileInfos.removeAll(),d.getAttachments()})()}addFile(d,_){if(!d||!_)return null;const T={file:d,form:_};return this.fileInfos.add(T),T}updateFile(d,_,T=this.activeFileInfo){if(!d||!_||!T)return null;const x=this.fileInfos.findIndex(A=>T===A);return x>-1&&this.fileInfos.splice(x,1,{file:d,form:_}),this.fileInfos.items[x]}deleteFile(d){const _=this.fileInfos.find(T=>T.file===d);return this.fileInfos.remove(_)??null}_queryAttachment(d,_){var T=this;return(0,kr.Z)(function*(){if(!d)throw new ai.Z("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:x}=T,A=T._getObjectId(_),U=new LD.Z({objectIds:[A],attachmentsWhere:`AttachmentId=${d}`,returnMetadata:!0});return x.queryAttachments(U).then(ne=>ne[A][0])})()}_getObjectId(d=this.graphic){return d?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:d}=this,_=ND(d);this._attachmentLayer=_?"scene"===_.type&&(0,Qe.pC)(_.associatedLayer)?_.associatedLayer:_:null}};(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"abilities",void 0),(0,Ve._)([(0,ko.p)("abilities")],Kl.prototype,"castAbilities",null),(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"activeAttachmentInfo",void 0),(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"activeFileInfo",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:QD})],Kl.prototype,"attachmentInfos",void 0),(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"fileInfos",void 0),(0,Ve._)([(0,ke.Cb)({type:fd.Z})],Kl.prototype,"graphic",void 0),(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"mode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Kl.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],Kl.prototype,"filesEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Kl.prototype,"supportsResizeAttachments",null),Kl=(0,Ve._)([(0,Wr.j)("esri.widgets.Attachments.AttachmentsViewModel")],Kl);const XT=Kl;var Uv=v(54346);function qD(d){const _=d.toLowerCase();return"image/bmp"===_||"image/emf"===_||"image/exif"===_||"image/gif"===_||"image/x-icon"===_||"image/jpeg"===_||"image/png"===_||"image/tiff"===_||"image/x-wmf"===_}var uo=v(38570),Jo=v(25552),Yt=v(94450);const eS={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},zs_item="esri-attachments__item",zs_itemButton="esri-attachments__item-button",kT=window.CSS;let rl=class extends ua.Z{constructor(d,_){super(d,_),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new XT,this.visibleElements={...eS},this._supportsImageOrientation=kT&&kT.supports&&kT.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.addHandles([(0,Ht.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,Ht.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,Ht.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),Ht.nn)])}loadDependencies(){return Promise.all([v.e(8472).then(v.bind(v,8472))])}get abilities(){return this.viewModel.abilities}set abilities(d){this.viewModel.abilities=d}get effectiveDisplayType(){const{displayType:d}=this;return d&&"auto"!==d?d:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}castVisibleElements(d){return{...eS,...d}}addAttachment(){const{_addAttachmentForm:d,viewModel:_}=this;return this._set("submitting",!0),this._set("error",null),_.addAttachment(d).then(T=>(this._set("submitting",!1),this._set("error",null),_.mode="view",T)).catch(T=>{throw this._set("submitting",!1),this._set("error",new ai.Z("attachments:add-attachment",this.messages.addErrorMessage,T)),T})}deleteAttachment(d){const{viewModel:_}=this;return this._set("submitting",!0),this._set("error",null),_.deleteAttachment(d).then(T=>(this._set("submitting",!1),this._set("error",null),_.mode="view",T)).catch(T=>{throw this._set("submitting",!1),this._set("error",new ai.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,T)),T})}updateAttachment(){const{viewModel:d}=this,{_updateAttachmentForm:_}=this;return this._set("submitting",!0),this._set("error",null),d.updateAttachment(_).then(T=>(this._set("submitting",!1),this._set("error",null),d.mode="view",T)).catch(T=>{throw this._set("submitting",!1),this._set("error",new ai.Z("attachments:update-attachment",this.messages.updateErrorMessage,T)),T})}addFile(){const d=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",d}updateFile(){const{viewModel:d}=this,_=d.updateFile(this.selectedFile,this._updateAttachmentForm,d.activeFileInfo);return d.mode="view",_}deleteFile(d){const _=this.viewModel.deleteFile(d||this.viewModel.activeFileInfo.file);return this.viewModel.mode="view",_}render(){const{submitting:d,viewModel:_}=this,{state:T}=_;return(0,Yt.u)("div",{class:this.classes("esri-attachments","esri-widget")},d?this.renderProgressBar():null,"loading"===T?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:d,visibleElements:_}=this;return d&&_.errorMessage?(0,Yt.u)("div",{key:"error-message",class:"esri-attachments__error-message"},d.message):null}renderAttachments(){const{activeFileInfo:d,mode:_,activeAttachmentInfo:T}=this.viewModel;return"add"===_?this.renderAddForm():"edit"===_?this.renderDetailsForm(T||d):this.renderAttachmentContainer()}renderLoading(){return(0,Yt.u)("div",{class:"esri-attachments__loader-container",key:"loader"},(0,Yt.u)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?(0,Yt.u)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:d,selectedFile:_}=this,T=d||!_,x=this.visibleElements.cancelAddButton?(0,Yt.u)("button",{type:"button",bind:this,disabled:d,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",d&&"esri-button--disabled")},this.messages.cancel):null,A=this.visibleElements.addSubmitButton?(0,Yt.u)("button",{type:"submit",disabled:T,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{"esri-button--disabled":T})},this.messages.add):null,U=_?(0,Yt.u)("span",{key:"file-name",class:"esri-attachments__file-name"},_.name):null,ne=(0,Yt.u)("form",{bind:this,afterCreate:uo.Yo,afterRemoved:uo.pV,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,Yt.u)("fieldset",{class:"esri-attachments__file-fieldset"},U,(0,Yt.u)("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},_?this.messages.changeFile:this.messages.selectFile,(0,Yt.u)("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),A,x);return(0,Yt.u)("div",{key:"add-form-container",class:"esri-attachments__form-node"},ne)}renderDetailsForm(d){const{visibleElements:_,viewModel:T,selectedFile:x,submitting:A}=this,{abilities:U}=T,ne=A||!x;let fe,Oe,we,Ze;x?(fe=x.type,Oe=x.name,we=x.size):"file"in d?(fe=d.file.type,Oe=d.file.name,we=d.file.size):(fe=d.contentType,Oe=d.name,we=d.size,Ze=d.url);const it=U.editing&&U.operations.delete&&_.deleteButton?(0,Yt.u)("button",{key:"delete-button",type:"button",disabled:A,bind:this,onclick:Bt=>this._submitDeleteAttachment(Bt,d),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{"esri-button--disabled":A})},this.messages.delete):void 0,lt=U.editing&&U.operations.update&&_.updateButton?(0,Yt.u)("button",{disabled:ne,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{"esri-button--disabled":ne})},this.messages.update):void 0,dt=this.visibleElements.cancelUpdateButton?(0,Yt.u)("button",{disabled:A,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{"esri-button--disabled":A})},this.messages.cancel):void 0,Tt=U.editing&&U.operations.update?(0,Yt.u)("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},(0,Yt.u)("span",{key:"file-name",class:"esri-attachments__file-name"},Oe),(0,Yt.u)("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,(0,Yt.u)("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,mt=(0,Yt.u)("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},(0,Yt.u)("label",null,(0,h4.sS)(this.messagesUnits,we))),Mt=(0,Yt.u)("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},(0,Yt.u)("label",null,fe)),Pt=(0,Qe.pC)(Ze)?(0,Yt.u)("a",{class:"esri-attachments__item-link",href:Ze,rel:"noreferrer",target:"_blank"},this.renderImageMask(d,400),(0,Yt.u)("div",{class:"esri-attachments__item-link-overlay"},(0,Yt.u)("span",{class:"esri-attachments__item-link-overlay-icon"},(0,Yt.u)("calcite-icon",{icon:"launch"})))):this.renderImageMask(d,400),Nt=(0,Yt.u)("form",{bind:this,afterCreate:uo.Yo,afterRemoved:uo.pV,"data-node-ref":"_updateAttachmentForm",onsubmit:Bt=>this._submitUpdateAttachment(Bt,d)},(0,Yt.u)("div",{class:"esri-attachments__metadata"},mt,Mt),Tt,(0,Yt.u)("div",{class:"esri-attachments__actions"},it,dt,lt));return(0,Yt.u)("div",{key:"edit-form-container",class:"esri-attachments__form-node"},Pt,Nt)}renderImageMask(d,_){return"file"in d?this.renderGenericImageMask(d.file.name,d.file.type):this.renderImageMaskForAttachment(d,_)}renderGenericImageMask(d,_){const{supportsResizeAttachments:T}=this.viewModel,x=function $4(d){const _=(0,Uv.V)("esri/themes/base/images/files/");return d?"text/plain"===d?`${_}text-32.svg`:"application/pdf"===d?`${_}pdf-32.svg`:"text/csv"===d?`${_}csv-32.svg`:"application/gpx+xml"===d?`${_}gpx-32.svg`:"application/x-dwf"===d?`${_}cad-32.svg`:"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?`${_}code-32.svg`:"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?`${_}zip-32.svg`:d.includes("image/")?`${_}image-32.svg`:d.includes("audio/")?`${_}sound-32.svg`:d.includes("video/")?`${_}video-32.svg`:d.includes("msexcel")||d.includes("ms-excel")||d.includes("spreadsheetml")?`${_}excel-32.svg`:d.includes("msword")||d.includes("ms-word")||d.includes("wordprocessingml")?`${_}word-32.svg`:d.includes("powerpoint")||d.includes("presentationml")?`${_}report-32.svg`:`${_}generic-32.svg`:`${_}generic-32.svg`}(_),A={"esri-attachments__image--resizable":T};return(0,Yt.u)("div",{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask")},(0,Yt.u)("img",{title:d,alt:d,src:x,class:this.classes(A,"esri-attachments__image")}))}renderImageMaskForAttachment(d,_){const{supportsResizeAttachments:T}=this.viewModel,{contentType:x,name:A,url:U}=d;if(!T||!qD(x))return this.renderGenericImageMask(A,x);const ne=this._getCSSTransform(d),fe=ne?{transform:ne,"image-orientation":"none"}:{},Oe=`${U}${U.includes("?")?"&":"?"}w=${_}`,we={"esri-attachments__image--resizable":T};return(0,Yt.u)("div",{class:this.classes("esri-attachments__item-mask")},(0,Yt.u)("img",{styles:fe,alt:A,title:A,src:Oe,class:this.classes(we,"esri-attachments__image")}))}renderFile(d){const{file:_}=d;return(0,Yt.u)("li",{class:zs_item,key:_},(0,Yt.u)("button",{key:"details-button",bind:this,class:zs_itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(d),type:"button"},this.renderImageMask(d),(0,Yt.u)("label",{class:"esri-attachments__label"},(0,Yt.u)("span",{class:"esri-attachments__filename"},_.name||this.messages.noTitle),(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",(0,uo.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}))))}renderAttachmentInfo({attachmentInfo:d,displayType:_}){const{viewModel:T,effectiveDisplayType:x}=this,{abilities:A,supportsResizeAttachments:U}=T,{contentType:ne,name:fe,url:Oe}=d,we=this.renderImageMask(d,"list"===_?48:400),Ze=A.editing?(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",(0,uo.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}):null,it=[we,"preview"===x&&U&&qD(ne)?null:(0,Yt.u)("label",{class:"esri-attachments__label"},(0,Yt.u)("span",{class:"esri-attachments__filename"},fe||this.messages.noTitle),Ze)],lt=A.editing?(0,Yt.u)("button",{key:"details-button",bind:this,class:zs_itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":d.id,onclick:()=>this._startEditAttachment(d),type:"button"},it):(0,Yt.u)("a",{key:"details-link",class:zs_itemButton,href:Oe,target:"_blank"},it);return(0,Yt.u)("li",{class:zs_item,key:d},lt)}renderAttachmentContainer(){const{effectiveDisplayType:d,viewModel:_,visibleElements:T}=this,{attachmentInfos:x,abilities:A,fileInfos:U}=_,ne=!!x?.length,fe=!!U?.length,Oe={"esri-attachments__container--list":"preview"!==d,"esri-attachments__container--preview":"preview"===d},we=A.editing&&A.operations.add&&T.addButton?(0,Yt.u)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):void 0,Ze=ne?(0,Yt.u)("ul",{key:"attachments-list",class:"esri-attachments__items"},x.toArray().map(dt=>this.renderAttachmentInfo({attachmentInfo:dt,displayType:d}))):void 0,it=fe?(0,Yt.u)("ul",{key:"file-list",class:"esri-attachments__items"},U.toArray().map(dt=>this.renderFile(dt))):void 0,lt=fe||ne?void 0:(0,Yt.u)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return(0,Yt.u)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",Oe)},Ze,it,lt,we)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(d){const _=d.target,T=_&&_.files&&_.files.item(0);this._set("selectedFile",T)}_submitDeleteAttachment(d,_){d.preventDefault(),"file"in _?this.deleteFile(_.file):this.deleteAttachment(_)}_submitAddAttachment(d){d.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(d,_){d.preventDefault(),"file"in _?this.updateFile():this.updateAttachment()}_startEditAttachment(d){const{viewModel:_}=this;_.activeFileInfo=null,_.activeAttachmentInfo=d,_.mode="edit"}_startEditFile(d){const{viewModel:_}=this;_.activeAttachmentInfo=null,_.activeFileInfo=d,_.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(d){d.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(d){const{orientationInfo:_}=d;return!this._supportsImageOrientation&&_?[_.rotation?`rotate(${_.rotation}deg)`:"",_.mirrored?"scaleX(-1)":""].join(" "):""}};(0,Ve._)([(0,ke.Cb)()],rl.prototype,"abilities",null),(0,Ve._)([(0,ke.Cb)()],rl.prototype,"displayType",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],rl.prototype,"effectiveDisplayType",null),(0,Ve._)([(0,ke.Cb)()],rl.prototype,"graphic",null),(0,Ve._)([(0,ke.Cb)()],rl.prototype,"label",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Attachments/t9n/Attachments")],rl.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/core/t9n/Units")],rl.prototype,"messagesUnits",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],rl.prototype,"selectedFile",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],rl.prototype,"submitting",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],rl.prototype,"error",void 0),(0,Ve._)([(0,ke.Cb)({type:XT})],rl.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)()],rl.prototype,"visibleElements",void 0),(0,Ve._)([(0,ko.p)("visibleElements")],rl.prototype,"castVisibleElements",null),rl=(0,Ve._)([(0,Wr.j)("esri.widgets.Attachments")],rl);const Y4=rl;let jm=class extends XT{constructor(d){super(d),this.description=null,this.title=null}};(0,Ve._)([(0,ke.Cb)()],jm.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)()],jm.prototype,"title",void 0),jm=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],jm);const JT=jm;function wp(d,_){const T=tS(d.level),x=`h${T}`;return delete d.level,(0,Yt.u)(x,{...d,class:(0,uo.Sh)("esri-widget__heading",d.class),role:"heading","aria-level":String(T)},_)}function tS(d){return(0,xr.uZ)(Math.ceil(d),1,6)}function k4(d,_=1){return tS(d+_)}let u_=class extends ua.Z{constructor(d,_){super(d,_),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,Yt.u)("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:d}=this;return d?(0,Yt.u)(wp,{level:this.headingLevel,class:"esri-feature-element-info__title"},d):null}renderDescription(){const{description:d}=this;return d?(0,Yt.u)("div",{key:"description",class:"esri-feature-element-info__description"},d):null}};(0,Ve._)([(0,ke.Cb)()],u_.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)()],u_.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],u_.prototype,"title",void 0),u_=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.support.FeatureElementInfo")],u_);const Bv=u_;let Ru=class extends ua.Z{constructor(d,_){super(d,_),this._featureElementInfo=null,this.attachmentsWidget=new Y4,this.headingLevel=2,this.viewModel=new JT}initialize(){this._featureElementInfo=new Bv,this.addHandles([(0,Ht.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Ht.nn),(0,Ht.YP)(()=>this.viewModel?.graphic,d=>this.attachmentsWidget.graphic=d,Ht.nn)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get displayType(){return this.attachmentsWidget.displayType}set displayType(d){this.attachmentsWidget.displayType=d}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){const{attachmentsWidget:d}=this;return(0,Yt.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),d?.render())}_setupFeatureElementInfo(){const{description:d,title:_,headingLevel:T}=this;this._featureElementInfo.set({description:d,title:_,headingLevel:T})}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ru.prototype,"attachmentsWidget",void 0),(0,Ve._)([(0,ke.Cb)()],Ru.prototype,"description",null),(0,Ve._)([(0,ke.Cb)()],Ru.prototype,"displayType",null),(0,Ve._)([(0,ke.Cb)()],Ru.prototype,"graphic",null),(0,Ve._)([(0,ke.Cb)()],Ru.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],Ru.prototype,"title",null),(0,Ve._)([(0,ke.Cb)({type:JT})],Ru.prototype,"viewModel",void 0),Ru=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureAttachments")],Ru);const Q4=Ru;var Ip=v(80542);let mh=class extends((0,Ip.p)(Ns.Z)){constructor(d){super(d),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add((0,Ht.YP)(()=>this.creator,_=>{this._destroyContent(),this._createContent(_)},Ht.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:d,graphic:_,destroyer:T}=this;d&&(Lv(T,{graphic:_}).catch(()=>null),this._set("created",null))}_createContent(d){var _=this;return(0,kr.Z)(function*(){const{graphic:T}=_,x=Lv(d,{graphic:T}).catch(()=>null);_._loadingPromise=x,_.notifyChange("state");const A=yield x;x===_._loadingPromise&&(_._loadingPromise=null,_.notifyChange("state"),_._set("created",A))})()}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],mh.prototype,"created",void 0),(0,Ve._)([(0,ke.Cb)()],mh.prototype,"creator",void 0),(0,Ve._)([(0,ke.Cb)()],mh.prototype,"destroyer",void 0),(0,Ve._)([(0,ke.Cb)({type:fd.Z})],mh.prototype,"graphic",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],mh.prototype,"state",null),mh=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],mh);const jv=mh;var qT=v(25469);let d_=class extends ua.Z{constructor(d,_){super(d,_),this.viewModel=null,this._addTargetToAnchors=T=>{Array.from(T.querySelectorAll("a")).forEach(x=>{WD(x.href)&&!x.hasAttribute("target")&&x.setAttribute("target","_blank")})}}get creator(){return this.viewModel.creator}set creator(d){this.viewModel.creator=d}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}renderLoading(){return(0,Yt.u)("div",{class:"esri-feature-content__loader-container",key:"loader"},(0,Yt.u)("div",{class:"esri-feature-content__loader"}))}renderCreated(){const d=this.viewModel?.created;return d?d instanceof HTMLElement?(0,Yt.u)("div",{key:d,bind:d,afterCreate:this._attachToNode}):(0,qT.Qd)(d)?(0,Yt.u)("div",{key:d},!d.destroyed&&d.render()):(0,Yt.u)("div",{key:d,innerHTML:d,afterCreate:this._addTargetToAnchors}):null}render(){const d=this.viewModel?.state;return(0,Yt.u)("div",{class:"esri-feature-content"},"loading"===d?this.renderLoading():this.renderCreated())}_attachToNode(d){d.appendChild(this)}};(0,Ve._)([(0,ke.Cb)()],d_.prototype,"creator",null),(0,Ve._)([(0,ke.Cb)()],d_.prototype,"graphic",null),(0,Ve._)([(0,ke.Cb)({type:jv})],d_.prototype,"viewModel",void 0),d_=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureContent")],d_);const Fv=d_;var q4=v(38439),rS=v(25621);let vd=class extends Ns.Z{constructor(d){super(d),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:d,fieldInfos:_}=this,T=[];return _?.forEach(x=>{if(x.hasOwnProperty("visible")&&!x.visible)return;const A=x.clone();A.label=VD(A,d),T.push(A)}),T}};(0,Ve._)([(0,ke.Cb)()],vd.prototype,"attributes",void 0),(0,Ve._)([(0,ke.Cb)({type:[q4.Z]})],vd.prototype,"expressionInfos",void 0),(0,Ve._)([(0,ke.Cb)()],vd.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)({type:[rS.Z]})],vd.prototype,"fieldInfos",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],vd.prototype,"formattedFieldInfos",null),(0,Ve._)([(0,ke.Cb)()],vd.prototype,"title",void 0),vd=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],vd);const Nv=vd,e6=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let ou=class extends ua.Z{constructor(d,_){super(d,_),this._featureElementInfo=null,this.viewModel=new Nv,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Bv,this.addHandles((0,Ht.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),Ht.nn))}destroy(){this._featureElementInfo.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(d){this.viewModel.expressionInfos=d}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(d){this.viewModel.fieldInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}renderFieldInfo(d,_){const{attributes:T}=this.viewModel,x=d.fieldName,A=d.label||x,U=T?T[x]??"":"",ne=!(!d.format||!d.format.dateFormat),fe="number"!=typeof U||ne?function r6(d,_){if("string"!=typeof _||!_)return _;const T=function t6(d){let _=null;return e6.some(T=>(T.pattern.test(d)&&(_=T),!!_)),_}(_);if(!T)return _;const x=_.match(T.pattern),U=(0,Im.gx)((0,Im.gx)(T.label,{messages:d,hierPart:x&&x[2]}),{appName:T.appName});return _.replace(T.pattern,`<a${T.target?` target="${T.target}"`:""} href="$1"${"_blank"===T.target?' rel="noreferrer"':""}>${U}</a>`)}(this.messagesURIUtils,U):this._forceLTR(U),Oe={"esri-feature-fields__field-data--date":ne};return(0,Yt.u)("tr",{key:`fields-element-info-row-${x}-${_}`},(0,Yt.u)("th",{key:`fields-element-info-row-header-${x}-${_}`,class:"esri-feature-fields__field-header",innerHTML:A}),(0,Yt.u)("td",{key:`fields-element-info-row-data-${x}-${_}`,class:this.classes("esri-feature-fields__field-data",Oe),innerHTML:fe}))}renderFields(){const{formattedFieldInfos:d}=this.viewModel;return d?.length?(0,Yt.u)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},(0,Yt.u)("tbody",null,d.map((_,T)=>this.renderFieldInfo(_,T)))):null}render(){return(0,Yt.u)("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:d,title:_}=this;this._featureElementInfo.set({description:d,title:_})}_forceLTR(d){return`&lrm;${d}`}};(0,Ve._)([(0,ke.Cb)()],ou.prototype,"attributes",null),(0,Ve._)([(0,ke.Cb)()],ou.prototype,"description",null),(0,Ve._)([(0,ke.Cb)()],ou.prototype,"expressionInfos",null),(0,Ve._)([(0,ke.Cb)()],ou.prototype,"fieldInfos",null),(0,Ve._)([(0,ke.Cb)()],ou.prototype,"title",null),(0,Ve._)([(0,ke.Cb)({type:Nv,nonNullable:!0})],ou.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Feature/t9n/Feature")],ou.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/support/t9n/uriUtils")],ou.prototype,"messagesURIUtils",void 0),ou=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureFields")],ou);const sS=ou;var El=v(88159);const s6=/^-?(\d+)(\.(\d+))?$/i;function i6(d,_){return d-_}function n6(d,_){let T,x;return T=Number(d.toFixed(_)),T<d?x=T+1/10**_:(x=T,T-=1/10**_),T=Number(T.toFixed(_)),x=Number(x.toFixed(_)),[T,x]}function o6(d,_,T,x,A){const U=Vv(d,_,T,x);return(null==U.previous||U.previous<=A)&&(null==U.next||U.next<=A)||U.previous+U.next<=2*A}function Wv(d){const _=String(d),T=_.match(s6);if(T&&T[1])return{integer:T[1].split("").length,fractional:T[3]?T[3].split("").length:0};if(_.toLowerCase().includes("e")){const x=_.split("e"),A=x[0],U=x[1];if(A&&U){const ne=Number(A);let fe=Number(U);const Oe=fe>0;Oe||(fe=Math.abs(fe));const we=Wv(ne);return Oe?(we.integer+=fe,fe>we.fractional?we.fractional=0:we.fractional-=fe):(we.fractional+=fe,fe>we.integer?we.integer=1:we.integer-=fe),we}}return{integer:0,fractional:0}}function Vv(d,_,T,x){const A={previous:null,next:null};if(null!=T){const U=d-T;A.previous=Math.floor(Math.abs(100*(_-T-U)/U))}if(null!=x){const U=x-d;A.next=Math.floor(Math.abs(100*(x-_-U)/U))}return A}function zv(d,_={}){const T=d.slice(0),{tolerance:x=2,strictBounds:A=!1,indexes:U=T.map((ne,fe)=>fe)}=_;U.sort(i6);for(let ne=0;ne<U.length;ne++){const fe=U[ne],Oe=T[fe],we=0===fe?null:T[fe-1],Ze=fe===T.length-1?null:T[fe+1],it=Wv(Oe).fractional;if(it){let lt,dt=0,Tt=!1;for(;dt<=it&&!Tt;){const mt=n6(Oe,dt);lt=A&&0===ne?mt[1]:mt[0],Tt=o6(Oe,lt,we,Ze,x),dt++}Tt&&(T[fe]=lt)}}return T}const a6={maximumFractionDigits:20};v(8029);var da=v(86606),iS=v(20383),nS=v(52068);const c6=(0,Ap.Ze)("short-date");function lS(d,_,T,x){let A="";0===_?A="< ":_===T&&(A="> ");let U=null;return U=x?(0,Ap.p6)(d,c6):function l6(d){return(0,Lm.uf)(d,a6)}(d),A+U}const u6=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];function tM(d){return rM.apply(this,arguments)}function rM(){return(rM=(0,kr.Z)(function*(d){if(!("visualVariables"in d)||!d.visualVariables)return null;const _=d.visualVariables.find(ne=>"color"===ne.type);if(!_)return null;let T=null,x=null;if(_.stops){if(1===_.stops.length)return _.stops[0].color;T=_.stops[0].value,x=_.stops[_.stops.length-1].value}const A=T+(x-T)/2,{getColor:U}=yield Promise.resolve().then(v.bind(v,81808));return U(_,A)})).apply(this,arguments)}function cS(d,_){return sM.apply(this,arguments)}function sM(){return(sM=(0,kr.Z)(function*(d,_){const T=d.trailCap,x=d.trailWidth||1,A=_||(yield tM(d))||d.color;return new nS.Z({cap:T,color:A,width:x})})).apply(this,arguments)}const d6=new lo.Z([64,64,64]);function uS(d,_){const T=[],x=d.length-1;return 5===d.length?T.push(0,2,4):T.push(0,x),d.map((A,U)=>T.includes(U)?lS(A,U,x,_):null)}function iM(d,_,T){return nM.apply(this,arguments)}function nM(){return nM=(0,kr.Z)(function*(d,_,T){let x=!1,A=[],U=[];if(d.stops){const we=d.stops;A=we.map(Ze=>Ze.value),x=we.some(Ze=>!!Ze.label),x&&(U=we.map(Ze=>Ze.label))}if(null==A[0]&&null==A[A.length-1])return null;const Oe=x?null:uS(A,T);return(yield Promise.all(A.map(function(){var we=(0,kr.Z)(function*(Ze,it){return{value:Ze,color:"opacity"===d.type?yield h6(Ze,d,_):(yield Promise.resolve().then(v.bind(v,81808))).getColor(d,Ze),label:x?U[it]:Oe[it]}});return function(Ze,it){return we.apply(this,arguments)}}()))).reverse()}),nM.apply(this,arguments)}function h6(d,_){return oM.apply(this,arguments)}function oM(){return(oM=(0,kr.Z)(function*(d,_,T=d6){const x=new lo.Z(T),A=(yield Promise.resolve().then(v.bind(v,81808))).getOpacity(_,d);return null!=A&&(x.a=A),x})).apply(this,arguments)}function dS(d,_){const{startIndex:T,endIndex:x,weight:A}=function _6(d,_){let T=0,x=_.length-1;return _.some((A,U)=>d<A.value?(x=U,!0):(T=U,!1)),{startIndex:T,endIndex:x,weight:(d-_[T].value)/(_[x].value-_[T].value)}}(d,_);if(T===x)return _[T].color;const U=lo.Z.blendColors(_[T].color,_[x].color,A);return new lo.Z(U)}var m6=v(52372);function hS(d){if(!d.colorStops)return[];const _=[...d.colorStops].filter(x=>x.color?.a>0);let T=_.length-1;if(_&&_[0]){const x=_[T];x&&1!==x.ratio&&(_.push(new m6.Z({ratio:1,color:x.color})),T++)}return _.map((x,A)=>{let U="";return 0===A?U=d.legendOptions?.minLabel||"low":A===T&&(U=d.legendOptions?.maxLabel||"high"),{color:x.color,label:U,ratio:x.ratio}}).reverse()}function dc(d,_,T){return aM.apply(this,arguments)}function aM(){return(aM=(0,kr.Z)(function*(d,_,T){(0,El.s1)(d,_,()=>[]).push(...T)})).apply(this,arguments)}function lM(){return(lM=(0,kr.Z)(function*(d){const _=new Map;if(!d)return _;if("visualVariables"in d&&d.visualVariables){const T=d.visualVariables.filter(x=>"color"===x.type);for(const x of T){const A=(yield iM(x)).map(U=>U.color);yield dc(_,x.field||x.valueExpression,A)}}if("heatmap"===d.type){const T=hS(d).map(x=>x.color);yield dc(_,d.field||d.valueExpression,T)}else if("pie-chart"===d.type){for(const T of d.attributes)yield dc(_,T.field||T.valueExpression,[T.color]);yield dc(_,"default",[d?.othersCategory?.color,(0,da._h)(d.backgroundFillSymbol,null)])}else if("dot-density"===d.type){for(const T of d.attributes)yield dc(_,T.field||T.valueExpression,[T.color]);yield dc(_,"default",[d.backgroundColor])}else if("unique-value"===d.type)if("predominance"===d.authoringInfo?.type)for(const T of d.uniqueValueInfos??[])yield dc(_,T.value.toString(),[(0,da._h)(T.symbol,null)]);else{const T=(d.uniqueValueInfos??[]).map(fe=>(0,da._h)(fe.symbol,null)),{field:x,field2:A,field3:U,valueExpression:ne}=d;(x||ne)&&(yield dc(_,x||ne,T)),A&&(yield dc(_,A,T)),U&&(yield dc(_,U,T))}else if("class-breaks"===d.type){const T=d.classBreakInfos.map(U=>(0,da._h)(U.symbol,null)),{field:x,valueExpression:A}=d;yield dc(_,x??A,T)}else"simple"===d.type&&(yield dc(_,"default",[(0,da._h)(d.symbol,null)]));return"defaultSymbol"in d&&d.defaultSymbol&&(yield dc(_,"default",[(0,da._h)(d.defaultSymbol,null)])),_.forEach((T,x)=>{const A=(0,pd.Tw)(T.filter(Boolean),(U,ne)=>JSON.stringify(U)===JSON.stringify(ne));_.set(x,A)}),_})).apply(this,arguments)}Us.Z.getLogger("esri.renderers.support.utils"),(0,Ap.Ze)("short-date");var M6=v(77891),cM=v(84792),uM=(v(15283),v(2865)),P6=v(24263),dM=v(16730),hc=v(37053),bl=(v(82054),v(2004)),O6=v(21674),hM=(v(72854),v(37118),v(55214),v(93555),v(24192),v(17253),v(96854)),pM=v(67010),x6=(v(6871),v(60776));const fS=Us.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),mS=new Map;function _M(d){if(!yd(d))return null;const[_,T]=d.split("/").slice(1);return{layerId:_,fieldName:T}}function A6({originRelationship:d,relationships:_,layerId:T}){let x;return _&&_.some(A=>(`${A.relatedTableId}`===T&&A.id===d.id&&(x=A),!!x)),x}function R6(d,_){const T=_.toLowerCase();for(const x in d)if(x.toLowerCase()===T)return d[x];return null}function L6(d,_,T,x){const A=new pM.Z;return A.outFields=["*"],A.relationshipId="number"==typeof _.id?_.id:parseInt(_.id,10),A.objectIds=[d.attributes[T.objectIdField]],T.queryRelatedFeatures(A,x)}function U6(d,_,T){let x=0;const A=[];for(;x<_.length;)A.push(`${d} IN (${_.slice(x,T+x)})`),x+=T;return A.join(" OR ")}function fM(){return(fM=(0,kr.Z)(function*(d,_,T,x){const A=T.layerId.toString(),{layerInfo:U,relation:ne,relatedFields:fe,outStatistics:Oe,url:we,sourceSpatialReference:Ze}=_,it=A6({originRelationship:ne,relationships:U.relationships,layerId:A});if(it.relationshipTableId&&it.keyFieldInRelationshipTable){const dt=(yield L6(d,it,T,x))[d.attributes[T.objectIdField]];if(!dt)return null;const Tt=dt.features.map(mt=>mt.attributes[U.objectIdField]);if(Oe?.length>0&&U.supportsStatistics){const mt=new hM.Z;mt.where=U6(U.objectIdField,Tt,1e3),mt.outFields=fe,mt.outStatistics=Oe,mt.sourceSpatialReference=Ze;const Mt={features:Promise.resolve(dt),statsFeatures:(0,uM.e)(we,mt)};return(0,ws.as)(Mt)}}const lt=it?.keyField;if(lt){const dt=(0,Iv.H7)(V6(U.fields,lt)),Tt=R6(d.attributes,ne.keyField),mt=dt?`${lt}=${Tt}`:`${lt}='${Tt}'`,Mt=(0,uM.e)(we,new hM.Z({where:mt,outFields:_.relatedFields,sourceSpatialReference:Ze}),x),Pt=_.outStatistics&&_.outStatistics.length>0&&U.supportsStatistics?(0,uM.e)(we,new hM.Z({where:mt,outFields:_.relatedFields,outStatistics:_.outStatistics,sourceSpatialReference:Ze}),x):null,Nt={features:Mt};return Pt&&(Nt.statsFeatures=Pt),(0,ws.as)(Nt)}return null})).apply(this,arguments)}function V6(d,_){if(null!=d){_=_.toLowerCase();for(const T of d)if(T&&T.name.toLowerCase()===_)return T}return null}const gS={chartAnimation:!0};let ha=class extends Ns.Z{constructor(d){super(d),this.abilities={...gS},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(d){return{...gS,...d}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(d){this._setContentElementMedia(d)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(d){const{formattedMediaInfoCount:_}=this;this.activeMediaInfoIndex=(d+_)%_}_pageContentElementMedia(d){const{activeMediaInfoIndex:_}=this;this._setContentElementMedia(_+d)}_formatMediaInfos(){const{attributes:d,mediaInfos:_,formattedAttributes:T,expressionAttributes:x,fieldInfoMap:A,layer:U}=this;return _?.map(ne=>{const fe=ne?.clone();if(!fe)return null;if(fe.title=Rp({attributes:d,fieldInfoMap:A,globalAttributes:T,expressionAttributes:x,layer:U,text:fe.title}),fe.caption=Rp({attributes:d,fieldInfoMap:A,globalAttributes:T,expressionAttributes:x,layer:U,text:fe.caption}),fe.altText=Rp({attributes:d,fieldInfoMap:A,globalAttributes:T,expressionAttributes:x,layer:U,text:fe.altText}),"image"===fe.type){const{value:Oe}=fe;return this._setImageValue({value:Oe,formattedAttributes:T,layer:U}),fe.value.sourceURL?fe:void 0}if("pie-chart"===fe.type||"line-chart"===fe.type||"column-chart"===fe.type||"bar-chart"===fe.type){const{value:Oe}=fe;return this._setChartValue({value:Oe,chartType:fe.type,attributes:d,formattedAttributes:T,layer:U,expressionAttributes:x}),fe}return null}).filter(Boolean)}_setImageValue(d){const{fieldInfoMap:_}=this,{value:T,formattedAttributes:x,layer:A}=d,{linkURL:U,sourceURL:ne}=T;if(ne){const fe=HT(ne,A);T.sourceURL=zT({formattedAttributes:x,template:fe,fieldInfoMap:_})}if(U){const fe=HT(U,A);T.linkURL=zT({formattedAttributes:x,template:fe,fieldInfoMap:_})}}_setChartValue(d){const{value:_,attributes:T,formattedAttributes:x,chartType:A,layer:U,expressionAttributes:ne}=d,{popupTemplate:fe,relatedInfos:Oe}=this,{fields:we,normalizeField:Ze}=_;if(_.fields=function O4(d,_){return d&&d.map(T=>Um(T,_))}(we,U),Ze&&(_.normalizeField=Um(Ze,U)),!we.some(lt=>!!(null!=x[lt]||yd(lt)&&Oe.size)))return;const it=fe?.fieldInfos;we.forEach(lt=>{if(yd(lt))return void(_.series=[..._.series,...this._getRelatedChartInfos({fieldInfos:it,fieldName:lt,formattedAttributes:x,chartType:A,value:_})]);const dt=this._getChartOption({value:_,attributes:T,chartType:A,formattedAttributes:x,expressionAttributes:ne,fieldName:lt,fieldInfos:it});_.series.push(dt)})}_getRelatedChartInfos(d){const{fieldInfos:_,fieldName:T,formattedAttributes:x,chartType:A,value:U}=d,ne=[],fe=_M(T),{layerId:Oe,fieldName:we}=fe,Ze=this.relatedInfos?.get(Oe.toString());if(!Ze)return ne;const{relatedFeatures:it,relation:lt}=Ze;if(!lt||!it)return ne;const{cardinality:dt}=lt;return it.forEach(Tt=>{const{attributes:mt}=Tt;mt&&Object.keys(mt).forEach(Mt=>{Mt===we&&ne.push(this._getChartOption({value:U,attributes:mt,formattedAttributes:x,fieldName:T,chartType:A,relatedFieldName:Mt,fieldInfos:_}))})}),"one-to-many"===dt||"many-to-many"===dt?ne:[ne[0]]}_getTooltip({label:d,value:_,chartType:T}){return"pie-chart"===T?`${d}`:`${d}: ${_}`}_getChartOption(d){const{value:_,attributes:T,formattedAttributes:x,expressionAttributes:A,fieldName:U,relatedFieldName:ne,fieldInfos:fe,chartType:Oe}=d,{layer:we,fieldInfoMap:Ze}=this,{normalizeField:it,tooltipField:lt}=_,dt=it?yd(it)?T[_M(it).fieldName]:T[it]:null,Tt=WT(U)&&A&&void 0!==A[U]?A[U]:ne&&void 0!==T[ne]?T[ne]:void 0!==T[U]?T[U]:x[U],mt=new M6.Z({fieldName:U,value:void 0===Tt?null:Tt&&dt?Tt/dt:Tt});if(yd(U)){const Zt=Ze.get(U.toLowerCase()),nr=Ze.get(lt.toLowerCase());return mt.tooltip=this._getTooltip({label:x[nr?.fieldName??lt]??Zt?.label??Zt?.fieldName??ne,value:x[Zt?.fieldName??U],chartType:Oe}),mt}const Mt=GD(fe,U),Pt=Um(U,we),Nt=lt&&void 0!==x[lt]?x[lt]:VD(Mt||new rS.Z({fieldName:Pt}),this.popupTemplate?.expressionInfos);return mt.tooltip=this._getTooltip({label:Nt,value:x[Pt],chartType:Oe}),mt}};(0,Ve._)([(0,ke.Cb)()],ha.prototype,"abilities",void 0),(0,Ve._)([(0,ko.p)("abilities")],ha.prototype,"castAbilities",null),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"activeMediaInfoIndex",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ha.prototype,"activeMediaInfo",null),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"attributes",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"fieldInfoMap",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"formattedAttributes",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"expressionAttributes",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ha.prototype,"formattedMediaInfos",null),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"layer",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ha.prototype,"formattedMediaInfoCount",null),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"mediaInfos",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"popupTemplate",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"relatedInfos",void 0),(0,Ve._)([(0,ke.Cb)()],ha.prototype,"title",void 0),ha=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ha);const Lp=ha;var yS=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],H6=[{name:"default",colors:[].concat(yS.slice(30,39),yS.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],vS=v(56683);const mM=new Map([["ar",()=>v.e(3309).then(v.bind(v,93309)).then(d=>d.a)],["bg-bg",()=>v.e(2504).then(v.bind(v,82504)).then(d=>d.b)],["bs-ba",()=>v.e(88).then(v.bind(v,88)).then(d=>d.b)],["ca-es",()=>v.e(2371).then(v.bind(v,32371)).then(d=>d.c)],["cs-cz",()=>v.e(3690).then(v.bind(v,93690)).then(d=>d.c)],["da-dk",()=>v.e(2125).then(v.bind(v,42125)).then(d=>d.d)],["de-de",()=>v.e(7396).then(v.bind(v,7396)).then(d=>d.d)],["de-ch",()=>v.e(2479).then(v.bind(v,62479)).then(d=>d.d)],["el-gr",()=>v.e(9548).then(v.bind(v,39548)).then(d=>d.e)],["en-us",()=>v.e(700).then(v.bind(v,20700)).then(d=>d.e)],["en-ca",()=>v.e(7028).then(v.bind(v,37028)).then(d=>d.e)],["es-es",()=>v.e(4824).then(v.bind(v,54824)).then(d=>d.e)],["et-ee",()=>v.e(3914).then(v.bind(v,23914)).then(d=>d.e)],["fi-fi",()=>v.e(1299).then(v.bind(v,1299)).then(d=>d.f)],["fr-fr",()=>v.e(9856).then(v.bind(v,39856)).then(d=>d.f)],["he-il",()=>v.e(4609).then(v.bind(v,24609)).then(d=>d.h)],["hr-hr",()=>v.e(7731).then(v.bind(v,87731)).then(d=>d.h)],["hu-hu",()=>v.e(7127).then(v.bind(v,57127)).then(d=>d.h)],["id-id",()=>v.e(6560).then(v.bind(v,36560)).then(d=>d.i)],["it-it",()=>v.e(7708).then(v.bind(v,67708)).then(d=>d.i)],["ja-jp",()=>v.e(6651).then(v.bind(v,36651)).then(d=>d.j)],["ko-kr",()=>v.e(7016).then(v.bind(v,7016)).then(d=>d.k)],["lt-lt",()=>v.e(5010).then(v.bind(v,5010)).then(d=>d.l)],["lv-lv",()=>v.e(2620).then(v.bind(v,92620)).then(d=>d.l)],["nb-no",()=>v.e(5237).then(v.bind(v,55237)).then(d=>d.n)],["nl-nl",()=>v.e(948).then(v.bind(v,948)).then(d=>d.n)],["pl-pl",()=>v.e(8351).then(v.bind(v,58351)).then(d=>d.p)],["pt-br",()=>v.e(6681).then(v.bind(v,86681)).then(d=>d.p)],["pt-pt",()=>v.e(8110).then(v.bind(v,48110)).then(d=>d.p)],["ro-ro",()=>v.e(8372).then(v.bind(v,95058)).then(d=>d.r)],["ru-ru",()=>v.e(8073).then(v.bind(v,88073)).then(d=>d.r)],["sk-sk",()=>v.e(7419).then(v.bind(v,7419)).then(d=>d.s)],["sl-sl",()=>v.e(1218).then(v.bind(v,11218)).then(d=>d.s)],["sr-rs",()=>v.e(5302).then(v.bind(v,85302)).then(d=>d.s)],["sv-se",()=>v.e(6079).then(v.bind(v,86079)).then(d=>d.s)],["th-th",()=>v.e(5508).then(v.bind(v,55508)).then(d=>d.t)],["tr-tr",()=>v.e(6844).then(v.bind(v,56844)).then(d=>d.t)],["uk-ua",()=>v.e(4978).then(v.bind(v,4978)).then(d=>d.u)],["vi-vn",()=>v.e(9202).then(v.bind(v,29202)).then(d=>d.v)],["zh-cn",()=>v.e(865).then(v.bind(v,70865)).then(d=>d.z)],["zh-hk",()=>v.e(3207).then(v.bind(v,3207)).then(d=>d.z)],["zh-tw",()=>v.e(3207).then(v.bind(v,3207)).then(d=>d.z)]]);function K6(d){return d?mM.has(d.toLowerCase())?d.toLowerCase():function G6(d){const _=d.split("-")[0].toLowerCase();let T=null;for(const x of mM.keys())if(x.startsWith(_)){T=x;break}return T}(d)||"en-us":"en-us"}let p_,Wm;function gM(){return(gM=(0,kr.Z)(function*(d=(0,vS.Kd)()){if(d=K6(d),p_&&d===Wm)return p_;p_=v.e(4430).then(v.bind(v,4430)).then(_=>_.i),Wm=d;try{const[_,T]=yield Promise.all([p_,mM.get(Wm)()]);Wm===d&&(_.am4core.options.defaultLocale=T.default),_.am4core.options.suppressWarnings=!0,_.am4core.options.autoDispose=!0}catch{return p_=null,Wm=null,null}return p_})).apply(this,arguments)}const bS="calcite-theme-";function Vm(){return function Y6(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}().startsWith("dark")}const Ao_mediaIcon="esri-feature-media__icon",Ed="color",gh="tooltip",zm="value",CS="default-line-value";let Zl=class extends ua.Z{constructor(d,_){var T;super(d,_),T=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new Lp,this.messages=null,this._getChartDependencies=function(){var x=(0,kr.Z)(function*(A){const U=yield function Z6(){return gM.apply(this,arguments)}(),{destroyed:ne,viewModel:fe}=T;if(ne||!fe||!A)return;const{activeMediaInfo:Oe}=fe,we=yield T._getRendererColors(U);T._renderChart({chartDiv:A,mediaInfo:Oe,chartsModule:U,colorMap:we})});return function(A){return x.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new Bv,this.addHandles([(0,Ht.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),Ht.nn),(0,Ht.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),Ht.nn)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(d){this.viewModel.activeMediaInfoIndex=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(d){this.viewModel.fieldInfoMap=d}get layer(){return this.viewModel.layer}set layer(d){this.viewModel.layer=d}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(d){this.viewModel.mediaInfos=d}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(d){this.viewModel.popupTemplate=d}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(d){this.viewModel.relatedInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){return(0,Yt.u)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:d}=this.viewModel;return d?(0,Yt.u)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(d){const{_refreshIntervalInfo:_}=this,{activeMediaInfoIndex:T,formattedMediaInfoCount:x}=this.viewModel,{value:A,refreshInterval:U,altText:ne,title:fe,type:Oe}=d,{sourceURL:we,linkURL:Ze}=A,it=WD(Ze)?"_blank":"_self",lt="_blank"===it?"noreferrer":"",dt=U?_:null,Mt=(0,Yt.u)("img",{alt:ne||fe,key:`media-${Oe}-${T}-${x}-${dt?dt.timestamp:0}`,src:dt?dt.sourceURL:we});return(Ze?(0,Yt.u)("a",{title:fe,href:Ze,rel:lt,target:it},Mt):null)||Mt}renderChartMediaInfo(d){const{activeMediaInfoIndex:_,formattedMediaInfoCount:T}=this.viewModel;return(0,Yt.u)("div",{key:`media-${d.type}-${_}-${T}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:d}=this.viewModel;return d?"image"===d.type?this.renderImageMediaInfo(d):d.type.includes("chart")?this.renderChartMediaInfo(d):null:null}renderMediaInfo(){const{activeMediaInfo:d}=this.viewModel;if(!d)return null;const _=d.title?(0,Yt.u)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:d.title}):null,T=d.caption?(0,Yt.u)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:d.caption}):null;return(0,Yt.u)("div",{key:"media-container",class:"esri-feature-media__item-container"},(0,Yt.u)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),_,T)}renderMediaPageButton(d){if(this.viewModel.formattedMediaInfoCount<2)return null;const _="previous"===d,T=_?this.messages.previous:this.messages.next,x=this.classes("esri-feature-media__button",_?"esri-feature-media__previous":"esri-feature-media__next"),A=_?this.classes(Ao_mediaIcon,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(Ao_mediaIcon,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),U=_?this.classes(Ao_mediaIcon,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(Ao_mediaIcon,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return(0,Yt.u)("button",{type:"button",key:_?"media-previous":"media-next",title:T,"aria-label":T,tabIndex:0,class:x,bind:this,onclick:_?this._previous:this._next},(0,Yt.u)("span",{"aria-hidden":"true",class:A}),(0,Yt.u)("span",{"aria-hidden":"true",class:U}))}_setupFeatureElementInfo(){const{description:d,title:_}=this;this._featureElementInfo.set({description:d,title:_})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRendererColors(d){var _=this;return(0,kr.Z)(function*(){const{am4core:T}=d,x=new Map,A=_.viewModel?.layer?.renderer;if(!A)return x;const ne=yield function E6(d){return lM.apply(this,arguments)}(A);return ne.delete("default"),Array.from(ne.values()).every(fe=>1===fe?.length)&&(x.set(CS,T.color({r:50,g:50,b:50,a:1})),Array.from(ne.keys()).forEach(fe=>{fe&&x.set(fe,T.color(ne.get(fe)[0].toCss(!0)))})),x})()}_handleMediaKeyup(d){const _=(0,Dp.kK)(d);"ArrowLeft"===_&&(d.stopPropagation(),this.viewModel.previous()),"ArrowRight"===_&&(d.stopPropagation(),this.viewModel.next())}_renderChart(d){const{abilities:_}=this.viewModel,{chartsModule:T,chartDiv:x,mediaInfo:A,colorMap:U}=d,{value:ne,type:fe}=A,{am4core:Oe}=T,we=function $6(d,_="default"){const T=H6.find(x=>x.name===_);return T?T.colors.map(x=>d.color(x)):null}(Oe);Vm()&&Oe.useTheme(T.am4themes_dark);const it=window.matchMedia("(prefers-reduced-motion: reduce)");_.chartAnimation&&!it.matches?Oe.useTheme(T.am4themes_animated):Oe.unuseTheme(T.am4themes_animated),Oe.useTheme(function Ze(dt){dt instanceof Oe.ColorSet&&we&&(dt.list=we)});const lt="pie-chart"===fe?this._createPieChart(d):this._createXYChart(d);x.setAttribute("aria-label",A.altText||A.title),lt.data=ne.series.map(dt=>({[gh]:dt.tooltip,[zm]:dt.value,[Ed]:U.get(dt.fieldName)})).filter(dt=>"pie-chart"!==fe||dt.value>0)}_customizeChartTooltip(d,_){d.label.wrap=!0,d.label.maxWidth=200,d.autoTextColor=!1,d.getFillFromObject=!1,d.label.fill=_.color("#ffffff"),d.background.fill=_.color({r:0,g:0,b:0,a:.7})}_createPieChart(d){const{chartDiv:_,chartsModule:T}=d,{am4core:x,am4charts:A}=T,U=x.create(_,A.PieChart);U.rtl=(0,uo.dZ)(this.container);const ne=U.series.push(new A.PieSeries);return ne.labels.template.disabled=!0,ne.ticks.template.disabled=!0,ne.dataFields.value=zm,ne.dataFields.category=gh,this._customizeChartTooltip(ne.tooltip,x),ne.slices.template.propertyFields.fill=Ed,ne.slices.template.propertyFields.stroke=Ed,U}_getMinSeriesValue(d){let _=0;return d.forEach(T=>_=Math.min(T.value,_)),_}_createColumnChart(d,_){const{chartsModule:T,mediaInfo:x}=_,{value:A}=x,{am4core:U,am4charts:ne}=T,fe=d.xAxes.push(new ne.CategoryAxis);fe.dataFields.category=gh,fe.renderer.labels.template.disabled=!0,this._customizeChartTooltip(fe.tooltip,U),fe.tooltip.events.on("sizechanged",()=>{fe.tooltip.dy=-fe.tooltip.contentHeight});const Oe=d.yAxes.push(new ne.ValueAxis),we=Oe.renderer.labels.template;Oe.renderer.minLabelPosition=.05,Oe.renderer.maxLabelPosition=.95,Oe.min=this._getMinSeriesValue(A.series),this._customizeChartTooltip(Oe.tooltip,U),we.wrap=!0;const Ze=d.series.push(new ne.ColumnSeries);Ze.dataFields.valueY=zm,Ze.dataFields.categoryX=gh,Ze.columns.template.propertyFields.fill=Ed,Ze.columns.template.propertyFields.stroke=Ed,d.cursor=new ne.XYCursor,A.series.length>15&&(d.scrollbarX=new U.Scrollbar)}_createBarChart(d,_){const{chartsModule:T,mediaInfo:x}=_,{value:A}=x,{am4core:U,am4charts:ne}=T,fe=d.yAxes.push(new ne.CategoryAxis);fe.dataFields.category=gh,fe.renderer.inversed=!0,fe.renderer.labels.template.disabled=!0,this._customizeChartTooltip(fe.tooltip,U),fe.tooltip.events.on("sizechanged",()=>{fe.tooltip.dx=fe.tooltip.contentWidth});const Oe=d.xAxes.push(new ne.ValueAxis),we=Oe.renderer.labels.template;Oe.renderer.minLabelPosition=.05,Oe.renderer.maxLabelPosition=.95,Oe.min=this._getMinSeriesValue(A.series),this._customizeChartTooltip(Oe.tooltip,U),we.wrap=!0;const Ze=d.series.push(new ne.ColumnSeries);Ze.dataFields.valueX=zm,Ze.dataFields.categoryY=gh,Ze.columns.template.propertyFields.fill=Ed,Ze.columns.template.propertyFields.stroke=Ed,d.cursor=new ne.XYCursor,A.series.length>15&&(d.scrollbarY=new U.Scrollbar)}_createLineChart(d,_){const{chartsModule:T,mediaInfo:x,colorMap:A}=_,{value:U}=x,{am4core:ne,am4charts:fe}=T,Oe=d.xAxes.push(new fe.CategoryAxis);Oe.dataFields.category=gh,Oe.renderer.labels.template.disabled=!0,this._customizeChartTooltip(Oe.tooltip,ne),Oe.tooltip.events.on("sizechanged",()=>{Oe.tooltip.dy=-Oe.tooltip.contentHeight});const we=d.yAxes.push(new fe.ValueAxis),Ze=we.renderer.labels.template;we.renderer.minLabelPosition=.05,we.renderer.maxLabelPosition=.95,we.min=this._getMinSeriesValue(U.series),this._customizeChartTooltip(we.tooltip,ne),Ze.wrap=!0;const it=d.series.push(new fe.LineSeries);it.dataFields.categoryX=gh,it.dataFields.valueY=zm,it.strokeWidth=1;const lt=A.get(CS);lt&&(it.stroke=lt);const dt=it.bullets.push(new fe.CircleBullet);dt.propertyFields.fill=Ed,dt.propertyFields.stroke=Ed,d.cursor=new fe.XYCursor,U.series.length>15&&(d.scrollbarX=new ne.Scrollbar)}_createXYChart(d){const{chartDiv:_,chartsModule:T,mediaInfo:x}=d,{type:A}=x,{am4core:U,am4charts:ne}=T,fe=U.create(_,ne.XYChart);return fe.rtl=(0,uo.dZ)(this.container),"column-chart"===A&&this._createColumnChart(fe,d),"bar-chart"===A&&this._createBarChart(fe,d),"line-chart"===A&&this._createLineChart(fe,d),fe}_clearMediaRefreshTimer(){const{_refreshTimer:d}=this;d&&(clearTimeout(d),this._refreshTimer=null)}_updateMediaInfoTimestamp(d){const _=Date.now();this._refreshIntervalInfo={timestamp:_,sourceURL:this._getImageSource(d,_)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:d}=this.viewModel;d&&"image"===d.type&&d.refreshInterval&&this._setRefreshTimeout(d)}_setRefreshTimeout(d){const{refreshInterval:_,value:T}=d;if(!_)return;const x=6e4*_;this._updateMediaInfoTimestamp(T.sourceURL);const A=setInterval(()=>{this._updateMediaInfoTimestamp(T.sourceURL)},x);this._refreshTimer=A}_getImageSource(d,_){const T=d.includes("?")?"&":"?",[x,A=""]=d.split("#");return`${x}${T}timestamp=${_}${A?"#":""}${A}`}};(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"attributes",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"activeMediaInfoIndex",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"description",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"fieldInfoMap",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"layer",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"mediaInfos",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"popupTemplate",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"relatedInfos",null),(0,Ve._)([(0,ke.Cb)()],Zl.prototype,"title",null),(0,Ve._)([(0,ke.Cb)({type:Lp})],Zl.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Feature/t9n/Feature")],Zl.prototype,"messages",void 0),Zl=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureMedia")],Zl);const TS=Zl;v(55664),v(55013),v(16615),v(82561);var Q6=v(75484),q6=v(64531),MS=(v(6785),v(501)),e8=v(38159);const t8=["$datastore","$map","$layer","$aggregatedfeatures"],s8=Us.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function i8(d){return"string"==typeof d?Bm(GT(d)):Array.isArray(d)?function n8(d){return`<ul class="esri-widget__list">${d.map(_=>`<li>${"string"==typeof _?Bm(GT(_)):_}</li>`).join("")}</ul>`}(d):"esri.arcade.Dictionary"===d?.declaredClass?function o8(d){return`<table class="esri-widget__table">${d.keys().map(_=>{const T=d.field(_);return`<tr><th>${_}</th><td>${"string"==typeof T?Bm(GT(T)):T}</td></tr>`}).join("")}</table>`}(d):d}function a8({aggregatedFeatures:d,arcadeUtils:_,featureSetVars:T,context:x,viewInfo:A,map:U,graphic:ne,interceptor:fe}){T.forEach(Oe=>{const we=Oe.toLowerCase();if("$map"===we&&(x.vars[we]=_.convertMapToFeatureSetCollection({map:U,spatialReference:A.sr,interceptor:fe})),"$layer"===we&&(x.vars[we]=_.convertFeatureLayerToFeatureSet({layer:ne.sourceLayer,spatialReference:A.sr,interceptor:fe})),"$datastore"===we&&(x.vars[we]=_.convertServiceUrlToWorkspace({url:ne.sourceLayer.url,spatialReference:A.sr,interceptor:fe})),"$aggregatedfeatures"===we){const it=ne.layer,{fields:lt,objectIdField:dt,geometryType:Tt,spatialReference:mt,displayField:Mt}=it,Pt=new lD.default({fields:lt,objectIdField:dt,geometryType:Tt,spatialReference:mt,displayField:Mt,..."feature"===it.type?{templates:it.templates,typeIdField:it.typeIdField,types:it.types}:null,source:d});x.vars[we]=_.convertFeatureLayerToFeatureSet({layer:Pt,spatialReference:A.sr,interceptor:fe})}})}function PS(){return Promise.all([v.e(8592),v.e(4988)]).then(v.bind(v,4988))}function l8(d){return"createQuery"in d&&"queryFeatures"in d}function c8(d){return bM.apply(this,arguments)}function bM(){return(bM=(0,kr.Z)(function*({graphic:d,view:_}){const{isAggregate:T,layer:x}=d;if(!T||!x||"2d"!==_?.type)return[];const A=yield _.whenLayerView(x);if(!l8(A))return[];const U=A.createQuery();U.aggregateIds=[d.getObjectId()];const{features:ne}=yield A.queryFeatures(U);return ne})).apply(this,arguments)}function OS(d){return CM.apply(this,arguments)}function CM(){return(CM=(0,kr.Z)(function*({expressionInfo:d,arcadeUtils:_,interceptor:T,spatialReference:x,map:A,graphic:U,view:ne}){if(!d||!d.expression)return null;const fe=_.createSyntaxTree(d.expression),Oe=t8.filter(dt=>_.hasVariable(fe,dt)),[we]=yield Promise.all([c8({graphic:U,view:ne}),_.loadScriptDependencies(fe,!0,Oe)]),Ze=_.getViewInfo({spatialReference:x}),it=_.createExecContext(U,Ze);it.interceptor=T,it.useAsync=!0,a8({aggregatedFeatures:we,arcadeUtils:_,featureSetVars:Oe,context:it,viewInfo:Ze,map:A,graphic:U,interceptor:T});const lt=_.createFunction(fe,it);return _.executeAsyncFunction(lt,it).catch(dt=>s8.error("arcade-execution-error",{error:dt,graphic:U,expressionInfo:d}))})).apply(this,arguments)}function u8(d){return TM.apply(this,arguments)}function TM(){return(TM=(0,kr.Z)(function*({expressionInfos:d,spatialReference:_,graphic:T,interceptor:x,map:A,view:U}){if(!d||!d.length)return{};const ne=yield PS(),fe={};for(const Ze of d)fe[`expression/${Ze.name}`]=OS({expressionInfo:Ze,arcadeUtils:ne,interceptor:x,spatialReference:_,map:A,graphic:T,view:U});const Oe=yield(0,ws.as)(fe),we={};for(const Ze in Oe)we[Ze]=i8(Oe[Ze].value);return we})).apply(this,arguments)}let pc=class extends((0,Ip.p)(Ns.Z)){constructor(d){var _;super(d),_=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:T}=this;T&&T.abort(),this._abortController=null},this._createVM=()=>{const T=this.contentElement?.type;this.contentElementViewModel?.destroy();const x="fields"===T?new Nv:"media"===T?new Lp:"text"===T?new jv:null;this._set("contentElementViewModel",x)},this._compile=(0,kr.Z)(function*(){_._cancelQuery();const T=new AbortController;_._abortController=T,yield _._compileExpression(),_._abortController===T&&(_._abortController=null)}),this._compileThrottled=c_(this._compile,1,this),this._compileExpression=(0,kr.Z)(function*(){const{expressionInfo:T,graphic:x,interceptor:A,spatialReference:U,map:ne,view:fe,_abortController:Oe}=_;if(!(T&&x&&U&&ne))return void _._set("contentElement",null);const we=yield PS();if(Oe!==_._abortController)return;const Ze=yield OS({arcadeUtils:we,expressionInfo:T,graphic:x,interceptor:A,map:ne,spatialReference:U,view:fe});if(!Ze||"esri.arcade.Dictionary"!==Ze.declaredClass)return void _._set("contentElement",null);const it=yield Ze.castAsJsonAsync(Oe.signal),lt=it?.type,dt="media"===lt?q6.Z.fromJSON(it):"text"===lt?MS.Z.fromJSON(it):"fields"===lt?Q6.Z.fromJSON(it):null;_._set("contentElement",dt)}),this.handles.add([(0,Ht.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Ht.nn),(0,Ht.YP)(()=>[this.contentElement],()=>this._createVM(),Ht.nn)])}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get state(){const{_abortController:d,contentElement:_,contentElementViewModel:T}=this;return d?"loading":_||T?"ready":"disabled"}get map(){return this.view?.map??null}set map(d){this._override("map",d)}};(0,Ve._)([(0,ke.Cb)()],pc.prototype,"_abortController",void 0),(0,Ve._)([(0,ke.Cb)({type:e8.Z})],pc.prototype,"expressionInfo",void 0),(0,Ve._)([(0,ke.Cb)({type:fd.Z})],pc.prototype,"graphic",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],pc.prototype,"contentElement",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],pc.prototype,"contentElementViewModel",void 0),(0,Ve._)([(0,ke.Cb)()],pc.prototype,"interceptor",void 0),(0,Ve._)([(0,ke.Cb)()],pc.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],pc.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],pc.prototype,"map",null),(0,Ve._)([(0,ke.Cb)()],pc.prototype,"view",void 0),pc=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],pc);const MM=pc;let Gv=class extends ua.Z{constructor(d,_){super(d,_),this.viewModel=new MM}initialize(){this.addHandles((0,Ht.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),Ht.nn))}destroy(){this._destroyContentWidget()}renderLoading(){return(0,Yt.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,Yt.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}render(){const{state:d}=this.viewModel;return(0,Yt.u)("div",{class:"esri-feature-expression"},"loading"===d?this.renderLoading():"disabled"===d?null:this._contentWidget?.render())}_destroyContentWidget(){const{_contentWidget:d}=this;d&&(d.viewModel=null,d.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:d,contentElement:_}=this.viewModel,T=_?.type;this._destroyContentWidget();const x=d?"fields"===T?new sS({viewModel:d}):"media"===T?new TS({viewModel:d}):"text"===T?new Fv({viewModel:d}):null:null;this._contentWidget=x,this.scheduleRender()}};(0,Ve._)([(0,ke.Cb)({type:MM})],Gv.prototype,"viewModel",void 0),Gv=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureExpression")],Gv);const h8=Gv;var xS=v(61996);let eo=class extends((0,OD.J)((0,xS.IG)((0,Ip.p)(Ns.Z)))){constructor(d){var _;super(d),_=this,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:T}=this;T&&T.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:T}=this;T&&T.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:T}=this;T&&T.abort(),this._queryPageAbortController=null},this._queryController=(0,kr.Z)(function*(){_._cancelQuery();const T=new AbortController;_._queryAbortController=T,yield(0,ws.R8)(_._query()),_._queryAbortController===T&&(_._queryAbortController=null)}),this._queryFeatureCountController=(0,kr.Z)(function*(){_._cancelQueryFeatureCount();const T=new AbortController;_._queryFeatureCountAbortController=T,yield(0,ws.R8)(_._queryFeatureCount()),_._queryFeatureCountAbortController===T&&(_._queryFeatureCountAbortController=null)}),this._queryPageController=(0,kr.Z)(function*(){const T=new AbortController;_._queryPageAbortController=T,yield(0,ws.R8)(_._queryPage()),_._queryPageAbortController===T&&(_._queryPageAbortController=null)}),this._queryThrottled=c_(this._queryController,100,this),this._queryFeatureCountThrottled=c_(this._queryFeatureCountController,100,this),this._queryPageThrottled=c_(this._queryPageController,100,this),this._query=(0,kr.Z)(function*(){const{_queryAbortController:T,relatedFeatures:x}=_;_._destroyRelatedFeatureViewModels(),_.featurePage=1,x.removeAll(),x.addMany(_._sliceFeatures(yield _._queryRelatedFeatures({signal:T?.signal})))}),this.handles.add([(0,Ht.YP)(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled],()=>this._queryThrottled(),Ht.nn),(0,Ht.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),(0,Ht.YP)(()=>[this.layer,this.relationshipId,this.objectId],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(d){const{featuresPerPage:_,featureCount:T}=this,A=Math.ceil(T/_)||1;this._set("featurePage",Math.min(Math.max(d,1),A))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:d,relatedLayer:_}=this;return d&&_?.loaded?d.map(T=>{const x=T.clone(),A=Um(T.field,_);return x.field=A,x}):d}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing?.[0]?.field||null}set displayCount(d){this._set("displayCount",Math.min(Math.max(d,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return this.graphic?.attributes?.[this.objectIdField]??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new On.Z}get relatedLayer(){const{layer:d,map:_,relationship:T}=this;return d?.loaded?function Z4(d,_,T){return d&&_&&T?kD(d.allLayers,_,T)||kD(d.allTables,_,T):null}(_,d,T):null}get relationship(){const{relationshipId:d,layer:_}=this;return"number"==typeof d?_?.relationships?.find(({id:T})=>T===d)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new On.Z}get state(){const{_queryAbortController:d,_queryFeatureCountAbortController:_,_queryPageAbortController:T,graphic:x,relatedLayer:A}=this;return _?"loading":d||T?"querying":x&&A?"ready":"disabled"}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(d=>!d.destroyed&&d.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var d=this;return(0,kr.Z)(function*(){const{layer:_,relatedLayer:T,relationshipId:x,objectId:A,_queryFeatureCountAbortController:U}=d;if(yield _?.load(),!T||"number"!=typeof A||!_?.capabilities?.queryRelated?.supportsCount)return void d._set("featureCount",0);yield T.load();const ne=T.createQuery(),Oe=new pM.Z({cacheHint:_.capabilities?.queryRelated?.supportsCacheHint??!1,relationshipId:x,returnGeometry:!1,objectIds:[A],where:ne.where}),we=yield _.queryRelatedFeaturesCount(Oe,{signal:U?.signal});d._set("featureCount",we[A]||0)})()}_sliceFeatures(d){const{showAllEnabled:_,displayCount:T}=this;return _?d:T?d.slice(0,T):[]}_queryPage(){var d=this;return(0,kr.Z)(function*(){const{relatedFeatures:_,featurePage:T,showAllEnabled:x,_queryPageAbortController:A}=d;!x||T<2||_.addMany(yield d._queryRelatedFeatures({signal:A?.signal}))})()}_queryRelatedFeatures(d){var _=this;return(0,kr.Z)(function*(){const{orderByFieldsFixedCasing:T,showAllEnabled:x,featuresPerPage:A,displayCount:U,layer:ne,relationshipId:fe,featurePage:Oe,featureCount:we,relatedLayer:Ze}=_;yield ne?.load();const{relationship:it,objectId:lt}=_;if(!it||"number"!=typeof lt||!ne?.capabilities?.queryRelated?.supportsPagination)return[];const dt=x?((Oe-1)*A+we)%we:0,Tt=x?A:U;if(!Ze)return[];yield Ze.load();const mt=Ze.objectIdField,Mt=[...T?.map(Jt=>Jt.field),mt],Pt=T?.map(Jt=>`${Jt.field} ${Jt.order}`),Nt=ne.capabilities?.queryRelated?.supportsCacheHint||!1,Bt=Ze.createQuery(),Zt=new pM.Z({orderByFields:Pt,start:dt,num:Tt,outFields:Mt,cacheHint:Nt,relationshipId:fe,returnGeometry:!1,objectIds:[lt],where:Bt.where}),nr=(yield ne.queryRelatedFeatures(Zt,{signal:d?.signal}))[lt]?.features||[];return nr.forEach(Jt=>Jt.sourceLayer=Ze),nr})()}};(0,Ve._)([(0,ke.Cb)()],eo.prototype,"_queryAbortController",void 0),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"_queryPageAbortController",void 0),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"_queryFeatureCountAbortController",void 0),(0,Ve._)([(0,ke.Cb)({value:1})],eo.prototype,"featurePage",null),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"featuresPerPage",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"orderByFieldsFixedCasing",null),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"itemDescriptionFieldName",null),(0,Ve._)([(0,ke.Cb)({value:3})],eo.prototype,"displayCount",null),(0,Ve._)([(0,ke.Cb)({type:fd.Z})],eo.prototype,"graphic",void 0),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"layer",void 0),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"map",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"objectId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"objectIdField",null),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"orderByFields",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"relatedFeatures",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"relatedLayer",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"relationship",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"featureCount",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"relatedFeatureViewModels",null),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"relationshipId",void 0),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"showAllEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],eo.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],eo.prototype,"title",void 0),eo=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],eo);const OM=eo;var _c=v(97059);const DS={title:!0,description:!0};let Cl=class extends ua.Z{constructor(d,_){super(d,_),this._featureElementInfo=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([T])=>{T?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new OM,this.messages=null,this.messagesCommon=null,this.visibleElements={...DS},this._increaseFeaturePage=()=>{const{state:T,showAllEnabled:x,relatedFeatures:A,featuresPerPage:U,featurePage:ne}=this.viewModel;"ready"===T&&x&&A.length>=U*ne&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Bv,this.addHandles([(0,Ht.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Ht.nn),(0,Ht.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,Ht.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([v.e(9986).then(v.bind(v,79986)),Promise.all([v.e(8592),v.e(4786)]).then(v.bind(v,37591)),v.e(8472).then(v.bind(v,8472)),Promise.all([v.e(8592),v.e(9325)]).then(v.bind(v,9325))])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,Qe.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:d,featureCount:_,displayCount:T}=this.viewModel;return!d&&(_>T||0===T)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get featureCountDescription(){const{messages:d}=this,{featureCount:_}=this.viewModel;return(0,_c.n)(1===_?d?.numberRecord:d?.numberRecords,{number:_})}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}castVisibleElements(d){return{...DS,...d}}renderStickyLoading(){return"querying"===this.viewModel.state?(0,Yt.u)("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null}renderLoadingIcon(){return(0,Yt.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})}renderLoading(){return(0,Yt.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},this.renderLoadingIcon())}renderShowAllIconNode(){return(0,Yt.u)("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const d=(0,uo.dZ)(this.container)?"chevron-left":"chevron-right";return(0,Yt.u)("calcite-icon",{scale:"s",icon:d,slot:"content-end"})}renderRelatedFeature(d){const{itemDescriptionFieldName:_}=this.viewModel,T=d.title;d.description=_&&d.formattedAttributes?.global[_];const x="loading"===d.state;return(0,Yt.u)("calcite-list-item",{key:d.uid,label:x?`${this.messagesCommon?.loading}\u2026`:T,description:x?"\u2026":d.description,onclick:()=>this.emit("select-record",{featureViewModel:d})},this.renderChevronIconNode())}renderShowAllListItem(){return this.displayShowAllButton?(0,Yt.u)("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,onclick:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){return(0,Yt.u)("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,color:"blue",scale:"s",width:"full"},(0,Yt.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}renderFeatureObserver(){return(0,Yt.u)("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:d}=this.viewModel;return(0,Yt.u)("calcite-list",null,d.toArray().map(_=>this.renderRelatedFeature(_)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:d}=this,{state:_}=this.viewModel;return(0,Yt.u)("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{"esri-feature-relationship__list--querying":"querying"===_})},d?this.renderList():"ready"===_?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){return(0,Yt.u)("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,color:"red",scale:"s",width:"full"},(0,Yt.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}render(){const{state:d}=this.viewModel;return(0,Yt.u)("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===d?this.renderLoading():"disabled"===d?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:d}=this.viewModel,_="related-feature-viewmodels";this.removeHandles(_),d?.forEach(T=>{this.addHandles((0,Ht.YP)(()=>[T.title,T.state],()=>this.scheduleRender(),Ht.nn),_)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:d,visibleElements:_}=this;this._featureElementInfo.set({description:_.description&&this.description,title:_.title&&this.title,headingLevel:d})}_handleRelatedFeatureObserverChange(){var d=this;return(0,kr.Z)(function*(){d._unobserveRelatedFeatureObserver();const{state:_,showAllEnabled:T}=d.viewModel;yield(0,ws.e4)(0),d._relatedFeatureIntersectionObserverNode&&"ready"===_&&T&&d._relatedFeatureIntersectionObserver.observe(d._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(d){this._relatedFeatureIntersectionObserverNode=d}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,Ve._)([(0,ke.Cb)()],Cl.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Cl.prototype,"displayShowAllButton",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Cl.prototype,"displayListItems",null),(0,Ve._)([(0,ke.Cb)()],Cl.prototype,"description",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Cl.prototype,"featureCountDescription",null),(0,Ve._)([(0,ke.Cb)()],Cl.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],Cl.prototype,"title",null),(0,Ve._)([(0,ke.Cb)({type:OM})],Cl.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Feature/t9n/Feature")],Cl.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/t9n/common")],Cl.prototype,"messagesCommon",void 0),(0,Ve._)([(0,ke.Cb)()],Cl.prototype,"visibleElements",void 0),(0,Ve._)([(0,ko.p)("visibleElements")],Cl.prototype,"castVisibleElements",null),Cl=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.FeatureRelationship")],Cl);const SS=Cl;var Hm;const AS="content-view-models",RS="relationship-view-models",wS={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let ho=Hm=class extends((0,xS.IG)(Ns.Z)){constructor(d){super(d),this._handles=new Ji.Z,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=c_(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...wS},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=_=>{const{abilities:T}=this;return"attachments"===_.type&&T.attachmentsContent||"custom"===_.type&&T.customContent||"fields"===_.type&&T.fieldsContent||"media"===_.type&&T.mediaContent||"text"===_.type&&T.textContent||"expression"===_.type&&T.expressionContent||"relationship"===_.type&&T.relationshipContent},this._handles.add((0,Ht.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Ht.nn))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return(0,Qe.pC)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function F4(d,_){const T=new Map;return d&&d.forEach(x=>{const A=Um(x.fieldName,_);x.fieldName=A,T.set(A.toLowerCase(),x)}),T}(KD(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return ND(this.graphic)}castAbilities(d){return{...wS,...d}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(d){this._set("graphic",d?d.clone():null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get map(){return this.view?.map||null}set map(d){this._override("map",d)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(d,_){const T=this.contentViewModels[d];T instanceof Lp&&T.setActiveMedia(_)}nextMedia(d){const _=this.contentViewModels[d];_ instanceof Lp&&_.next()}previousMedia(d){const _=this.contentViewModels[d];_ instanceof Lp&&_.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var d=this;return(0,kr.Z)(function*(){d._cancelFeatureQuery(),d._error=null,d._clear();const{graphic:_}=d;if(!_)return;const T=new AbortController;d._featureAbortController=T;try{yield d._queryFeature({signal:T.signal})}catch(x){(0,ws.D_)(x)||(d._error=x,Us.Z.getLogger(d.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:x,graphic:_,popupTemplate:d._effectivePopupTemplate}))}d._featureAbortController===T&&(d._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:d}=this;d&&d.abort(),this._featureAbortController=null}_compileContentElement(d,_){return"attachments"===d.type?this._compileAttachments(d,_):"custom"===d.type?this._compileCustom(d,_):"fields"===d.type?this._compileFields(d,_):"media"===d.type?this._compileMedia(d,_):"text"===d.type?this._compileText(d,_):"expression"===d.type?this._compileExpression(d,_):"relationship"===d.type?this._compileRelationship(d,_):void 0}_compileContent(d){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(d)?d.filter(this._isAllowedContentType).map((_,T)=>this._compileContentElement(_,T)):"string"==typeof d?this._compileText(new MS.Z({text:d}),0).text:d}_destroyContentViewModels(){this._handles?.remove(RS),this._handles?.remove(AS),this.contentViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("contentViewModels",[])}_matchesFeature(d,_){const T=d?.graphic?.getObjectId(),x=_?.getObjectId();return(0,Qe.pC)(T)&&(0,Qe.pC)(x)&&T===x}_setRelatedFeaturesViewModels({relatedFeatureViewModels:d,relatedFeatures:_,map:T}){_?.filter(Boolean).forEach(x=>{d.find(A=>this._matchesFeature(A,x))||d.add(new Hm({abilities:{relationshipContent:!1},map:T,graphic:x}))}),d.forEach(x=>{_?.find(U=>this._matchesFeature(x,U))||d.remove(x)})}_setExpressionContentVM(d,_){const{formattedAttributes:T}=this,{contentElement:x,contentElementViewModel:A}=d,U=x?.type;A&&U&&("fields"===U&&(this._createFieldsFormattedAttributes({contentElement:x,contentElementIndex:_,formattedAttributes:T}),A.set(this._createFieldsVMParams(x,_))),"media"===U&&(this._createMediaFormattedAttributes({contentElement:x,contentElementIndex:_,formattedAttributes:T}),A.set(this._createMediaVMParams(x,_))),"text"===U&&A.set(this._createTextVMParams(x)))}_compileRelationship(d,_){const{displayCount:T,orderByFields:x,relationshipId:A,title:U,description:ne}=d,{_sourceLayer:fe,graphic:Oe,map:we}=this,Ze=new OM({displayCount:T,graphic:Oe,orderByFields:x,relationshipId:A,layer:fe,map:we,...this._compileTitleAndDesc({title:U,description:ne})});return this.contentViewModels[_]=Ze,this._handles.add((0,Ht.on)(()=>Ze.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(Ze)),RS),d}_compileExpression(d,_){const{expressionInfo:T}=d,{graphic:x,map:A,spatialReference:U,view:ne}=this,fe=new MM({expressionInfo:T,graphic:x,interceptor:Hm.interceptor,map:A,spatialReference:U,view:ne});return this.contentViewModels[_]=fe,this._handles.add((0,Ht.YP)(()=>fe.contentElementViewModel,()=>this._setExpressionContentVM(fe,_),Ht.nn),AS),d}_compileAttachments(d,_){const{graphic:T}=this,{description:x,title:A}=d;return this.contentViewModels[_]=new JT({graphic:T,...this._compileTitleAndDesc({title:A,description:x})}),d}_compileCustom(d,_){const{graphic:T}=this,{creator:x,destroyer:A}=d;return this.contentViewModels[_]=new jv({graphic:T,creator:x,destroyer:A}),d}_compileTitleAndDesc({title:d,description:_}){const{_fieldInfoMap:T,_sourceLayer:x,graphic:A,formattedAttributes:U,_expressionAttributes:ne}=this,{attributes:fe}=A,Oe=U.global;return{title:Rp({attributes:fe,fieldInfoMap:T,globalAttributes:Oe,expressionAttributes:ne,layer:x,text:d}),description:Rp({attributes:fe,fieldInfoMap:T,globalAttributes:Oe,expressionAttributes:ne,layer:x,text:_})}}_createFieldsVMParams(d,_){const{_effectivePopupTemplate:T,formattedAttributes:x}=this,A={...x.global,...x.content[_]},U=(d?.fieldInfos||T?.fieldInfos)?.filter(({fieldName:we})=>WT(we)||yd(we)||A.hasOwnProperty(we)),ne=T?.expressionInfos,{description:fe,title:Oe}=d;return{attributes:A,expressionInfos:ne,fieldInfos:U,...this._compileTitleAndDesc({title:Oe,description:fe})}}_compileFields(d,_){const T=d.clone(),x=new Nv(this._createFieldsVMParams(d,_));return this.contentViewModels[_]=x,T.fieldInfos=x.formattedFieldInfos.slice(0),T}_createMediaVMParams(d,_){const{abilities:T,graphic:x,_fieldInfoMap:A,formattedAttributes:U,_effectivePopupTemplate:ne,relatedInfos:fe,_sourceLayer:Oe,_expressionAttributes:we}=this,{attributes:Ze}=x,{description:it,mediaInfos:lt,title:dt}=d;return{abilities:{chartAnimation:T.chartAnimation},activeMediaInfoIndex:d.activeMediaInfoIndex||0,attributes:Ze,layer:Oe,fieldInfoMap:A,formattedAttributes:{...U.global,...U.content[_]},expressionAttributes:we,mediaInfos:lt,popupTemplate:ne,relatedInfos:fe,...this._compileTitleAndDesc({title:dt,description:it})}}_compileMedia(d,_){const T=d.clone(),x=new Lp(this._createMediaVMParams(d,_));return T.mediaInfos=x.formattedMediaInfos.slice(0),this.contentViewModels[_]=x,T}_createTextVMParams(d){const{graphic:_,_fieldInfoMap:T,_sourceLayer:x,_expressionAttributes:A}=this;if(d&&d.text){const{attributes:U}=_;d.text=Rp({attributes:U,fieldInfoMap:T,globalAttributes:this.formattedAttributes.global,expressionAttributes:A,layer:x,text:d.text})}return{graphic:_,creator:d.text}}_compileText(d,_){const T=d.clone();return this.contentViewModels[_]=new jv(this._createTextVMParams(T)),T}_compileLastEditInfo(){const{_effectivePopupTemplate:d,_sourceLayer:_,graphic:T}=this;if(!d)return;const{lastEditInfoEnabled:x}=d,A=_?.editFieldsInfo;return x&&A?function j4(d,_){const{creatorField:T,creationDateField:x,editorField:A,editDateField:U}=d;if(!_)return;const ne=_[U];if("number"==typeof ne){const Oe=_[A];return{type:"edit",date:(0,Ap.p6)(ne,FT),user:Oe}}const fe=_[x];if("number"==typeof fe){const Oe=_[T];return{type:"create",date:(0,Ap.p6)(fe,FT),user:Oe}}return null}(A,T.attributes):void 0}_compileTitle(d){const{_fieldInfoMap:_,_sourceLayer:T,graphic:x,_expressionAttributes:A}=this,{attributes:U}=x;return Rp({attributes:U,fieldInfoMap:_,globalAttributes:this.formattedAttributes.global,expressionAttributes:A,layer:T,text:d})}_getTitle(){var d=this;return(0,kr.Z)(function*(){const{_effectivePopupTemplate:_,graphic:T}=d,x=_?.title;return Lv(x,{graphic:T})})()}_getContent(){var d=this;return(0,kr.Z)(function*(){const{_effectivePopupTemplate:_,graphic:T}=d,x=_?.content;return Lv(x,{graphic:T})})()}_queryFeature(d){var _=this;return(0,kr.Z)(function*(){const{_featureAbortController:T,_sourceLayer:x,graphic:A,_effectivePopupTemplate:U,spatialReference:ne,map:fe,view:Oe}=_;if(T!==_._featureAbortController||!A)return;yield function V4(d,_){return YT.apply(this,arguments)}({graphic:A,popupTemplate:U,layer:x,spatialReference:ne},d);const{content:{value:we},title:{value:Ze}}=yield(0,ws.as)({content:_._getContent(),title:_._getTitle()}),{expressionAttributes:{value:it}}=yield(0,ws.as)({checkForRelatedFeatures:_._checkForRelatedFeatures(d),expressionAttributes:u8({expressionInfos:U?.expressionInfos,spatialReference:ne,graphic:A,map:fe,interceptor:Hm.interceptor,view:Oe})});T===_._featureAbortController&&A&&(_._expressionAttributes=it,_._graphicExpressionAttributes={...A.attributes,...it},_._set("formattedAttributes",_._createFormattedAttributes(we)),_._set("title",_._compileTitle(Ze)),_._set("lastEditInfo",_._compileLastEditInfo()||null),_._set("content",_._compileContent(we)||null))})()}_createMediaFormattedAttributes({contentElement:d,contentElementIndex:_,formattedAttributes:T}){const{_effectivePopupTemplate:x,graphic:A,relatedInfos:U,_sourceLayer:ne,_fieldInfoMap:fe,_graphicExpressionAttributes:Oe}=this;T.content[_]=KT({fieldInfos:x?.fieldInfos,graphic:A,attributes:{...Oe,...d.attributes},layer:ne,fieldInfoMap:fe,relatedInfos:U})}_createFieldsFormattedAttributes({contentElement:d,contentElementIndex:_,formattedAttributes:T}){if(d.fieldInfos){const{graphic:x,relatedInfos:A,_sourceLayer:U,_fieldInfoMap:ne,_graphicExpressionAttributes:fe}=this;T.content[_]=KT({fieldInfos:d.fieldInfos,graphic:x,attributes:{...fe,...d.attributes},layer:U,fieldInfoMap:ne,relatedInfos:A})}}_createFormattedAttributes(d){const{_effectivePopupTemplate:_,graphic:T,relatedInfos:x,_sourceLayer:A,_fieldInfoMap:U,_graphicExpressionAttributes:ne}=this,fe=_?.fieldInfos,Oe={global:KT({fieldInfos:fe,graphic:T,attributes:ne,layer:A,fieldInfoMap:U,relatedInfos:x}),content:[]};return Array.isArray(d)&&d.forEach((we,Ze)=>{"fields"===we.type&&this._createFieldsFormattedAttributes({contentElement:we,contentElementIndex:Ze,formattedAttributes:Oe}),"media"===we.type&&this._createMediaFormattedAttributes({contentElement:we,contentElementIndex:Ze,formattedAttributes:Oe})}),Oe}_checkForRelatedFeatures(d){const{graphic:_,_effectivePopupTemplate:T}=this;return this._queryRelatedInfos(_,KD(T),d)}_queryRelatedInfos(d,_,T){var x=this;return(0,kr.Z)(function*(){const{relatedInfos:A,_sourceLayer:U}=x;A.clear();const ne=(0,Qe.pC)(U.associatedLayer)?yield U.associatedLayer.load(T):U;if(!ne)return;const fe=_.filter(Ze=>Ze&&yd(Ze.fieldName));if(!fe||!fe.length)return;_.forEach(Ze=>x._configureRelatedInfo(Ze,ne));const Oe=yield function F6({relatedInfos:d,layer:_},T){const x={};return d.forEach((A,U)=>{const{relation:ne}=A;if(!ne){const it=new ai.Z("relation-required","A relation is required on a layer to retrieve related records.");throw fS.error(it),it}const{relatedTableId:fe}=ne;if("number"!=typeof fe){const it=new ai.Z("A related table ID is required on a layer to retrieve related records.");throw fS.error(it),it}const Oe=`${_.url}/${fe}`,we=mS.get(Oe),Ze=we||function j6(d,_){return(0,cM.default)(d,{query:{f:"json"},signal:_&&_.signal})}(Oe,T);we||mS.set(Oe,Ze),x[U]=Ze}),(0,ws.as)(x)}({relatedInfos:A,layer:ne},T);Object.keys(Oe).forEach(Ze=>{const it=A.get(Ze.toString()),lt=Oe[Ze]?.value;it&&lt&&(it.layerInfo=lt.data)});const we=yield function N6({graphic:d,relatedInfos:_,layer:T},x){const A={};return _.forEach((U,ne)=>{U.layerInfo&&(A[ne]=function B6(d,_,T,x){return fM.apply(this,arguments)}(d,U,T,x))}),(0,ws.as)(A)}({graphic:d,relatedInfos:A,layer:ne},T);Object.keys(we).forEach(Ze=>{!function I6(d,_){if(!_||!d)return;const{features:T,statsFeatures:x}=d,A=T&&T.value;_.relatedFeatures=A?A.features:[];const U=x&&x.value;_.relatedStatsFeatures=U?U.features:[]}(we[Ze]?.value,A.get(Ze.toString()))})})()}_configureRelatedInfo(d,_){const{relatedInfos:T}=this,x=_M(d.fieldName);if(!x)return;const{layerId:A,fieldName:U}=x;if(!A)return;const ne=T.get(A.toString())||function w6(d,_){const T=function S6(d,_){if(!_.relationships)return null;let T=null;const{relationships:x}=_;return x.some(A=>A.id===parseInt(d,10)&&(T=A,!0)),T}(d,_);if(T)return{url:`${_.url}/${T.relatedTableId}`,sourceSpatialReference:_.spatialReference,relation:T,relatedFields:[],outStatistics:[]}}(A,_);ne&&(function W6({relatedInfo:d,fieldName:_,fieldInfo:T}){if(d.relatedFields.push(_),T.statisticType){const x=new x6.Z({statisticType:T.statisticType,onStatisticField:_,outStatisticFieldName:_});d.outStatistics.push(x)}}({relatedInfo:ne,fieldName:U,fieldInfo:d}),this.relatedInfos.set(A,ne))}};ho.interceptor=new class p8{constructor(_,T){this.preLayerQueryCallback=_,this.preRequestCallback=T,this.preLayerQueryCallback||(this.preLayerQueryCallback=x=>{}),this.preRequestCallback||(this.preLayerQueryCallback=x=>{})}}(({query:d,layer:_,method:T})=>{XD({layer:_,method:T,query:d,definitionExpression:`${_.definitionExpression} ${_.serviceDefinitionExpression}`})},({queryPayload:d,layer:_,method:T})=>{XD({layer:_,method:T,query:d,definitionExpression:`${_.definitionExpression} ${_.serviceDefinitionExpression}`})}),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"_error",void 0),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"_featureAbortController",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"_effectivePopupTemplate",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"_fieldInfoMap",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"_sourceLayer",null),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"abilities",void 0),(0,Ve._)([(0,ko.p)("abilities")],ho.prototype,"castAbilities",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"content",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"contentViewModels",void 0),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"description",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],ho.prototype,"defaultPopupTemplateEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"state",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"formattedAttributes",void 0),(0,Ve._)([(0,ke.Cb)({type:fd.Z,value:null})],ho.prototype,"graphic",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"lastEditInfo",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"relatedInfos",void 0),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"title",void 0),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"map",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ho.prototype,"waitingForContent",null),(0,Ve._)([(0,ke.Cb)()],ho.prototype,"view",void 0),ho=Hm=(0,Ve._)([(0,Wr.j)("esri.widgets.FeatureViewModel")],ho);const xM=ho,bo_contentNode="esri-feature__content-node",bo_contentElement="esri-feature__content-element",IS=d=>{let _=class extends d{constructor(){super(...arguments),this.renderNodeContent=T=>(0,qT.Qd)(T)&&!T.destroyed?(0,Yt.u)("div",{class:bo_contentNode,key:T},T.render()):T instanceof HTMLElement?(0,Yt.u)("div",{class:bo_contentNode,key:T,bind:T,afterCreate:this._attachToNode}):(0,qT.o)(T)?(0,Yt.u)("div",{class:bo_contentNode,key:T,bind:T.domNode,afterCreate:this._attachToNode}):null}_attachToNode(T){T.appendChild(this)}};return _=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature.ContentMixin")],_),_};var DM;const LS={title:!0,content:!0,lastEditedInfo:!0},US="relationship-handles";let Da=DM=class extends(IS(ua.Z)){constructor(d,_){super(d,_),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...LS},this.viewModel=new xM}initialize(){this.addHandles((0,Ht.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),Ht.nn))}loadDependencies(){return Promise.all([v.e(8592),v.e(9325)]).then(v.bind(v,9325))}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(d){this.viewModel.spatialReference=d}get title(){return this.viewModel.title}castVisibleElements(d){return{...LS,...d}}get map(){return this.viewModel.map}set map(d){this.viewModel.map=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}render(){const{state:d}=this.viewModel,_=(0,Yt.u)("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===d?this.renderError():"loading"===d?this.renderLoading():this.renderContentContainer());return(0,Yt.u)("div",{class:this.classes("esri-feature","esri-widget")},_)}setActiveMedia(d,_){return this.viewModel.setActiveMedia(d,_)}nextMedia(d){return this.viewModel.nextMedia(d)}previousMedia(d){return this.viewModel.previousMedia(d)}renderError(){const{messagesCommon:d,messages:_,visibleElements:T}=this;return(0,Yt.u)("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},T.title?(0,Yt.u)("div",{key:"error-title",slot:"title"},d.errorMessage):null,(0,Yt.u)("div",{key:"error-message",slot:"message"},_.loadingError))}renderLoading(){return(0,Yt.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,Yt.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:d}=this;return d.content?(0,Yt.u)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:d,title:_}=this;return d.title?(0,Yt.u)(wp,{level:this.headingLevel,class:"esri-feature__title",innerHTML:_}):null}renderContent(){const d=this.viewModel.content,_="content";if(!d)return null;if(Array.isArray(d))return d.length?(0,Yt.u)("div",{class:bo_contentNode,key:`${_}-content-elements`},d.map(this.renderContentElement,this)):null;if("string"==typeof d){const T=this._contentWidgets[0];return!T||T.destroyed?null:(0,Yt.u)("div",{class:bo_contentNode,key:`${_}-content`},T.render())}return this.renderNodeContent(d)}renderContentElement(d,_){const{visibleElements:T}=this;if("boolean"!=typeof T.content&&!T.content[d.type])return null;switch(d.type){case"attachments":return this.renderAttachments(_);case"custom":return this.renderCustom(d,_);case"fields":return this.renderFields(_);case"media":return this.renderMedia(_);case"text":return this.renderText(d,_);case"expression":return this.renderExpression(_);case"relationship":return this.renderRelationship(_);default:return null}}renderAttachments(d){const _=this._contentWidgets[d];if(!_||_.destroyed)return null;const{state:T,attachmentInfos:x}=_.viewModel;return"loading"===T||x.length>0?(0,Yt.u)("div",{key:this._buildKey("attachments-element",d),class:this.classes(bo_contentElement)},_.render()):null}renderRelationship(d){const _=this._contentWidgets[d];return _&&!_.destroyed&&this.flowItems?(0,Yt.u)("div",{key:this._buildKey("relationship-element",d),class:bo_contentElement},_.render()):null}renderExpression(d){const _=this._contentWidgets[d];return!_||_.destroyed?null:(0,Yt.u)("div",{key:this._buildKey("expression-element",d),class:bo_contentElement},_.render())}renderCustom(d,_){const{creator:T}=d,x=this._contentWidgets[_];return!x||x.destroyed?null:T?(0,Yt.u)("div",{key:this._buildKey("custom-element",_),class:bo_contentElement},x.render()):null}renderFields(d){const _=this._contentWidgets[d];return!_||_.destroyed?null:(0,Yt.u)("div",{key:this._buildKey("fields-element",d),class:bo_contentElement},_.render())}renderMedia(d){const _=this._contentWidgets[d];return!_||_.destroyed?null:(0,Yt.u)("div",{key:this._buildKey("media-element",d),class:bo_contentElement},_.render())}renderLastEditInfo(){const{visibleElements:d,messages:_}=this,{lastEditInfo:T}=this.viewModel;if(!T||!d.lastEditedInfo)return null;const{date:x,user:A}=T,ne=(0,_c.n)("edit"===T.type?A?_.lastEditedByUser:_.lastEdited:A?_.lastCreatedByUser:_.lastCreated,{date:x,user:A});return(0,Yt.u)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",bo_contentElement)},ne)}renderText(d,_){const x=this._contentWidgets[_];return!x||x.destroyed?null:d.text?(0,Yt.u)("div",{key:this._buildKey("text-element",_),class:this.classes(bo_contentElement,"esri-feature__text")},x.render()):null}_buildKey(d,..._){return`${d}__${this.get("viewModel.graphic.uid")||"0"}-${_.join("-")}`}_destroyContentWidget(d){d&&(d.viewModel=null,!d.destroyed&&d.destroy())}_destroyContentWidgets(){this.removeHandles(US),this._contentWidgets.forEach(d=>this._destroyContentWidget(d)),this._contentWidgets=[]}_addFeatureRelationshipHandles(d){const{flowItems:_,visibleElements:T}=this;this.addHandles([(0,Ht.on)(()=>d,"select-record",({featureViewModel:x})=>{_&&(x.abilities={relationshipContent:!0},_.push(new DM({flowItems:_,viewModel:x,visibleElements:T})))}),(0,Ht.on)(()=>d,"show-all-records",()=>{if(!_)return;const{viewModel:x}=d;x.showAllEnabled=!0;const A=new SS({visibleElements:{title:!1,description:!1},viewModel:x});this._addFeatureRelationshipHandles(A),_.push(A)})],US)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:d,visibleElements:_}=this,T=this.get("viewModel.content"),{contentViewModels:x}=this.viewModel;if(Array.isArray(T))T.forEach((A,U)=>{if("attachments"===A.type&&(this._contentWidgets[U]=new Q4({displayType:A.displayType,headingLevel:_.title?d+1:d,viewModel:x[U]})),"fields"===A.type&&(this._contentWidgets[U]=new sS({viewModel:x[U]})),"media"===A.type&&(this._contentWidgets[U]=new TS({viewModel:x[U]})),"text"===A.type&&(this._contentWidgets[U]=new Fv({viewModel:x[U]})),"custom"===A.type&&(this._contentWidgets[U]=new Fv({viewModel:x[U]})),"expression"===A.type&&(this._contentWidgets[U]=new h8({viewModel:x[U]})),"relationship"===A.type){const ne=new SS({viewModel:x[U]});this._addFeatureRelationshipHandles(ne),this._contentWidgets[U]=ne}},this);else{const A=x[0];A&&!A.destroyed&&(this._contentWidgets[0]=new Fv({viewModel:A}))}this.scheduleRender()}};(0,Ve._)([(0,ke.Cb)()],Da.prototype,"graphic",null),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"defaultPopupTemplateEnabled",null),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"flowItems",void 0),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"label",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Feature/t9n/Feature")],Da.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/t9n/common")],Da.prototype,"messagesCommon",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/support/t9n/uriUtils")],Da.prototype,"messagesURIUtils",void 0),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Da.prototype,"title",null),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"visibleElements",void 0),(0,Ve._)([(0,ko.p)("visibleElements")],Da.prototype,"castVisibleElements",null),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"map",null),(0,Ve._)([(0,ke.Cb)()],Da.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:xM})],Da.prototype,"viewModel",void 0),Da=DM=(0,Ve._)([(0,Wr.j)("esri.widgets.Feature")],Da);const f8=Da;var BS;const Kv=Symbol("anchorHandles");let Up=class extends Va.Z.EventedAccessor{constructor(d){super(d),this[BS]=new Ji.Z,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[Kv].add([(0,Ht.gx)(()=>(0,Qe.yw)(this.screenLocationEnabled?this.view:null,_=>[_.size,"3d"===_.type?_.camera:_.viewpoint]),()=>this.notifyChange("screenLocation")),(0,Ht.YP)(()=>this.screenLocation,(_,T)=>{(0,Qe.pC)(_)&&(0,Qe.pC)(T)&&this.emit("view-change")})])}destroy(){this.view=null,this[Kv]=(0,Qe.SC)(this[Kv])}get screenLocation(){const{location:d,view:_,screenLocationEnabled:T}=this;return T&&(0,Qe.pC)(d)&&(0,Qe.pC)(_)&&_.ready?_.toScreen(d):null}};BS=Kv,(0,Ve._)([(0,ke.Cb)()],Up.prototype,"location",void 0),(0,Ve._)([(0,ke.Cb)()],Up.prototype,"screenLocation",null),(0,Ve._)([(0,ke.Cb)()],Up.prototype,"screenLocationEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],Up.prototype,"view",void 0),Up=(0,Ve._)([(0,Wr.j)("esri.widgets.support.AnchorElementViewModel")],Up);const jS=Up;let Zv=class extends jS{constructor(d){super(d),this.visible=!1}};(0,Ve._)([(0,ke.Cb)()],Zv.prototype,"visible",void 0),Zv=(0,Ve._)([(0,Wr.j)("esri.widgets.CompassViewModel")],Zv);const FS=Zv;let Bp=class extends ua.Z{constructor(d,_){super(d,_),this._animationDelay=500,this._animationPromise=null,this.viewModel=new FS}initialize(){this.addHandles((0,Ht.YP)(()=>this.visible,d=>this._visibleChange(d)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}show(d){const{location:_,promise:T}=d;_&&(this.viewModel.location=_),this.visible=!0,T&&T.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:d}=this,{screenLocation:_}=this.viewModel,T=!!_,U={"esri-spinner--start":d&&T,"esri-spinner--finish":!d&&T},ne=this._getPositionStyles();return(0,Yt.u)("div",{class:this.classes("esri-spinner",U),styles:ne})}_visibleChange(d){if(d)return void(this.viewModel.screenLocationEnabled=!0);const _=(0,ws.e4)(this._animationDelay);this._animationPromise=_,_.catch(()=>{}).then(()=>{this._animationPromise===_&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:d,view:_}=this.viewModel;if((0,Qe.Wi)(_)||(0,Qe.Wi)(d))return{};const{padding:T}=_;return{left:d.x-T.left+"px",top:d.y-T.top+"px"}}};(0,Ve._)([(0,ke.Cb)()],Bp.prototype,"location",null),(0,Ve._)([(0,ke.Cb)()],Bp.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:FS})],Bp.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)()],Bp.prototype,"visible",null),Bp=(0,Ve._)([(0,Wr.j)("esri.widgets.Spinner")],Bp);const g8=Bp;var au=v(46367),NS=v(44917),y8=v(59397),Gm=v(48753),v8=v(10671),$v=v(74741),WS=v(71131),VS=v(34057);let __=null;const zS=[255,255,255];function HS(d,_){return Math.floor(Math.random()*(_-d+1)+d)}function jp(d,_={}){const A="horizontal"===_.align,U=A?75:24,ne=A?24:75,{width:fe=U,height:Oe=ne,gradient:we=!0}=_,Ze=window.devicePixelRatio,it=fe*Ze,lt=Oe*Ze,dt=document.createElement("canvas");dt.width=it,dt.height=lt,dt.style.width=`${fe}px`,dt.style.height=`${Oe}px`;const Tt=dt.getContext("2d");if(we){const Nt=Tt.createLinearGradient(0,0,A?it:0,A?0:lt),Bt=d.length,Zt=1===Bt?0:1/(Bt-1);d.forEach((nr,Jt)=>Nt.addColorStop(Jt*Zt,nr.toString())),Tt.fillStyle=Nt,Tt.fillRect(0,0,it,lt)}else{const Nt=A?it/d.length:it,Bt=A?lt:lt/d.length;let Zt=0,nr=0;for(const Jt of d)Tt.fillStyle=Jt.toString(),Tt.fillRect(Zt,nr,Nt,Bt),Zt=A?Zt+Nt:0,nr=A?0:nr+Bt}const Pt=document.createElement("div");return Pt.style.width=`${fe}px`,Pt.style.height=`${Oe}px`,function C8(d,_){if(!_)return;d.style.filter=(0,da.wJ)(_);const T=_.effects;if(T)for(const x of T)if("drop-shadow"===x?.type){x.offsetX<0?d.style.marginLeft=`${Math.abs(x.offsetX)}px`:d.style.marginRight=`${x.offsetX}px`;break}}(Pt,_?.effectList),Pt.appendChild(dt),Pt}function GS(d,_){return AM.apply(this,arguments)}function AM(){return(AM=(0,kr.Z)(function*(d,_){switch(d.type){case"web-style":{const{previewWebStyleSymbol:T}=yield v.e(8704).then(v.bind(v,38704));return T(d,GS,_)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:T}=yield Promise.resolve().then(v.bind(v,66960));return T(d,_)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:T}=yield v.e(7755).then(v.bind(v,67755));return T(d,_)}case"cim":{const{previewCIMSymbol:T}=yield Promise.all([v.e(3751),v.e(3678),v.e(8899),v.e(7313)]).then(v.bind(v,27313));return T(d,_)}default:return}})).apply(this,arguments)}function RM(d){return d&&"opacity"in d?d.opacity*RM(d.parent):1}function wM(){return(wM=(0,kr.Z)(function*(d,_){if(!d)return;const T=d.sourceLayer,x=((0,Qe.pC)(_)&&_.useSourceLayer?T:d.layer)??T,A=RM(x);if((0,Qe.pC)(d.symbol)&&(!(0,Qe.pC)(_)||!0!==_.ignoreGraphicSymbol)){const Mt="web-style"===d.symbol.type?yield d.symbol.fetchSymbol({..._,cache:(0,Qe.pC)(_)?_.webStyleCache:null}):d.symbol.clone();return(0,da.tb)(Mt,null,A),Mt}const U=((0,Qe.pC)(_)?_.renderer:null)??(x&&"renderer"in x?x.renderer:null);let ne=U&&"getSymbolAsync"in U?yield U.getSymbolAsync(d,_):null;if(!ne)return;if(ne="web-style"===ne.type?yield ne.fetchSymbol({..._,cache:(0,Qe.pC)(_)?_.webStyleCache:null}):ne.clone(),!(U&&"visualVariables"in U&&U.visualVariables&&U.visualVariables.length))return(0,da.tb)(ne,null,A),ne;if("arcadeRequiredForVisualVariables"in U&&U.arcadeRequiredForVisualVariables&&((0,Qe.Wi)(_)||(0,Qe.Wi)(_.arcade))){const Mt={...(0,Qe.Wg)(_)};Mt.arcade=yield(0,UD.LC)(),_=Mt}const fe=yield Promise.resolve().then(v.bind(v,81808)),Oe=[],we=[],Ze=[],it=[];for(const Mt of U.visualVariables)switch(Mt.type){case"color":Oe.push(Mt);break;case"opacity":we.push(Mt);break;case"rotation":it.push(Mt);break;case"size":Mt.target||Ze.push(Mt)}const lt=!!Oe.length&&Oe[Oe.length-1],dt=lt?fe.getColor(lt,d,_):null,Tt=!!we.length&&we[we.length-1];let mt=Tt?fe.getOpacity(Tt,d,_):null;if(null!=A&&(mt=null!=mt?mt*A:A),(0,da.tb)(ne,dt,mt),Ze.length){const Mt=fe.getAllSizes(Ze,d,_);yield(0,da.e3)(ne,Mt)}for(const Mt of it)(0,da.BR)(ne,fe.getRotationAngle(Mt,d,_),Mt.axis);return ne})).apply(this,arguments)}var Km=v(18547),LM=v(93579);const Yv_iconZoom="esri-icon-zoom-in-magnifying-glass",yh=new Gm.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:Yv_iconZoom}),UM=new Gm.Z({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Fp=new Gm.Z({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Yv_iconZoom}),Np=new Gm.Z({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),Xv=Us.Z.getLogger("esri.widgets.Popup.PopupViewModel"),P8=d=>{const{event:_,view:T}=d,{action:x}=_,A=T&&T.popup;if(!x)return Promise.reject(new ai.Z("trigger-action:missing-arguments","Event has no action"));if(!A)return Promise.reject(new ai.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:U,id:ne}=x;if(!ne)return Promise.reject(new ai.Z("trigger-action:invalid-action","action.id is missing"));if(U)return Promise.reject(new ai.Z("trigger-action:invalid-action","Action is disabled"));if(ne===yh.id)return function x8(d){return jM.apply(this,arguments)}(A.viewModel).catch(ws.H9);if(ne===Fp.id)return function D8(d){return FM.apply(this,arguments)}(A.viewModel);if(ne===Np.id)return A.featureMenuOpen=!A.featureMenuOpen,A.viewModel.browseClusterEnabled=!A.viewModel.browseClusterEnabled,Promise.resolve();if(A.viewModel.browseClusterEnabled=!1,ne===UM.id){A.close();const{selectedFeature:fe}=A;if(!fe)return Promise.reject(new ai.Z(`trigger-action:${UM.id}`,"selectedFeature is required",{selectedFeature:fe}));const{sourceLayer:Oe}=fe;return Oe?Oe.remove(fe):T.graphics.remove(fe),Promise.resolve()}return Promise.resolve()};function KS(d){const{selectedFeature:_,location:T,view:x}=d;return x?"3d"===x.type?_||T:d.get("selectedFeature.geometry")||T:null}function Wp(d){return d?.isAggregate&&"cluster"===d?.sourceLayer?.featureReduction?.type}function O8(d,_){return BM.apply(this,arguments)}function BM(){return(BM=(0,kr.Z)(function*(d,_){if("3d"!==_?.type||!d||"esri.Graphic"!==d.declaredClass)return!0;const T=_.getViewForGraphic(d);if(T&&"whenGraphicBounds"in T){let x;try{x=yield T.whenGraphicBounds(d,{useViewElevation:!0})}catch{}return!x||!x.boundingBox||x.boundingBox[0]===x.boundingBox[3]&&x.boundingBox[1]===x.boundingBox[4]&&x.boundingBox[2]===x.boundingBox[5]}return!0})).apply(this,arguments)}function jM(){return(jM=(0,kr.Z)(function*(d){const{location:_,selectedFeature:T,view:x,zoomFactor:A}=d,U=KS(d);if(!U){const we=new ai.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:U,view:x});throw Xv.error(we),we}const ne=x.scale/A,fe=d.get("selectedFeature.geometry")||_,Oe=fe&&"point"===fe.type&&(yield O8(T,x));yh.active=!0,yh.disabled=!0;try{yield d.zoomTo({target:{target:U,scale:Oe?ne:void 0}})}catch{const Ze=new ai.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:T});Xv.error(Ze)}finally{yh.active=!1,yh.disabled=!1,d.zoomToLocation=null,Oe&&(d.location=fe)}})).apply(this,arguments)}function FM(){return(FM=(0,kr.Z)(function*(d){const{selectedFeature:_,view:T}=d;if("2d"!==T?.type){const fe=new ai.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:T});throw Xv.error(fe),fe}if(!Wp(_)){const fe=new ai.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:_});throw Xv.error(fe),fe}const x=_.sourceLayer,A=yield T.whenLayerView(x),U=A.createQuery();U.aggregateIds=[_.getObjectId()],Fp.active=!0,Fp.disabled=!0;const{extent:ne}=yield A.queryExtent(U);yield d.zoomTo({target:ne}),Fp.active=!1,Fp.disabled=!1})).apply(this,arguments)}function NM(){return(NM=(0,kr.Z)(function*(d){const{selectedFeature:_,view:T}=d,x=_.sourceLayer,A=yield T.whenLayerView(x),U=A.createQuery();U.aggregateIds=[_.getObjectId()];const{extent:ne}=yield A.queryExtent(U);d.selectedClusterBoundaryFeature.geometry=ne,T.graphics.add(d.selectedClusterBoundaryFeature)})).apply(this,arguments)}function WM(){return(WM=(0,kr.Z)(function*(d){const{selectedFeature:_,view:T}=d,x=_.sourceLayer,A=yield T.whenLayerView(x),U=A.createQuery();U.aggregateIds=[_.getObjectId()],Np.active=!0,Np.disabled=!0;const{features:ne}=yield A.queryFeatures(U);Np.active=!1,Np.disabled=!1,T.popup.open({features:[_].concat(ne),featureMenuOpen:!0})})).apply(this,arguments)}const ZS=d=>{let _=class extends d{constructor(...T){super(...T),this.goToOverride=null,this.view=null}callGoTo(T){const{view:x}=this;return this.goToOverride?this.goToOverride(x,T):x.goTo(T.target,T.options)}};return(0,Ve._)([(0,ke.Cb)()],_.prototype,"goToOverride",void 0),(0,Ve._)([(0,ke.Cb)()],_.prototype,"view",void 0),_=(0,Ve._)([(0,Wr.j)("esri.widgets.support.GoTo")],_),_};var VM=v(88493);const Zm=On.Z.ofType({key:"type",defaultKeyValue:"button",base:y8.Z,typeMap:{button:Gm.Z,toggle:v8.Z}});let tn=class extends(ZS(jS)){constructor(d){super(d),this._handles=new Ji.Z,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Zm,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new fd.Z({symbol:new VM.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(d=>d.waitingForContent)}initialize(){this._handles.add([(0,Ht.YP)(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),(0,Ht.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,Ht.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,Ht.YP)(()=>this.view?.animation?.state,d=>this._animationStateChange(d)),(0,Ht.YP)(()=>this.location,d=>this._locationChange(d)),(0,Ht.YP)(()=>this.selectedFeature,d=>this._selectedFeatureChange(d)),(0,Ht.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,Ht.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,Ht.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",d=>P8({event:d,view:this.view})),(0,Ht.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ht.Z_),(0,Ht.YP)(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),(0,Ht.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,Ht.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,Ht.YP)(()=>this.browseClusterEnabled,d=>d?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const d=this._get("allActions")||new Zm;d.removeAll();const{actions:_,defaultActions:T,defaultPopupTemplateEnabled:x,includeDefaultActions:A,selectedFeature:U}=this,ne=A?T.concat(_):_,fe=U&&("function"==typeof U.getEffectivePopupTemplate&&U.getEffectivePopupTemplate(x)||U.popupTemplate),Oe=fe&&fe.actions,we=fe&&fe.overwriteActions?Oe:Oe?Oe.concat(ne):ne;return we&&we.filter(Boolean).forEach(Ze=>d.add(Ze)),d}get defaultActions(){const d=this._get("defaultActions")||new Zm;return d.removeAll(),d.addMany(Wp(this.selectedFeature)?[Fp.clone(),Np.clone()]:[yh.clone()]),d}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(d){const _=d||[];this._set("features",_);const{pendingPromisesCount:T,promiseCount:x,selectedFeatureIndex:A}=this,U=x&&_.length;U&&T&&-1===A?this.selectedFeatureIndex=0:U&&-1!==A||(this.selectedFeatureIndex=_.length?0:-1)}get location(){return this._get("location")||null}set location(d){const _=this.get("view.spatialReference.isWebMercator");d&&d.get("spatialReference.isWGS84")&&_&&(d=(0,au.$)(d)),this._set("location",d)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(d){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(d)||!d.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",d),(d=d.slice(0)).forEach(_=>{this._pendingPromises.add(_),_.then(A=>{this._pendingPromises.has(_)&&this._updateFeatures(A),this._updatePendingPromises(_)},()=>this._updatePendingPromises(_))}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:d,selectedFeatureIndex:_}=this;return-1===_?null:d[_]||null}get selectedFeatureIndex(){const d=this._get("selectedFeatureIndex");return"number"==typeof d?d:-1}set selectedFeatureIndex(d){const{featureCount:_}=this;d=isNaN(d)||d<-1||!_?-1:(d+_)%_,this.activeFeature=null,this._set("selectedFeatureIndex",d)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:d}=this,_=KS(this);return _?this.callGoTo({target:{target:_,scale:d.scale}}):Promise.reject(new ai.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:_,view:d}))}zoomTo(d){return this.callGoTo(d)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(d,_){const{view:T}=this;if(!T||!d)throw new ai.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:d,view:T});return T.fetchPopupFeatures(d,{event:_&&_.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:_&&_.signal})}open(d){const _={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...d,visible:!0},{fetchFeatures:T}=_;delete _.fetchFeatures,T&&this._setFetchFeaturesPromises(_.location);const x=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const A of x)delete _[A];this.set(_)}triggerAction(d){const _=this.allActions.getItemAt(d);_&&!_.disabled&&this.emit("trigger-action",{action:_})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function R8(d){const _=d.features.filter(T=>Wp(T));_.length&&(d.features=_)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var d=this;return(0,kr.Z)(function*(){const{view:_,selectedFeature:T}=d;"2d"===_?.type?Wp(T)?(yield function S8(d){return NM.apply(this,arguments)}(d),yield function A8(d){return WM.apply(this,arguments)}(d)):Us.Z.getLogger(d.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",T):Us.Z.getLogger(d.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",T)})()}_animationStateChange(d){this.zoomToLocation||(yh.disabled="waiting-for-target"===d)}_clearBrowsedClusterGraphics(){const d=this.view?.graphics;d&&(d.remove(this.selectedClusterBoundaryFeature),d.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Wp(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(d){const{selectedFeature:_,updateLocationEnabled:T}=this;T&&d&&(!_||_.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:d,featureCount:_,featurePage:T,featuresPerPage:x,featureViewModels:A}=this;if(null===T)return;const U=((T-1)*x+_)%_;A.slice(U,U+x).forEach((fe,Oe)=>{fe&&!fe.graphic&&(fe.graphic=d[U+Oe])})}_selectedFeatureChange(d){var _=this;return(0,kr.Z)(function*(){if(!d)return;const{location:T,updateLocationEnabled:x,view:A}=_;if(_.browseClusterEnabled)return _._selectedClusterFeature&&(A.graphics.remove(_._selectedClusterFeature),_._selectedClusterFeature=null),Wp(d)?void 0:(d.symbol=yield function T8(d,_){return wM.apply(this,arguments)}(d),_._selectedClusterFeature=d,void A.graphics.add(_._selectedClusterFeature));!x&&T||!d.geometry?x&&!d.geometry&&_.centerAtLocation().then(()=>{_.location=A.center.clone()}):_.location=(0,Qe.Wg)(_._getPointFromGeometry(d.geometry))})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(d){return this._fetchFeaturesWithController(this._getScreenPoint(d||this.location)).then(_=>{const{clientOnlyGraphics:T,promisesPerLayerView:x}=_,A=Promise.resolve(T),U=x.map(ne=>ne.promise);this.promises=[A,...U]})}_destroyFeatureVMs(){this.featureViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:d,features:_,featureViewModels:T}=this;if(Wp(d)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!_||!_.length)return;const x=T.slice(0),A=[];_.forEach((U,ne)=>{if(!U)return;let fe=null;if(x.some((Oe,we)=>(Oe&&Oe.graphic===U&&(fe=Oe,x.splice(we,1)),!!fe)),fe)A[ne]=fe;else{const Oe=new xM({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:this.view?.spatialReference,graphic:U===d?U:null,map:this.view?.map,view:this.view});A[ne]=Oe}}),x.forEach(U=>U&&!U.destroyed&&U.destroy()),this._set("featureViewModels",A)}_getScreenPoint(d){const{view:_}=this;return _&&d&&"function"==typeof _.toScreen?_.toScreen(d):null}_autoOpenEnabledChange(){const d="auto-fetch-features",{_handles:_,autoOpenEnabled:T}=this;if(_.remove(d),T&&this.view){const x=this.view.on("click",A=>{"mouse"===A.pointerType&&0!==A.button||this._fetchFeaturesAndOpen(A)},Km.f.WIDGET);_.add(x,d)}}_cancelFetchingFeatures(){const d=this._fetchFeaturesController;d&&d.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(d,_){this._cancelFetchingFeatures();const T=new AbortController,{signal:x}=T;this._fetchFeaturesController=T,this.notifyChange("waitingForResult");const A=this.fetchFeatures(d,{signal:x,event:_});return A.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),A}_fetchFeaturesAndOpen(d){const{screenPoint:_,mapPoint:T}=d,{view:x}=this;this._fetchFeaturesWithController(_,d).then(A=>{const{clientOnlyGraphics:U,promisesPerLayerView:ne,location:fe}=A,Oe=[Promise.resolve(U),...ne.map(we=>we.promise)];return x.popup.open({location:fe||T,promises:Oe}),A})}_updatePendingPromises(d){d&&this._pendingPromises.has(d)&&(this._pendingPromises.delete(d),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(d){return(0,Qe.Wi)(d)?null:"point"===d.type?d:"extent"===d.type?d.center:"polygon"===d.type?d.centroid:"multipoint"===d.type||"polyline"===d.type?d.extent?.center:null}_getLayerView(d,_){return(0,kr.Z)(function*(){return yield d.when(),d.whenLayerView(_)})()}_getHighlightLayer(d){const{layer:_,sourceLayer:T}=d;return T&&"layer"in T&&T.layer?T.layer:"map-notes"===T?.type||"subtype-group"===T?.type?T:_}_getHighlightTarget(d,_){const T="imagery"===_.type?void 0:"objectIdField"in _?_.objectIdField||wD.d:null,x=d.attributes;return x&&T&&x[T]||d}_highlightActiveFeature(){var d=this;return(0,kr.Z)(function*(){const _="highlight-active-feature";d._handles.remove(_);const{highlightEnabled:T,view:x,activeFeature:A,visible:U}=d;if(!(A&&x&&T&&U))return;const ne=d._getHighlightLayer(A);if(!(ne&&ne instanceof NS.Z))return;const fe=d._getLayerView(x,ne);d._highlightActiveFeaturePromise=fe;const Oe=yield fe;if(!(Oe&&(0,LM.tl)(Oe)&&d._highlightActiveFeaturePromise===fe&&d.activeFeature&&d.highlightEnabled))return;const we=Oe.highlight(d._getHighlightTarget(A,ne));d._handles.add(we,_)})()}_highlightSelectedFeature(){var d=this;return(0,kr.Z)(function*(){const _="highlight-selected-feature";d._handles.remove(_);const{selectedFeature:T,highlightEnabled:x,view:A,visible:U}=d;if(!(T&&A&&x&&U))return;const ne=d._getHighlightLayer(T);if(!(ne&&ne instanceof NS.Z))return;const fe=d._getLayerView(A,ne);d._highlightSelectedFeaturePromise=fe;const Oe=yield fe;if(!(Oe&&(0,LM.tl)(Oe)&&d._highlightSelectedFeaturePromise===fe&&d.selectedFeature&&d.highlightEnabled&&d.visible))return;const we=Oe.highlight(d._getHighlightTarget(T,ne));d._handles.add(we,_)})()}_updateFeatures(d){const{features:_}=this;if(!d||!d.length)return;if(!_.length)return void(this.features=d);const T=d.filter(x=>!_.includes(x));this.features=_.concat(T)}};(0,Ve._)([(0,ke.Cb)()],tn.prototype,"featurePage",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"isLoadingFeature",null),(0,Ve._)([(0,ke.Cb)({type:Zm})],tn.prototype,"actions",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"active",null),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"activeFeature",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"allActions",null),(0,Ve._)([(0,ke.Cb)({type:Boolean})],tn.prototype,"defaultPopupTemplateEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"autoCloseEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"autoOpenEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"browseClusterEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"content",void 0),(0,Ve._)([(0,ke.Cb)({type:Zm,readOnly:!0})],tn.prototype,"defaultActions",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"featureCount",null),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"features",null),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"featuresPerPage",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"featureViewModelAbilities",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"featureViewModels",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"highlightEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"includeDefaultActions",void 0),(0,Ve._)([(0,ke.Cb)({type:vn.Z})],tn.prototype,"location",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"pendingPromisesCount",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"selectedClusterBoundaryFeature",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"waitingForResult",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"promiseCount",null),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"promises",null),(0,Ve._)([(0,ke.Cb)({value:null,readOnly:!0})],tn.prototype,"selectedFeature",null),(0,Ve._)([(0,ke.Cb)({value:-1})],tn.prototype,"selectedFeatureIndex",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"selectedFeatureViewModel",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],tn.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"title",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"updateLocationEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"visible",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"zoomFactor",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"zoomToLocation",void 0),(0,Ve._)([(0,ke.Cb)()],tn.prototype,"centerAtLocation",null),tn=(0,Ve._)([(0,Wr.j)("esri.widgets.Popup.PopupViewModel")],tn);const $S=tn;var fc=v(24940);const YS="selected-index",XS="popup-spinner",Ts_shadow="esri-popup--shadow",Ts_button="esri-popup__button",Ts_icon="esri-popup__icon",kS={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},JS="esri-popup";function Cd(d,_){return void 0===_?`${JS}__${d}`:`${JS}__${d}-${_}`}const QS={closeButton:!0,featureNavigation:!0};let hi=class extends(IS(ua.Z)){constructor(d,_){super(d,_),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ji.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([T])=>{T?.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=c_(()=>this._displaySpinner(),0),this._exitRelatedRecordsActions=new WeakMap,this._flowItems=new On.Z,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new $S,this.visibleElements={...QS},this._addSelectedFeatureIndexHandle(),this.addHandles([(0,Ht.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,Ht.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,Ht.YP)(()=>this.viewModel?.screenLocation,(T,x)=>{!!T!=!!x&&this.reposition()}),(0,Ht.YP)(()=>[this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,Ht.YP)(()=>this.spinnerEnabled,T=>this._spinnerEnabledChange(T)),(0,Ht.YP)(()=>this.viewModel?.view?.size,(T,x)=>this._updateDockEnabledForViewSize(T,x)),(0,Ht.YP)(()=>this.viewModel?.view,(T,x)=>this._viewChange(T,x)),(0,Ht.YP)(()=>this.viewModel?.view?.ready,(T,x)=>this._viewReadyChange(T,x)),(0,Ht.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,Ht.YP)(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),(0,Ht.YP)(()=>[this.selectedFeatureWidget?.viewModel?.title,this.selectedFeatureWidget?.viewModel?.state],()=>this._setTitleFromFeatureWidget()),(0,Ht.YP)(()=>[this.selectedFeatureWidget?.viewModel?.content,this.selectedFeatureWidget?.viewModel?.state],()=>this._setContentFromFeatureWidget()),(0,Ht.gx)(()=>!this.collapsed,()=>{"xsmall"===this.viewModel?.view?.widthBreakpoint&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),(0,Ht.on)(()=>this.viewModel?.allActions,"change",()=>this._watchActions()),(0,Ht.YP)(()=>this.viewModel?.allActions,()=>this._watchActions(),Ht.nn),(0,Ht.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),(0,Ht.on)(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),(0,Ht.YP)(()=>[this._activeFlowItemWidget?.viewModel?.state,this._activeFlowItemWidget?.viewModel?.title],()=>this.scheduleRender())])}loadDependencies(){return Promise.all([v.e(8178).then(v.bind(v,58178)),Promise.all([v.e(8792),v.e(8346),v.e(7112)]).then(v.bind(v,17112)),Promise.all([v.e(8346),v.e(2226)]).then(v.bind(v,52573)),Promise.all([v.e(8792),v.e(6810)]).then(v.bind(v,26810)),v.e(8472).then(v.bind(v,8472))])}destroy(){this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles?.destroy(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:d,viewModel:_}=this;if(!d)return!!_?.content;const T=d.viewModel;if(T?.waitingForContent||"error"===T?.state)return!0;const x=T?.content;return Array.isArray(x)?!!x.length:!!x}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:d}=this;return d.getItemAt(d.length-1)||null}get actions(){return this.viewModel.actions}set actions(d){this.viewModel.actions=d}set actionsMenuOpen(d){this._set("actionsMenuOpen",!!d)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(d){this.viewModel.autoCloseEnabled=d}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(d){this.viewModel.autoOpenEnabled=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get content(){return this.viewModel.content}set content(d){this.viewModel.content=d}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||kS}set dockOptions(d){const _={...kS},T=this.get("viewModel.view.breakpoints"),x={};T&&(x.width=T.xsmall,x.height=T.xsmall);const A={..._,...d},U={..._.breakpoint,...x},{breakpoint:ne}=A;!0===ne?A.breakpoint=U:"object"==typeof ne&&(A.breakpoint={...U,...ne}),this._set("dockOptions",A),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(d){this.viewModel.features=d}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(d){this.viewModel.goToOverride=d}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(d){this.viewModel.highlightEnabled=d}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get promises(){return this.viewModel.promises}set promises(d){this.viewModel.promises=d}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(d){this.viewModel.selectedFeatureIndex=d}get selectedFeatureWidget(){const{_feature:d,visibleElements:_,headingLevel:T,_flowItems:x}=this,{selectedFeatureViewModel:A}=this.viewModel,U={..._,title:!1};return A?(d?(d.viewModel=A,d.visibleElements=U):this._feature=new f8({flowItems:x,headingLevel:T+1,viewModel:A,visibleElements:U}),this._feature):null}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(d){this.viewModel.updateLocationEnabled=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}castVisibleElements(d){return{...QS,...d}}blur(){const{active:d}=this.viewModel;d||Us.Z.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(d,_){return this.viewModel.fetchFeatures(d,_)}focus(){const{active:d}=this.viewModel;d||Us.Z.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(d){this._handles.remove(YS);const x={collapsed:!!d&&!!d.collapsed,actionsMenuOpen:!!d&&!!d.actionsMenuOpen,featureMenuOpen:!!d&&!!d.featureMenuOpen};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(x.collapsed=!0),this.set(x),this.viewModel.open(d),this._shouldFocus(d),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(d){return this.viewModel.triggerAction(d)}render(){const{actionsMenuOpen:d,dockEnabled:_,featureMenuVisible:T,dividedActions:x,currentAlignment:A,currentDockPosition:U}=this,{active:ne}=this.viewModel,{menuActions:fe}=x,it=this.selectedFeature?.layer?.title,lt=this.selectedFeature?.layer?.id;return(0,Yt.u)("div",{class:this.classes("esri-popup",{"esri-popup--aligned-top-center":"top-center"===A,"esri-popup--aligned-bottom-center":"bottom-center"===A,"esri-popup--aligned-top-left":"top-left"===A,"esri-popup--aligned-bottom-left":"bottom-left"===A,"esri-popup--aligned-top-right":"top-right"===A,"esri-popup--aligned-bottom-right":"bottom-right"===A,"esri-popup--is-docked":ne&&_,[Ts_shadow]:ne&&!_,"esri-popup--is-docked-top-left":"top-left"===U,"esri-popup--is-docked-top-center":"top-center"===U,"esri-popup--is-docked-top-right":"top-right"===U,"esri-popup--is-docked-bottom-left":"bottom-left"===U,"esri-popup--is-docked-bottom-center":"bottom-center"===U,"esri-popup--is-docked-bottom-right":"bottom-right"===U,"esri-popup--feature-menu-open":T,"esri-popup--actions-menu-open":ne&&fe.length>1&&d}),role:"presentation","data-layer-title":it,"data-layer-id":lt,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},ne?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes(Ts_icon,"esri-icon-loading-indicator","esri-rotating")})}renderNavigationLoading(){const{messagesCommon:d}=this;return this.viewModel.pendingPromisesCount?(0,Yt.u)("div",{key:Cd("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":d.loading,title:d.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const d=(0,uo.dZ)(this.container);return(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes(Ts_icon,{"esri-icon-right-triangle-arrow":d,"esri-popup__pagination-previous-icon--rtl":d,"esri-icon-left-triangle-arrow":!d,"esri-popup__pagination-previous-icon":!d})})}renderPreviousButton(){const{messages:d}=this;return(0,Yt.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ts_button,"esri-popup__pagination-previous"),"aria-label":d.previous,title:d.previous},this.renderPreviousIcon())}renderNextIcon(){const d=(0,uo.dZ)(this.container);return(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes(Ts_icon,{"esri-icon-left-triangle-arrow":d,"esri-popup__pagination-next-icon--rtl":d,"esri-icon-right-triangle-arrow":!d,"esri-popup__pagination-next-icon":!d})})}renderNextButton(){const{messages:d}=this;return(0,Yt.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ts_button,"esri-popup__pagination-next"),"aria-label":d.next,title:d.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:d,featureMenuId:_,messagesCommon:T}=this,{featureCount:x,selectedFeatureIndex:A}=this.viewModel;return(0,Yt.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ts_button,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":_,"aria-expanded":d.toString(),"aria-label":T.menu,title:T.menu},this._getPageText(x,A))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:d}=this,_=this._wouldDockTo();return(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes({"esri-icon-minimize":d,"esri-popup__icon--dock-icon":!d,"esri-icon-dock-right":!d&&("top-right"===_||"bottom-right"===_),"esri-icon-dock-left":!d&&("top-left"===_||"bottom-left"===_),"esri-icon-maximize":!d&&"top-center"===_,"esri-icon-dock-bottom":!d&&"bottom-center"===_},Ts_icon)})}renderDockButton(){const{dockEnabled:d,messages:_}=this,T=this.viewModel?.view?.widthBreakpoint,x=d?_.undock:_.dock;return"xsmall"!==T&&this.dockOptions?.buttonEnabled?(0,Yt.u)("div",{role:"button","aria-label":x,title:x,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ts_button,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:d}=this.viewModel,{titleId:_,collapsible:T,contentCollapsed:x,messagesCommon:A}=this,U={"esri-popup__header-container--button":T},ne=(0,Yt.u)(wp,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:d}),fe=T?(0,Yt.u)("button",{key:`${d}--collapsible`,id:_,title:x?A.expand:A.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",U),"aria-expanded":x?"false":"true",onclick:this._toggleCollapsed,type:"button"},ne,(0,Yt.u)("calcite-icon",{class:"esri-popup__collapse-icon",key:"collapse-icon",icon:x?"chevron-down":"chevron-up",scale:"m"})):(0,Yt.u)("div",{key:d,id:_,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",U)},ne);return d?fe:null}renderCloseIcon(){return(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes(Ts_icon,"esri-icon-close")})}renderCloseButton(){const{visibleElements:d,messagesCommon:_}=this;return d.closeButton?(0,Yt.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ts_button,"aria-label":_.close,title:_.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,Yt.u)("header",{class:"esri-popup__header"},this.renderTitle(),(0,Yt.u)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:d,hasContent:_,contentCollapsed:T,_flowItems:x,messagesCommon:A}=this,{content:U}=this.viewModel,ne=x.toArray(),fe={"esri-content--has-flows":!!ne.length};return _&&!T?(0,Yt.u)("div",{key:U,enterAnimation:this._createFeatureUpdatedAnimation(),id:d,class:this.classes("esri-popup__content",fe)},(0,Yt.u)("calcite-flow",{bind:this,onCalciteFlowItemBack:this._handleBackClick},(0,Yt.u)("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode","intl-back":A.back,afterCreate:uo.Yo,key:"root-flow-item"},this.renderContent()),ne.map(Oe=>this.renderFlowItem(Oe))),ne.map(Oe=>this.renderFlowItemTooltip(Oe))):null}renderFlowItem(d){const{messages:_,messagesCommon:T}=this,x=Vm();return(0,Yt.u)("calcite-flow-item",{class:this.classes({"calcite-theme-dark":!x,"calcite-theme-light":x}),heading:d.title,"intl-back":T.back,description:this._getFlowItemDescription(d),key:`flow-item-${d.viewModel.uid}`},(0,Yt.u)("calcite-action",{class:"esri-popup__action--exit",icon:"move-up",label:_?.exitRelatedRecords,text:_?.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:A=>this._storeExitRelatedRecordsAction(d,A),onclick:this._destroyFlowItemWidgets}),(0,Yt.u)("div",{class:this.classes("esri-content__flow-item",{"calcite-theme-dark":x,"calcite-theme-light":!x})},d.render()))}renderFlowItemTooltip(d){const{messages:_,_exitRelatedRecordsActions:T}=this,x=Vm();return(0,Yt.u)("calcite-tooltip",{class:this.classes({"calcite-theme-dark":!x,"calcite-theme-light":x}),key:`exit-related-records-tooltip-${d.viewModel.uid}`,label:_?.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:T.get(d),placement:"top"},_?.exitRelatedRecords)}renderActionsMenuButton(){const{actionsMenuId:d,actionsMenuButtonId:_,actionsMenuOpen:T,dividedActions:x,messagesCommon:A}=this,U=T?A.close:A.open,{menuActions:ne}=x;return ne.length?(0,Yt.u)("div",{key:Cd("actions-menu-button"),class:this.classes(Ts_button,"esri-popup__actions-menu-button"),role:"button",id:_,"aria-haspopup":"true","aria-controls":T?d:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":U,title:U},(0,Yt.u)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:d,actionsMenuButtonId:_,actionsMenuOpen:T,dividedActions:x}=this,{menuActions:A}=x;return A.length&&T?(0,Yt.u)("ul",{id:d,role:"menu","aria-labelledby":_,key:Cd("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},A.toArray().map(U=>this.renderAction({action:U,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:d}=this.dividedActions;return!!d.length&&d.toArray().map(_=>this.renderAction({action:_,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:d,menuActions:_}=this.dividedActions,T=!!d.length,x=!!_.length;return T||x?(0,Yt.u)("div",{key:"inline-actions-container","data-inline-actions":T.toString(),"data-menu-actions":x.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,Yt.u)("section",{key:Cd("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:d,dividedActions:_}=this,{inlineActions:T,menuActions:x}=_,A=!!T.length,ne={"esri-popup__footer--has-pagination":d,"esri-popup__footer--has-actions":A,"esri-popup__footer--has-actions-menu":!!x.length};return d||A?(0,Yt.u)("div",{key:Cd("feature-buttons"),class:this.classes("esri-popup__footer",ne)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:d}=this,{featureViewModels:_,isLoadingFeature:T}=this.viewModel,x=(0,_c.n)(d.selectedFeatures,{total:_.length});return(0,Yt.u)("section",{key:Cd("menu"),class:"esri-popup__feature-menu"},(0,Yt.u)("strong",{class:"esri-popup__feature-menu-header"},x),(0,Yt.u)("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:uo.Yo},this.renderFeatureMenu(),(0,Yt.u)("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),T?(0,Yt.u)("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:(0,Yt.u)("div",{key:Cd("pointer"),class:"esri-popup__pointer",role:"presentation"},(0,Yt.u)("div",{class:this.classes("esri-popup__pointer-direction",Ts_shadow)}))}renderMainContainer(){const{dockEnabled:d,currentAlignment:_,currentDockPosition:T,titleId:x,contentId:A,collapsible:U,hasContent:ne,contentCollapsed:fe,visibleElements:Oe}=this,{title:we}=this.viewModel,Ze="bottom-left"===_||"bottom-center"===_||"bottom-right"===_||"top-left"===T||"top-center"===T||"top-right"===T,it="top-left"===_||"top-center"===_||"top-right"===_||"bottom-left"===T||"bottom-center"===T||"bottom-right"===T;return(0,Yt.u)("div",{class:this.classes("esri-popup__main-container","esri-widget",{[Ts_shadow]:d,"esri-popup--is-collapsible":U,"esri-popup--is-collapsed":fe}),tabIndex:Oe.closeButton?null:-1,role:"dialog","aria-labelledby":we?x:"","aria-describedby":ne&&!fe?A:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},Ze?this.renderFooter():null,Ze?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),it?this.renderFooter():null,it?this.renderFeatureMenuContainer():null)}renderContent(){const d=this.viewModel?.content;return d?"string"==typeof d?(0,Yt.u)("div",{class:bo_contentNode,key:d,innerHTML:d}):this.renderNodeContent(d):null}renderActionText(d){return(0,Yt.u)("span",{key:"text",class:"esri-popup__action-text"},d)}renderActionIcon(d){const _=this._getActionClass(d),T=this._getActionImage(d),x={"esri-icon-loading-indicator":d.active,"esri-rotating":d.active,[Ts_icon]:!!_,"esri-popup__action-image":!d.active&&!!T};return _&&(x[_]=!d.active),(0,Yt.u)("span",{key:"icon","aria-hidden":"true",class:this.classes(Ts_icon,x),styles:this._getIconStyles(T)})}renderAction(d){const{action:_,type:T}=d,x=this._getActionTitle(_),A={"esri-popup__action":"toggle"!==_.type,"esri-popup__action-toggle":"toggle"===_.type,"esri-popup__action-toggle--on":"toggle"===_.type&&_.value,"esri-popup__button--disabled":_.disabled},U=[this.renderActionIcon(_),this.renderActionText(x)],ne="menu-item"===T?(0,Yt.u)("li",{key:_.uid,role:"menuitem",tabIndex:0,title:x,"aria-label":x,class:this.classes(Ts_button,A),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":_.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},U):(0,Yt.u)("div",{key:_.uid,role:"button",tabIndex:0,title:x,"aria-label":x,class:this.classes(Ts_button,A),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":_.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},U);return _.visible?ne:null}renderFeatureMenuItem(d,_){const{messages:T,messagesCommon:x}=this,{selectedFeatureIndex:A,selectedFeatureViewModel:U}=this.viewModel,ne=d===U,fe={"esri-popup__feature-menu-item--selected":ne},Oe=ne?(0,Yt.u)("span",{key:Cd(`feature-menu-selected-feature-${A}`),title:T.selectedFeature,"aria-label":T.selectedFeature,class:"esri-icon-check-mark"}):null,we=(0,Yt.u)("span",{innerHTML:d.title||x.untitled});return(0,Yt.u)("li",{role:"menuitem",tabIndex:-1,key:Cd(`feature-menu-feature-${A}`),class:this.classes(fe,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":_,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,Yt.u)("span",{class:"esri-popup__feature-menu-title"},we,Oe))}renderFeatureMenu(){const{featureMenuId:d}=this,{featureViewModels:_}=this.viewModel;return _.length>1?(0,Yt.u)("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},_.filter(T=>!!T.graphic).map((T,x)=>this.renderFeatureMenuItem(T,x))):null}_storeExitRelatedRecordsAction(d,_){this._exitRelatedRecordsActions.set(d,_),this.scheduleRender()}_getFlowItemDescription(d){return"featureCountDescription"in d?d.featureCountDescription:d.viewModel.description}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(d=>{"showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d.viewModel=null,d.destroy()})}_handleBackClick(){const d=this._flowItems.pop();this._exitRelatedRecordsActions.delete(d),"showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d&&(d.viewModel=null,d.destroy())}_getActionTitle(d){const{messages:_,selectedFeature:T,messagesCommon:x}=this,{id:A}=d,U=T?.attributes,ne="zoom-to-feature"===A?(0,_c.n)(d.title,{messages:_}):"remove-selected-feature"===A?(0,_c.n)(d.title,{messages:x}):"zoom-to-clustered-features"===A||"browse-clustered-features"===A?(0,_c.n)(d.title,{messages:_}):d.title;return ne&&U?(0,_c.n)(ne,U):ne}_getActionClass(d){const{selectedFeature:_}=this,T=_?.attributes,{className:x,image:A}=d,U=A||x?x:"esri-icon-default-action";return U&&T?(0,_c.n)(U,T):U}_getActionImage(d){const{selectedFeature:_}=this,T=_?.attributes,{image:x}=d;return x&&T?(0,_c.n)(x,T):x}_createFeatureUpdatedAnimation(){return(0,uo.vU)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:d,featureNavigationVisible:_}=this;if("number"!=typeof d)return null;const T=Math.round(d);return Math.max(_?T-1:T,0)}_watchActions(){const{allActions:d}=this.viewModel;this.notifyChange("dividedActions");const _="actions";this._handles.remove(_),d&&d.forEach(T=>{this._handles.add((0,Ht.YP)(()=>[T.uid,T.active,T.className,T.disabled,T.id,T.title,T.image,T.visible],()=>this.scheduleRender()),_)})}_divideActions(){const{allActions:d}=this.viewModel,_=d.filter(U=>U.visible),T=this._getInlineActionCount(),x=null===T,A=0===T;return{inlineActions:x?_.slice(0):A?new On.Z:_.slice(0,T),menuActions:x?new On.Z:_.slice(A?0:T)}}_featureMenuOpenChanged(d){d?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(d){d?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:d,messagesCommon:_}=this;d&&(this.viewModel.title="error"===d.viewModel?.state?_.errorMessage:d.viewModel?.title||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:d}=this;d&&(this.viewModel.content=d)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(d){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(d),this._featureMenuIntersectionObserverNode=d}_handleFeatureMenuKeyup(d){"Escape"===(0,Dp.kK)(d)&&(d.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(d){"Escape"===(0,Dp.kK)(d)&&(d.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(d){const{viewModel:_}=this;_.activeFeature=_.features[d.currentTarget["data-feature-index"]]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(d){const _=(0,Dp.kK)(d),{_featureMenuNode:T}=this,x=d.currentTarget["data-feature-index"];if(!T)return;const A=T.querySelectorAll("li"),U=A.length;"ArrowUp"!==_?"ArrowDown"!==_?"Home"!==_?"End"!==_||(d.stopPropagation(),A[A.length-1].focus()):(d.stopPropagation(),A[0].focus()):(d.stopPropagation(),A[(x+1+U)%U].focus()):(d.stopPropagation(),A[(x-1+U)%U].focus())}_handleActionMenuItemKeyup(d){const _=(0,Dp.kK)(d),{_actionsMenuNode:T}=this,x=d.currentTarget.dataset.actionUid,{menuActions:A}=this.dividedActions,U=A.findIndex(Oe=>Oe.uid===x);if(!T)return;const ne=T.querySelectorAll("li"),fe=ne.length;"ArrowUp"!==_?"ArrowDown"!==_?"Home"!==_?"End"!==_||(d.stopPropagation(),ne[ne.length-1].focus()):(d.stopPropagation(),ne[0].focus()):(d.stopPropagation(),ne[(U+1+fe)%fe].focus()):(d.stopPropagation(),ne[(U-1+fe)%fe].focus())}_handleMainKeyup(d){const _=(0,Dp.kK)(d);"ArrowLeft"===_&&(d.stopPropagation(),this.previous()),"ArrowRight"===_&&(d.stopPropagation(),this.next())}_spinnerEnabledChange(d){if(this._destroySpinner(),!d)return;const _=this.get("viewModel.view");this._createSpinner(_)}_hideSpinner(){const{_spinner:d}=this;d&&(d.location=null,d.hide())}_displaySpinner(){const{_spinner:d}=this;if(!d)return;const{location:_,waitingForResult:T}=this.viewModel;T?d.show({location:_}):d.hide()}_getIconStyles(d){return{"background-image":d?`url(${d})`:""}}_shouldFocus(d){var _=this;return(0,kr.Z)(function*(){d.shouldFocus&&(yield(0,Ht.N1)(()=>!0===_.viewModel?.active),_.focus())})()}_addSelectedFeatureIndexHandle(){const d=(0,Ht.YP)(()=>this.viewModel?.selectedFeatureIndex,(_,T)=>this._selectedFeatureIndexUpdated(_,T));this._handles.add(d,YS)}_selectedFeatureIndexUpdated(d,_){const{featureCount:T}=this;T&&d!==_&&-1!==d&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:d}=this;d&&(d.viewModel=null,d&&!d.destroyed&&d.destroy()),this._feature=null}_isScreenLocationWithinView(d,_){return d.x>-1&&d.y>-1&&d.x<=_.width&&d.y<=_.height}_isOutsideView(d){const{popupHeight:_,popupWidth:T,screenLocation:x,side:A,view:U}=d;if(isNaN(T)||isNaN(_)||!U||!x)return!1;const ne=U.padding;return"right"===A&&x.x+T/2>U.width-ne.right||"left"===A&&x.x-T/2<ne.left||"top"===A&&x.y-_<ne.top||"bottom"===A&&x.y+_>U.height-ne.bottom}_calculateAutoAlignment(d){if("auto"!==d)return d;const{_pointerOffsetInPx:_,_containerNode:T,_mainContainerNode:x,viewModel:A}=this,{screenLocation:U,view:ne}=A;if((0,Qe.Wi)(U)||!ne||!T)return"top-center";if(!this._isScreenLocationWithinView(U,ne))return this._get("currentAlignment")||"top-center";function fe(Bt){return parseInt(Bt.replace(/[^-\d\.]/g,""),10)}const Oe=x?window.getComputedStyle(x,null):null,we=Oe?fe(Oe.getPropertyValue("max-height")):0,Ze=Oe?fe(Oe.getPropertyValue("height")):0,{height:it,width:lt}=T.getBoundingClientRect(),dt=lt+_,Tt=Math.max(it,we,Ze)+_,mt=this._isOutsideView({popupHeight:Tt,popupWidth:dt,screenLocation:U,side:"right",view:ne}),Mt=this._isOutsideView({popupHeight:Tt,popupWidth:dt,screenLocation:U,side:"left",view:ne}),Pt=this._isOutsideView({popupHeight:Tt,popupWidth:dt,screenLocation:U,side:"top",view:ne}),Nt=this._isOutsideView({popupHeight:Tt,popupWidth:dt,screenLocation:U,side:"bottom",view:ne});return Mt?Pt?"bottom-right":"top-right":mt?Pt?"bottom-left":"top-left":Pt?Nt?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(d){return"function"==typeof d?d.call(this):d}_getCurrentAlignment(){const{alignment:d,dockEnabled:_}=this;return _||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(d)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(d){const _=["left","right"];return(0,uo.dZ)(this.container)&&_.reverse(),d.replace(/leading/gi,_[0]).replace(/trailing/gi,_[1])}_callDockPosition(d){return"function"==typeof d?d.call(this):d}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(d){if("auto"!==d)return d;const _=this.viewModel?.view,T=(0,uo.dZ)(this.container)?"top-left":"top-right";if(!_)return T;const x=_.padding||{left:0,right:0,top:0,bottom:0},A=_.width-x.left-x.right,{breakpoints:U}=_;return U&&A<=U.xsmall?"bottom-center":T}_positionContainer(d=this._containerNode){if(d&&(this._containerNode=d),!d)return;const{screenLocation:_}=this.viewModel,{width:T}=d.getBoundingClientRect(),x=this._calculatePositionStyle(_,T);x&&(d.style.top=x.top,d.style.left=x.left,d.style.bottom=x.bottom,d.style.right=x.right)}_calculateFullWidth(d){const{currentAlignment:_,_pointerOffsetInPx:T}=this;return"top-left"===_||"bottom-left"===_||"top-right"===_||"bottom-right"===_?d+T:d}_calculateAlignmentPosition(d,_,T,x){const{currentAlignment:A,_pointerOffsetInPx:U}=this,ne=x/2,fe=T.height-_,Oe=T.width-d,{padding:we}=this.view;return"bottom-center"===A?{top:_+U-we.top,left:d-ne-we.left}:"top-left"===A?{bottom:fe+U-we.bottom,right:Oe+U-we.right}:"bottom-left"===A?{top:_+U-we.top,right:Oe+U-we.right}:"top-right"===A?{bottom:fe+U-we.bottom,left:d+U-we.left}:"bottom-right"===A?{top:_+U-we.top,left:d+U-we.left}:"top-center"===A?{bottom:fe+U-we.bottom,left:d-ne-we.left}:void 0}_calculatePositionStyle(d,_){const{dockEnabled:T,view:x}=this;if(!x)return;if(T)return{left:"",top:"",right:"",bottom:""};if((0,Qe.Wi)(d)||!_)return;const A=this._calculateFullWidth(_),U=this._calculateAlignmentPosition(d.x,d.y,x,A);return U?{top:void 0!==U.top?`${U.top}px`:"auto",left:void 0!==U.left?`${U.left}px`:"auto",bottom:void 0!==U.bottom?`${U.bottom}px`:"auto",right:void 0!==U.right?`${U.right}px`:"auto"}:void 0}_viewChange(d,_){d&&_&&(this.close(),this.clear())}_viewReadyChange(d,_){if(d){const T=this.get("viewModel.view");this._wireUpView(T)}else _&&(this.close(),this.clear())}_wireUpView(d){if(this._destroySpinner(),!d)return;const{spinnerEnabled:_}=this;_&&this._createSpinner(d),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(d,_,T){const[x,A]=d,[U,ne]=_,{width:fe,height:Oe}=T;return x<=fe&&U>fe||x>fe&&U<=fe||A<=Oe&&ne>Oe||A>Oe&&ne<=Oe}_updateDockEnabledForViewSize(d,_){if(!d||!_)return;const T=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},x=T.left+T.right,A=T.top+T.bottom,U=[],ne=[];U[0]=d[0]-x,U[1]=d[1]-A,ne[0]=_[0]-x,ne[1]=_[1]-A;const{dockOptions:fe}=this;this._dockingThresholdCrossed(U,ne,fe.breakpoint)&&this._setDockEnabledForViewSize(fe),this._setCurrentDockPosition()}_focusDockButtonNode(d){this._focusDockButton&&(this._focusDockButton=!1,d.focus())}_closeButtonNodeUpdated(d){return this._focusClose?(this._focusClose=!1,void d.focus()):this._blurClose?(this._blurClose=!1,void d.blur()):void 0}_mainContainerNodeUpdated(d){return this._mainContainerNode=d,this._focusContainer?(this._focusContainer=!1,void d.focus()):this._blurContainer?(this._blurContainer=!1,void d.blur()):void 0}_featureMenuNodeUpdated(d){if(this._featureMenuNode=d,!d||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const _=d.querySelectorAll("li");_.length&&_[0].focus()}_actionsMenuNodeUpdated(d){if(this._actionsMenuNode=d,!d||!this._focusFirstAction)return;this._focusFirstAction=!1;const _=d.querySelectorAll("li");_.length&&_[0].focus()}_focusFeatureMenuButtonNode(d){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,d.focus())}_focusActionsMenuButtonNode(d){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,d.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:d,viewModel:_}=this;_&&(_.screenLocationEnabled=_.active&&!d)}_shouldDockAtCurrentViewSize(d){const _=d.breakpoint,T=this.viewModel?.view?.ui;if(!T)return!1;const{width:x,height:A}=T;if(isNaN(x)||isNaN(A))return!1;const U=_.hasOwnProperty("width")&&x<=_.width,ne=_.hasOwnProperty("height")&&A<=_.height;return U||ne}_setDockEnabledForViewSize(d){d.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(d))}_getPageText(d,_){return this.featureNavigationVisible?(0,_c.n)(this.messages.pageText,{index:_+1,total:d}):null}_destroySpinner(){const{_spinner:d,view:_}=this;d&&(_&&_.ui&&_.ui.remove(this._spinner,XS),d.destroy(),this._spinner=null)}_createSpinner(d){d&&(this._spinner=new g8({view:d}),d.ui.add(this._spinner,{key:XS,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const d=!this.featureMenuOpen;this._featureMenuOpenChanged(d),this.actionsMenuOpen=!1,this.featureMenuOpen=d}_toggleActionsMenu(){const d=!this.actionsMenuOpen;this._actionsMenuOpenChanged(d),this.featureMenuOpen=!1,this.actionsMenuOpen=d}_triggerAction(d){const _=d.currentTarget.dataset.actionUid,{allActions:T}=this.viewModel,x=T.findIndex(U=>U.uid===_),A=T.getItemAt(x);A&&"toggle"===A.type&&(A.value=!A.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(x)}_selectFeature(d){const _=d.currentTarget["data-feature-index"];isNaN(_)||(this.viewModel.selectedFeatureIndex=_),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"actionsMenuId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"actionsMenuButtonId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"featureMenuId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"titleId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"contentId",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"hasContent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"featureNavigationVisible",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"collapsible",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"featureMenuVisible",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"contentCollapsed",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"dividedActions",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:["_flowItems.length"]})],hi.prototype,"_activeFlowItemWidget",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"actions",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"actionsMenuOpen",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"alignment",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"autoCloseEnabled",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"autoOpenEnabled",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"defaultPopupTemplateEnabled",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"content",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"collapsed",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"collapseEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"currentAlignment",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"currentDockPosition",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"dockOptions",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"dockEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"featureCount",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"featureMenuOpen",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"features",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"goToOverride",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"highlightEnabled",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"location",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"label",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"maxInlineActions",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Popup/t9n/Popup")],hi.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/t9n/common")],hi.prototype,"messagesCommon",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"promises",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"selectedFeature",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"selectedFeatureIndex",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],hi.prototype,"selectedFeatureWidget",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"spinnerEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"title",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"updateLocationEnabled",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:$S}),function L8(d){return _=>{_.hasOwnProperty("_delegatedEventNames")||(_._delegatedEventNames=_._delegatedEventNames?_._delegatedEventNames.slice():[]);const T=_._delegatedEventNames,x=Array.isArray(d)?d:function U8(d){return d.split(",").map(_=>_.trim())}(d);T.push(...x)}}(["triggerAction","trigger-action"])],hi.prototype,"viewModel",void 0),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"visible",null),(0,Ve._)([(0,ke.Cb)()],hi.prototype,"visibleElements",void 0),(0,Ve._)([(0,ko.p)("visibleElements")],hi.prototype,"castVisibleElements",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_close",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_toggleDockEnabled",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_toggleFeatureMenu",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_toggleActionsMenu",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_triggerAction",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_selectFeature",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_next",null),(0,Ve._)([(0,fc.h)()],hi.prototype,"_previous",null),hi=(0,Ve._)([(0,Wr.j)("esri.widgets.Popup")],hi);const qS=hi,zM=[0,0];function eA(d){d&&((0,md.cS)(d),d.parentNode&&d.parentNode.removeChild(d))}const V8=d=>{let _=class extends d{constructor(...T){super(...T),this._freqInfo={freq:16,time:750},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,0!==T.length&&void 0!==T[0]?.popup||(this.popup=new qS({view:this})),this.handles.add([(0,Ht.YP)(()=>this.cursor,x=>{const{surface:A}=this;A&&A.setAttribute("data-cursor",x)}),(0,Ht.YP)(()=>this.interacting,x=>{const{surface:A}=this;A&&A.setAttribute("data-interacting",x.toString())})])}initialize(){this.handles.add((0,Ht.YP)(()=>this.ui,(T,x)=>this._handleUIChange(T,x))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=(0,Qe.SC)(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(T){const x=this._get("container"),A=(0,md.L7)(T),U=A instanceof HTMLDivElement?A:null;if(U||"string"!=typeof T||Us.Z.getLogger(this.declaredClass).error("#container",`element with id '${T}' not found`),x===U)return;const ne="dom-size";if(this.handles.remove(ne),this._stopMeasuring(),x&&(x.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(eA(this.root),this._set("root",null)),this.userContent&&((0,md.YD)(this.userContent,x),eA(this.userContent),this._set("userContent",null))),!U)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);U.classList.add("esri-view");const fe=document.createElement("div");fe.className="esri-view-user-storage",(0,md.YD)(U,fe),U.appendChild(fe),this._set("userContent",fe);const Oe=document.createElement("div");Oe.className="esri-view-root",U.insertBefore(Oe,U.firstChild),this._set("root",Oe);const we=document.createElement("div");we.className="esri-view-surface",we.setAttribute("role","application"),we.tabIndex=0,Oe.appendChild(we),this._set("surface",we);const Ze=new ID;Oe.appendChild(Ze.surface),this._set("overlay",Ze),(0,Ht.YP)(()=>Ze.needsRender,it=>{this._overlayRenderTaskHandle=it&&!this._overlayRenderTaskHandle?(0,gd.A)({render:()=>this.overlay?.render()}):(0,Qe.hw)(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add((0,Ht.YP)(()=>this.size,it=>{const[lt,dt]=it,Tt="esri-view-surface--inset-outline";lt>=document.body.clientWidth||dt>=document.body.clientHeight?we.classList.add(Tt):we.classList.remove(Tt)},Ht.nn),ne),this._set("container",U),this._startMeasuring()}get focused(){const T=document.activeElement===this.surface;return document.hasFocus()&&T}set popup(T){const x=this._get("popup");x&&x!==T&&x.destroy(),this._set("popup",T)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(T,x,A){const U=this.position;return T-=U?U[0]:0,x-=U?U[1]:0,A?(A[0]=T,A[1]=x):A=[T,x],A}containerToPage(T,x,A){const U=this.position;return T+=U?U[0]:0,x+=U?U[1]:0,A?(A[0]=T,A[1]=x):A=[T,x],A}_handleUIChange(T,x){x&&(this.handles.remove("ui"),x.destroy()),T&&this._wireUI(T),this._set("ui",T)}_wireUI(T){this.handles.remove("ui"),T&&(T.view=this,this.handles.add([(0,Ht.YP)(()=>this.root,x=>{T.container=x?function F8(d){const _=document.createElement("div");return d.appendChild(_),_}(x):null},Ht.nn),(0,Ht.YP)(()=>this.popup,(x,A)=>{const U="popup";A&&T.remove(A,U),x&&(x.view=T.view,T.add(x,{key:U,position:"manual"}))},Ht.nn)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const T=this._freqInfo;T.freq=16,T.time=750,this.handles.add([(()=>{const x=()=>{T.freq=16,T.time=750};return window.addEventListener("resize",x),{remove(){window.removeEventListener("resize",x)}}})(),(0,gd.A)({prepare:x=>{const A=this._measure(),U=this._freqInfo;if(U.time+=x.deltaTime,A&&(U.freq=16,this._get("resizing")||this._set("resizing",!0)),U.time<U.freq)return;U.time=0;const ne=this._position();U.freq=ne||A?16:Math.min(750,2*U.freq),!A&&U.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const T=this.container,x=T?T.clientWidth:0,A=T?T.clientHeight:0;if(0===x||0===A)return this.suspended||this._set("suspended",!0),!1;const U=this.width,ne=this.height;return x===U&&A===ne?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",x),this._set("height",A),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:U,oldHeight:ne,width:x,height:A}),!0)}_position(){const T=this.container,x=this.position,A=T&&function j8(d){const _=(d.ownerDocument||window.document).defaultView,T=d.getBoundingClientRect();return zM[0]=T.left+(_?.pageXOffset??0),zM[1]=T.top+(_?.pageYOffset??0),zM}(T);return!(!A||x&&A[0]===x[0]&&A[1]===x[1]||(this._set("position",[A[0],A[1]]),0))}forceDOMReadyCycle(){}};return(0,Ve._)([(0,ke.Cb)()],_.prototype,"container",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"focused",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"height",void 0),(0,Ve._)([(0,ke.Cb)({type:qS})],_.prototype,"popup",null),(0,Ve._)([(0,ke.Cb)({type:ID})],_.prototype,"overlay",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"position",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"resizing",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"root",void 0),(0,Ve._)([(0,ke.Cb)({value:null,readOnly:!0})],_.prototype,"size",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"surface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"suspended",void 0),(0,Ve._)([(0,ke.Cb)()],_.prototype,"ui",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"userContent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],_.prototype,"width",void 0),(0,Ve._)([(0,ke.Cb)()],_.prototype,"widthBreakpoint",void 0),_=(0,Ve._)([(0,Wr.j)("esri.views.DOMContainer")],_),_};var to=v(65234),tA=v(33190),z8=v(13762),po=v(10558);let vh=class extends Va.Z.EventedAccessor{constructor(d){super(d),this.demResolution={min:-1,max:-1},this.noDataValue=po.$7}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const d=this.view.basemapTerrain;if((0,Qe.Wi)(d.extent)||(0,Qe.Wi)(d.spatialReference))return null;const _=(0,Bs.HH)(d.extent,d.spatialReference);return _.zmin=d.visibleElevationBounds.min,_.zmax=d.visibleElevationBounds.max,_}get spatialReference(){return(0,Qe.Pt)(this.view.basemapTerrain.spatialReference,to.Z.WGS84)}elevationAt(d,_){if((0,Qe.Wi)(this.extent)||!(0,tA.Kv)(this.extent,d,_)){const T=(0,Qe.pC)(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Us.Z.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${d}, ${_}) is outside of the sampler extent (${T})`),this.noDataValue}return(0,Qe.Pt)(this.view.elevationProvider.getElevation(d,_,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(d){return(0,z8.G$)(d.clone(),this)}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],vh.prototype,"demResolution",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],vh.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],vh.prototype,"noDataValue",void 0),(0,Ve._)([(0,ke.Cb)()],vh.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],vh.prototype,"view",void 0),vh=(0,Ve._)([(0,Wr.j)("esri.views.support.GroundViewElevationSampler")],vh);const H8=vh;let Eh=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this.view=null,this.layerViews=new On.Z}initialize(){this._handles.add((0,Ht.gx)(()=>this.view?.map?.ground,d=>d.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new H8({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(d=>d.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(d=>(0,Ht.YP)(()=>d.updating,()=>this._updateUpdating(),Ht.Z_)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Eh.prototype,"elevationSampler",null),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],Eh.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Eh.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({type:On.Z,readOnly:!0})],Eh.prototype,"layerViews",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Eh.prototype,"suspended",null),Eh=(0,Ve._)([(0,Wr.j)("esri.views.GroundView")],Eh);const G8=Eh,K8=d=>{let _=class extends d{fetchPopupFeatures(T,x){var A=this;return(0,kr.Z)(function*(){yield A.when();const{location:U,queryArea:ne,layerViewsAndGraphics:fe,clientOnlyGraphics:Oe}=yield A._prepareFetchPopupFeatures(T,x),we=Promise.resolve(Oe),Ze=A._queryLayerPopupFeatures(ne,fe,x),it=Ze.map(lt=>lt.promise);return{location:U,clientOnlyGraphics:Oe,allGraphicsPromise:(0,ws.WW)([we,...it]).then(lt=>Array.from(new Set(lt.flat()))),promisesPerLayerView:Ze}})()}_queryLayerPopupFeatures(T,x,A){return x.map(({layerView:U,graphics:ne})=>{const fe={clientGraphics:ne,event:(0,Qe.pC)(A)?A.event:null,signal:(0,Qe.pC)(A)?A.signal:null,defaultPopupTemplateEnabled:!!(0,Qe.pC)(A)&&!!A.defaultPopupTemplateEnabled},Oe=U.fetchPopupFeatures(T,fe);return{layerView:U,promise:Oe}})}_isValidPopupGraphic(T,x){return T&&!!T.getEffectivePopupTemplate((0,Qe.pC)(x)&&x.defaultPopupTemplateEnabled)}_prepareFetchPopupFeatures(T,x){var A=this;return(0,kr.Z)(function*(){const{clientGraphics:U,queryArea:ne,location:fe}=yield A._popupHitTestGraphics(T,x),Oe=A._getFetchPopupLayerViews(),{layerViewsAndGraphics:we,clientOnlyGraphics:Ze}=A._graphicsPerFetchPopupLayerView(U,Oe);return{clientOnlyGraphics:Ze,layerViewsAndGraphics:we,queryArea:ne,location:fe}})()}_popupHitTestGraphics(T,x){var A=this;return(0,kr.Z)(function*(){const{results:U,mapPoint:ne}=yield A.popupHitTest(T),fe=U.filter(we=>"graphic"===we.type&&A._isValidPopupGraphic(we.graphic,x)),Oe=fe.length?fe[0].mapPoint:null;return{clientGraphics:fe.map(we=>we.graphic),queryArea:ne,location:ne||Oe}})()}_getFetchPopupLayerViews(){const T=[];return this.allLayerViews.forEach(x=>{this._isValidPopupLayerView(x)&&T.push(x)}),(0,Qe.pC)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&T.push(this.graphicsView),T.reverse()}_isValidPopupLayerView(T){return(0,Qe.pC)(T)&&(!("layer"in T)||!T.suspended)&&"fetchPopupFeatures"in T}_graphicsPerFetchPopupLayerView(T,x){const A=[],U=new Map,ne=x.map(fe=>{const Oe=[];return U.set("layer"in fe?fe.layer:fe.graphics,Oe),{layerView:fe,graphics:Oe}});for(const fe of T){const Oe=U.get(fe.layer)||U.get(fe.sourceLayer)||null;Oe?Oe.push(fe):A.push(fe)}return{layerViewsAndGraphics:ne,clientOnlyGraphics:A}}};return _=(0,Ve._)([(0,Wr.j)("esri.views.PopupView")],_),_};var Z8=v(97478),wu=v(59213),rA=v(60330),sA=v(51815);let bh=class extends Ns.Z{constructor(d){super(d),this.view=null,this.baseLayerViews=new On.Z,this.referenceLayerViews=new On.Z,this._loadingHandle=(0,Ht.YP)(()=>this.view?.map?.basemap,_=>{_&&_.load().catch(()=>{})},Ht.nn)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const d=this.view?.map?.basemap;return!!d&&!!d.loaded&&(this.baseLayerViews.some(_=>_.updating)||this.referenceLayerViews.some(_=>_.updating))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],bh.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],bh.prototype,"baseLayerViews",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],bh.prototype,"referenceLayerViews",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],bh.prototype,"suspended",null),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],bh.prototype,"updating",null),bh=(0,Ve._)([(0,Wr.j)("esri.views.BasemapView")],bh);class $8{constructor(_,T,x){this.layer=_,this.view=T,this.layerViewImporter=x,this._controller=new AbortController,this._deferred=(0,ws.dD)(),this._started=!1,this.done=!1,(0,ws.fu)(this._controller.signal,()=>{const A=new ai.Z("cancelled:layerview-create","layerview creation cancelled",{layer:_});this._deferred.reject(A)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:_}=this;if(!_)return;const{layer:T,view:x}=this;T.emit("layerview-destroy",{view:x,layerView:_}),x.emit("layerview-destroy",{layer:T,layerView:_}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}start(){var _=this;return(0,kr.Z)(function*(){if(_._started)return;_._started=!0;const{_controller:{signal:T},layer:x,view:A}=_;_._map=A.map;try{let U,ne;if(yield x.load({signal:T}),"prefetchResources"in x&&(yield x.prefetchResources({signal:T})),x.createLayerView)U=yield x.createLayerView(A,{signal:T});else{if(!_.layerViewImporter.hasLayerViewModule(x))throw new ai.Z("layer:view-not-supported","No layerview implementation was found");const we=yield _.layerViewImporter.importLayerView(x);(0,ws.k_)(T),U="default"in we?new we.default({layer:x,view:A}):new we({layer:x,view:A})}const fe=()=>{ne=(0,Qe.hw)(ne),U.destroyed||U.destroy(),U.layer=null,U.parent=null,U.view=null,_.done=!0};ne=(0,ws.fu)(T,fe),(0,ws.k_)(T);try{yield U.when()}catch(we){throw fe(),we}if(!_._map?.allLayers?.includes(x))return fe(),void _._deferred.reject(new ai.Z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:x}));_.layerView=U,x.emit("layerview-create",{view:A,layerView:U}),A.emit("layerview-create",{layer:x,layerView:U}),_.done=!0,_._deferred.resolve(U)}catch(U){x.emit("layerview-create-error",{view:A,error:U}),A.emit("layerview-create-error",{layer:x,error:U}),_.done=!0,_._deferred.reject(new ai.Z("layerview:create-error","layerview creation failed",{layer:x,error:U}))}})()}}let jc=class extends Ns.Z{constructor(d){super(d),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new l_.t,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const _=this.view.map?.allLayers;if(_)for(const T of _)this.layerViewImporter.hasLayerViewModule(T)&&this.layerViewImporter.importLayerView(T)},this._reschedule=()=>((0,Qe.Wi)(this._workPromise)&&(this._workPromise=(0,ws.dD)(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles((0,gd.Os)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{const _=this.view.map;if(this._map!==_&&(this.clear(),this._map=_),(0,Qe.Wi)(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const T=[],x=ne=>{if(!(0,Qe.Wi)(ne))for(const fe of ne)fe&&(T.push(fe),this._createLayerView(fe),"layers"in fe&&fe.layers&&x(fe.layers))};for(const ne of this._rootCollectionNames)x(this.get(ne));this._refreshCollections();for(const[ne,fe]of this._layerLayerViewInfoMap)T.includes(ne)||(this._layerLayerViewInfoMap.delete(fe.layer),fe.destroy());const A=T.filter(ne=>"group"===ne.type).map(ne=>ne.layers),U=[_?.ground?.layers,_?.basemap?.baseLayers,_?.basemap?.referenceLayers,_?.layers,...A].filter(ne=>!!ne);this.addHandles(U.map(ne=>this._watchUpdatingTracking.addOnCollectionChange(()=>ne,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([(0,Ht.on)(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,Ht.YP)(()=>{const d=this.view,_=d?.map;return[_?.basemap,_?.ground,_?.layers,d?.ready]},()=>this._reschedule(),Ht.tX)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,(0,Qe.pC)(this._workPromise)&&(this._workPromise.reject((0,ws.zE)()),this._workPromise=null)}get _layersToLayerViews(){const d=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&d.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(d)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return(0,Qe.pC)(this._workPromise)||this._watchUpdatingTracking.updating||(0,El.oE)(this._layerLayerViewInfoMap,d=>!d.done)}get updatingRemaining(){let d=0;for(const _ of this._layerLayerViewInfoMap.values())_.done||++d;return d}clear(){if(!this.destroyed){for(const d of this._layerLayerViewInfoMap.values())d.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}whenLayerView(d){var _=this;return(0,kr.Z)(function*(){if(yield _._reschedule(),!_._layerLayerViewInfoMap.has(d))throw new ai.Z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:d});return _._layerLayerViewInfoMap.get(d).promise})()}_refreshCollections(){for(const[d,_]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(d),this.get(_),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(d,_,T){if(!d||!_)return void(_&&_.removeAll());let x=0;for(const A of d){const U=this._layerLayerViewInfoMap.get(A);if(!U||!U.layerView)continue;const ne=U.layerView;ne.layer=A,ne.parent=T,_.getItemAt(x)!==ne&&_.splice(x,0,ne),A.layers&&this._populateLayerViewsOwners(A.layers,ne.layerViews,ne),x+=1}x<_.length&&_.splice(x,_.length)}_createLayerView(d){if(this._layerLayerViewInfoMap.has(d))return this.view.ready&&this._layerLayerViewInfoMap.get(d).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");d.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(d)&&this.layerViewImporter.importLayerView(d);const _=new $8(d,this.view,this.layerViewImporter);_.promise.then(()=>this._refreshCollections(),T=>{T&&((0,ws.D_)(T)||"cancelled:layerview-create"===T.name)||Us.Z.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${d.title??"no title"}', id:'${d.id??"no id"}' of type '${d.type}'.`,{layer:d,error:T}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(d,_),this.view.ready&&_.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,Ve._)([(0,ke.Cb)()],jc.prototype,"_workPromise",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jc.prototype,"_watchUpdatingTracking",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jc.prototype,"_layersToLayerViews",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jc.prototype,"_rootCollectionNames",null),(0,Ve._)([(0,ke.Cb)()],jc.prototype,"layerViewImporter",void 0),(0,Ve._)([(0,ke.Cb)()],jc.prototype,"supportsGround",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jc.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jc.prototype,"updatingRemaining",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],jc.prototype,"view",void 0),jc=(0,Ve._)([(0,Wr.j)("esri.views.LayerViewManager")],jc);const Y8=jc;let mc=class extends Ns.Z{constructor(d){super(d),this.factor=1.5,this.offset=(0,li.vW)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,Ve._)([(0,ke.Cb)({type:Number})],mc.prototype,"factor",void 0),(0,Ve._)([(0,ke.Cb)({nonNullable:!0})],mc.prototype,"offset",void 0),(0,Ve._)([(0,ke.Cb)()],mc.prototype,"position",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,range:{min:0}})],mc.prototype,"size",void 0),(0,Ve._)([(0,ke.Cb)()],mc.prototype,"maskUrl",void 0),(0,Ve._)([(0,ke.Cb)()],mc.prototype,"maskEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],mc.prototype,"overlayUrl",void 0),(0,Ve._)([(0,ke.Cb)()],mc.prototype,"overlayEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],mc.prototype,"version",null),(0,Ve._)([(0,ke.Cb)({type:Boolean})],mc.prototype,"visible",void 0),mc=(0,Ve._)([(0,Wr.j)("esri.views.Magnifier")],mc);const iA=mc;var Fn=v(87091);let f_=class extends Ns.Z{constructor(d,_){super({}),this._stage=d,this._textureRequests=new Map,this._frameTask=_?.registerTask(Fn.T8.TEXTURE_UNLOAD)??Fn.sq}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(d=>this._releaseTextureRequest(d)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(d,_,T){const x=this.makeUid(d);let A=this._textureRequests.get(x);return A||(A={referenceCount:0,texture:_(),textureAsync:null,abortController:null,onRemove:T},this._stage&&(this._stage.add(A.texture),this._stage.loadImmediate(A.texture)),this._textureRequests.set(x,A)),A.referenceCount++,{uid:x,texture:A.texture,release:()=>this._release(x)}}_release(d){const _=this._textureRequests.get(d);_?(_.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+d),_.referenceCount--,_.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(d))):console.warn(`TextureCollection: texture doesn't exist: '${d}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(d){if(!this._textureRequests)return;const _=this._textureRequests.get(d);!_||_.referenceCount>0||(this._releaseTextureRequest(_),this._textureRequests.delete(d))}_releaseTextureRequest(d){d.onRemove&&d.onRemove(),d.texture?this._stage?.remove(d.texture):d.abortController&&(d.abortController.abort(),d.abortController=null)}makeUid(d,_=null){return(0,Qe.pC)(_)?`${d}.${_}px`:d}};(0,Ve._)([(0,ke.Cb)()],f_.prototype,"_frameTask",void 0),(0,Ve._)([(0,ke.Cb)()],f_.prototype,"updating",null),f_=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.TextureCollection")],f_);var nA=v(45458),HM=v(33786);function GM(d){return d.visible&&d.getEditableFlag(HM.bH.USER)&&d.getEditableFlag(HM.bH.MANAGER)}var $l=v(41900);class k8{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(_,T){const x=()=>_.stopPropagation();switch(_.type){case"pointer-move":oA(_.pointerType)&&this._pointerLocations.set(_.pointerId,{x:_.x,y:_.y,pointerType:_.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(x(),"end"===_.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!aA(_))break;const A=(0,$l.vT)(_),U=this._intersect(A,_.pointerType,T.forEachTool);if((0,Qe.Wi)(U))break;const ne=U.manipulator,fe=U.tool;!((0,Qe.pC)(ne)&&(0,Qe.pC)(fe)&&ne.interactive)||ne.grabbable&&ne.grabbableForEvent(_)||!ne.grabbing||ne.dragging||this._ungrabManipulatorBeforeDragging(ne,_,T),(0,Qe.pC)(ne)&&(0,Qe.pC)(fe)&&ne.interactive&&ne.grabbable&&ne.grabbableForEvent(_)&&!ne.grabbing&&(this._grabbedManipulators.set(_.pointerId,{manipulator:ne,tool:fe,start:A,pointerType:_.pointerType}),1===this._grabbedManipulators.size&&(0,Qe.Wi)(T.activeTool)&&(this._revertToNullActiveTool=!0,T.setActiveTool(U.tool)),ne.grabbing=!0,ne.events.emit("grab-changed",{action:"start",pointerType:_.pointerType,screenPoint:A}),x());break}case"pointer-up":this._draggedManipulators.has(_.pointerId)||this._handlePointerEnd(_,T);break;case"pointer-drag":{if(!aA(_))break;const A=this._grabbedManipulators.get(_.pointerId),U=(0,Qe.yw)(A,({manipulator:Ze})=>Ze),ne=(0,Qe.yw)(A,({tool:Ze})=>Ze);if((0,Qe.Wi)(U)||(0,Qe.Wi)(ne))break;const fe=(0,$l.vT)(_);fe.x=(0,xr.uZ)(fe.x,0,T.view.width),fe.y=(0,xr.uZ)(fe.y,0,T.view.height);const Oe=(0,Qe.Wg)(A).start,we=this._draggedManipulators.get(_.pointerId);switch(_.action){case"start":case"update":"update"!==_.action&&1!==this._grabbedManipulators.size||(U.dragging=!0,U.events.emit("drag",we?{action:"update",start:Oe,screenPoint:fe}:{action:"start",start:Oe,screenPoint:fe,pointerType:_.pointerType}),this._draggedManipulators.set(_.pointerId,{tool:ne,manipulator:U,start:Oe}));break;case"end":U.dragging=!1,we&&U.events.emit("drag",{action:"end",start:Oe,screenPoint:fe}),this._draggedManipulators.delete(_.pointerId),this._handlePointerEnd(_,T)}x();break}case"immediate-click":{const A=(0,$l.vT)(_),U=this._intersect(A,_.pointerType,T.forEachTool);if(function J8(d){return!!d.native.shiftKey}(_)||T.forEachTool(we=>{if((!(0,Qe.pC)(U)||U.tool!==we||we.automaticManipulatorSelection)&&we.manipulators){let Ze=!1;we.manipulators.forEach(({manipulator:it})=>{it.selected&&(it.selected=!1,Ze=!0)}),Ze&&we.onManipulatorSelectionChanged&&we.onManipulatorSelectionChanged()}}),(0,Qe.Wi)(U))break;const{manipulator:ne,tool:fe}=U;if(!ne.interactive)break;ne.selectable&&fe.automaticManipulatorSelection&&(ne.selected=!ne.selected,fe.onManipulatorSelectionChanged&&fe.onManipulatorSelectionChanged()),ne.events.emit("immediate-click",{screenPoint:A,button:_.button,pointerType:_.pointerType,shiftKey:_.native.shiftKey,stopPropagation:x});break}case"click":{const A=(0,$l.vT)(_),U=this._intersect(A,_.pointerType,T.forEachTool),ne=(0,Qe.pC)(U)?U.manipulator:null;if((0,Qe.Wi)(ne)||!ne.interactive)break;ne.events.emit(_.type,{screenPoint:A,button:_.button,pointerType:_.pointerType,shiftKey:_.native.shiftKey}),x();break}case"double-click":{const A=(0,$l.vT)(_),U=this._intersect(A,_.pointerType,T.forEachTool),ne=(0,Qe.pC)(U)?U.manipulator:null;if((0,Qe.Wi)(ne)||!ne.interactive)break;ne.events.emit("double-click",{screenPoint:A,button:_.button,pointerType:_.pointerType,shiftKey:_.native.shiftKey,stopPropagation:x});break}case"immediate-double-click":{const A=(0,$l.vT)(_),U=this._intersect(A,_.pointerType,T.forEachTool),ne=(0,Qe.pC)(U)?U.manipulator:null;if((0,Qe.Wi)(ne)||!ne.interactive)break;ne.events.emit("immediate-double-click",{screenPoint:A,button:_.button,pointerType:_.pointerType,shiftKey:_.native.shiftKey,stopPropagation:x});break}}this._onFocusChange(T.forEachTool)}_ungrabManipulatorBeforeDragging(_,T,x){_.grabbing=!1,_.events.emit("grab-changed",{action:"end",pointerType:T.pointerType,screenPoint:(0,$l.vT)(T)}),this._grabbedManipulators.forEach(({manipulator:A},U)=>{A===_&&this._grabbedManipulators.delete(U)}),this._afterManipulatorUngrab(x.setActiveTool)}_handlePointerEnd(_,T){const x=(0,Qe.yw)(this._grabbedManipulators.get(_.pointerId),({manipulator:A})=>A);(0,Qe.Wi)(x)||x.grabbing&&(x.grabbing=!1,x.events.emit("grab-changed",{action:"end",pointerType:_.pointerType,screenPoint:(0,$l.vT)(_)}),this._grabbedManipulators.delete(_.pointerId),this._afterManipulatorUngrab(T.setActiveTool))}_cursorFromMap(_){let T=null;return(0,El.oE)(_,({manipulator:x})=>!((0,Qe.Wi)(x)||!x.interactive||(x.grabbing&&x.grabCursor?(T=x.grabCursor,0):!x.cursor||(T=x.cursor,0)))),T}_onFocusChange(_){this._updateCursor(),this._updateFocusedManipulatorTools(_)}_updateCursor(){this._cursor=this._grabbedManipulators.size>0?this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursorFromMap(this._hoveredManipulators)||"pointer":null}_updateFocusedManipulatorTools(_){const T=new Set,x=new Set;this._grabbedManipulators.forEach(({tool:A})=>{T.add(A)}),this._hoveredManipulators.forEach(({tool:A})=>{x.add(A)}),_(A=>{A.hasGrabbedManipulators=T.has(A),A.hasHoveredManipulators=x.has(A);const U=this._grabbedManipulators.values(),ne=(0,DD.sE)(U,({tool:fe})=>fe===A);A.firstGrabbedManipulator=(0,Qe.pC)(ne)?ne.manipulator:null})}clearPointers(_,{forEachTool:T,setActiveTool:x},A=!0,U){const ne=(fe,Oe)=>fe===_&&((0,Qe.Wi)(U)||U===Oe);this._grabbedManipulators.forEach(({tool:fe,manipulator:Oe,pointerType:we},Ze)=>{ne(fe,Oe)&&(this._grabbedManipulators.delete(Ze),Oe.grabbing=!1,Oe.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:we}))}),this._draggedManipulators.forEach(({tool:fe,manipulator:Oe},we)=>{ne(fe,Oe)&&(this._draggedManipulators.delete(we),Oe.dragging=!1,Oe.events.emit("drag",{action:"cancel"}))}),A&&this._hoveredManipulators.forEach(({tool:fe,manipulator:Oe},we)=>{ne(fe,Oe)&&(this._hoveredManipulators.delete(we),Oe.hovering=!1)}),this._afterManipulatorUngrab(x),this._onFocusChange(T)}_intersect(_,T,x){let A=null;return x(U=>{if(null==U.manipulators||!GM(U))return!1;const ne=U.manipulators.intersect(_,T);return!(0,Qe.Wi)(ne)&&(A={tool:U,manipulator:ne},!0)}),A}updateHoveredStateFromKnownPointers(_){this._pointerLocations.forEach((T,x)=>{this._updateHoveredStateForPointerAtScreenPosition((0,li.vW)(T.x,T.y),x,T.pointerType,_)})}handleHoverEvent(_,T){"pointer-up"!==_.type&&"immediate-click"!==_.type&&"pointer-move"!==_.type||!oA(_.pointerType)||this._updateHoveredStateForPointerAtScreenPosition((0,$l.vT)(_),_.pointerId,_.pointerType,T)}_updateHoveredStateForPointerAtScreenPosition(_,T,x,A){let U=this._intersect(_,x,A);const ne=(0,Qe.yw)(this._hoveredManipulators.get(T),({manipulator:fe})=>fe);(0,Qe.pC)(U)&&!U.manipulator.interactive&&(U=null),(0,Qe.pC)(U)&&ne===U.manipulator||((0,Qe.pC)(ne)&&(ne.hovering=!1),(0,Qe.pC)(U)?(U.manipulator.hovering=!0,this._hoveredManipulators.set(T,U)):this._hoveredManipulators.delete(T),this._onFocusChange(A))}_afterManipulatorUngrab(_){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(_(null),this._revertToNullActiveTool=!1)}}function oA(d){return"mouse"===d}function aA(d){return"mouse"!==d.pointerType||0===d.button}const lA="attached",KM="tools";let Td=class extends Ip.r{constructor(d){super(d),this._manipulatorState=new k8,this.tools=new On.Z,this.cursor=null,this._forEachTool=_=>{for(const T of this.tools.items)if(_(T))return}}initialize(){var d;this.handles.add([this.view.on(nA.uS,d=>{this._handleInputEvent(d)},Km.f.TOOL),...(d=this.tools,[d.on("before-add",_=>{const T=_.item;if(null==T||d.includes(T))return Us.Z.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void _.preventDefault();T.onAdd()}),d.on("after-remove",_=>{const T=_.item;T.active&&(T.view.activeTool=null),T.destroy()})]),this.tools.on("before-add",({item:d})=>{this._updateToolEditableFlag(d)}),this.tools.on("before-remove",({item:d})=>{this._manipulatorState.clearPointers(d,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:d=>{this.activeTool=d},view:this.view}}set activeTool(d){if((0,Qe.pC)(d)&&!this.view.ready)return void Us.Z.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(d===this.activeTool)return;const _=this.activeTool;this._set("activeTool",d),(0,Qe.pC)(_)&&_.deactivate(),(0,Qe.pC)(d)&&d.activate(),this._removeIncompleteTools(d);for(const T of this.tools){this._updateToolEditableFlag(T);const x=GM(T);!(0,Qe.Wi)(this.activeTool)&&x||this._manipulatorState.clearPointers(T,this._manipulatorStateEventArgs,!x)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some(d=>d.updating)||(this.textures?.updating??!1)}attach(){"3d"===this.view.type?(this._set("textures",new f_(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([(0,Ht.YP)(()=>{const{state:d}=this.view;return"camera"in d&&d.camera},()=>{this._forEachManipulator(d=>{null!=d.onViewChange&&d.onViewChange()})}),this.view.elevationProvider.on("elevation-change",d=>{this._forEachManipulator(_=>{null!=_.onElevationChange&&_.onElevationChange(d)})}),(0,Sp.kB)(()=>this._set("textures",(0,Qe.SC)(this.textures)))],lA)):this.handles.add((0,Ht.YP)(()=>this.view.extent,()=>{this._forEachManipulator(d=>{null!=d.onViewChange&&d.onViewChange()})}))}detach(){(0,Qe.pC)(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(lA)}_forEachManipulator(d){this._forEachTool(_=>{_.manipulators&&_.manipulators.forEach(({manipulator:T})=>d(T,_))})}_handleInputEvent(d){let _=!1;const T={...d,stopPropagation:()=>{_=!0,d.stopPropagation()}};(0,Qe.pC)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(T):this._forEachTool(x=>{!_&&x.visible&&x.handleInputEvent(T)}),!_&&"key-down"===d.type&&"Escape"===d.key&&this.activeTool&&(d.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(T,this._manipulatorStateEventArgs),!_&&(0,Qe.pC)(this.activeTool)&&this.activeTool.handleInputEventAfter(T),this._manipulatorState.handleHoverEvent(T,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(KM),this._forEachTool(d=>{if(d instanceof Ns.Z){const _=(0,Ht.YP)(()=>[d.cursor,d.visible,d.editable],()=>{GM(d)||this._manipulatorState.clearPointers(d,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(_,KM)}d.manipulators&&this.handles.add([d.manipulators.on("after-remove",_=>{this._manipulatorState.clearPointers(d,this._manipulatorStateEventArgs,!0,_.item.manipulator)}),d.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],KM)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(d){d.setEditableFlag(HM.bH.MANAGER,(0,Qe.Wi)(this.activeTool)||d===this.activeTool)}_updateCursor(){let d=this._manipulatorState.cursor;(0,Qe.Wi)(d)&&this._forEachTool(_=>!(!(0,Qe.pC)(_.cursor)||!_.visible||(d=_.cursor,0))),this._get("cursor")!==d&&this._set("cursor",d)}_removeIncompleteTools(d){this.tools.filter(_=>((0,Qe.Wi)(d)||_!==d)&&!_.created&&_.removeIncompleteOnCancel).forEach(_=>{this.tools.remove(_)})}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0,nonNullable:!0})],Td.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,nonNullable:!0})],Td.prototype,"textures",void 0),(0,Ve._)([(0,ke.Cb)({value:null})],Td.prototype,"activeTool",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:On.Z})],Td.prototype,"tools",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Td.prototype,"cursor",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Td.prototype,"updating",null),Td=(0,Ve._)([(0,Wr.j)("esri.views.ToolViewManager")],Td);const Q8=Td;let m_=class extends Ns.Z{constructor(d){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",this._detectedDeviceType="standard"===d.mapping?"standard":q8.test(d.id)?"spacemouse":"unknown",this.nativeIndex=d.index}get native(){const d=navigator.getGamepads?navigator.getGamepads():[];return null!=this.nativeIndex&&this.nativeIndex<d.length?d[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return eB[this.deviceType]}};(0,Ve._)([(0,ke.Cb)({nonNullable:!0,readOnly:!0})],m_.prototype,"nativeIndex",void 0),(0,Ve._)([(0,ke.Cb)({type:String,readOnly:!0})],m_.prototype,"deviceType",null),(0,Ve._)([(0,ke.Cb)({type:Number,readOnly:!0})],m_.prototype,"axisThreshold",null),m_=(0,Ve._)([(0,Wr.j)("esri.views.input.gamepad.GamepadInputDevice")],m_);const q8=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),eB={standard:.15,spacemouse:.025,unknown:0},ZM=m_;let Ym=class extends Ns.Z{constructor(...d){super(...d),this.devices=new On.Z,this.enabledFocusMode="document"}};(0,Ve._)([(0,ke.Cb)({type:On.Z.ofType(ZM),readOnly:!0})],Ym.prototype,"devices",void 0),(0,Ve._)([(0,ke.Cb)({type:["document","view","none"]})],Ym.prototype,"enabledFocusMode",void 0),Ym=(0,Ve._)([(0,Wr.j)("esri.views.input.gamepad.GamepadSettings")],Ym);const tB=Ym;let Jv=class extends Ns.Z{constructor(){super(...arguments),this.gamepad=new tB}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Jv.prototype,"gamepad",void 0),Jv=(0,Ve._)([(0,Wr.j)("esri.views.input.Input")],Jv);const rB=Jv;let Ch=class extends Ns.Z{constructor(d){super(d),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,Ve._)([(0,ke.Cb)({type:Boolean,nonNullable:!0})],Ch.prototype,"enabled",void 0),(0,Ve._)([(0,ke.Cb)({type:ZM})],Ch.prototype,"device",void 0),(0,Ve._)([(0,ke.Cb)({type:["pan","zoom"],nonNullable:!0})],Ch.prototype,"mode",void 0),(0,Ve._)([(0,ke.Cb)({type:["forward-down","forward-up"],nonNullable:!0})],Ch.prototype,"tiltDirection",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0})],Ch.prototype,"velocityFactor",void 0),Ch=(0,Ve._)([(0,Wr.j)("esri.views.navigation.gamepad.GamepadSettings")],Ch);const cA=Ch;let Vp=class extends Ns.Z{constructor(d){super(d),this.browserTouchPanEnabled=!0,this.gamepad=new cA,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};(0,Ve._)([(0,ke.Cb)({type:Boolean})],Vp.prototype,"browserTouchPanEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:cA,nonNullable:!0})],Vp.prototype,"gamepad",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Vp.prototype,"momentumEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Vp.prototype,"mouseWheelZoomEnabled",void 0),Vp=(0,Ve._)([(0,Wr.j)("esri.views.navigation.Navigation")],Vp);const uA=Vp;var dA=v(36947),vi=v(59617);let $M,YM=null;function sB(d){return XM.apply(this,arguments)}function XM(){return(XM=(0,kr.Z)(function*(d){YM||(YM=Promise.resolve().then(v.bind(v,35082)).then(_=>$M=_)),yield YM,(0,ws.k_)(d)})).apply(this,arguments)}function hA(d,_,T,x){return kM.apply(this,arguments)}function kM(){return(kM=(0,kr.Z)(function*(d,_,T,x){if(!d)return null;const A=d.spatialReference;return(0,di.kR)()||(0,di.Up)(A,_)?(0,di.iV)(d,_):$M?$M.projectGeometry(d,_,T,x):(yield Promise.race([sB(x),(0,di.zD)(x)]),hA(d,_,T,x))})).apply(this,arguments)}let Nn=class extends Ns.Z{constructor(d){super(d),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,Qe.IM)(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return(0,Qe.pC)(this.userSpatialReference)?this.userSpatialReference:(0,Qe.Wg)(this._spatialReferenceTask.spatialReference)}get extent(){return(0,Qe.Wg)(this._extentTask.extent)}get heightModelInfo(){return(0,Qe.Wg)(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return(0,Qe.Wg)(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return(0,Qe.Wg)(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return(0,Qe.Wi)(this.userSpatialReference)||this.userSpatialReference.equals((0,Qe.Wg)(this._spatialReferenceTask.spatialReference))?(0,Qe.Wg)(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return(0,Qe.Wg)(this._tileInfoTask.tileInfo)}get mapCollections(){const d=this.map?.(),_=[];return(0,Qe.pC)(this.priorityCollection)&&_.push(this.priorityCollection),_.push({parent:d?.basemap,layers:d?.basemap?.baseLayers},{layers:d?.layers},{parent:d?.ground,layers:d?.ground?.layers},{parent:d?.basemap,layers:d?.basemap?.referenceLayers}),_}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:d,updating:_}=this._allLayers;let T=null;for(const A of d){const U=this._getSupportedSpatialReferences(A);if(U.length>0){const ne=this._narrowDownSpatialReferenceCandidates(T,U);(0,Qe.pC)(ne)&&(T=ne)}if((0,Qe.pC)(T)&&1===T.length)break}if(_&&((0,Qe.Wi)(T)||1!==T.length))return{updating:!0};const x=this._pickSpatialReferenceCandidate(T);return{spatialReference:(0,Qe.pC)(x)?x.spatialReference:null,viewingMode:(0,Qe.pC)(x)?x.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:d,updating:_}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(d&&d.length>0&&"tileInfo"in d[0]){const T=d[0].tileInfo;return{tileInfo:T&&T.spatialReference.equals(this.spatialReference)?T:null,updating:!1}}return{updating:_}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:d,updating:_}=this._allLayers;for(const T of d)if((0,dA.qC)(T)){const x=(0,dA.Ku)(T);if(x)return{heightModelInfo:x,vcsWkid:T.spatialReference?.vcsWkid,latestVcsWkid:T.spatialReference?.latestVcsWkid,updating:!1}}return{updating:_}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const d=this._allLayers,_=d.updating,T=[];for(const x of d.layers){const A="fullExtents"in x&&x.fullExtents||((0,Qe.pC)(x.fullExtent)?[x.fullExtent]:[]),U=this.requiresExtentInSpatialReference?null:A[0],ne=A.find(fe=>fe.spatialReference.equals(this.spatialReference))??U;if(ne)return{candidates:[{extent:ne,layer:x}],updating:!1};if(this._getSupportedSpatialReferences(x).length>0)for(const fe of A)T.push({extent:fe,layer:x})}return{candidates:T,updating:_}}get _extentTask(){var d=this;const{candidates:_,updating:T}=this._extentCandidatesTask;if(T)return{updating:T};if((0,Qe.Wi)(_)||0===_.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const x=this._pickExtentCandidate(_),A=this.spatialReference;return x.extent.equals(this._projectExtentTask.input)&&A.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:(0,Qe.pC)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:((0,Qe.pC)(this._projectExtentTask.task)&&(this._projectExtentTask.task=(0,Qe.IM)(this._projectExtentTask.task)),this._projectExtentTask={input:x.extent.clone(),output:null,spatialReference:A.clone(),task:(0,wu.vr)(function(){var U=(0,kr.Z)(function*(ne){try{const fe=yield hA(x.extent,A,x.layer.portalItem,ne);d._projectExtentTask={...d._projectExtentTask,task:null,output:fe}}catch{if((0,ws.Hc)(ne))return;d._projectExtentTask={...d._projectExtentTask,task:null}}});return function(ne){return U.apply(this,arguments)}}())},{updating:!0})}_narrowDownSpatialReferenceCandidates(d,_){if((0,Qe.Wi)(d))return _;const T=[],x=(A,U)=>(0,Qe.pC)(A)?(0,Qe.pC)(U)?A===U&&A:A:U;for(const A of d)for(const U of _){if(!A.spatialReference.equals(U.spatialReference))continue;const ne=x(A.viewingMode,U.viewingMode);if(!1!==ne){T.push({spatialReference:A.spatialReference,viewingMode:ne});break}}return T.length>0?T:null}_pickSpatialReferenceCandidate(d){const _=this.defaultSpatialReference;return(0,Qe.Wi)(d)||d.length<1?(0,Qe.pC)(_)?{spatialReference:_,viewingMode:null}:null:((0,Qe.pC)(_)&&d.length>1&&d.some(({spatialReference:T})=>T.equals(_))&&(d=d.filter(({spatialReference:T})=>T.equals(_))),d.length>1&&d.some(({viewingMode:T})=>T!==vi.JY.Local)&&(d=d.filter(({viewingMode:T})=>T!==vi.JY.Local)),d[0])}_getSupportedSpatialReferences(d){const _="supportedSpatialReferences"in d&&d.supportedSpatialReferences||(d.spatialReference?[d.spatialReference]:[]);if(0===_.length)return[];const T=[];for(const x of _){const A=this.getSpatialReferenceSupport({spatialReference:x,layer:d});if((0,Qe.pC)(A)){const U=(0,Qe.pC)(A.constraints)?A.constraints:[{spatialReference:x,viewingMode:null}];for(const{spatialReference:ne,viewingMode:fe}of U)(!this.requiresExtentInSpatialReference||(0,Qe.Wi)(this.userSpatialReference)||ne.equals(this.userSpatialReference))&&T.push({spatialReference:ne,viewingMode:fe})}}return T}_pickExtentCandidate(d){const _=this.spatialReference;return d.find(({extent:T})=>_.equals(T.spatialReference))||d[0]}_collectLayers(d){if("loaded"!==this._loadMaybe(this.map?.()))return{layers:[],updating:!0};const _={layers:[],preloading:-1,updating:!1};for(const T of d)if(this._collectCollection(T,_),_.preloading===this.sourcePreloadCount)break;return{layers:_.layers,updating:_.updating}}_collectCollection(d,_){if(d.layers){switch(this._loadMaybe(d.parent)){case"loading":return _.updating=!0,void++_.preloading;case"failed":return}for(const T of d.layers){switch(this._loadMaybe(T)){case"failed":continue;case"loading":_.updating=!0,++_.preloading;break;case"loaded":_.updating||_.layers.push(T),"layers"in T&&this._collectCollection({layers:T.layers},_)}if(_.preloading===this.sourcePreloadCount)break}}}_loadMaybe(d){return d&&"loadStatus"in d?"not-loaded"===d.loadStatus?(d.load().catch(()=>{}),"loading"):d.loadStatus:"loaded"}};var Qv;(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"required",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Nn.prototype,"map",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Nn.prototype,"getSpatialReferenceSupport",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"defaultSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"userSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"sourcePreloadCount",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"priorityCollection",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"requiresExtentInSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"suspended",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"ready",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"heightModelInfoReady",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"heightModelInfo",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"vcsWkid",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"latestVcsWkid",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"viewingMode",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"tileInfo",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"mapCollections",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"_allLayers",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"_spatialReferenceTask",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"_tileInfoTask",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"_heightModelInfoTask",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Nn.prototype,"_extentCandidatesTask",null),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"_extentTask",null),(0,Ve._)([(0,ke.Cb)()],Nn.prototype,"_projectExtentTask",void 0),Nn=(0,Ve._)([(0,Wr.j)("esri.views.support.DefaultsFromMap")],Nn);let Ti=Qv=class extends((0,Ip.p)(Va.Z.EventedMixin((0,rA.v)(Ns.Z)))){constructor(d){super(d),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Sv.Z({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:_=>_.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new sA.J,this.analyses=new a_,this.typeSpecificPreconditionsReady=!0,this.layerViews=new On.Z,this.magnifier=new iA,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new rB,this.navigation=new uA,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new nA.CE(this),this.persistableViewModels=new On.Z,this._isValid=!1,this._readyCycleForced=!1,this.handles.add((0,Ht.YP)(()=>this.preconditionsReady,_=>{_?(this._currentSpatialReference=this.spatialReference,Qv.views.add(this)):(this._currentSpatialReference=null,Qv.views.remove(this)),this.notifyChange("spatialReference"),!_&&this.ready?(this.toolViewManager?.detach(),(0,Qe.pC)(this.analysisViewManager)&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):_&&!this.ready&&(this._startup(),(0,Qe.pC)(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Ht.Z_))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,(0,Ht.N1)(()=>this.ready)))),this.basemapView=new bh({view:this}),this.layerViewManager=new Y8({view:this,layerViewImporter:{importLayerView:d=>this.importLayerView(d),hasLayerViewModule:d=>this.hasLayerViewModule(d)},supportsGround:this.supportsGround}),this.toolViewManager=new Q8({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,Ht.YP)(()=>this.initialExtentRequired,d=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:d},{sync:!0,initial:!0}),(0,Ht.YP)(()=>this.ready,d=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=d,this.defaultsFromMap.userSpatialReference=d?this.spatialReference:this._userSpatialReference)},{sync:!0}),(0,Ht.YP)(()=>this._userSpatialReference,d=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=d)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){var d=this;let _=null;this.handles.add([(0,Ht.YP)(()=>this.defaultsFromMap?.ready,T=>{if(T&&!this.spatialReference&&this.map?.allLayers.length>0){if((0,Qe.pC)(_))return;const A=(0,Sp.kB)(()=>_=(0,Qe.IM)(_));_=(0,wu.vr)(function(){var U=(0,kr.Z)(function*(ne){try{yield(0,ws.e4)(d.spatialReferenceWarningDelay,null,ne)}catch{return}finally{_=null}Us.Z.getLogger(d.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")});return function(ne){return U.apply(this,arguments)}}()),this.handles.add(A,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,Qe.SC)(this.graphics),this.analyses=(0,Qe.SC)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,Qe.SC)(this.analysisViewManager),this.toolViewManager=(0,Qe.SC)(this.toolViewManager),this.layerViewManager=(0,Qe.SC)(this.layerViewManager),this.basemapView=(0,Qe.SC)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const d=this.map;this.map=null,d?.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Us.Z.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(d){this.toolViewManager&&(this.toolViewManager.activeTool=d)}get animation(){return this._get("animation")}set animation(d){this._set("animation",d)}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Nn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:d=>this.getSpatialReferenceSupport(d),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(d){this._set("extent",d)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||OT.Z.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}set map(d){d!==this._get("map")&&(d?.destroyed&&(Us.Z.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:d}),d=null),OT.Z.isLoadable(d)&&d.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",d))}get spatialReference(){let d=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return d&&this.defaultsFromMap?.required?.heightModelInfo&&(d=d.clone(),d.vcsWkid=this.defaultsFromMap.vcsWkid,d.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),d}set spatialReference(d){const _=!(0,hc.fS)(d,this._get("spatialReference"));this._set("_userSpatialReference",d),_&&(this._set("spatialReference",d),this._spatialReferenceChanged(d))}_spatialReferenceChanged(d){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const d=this.toolViewManager?this.toolViewManager.cursor:null;return(0,Qe.pC)(d)?d:this._cursor||"default"}set cursor(d){this._cursor=d,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(d){return this.layerViewManager.whenLayerView(d)}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(d){throw new ai.Z("importLayerView() not implemented")}hasLayerViewModule(d){return!1}validate(){return(0,kr.Z)(function*(){})()}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(d){return(0,Qe.pC)(this.getSpatialReferenceSupport({spatialReference:d}))}when(d,_){return this.isResolved()&&!this.ready&&Us.Z.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(d,_)}forceReadyCycle(){this.ready&&((0,Ht.gx)(()=>!1===this.preconditionsReady,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(d){this.toolViewManager.tools.add(d),this.activeTool=d}tryFatalErrorRecovery(){this.fatalError=null}};Ti.views=new On.Z,(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"_userSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"activeTool",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"allLayerViews",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"groundView",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"animation",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"basemapView",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"_defaultsFromMapSettings",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"defaultsFromMap",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"fatalError",void 0),(0,Ve._)([(0,ke.Cb)({type:bl.Z})],Ti.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)((0,Av.z)(sA.J,"graphics"))],Ti.prototype,"graphics",void 0),(0,Ve._)([(0,ke.Cb)((0,Av.z)(a_,"analyses"))],Ti.prototype,"analyses",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:AD.Z})],Ti.prototype,"heightModelInfo",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"interacting",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"navigating",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Ti.prototype,"preconditionsReady",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"typeSpecificPreconditionsReady",void 0),(0,Ve._)([(0,ke.Cb)({type:On.Z,readOnly:!0})],Ti.prototype,"layerViews",void 0),(0,Ve._)([(0,ke.Cb)({type:iA})],Ti.prototype,"magnifier",void 0),(0,Ve._)([(0,ke.Cb)({value:null,type:PD})],Ti.prototype,"map",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"padding",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"ready",void 0),(0,Ve._)([(0,ke.Cb)({type:to.Z})],Ti.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"spatialReferenceWarningDelay",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"stationary",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"supportsGround",void 0),(0,Ve._)([(0,ke.Cb)({type:Z8.Z})],Ti.prototype,"timeExtent",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"tools",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"toolViewManager",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number})],Ti.prototype,"scale",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"updating",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"initialExtentRequired",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"initialExtent",null),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"cursor",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"input",void 0),(0,Ve._)([(0,ke.Cb)({type:uA,nonNullable:!0})],Ti.prototype,"navigation",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"layerViewManager",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"analysisViewManager",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"width",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"height",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"resizing",void 0),(0,Ve._)([(0,ke.Cb)({value:null,readOnly:!0})],Ti.prototype,"size",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"suspended",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"viewEvents",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ti.prototype,"persistableViewModels",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"_isValid",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"_readyCycleForced",void 0),(0,Ve._)([(0,ke.Cb)()],Ti.prototype,"_currentSpatialReference",void 0),Ti=Qv=(0,Ve._)([(0,Wr.j)("esri.views.View")],Ti);const iB=Ti;let Th=class extends rA.D{constructor(d){super(d),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((d,_)=>this._dfd={resolve:d,reject:_}))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd?.reject(new ai.Z("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd?.resolve())}update(d,_){_||(_=(0,ws.y8)(d)?"waiting-for-target":"running"),this._set("target",d),this._set("state",_)}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Th.prototype,"done",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:String})],Th.prototype,"state",void 0),(0,Ve._)([(0,ke.Cb)()],Th.prototype,"target",void 0),Th=(0,Ve._)([(0,Wr.j)("esri.views.ViewAnimation")],Th),(Th||(Th={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const g_=Th,Xm=()=>Promise.all([v.e(8592),v.e(8562)]).then(v.bind(v,8562)),pA=()=>Promise.all([v.e(8592),v.e(4976)]).then(v.bind(v,64976)),_A={"base-dynamic":()=>Promise.all([v.e(9759),v.e(5627)]).then(v.bind(v,95627)),"base-elevation":pA,"base-tile":Xm,"bing-maps":Xm,"building-scene":()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(2144),v.e(4341),v.e(9410),v.e(3279),v.e(8592),v.e(8068)]).then(v.bind(v,81736)),csv:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(4048)]).then(v.bind(v,84048)),dimension:()=>v.e(6886).then(v.bind(v,26886)),elevation:pA,feature:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(6446)]).then(v.bind(v,16446)),geojson:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(4937)]).then(v.bind(v,54937)),graphics:()=>Promise.all([v.e(1832),v.e(8592),v.e(1561)]).then(v.bind(v,62359)),group:()=>v.e(961).then(v.bind(v,961)),imagery:()=>Promise.all([v.e(9759),v.e(4366)]).then(v.bind(v,4366)),"integrated-mesh":()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(2144),v.e(4341),v.e(4186)]).then(v.bind(v,4186)),"line-of-sight":()=>v.e(8325).then(v.bind(v,68325)),"map-image":()=>Promise.all([v.e(9759),v.e(8592),v.e(1955)]).then(v.bind(v,81955)),media:()=>Promise.all([v.e(8592),v.e(9094)]).then(v.bind(v,59094)),"ogc-feature":()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(3835)]).then(v.bind(v,3835)),"open-street-map":Xm,"oriented-imagery":()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(6446)]).then(v.bind(v,16446)),"point-cloud":()=>Promise.all([v.e(4471),v.e(8592),v.e(154)]).then(v.bind(v,61525)),voxel:()=>v.e(9991).then(v.bind(v,19991)),route:()=>Promise.all([v.e(1832),v.e(403),v.e(8592),v.e(5645)]).then(v.bind(v,62124)),scene:d=>null==d.profile||"mesh-pyramids"===d.profile?Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(2144),v.e(4341),v.e(3279),v.e(8592),v.e(15)]).then(v.bind(v,80015)):Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(2144),v.e(8592),v.e(9973)]).then(v.bind(v,39988)),stream:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(9372),v.e(937)]).then(v.bind(v,20937)),tile:Xm,"imagery-tile":()=>Promise.all([v.e(8594),v.e(8592),v.e(342)]).then(v.bind(v,10342)),"vector-tile":()=>Promise.all([v.e(8364),v.e(8592),v.e(921)]).then(v.bind(v,63038)),wcs:()=>Promise.all([v.e(8594),v.e(8592),v.e(342)]).then(v.bind(v,10342)),"web-tile":Xm,wfs:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(1832),v.e(8203),v.e(126),v.e(8726)]).then(v.bind(v,68726)),wms:()=>Promise.all([v.e(9759),v.e(8592),v.e(8765)]).then(v.bind(v,48765)),wmts:()=>Promise.all([v.e(8592),v.e(6373)]).then(v.bind(v,6373)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null},mA="analyses-owner-handles";var y_,zp,d;(d=y_||(y_={}))[d.PENDING=0]="PENDING",d[d.CREATED=1]="CREATED",function(d){d[d.ADDED=0]="ADDED",d[d.REMOVED=1]="REMOVED"}(zp||(zp={}));let Hp=class extends Ip.r{constructor(d){super(d),this._allAnalysisViews=new On.Z,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=gA(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,ws.zE)("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,ws.zE)()),this._attachedToViewResolver=gA()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(d=>d.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}whenAnalysisView(d){var _=this;return(0,kr.Z)(function*(){yield _._attachedToViewResolver.promise;const T=_._items.get(d);if((0,Qe.Wi)(T)||T.state.list===zp.REMOVED)throw new ai.Z("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:d});return T.createAnalysisViewTask.promise})()}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),mA)}_disconnectOwners(){this.handles.remove(mA),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(d){for(const x of d)this._addAnalysis(x);const _=d.on("after-add",x=>this._addAnalysis(x.item)),T=d.on("after-remove",x=>this._removeAnalysis(x.item));return{remove:()=>{_.remove(),T.remove();for(const x of d)this._removeAnalysis(x)}}}_addAnalysis(d){const _=this._items.get(d);if(null==_){const T={state:{view:y_.PENDING,list:zp.ADDED},analysis:d,view:null,createAnalysisViewTask:null};this._items.set(d,T),T.createAnalysisViewTask=(0,wu.vr)(x=>this._createAnalysisViewPromise(T,x))}else _.state.list=zp.ADDED}_removeAnalysis(d){const _=this._items.get(d);null!=_?(_.state.list=zp.REMOVED,this._scheduleUpdate()):Us.Z.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){(0,Qe.pC)(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=(0,gd.Os)(()=>this._update()))}_update(){this._scheduledUpdateHandle=(0,Qe.hw)(this._scheduledUpdateHandle),this._items.forEach(d=>{if(d.state.list===zp.REMOVED)switch(this._items.delete(d.analysis),d.state.view){case y_.PENDING:d.createAnalysisViewTask=(0,Qe.IM)(d.createAnalysisViewTask);break;case y_.CREATED:(0,Qe.pC)(d.view)&&(this._allAnalysisViews.remove(d.view),d.view=(0,Qe.SC)(d.view),d.createAnalysisViewTask=null)}})}_createAnalysisViewPromise(d,_){var T=this;return(0,kr.Z)(function*(){const x=d.analysis,A=x.type,U=T._analysisModules[A];if(T._creatingViewCount+=1,(0,Qe.Wi)(U.module))try{U.module=yield T._loadAnalysisModule(A)}catch(fe){throw T._creatingViewCount-=1,fe}if((0,ws.Hc)(_))throw T._creatingViewCount-=1,(0,ws.zE)("AnalysisView creation aborted");const ne=new U.module.default({analysis:x,view:T.view});try{yield ne.when()}catch(fe){throw T._creatingViewCount-=1,fe}if((0,ws.Hc)(_))throw T._creatingViewCount-=1,ne.destroy(),(0,ws.zE)("AnalysisView creation aborted");return d.view=ne,d.state.view=y_.CREATED,T._allAnalysisViews.add(ne),T._creatingViewCount-=1,ne})()}_loadAnalysisModule(d){switch(d){case"area-measurement":return Promise.all([v.e(4918),v.e(5043),v.e(1329),v.e(6402),v.e(2943)]).then(v.bind(v,32943));case"dimension":return Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(125),v.e(5043),v.e(4828),v.e(1329),v.e(8592),v.e(73)]).then(v.bind(v,10073));case"direct-line-measurement":return Promise.all([v.e(4918),v.e(5043),v.e(6402),v.e(8592),v.e(6212)]).then(v.bind(v,96212));case"line-of-sight":return Promise.all([v.e(125),v.e(4828),v.e(8592),v.e(9862)]).then(v.bind(v,11467));case"slice":return Promise.all([v.e(125),v.e(9410),v.e(8592),v.e(9303)]).then(v.bind(v,47351))}}};function gA(){const d=(0,ws.hh)();return d.promise.catch(()=>{}),d}(0,Ve._)([(0,ke.Cb)()],Hp.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Hp.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],Hp.prototype,"_allAnalysisViews",void 0),(0,Ve._)([(0,ke.Cb)()],Hp.prototype,"_creatingViewCount",void 0),Hp=(0,Ve._)([(0,Wr.j)("esri.views.3d.analysis.AnalysisViewManager3D")],Hp);const oB=Hp;var gc=v(94425),sl=v(98943);let Md=class extends Ns.Z{constructor(d){super(d),this.collision=new km,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===vi.JY.Local?null:this._get("altitude")||null}set altitude(d){this.mode!==vi.JY.Local?this._set("altitude",d):Us.Z.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(d){return this.altitude?(0,xr.uZ)(d,this.altitude.min,this.altitude.max):d}clampTilt(d,_){if(!this.tilt)return _;const T=this.tilt(d);return(0,xr.uZ)(_,T.min,T.max)}clampDistance(d){return Math.min(d,this.distance)}createDefaultTilt(){return this.mode===vi.JY.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(d){return(_,T=JM)=>(T.min=Sa.min,T.max=d,T)}_createDefaultTiltLocal(){const d=this.collision.enabled?(0,sl.uV)([[4e3,Sa.max],[1e4,(0,xr.Vl)(88)],[6e6,(0,xr.Vl)(88)]]):()=>Sa.max;return(_,T=JM)=>(T.min=Sa.min,T.max=d(_),T)}_createDefaultTiltGlobal(){const d=(0,sl.uV)(this.collision.enabled?[[4e3,Sa.max],[5e4,(0,xr.Vl)(88)],[6e6,(0,xr.Vl)(88)],[2e7,Sa.min]]:[[3e5,Sa.max],[3e6,(0,xr.Vl)(88)],[6e6,(0,xr.Vl)(88)],[2e7,Sa.min]]);return(_,T=JM)=>(T.min=Sa.min,T.max=d(_),T)}};(0,Ve._)([(0,ke.Cb)()],Md.prototype,"altitude",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Md.prototype,"collision",void 0),(0,Ve._)([(0,ke.Cb)()],Md.prototype,"distance",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Md.prototype,"minimumPoiDistance",void 0),(0,Ve._)([(0,ke.Cb)()],Md.prototype,"tilt",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Md.prototype,"mode",void 0),Md=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.Constraints")],Md);const yA=function aB(d){return{min:-2e5,max:4*d.radius}}(gc.sv),Sa={min:(0,xr.Vl)(.5),max:(0,xr.Vl)(179.5)},JM={min:0,max:0};let km=class extends Ns.Z{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};(0,Ve._)([(0,ke.Cb)({type:Boolean})],km.prototype,"enabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Number})],km.prototype,"elevationMargin",void 0),km=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.Constraints.CollisionConstraint")],km);let v_=class extends Ns.Z{constructor(){super(...arguments),this.min=yA.min,this.max=yA.max}};(0,Ve._)([(0,ke.Cb)({type:Number})],v_.prototype,"min",void 0),(0,Ve._)([(0,ke.Cb)({type:Number})],v_.prototype,"max",void 0),v_=(0,Ve._)([(0,Wr.j)("esri.views.3d.constraints.AltitudeConstraint")],v_);let Pd=class extends Ns.Z{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(d){this._set("near",d),d>=this._get("far")&&(this.far=d+1e-9),this.mode="manual"}castNear(d){return Math.max(1e-8,d)}get far(){return this._get("far")}set far(d){this._set("far",d),d<=this._get("near")&&(this.near=d-1e-9),this.mode="manual"}castFar(d){return Math.max(1e-8,d)}autoUpdate(d,_){"auto"===this.mode&&(this._get("near")!==d&&this._set("near",d),this._get("far")!==_&&this._set("far",_))}};(0,Ve._)([(0,ke.Cb)({type:Number,value:1e-8})],Pd.prototype,"near",null),(0,Ve._)([(0,ko.p)("near")],Pd.prototype,"castNear",null),(0,Ve._)([(0,ke.Cb)({type:Number,value:1e-8})],Pd.prototype,"far",null),(0,Ve._)([(0,ko.p)("far")],Pd.prototype,"castFar",null),(0,Ve._)([(0,ke.Cb)({type:["auto","manual"]})],Pd.prototype,"mode",void 0),Pd=(0,Ve._)([(0,Wr.j)("esri.views.3d.constraints.ClipDistanceConstraint")],Pd);const QM={min:(0,xr.BV)(Sa.min),max:(0,xr.BV)(Sa.max)};let Gp=class extends Ns.Z{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(d){this._set("max",d),this.mode="manual"}castMax(d){return(0,xr.uZ)(d,QM.min,QM.max)}autoUpdate(d){"auto"===this.mode&&this._get("max")!==d&&this._set("max",d)}};(0,Ve._)([(0,ke.Cb)({type:["auto","manual"]})],Gp.prototype,"mode",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,value:QM.max})],Gp.prototype,"max",null),(0,Ve._)([(0,ko.p)("max")],Gp.prototype,"castMax",null),Gp=(0,Ve._)([(0,Wr.j)("esri.views.3d.constraints.TiltConstraint")],Gp);let Kp=class extends Ns.Z{constructor(){super(...arguments),this.tilt=new Gp,this.altitude=new v_,this.clipDistance=new Pd}};var qM;(0,Ve._)([(0,ke.Cb)({type:Gp})],Kp.prototype,"tilt",void 0),(0,Ve._)([(0,ke.Cb)({type:v_})],Kp.prototype,"altitude",void 0),(0,Ve._)([(0,ke.Cb)({type:Pd})],Kp.prototype,"clipDistance",void 0),Kp=(0,Ve._)([(0,Wr.j)("esri.views.3d.constraints.Constraints")],Kp);let Fc=qM=class extends zl.wq{constructor(d){super(d),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(d,_){return null!=_.datetime&&new Date(_.datetime)||null}writeDate(d,_,T){_[T]=d.getTime()}readDirectShadowsEnabled(d,_){return!!_.directShadows}writedirectShadowsEnabled(d,_,T){d&&(_[T]=d)}writeDisplayUTCOffset(d,_){null!=d&&(_.displayUTCOffset=d)}clone(){return new qM(this.cloneConstructProperties())}cloneConstructProperties(){const d={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(d.date=new Date(this.date.getTime())),d}};(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:["sun"],json:{write:!0}})],Fc.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Date,json:{type:Number,write:{target:"datetime"}}})],Fc.prototype,"date",void 0),(0,Ve._)([(0,wT.r)("date",["datetime"])],Fc.prototype,"readDate",null),(0,Ve._)([(0,wm.c)("date")],Fc.prototype,"writeDate",null),(0,Ve._)([(0,ke.Cb)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Fc.prototype,"directShadowsEnabled",void 0),(0,Ve._)([(0,wT.r)("directShadowsEnabled",["directShadows"])],Fc.prototype,"readDirectShadowsEnabled",null),(0,Ve._)([(0,wm.c)("directShadowsEnabled")],Fc.prototype,"writedirectShadowsEnabled",null),(0,Ve._)([(0,ke.Cb)({type:Number,json:{write:!0}})],Fc.prototype,"displayUTCOffset",void 0),(0,Ve._)([(0,wm.c)("displayUTCOffset")],Fc.prototype,"writeDisplayUTCOffset",null),Fc=qM=(0,Ve._)([(0,Wr.j)("esri.webscene.SunLighting")],Fc);const Jm=Fc;var E_;let Iu=E_=class extends(Va.Z.EventedMixin(Jm)){constructor(d){super(d),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const _=(new Date).getFullYear(),T=new Date("March 15, "+_+" 12:00:00 UTC");this._set("defaultDate",T),this._set("date",T)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(d){return new E_(d.cloneConstructProperties())}set defaultDate(d){const _=this._get("date")===this._get("defaultDate");d=new Date(d.getTime()),this._set("defaultDate",d),_&&this._set("date",d)}set date(d){null!=d&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(d.getTime())))}autoUpdate(d,_){const T=E_.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=_.hours,this.positionTimezoneInfo.minutes=_.minutes,this.positionTimezoneInfo.seconds=_.seconds;let x=null;(0,Qe.pC)(d)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(d.getTime())?(x=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(x=this.date&&this.date.getTime(),this._set("date",new Date(d.getTime()))));const A=E_.calculateTimezoneOffset(this.positionTimezoneInfo);if(T!==A&&(eP.target=this,eP.timezoneOffset=A,this.emit("timezone-will-change",eP)),(0,Qe.pC)(d))return!!isNaN(d.getTime())||x!==d.getTime()}clone(){const d=this._get("date")===this._get("defaultDate"),_=new E_({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return d&&_._set("date",_._get("defaultDate")),_.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,_.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,_.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,_.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,_}cloneWithWebsceneLighting(d){const _=this.clone();return null!=d.date&&(_.date=d.date),_.directShadowsEnabled=d.directShadowsEnabled,_.displayUTCOffset=d.displayUTCOffset,_}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,Ve._)([(0,ke.Cb)({type:Boolean})],Iu.prototype,"cameraTrackingEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Iu.prototype,"ambientOcclusionEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Iu.prototype,"waterReflectionEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Date})],Iu.prototype,"defaultDate",null),(0,Ve._)([(0,ke.Cb)({type:Date})],Iu.prototype,"date",null),Iu=E_=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SunLighting")],Iu),function(d){d.calculateTimezoneOffset=function _({hours:T,minutes:x,seconds:A}){return Math.round(T+x/60+A/3600)}}(Iu||(Iu={}));const eP={target:null,timezoneOffset:0},Mh=Iu;var tP;let Qm=tP=class extends zl.wq{constructor(d){super(d),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new tP(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:["virtual"],json:{write:!0}})],Qm.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],Qm.prototype,"directShadowsEnabled",void 0),Qm=tP=(0,Ve._)([(0,Wr.j)("esri.webscene.VirtualLighting")],Qm);const qv=Qm;var e1;let b_=e1=class extends(Va.Z.EventedMixin(qv)){constructor(d){super(d),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new e1({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(d){return new e1(d.cloneConstructProperties())}cloneWithWebsceneLighting(d){const _=this.clone();return _.directShadowsEnabled=d.directShadowsEnabled,_}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,Ve._)([(0,ke.Cb)({type:Boolean})],b_.prototype,"ambientOcclusionEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],b_.prototype,"waterReflectionEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],b_.prototype,"cameraTrackingEnabled",void 0),b_=e1=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.VirtualLighting")],b_);const qm=b_,lB={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Mh,virtual:qm}};var rP;let eg=rP=class extends Ns.Z{set quality(d){["low","high"].includes(d)&&this._set("quality",d)}clone(){return new rP({quality:this.quality})}};var sP;(0,Ve._)([(0,ke.Cb)({type:["low","high"],value:"low"})],eg.prototype,"quality",null),eg=rP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SceneViewAtmosphere")],eg);let tg=sP=class extends zl.wq{constructor(d){super(d),this.type="sunny",this.cloudCover=.5}clone(){return new sP({cloudCover:this.cloudCover})}};(0,Ve._)([(0,xp.J)({sunny:"sunny"})],tg.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],tg.prototype,"cloudCover",void 0),tg=sP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SunnyWeather")],tg);const iP=tg;var nP;let rg=nP=class extends zl.wq{constructor(d){super(d),this.type="cloudy",this.cloudCover=.5}clone(){return new nP({cloudCover:this.cloudCover})}};(0,Ve._)([(0,xp.J)({cloudy:"cloudy"})],rg.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rg.prototype,"cloudCover",void 0),rg=nP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.CloudyWeather")],rg);const cB=rg;var oP;let sg=oP=class extends zl.wq{constructor(d){super(d),this.type="foggy",this.fogStrength=.5}clone(){return new oP({fogStrength:this.fogStrength})}};(0,Ve._)([(0,xp.J)({foggy:"foggy"})],sg.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sg.prototype,"fogStrength",void 0),sg=oP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.FoggyWeather")],sg);const uB=sg;var aP;let C_=aP=class extends zl.wq{constructor(d){super(d),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new aP({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,Ve._)([(0,xp.J)({rainy:"rainy"})],C_.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],C_.prototype,"cloudCover",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],C_.prototype,"precipitation",void 0),C_=aP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.RainyWeather")],C_);const dB=C_;var lP;let Zp=lP=class extends zl.wq{constructor(d){super(d),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new lP({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,Ve._)([(0,xp.J)({snowy:"snowy"})],Zp.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Zp.prototype,"cloudCover",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Zp.prototype,"precipitation",void 0),(0,Ve._)([(0,ke.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Zp.prototype,"snowCover",void 0),Zp=lP=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SnowyWeather")],Zp);const vA={key:"type",base:iP,typeMap:{sunny:iP,cloudy:cB,rainy:dB,snowy:Zp,foggy:uB}},hB=Object.keys(vA.typeMap),Nc=1e4,_B={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Jm,virtual:qv}};let t1=class extends zl.wq{constructor(d){super(d)}clone(){}};(0,Ve._)([(0,ke.Cb)({readOnly:!0,json:{read:!1}})],t1.prototype,"type",void 0),t1=(0,Ve._)([(0,Wr.j)("esri.webscene.background.Background")],t1);const EA=t1;var cP;const mB={...v(60958).a,nonNullable:!0};let ig=cP=class extends EA{constructor(d){super(d),this.type="color",this.color=new lo.Z([0,0,0,1])}clone(){return new cP(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,Ve._)([(0,xp.J)({color:"color"},{readOnly:!0})],ig.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)(mB)],ig.prototype,"color",void 0),ig=cP=(0,Ve._)([(0,Wr.j)("esri.webscene.background.ColorBackground")],ig);const bA=ig,CA={base:EA,key:"type",typeMap:{color:bA}},yB={types:CA,json:{read:function gB(d){return(_,T,x)=>{if(!_)return _;for(const A in d.typeMap)if(_.type===A){const U=new d.typeMap[A];return U.read(_,x),U}}}(CA),write:{overridePolicy:(d,_,T)=>({enabled:!T||!T.isPresentation})}}};var uP;const TA="esri.webscene.Environment",vB=Us.Z.getLogger(TA),MA=(d,_,T)=>({enabled:!T||!T.isPresentation});let Ph=uP=class extends zl.wq{constructor(d){super(d),this.lighting=new Jm,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(d){(function pB(d,_){return!!hB.includes(d)||(_.error(`"${d}" is not a valid weather type`),!1)})(d?.type,vB)&&this._set("weather",d)}clone(){return new uP(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?qv.prototype.clone.call(this.lighting):Jm.prototype.clone.call(this.lighting),background:(0,hd.d9)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,Ve._)([(0,ke.Cb)({types:_B,nonNullable:!0,json:{write:!0}})],Ph.prototype,"lighting",void 0),(0,Ve._)([(0,ke.Cb)(yB)],Ph.prototype,"background",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:MA}}})],Ph.prototype,"atmosphereEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:MA}}})],Ph.prototype,"starsEnabled",void 0),(0,Ve._)([(0,ke.Cb)({types:vA,nonNullable:!0,json:{write:!0},value:new iP})],Ph.prototype,"weather",null),Ph=uP=(0,Ve._)([(0,Wr.j)(TA)],Ph);const PA=Ph;var ng;let T_=ng=class extends PA{constructor(d){super(d),this.atmosphere=new eg,this.lighting=new Mh,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(d){const _=d.cloneConstructProperties();return new ng({..._,lighting:"virtual"===_.lighting.type?qm.fromWebsceneLighting(_.lighting):Mh.fromWebsceneLighting(_.lighting)})}castLighting(d){return this._convertLighting(d)}applyLighting(d){this.lighting=this._convertLighting(d)}_convertLighting(d){return d?d instanceof Mh||d instanceof qm?d:d instanceof Jm?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(d):new Mh({...d.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):d instanceof qv?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(d):new qm({...d.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):(0,Hl.N7)(lB,d):new Mh}clone(){return new ng({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,hd.d9)(this.background)})}cloneWithWebsceneEnvironment(d){return new ng({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,hd.d9)(this.background),...d.cloneConstructProperties(),lighting:this._getLighting(d)})}_getLighting(d){switch(d.lighting.type){case"sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(d.lighting):Mh.fromWebsceneLighting(d.lighting);case"virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(d.lighting):qm.fromWebsceneLighting(d.lighting);default:return(0,Rm.Bg)(d.lighting),Mh.fromWebsceneLighting(d.lighting)}}};(0,Ve._)([(0,ke.Cb)({type:eg,json:{read:!1},nonNullable:!0})],T_.prototype,"atmosphere",void 0),(0,Ve._)([(0,ke.Cb)({nonNullable:!0})],T_.prototype,"lighting",void 0),(0,Ve._)([(0,ko.p)("lighting")],T_.prototype,"castLighting",null),T_=ng=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SceneViewEnvironment")],T_);const M_=T_;var pa,pt=v(84161),Tn=v(4794),mi=v(27422),En=v(12080);!function(d){d[d.Simple=0]="Simple",d[d.Realistic=1]="Realistic",d[d.Panoramic=2]="Panoramic",d[d.None=3]="None"}(pa||(pa={}));var ti=v(67831),Qo=v(993),Od=v(61343),un=v(99770),EB=v(56598),lu=v(17625),ro=v(651),so=v(91056),io=v(39114),Gn=v(12407),xt=v(67969),Ds=v(2078);class bB extends lu.K{constructor(){super(...arguments),this.heightParameters=(0,Tn.c)(),this.radii=(0,un.a)(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}}class og extends so.A{initializeProgram(_){return new Gn.$(_.rctx,og.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)(this.configuration.haze?{blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ZERO,xt.zi.ONE_MINUS_SRC_COLOR,xt.zi.ONE),colorWrite:Ds.BK}:{blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}og.shader=new ro.J(EB.C,()=>v.e(6713).then(v.bind(v,66713)));var pi=v(87601);class OA extends pi.m{constructor(){super(...arguments),this.haze=!1}}(0,Ve._)([(0,pi.o)()],OA.prototype,"haze",void 0);var P_=v(59631),_a=v(19597);class xA{constructor(_){this._view=_,this.type=pa.Realistic,this._passParameters=new bB,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=gc.sv.radius,this._fadeHaze=0,this._updateRadius(gc.sv.radius)}destroy(){this._atmosphereTechnique=(0,Qe.RY)(this._atmosphereTechnique),this._atmosphereHazeTechnique=(0,Qe.RY)(this._atmosphereHazeTechnique),this._vao=(0,Qe.M2)(this._vao),this._handles=(0,Qe.SC)(this._handles)}initializeRenderContext(_){const T=_.renderContext.rctx,x=this._handles=new Ji.Z;this._updateRootTileElevationBounds(),x.add((0,Ht.YP)(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds())),x.add((0,Ht.YP)(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds()));const A=new OA;A.haze=!1,this._atmosphereTechnique=_.shaderTechniqueRepository.acquire(og,A),A.haze=!0,this._atmosphereHazeTechnique=_.shaderTechniqueRepository.acquire(og,A),this._vao=(0,_a.ow)(T,P_.Bn)}render(_){this._render(_,this._atmosphereTechnique,_.offscreenRenderingHelper.depthTexture)}renderHaze(_,T){this._fadeHaze=T,this._render(_,this._atmosphereHazeTechnique,_.offscreenRenderingHelper.linearDepthTexture)}_render(_,T,x){if((0,Qe.Wi)(x))return;this._update(_.bindParameters.camera),this._passParameters.depthTex=x;const A=_.rctx.bindTechnique(T,this._passParameters,_.bindParameters);_.offscreenRenderingHelper.renderDepthDetached(()=>{this._renderCommon(A,_)})}_renderCommon(_,T){(0,Qe.Wi)(this._vao)||(T.rctx.bindVAO(this._vao),_.assertCompatibleVertexAttributeLocations(this._vao),T.rctx.drawArrays(xt.MX.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(_){return _*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const _=this._view.basemapTerrain.rootTileElevationBounds.min;_!==this._rootTileElevationMin&&(this._rootTileElevationMin=_,this._lowerBoundEarthRadius=gc.sv.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const _=this._adjustRadiusForTesselation(gc.sv.radius+this._view.basemapTerrain.visibleElevationBounds.min);_<this._lowerBoundEarthRadius&&this._updateRadius(_)}_updateRadius(_){this._lowerBoundEarthRadius=_,(0,ti.s)(this._passParameters.radii,_,_+Od.k8),this._passParameters.innerFadeDistance=2*Math.sqrt((2*_-Od.Tk)*Od.Tk)}_update(_){if((0,Qe.Wi)(_))return;const T=(0,pt.l)(_.eye),x=T*T,A=x-this._passParameters.radii[1]*this._passParameters.radii[1],U=Math.min(1,Math.max(0,(T-this._passParameters.radii[0])/Od.k8));(0,Qo.s)(this._passParameters.heightParameters,T,x,A,U),this._passParameters.altitudeFade=(0,Od.yx)(T-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=(0,xr.t7)((0,xr.t7)(.6,1,(0,xr.CW)(9500,10500,T-gc.sv.radius)),1,this._fadeHaze)}static isSupported(_){return _.renderContext.rctx.capabilities.depthTexture}}var CB=v(50722);class r1 extends so.A{constructor(_){super(_,new pi.m,()=>this.destroy())}initializeProgram(_){return new Gn.$(_.rctx,r1.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.SRC_ALPHA),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}r1.shader=new ro.J(CB.C,()=>v.e(2694).then(v.bind(v,32694)));let $p=class extends Ns.Z{constructor(d){super(d),this._technique=new r1(d),this._vao=(0,_a.ow)(d.rctx)}destroy(){this._technique=(0,Qe.RY)(this._technique),this._vao=(0,Qe.M2)(this._vao)}render(d){const _=d.bindParameters.cloudsFade;if((0,Qe.Wi)(this._vao)||(0,Qe.Wi)(_.data))return;if(!this._technique.compiled)return void this.requestRender();const T=d.rctx.bindTechnique(this._technique,TB,d.bindParameters);d.rctx.bindVAO(this._vao),T.assertCompatibleVertexAttributeLocations(this._vao),d.rctx.drawArrays(xt.MX.TRIANGLE_STRIP,0,4)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],$p.prototype,"rctx",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],$p.prototype,"viewingMode",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],$p.prototype,"planetRadius",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],$p.prototype,"requestRender",void 0),$p=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.CloudsComposition")],$p);const TB=new lu.K;var Wn=v(12015),no=v(75583),Co=v(30217),gi=v(28347),gn=v(43703),Tl=v(14658),dP=v(89803),il=v(85073);class s1 extends so.A{constructor(_,T){super(_,T,()=>this.destroy())}initializeProgram(_){return new Gn.$(_.rctx,s1.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.CONSTANT_COLOR,xt.zi.ONE_MINUS_CONSTANT_COLOR,xt.db.ADD,this.configuration.writeTextureChannels===no.uz.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}s1.shader=new ro.J(dP.b,()=>v.e(8698).then(v.bind(v,78698)));var ag=v(32849),DA=v(42474),Oh=v(64312),O_=v(85755);class lg extends so.A{initializeProgram(_){return new Gn.$(_.rctx,lg.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:this.configuration.mode===Oh.u.Full?(0,Ds.if)(xt.zi.ONE,xt.zi.ZERO):(0,Ds.wK)(xt.zi.ZERO,xt.zi.ONE,xt.zi.ONE,xt.zi.ZERO),depthTest:{func:xt.wb.ALWAYS},colorWrite:Ds.BK})}}lg.shader=new ro.J(DA.a,()=>v.e(5337).then(v.bind(v,35337)));var Aa=v(85775);let cg=class extends Ns.Z{constructor(d){super(d),this._needsRender=!0,this._passParameters=new DA.N,this._frameBuffer=new Aa.X(d.context.renderContext.rctx,{colorTarget:xt.Lm.TEXTURE,width:O_.IQ,height:O_.IQ},{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,hasMipmap:!1,width:O_.IQ,height:O_.IQ}),this._vao=(0,_a.ow)(d.context.renderContext.rctx)}get _techniqueRepository(){return this.context.shaderTechniqueRepository}get textureAtlas(){return(0,Qe.pC)(this._texture)?(0,Qe.pC)(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Oh.u.WeatherMap)):(0,Qe.pC)(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Oh.u.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(d){this._passParameters.weatherTile[0]===d[0]&&this._passParameters.weatherTile[1]===d[1]||((0,ti.c)(this._passParameters.weatherTile,d),this._setDirty())}destroy(){this._fullTechniqueCached=(0,Qe.RY)(this._fullTechniqueCached),this._weatherMapTechniqueCached=(0,Qe.RY)(this._weatherMapTechniqueCached),this._frameBuffer=(0,Qe.M2)(this._frameBuffer),this._vao=(0,Qe.M2)(this._vao)}get _fullTechnique(){if((0,Qe.Wi)(this._fullTechniqueCached)){const d=new Oh.i;d.mode=Oh.u.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(lg,d)}return this._fullTechniqueCached}get _weatherMapTechnique(){if((0,Qe.Wi)(this._weatherMapTechniqueCached)){const d=new Oh.i;d.mode=Oh.u.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(lg,d)}return this._weatherMapTechniqueCached}_render(d){if((0,Qe.Wi)(this._vao)||(0,Qe.Wi)(this._frameBuffer))return null;const _=d===Oh.u.Full?this._fullTechnique:this._weatherMapTechnique,T=this.context.renderContext.rctx,x=T.getViewport();T.setViewport(0,0,O_.IQ,O_.IQ),T.bindFramebuffer(this._frameBuffer);const A=T.bindTechnique(_,this._passParameters,null);return T.bindVAO(this._vao),A.assertCompatibleVertexAttributeLocations(this._vao),T.gl.drawArrays(T.gl.TRIANGLE_STRIP,0,4),T.setViewport(x.x,x.y,x.width,x.height),this._needsRender=!1,this._frameBuffer.colorTexture}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],cg.prototype,"context",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],cg.prototype,"_techniqueRepository",null),cg=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.NoiseTextureAtlas")],cg);var hP=v(74202);let Ml=class extends Ns.Z{constructor(d){super(d),this.runOncePerFrame=!0,this._handles=new Ji.Z,this._techniques=new Array,this._techniqueConfiguration=new ag.t,this._bindParameters=new hP.p(null,null,null),this._passParameters=new dP.C,this._drawParameters=new dP.a,this._weatherTile=(0,un.a)(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=(0,xr.t7)(il.L.default.coverage[0],il.L.default.coverage[1],.5),this.density=(0,xr.t7)(il.L.default.density[0],il.L.default.density[1],.5),this.absorption=(0,xr.t7)(il.L.default.absorption[0],il.L.default.absorption[1],.5),this.cloudSize=(0,xr.t7)(il.L.default.cloudSize[0],il.L.default.cloudSize[1],.5),this.detailSize=(0,xr.t7)(il.L.default.detailSize[0],il.L.default.detailSize[1],.5),this.smoothness=(0,xr.t7)(il.L.default.smoothness[0],il.L.default.smoothness[1],.5),this.cloudHeight=(0,xr.t7)(il.L.default.cloudHeight[0],il.L.default.cloudHeight[1],.5),this.raymarchingSteps=il.L.default.raymarchingSteps,this._viewMatrix=(0,gn.c)(),this._dirty=!1,this.running=!1}_getTechnique(d){const _=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,T=_===no.uz.RG?2*d:2*d+1;return this._techniques[T]||(this._techniqueConfiguration.writeTextureChannels=_,this._techniqueConfiguration.steps=d,this._techniques[T]=new s1({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[T])}updateWeatherTile(){(0,ti.s)(this._weatherTile,(this.view.camera.position.latitude+90)/180,(this.view.camera.position.longitude+180)/360);const T=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-T)*this._weatherTile[1]);let x=0,A=0;if((0,Qe.pC)(this.view.environment)&&"virtual"!==this.view.environment.lighting.type&&(0,Qe.pC)(this.view.environment.lighting.date)){const U=new Date(this.view.environment.lighting.date);U.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),x=31*U.getUTCMonth()+U.getUTCDate(),A=U.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+x)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+A%100)%(4*this._weatherTileCount),(0,ti.o)(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=(0,_a.ow)(this.context.renderContext.rctx);const d=(0,En.Iu)(this.view.spatialReference);this._passParameters.cloudRadius=.5*d.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Fn.T8.CLOUDS_GENERATOR,this),(0,Ht.YP)(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Ht.nn)])}destroy(){this._handles.destroy(),this._techniques.forEach(d=>(0,Qe.RY)(d)),this._frameBufferCube=(0,Qe.M2)(this._frameBufferCube),this._techniques.length=0,this._vao=(0,Qe.M2)(this._vao),this._passParameters.noiseTexture=(0,Qe.SC)(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case ag.p.SIXTEEN:return 1;case ag.p.HUNDRED:return 4;case ag.p.COUNT:case ag.p.TWOHUNDRED:return 8}}_ensureNoiseTexture(){return(0,Qe.pC)(this._passParameters.noiseTexture)||(this._passParameters.noiseTexture=new cg({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),(0,Qe.pC)(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(d){return(0,Qe.Wi)(this._frameBufferCube)&&(this._frameBufferCube=new Aa.X(this.context.renderContext.rctx,{colorTarget:xt.Lm.CUBEMAP,width:d,height:d},{target:xt.No.TEXTURE_CUBE_MAP,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,hasMipmap:!1,width:d,height:d})),this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=(0,Qe.M2)(this._frameBufferCube)}applyPreset(d,_){const T=d.median,x=A=>{const U=(0,xr.t7)(A[0],A[1],T);return _<.5?(0,xr.t7)(A[0],U,2*_):(0,xr.t7)(U,A[1],2*(_-.5))};this.coverage=x(d.coverage),this.density=x(d.density),this.absorption=x(d.absorption),this.cloudSize=x(d.cloudSize),this.detailSize=x(d.detailSize),this.smoothness=x(d.smoothness),this.cloudHeight=x(d.cloudHeight),this.raymarchingSteps=d.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(d){if((0,Qe.Wi)(this._vao))return this._dirty=this.running=!1,void(this.context.renderContext.bindParameters.cloudsFade.renderingStage=no.jL.FINISHED_RENDERING);0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),(0,ti.c)(this._passParameters.weatherTile,this._weatherTile));const _=this._getTechnique(this._passParameters.raymarchingSteps);if(!_.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=no.jL.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const T=this.context.renderContext.rctx,x=T.bindTechnique(_,this._passParameters,this._bindParameters);T.bindVAO(this._vao),x.assertCompatibleVertexAttributeLocations(this._vao);const A=T.getViewport(),U=_.configuration.cubeMapSize,ne=U/this._tilesPerFace;T.setViewport(0,this._tileIndex*ne,U,ne);const Oe=this._ensureFrameBufferCube(U);T.bindFramebuffer(Oe),(0,gi.u)(this._viewMatrix,OB,MB[this._faceIndex],PB[this._faceIndex]),(0,Co.f)(this._drawParameters.viewMatrix,this._viewMatrix),Oe.setColorTextureTarget(xt.No.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex),x.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),T.gl.drawArrays(T.gl.TRIANGLE_STRIP,0,4),T.gl.flush(),T.setViewport(A.x,A.y,A.width,A.height),this.requestRender(),d.madeProgress(),++this._tileIndex,4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=no.jL.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ml.prototype,"context",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ml.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ml.prototype,"requestRender",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"coverage",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"density",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"absorption",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"cloudSize",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"detailSize",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"smoothness",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"cloudHeight",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"raymarchingSteps",void 0),(0,Ve._)([(0,ke.Cb)()],Ml.prototype,"running",void 0),Ml=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.CloudsGenerator")],Ml);const MB=[(0,Tl.f)(1,0,0),(0,Tl.f)(-1,0,0),(0,Tl.f)(0,1,0),(0,Tl.f)(0,-1,0),(0,Tl.f)(0,0,1)],PB=[(0,Tl.f)(0,1,0),(0,Tl.f)(0,1,0),(0,Tl.f)(0,0,-1),(0,Tl.f)(0,0,1),(0,Tl.f)(0,1,0)],OB=(0,Tl.z)();var i1=v(41918);class n1 extends so.A{initializeProgram(_){return new Gn.$(_.rctx,n1.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)(this.configuration.haze?{blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ZERO,xt.zi.ONE_MINUS_SRC_COLOR,xt.zi.ONE),colorWrite:Ds.BK}:{blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ZERO,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE),colorWrite:Ds.BK})}}n1.shader=new ro.J(i1.H,()=>v.e(7765).then(v.bind(v,7765)));class pP extends pi.m{constructor(){super(...arguments),this.haze=!1}}(0,Ve._)([(0,pi.o)()],pP.prototype,"haze",void 0);let ug=class extends Ns.Z{constructor(d){super(d),this._passParameters=new i1.F,this._vao=(0,_a.ow)(d.context.renderContext.rctx,P_.Bn);const T=(0,En.Iu)(d.view.spatialReference);this._planetRadius=T.radius,this._atmosphereRadius=T.radius+Od.k8}destroy(){this._thickFogTechniqueCached=(0,Qe.RY)(this._thickFogTechniqueCached),this._vao=(0,Qe.M2)(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(d){this._passParameters.fogStrength=d}get strength(){return this._passParameters.fogStrength}get _thickFogTechnique(){if((0,Qe.Wi)(this._thickFogTechniqueCached)){const d=new pP;d.haze=!1,this._thickFogTechniqueCached=this._shaderTechniqueRepository.acquire(n1,d)}return this._thickFogTechniqueCached}render(d,_){if(this._update(d,_),this._passParameters.fogAmount<=0)return;const T=this._thickFogTechnique;if(!T.compiled)return void this.context.requestRender();const x=d.offscreenRenderingHelper;x.renderDepthDetached(()=>{this._passParameters.depthTexture=x.depthTexture;const A=d.rctx.bindTechnique(T,this._passParameters,d.bindParameters);this._renderFog(A,d)})}_renderFog(d,_){if((0,Qe.Wi)(this._vao))return;const T=_.rctx;T.bindVAO(this._vao),d.assertCompatibleVertexAttributeLocations(this._vao),T.drawArrays(xt.MX.TRIANGLE_STRIP,0,4)}_update(d,_){const T=d.bindParameters.camera;(0,pt.n)(SA,T.eye);const x=Math.max(0,(0,pt.e)(SA,d.bindParameters.lighting.mainLight.direction)),A=_.color;(0,pt.g)(AA,A,.1),(0,pt.h)(this._passParameters.fogColor,AA,A,x);const U=(0,pt.l)(T.eye);this._passParameters.atmosphereC=U*U-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-(0,xr.CW)(9500,1*Nc,Math.abs(U-this._planetRadius)))*_.amount,this._passParameters.fogStrength=_.strength}static isSupported(d){return d.capabilities.depthTexture}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ug.prototype,"context",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ug.prototype,"view",void 0),ug=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.Fog")],ug);class SB{constructor(){this.color=(0,ir.c)(),this.strength=0,this.amount=0}}const SA=(0,ir.c)(),AA=(0,ir.c)();var _P=v(4300),Yp=v(49115);class x_ extends so.A{initializeProgram(_){return new Gn.$(_.rctx,x_.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)(this.configuration.geometry===Yp.n.Cylinder?{blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),culling:Ds.Rd,depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK}:{blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}x_.shader=new ro.J(_P.a,()=>v.e(5359).then(v.bind(v,75359)));const RA=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var xh=v(4511),Xp=v(19625),AB=v(57521),Dh=v(15197),Qi=v(16396),Ra=v(83994),Ro=v(55086),No=v(26906);class RB{constructor(){this.type=pa.Panoramic,this._configuration=new Yp.f,this._passParameters=new _P.S}destroy(){this._passParameters.texture=(0,Qe.M2)(this._passParameters.texture),this._vao=(0,Qe.M2)(this._vao)}initializeRenderContext(_){this._configuration.geometry=Yp.n.Cylinder,this._technique=_.shaderTechniqueRepository.acquire(x_,this._configuration);const T=_.renderContext.rctx;this._vao=this._createVertexArrayObject(T),this._vaoCount=(0,No._V)(this._vao,"geometry"),this._passParameters.texture=new Ro.x(T,{pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,flipped:!0,width:1,height:512},RA),_.requestRender()}render(_){if((0,Qe.Wi)(this._vao)||(0,Qe.Wi)(this._passParameters.texture))return;const T=_.rctx,x=T.bindTechnique(this._technique,this._passParameters,_.bindParameters);(function wB(d,_){(0,gi.c)(d,_),d[12]=0,d[13]=0,d[14]=0,d[15]=1})(wA,_.bindParameters.camera.viewMatrix),x.setUniformMatrix4fv("view",wA),T.bindVAO(this._vao),x.assertCompatibleVertexAttributeLocations(this._vao),T.drawArrays(xt.MX.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(_){const T=(0,AB.mj)(1,2,!1),x=T.indices.get(Qi.T.POSITION);for(let fe=0;fe<x.length;fe+=3){const Oe=x[fe];x[fe]=x[fe+2],x[fe+2]=Oe}const A=T.vertexAttributes.get(Qi.T.POSITION).data,U=IA.createBuffer(x.length),ne=U.position;for(let fe=0;fe<x.length;++fe){const Oe=3*x[fe];ne.set(fe,0,A[Oe]),ne.set(fe,1,A[Oe+1]),ne.set(fe,2,A[Oe+2])}return new Dh.U(_,io.i,{geometry:(0,xh.K)(IA)},{geometry:Ra.f.createVertex(_,xt.l1.STATIC_DRAW,U.buffer)})}}const wA=(0,gn.c)(),IA=(0,Xp.U$)().vec3f(Qi.T.POSITION);var IB=v(5585);class LB extends lu.K{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class dg extends so.A{initializeProgram(_){return new Gn.$(_.rctx,dg.shader.get().build(this.configuration),o1)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}dg.shader=new ro.J(IB.P,()=>v.e(8954).then(v.bind(v,78954)));const o1=new Map([[Qi.T.POSITION,0],[Qi.T.INSTANCEFEATUREATTRIBUTE,1]]);var a1=v(6067),UB=v(42836);let kp=class extends Ns.Z{constructor(d){super(d),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new LB,this._animation=new UB.d,this._updatingTracking=new l_.t,this._passParameters.time=0,this._passParameters.radius=(0,En.Iu)(d.view.spatialReference).radius,this._shaderTechniqueRepository=d.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=(0,Qe.RY)(this._snowTechniqueCached),this._rainTechniqueCached=(0,Qe.RY)(this._rainTechniqueCached),this._vao=(0,Qe.M2)(this._vao),this._instanceIdBuffer=(0,Qe.M2)(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if((0,Qe.Wi)(this._rainTechniqueCached)){const d=new a1.Y;d.type=a1.H.Rain,this._rainTechniqueCached=this._shaderTechniqueRepository.acquire(dg,d)}return this._rainTechniqueCached}get _snowTechnique(){if((0,Qe.Wi)(this._snowTechniqueCached)){const d=new a1.Y;d.type=a1.H.Snow,this._snowTechniqueCached=this._shaderTechniqueRepository.acquire(dg,d)}return this._snowTechniqueCached}update(d){return this._animation.advance(d)}render(d,_,T){const x="rainy"===T?this._rainTechnique:this._snowTechnique;if(!x.compiled)return void this.context.requestRender();const A=d.rctx;if(this._ensureResources(A),(0,Qe.Wi)(x)||(0,Qe.Wi)(this._vao)||(0,Qe.Wi)(this._instanceIdBuffer)||((0,Qe.pC)(d.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-d.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;_=_<.5?(0,xr.t7)(0,.35,2*_):(0,xr.t7)(.35,1,2*(_-.5)),this._passParameters.time=("rainy"===T?this._rainSpeed:this._snowSpeed)*(0,mi.D9)(this._animation.time)%1e5;const ne=A.bindTechnique(x,this._passParameters,d.bindParameters);A.bindVAO(this._vao),ne.assertCompatibleVertexAttributeLocations(this._vao),(0,No.XP)(A,o1,this._instanceIdBuffer,LA,0),A.capabilities.instancing.drawArraysInstanced(xt.MX.TRIANGLES,0,3,this._numParticles*_),(0,No.UF)(A,o1,this._instanceIdBuffer,LA)}_ensureResources(d){(0,Qe.Wi)(this._vao)&&(this._vao=this._createVertexArrayObject(d)),(0,Qe.Wi)(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(d))}_createInstanceIndices(d){const _=[];for(let T=0;T<this._numParticles;T++)_.push(T);return Ra.f.createVertex(d,xt.l1.STATIC_DRAW,new Float32Array(_))}_createVertexArrayObject(d){const _=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Dh.U(d,o1,{geometry:(0,xh.K)(BB)},{geometry:Ra.f.createVertex(d,xt.l1.STATIC_DRAW,_)})}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],kp.prototype,"context",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],kp.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],kp.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)()],kp.prototype,"_updatingTracking",void 0),kp=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.Precipitation")],kp);const BB=(0,Xp.U$)().vec3f(Qi.T.POSITION),LA=(0,xh.K)((0,Xp.U$)().f32(Qi.T.INSTANCEFEATUREATTRIBUTE),1),jB=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);var Wc=v(2282);const UA=-Od.Tk,NB=(0,sl.uV)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class WB{constructor(_){this.view=_,this.type=pa.Simple,this._passParameters=new _P.S,this._fadeVaoCount=0,this._texV1=1,this._isOnMars=(0,hc.BZ)(_.spatialReference);const T=(0,En.Iu)(_.spatialReference);this._planetRadius=T.radius,this._outerRimWidth=T.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+UA)/this._planetRadius,this._middleRimFactor=(this._planetRadius+0)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=0/this._outerRimWidth,this._texVScale=this._texV1-this._texV0}destroy(){this._cameraChangeHandle=(0,Qe.hw)(this._cameraChangeHandle),this._passParameters.texture=(0,Qe.M2)(this._passParameters.texture),this._fadeVao=(0,Qe.M2)(this._fadeVao),this._vao=(0,Qe.M2)(this._vao)}initializeRenderContext(_){var T=this;return(0,kr.Z)(function*(){T._shaderTechniqueRepository=_.shaderTechniqueRepository;const x=_.renderContext.rctx;T._cameraChangeHandle=(0,Ht.YP)(()=>T.view.state?.camera,()=>_.requestRender(),Ht.tX),T._vao=T._createRibbon(x),T._vaoCount=(0,No._V)(T._vao,"geometry"),T._fadeVao=(0,_a.ow)(x),T._fadeVaoCount=(0,No._V)(T._fadeVao,"geometry"),T._passParameters.texture=new Ro.x(x,{pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,flipped:!0,width:1,height:512},T._isOnMars?jB:RA),_.requestRender()})()}get _coneTechnique(){if((0,Qe.Wi)(this._coneTechniqueCached)){const _=new Yp.f;_.geometry=Yp.n.Cone,this._coneTechniqueCached=this._shaderTechniqueRepository.acquire(x_,_)}return this._coneTechniqueCached}get _undergroundTechnique(){if((0,Qe.Wi)(this._undergroundTechniqueCached)){const _=new Yp.f;_.geometry=Yp.n.Underground,this._undergroundTechniqueCached=this._shaderTechniqueRepository.acquire(x_,_)}return this._undergroundTechniqueCached}render(_){if((0,Qe.Wi)(this._vao)||(0,Qe.Wi)(this._passParameters.texture))return;this._update(_.bindParameters.camera);const x=_.rctx;this._passParameters.undergroundFadeAlpha<1&&(x.bindTechnique(this._coneTechnique,this._passParameters,_.bindParameters),x.bindVAO(this._vao),x.drawArrays(xt.MX.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(x.bindTechnique(this._undergroundTechnique,this._passParameters,_.bindParameters),x.bindVAO(this._fadeVao),x.drawArrays(xt.MX.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(_){const T=(0,ir.c)(),x=this._planetRadius,A=(0,pt.l)(_.eye),U=A-x;if(U<0){const dt=Math.min(-U/5e3,1);this._passParameters.undergroundFadeAlpha=dt}else this._passParameters.undergroundFadeAlpha=0;const ne=Math.max(50,U);this._passParameters.innerScale=function VB(d,_,T){return d*d/(Math.sqrt(d*d-_*_)*Math.sqrt(d*d-T*T)+_*T)}(x+ne,x,x+UA)-1,this._passParameters.altitudeFade=(0,Od.yx)(U),(0,pt.g)(T,_.eye,(x+50)/A),jA(T,_.center,_.up,x,this._passParameters.silhouette);const Oe=this._computeScreenRimWidth(_,T,_.up,this._passParameters.silhouette),we=1-511/512,Ze=NB(U);let it=this._texV0+we*this._texVScale,lt=this._texV0+Oe*Ze*this._texVScale;if(U>50){jA(_.eye,_.center,_.up,x,this._passParameters.silhouette);const dt=this._computeScreenRimWidth(_,_.eye,_.up,this._passParameters.silhouette),Tt=(0,xr.uZ)((dt-1.5)/(Oe-1.5),0,1);it=this._texV0+Tt*we*this._texVScale,lt=this._texV0+(0,xr.t7)(this._texV1,Oe*Ze,Tt)*this._texVScale}(0,ti.s)(this._passParameters.texV,it,lt)}_createRibbon(_){const T=new Float32Array(1155),x=new Uint32Array(1920);T[0]=0,T[1]=0,T[2]=-1;for(let ne=0;ne<128;ne++){const fe=9*ne+3;T[fe+0]=ne,T[fe+1]=this._innerRimFactor,T[fe+2]=-1,T[fe+3]=ne,T[fe+4]=this._middleRimFactor,T[fe+5]=0,T[fe+6]=ne,T[fe+7]=this._outerRimFactor,T[fe+8]=1;const Oe=3*ne+1,we=127===ne?1:Oe+3,Ze=15*ne;x[Ze+0]=Oe,x[Ze+1]=Oe+1,x[Ze+2]=we+1,x[Ze+3]=we+1,x[Ze+4]=we,x[Ze+5]=Oe,x[Ze+6]=Oe+1,x[Ze+7]=Oe+2,x[Ze+8]=we+2,x[Ze+9]=we+2,x[Ze+10]=we+1,x[Ze+11]=Oe+1,x[Ze+12]=Oe,x[Ze+13]=we,x[Ze+14]=0}const A=FA.createBuffer(x.length),U=A.position;for(let ne=0;ne<x.length;++ne){const fe=3*x[ne];U.set(ne,0,T[fe]),U.set(ne,1,T[fe+1]),U.set(ne,2,T[fe+2])}return new Dh.U(_,io.i,{geometry:(0,xh.K)(FA)},{geometry:Ra.f.createVertex(_,xt.l1.STATIC_DRAW,A.buffer)})}_computeScreenRimWidth(_,T,x,A){return(0,pt.a)(hg,A.center,A.v2),(0,pt.g)(gP,hg,this._outerRimFactor),(0,gi.q)(mP,T,hg,x),(0,Wc.iV)(hg,mP,_.projectionMatrix,_.viewport),(0,Wc.iV)(gP,mP,_.projectionMatrix,_.viewport),(0,pt.i)(hg,gP)/_.height}}function jA(d,_,T,x,A){const U=(0,pt.l)(d),ne=x*Math.sqrt(U*U-x*x)/U,fe=Math.sqrt(x*x-ne*ne),Oe=A.v1,we=A.v2;return(0,pt.g)(A.center,d,fe/U),(0,pt.f)(Oe,d,_),(0,pt.p)(Oe)<1&&(0,pt.f)(Oe,d,T),(0,pt.g)(Oe,Oe,ne/(0,pt.l)(Oe)),(0,pt.f)(we,Oe,d),(0,pt.g)(we,we,ne/(0,pt.l)(we)),ne}const mP=(0,gn.c)(),hg=(0,ir.c)(),gP=(0,ir.c)(),FA=(0,Xp.U$)().vec3f(Qi.T.POSITION);class c1 extends so.A{initializeProgram(_){return new Gn.$(_.rctx,c1.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ZERO,xt.zi.ONE_MINUS_SRC_COLOR,xt.zi.ONE),colorWrite:Ds.BK})}}c1.shader=new ro.J(i1.H,()=>v.e(7765).then(v.bind(v,7765)));let pg=class extends Ns.Z{constructor(d){super(d),this._passParameters=new i1.F,this._vao=(0,_a.ow)(d.context.renderContext.rctx,P_.Bn);const T=(0,En.Iu)(d.view.spatialReference);this._planetRadius=T.radius,this._atmosphereRadius=T.radius+Od.k8}destroy(){this._hazeTechniqueCached=(0,Qe.RY)(this._hazeTechniqueCached),this._vao=(0,Qe.M2)(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(d){this._passParameters.hazeStrength=d}get strength(){return this._passParameters.hazeStrength}get _hazeTechnique(){if((0,Qe.Wi)(this._hazeTechniqueCached)){const d=new pP;d.haze=!0,this._hazeTechniqueCached=this._shaderTechniqueRepository.acquire(c1,d)}return this._hazeTechniqueCached}render(d,_){if(0===this.view.basemapTerrain.baseOpacity||(this._update(d,_),this._passParameters.hazeAmount<=0))return;const T=this._hazeTechnique;if(!T.compiled)return void this.context.requestRender();const x=d.offscreenRenderingHelper;x.renderDepthDetached(()=>{this._passParameters.depthTexture=x.depthTexture;const A=d.rctx.bindTechnique(T,this._passParameters,d.bindParameters);this._renderSimpleHaze(A,d)})}_renderSimpleHaze(d,_){if((0,Qe.Wi)(this._vao))return;const T=_.rctx;T.bindVAO(this._vao),d.assertCompatibleVertexAttributeLocations(this._vao),T.drawArrays(xt.MX.TRIANGLE_STRIP,0,4)}_update(d,_){const T=d.bindParameters.camera;(0,pt.n)(NA,T.eye);const x=Math.max(0,(0,pt.e)(NA,d.bindParameters.lighting.mainLight.direction)),A=KB;(0,pt.g)(WA,A,0),(0,pt.h)(this._passParameters.hazeColor,WA,A,x);const U=(0,pt.l)(T.eye);this._passParameters.atmosphereC=U*U-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-(0,xr.CW)(7e3,1*Nc,Math.abs(U-this._planetRadius)))*_.amount,this._passParameters.fogStrength=_.strength}static isSupported(d){return d.capabilities.depthTexture}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],pg.prototype,"context",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],pg.prototype,"view",void 0),pg=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SimpleHaze")],pg);class GB{constructor(){this.strength=0,this.amount=0}}const KB=(0,ir.f)(.24,.44,.8),NA=(0,ir.c)(),WA=(0,ir.c)();var ZB=v(45695);class $B extends lu.K{constructor(){super(...arguments),this.modelMatrix=(0,gn.c)()}}class u1 extends so.A{constructor(_){super(_,new pi.m,()=>this.destroy())}initializeProgram(_){return new Gn.$(_.rctx,u1.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK})}}u1.shader=new ro.J(ZB.S,()=>v.e(1317).then(v.bind(v,61317)));let Sh=class extends Ns.Z{constructor(d){super(d),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new $B,this._updatingTracking=new l_.t}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return(0,Qe.pC)(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=(0,Qe.IM)(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=(0,Qe.RY)(this._technique),this._vao=(0,Qe.M2)(this._vao)}render(d){const{rctx:_}=d;if(this._ensureResources(_),(0,Qe.Wi)(this._technique)||(0,Qe.Wi)(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const T=_.bindTechnique(this._technique,this._renderParameter,d.bindParameters);_.bindVAO(this._vao),T.assertCompatibleVertexAttributeLocations(this._vao),_.drawArrays(xt.MX.POINTS,0,this._numPoints)}_ensureResources(d){if((0,Qe.pC)(this._technique)||(0,Qe.Wi)(D_))return;this._technique=new u1({rctx:d,viewingMode:this.view.state.viewingMode}),this._numPoints=D_.byteLength/VA;const _=new Float32Array(D_,0,2*this._numPoints),T=new Uint8Array(D_,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(d,_,T,this._numPoints),this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,x=>this._update(x),Ht.nn)}_computeDayDuration(d){const _=d,T=new Date(d.getFullYear(),0,1,11,58,56);return(+_-+T)/(+new Date(d.getFullYear()+1,0,1,11,58,55)-+T)}_update(d){if(!d)return;const _=(d.getHours()/12+d.getMinutes()/60*(2/24)+d.getSeconds()/60*(2/1440)-.9972222)%2,T=2*this._computeDayDuration(d),x=(0,gi.c)(this._renderParameter.modelMatrix,kB);(0,gi.o)(x,x,-T*Math.PI),(0,gi.m)(x,XB,x),(0,gi.o)(x,x,-_*Math.PI),this.requestRender()}_hexToRGB(d){return[parseInt(d.substring(0,2),16),parseInt(d.substring(2,4),16),parseInt(d.substring(4,6),16)]}_unpackUint8Attributes(d){return d>=192?[2.9,d-192]:d>=160?[2.5,d-160]:d>=128?[2,d-128]:d>=96?[1.5,d-96]:d>=64?[1,d-64]:d>=32?[.7,d-32]:[.4,d]}_createVertexArrayObject(d,_,T,x){const A=zA.createBuffer(x),U=A.position,ne=A.color,fe=A.size;for(let Oe=0;Oe<x;Oe++){const we=_[2*Oe+0],Ze=_[2*Oe+1];U.set(Oe,0,-Math.cos(we)*Math.sin(Ze)),U.set(Oe,1,-Math.sin(we)*Math.sin(Ze)),U.set(Oe,2,-Math.cos(Ze));const it=this._unpackUint8Attributes(T[Oe]),lt=this._hexToRGB(YB[it[1]]);ne.set(Oe,0,255*lt[0]),ne.set(Oe,1,255*lt[1]),ne.set(Oe,2,255*lt[2]),ne.set(Oe,3,255),fe.set(Oe,it[0])}return new Dh.U(d,io.i,{geometry:(0,xh.K)(zA)},{geometry:Ra.f.createVertex(d,xt.l1.STATIC_DRAW,A.buffer)})}_createLoadDataTask(){var d=this;if((0,Qe.pC)(D_))return null;const _=(0,wu.vr)(function(){var T=(0,kr.Z)(function*(x){const{data:A}=yield(0,Uv.b)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:x});d._verifyStarData(A),D_=A});return function(x){return T.apply(this,arguments)}}());return _.promise.catch(T=>{(0,ws.D_)(T)||Us.Z.getLogger(this.declaredClass).error(T)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),_}_verifyStarData(d){if(!d)throw new ai.Z("stars:no-data-received","Failed to create stars because star catalogue is missing");const _=d.byteLength/VA;if(_%1!=0||_>5e4||_<5e3)throw new ai.Z("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Sh.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Sh.prototype,"requestRender",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Sh.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)()],Sh.prototype,"_loadDataTask",void 0),(0,Ve._)([(0,ke.Cb)()],Sh.prototype,"_updatingTracking",void 0),Sh=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.Stars")],Sh);const YB=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],XB=(0,gn.f)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),kB=(0,gn.f)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),VA=9,zA=(0,Xp.U$)().vec3f(Qi.T.POSITION).vec4u8(Qi.T.COLOR).f32(Qi.T.SIZE);let D_=null;var _g=v(89586),Lu=v(90478);function HA(d,_,T,x){const A=d.fadeInOutHeight;if(0!==x){const ne=(T-(A.stage===Wn.hZ.FINISHED?T:d.startTimeHeightFade))/(n9*x);A.factor+=_?-ne:ne}else A.factor=_?0:1;d.startTimeHeightFade=T,A.factor=(0,xr.uZ)(A.factor,0,1),A.stage=Wn.hZ.HEIGHT_FADE}const GA=(0,ir.f)(0,0,1),S_=(0,_g.Ue)(),Uu=(0,ir.c)(),r9=(0,ir.c)(),KA=1,s9=.5,i9=1.3,n9=1;var A_,R_,Xs=v(13934),Mi=v(5894);!function(d){d[d.Immediate=0]="Immediate",d[d.Faded=1]="Faded"}(A_||(A_={}));const o9=[Mi.r.POSTPROCESSING_ENVIRONMENT_OPAQUE,Mi.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Ha=R_=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._context=null,this._atmosphere=null,this._oldWeatherParameters=new yP,this._newWeatherParameters=new yP,this._fadedWeatherParameters=new yP,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(o9,this)}destroy(){null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this),this._handles=(0,Qe.SC)(this._handles),this._set("view",null)}get atmosphereType(){return(0,Qe.pC)(this._atmosphere)?this._atmosphere.type:pa.None}get canRender(){return!!this.view.basemapTerrain?.renderer.canRender||"global"!==this.view.viewingMode}get needsLinearDepth(){return(0,Qe.pC)(this._atmosphere)&&this._atmosphere.type===pa.Realistic}updateAnimation(d){return!!(0,Qe.pC)(this._precipitation)&&this._precipitation.update(d)}get updating(){return(0,Qe.pC)(this._stars)&&this._stars.updating||(0,Qe.pC)(this._clouds)&&this._clouds.running}get weatherVisible(){return(0,pt.l)(this.view.state.camera.eye)-(0,En.Iu)(this.view.spatialReference).radius<=Nc}get _stars(){const d=this.view,_=d.environment?.starsEnabled??!1,T=this._get("_stars");return!_||(0,Qe.Wi)(this._context)?((0,Qe.SC)(T),null):(0,Qe.pC)(T)?T:new Sh({view:d,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const d=this._get("_precipitation");if(!this._precipitationEnabled||(0,Qe.Wi)(this._context))return(0,Qe.SC)(d),null;const _=this.view,T=this._context;return(0,Qe.pC)(d)&&d.context===T?d:((0,Qe.SC)(d),new kp({context:T,view:_}))}get _clouds(){const d=this._get("_clouds");if(!this.weatherEnabled||(0,Qe.Wi)(this._context))return(0,Qe.SC)(d),null;if((0,Qe.pC)(d))return d;const _=this.view,T=this._context;return(0,Qe.SC)(d),new Ml({context:T,view:_,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const d=this._get("_cloudsComposition");if(!this.weatherEnabled||(0,Qe.Wi)(this._context))return(0,Qe.SC)(d),null;const _=this.view.state.viewingMode,T=this._context.renderContext.rctx,x=(0,En.Iu)(this.view.spatialReference).radius;return(0,Qe.pC)(d)&&d.viewingMode===_&&d.planetRadius===x?d:((0,Qe.SC)(d),new $p({rctx:T,viewingMode:_,planetRadius:x,requestRender:()=>this._setNeedsRender()}))}get _fog(){const d=this._get("_fog");return!this.weatherEnabled||(0,Qe.Wi)(this._context)?((0,Qe.SC)(d),null):(0,Qe.pC)(d)?d:new ug({context:this._context,view:this.view})}get _simpleHaze(){const d=this._get("_simpleHaze");return!this.weatherEnabled||(0,Qe.Wi)(this._context)?((0,Qe.SC)(d),null):(0,Qe.pC)(d)?d:new pg({context:this._context,view:this.view})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(d=null){this._context=d;const _=()=>this._setNeedsRender();this._handles.add([(0,Ht.gx)(()=>this.view?.basemapTerrain,()=>this._updateBasemapTerrain(),Ht.tX),(0,Ht.YP)(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Ht.tX),(0,Ht.YP)(()=>this._stars,_),(0,Ht.YP)(()=>this._precipitation,_),(0,Ht.YP)(()=>this._clouds,()=>this._updateWeather(),Ht.nn),(0,Ht.YP)(()=>this._fog,()=>this._updateFogHaze(),Ht.nn),(0,Ht.YP)(()=>this._simpleHaze,()=>this._updateFogHaze(),Ht.nn),(0,Ht.YP)(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ht.tX)])}uninitializeRenderContext(){this._context=null,this._atmosphere=(0,Qe.SC)(this._atmosphere),this._set("_stars",(0,Qe.SC)(this._stars)),this._set("_precipitation",(0,Qe.SC)(this._precipitation)),this._set("_clouds",(0,Qe.SC)(this._clouds)),this._set("_cloudsComposition",(0,Qe.SC)(this._cloudsComposition)),this._set("_fog",(0,Qe.SC)(this._fog)),this._set("_simpleHaze",(0,Qe.SC)(this._simpleHaze))}prepareRender(d){d.bindParameters.cloudsFade.data=(0,no.Ck)(this._clouds)?this._clouds:null,"local"!==this.view.viewingMode&&(function e9(d,_,T,x,A){d.renderingStage===no.jL.FINISHED_RENDERING&&(d.renderingStage=no.jL.FADING_TEXTURE_CHANNELS);const U=(0,pt.l)(_.eye);d.fadeInOutHeight.factor<0&&(d.fadeInOutHeight.factor=U-gc.sv.radius>Nc?1:0),d.isCameraPositionFinal=(0,pt.F)(d.cameraPositionLastFrame,_.eye),(0,pt.n)(Uu,_.eye),(0,pt.g)(Uu,Uu,gc.sv.radius);const ne=d.parallax;0===ne.anchorPointClouds[0]&&0===ne.anchorPointClouds[1]&&0===ne.anchorPointClouds[2]&&(0,pt.c)(ne.anchorPointClouds,Uu);const fe=(0,pt.l)((0,pt.b)(r9,ne.anchorPointClouds,Uu));let Oe=!0;fe>d.fadeIn.distanceThresholdFactor*ne.cloudsHeight||d.fadeIn.stage!==Wn.YF.FINISHED?function JB(d,_,T){const x=d.parallax.anchorPointClouds;d.fadeIn.stage===Wn.YF.FINISHED&&(d.fadeIn.factor=0,(0,pt.c)(x,Uu),d.fadeIn.stage=Wn.YF.CHANGE_ANCHOR,d.crossFade.enabled=!1,d.fadeInOut.stage=Wn.co.FINISHED),d.fadeIn.stage===Wn.YF.CHANGE_ANCHOR&&d.isCameraPositionFinal&&((0,no.WU)(d.data)&&d.renderingStage!==no.jL.RENDERING||d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS)&&((0,pt.c)(x,Uu),d.fadeIn.stage=Wn.YF.FADE_IN,d.startTime=_,d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS&&(d.renderingStage=no.jL.SWITCH_CHANNELS)),d.fadeIn.factor<1&&d.fadeIn.stage===Wn.YF.FADE_IN?d.fadeIn.factor=T?(0,xr.uZ)((_-d.startTime)/(KA*T),0,1):1:d.fadeIn.factor>=1&&d.fadeIn.stage===Wn.YF.FADE_IN&&(d.fadeIn.stage=Wn.YF.FINISHED,d.fadeIn.factor=1)}(d,x,A):fe>d.fadeInOut.distanceThresholdFactor*ne.cloudsHeight||d.fadeInOut.stage!==Wn.co.FINISHED?function QB(d,_,T){const{fadeInOut:x,crossFade:A}=d;x.stage===Wn.co.FINISHED&&(d.startTime=_,x.factor=1,x.stage=Wn.co.FADE_OUT),x.factor>0&&x.stage===Wn.co.FADE_OUT?x.factor=T?1-(0,xr.uZ)((_-d.startTime)/(s9*T),0,1):0:(x.factor<=0&&x.stage===Wn.co.FADE_OUT&&(x.factor=0,(0,pt.c)(d.parallax.anchorPointClouds,Uu)),x.factor<=0&&x.stage===Wn.co.FADE_OUT&&d.isCameraPositionFinal&&(x.factor=0,x.stage=Wn.co.SWITCH,d.crossFade.enabled=!1,A.factor=1),x.stage===Wn.co.SWITCH&&((0,no.WU)(d.data)&&d.renderingStage!==no.jL.RENDERING||d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS)&&(d.startTime=_,x.factor=0,x.stage=Wn.co.FADE_IN,(0,pt.c)(d.parallax.anchorPointClouds,Uu),d.crossFade.enabled=!1,A.factor=1,d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS&&(d.renderingStage=no.jL.SWITCH_CHANNELS)),x.factor<1&&x.stage===Wn.co.FADE_IN?x.factor=T?(0,xr.uZ)((_-d.startTime)/(KA*T),0,1):1:x.factor>=1&&x.stage===Wn.co.FADE_IN&&(x.stage=Wn.co.FINISHED,x.factor=1))}(d,x,A):fe>d.crossFade.distanceThresholdFactor*ne.cloudsHeight||d.crossFade.enabled||d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS?function qB(d,_,T,x){const{crossFade:A}=d,U=d.parallax.anchorPointClouds;d.crossFade.enabled&&!x||((0,pt.c)(d.parallaxNew.anchorPointClouds,Uu),d.startTime=_,A.factor=0,d.crossFade.enabled=!0),A.factor<1&&d.crossFade.enabled?A.factor=T?(0,xr.uZ)((_-d.startTime)/(i9*T),0,1):1:A.factor>=1&&d.crossFade.enabled&&(d.crossFade.enabled=!1,A.factor=1,(0,pt.c)(U,d.parallaxNew.anchorPointClouds),d.renderingStage===no.jL.FADING_TEXTURE_CHANNELS&&(d.renderingStage=no.jL.SWITCH_CHANNELS))}(d,x,A,(T!==Lu.n.IDLE||!(0,no.WU)(d.data))&&d.renderingStage!==no.jL.FADING_TEXTURE_CHANNELS):Oe=!1;const we=U-gc.sv.radius;if((we>17e3||we<-Nc)&&d.fadeInOutHeight.factor<1?d.fadeInOutHeight.factor=1:(we>Nc||we<-3500)&&d.fadeInOutHeight.factor<1?HA(d,!1,x,A):we<Nc&&we>-3500&&d.fadeInOutHeight.factor>0?HA(d,!0,x,A):d.fadeInOutHeight.stage=Wn.hZ.FINISHED,d.renderingStage===no.jL.SWITCH_CHANNELS&&(d.readChannels=1-d.readChannels,d.renderingStage=no.jL.FINISHED),ne.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(U*U-gc.sv.radius*gc.sv.radius,0))/U,(0,_g.zk)(GA,ne.anchorPointClouds,S_),(0,gi.e)(ne.transform,gn.I,S_[3],(0,_g.ZZ)(S_)),Oe){const{parallaxNew:Ze}=d;(0,_g.zk)(GA,Ze.anchorPointClouds,S_),(0,gi.e)(Ze.transform,gn.I,S_[3],(0,_g.ZZ)(S_))}(0,pt.c)(d.cameraPositionLastFrame,_.eye)}(d.bindParameters.cloudsFade,d.bindParameters.camera,this.view.state.mode,R_.test.time||d.time,this.view.qualitySettings.weatherFadeDuration),this._updateWeatherFading(d.bindParameters),d.bindParameters.cloudsFade.renderingStage===no.jL.FINISHED&&(0,Qe.pC)(this._clouds)&&0===this._clouds.coverage&&!1===this._clouds.running&&this._clouds.destroyFrameBufferCube())}render(d){if(d.output===Xs.H.Color)switch(d.bindParameters.slot){case Mi.r.POSTPROCESSING_ENVIRONMENT_OPAQUE:(0,Qe.pC)(this._stars)&&this._stars.render(d),(0,Qe.pC)(this._atmosphere)&&(this._atmosphere.render(d),(0,Qe.pC)(this._cloudsComposition)&&(0,Qe.pC)(d.bindParameters.cloudsFade.data)&&(this.weatherVisible&&(0,Qe.pC)(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(d)),function t9(d){return d.crossFade.enabled||d.fadeInOut.stage!==Wn.co.FINISHED||d.fadeIn.stage!==Wn.YF.FINISHED||d.fadeInOutHeight.stage!==Wn.hZ.FINISHED||d.renderingStage!==no.jL.FINISHED}(d.bindParameters.cloudsFade)&&(0,Qe.pC)(this._context)&&this._context.requestRender());break;case Mi.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if((0,Qe.pC)(this._atmosphere)&&(this._atmosphere.renderHaze(d,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._selectAtmosphereType()!==pa.Realistic&&(0,Qe.pC)(this._simpleHaze)&&this._simpleHaze.render(d,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&(0,Qe.pC)(this._fog)&&this._fog.render(d,this._weatherParameters.fog),(0,Qe.pC)(this._precipitation))){const _=this.view.environment.weather;"rainy"!==_.type&&"snowy"!==_.type||this._precipitation.render(d,_.precipitation,_.type)}}}updateLightSources(d,_,T,x){if((0,Qe.pC)(this._context)){const A=this._context.renderContext;A.bindParameters.oldLighting.copyFrom(A.bindParameters.lighting),A.bindParameters.newLighting.noonFactor=_,A.bindParameters.newLighting.globalFactor=T,A.bindParameters.newLighting.set(d),A.bindParameters.fadeLighting(x===A_.Faded||A.bindParameters.weatherFading?0:1),this._context.requestRender()}}get _weatherUpdateParameters(){const d=this.weatherEnabled?this.view.environment.weather:null;return(0,Qe.Wi)(d)?null:"rainy"===d.type||"snowy"===d.type?{type:d.type,weatherAdjustment:d.cloudCover,effect:d.precipitation}:{type:d.type,weatherAdjustment:"foggy"===d.type?d.fogStrength:d.cloudCover}}_updateWeatherFading(d){if(!d.weatherFading)return;const _=d.cloudsFade;return _.fadeIn.stage===Wn.YF.FADE_IN?(d.fadeLighting(_.fadeIn.factor),void this._fadeWeather(_.fadeIn.factor)):_.fadeInOut.stage===Wn.co.FADE_IN?(d.fadeLighting(_.fadeInOut.factor),void this._fadeWeather(_.fadeInOut.factor)):_.crossFade.enabled?(d.fadeLighting(_.crossFade.factor),void this._fadeWeather(_.crossFade.factor)):(d.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(d){const{_newWeatherParameters:_,_oldWeatherParameters:T}=this;d>=1?this._weatherParameters=_:(this._fadedWeatherParameters.lerp(T,_,d),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const d=this._weatherUpdateParameters;(0,Qe.Wi)(d)||(0,Qe.Wi)(this._clouds)||(this._clouds.applyPreset(il.L[d.type],d.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){(0,Qe.pC)(this._context)&&this._context.requestRender()}_updateFogHaze(){const d=this._weatherUpdateParameters;if((0,Qe.Wi)(this._fog)||(0,Qe.Wi)(this._simpleHaze)||(0,Qe.Wi)(d)||(0,Qe.Wi)(this._context))return;const _=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),d.type){case"foggy":this._newWeatherParameters.fog.strength=(0,xr.t7)(3e-5,.005,d.weatherAdjustment**3),(0,pt.c)(this._newWeatherParameters.fog.color,ZA),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===pa.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=(0,xr.t7)(4e-6,2e-4,d.effect**3),(0,pt.c)(this._newWeatherParameters.fog.color,a9),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=(0,xr.t7)(4e-6,2e-4,d.effect**3),(0,pt.c)(this._newWeatherParameters.fog.color,ZA),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===pa.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}this._fadeWeather(_.weatherFading?0:1)}_updateAtmosphere(){const d=this._selectAtmosphereType();if(this.atmosphereType===d)return;const _=this._getAtmosphereClass();if(!_)return(0,Qe.pC)(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();(0,Qe.pC)(this._context)&&((0,Qe.SC)(this._atmosphere),this._atmosphere=new _(this.view),this._atmosphere.initializeRenderContext(this._context),this._setNeedsRender(),this._updateBasemapTerrain())}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case pa.None:return null;case pa.Realistic:return xA;case pa.Panoramic:return RB;case pa.Simple:return WB;default:return}}_selectAtmosphereType(){const d=this.view.get("environment.atmosphereEnabled"),_=this.view.get("environment.atmosphere.quality"),T=this.view.viewingMode;return!d||null==_||(0,hc.V2)(this.view.spatialReference)?pa.None:"local"===T?pa.Panoramic:"high"===_&&(0,Qe.pC)(this._context)&&xA.isSupported(this._context)&&(0,hc.N$)(this.view.spatialReference)?pa.Realistic:pa.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=(0,Qe.pC)(this._atmosphere)&&this.atmosphereType===pa.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:d=>{$A=R_.prototype._getAtmosphereClass,R_.prototype._getAtmosphereClass=d},restoreGetAtmosphereClass:()=>{R_.prototype._getAtmosphereClass=$A}}}};Ha.test={time:(0,mi.HA)(0)},(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ha.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],Ha.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"weatherVisible",null),(0,Ve._)([(0,ke.Cb)()],Ha.prototype,"_context",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_stars",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_precipitation",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_clouds",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_cloudsComposition",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_fog",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_simpleHaze",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"weatherEnabled",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_precipitationEnabled",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ha.prototype,"_weatherUpdateParameters",null),Ha=R_=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.EnvironmentRenderer")],Ha);class yP{constructor(){this.fog=new SB,this.haze=new GB}copyFrom(_){this.fog.amount=_.fog.amount,this.haze.amount=_.haze.amount,this.fog.strength=_.fog.strength,this.haze.strength=_.haze.strength,(0,pt.c)(this.fog.color,_.fog.color)}lerp(_,T,x){this.fog.amount=(0,xr.t7)(_.fog.amount,T.fog.amount,x),this.haze.amount=(0,xr.t7)(_.haze.amount,T.haze.amount,x),this.fog.strength=(0,xr.t7)(_.fog.strength,T.fog.strength,x),this.haze.strength=(0,xr.t7)(_.haze.strength,T.haze.strength,x),(0,pt.h)(this.fog.color,_.fog.color,T.fog.color,x)}}const a9=(0,ir.f)(.5,.5,.5),ZA=(0,ir.f)(1.5,1.5,1.5);let $A;function YA(d,_,T){if((0,Qe.Wi)(_.longitude)||(0,Qe.Wi)(_.latitude)||(0,Qe.Wi)(T.longitude)||(0,Qe.Wi)(T.latitude))throw new Error("Invalid points: no lon/lat");return function l9(d,_,T,x,A){const U=(0,xr.Vl)(T),ne=(0,xr.Vl)(A),fe=U-ne,Oe=(0,xr.Vl)(_)-(0,xr.Vl)(x),we=Math.sin(fe/2),Ze=Math.sin(Oe/2),it=2*(0,xr.Kt)(Math.sqrt(we*we+Math.cos(U)*Math.cos(ne)*Ze*Ze))*d;return Math.round(1e4*it)/1e4}(d,_.longitude,_.latitude,T.longitude,T.latitude)}function XA(d,_){_||(_={hours:0,minutes:0,seconds:0}),_.hours=function d9(d,_){let T=d/15;return _||(T=Math.round(T)),T}(d[0],!0);const T=_.hours%1;_.hours-=T,_.minutes=60*T;const x=_.minutes%1;return _.minutes-=x,_.seconds=Math.round(60*x),_}var kA,JA,QA,qA={exports:{}};kA=qA,JA=function(){var d=Math.PI,_=Math.sin,T=Math.cos,x=Math.tan,A=Math.asin,U=Math.atan2,ne=Math.acos,fe=d/180,it={dec:0,ra:0};function dt(wr){return new Date(864e5*(wr+.5-2440588))}function Tt(wr){return function lt(wr){return wr.valueOf()/864e5-.5+2440588}(wr)-2451545}var mt=23.4397*fe;function Mt(wr,Gr){return U(_(wr)*T(mt)-x(Gr)*_(mt),T(wr))}function Pt(wr,Gr){return A(_(Gr)*T(mt)+T(Gr)*_(mt)*_(wr))}function Nt(wr,Gr,zr){return U(_(wr),T(wr)*_(Gr)-x(zr)*T(Gr))}function Bt(wr,Gr,zr){return A(_(Gr)*_(zr)+T(Gr)*T(zr)*T(wr))}function Zt(wr,Gr){return fe*(280.16+360.9856235*wr)-Gr}function nr(wr){return fe*(357.5291+.98560028*wr)}function Jt(wr){return fe*(1.9148*_(wr)+.02*_(2*wr)+3e-4*_(3*wr))}function Rr(wr,Gr){return wr+Gr+102.9372*fe+d}function Br(wr,Gr){var zr=nr(wr),rs=Rr(zr,Jt(zr));return Gr||(Gr={dec:0,ra:0}),Gr.dec=Pt(rs,0),Gr.ra=Mt(rs,0),Gr}var $r={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(wr,Gr,zr,rs){var ls=fe*-zr,ms=fe*Gr,ss=Tt(wr),Ms=Br(ss,it),Hs=Zt(ss,ls)-Ms.ra;return rs||(rs={azimuth:0,altitude:0}),rs.azimuth=Nt(Hs,ms,Ms.dec),rs.altitude=Bt(Hs,ms,Ms.dec),rs}},Yr=[[-.83,"sunrise","sunset"]];function os(wr,Gr,zr){return 9e-4+(wr+Gr)/(2*d)+zr}function br(wr,Gr,zr){return 2451545+wr+.0053*_(Gr)-.0069*_(2*zr)}function lr(wr){var Gr=fe*(134.963+13.064993*wr),zr=fe*(93.272+13.22935*wr),rs=fe*(218.316+13.176396*wr)+6.289*fe*_(Gr),ls=5.128*fe*_(zr),ms=385001-20905*T(Gr);return{ra:Mt(rs,ls),dec:Pt(rs,ls),dist:ms}}return $r.addTime=function(wr,Gr,zr){Yr.push([wr,Gr,zr])},$r.getTimes=function(wr,Gr,zr){var rs=fe*-zr,ls=fe*Gr,ms=function Xr(wr,Gr){return Math.round(wr-9e-4-Gr/(2*d))}(Tt(wr),rs),ss=os(0,rs,ms),Ms=nr(ss),Hs=Jt(Ms),Js=Rr(Ms,Hs),Gs=Pt(Js,0),bs=br(ss,Ms,Js);var Is,is,ii,Ys,Zs,ks={solarNoon:dt(bs),nadir:dt(bs-.5),polarException:$r.PolarException.NORMAL};for(Is=0,is=Yr.length;Is<is;Is+=1)Zs=bs-((Ys=br(os(function Vr(wr,Gr,zr){return ne((_(wr)-_(Gr)*_(zr))/(T(Gr)*T(zr)))}((ii=Yr[Is])[0]*fe,ls,Gs),rs,ms),Ms,Js))-bs),ks[ii[1]]=dt(Zs),ks[ii[2]]=dt(Ys);return ks.polarException=function _s(ds){var qs=(_(ds)-_(ls)*_(Gs))/(T(ls)*T(Gs));return qs<-1?$r.PolarException.MIDNIGHT_SUN:qs>1?$r.PolarException.POLAR_NIGHT:$r.PolarException.NORMAL}(Yr[0][0]*fe),ks},$r.getMoonPosition=function(wr,Gr,zr){var rs=fe*-zr,ls=fe*Gr,ms=Tt(wr),ss=lr(ms),Ms=Zt(ms,rs)-ss.ra,Hs=Bt(Ms,ls,ss.dec);return Hs+=.017*fe/x(Hs+10.26*fe/(Hs+5.1*fe)),{azimuth:Nt(Ms,ls,ss.dec),altitude:Hs,distance:ss.dist}},$r.getMoonFraction=function(wr){var Gr=Tt(wr),zr=Br(Gr),rs=lr(Gr),ls=149598e3,ms=ne(_(zr.dec)*_(rs.dec)+T(zr.dec)*T(rs.dec)*T(zr.ra-rs.ra)),ss=U(ls*_(ms),rs.dist-ls*T(ms));return(1+T(ss))/2},$r},void 0!==(QA=JA())&&(kA.exports=QA);const Jp=qA.exports,Bu={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function h9(d,_,T,x,A,U){(0,pt.s)(U.ambient.color,1,1,1),U.ambient.intensity=Bu.global.ambient,(0,pt.s)(U.direct.color,1,1,1),U.direct.intensity=Bu.global.direct;const fe=(0,xr.uZ)((Math.abs(_[2])-Bu.local.altitude)/(Bu.global.altitude-Bu.local.altitude),0,1);let Oe;if(U.globalFactor=fe,(0,Qe.pC)(d)&&(Oe=Jp.getTimes(d,_[1],_[0])),fe<1){let we;if((0,Qe.pC)(d))we=function y9(d,_,T){const x=d.valueOf();let A,U;_.polarException===Jp.PolarException.MIDNIGHT_SUN?(A=x-60*(d.getHours()+48)*60*1e3-60*d.getMinutes()*1e3,U=A+432e6):_.polarException===Jp.PolarException.POLAR_NIGHT?(A=x-2,U=x-1):(A=_.sunrise.valueOf(),U=_.sunset.valueOf());const ne=U-A,fe=A+ne/2,Oe=ne/4,we=fe-Oe,Ze=fe+Oe,it=.06*ne,lt=A-it/2,dt=A+it/2,Tt=U-it/2,mt=U+it/2,Mt=Bu.local,Pt=[.01,Mt.ambientAtNight],Nt=[.8,.8,1],Bt=[.01,.01,.01],Zt=[Mt.directAtTwilight,Mt.ambientAtTwilight],nr=[1,.6,.5],Jt=[.8,.8,1],Rr=[.9*Mt.directAtNoon,Mt.ambientAtNoon],Br=[1,.98,.98],$r=[.98,.98,1],Yr=[Mt.directAtNoon,Mt.ambientAtNoon],cs=[1,1,1],Xr=[1,1,1],os=Rr,br=Br,Vr=$r,lr=Zt,wr=nr,Gr=Jt;let zr,rs,ls=[0,0],ms=[0,0,0],ss=[0,0,0];x<lt||x>mt?(ls=Pt,ms=Bt,ss=Nt,rs="night"):x<dt?(zr=dt-lt,ls=wa(x-lt,zr,Pt,Zt),ms=wa(x-lt,zr,Bt,nr),ss=wa(x-lt,zr,Nt,Jt),rs="sun rising"):x<we?(zr=we-dt,ls=wa(x-dt,zr,Zt,Rr),ms=wa(x-dt,zr,nr,Br),ss=wa(x-dt,zr,Jt,$r),rs="early morning"):x<fe?(zr=fe-we,ls=wa(x-we,zr,Rr,Yr),ms=wa(x-we,zr,Br,cs),ss=wa(x-we,zr,$r,Xr),rs="late morning"):x<Ze?(zr=Ze-fe,ls=wa(x-fe,zr,Yr,os),ms=wa(x-fe,zr,cs,br),ss=wa(x-fe,zr,Xr,Vr),rs="early afternoon"):x<Tt?(zr=Tt-Ze,ls=wa(x-Ze,zr,os,lr),ms=wa(x-Ze,zr,br,wr),ss=wa(x-Ze,zr,Vr,Gr),rs="late afternoon"):x<mt&&(zr=mt-Tt,ls=wa(x-Tt,zr,lr,Pt),ms=wa(x-Tt,zr,wr,Bt),ss=wa(x-Tt,zr,Gr,Nt),rs="sun setting");let Ms=0;switch(T){case"rainy":case"foggy":Ms=.9;case"snowy":Ms=.5}Ms>0&&(ms=i3(ms,Ms),ss=i3(ss,Ms));const Hs=(0,ir.f)(ms[0],ms[1],ms[2]),Js=(0,ir.f)(ss[0],ss[1],ss[2]),Gs=s3(T);return{direct:{intensity:ls[0]*Gs.direct,color:Hs},ambient:{intensity:ls[1]*Gs.ambient,color:Js},timeOfDay:rs}}(d,Oe,x);else{const Ze=s3(x);we={direct:{intensity:Bu.local.directAtNoon*Ze.direct,color:(0,ir.f)(1,1,1)},ambient:{intensity:Bu.local.ambientAtNoon*Ze.ambient,color:(0,ir.f)(1,1,1)},timeOfDay:"early afternoon"}}(0,pt.h)(U.ambient.color,we.ambient.color,U.ambient.color,fe),U.ambient.intensity=(0,xr.t7)(we.ambient.intensity,U.ambient.intensity,fe),(0,pt.h)(U.direct.color,we.direct.color,U.direct.color,fe),U.direct.intensity=(0,xr.t7)(we.direct.intensity,U.direct.intensity,fe),U.specularStrength="rainy"===x||"snowy"===x||"foggy"===x?0:1,U.environmentStrength="rainy"===x?.7:"snowy"===x||"foggy"===x?.75:1}U.noonFactor=(0,Qe.pC)(d)?function g9(d,_){const T=d.valueOf();let x,A;return _.polarException===Jp.PolarException.MIDNIGHT_SUN?(x=T-60*(d.getHours()+48)*60*1e3-60*d.getMinutes()*1e3,A=x+432e6):_.polarException===Jp.PolarException.POLAR_NIGHT?(x=T-2,A=T-1):(x=_.sunrise.valueOf(),A=_.sunset.valueOf()),1-(0,xr.uZ)(Math.abs(T-(x+(A-x)/2))/432e5,0,1)}(d,Oe):1,(0,Qe.pC)(d)?function t3(d,_,T,x){const A=m9,U=(0,gi.i)(f9);if(T===vi.JY.Global)Jp.getPosition(d,0,0,A),(0,pt.s)(x,0,0,-1),(0,gi.r)(U,U,-A.azimuth),(0,gi.n)(U,U,-A.altitude),(0,pt.m)(x,x,U);else{const ne=Bu.planarDirection,fe=ne.globalAngles;let we=(Math.abs(_[2])-ne.localAltitude)/(ne.globalAltitude-ne.localAltitude);we=(0,xr.uZ)(we,0,1),we<1?(Jp.getPosition(d,_[1],_[0],A),A.azimuth=(1-we)*A.azimuth+we*fe.azimuth,A.altitude=(1-we)*A.altitude+we*fe.altitude):(A.azimuth=fe.azimuth,A.altitude=fe.altitude),(0,pt.s)(x,0,-1,0),(0,gi.o)(U,U,-A.azimuth),(0,gi.r)(U,U,-A.altitude),(0,pt.m)(x,x,U)}}(d,_,T,U.direct.directionToLightSource):e3(A,T,U.direct.directionToLightSource)}function e3(d,_,T){_===vi.JY.Global?(0,pt.n)(vP,d.eye):(0,pt.s)(vP,0,0,1),(0,pt.g)(EP,d.viewForward,-1);const x=(0,sl.EU)(EP,vP),A=Math.max(x-2*bP,0),ne=Math.max(bP,x-bP-.85*A/(A+1));(0,gi.d)(o3,-ne,d.viewRight),(0,pt.m)(T,EP,o3),(0,pt.a)(T,T,(0,pt.g)(v9,d.viewRight,E9)),(0,pt.n)(T,T)}const _9=(0,ir.f)(.5773502691896258,-.5773502691896258,.5773502691896258);class r3{constructor(){this.ambient={color:(0,ir.f)(1,1,1),intensity:.55},this.direct={color:(0,ir.f)(1,1,1),intensity:.55,directionToLightSource:(0,ir.a)(_9)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const f9=(0,gn.c)(),m9={azimuth:0,altitude:0};function s3(d){switch(d){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function i3(d,_){const T=(d[0]+d[1]+d[2])/3;for(let x=0;x<3;x++)d[x]=d[x]+(T-d[x])*_;return d}function wa(d,_,T,x){const A=[];for(let U=0;U<T.length;U++)A[U]=(x[U]-T[U])*d/_+T[U];return A}new Date(0);const o3=(0,gn.c)(),vP=(0,ir.c)(),EP=(0,ir.c)(),v9=(0,ir.c)(),bP=.25,E9=.2;var CP=v(82244);let cu=class extends Va.Z.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ji.Z,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new CP.Eg,this._ambientLight=new CP.Mi,this._moonLight=new CP.AM,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===vi.JY.Global&&(0,hc.N$)(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(d){if(this._renderer)return;this._renderer=new Ha({view:d});const _=()=>this._updateRenderParameters(),T=()=>this._cameraHandler();this._viewHandles.add([(0,Ht.YP)(()=>d.environment.lighting,x=>this._updateLightingHandler(x),Ht.Z_),(0,Ht.YP)(()=>"virtual"!==d.environment.lighting.type?d.environment.lighting.date:null,x=>this._lightingDateHandler(x),Ht.Z_),(0,Ht.YP)(()=>d.stationary,()=>this._interactingStationaryHandler()),(0,Ht.YP)(()=>d.environment.lighting.directShadowsEnabled,_,Ht.Z_),(0,Ht.YP)(()=>d.environment.lighting.ambientOcclusionEnabled,_,Ht.Z_),(0,Ht.YP)(()=>d.environment.lighting.waterReflectionEnabled,_,Ht.Z_),(0,Ht.YP)(()=>d.environment.background?.color,_,Ht.Z_),(0,Ht.YP)(()=>d.spatialReference,()=>this._resetReferencePosition(!0),Ht.Z_),(0,Ht.YP)(()=>d.environment.weather.type,()=>this._updateLighting(null,A_.Faded),Ht.Z_),(0,Ht.YP)(()=>this.weatherEnabled,()=>this._updateLighting(null,A_.Faded),Ht.Z_),(0,Ht.YP)(()=>d.viewingMode,()=>this._resetReferencePosition(!0),Ht.tX),(0,Ht.YP)(()=>"virtual"!==d.environment.lighting.type&&d.environment.lighting.cameraTrackingEnabled,x=>this._updateCameraTracking(x),Ht.tX),(0,Ht.YP)(()=>d.state.camera,T,Ht.tX),(0,Ht.YP)(()=>this.disableQueries,T)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=(0,Qe.SC)(this._renderer)}_updateLightingHandler(d){this._updateCameraTracking("virtual"!==d.type&&d.cameraTrackingEnabled),this._lightingDateHandler("virtual"!==d.type?d.date:null),this._updateRenderParameters()}_updateCameraTracking(d){if(this._trackingEnabled=d,d)this._cameraHandler();else{const _=this._view.environment.lighting;"virtual"!==_?.type&&(_.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(d){const _=this._view.environment.lighting;if("virtual"!==_?.type){if(d){if(!_.positionTimezoneInfo.autoUpdated){if(this._preserveAbsoluteDateTime=!0,!(0,di.jF)(this._view.spatialReference)){const x=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(x))return void this._requestReferencePositionUpdate(x)}if(this._preupdateTracking(d),(0,Qe.pC)(this._referencePosWGS84Comparable)){const x=XA(this._referencePosWGS84Comparable,a3);(0,Qe.pC)(x)&&(_.autoUpdate(null,x),this._trackingEnabled&&(_.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(d)}}else this._updateLighting()}_preupdateTracking(d){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(d)}_cameraHandler(d=null){const _=this._view;if(!_.ready)return;const T=_.stateManager.camera;T&&(this._cameraHandlerClientSide(T,d)||this._cameraHandlerServerSide(T))}_cameraHandlerClientSide(d,_){const T=(0,hc.N$)(this._view.spatialReference);if(T&&!(0,di.jF)(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;const x=d.position;return(0,Qe.Wi)(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=(0,ir.c)()),T?(0,di.UY)(x,this._referencePosWGS84Comparable):(0,pt.s)(this._referencePosWGS84Comparable,x.longitude,x.latitude,x.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,_)||this._updateLighting(_),!0}_cameraHandlerServerSide(d){const _=d.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(_))&&this._requestReferencePositionUpdate(_,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=_.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(d,_=A_.Immediate){const T=this._view;d=d||("virtual"===T.environment.lighting.type?null:T.environment.lighting.date);const x=this._referencePosWGS84Comparable,A=(0,Qe.pC)(x)?b9:C9,U=this.weatherVisible?T.environment.weather.type:"disabled";(0,Qe.pC)(x)?h9(d,x,T.state.viewingMode,U,T.state.camera,A):"virtual"===T.environment.lighting.type&&e3(T.state.camera,T.state.viewingMode,A.direct.directionToLightSource);const ne=this._mainLight,fe=A.direct;(0,pt.g)(ne.intensity,fe.color,fe.intensity*Math.PI),(0,pt.c)(ne.direction,fe.directionToLightSource),ne.specularStrength=A.specularStrength,ne.environmentStrength=A.environmentStrength;const Oe=this._ambientLight;(0,pt.g)(Oe.intensity,A.ambient.color,A.ambient.intensity);const we=this._moonLight;(0,pt.h)(we.intensity,M9,P9,A.globalFactor),(0,pt.g)(we.intensity,we.intensity,(1-.5*A.globalFactor)*(1-.4*A.noonFactor*(1-A.globalFactor))),(0,pt.c)(we.direction,fe.directionToLightSource),this._renderer.updateLightSources([ne,Oe,we],A.noonFactor,A.globalFactor,_),this._updateRenderParameters()}_autoUpdateTimezone(d,_=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||(0,Qe.Wi)(d))return!1;const T=T9;T.setTime((_||this._view.environment.lighting.date).getTime());const x=XA(d,a3);if((0,Qe.Wi)(x))return!1;let A=this._view.environment.lighting.positionTimezoneInfo;if(A.autoUpdated){if(A.hours===x.hours&&A.minutes===x.minutes&&A.seconds===x.seconds)return!1}else A=x;const U=T.getUTCHours()-(x.hours-A.hours),ne=T.getUTCMinutes()-(x.minutes-A.minutes),fe=T.getUTCSeconds()-(x.seconds-A.seconds);return T.setUTCHours(U),T.setUTCMinutes(ne),T.setUTCSeconds(fe),!_&&this._view.environment.lighting.autoUpdate(T,x)}_updateRenderParameters(){const d=this._view._stage;if(!d)return;const _=(0,Qe.R2)(this._referencePosWGS84Comparable,!0,A=>function p9(d,_){if(_===vi.JY.Global)return!0;const T=Bu.planarDirection;return Math.abs(d)<T.localAltitude}(A[2],this._view.state.viewingMode)),T=this._view.environment.background,x=T instanceof bA?{type:"color",color:(0,Tn.b)(lo.Z.toUnitRGBA(T.color))}:{type:"color",color:(0,Tn.f)(0,0,0,1)};d.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&_,background:x,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(d=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),d&&this._cameraHandler()}_requestReferencePositionUpdate(d,_=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(d):this._referencePosMapCoordsRequested=d.clone(),this._referencePosResetPreserveAbsoluteTime=!!_,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const T=this._referencePosUpdateQuery=(0,ws.e4)(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===T)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==T)}).catch(A=>{"mapcoordshelper:missing-geometry-service"===A.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===T&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),x=this._referencePosUpdateTimer=(0,ws.e4)(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===x&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}_doReferencePositionUpdateQuery(d){var _=this;return(0,kr.Z)(function*(){_._referencePosResetPreserveAbsoluteTime&&(_._preserveAbsoluteDateTime=!1),_._referencePosMapCoords?_._referencePosMapCoords.copy(_._referencePosMapCoordsRequested):_._referencePosMapCoords=_._referencePosMapCoordsRequested.clone(),_._referencePosResetPreserveAbsoluteTime=null,_._referencePosMapCoordsRequested=null;const T=yield _._view.mapCoordsHelper.toGeographic(_._referencePosMapCoords);if(!d()&&!isNaN(T[0])&&!isNaN(T[1])){const x=_._referencePosMapCoords.z*_._view.mapCoordsHelper.unitInMeters;_._referencePosWGS84Comparable?(_._referencePosWGS84Comparable[0]=T[0],_._referencePosWGS84Comparable[1]=T[1],_._referencePosWGS84Comparable[2]=x):_._referencePosWGS84Comparable=[T[0],T[1],x],_._referencePosChanged()}})()}_executePendingReferencePositionUpdate(){const d=this._referencePosMapCoordsRequested;d&&this._requestReferencePositionUpdate(d,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(d){if(this._referencePosMapCoords){let _=this._referencePosMapCoords.distance(d);return this._view.mapCoordsHelper&&(_*=this._view.mapCoordsHelper.unitInMeters),_>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const d=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,d}get test(){const d=this;return{get renderer(){return d._renderer},set referencePointUpdateInterval(_){d._referencePointUpdateInterval=_},set referencePointUpdateDistThreshold(_){d._referencePointUpdateDistThreshold=_},set referencePosUpdateTimer(_){d._referencePosUpdateTimer=_},set referencePointUpdateDelay(_){d._referencePointUpdateDelay=_},set disableWeather(_){d._disableWeather=_}}}};(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],cu.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"disableQueries",void 0),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"_disableWeather",void 0),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"weatherEnabled",null),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"weatherVisible",null),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"referencePositionWGS84Comparable",null),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"_renderer",void 0),(0,Ve._)([(0,ke.Cb)()],cu.prototype,"_referencePosWGS84Comparable",void 0),cu=(0,Ve._)([(0,Wr.j)("esri.views.3d.environment.SceneViewEnvironmentManager")],cu);const b9=new r3,C9=new r3,T9=new Date,a3={hours:0,minutes:0,seconds:0},M9=(0,ir.f)(.22,.22,.33),P9=(0,ir.f)(.22,.22,.22);var xn,wi,qo,oo=v(97126),yc=v(70562);function fg(d,_){return 0!=(d&_)}function d1(d,_,T,x,A,U){0!==d&&(T?(U.min=Math.min(U.min,_),U.max=Math.max(U.max,_)):null!=x?(U.min-=Math.max(0,(_-U.min)*(1-x)),U.max+=Math.max(0,(_-U.max)*(1-x))):A&&(U.min-=Math.max(0,_-U.min-A),U.max+=Math.max(0,_-U.max-A)))}!function(d){d[d.NONE=0]="NONE",d[d.TILT=1]="TILT",d[d.ALTITUDE=2]="ALTITUDE",d[d.DISTANCE=4]="DISTANCE",d[d.COLLISION=8]="COLLISION",d[d.ALL=15]="ALL",d[d.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(xn||(xn={})),function(d){d[d.NONE=0]="NONE",d[d.ZOOM=1]="ZOOM",d[d.TUMBLE=2]="TUMBLE",d[d.LOOK_AROUND=3]="LOOK_AROUND",d[d.PAN=4]="PAN",d[d.ASCEND=5]="ASCEND"}(wi||(wi={})),function(d){d[d.TUMBLE=0]="TUMBLE",d[d.LOOK_AROUND=1]="LOOK_AROUND"}(qo||(qo={}));const Ah={selection:xn.NONE,interactionType:wi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:qo.TUMBLE};function l3(d,_,T,x){return(0,pt.c)(x,_=_||d.viewForward),(0,pt.g)(x,x,Math.sign((0,pt.e)(_,T))),x}var O9=v(24229);function TP(d,_,T=Ah){if(!function D9(d,_){return!(!d.state.isGlobal||!d.state.constraints.altitude||_.interactionType===wi.TUMBLE&&fg(_.selection,xn.TILT))}(d,T))return 0;const x=function R9(d,_){return _.min=d.min,_.max=d.max,_}(d.state.constraints.altitude,w9);!function S9(d,_,T){const x=_.interactionType;if(x===wi.NONE)return;const{min:A,max:U}=T,{interactionStartCamera:ne,interactionFactor:fe}=_,Oe=x===wi.TUMBLE||x===wi.ZOOM,we=TP(d,ne),Ze=0===we?0:d.renderCoordsHelper.getAltitude(ne.eye);T.min=A,T.max=U,d1(we,Ze,Oe,fe,.05*Ze,T)}(d,T,x);const A=d.renderCoordsHelper.getAltitude(_.eye),U=(0,xr.uZ)(A,x.min,x.max)-A;return Math.abs(U)<=1e-6?0:U}const w9={min:0,max:0},I9=(0,ir.c)(),L9=(0,ir.c)(),U9=(0,ir.c)(),MP=(0,ir.c)();function PP(d,_,T=Ah){if(!d.state.isLocal)return 0;const x=d.state.constraints.distance;if(!d.pointsOfInterest.surfaceOrigin.renderLocation||x===1/0)return 0;h1.min=0,h1.max=x,function j9(d,_,T){const x=_.interactionType;if(x===wi.NONE)return;const{min:A,max:U}=T,{interactionStartCamera:ne,interactionFactor:fe}=_,Oe=x===wi.ZOOM||x===wi.PAN,we=PP(d,ne),Ze=0===we?0:OP(d,ne);T.min=A,T.max=U,d1(we,Ze,Oe,fe,.05*Ze,T)}(d,T,h1);const A=OP(d,_),U=h1.max-A;return U>=-1e-6?0:U}function OP(d,_){return(0,pt.i)(_.eye,d.pointsOfInterest.surfaceOrigin.renderLocation)}const h1={min:0,max:0},N9=(0,ir.c)(),W9=(0,ir.c)(),V9=(0,ir.c)(),z9=(0,ir.c)(),p1=(0,ir.c)();var Ga=v(62483);function c3(d,_,T,x){return(0,Qe.pC)(d.renderCoordsHelper.fromRenderCoords(_.eye,f1,x))&&(0,Bs.BD)(T,f1)}function _1(d,_){return d.elevationProvider?(0,Qe.Pt)(d.elevationProvider.getElevation(_[0],_[1],_[2],d.renderCoordsHelper.spatialReference,"ground"),0):0}function Qp(d,_,T,x){const A=d.state.camera.clone();_&&(A.eye=_,A.center=T,A.up=x),function H9(d,_,T){let x=d3[d.viewingMode];x||(x=(0,Ga.Z8)(d.state.viewingMode),x.options.backfacesTerrain=!d.state.isGlobal,x.options.invisibleTerrain=!0,d3[d.viewingMode]=x);const{isGlobal:A}=d.state;return!(!d.sceneIntersectionHelper.intersectRay(_,x,T)||u3(d,_.origin,T))||!(!d.renderCoordsHelper.intersectManifold(_,0,T)||u3(d,_.origin,T))||!!A&&function G9(d,_,T){const x=(0,pt.e)(d.origin,d.origin)-T*T,A=x>0?Math.sqrt(x)/3:1;return(0,pt.g)(_,d.direction,A/(0,pt.l)(d.direction)),(0,pt.a)(_,_,d.origin),!0}(_,T,(0,En.Iu)(d.spatialReference).radius)}(d,A.ray,Rh)||(0,pt.c)(Rh,A.center);const U=d.state.constraints,ne=U.minimumPoiDistance;if((0,pt.d)(A.eye,Rh)<ne){const fe=U.collision.enabled;(0,pt.c)(qp,A.viewForward),(0,pt.g)(qp,qp,ne),fe?A.eye=(0,pt.b)(f1,Rh,qp):(0,pt.a)(Rh,A.eye,qp);const Oe=d.renderCoordsHelper,we=Oe.getAltitude(A.eye),Ze=U.collision.elevationMargin;fe&&we<Ze&&((0,pt.b)(qp,Rh,A.eye),A.eye=Oe.setAltitude(f1,Ze,A.eye),(0,pt.a)(Rh,A.eye,qp))}return A.center=Rh,A}function u3(d,_,T){if(!d.state.isGlobal)return!1;const x=_1(d,_),A=d.stateManager.constraintsManager.nearFarHeuristic,{far:U}=A.compute(_,T,d.renderDataExtent,x,K9),ne=U*U;return(0,pt.d)(_,T)>ne}const d3={},f1=(0,ir.c)(),Rh=(0,ir.c)(),qp=(0,ir.c)(),K9={near:0,far:0};function w_(d,_,T=Vc.EYE){const x=d.state.constraints;if(!x.collision.enabled)return!1;const A=_1(d,_.eye),U=d.renderCoordsHelper.getAltitude(_.eye),ne=A+x.collision.elevationMargin;if(U>=ne)return!1;const fe=(0,pt.l)(_.eye);return(0,pt.b)(m1,_.center,_.eye),_.eye=d.renderCoordsHelper.setAltitude(Z9,ne,_.eye),T===Vc.EYE_AND_CENTER?_.center=(0,pt.a)(m1,_.eye,m1):T===Vc.EYE_AND_CENTER_SCALE&&(_.center=(0,pt.g)(m1,_.center,(fe-U+ne)/fe)),!0}var Vc;!function(d){d[d.EYE=0]="EYE",d[d.EYE_AND_CENTER=1]="EYE_AND_CENTER",d[d.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(Vc||(Vc={}));const m1=(0,ir.c)(),Z9=(0,ir.c)();function wh(d,_,T){d.worldUpAtPosition(_,h3),(0,pt.b)(xP,T,_);const x=(0,pt.l)(xP);return 0===x?0:(0,xr.ZF)((0,pt.e)(xP,h3)/x)}const h3=(0,ir.c)(),xP=(0,ir.c)();function DP(d,_,T=Ah,x=Ah,A){if(!d.state.constraints.tilt)return 0;const ne=d.state.constraints.tilt(_.distance,r7);return function t7(d,_,T){if(_.interactionType===wi.NONE)return;const{interactionStartCamera:x,interactionFactor:A}=_,{min:U,max:ne}=T,fe=DP(d,x,Ah,_),Oe=0===fe?0:wh(d.renderCoordsHelper,x.center,x.eye);T.min=U,T.max=ne,_.interactionType===wi.TUMBLE?(fg(_.selection,xn.ALTITUDE)&&_3(d,x,T),d1(fe,Oe,!0,A,f3,T)):d1(fe,Oe,!1,A,f3,T)}(d,T,ne),x.interactionType===wi.TUMBLE&&fg(x.selection,xn.ALTITUDE)&&_3(d,x.interactionStartCamera,ne),T.tiltMode===qo.LOOK_AROUND||x.tiltMode===qo.LOOK_AROUND?function Y9(d,_,T,x){switch(x&&(x.requiresTwoSteps=!1),d.viewingMode){case"global":return function k9(d,_,T,x){const A=function J9(d,_,T){const x=d.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,A=x+(0,En.Iu)(d.spatialReference).radius,U=d.renderCoordsHelper.intersectManifold(_.ray,x,Lh);return T.eyeCenterDistance=_.distance,T.centerIsOnSurface=!1,(0,Qe.pC)(U)?(T.eyeCenterDistance=(0,pt.i)(_.eye,U),T.tiltAtCenter=wh(d.renderCoordsHelper,U,_.eye),T.centerIsOnSurface=!0):d.state.isLocal?T.tiltAtCenter=wh(d.renderCoordsHelper,_.center,_.eye):((0,oo.b)((0,oo.e)(oo.t,A),_.ray,Lh),T.eyeCenterDistance=(0,pt.i)(_.eye,Lh),T.tiltAtCenter=(0,xr.ZF)(-(0,pt.e)(_.viewForward,(0,pt.n)(Lh,Lh)))),T.radius=A,T.eyeRadius=(0,pt.l)(_.eye),T.constraints=d.state.constraints,T}(d,_,s7),U=(0,xr.uZ)(A.tiltAtCenter,T.min,T.max);if(!mg(A.tiltAtCenter-U))return 0;let ne,fe;return A.centerIsOnSurface?(ne=function Q9(d){const{constraints:_,eyeCenterDistance:T,tiltAtCenter:x}=d;let A=x,U=_.clampTilt(T,x);const ne=SP(d,U);if(_.clampTilt(ne,x)===U)return U;let fe=0;for(;fe<10&&mg(U-A);){const Oe=(A+U)/2,we=SP(d,Oe);mg(_.clampTilt(we,Oe)-Oe)?A=Oe:U=Oe,fe++}return U}(A),fe=function q9(d,_){const T=(0,xr.Kt)(d.radius/d.eyeRadius*Math.sin(d.tiltAtCenter)),x=(0,xr.Kt)(d.radius/d.eyeRadius*Math.sin(_));return d.eyeRadius>d.radius?T-x:x-T}(A,ne)):(ne=A.constraints.clampTilt(A.eyeCenterDistance,A.tiltAtCenter),x&&ne<Math.PI/2&&(x.requiresTwoSteps=!0,ne=Math.PI/2-1e-5),fe=function e7(d,_){return d.tiltAtCenter-Math.PI/2-(_-Math.PI/2)}(A,ne)),x&&(x.eyeCenterDistance=SP(A,ne)),fe}(d,_,T,x);case"local":return function X9(d,_,T,x){const A=wh(d.renderCoordsHelper,_.center,_.eye),U=(0,xr.uZ)(A,T.min,T.max),ne=A-U;if(!mg(ne))return 0;if(x){const fe=d.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,Oe=d.renderCoordsHelper.getAltitude(_.eye)-fe,we=Math.cos(U);x.eyeCenterDistance=Math.abs(we)>1e-4?Oe/we:_.distance}return ne}(d,_,T,x);default:return void(0,Rm.Bg)(d.viewingMode)}}(d,_,ne,A):function $9(d,_,T){const x=wh(d.renderCoordsHelper,_.center,_.eye),A=x-(0,xr.uZ)(x,T.min,T.max);return mg(A)?A:0}(d,_,ne)}function mg(d){return Math.abs(d)>1e-9}function SP(d,_){if(!d.centerIsOnSurface)return d.eyeCenterDistance;const T=Math.PI-(0,xr.uZ)(_,0,Math.PI),x=(0,xr.Kt)(d.radius/d.eyeRadius*Math.sin(T)),A=Math.PI-T-x,U=Math.sin(A)/Math.sin(T);if(d.eyeRadius<d.radius&&U>1){const ne=Math.PI-x,fe=Math.PI-T-ne;return Math.sin(fe)/Math.sin(T)*d.eyeRadius}return U*d.eyeRadius}function _3(d,_,T){if(d.state.isLocal)return;const x=d.state.constraints;if(!x.altitude)return;const A=(0,pt.p)(_.center),U=Math.sqrt(A),ne=_.distance,fe=(0,En.Iu)(d.spatialReference).radius,Oe=x.altitude.min+fe,we=x.altitude.max+fe,Ze=(Oe*Oe-ne*ne-A)/(-2*U*ne);T.min=Math.max(T.min,Math.min(Math.PI-(0,xr.ZF)((we*we-ne*ne-A)/(-2*U*ne)),T.max)),T.max=Math.min(T.max,Math.PI-(0,xr.ZF)(Ze))}const Ih=(0,ir.c)(),g1=(0,gn.c)(),Lh=(0,ir.c)(),f3=(0,xr.Vl)(5),r7={min:0,max:0},s7={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},gg={eyeCenterDistance:0,requiresTwoSteps:!1},y1=d=>d*d,AP=d=>1-y1(1-d),RP=d=>d*d*d,m3=d=>1-RP(1-d),g3=d=>d<.5?RP(2*d)/2:(m3(2*(d-.5))+1)/2,wP=d=>d*d*d*d,y3=d=>1-wP(1-d),IP=d=>d*d*d*d*d,v3=d=>1-IP(1-d),LP=d=>1-Math.cos(d*Math.PI/2),E3=d=>1-LP(1-d),UP=d=>2**(10*(d-1)),yg=d=>1-UP(1-d),BP=d=>-(Math.sqrt(1-d*d)-1),b3=d=>1-BP(1-d);function zc(d){const _=2*(d-Math.sqrt((d-1)*d)),T=_/2/d;return x=>x<T?d*x*x:_*x-_+1}function Hc(d,_){return(T,x)=>T<_?_*d(T/_,x):1-d((1-T)/(1-_),x)*(1-_)}const d7=Hc(zc(1),1),h7=Hc(zc(1),0),C3=Hc(zc(1),.5),p7=Hc(zc(2),1),_7=Hc(zc(2),0),f7=Hc(zc(2),.5),m7=Hc(zc(3),1),g7=Hc(zc(3),0),y7=Hc(zc(3),.5),v7=Hc(zc(4),1),E7=Hc(zc(4),0),b7=Hc(zc(4),.5),C7={linear:function i7(d){return d},"in-quad":y1,"out-quad":AP,"in-out-quad":d=>d<.5?y1(2*d)/2:(AP(2*(d-.5))+1)/2,"in-coast-quad":d7,"out-coast-quad":h7,"in-out-coast-quad":C3,"in-cubic":RP,"out-cubic":m3,"in-out-cubic":g3,"in-coast-cubic":p7,"out-coast-cubic":_7,"in-out-coast-cubic":f7,"in-quart":wP,"out-quart":y3,"in-out-quart":d=>d<.5?wP(2*d)/2:(y3(2*(d-.5))+1)/2,"in-coast-quart":m7,"out-coast-quart":g7,"in-out-coast-quart":y7,"in-quint":IP,"out-quint":v3,"in-out-quint":d=>d<.5?IP(2*d)/2:(v3(2*(d-.5))+1)/2,"in-coast-quint":v7,"out-coast-quint":E7,"in-out-coast-quint":b7,"in-sine":LP,"out-sine":E3,"in-out-sine":d=>d<.5?LP(2*d)/2:(E3(2*(d-.5))+1)/2,"in-expo":UP,"out-expo":yg,"in-out-expo":d=>d<.5?UP(2*d)/2:(yg(2*(d-.5))+1)/2,"in-circ":BP,"out-circ":b3,"in-out-circ":d=>d<.5?BP(2*d)/2:(b3(2*(d-.5))+1)/2};function _o(d,_,T=O7,x=_){x!==_&&x.copyFrom(_),x.computeUp(d.state.viewingMode);let A=!1;for(let fe=0;fe<x7;fe++){let Oe=0;for(const we of P7)if(fg(T.selection,we.type)){const Ze=Math.abs(we.error(d,x,T));we.apply(d,x,T)&&(A=!0,Oe+=Ze)}if(0===Oe)break}const U=fg(T.selection,xn.COLLISION),ne=function T7(d,_){switch(d){case wi.PAN:return Vc.EYE_AND_CENTER;case wi.ASCEND:return _.state.isGlobal?Vc.EYE_AND_CENTER_SCALE:Vc.EYE_AND_CENTER;default:return Vc.EYE}}(T.interactionType,d);return U&&w_(d,x,ne)&&(A=!0),A&&x.computeUp(d.state.viewingMode),A}function uu(d){const _=Math.min(1,d/150);return g3(_)}const P7=[{type:xn.TILT,error:function M7(d,_,T){return DP(d,_,T)*_.distance},apply:function p3(d,_,T=Ah,x=!0){gg.eyeCenterDistance=0,gg.requiresTwoSteps=!1;const A=DP(d,_,T,void 0,gg);if(0===A)return!1;switch((0,gi.d)(g1,-A,_.viewRight),T.tiltMode){case qo.LOOK_AROUND:(0,pt.m)(Ih,_.viewForward,g1),(0,pt.g)(Ih,Ih,gg.eyeCenterDistance),_.center=(0,pt.a)(Lh,_.eye,Ih);break;case qo.TUMBLE:(0,pt.b)(Ih,_.center,_.eye),(0,pt.m)(Ih,Ih,g1),_.eye=(0,pt.b)(Lh,_.center,Ih);break;default:(0,Rm.Bg)(T.tiltMode)}return _.up=(0,pt.m)(Lh,_.up,g1),!gg.requiresTwoSteps||!x||p3(d,_,T,!1)}},{type:xn.ALTITUDE,error:TP,apply:function x9(d,_,T=Ah){const x=TP(d,_,T);if(0===x)return!1;const A=d.renderCoordsHelper,U=A.getAltitude(_.eye)+x,ne=l3(_,T.interactionDirection,function A9(d,_,T,x){return d.renderCoordsHelper.worldUpAtPosition(_.eye,x),(0,pt.g)(x,x,T),x}(d,_,Math.sign(x),L9),I9),fe=(0,pt.c)(U9,_.viewForward),Oe=A.intersectInfiniteManifold((0,yc.re)(_.eye,ne),U,MP);return _.eye=(0,Qe.pC)(Oe)?Oe:A.setAltitude(MP,U,_.eye),_.center=(0,O9.W8)(MP,_.eye,fe,_.center),!0}},{type:xn.DISTANCE,error:PP,apply:function B9(d,_,T=Ah){const x=PP(d,_,T);if(0===x)return!1;const A=d.pointsOfInterest.surfaceOrigin,U=OP(d,_)+x,ne=(0,pt.c)(N9,_.eye),fe=l3(_,T.interactionDirection,function F9(d,_,T){return(0,pt.r)(T,_.eye,d.pointsOfInterest.surfaceOrigin.renderLocation)}(d,_,z9),V9);if(!(0,oo.i)((0,oo.k)(A.renderLocation,U),(0,yc.re)(_.eye,fe),p1))return!1;_.eye=p1;const Oe=(0,pt.b)(W9,_.eye,ne);_.center=(0,pt.a)(p1,_.center,Oe);const we=d.renderCoordsHelper.getAltitude(_.center),Ze=d.renderCoordsHelper.intersectInfiniteManifold(_.ray,we,p1);return(0,Qe.pC)(Ze)&&(_.center=Ze),!0}}],O7={selection:xn.ALL,interactionType:wi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:qo.TUMBLE},x7=5;var xd=v(550);const vc=(0,ir.c)(),Yl=(0,ir.c)(),Uh=(0,ir.c)(),Ka=(0,ir.c)(),e0=(0,ir.c)(),D7=(0,ir.c)(),Ec={upward:(0,ir.f)(0,0,1),forward:(0,ir.f)(0,1,0),sideway:(0,ir.f)(1,0,0)},T3=(0,xd.c)();class M3{constructor(_=vi.JY.Global){this.viewingMode=_,this.center=(0,ir.c)(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=(0,ir.a)(Ec.forward)}pixelsPerPanAtZoom(_){return this.size/2/(this._zoomToPanScale*_)}zoomAtPixelsPerPan(_){return this.size/2/(this._zoomToPanScale*_)}pixelsPerRotateAtZoom(){const _=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/_}compareTo(_,T){if(T||(T={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===vi.JY.Global){const U=((0,pt.l)(this.center)+(0,pt.l)(_.center))/2;T.pan=(0,sl.EU)(this.center,_.center)*U}else T.pan=(0,pt.i)(this.center,_.center);let x=Math.abs(_.yaw-this.yaw);x>=Math.PI&&(x=2*Math.PI-x);const A=Math.abs(_.pitch-this.pitch);return T.rotate=Math.max(x,A),T.sourceZoom=this.distance,T.targetZoom=_.distance,T}interpolate(_,T,x){this.viewingMode===vi.JY.Global?(0,sl.ZA)(_.center,T.center,x.pan,this.center):(0,pt.h)(this.center,_.center,T.center,x.pan),this.distance=isFinite(T.distance)?(0,xr.t7)(_.distance,T.distance,x.zoom):_.distance,this.pitch=(0,xr.t7)(_.pitch,T.pitch,x.rotate);let A=_.yaw;const U=T.yaw;Math.abs(U-A)>=Math.PI&&(A+=2*(A<U?1:-1)*Math.PI),this.yaw=(0,xr.t7)(A,U,x.rotate)}copyFrom(_){(0,pt.c)(this.center,_.center),this.pitch=_.pitch,this.yaw=_.yaw,this.distance=_.distance,(0,pt.c)(this.lookAtDirection,_.lookAtDirection),this.size=_.size,this.copyFromCommon(_),this.viewingMode=_.viewingMode}copyFromRenderCamera(_){const T=this._lookAtOrientation(_.center,T3);(0,pt.c)(this.center,_.center),(0,pt.b)(Ka,_.center,_.eye),(0,pt.t)(Ka,Ka,T),(0,pt.t)(e0,_.up,T),this.distance=(0,pt.l)(Ka),0!==this.distance&&(Ka[0]/=this.distance,Ka[1]/=this.distance,Ka[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ka),this.yaw=this._eyeUpToYaw(Ka,e0),this.size=Math.sqrt(_.width*_.width+_.height*_.height),this.copyFromCommon(_)}copyFromCommon(_){this.fov=_.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(_){const T=this._lookAtOrientation(this.center,T3);(0,Co.t)(T,T),this._axisAngleVec3(Ec.sideway,this.pitch-Math.PI/2,Ec.forward,Ka),this._axisAngleVec3(Ec.upward,this.yaw,Ka),this._axisAngleVec3(Ec.sideway,this.pitch-Math.PI/2,Ec.upward,e0),this._axisAngleVec3(Ec.upward,this.yaw,e0),(0,pt.g)(Ka,Ka,this.distance),(0,pt.t)(Ka,Ka,T),(0,pt.t)(e0,e0,T),_.center=this.center,_.eye=(0,pt.b)(Ka,this.center,Ka),_.up=e0}_axisAngleVec3(_,T,x,A=x){const U=Math.cos(T),ne=Math.sin(T);return(0,pt.g)(vc,x,U),(0,pt.f)(Yl,_,x),(0,pt.g)(Yl,Yl,ne),(0,pt.g)(Uh,_,(1-U)*(0,pt.e)(_,x)),(0,pt.a)(A,(0,pt.a)(A,vc,Yl),Uh)}_lookAtOrientation(_,T=(0,xd.c)()){return this._upAtLookAt(_,Uh),(0,pt.f)(vc,this.lookAtDirection,Uh),(0,pt.n)(vc,vc),0===vc[0]&&0===vc[1]&&0===vc[2]&&(0,pt.c)(vc,Ec.sideway),(0,pt.f)(Yl,Uh,vc),(0,pt.n)(Yl,Yl),T[0]=vc[0],T[1]=Yl[0],T[2]=Uh[0],T[3]=vc[1],T[4]=Yl[1],T[5]=Uh[1],T[6]=vc[2],T[7]=Yl[2],T[8]=Uh[2],T}_upAtLookAt(_,T){return this.viewingMode===vi.JY.Local?(0,pt.c)(T,Ec.upward):(0,pt.n)(T,_)}_eyeUpToPitch(_){return Math.PI-(0,sl.EU)(Ec.upward,_)}_eyeUpToYaw(_,T){const x=D7;return Math.abs(T[2])<.5?((0,pt.c)(x,T),_[2]>0&&(0,pt.g)(x,x,-1)):(0,pt.c)(x,_),(0,pt.f)(Yl,x,Ec.upward),(0,pt.n)(Yl,Yl),(0,sl.EU)(Ec.sideway,Yl,Ec.upward)}}var $i=v(59856);const v1_minDuration=(0,mi.HA)(500),v1_maxDuration=(0,mi.HA)(8e3);class jP{constructor(_){this._createCamera=_,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:2},this.source=_(),this.target=_()}clone(){const _=new jP(this._createCamera);return _.copyFrom(this),_}copyFrom(_){this.update(_.source,_.target,_.settings)}update(_,T,x){this.source!==_&&this.source.copyFrom(_),this.target!==T&&this.target.copyFrom(T),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=x.desiredScreenFlow?x.desiredScreenFlow:2,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(_){const T=this.target.pixelsPerPanAtZoom(_);return this.halfWindowSize/T}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class S7{constructor(){this.segments=[]}get time(){return this.segments.reduce((_,T)=>(0,mi._H)(_+T.time),(0,mi._H)(0))}interpolateComponentsAt(_,T){_=Math.min(Math.max(_,0),1),_*=this.time;let x=0,A=0;const U=this.definition;for(let ne=0;ne<this.segments.length;ne++){const fe=this.segments[ne],Oe=fe.definition;if(_<=fe.time||ne===this.segments.length-1){if((T=this.segmentInterpolateComponentsAt(fe,0===fe.time?0:_/fe.time,T)).pan=U.hasPan&&!isNaN(T.pan)&&isFinite(U.compared.pan)?(x+Oe.compared.pan*T.pan)/U.compared.pan:1,T.rotate=U.hasRotate&&!isNaN(T.rotate)&&isFinite(U.compared.rotate)?(A+Oe.compared.rotate*T.rotate)/U.compared.rotate:1,U.hasZoom&&!isNaN(T.zoom)&&isFinite(Oe.compared.targetZoom)){const Ze=this.segments[0].definition.compared.sourceZoom;T.zoom=(T.zoom*(Oe.compared.targetZoom-Oe.compared.sourceZoom)+Oe.compared.sourceZoom-Ze)/(this.segments[this.segments.length-1].definition.compared.targetZoom-Ze)}else T.zoom=1;return T}_-=fe.time,x+=Oe.compared.pan,A+=Oe.compared.rotate}}segmentInterpolateComponentsAt(_,T,x){return _.interpolateComponentsAt(T,x)}}class FP{constructor(_){_&&this.update(_)}get time(){return this._time}update(_){_&&(this.definition?this.definition.copyFrom(_):this.definition=_.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const _=this.definition,T=_.compared,x=T.sourceZoom,A=T.targetZoom;this._zoomSign=x>A?1:-1,this._panPixelsAtSource=T.pan*_.source.pixelsPerPanAtZoom(x);const U=(_.source.pixelsPerRotateAtZoom(x)+_.target.pixelsPerRotateAtZoom(A))/2;this._rotatePixels=T.rotate*U}_updatePixelFlow(){const _=this.definition.compared.sourceZoom,T=this.definition.compared.targetZoom,{hasZoom:x,hasPan:A,hasRotate:U}=this.definition;let ne=0,fe=0;x&&(A&&(ne=(T/_-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),U&&(fe=this._zoomSign*(Math.log(_/T)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const Oe=this.definition.desiredPixelFlow;if(x&&A&&U){const we=ne+fe+ne*fe;this._zoomPixelFlow=ne*fe/we*Oe,this._panPixelFlow=fe/we*Oe,this._rotatePixelFlow=ne/we*Oe}else if(x&&A){const we=1+ne;this._zoomPixelFlow=ne/we*Oe,this._panPixelFlow=1/we*Oe}else if(x&&U){const we=1+fe;this._zoomPixelFlow=fe/we*Oe,this._rotatePixelFlow=1/we*Oe}else if(A&&U){const we=this._panPixelsAtSource/this._rotatePixels,Ze=1+we;this._panPixelFlow=we/Ze*Oe,this._rotatePixelFlow=1/Ze*Oe}else A?this._panPixelFlow=Oe:x?this._zoomPixelFlow=Oe:U&&(this._rotatePixelFlow=Oe);this._time=U?this.rotateTime:x?this.zoomTime:A?this.panTime:(0,mi._H)(0)}get rotateTime(){return(0,mi._H)(this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0)}get zoomTime(){return(0,mi._H)(this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const _=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return(0,mi._H)(Math.log(_*this._panPixelsAtSource*(this._zoomPixelFlow/this._panPixelFlow)+1)/(_*this._zoomPixelFlow))}return(0,mi._H)(this._panPixelsAtSource/this._panPixelFlow)}return(0,mi._H)(0)}_interpolateComponentsZoom(_){if(0===_||1===_)return _;if(this.definition.hasZoom){const T=this.definition.compared.sourceZoom,x=this.definition.compared.targetZoom;return(T*(T/x)**-_-T)/(x-T)}return _}_interpolateComponentsPan(_){if(0===_||1===_)return _;if(this.definition.hasPan&&this.definition.hasZoom){const T=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(T*_*this._time)-1))/(T*Math.LN2)}return _}_interpolateComponentsRotate(_){return _}interpolateComponentsAt(_,T){_=Math.min(Math.max(_,0),1);const x=this._interpolateComponentsZoom(_),A=this._interpolateComponentsPan(_),U=this._interpolateComponentsRotate(_);return T?(T.zoom=x,T.pan=A,T.rotate=U):T={zoom:x,pan:A,rotate:U},T}}function A7(d,_,T){const A=d.halfWindowPanAtZoom(_-d.compared.sourceZoom);return-d.halfWindowSize*(T.ascensionFactor*Math.LN2*d.compared.pan+A)*Math.log(d.compared.sourceZoom/_)/(d.desiredPixelFlow*Math.LN2*A)}function R7(d,_,T){const x=1/_,A=Math.log(d.compared.sourceZoom*x),U=1/d.desiredPixelFlow,ne=1/Math.LN2,fe=_-d.compared.sourceZoom,Oe=1/fe,we=(T.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(fe))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*x*U*ne*Oe*we-d.halfWindowSize*A*U*ne*Oe+d.halfWindowSize*A*U*ne*we/(fe*fe)}function w7(d,_,T){const x=_-d.compared.sourceZoom,A=1/x,U=1/_,ne=Math.log(d.compared.sourceZoom*U),fe=(T.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(x))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*A*(-2*A*U*fe+2*A*ne+2*U-2*ne*fe/(x*x)-fe/(_*_))/(d.desiredPixelFlow*Math.LN2)}function I7(d,_){return-d.halfWindowSize*Math.log(d.compared.sourceZoom/_)/(d.desiredPixelFlow*Math.LN2)}function L7(d,_){return d.halfWindowSize/(_*d.desiredPixelFlow*Math.LN2)}function U7(d,_){return-d.halfWindowSize/(_*_*d.desiredPixelFlow*Math.LN2)}function N7(d,_,T){return d.halfWindowSize*(-d.halfWindowPanAtZoom(_)-T.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))*Math.log(_/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*d.halfWindowPanAtZoom(-_+d.compared.targetZoom))}function W7(d,_,T){const x=Math.log(_/d.compared.targetZoom),A=1/d.desiredPixelFlow,U=1/Math.LN2,ne=-_+d.compared.targetZoom,fe=1/ne,Oe=(-d.halfWindowPanAtZoom(_)-T.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return-d.halfWindowSize*x*A*U*fe+d.halfWindowSize*x*A*U*Oe/(ne*ne)+d.halfWindowSize*A*U*fe*Oe/_}function V7(d,_,T){const x=_-d.compared.targetZoom,A=1/x,U=1/_,ne=Math.log(_/d.compared.targetZoom),fe=(d.halfWindowPanAtZoom(_)+T.descensionFactor*Math.LN2*d.compared.pan-d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*A*(-2*A*U*fe-2*A*ne+2*U+2*ne*fe/(x*x)-fe/(_*_))/(d.desiredPixelFlow*Math.LN2)}function z7(d,_){return d.halfWindowSize*Math.log(_/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2)}function H7(d,_){return d.halfWindowSize/(_*d.desiredPixelFlow*Math.LN2)}function G7(d,_){return-d.halfWindowSize/(_*_*d.desiredPixelFlow*Math.LN2)}class Y7 extends S7{constructor(_,T){super(),this._preallocSegments=[new FP,new FP,new FP],this.update(_,T)}update(_,T){if(!_)return;this.definition?this.definition.copyFrom(_):this.definition=_.clone();let x=null;T&&T.apex&&(x=function Z7(d,_){let T=function $7(d,_){const T=Math.max(d.compared.sourceZoom,d.compared.targetZoom),x=d.source.zoomAtPixelsPerPan(d.desiredPixelFlow/d.compared.pan)/2;return x<T?null!=_.maximumDistance?T+(_.maximumDistance-T)/2:1.5*T:_.maximumDistance?Math.min(_.maximumDistance,x):x}(d,_);const x={ascensionFactor:null!=_.ascensionFactor?_.ascensionFactor:.5,descensionFactor:null!=_.descensionFactor?_.descensionFactor:.5},A=0===x.ascensionFactor,U=0===x.descensionFactor,ne=A?I7:A7,fe=A?L7:R7,Oe=A?U7:w7,we=U?z7:N7,Ze=U?H7:W7,it=U?G7:V7,lt=Zt=>ne(d,Zt,x)+function B7(d,_,T){return-d.compared.pan*d.halfWindowSize*(T.ascensionFactor+T.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(_))}(d,Zt,x)+we(d,Zt,x),Tt=Zt=>Oe(d,Zt,x)+function F7(d,_,T){return-2*d.compared.pan*d.halfWindowSize*(T.ascensionFactor+T.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(_*_*_))}(d,Zt,x)+it(d,Zt,x);let mt=lt(T);const Mt=function K7(d){const _=Math.LN2*d.compared.pan,x=d.halfWindowPanAtZoom(d.compared.sourceZoom-d.compared.targetZoom),A=d.halfWindowSize*Math.log(d.compared.sourceZoom/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*x);return d.compared.sourceZoom<=d.compared.targetZoom?A*(_-x):A*(_+x)}(d);let Pt;const Nt=_.maximumIterations||20,Bt=null!=_.maximumDistance?_.maximumDistance:1/0;for(Pt=0;Pt<Nt;Pt++){const nr=(fe(d,Zt=T,x)+function j7(d,_,T){return d.compared.pan*d.halfWindowSize*(T.ascensionFactor+T.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(_*_))}(d,Zt,x)+Ze(d,Zt,x)+1e-6)/Tt(T);if(isNaN(nr)||T>=Bt&&nr<0){if(!isFinite(Bt))return null;T=Bt,mt=lt(T);break}if(T-=nr,T<d.compared.sourceZoom||T<d.compared.targetZoom)return null;const Jt=lt(T);if(Math.abs(Jt-mt)/mt<=.005)break;mt=Jt}var Zt;return mt>.7*Mt||T<d.compared.sourceZoom||T<d.compared.targetZoom?null:T}(_,T.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==x?this._updateWithoutApex():this._updateWithApex(x,T.apex)}segmentInterpolateComponentsAt(_,T,x){return x=_.interpolateComponentsAt(T,x),_===this._ascensionSegment?x.zoom=AP(x.zoom):_===this._descensionSegment&&(x.zoom=y1(x.zoom)),x}_updateWithApex(_,T){const[x,A,U]=this._preallocSegments,ne=null!=T.ascensionFactor?T.ascensionFactor:.5,fe=Math.min(1-ne,null!=T.ascensionFactor?T.descensionFactor:.5),Oe=1-ne-fe;x.definition?x.definition.copyFrom(this.definition):x.definition=this.definition.clone(),x.definition.compared.targetZoom=_,x.definition.compared.pan=this.definition.compared.pan*ne,x.definition.compared.rotate=this.definition.compared.rotate*ne,x.update(),this._ascensionSegment=x,this.segments.push(x),Oe>0&&(A.definition?A.definition.copyFrom(this.definition):A.definition=this.definition.clone(),A.definition.copyFrom(this.definition),A.definition.compared.sourceZoom=_,A.definition.compared.targetZoom=_,A.definition.compared.pan=this.definition.compared.pan*Oe,A.definition.compared.rotate=this.definition.compared.rotate*Oe,A.update(),this.segments.push(A)),U.definition?U.definition.copyFrom(this.definition):U.definition=this.definition.clone(),U.definition.compared.sourceZoom=_,U.definition.compared.pan=this.definition.compared.pan*fe,U.definition.compared.rotate=this.definition.compared.rotate*fe,U.update(),this._descensionSegment=U,this.segments.push(U)}_updateWithoutApex(){const[_]=this._preallocSegments;_.update(this.definition),this.segments.push(_)}}const X7={zoom:0,pan:0,rotate:0};class k7{constructor(_){this._createCamera=_,this._time=(0,mi.HA)(0),this.definition=new jP(_),this.path=new Y7}get time(){return this._time}update(_,T,x){this.definition.update(_,T,x),this.path.update(this.definition,x),this._time=this._applyTimeSettings((0,mi.up)(isFinite(this.path.time)?this.path.time:(0,mi._H)(0)),x),this._easing=x.easing?x.easing:this._time>=1e3?C3:yg}cameraAt(_,T){T=T||this._createCamera(),_=Math.min(Math.max(0,_),1),_=this._normalizedEasing(_);const x=this.path.interpolateComponentsAt(_,X7);return T.interpolate(this.definition.source,this.definition.target,x),T}_normalizedEasing(_){const T=this._easing(0,this._time),x=this._easing(1,this._time);return(this._easing(_,this._time)-T)/(x-T)}_applyTimeSettings(_,T){const x=null!=T.speedFactor?T.speedFactor:1;null!=T.duration?_=T.duration:null!=T.speedFactor&&(_=(0,mi.HA)(_/x));const U=null!=T.maxDuration?T.maxDuration:v1_maxDuration/x;return(0,mi.HA)(Math.min(Math.max(null!=T.minDuration?T.minDuration:v1_minDuration/x,_),U))}}const J7=(0,ir.c)();class Q7{constructor(_){this.currentTime=(0,mi.HA)(0),this._animation=new k7(()=>new M3(_)),this._current=new M3(_)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(_,T,x){const A=this._animation.definition.source,U=this._animation.definition.target,ne=(0,pt.b)(J7,T.center,_.center),fe=(0,pt.l)(ne);fe>=1e-5?(ne[0]/=fe,ne[1]/=fe,ne[2]/=fe):(ne[0]=0,ne[1]=1,ne[0]=0),(0,pt.c)(A.lookAtDirection,ne),(0,pt.c)(U.lookAtDirection,ne),A.copyFromRenderCamera(_),U.copyFromRenderCamera(T),this._current.copyFrom(A),this._animation.update(A,U,x),this.currentTime=(0,mi.HA)(0),_.almostEquals(T)&&(this.currentTime=this._animation.time)}cameraAt(_,T){return this._animation.cameraAt(_,this._current),T=T||new $i.V,this._current.copyToRenderCamera(T),T}step(_,T){return this.finished||(this.currentTime=(0,mi.HA)(this.currentTime+(0,mi.up)(_)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,T)}}var Kn;!function(d){d.Ready="ready",d.Rejected="rejected",d.Running="running",d.Stopped="stopped",d.Finished="finished"}(Kn||(Kn={}));let Dd=class extends Ns.Z{constructor(d){super(d),this.state=Kn.Ready}get active(){return this.state===Kn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Kn.Stopped,!0)}finishController(){this.state=Kn.Finished}get steppingFinished(){return!1}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Dd.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Dd.prototype,"active",null),(0,Ve._)([(0,ke.Cb)()],Dd.prototype,"state",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Dd.prototype,"isInteractive",null),Dd=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.CameraController")],Dd);let vg=class extends Dd{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(d){this._asyncResult&&(this._asyncResult.reject((0,ws.zE)()),this._asyncResult=null),this.state===Kn.Finished||this.state===Kn.Stopped?((0,Qe.O3)(d),this.state===Kn.Finished?d.resolve():d.reject((0,ws.zE)())):this._asyncResult=d}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Kn.Running,(0,Qe.pC)(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!(0,Qe.pC)(this.viewAnimation)||this.state!==Kn.Ready&&this.state!==Kn.Running||(this.viewAnimation.state===g_.State.FINISHED?this.finish():this.viewAnimation.state===g_.State.STOPPED&&(this.state=Kn.Stopped))}onControllerEnd(){(0,Qe.pC)(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Kn.Finished?this.viewAnimation.finish():this.state===Kn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Kn.Finished?this._asyncResult.resolve():this._asyncResult.reject((0,ws.zE)()))}finish(){this.finishController()}};vg=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.AnimationController")],vg);let Sd=class extends vg{constructor(d){super(d),this.mode="interaction",this._hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new Q7(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new g_}get isInteractive(){return"interaction"===this.mode}begin(d,_){this._hasTarget=!0;const T=this.animationSettings(_);E1.copyFrom(this.view.state.camera);const x=(0,Ga.Z8)(this.view.state.viewingMode);this.intersectionHelper.intersectRay(E1.ray,x,P3)&&(E1.center=P3),this.animation.update(E1,d,T),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(d,_){this._hasTarget&&this.animation.step(d,_)}onControllerEnd(d){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,d),this.animation.currentTime=this.animation.time),super.onControllerEnd(d)}animationSettings(d={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...d,easing:"string"==typeof d.easing?C7[d.easing]:d.easing}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Sd.prototype,"mode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Sd.prototype,"isInteractive",null),Sd=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.PointToPointAnimationController")],Sd);const E1=new $i.V,P3=(0,ir.c)();var q7=v(48977),NP=v(78451),WP=v(34054),Dn=v(26242);function I_(d=tj){return[d[0],d[1],d[2],d[3]]}function Eg(d,_){return function VP(d,_,T,x,A=I_()){return A[0]=d,A[1]=_,A[2]=T,A[3]=x,A}(d[0],d[1],d[2],_,Dn.o6.get())}function zP(d,_,T){return(0,pt.f)(T,d,_),(0,pt.n)(T,T),T[3]=(0,WP.EU)(d,_),T}const tj=[0,0,1,0];(0,NP.a)(),(0,NP.a)();var Rn=v(90014),ju=v(26046);function HP(d,_,T,x){const A=(0,ju.iE)(_,T,rj);return(0,oo.i)(d,A,x)}const rj=(0,yc.Ue)();var L_;!function(d){d[d.Ellipsoid=0]="Ellipsoid",d[d.Silhouette=1]="Silhouette"}(L_||(L_={}));const C1=[1,3e8];function t0(d,_,T){return T[0]=_[0]/(d.fullWidth/d.pixelRatio),T[1]=_[1]/(d.fullHeight/d.pixelRatio),T}function GP(d){for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d}function Bh(d,_,T){const x=(0,gi.d)(Dn.MP.get(),T[3],T);(0,Qe.Wi)(x)||(0,gi.j)(x,gn.I)||((0,pt.b)(yn,d.eye,_),(0,pt.m)(yn,yn,x),d.eye=(0,pt.a)(yn,yn,_),(0,pt.b)(yn,d.center,_),(0,pt.m)(yn,yn,x),d.center=(0,pt.a)(yn,yn,_),d.up=(0,pt.m)(yn,d.up,x))}function KP(d,_,T,x){return(0,Rn.BR)(d,(0,ju.iE)(_,T,kP),x)}function ZP(d,_,T,x){const A=Dn.WM.get();let U=1-T;(0,pt.b)(A,_,d.eye);const ne=(0,pt.l)(A);let fe=ne*(1-U);U>=0&&fe<x&&(fe=x,U=-(fe-ne)/ne),Math.abs(ne-fe)<1e-6||((0,pt.g)(A,A,U),d.eye=(0,pt.a)(yn,d.eye,A),d.center=(0,pt.h)(yn,d.center,_,U))}function A3(d,_,T){_.getScreenCenter(R3),HP(d,_,R3,yn)&&(_.center=yn);const x=_.distance,A=x*T;if(Math.abs(x-A)<1e-6)return;const U=(0,pt.g)(Dn.WM.get(),_.viewForward,A);_.eye=(0,pt.b)(yn,_.center,U)}const R3=(0,li.s1)();function $P(d,_){(0,pt.s)(_,0,0,0);for(const T of d)(0,pt.a)(_,_,T);(0,pt.g)(_,_,1/d.length)}function T1(d,_,T,x){return Math.sin(d/(0,pt.l)(_))*(T+x.radius)}function w3(d,_,T,x){return T1(Math.PI/2,_,T,x)+(d-Math.PI/2)}var fa;!function(d){d[d.Vertical=0]="Vertical",d[d.Horizontal=1]="Horizontal"}(fa||(fa={}));const I3_Angle=(0,xr.Vl)(6),M1_Angle=(0,xr.Vl)(18),L3=(0,xr.Vl)(80);function U3(d,_,T,x,A,U){const ne=(0,ir.c)(),fe=(0,oo.c)();let Oe=!0,we=!0;return d.intersectScreen(T,ne,U)?fe[3]=(0,pt.l)(ne):(we=!1,fe[3]=_.aboveGround&&A!==L_.Ellipsoid?Math.max((0,pt.l)(_.center),.9*x.radius):(0,pt.l)(_.eye)-_.relativeElevation,A===L_.Silhouette?bg(fe,_,T,ne):Oe=HP(fe,_,T,ne)),{sphere:fe,scenePickPoint:Oe?ne:null,hasGeometryIntersection:we}}function P1(d,_,T,x){return(0,pt.l)(d.eye)-x.radius>3e4?fa.Horizontal:T?((0,ju.iE)(d,_,k3),-Math.sign(d.relativeElevation)*(.5*Math.PI+(0,WP.EU)(d.eye,k3.direction))<I3_Angle?fa.Vertical:fa.Horizontal):fa.Vertical}function B3(d,_,T){(0,pt.b)(YP,T,_),d.eye=(0,pt.b)(yn,d.eye,YP),d.center=(0,pt.b)(yn,d.center,YP)}const YP=(0,ir.c)();function bg(d,_,T,x){const A=(0,ju.iE)(_,T,kP);return!((0,Qe.Wi)(A)||((0,oo.b)(d,A,O1),(0,oo.i)(d,A,x)?(0,pt.d)(O1,A.origin)<(0,pt.d)(x,A.origin)&&((0,pt.c)(x,O1),1):((0,pt.b)(U_,_.eye,_.center),(0,pt.n)(U_,U_),(0,Rn.Oy)(U_,-(0,pt.e)((0,pt.n)(U_,U_),O1),j3),(0,Rn.BR)(j3,A,x),1)))}const O1=(0,ir.c)(),U_=(0,ir.c)(),j3=(0,Rn.Ue)();function F3(d,_,T,x,A,U){let ne=0;if((0,pt.f)(L1,d,_),(0,pt.b)(w1,d,_),(0,pt.l)(d)<=A||!x.aboveGround){(0,pt.f)(T,w1,x.eye);const fe=(0,pt.e)(d,_)/((0,pt.l)(d)*(0,pt.l)(_));if(fe<.9999)ne=(0,xr.ZF)(fe);else{const we=(0,pt.l)((0,pt.f)((0,ir.c)(),d,_))/((0,pt.l)(d)*(0,pt.l)(_));ne=(0,xr.Kt)(we)}const Oe=Math.cos((0,xr.uZ)(za.Q4.normalize((0,xr.Vl)(U)),0,L3));ne=-ne-Math.max(0,(0,pt.l)(_)-A)/(Oe*A)}else(0,pt.b)(N3,x.eye,x.center),(0,pt.f)(T,w1,N3),ne=-(0,pt.l)(w1)/A;return(0,pt.n)(T,T),(0,pt.g)(T,T,(0,pt.l)(L1)),ne}const N3=(0,ir.c)();function W3(d,_,T,x){let A,U;const ne=Math.cos((0,xr.uZ)(za.Q4.normalize((0,xr.Vl)(x)),0,L3));return A=_>T?-(_-T)/(ne*T):_<-T?Math.PI-(_+T)/(ne*T):(0,xr.ZF)(_/T),U=d>T?-(d-T)/(ne*T):d<-T?Math.PI-(d+T)/(ne*T):(0,xr.ZF)(d/T),(U-A)*T}function V3(d,_,T,x,A,U,ne,fe,Oe,we){(0,pt.f)(L1,d,_),(0,o_.Tz)(U.up,U.eye,x1,D1,S1),(0,o_.Tz)([0,0,1],U.eye,Ad,jh,K3),(0,pt.c)(T,jh),(0,pt.c)(x,Ad),(0,pt.n)(T,T),(0,pt.g)(T,T,(0,pt.l)(L1)),(0,o_.yS)(d,(0,pt.n)(D1,D1),(0,pt.n)(S1,S1),(0,pt.n)(x1,x1),Z3),(0,o_.yS)(_,D1,S1,x1,$3),function ij(d,_,T,x,A,U,ne,fe,Oe,we){const Ze=W3(d[2],_[2],U[3],fe),it=Oe?W3(d[0],_[0],U[3],180):_[0]-d[0],lt=Math.sin(ne)*it-Math.cos(ne)*Ze,dt=Math.cos(ne)*it+Math.sin(ne)*Ze;(0,pt.n)(yn,A);const Tt=Oe?lt/Math.sqrt(Math.abs(U[3]**2-(0,pt.e)(T,yn)**2)):lt/U[3],mt=dt/Math.sqrt(Math.abs(U[3]**2-(0,pt.e)(T,x)**2));(0,ti.s)(we,Tt,mt)}(Z3,$3,d,Ad,jh,ne,fe,Oe,we,A)}function nj(d,_,T,x,A,U,ne){(0,gi.d)(A1,A,x),(0,gi.d)(R1,ne,U),(0,gi.m)(B_,A1,R1),(0,pt.b)(_,d,T),(0,pt.m)(_,_,B_),(0,pt.a)(_,_,T)}function z3(d,_,T,x,A,U){(0,gi.d)(A1,x,T),(0,gi.d)(R1,U,A),(0,gi.m)(B_,A1,R1),(0,pt.b)(yn,d.eye,_),(0,pt.m)(yn,yn,B_),d.eye=(0,pt.a)(yn,yn,_),(0,pt.b)(yn,d.center,_),(0,pt.m)(yn,yn,B_),d.center=(0,pt.a)(yn,yn,_),(0,pt.b)(yn,d.up,_),(0,pt.m)(yn,yn,B_),d.up=(0,pt.a)(yn,yn,_)}function XP(d,_,T,x,A,U){return(Math.abs(x)>Math.PI-M1_Angle||Math.abs(x)<M1_Angle)&&(Math.abs(d[2])<.95*T||Math.abs(_)>T)&&U.aboveGround&&A<45}function H3(d,_,T,x,A,U){if(U)zP(T,x,Y3),Bh(_,d,Y3);else{const ne=F3(T,x,X3,_,d[3],A);Bh(_,d,Eg(X3,ne))}}function G3(d,_,T,x,A,U,ne){const fe=ne?20:1;let we,Ze;(0,pt.c)(r0,x),I1.copyFrom(_);for(let it=0;it<fe&&(0,pt.d)(T,r0)>1e-12&&(we=(0,pt.d)(T,r0),V3(T,r0,jh,Ad,Cg,I1,d,A,U,ne),z3(I1,d,Ad,Cg[1],jh,Cg[0]),nj(r0,r0,d,Ad,Cg[1],jh,Cg[0]),Ze=(0,pt.d)(T,r0),Ze<we||0===it);it++)_.copyFrom(I1)}const Ad=(0,ir.c)(),jh=(0,ir.c)(),K3=(0,ir.c)(),x1=(0,ir.c)(),D1=(0,ir.c)(),S1=(0,ir.c)(),Z3=(0,ir.c)(),$3=(0,ir.c)(),Cg=(0,un.a)(),Y3=I_(),A1=(0,gn.c)(),R1=(0,gn.c)(),B_=(0,gn.c)(),r0=(0,ir.c)(),yn=(0,ir.c)(),w1=(0,ir.c)(),I1=new $i.V,L1=(0,ir.c)(),X3=(0,ir.c)(),kP={origin:(0,ir.c)(),direction:(0,ir.c)()},k3={origin:(0,ir.c)(),direction:(0,ir.c)()};var bc=v(40841);let U1=class extends Sd{constructor(){super(...arguments),this._zoomLocation=(0,ir.c)(),this._tmpCamera=new $i.V,this._tmpViewDir=(0,ir.c)(),this._tmpRayDir={origin:(0,ir.c)(),direction:(0,ir.c)()},this._targetOnSphere=(0,ir.c)(),this._tmpCenter=(0,ir.c)(),this._constraintOptions={selection:xn.ALL_EXCEPT_COLLISION,interactionType:wi.ZOOM,interactionFactor:null,interactionStartCamera:new $i.V,interactionDirection:null,tiltMode:qo.TUMBLE},this._sphere=(0,oo.c)()}initialize(){this._intersector=(0,Ga.Z8)(this.view.state.viewingMode)}zoomStep(d,_){if(!this.active)return;const T=this.view.state,{interactionStartCamera:x}=this._constraintOptions;this.animation.finished?x.copyFrom(T.camera):this.animation.cameraAt(1,x);let A=!1,U=!1;this.intersectionHelper.intersectScreen(_,this._zoomLocation,0===this.view.map.ground.opacity?pj:{})&&(A=d>0,U=!0),this._tmpCamera.copyFrom(T.camera),A?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,pt.c)(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,d,this._zoomLocation,_,U),this.begin(this._tmpCamera)}animationSettings(){return{apex:null,duration:(0,mi.HA)(600),easing:yg}}_updateCamera(d,_,T,x,A){const ne=P1(d,x,A,(0,En.Iu)(this.view.spatialReference));let fe;this.view.camera.position.hasZ&&(fe=Math.abs(this.view.camera.position.z)),(0,pt.n)(j1,d.eye),(0,pt.g)(j1,j1,-1),(0,ju.iE)(d,x,this._tmpRayDir),(0,pt.n)(this._tmpRayDir.direction,this._tmpRayDir.direction);const Oe=Math.max(Math.min(12,1/Math.abs((0,pt.e)(j1,this._tmpRayDir.direction)))*fe,200);if(ne===fa.Horizontal){let we=.6**_;this._sphere[3]=(0,pt.l)(T),(0,pt.b)(this._tmpViewDir,d.center,d.eye);const Ze=Math.min((0,pt.l)(this._tmpViewDir),Oe);let it=Ze*we;if(we<=1&&it<4&&(it=4,we=it/Ze),Math.abs(Ze-it)<1e-6)return;const lt=(0,pt.l)(d.center);this._sphere[3]!==lt&&(d.center=(0,pt.g)(B1,d.center,(this._sphere[3]+we*(lt-this._sphere[3]))/lt)),(0,pt.g)(this._tmpViewDir,this._tmpViewDir,-we),d.eye=(0,pt.a)(B1,d.center,this._tmpViewDir),_o(this.view,d,this._constraintOptions),(0,pt.d)(T,d.center)>1e-12&&HP(this._sphere,d,x,this._targetOnSphere)&&function oj(d,_,T,x,A,U,ne){XP(T,(0,pt.e)(_.up,T),d[3],-za.Q4.normalize((0,xr.Vl)(A)),U,_)?G3(d,_,T,x,-za.Q4.normalize((0,xr.Vl)(A)),U,ne):H3(d,_,T,x,U,ne)}(this._sphere,d,T,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let we=.6**Math.abs(_);const Ze=_>0?1:-1;(0,pt.b)(this._tmpViewDir,T,d.eye);const it=(0,pt.l)(this._tmpViewDir),lt=this.view._stage.renderView.getMinimalDepthForArea(null,x[0],x[1],this.view.state.camera,60);let dt=(0,Qe.pC)(lt)?Math.min(Oe,lt):Oe;dt=A?Math.min(dt,it):dt,(0,pt.g)(this._tmpRayDir.direction,this._tmpRayDir.direction,dt),(0,pt.a)(T,this._tmpRayDir.origin,this._tmpRayDir.direction);let Tt=dt*we;const mt=Math.max(4,1.01*d.nearFar[0]);if(_>0&&Tt<mt&&(Tt=mt,we=Tt/dt),Math.abs(dt-Tt)<1e-6)return;(0,pt.g)(this._tmpRayDir.direction,this._tmpRayDir.direction,Ze*(1-we)),d.eye=(0,pt.a)(B1,d.eye,this._tmpRayDir.direction),d.center=(0,pt.a)(B1,d.center,this._tmpRayDir.direction)}w_(this.view,d)}};U1=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.global.ZoomStepController")],U1);const B1=(0,ir.c)(),j1=(0,ir.c)(),pj={exclude:new Set([bc.cy])};let F1=class extends Sd{constructor(){super(...arguments),this._zoomLocation=(0,ir.c)(),this._tmpCamera=new $i.V,this._tmpRayDir=(0,ir.c)(),this._tmpCenter=(0,ir.c)(),this._constraintOptions={selection:xn.ALL,interactionType:wi.ZOOM,interactionFactor:null,interactionStartCamera:new $i.V,interactionDirection:null,tiltMode:qo.TUMBLE}}zoomStep(d,_){if(!this.active)return;const T=this.view.state,{interactionStartCamera:x}=this._constraintOptions;this.animation.finished?x.copyFrom(T.camera):this.animation.cameraAt(1,x),this._tmpCamera.copyFrom(T.camera);const A=(0,Ga.Z8)(this.view.state.viewingMode);d>0?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(_,this._zoomLocation,Ej):this.intersectionHelper.intersectScreenFreePointFallback(_,this._zoomLocation),this.intersectionHelper.intersectRay(this._tmpCamera.ray,A,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,A,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,pt.c)(this._zoomLocation,this._tmpCamera.center);const U=.6**d;let ne=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,_[0],_[1],this.view.state.camera,60);(0,pt.b)(N1,this._tmpCamera.eye,this._zoomLocation),(0,pt.n)(N1,N1);const fe=Math.max(Math.min(14,1/Math.abs((0,pt.e)(vj,N1)))*Math.abs(this.view.camera.position.z),200);if(ne=(0,Qe.pC)(ne)?Math.min(ne,fe):fe,ne){const Oe=(0,ir.c)();(0,pt.b)(Oe,this._zoomLocation,this._tmpCamera.eye),ne<(0,pt.l)(Oe)&&((0,pt.n)(Oe,Oe),(0,pt.a)(this._zoomLocation,this._tmpCamera.eye,(0,pt.g)(Oe,Oe,ne)))}this._updateCamera(this._tmpCamera,U,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{apex:null,duration:(0,mi.HA)(600),easing:yg}}_updateCamera(d,_,T){(0,pt.b)(this._tmpRayDir,T,d.eye);const x=(0,pt.l)(this._tmpRayDir);let A=x*_;const U=_<=1,ne=Math.max(4,1.01*d.nearFar[0]);0!==A&&(U&&A<ne&&(A=ne,_=A/x),Math.abs(x-A)<1e-6||((0,pt.g)(this._tmpRayDir,this._tmpRayDir,_),d.eye=(0,pt.b)(Q3,T,this._tmpRayDir),d.center=(0,pt.h)(Q3,d.center,T,1-_),_o(this.view,d,this._constraintOptions)))}};F1=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.local.ZoomStepController")],F1);const Q3=(0,ir.c)(),vj=(0,ir.f)(0,0,1),N1=(0,ir.c)(),Ej={exclude:new Set([bc.cy])};var nl=v(35216);function QP(d,_){if("touch"===d.pointerType)return!1;switch(_){case"primary":return 0===d.button;case"secondary":return 2===d.button;case"tertiary":return 1===d.button}}class Cj extends nl.a{constructor(_,T){super(!0),this._view=_,this.registerIncoming("double-click",T,x=>this._handleDoubleClick(x))}_handleDoubleClick(_){const T=_.data;if(function bj(d,_){switch(_){case"primary":return"touch"===d.pointerType||0===d.button;case"secondary":return"touch"!==d.pointerType&&2===d.button;case"tertiary":return"touch"!==d.pointerType&&1===d.button}}(T,"primary")){const x=this._view.state.isGlobal?new U1({view:this._view,mode:"animation"}):new F1({view:this._view,mode:"animation"});this._view.state.switchCameraController(x),x.zoomStep(Math.log(.5)/Math.log(.6),(0,li.s1)(T.x,T.y)),_.stopPropagation()}}}class Mj{constructor(_,T){this._elevationProvider=_,this._referenceEllipsoid=(0,En.Iu)(T),this._unitInMeters=(0,dM.c9)(T,this._referenceEllipsoid.metersPerDegree)}compute(_,T,x,A,U){U||(U={near:0,far:0});let ne=_[2]*this._unitInMeters;const Oe=ne-A,we=this._elevationProvider?.visibleElevationBounds;we&&(ne=Oe>=0?ne-this._unitInMeters*we.min:this._unitInMeters*we.max-ne);const Ze={x:(x=(0,Qe.pC)(x)?x:new bl.Z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-x.xmin,y:x.ymax-x.ymin,z:4*Math.max(x.xmax-x.xmin,x.ymax-x.ymin)},it=Math.max(Ze.x,Ze.y,Ze.z);(0,pt.b)(s0,T,_),j_[0]=s0[0]>0?x.xmax:x.xmin,j_[1]=s0[1]>0?x.ymax:x.ymin,j_[2]=s0[2]>0?it/2:-it/2,(0,pt.b)(j_,j_,_),(0,pt.n)(s0,s0);const lt=1.1*(0,pt.e)(j_,s0)*this._unitInMeters,dt=Math.sqrt(ne*(ne+2*this._referenceEllipsoid.radius)),Tt=Math.max(x.xmax-x.xmin,x.ymax-x.ymin),Mt=Tt*Sj*this._unitInMeters;let Pt=(0,xr.uZ)((ne-Mt)/(Tt*Dj*this._unitInMeters-Mt),0,1);Pt*=Pt*Pt;let Nt=Math.min((0,xr.t7)(dt,lt,Pt),dt);return Nt*=Math.max(Math.log(Math.abs(Oe)),1),Nt=Math.min(Nt,Math.max(34064e4,it)),Nt/=this._unitInMeters,q3(Nt,Oj,this._unitInMeters,U)}}class Pj{constructor(_){this._referenceEllipsoid=(0,En.Iu)(_)}compute(_,T,x,A,U){U||(U={near:0,far:0});const ne=(0,pt.l)(_)-this._referenceEllipsoid.radius,fe=this._referenceEllipsoid.radius+Math.min(0,A),Oe=Math.abs(ne-A),we=Math.max(Oe,Math.abs(ne));return q3(1.2*Math.sqrt(we*(we+2*fe)),(0,xr.uZ)(2e4-(Math.log(we)-7.983)/9.011*19e3,1e3,2e4),1,U)}}function q3(d,_,T,x){const A=xj/T;return d/_>A?(x.far=d,x.near=x.far/_):(x.near=A,x.far=x.near*_),x}const Oj=2e4,xj=2,Dj=.001,Sj=1e-4,j_=(0,ir.c)(),s0=(0,ir.c)();let W1=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z}initialize(){this._handles.add(this.view.basemapTerrain.on("elevation-change",d=>this._handleElevationChangeEvent(d)))}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}_handleElevationChangeEvent(d){if(this.view.state.cameraController)return;const _=this.view.state.camera;(0,Qe.pC)(d.spatialReference)&&c3(this.view,_,d.extent,d.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(d=>w_(this.view,d,Vc.EYE_AND_CENTER))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],W1.prototype,"view",void 0),W1=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.ElevationCollisionConstraint")],W1);let Tg=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this.nearFarHeuristic=function Tj(d,_,T){return d===vi.JY.Global?new Pj(T):new Mj(_,T)}(d.view.state.viewingMode,d.view.basemapTerrain,d.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([(0,Ht.YP)(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),(0,Ht.YP)(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",d=>this._updateCameraNearFar(d.camera)),(0,Ht.YP)(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Ht.Z_),(0,Ht.YP)(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Ht.Z_),(0,Ht.YP)(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Ht.Z_),(0,Ht.YP)(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Ht.Z_),(0,Ht.YP)(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Ht.Z_),(0,Ht.YP)(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Ht.Z_)]),this.view.state.isLocal&&this._handles.add((0,Ht.YP)(()=>this.view.renderDataExtent,d=>this._updateLocalSurfaceDistance(d),Ht.nn)),this._updateNearFar(),this.view.state.viewingMode!==vi.JY.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new W1({view:this.view}))}destroy(){this._handles=(0,Qe.SC)(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const d=this.view.constraints?.clipDistance;d&&"auto"!==d.mode&&this.view.state.updateCamera(_=>this._updateCameraNearFarManual(_,d))}_updateNearFar(){this.view.state.updateCamera(d=>this._updateCameraNearFar(d))}_updateCameraNearFar(d){const _=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(_?_.mode:"auto")?this._updateCameraNearFarManual(d,_):this._updateCameraNearFarAuto(d,_)}_updateCameraNearFarAuto(d,_){this.nearFarHeuristic.compute(d.eye,d.center,this.view.renderDataExtent,_1(this.view,d.eye),d),_&&_.autoUpdate(d.near,d.far)}_updateCameraNearFarManual(d,_){_&&(d.near=_.near,d.far=_.far)}_updateCollision(){const d=this.view.map?.ground?.navigationConstraint?.type,_=!d||"stay-above"===d,T=this.view.state.constraints.collision;if(_!==T.enabled){T.enabled=_,_&&this._reapplyConstraints(xn.COLLISION);const x=this.view.constraints&&this.view.constraints.tilt;x&&"auto"!==x.mode||this._updateTiltAuto()}}_updateAltitude(){const d=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=d&&this.view.state.viewingMode!==vi.JY.Local?{min:d.min,max:d.max}:null,this._reapplyConstraints()}_updateTiltMax(){const d=this.view.constraints&&this.view.constraints.tilt;d&&"auto"!==d.mode&&(this._updateTiltManual(d),this._reapplyConstraints())}_updateTilt(){const d=this.view.constraints&&this.view.constraints.tilt;"manual"===(d?d.mode:"auto")?this._updateTiltManual(d):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(d){const _=this.view.state.constraints;_.tilt=_.createConstantMaxTilt((0,xr.Vl)(d.max))}_updateTiltAuto(){const d=this.view.state.constraints;d.tilt=d.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const d=this.view.constraints&&this.view.constraints.tilt;if(!d||"auto"!==d.mode)return;const _=this.view.state.constraints;if(_.tilt){const T=_.tilt(this.view.state.camera.distance).max;d.autoUpdate((0,xr.BV)(T))}}_updateLocalSurfaceDistance(d){if((0,Qe.Wi)(d))return;let _=Math.max(d.width,d.height);if(_<=0)return;d.hasZ&&(_=Math.max(_,d.zmax-d.zmin));const T=this.view.state,x=3*_/Math.atan(T.camera.fov/2);x!==T.constraints.distance&&(T.constraints.distance=x)}_reapplyConstraints(d=xn.ALL){this.view.state.updateCamera(_=>_o(this.view,_,{selection:d,interactionType:wi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:qo.TUMBLE}))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Tg.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Tg.prototype,"surfaceCollisionConstraint",void 0),Tg=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.ConstraintsManager")],Tg);var F_=v(24805);let Mg=class extends Dd{constructor(d){super(d),this._handles=new Ji.Z}set desiredCamera(d){this._set("desiredCamera",d.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Kn.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",d=>this._handleElevationChangeEvent(d))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(d){(0,Qe.pC)(d.spatialReference)&&!c3(this.view,this.desiredCamera,d.extent,d.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(d=>{d.copyViewFrom(this.desiredCamera),w_(this.view,d,Vc.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Kn.Stopped)})}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Mg.prototype,"desiredCamera",null),Mg=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Mg);const Aj=(0,ir.c)(),V1=(0,ir.c)();function qP(){return{direction:(0,ir.c)(),up:(0,ir.c)()}}function eR(d,_,T,x,A){let U=(0,pt.n)(Aj,d),ne=(0,pt.e)(U,x);const fe=ne>0;ne=Math.abs(ne),ne>.99&&(ne=Math.abs((0,pt.e)(_,x)),ne<.99?((0,pt.c)(U,_),fe&&(0,pt.g)(U,U,-1)):U=null);let Oe=0;if(U){(0,pt.g)(V1,x,(0,pt.e)(x,U)),(0,pt.b)(U,U,V1);const Ze=(0,pt.e)(U,A)/((0,pt.l)(U)*(0,pt.l)(A));(0,pt.f)(V1,U,A),Oe=((0,pt.e)(V1,x)>0?1:-1)*(0,xr.BV)((0,xr.ZF)(Ze))}const we=(0,xr.BV)((0,xr.ZF)(-(0,pt.e)(x,d)/(0,pt.l)(d)));return T?(T.heading=Oe,T.tilt=we,T):{heading:Oe,tilt:we}}const tR=(0,ir.f)(0,1,0),rR=(0,ir.f)(0,0,1),Pg=(0,gn.c)(),Rd=(0,ir.c)(),wd=(0,ir.c)();function sR(d,_,T,x=qP()){const{direction:A,up:U}=x;return(0,gi.b)(Pg,-(0,xr.Vl)(_)),(0,gi.r)(Pg,Pg,(0,xr.Vl)(T)),(0,pt.m)(A,rR,Pg),(0,pt.g)(A,A,-1),(0,pt.m)(U,tR,Pg),x}function iR(d,_,T,x,A){const U=d.renderSpatialReference,ne=d.map&&d.spatialReference||_.spatialReference;return(0,di.KC)(_,Rd,U),(0,di.KC)(_,wd,U),Rd[0]-=T/2,wd[0]+=T/2,Rd[1]-=x/2,wd[1]+=x/2,(0,di.SH)(Rd,U,Rd,ne),(0,di.SH)(wd,U,wd,ne),A?(A.xmin=Rd[0],A.ymin=Rd[1],A.xmax=wd[0],A.ymax=wd[1],A.spatialReference=ne):A=new bl.Z(Rd[0],Rd[1],wd[0],wd[1],ne),A}const Uj=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:sR,directionToHeadingTilt:function Rj(d,_,T,x){return eR(_,T,x,rR,tR)},eyeForCenterWithHeadingTilt:function wj(d,_,T,x){const A=sR(0,T,x),U=(0,ir.c)();return(0,pt.g)(U,A.direction,-_),(0,pt.a)(U,U,d),{up:A.up,eye:U,heading:T,tilt:x}},lookAtTiltToEyeTilt:function Ij(d){return(0,xr.BV)(d)},eyeTiltToLookAtTilt:function Lj(d){return(0,xr.Vl)(d)},toExtent:iR},Symbol.toStringTag,{value:"Module"})),nR=(0,ir.f)(0,0,1),oR=(0,pt.n)((0,ir.c)(),(0,ir.f)(1,1,1)),Bj=new za.pE(-180,180),Og=(0,gn.c)(),Fh=(0,ir.c)(),N_=(0,ir.c)();function aR(d,_,T,x=qP()){(0,pt.f)(Fh,d,nR),0===(0,pt.e)(Fh,Fh)&&(0,pt.f)(Fh,d,oR),(0,gi.d)(Og,-(0,xr.Vl)(_),d),(0,gi.e)(Og,Og,-(0,xr.Vl)(T),Fh);const{up:A,direction:U}=x;return(0,pt.f)(A,Fh,d),(0,pt.n)(A,A),(0,pt.m)(A,A,Og),(0,pt.n)(U,d),(0,pt.o)(U,U),(0,pt.m)(U,U,Og),x}function e2(d){const _=d[1];d[1]=-d[2],d[2]=_}function t2(d,_){const T=aR(_,d.heading,d.tilt);return d.up=T.up,d}function lR(d,_,T,x,A){let U,ne,fe,Oe;const we=_.latitude,Ze=(0,En.Iu)(d.spatialReference).radius,it=_.longitude,lt=function u9(d,_,T){const x=_/T,A=(0,xr.Vl)(d),U=Math.sin(x/2),ne=Math.cos(A),fe=2*(0,xr.Kt)(Math.sqrt(U*U/(ne*ne)));return(0,xr.BV)(fe)}(we,T,Ze)/2;U=it-lt,ne=it+lt;const dt=(0,xr.Vl)(we),Tt=(1+Math.sin(dt))/(1-Math.sin(dt)),mt=(Tt+1)*Math.tan(x/Ze/2);function Pt(Bt){const Zt=Math.PI/2;return(Bt=za.c5.normalize(Bt,-Zt))>Zt&&(Bt=Math.PI-Bt),Bt}if(fe=1.5*Math.PI-2*Math.atan(.5*(mt+Math.sqrt(4*Tt+mt*mt))),Oe=fe+x/Ze,fe=Pt(fe),Oe=Pt(Oe),Oe<fe){const Bt=Oe;Oe=fe,fe=Bt}if(fe=Math.max((0,xr.BV)(fe),-90),Oe=Math.min((0,xr.BV)(Oe),90),ne=Bj.monotonic(U,ne),ne-U>180){const Bt=(ne-U-180)/2;U+=Bt,ne-=Bt}const Nt=d.spatialReference&&d.spatialReference.isGeographic?d.spatialReference:to.Z.WGS84;return A?(A.xmin=U,A.ymin=fe,A.xmax=ne,A.ymax=Oe,A.spatialReference=Nt):A=new bl.Z(U,fe,ne,Oe,Nt),d.spatialReference&&d.spatialReference.isWebMercator&&(0,au.$)(A,!1,A),A}const Vj=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:aR,directionToHeadingTilt:function jj(d,_,T,x){const A=Fh,U=N_;return(0,pt.n)(A,d),(0,pt.f)(N_,A,nR),0===(0,pt.e)(N_,N_)&&(0,pt.f)(N_,A,oR),(0,pt.f)(U,N_,A),eR(_,T,x,A,U)},eyeForCenterWithHeadingTilt:function Fj(d,_,T,x){const A={eye:(0,ir.c)(),up:null,tilt:x,heading:T},U=Fh;U[0]=d[0],U[1]=d[2],U[2]=-d[1];const ne=_,fe=(0,xr.Vl)(T),Oe=(0,xr.Vl)(x),we=Math.sin(fe),Ze=Math.cos(fe),it=Math.sin(Oe),lt=Math.cos(Oe),dt=(0,pt.l)(U);let Tt;if(Math.abs(Oe)<1e-8)Tt=ne+dt;else{const lr=dt/it,wr=(0,xr.Kt)(ne/lr),Gr=Math.PI-Oe-wr;Tt=lr*Math.sin(Gr)}const mt=lt*ne,Mt=ne*ne*(it*it),Pt=Ze*Ze*Mt,Nt=Tt-mt,Bt=Nt*Nt,Zt=Pt*(Pt+Bt-U[1]*U[1]);if(Zt<0)return(0,pt.g)(A.eye,U,Tt/dt),A.tilt=0,A;const nr=Math.sqrt(Zt),Jt=U[1]*Nt,Rr=Pt+Bt;let Br;if(Br=Ze>0?-nr+Jt:nr+Jt,Math.abs(Rr)<1e-8)return dt<1e-8?(A.eye[0]=0,A.eye[1]=0,A.eye[2]=ne):(0,pt.g)(A.eye,U,Tt/dt),A.tilt=0,e2(A.eye),t2(A,d);A.eye[1]=Br/Rr;const $r=we*we*Mt,Yr=it*ne,cs=Ze*Yr*A.eye[1],Xr=A.eye[1]*A.eye[1],os=1-Xr,br=Math.sqrt(os),Vr=Pt*Xr+$r-2*cs*br*Nt+os*Bt;return Math.abs(Vr)<1e-8?((0,pt.g)(A.eye,U,Tt/dt),A.tilt=0,e2(A.eye),t2(A,d)):(A.eye[0]=(os*(Tt*U[0]-mt*U[0])-Yr*br*(U[0]*A.eye[1]*Ze+U[2]*we))/Vr,A.eye[2]=(os*(Tt*U[2]-mt*U[2])-Yr*br*(U[2]*A.eye[1]*Ze-U[0]*we))/Vr,(0,pt.g)(A.eye,A.eye,Tt),e2(A.eye),t2(A,d))},lookAtTiltToEyeTilt:function Nj(d,_,T){const x=(0,pt.l)(_),A=Math.sqrt(T*T+x*x-2*T*x*Math.cos(Math.PI-d)),U=(0,xr.Kt)(T/(A/Math.sin(d)));return(0,xr.BV)(d-U)},eyeTiltToLookAtTilt:function Wj(d,_,T){const x=(0,xr.Vl)(d),A=(0,pt.l)(_);return(0,xr.Kt)(T/(A/Math.sin(x)))+x},toExtent:lR},Symbol.toStringTag,{value:"Module"}));var W_=v(53929),r2=v(86080);const cR=Us.Z.getLogger("esri.views.3d.support.cameraUtils"),pR=(0,ir.c)(),z1=(0,ir.c)(),Gj={heading:0,tilt:0},Id=new vn.Z,Kj=new za.pE(-20037508.342788905,20037508.342788905),Zj=new za.pE(-180,180);var Ia;function xg(d){return d.spatialReference||to.Z.WGS84}function V_(d){return"global"===d.viewingMode?Vj:Uj}function Ld(d,_){if((0,Qe.Wi)(_))return null;const T=d.renderSpatialReference,x=V_(d).headingTiltToDirectionUp,A=(0,ir.c)();if(!(0,di.KC)(_.position,A,T))return null;const U=x(A,_.heading,_.tilt);(0,pt.g)(U.direction,U.direction,d.state.camera.distance),(0,pt.a)(U.direction,U.direction,A);const ne=Qp(d,A,U.direction,U.up);return ne.fov=(0,xr.Vl)(_.fov),ne}!function(d){d[d.LOCKED=0]="LOCKED",d[d.ADJUST=1]="ADJUST"}(Ia||(Ia={}));const z_=(0,ir.c)();function H_(d,_,T){const x=d.renderSpatialReference,A=H1(d,_.eye,_.viewForward,_.up,Gj);let U=xg(d);return(0,di.SH)(_.eye,x,z_,U)||(U=to.Z.WGS84,(0,di.SH)(_.eye,x,z_,U)),(0,Qe.Wi)(T)?new uc(new vn.Z(z_,U),A.heading,A.tilt,(0,xr.BV)(_.fov)):(T.position.x=z_[0],T.position.y=z_[1],T.position.z=z_[2],T.position.spatialReference=U,T.heading=A.heading,T.tilt=A.tilt,T.fov=(0,xr.BV)(_.fov),T)}function i2(d,_,T){const x=d.state.camera,A=x.width/2/x.pixelRatio;return d.renderCoordsHelper.viewingMode===vi.JY.Global&&null!=T&&(_*=Math.cos((0,xr.Vl)(T))),A/(96*39.37/(_/=d.renderCoordsHelper.unitInMeters))/Math.tan(x.fovX/2)}function i0(d,_,T){const x=d.state.camera,A=_*Math.tan(x.fovX/2);let ne=96*39.37/(x.width/2/x.pixelRatio/A);return d.renderCoordsHelper.viewingMode===vi.JY.Global&&(ne/=Math.cos((0,xr.Vl)(T))),ne*=d.renderCoordsHelper.unitInMeters,ne}function _R(d,_,T,x,A,U){return fR(d,_,i2(d,T,_.latitude),x,A,U)}function fR(d,_,T,x,A,U){if(n0(U)){const fe=new G_(U.signal);return Dg(d,x.heading,x.tilt,_,T,A,fe),void fe.resolver.promise.then(Oe=>{const we=K1(d,Oe,x.fov);if(!(0,Qe.Wi)(we))return U.resolver.resolve(we);U.resolver.reject()},Oe=>U.resolver.reject(Oe))}const ne=Dg(d,x.heading,x.tilt,_,T,A);return K1(d,ne,x.fov,U)}function H1(d,_,T,x,A){return V_(d).directionToHeadingTilt(_,T,x,A)}function n2(){return n2=(0,kr.Z)(function*(d,_,T){if(!d.renderCoordsHelper.fromRenderCoords(_,Id,d.spatialReference))return!1;const x=yield d.elevationProvider.queryElevation(Id.x,Id.y,Id.z,Id.spatialReference,"ground",T);return(0,Qe.Pt)(x,0)>Id.z-1}),n2.apply(this,arguments)}function o2(){return o2=(0,kr.Z)(function*(d,_,T){const x=(0,ir.c)();if(_)if(_ instanceof vn.Z){if((0,di.KC)(_,x,d.renderSpatialReference),null==_.z&&null!=d.basemapTerrain){const A=yield d.elevationProvider.queryElevation(_.x,_.y,_.z,_.spatialReference,"ground",T);return(0,Qe.pC)(A)&&d.renderCoordsHelper.setAltitude(x,A),x}}else(0,pt.c)(x,_);else(0,pt.c)(x,d.state.camera.center);return x}),o2.apply(this,arguments)}function Dg(d,_,T,x,A,U,ne){const fe=x&&x instanceof vn.Z?x:null;if(n0(ne))return function kj(d,_,T){return o2.apply(this,arguments)}(d,x,ne.signal).then(we=>{a2(d,_,T,fe,we,A,U,ne)},we=>ne.resolver.reject(we)),null;const Oe=function Jj(d,_){const T=(0,ir.c)();if(_&&_ instanceof vn.Z){if((0,di.KC)(_,T,d.renderSpatialReference),null==_.z&&null!=d.basemapTerrain){const x=(0,W_.KO)(d.elevationProvider,_);(0,Qe.pC)(x)&&d.renderCoordsHelper.setAltitude(T,x)}}else(0,pt.c)(T,_||d.state.camera.center);return T}(d,x);return a2(d,_,T,fe,Oe,A,U,ne)}function a2(d,_,T,x,A,U,ne,fe){if((0,Qe.Wi)(x)&&(x=(0,di.fA)(A,d.renderSpatialReference,xg(d)),(0,Qe.Wi)(x)))return null;U=Math.max(U,d.state.constraints.minimumPoiDistance);const Oe=function eF(d,_,T,x,A,U){let ne=0;return U===Ia.ADJUST&&function qj(d,_,T){const x=d.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(T/x)/Math.LN2>8)return!0;const A=d.renderSpatialReference,U=xg(d),ne=(0,di.fA)(_,A,U),fe=(0,di.fA)(d.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,A,U);if((0,Qe.Wi)(ne)||(0,Qe.Wi)(fe))return!1;const Oe=Math.tan(.5*d.state.camera.fov)*x;return fe.distance(ne)/Oe>5}(d,x,A)?(_=0,ne=function tF(d,_,T,x){const A=d.state.constraints.tilt(_);A.max=Math.min(A.max,.5*Math.PI);const U=A.min*(1-.7)+.7*A.max,ne=l2(d,x,_,T);return Math.min(ne,U)}(d,A,T,x)):ne=l2(d,x,A,T),ne=d.state.constraints.clampTilt(A,ne),{heading:_,tilt:T=mR(d,x,A,ne)}}(d,_,T,A,U,ne),we=(0,V_(d).eyeForCenterWithHeadingTilt)(A,U,Oe.heading,Oe.tilt);if(ne===Ia.ADJUST&&"global"===d.viewingMode&&T>0){const it=()=>{const dt=mR(d,A,U,function rF(d,_,T,x){const A=d.state.constraints.tilt(_);let U=l2(d,x,_,T);return U=Math.min(U,.5*Math.PI),A.min*(1-G1)+U*G1}(d,U,T,A));return a2(d,_,dt,x,A,U,ne=T-dt<1?Ia.LOCKED:Ia.ADJUST,fe)},lt=d.map.ground.navigationConstraint;if(!lt||"stay-above"===lt.type){if(function Yj(d,_){return!!(d.basemapTerrain&&d.renderCoordsHelper.fromRenderCoords(_,Id,d.spatialReference)&&(0,Qe.Pt)((0,W_.KO)(d.elevationProvider,Id),0)>Id.z-1)}(d,we.eye))return it();if(n0(fe))return function Xj(d,_,T){return n2.apply(this,arguments)}(d,we.eye,fe.signal).then(dt=>dt?it():(fe.resolver.resolve({eye:we.eye,up:we.up,center:(0,ir.a)(A),heading:we.heading,tilt:we.tilt}),null)),null}}const Ze=!fe||n0(fe)?{center:(0,ir.c)(),eye:(0,ir.c)(),up:(0,ir.c)(),tilt:0,heading:0}:fe;return Ze.eye=we.eye,Ze.up=we.up,Ze.center=(0,ir.a)(A),Ze.heading=we.heading,Ze.tilt=we.tilt,n0(fe)&&fe.resolver.resolve(Ze),Ze}function Sg(d,_,T,x,A,U=null){const ne=null!=_.zmax&&null!=_.zmin;let fe,Oe,we;if(d.state.isGlobal){if(!(0,r2.D)(_.spatialReference,vi.JY.Global))return n0(U)&&U.resolver.reject(),null;const Pt=new vn.Z(_.xmin,_.ymin,_.spatialReference),Nt=new vn.Z(_.xmax,_.ymax,_.spatialReference),Bt=_.spatialReference.isGeographic?Zj:Kj;fe=new vn.Z({x:Bt.center(Pt.x,Nt.x),y:(Nt.y+Pt.y)/2,z:ne?(_.zmax+_.zmin)/2:null,spatialReference:_.spatialReference});const Zt=(0,En.Iu)(_.spatialReference),nr=function c9(d,_,T){const x=_.spatialReference,A=(0,En.Iu)(x),U=new vn.Z(_.x,d.y,x),ne=new vn.Z(T.x,d.y,x),fe=new vn.Z(d.x,_.y,x),Oe=new vn.Z(d.x,T.y,x);return{lon:YA(A.radius,U,ne),lat:YA(A.radius,fe,Oe)}}(fe,Pt,Nt);Oe=nr.lon,we=nr.lat,Bt.diff(Pt.x,Nt.x)>Bt.range/2&&(Oe+=Zt.halfCircumference),Oe=Math.min(Oe,Zt.halfCircumference),we=Math.min(we,Zt.halfCircumference)}else{const Pt=(0,Qe.Pt)(d.renderSpatialReference,_.spatialReference);Pt.equals(_.spatialReference)||(_=(0,di.iV)(_,Pt)),Oe=_.xmax-_.xmin,we=_.ymax-_.ymin,fe=new vn.Z({x:_.xmin+.5*Oe,y:_.ymin+.5*we,z:ne?(_.zmax+_.zmin)/2:null,spatialReference:Pt})}const Ze=ne?_.zmax-_.zmin:0,it=d.state.camera,lt=1/Math.tan(it.fovX/2),dt=1/Math.tan(it.fovY/2),Tt=1/Math.tan(it.fov/2),mt=Math.max(.5*Oe*lt,.5*we*dt,.5*Ze*Tt)/1;if(n0(U)){const Pt=new G_(U.signal);return Dg(d,T,x,fe,mt,A,Pt),void Pt.resolver.promise.then(Nt=>{const Bt=K1(d,Nt,d.camera.fov);if(!(0,Qe.Wi)(Bt))return U.resolver.resolve(Bt);U.resolver.reject()},Nt=>U.resolver.reject(Nt))}const Mt=Dg(d,T,x,fe,mt,A);return K1(d,Mt,d.camera.fov,U)}const G1=.7;function mR(d,_,T,x){return V_(d).lookAtTiltToEyeTilt(x,_,T)}function l2(d,_,T,x){return V_(d).eyeTiltToLookAtTilt(x,_,T)}function K1(d,_,T,x){if((0,Qe.Wi)(_))return null;const U=(0,di.fA)(_.eye,d.renderSpatialReference,xg(d));return(0,Qe.Wi)(U)?null:(0,Qe.pC)(x)?(x.position=U,x.heading=_.heading,x.tilt=_.tilt,x.fov=T,x):new uc(U,_.heading,_.tilt,T)}function gR(d,_){const T=d.basemapTerrain?.tilingScheme;if(T)return T.scaleAtLevel(_);cR.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function yR(d,_,T){const x=d.renderSpatialReference;let A,U;_||(_=d.state.camera);const ne=to.Z.WGS84;return _ instanceof uc?(A=_.position.latitude,(0,di.KC)(_.position,pR,x),(0,di.KC)(T,z1,x),U=(0,pt.i)(pR,z1)):((0,di.SH)(_.center,x,z1,ne),A=z1[1],U=_.distance),i0(d,U,A)}class G_{constructor(_){this.signal=_,this.resolver=(0,ws.hh)()}}function n0(d){return d&&"resolver"in d}var fo=v(5548),rn=v(8834);function vR(d){return 360-za.BV.normalize(d)}function Z1(d){return za.BV.normalize(360-d)}function $1(d){return(0,Qe.pC)(d)&&d.resolver&&d.resolver.reject(),null}function ER(d,_,T,x=null){if(!_)return $1(x);const A=d.spatialReference||to.Z.WGS84;if((0,Qe.pC)(_.camera)){const we=(0,au.iV)(_.camera.position,A);if((0,Qe.Wi)(we))return $1(x);const Ze=_.camera.clone();return Ze.position=we,function nF(d,_){return(0,Qe.pC)(d)&&d.resolver&&d.resolver.resolve(_),_}(x,Ze)}if((0,Qe.Wi)(_.targetGeometry))return $1(x);const U=_.get("targetGeometry.spatialReference");if(U&&!(0,au.Q8)(U,A))return $1(x);const ne=H_(d,d.state.camera);let fe=Ia.ADJUST;if(null!=_.rotation&&(ne.heading=vR(_.rotation),fe=Ia.LOCKED),null!=T&&(ne.tilt=T),"point"===_.targetGeometry.type){const we=_.targetGeometry;let Ze;const it=_.targetGeometry.clone();return Ze=null!=_.scale?i2(d,_.scale,we.latitude):d.state.camera.distance,fR(d,it,Ze,ne,fe,x)}return Sg(d,_.targetGeometry.extent,ne.heading,ne.tilt,fe,x)}function c2(){return c2=(0,kr.Z)(function*(d,_,T){const x=gF(d,_);if(!x)throw new ai.Z("viewpointutils-create:no-target","Missing target for creating viewpoint");const A=new uc({fov:d.camera.fov}),U=new iu({camera:A});if(x.target instanceof iu)return o0(yield uF(d,x.target,x,T,U));if(x.target instanceof uc)return o0(CR(d,x.target,U));const ne=null!=x.scale||null!=x.zoom;if(x.target instanceof bl.Z){const we=x.target.xmin===x.target.xmax||x.target.ymin===x.target.ymax;return o0(ne||we?yield m2(d,x,x.target.center,A,T,U):yield _F(d,x,x.target,A,T,U))}const fe={boundingBox:(0,fo.cS)(),hasZ:!1,screenSpaceObjects:[]},Oe=ne?lF(d,x):void 0;if(yield bR(d,x.target,Oe,fe),isFinite(fe.boundingBox[0])){let we;if((0,fo.be)(fe.boundingBox,mo),Cc.x=mo[0],Cc.y=mo[1],Cc.z=mo[2],Cc.spatialReference=d.spatialReference,isFinite(Cc.z)&&fe.hasZ?we=(0,fo.wp)(fe.boundingBox):(Cc.z=void 0,we=(0,Bs.wp)((0,fo.y8)(fe.boundingBox,vF))),ne||we)return o0(yield m2(d,x,Cc,A,T,U));const Ze=yF(d,fe.screenSpaceObjects);return o0(yield mF(d,x,Cc,fe.boundingBox,Ze,A,T,U))}return o0(x.position?hF(d,x,A,U):yield pF(d,x,A,T,U))}),c2.apply(this,arguments)}function u2(d,_){return null==_.scale&&null!=_.zoom?gR(d,_.zoom):_.scale}function lF(d,_){return(0,RD.DE)(u2(d,_))}function d2(d,_){let T=!1;return null!=_.heading?(d.heading=_.heading,T=!0):null!=_.rotation&&(d.heading=vR(_.rotation),T=!0),null!=_.tilt&&(d.tilt=_.tilt,T=!0),null!=_.fov&&(d.fov=_.fov),T}function h2(d,_,T,x){const A=d.spatialReference||to.Z.WGS84;return _=(0,Qe.pC)(_)?_:Ld(d,T),(0,Qe.Wi)(_)||(x.targetGeometry=(0,di.fA)(_.center,d.renderSpatialReference,A),x.scale=yR(d,_),x.rotation=Z1(T.heading),x.camera=T),x}function Y1(d,_,T){const x=()=>new ai.Z("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!_)throw x();if(!(0,au.Q8)(_.spatialReference,d.spatialReference))throw new ai.Z("viewpointutils:incompatible-spatialreference",`Spatial reference (${_.spatialReference?_.spatialReference.wkid:"unknown"}) is incompatible with the view (${d.spatialReference.wkid})`,{geometry:_});const A=[];if(!_.hasZ&&d.basemapTerrain){let fe;switch(_.type){case"point":fe=_;break;case"multipoint":case"polyline":fe=_.extent?.center;break;case"mesh":fe=_.origin;break;case"extent":fe=_.center;break;case"polygon":fe=_.centroid}mo[2]=fe&&(0,Qe.pC)(d.basemapTerrain.spatialReference)&&(0,au.Q8)(fe,d.basemapTerrain.spatialReference)?(0,Qe.Pt)((0,W_.KO)(d.elevationProvider,fe),0):0}(0,EF[_.type])(_,fe=>{A.push(fe[0],fe[1],fe[2])},mo);const U=A.length/3;if(0===U)throw x();const ne=new Array(A.length);if((0,di.CM)(A,_.spatialReference,0,ne,d.spatialReference,0,U)){_.hasZ&&(T.hasZ=!0);for(let fe=0;fe<ne.length;fe+=3)_.hasZ?(mo[0]=ne[fe+0],mo[1]=ne[fe+1],mo[2]=ne[fe+2]):(mo[0]=ne[fe+0],mo[1]=ne[fe+1]),(0,fo.pp)(T.boundingBox,mo)}}function cF(d,_,T,x){return p2.apply(this,arguments)}function p2(){return p2=(0,kr.Z)(function*(d,_,T,x){const A=yield(0,wu.q6)(d.whenViewForGraphic(_));if(!1===A.ok||(0,Qe.Wi)(A.value)||!("whenGraphicBounds"in A.value))return void Y1(d,_.geometry,x);const U=A.value,ne=yield(0,wu.q6)(U.whenGraphicBounds(_,{minDemResolution:T}));if(!1===ne.ok)return void Y1(d,_.geometry,x);const{screenSpaceObjects:fe,boundingBox:Oe}=ne.value;(0,fo.TC)(x.boundingBox,Oe),fe&&fe.forEach(we=>{x.screenSpaceObjects.push(we)}),isFinite(Oe[2])&&(x.hasZ=!0)}),p2.apply(this,arguments)}function bR(d,_,T,x){return _2.apply(this,arguments)}function _2(){return _2=(0,kr.Z)(function*(d,_,T,x){if(Array.isArray(_)&&2===_.length){const A=_[0],U=_[1];if("number"==typeof A&&"number"==typeof U)return Cc.x=A,Cc.y=U,Cc.z=void 0,Cc.spatialReference=d.spatialReference.isGeographic?d.spatialReference:to.Z.WGS84,void Y1(d,Cc,x)}_&&"function"==typeof _.map?yield(0,ws.as)(_.map(A=>bR(d,A,T,x))):_ instanceof O6.Z?Y1(d,_,x):_ instanceof fd.Z&&(yield cF(d,_,T,x))}),_2.apply(this,arguments)}function uF(d,_,T,x,A){return f2.apply(this,arguments)}function f2(){return f2=(0,kr.Z)(function*(d,_,T,x,A){if((0,Qe.pC)(_.camera))return CR(d,_.camera,A);A.scale=_.scale,A.rotation=_.rotation,A.targetGeometry=(0,Qe.pC)(_.targetGeometry)?_.targetGeometry.clone():null,A.camera=null,null!=T.heading?A.rotation=Z1(T.heading):null!=T.rotation&&(A.rotation=T.rotation);const U=u2(d,T);null!=U&&(A.scale=U);const ne=new G_(x);return ER(d,A,T.tilt,ne),A.camera=yield ne.resolver.promise,A}),f2.apply(this,arguments)}function CR(d,_,T){const A=(0,au.iV)(_.position,d.spatialReference);return(0,Qe.Wi)(A)?null:((_=_.clone()).fov=d.camera.fov,_.position=A,h2(d,null,_,T))}function dF(d,_,T,x,A,U){const ne=d.renderSpatialReference;return(0,di.KC)(T.position,J1,ne),(0,di.KC)(_,b2,ne),U.targetGeometry=new vn.Z(_),A.position=new vn.Z(T.position),(0,pt.b)(k1,b2,J1),H1(d,J1,k1,x.up,A),U.scale=i0(d,(0,pt.i)(J1,b2),U.targetGeometry.latitude),U.rotation=Z1(A.heading),U.camera=A,U}function m2(d,_,T,x,A,U){return g2.apply(this,arguments)}function g2(){return g2=(0,kr.Z)(function*(d,_,T,x,A,U){if((0,Qe.Wi)(T))throw new ai.Z("createfromcenter","invalid point");U.targetGeometry=T.clone();const ne=Qp(d);if(_.position)return dF(d,U.targetGeometry,_,ne,x,U);if(_.zoomFactor){const Oe=ne.distance/_.zoomFactor,we=(0,pt.g)(mo,ne.viewForward,-Oe);ne.eye=(0,pt.a)(mo,ne.center,we),U.scale=i0(d,Oe,T.latitude)}H_(d,ne,x);const fe=d2(x,_)?Ia.LOCKED:Ia.ADJUST;if(!_.zoomFactor){U.scale=u2(d,_),null==U.scale&&((0,di.KC)(T,mo,d.renderSpatialReference),U.scale=(0,rn.g8)(ne.frustum,mo)?i0(d,(0,pt.i)(ne.eye,mo),T.latitude):yR(d,ne));const Oe=new G_(A);_R(d,U.targetGeometry,U.scale,x,fe,Oe),U.camera=yield Oe.resolver.promise}return U}),g2.apply(this,arguments)}function hF(d,_,T,x){const A=Qp(d);return(0,pt.c)(k1,A.viewForward),H1(d,A.eye,k1,A.up,C2),T.position=new vn.Z(_.position),T.heading=null!=_.heading?_.heading:C2.heading,T.tilt=null!=_.tilt?_.tilt:C2.tilt,h2(d,null,T,x)}function pF(d,_,T,x,A){return y2.apply(this,arguments)}function y2(){return y2=(0,kr.Z)(function*(d,_,T,x,A){const U=Qp(d);return m2(d,_,(0,di.fA)(U.center,d.renderSpatialReference,d.spatialReference),T,x,A)}),y2.apply(this,arguments)}function _F(d,_,T,x,A,U){return v2.apply(this,arguments)}function v2(){return v2=(0,kr.Z)(function*(d,_,T,x,A,U){U.targetGeometry=T.clone(),H_(d,Qp(d),x);const fe=d2(x,_)?Ia.LOCKED:Ia.ADJUST,Oe=new G_(A);return Sg(d,T,x.heading,x.tilt,fe,Oe),U.camera=yield Oe.resolver.promise,U}),v2.apply(this,arguments)}function fF(d,_,T,x,A){let U=0;T.hasZ?U=T.z:d.basemapTerrain&&(U=(0,Qe.Wg)((0,W_.KO)(d.elevationProvider,T))),(0,pt.s)(mo,T.x,T.y,U),(0,di.Bm)(d.spatialReference,mo,TR,d.renderSpatialReference),(0,Co.f)(X1,TR),(0,Co.t)(X1,X1),(0,fo.cS)(Ag);const ne=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let Tt=0;Tt<ne.length;Tt++){const mt=ne[Tt];let Mt=x[mt[2]];isFinite(Mt)||(Mt=U),(0,pt.s)(mo,x[mt[0]],x[mt[1]],Mt),(0,di.SH)(mo,d.spatialReference,mo,d.renderSpatialReference),(0,fo.pp)(Ag,(0,pt.t)(mo,mo,X1))}const fe=(0,fo.bf)(Ag),Oe=(0,fo.Cb)(Ag),we=(0,fo.Ye)(Ag),Ze=1/Math.tan(_.fovX/2),it=1/Math.tan(_.fovY/2),lt=.5*Math.sqrt(fe*fe+we*we)*Math.max(it,Ze)+.5*Oe,dt=.5*Oe*it+.5*Math.max(fe,we);return Math.max(lt,dt)/A}function mF(d,_,T,x,A,U,ne,fe){return E2.apply(this,arguments)}function E2(){return E2=(0,kr.Z)(function*(d,_,T,x,A,U,ne,fe){fe.targetGeometry=T.clone();const Oe=Qp(d),we=fF(d,Oe,T,x,A);H_(d,Oe,U);const Ze=d2(U,_)?Ia.LOCKED:Ia.ADJUST;fe.scale=i0(d,we,fe.targetGeometry.latitude);const it=new G_(ne);return _R(d,fe.targetGeometry,fe.scale,U,Ze,it),fe.camera=yield it.resolver.promise,fe}),E2.apply(this,arguments)}function gF(d,_){if(!_||!d.spatialReference)return null;const T={target:null};if("declaredClass"in _||Array.isArray(_))T.target=_;else{for(const x in _)T[x]=_[x];_.center&&!T.target&&(T.target=_.center)}return T}function o0(d){return d&&(0,Qe.pC)(d.camera)&&(d.rotation=Z1(d.camera.heading)),d}function yF(d,_){if(!_.length)return.66;let x=Number.NEGATIVE_INFINITY;for(let A=0;A<_.length;A++){const U=_[A].screenSpaceBoundingRect;x=Math.max(x,Math.abs(U[0]),Math.abs(U[1]),Math.abs(U[2]),Math.abs(U[3]))}return.66-x/Math.min(d.width,d.height)*2}const mo=(0,ir.c)(),TR=(0,gn.c)(),X1=(0,xd.c)(),Ag=(0,fo.Ue)(),vF=(0,Bs.Ue)(),k1=(0,ir.c)(),J1=(0,ir.c)(),b2=(0,ir.c)(),C2={heading:0,tilt:0},Cc=new vn.Z,EF={point(d,_,T){T[0]=d.x,T[1]=d.y,d.hasZ&&(T[2]=d.z),_(T)},polygon(d,_,T){const x=d.hasZ;for(let A=0;A<d.rings.length;A++){const U=d.rings[A];for(let ne=0;ne<U.length;ne++)T[0]=U[ne][0],T[1]=U[ne][1],x&&(T[2]=U[ne][2]),_(T)}},polyline(d,_,T){const x=d.hasZ;for(let A=0;A<d.paths.length;A++){const U=d.paths[A];for(let ne=0;ne<U.length;ne++)T[0]=U[ne][0],T[1]=U[ne][1],x&&(T[2]=U[ne][2]),_(T)}},multipoint(d,_,T){const x=d.points,A=d.hasZ;for(let U=0;U<x.length;U++)T[0]=x[U][0],T[1]=x[U][1],A&&(T[2]=x[U][2]),_(T)},extent(d,_,T){d.hasZ?(_((0,pt.s)(T,d.xmin,d.ymin,d.zmin)),_((0,pt.s)(T,d.xmax,d.ymin,d.zmin)),_((0,pt.s)(T,d.xmin,d.ymax,d.zmin)),_((0,pt.s)(T,d.xmax,d.ymax,d.zmin)),_((0,pt.s)(T,d.xmin,d.ymin,d.zmax)),_((0,pt.s)(T,d.xmax,d.ymin,d.zmax)),_((0,pt.s)(T,d.xmin,d.ymax,d.zmax)),_((0,pt.s)(T,d.xmax,d.ymax,d.zmax))):(_((0,pt.s)(T,d.xmin,d.ymin,T[2])),_((0,pt.s)(T,d.xmax,d.ymin,T[2])),_((0,pt.s)(T,d.xmin,d.ymax,T[2])),_((0,pt.s)(T,d.xmax,d.ymax,T[2])))},mesh(d,_,T){const x=d.vertexAttributes&&d.vertexAttributes.position;if(x)for(let A=0;A<x.length;A+=3)_((0,pt.s)(T,x[A+0],x[A+1],x[A+2]))}};class bF{constructor(_,T,x){this.target=_,this.options=T,this.view=x,this.state="pending",this._abortController=null,this._animationController=null,this._promise=new Promise((A,U)=>{this._resolveCallback=A,this._rejectCallback=U;const ne=new AbortController;(0,Qe.pC)(this.options.signal)&&(0,ws.fu)(this.options.signal,()=>{this.abort()}),this._abortController=ne,this.waitForReady()})}then(_,T){return this._promise.then(_,T)}catch(_){return this._promise.catch(_)}resolve(_){return this.state="finished",this._resolveCallback(_)}reject(_){return this.state="finished",this._rejectCallback(_)}abort(_=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject((0,ws.zE)());break;case"wait-for-animation-finish":!_&&(0,Qe.pC)(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject((0,ws.zE)())}}waitForReady(){var _=this;return(0,kr.Z)(function*(){if(_.state="wait-for-ready",!_.view.ready)try{yield(0,Ht.N1)(()=>_.view.ready,_._abortController.signal)}catch(T){return _.reject(T)}_.createViewPoint()})()}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,function aF(d,_,T){return c2.apply(this,arguments)}(this.view,this.target,this._abortController.signal).then(_=>{if("finished"===this.state)return;const T=this._getCameraFromViewpoint(_);if(!(0,Qe.Wi)(T))if(this.options.animate){if((0,Qe.Wi)(this._animationController))return;this.startAnimation(T,this._animationController)}else this.view.stateManager.setStateCamera(T.camera,{applyConstraints:!T.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},_=>{this.reject(_)}))}_getCameraFromViewpoint(_){const T=!!(this.target instanceof iu&&this.target.camera||this.target instanceof uc),x=_.camera;if((0,Qe.Wi)(x))return null;if(!this.view.stateManager.isCompatible(x)){const U=x.position,ne=U&&U.spatialReference;return this.reject(new ai.Z("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${ne?ne.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:x})),null}const A=Ld(this.view,x);return(0,Qe.Wi)(A)?(this.reject(new ai.Z("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:_,camera:A,isFullySpecified:T}}startAnimation(_,T){this.state="wait-for-animation-finish";const x=T.viewAnimation;if((0,Qe.Wi)(x))return void this.reject(new ai.Z("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(x.update(_.viewpoint,"running"),!T.active||(0,Qe.Wi)(T.viewAnimation)||T.viewAnimation.target!==_.viewpoint||this.view.state.cameraController!==T)return this.abort();let A;_.isFullySpecified?(A=new Mg({view:this.view,desiredCamera:_.camera}),w_(this.view,_.camera,Vc.EYE_AND_CENTER)):_o(this.view,_.camera),T.begin(_.camera,this.options);const ne=fe=>{if(!(0,Qe.Wi)(this.view.state))switch(T.state){case Kn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Kn.Ready:case Kn.Rejected:case Kn.Running:case Kn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(fe)}}};x.when(()=>{const fe=this.view.state.cameraController;A&&(fe&&fe.active?fe instanceof Sd&&(0,Qe.pC)(fe.viewAnimation)&&fe.viewAnimation.target===_.viewpoint&&(this.view.state.cameraController=A):(0,Qe.pC)(T.viewAnimation)&&T.viewAnimation.target===_.viewpoint&&"finished"===T.state&&(this.view.state.cameraController=A))},fe=>ne(fe)),T.asyncResult={resolve:()=>ne(),reject:fe=>ne(fe)}}_getAnimationController(){let _,T=null;const x=this.view.state.cameraController;return x instanceof Sd&&(x.updateStateFromViewAnimation(),x.active&&(_=x,T=_.viewAnimation)),null!=_||(_=new Sd({view:this.view,mode:"animation"}),T=_.viewAnimation,this.view.state.switchCameraController(_))?_:((0,Qe.pC)(T)&&T.stop(),this.reject(new ai.Z("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}var Nh=v(63416);let Ho=class extends Ns.Z{constructor(d){super(d),this._propertiesPool=new Nh.L({frustum:F_.i},this),this._handles=new Ji.Z,this._cameraSetByUser=!1,this._gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this._cameraChangeTime=0,this.test={contentCameraResetState:new Map,setDevicePixelRatio:_=>this._devicePixelRatioOverride=_,setMaximumPixelRatio:_=>this._maximumPixelRatioOverride=_,renderState:null}}get camera(){const d=this._get("camera");if(!this.ready)return d;const _=H_(this.view,this.view.state.camera,T2);return _&&d&&_.equals(d)?d:_.clone()}set camera(d){this._updatePropertyBeforeReady("camera",d)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Ld(this.view,d),{applyConstraints:!1})||Us.Z.getLogger(this.declaredClass).error("#camera=","Invalid camera",d),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const d=this._get("contentCamera");if(!this.ready)return d;const _=H_(this.view,this.view.state.contentCamera,T2);return _&&d&&_.equals(d)?d:_.clone()}set contentCamera(d){if(this._updatePropertyBeforeReady("contentCamera",d))return;const _=Ld(this.view,d);(0,Qe.Wi)(_)?this.view.state.contentCamera=null:(this._updateElevation(_),this.view.state.contentCamera=_)}installContentCameraReset(d){if(this._handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const _=this.zoom,T=this.view.state.camera.distance**2,x=(0,ir.d)(this.view.state.camera.center),A=d.sticky?this.contentCamera.clone():null;return this._handles.add([(0,Ht.YP)(()=>this.contentCamera,()=>{d.sticky||(this._handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),(0,Ht.YP)(()=>this.zoom,U=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(U-_)/2),Math.abs(U-_)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=A)}),(0,Ht.YP)(()=>this.view.state.camera,U=>{const ne=(0,pt.d)(x,U.center);this.test.contentCameraResetState.set("camera.center",ne/T),ne>T?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=A)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(d){this._updatePropertyBeforeReady("center",d)||(d?this.isCompatible(d)?this.setStateCamera(this._centerToCamera(d),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Us.Z.getLogger(this.declaredClass).error("#center=","Invalid center",d):Us.Z.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(d.spatialReference?d.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",d):Us.Z.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const d=this.view,_=function Qj(d,_,T){const A=(0,di.fA)(T,d.renderSpatialReference,xg(d));if((0,Qe.Wi)(A))return null;const U=Math.tan(_.fovX/2),ne=Math.tan(_.fovY/2),fe=(0,pt.j)(_.eye,T),Oe=2*fe*U*1,we=2*fe*ne*1;return"global"===d.viewingMode?lR(d,A,Oe,we):iR(d,A,Oe,we)}(d,d.state.camera,d.pointsOfInterest.centerOnContent.renderLocation);return(0,Qe.pC)(_)?_:this._get("extent")}set extent(d){this._updatePropertyBeforeReady("extent",d)||(d?this.isCompatible(d)?this.setStateCamera(this._extentToCamera(d),{applyConstraints:!0})||Us.Z.getLogger(this.declaredClass).error("#extent=","Invalid extent",d):Us.Z.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(d.spatialReference?d.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",d):Us.Z.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const d=this._propertiesPool.get("frustum");return d.renderCoordsHelper=this.view.renderCoordsHelper,d.update(this.view.state.camera),d}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const d=this.view.pointsOfInterest.centerOnContent;return i0(this.view,d.distance,d.location.latitude)}return this._get("scale")}set scale(d){this._updatePropertyBeforeReady("scale",d)||this.setStateCamera(this._scaleToCamera(d),{applyConstraints:!0})||Us.Z.getLogger(this.declaredClass).error("#scale=","Invalid scale",d)}get padding(){if(!this.ready)return this._get("padding");const d=this.view.state.camera,_=d.padding,T=d.pixelRatio,x=this._get("padding"),A=Math.round(_[$i.N.TOP]/T),U=Math.round(_[$i.N.RIGHT]/T),ne=Math.round(_[$i.N.BOTTOM]/T),fe=Math.round(_[$i.N.LEFT]/T);return null!=x&&x.top===A&&x.right===U&&x.bottom===ne&&x.left===fe?x:{top:A,right:U,bottom:ne,left:fe}}set padding(d){this._updatePropertyBeforeReady("padding",d)||(this._paddingToArray(d,this.view.state.camera.pixelRatio,Q1),this.view.state.updateCamera(_=>_.padding=Q1))}_paddingToArray(d,_,T){d?(0,Qo.s)(T,d.top||0,d.right||0,d.bottom||0,d.left||0):(0,Qo.s)(T,0,0,0,0);for(let x=0;x<4;x++)T[x]=Math.round(T[x]*_)}get screenCenter(){const d=this.padding;return(0,li.vW)((this.view.width-(d.left+d.right))/2+d.left,(this.view.height-(d.top+d.bottom))/2+d.top)}get viewpoint(){return this.ready?function oF(d,_,T=null){return(0,Qe.Wi)(T)&&(T=new iu),h2(d,null,_.clone(),T)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(d){if(!this._updatePropertyBeforeReady("viewpoint",d))if(d)if(this.isCompatible(d))this.setStateCamera(this._viewpointToCamera(d),{applyConstraints:!d.camera})||Us.Z.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",d);else{const _=(0,Qe.pC)(d.camera)?d.camera.position:d.targetGeometry,T=(0,Qe.pC)(_)&&_.spatialReference;Us.Z.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(T?T.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",d)}else Us.Z.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?function sF(d,_){const T=d.basemapTerrain?.tilingScheme;if(T)return T.levelAtScale(_);cR.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}(this.view,this.scale):this._get("zoom")}set zoom(d){this._updatePropertyBeforeReady("zoom",d)||this.setStateCamera(this._zoomToCamera(d),{applyConstraints:!0})||Us.Z.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",d)}get maximumPixelRatio(){if((0,Qe.pC)(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let d=1/0;const{maximumPixelRatio:_,maximumRenderResolution:T}=this.view.qualitySettings;if(null!=_&&(d=Math.min(d,_)),null!=T){const x=T/Math.max(this.view.width,this.view.height);d=Math.min(d,x)}return d}get _devicePixelRatio(){return(0,Qe.Wi)(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this._cameraChangeTime=performance.now(),this._handles.add([(0,Ht.on)(()=>this.view.state.events,"before-camera-change",d=>this._updateElevation(d.camera)),(0,Ht.YP)(()=>this.view.state?.camera,(d,_)=>this._cameraChangedHandler(d,_),Ht.Z_)]),(0,Ht.gx)(()=>this.view.state?.camera,d=>this._updateElevation(d),{once:!0,sync:!0}),this._handles.add([(0,gd.A)({prepare:()=>this._prepareFrame()}),(0,Ht.YP)(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this._handles.remove(q1)}),(0,Ht.on)(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._handles&&(this._handles.destroy(),this._handles=null),this._propertiesPool&&(this._propertiesPool.destroy(),this._propertiesPool=null)}init(){this.constraintsManager=new Tg({view:this.view}),this._prepareFrame();const d=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const _ of d)this.set(_.name,_.value);if(!this._cameraSetByUser){const _=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;_&&this.isCompatible(_)?this._setInitialView(_):this.view.state.viewingMode===vi.JY.Local&&this._handles.add((0,Ht.gx)(()=>this.view.basemapTerrain.ready,()=>{this._handles.remove(q1),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),q1)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this._handles.remove(q1),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}goTo(d,_){var T=this;return(0,kr.Z)(function*(){const x={animate:!0,..._};return(0,Qe.pC)(T._gotoOperation)&&T._gotoOperation.abort(x.animate),T._gotoOperation=new bF(d,x,T.view),T.view.resourceController.scheduler.stopFrame(),T._gotoOperation})()}debugSetCameraOnContent(){this.setStateCamera(Qp(this.view),{applyConstraints:!1})}step(d){const _=this.view.state,T=_?.cameraController;T&&(_.updateCamera(x=>T.stepController(d,x)),T.steppingFinished&&T.finishController())}_cancelGoToOperation(){(0,Qe.pC)(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const d=new Set,_=[];for(const{propertyName:T,overrides:x}of TF){const A=d.has(T),U=this._isOverridden(T);!A&&U&&_.push({name:T,value:this._get(T)}),this._clearOverride(T),(A||U)&&x.forEach(ne=>d.add(ne))}return _}_setInitialView(d){if((0,Qe.Wi)(d)||this._cameraSetByUser)return;if(d instanceof uc)return void this.setStateCamera(Ld(this.view,d),{applyConstraints:!1});if(d instanceof iu){if(d.targetGeometry instanceof bl.Z){const A=Sg(this.view,d.targetGeometry,0,.5,Ia.LOCKED);return void((0,Qe.pC)(A)&&this.setStateCamera(Ld(this.view,A),{applyConstraints:!0}))}const T={applyConstraints:!d.camera},x=this._viewpointToCamera(d);return void this.setStateCamera(x,T)}const _=Sg(this.view,d,0,.5,Ia.LOCKED);(0,Qe.pC)(_)&&this.setStateCamera(Ld(this.view,_),{applyConstraints:!0})}_updatePropertyBeforeReady(d,_){return!this.ready&&(this._override(d,_),_&&CF.includes(d)&&this._override("hasInitialView",!0),!0)}isCompatible(d){return!(0,Qe.Wi)(d)&&(d instanceof iu?this.isCompatible(d.camera?d.camera:d.targetGeometry):d instanceof uc?this.isCompatible(d.position):d.spatialReference&&(0,au.Q8)(d.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(d=MF){return this._cameraSetByUser?(d.heading=this.camera.heading,d.tilt=this.camera.tilt):(d.heading=0,d.tilt=.5),d}_centerPointAtDistanceToCamera(d,_,T=Wh){const{heading:x,tilt:A}=this._getPreservingHeadingTilt(),U=Dg(this.view,x,A,d,_,Ia.ADJUST);return(0,Qe.Wi)(U)?null:(T.copyFrom(this.view.state.camera),T.eye=U.eye,T.center=U.center,T.up=U.up,T)}_centerToCamera(d){const _=this.view.pointsOfInterest.centerOnContent;return _.runTask(),this._centerPointAtDistanceToCamera(d,_.distance)}_extentToCamera(d){const{heading:_,tilt:T}=this._getPreservingHeadingTilt(),x=Sg(this.view,d,_,T,Ia.ADJUST,T2);return(0,Qe.pC)(x)?Ld(this.view,x):null}_scaleToCamera(d){if(null==d)return null;const _=this.view.pointsOfInterest.centerOnContent;_.runTask();const T=_.renderLocation,A=i2(this.view,d,_.location.latitude);return this._centerPointAtDistanceToCamera(T,A)}_zoomToCamera(d){return this._scaleToCamera(gR(this.view,d))}_viewpointToCamera(d){return Ld(this.view,ER(this.view,d))}setStateCamera(d,_){return!((0,Qe.Wi)(d)||!this.view.state.stopActiveCameraController()||(this._cameraSetByUser=!0,_.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(T=>{_.positionAndOrientationOnly?(T.eye=d.eye,T.center=d.center,T.up=d.up):T.copyFrom(d),_.applyConstraints&&_o(this.view,T)}),_.applyConstraints||(this.view.state.cameraController=new Mg({view:this.view,desiredCamera:d})),0))}_prepareFrame(){const{surface:d,canvas:_}=this.view;if(!d||!_)return;this._windowDevicePixelRatio=window.devicePixelRatio;const T=this._devicePixelRatio,x=Math.round(d.clientWidth*T),A=Math.round(d.clientHeight*T);if(0!==x&&0!==A&&(_.width===x&&_.height===A||(_.width=x,_.height=A),this.view.state)){const U=this.view.state.camera;U.fullWidth===x&&U.fullHeight===A&&U.pixelRatio===T||(Wh.copyFrom(U),Wh.pixelRatio!==T&&(this._paddingToArray(this.padding,T,Q1),Wh.padding=Q1),Wh.fullWidth=x,Wh.fullHeight=A,Wh.pixelRatio=T,this.view.state.camera=Wh),this._updateRenderState()}}_updateElevation(d){const _=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,T=this.view.renderCoordsHelper?.getAltitude(d.eye)??0,x=_?_1(this.view,d.eye):0;d.relativeElevation=T-x}_updateRenderState(){(0,Qe.pC)(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Lu.n.ANIMATING:this.view.interacting?this.view.state.mode=Lu.n.INTERACTING:(this.view.state.mode===Lu.n.ANIMATING&&(this._cameraChangeTime=0),this.view.state.mode=performance.now()-this._cameraChangeTime<=PF?Lu.n.INTERACTING:Lu.n.IDLE)}_cameraChangedHandler(d,_){d&&_&&d.almostEquals(_)||(this._cameraChangeTime=performance.now(),this._updateRenderState())}};(0,Ve._)([(0,ke.Cb)({type:uc,dependsOn:["view.state.camera","ready"]})],Ho.prototype,"camera",null),(0,Ve._)([(0,ke.Cb)({type:uc,dependsOn:["view.state.contentCamera","ready"]})],Ho.prototype,"contentCamera",null),(0,Ve._)([(0,ke.Cb)({type:vn.Z})],Ho.prototype,"center",null),(0,Ve._)([(0,ke.Cb)({type:bl.Z})],Ho.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ho.prototype,"frustum",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ho.prototype,"hasInitialView",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:Boolean})],Ho.prototype,"ready",void 0),(0,Ve._)([(0,ke.Cb)({type:Number})],Ho.prototype,"scale",null),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"padding",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ho.prototype,"screenCenter",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ho.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({type:iu})],Ho.prototype,"viewpoint",null),(0,Ve._)([(0,ke.Cb)({type:Number})],Ho.prototype,"zoom",null),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"maximumPixelRatio",null),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"_devicePixelRatio",null),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"_windowDevicePixelRatio",void 0),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"_devicePixelRatioOverride",void 0),(0,Ve._)([(0,ke.Cb)()],Ho.prototype,"_maximumPixelRatioOverride",void 0),Ho=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.ViewStateManager")],Ho);const CF=["camera","viewpoint","extent","scale","center","zoom"],TF=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],MF={heading:0,tilt:0},T2=new uc,Wh=new $i.V,Q1=(0,Tn.c)(),q1="pending-initial-view",PF=300;let Fu=class extends Dd{constructor(){super(...arguments),this.startCamera=new $i.V,this.currentCamera=new $i.V,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<100}stepController(d,_){_.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(_)}onControllerStart(d){this.state=Kn.Running,this.startCamera.copyFrom(d),this.currentCamera.copyFrom(d)}onControllerEnd(d){d.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),100),this.view.state.updateCamera(d=>this.stepController(0,d)),this.steppingFinished&&this.finishController()}};var Xl;(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Fu.prototype,"isInteractive",null),(0,Ve._)([(0,ke.Cb)()],Fu.prototype,"_lastInteraction",void 0),Fu=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.InteractiveController")],Fu),function(d){d[d.CENTER=0]="CENTER",d[d.EYE=1]="EYE"}(Xl||(Xl={}));let Rg=class extends Fu{constructor(d){super(d),this.pivot=Xl.CENTER,this._lastPoint=(0,un.a)(),this._tmpWorldUp=(0,ir.c)(),this._tmpViewDir=(0,ir.c)(),this._tmpRotCurPoint=(0,un.a)(),this._tmpTransf=(0,gn.c)(),this._tmpAxis=(0,ir.c)(),this._tmpPivotPoint=(0,ir.c)(),this._pivotPos=(0,ir.c)(),this._constraintOptions={selection:xn.ALL,interactionType:wi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:qo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this._rotScale=this.pivot===Xl.CENTER?3:1.5}begin(d){if(this.active){switch(this.pivot){case Xl.EYE:(0,pt.c)(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=wi.LOOK_AROUND,this._constraintOptions.tiltMode=qo.LOOK_AROUND,this._constraintOptions.selection=xn.NONE;break;case Xl.CENTER:{const _=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos);_||(0,pt.c)(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(d,_),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=wi.TUMBLE,this._constraintOptions.tiltMode=qo.TUMBLE,this._constraintOptions.selection=xn.ALL&~xn.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,t0(this.startCamera,d,this._lastPoint)}}_constrainPivotPoint(d,_){const T=this.startCamera,x=(0,ir.c)();(0,pt.b)(x,this._pivotPos,T.eye);const A=(0,pt.l)(x);let U=Math.min(A,7*Math.abs(this.view.camera.position.z));const ne=(0,En.Iu)(this.view.spatialReference),fe=(0,li.s1)(T.width/T.pixelRatio*.5,T.height/T.pixelRatio*.5),Oe=P1(this.startCamera,fe,!0,ne);let we=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,T.fullWidth/T.pixelRatio*.5,T.fullHeight/T.pixelRatio*.5,T,225,90),Ze=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,d[0],d[1],T,90);((0,Qe.pC)(we)||(0,Qe.pC)(Ze))&&(we=(0,Qe.Pt)(we,Ze),Ze=(0,Qe.Wi)(Ze)||Oe===fa.Horizontal?we:Ze,U=we>Ze?Ze:we,U=_?Math.min(U,A):U),(0,pt.n)(x,x),(0,pt.c)(this._pivotPos,(0,pt.a)(this._tmpPivotPoint,T.eye,(0,pt.g)(this._tmpPivotPoint,x,U)))}update(d){if(this.active){switch(this.pivot){case Xl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,d,this.currentCamera.center,this._pivotPos);break;case Xl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,d,this.currentCamera.eye,this._pivotPos)}_o(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(d,_,T,x){this.view.renderCoordsHelper.worldUpAtPosition(x,this._tmpWorldUp),t0(d,_,this._tmpRotCurPoint);let A=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,U=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;(0,pt.b)(this._tmpViewDir,T,x);const ne=(0,pt.l)(this._tmpViewDir),fe=(0,xr.ZF)((0,pt.e)(this._tmpViewDir,this._tmpWorldUp)/ne);if(this.pivot===Xl.EYE){A*=-.5;const Oe=.5*Math.PI-fe,we=.5*Math.PI*.99;A=Oe-Math.max(-we,Math.min(we,Oe+A))}return A=(0,xr.uZ)(A+fe,Sa.min,Sa.max)-fe,(0,pt.f)(this._tmpAxis,d.up,this._tmpViewDir),this.pivot===Xl.CENTER&&(U=-U),(0,gi.d)(this._tmpTransf,U,this._tmpWorldUp),(0,gi.e)(this._tmpTransf,this._tmpTransf,A,this._tmpAxis),(0,pt.m)(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),d.up=(0,pt.m)(P2,d.up,this._tmpTransf),(0,pt.a)(P2,x,this._tmpViewDir),(0,ti.c)(this._lastPoint,this._tmpRotCurPoint),P2}};(0,Ve._)([(0,ke.Cb)()],Rg.prototype,"pivot",void 0),Rg=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.RotateController")],Rg);const P2=(0,ir.c)();class O2 extends nl.a{constructor(_,T,x,A){super(!0),this._view=_,this.pointerAction=T,this._pivot=x,this.registerIncoming("drag",A,U=>this._handleDrag(U))}_handleDrag(_){const T=_.data;if(T.pointers.size>1||!QP(_.data,this.pointerAction))return;const x=(0,li.s1)(T.center.x,T.center.y);switch(T.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Rg({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(x);break;case"update":this._cameraController&&this._cameraController.update(x);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}_.stopPropagation()}}let x2=class extends Fu{constructor(){super(...arguments),this._pickPoint=(0,ir.c)(),this._tmpP0=(0,un.a)(),this._panAxisAngle=I_(),this._tmpRayDir=(0,ir.c)(),this._tmpRayDirPick=(0,ir.c)(),this._targetOnSphere=(0,ir.c)(),this._tmpRay={origin:(0,ir.c)(),direction:(0,ir.c)()},this.dragBeginPoint=(0,li.s1)(),this._normalizedAnchorPoint=(0,un.a)(),this._constraintOptions={selection:xn.ALL_EXCEPT_COLLISION,interactionType:wi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:qo.TUMBLE},this._sphere=(0,oo.c)(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(d){if(!this.active)return;(0,ti.c)(this.dragBeginPoint,d),t0(this.startCamera,d,this._normalizedAnchorPoint);const _=(0,En.Iu)(this.view.spatialReference),T=U3(this._intersectionHelper,this.startCamera,d,_,L_.Ellipsoid,0===this.view.map.ground.opacity?xF:{});if(this._navMode=P1(this.startCamera,d,T.hasGeometryIntersection,_),this._navMode===fa.Horizontal)this._hasPickPoint=!!T.scenePickPoint,this._pickPoint=(0,Qe.Pt)(T.scenePickPoint,this._pickPoint),this._sphere=T.sphere;else{let x,A;(0,ju.iE)(this.startCamera,d,this._tmpRay),(0,pt.n)(this._tmpRay.direction,this._tmpRay.direction),(0,Qe.pC)(T.scenePickPoint)&&((0,pt.b)(this._tmpRayDirPick,this.startCamera.eye,T.scenePickPoint),A=(0,pt.l)(this._tmpRayDirPick)),this.view.camera.position.hasZ&&(x=Math.abs(this.view.camera.position.z));let U=(0,xr.uZ)(30*x,C1[0],C1[1]);const ne=this.view._stage.renderView.getMinimalDepthForArea(null,d[0],d[1],this.view.state.camera,70);U=(0,Qe.pC)(ne)?Math.min(U,ne):U,U=T.scenePickPoint?Math.min(U,A):U,this._hasPickPoint=!0,(0,pt.g)(this._tmpRay.direction,this._tmpRay.direction,U),(0,pt.a)(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(d){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===fa.Horizontal){(0,pt.b)(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const _=(0,pt.l)(this._tmpRayDir);t0(this.currentCamera,d,this._tmpP0);const T=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let x=_*2**T;const A=this.view.state.constraints.minimumPoiDistance;if(T<0&&x<A&&(x=A),Math.abs(_-x)<1e-6)return;if(this._hasPickPoint&&x<_){const U=1-(1-x/_)*(1-this._sphere[3]/(0,pt.l)(this.currentCamera.center));this.currentCamera.center=(0,pt.g)(eE,this.currentCamera.center,U)}(0,pt.g)(this._tmpRayDir,this._tmpRayDir,-x/_),this.currentCamera.eye=(0,pt.a)(eE,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=uu((0,ti.d)(this.dragBeginPoint,d)),_o(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(bg(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),zP(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Bh(this.currentCamera,this._sphere,this._panAxisAngle))}else{const _=(0,pt.l)(this._tmpRay.direction);t0(this.currentCamera,d,this._tmpP0);const T=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let x=_*2**T;const A=this.view.state.constraints.minimumPoiDistance;if(T<0&&x<A&&(x=A),Math.abs(_-x)<1e-6)return;(0,pt.g)(this._tmpRayDir,this._tmpRay.direction,1-x/_),this.currentCamera.eye=(0,pt.a)(eE,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=(0,pt.a)(eE,this.currentCamera.center,this._tmpRayDir)}w_(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};x2=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.global.ZoomController")],x2);const eE=(0,ir.c)(),xF={exclude:new Set([bc.cy])};let D2=class extends Fu{constructor(){super(...arguments),this._tmpP=(0,ir.c)(),this._tmpDir=(0,ir.c)(),this._tmpN=(0,ir.c)(),this._tmpP0=(0,un.a)(),this._tmpPoi=(0,ir.c)(),this._tmpRayDir=(0,ir.c)(),this.dragBeginPoint=(0,li.s1)(),this._normalizedAnchorPoint=(0,un.a)(),this._constraintOptions={selection:xn.ALL,interactionType:wi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:(0,ir.c)(),tiltMode:qo.TUMBLE},this._plane=(0,Rn.Ue)()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(d){if(!this.active)return;(0,ti.c)(this.dragBeginPoint,d),t0(this.startCamera,d,this._normalizedAnchorPoint);const _=this._intersectionHelper.intersectScreenFreePointFallback(d,this._tmpP,0===this.view.map.ground.opacity?DF:{});(0,pt.b)(this._tmpDir,this._tmpP,this.startCamera.eye);const T=(0,pt.l)(this._tmpDir);let x;(0,pt.n)(this._tmpDir,this._tmpDir),this.view.camera.position.hasZ&&(x=Math.abs(this.view.camera.position.z));let A=(0,xr.uZ)(30*x,C1[0],C1[1]);const U=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,d[0],d[1],this.view.state.camera,70);A=(0,Qe.pC)(U)?Math.min(A,U):A,A=_?Math.min(A,T):A,(0,pt.g)(this._tmpDir,this._tmpDir,A),(0,pt.a)(this._tmpP,this.startCamera.eye,this._tmpDir),(0,pt.b)(this._tmpN,this.startCamera.eye,this.startCamera.center),(0,pt.n)(this._tmpN,this._tmpN),this._tmpN[1]<0&&(0,pt.o)(this._tmpN,this._tmpN),(0,Rn.Yq)(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(d){if(!this.active)return;(function sj(d,_,T,x){return(0,Rn.BR)(d,(0,ju.u4)(_,T,kP),x)})(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||(0,pt.c)(this._tmpPoi,this.currentCamera.center),t0(this.currentCamera,d,this._tmpP0);let _=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);(0,ti.c)(this._normalizedAnchorPoint,this._tmpP0),(0,pt.b)(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const T=(0,pt.l)(this._tmpRayDir);let x=T*(1-_);(0,pt.c)(this._constraintOptions.interactionDirection,this._tmpRayDir),(0,pt.g)(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(_)/T);const A=this.view.state.constraints.minimumPoiDistance;_>=0&&x<A&&(x=A,_=-(x-T)/T),Math.abs(T-x)<1e-6||((0,pt.g)(this._tmpRayDir,this._tmpRayDir,_),this.currentCamera.eye=(0,pt.a)(a0,this.currentCamera.eye,this._tmpRayDir),(0,pt.h)(a0,this.currentCamera.center,this._tmpPoi,_),a0[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],a0[2]):Math.min(this.startCamera.center[2],a0[2]),this.currentCamera.center=a0,this._constraintOptions.interactionFactor=uu((0,ti.d)(this.dragBeginPoint,d)),_o(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};D2=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.local.ZoomController")],D2);const a0=(0,ir.c)(),DF={exclude:new Set([bc.cy])};class SF extends nl.a{constructor(_,T,x){super(!0),this._view=_,this.pointerAction=T,this.registerIncoming("drag",x,A=>this._handleDrag(A))}_handleDrag(_){const T=_.data;if(T.pointers.size>1||!QP(_.data,this.pointerAction))return;const x=(0,li.s1)(T.center.x,T.center.y);switch(T.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=this._view.state.isGlobal?new x2({view:this._view}):new D2({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(x);break;case"update":this._cameraController&&this._cameraController.update(x);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}_.stopPropagation()}}function du(d){let _=d*d;return d<0&&(_*=-1),_}function PR(d,_,T){const x=T,A=d.state,U=d.device,ne="forward-down"===_.tiltDirection?1:-1;return"standard"===U.deviceType?(x.translation[0]=du(A.axes[0]),x.translation[1]=du(A.axes[1]),x.translation[2]=du(A.buttons[7])-du(A.buttons[6]),x.heading=du(A.axes[2]),x.tilt=du(A.axes[3])):"spacemouse"===U.deviceType&&(x.translation[0]=1.2*du(A.axes[0]),x.translation[1]=1.2*du(A.axes[1]),x.translation[2]=2*-du(A.axes[2]),x.heading=1.2*du(A.axes[5]),x.tilt=1.2*du(A.axes[3])),x.tilt*=ne,(0,pt.g)(x.translation,x.translation,1),x}function OR(d,_){const T=_;return T.translation[0]=d[1]-d[0],T.translation[1]=d[3]-d[2],T.translation[2]=d[4]-d[5],T.heading=d[7]-d[6],T.tilt=d[8]-d[9],T.zoom=d[10]-d[11],T}function S2(d){return 0===d.translation[0]&&0===d.translation[1]&&0===d.translation[2]&&0===d.heading&&0===d.tilt&&0===d.zoom}let l0=class extends Fu{constructor(d){super(d),this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new $i.V,this._constraintOptions={selection:xn.ALL,interactionType:wi.NONE,interactionStartCamera:new $i.V,interactionFactor:0,interactionDirection:null,tiltMode:qo.LOOK_AROUND}}handleEventGamepad(d){const _=PR(d,this.view.navigation.gamepad,this._transformation);("end"===d.action||S2(_))&&this.finishController()}activateDirection(d){this._keysButtonState[d]=1,OR(this._keysButtonState,this._transformation)}deactivateDirection(d){this._keysButtonState[d]=0,S2(OR(this._keysButtonState,this._transformation))&&this.finishController()}onControllerStart(d){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(d)}_updateFilteredSurfaceElevation(d){this._filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*d}stepController(d,_){this._updateStartHeading(),this._updateFilteredSurfaceElevation(d),this.currentCamera.copyViewFrom(_),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(d,this.currentCamera,c0),this._applyDisabledMovementTypes(c0),this._applyPan(c0.pan),this._applyRotate(c0.rotate),this._applyZoom(c0.zoom),this._applyAscend(c0.ascend),this._constraintOptions.interactionType=wi.NONE,this._constraintOptions.selection=xn.COLLISION,_o(this.view,this.currentCamera,this._constraintOptions),super.stepController(d,_)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(d){if(!d.enabled)return;const _=this.currentCamera;(0,pt.b)(Pl,_.center,_.eye),(0,pt.m)(Pl,Pl,d.matrix),_.center=(0,pt.a)(Pl,Pl,_.eye),_.up=(0,pt.m)(Pl,_.up,d.matrix),this._constraintOptions.interactionType=wi.LOOK_AROUND,this._constraintOptions.selection=xn.ALL_EXCEPT_COLLISION,_o(this.view,_,this._constraintOptions)}_applyPan(d,_=this.currentCamera){!d.enabled||(_.eye=(0,pt.m)(Pl,_.eye,d.matrix),_.center=(0,pt.m)(Pl,_.center,d.matrix),this.view.state.isGlobal&&(_.up=(0,pt.m)(Pl,_.up,d.matrix)),this._constraintOptions.interactionType=wi.PAN,this._constraintOptions.selection=xn.ALL,_o(this.view,_,this._constraintOptions))}_applyZoom(d){if(!d)return;const _=this.currentCamera.viewForward;this.currentCamera.eye=(0,pt.a)(Pl,this.currentCamera.eye,(0,pt.g)(Dn.WM.get(),_,d)),(0,pt.c)(wg,_),(0,pt.o)(wg,wg),this._constraintOptions.interactionDirection=wg,this._constraintOptions.interactionType=wi.ZOOM,this._constraintOptions.selection=xn.ALL_EXCEPT_COLLISION,_o(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(d){if(!d)return;const _=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Dn.WM.get());if(this._constraintOptions.interactionDirection=(0,pt.c)(wg,_),this.view.state.isGlobal){const T=(0,pt.l)(this.currentCamera.eye),x=(T+d)/T;this.currentCamera.eye=(0,pt.g)(Pl,this.currentCamera.eye,x),this.currentCamera.center=(0,pt.g)(Pl,this.currentCamera.center,x)}else{const T=(0,pt.g)(Dn.WM.get(),_,d);this.currentCamera.eye=(0,pt.a)(Pl,this.currentCamera.eye,T),this.currentCamera.center=(0,pt.a)(Pl,this.currentCamera.center,T)}this._updateCameraCenter(),this._constraintOptions.interactionType=wi.ASCEND,this._constraintOptions.selection=xn.COLLISION,_o(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=xn.ALL_EXCEPT_COLLISION,_o(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(d,_,T){!function BF(d){d.zoom=0,d.ascend=0,d.pan.enabled=!1,(0,gi.i)(d.pan.matrix),d.rotate.enabled=!1,(0,gi.i)(d.rotate.matrix)}(T);const x=this._computeVelocities(d);this.view.state.isLocal?this._calculateControlTransformationLocal(x,_,T):this._calculateControlTransformationGlobal(x,_,T)}_updateCameraCenter(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,Pl)}_calculateControlTransformationLocal(d,_,T){const{viewRight:x,viewForward:A}=_,U=this._transformation,ne=this.view.navigation.gamepad,fe=(0,pt.s)(Dn.WM.get(),A[0],A[1],0);(0,pt.n)(fe,fe);const Oe=U.translation[0]*d.pan;if(0!==Oe){const Tt=(0,pt.g)(Dn.WM.get(),x,Oe);(0,gi.v)(T.pan.matrix,T.pan.matrix,Tt),T.pan.enabled=!0}switch(ne.mode){case"pan":{const Tt=-U.translation[1]*d.pan;if(0!==Tt){const mt=(0,pt.g)(Dn.WM.get(),fe,Tt);(0,gi.v)(T.pan.matrix,T.pan.matrix,mt),T.pan.enabled=!0}T.zoom=U.zoom*d.zoom;break}case"zoom":T.zoom=(-U.translation[1]+U.zoom)*d.zoom;break;default:(0,Rm.Bg)(ne.mode)}T.ascend=U.translation[2]*d.ascend;const Ze=-U.heading*d.rotate;0!==Ze&&((0,gi.e)(T.rotate.matrix,T.rotate.matrix,Ze,this.view.renderCoordsHelper.worldUpAtPosition(_.eye,Dn.WM.get())),T.rotate.enabled=!0);const it=U.tilt*d.rotate,lt=wh(this.view.renderCoordsHelper,_.center,_.eye),dt=(0,xr.uZ)(lt+it,Sa.min,Sa.max)-lt;dt&&((0,gi.e)(T.rotate.matrix,T.rotate.matrix,dt,x),T.rotate.enabled=!0)}_calculateControlTransformationGlobal(d,_,T){const{eye:x,viewRight:A}=_,U=this._transformation,ne=this.view.navigation.gamepad,fe=(0,pt.f)(Dn.WM.get(),A,x);(0,pt.n)(fe,fe),(0,pt.o)(fe,fe),function cj(d,_,T,x,A,U,ne,fe,Oe){XP(d.center,(0,pt.e)(d.up,d.center),(0,pt.l)(d.center),-za.Q4.normalize((0,xr.Vl)(U)),ne,_)?function aj(d,_,T,x,A,U){const{eye:ne}=d;(0,o_.Tz)([0,0,1],ne,Ad,jh,K3);const fe=_.translation[0]*T.pan,Oe="zoom"===A.mode?0:_.translation[1]*T.pan,we=Math.max(Math.sqrt(Math.abs(1-(0,pt.e)(d.center,Ad)**2/(0,pt.l)(d.center)**2)),.5),Ze=(Math.sin(U)*Oe+Math.cos(U)*fe)/we,it=-Math.cos(U)*Oe+Math.sin(U)*fe;switch((0,gi.e)(x.pan.matrix,x.pan.matrix,Ze,Ad),x.pan.enabled=!0,A.mode){case"pan":(0,gi.e)(x.pan.matrix,x.pan.matrix,it,jh),x.pan.enabled=!0;break;case"zoom":x.zoom=-_.translation[1]*T.zoom}}(_,T,x,fe,Oe,-za.Q4.normalize((0,xr.Vl)(A))):function lj(d,_,T,x,A){const{eye:U,viewRight:ne}=d,fe=(0,pt.f)(Dn.WM.get(),ne,U),Oe=_.translation[0]*T.pan;switch(0!==Oe&&((0,gi.e)(x.pan.matrix,x.pan.matrix,-Oe,fe),x.pan.enabled=!0),A.mode){case"pan":{const we=_.translation[1]*T.pan;0!==we&&((0,gi.e)(x.pan.matrix,x.pan.matrix,we,ne),x.pan.enabled=!0);break}case"zoom":x.zoom=-_.translation[1]*T.zoom}}(_,T,x,fe,Oe)}(this.startCamera,_,U,d,this.view.camera.heading,this._headingStart,this.view.camera.tilt,T,ne),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(c0.pan,this._tmpCamera);const Oe=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;T.ascend=U.translation[2]*d.ascend;const Ze=-U.heading*d.rotate;0!==Ze&&((0,gi.e)(T.rotate.matrix,T.rotate.matrix,Ze,this._tmpCamera.eye),T.rotate.enabled=!0);const lt=this._clampTiltDeltaGlobalToValidRange(U.tilt*d.rotate,_.ray,Oe);0!==lt&&((0,gi.e)(T.rotate.matrix,T.rotate.matrix,lt,this._tmpCamera.viewRight),T.rotate.enabled=!0),T.zoom+=U.zoom*d.zoom}_clampTiltDeltaGlobalToValidRange(d,_,T){const x=(0,En.Iu)(this.view.spatialReference),A=T1(Sa.min,_.origin,T,x);let U=0,ne=0;const fe=Dn.WM.get();return this.view.renderCoordsHelper.intersectManifold(_,T,fe)?(U=T1(wh(this.view.renderCoordsHelper,fe,_.origin),_.origin,T,x),ne=T1(Sa.max,_.origin,T,x)):((0,oo.b)((0,oo.e)(oo.t,T+x.radius),_,fe),U=w3((0,xr.ZF)(-(0,pt.e)(_.direction,(0,pt.n)(fe,fe))),_.origin,T,x),ne=w3(Sa.max,_.origin,T,x)),(0,xr.uZ)(U+d,A,ne)-U}_getPointAbsoluteSurfaceElevation(d,_,T){const{renderCoordsHelper:x}=this.view,A=x.getAltitude(d),U=_+Math.abs(A-_);return x.setAltitude(T,U,d),U}_clampedDistanceToSurface(d,_){const{renderCoordsHelper:T}=this.view,{camera:x}=this.view.state,{direction:A}=function $j(d,_,T,x,A){return V_(d).headingTiltToDirectionUp(_,T,x,A)}(this.view,_,0,xR,UF),U=T.intersectManifoldClosestSilhouette((0,yc.re)(_,A),d,Dn.WM.get()),ne=(0,pt.i)(_,U),fe=T.intersectManifoldClosestSilhouette((0,yc.re)(_,(0,pt.r)(Dn.WM.get(),_,x.center)),d,Dn.WM.get()),Oe=(0,pt.i)(_,fe);return Math.min(ne,Oe)}_computeHeadingRotateRadius(d){const{renderCoordsHelper:_,state:T}=this.view,{camera:x,isGlobal:A}=T,U=_.intersectManifoldClosestSilhouette(x.ray,this._filteredSurfaceElevation,Dn.WM.get());if(A){const ne=(0,pt.b)(Dn.WM.get(),d,U),fe=(0,pt.l)(ne);(0,pt.g)(ne,ne,1/fe);const Oe=(0,pt.n)(Dn.WM.get(),d),we=(0,xr.ZF)((0,pt.e)(Oe,ne));return fe*Math.sin(Math.min(RF,we))}{const ne=(0,pt.c)(Dn.WM.get(),d);return _.setAltitude(ne,this._filteredSurfaceElevation),(0,pt.i)(U,ne)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:wF}_computeVelocities(d){const _=this._filteredSurfaceElevation,T=_+(0,En.Iu)(this.view.spatialReference).radius,{camera:x,isGlobal:A}=this.view.state,U=Dn.WM.get(),ne=this._getPointAbsoluteSurfaceElevation(x.eye,_,U),fe=this._clampedDistanceToSurface(_,U),Oe=x.width/2,we=DR*x.width,Ze=DR*x.width,it=fe*Math.tan(.5*x.fovX)/Oe,lt=it/T,dt=it/this._computeHeadingRotateRadius(U),Tt=ne-_;return{pan:(A?lt:it)*we*d,ascend:Math.max(this._minimumAscendVelocity()*d,2**(we*d/Oe)*Tt-Tt),zoom:2**(we*d/Oe)*fe-fe,rotate:(0,xr.uZ)(dt*Ze,IF,LF)*d}}_applyDisabledMovementTypes(d){!(0,Qe.pC)(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(d.zoom=this.disableMovements.zoom?0:d.zoom,d.ascend=this.disableMovements.ascend?0:d.ascend,d.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&(0,gi.i)(d.pan.matrix),d.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&(0,gi.i)(d.rotate.matrix))}static activatesFor(d,_){const T=PR(_,d.navigation.gamepad,AF);return!("end"===_.action||S2(T))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],l0.prototype,"gamepadDevice",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],l0.prototype,"disableMovements",void 0),l0=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.GamepadKeyboardController")],l0);const AF={translation:[0,0,0],heading:0,tilt:0,zoom:0},xR=80,RF=(0,xr.Vl)(xR),DR=.75,wF=5,IF=(0,xr.Vl)(30),LF=(0,xr.Vl)(80),c0={zoom:0,ascend:0,pan:{enabled:!1,matrix:(0,gn.c)()},rotate:{enabled:!1,matrix:(0,gn.c)()}},Pl=(0,ir.c)(),wg=(0,ir.c)(),UF=qP();class jF extends nl.a{constructor(_){super(!0),this._view=_,this._watchHandles=new Ji.Z,this._handle=this.registerIncoming("gamepad",T=>this._handleEventGamepad(T)),this._handle.pause()}onInstall(_){super.onInstall(_),this._watchHandles.add([(0,Ht.YP)(()=>this._view.navigation.gamepad.enabled,T=>{T?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Ht.nn),(0,Ht.YP)(()=>this._view.navigation.gamepad.device,T=>{this._cameraControllerGamepad&&T&&this._cameraControllerGamepad.gamepadDevice!==T&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(_){const T=this._view.navigation.gamepad.device;if(T&&_.data.device!==T)return;const x=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(x||l0.activatesFor(this._view,_.data)){if(!x){const A=new l0({view:this._view,gamepadDevice:_.data.device});this._view.state.switchCameraController(A)&&(this._cameraControllerGamepad=A)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===_.data.device&&this._cameraControllerGamepad.handleEventGamepad(_.data)}}}var kl;!function(d){d[d.LEFT=0]="LEFT",d[d.RIGHT=1]="RIGHT",d[d.FORWARD=2]="FORWARD",d[d.BACKWARD=3]="BACKWARD",d[d.UP=4]="UP",d[d.DOWN=5]="DOWN",d[d.HEADINGLEFT=6]="HEADINGLEFT",d[d.HEADINGRIGHT=7]="HEADINGRIGHT",d[d.TILTUP=8]="TILTUP",d[d.TILTDOWN=9]="TILTDOWN",d[d.ZOOMIN=10]="ZOOMIN",d[d.ZOOMOUT=11]="ZOOMOUT"}(kl||(kl={}));class FF extends nl.a{constructor(_,T){super(!0),this._view=_,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:vi.JY.Local},this._keyToNumber={[T.left]:kl.LEFT,[T.right]:kl.RIGHT,[T.forward]:kl.FORWARD,[T.backward]:kl.BACKWARD,[T.up]:kl.UP,[T.down]:kl.DOWN,[T.headingLeft]:kl.HEADINGLEFT,[T.headingRight]:kl.HEADINGRIGHT,[T.tiltUp]:kl.TILTUP,[T.tiltDown]:kl.TILTDOWN,[T.zoomIn]:kl.ZOOMIN,[T.zoomOut]:kl.ZOOMOUT},this.registerIncoming("key-down",null,x=>this._handleKeyDown(x)),this.registerIncoming("key-up",null,x=>this._handleKeyUp(x)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(_){if(_.data.native.ctrlKey||_.data.native.metaKey)return;const T=this._keyToNumber[_.data.key];null!=T&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new l0({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(T),_.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(_){if(_.data.native.ctrlKey||_.data.native.metaKey)return;const T=this._keyToNumber[_.data.key];null!=T&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(T),_.stopPropagation())}}class NF extends nl.a{constructor(_,T){super(!0),this._view=_,this.registerIncoming("mouse-wheel",T,x=>this._handleMouseWheel(x))}_handleMouseWheel(_){if(!this._view.navigation.mouseWheelZoomEnabled)return;const T=_.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new U1({view:this._view,mode:"interaction"}):new F1({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*T.deltaY,(0,li.s1)(T.x,T.y)),_.preventDefault(),_.stopPropagation()}}class tE{constructor(_){this._gain=_}reset(_){this._value=_}set gain(_){this._gain=_}get value(){return void 0===this._value?0:this._value}update(_){this._value=void 0===this._value?_:this._gain*_+(1-this._gain)*this._value}}let u0=class extends vg{constructor(){super(...arguments),this._beginCamera=new $i.V,this._elapsedTimeSec=0,this.constraintOptions={selection:xn.ALL,interactionType:wi.PAN,interactionFactor:0,interactionStartCamera:new $i.V,interactionDirection:null,tiltMode:qo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new g_}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(d){this._beginCamera.copyFrom(d),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(d)}stepController(d,_){_.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=d,this.momentumStep(this._elapsedTimeSec,_),_o(this.view,_,this.constraintOptions)}};u0=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.MomentumController")],u0);let Ig=class extends u0{constructor(d){super(d),this.interactionType=wi.PAN,this._tmpPan=(0,ir.c)()}momentumStep(d,_){const T=this.momentum.value(d);(0,pt.g)(this._tmpPan,this.momentum.direction,T),_.eye=(0,pt.b)(SR,_.eye,this._tmpPan),_.center=(0,pt.b)(SR,_.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ig.prototype,"momentum",void 0),Ig=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Ig);const SR=(0,ir.c)(),WF=(0,ir.c)(),rE=(0,ir.c)();let sE=class extends u0{constructor(d){super(d),this.interactionType=wi.PAN}momentumStep(d,_){const T=this.momentum.value1(d),x=this.momentum.value2(d);(0,pt.c)(rE,_.eye),(0,pt.n)(rE,rE),(0,pt.f)(this.momentum.axis2,rE,this.momentum.axis1),z3(_,WF,this.momentum.axis1,T,this.momentum.axis2,x)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],sE.prototype,"momentum",void 0),sE=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],sE);let d0=class extends u0{constructor(d){super(d),this.interactionType=wi.TUMBLE}set center(d){this._set("center",(0,ir.a)(d))}set axis(d){this._set("axis",(0,ir.a)(d))}momentumStep(d,_){const T=this.momentum.value(d);Bh(_,this.center,Eg(this.axis,T))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],d0.prototype,"momentum",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],d0.prototype,"center",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],d0.prototype,"axis",null),d0=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.MomentumController")],d0);let K_=class extends u0{constructor(d){super(d),this.interactionType=wi.ZOOM,this.constraintOptions.interactionDirection=(0,ir.c)()}set zoomCenter(d){this._set("zoomCenter",(0,ir.a)(d))}momentumStep(d,_){(0,pt.c)(this.constraintOptions.interactionDirection,_.eye);const T=this.momentum.valueDelta(0,d);ZP(_,this.zoomCenter,T,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=(0,pt.r)(this.constraintOptions.interactionDirection,_.eye,this.constraintOptions.interactionDirection)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],K_.prototype,"momentum",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],K_.prototype,"zoomCenter",null),K_=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],K_);let h0=class extends u0{constructor(d){super(d),this.interactionType=wi.ZOOM,this.radius=0,this._tmpSceneCenter=(0,ir.c)(),this._tmpZoomAxisAngle=I_(),this._sphere=(0,oo.c)()}set screenCenter(d){this._set("screenCenter",(0,li.s1)(d[0],d[1]))}set sceneCenter(d){this._set("sceneCenter",(0,ir.a)(d))}initialize(){this._sphere[3]=this.radius}momentumStep(d,_){const T=this.momentum.valueDelta(0,d);A3(this._sphere,_,T),this.constraintOptions.interactionType=wi.ZOOM,_o(this.view,_,this.constraintOptions),bg(this._sphere,_,this.screenCenter,this._tmpSceneCenter),zP(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Bh(_,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=wi.PAN}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],h0.prototype,"momentum",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],h0.prototype,"screenCenter",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],h0.prototype,"sceneCenter",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],h0.prototype,"radius",void 0),h0=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],h0);class hu{constructor(_){this._gain=_,this.lastValue=void 0,this.filteredDelta=void 0}update(_){if(this.hasLastValue()){const T=this.computeDelta(_);this._updateDelta(T)}this.lastValue=_}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(_){return void 0===this.lastValue?NaN:_-this.lastValue}_updateDelta(_){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*_:_}}class iE{constructor(_,T,x){this._initialVelocity=_,this._stopVelocity=T,this._friction=x,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(_){return _>this.duration}get friction(){return this._friction}value(_){return this.valueFromInitialVelocity(this._initialVelocity,_)}valueDelta(_,T){const x=this.value(_);return this.value(_+T)-x}valueFromInitialVelocity(_,T){T=Math.min(T,this.duration);const x=1-this.friction;return _*(x**T-1)/Math.log(x)}}class VF extends iE{constructor(_,T,x,A,U){super(_,T,x),this._sceneVelocity=A,this.direction=U}value(_){return super.valueFromInitialVelocity(this._sceneVelocity,_)}}class AR{constructor(_=300,T=12,x=.84){this._minimumInitialVelocity=_,this._stopVelocity=T,this._friction=x,this.enabled=!0,this._time=new hu(.6),this._screen=[new hu(.4),new hu(.4)],this._scene=[new hu(.6),new hu(.6),new hu(.6)],this._tmpDirection=(0,ir.c)()}add(_,T,x){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(x)<.015)return;this._screen[0].update(_[0]),this._screen[1].update(_[1]),this._scene[0].update(T[0]),this._scene[1].update(T[1]),this._scene[2].update(T[2]),this._time.update(x)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const _=this._screen[0].filteredDelta,T=this._screen[1].filteredDelta,x=null==_||null==T?0:Math.sqrt(_*_+T*T),A=this._time.filteredDelta,U=null==A||null==x?0:x/A;return Math.abs(U)<this._minimumInitialVelocity?null:this.createMomentum(U,this._stopVelocity,this._friction)}createMomentum(_,T,x){(0,pt.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const A=(0,pt.l)(this._tmpDirection);A>0&&(0,pt.g)(this._tmpDirection,this._tmpDirection,1/A);const U=this._time.filteredDelta;return new VF(_,T,x,null==U?0:A/U,this._tmpDirection)}}class RR{constructor(_){this._gain=_}update(_){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*_:_}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}class zF extends iE{constructor(_,T,x,A,U,ne=0,fe){super(_,T,x),this._angularVelocity1=A,this.axis1=U,this.angularVelocity2=ne,this.axis2=fe}value1(_){return super.valueFromInitialVelocity(this._angularVelocity1,_)}value2(_){return super.valueFromInitialVelocity(this.angularVelocity2,_)}}class HF{constructor(_=300,T=12,x=.84){this._minimumInitialVelocity=_,this._stopVelocity=T,this._friction=x,this.enabled=!0,this._tmpAxis1=(0,ir.c)(),this._tmpAxis2=(0,ir.c)(),this._tmpAngles=(0,un.a)(),this._time=new hu(.3),this._screen=[new hu(.4),new hu(.4)],this._angle1=new RR(.6),this._angle2=new RR(.6),this._axis1=(0,ir.c)(),this._axis2=(0,ir.c)(),this._lastScene=(0,ir.c)()}addMomentumDirectRotation(_,T,x,A,U,ne){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(x)<.01)return;let fe=F3(this._lastScene,T,this._tmpAxis2,A,U,ne);this._angle2.update(0),(0,pt.p)(this._tmpAxis2)<1e-5?fe=0:(0,pt.n)(this._axis1,this._tmpAxis2),this._angle1.update(fe),(0,pt.c)(this._lastScene,T)}this._screen[0].update(_[0]),this._screen[1].update(_[1]),this._time.update(x)}}addMomentumPreserveHeading(_,T,x,A,U,ne,fe){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(x)<.01)return;V3(this._lastScene,T,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,A,U,ne,fe,!1),(0,pt.p)(this._tmpAxis2)<1e-5?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),(0,pt.n)(this._axis1,this._tmpAxis1),(0,pt.n)(this._axis2,this._tmpAxis2)),(0,pt.c)(this._lastScene,T)}this._screen[0].update(_[0]),this._screen[1].update(_[1]),this._time.update(x)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const _=this._screen[0].filteredDelta,T=this._screen[1].filteredDelta,x=null==_||null==T?null:Math.sqrt(_*_+T*T),A=this._time.filteredDelta,U=null==x||null==A?0:x/A;return Math.abs(U)<this._minimumInitialVelocity?null:this.createMomentum(U,this._stopVelocity,this._friction)}createMomentum(_,T,x){const A=this._time.filteredDelta,U=this._angle1.filteredValue,ne=this._angle2.filteredValue;return new zF(_,T,x,null==A||null==U?0:U/A,this._axis1,null==A||null==ne?0:ne/A,this._axis2)}}class IR{constructor(_=2.5,T=.01,x=.95,A=12){this._minimumInitialVelocity=_,this._stopVelocity=T,this._friction=x,this._maxVelocity=A,this.enabled=!0,this.value=new hu(.8),this.time=new hu(.3)}add(_,T){if(this.enabled&&null!=T){if(this.time.hasLastValue()){if(this.time.computeDelta(T)<.01)return;if(this.value.hasFilteredDelta()){const x=this.value.computeDelta(_);this.value.filteredDelta*x<0&&this.value.reset()}}this.time.update(T),this.value.update(_)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let _=this.value.filteredDelta/this.time.filteredDelta;return _=(0,xr.uZ)(_,-this._maxVelocity,this._maxVelocity),Math.abs(_)<this._minimumInitialVelocity?null:this.createMomentum(_,this._stopVelocity,this._friction)}createMomentum(_,T,x){return new iE(_,T,x)}}class LR extends IR{constructor(_=3,T=.01,x=.95,A=12){super(_,T,x,A)}add(_,T){const x=this.value.lastValue;if(null!=x){let A=_-x;for(;A>Math.PI;)A-=2*Math.PI;for(;A<-Math.PI;)A+=2*Math.PI;_=x+A}super.add(_,T)}}class GF extends iE{constructor(_,T,x){super(_,T,x)}value(_){const T=super.value(_);return Math.exp(T)}valueDelta(_,T){const x=super.value(_),A=super.value(_+T)-x;return Math.exp(A)}}class UR extends IR{constructor(_=2.5,T=.01,x=.95,A=12){super(_,T,x,A)}add(_,T){super.add(Math.log(_),T)}createMomentum(_,T,x){return new GF(_,T,x)}}let A2=class extends Fu{constructor(){super(...arguments),this._smoothRotation=new tE(.05),this._rotationAxis=(0,ir.c)(),this._panningPlane=(0,Rn.Ue)(),this._smoothScaling=new tE(.05),this._zoomCenterScreen=(0,li.s1)(),this._zoomMomentumEstimator=new UR,this._rotationMomentumEstimator=new LR,this._panSphericalMomentumEstimator=new HF,this._panPlanarMomentumEstimator=new AR,this._adjustedSphere=(0,oo.c)(),this._tmp3d=(0,ir.c)(),this._tmpScreenPointArray=(0,li.s1)(),this._beginScreenPoint=(0,li.s1)(),this._beginScenePoint=(0,ir.c)(),this._screenPickPoint=(0,li.s1)(),this._mode=fa.Horizontal,this._tmpInteractionDirection=(0,ir.c)(),this._constraintOptions={selection:xn.ALL,interactionType:wi.NONE,interactionFactor:0,interactionStartCamera:new $i.V,interactionDirection:null,tiltMode:qo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(d){if(!this.active)return;const _=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=_,this._rotationMomentumEstimator.enabled=_,this._panPlanarMomentumEstimator.enabled=_,this._panSphericalMomentumEstimator.enabled=_,this._beginHeading=-za.Q4.normalize((0,xr.Vl)(this.view.camera.heading)),this._beginRadius=d.radius,this._pointerCount=d.pointers.size,this._beginAngle=d.angle,this._smoothRotation.reset(),(0,li.md)(d.center,this._screenPickPoint),(0,ti.c)(this._beginScreenPoint,this._screenPickPoint);const T=(0,En.Iu)(this.view.spatialReference),x=U3(this._intersectionHelper,this.startCamera,this._screenPickPoint,T,L_.Silhouette);(0,Qe.Wi)(x.scenePickPoint)||(this._scenePickPoint=x.scenePickPoint,this._sphere=x.sphere,(0,pt.c)(this._beginScenePoint,this._scenePickPoint),this._mode=P1(this.startCamera,this._screenPickPoint,x.hasGeometryIntersection,T),this._mode===fa.Vertical&&this._preparePlanarPanMode(d),this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera))}update(d){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const _=d.pointers.size>1;this._mode===fa.Horizontal?(_&&this._zoomSpherical(d),this._panningSpherical(d),_&&this._rotateSpherical(d)):(_&&this._zoomPlanar(d),this._panningPlanar(d),_&&this._rotatePlanar(d)),this.commitCamera()}end(d){d.pointers.size===this._pointerCount&&this.update(d),this.finishController();const _=this._zoomMomentumEstimator.evaluateMomentum();if(_)return this._mode===fa.Horizontal?new h0({view:this.view,momentum:_,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new K_({view:this.view,momentum:_,zoomCenter:this._beginScenePoint});const T=this._rotationMomentumEstimator.evaluateMomentum();if(T)return new d0({view:this.view,momentum:T,center:this._sphere,axis:this._rotationAxis});if(this._mode===fa.Horizontal){const x=this._panSphericalMomentumEstimator.evaluateMomentum();if(x)return new sE({view:this.view,momentum:x})}else{const x=this._panPlanarMomentumEstimator.evaluateMomentum();if(x)return new Ig({view:this.view,momentum:x})}return null}_preparePlanarPanMode(d){const _=(0,pt.o)(this._tmp3d,this.startCamera.viewForward);(0,Rn.Yq)(this._scenePickPoint,_,this._panningPlane);const T=(0,li.s1)(this._screenPickPoint[0],0),x=(0,ir.c)(),A=(0,pt.l)(this.startCamera.eye);this._adjustedSphere[3]=A<this._sphere[3]?A-100:this._sphere[3],bg(this._adjustedSphere,this.startCamera,T,x);const U=(0,li.J$)();this.startCamera.projectToRenderScreen(x,U),this._screenPickPoint[1]=Math.min(this._screenPickPoint[1],.9*U[1]);const fe=this._intersectionHelper.intersectScreen(this._screenPickPoint,this._scenePickPoint);fe&&(0,Rn.Yq)(this._scenePickPoint,(0,Rn.mJ)(this._panningPlane),this._panningPlane);const Oe=(0,ir.c)(),we=(0,ir.c)(),Ze=(0,ir.c)();(0,pt.b)(Oe,this._scenePickPoint,this.currentCamera.eye);const Tt=(0,pt.l)(Oe);(0,pt.n)(Oe,Oe);const mt=5*Math.max(Math.abs(this.view.camera.position.z),50),Mt=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,80);let Pt=(0,Qe.pC)(Mt)?Math.min(Mt,mt):mt;Pt=fe?Math.min(Pt,Tt):Pt,(0,pt.c)(Ze,(0,pt.a)(we,this.currentCamera.eye,(0,pt.g)(we,Oe,Pt))),this._panningPlane[3]=-(0,pt.e)(this._panningPlane,Ze),this.startCamera.center=(0,pt.a)(we,this.startCamera.eye,(0,pt.g)(we,this.startCamera.viewForward,Pt));const Nt=(0,li.md)(d.center,this._tmpScreenPointArray);KP(this._panningPlane,this.startCamera,Nt,this._beginScenePoint)}_zoomSpherical(d){const _=this._beginRadius/d.radius,T=.001875*Math.min(Math.max(d.radius,40),120);this._smoothScaling.gain=T,this._smoothScaling.update(_),A3(this._sphere,this.currentCamera,this._smoothScaling.value),(0,li.md)(d.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*d.timestamp),this._constraintOptions.interactionType=wi.ZOOM,this._constraintOptions.interactionFactor=uu(d.radius-this._beginRadius),_o(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(d){const _=(0,li.md)(d.center,this._tmpScreenPointArray);bg(this._sphere,this.currentCamera,_,this._tmp3d),XP(this._beginScenePoint,(0,pt.e)(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(G3(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(_,this._tmp3d,.001*d.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(H3(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(_,this._tmp3d,.001*d.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=wi.PAN,this._constraintOptions.interactionFactor=uu((0,ti.d)(this._screenPickPoint,_)),_o(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(d){(0,pt.n)(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||(0,pt.o)(this._rotationAxis,this._rotationAxis);const _=this._smoothRotation.value,T=_+GP(d.angle-_),x=.00125*Math.min(Math.max(d.radius,40),120);this._smoothRotation.gain=x,this._smoothRotation.update(T);const A=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(A,.001*d.timestamp),Bh(this.currentCamera,this._sphere,Eg(this._rotationAxis,A)),this._constraintOptions.interactionType=wi.TUMBLE,this._constraintOptions.interactionFactor=uu(d.radius*T),_o(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(d){const _=(0,li.md)(d.center,this._tmpScreenPointArray);KP(this._panningPlane,this.currentCamera,_,this._tmp3d)&&(B3(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(_,this._tmp3d,.001*d.timestamp),this._constraintOptions.interactionType=wi.PAN,this._constraintOptions.interactionFactor=uu((0,ti.d)(this._beginScreenPoint,_)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),_o(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(d){const _=this._beginRadius/d.radius,T=.001875*Math.min(Math.max(d.radius,40),120);this._smoothScaling.gain=T,this._smoothScaling.update(_),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*d.timestamp),ZP(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=wi.ZOOM,this._constraintOptions.interactionFactor=uu(d.radius-this._beginRadius),_o(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(d){(0,pt.c)(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||(0,pt.o)(this._rotationAxis,this._rotationAxis);const _=this._smoothRotation.value;let T=d.angle-_;T=GP(T);const x=_+T,A=.00125*Math.min(Math.max(d.radius,40),120);this._smoothRotation.gain=A,this._smoothRotation.update(x);const U=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(U,.001*d.timestamp),Bh(this.currentCamera,this._sphere,Eg(this._rotationAxis,U)),this._constraintOptions.interactionType=wi.TUMBLE,this._constraintOptions.interactionFactor=uu(d.radius*U),_o(this.view,this.currentCamera,this._constraintOptions)}};A2=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.global.PinchAndPanController")],A2);const BR=(0,ir.f)(0,0,1),KF_ANGLE_THRESHOLD=16/180*Math.PI;let R2=class extends Fu{constructor(){super(...arguments),this._rotationValueSmooth=new tE(.05),this._scalingValueSmooth=new tE(.05),this._planeHorizontal=(0,Rn.Ue)(),this._planeVertical=(0,Rn.Ue)(),this._rotationMomentumEstimator=new LR,this._panMomentumEstimator=new AR(300,12,.9),this._zoomMomentumEstimator=new UR,this._beginCenter=(0,ir.c)(),this._tmpPoints=[],this._beginCenterScreen=(0,li.s1)(),this._tmpCentroid3d=(0,ir.c)(),this._tmpCentroid2d=(0,li.s1)(),this._tmp2d=(0,li.s1)(),this._constraintOptions={selection:xn.ALL,interactionType:wi.NONE,interactionFactor:0,interactionStartCamera:new $i.V,interactionDirection:null,tiltMode:qo.TUMBLE}}begin(d){if(!this.active)return;const _=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=_,this._rotationMomentumEstimator.enabled=_,this._panMomentumEstimator.enabled=_,this._beginRadius=d.radius,this._pointerCount=d.pointers.size,this._beginAngle=d.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),(0,li.md)(d.center,this._beginCenterScreen),(0,Rn.Oy)(BR,0,this._planeHorizontal);const T=(0,ir.c)(),x=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,T),A=(0,ir.c)();(0,pt.o)(A,this.startCamera.viewForward);const U=(0,ir.c)();(0,pt.c)(U,BR);const ne=(0,pt.e)(A,U),fe=(0,xr.Kt)(ne<0?-ne:ne);if(this._panMode=fe>=KF_ANGLE_THRESHOLD?fa.Horizontal:fa.Vertical,(0,Rn.T5)(this._planeHorizontal,this._planeHorizontal,T),this.startCamera.aboveGround||(0,Rn.tk)(this._planeHorizontal,this._planeHorizontal),this._panMode===fa.Vertical){(0,pt.g)(U,U,ne),(0,pt.b)(this._planeVertical,A,U),(0,pt.n)(this._planeVertical,this._planeVertical),(0,Rn.T5)(this._planeVertical,this._planeVertical,T);const Oe=(0,ir.c)(),we=(0,ir.c)(),Ze=(0,ir.c)();(0,pt.b)(Oe,T,this.currentCamera.eye);const it=(0,pt.l)(Oe);(0,pt.n)(Oe,Oe);const lt=5*Math.max(Math.abs(this.view.camera.position.z),50),dt=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,80);let Tt=(0,Qe.pC)(dt)?Math.min(dt,lt):lt;Tt=x?Math.min(Tt,it):Tt,(0,pt.c)(Ze,(0,pt.a)(we,this.currentCamera.eye,(0,pt.g)(we,Oe,Tt))),this._planeVertical[3]=-(0,pt.e)(this._planeVertical,Ze),this._computePlanePoints(d.pointers,this._planeVertical,this.startCamera,this._tmpPoints),$P(this._tmpPoints,this._beginCenter)}else this._computePlanePoints(d.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),$P(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(d){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const _=d.pointers.size>1,T=this._panMode===fa.Horizontal?this._planeHorizontal:this._planeVertical,x=this._beginCenter;if(_){const A=this._beginRadius/d.radius,U=.001875*Math.min(Math.max(d.radius,40),120);this._scalingValueSmooth.gain=U,this._scalingValueSmooth.update(A),ZP(this.currentCamera,x,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*d.timestamp),this._constraintOptions.interactionType=wi.ZOOM,this._constraintOptions.interactionFactor=uu(Math.abs(d.radius-this._beginRadius)),_o(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(d.pointers,T,this.currentCamera,this._tmpPoints),$P(this._tmpPoints,this._tmpCentroid3d),(0,li.md)(d.center,this._tmpCentroid2d),B3(this.currentCamera,x,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*d.timestamp),this._constraintOptions.interactionType=wi.PAN,this._constraintOptions.interactionFactor=uu((0,ti.d)(this._beginCenterScreen,this._tmpCentroid2d)),_o(this.view,this.currentCamera,this._constraintOptions),_){const A=this._planeHorizontal,U=x,ne=this._rotationValueSmooth.value,fe=ne+GP(d.angle-ne),Oe=.00125*Math.min(Math.max(d.radius,40),120);this._rotationValueSmooth.gain=Oe,this._rotationValueSmooth.update(fe);const we=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(we,.001*d.timestamp),Bh(this.currentCamera,U,Eg(A,we)),this._constraintOptions.interactionType=wi.TUMBLE,this._constraintOptions.interactionFactor=uu(Math.abs(d.radius*we)),_o(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(d){d.pointers.size===this._pointerCount&&this.update(d),this.finishController();const _=this._zoomMomentumEstimator.evaluateMomentum();if(_)return new K_({view:this.view,momentum:_,zoomCenter:this._beginCenter});const T=this._rotationMomentumEstimator.evaluateMomentum();if(T)return new d0({view:this.view,momentum:T,center:this._beginCenter,axis:(0,Rn.mJ)(this._planeHorizontal)});const x=this._panMomentumEstimator.evaluateMomentum();return x?new Ig({view:this.view,momentum:x}):null}_computePlanePoints(d,_,T,x){x.length=d.size;const A=this._tmp2d;let U=0;return d.forEach(ne=>{A[0]=ne.x,A[1]=ne.y,void 0===x[U]&&(x[U]=(0,ir.c)()),KP(_,T,A,x[U]),U+=1}),x}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};R2=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.controllers.local.PinchAndPanController")],R2);class jR extends nl.a{constructor(_,T,x){super(!0),this._view=_,this.pointerAction=T,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",x,A=>this._handleDrag(A))}_handleDrag(_){if("mouse"===_.data.pointerType&&!QP(_.data,this.pointerAction))return;const A=this._momentum&&this._momentum.active&&_.timestamp-this._lastEndTimestamp<40;switch(_.data.action){case"start":case"update":if(A)break;this._controller&&this._controller.active?_.data.timestamp-this._lastTimestamp>2&&(this._controller.update(_.data),this._lastTimestamp=_.timestamp):this._startController(_);break;case"end":case"removed":this._endController(_,!0);break;case"added":this._endController(_,!1),this._startController(_)}_.stopPropagation()}_endController(_,T){if(this._controller&&this._controller.active){this._lastEndTimestamp=_.timestamp;const x=this._controller.end(_.data);T&&x&&(this._momentum=x,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(_){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(_.data),this._lastTimestamp=_.timestamp}_createController(){return this._view.state.isGlobal?new A2({view:this._view}):new R2({view:this._view})}}class $F extends nl.a{constructor(_,T){super(!0),this.view=_,this.registerIncoming("pointer-down",T,()=>this.view.state.stopActiveCameraController())}}class FR extends nl.a{constructor(_,T){super(!0),this.key=_,this.registerIncoming("key-down",T,x=>this._handleKeyDown(x))}_handleKeyDown(_){_.data.key===this.key&&(this.activate(),_.stopPropagation())}}class YF extends FR{constructor(_,T,x){super(T,x),this.view=_}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class XF extends FR{constructor(_,T,x){super(T,x),this.view=_}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class kF extends nl.a{constructor(_,T=!1){super(!0),this._view=_,this._invert=T,this.registerIncoming("vertical-two-finger-drag",x=>this._handleTwoFinger(x))}_handleTwoFinger(_){const x=(0,li.s1)(0,_.data.delta*(this._invert?-1:1));switch(_.data.action){case"begin":this._cameraController?.end(),this._cameraController=new Rg({view:this._view,pivot:Xl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(x);break;case"update":this._cameraController?.update(x);break;case"end":this._cameraController?.end(),this._cameraController=null}}}var JF=v(25441);function NR(d){const _=d.native;return _?{buttons:_.buttons.map(T=>T.pressed?T.value?T.value:1:0),axes:_.axes.map(T=>function eN(d,_){const T=Math.abs(d);return T<_?0:Math.sign(d)*(T-_)/(1-_)}(T,d.axisThreshold))}:{buttons:[],axes:[]}}class tN{constructor(_,T){this._element=_,this._input=T,this._hasEventListeners=!1,this._onConnectGamepad=U=>{this._connectGamepad(U.gamepad)},this._onDisconnectGamepad=U=>{const ne=U.gamepad,fe=ne.index,Oe=this._inputDevices[fe];Oe&&(this._emitGamepadEvent(ne,NR(Oe),!1),this._inputDevices.splice(fe,1),this._latestUpdate.splice(fe,1),this._input.gamepad.devices.remove(Oe),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const x="getGamepads"in window.navigator,A=window.isSecureContext;this.supported=x&&A,this.supported&&(this._forEachGamepad(U=>this._connectGamepad(U)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(_){this._hasEventListeners!==_&&(this._hasEventListeners=_,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(_){this._callback=_}_connectGamepad(_){const T=new ZM(_);"unknown"!==T.deviceType&&(this._inputDevices[_.index]=T,this._input.gamepad.devices.add(T)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=(0,gd.A)({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const _=document.hasFocus(),T=this._element.contains(document.activeElement),x="document"===this._input.gamepad.enabledFocusMode&&!_||"view"===this._input.gamepad.enabledFocusMode&&!T;this._forEachGamepad(A=>{const U=this._inputDevices[A.index];if(!U)return;const ne=this._latestUpdate[A.index],fe=NR(U),Oe=x||function qF(d){for(let _=0;_<d.axes.length;_++)if(0!==d.axes[_])return!1;for(let _=0;_<d.buttons.length;_++)if(0!==d.buttons[_])return!1;return!0}(fe);ne&&(ne.timestamp===A.timestamp||!ne.active&&Oe||function QF(d,_){if(d.axes.length!==_.axes.length||d.buttons.length!==_.buttons.length)return!1;for(let T=0;T<d.axes.length;T++)if(d.axes[T]!==_.axes[T])return!1;for(let T=0;T<d.buttons.length;T++)if(d.buttons[T]!==_.buttons[T])return!1;return!0}(ne.state,fe))||this._emitGamepadEvent(A,fe,!Oe)})}_forEachGamepad(_){const T=window.navigator.getGamepads();for(let x=0;x<T.length;x++){const A=T[x];this._validate(A)&&_(A)}}_emitGamepadEvent(_,T,x){const A=this._latestUpdate[_.index],U=A&&A.active;if(!U&&!x)return;const ne=!U&&x?"start":U&&x?"update":"end";this._latestUpdate[_.index]={timestamp:_.timestamp,state:T,active:x},this._callback&&this._callback({device:this._inputDevices[_.index],state:T,action:ne})}_validate(_){if(!_||!_.connected)return!1;for(let T=0;T<_.axes.length;T++)if(isNaN(_.axes[T]))return!1;return!0}}const WR=(0,So.Z)("trident"),VR=(0,So.Z)("edge"),rN=(0,So.Z)("chrome"),sN=(0,So.Z)("ff"),iN=(0,So.Z)("safari"),Z__touchNone="esri-view-surface--touch-none",Z__touchPan="esri-view-surface--touch-pan";let nN=(()=>{class d{constructor(T,x){this._input=x,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=T,T.getAttribute("tabindex")||T.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new tN(T,this._input),this._gamepadSource.onEvent=A=>this._callback("gamepad",A)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(T=>{this._releasePointerCaptureSafe(T)}),this._gamepadSource=(0,Qe.SC)(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(T){this._browserTouchPanningEnabled=T,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(T){this._callback=T}set activeEvents(T){for(const x in this._active)T&&T.has(x)||(this._element.removeEventListener(w2[x],this._active[x]),delete this._active[x]);T&&T.forEach(x=>{if(!this._active[x]&&w2[x]){const A=(this._eventHandlers[x]||this._handleDefault).bind(this,x);this._element.addEventListener(w2[x],A),this._active[x]=A}}),this._gamepadSource.hasEventListeners=T&&T.has("gamepad")}setPointerCapture(T,x){x?(this._element.setPointerCapture(T.pointerId),this._activePointerCaptures.add(T.pointerId)):(this._releasePointerCaptureSafe(T.pointerId),this._activePointerCaptures.delete(T.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Z__touchNone:Z__touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Z__touchPan:Z__touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Z__touchNone),this._element.classList.remove(Z__touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(T){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(T))return;this._element.releasePointerCapture(T)}catch{}}_updateNormalizedPointerLikeEvent(T,x){const A=(0,$l.Eu)(this._element,T);return d.test.disableSubpixelCoordinates&&(A.x=Math.round(A.x),A.y=Math.round(A.y)),x.x=A.x,x.y=A.y,x}_handleKey(T,x){const A=(0,JF.kK)(x);A&&"key-up"===T&&this._keyDownState.delete(A);const U={native:x,key:A,repeat:A&&this._keyDownState.has(A)};A&&"key-down"===T&&this._keyDownState.add(U.key),this._callback(T,U)}_handlePointer(T,x){const A=this._updateNormalizedPointerLikeEvent(x,{native:x,x:0,y:0,pointerType:x.pointerType,button:x.button,buttons:x.buttons,eventId:this._eventId++});this._callback(T,A)}_handlePointerPreventDefault(T,x){const A=this._updateNormalizedPointerLikeEvent(x,{native:x,x:0,y:0,pointerType:x.pointerType,button:x.button,buttons:x.buttons,eventId:this._eventId++});x.preventDefault(),this._callback(T,A)}_handleMouseWheel(T,x){let A=x.deltaY;switch(x.deltaMode){case 0:(WR||VR)&&(A=A/document.documentElement.clientHeight*600);break;case 1:A*=30;break;case 2:A*=900}WR||VR?A*=.7:rN||iN?A*=.6:sN&&(A*=1.375);const ne=Math.abs(A);ne>100&&(A=A/ne*200/(1+Math.exp(-.02*(ne-100))));const fe=this._updateNormalizedPointerLikeEvent(x,{native:x,x:0,y:0,deltaY:A});this._callback(T,fe)}_handlePointerCaptureLost(T,x){this._activePointerCaptures.delete(x.pointerId),this._handleDefault(T,x)}_handleDefault(T,x){const A={native:x};x.preventDefault(),this._callback(T,A)}_preventAltKeyDefault(T){"Alt"===T.key&&T.preventDefault()}_preventMultiTouchPanning(T){T.touches.length>1&&T.preventDefault()}}return d.test={disableSubpixelCoordinates:!1},d})();const w2={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class oN extends nl.a{constructor(){super(!0),this.registerIncoming("context-menu",_=>{_.data.native.preventDefault()})}}function zR(d,_){return Math.abs(_.x-d.x)+Math.abs(_.y-d.y)}function Lg(d){const{native:_}=d,{pointerId:T,button:x,pointerType:A}=_;return"mouse"===A?`${T}:${x}`:`${A}`}class cN extends nl.a{constructor(_){super(!1),this._navigationTouch=_,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(_,T,x,A){return{action:_,pointerType:this._pointerType,button:this._mouseButton,buttons:T.buttons,timestamp:A,pointers:uN(this._activePointerMap),pointer:T,angle:x.angle,radius:x.radius,center:x.center}}_addPointer(_){const T=_.native.pointerId,x=nE(this._activePointerMap).angle,A={event:_,initialAngle:0,lastAngle:0};this._activePointerMap.set(T,A);const U=oE(A,HR(this._activePointerMap));A.initialAngle=U,A.lastAngle=U,this._updatePointerAngles(x)}_updatePointer(_){if(_&&null==_.x&&null==_.y)return;const x=this._activePointerMap.get(_.native.pointerId);x?x.event=_:this._addPointer(_)}_removePointer(_){const T=nE(this._activePointerMap).angle;this._activePointerMap.delete(_),this._updatePointerAngles(T)}_updatePointerAngles(_){const T=nE(this._activePointerMap);this._activePointerMap.forEach(x=>{x.initialAngle=oE(x,T)-_,x.lastAngle=oE(x,T)-_})}_emitEvent(_,T,x){const A=nE(this._activePointerMap);this._drag.emit(this._createPayload(_,T,A,x),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(_){const T=_.data.native.pointerId,x=(0,mi.HA)(_.timestamp);this._activePointerMap.get(T)&&(1===this._activePointerMap.size?(this._updatePointer(_.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",_.data,x),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(T)):(this._removePointer(T),this._emitEvent("removed",_.data,(0,mi.HA)(_.timestamp))))}_handlePointerDrag(_){const T=_.data,x=T.currentEvent,A=(0,mi.HA)(_.timestamp);switch(T.action){case"start":case"update":this._isDragging?this._activePointerMap.has(x.native.pointerId)?(this._updatePointer(x),!this._isCurrentDragSuppressed&&this._emitEvent("update",x,A)):(this._addPointer(x),this._emitEvent("added",x,A),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(x),this._pointerType=_.data.startEvent.pointerType,this._mouseButton=_.data.startEvent.button,this._startStateModifiers=_.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",x,A))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}function HR(d){const _=[];return d.forEach(T=>{_.push((0,li.vW)(T.event.x,T.event.y))}),function lN(d,_){if(_?(_.radius=0,_.center.x=0,_.center.y=0):_={radius:0,center:(0,li.vW)()},0===d.length)return _;if(1===d.length)return _.center.x=d[0].x,_.center.y=d[0].y,_;if(2===d.length){const[Bt,Zt]=d,[nr,Jt]=[Zt.x-Bt.x,Zt.y-Bt.y];return _.radius=Math.sqrt(nr*nr+Jt*Jt)/2,_.center.x=(Bt.x+Zt.x)/2,_.center.y=(Bt.y+Zt.y)/2,_}let T=0,x=0;for(let Bt=0;Bt<d.length;Bt++)T+=d[Bt].x,x+=d[Bt].y;T/=d.length,x/=d.length;const A=d.map(Bt=>Bt.x-T),U=d.map(Bt=>Bt.y-x);let ne=0,fe=0,Oe=0,we=0,Ze=0,it=0,lt=0;for(let Bt=0;Bt<A.length;Bt++){const Zt=A[Bt],nr=U[Bt],Jt=Zt*Zt,Rr=nr*nr;ne+=Jt,fe+=Rr,Oe+=Zt*nr,we+=Jt*Zt,Ze+=Rr*nr,it+=Zt*Rr,lt+=nr*Jt}const dt=.5*(we+it),Tt=.5*(Ze+lt),mt=ne*fe-Oe*Oe,Mt=(dt*fe-Tt*Oe)/mt,Pt=(ne*Tt-Oe*dt)/mt,Nt=(0,li.vW)(Mt+T,Pt+x);return{radius:Math.sqrt(Mt*Mt+Pt*Pt+(ne+fe)/d.length),center:Nt}}(_)}function nE(d){const _=HR(d);let T=0;return d.forEach(x=>{let A=oE(x,_),U=A-x.lastAngle;for(;U>Math.PI;)U-=2*Math.PI;for(;U<-Math.PI;)U+=2*Math.PI;A=x.lastAngle+U,x.lastAngle=A,T+=A-x.initialAngle}),T/=d.size||1,{angle:T,radius:_.radius,center:_.center}}function uN(d){const _=new Map;return d.forEach((T,x)=>_.set(x,T.event)),_}function oE(d,_){const T=d.event;return Math.atan2(T.y-_.center.y,T.x-_.center.x)}var GR;!function(d){d[d.Left=0]="Left",d[d.Middle=1]="Middle",d[d.Right=2]="Right",d[d.Back=3]="Back",d[d.Forward=4]="Forward",d[d.Undefined=-1]="Undefined"}(GR||(GR={}));var I2=v(84244);class dN extends nl.a{constructor(_=250,T=10,x=350,A=35,U=I2.m){super(!1),this._maximumDoubleClickDelay=_,this._maximumDoubleClickDistance=T,this._maximumDoubleTouchDelay=x,this._maximumDoubleTouchDistance=A,this._clock=U,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(_=>_.doubleClickTimer=(0,Qe.hw)(_.doubleClickTimer))}get hasPendingInputs(){return(0,El.oE)(this._pointerState,_=>null!=_.doubleClickTimer)}_clearDoubleClickTimer(_,T){const x=this._pointerState.get(_);x&&(x.doubleClickTimer=(0,Qe.hw)(x.doubleClickTimer),T&&this._click.emit(x.event.data,void 0,x.event.modifiers),this._pointerState.delete(_),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(_){const T=this._pointerState.get(_);1===T.pointerDownCount&&this._click.emit(T.event.data,void 0,T.event.modifiers),T.doubleClickTimer=null,this._pointerState.delete(_),this.refreshHasPendingInputs()}_getPointerId(_){const{pointerId:T,pointerType:x,button:A}=_.native;return"mouse"===x?`${T}:${A}`:`${x}`}_handleImmediateClick(_){const T=_.data,{pointerType:x}=T.native,A=this._getPointerId(T);if(!this._pointerState.has(A))return void this._startClick(_);const U=this._pointerState.get(A),{data:ne,modifiers:fe}=U.event,Oe="touch"===x?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;zR(ne,T)>Oe?(this._clearDoubleClickTimer(A,!0),this._startClick(_)):(this._clearDoubleClickTimer(A,!1),2===U.pointerDownCount&&this._doubleClick.emit(ne,void 0,fe))}_handlePointerDown(_){const T=Lg(_.data),x=this._pointerState.get(T);x&&(x.pointerDownCount+=1)}_startClick(_){const{data:T}=_,{native:{pointerType:x}}=T,A=Lg(T),ne=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(A),"touch"===x?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(A,{event:_,doubleClickTimer:ne,pointerDownCount:1}),this.refreshHasPendingInputs()}}class hN extends nl.a{constructor(_=250,T=10,x=350,A=35,U=I2.m){super(!1),this._maximumDoubleClickDelay=_,this._maximumDoubleClickDistance=T,this._maximumDoubleTouchDelay=x,this._maximumDoubleTouchDistance=A,this._clock=U,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(_=>{_.immediateDoubleClick&&_.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(_){const T=_.data,x=Lg(T);this._pointerState.has(x)||(this._pointerState.set(x,{downButton:T.native.button,immediateDoubleClick:null}),this.startCapturingPointer(T.native))}_handlePointerUp(_){const T=_.data,x=Lg(T),A=this._pointerState.get(x);if(A&&A.downButton===T.native.button){const U=A.immediateDoubleClick;if(U){U.timeoutHandle.remove();const ne="touch"===_.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;zR(U,_.data)>ne?this._startImmediateDoubleClick(_,A):(this._immediateDoubleClick.emit(_.data,void 0,U.modifiers),this._removeState(T))}else this._startImmediateDoubleClick(_,A)}}_startImmediateDoubleClick(_,T){T.immediateDoubleClick={x:_.data.x,y:_.data.y,modifiers:_.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(_.data),"touch"===_.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(_){const T=Lg(_);this._pointerState.delete(T),this.stopCapturingPointer(_.native),this.refreshHasPendingInputs()}}class pN extends nl.a{constructor(_=300,T=1.5,x=6,A=6,U=500,ne=I2.m){super(!1),this._maximumClickDelay=_,this._movementUntilMouseDrag=T,this._movementUntilPenDrag=x,this._movementUntilTouchDrag=A,this._holdDelay=U,this._clock=ne,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",fe=>{this._handlePointerLoss(fe,"pointer-up")}),this.registerIncoming("pointer-capture-lost",fe=>{this._handlePointerLoss(fe,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",fe=>{this._handlePointerLoss(fe,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(_=>{_.holdTimeout=(0,Qe.hw)(_.holdTimeout)}),super.onUninstall()}_handlePointerDown(_){const T=_.data,x=T.native.pointerId;let A=null;0===this._pointerState.size&&(A=this._clock.setTimeout(()=>{const ne=this._pointerState.get(x);ne&&(ne.isDragging||(this._pointerHold.emit(ne.previousEvent,void 0,_.modifiers),ne.holdEmitted=!0),ne.holdTimeout=null)},this._holdDelay)),this._pointerState.set(x,{startEvent:T,previousEvent:T,startTimestamp:_.timestamp,isDragging:!1,downButton:T.native.button,holdTimeout:A,modifiers:new Set}),this.startCapturingPointer(T.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(_)}_createPointerDragData(_,T,x){return{action:_,startEvent:T.startEvent,previousEvent:T.previousEvent,currentEvent:x}}_handlePointerMove(_){const T=_.data,A=this._pointerState.get(T.native.pointerId);A&&(A.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",A,T),void 0,A.modifiers):function aN(d,_){const T=_.x-d.x,x=_.y-d.y;return Math.sqrt(T*T+x*x)}(T,A.startEvent)>this._getDragThreshold(T.native.pointerType)&&this._startDragging(_),A.previousEvent=T)}_getDragThreshold(_){switch(_){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(_){const T=_.data,x=T.native.pointerId;this._pointerState.forEach(A=>{null!=A.holdTimeout&&(A.holdTimeout.remove(),A.holdTimeout=null),A.isDragging||(A.modifiers=_.modifiers,A.isDragging=!0,x===A.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",A,T)):this._pointerDrag.emit(this._createPointerDragData("start",A,A.previousEvent),_.timestamp))})}_handlePointerLoss(_,T){const x=_.data,A=x.native.pointerId,U=this._pointerState.get(A);U&&(null!=U.holdTimeout&&(U.holdTimeout.remove(),U.holdTimeout=null),U.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",U,"pointer-up"===T?x:U.previousEvent),void 0,U.modifiers):"pointer-up"===T&&U.downButton===x.native.button&&_.timestamp-U.startTimestamp<=this._maximumClickDelay&&!U.holdEmitted&&this._immediateClick.emit(x),this._pointerState.delete(A),this.stopCapturingPointer(x.native),0===this._pointerState.size&&this._moveHandle.pause())}}class _N{constructor(_){this._callbacks=_,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(_){const T=_.data,x=T.pointers.size;switch(T.action){case"start":this._currentCount=x,this._emitStart(_);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=x,this._emitStart(_);break;case"update":this._emitUpdate(_);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=x,this._emitStart(_);break;case"end":this._emitEnd(_),this._currentCount=0}this._previousEvent=_}_emitStart(_){this._startEvent=_,this._callbacks.condition?.(this._currentCount,_)&&this._callbacks.start(this._currentCount,_,this._startEvent)}_emitUpdate(_){this._callbacks.condition?.(this._currentCount,_)&&this._callbacks.update(this._currentCount,_,this._startEvent)}_emitEnd(_){this._callbacks.condition?.(this._currentCount,_)&&this._callbacks.end(this._currentCount,_,this._startEvent),this._startEvent=null}}class fN extends nl.a{constructor(_=20,T=40){super(!1),this._threshold=_,this._maxDelta=T,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new _N({start:(x,A)=>this._observeStart(x,A),update:(x,A,U)=>this._observeUpdate(x,A,U),end:(x,A)=>this._observeEnd(A)}),this.registerIncoming("drag",x=>this._dragEventSeparator.handle(x))}get failed(){return"failed"===this._state}_observeStart(_,T){1===_&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:T.data.button,buttons:T.data.buttons,pointerType:T.data.pointerType,timestamp:T.data.timestamp,pointers:T.data.pointers,pointer:T.data.pointer,angle:T.data.angle,radius:T.data.radius,center:T.data.center}),T.stopPropagation()),this._state=2===_?"ready":"failed"}_observeUpdate(_,T,x){if("failed"!==this._state&&2===_)return"active"===this._state?(this._vertical.emit({delta:T.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void T.stopPropagation()):void(this._checkMovementWithinLimits(T.data,x.data)?this._checkVerticalThresholdReached(T.data,x.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=T.data.center,this._artificalDrag.emit({action:"end",button:T.data.button,buttons:T.data.buttons,pointerType:T.data.pointerType,timestamp:T.data.timestamp,pointers:T.data.pointers,pointer:T.data.pointer,angle:T.data.angle,radius:T.data.radius,center:T.data.center}),this._vertical.emit({delta:T.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),T.stopPropagation()):this._state="failed")}_observeEnd(_){"active"===this._state&&(this._vertical.emit({delta:_.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",_.stopPropagation())}_checkMovementWithinLimits(_,T){let x=-1/0,A=1/0,U=-1/0,ne=1/0;for(const{x:mt,y:Mt}of T.pointers.values())x=Math.max(x,mt),A=Math.min(A,mt),U=Math.max(U,Mt),ne=Math.min(ne,Mt);let fe=-1/0,Oe=1/0,we=-1/0,Ze=1/0;for(const{x:mt,y:Mt}of _.pointers.values())fe=Math.max(fe,mt),Oe=Math.min(Oe,mt),we=Math.max(we,Mt),Ze=Math.min(Ze,Mt);const it=x-A,lt=U-ne,dt=fe-Oe,Tt=we-Ze;return Math.abs(_.center.x-T.center.x)<this._threshold&&Math.abs(dt-it)<=this._maxDelta&&Math.abs(Tt-lt)<=this._maxDelta}_checkVerticalThresholdReached(_,T){let x=Math.abs(_.center.y-T.center.y);return _.pointers.forEach((A,U)=>{const ne=T.pointers.get(U);x=Math.min(x,Math.abs(A.y-ne.y))}),x>=this._threshold}}let pu=class extends Ns.Z{constructor(){super(...arguments),this._handles=new Ji.Z}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(d){"pan"!==d&&"rotate"!==d||d===this._get("primaryDragAction")||(this._set("primaryDragAction",d),this._updateMode())}get mode(){return this._get("mode")}set mode(d){"default"!==d&&"pro"!==d||d===this._get("mode")||(this._set("mode",d),this._updateMode())}get hasPendingInputs(){return this._inputManager?.hasPendingInputs}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=(0,Qe.SC)(this._inputManager)}connect(){const d=this.view;this._source=new nN(this.view.surface,d.input);const _=[new hN,new pN,new dN,new cN(this.view.navigation),new fN],T=new Km.$({eventSource:this._source,recognizers:_});this._inputManager=T,T.installHandlers("prevent-context-menu",[new oN],Km.f.INTERNAL),this._modeDragPan=new jR(d,"primary"),this._modeDragRotate=new O2(d,"secondary",Xl.CENTER),this._modeDragZoom=new SF(d,"tertiary");T.installHandlers("navigation",[new $F(d),new Cj(d),new jF(d),new FF(d,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new NF(d),new XF(d,"p"),new YF(d,"n"),new O2(d,"primary",Xl.EYE,["b"]),new O2(d,"secondary",Xl.CENTER,["b"]),new jR(d,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new kF(d)],Km.f.INTERNAL),this.view.viewEvents.connect(T),this._updateMode(),this._handles.add((0,Ht.YP)(()=>this.view.navigation?.browserTouchPanEnabled,A=>{this._source.browserTouchPanningEnabled=!A},Ht.nn))}_updateMode(){const _=this.primaryDragAction,T=L2.get(this.mode).get(_);this._modeDragPan&&(this._modeDragPan.pointerAction=T.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=T.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=T.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};(0,Ve._)([(0,ke.Cb)()],pu.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({value:"pan"})],pu.prototype,"primaryDragAction",null),(0,Ve._)([(0,ke.Cb)({value:"default"})],pu.prototype,"mode",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],pu.prototype,"hasPendingInputs",null),(0,Ve._)([(0,ke.Cb)()],pu.prototype,"latestPointerType",null),(0,Ve._)([(0,ke.Cb)()],pu.prototype,"latestPointerLocation",null),(0,Ve._)([(0,ke.Cb)()],pu.prototype,"multiTouchActive",null),(0,Ve._)([(0,ke.Cb)()],pu.prototype,"_inputManager",void 0),pu=(0,Ve._)([(0,Wr.j)("esri.views.3d.input.SceneInputManager")],pu);const L2=new Map,U2=new Map,B2=new Map;U2.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),U2.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),B2.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),B2.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),L2.set("default",U2),L2.set("pro",B2);const mN=pu;var wo=v(77029);let Tc,$_,j2=!1,F2=!1,N2=!1,W2=!1,Bg=null;function KR(){Bg&&(Bg(),Bg=null)}function ZR(d,_,T,x,A){KR();const U=Tc.height,ne=$_;ne.beginPath(),ne.lineWidth=1,ne.strokeStyle=A,ne.moveTo(d,U-T),ne.lineTo(_,U-T),ne.stroke(),ne.lineTo(_,U-x),ne.stroke(),ne.lineTo(_,U-T),ne.stroke(),ne.lineTo(d,U-T),ne.stroke(),ne.lineTo(d,U-T),ne.stroke(),ne.closePath()}function EN(d,_){j2&&(_&&N2||!_&&W2)&&ZR(d.aabr[0],d.aabr[2],d.aabr[1],d.aabr[3],_?"green":"red")}var Go=v(79721),aE=v(17962),$R=v(80805);const Nu=(0,ir.c)(),Y_=(0,Tn.c)(),jg=(0,Tn.c)(),V2=(0,ir.c)(),bN=(0,gn.c)(),CN=(0,oo.c)(),z2=(0,yc.Ue)(),TN=(0,ir.c)(),MN=(0,Bs.Ue)();class PN{constructor(){this.aabr=(0,Bs.Ue)(),this.distance=0,this.culled=!1,this.visible=!1}}class ON{constructor(_,T,x={}){this.graphics3DGraphic=_,this.slicePlaneEnabled=T,this.info=x}}class xN{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class DN{}class SN{constructor(){this.sortArray=new wo.Z({allocator:_=>_||new DN})}}var Jl;!function(d){d[d.Idle=0]="Idle",d[d.Process=1]="Process",d[d.Sort=2]="Sort",d[d.Deconflict=3]="Deconflict",d[d.NumStates=4]="NumStates"}(Jl||(Jl={}));class YR{constructor(){this.camera=new $i.V,this.slicePlane=(0,nu.a)(),this.slicePlaneEnabled=!1}copyFrom(_){this.camera.copyFrom(_.camera),(0,nu.c)(_.slicePlane,this.slicePlane),this.slicePlaneEnabled=_.slicePlaneEnabled}}let X_=class extends Ns.Z{constructor(d){super(d),this._dirty=!1,this._runningViewState=new YR,this._state=Jl.Idle,this._graphics=new xN,this._iterators=new SN,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this._graphics.clear(),this._iterators=null}setDirty(){!this._dirty&&this._graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Jl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const d=this._state/Jl.NumStates;return this._dirty?.5*d:d}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(d){switch(this._state){case Jl.Idle:this._startUpdate(),d.madeProgress();case Jl.Process:if(this._state=Jl.Process,!this._processActiveGraphics(d))return;case Jl.Sort:if(this._state=Jl.Sort,!this._sortVisibleGraphics(d))return;case Jl.Deconflict:if(this._state=Jl.Deconflict,!this._deconflictVisibleGraphics(d))return;default:(function gN(d,_){if(!F2||!$_)return;KR();const T=$_;let x=0;for(let A=0;A<d.accBinsNumX;A++)for(let U=0;U<d.accBinsNumY;U++){const ne=d.accBins[A][d.accBinsNumY-1-U];x+=ne.length;const fe=A*d.accBinsSizeX,Oe=(A+1)*d.accBinsSizeX,we=U*d.accBinsSizeY,Ze=(U+1)*d.accBinsSizeY;T.fillText(ne.length.toFixed(),fe+5,we+15),ZR(fe,Oe,we,Ze,"blue")}T.fillText("total totalShownLabels: "+x,70,40),T.fillText("total visible labels: "+_.size,70,50),T.fillText("total numTests: "+d.accNumTests,70,30)})(this,this._graphics.visible),this._state=Jl.Idle,this.notifyChange("updating")}}modifyGraphics(d,_){d.forEach(_?T=>this.addToActiveGraphics(T):T=>this.removeFromActiveGraphics(T)),this.setDirty()}layerSupportsDeconfliction(d){if((0,Qe.Wi)(d)||"object3d"!==d.type)return!1;const _=d.stageObject;return 1===(_?_.geometryRecords.length:0)&&_.geometryRecords[0].material instanceof $R.A}_startUpdate(){(function yN(d){N2=Fo.Z.DECONFLICTOR_SHOW_VISIBLE,W2=Fo.Z.DECONFLICTOR_SHOW_INVISIBLE,j2=N2||W2,F2=Fo.Z.DECONFLICTOR_SHOW_GRID,Bg=null,j2||F2?Bg=()=>function vN(d){null==Tc&&(Tc=document.createElement("canvas"),Tc.setAttribute("id","canvas2d"),d.surface.parentElement.style.position="relative",d.surface.parentElement.appendChild(Tc));const{state:_}=d,{camera:T,pixelRatio:x}=_,{width:A,height:U}=T,fe=U*x;Tc.setAttribute("width",A*x+"px"),Tc.setAttribute("height",`${fe}px`),Tc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${A}px;height:${U}px`),$_=Tc.getContext("2d"),$_.clearRect(0,0,A,U),$_.font="12px Arial"}(d):Tc&&(Tc.parentElement.removeChild(Tc),Tc=null)})(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:d,fullHeight:_}=this._runningViewState.camera;this._initBins(d,_),this._resetIterators()}addToActiveGraphics(d){d.info[this.visibilityGroup]=new PN,this._graphics.active.set(d.graphics3DGraphic.graphic.uid,d),this.setDirty()}removeFromActiveGraphics(d){this._removeFromVisibleGraphics(d),function AN(d,_){const T=d.graphics3DGraphic;T.destroyed||T.clearVisibilityFlag(Go.P.DECONFLICTION,_)}(d,this.visibilityGroup),delete d.info[this.visibilityGroup],this._graphics.active.delete(d.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(d){this._graphics.visible.set(d.graphics3DGraphic.graphic.uid,d)}_removeFromVisibleGraphics(d){this._graphics.visible.delete(d.graphics3DGraphic.graphic.uid)}_processActiveGraphics(d){const _=this._ensureActiveGraphicsIterator(),T=(0,gi.a)(bN,this._runningViewState.camera.projectionMatrix),x="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?CN:null;let A=0;for((0,Qe.pC)(x)&&((0,pt.m)(x,ir.Z,this._runningViewState.camera.viewMatrix),x[3]=(0,En.Iu)(this.view.spatialReference).radius,A=(0,oo.d)(x,ir.Z));!d.done;){d.madeProgress();const U=_.next();if(!0===U.done)return this._resetActiveGraphicsIterator(),!0;const ne=U.value,fe=ne&&ne.info[this.visibilityGroup];fe&&(this._collectGraphics3DGraphics(ne,T,x,A),fe.culled?this._removeFromVisibleGraphics(ne):this._addToVisibleGraphics(ne))}return!1}_sortVisibleGraphics(d){const _=this._ensureSortGraphicsIterator();for(;!d.done;){const T=_.next();if(d.madeProgress(),!0===T.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(d){const _=this._ensureVisibleGraphicsIterator(),T=this.visibilityGroup===Go.E.LABEL;for(;!d.done;){d.madeProgress();const x=_.next();if(!0===x.done)return this._resetVisibleGraphicsIterator(),!0;const A=x.value,U=A.info[this.visibilityGroup];if(!U||U.culled)continue;const ne=A.graphics3DGraphic,fe=(!T||ne.isVisible())&&!this._isConflicted(A);fe&&this._addToBins(A),U.visible=fe,this._setGraphicVisibility(A,fe),EN(U,fe)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=XR(this._graphics.active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=XR(this._graphics.visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=function*RN(d,_,T){_.clear(),d.forEach((A,U)=>{const ne=_.pushNew();ne.id=U,ne.prio=A.info?-A.info[T].distance:Number.MAX_VALUE}),yield;const x=_.iterableSort((A,U)=>U.prio-A.prio);for(let A=x.next();!A.done;A=x.next())yield;_.forAll(A=>{const U=d.get(A.id);U&&(d.delete(A.id),d.set(A.id,U))}),_.clear()}(this._graphics.visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(d,_,T,x){const A=d.graphics3DGraphic;if(A.destroyed)return;const U=d.info[this.visibilityGroup];if(!A.isVisible(Go.E.GRAPHIC,Go.P.DECONFLICTION))return void(U.culled=!0);const ne=this.getGraphicsLayers(A);(0,Bs.cS)(U.aabr);let fe=null;for(const Oe of ne){if(!this.layerSupportsDeconfliction(Oe))continue;const we=Oe.stageObject.geometryRecords[0].material;if((0,Qe.Wi)(fe)){if(fe=this._getProjectionInfo(Oe,_,LN),fe.isOutsideScreen||this._isCulledBySlice(d,Nu)||(0,Qe.pC)(T)&&this._isCulledByHorizon(fe,T,x))return void(U.culled=!0);!Fo.Z.TESTS_DISABLE_OPTIMIZATIONS&&U.visible&&(fe.distance*=.7)}this._expandBoundingRect(U,Oe,we,fe)}(0,Qe.Wi)(fe)?U.culled=!0:(U.distance=fe.distance,U.culled=!1)}_getProjectionInfo(d,_,T){const x=this._runningViewState.camera,A=d.stageObject,U=A.geometryRecords[0],ne=U.material,fe=(0,oo.g)(A.boundingVolumeWorldSpace.bounds);(0,pt.m)(Nu,fe,x.viewMatrix);const Oe=U.geometry.vertexAttributes,we=Oe.get(Qi.T.NORMAL).data,Ze=Oe.get(Qi.T.AUXPOS1).data;return ne.applyShaderOffsetsView(Nu,we,A.transformation,Ze,x,T.scaleInfo,Nu),(0,Qo.s)(Y_,Nu[0],Nu[1],Nu[2],1),(0,Qo.t)(jg,Y_,x.projectionMatrix),(0,pt.g)(T.positionNDC,jg,1/jg[3]),ne.applyShaderOffsetsNDC(T.positionNDC,Ze,x,T.positionNDC,V2),T.distanceWithoutPolygonOffset=x.depthNDCToWorld(V2[2]),T.distance=V2[2]===T.positionNDC[2]?T.distanceWithoutPolygonOffset:x.depthNDCToWorld(T.positionNDC[2]),(0,Qo.s)(jg,T.positionNDC[0],T.positionNDC[1],T.positionNDC[2],1),(0,Qo.t)(Y_,jg,_),(0,Qo.b)(Y_,Y_,1/Y_[3]),(0,pt.s)(T.positionView,Nu[0],Nu[1],Nu[2]),T}_isCulledByHorizon(d,_,T){return(0,pt.c)(z2.direction,d.positionView),(0,pt.s)(z2.origin,0,0,0),!!(0,oo.i)(_,z2,TN)&&d.distanceWithoutPolygonOffset>T}_isCulledBySlice(d,_){return d.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&(0,nu.e)(this._runningViewState.slicePlane,_)}_expandBoundingRect(d,_,T,{positionNDC:x,scaleInfo:A}){const U=this._runningViewState.camera,ne=_.getScreenSize(wN);(0,aE.TU)(ne,A.factor,ne),ne[0]*=U.pixelRatio,ne[1]*=U.pixelRatio;const fe=(0,Bs.cv)(T.calculateRelativeScreenBounds(ne,A.factorAlignment.scale,MN),(0,xr.t7)(0,U.fullWidth,.5+.5*x[0]),(0,xr.t7)(0,U.fullHeight,.5+.5*x[1])),Oe=this.iconMarginFactor;if(0!==Oe){const we=Oe*Math.min((0,Bs.bf)(fe),(0,Bs.Cb)(fe));fe[0]-=we,fe[1]-=we,fe[2]+=we,fe[3]+=we}(0,Bs.jn)(d.aabr,fe,d.aabr)}_isConflicted(d){const _=d.graphics3DGraphic.graphic.uid,T=d.info[this.visibilityGroup];for(let x=Math.floor(T.aabr[0]/this._accBinsSizeX);x<=Math.floor(T.aabr[2]/this._accBinsSizeX);x++)if(!(x<0||x>=this._accBinsNumX))for(let A=Math.floor(T.aabr[1]/this._accBinsSizeY);A<=Math.floor(T.aabr[3]/this._accBinsSizeY);A++){if(A<0||A>=this._accBinsNumY)continue;const U=this._accBins[x][A];for(let ne=0;ne<U.length;ne++){const fe=U.data[ne],Oe=fe.info[this.visibilityGroup];if(Oe&&Oe.visible&&fe.graphics3DGraphic.graphic.uid!==_&&(this.accNumTests++,(0,Bs.kK)(Oe.aabr,T.aabr)))return!0}}return!1}_initBins(d,_){if(null==this._accBins){this._accBins=[];for(let T=0;T<this._accBinsNumX;T++){this._accBins.push([]);const x=this._accBins[this._accBins.length-1];for(let A=0;A<this._accBinsNumY;A++)x.push(new wo.Z)}}else for(let T=0;T<this._accBinsNumX;T++)for(let x=0;x<this._accBinsNumY;x++)this._accBins[T][x].clear();this._accBinsSizeX=d/this._accBinsNumX,this._accBinsSizeY=_/this._accBinsNumY,this.accNumTests=0}_addToBins(d){const _=d.info[this.visibilityGroup],T=Math.floor(_.aabr[0]/this._accBinsSizeX),x=Math.floor(_.aabr[2]/this._accBinsSizeX),A=Math.floor(_.aabr[1]/this._accBinsSizeY),U=Math.floor(_.aabr[3]/this._accBinsSizeY);for(let ne=T;ne<=x;ne++)if(!(ne<0||ne>=this._accBinsNumX))for(let fe=A;fe<=U;fe++)fe<0||fe>=this._accBinsNumY||this._accBins[ne][fe].push(d)}_setGraphicVisibility(d,_){const T=d.graphics3DGraphic;T.destroyed||(T.setVisibilityFlag(Go.P.DECONFLICTION,_,this.visibilityGroup),this.visibilityGroup===Go.E.LABEL&&this.view.labeler.setLabelGraphicVisibility(T,_))}};function*XR(d){if(Map.prototype.entries){const _=d.entries();for(let T=_.next();!T.done;T=_.next())yield T.value[1]}else yield*d.values()}(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],X_.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],X_.prototype,"updating",null),X_=(0,Ve._)([(0,Wr.j)("esri.views.3d.layers.graphics.Deconflictor")],X_);const wN=(0,un.a)(),LN=new class IN{constructor(){this.positionView=(0,ir.c)(),this.positionNDC=(0,ir.c)(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const _=this.positionNDC;return _[0]<-1||_[1]<-1||_[2]<-1||_[0]>=1||_[1]>=1}};let lE=class extends X_{constructor(d){super(d),this.visibilityGroup=Go.E.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(d){if(this.parent.running)return;const _=performance.now();(d.state===Lu.n.IDLE||_-this._lastDeconfliction>2e3)&&(super.runTask(d),this.state===Jl.Idle&&(this._lastDeconfliction=_))}enabledChanged(d,_){this.modifyGraphics(_,d.labelsEnabled)}getGraphicsLayers(d){return d.labelGraphics}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],lE.prototype,"parent",void 0),lE=(0,Ve._)([(0,Wr.j)("esri.views.3d.layers.graphics.LabelDeconflictor")],lE);let H2=class extends X_{constructor(){super(...arguments),this._handles=new Ji.Z,this._contexts=new Map,this._viewState=new YR,this.visibilityGroup=Go.E.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([(0,Ht.YP)(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),(0,Ht.YP)(()=>this.view?.map?.ground?.opacity,(d,_)=>{1!==d&&1!==_||this.setDirty()}),(0,Ht.YP)(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ht.nn)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Fn.T8.GRAPHICS_DECONFLICTOR,this),this._labels=new lE({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(d){this._iconMarginFactor=d,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(d){super.runTask(d),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(d,_){const T=!(this._graphicSupportsDeconfliction(_)&&G2(d));_.setVisibilityFlag(Go.P.DECONFLICTION,T,Go.E.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const d=this.view?this.view.slicePlane:null;(0,Qe.pC)(d)&&(0,nu.t)(d,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=(0,Qe.pC)(d)}_slicePlaneChanged(){(0,El.oE)(this._contexts,(d,_)=>_.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(d){let _=this._contexts.get(d);return null==_&&(_=new Map,this._contexts.set(d,_),this.setDirty()),{addGraphic:T=>this._addGraphic(d,_,T),removeGraphic:T=>this._removeGraphic(_,T),labelingInfoChange:()=>this._labels.enabledChanged(d,_),featureReductionChange:()=>this.enabledChanged(d,_),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(d,_),clear:()=>_.forEach(T=>this._removeGraphic(_,T.graphics3DGraphic))}}removeGraphicsOwner(d){const _=this._contexts.get(d);_&&(_.forEach(T=>this._removeGraphic(_,T.graphics3DGraphic)),this._contexts.delete(d),this.setDirty())}_addGraphic(d,_,T){const x=T.graphic.uid,A=new ON(T,d.symbolCreationContext.slicePlaneEnabled);_.set(x,A),G2(d)&&this.addToActiveGraphics(A),d.labelsEnabled&&this._labels.addToActiveGraphics(A)}_removeGraphic(d,_){const T=_.graphic.uid,x=d.get(T);x&&(this.removeFromActiveGraphics(x),this._labels.removeFromActiveGraphics(x),d.delete(T),this.setDirty())}enabledChanged(d,_){const T=G2(d);T||function BN(d){const _=d.graphics3DGraphics;_&&_.forEach(T=>T.clearVisibilityFlag(Go.P.DECONFLICTION))}(d),this.modifyGraphics(_,T)}_slicePlaneEnabledChanged(d,_){const T=d.symbolCreationContext.slicePlaneEnabled;_.forEach(x=>x.slicePlaneEnabled=T),this.setDirty()}getGraphicsLayers(d){return d.graphics}_graphicSupportsDeconfliction(d){if(d.isDraped)return!1;const _=d.graphics;if(!_||!_.length)return!1;for(const T of _)if(this.layerSupportsDeconfliction(T))return!0;return!1}};function G2(d){const _=d.layer;return!(!_||!_.featureReduction||"selection"!==_.featureReduction.type)}H2=(0,Ve._)([(0,Wr.j)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],H2);var jN=v(84786),FN=v(22445),NN=v(9824),WN=v(18170),VN=v(23641),zN=v(21439),HN=v(13939);function K2(d){return d instanceof HN.Z?d.graphics3DSymbol:d instanceof zN.Z?d:null}const Fg=Us.Z.getLogger("esri.views.3d.layers.graphics.labelPlacement");function GN(d){const _=function qN(d){const _=d.labelClass.labelPlacement,{labelSymbol:T,graphics3DGraphic:x}=d,A=K2(x.graphics3DSymbol),U=(0,Qe.yw)(A,fe=>"point-3d"===fe.symbol.type?fe.symbol:null),ne=_u[_]||cE(d);return(0,Qe.pC)(U)&&U.supportsCallout()&&U.hasVisibleVerticalOffset()&&!x.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:JR(U.verticalOffset),anchor:null,normalizedOffset:null}:T&&T.hasVisibleVerticalOffset()&&((0,Qe.Wi)(U)||!U.supportsCallout()||!U.verticalOffset||x.isDraped)?function QN(d){return"above-center"===d}(ne.placement)?{placement:"above-center",verticalOffset:JR(T.verticalOffset),anchor:"bottom",normalizedOffset:[0,ne.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(Fg.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+_+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}(d);if((0,Qe.Wi)(_))return null;const T=function KN(d,_){if(_.anchor)return _;const T=d.labelClass.labelPlacement,x=_u[T],A=x||cE(d);return T&&!x&&Fg.warnOncePerTick(`the requested label placement '${T}' is currently unsupported in SceneView.`),function ZN(d,_){const T=_.graphics3DGraphic.graphic.geometry;if((0,Qe.Wi)(T))return null;if((0,Qe.pC)(_.disablePlacement))return _.labelClass.labelPlacement?(Fg.warnOncePerTick(kR(d.placement,_.disablePlacement.logEntityDescription)),cE(_)):d;const x=T.type;switch(x){case"polyline":case"polygon":case"extent":case"multipoint":if(_.labelClass.labelPlacement)return Fg.warnOncePerTick(kR(d.placement,`'${x}' geometries`)),cE(_);break;case"point":case"mesh":return d}return d}(A,d)}(d,_);if((0,Qe.Wi)(T))return null;const A=!!_.hasLabelVerticalOffset;return function $N(d,_,T){const x=T.graphics3DGraphic.graphic.geometry;if((0,Qe.Wi)(x))return null;switch(x.type){case"point":!function XN(d,_,T){const x=Z2(T);if((0,Qe.Wi)(x))return;const A=T.graphics3DGraphic.graphics[0];switch((0,Qe.pC)(A)?A.getCenterObjectSpace(d.translation):(0,pt.s)(d.translation,0,0,0),x.type){case"icon":case"text":!function kN(d,_,T,x){const{graphics3DGraphic:A}=T,U=(0,Qe.pC)(x)?x.getScreenSize():null;if(!A.isDraped&&(0,Qe.pC)(U)){const ne=function JN(d,_=eW){const{graphics3DGraphic:T}=d,x=T.graphics[0],A=(0,Qe.pC)(x)?x.stageObject.geometryRecords[0].material:null;if(A&&A instanceof $R.A){const U=A.parameters.anchorPosition;_[0]=2*(U[0]-.5),_[1]=2*(U[1]-.5)}else _[0]=0,_[1]=0;return _}(T);Ng[0]=U[0]/2*(_.normalizedOffset[0]-ne[0]),Ng[1]=U[1]/2*(_.normalizedOffset[1]-ne[1]),d.screenOffset[0]=Ng[0],d.hasLabelVerticalOffset?(d.centerOffset[1]=Ng[1],d.centerOffsetUnits="screen"):d.screenOffset[1]=Ng[1]}else d.hasLabelVerticalOffset||"center"===d.anchor||(_u[T.labelClass.labelPlacement]&&Fg.warnOncePerTick(`the requested placement '${_.placement}' is currently unsupported for draped graphics`),d.anchor="center")}(d,_,T,A);break;case"object":$2(d,_,A)}}(d,_,T);break;case"polygon":!function YN(d,_,T){const x=Z2(T);if(!(0,Qe.Wi)(x))switch(x.type){case"extrude":{const A=T.graphics3DGraphic.graphics[0];(0,Qe.pC)(A)?(A.getBoundingBoxObjectSpace(Wg),(0,fo.be)(Wg,d.translation),d.translation[2]=(0,fo.Cb)(Wg)/2):(0,pt.s)(d.translation,0,0,0),$2(d,_,A);break}}}(d,_,T);break;case"mesh":$2(d,_,T.graphics3DGraphic.graphics[0])}return d}({anchor:T.anchor,verticalOffset:_.verticalOffset,screenOffset:(0,un.a)(),centerOffset:(0,Tn.f)(0,0,0,-1),centerOffsetUnits:"world",translation:(0,ir.c)(),elevationOffset:0,hasLabelVerticalOffset:A},T,d)}function Z2(d){const T=K2(d.graphics3DGraphic.graphics3DSymbol);return(0,Qe.pC)(T)?T.symbol.symbolLayers.getItemAt(0):null}function kR(d,_){return`the requested label placement '${d}' is currently unsupported for ${_} in SceneView.`}function cE(d){const _=d.graphics3DGraphic.graphic.geometry;if((0,Qe.Wi)(_))return null;switch(_.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const T=Z2(d);return(0,Qe.pC)(T)&&"extrude"===T.type?_u["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return _u["above-center"];default:return}}function $2(d,_,T){const x=(0,Qe.pC)(T)?T.getBoundingBoxObjectSpace(Wg):Wg,A=(0,ir.f)(x[3]-x[0],x[4]-x[1],x[5]-x[2]),U=Math.sqrt(A[0]*A[0]+A[1]*A[1]);d.centerOffset[0]=U/2*_.normalizedOffset[0];const ne=d.translation[2],fe=A[2]/2*_.normalizedOffset[1];d.translation[2]=0,d.elevationOffset=ne+fe;const Oe=(0,pt.l)(A);d.centerOffset[2]=Oe/2*_.normalizedOffset[2]}function JR(d){const{screenLength:_,minWorldLength:T,maxWorldLength:x}=d;return{screenLength:_,minWorldLength:T,maxWorldLength:x}}const _u={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},QR={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const d in QR){const T=_u[d];QR[d].forEach(x=>{_u[x]=T})}Object.freeze&&(Object.freeze(_u),Object.keys(_u).forEach(d=>{Object.freeze(_u[d]),Object.freeze(_u[d].normalizedOffset)}));const Ng=[0,0],eW=[0,0],Wg=(0,fo.Ue)();var uE=v(75688);class qR{constructor(_){this._stage=_,this._materials=new Map}get(_){return this._materials.get(_)}add(_,T){this._materials.set(_,T),this._stage.add(T)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var tW=v(6169),rW=v(65542),dE=v(86236),Y2=v(24425),sW=v(39782);let Vg=class extends Ns.Z{constructor(d){super(d),this.type=Y2.U.Texture,this.id=(0,dE.D)(),this.events=new Va.Z,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const d=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(d),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=(0,Qe.M2)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(d){return{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,flipped:!0,samplingMode:xt.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:d.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(d){return(0,Qe.pC)(this._glTexture)||(this._glTexture=new Ro.x(d,this._createDescriptor(d),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Fn.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=(0,Qe.hw)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,Qe.M2)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const d=document.createElement("canvas");return d.setAttribute("id","canvas2d"),d.setAttribute("style","display:none"),d.setAttribute("width",512..toString()),d.setAttribute("height",512..toString()),d}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(d=512){this._atlas={size:{width:d,height:d},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(d,_){let T=Math.max(d,_);return T+=256,T=(0,xr.Sf)(T),T=Math.min(T,4096),T}_resizeAtlas(d,_){_=_||d;const T=this._atlas;T.size.width=d,T.size.height=_,(0,Qe.pC)(this._glTexture)&&this._glTexture.resize(d,_),this._update2DCanvasSize()}_resetAtlasCursor(){const d=this._atlas;d.cursor.x=zg,d.cursor.y=zg+ew,d.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const d=this._atlas;return(d.cursor.x+d.cursor.y*d.size.width)/(d.size.width*d.size.height)}_getExpectedAtlasUsage(){const d=this._elementsToRemove.size,_=this._elementsToAddOrUpdate.size,T=this._elements.size;return this._getAtlasUsage()/T*(T+_-d)}_addAtlasElement(d,_,T,x){const A=this._atlas,{renderedWidth:U,renderedHeight:ne,displayWidth:fe,displayHeight:Oe}=d.textRenderer;d.placement.offset.x=A.cursor.x,d.placement.offset.y=A.cursor.y,d.placement.size.width=U,d.placement.size.height=ne,d.placement.size.displayWidth=fe,d.placement.size.displayHeight=Oe,d.placement.uvMinMax=[d.placement.offset.x/A.size.width,1-(d.placement.offset.y+ne)/A.size.height,(d.placement.offset.x+U)/A.size.width,1-d.placement.offset.y/A.size.height],A.cursor.x+=T,A.lineHeight=Math.max(A.lineHeight,x),this._elements.set(_,d)}_removeAtlasElement(d){if(d&&this._elements.has(d.textId)){const _=d.placement.offset,T=d.placement.size;this._ctx.clearRect(_.x,_.y,T.width,T.height),this._elements.delete(d.textId)}}_ensureStageObjects(d){const _=this._stageObjects.get(d);if(_)return _;const T=new Set;return this._stageObjects.set(d,T),T}_addStageObject(d,_){this._ensureStageObjects(d).add(_)}_removeStageObject(d,_){const T=this._stageObjects.get(d);T&&T.delete(_)&&(_.geometries[0].vertexAttributes.get(Qi.T.SIZE).data=[0,0],_.geometryVertexAttrsUpdated(_.geometryRecords[0]))}_processAddition(d,_){const T=this._atlas,x=d.textId,ne=d.textRenderer.renderedWidth+zg,fe=d.textRenderer.renderedHeight+zg+ew;if(T.cursor.x+ne<T.size.width&&T.cursor.y+fe<T.size.height)this._addAtlasElement(d,x,ne,fe),this._elementsToRender.set(x,d),this._elementsToAddOrUpdate.delete(x);else{if(!(T.cursor.y+fe+T.lineHeight<T.size.height)){const Oe=this._getExpectedAtlasUsage(),we=Oe>.85&&T.size.width<4096;return we&&this._resizeAtlas(2*T.size.width,2*T.size.height),!_||!we&&Oe>.95&&4096===T.size.width?(this._processRemovals(),k_.OK):(this._repack(),k_.REPACK)}T.cursor.x=zg,T.cursor.y+=T.lineHeight,T.lineHeight=0,this._addAtlasElement(d,x,ne,fe),this._elementsToRender.set(x,d),this._elementsToAddOrUpdate.delete(x)}return k_.OK}_processRemovals(){this._elementsToRemove.forEach((d,_)=>{const T=this._stageObjects.get(_);T&&0!==T.size||this._removeAtlasElement(d),T&&0===T.size&&this._stageObjects.delete(_)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((d,_)=>{d.rendered=!1,this._elementsToAddOrUpdate.set(_,d)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(d){this._ctx.clearRect(d.placement.offset.x,d.placement.offset.y,d.placement.size.width,d.placement.size.height),d.textRenderer.render(this._ctx,d.placement.offset.x,d.placement.offset.y);const _=this._stageObjects.get(d.textId);_&&_.forEach(T=>{T.geometries[0].vertexAttributes.get(Qi.T.UV0).data=new Float32Array(d.placement.uvMinMax),T.geometries[0].vertexAttributes.get(Qi.T.SIZE).data=[d.placement.size.displayWidth,d.placement.size.displayHeight],T.geometryVertexAttrsUpdated(T.geometryRecords[0])}),d.rendered=!0}get running(){return this.updating}runTask(d,_=!0){if(!this._glTexture)return;let T=!1;if((0,El.oE)(this._elementsToAddOrUpdate,(A,U)=>{const ne=this._elements.get(U);if(ne&&ne.rendered){const fe=this._stageObjects.get(U);return fe&&fe.forEach(Oe=>{const we=Oe.geometries[0].vertexAttributes,Ze=this._elements.get(U);we.get(Qi.T.UV0).data=new Float32Array(Ze.placement.uvMinMax),we.get(Qi.T.SIZE).data=new Float32Array([Ze.placement.size.displayWidth,Ze.placement.size.displayHeight]),Oe.geometryVertexAttrsUpdated(Oe.geometryRecords[0])}),this._elementsToAddOrUpdate.delete(U),!1}return this._processAddition(this._elementsToAddOrUpdate.get(U),_)===k_.REPACK&&(T=!0,!0)}),T)return void this.runTask(Fn.G5,!1);let x=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),(0,El.oE)(this._elementsToRender,(A,U)=>(this._processRenderingRequest(A),this._elementsToRender.delete(U),x=!0,d.madeProgress(),d.done)),x&&(0,Qe.pC)(this._glTexture)&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&sW.y.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(d,_){const T=d.key;this._elementsToAddOrUpdate.has(T)||this._elementsToAddOrUpdate.set(T,{textId:T,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:d,rendered:!1}),this._addStageObject(T,_),this._elementsToRemove.delete(T),this.setDirty()}removeTextTexture(d,_){const T=d.key;this._elementsToRemove.set(T,this._elements.get(T)),this._removeStageObject(T,_)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(0===this._elements.size)return;const d=[];this._elements.forEach((T,x)=>d.push({element:T,key:x}));let _=!0;for(let T=0;T<d.length-1;T++)if(d[T].key.localeCompare(d[T+1].key)>0){_=!1;break}if(!_||this._elementsToRemove.size){d.sort((T,x)=>T.key.localeCompare(x.key)),this._elements.clear();for(const{element:T,key:x}of d)this._elements.set(x,T);this._repack(),this.setDirty()}}get test(){const{_elements:d,_stageObjects:_,_elementsToRemove:T,_atlas:x}=this,A=this;return{elements:d,stageObjects:_,elementsToRemove:T,atlas:x,_resizeAtlas:(U,ne)=>A._resizeAtlas(U,ne),run:(U,ne)=>A.runTask(U,ne)}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Vg.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Vg.prototype,"updating",void 0),Vg=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Vg);const zg=2,ew=2;var k_;!function(d){d[d.OK=0]="OK",d[d.REPACK=1]="REPACK"}(k_||(k_={}));var Hg=v(34103);let p0=class extends Ns.Z{constructor(d){super(d),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ji.Z,this._handles.add([(0,Ht.YP)(()=>this.view.state?.camera,()=>this.setDirty()),(0,Ht.YP)(()=>this.view.state?.pixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Fn.T8.LABELER,this)]),this._textTextureAtlas=new Vg({view:this.view}),this._hudMaterialCollection=new qR(this.view._stage),this._calloutMaterialCollection=new qR(this.view._stage)}dispose(){this._handles=(0,Qe.SC)(this._handles),this._textTextureAtlas=(0,Qe.M2)(this._textTextureAtlas),this._hudMaterialCollection=(0,Qe.M2)(this._hudMaterialCollection),this._calloutMaterialCollection=(0,Qe.M2)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(d){d.labels.forEach((_,T)=>{this._labels.set(T,_),_.graphics3DGraphic.setVisibilityFlag(Go.P.USER_SETTING,!0,Go.E.LABEL)}),d.active=!0}_deactivateLabelingContext(d){d.labels.forEach((_,T)=>{_.graphics3DGraphic.setVisibilityFlag(Go.P.USER_SETTING,!1,Go.E.LABEL),this.setLabelGraphicVisibility(_.graphics3DGraphic,!1),this._labels.delete(T)}),d.active=!1}_addLabelTextureToAtlas(d){for(const _ of d.graphics3DGraphic.labelGraphics){if(!_._labelClass)continue;const T=d.textTextureResources.textRenderers[_._labelIndex];(0,Qe.pC)(T)&&this._textTextureAtlas.addTextTexture(T,_.stageObject)}d.rendered=!0}_removeLabelTextureFromAtlas(d){for(const _ of d.graphics3DGraphic.labelGraphics){if(!_._labelClass)continue;const T=d.textTextureResources.textRenderers[_._labelIndex];(0,Qe.pC)(T)&&this._textTextureAtlas.removeTextTexture(T,_.stageObject)}d.rendered=!1}get running(){return this.view.ready&&(this._dirty||this._textTextureAtlas?.updating||this.deconflictor.running)}runTask(d){this._updateLabels(d),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(d)}_updateLabels(d){if(this._dirty){this._dirty=!1;for(const _ of this._labelingContexts)if(oW(_)){if(!tw(_)){if(aW(_)){this._deactivateLabelingContext(_);continue}if(this._createLabelClassContext(_),J2(_)){this._dirty=!0;continue}if(!tw(_))continue}(0,El.oE)(_.labelsToInitialize,(T,x)=>(this._ensureGraphics3DResources(T)&&(this._labels.set(x,T),this.deconflictor.setDirty(),d.madeProgress()),(T.visible&&T.textTextureResources.initialized||!T.visible&&T.hasGraphics3DResources)&&(_.labelsToInitialize.delete(x),d.madeProgress()),d.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(_=>this._removeLabelTextureFromAtlas(_)),this._labelsToAdd.forEach(_=>this._addLabelTextureToAtlas(_)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}_createLabelClassContextAsync(d){var _=this;return(0,kr.Z)(function*(){const T=d.labelClassAbortController.signal;yield d.layer.when(),(0,ws.k_)(T),d.scaleVisibility&&d.scaleVisibility.updateScaleRangeActive();const x=d.graphics3DCore,A=x.layer,U=A.labelingInfo&&A.labelingInfo.filter(Oe=>!!Oe.symbol);if(!U||0===U.length)return;const ne=new Array(U.length);let fe=!1;yield(0,wu.Ed)(U,function(){var Oe=(0,kr.Z)(function*(we,Ze){const it=we.symbol,lt=K2(x.getOrCreateGraphics3DSymbol(it));if((0,Qe.Wi)(lt))return void Us.Z.getLogger(_.declaredClass).error("Failed to create Graphics3DSymbol for label");yield lt.load(),(0,ws.k_)(T);let dt=null;(0,NN.Pd)(it)&&it.hasVisibleCallout()&&(dt=(0,WN.S)(it,x.symbolCreationContext),yield dt.load(),(0,ws.k_)(T));const Tt=yield(0,wu.q6)((0,FN.createLabelFunction)(we,d.layer.fieldsIndex,_.view.spatialReference));if((0,ws.k_)(T),!0===Tt.ok){const mt=yield _._createTextRenderParameters(lt.symbol);(0,ws.k_)(T),ne[Ze]={labelClass:we,labelFunction:Tt.value,graphics3DSymbol:lt,graphics3DCalloutSymbolLayer:dt,calloutSymbolLayerIndex:0,textRenderParameters:mt}}else Us.Z.getLogger(_.declaredClass).error(`Label expression failed to evaluate: ${Tt.error}`),fe=!0});return function(we,Ze){return Oe.apply(this,arguments)}}()),(0,ws.k_)(T),fe||(d.labelClassContexts=ne)})()}_createLabelClassContext(d){var _=this;return(0,kr.Z)(function*(){return d.labelClassPromise||(d.labelClassPromise=_._createLabelClassContextAsync(d).catch(T=>{if((0,ws.D_)(T))throw T;d.labelClassContexts=null}).then(()=>{d.labelClassAbortController=null,_.notifyChange("updating")}).catch(()=>{}),_.notifyChange("updating")),d.labelClassPromise})()}_createTextRenderParameters(d){var _=this;return(0,kr.Z)(function*(){const T=d.symbolLayers.getItemAt(0);return T&&"text"===T.type?rW.V.fromSymbol(T,_.view.state.pixelRatio):null})()}_destroyLabelClassContext(d){for(const T of d.labelClassContexts)--T.graphics3DSymbol.referenced,T.graphics3DSymbol=null;const _=d.labelClassAbortController;d.labelClassAbortController=new AbortController,_&&_.abort(),d.labelClassContexts=[],d.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(d,_,T,x,A){const U={text:d.text,centerOffset:T.centerOffset,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,centerOffsetUnits:T.centerOffsetUnits,horizontalPlacement:(0,uE.zi)(T.anchor),verticalPlacement:(0,uE.EP)(T.anchor),verticalOffset:T.verticalOffset,debugDrawLabelBorder:Fo.Z.LABELS_SHOW_BORDER,displayWidth:d.displayWidth,displayHeight:d.displayHeight};return zh.graphic=_,zh.renderingInfo=null,zh.layer=x,A.createLabel(zh,U,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(d,_,T,x,A){const U={symbol:_,translation:x.translation,elevationOffset:x.elevationOffset,screenOffset:x.screenOffset,centerOffset:x.centerOffset,centerOffsetUnits:x.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return zh.graphic=d,zh.renderingInfo=U,zh.layer=A,T.createGraphics3DGraphic(zh)}_ensureGraphics3DResources(d){if(d.hasGraphics3DResources)return!1;const _=d.graphics3DGraphic;if(_.destroyed)return!1;this._ensureTextTextureResources(d);const{textTextureResources:T}=d,x=d.labelingContext,A=x.labelClassContexts;if(!A||0===A.length||!x.emptySymbolLabelSupported&&0===_.graphics.length)return!1;let U=!1;const ne=_.graphic,fe=x.layer,Oe=(0,Gl.C6)(x.layer),we=this.view._stage;for(let Ze=0;Ze<A.length;Ze++){const it=T.textRenderers[Ze],lt=T.labelPlacements[Ze];if((0,Qe.Wi)(it)||(0,Qe.Wi)(lt))continue;const dt=A[Ze],Tt=dt.graphics3DSymbol,mt=Tt.symbol&&"label-3d"===Tt.symbol.type?Tt.symbol:null,Mt=Tt.symbolLayers[0];if(!Mt)continue;Mt.setElevationInfoOverride(x.elevationInfoOverride);const Pt=this._createTextSymbolGraphic(it,ne,lt,fe,Mt);if(!Pt)return!1;Pt._labelClass=dt.labelClass,Pt._labelIndex=Ze,_.addLabelGraphic(Pt,we,x.stageLayer),_.setVisibilityFlag(Go.P.USER_SETTING,Oe,Go.E.LABEL),_.clearVisibilityFlag(Go.P.SCALE_RANGE,Go.E.LABEL),_.setVisibilityFlag(Go.P.DECONFLICTION,!1,Go.E.LABEL),U=!0;const Nt=dt.graphics3DCalloutSymbolLayer;if(Nt&&lt.hasLabelVerticalOffset){Nt.setElevationInfoOverride(x.elevationInfoOverride);const Bt=this._createLineCalloutGraphic(ne,mt,Nt,lt,fe);(0,Qe.pC)(Bt)&&(dt.calloutSymbolLayerIndex=_.labelGraphics.length,_.addLabelGraphic(Bt,we,x.stageLayer))}break}return x.scaleVisibility&&U&&x.scaleVisibility.updateGraphicLabelScaleVisibility(_),d.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(d){const _=d.labelingContext.labelClassContexts;for(const T of d.graphics3DGraphic.labelGraphics)null!=T._labelClass&&_[T._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(T);d.graphics3DGraphic.clearLabelGraphics(),d.hasGraphics3DResources=!1}_ensureTextTextureResources(d){const{textTextureResources:_}=d;if(_.initialized)return;const T=d.labelingContext,x=T.labelClassContexts;if(!x||0===x.length)return;const A=d.graphics3DGraphic.graphic;for(let U=0;U<x.length;U++){const ne=x[U];if(_.textRenderers[U]=null,_.labelPlacements[U]=null,!ne.textRenderParameters)continue;const fe=ne.labelFunction;let Oe;if("arcade"===fe.type)try{const Pt=fe.needsHydrationToEvaluate()?(0,jN.mW)(A,T.layer):A;Oe=fe.evaluate(Pt)}catch{Oe=null}else Oe=fe.evaluate(A);if((0,Qe.Wi)(Oe)||""===Oe||/^\s+$/.test(Oe))continue;const we=ne.graphics3DSymbol,Ze=we.symbol&&"label-3d"===we.symbol.type?we.symbol:null;if(!we.symbolLayers[0])continue;const Tt=GN({graphics3DGraphic:d.graphics3DGraphic,labelSymbol:Ze,labelClass:ne.labelClass,disablePlacement:T.disablePlacement});if((0,Qe.Wi)(Tt))continue;const mt=(0,uE.zi)(Tt.anchor),Mt=(0,uE.mq)(mt);_.textRenderers[U]=new tW.tV(Oe,Mt,ne.textRenderParameters),_.labelPlacements[U]=Tt}_.initialized=!0}_destroyTextTextureResources(d){const{textTextureResources:_}=d;_.initialized=!1,_.textRenderers=[],_.labelPlacements=[]}_addGraphic(d,_){const T={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:d,graphics3DGraphic:_,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},x=_.graphic.uid;d.labels.set(x,T),d.labelsToInitialize.set(x,T),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(d,_){const T=_.graphic.uid,x=d.labels.get(T);x&&(this._destroyGraphic(x,T),d.labels.delete(T),d.labelsToInitialize.delete(T),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(d,_){this._labels.has(_)&&(this._labels.delete(_),this._labelsToAdd.delete(_),this._labelsToRemove.delete(_)),d.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(d),this._destroyTextTextureResources(d)),d.hasGraphics3DResources&&this._destroyGraphics3DResources(d)}_labelingInfoChange(d,_){var T=this;return(0,kr.Z)(function*(){if(!_)return T._visibilityInfoChange(d),T._resetLabels(d),T._createLabelClassContext(d);for(const x of _){const A=d.labels.get(x);A&&(T._removeGraphic(d,A.graphics3DGraphic),T._addGraphic(d,A.graphics3DGraphic))}})()}_globalPropertyChanged(d,_){for(const T of _.labelClassContexts){const x=new Map;_.labels.forEach(U=>{const ne=U.graphics3DGraphic;x.set(ne.graphic.uid,ne)});const A=U=>U.labelGraphics[0];(0,Qe.Wg)(T.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(d,x,A),T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(d,x,ne=>ne.labelGraphics[T.calloutSymbolLayerIndex])}}_visibilityInfoChange(d){const _=d.layer.labelsVisible;_&&!d.active&&this._activateLabelingContext(d),!_&&d.active&&this._deactivateLabelingContext(d),this.setDirty()}_resetAllLabels(){for(const d of this._labelingContexts)this._resetLabels(d)}_resetLabels(d){d.labels.forEach((_,T)=>{this._destroyGraphic(_,T),_.visible=!1,_.rendered=!1,d.labelsToInitialize.set(T,_)}),this._destroyLabelClassContext(d),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(d){for(const _ of this._labelingContexts)if(_.graphics3DCore===d)return _;return null}addGraphicsOwner(d,_,T){const x=T&&T.emptySymbolLabelSupported||!1,A=T&&T.elevationInfoOverride||null,U=T&&T.disablePlacement||null;if(this._findLabelingContext(d))return;const ne=d.layer,fe={graphics3DCore:d,layer:ne,scaleVisibility:_,emptySymbolLabelSupported:x,elevationInfoOverride:A,disablePlacement:U,active:ne.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new Hg.F({isPickable:!0},ne.uid)};return this.view._stage.add(fe.stageLayer),this._labelingContexts.push(fe),this.setDirty(),{addGraphic:Oe=>this._addGraphic(fe,Oe),removeGraphic:Oe=>this._removeGraphic(fe,Oe),featureReductionChange:()=>{},layerLabelsEnabled:()=>(0,Gl.C6)(fe.layer),labelingInfoChange:Oe=>this._labelingInfoChange(fe,Oe),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",fe),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",fe),visibilityInfoChange:()=>this._visibilityInfoChange(fe),reset:()=>this._resetLabels(fe),clear:()=>{}}}removeGraphicsOwner(d){const _=this._findLabelingContext(d);if(!_)return;const T=this._labelingContexts.indexOf(_);this._labelingContexts.splice(T,1),_.labels.forEach(x=>this._removeGraphic(_,x.graphics3DGraphic)),this.view._stage.remove(_.stageLayer),_.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(d,_){const T=d.graphic.uid,x=this._labels.get(T);x&&x.visible!==_&&(_&&!x.rendered?(this._labelsToAdd.set(T,x),this._labelsToRemove.delete(T),x.textTextureResources.initialized||x.labelingContext.labelsToInitialize.set(T,x)):!_&&x.rendered&&(this._labelsToRemove.set(T,x),this._labelsToAdd.delete(T)),x.visible=_,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(d=>J2(d))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const d=this._labelingContexts.length>0?this._labelingContexts.reduce((_,T)=>_+(J2(T)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*d+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function oW(d){return d.active&&(0,Gl.C6)(d.layer)}function J2(d){return d.labelClassPromise&&!!d.labelClassAbortController}function tw(d){return d.labelClassContexts&&d.labelClassContexts.length}function aW(d){return null===d.labelClassContexts}(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],p0.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],p0.prototype,"deconflictor",void 0),(0,Ve._)([(0,ke.Cb)()],p0.prototype,"_textTextureAtlas",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],p0.prototype,"updating",null),p0=(0,Ve._)([(0,Wr.j)("esri.views.3d.layers.graphics.Labeler")],p0);const zh=new VN.Z(null,null,null);var ma=v(27351),rw=v(11544),Wu=v(27899),lW=v(37810);class cW{constructor(_){this._renderCoordsHelper=_,this._surfaceElevation=0,this._cache=new Map,this._frustum=new F_.i(_),this._extendedFrustum=new F_.i(_),this._intersector=new lW.q({renderCoordsHelper:_}),this._renderCoordsHelper=_}begin(_,T){this._surfaceElevation=T,this._aboveGround=this._renderCoordsHelper.getAltitude(_.eye)>T,this._frustum.update(_),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(_)}end(){this._cache.clear()}calculate(_){if(this._allTilesInvisible)return ma.E.INVISIBLE;const T=this._renderCoordsHelper.viewingMode===vi.JY.Global&&_.lij[0]>=uW&&_.lij[0]<dW,x=this._getOrCalculateSingleTileVisibility(_,!T);return x!==ma.E.INVISIBLE&&T?this._calculateAggregatedChildrenVisibility(_):x}_shortenFrustumFarPlane(_){const T=F_.i.nearFarLineIndices,x=_.mutablePoints;for(const A of T){const[U,ne]=A,fe=x[U];(0,pt.b)(Mc,x[ne],fe),(0,pt.g)(Mc,Mc,pW),(0,pt.a)(x[ne],fe,Mc)}_.updatePoints(x)}_calculateAggregatedChildrenVisibility(_){let T=ma.E.INVISIBLE;const x=this._cache.get(_.id);if(null!=x)return x;const A=ow.acquire();_.getChildren(A);for(const U of A){const ne=this.calculate(U);if(ne!==ma.E.INVISIBLE&&(T=ne,ne===ma.E.VISIBLE_ON_SURFACE))break}return ow.release(A),this._cache.set(_.id,T),T}_getOrCalculateSingleTileVisibility(_,T){const x=this._cache.get(_.id);if(null!=x)return x;const A=this._calculateSingleTileVisibility(_);return T&&this._cache.set(_.id,A),A}_calculateSingleTileVisibility(_){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===vi.JY.Global&&_.lij[0]<hW?this._calculateSingleTileVisibilitySided(_,!1)===ma.E.INVISIBLE?this._calculateSingleTileVisibilitySided(_,!0):void 0:this._calculateSingleTileVisibilitySided(_,this._aboveGround)}_calculateSingleTileVisibilitySided(_,T){this._intersector.update(_.extent,_.tilingScheme.spatialReference,this._surfaceElevation,T);const x=(0,En.Iu)(_.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,x)?this._intersector.isVisibleInFrustum(this._frustum,x,!0)?ma.E.VISIBLE_ON_SURFACE:ma.E.VISIBLE_WHEN_EXTENDED:ma.E.INVISIBLE}_updateExtendedFrustum(_){this._extendedFrustum.update(_),this._shortenFrustumFarPlane(this._extendedFrustum);const T=this._renderCoordsHelper.worldUpAtPosition(_.eye,Mc);this._aboveGround||(0,pt.o)(T,T);const x=(0,xr.ZF)(-(0,pt.e)(T,_.viewForward));if(this._allTilesInvisible=x>(Math.PI+_.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=x>_.fovY/2,!this._hasExtendedFrustum))return;const A=this._extendedFrustumParameters(),U=this._extendedFrustum.mutablePoints;for(let ne=0;ne<4;ne++){const fe=A.pointIndices[ne],Oe=U[fe],we=this._renderCoordsHelper.getAltitude(Oe);if(A.needsAltitudeAdjustment(we)){switch(this._renderCoordsHelper.worldUpAtPosition(Oe,Mc),fe){case rn.NQ.FAR_BOTTOM_LEFT:case rn.NQ.FAR_TOP_LEFT:case rn.NQ.NEAR_BOTTOM_LEFT:case rn.NQ.NEAR_TOP_LEFT:(0,Rn._l)(this._extendedFrustum.planes[rn.Nu.LEFT],Mc,Mc);break;case rn.NQ.FAR_BOTTOM_RIGHT:case rn.NQ.FAR_TOP_RIGHT:case rn.NQ.NEAR_BOTTOM_RIGHT:case rn.NQ.NEAR_TOP_RIGHT:(0,Rn._l)(this._extendedFrustum.planes[rn.Nu.RIGHT],Mc,Mc)}(0,pt.g)(Mc,Mc,A.direction),this._renderCoordsHelper.intersectInfiniteManifold((0,yc.re)(Oe,Mc),A.zWithMargin,Oe)}}if(this._extendedFrustum.updatePoints(U),(0,Rn.zk)(U[rn.NQ.NEAR_BOTTOM_LEFT],U[rn.NQ.NEAR_BOTTOM_RIGHT],U[rn.NQ.NEAR_TOP_RIGHT],iw),(0,Rn.zk)(U[rn.NQ.NEAR_BOTTOM_RIGHT],U[rn.NQ.NEAR_TOP_RIGHT],U[rn.NQ.NEAR_TOP_LEFT],nw),(0,pt.e)((0,Rn.mJ)(iw),(0,Rn.mJ)(nw))<0){const ne=this._extendedFrustum.mutablePoints;this._aboveGround?[ne[rn.NQ.NEAR_BOTTOM_LEFT],ne[rn.NQ.NEAR_BOTTOM_RIGHT]]=[ne[rn.NQ.NEAR_BOTTOM_RIGHT],ne[rn.NQ.NEAR_BOTTOM_LEFT]]:[ne[rn.NQ.NEAR_TOP_LEFT],ne[rn.NQ.NEAR_TOP_RIGHT]]=[ne[rn.NQ.NEAR_TOP_RIGHT],ne[rn.NQ.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(ne)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const _=this._surfaceElevation-sw;return{zWithMargin:_,pointIndices:F_.i.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:T=>T>_}}_extendedFrustumParametersBelowSurface(){const _=this._surfaceElevation+sw;return{zWithMargin:_,pointIndices:F_.i.planePointIndices.top,direction:1,needsAltitudeAdjustment:T=>T<_}}}const uW=2,dW=6,hW=12,pW=.95,sw=1,Mc=(0,ir.c)(),iw=(0,Rn.Ue)(),nw=(0,Rn.Ue)(),ow=new Wu.Z(Array,d=>{4!==d.length&&(d[0]=new ma.C,d[1]=new ma.C,d[2]=new ma.C,d[3]=new ma.C)},d=>{d[0].release(),d[1].release(),d[2].release(),d[3].release()});class _W{constructor(_){this._camera=new $i.V,this._focusOnMap=[0,0],this._screenRect=(0,Bs.Ue)(),this._tileSize=_.tileSize,this._renderCoordsHelper=_.renderCoordsHelper,this._tilingScheme=_.tilingScheme,this._visibility=new cW(_.renderCoordsHelper)}begin(_,T,x){this._camera.copyFrom(_),this._surfaceElevation=x,this._focusOnMap[0]=T.x,this._focusOnMap[1]=T.y,(0,Bs.al)(0,0,_.fullWidth,_.fullHeight,this._screenRect),this._visibility.begin(this._camera,x)}end(){this._visibility.end()}updateTile(_){_.measures.visibility=this._visibility.calculate(_),_.measures.distance=(0,Bs.TE)(_.extent,this._focusOnMap),_.measures.visibility!==ma.E.INVISIBLE&&this._updateScreenMeasure(_)}_updateScreenMeasure(_){const T=fW,x=1<<T,A=_.measures.screenRect;(0,Bs.cS)(A);let U=0;const ne=_.lij[0]+T,fe=_.lij[1]<<T,Oe=_.lij[2]<<T,we=this._tileSizeWithBias(_),Ze=we*we;for(let it=0;it<x;it++)for(let lt=0;lt<x;lt++)if(U+=this._computeScreenArea(_,ne,fe+it,Oe+lt,A),U>Ze)return void(_.measures.shouldSplit=!0);_.measures.shouldSplit=!1}_tileSizeWithBias(_){return _.measures.visibility===ma.E.VISIBLE_WHEN_EXTENDED?this._tileSize*mW:this._tileSize}_computeScreenArea(_,T,x,A,U){this._projectToScreen(T,x,A,_.measures.visibility===ma.E.VISIBLE_WHEN_EXTENDED,Hh),(0,Bs.cS)(Q2);for(let fe=0;fe<4;fe++)(0,Bs.Ho)(Q2,Hh[fe]);return(0,Bs.jn)(U,Q2,U),(0,rw.wu)(Hh[0],Hh[1],Hh[2])+(0,rw.wu)(Hh[0],Hh[2],Hh[3])}_projectToScreen(_,T,x,A,U){this._tilingScheme.ensureMaxLod(_),this._tilingScheme.getExtent(_,T,x,Gg),this._toRenderCoords(Gg,0,3,Gh[0]),this._toRenderCoords(Gg,2,3,Gh[1]),this._toRenderCoords(Gg,2,1,Gh[2]),this._toRenderCoords(Gg,0,1,Gh[3]),A&&(this._projectToPlane(Gh,this._camera.frustum[rn.Nu.NEAR]),this._projectToPlane(Gh,this._camera.frustum[rn.Nu.TOP]),this._projectToPlane(Gh,this._camera.frustum[rn.Nu.BOTTOM]));for(let ne=0;ne<4;ne++)this._camera.projectToRenderScreen(Gh[ne],aw),this._camera.renderToScreen(aw,U[ne])}_projectToPlane(_,T){for(let A=0;A<4;A++)Zg[A]=(0,Rn.jH)(T,_[A]);const x=Math.max(Zg[0],Zg[1],Zg[2],Zg[3]);if(x>0){const A=(0,pt.g)(Kg,(0,Rn.mJ)(T),-x);for(let U=0;U<4;U++)(0,pt.a)(_[U],_[U],A)}}_toRenderCoords(_,T,x,A){return Kg[0]=_[T],Kg[1]=_[x],Kg[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Kg,this._tilingScheme.spatialReference,A),A}}const Q2=(0,Bs.Ue)(),fW=2,mW=5,Hh=[(0,li.s1)(),(0,li.s1)(),(0,li.s1)(),(0,li.s1)()],Gg=(0,Bs.Ue)(),Kg=(0,ir.c)(),Gh=[(0,ir.c)(),(0,ir.c)(),(0,ir.c)(),(0,ir.c)()],Zg=[0,0,0,0],aw=(0,li.J$)();var lw=v(55745);let ga=class extends Ns.Z{constructor(d){super(d),this.tiles=new On.Z,this.tileSize=512,this._idToTile=new Map,this._handles=new Ji.Z,this._clients=new Set,this._dirty=!1,this._newTiles=new wo.Z}get tilingScheme(){const d=this.tilingSchemeOwner.tilingScheme;return d?d.clone():null}set filterExtent(d){if((0,Qe.pC)(d)&&!d.spatialReference.equals(this.viewState.spatialReference))return void Us.Z.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const _=this._get("filterExtent");if(_===d||(0,Qe.pC)(_)&&d&&_.equals(d))return;const T=(0,Qe.pC)(d)?d.clone():null;this._set("filterExtent",T),this._setDirty()}get _filterExtentRect(){if((0,Qe.Wi)(this.filterExtent)||!this.tilingScheme)return null;const d=(0,Bs.Ue)();return(0,lw.G)(this.filterExtent,d,this.tilingScheme.spatialReference),d}get _rootTileIds(){return this._filterExtentRect?this.tilingScheme.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(d){d!==this._get("suspended")&&(this._set("suspended",d),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([(0,Ht.YP)(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Ht.Z_),(0,Ht.YP)(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Ht.tX)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Fn.T8.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=(0,Qe.hw)(this._frameWorker),this._handles=(0,Qe.SC)(this._handles)}addClient(){const d=function yW(){return gW++}();return this._clients.add(d),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(d)}}_removeClient(d){this._clients.delete(d),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Fn.G5))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(d){this._dirty=!1,this._pendingTiles||(this._startUpdate(),(0,Qe.pC)(this._frameWorker)&&(this._frameWorker.priority=Fn.T8.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(d),!this._pendingTiles&&(0,Qe.pC)(this._frameWorker)&&(this._frameWorker.priority=Fn.T8.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new _W({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this._rootTileIds.map(d=>new ma.C(d[0],d[1],d[2],this.tilingScheme))}_purgeHorizonTiles(d){d.sort((_,T)=>{const x=_.measures.screenRect,A=T.measures.screenRect;return x[1]+x[3]-(A[1]+A[3])}),(0,Bs.cS)(hE);for(let _=0;_<d.length;_++)if((0,Bs.jn)(hE,d.data[_].measures.screenRect,hE),(0,Bs.Cb)(hE)>vW)return d.data.slice(_,d.length);return[]}_subdivideTilesForView(d){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!d.done;){const _=this._pendingTiles.pop();d.madeProgress(),this._filterExtentRect&&!(0,Bs.kK)(this._filterExtentRect,_.extent)||(this._tileMeasurements.updateTile(_),_.measures.visibility!==ma.E.INVISIBLE&&(_.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(_.lij[0]+1),this._pendingTiles.push(..._.getChildren())):this._newTiles.push(_)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(d){for(const x of this.tiles.items)x.used=!1;const _=d.filter(x=>{const A=this._idToTile.get(x.id);return A?(A.copyMeasurementsFrom(x),A.used=!0):this._idToTile.set(x.id,x),!A}),T=this.tiles.items.filter(x=>!x.used&&(this._idToTile.delete(x.id),!0));this.tiles.removeMany(T),this.tiles.addMany(_),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((d,_)=>d.measures.visibility!==_.measures.visibility?d.measures.visibility===ma.E.VISIBLE_ON_SURFACE?-1:1:d.measures.distance-_.measures.distance),this.tiles.forEach((d,_)=>d.loadPriority=_)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"scheduler",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"renderCoordsHelper",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"tilingSchemeOwner",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"cameraOnSurface",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"focus",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"viewState",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],ga.prototype,"terrain",void 0),(0,Ve._)([(0,ke.Cb)()],ga.prototype,"tiles",void 0),(0,Ve._)([(0,ke.Cb)()],ga.prototype,"tileSize",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ga.prototype,"tilingScheme",null),(0,Ve._)([(0,ke.Cb)()],ga.prototype,"filterExtent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ga.prototype,"_filterExtentRect",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ga.prototype,"_rootTileIds",null),(0,Ve._)([(0,ke.Cb)({value:!1})],ga.prototype,"suspended",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ga.prototype,"updating",null),ga=(0,Ve._)([(0,Wr.j)("esri.views.3d.layers.support.FeatureTileTree3D")],ga);let gW=0;const hE=(0,Bs.Ue)(),vW=10;var EW=v(30755);let ea=class extends Ns.Z{constructor(){super(...arguments),this._propertiesPool=new Nh.L({camera:$i.V},this),this._lastSeenCameraProjectionValues=new $i.V,this.events=new Va.Z,this.viewingMode=vi.JY.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(d,_){this._set("viewingMode",d),this._set("spatialReference",_),this._set("constraints",new Md({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Nh.L({camera:$i.V},this)}createInitialCamera(){if(this.viewingMode===vi.JY.Global){const d=(0,En.Iu)(this.spatialReference).radius;this.camera=new $i.V((0,ir.f)(4*d,0,0),(0,ir.f)(d,0,0),(0,ir.f)(0,0,1))}else this.camera=new $i.V((0,ir.f)(0,0,100),(0,ir.f)(0,0,0),(0,ir.f)(0,1,0))}get animation(){return this.cameraController instanceof vg&&(0,Qe.pC)(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(d){d!==Gc&&Gc.copyFrom(d),Gc.computeUp(this.viewingMode),cw.camera=Gc,this.events.emit("before-camera-change",cw);const _=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Gc)&&(this._lastSeenCameraProjectionValues.copyFrom(Gc),uw.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",uw)),(!_||!_.equals(Gc))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Gc)),this._cameraChanged=!_||!_.almostEquals(Gc),this._cameraChanged)){const T=(0,EW.Fs)(()=>{this._cameraChanged=!1,T.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return(0,Qe.pC)(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(d){this._contentCamera=(0,Qe.pC)(d)?d.clone():null}get fixedContentCamera(){return(0,Qe.pC)(this._contentCamera)}get isGlobal(){return this.viewingMode===vi.JY.Global}get isLocal(){return this.viewingMode===vi.JY.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(d){this.stopActiveCameraController()?(d&&(this.addHandles((0,Ht.gx)(()=>d.state===Kn.Finished||d.state===Kn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(_=>d.onControllerEnd(_))},{sync:!0,once:!0})),d.onControllerStart(this.camera)),this._set("cameraController",d)):d&&(d.state=Kn.Rejected)}switchCameraController(d){return this.cameraController=d,d.state!==Kn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(d){this._updateQueue.push(d),this._processUpdateQueue()}_processUpdateQueue(){if(0===this._updateQueue.length||this._processingUpdates)return;this._processingUpdates=!0;const d=this._updateQueue.shift();Gc.copyFrom(this._get("camera")),d(Gc),this.camera=Gc,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(d,_){return d.fov!==_.fov||d.fullViewport[0]!==_.fullViewport[0]||d.fullViewport[1]!==_.fullViewport[1]||d.fullViewport[2]!==_.fullViewport[2]||d.fullViewport[3]!==_.fullViewport[3]||d.padding[$i.N.TOP]!==_.padding[$i.N.TOP]||d.padding[$i.N.RIGHT]!==_.padding[$i.N.RIGHT]||d.padding[$i.N.BOTTOM]!==_.padding[$i.N.BOTTOM]||d.padding[$i.N.LEFT]!==_.padding[$i.N.LEFT]}};(0,Ve._)([(0,ke.Cb)()],ea.prototype,"mode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:g_})],ea.prototype,"animation",null),(0,Ve._)([(0,ke.Cb)({type:$i.V})],ea.prototype,"camera",null),(0,Ve._)([(0,ke.Cb)()],ea.prototype,"pixelRatio",null),(0,Ve._)([(0,ke.Cb)({})],ea.prototype,"_contentCamera",void 0),(0,Ve._)([(0,ke.Cb)({type:$i.V})],ea.prototype,"contentCamera",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"fixedContentCamera",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"constraints",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"events",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"isGlobal",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"isLocal",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"viewingMode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ea.prototype,"spatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],ea.prototype,"navigating",null),(0,Ve._)([(0,ke.Cb)()],ea.prototype,"stationary",null),(0,Ve._)([(0,ke.Cb)()],ea.prototype,"_cameraChanged",void 0),(0,Ve._)([(0,ke.Cb)()],ea.prototype,"cameraController",null),ea=(0,Ve._)([(0,Wr.j)("esri.views.3d.state.ViewState")],ea);const bW=ea,Gc=new $i.V,cw={camera:null},uw={camera:null};var ya=v(67857),pE=v(91480);class CW{constructor(_,T,x){this.viewingMode=_,this._forEachLayer=T,this._view=x,this._externalIntersectionHandlers=new wo.Z,this._tolerance=Ga.vh,this._tmpRay=(0,yc.Ue)(),this._tmpRegion=(0,Bs.Ue)(),this._validateHUDIntersector=(0,Ga.Z8)(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(_,T,x){return this.intersectRay(this._getPickRay(_,this._tmpRay),dw(this.viewingMode),T,x)}intersectScreenFreePointFallback(_,T,x){return this.intersectRayFreePointFallback(this._getPickRay(_,this._tmpRay),T,x)}intersectRayFreePointFallback(_,T,x){return this.intersectRay(_,dw(this.viewingMode),T,x)||this._intersectRayFreePointLocal(_,T)}intersectRay(_,T,x,A){return T.options.selectionMode=!1,T.options.store=ya.eC.MIN,this.computeIntersection(_,T,A),!!T.results.min&&T.results.min.getIntersectionPoint(x)}getCenterRayWithSubpixelOffset(_,T,x=.5,A=.5){return _.getRenderCenter(mE,x,A),mE[0]+=.0466,mE[1]-=.0123,(0,ju.eW)(_,mE,T)}intersectIntersectorScreen(_,T,x){this.computeIntersection(this._getPickRay(_,this._tmpRay),T,x)}intersectToolIntersectorScreen(_,T,x){const A=this._getPickRay(_,this._tmpRay);this.intersectToolIntersectorRay(A,T,x)}intersectToolIntersectorRay(_,T,x){T.options.selectionMode=!0,this.computeIntersection(_,T,x);const A=T.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||(0,pE.nn)(A)&&A.intersector!==ya.q7.TERRAIN||(T.options.selectionMode=!1,this.computeIntersection(_,T,x))}setTolerance(_=Ga.vh){this._tolerance=_}addIntersectionHandler(_){this._externalIntersectionHandlers.push(_),this._externalIntersectionHandlers.sort((T,x)=>T.type===ya.q7.TERRAIN?1:x.type===ya.q7.TERRAIN?-1:0)}removeIntersectionHandler(_){null!=this._externalIntersectionHandlers.removeUnordered(_)&&this._externalIntersectionHandlers.sort((T,x)=>T.type===ya.q7.TERRAIN?1:x.type===ya.q7.TERRAIN?-1:0)}_getPickRay(_,T){return(0,ju.u4)(this._view.state.camera,_,T)}_intersectRayFreePointLocal(_,T){if(this.viewingMode!==vi.JY.Local||(0,Qe.Wi)(_))return!1;const x=this._view.renderDataExtent;if((0,Qe.Wi)(x))return(0,pt.a)(T,_.origin,(0,pt.n)(Dn.WM.get(),_.direction)),!0;const A={x:x.xmax-x.xmin,y:x.ymax-x.ymin,z:8*Math.max(x.xmax-x.xmin,x.ymax-x.ymin)},U=Math.max(A.x,A.y,A.z);if(0===U)return(0,pt.a)(T,_.origin,(0,pt.n)(Dn.WM.get(),_.direction)),!0;const ne=this._view.state.camera,fe=Math.max(0,x.xmin-ne.eye[0],ne.eye[0]-x.xmax),Oe=Math.max(0,x.ymin-ne.eye[1],ne.eye[1]-x.ymax),we=Math.sqrt(fe*fe+Oe*Oe),Ze=Math.abs(ne.relativeElevation)+Number.MIN_VALUE,it=Math.max(0,Math.log(U/Ze))**2;let lt=U/Math.max(1,it);lt=Math.max(lt,Math.min(we,U));const dt=(0,pt.l)(_.direction),Tt=(0,pt.g)(Dn.WM.get(),_.direction,0===dt?lt:lt/dt);return(0,pt.a)(T,_.origin,Tt),!0}intersectElevationFromScreen(_,T,x=0,A=null){return this._intersectElevation(this._getPickRay(_,this._tmpRay),T,x,A)}_intersectElevation(_,T,x=0,A=null){if((0,Qe.Wi)(_))return null;const U=(0,Qe.pC)(T)?T.mode:"absolute-height",ne=(0,Qe.pC)(T)?(0,Qe.Pt)(T.offset,0):0,fe="on-the-ground"!==U?ne+x:0,Oe=fe/this._view.renderCoordsHelper.unitInMeters;if("absolute-height"===U){if(this._view.renderCoordsHelper.intersectInfiniteManifold(_,fe,fE)){const Nt=this._view.computeMapPointFromVec3d(fE);return Nt.z-=ne,Nt}return null}const we=this._view.state.camera,Ze=(0,li.Wv)(Dn.WM.get());we.projectToRenderScreen(_.origin,Ze);const it=new hw(null,this._forEachLayer),lt=this._view.slicePlane,dt=(0,Qe.pC)(lt)?(0,pE.e4)(lt):null,Tt=(0,Ga.Z8)(this.viewingMode);Tt.options.store=ya.eC.MIN,Tt.options.verticalOffset=Oe;const mt=_.origin,Mt=(0,pt.a)(Dn.WM.get(),mt,_.direction);Tt.reset(mt,Mt,we),Tt.point=Ze;const Pt=(0,Qe.pC)(A)?"type"in A&&"graphics"===A.type?Nt=>Nt.metadata.layerUid!==A.uid:Nt=>Nt.metadata.graphicUid!==A.uid:null;switch(U){case"relative-to-scene":Tt.intersect(it.layers,Ze,this._tolerance,null,Bt=>((0,Qe.Wi)(Pt)||Pt(Bt))&&Bt.metadata&&Bt.metadata.isElevationSource),this._externalIntersectionHandlers.forAll(Bt=>{Bt.type!==ya.q7.I3S&&Bt.type!==ya.q7.TERRAIN||Bt.intersect(Tt,Bt.slicePlaneEnabled?dt:null,Tt.rayBegin,Tt.rayEnd,Ze)});break;case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(Nt=>{Nt.isGround&&Nt.intersect(Tt,Nt.slicePlaneEnabled?dt:null,Tt.rayBegin,Tt.rayEnd,Ze)})}if(Tt.results.min.getIntersectionPoint(fE)){const Nt=this._view.computeMapPointFromVec3d(fE);return Nt.z=x,Nt}return null}computeIntersection(_,T,x){if((0,Qe.Wi)(_))return;const A=this._view.state.camera,U=(0,li.Wv)(Dn.WM.get());A.projectToRenderScreen(_.origin,U);const ne=new hw(x,this._forEachLayer);T.options.selectOpaqueTerrainOnly=!x||!("include"in x||"exclude"in x);const fe=_.origin,Oe=(0,pt.a)(Dn.WM.get(),_.origin,_.direction);T.reset(fe,Oe,A),T.intersect(ne.layers,U,this._tolerance);const we=this._view.slicePlane,Ze=(0,Qe.pC)(we)?(0,pE.e4)(we):null;T.intersect(ne.sliceableLayers,U,this._tolerance,Ze);const it=x&&(x.requiresGroundFeedback||x.enableDraped);this._externalIntersectionHandlers.forAll(Tt=>{T.options.isFiltered=!ne.filterLayerUid(Tt.layerUid),(Tt.isGround&&it||!T.options.isFiltered)&&Tt.intersect(T,Tt.slicePlaneEnabled?Ze:null,fe,Oe,U)});const lt=Dn.WM.get(),dt=this._view.basemapTerrain;if(x&&x.enableDraped&&(0,Qe.pC)(dt.spatialReference)&&T.results.ground.getIntersectionPoint(lt)){const Tt=dt.overlayManager.renderer,mt=this._view.renderCoordsHelper.spatialReference,Mt=Dn.WM.get();this._view.renderCoordsHelper.fromRenderCoords(lt,Mt,dt.spatialReference),Mt[2]=(0,Qe.Pt)(this._view.elevationProvider.getElevation(lt[0],lt[1],lt[2],mt,"ground"),0),Tt.intersect(T,Mt,T.results.ground,Pt=>ne.filterRenderGeometry(Pt))}T.sortResults(),this._processHUDResults(T)}_processHUDResults(_){const T=_.results.hud;(0,Bs.JG)(this._tmpRegion,Bs.Gv);const x=this._view.state.camera,A=[],U=this._tmpRegion,ne=Pt=>{const Nt=new MW(Pt);x.projectToRenderScreen(Pt.target.center,Nt.screenPoint),Nt.screenPoint[0]=Math.floor(Nt.screenPoint[0]),Nt.screenPoint[1]=Math.floor(Nt.screenPoint[1]),A.push(Nt),(0,Bs.Ho)(U,Nt.screenPoint)};_.sortResults(T.all),(0,Qe.pC)(T.min.dist)&&ne(T.min);for(const Pt of T.all)T.min.target.object!==Pt.target.object&&T.max.target.object!==Pt.target.object&&ne(Pt);if((0,Qe.pC)(T.max.dist)&&T.max.target.object!==T.min.target.object&&ne(T.max),!A.length)return;U[0]===U[2]&&(U[2]+=1),U[1]===U[3]&&(U[3]+=1);const fe=x.fullWidth,Oe=x.fullHeight,we=Math.max(0,U[0]-$g),Ze=Math.max(0,U[1]-$g),it=Math.min((0,Bs.bf)(U)+2*$g,fe-we),lt=Math.min((0,Bs.Cb)(U)+2*$g,Oe-Ze),dt=new Uint8Array(it*lt*4);this._view._stage.renderView.readHUDVisibility(we,Ze,it,lt,dt);let Tt=!0;const mt=(0,Qe.Wi)(_.results.max.dist);let Mt=0;for(const Pt of A)for(const Nt of TW)if(dt[4*(Math.min(Pt.screenPoint[0]+Nt[0],fe)-U[0]+(Math.min(Pt.screenPoint[1]+Nt[1],Oe)-U[1])*it)]){Tt&&(_.results.min.copy(Pt.result),Tt=!1),mt&&_.results.max.copy(Pt.result),_.options.store===ya.eC.ALL&&_.results.all.splice(Mt++,0,Pt.result);break}}}const $g=1,TW=(()=>{const d=[],_=$g;for(let T=-_;T<=_;T++)for(let x=-_;x<=_;x++)d.push([x+_,T+_]);return d})();class MW{constructor(_){this.result=_,this.screenPoint=(0,li.J$)()}}let _E;function dw(d){return _E&&_E.viewingMode===d||(_E=(0,Ga.Z8)(d)),_E}class hw{constructor(_,T){this.layers=new Array,this.sliceableLayers=new Array,this.include=_?.include,this.exclude=_?.exclude,T(x=>{x.isPickable&&this.filterLayerUid(x.apiLayerUid)&&(x.isSliceable?this.sliceableLayers:this.layers).push(x)})}filterLayerUid(_){const{include:T,exclude:x}=this;return(0,Qe.Wi)(_)?null==T&&null==x:(null==T||T.has(_))&&(null==x||!x.has(_))}filterRenderGeometry(_){return this.filterLayerUid(_.layerUid)}}function pw(d){return"object"==typeof d&&"intersect"in d}const fE=(0,ir.c)(),mE=(0,li.J$)();var PW=v(39912);let Yg=class extends(Va.Z.EventedMixin(Ns.Z)){constructor(d){super(d),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}get spatialReference(){return this.view?.basemapTerrain?.spatialReference}destroy(){this._elevationQueryCached=(0,Qe.SC)(this._elevationQueryCached)}get _elevationQuery(){return(0,Qe.Wi)(this._elevationQueryCached)&&(this._elevationQueryCached=new PW.K(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(d){d||(this.lastElevationQuery=null),this.elevationCacheEnabled=d}getElevation(d,_,T,x,A){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){const ne=this.lastElevationQuery;if(d===ne.x&&_===ne.y&&T===ne.z&&(0,hc.fS)(x,ne.spatialReference)&&A===ne.queryContext)return ne.result}let U=null;return U=gE(U,this._im,d,_,T,x,A),(0,Qe.Wi)(U)&&(U=gE(U,this._ground,d,_,T,x,A)),"scene"===A&&(U=gE(U,this._scene,d,_,T,x,A)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:d,y:_,z:T,spatialReference:x,queryContext:A,result:U}),U}queryElevation(d,_,T,x,A,U=null,ne=0){const fe=(0,ws.hh)();return this._elevationQuery.queryElevation(d,_,U,ne).then(Oe=>{"scene"===A&&(Oe=gE(Oe,this._scene,d,_,T,x,A)),fe.resolve(Oe)}).catch(Oe=>{(0,ws.D_)(Oe)?fe.reject(Oe):fe.resolve(this.getElevation(d,_,T,x,A))}),fe.promise}register(d,_){this._handles.set(_,_.on("elevation-change",T=>this.emit("elevation-change",T))),this._providersFromContext(d).push(_)}unregister(d){this._handles.has(d)&&(this._handles.get(d).remove(),this._handles.delete(d));for(const _ of[this._im,this._ground,this._scene]){const T=_.indexOf(d);T>-1&&_.splice(T,1)}}_providersFromContext(d){switch(d){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function gE(d,_,T,x,A,U,ne){for(const fe of _){const Oe=fe.getElevation(T,x,A,U,ne);(0,Qe.pC)(Oe)&&(d=(0,Qe.pC)(d)?Math.max(Oe,d):Oe)}return d}(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Yg.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],Yg.prototype,"spatialReference",null),Yg=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.CombinedElevationProvider")],Yg);class Kh{static isValidProfile(_){return _ in Kh.profiles}static getDefaultProfile(){return(0,So.Z)("trident")||(0,So.Z)("esri-iPhone")?"low":"medium"}static apply(_,T){const x=Kh.profiles[_];T.graphics3D.maxTotalNumberOfFeatures=x.graphics3D.maxTotalNumberOfFeatures,T.graphics3D.maxTotalNumberOfPrimitives=x.graphics3D.maxTotalNumberOfPrimitives,T.graphics3D.polygonLodFactor=x.graphics3D.polygonLodFactor,T.graphics3D.polylineLodFactor=x.graphics3D.polylineLodFactor,T.graphics3D.snapshotAvailable=x.graphics3D.snapshotAvailable,T.graphics3D.skipHighSymbolLods=x.graphics3D.skipHighSymbolLods;{const A=T.sceneService.object,U=x.sceneService.object;A.lodFactor=U.lodFactor,A.lodCrossfadeinDuration=U.lodCrossfadeinDuration,A.lodCrossfadeoutDuration=U.lodCrossfadeoutDuration,A.lodCrossfadeUncoveredDuration=U.lodCrossfadeUncoveredDuration}T.sceneService.point.lodFactor=x.sceneService.point.lodFactor,T.sceneService.integratedMesh.lodFactor=x.sceneService.integratedMesh.lodFactor,T.sceneService.pointCloud.lodFactor=x.sceneService.pointCloud.lodFactor,T.sceneService.uncompressedTextureDownsamplingEnabled=x.sceneService.uncompressedTextureDownsamplingEnabled,T.tiledSurface.lodBias=x.tiledSurface.lodBias,T.tiledSurface.angledSplitBias=x.tiledSurface.angledSplitBias,T.tiledSurface.reduceTileLevelDifferences=x.tiledSurface.reduceTileLevelDifferences,T.tiledSurface.textureFadeDuration=x.tiledSurface.textureFadeDuration,T.heatmap.pixelRatio=x.heatmap.pixelRatio,T.heatmap.maxTotalNumberOfFeatures=x.heatmap.maxTotalNumberOfFeatures,T.weatherFadeDuration=x.weatherFadeDuration,T.antialiasingEnabled=x.antialiasingEnabled,T.physicallyBasedRenderingEnabled=x.physicalBasedRenderingEnabled,T.highQualityTransparency=x.highQualityTransparency,T.memoryLimit=x.memoryLimit,T.additionalCacheMemory=x.additionalCacheMemory,T.frameRate=x.frameRate,T.maximumRenderResolution=x.maximumRenderResolution,T.maximumPixelRatio=x.maximumPixelRatio}}function _w(){const d=!!(0,So.Z)("esri-mobile"),_=!!(0,So.Z)("ios"),T=(0,mi.HA)(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:(0,mi.HA)(0),lodCrossfadeoutDuration:(0,mi.HA)(0),lodCrossfadeUncoveredDuration:(0,mi.HA)(0)},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:(0,mi.HA)(0)},weatherFadeDuration:(0,mi.HA)(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:d?.8:1,polylineLodFactor:d?1.2:1.5,snapshotAvailable:!_,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:(0,mi.HA)(0),lodCrossfadeoutDuration:(0,mi.HA)(0),lodCrossfadeUncoveredDuration:T},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:d},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,So.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:T},weatherFadeDuration:T,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:d?600:750,additionalCacheMemory:d?0:150,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:d?1.2:2,polylineLodFactor:d?1.2:2,snapshotAvailable:!_,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:(0,mi.HA)(0),lodCrossfadeoutDuration:(0,mi.HA)(0),lodCrossfadeUncoveredDuration:T},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,So.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:T},weatherFadeDuration:T,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:d?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:d?void 0:4096,maximumPixelRatio:d?1:void 0}}}Kh.debug={reset(){const d=_w();for(const _ in d)Kh.profiles[_]=d[_]}},function(d){d.profiles=_w()}(Kh||(Kh={}));const yE=Kh;var Zh=v(67709);let Vu=class extends Ns.Z{constructor(){super(...arguments),this.color=new lo.Z([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new lo.Z([0,0,0]),this.shadowDifference=.2}static toEngineOptions(d){const _=lo.Z.toUnitRGBA(d.color),T=(0,Qe.pC)(d.haloColor)?lo.Z.toUnitRGBA(d.haloColor):_,x=lo.Z.toUnitRGBA(d.shadowColor);return{color:(0,Zh.f)(_[0],_[1],_[2],_[3]),haloColor:(0,Zh.f)(T[0],T[1],T[2],T[3]),haloOpacity:d.haloOpacity,haloOpacityOccluded:.25*d.haloOpacity,fillOpacity:d.fillOpacity,fillOpacityOccluded:.25*d.fillOpacity,shadowOpacity:d.shadowOpacity,shadowColor:(0,Tn.f)(x[0],x[1],x[2],x[3]),occludedShadowOpacity:d.shadowOpacity*(1-d.shadowDifference)}}};(0,Ve._)([(0,ke.Cb)({type:lo.Z})],Vu.prototype,"color",void 0),(0,Ve._)([(0,ke.Cb)({type:lo.Z})],Vu.prototype,"haloColor",void 0),(0,Ve._)([(0,ke.Cb)()],Vu.prototype,"haloOpacity",void 0),(0,Ve._)([(0,ke.Cb)()],Vu.prototype,"fillOpacity",void 0),(0,Ve._)([(0,ke.Cb)()],Vu.prototype,"shadowOpacity",void 0),(0,Ve._)([(0,ke.Cb)({type:lo.Z})],Vu.prototype,"shadowColor",void 0),(0,Ve._)([(0,ke.Cb)()],Vu.prototype,"shadowDifference",void 0),Vu=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.HighlightOptions")],Vu);const q2=Vu;var OW=v(35082),xW=v(39636),DW=v(77294);class SW{constructor(_,T){this.spatialReference=T,this.unitInMeters=(0,dM.c9)(this.spatialReference,(0,En.Iu)(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=(0,OW.getGeometryServiceURL)(_&&_.get("portalItem")).catch(()=>{throw new ai.Z("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}toGeographic(_){var T=this;return(0,kr.Z)(function*(){const x=yield T._geometryServiceURLPromise;let A,U=!0;Array.isArray(_[0])&&"number"!=typeof _[0]?A=_:(A=[_],U=!1);const ne=A.map(we=>we instanceof vn.Z?we:new vn.Z(we,T.spatialReference)),fe=new DW.Z({geometries:ne,outSpatialReference:to.Z.WGS84}),Oe=(yield(0,xW.i)(x,fe)).map(we=>"point"===we.type?[we.x,we.y]:void 0);return U?Oe:Oe[0]})()}}let fu=class extends Ns.Z{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};(0,Ve._)([(0,ke.Cb)()],fu.prototype,"minTotalNumberOfFeatures",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"maxTotalNumberOfFeatures",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"maxTotalNumberOfPrimitives",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"snapshotAvailable",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"polygonLodFactor",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"polylineLodFactor",void 0),(0,Ve._)([(0,ke.Cb)()],fu.prototype,"skipHighSymbolLods",void 0),fu=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],fu);let zu=class extends Ns.Z{constructor(){super(...arguments),this.lodFactor=1}};(0,Ve._)([(0,ke.Cb)()],zu.prototype,"lodFactor",void 0),zu=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],zu);let vE=class extends zu{constructor(){super(...arguments),this.lodCrossfadeinDuration=(0,mi.HA)(0),this.lodCrossfadeoutDuration=(0,mi.HA)(0),this.lodCrossfadeUncoveredDuration=(0,mi.HA)(0)}};vE=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],vE);let Ud=class extends Ns.Z{constructor(){super(...arguments),this.object=new vE,this.point=new zu,this.integratedMesh=new zu,this.pointCloud=new zu,this.uncompressedTextureDownsamplingEnabled=!1}};(0,Ve._)([(0,ke.Cb)({type:vE})],Ud.prototype,"object",void 0),(0,Ve._)([(0,ke.Cb)({type:zu})],Ud.prototype,"point",void 0),(0,Ve._)([(0,ke.Cb)({type:zu})],Ud.prototype,"integratedMesh",void 0),(0,Ve._)([(0,ke.Cb)({type:zu})],Ud.prototype,"pointCloud",void 0),(0,Ve._)([(0,ke.Cb)()],Ud.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Ud=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Ud);let $h=class extends Ns.Z{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=(0,mi.HA)(400)}};(0,Ve._)([(0,ke.Cb)()],$h.prototype,"lodBias",void 0),(0,Ve._)([(0,ke.Cb)()],$h.prototype,"angledSplitBias",void 0),(0,Ve._)([(0,ke.Cb)()],$h.prototype,"reduceTileLevelDifferences",void 0),(0,Ve._)([(0,ke.Cb)()],$h.prototype,"textureFadeDuration",void 0),$h=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],$h);let J_=class extends Ns.Z{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};(0,Ve._)([(0,ke.Cb)()],J_.prototype,"pixelRatio",void 0),(0,Ve._)([(0,ke.Cb)()],J_.prototype,"maxTotalNumberOfFeatures",void 0),J_=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.HeatmapSettings")],J_);let ol=class extends Ns.Z{constructor(){super(...arguments),this.graphics3D=new fu,this.sceneService=new Ud,this.tiledSurface=new $h,this.heatmap=new J_,this.weatherFadeDuration=(0,mi.HA)(400),this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumRenderResolution=void 0,this.maximumPixelRatio=void 0}};(0,Ve._)([(0,ke.Cb)({type:fu})],ol.prototype,"graphics3D",void 0),(0,Ve._)([(0,ke.Cb)({type:Ud})],ol.prototype,"sceneService",void 0),(0,Ve._)([(0,ke.Cb)({type:$h})],ol.prototype,"tiledSurface",void 0),(0,Ve._)([(0,ke.Cb)({type:J_})],ol.prototype,"heatmap",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"weatherFadeDuration",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"antialiasingEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"physicallyBasedRenderingEnabled",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"highQualityTransparency",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"memoryLimit",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"additionalCacheMemory",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"frameRate",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"maximumRenderResolution",void 0),(0,Ve._)([(0,ke.Cb)()],ol.prototype,"maximumPixelRatio",void 0),ol=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.QualitySettings.QualitySettings")],ol);const fw=ol;var AW=v(13986),Xg=v(39135),mw=v(1036);function gw(d){return"function"==typeof d.getUsedMemory}let Ol=class extends Ns.Z{constructor(d){super(d),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new mw.WJ,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(d){null==d||d<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<d&&this._updateQuality(1),this._maxMemory=d)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(d){null!=d&&d>=0&&(this._additionalCacheMemory=d)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(d,_){return new mw.Xq(d,this._cacheStorage,_)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let d=this._layersUpdating();this._memoryPredicted<.6&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1)):d?(this._memoryPredicted>1.1||this._memoryUsed>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._memoryUsed>1?(this._stableQuality=0,this._canFastRecover=!1,d=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._memoryUsed<.75&&this._quality<1?(this._stableQuality=this._quality,d=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=d}_updateQuality(d){return(d=Math.min(Math.max(d,this.minQuality),1))!==this._quality&&(this._quality=d,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(d=>!!d.updating)}_updateMemory(){let d=0,_=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(d+=this.view.basemapTerrain.getUsedMemory());const T=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;(0,Qe.pC)(T)&&(d+=T.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(ne=>{if(gw(ne)){const fe=ne.ignoresMemoryFactor()?this._quality:1;d+=ne.getUsedMemory()*fe,_+=ne.getUnloadedMemory()*fe}});const x=(0,Qe.Wi)(this._warnMemoryUsage)||Math.round(10*d)!==Math.round(10*this._warnMemoryUsage),A=1048576*this.maxMemory;if(d>A&&x){this._warnMemoryUsage=d;const ne=Oe=>(Oe/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",fe=Math.round(100*this._quality);Us.Z.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${ne(A)} Current: ${ne(d)} Projected: ${ne(d+_)} Quality: ${fe}%`)}this._memoryUsed=d/A,this._memoryPredicted=(d+_)/A,this._cacheStorage.maxSize=Math.max(0,A-d+1048576*this.additionalCacheMemory)}get test(){const d=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const _=d._numQualityChanges;return d._numQualityChanges=0,_}}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ol.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"maxMemory",null),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"additionalCacheMemory",null),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"memoryFactor",null),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"usedMemory",null),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_quality",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_memoryUsed",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_updating",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_stableQuality",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_maxMemory",void 0),(0,Ve._)([(0,ke.Cb)()],Ol.prototype,"_additionalCacheMemory",void 0),Ol=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.MemoryControllerImpl")],Ol);var tO=v(91540);let bE=class extends Ns.Z{constructor(){super(...arguments),this.updating=!1}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],bE.prototype,"updating",void 0),bE=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.ResourceControllerMain")],bE);let Bd=class extends bE{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=Fn.sq,this._handles=new Ji.Z,this._frameTask=null}initialize(){this._scheduler=(0,Fn.z4)(),this._memoryController=function RW(d){return new Ol({view:d})}(this.view),this._streamDataLoader=new tO.wu,this._streamDataLoader.setup(Xg.NT,Xg.Ty,this._scheduler),this._handles.add([(0,Ht.YP)(()=>this.view.state?.mode,d=>this._scheduler.state=d,Ht.Z_),(0,Ht.YP)(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=(0,gd.A)({update:d=>this._frame(d)}),this._scheduleTask=this._scheduler.registerTask(Fn.T8.RESOURCE_CONTROLLER)}destroy(){this._handles=(0,Qe.SC)(this._handles),this._scheduleTask.remove(),this._frameTask=(0,Qe.hw)(this._frameTask),this._streamDataLoader=(0,Qe.SC)(this._streamDataLoader),this._memoryController=(0,Qe.SC)(this._memoryController),this._scheduler=(0,Qe.SC)(this._scheduler)}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._scheduleTask?.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(d,_,T){return this._scheduleTask.schedule(d,_,T)}createStreamDataRequester(d){const _=this._streamDataLoader;return{request:(T,x,A)=>_.request(T,x,d,A),get busy(){return!_.hasDownloadSlots(d)}}}_frame(d){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step((0,mi.D9)(d.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(d)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:d=>this._streamDataLoader.test.loadQueue.getStatsForType(d)}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Bd.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],Bd.prototype,"_scheduler",void 0),(0,Ve._)([(0,ke.Cb)()],Bd.prototype,"_memoryController",void 0),(0,Ve._)([(0,ke.Cb)()],Bd.prototype,"_streamDataLoader",void 0),(0,Ve._)([(0,ke.Cb)()],Bd.prototype,"_scheduleTask",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Bd.prototype,"updating",null),Bd=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.ResourceControllerImpl")],Bd);var UW=v(27306),Cr=v(61779);class jW{constructor(_,T){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=_.layer,this.memory=(0,Cr.wP)(_)?T.basemapTerrain.getUsedMemoryForLayerView(_):_.getUsedMemory(),function BW(d){return"performanceInfo"in d}(_)){const x=_.performanceInfo;this.displayedNumberOfFeatures=x.displayedNumberOfFeatures,this.maximumNumberOfFeatures=x.maximumNumberOfFeatures,this.totalNumberOfFeatures=x.totalNumberOfFeatures}}}class FW{constructor(_){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,(0,Qe.pC)(_.resourceController)){const x=_.resourceController.memoryController;this.totalMemory=x.maxMemory*UW.Y8.MEGABYTES,this.usedMemory=Math.round(x.usedMemory*this.totalMemory),this.quality=x.memoryFactor,this.load=_.resourceController.scheduler.load}this.terrainMemory=_.basemapTerrain?_.basemapTerrain.getUsedMemory():0;const T=_._stage&&_._stage.renderView&&_._stage.renderView.edgeView;this.edgesMemory=(0,Qe.pC)(T)?T.usedMemory:0,_.allLayerViews.items.forEach(x=>{(gw(x)||(0,Cr.wP)(x))&&this.layerPerformanceInfos.push(new jW(x,_))}),this.layerPerformanceInfos.sort((x,A)=>A.memory-x.memory)}}var NW=v(9160),WW=v(93831),VW=v(98973);class zW{constructor(_){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=_("gltf-resources",()=>{}),this._wosrMemCache=_("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(_=>_.abortController.abort()),this._wosrLoading.forEach(_=>_.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(_,T,x){const A=x?`gltfPBR:${_}`:`gltf:${_}`,U=this._gltfMemCache.get(A);return(0,Qe.pC)(U)?Promise.resolve(U):this._loadOnce(this._gltfLoading,this._gltfMemCache,A,ne=>(0,WW.Q)(new NW.C(ne.streamDataRequester),_,ne,x),T)}loadWOSR(_,T){const x=`wosr:${_}:${T.disableTextures}`,A=this._wosrMemCache.get(x);return(0,Qe.pC)(A)?Promise.resolve(A):this._loadOnce(this._wosrLoading,this._wosrMemCache,x,U=>(0,VW.zD)(_,U),T)}_loadOnce(_,T,x,A,U){var ne=this;return(0,kr.Z)(function*(){(0,ws.k_)(U);const fe=(0,ws.fu)(U,()=>ne._abortLoad(_,x));let Oe=_.get(x);if(Oe)Oe.refCount++;else{const we=new AbortController;Oe={refCount:1,abortController:we,promise:A({...U,signal:we.signal})},_.set(x,Oe)}try{const we=yield Oe.promise;return T.put(x,we,we.size),_.delete(x),(0,ws.k_)(U),we}finally{(0,Qe.hw)(fe)}})()}_abortLoad(_,T){const x=_.get(T);(0,Qe.pC)(x)&&--x.refCount>0||(_.delete(T),(0,Qe.pC)(x)&&x.abortController.abort())}}var Fi=v(42743),HW=v(81695);class GW extends f_{constructor(_,T,x,A){super(T,A),this._streamDataRequester=_,this._parameters=x}fromUrl(_,T,x){var A=this;return(0,kr.Z)(function*(){(0,ws.k_)(x);const U=(0,Qe.pC)(x)&&x.signal,ne=A.makeUid(_,T);let fe=A._textureRequests.get(ne);if(!fe){const Oe=new AbortController,we=A._streamDataRequester.request(_,"image",{uid:ne,signal:Oe.signal});fe={referenceCount:0,texture:null,textureAsync:null,abortController:Oe},A._textureRequests.set(ne,fe),fe.textureAsync=we.then(function(){var Ze=(0,kr.Z)(function*(it){const lt=A._createTexture(_,it,T);return fe.texture=lt,fe.abortController=null,A._stage.add(lt),yield A._stage.load(lt),{uid:ne,texture:lt,release:()=>A._release(ne)}});return function(it){return Ze.apply(this,arguments)}}(),Ze=>{throw fe.abortController=null,Ze})}return fe.referenceCount++,new Promise((Oe,we)=>{(0,ws.fu)(U,()=>{we((0,ws.zE)())}),fe.textureAsync.then(Oe,we)}).catch(Oe=>{throw A._release(ne),Oe})})()}_createTexture(_,T,x){const A={...this._parameters,powerOfTwoResizeMode:Fi.CE.PAD};if((0,ST.zd)(_)){if(x||0===T.width&&0===T.height){const U=T.width?T.height/T.width:1;x=x||64,U>1?(T.width=Math.round(x/U),T.height=x):(T.width=x,T.height=Math.round(x*U))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(A.preMultiplyAlpha=!1)}return A.width=T.width,A.height=T.height,new HW.x(T,A)}}class KW{constructor(_){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=_.viewState,this._view=_.view,this._pointsOfInterest=_.pointsOfInterest,this.streamDataRequester=_.resourceController.createStreamDataRequester(Xg.Bh.SYMBOLOGY),this.objectResourceCache=new zW((x,A)=>_.resourceController.memoryController.newCache(x,A)),this.textures=new GW(this.streamDataRequester,_.view._stage,{preMultiplyAlpha:!0,wrap:{s:xt.e8.CLAMP_TO_EDGE,t:xt.e8.CLAMP_TO_EDGE}},_.resourceController.scheduler);const T=(0,En.Iu)(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=(0,aE.Gw)(_.viewingMode,T),this.screenSizePerspectiveSettingsLabels=(0,aE.n9)(_.viewingMode,T)}destroy(){(0,Qe.SC)(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(_){if(!_)return(0,Sp.kB)();this._graphicsOwners.push(_);const T=(0,Ht.YP)(()=>_.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),(0,Sp.kB)(()=>{T.remove(),(0,pd.e$)(this._graphicsOwners,_),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const _=this._graphicsOwners.some(T=>!0===T.layer?.screenSizePerspectiveEnabled);if(_&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ji.Z;const T=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([(0,Ht.YP)(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,T,Ht.Z_),this._viewState.events.on("camera-projection-changed",T)]),this._updateScreenSizePerspectiveSettings()}else!_&&this._screenSizePerspectiveHandles&&(this._screenSizePerspectiveHandles.destroy(),this._screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){CE.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance,CE.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(CE),this.screenSizePerspectiveSettingsLabels.update(CE),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const CE={distance:0,fovY:0};v(9260),v(89673);var ZW=v(69852),$W=v(26531),YW=v(21716);class Yh{constructor(_,T,x=""){this.graphics=_,this._symbol=new ZW.Z({symbolLayers:[new $W.Z({material:{color:T},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new YW.Z({text:x,halo:{color:"white",size:1/.75},material:{color:T},size:12})]})}show(_,T){if((0,Qe.Wi)(T))return;this.hide();const x=new vn.Z({x:_[0],y:_[1],z:_[2],spatialReference:T});this._graphic=new fd.Z({geometry:x,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){(0,Qe.pC)(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Xh=class extends Ns.Z{constructor(d){super(d),this.handles=new Ji.Z}destroy(){this.handles.destroy()}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Xh.prototype,"renderCoordsHelper",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Xh.prototype,"surface",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Xh.prototype,"state",void 0),Xh=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.PointOfInterest")],Xh);const XW=Array;let Pc=class extends Xh{constructor(d){super(d),this._dirty=!1,this._propertiesPool=new Nh.L({location:vn.Z,renderLocation:XW},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=(0,ir.c)(),this._tmpPoint=new vn.Z}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const d=()=>this._setDirty();this.handles.add((0,Ht.on)(()=>this.map?.ground?.layers,"change",d,{onListenerAdd:d,onListenerRemove:d}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const d=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,d,this.state.spatialReference),d}get scale(){const d=this._camera,_=(0,pt.i)(d.eye,this.renderLocation);return i0({renderCoordsHelper:this.renderCoordsHelper,state:{camera:d}},_,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const d=this._pendingElevationQueryController;d&&(this._pendingElevationQueryController=null,d.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);const d=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,d);const _=this._tmpPoint.z>kW&&this.renderCoordsHelper.viewingMode===vi.JY.Global&&(d.isWGS84||d.isWebMercator);let T=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:T.signal,cache:this.cache,minDemResolution:_?JW:0}).then(x=>this._updateSurfaceAltitude(x.geometry.z)).catch(x=>{(0,ws.D_)(x)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===T&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),T=null}),this._pendingElevationQueryController=T}_updateSurfaceAltitude(d){this._estimatedSurfaceAltitude!==d&&(this._estimatedSurfaceAltitude=d,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(rO,this._estimatedSurfaceAltitude,this._camera.eye),(0,pt.k)(this._get("renderLocation"),rO)||(this._set("renderLocation",(0,pt.c)(this._propertiesPool.get("renderLocation"),rO)),this.notifyChange("renderLocation"))}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Pc.prototype,"scheduler",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Pc.prototype,"cache",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Pc.prototype,"task",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Pc.prototype,"cameraName",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pc.prototype,"location",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Pc.prototype,"map",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pc.prototype,"renderLocation",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pc.prototype,"scale",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pc.prototype,"updating",null),Pc=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.CameraOnSurface")],Pc);const rO=(0,ir.c)(),kW=1e5,JW=1e6,QW=Array;let Ql=class extends Xh{constructor(d){super(d),this._propertiesPool=new Nh.L({location:vn.Z,renderLocation:QW},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=(0,ir.c)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=(0,Qe.hw)(this._frameWorker),this._propertiesPool=(0,Qe.SC)(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const d=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,d,this.state.spatialReference),d}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const d=eV;let _=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,d);!_&&this._currentSurfaceAltitude!==this._latestSurfaceAltitude&&(_=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,d),_&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const x=tV;_&&this._latestSurfaceAltitudeChangesDistanceSignificantly(d,x)&&((0,pt.c)(d,x),this._currentSurfaceAltitude=this._latestSurfaceAltitude),_?this.distance=(0,pt.i)(this._camera.eye,d):((0,pt.g)(d,this._camera.viewForward,this._get("distance")),(0,pt.a)(d,d,this._camera.eye)),(0,pt.k)(this._get("renderLocation"),d)||this._set("renderLocation",(0,pt.c)(this._propertiesPool.get("renderLocation"),d))}_calculateSurfaceIntersection(d,_){const T=this._camera;if(!this.renderCoordsHelper.intersectManifold(T.ray,d,_))return!1;if(this.state.isGlobal){const x=(0,En.Iu)(this.renderCoordsHelper.spatialReference).radius,A=x+d,U=(0,pt.p)(T.eye),ne=U<A*A,fe=(0,pt.i)(T.eye,_);if(ne&&fe>x/4){const Oe=A-Math.sqrt(U);return(0,pt.g)(_,T.viewForward,Oe),(0,pt.a)(_,_,T.eye),!0}}else{const x=this.surface.ready?this.surface.extent:null;(0,Qe.pC)(x)&&(0,di.dH)(x,this.surface.spatialReference,kg,this.renderCoordsHelper.spatialReference)&&(_[0]=(0,xr.uZ)(_[0],kg[0],kg[2]),_[1]=(0,xr.uZ)(_[1],kg[1],kg[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(d,_){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==d)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,_)){if(Fo.Z.TESTS_DISABLE_OPTIMIZATIONS)return!0;const T=this._camera.eye,x=(0,pt.i)(T,d),A=(0,pt.i)(T,_);if(Math.abs(A-x)/x>qW)return!0}return!1}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ql.prototype,"scheduler",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ql.prototype,"task",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ql.prototype,"cameraName",void 0),(0,Ve._)([(0,ke.Cb)()],Ql.prototype,"distance",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ql.prototype,"estimateSurfaceAltitudeAtCenter",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ql.prototype,"location",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ql.prototype,"renderLocation",void 0),(0,Ve._)([(0,ke.Cb)()],Ql.prototype,"updating",void 0),Ql=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.CenterOnSurface")],Ql);const qW=.05,eV=(0,ir.c)(),tV=(0,ir.c)(),kg=(0,Bs.Ue)();class rV{constructor(_){this._handles=new Ji.Z,this.events=new Va.Z,this._contentLayerViews=_.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",T=>this._layerViewsChanged(T))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}_layerViewsChanged(_){_.added.forEach(T=>{"esri.views.3d.layers.SceneLayerView3D"===T.declaredClass&&this._handles.add(T.on("visible-geometry-changed",()=>this._contentChanged()),T.uid)}),_.removed.forEach(T=>this._handles.remove(T.uid))}_contentChanged(){this.events.emit("request-update",sV)}}const sV={},iV=Array;let Hu=class extends Xh{constructor(d){super(d),this._propertiesPool=new Nh.L({location:vn.Z,renderLocation:iV},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([(0,Ht.YP)(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),(0,Ht.YP)(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Fn.T8.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const d=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,d,this.state.spatialReference),d}get running(){return this._dirty}runTask(){const d=this._get("renderLocation"),_=this.centerOnSurface.renderLocation,T=this.renderCoordsHelper,x=this.state.contentCamera;this._dirty=!1,T.worldUpAtPosition(_,vw);const A=Math.max(0,(Math.acos((0,pt.e)(vw,x.viewForward))-.5*Math.PI)*(x.aboveGround?1:-1));if(Number.isNaN(A)){if(!d||!(0,pt.F)(d,_)){const Oe=this._propertiesPool.get("renderLocation");(0,pt.c)(Oe,_),this._set("renderLocation",Oe)}return}const U=1-(0,xr.uZ)(A/(.5*Math.PI),0,1),ne=U*U*U;this._calculateScreenHorizontalEdgeOnSurface(Ew);const fe=this._propertiesPool.get("renderLocation");(0,pt.h)(fe,_,Ew,ne),d&&(0,pt.F)(d,fe)||this._set("renderLocation",fe)}_calculateScreenHorizontalEdgeOnSurface(d){const _=this.state.contentCamera,T=_.getRenderCenter((0,li.J$)());if(T[1]=_.aboveGround?_.padding[$i.N.BOTTOM]:_.fullHeight-_.padding[$i.N.TOP],this.estimateSurfaceIntersectionAtRenderPoint(T,d))return d;const x=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(_.unprojectFromRenderScreen(T,Jg)){(0,pt.b)(Jg,Jg,_.eye);const A=(0,pt.n)(Jg,Jg);if(this.renderCoordsHelper.intersectManifold((0,yc.re)(_.eye,A),x,d))return d}return this.renderCoordsHelper.setAltitude(d,x,_.eye)}updateRenderLocation(){this._dirty=!0}};(0,Ve._)([(0,ke.Cb)()],Hu.prototype,"_dirty",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Hu.prototype,"scheduler",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Hu.prototype,"centerOnSurface",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Hu.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Hu.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Hu.prototype,"location",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Hu.prototype,"renderLocation",void 0),Hu=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.pointsOfInterest.Focus")],Hu);const vw=(0,ir.c)(),Jg=(0,ir.c)(),Ew=(0,ir.c)();let jd=class extends Ns.Z{constructor(d){super(d),this.location=null,this._updateController=null,this._handles=new Ji.Z}get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const d=(0,ir.c)();return this.view.renderCoordsHelper.toRenderCoords(this.location,d),d}initialize(){this.view.state.isLocal&&(this._handles.add([(0,Ht.YP)(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),(0,Ht.on)(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||(0,Qe.Wi)(this.surfaceView.extent)||(0,Qe.Wi)(this.surfaceView.spatialReference))return void this._set("location",null);const d=(0,Bs.be)(this.surfaceView.extent),_=new vn.Z({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(_,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(T=>{this._updateController=null,this._set("location",T.geometry)}).catch(T=>{(0,ws.D_)(T)||T&&"elevation-query:invalid-layer"===T.name||console.error("StableSurfaceCenter failed to update: ",T)})):this._set("location",_)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],jd.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],jd.prototype,"cache",void 0),(0,Ve._)([(0,ke.Cb)()],jd.prototype,"surface",null),(0,Ve._)([(0,ke.Cb)()],jd.prototype,"surfaceView",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jd.prototype,"location",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],jd.prototype,"renderLocation",null),jd=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.StableSurfaceCenter")],jd);let Fd=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._tileGeometryUpdateExtent=(0,Bs.cS)(),this._tileGeometryUpdateSpatialReference=null,this.events=new Va.Z,this.updating=!1}initialize(){this._handles.add([this.surface.on("elevation-change",d=>this._tileGeometryChanged(d)),this.scheduler.registerTask(Fn.T8.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this._handles=(0,Qe.SC)(this._handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",nV),(0,Bs.cS)(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(d){this._tileGeometryUpdateSpatialReference=(0,Qe.Wg)(d.spatialReference),(0,Bs.jn)(this._tileGeometryUpdateExtent,d.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let d=this.centerOnSurfaces[0];for(let _=1;_<this.centerOnSurfaces.length;_++){const T=this.centerOnSurfaces[_];T.distance>d.distance&&(d=T)}return d}_centerIntersectsExtent(d,_){const T=this.state.camera.eye,x=oV,A=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(T,_0,_),this.renderCoordsHelper.fromRenderCoords(A.renderLocation,f0,_),_0[0]<f0[0]?(x[0]=_0[0],x[2]=f0[0]):(x[0]=f0[0],x[2]=_0[0]),_0[1]<f0[1]?(x[1]=_0[1],x[3]=f0[1]):(x[1]=f0[1],x[3]=_0[1]),(0,Bs.kK)(x,d)}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Fd.prototype,"state",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Fd.prototype,"centerOnSurfaces",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Fd.prototype,"renderCoordsHelper",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Fd.prototype,"scheduler",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Fd.prototype,"surface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Fd.prototype,"updating",void 0),Fd=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.SurfaceGeometryUpdates")],Fd);const nV={},_0=(0,ir.c)(),f0=(0,ir.c)(),oV=(0,Bs.cS)();let Za=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._tmpRay=(0,yc.Ue)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Nh.L({renderPointOfView:aV},this),this.renderPointOfView=(0,ir.c)(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:d,basemapTerrain:_,renderCoordsHelper:T,map:x}=this.view;this._surfaceIntersector=(0,Ga.Z8)(d.viewingMode),this._surfaceIntersector.options.backfacesTerrain=!d.isGlobal,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ya.eC.MIN,this._contentIntersector=(0,Ga.Z8)(d.viewingMode);const A=()=>this._estimateSurfaceAltitudeAtCenter(),U=this.view.resourceController.scheduler,ne=(0,Qe.Wg)(this.view.basemapTerrain?.elevationQueryCache),fe={state:d,scheduler:U,surface:_,renderCoordsHelper:T};this._set("centerOnSurfaceInfrequent",new Ql({...fe,task:Fn.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:A})),this._set("centerOnSurfaceFrequent",new Ql({...fe,task:Fn.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:A})),this._set("contentCenterOnSurface",new Ql({...fe,task:Fn.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:A,cameraName:"contentCamera"})),this._set("centerOnContent",new Ql({...fe,task:Fn.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Pc({...fe,cache:ne,task:Fn.T8.POINT_OF_INTEREST_INFREQUENT,map:x})),this._set("contentCameraOnSurface",new Pc({...fe,cache:ne,task:Fn.T8.POINT_OF_INTEREST_INFREQUENT,map:x,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new Fd({...fe,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new rV({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:T})),this._set("surfaceOrigin",new jd({cache:ne,view:this.view})),this._set("focus",new Hu({state:d,scheduler:U,surface:_,renderCoordsHelper:T,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(we,Ze)=>this._estimateSurfaceIntersectionAtRenderPoint(we,this.view.state.contentCamera,Ze)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const Oe=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Yh(Oe,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Yh(Oe,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Yh(Oe,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new Yh(Oe,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Yh(Oe,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new Yh(Oe,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new Yh(Oe,"green","Focus")),this._handles.add([(0,Ht.YP)(()=>d.camera,we=>this._cameraChanged(we),Ht.Z_),(0,Ht.YP)(()=>_.extent,()=>this._updateCenterPointsOfInterest()),(0,Ht.gx)(()=>!_.updating,()=>this._updateCenterPointsOfInterest(),Ht.Z_),(0,Ht.on)(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),(0,Ht.on)(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),(0,Ht.gx)(()=>Fo.Z.SHOW_POI,we=>this._setDebug(we),Ht.nn)]),this._cameraChanged(this.view.state.camera);for(const we of this._pois)we.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const d of this._pois)d.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(d=>d.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const d=this._centerRay;return(0,Qe.Wi)(d)||(this._contentAltitudeAtCenter=this.view.sceneIntersectionHelper.intersectRay(d,this._contentIntersector,Q_,cV)?this.view.renderCoordsHelper.getAltitude(Q_):this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const d=this._centerRay;if((0,Qe.Wi)(d))return this._surfaceAltitudeAtCenter;const _=d.origin,T=(0,pt.a)(Q_,d.origin,d.direction);return this._surfaceIntersector.resetWithRay(d,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,_,T),this._surfaceIntersector.results.min.getIntersectionPoint(Q_)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Q_)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(d,_,T){const x=(0,ju.eW)(_,d,lV);if((0,Qe.Wi)(x))return null;const A=x.origin,U=(0,pt.a)(Q_,x.origin,x.direction);return this._surfaceIntersector.resetWithRay(x,_),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,A,U),this._surfaceIntersector.results.min.getIntersectionPoint(T)?T:null}_cameraChanged(d){this._updateCenterPointsOfInterest();const _=d.eye;(0,pt.k)(this.renderPointOfView,_)||this._set("renderPointOfView",(0,pt.c)(this._propertiesPool.get("renderPointOfView"),_))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const d of this._pois)d.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(d){if(!d)return this._debugCenters.forEach(_=>_.hide()),void this._handles.remove("debug");for(const _ of this._pois)this._handles.add((0,Ht.YP)(()=>_.renderLocation,T=>this._debugCenters.get(_).show(T,_.renderCoordsHelper.spatialReference),Ht.nn),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const d of this._pois)d.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"centerOnContent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"centerOnSurfaceFrequent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"centerOnSurfaceInfrequent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"contentCenterOnSurface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"cameraOnSurface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"contentCameraOnSurface",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"focus",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"renderPointOfView",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"surfaceOrigin",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"contentGeometryUpdates",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"surfaceGeometryUpdates",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Za.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Za.prototype,"updating",null),Za=(0,Ve._)([(0,Wr.j)("esri.views.3d.support.PointsOfInterest")],Za);const aV=Array,Q_=(0,ir.c)(),lV=(0,yc.Ue)(),cV={exclude:new Set([bc.cy])};var uV=v(30346);class dV{constructor(_){this._store=_}destroy(){this._store.destroy()}get(_){return this._store.get(_)}put(_,T){this._store.put(_,T,T.values.byteLength+256)}}var hV=v(36596),TE=v(54540),pV=v(41632);class q_{constructor(_=0,T=0){this.min=_,this.max=T,this.level=0,this.hasNoDataValues=!1}copyFrom(_){this.min=_.min,this.max=_.max,this.level=_.level,this.hasNoDataValues=_.hasNoDataValues}}var _V=v(80403);class fV{constructor(_,T,x){this.type="elevation",this.level=_[0],this.i=_[1],this.j=_[2],this.extent=T;const A=x.noDataValue,U=x.values;let ne=1/0,fe=-1/0,Oe=!0,we=!1;for(let Ze=0;Ze<U.length;Ze++){const it=U[Ze];it!==A?(ne=it<ne?it:ne,fe=it>fe?it:fe,Oe=!1):we=!0}Oe&&(ne=0,fe=0),fe=fe>-3e38?fe:0,this.samplerData=new _V.K(x,T),this.bounds=[ne,fe],this.hasNoDataValues=we}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(_,T,x,A){A.min=1/0,A.max=-1/0,A.hasNoDataValues=!1;const U=_-this.level;if(U<=0)return A;const ne=2**U;if(Math.floor(T/ne)!==this.i||Math.floor(x/ne)!==this.j)return A;let fe=1/0,Oe=-1/0;const we=this.samplerData.width,Ze=this.samplerData.pixelData,it=.5*po.$7;let lt=(we-1)/ne,dt=(x-this.j*ne)*lt,Tt=(T-this.i*ne)*lt;if(lt<1){const mt=Math.floor(dt),Mt=Math.floor(Tt),Pt=mt+Mt*we,Nt=Ze[Pt],Bt=Ze[Pt+1],Zt=Ze[Pt+we],nr=Ze[Pt+we+1];if(Nt+Bt+Zt+nr<it){const Jt=dt-mt,Rr=Tt-Mt,Br=(0,sl.bX)(Nt,Bt,Zt,nr,Jt,Rr),$r=(0,sl.bX)(Nt,Bt,Zt,nr,Jt+lt,Rr),Yr=(0,sl.bX)(Nt,Bt,Zt,nr,Jt,Rr+lt),cs=(0,sl.bX)(Nt,Bt,Zt,nr,Jt+lt,Rr+lt);return A.min=Math.min(Br,$r,Yr,cs),A.max=Math.max(Br,$r,Yr,cs),A}dt=mt,Tt=Mt,lt=1}else dt=Math.floor(dt),Tt=Math.floor(Tt),lt=Math.ceil(lt);for(let mt=dt;mt<=dt+lt;mt++)for(let Mt=Tt;Mt<=Tt+lt;Mt++){const Pt=Ze[mt+Mt*we];Pt<it?(fe=Math.min(fe,Pt),Oe=Math.max(Oe,Pt)):A.hasNoDataValues=!0}return A.min=fe,A.max=Oe,A}}const mV=.5*po.$7;function wn(d,_,T){if((0,Qe.Wi)(T))return null;for(const x of T){if(!x)continue;const A=x.safeWidth;let U=(0,xr.uZ)(x.dy*(x.y1-_),0,A),ne=(0,xr.uZ)(x.dx*(d-x.x0),0,A);const fe=Math.floor(U),Oe=Math.floor(ne),we=x.width,Ze=fe*we+Oe,it=x.pixelData,lt=it[Ze],dt=it[Ze+1],Tt=Ze+we,mt=it[Tt],Mt=it[Tt+1];if(lt+mt+dt+Mt<mV){U-=fe,ne-=Oe;const Pt=lt+(dt-lt)*ne;return Pt+(mt+(Mt-mt)*ne-Pt)*U}}return null}let Kc=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const d=[];return this.layerViews.forEach(_=>{const T=_.layer;if("IntegratedMeshLayer"===T.operationalLayerType&&null!=this.viewSpatialReference){const x=bw(T.fullExtent,this.viewSpatialReference);(0,Qe.pC)(x)&&d.push((0,Bs.oJ)(x))}}),d}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Kc.prototype,"layerViewsExtent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Kc.prototype,"tiledLayersExtent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Kc.prototype,"stencilEnabledExtents",null),(0,Ve._)([(0,ke.Cb)()],Kc.prototype,"viewSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)()],Kc.prototype,"tilingScheme",void 0),(0,Ve._)([(0,ke.Cb)()],Kc.prototype,"defaultTiledLayersExtent",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Kc.prototype,"layers",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Kc.prototype,"layerViews",void 0),Kc=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.ExtentHelper")],Kc);let sO=class extends Kc{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?po.cy:po.Lz}};sO=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.ExtentHelperGlobal")],sO);let iO=class extends Kc{_computeLayerViewsExtent(){const d=(0,Bs.cS)(),_=this.viewSpatialReference;this.layerViews.forEach(A=>{const U=A.layer;if(A.isResolved()&&("graphics"!==U.type||!U.internal)){const ne=bw("fullExtentInLocalViewSpatialReference"in A&&A.fullExtentInLocalViewSpatialReference||A.layer.fullExtent,_);(0,Bs.jn)(d,ne,d)}});const T=(0,Bs.sU)(d)?d:null,x=this._get("layerViewsExtent");return(0,Bs.fS)(T,x)?x:T}_computeTiledLayersExtent(){const d=this.tilingScheme;if(!d)return null;const _=this.viewSpatialReference,T=(0,Bs.cS)();this.layers.forEach(U=>{if(U.loaded&&(0,Gl.iC)(U)){const ne=(0,Cr.E_)(U,_,vi.JY.Local);if((0,Qe.Wi)(ne))return;const{tileInfo:fe,fullExtent:Oe}=ne;(0,Qe.pC)(fe)&&(0,Qe.pC)(Oe)&&((0,Cr.x4)(U)||d.compatibleWith(fe)&&Oe.spatialReference.equals(d.spatialReference))&&(0,Bs.jn)(T,Oe,T)}}),(0,Bs.jn)(T,this.defaultTiledLayersExtent,T);const x=(0,Bs.sU)(T)?T:null,A=this._get("tiledLayersExtent");return(0,Bs.fS)(x,A)?A:x}};function bw(d,_){return(0,Qe.pC)(d)&&!d.spatialReference.equals(_)?(0,di.fi)(d,d.spatialReference,_):d}iO=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.ExtentHelperLocal")],iO);var Bi,Vs=v(75224);!function(d){d[d.ELEVATION=0]="ELEVATION",d[d.MAP=1]="MAP"}(Bi||(Bi={}));const m0=[Bi.ELEVATION,Bi.MAP];var Oc=v(61034),nO=v(64835),yV=v(30993),vV=v(14411);function Cw(){const d=globalThis.require?.modules;if(d){const _=Object.keys(d);for(const T of _)-1!==T.search(".glsl")&&delete d[T]}}const EV=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let kh,xl=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=(0,So.Z)("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||Fo.Z.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return(0,Qe.pC)(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?(0,En.Iu)(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const d=this._view;this.renderer=new nO.CB({view:d,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=(0,Ga.Z8)(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",_=>d._stage?.renderView.setRenderParameters({hasOverlayWater:_})),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),(0,Ht.YP)(()=>[d.pointsOfInterest?.renderPointOfView,d.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),(0,Ht.YP)(()=>d.state?.pixelRatio,()=>this.setPlacementDirty(),Ht.Z_),this.surface.on("elevation-change",()=>this.setPlacementDirty()),d.on("resize",()=>this.setPlacementDirty()),d.resourceController.scheduler.registerTask(Fn.T8.OVERLAY,this),d._stage.renderView.events.on("force-camera-for-screenshot",_=>{this._updateOverlays(_,Fi.Xx.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Fi.Xx.BACKGROUND,_)})]),d._stage?.renderView.setRenderParameters({renderOverlay:_=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(_),this._drawOverlayTextures(this.renderer.overlays,Fi.Xx.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),(0,Qe.pC)(kh)&&(kh.hide(),kh=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(d){this._spatialReference=d,this.renderer.spatialReference=d,this._longitudeCyclical=null;const _=this._view.renderSpatialReference;(0,Qe.pC)(d)&&(0,Qe.pC)(_)?(this._renderSR=_,this._overlaySREqualsRenderSR=d.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=d.isWebMercator?new za.pE(-20037508.342787,20037508.342787):new za.pE(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(d,_,T){this._drapeSources.add(d),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const x=this.renderer.createDrapeSourceRenderer(d,_,T);return this._updateDrapeSourceExtent(d),this._setContentDirty(),this.notifyChange("running"),x}registerGeometryDrapeSource(d){return this.registerDrapeSource(d,vV.S)}_updateDrapeSourceExtent(d){2===this.renderer.overlays.length&&(0,Qe.pC)(d.setDrapingExtent)&&(0,Qe.pC)(this._spatialReference)&&d.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(d){this._drapeSources.has(d)&&(this._drapeSources.delete(d),this.renderer.removeDrapeSourceRenderer(d),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(d){this._drapeTargets.add(d),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this._view._stage?.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(d){this._drapeTargets.delete(d),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this._view.state.camera,Fi.Xx.UPDATE)}_updateOverlays(d,_){if(!this._spatialReference)return;const T=(0,Oc.Jk)(d.fullWidth,d.fullHeight,this._maxResolution);this._computeOverlayExtents(d,T,Nd);const x=(0,Bs.bf)(Nd.inner)/(0,Bs.bf)(Nd.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const A=this._updateOverlay(Vs.fu.INNER,Nd.inner,T,1*Nd.pixelRatioAdjustment,Nd.mapUnitsPerPixel),U=this._updateOverlay(Vs.fu.OUTER,Nd.outer,T,x*Nd.pixelRatioAdjustment,Nd.mapUnitsPerPixel);A!==Gu.EXTENT&&U!==Gu.EXTENT||(this._drapeSources.forEach(ne=>this._updateDrapeSourceExtent(ne)),this.surface.updateTileOverlayParams(_)),A===Gu.NONE&&U===Gu.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(d,_,T,x,A){if(0===this.renderer.overlays.length)return Gu.NONE;const U=this.renderer.overlays[d],ne=U.mapUnitsPerPixel;if(U.mapUnitsPerPixel=A,U.pixelRatio=x,function bV(d,_){const x=Fo.Z.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(d[2]-d[0],d[3]-d[1],_[2]-_[0],_[3]-_[1]);return Math.abs(_[0]-d[0])<=x&&Math.abs(_[1]-d[1])<=x&&Math.abs(_[2]-d[2])<=x&&Math.abs(_[3]-d[3])<=x}(_,U.extent)&&T===U.resolution)return ne===A?Gu.NONE:Gu.RERENDER_ONLY;(0,Bs.JG)(U.extent,_),U.resolution=T;const fe=(0,Bs.be)(U.extent);return U.renderLocalOrigin=(0,yV.a)(fe[0],fe[1],0,"OV_"+this._latestOriginId++),Gu.EXTENT}setTileParameters(d){const _=d.renderData.overlay;if(this.renderer.overlays.length>0){const T=this.renderer.overlays[Vs.fu.INNER],x=this.renderer.overlays[Vs.fu.OUTER],A=d.extent;this._rectInsideRect(T.extent,A)||this._rectanglesOverlap(A,T.extent)||this._rectanglesOverlap(A,x.extent)?(this._setTileOverlayData(A,Vs.fu.INNER,_),this._setTileOverlayData(A,Vs.fu.OUTER,_)):(this._clearTileOverlayData(Vs.fu.INNER,_),this._clearTileOverlayData(Vs.fu.OUTER,_))}else this._clearTileOverlayData(Vs.fu.INNER,_),this._clearTileOverlayData(Vs.fu.OUTER,_)}overlayPixelSizeInMapUnits(d){if(0===this.renderer.overlays.length)return 0;const _=this.renderer.overlays[Vs.fu.INNER],T=this.renderer.overlays[Vs.fu.OUTER],x=this._pointIsInExtent(d,_.extent)?_:T;return(x.extent[2]-x.extent[0])/x.resolution}_setTileOverlayData(d,_,T){if(0===this.renderer.overlays.length)return;const x=this.renderer.overlays[_].extent,A=(0,Bs.bf)(x),U=(0,Bs.Cb)(x);let ne=d[0];if(this._longitudeCyclical){ne=this._longitudeCyclical.minimalMonotonic(x[0],ne);const fe=this._longitudeCyclical.minimalMonotonic(x[0],d[2]);ne>fe&&(ne=fe-(d[2]-d[0]))}T.setScale(_,(0,Bs.bf)(d)/A,(0,Bs.Cb)(d)/U),T.setOffset(_,(ne-x[0])/A,(d[1]-x[1])/U)}_clearTileOverlayData(d,_){_.setScale(d,-1,-1),_.setOffset(d,-1,-1)}reloadShaders(){var d=this;return(0,kr.Z)(function*(){Cw(),yield d.renderer.reloadShaders(),d.setDrawTexturesDirty(),d.runTask()})()}_dispatchAnimationUpdate(d){const _=(0,mi.HA)(d-this._animationTimeLast);d=(0,Qe.Pt)(this._view.state.forcedAnimationTime,d),(_>=this.surface.view._stage.renderView.animationTimestep||(0,Qe.pC)(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({time:d,camera:this._view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=d)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(d,_,T,x){const A=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(d,MV,_,T);if((0,Qe.Wi)(A))return!1;const U=A.origin,ne=(0,pt.a)(ME,A.origin,A.direction);return this._groundIntersector.reset(U,ne,d),this._groundIntersector.intersect([],null),this._view.basemapTerrain.intersect(this._groundIntersector,null,U,ne),this._groundIntersector.results.min.getIntersectionPoint(x)}_findHorizonBasedPointOfInterest(d,_){let T=.5;const x=.55,A=this._view.renderCoordsHelper.getAltitude(d.eye),U=this._view.pointsOfInterest.centerOnSurfaceFrequent,fe=(0,xr.uZ)(U.estimatedSurfaceAltitude,d.aboveGround?-1/0:A+1e-5,d.aboveGround?A-1e-5:1/0),Oe=d.aboveGround;if("global"===this._view.viewingMode){const we=ME;(0,oo.b)((0,oo.e)(oo.t,(0,En.Iu)(this._view.spatialReference).radius+fe),(0,yc.re)(d.eye,d.viewForward),we),(0,pt.b)(we,we,d.eye);const Ze=za.Q4.normalize((0,WP.cp)(d.viewForward,we,d.viewRight))/d.fovY+.5,it=Ze<=0||Ze>=1?.5:x;T=Oe?it*Ze:Ze+it*(1-Ze)}else{const we=.5*Math.PI-Math.acos(-d.viewForward[2]),Ze=Math.tan(we),it=(0,Tn.f)(0,Ze,1,0),lt=(0,Qo.t)(it,it,d.projectionMatrix)[1],dt=(0,xr.uZ)(.5+.5*lt,0,1);T=1===dt||0===dt?.5:Oe?dt*x:1-(1-dt)*x}return!!this._intersectGroundFromView(d,.5,T,_)&&(0,pt.E)(_,d.eye)<U.distance*U.distance}_computeOverlayExtents(d,_,T){const x=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,A=(0,ir.c)();this._findHorizonBasedPointOfInterest(d,A)||(0,pt.c)(A,x);const U=Math.max(.1,(0,pt.i)(d.eye,A)),ne=wh(this._view.renderCoordsHelper,x,d.eye),fe=Math.PI/2-Math.abs(ne-Math.PI/2);Fo.Z.OVERLAY_SHOW_CENTER?((0,Qe.Wi)(kh)&&(kh=new Yh(this._view.graphics,"red")),kh.show(A,this._renderSR)):(0,Qe.pC)(kh)&&kh.hide(),this._overlaySREqualsRenderSR||(0,di.SH)(A,this._renderSR,A,this._spatialReference);const Oe=this.surface.extent,we=!this._isSpherical&&(0,Qe.pC)(this._spatialReference)&&this._spatialReference.isGeographic,Ze=we&&(0,Qe.pC)(this._spatialReference)?1/(0,En.Iu)(this._spatialReference).metersPerDegree:1,it=d.perRenderPixelRatio*U*Ze;T.mapUnitsPerPixel=it/this._worldToPCSRatio;let lt=_*it/2,dt=!1,Tt=we?90:1/0;this._isSpherical&&(0,Qe.pC)(Oe)&&(0,Qe.pC)(this._spatialReference)&&(this._spatialReference.isWebMercator?(lt/=Math.cos((0,au.mZ)(A[1])),Tt=Oe[3]):(dt=!0,lt/=(0,En.Iu)(this._spatialReference).metersPerDegree,Tt=90),lt>=Tt&&(lt=Tt,A[1]=0,this._spatialReference.isWebMercator&&(A[0]=0)));let mt=1;dt&&(mt=1/Math.max(.2,Math.cos(Math.abs((0,xr.Vl)(A[1])))),lt*mt>180&&(mt=180/lt),T.mapUnitsPerPixel*=mt);const Mt=Math.log(2)/12;lt=Math.exp(Math.round(Math.log(lt)/Mt)*Mt);const Pt=lt*mt,Bt=.5*_/(32*Pt),Zt=.5*_/(32*lt);A[0]=Math.round(A[0]*Bt)/Bt,A[1]=Math.round(A[1]*Zt)/Zt;const nr=T.inner;nr[0]=A[0]-Pt,nr[1]=A[1]-lt,nr[2]=A[0]+Pt,nr[3]=A[1]+lt,this._isSpherical&&this._shiftExtentToFitBounds(nr,1/0,Tt);const Jt=T.outer;if(6*Pt>(0,Bs.bf)(Oe))(0,Bs.JG)(Jt,(0,Qe.Wg)(Oe));else if(fe<=.25*Math.PI)Jt[0]=nr[0]-Pt,Jt[1]=nr[1]-lt,Jt[2]=nr[2]+Pt,Jt[3]=nr[3]+lt;else{(0,di.SH)(d.eye,this._renderSR,ME,this._spatialReference),(0,ti.a)(g0,A,ME);let Br=-Math.atan2(g0[1],g0[0])+.125*Math.PI;Br<0&&(Br+=2*Math.PI);const $r=Math.floor(Br/(.25*Math.PI));(0,Qo.b)(g0,EV[$r],2*lt),g0[0]*=mt,g0[2]*=mt,(0,Qo.a)(Jt,nr,g0)}if(this._isSpherical)Jt[0]=this._longitudeCyclical.clamp(Jt[0]),Jt[2]=this._longitudeCyclical.clamp(Jt[2]),Jt[1]=Math.max(Jt[1],-Tt),Jt[3]=Math.min(Jt[3],Tt);else{const Br=(0,Bs.jV)(nr,Oe,CV),$r=(0,Bs.jV)(Jt,Oe,TV);(0,Bs.r3)(Br,$r)&&(Jt[2]=Jt[0],Jt[3]=Jt[1])}const Rr=Math.abs(nr[2]-nr[0])/_;T.mapUnitsPerPixel=Math.max(T.mapUnitsPerPixel,Rr),T.pixelRatioAdjustment=T.mapUnitsPerPixel/Rr}_drawOverlayTextures(d,_,T=this._view.state.camera){if(0===d.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const x=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const A=this._drawOverlay(d[Vs.fu.INNER],T),U=this._drawOverlay(d[Vs.fu.OUTER],T);A!==Fi.Yg.CHANGED&&U!==Fi.Yg.CHANGED||this.surface.updateTileOverlayParams(Fi.Xx.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),x?(this.surface.requestRender(_),_===Fi.Xx.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Fi.Xx.BACKGROUND)}_drawOverlay(d,_){return this._longitudeCyclical?d.setupGeometryViewsCyclical(this._longitudeCyclical):d.setupGeometryViewsDirect(),d.draw(this.renderer,_.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const d=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(d)}}_rectanglesOverlap(d,_){return!(0,Qe.Wi)(d)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(_[0],_[2],d[0])||this._longitudeCyclical.contains(_[0],_[2],d[2])||this._longitudeCyclical.contains(d[0],d[2],_[0]))&&!(d[1]>_[3]||d[3]<_[1]):(0,Bs.kK)(d,_))}_rectInsideRect(d,_){return!(0,Qe.Wi)(_)&&(this._longitudeCyclical?this._longitudeCyclical.contains(d[0],d[2],_[0])&&this._longitudeCyclical.contains(d[0],d[2],_[2])&&_[1]>d[1]&&_[3]<d[3]:(0,Bs.r3)(d,_))}_pointIsInExtent(d,_){if(this._longitudeCyclical)return this._longitudeCyclical.contains(_[0],_[2],d.x)&&d.y>=_[1]&&d.y<=_[3];const T=d.x,x=d.y;return T>_[0]&&T<_[2]&&x>_[1]&&x<_[3]}_shiftExtentToFitBounds(d,_,T){let x=0,A=0;d[0]<-_?x=d[0]+_:d[2]>_&&(x=_-d[2]),d[1]<-T?A=d[1]+T:d[3]>T&&(A=T-d[3]),(0,Bs.cv)(d,x,A)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};(0,Ve._)([(0,ke.Cb)()],xl.prototype,"_spatialReference",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],xl.prototype,"running",null),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"_placementDirty",void 0),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"_contentUpdated",void 0),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"_isSpherical",null),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"_worldToPCSRatio",null),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"renderer",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],xl.prototype,"surface",void 0),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"suspended",null),(0,Ve._)([(0,ke.Cb)()],xl.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({type:Boolean})],xl.prototype,"hasHighlights",null),(0,Ve._)([(0,ke.Cb)({type:Boolean})],xl.prototype,"rendersOccluded",null),xl=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.OverlayManager")],xl);const g0=(0,Tn.c)(),ME=(0,ir.c)(),Nd={inner:(0,Bs.Ue)(),outer:(0,Bs.Ue)(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},CV=(0,Bs.Ue)(),TV=(0,Bs.Ue)(),MV=(0,yc.Ue)();var Gu;!function(d){d[d.NONE=0]="NONE",d[d.EXTENT=1]="EXTENT",d[d.RERENDER_ONLY=2]="RERENDER_ONLY"}(Gu||(Gu={}));let PV=(()=>{class d{constructor(T,x){this._factoryCallback=T,this._lengthCallback=x,this._pool=new Map}acquire(T){if(!d.test.disabled){const x=this._pool.get(T);if(x&&0!==x.length)return x.pop()}try{return this._factoryCallback(T)}catch(x){const A=window.performance&&window.performance.memory;let U="";throw A&&(U=`\n  totalJSHeapSize: ${A.totalJSHeapSize}, usedJSHeapSize: ${A.usedJSHeapSize}, jsHeapSizeLimit: ${A.jsHeapSizeLimit}`),console.log("Array allocation of size "+T+" failed: "+x+U),x}}release(T){if(d.test.disabled)return;const x=this._lengthCallback(T);let A=this._pool.get(x);A||(A=new wo.Z({shrink:!0}),this._pool.set(x,A)),A.push(T)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}return d.test={disabled:!1},d})();class OV{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=(0,fo.cS)(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class Tw{constructor(_,T,x,A,U){this.attributes=_,this.localOrigin=T,this.index0=x,this.stride=A,this.count=U}getVertexIndex(_){return this.getAttributeIndex(_)}getAttributeIndex(_){return(0,Cr.Fp)(0<=_&&_<this.count),this.index0+this.stride*_}_getVertexRaw(_,T){this.attributes.position.getVec(_,T)}_getNormalRaw(_,T){this.attributes.normalCompressed.getVec(_,T)}getVertexPos(_,T){this._getVertexRaw(this.getAttributeIndex(T),_),(0,pt.a)(_,_,this.localOrigin)}getNormal(_,T){const x=(0,un.a)();this._getNormalRaw(this.getAttributeIndex(T),x),function AV(d,_){const T=xw(_[0]),x=xw(_[1]),A=1-Math.abs(T)-Math.abs(x);d[2]=A,A<0?(d[0]=(T>=0?1:-1)*(1-Math.abs(x)),d[1]=(x>=0?1:-1)*(1-Math.abs(T))):(d[0]=T,d[1]=x),(0,pt.n)(d,d)}(_,x)}_setNormal(_,T,x,A){Qg(this.attributes.normalCompressed,_,T,x,A)}_setUV(_,T,x){ql(this.attributes.uv0,_,T,x)}setNormalFromValues(_,T,x,A){this._setNormal(this.getAttributeIndex(_),T,x,A)}setVertexFromValuesRawPositionUV(_,T,x,A,U,ne){const fe=this.getAttributeIndex(_);this.attributes.position.setValues(fe,T,x,A),this._setUV(fe,U,ne)}setVertexFromValuesRawPositionUVNormal(_,T,x,A,U,ne,fe,Oe,we){const Ze=this.getAttributeIndex(_);this.attributes.position.setValues(Ze,T,x,A),this._setUV(Ze,U,ne),this._setNormal(Ze,fe,Oe,we)}}const xV=(0,Xp.U$)().vec3f(Qi.T.POSITION).vec2i16(Qi.T.UV0).vec2i16(Qi.T.NORMALCOMPRESSED,{glNormalized:!0}),oO=new PV(d=>xV.createBuffer(d),d=>d.count);function Mw(d){return oO.acquire(d)}function Qg(d,_,T,x,A){const U=1/(Math.abs(T)+Math.abs(x)+Math.abs(A)),ne=T*U,fe=x*U,Oe=A<=0?(ne>=0?1:-1)*(1-Math.abs(fe)):ne,we=A<=0?(fe>=0?1:-1)*(1-Math.abs(ne)):fe;d.setValues(_,Ow(Oe),Ow(we))}function ql(d,_,T,x){d.setValues(_,16384*T,16384*x)}function Ow(d){return(0,xr.uZ)(Math.round(32767*d),-32767,32767)}function xw(d){return(0,xr.uZ)(d/32767,-1,1)}function al(d,_,T,x){d<x[0]?x[0]=d:d>x[3]&&(x[3]=d),_<x[1]?x[1]=_:_>x[4]&&(x[4]=_),T<x[2]?x[2]=T:T>x[5]&&(x[5]=T)}class PE{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class wV{constructor(){this.cornerNeighborData=[new PE,new PE,new PE,new PE],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}}class IV{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new wV}}class ef{constructor(_){this._getFadeDuration=_,this._fadeStart=0,this._delayedTime=0}clear(){this._current=(0,Qe.SC)(this._current),this._next=(0,Qe.SC)(this._next),this._waiting=(0,Qe.SC)(this._waiting),this._delayed=(0,Qe.SC)(this._delayed)}get current(){if((0,Qe.Wi)(this._current))return null;if(!this._isFadingEnabled){const T=this._delayed||this._waiting||this._next||this._current;T!==this._current&&(this._current=null,this.clear(),this._current=T)}let _=ef.test.fadeMoment;if((0,Qe.pC)(this._delayed)&&(_=_||performance.now(),_>=this._delayedTime&&(this._push(this._delayed,Wd.Immediate),this._delayed=null)),(0,Qe.pC)(this._next)){_=_||performance.now();const T=this._fadeDuration,x=(0,Qe.pC)(this._current)&&this._next.texture===this._current.texture,A=this._next.type!==Vs.Ns.FADING,U=_-this._fadeStart>=T;(x||A||U)&&((0,Qe.SC)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(_))}return this._current}get next(){return this._next}get fadeFactor(){if((0,Qe.Wi)(this._next))return 1;const _=ef.test.fadeMoment||performance.now(),T=Math.max(0,_-this._fadeStart),x=this._fadeDuration;return T>x?0:1-T/x}get isFading(){return(0,Qe.pC)(this._next)||(0,Qe.pC)(this._delayed)}push(_,T=Wd.Immediate){this._delayed=(0,Qe.SC)(this._delayed),this._push(_,T)}_push(_,T){if(this._isFadingEnabled||this.clear(),(0,Qe.Wi)(this._current))return void(this._current=_);const x=ef.test.fadeMoment||performance.now();return T!==Wd.Immediate?(this._delayed=_,void(this._delayedTime=x+T)):(0,Qe.Wi)(this._next)?(this._next=_,void(this._fadeStart=this._alignFadeStart(x))):void((0,Qe.Wi)(_)||((0,Qe.SC)(this._waiting),this._waiting=_))}get _fadeDuration(){return(0,Qe.Wi)(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(_){const T=this._getFadeDuration();return _+T-_%T}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Wd;ef.test={fadeMoment:0},function(d){d[d.Immediate=0]="Immediate",d[d.Delayed=5e3]="Delayed"}(Wd||(Wd={}));var OE=v(39863),Ko=v(15076);class aO{get updating(){return!!this._tileRequested}init(_,T,x,A){this.tile=_,this._layerIdx=T,this._layerClass=x,this._suspended=A,this._tileLayerInfo=_.getLayerInfo(T,x),this._tileRequested=null;const U=this._findAncestorWithData();this._setUpsampleTile(U)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(_){_!==this._suspended&&(this._suspended=_,_?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const _=this._findAncestorWithData();return this._setUpsampleTile(_),this._requestNext()}dataArrived(_){this._setUpsampleTile(_),this._tileRequested=null,_===this.tile?this.tile.updateRenderData(this._layerClass,Vs.Ns.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const _=this._findNextDownload();if(this._tileRequested){if(_===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return(0,Qe.pC)(_)?_.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=_):this._agentDone(),!!this._tileRequested}_findNextDownload(){const _=this._layerIdx,T=this._layerClass,x=this.tile.surface.layerViewByIndex(_,T),A=(0,Cr.RB)(x),{minLevel:U,maxLevel:ne}=x.dataLevelRange,fe=this._desiredMinLevelDelta,Oe=this._progressiveLevelModulo+fe,we=this._scaleRangeEnabled?Ko.yf:()=>!0;let Ze=this.tile;const it=Ze.level;let lt;const dt=this._tileLayerInfo.upsampleInfo,Tt=(0,Qe.pC)(dt)?dt.tile.level:-1,mt=!!(0,Qe.pC)(dt)&&Tt-it>=fe,Mt=(0,Qe.U2)(A,"tilemapCache");for(;Ze&&we(Ze,A,!1)&&Ze.level>=U;){const Pt=Ze.level,Nt=it-Pt,Bt=Ze.layerInfo[T][_];if(Bt.data&&Nt>=fe){(!mt||Pt>Tt)&&this._setUpsampleTile(Ze),Bt.dataInvalidated&&(lt=Ze);break}if(((0,Qe.Wi)(Mt)||"unavailable"!==Mt.getAvailability(Ze.lij[0],Ze.lij[1],Ze.lij[2]))&&Pt<=ne&&!Bt.data&&!Bt.dataMissing&&(((0,Qe.Wi)(lt)||Ze.level===U||Pt%po.Sx==0||it-lt.level<fe)&&(lt=Ze),Nt>=Oe))break;Ze=Ze.parent}return(0,Qe.pC)(lt)&&it-lt.level<fe&&this._tileLayerInfo.upsampleInfo&&(lt=null),lt}_findAncestorWithData(){const _=this.tile.vlevel,T=this._desiredMinLevelDelta;let x;for(let A=this.tile;A;A=A.parent)if(A.hasLayerData(this._layerIdx,this._layerClass)){if(_-A.level>=T)return A;x=A}return x}_setUpsampleTile(_){this._tileLayerInfo.setUpsampleInfo(this.tile,_),this.tile.updateRenderData(this._layerClass,Vs.Ns.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}const Dw=new Error("Abstract method called on TileAgent"),ec=new class LV extends aO{get _desiredMinLevelDelta(){throw Dw}get _progressiveLevelModulo(){throw Dw}dispose(){}};class Sw extends aO{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return(0,po.L)(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class Aw extends aO{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return po.Sx}}var UV=v(80382);class xE{constructor(){this.waitingAgents=new wo.Z,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(_){const T=lO.acquire();return T._init(_),T}release(){this.dispose(),DE.delete(this),lO.release(this)}dispose(){this.loadingAgent=(0,Qe.M2)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=(0,Cr.z4)(this._data)}static prune(){lO.prune(0)}_init(_){this.waitingAgents.clear(),this._data=(0,Cr.z4)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=_,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=(0,Qe.IM)(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){(0,Qe.pC)(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(_,T){if(_===T||(0,Qe.Wi)(T))this._unsetUpsampleInfo();else{if((0,Qe.Wi)(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===T)return;this._upsampleInfo.tile.unrefMapData()}T.refMapData(),(0,Ko.QT)(_,T,this._upsampleInfo)}}get data(){return this._data}set data(_){(0,Cr.z4)(this._data),this._data=_}}const lO=new Wu.Z(xE,null,()=>{}),DE=new Map;class tf{constructor(_){this._texture=_,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var ni;!function(d){d[d.NONE=0]="NONE",d[d.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",d[d.SPLIT=2]="SPLIT",d[d.VSPLITMERGE=4]="VSPLITMERGE",d[d.MERGE=8]="MERGE",d[d.RENDERDATA=16]="RENDERDATA",d[d.GEOMETRY=32]="GEOMETRY",d[d.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",d[d.TEXTURE_FADING=128]="TEXTURE_FADING"}(ni||(ni={}));const cO=(0,ir.c)(),rf=(0,ir.c)(),va=(0,ir.c)();class FV{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class uO{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=(0,Bs.Ue)(),this._elevationBounds=(0,un.a)(),this.layerInfo=[[],[]],this.extentInRadians=(0,Bs.Ue)(),this.centerAtSeaLevel=(0,ir.c)(),this._center=[(0,ir.c)(),(0,oo.c)(),(0,ir.c)()],this.up=(0,ir.u)(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0}static prune(){dO.prune(0),hO.prune(0),xE.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ll.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const _=this.parent?.frustumVisibility??Vs.ir.INTERSECTS;this._frustumVisibility=_===Vs.ir.INSIDE?Vs.ir.INSIDE:_===Vs.ir.OUTSIDE?Vs.ir.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const T=this._frustumVisibility!==Vs.ir.OUTSIDE&&this._intersectsClippingArea;T!==this._visible&&(this._visible=T,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const _=!!this.renderData;return _!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=_,this._surface.renderer.setDirty()),_}get shouldLoad(){const _=this._surface.snapLevel;if((0,Qe.pC)(_)){const T=this.level-_;if(0===T)return!0;if(1===T)return!1}return this.isLeaf}init(_,T,x){this.lij[0]=_[0],this.lij[1]=_[1],this.lij[2]=_[2],this.ellipsoid=(0,En.Iu)(x.tilingScheme.spatialReference),x.tilingScheme.getExtent(_[0],_[1],_[2],this.extent),x.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,x.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ll.MIDDLE][3]=0,this.vlevel=_?_[0]:0,T&&T.elevationBounds?(0,ti.c)(this._elevationBounds,T.elevationBounds):(0,ti.s)(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=T,this.unsetChildren(),this._surface=x,this.updateVisibility();for(const A of m0){const U=x.numLayers(A),ne=this.layerInfo[A];for(const fe of ne)fe.release();ne.length=U;for(let fe=0;fe<U;fe++)ne[fe]=xE.acquire(this._surface.upsampleInfoPool),A===Bi.ELEVATION&&this.findElevationBoundsForLayer(fe,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(x.tilingScheme.pixelSize,po.HB)}release(){(0,Cr.wu)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const _ of m0){for(const T of this.layerInfo[_])T.release();this.layerInfo[_].length=0}this._parent=null;for(let _=0;_<4;++_)this._children[_]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const _=this._cachedMemory;_>0&&this._surface.upsampleMapCache.put(this.key,this,_)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Bi.MAP].reduce((_,T)=>_+(T instanceof TE.i?T.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const T=this._surface.tilingScheme.pixelSize;return T*T*4}_ensureUsedMemory(){if((0,Qe.pC)(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let _=0;for(const{data:x}of this.layerInfo[Bi.MAP])x instanceof TE.i?_+=this._getTerrainDataMemory(x):this._mapTileMemoryInternal+=this._getTerrainDataMemory(x);const T=this._cpuImageMemorySize;for(const x of this.layerInfo[Bi.ELEVATION])this._usedMemory+=x.data?T:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=(0,No.un)(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+_),this._usedMemory}getUsedMemoryForLayer(_,T){const x=this.layerInfo[_][T];return x?.data?_===Bi.MAP?this._isCached?0:this._getTerrainDataMemory(x.data):_===Bi.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(_){return _ instanceof tf?(0,No.un)(_.texture):_ instanceof HTMLImageElement||_ instanceof tO.nN?this._cpuImageMemorySize:_ instanceof TE.i||_ instanceof UV.H?_.memoryUsage:0}updateScreenDepth(_){const T=this._center[ll.MIDDLE],A=T[0],U=T[1],ne=T[2],fe=_[2]*A+_[6]*U+_[10]*ne+_[14];this._screenDepth=fe<0?0:fe/(_[3]*A+_[7]*U+_[11]*ne+_[15])}shouldSplit(_,T,x){if(!this.visible||(0,Qe.pC)(_.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(_.frustum)===Vs.ir.OUTSIDE))return ni.NONE;const A=this.level;(0,pt.b)(cO,this._center[ll.MIDDLE],T);let U=(0,pt.p)(cO),ne=ll.MIDDLE;(0,pt.b)(rf,this._center[ll.TOP],T);const fe=(0,pt.p)(rf);fe<U&&(U=fe,ne=ll.TOP),(0,pt.b)(rf,this._center[ll.BOTTOM],T);const Oe=(0,pt.p)(rf);if(Oe<U&&(U=Oe,ne=ll.BOTTOM),this._edgeLen2>U&&A<_.maxLod)return ni.SPLIT;const we=Math.sqrt(U),it=this._edgeLen/(_.fovX*we*2),lt=()=>{const Mt=A+Math.ceil(-Math.log2(_.relativeWidthLimit/it));return Mt!==this.vlevel?(this.vlevel=Mt,ni.VSPLITMERGE):ni.NONE_HIT_MAXLOD};if((0,Qe.pC)(x)&&x-A==1)return A>=_.maxLod?lt():ni.SPLIT;const dt=(0,pt.e)(this.up,cO),Tt=this._elevationBounds[1]-this._elevationBounds[0],mt=Tt/this.edgeLen;if(_.aboveGround&&dt>0&&mt<.001&&dt/we-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-mt>0)return ni.NONE;if(it<_.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,ni.VSPLITMERGE):ni.NONE;if(A>=_.maxLod)return lt();if(A>6){(0,pt.b)(rf,this._center[ne],T),(0,pt.g)(va,this.up,dt),(0,pt.b)(va,va,rf);const Mt=(0,pt.p)(va);if(Mt>this.radius*this.radius&&((0,pt.g)(va,va,this.radius/Math.sqrt(Mt)),(0,pt.a)(va,va,this._center[ne]),(0,pt.b)(va,T,va),Math.min(1,(Math.abs((0,pt.e)(va,this.up))+.5*Tt+this._curvatureHeight)/(0,pt.l)(va))*(this._edgeLen/(_.fovY*we*2))<.1/_.angledSplitBias*_.relativeHeightLimit))return ni.NONE}return ni.SPLIT}setChildren(_,T,x,A){(0,Cr.wu)(!!(_&&T&&x&&A),"Null child passed"),this._children[0]=_,this._children[1]=T,this._children[2]=x,this._children[3]=A}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const _ of m0)this._createOrUpdateAgents(0,_);this.surface.renderer.loadTile(this)}unload(_){_.unloadTile(this);for(const T of m0){const x=this.layerInfo[T];for(const A of x)A.loadingAgent&&A.loadingAgent!==ec&&(SE(A.loadingAgent),A.loadingAgent=null),A.pendingUpdates=0}this.resetPendingUpdate(ni.GEOMETRY),this.resetPendingUpdate(ni.TEXTURE_NOFADING),this.resetPendingUpdate(ni.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const _=this.layerInfo[Bi.MAP];for(const T of _)T.loadingAgent&&T.loadingAgent!==ec&&(SE(T.loadingAgent),T.loadingAgent=null),T.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(_){if((0,Bs.fS)(_,this._clippingArea))return!1;const T=this._intersectsClippingArea,x=this._isWithinClippingArea;return(0,Qe.pC)(_)?(this._intersectsClippingArea=this.intersectsExtent(_),this._isWithinClippingArea=this._isWithinExtent(_)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=_,this.updateVisibility(),!this.renderData||x&&this._isWithinClippingArea||!(x||T||this._isWithinClippingArea||this._intersectsClippingArea)||this.setPendingUpdate(ni.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(_,T){return this.layerInfo[T][_]}hasLayerData(_,T){const x=this.layerInfo[T][_];return!(!x||!x.data||x.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const _ of m0){const T=this.layerInfo[_];for(const x of T)if(x.loadingAgent&&x.loadingAgent!==ec&&x.loadingAgent.updating)return!0}return!1}_isSuspended(_){return!!this.hasPendingUpdate(ni.SPLIT)||_!==Bi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(_){return(this._pendingUpdates&_)===_}setPendingUpdate(_){this._pendingUpdates|=_,_===ni.SPLIT||_===ni.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(_){return!!this.hasPendingUpdate(_)&&(this._pendingUpdates&=~_,!0)}requestLayerData(_,T,x){const A=this.layerInfo[T][_];if(A.waitingAgents.has(x))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),x.tile.lij.toString(),T,_),!0;if(A.waitingAgents.push(x),A.data&&!A.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),x.tile.lij.toString(),T,_),x.dataArrived(this),!0;if(A.requestPromise)return!0;(0,Qe.IM)(A.requestAbort),A.requestAbort=new AbortController;const U=this._surface.requestTileData(this,_,T,A.requestAbort);if(!U)return A.requestAbort=null,!1;const ne=()=>{A.requestPromise===U&&(A.requestPromise=null,A.requestAbort=null)};return A.requestPromise=U,U.then(ne,ne),!0}get isLeaf(){return null==this._children[0]}hasLij(_){return this.lij[0]===_[0]&&this.lij[1]===_[1]&&this.lij[2]===_[2]}findByLij(_){return this.hasLij(_)?this:this.isLeaf?null:this._children[0].findByLij(_)||this._children[1].findByLij(_)||this._children[2].findByLij(_)||this._children[3].findByLij(_)||null}distanceToSquared(_){return(0,pt.p)((0,pt.b)(va,this._center[ll.MIDDLE],_))}containsPoint(_){const T=this.extent;return _[0]>=T[0]&&_[1]>=T[1]&&_[0]<=T[2]&&_[1]<=T[3]}containsPointXY(_,T){const x=this.extent;return _>=x[0]&&T>=x[1]&&_<=x[2]&&T<=x[3]}unrequestLayerData(_,T,x){const A=this.layerInfo[T][_],U=A.waitingAgents,ne=null!=U.removeUnordered(x);(0,Cr.wu)(ne,"agent has not requested this piece of map data"),U.length<1&&(A.abortRequest(),this.setMemoryDirty())}dataArrived(_,T,x){const A=this.layerInfo[T][_];A.data=x,A.dataInvalidated=!1,A.waitingAgents.forAll(U=>U.dataArrived(this)),A.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(_,T,x){x.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${T}/${_} error ${x}`);const A=this.layerInfo[T][_];A.dataMissing=!0,A.waitingAgents.forAll(U=>U.dataMissing()),A.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(_,T){switch(_){case Bi.MAP:return this._updateTexture(T);case Bi.ELEVATION:return this._updateGeometry()}}_updateTexture(_){this.renderData&&(this.resetPendingUpdate(_===Vs.Ns.FADING?ni.TEXTURE_NOFADING:ni.TEXTURE_FADING),this.setPendingUpdate(_===Vs.Ns.FADING?ni.TEXTURE_FADING:ni.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ni.GEOMETRY);for(const _ of this.layerInfo[Bi.ELEVATION])_.pendingUpdates|=ni.GEOMETRY}invalidateLayerData(_,T){this.layerInfo[T][_].invalidateSourceData(),this.restartAgents(T)}computeElevationBounds(){const _=this._elevationBounds;(0,ti.s)(_,1/0,-1/0);const T=this.layerInfo[Bi.ELEVATION];let x=!0;for(const A of T)(0,Qe.pC)(A.elevationBounds)&&(_[0]=Math.min(_[0],A.elevationBounds.min),_[1]=Math.max(_[1],A.elevationBounds.max),A.elevationBounds.hasNoDataValues||(x=!1));x&&(_[0]=Math.min(_[0],0),_[1]=Math.max(_[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const _=this._elevationBounds;(0,pt.g)(va,this.up,.5*(_[0]+_[1])),(0,pt.a)(this._center[ll.MIDDLE],this.centerAtSeaLevel,va),(0,pt.g)(va,this.up,_[0]),(0,pt.a)(this._center[ll.TOP],this.centerAtSeaLevel,va),(0,pt.g)(va,this.up,_[1]),(0,pt.a)(this._center[ll.BOTTOM],this.centerAtSeaLevel,va)}findElevationBoundsForLayer(_,T){const x=this.layerInfo[Bi.ELEVATION][_];if((0,Qe.pC)(x.elevationBounds)&&x.elevationBounds.level>=T)return;const A=this._surface.layerViewByIndex(_,Bi.ELEVATION),U=(0,Cr.RB)(A);if(!(0,Ko.yf)(this,U,!1))return;const ne=WV;let fe=!1;if(x.data){const Oe=x.data;ne.min=Oe.bounds[0],ne.max=Oe.bounds[1],ne.hasNoDataValues=Oe.hasNoDataValues,ne.level=this.level,fe=!0}else{let Oe,we,Ze=0;for(let it=this._parent;it&&(!we||Ze<(0,po.L)(this.level))&&(Ze=this.vlevel-it.level,Oe=we||Oe,we=it.layerInfo[Bi.ELEVATION][_].data,!(!we&&Oe&&Ze>=(0,po.L)(this.level)));it=it.parent);we=we||Oe,we&&(we.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],ne),ne.min!==1/0&&(ne.level=we.level,fe=!0))}fe&&((0,Qe.Wi)(x.elevationBounds)&&(x.elevationBounds=new q_),x.elevationBounds.copyFrom(ne))}modifyLayers(_,T,x){const A=this.layerInfo[x];for(const fe of A)fe.loadingAgent&&fe.loadingAgent!==ec&&(SE(fe.loadingAgent),fe.loadingAgent=null),fe.waitingAgents.clear();for(let fe=0;fe<A.length;++fe)void 0===_[fe]&&A[fe].release();const U=new Array(...A),ne=T.length;A.length=ne;for(let fe=0;fe<ne;fe++){const Oe=T[fe];A[fe]=Oe>-1?U[Oe]:xE.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(_){this.renderData&&(this._createOrUpdateAgents(0,_),this.updateRenderData(_,Vs.Ns.FADING))}updateAgents(_){if(this.renderData){const T=this.layerInfo[_];for(const x of T)x.loadingAgent===ec&&(x.loadingAgent=null);this._createOrUpdateAgents(0,_)}}updateAgentSuspension(){for(const _ of m0){const T=this._isSuspended(_);for(const x of this.layerInfo[_])x.loadingAgent&&x.loadingAgent!==ec&&(x.loadingAgent.setSuspension(T),x.loadingAgent===ec&&this.updateRenderData(_,Vs.Ns.FADING))}}removeLayerAgent(_,T){const x=this.layerInfo[T][_];x.loadingAgent&&x.loadingAgent!==ec&&x.loadingAgent.dispose(),x.loadingAgent=null}agentDone(_,T){const x=this.layerInfo[T][_];x.loadingAgent=ec,!x.data&&(0,Qe.Wi)(x.upsampleInfo)&&this._createOrUpdateAgents(_+1,T)}_hasBlendableAncestor(_){return"normal"!==_.blendMode||(0,Cr.CY)(_.parent)&&this._hasBlendableAncestor(_.parent)}_hasBlendModes(_,T,x){for(let A=_;A<T;++A){const U=this._surface.layerViewByIndex(A,x);if((0,Cr.TK)(U)&&"normal"!==U?.layer?.blendMode||(0,Cr.CY)(U?.layer?.parent)&&this._hasBlendableAncestor(U?.layer?.parent))return!0}return!1}_createOrUpdateAgents(_,T){const x=this.layerInfo[T];if(0===x.length)return;const A=this._isSuspended(T);for(let U=_;U<x.length;++U){const ne=x[U];let fe=!1;const Oe=this._surface.layerViewByIndex(U,T),we=(0,Cr.RB)(Oe);if(ne.loadingAgent?(0,Ko.yf)(this,we,!1)?(ne.loadingAgent!==ec&&ne.loadingAgent.setSuspension(A),ne.loadingAgent!==ec&&(fe=ne.loadingAgent.update())):ne.dispose():(0,Ko.yf)(this,we,!1)&&(ne.loadingAgent=NV(this,U,T,A),fe=ne.loadingAgent.startLoading(),fe?ne.loadingAgent===ec&&this.setPendingUpdate(ni.GEOMETRY):(SE(ne.loadingAgent),ne.loadingAgent=ec)),ne.loadingAgent===ec&&this.updateRenderData(T,Vs.Ns.FADING),!this._hasBlendModes(_,x.length,T)&&fe&&Oe.isOpaque)return}}_isWithinExtent(_){const T=this.extent;return T[0]>=_[0]&&_[2]>=T[2]&&T[1]>=_[1]&&_[3]>=T[3]}intersectsExtent(_){const T=this.extent;return T[2]>=_[0]&&_[2]>=T[0]&&T[3]>=_[1]&&_[3]>=T[1]}getElevationBasedVerticesPerSide(_){const T=this.vlevel-this.level,x=Math.max(this.level-_,(0,po.L)(this.level)-T);return(0,xr.uZ)(1+(this.maxTesselation>>x),2,this.maxTesselation+1)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(_,T){if(!_)return null;const x=this.surface.rootTiles;if((0,Qe.pC)(x))for(const A of x)if(VV(A,_)){let U=A,ne=_[0]-U.level-1;for(;ne>=0&&!U.isLeaf&&!T(U);)U=U.children[2*(_[1]>>ne&1)+(_[2]>>ne&1)],ne--;return T(U)?U:null}return null}findNeighborTile(_,T){const x=this.lij,A=this.getNeighborLIJ(x,_);return A?function zV(d,_){return d[0]===_[0]&&d[1]===_[1]&&d[2]===_[2]}(x,A)?T(this)?this:null:this._findLIJ(A,T):null}findCorner(_,T){const x=_===Vs.Xo.NORTH_EAST?1:_===Vs.Xo.NORTH_WEST?0:_===Vs.Xo.SOUTH_WEST?2:3;let A=this;for(;!(A.isLeaf||T&&T(A));)A=A.children[x];return A}findNeighborCornerTileExact(_,T){return this.findNeighborTile(_,x=>T(x)||x.level===this.level)?.findCorner((0,Cr.$v)(_),T)}forAllSubtreeOnSide(_,T){const x=_===Vs.Xo.NORTH?[0,1]:_===Vs.Xo.NORTH_EAST?[1]:_===Vs.Xo.EAST?[1,3]:_===Vs.Xo.SOUTH_EAST?[3]:_===Vs.Xo.SOUTH?[2,3]:_===Vs.Xo.SOUTH_WEST?[2]:_===Vs.Xo.WEST?[0,2]:[0],A=U=>{T(U)||U.isLeaf||x.forEach(ne=>A(U.children[ne]))};A(this)}forallNeighbors(_){Cr.cA.forEach(T=>this.findNeighborCornerTileExact(T,_)),Cr.OC.forEach(T=>this.findNeighborTile(T,x=>x.level===this.level||_(x))?.forAllSubtreeOnSide((0,Cr._F)(T),_))}getNeighborEdgeStartVertexIndex(_,T){if(!T)return 0;const x=this.level-T.level;if((0,Cr.Fp)(!Cr.jt||x>=0),0===x)return 0;const A=2**x,U=1==(1&_),ne=U?0:1,fe=T.lij[ne+1]*A,Oe=this.lij[ne+1],we=Oe-fe,Ze=U?A-1-we:we;return Cr.jt&&((0,Cr.Fp)(fe<=Oe&&Oe<fe+A),(0,Cr.Fp)(0<=Ze&&Ze<A)),Ze}forEachLoadedNeighbor(_){const T=this.level,x=A=>A.level===T||A.isLoaded;Cr.OC.forEach(A=>{const U=this.findNeighborTile(A,x);null!=U&&U!==this&&U.forAllSubtreeOnSide((0,Cr._F)(A),ne=>!!ne.isLoaded&&(_(ne,A),!0))}),Cr.cA.forEach(A=>{const U=this.findNeighborTile(A,x)?.findCorner((0,Cr.$v)(A),ne=>ne.isLoaded);(0,Cr.Fp)(!U||pO(this,U,A)),U?.isLoaded&&_(U,A)})}getNeighborLIJ(_,T){const x=(0,Cr.Mw)(T)?-1:(0,Cr.uv)(T)?1:0,A=(0,Cr.OD)(T)?-1:(0,Cr.Eu)(T)?1:0,U=[_[0],_[1]+x,_[2]+A];return U[1]<0?null:this.surface.isGlobal?this.wrapLIJ(U):U[2]<0?null:U}wrapLIJ(_){return!_||_[1]<0||_[1]>=2**_[0]?null:this.surface.wrapEastWest(_)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){return this.extent[1]+(0,OE.g)()>=this.surface.extent[1]}compareLIJs(_){const T=this.lij,x=T[0],A=_[0];if(x===A)return[T,_];const U=x-A;if(U<0){const ne=2**-U;return[[A,T[1]*ne,T[2]*ne],_]}{const ne=2**U;return[T,[x,_[1]*ne,_[2]*ne]]}}checkGeometryWaterproofness(){Cr.XJ&&((0,Cr.Fp)(this.isLoaded),this.renderData.checkGeometryWaterproofness())}shouldHaveNeighbor(_){const T=this.extent,x=this.surface.rootTilesExtent,A=.25*(T[2]-T[0]);if((0,Cr.Mw)(_)&&T[3]+A>=x[3]||(0,Cr.uv)(_)&&T[1]-A<=x[1])return!1;const U=this.surface.isGlobal;return!(!U&&(0,Cr.OD)(_)&&T[0]-A<=x[0]||!U&&(0,Cr.Eu)(_)&&T[2]+A>=x[2])}}function NV(d,_,T,x){const A=T===Bi.ELEVATION?hO.acquire():dO.acquire();return A.init(d,_,T,x),A}function SE(d){d.dispose(),d instanceof Sw?hO.release(d):d instanceof Aw&&dO.release(d)}const dO=new Wu.Z(Aw),hO=new Wu.Z(Sw),WV=new q_;var ll;function VV(d,_){const T=d.level,x=_[0];if(T>x)return!1;const A=x-T,U=Math.floor(_[1]/2**A),ne=Math.floor(_[2]/2**A);return U===d.lij[1]&&ne===d.lij[2]}function Vd(d,_,T){return Math.abs(d-_)<=T}function pO(d,_,T){return!(0,Qe.Wi)(d)&&!(0,Qe.Wi)(_)&&_!==d&&(d.level>=_.level?Rw(d,_,T):Rw(_,d,(0,Cr.$v)(T)))}function Rw(d,_,T){(0,Cr.Fp)(d.level>=_.level);const x=(0,Cr._0)(T),A=(0,Cr.wt)(T),U=d.extent,ne=_.extent,fe=[x?U[0]:U[2],A?U[3]:U[1]],Oe=[x?ne[2]:ne[0],A?ne[1]:ne[3]],we=1e-5*(U[2]-U[0]),Ze=Vd(fe[0],Oe[0],we)||d.surface.isGlobal&&Vd(fe[0],-Oe[0],we),it=Vd(fe[1],Oe[1],we);if(Ze&&it)return!0;if(d.level===_.level||!Ze&&!it)return(0,Cr.Fp)(!1),!1;const lt=Ze?ww(ne[1],ne[3],U[1],U[3],we):ww(ne[0],ne[2],U[0],U[2],we);return(0,Cr.Fp)(lt),lt}function ww(d,_,T,x,A=(0,OE.g)()){return d-A<=T&&T<=x&&x<=_+A}!function(d){d[d.TOP=0]="TOP",d[d.MIDDLE=1]="MIDDLE",d[d.BOTTOM=2]="BOTTOM"}(ll||(ll={}));class GV{constructor(){this._scales=(0,Tn.f)(-1,-1,-1,-1),this._offsets=(0,Tn.f)(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(_,T,x){this._scales[2*_]=T,this._scales[2*_+1]=x}setOffset(_,T,x){this._offsets[2*_]=T,this._offsets[2*_+1]=x}get scales(){return this._scales}get offsets(){return this._offsets}}var Iw=v(73693),AE=v(64127),cl=v(57596);class RE extends so.A{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2,T.spherical=_.viewingMode===vi.JY.Global}initializeProgram(_){return new Gn.$(_.rctx,RE.shader.get().build(this.configuration),Lw)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(_){const T=this.configuration,x=T.backfaceCullingEnabled&&!T.renderOccluded;return(0,Ds.sm)({blending:T.renderOccluded?(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA):null,culling:x&&Ds.Rd,depthTest:!T.renderOccluded&&{func:xt.wb.LESS},depthWrite:!T.renderOccluded&&Ds.LZ,colorWrite:Ds.BK,stencilTest:_?(0,AE.iV)(Fi.hU.IntegratedMeshMaskExcluded):null})}getPipelineState(_,T){return this.useStencil?this._stencilPipelineState:super.getPipelineState(_,T)}}RE.shader=new ro.J(Iw.a,()=>v.e(3277).then(v.bind(v,13277)));const Lw=new Map([[Qi.T.POSITION,0],[Qi.T.UV0,1],[Qi.T.NORMALCOMPRESSED,2]]);class KV{constructor(){this.geometryInfo=new OV,this.intersectionData=null,this.geometryState=null,this._textureRef=new ef(()=>this.tile.surface.textureFadeDuration),this.overlay=new GV,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(_){this.clear(),this._tile=_;const T=this.geometryInfo;T.indices=null,T.vertexAttributes=null,(0,fo.cS)(T.boundingBox),T.indexCount=0,T.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new IV,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(_){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(_),this._geometryStateChangedSinceLastUpdate=!1),Cr.jt&&this.tile.intersectsClippingArea)for(let T=0;T<4;++T)(0,Cr.Fp)(this.geometryInfo.outerEdges[T].count===this.geometryState.neighborData.edgeResolutions[T]+1)}_calculateEdgeResolution(_,T){const x=this.tile,A=this.geometryState.numVerticesPerSide-1;if(!x.surface.isGlobal){const Oe=x.surface.extent;if((0,Qe.pC)(Oe)&&(0===_&&x.extent[3]>Oe[3]||1===_&&x.extent[2]>Oe[2]||2===_&&x.extent[1]<Oe[1]||3===_&&x.extent[0]<Oe[0]))return A}const U=x.level,ne=Cr.OC[_];if(!T)return(0,Cr.Fp)((0,Qe.Wi)(x.surface?.rootTiles)||x.surface.updatingRootTiles||!x.shouldHaveNeighbor(ne)),A;if(T.isLoaded){const we=T.renderData.geometryState,Ze=U-T.level;return(0,Cr.Fp)(Ze>=0),0===Ze?Math.max(we.numVerticesPerSide-1,A):Math.max(1,we.neighborData.edgeResolutions[(_+2)%4]/2**Ze)}(0,Cr.Fp)(!T.isLeaf);let fe=A;return T.forAllSubtreeOnSide((0,Cr._F)(ne),Oe=>Oe===x||(Oe.isLoaded?(fe=Math.max(fe,2**(Oe.level-U)),!0):((0,Cr.Fp)(!Oe.isLeaf),!1))),fe}updateNeighborData(){const _=this.tile;if(!_.intersectsClippingArea)return;const T=_.renderData.geometryState.neighborData,x=fe=>(fe.isLoaded||fe.level===_.level)&&fe?.intersectsClippingArea,A=T.edgePeerNeighbors,U=T.edgePeerNeighborSamplerVersions;for(let fe=0;fe<4;++fe){const Oe=_.findNeighborTile(Cr.OC[fe],x),we=Jh(_,Oe),Ze=we?.renderData?.geometryState.samplerDataVersion??-1,lt=we!==Jh(_,A[fe]),dt=U[fe]!==Ze;A[fe]=Oe,(lt||dt)&&(U[fe]=Ze,this._markEdgeDirty(fe));const Tt=T.edgeResolutions[fe],mt=this._calculateEdgeResolution(fe,Oe);(0,Cr.Fp)((0,xr.wt)(mt)),(0,Cr.Fp)(mt>=1),T.edgeResolutions[fe]=mt,Tt!==mt&&this._markEdgeResolutionDirty(fe)}const ne=T.cornerPeerNeighbors;for(let fe=0;fe<4;++fe){const Oe=_.findNeighborTile(Cr.cA[fe],x);ne[fe]=Oe;const we=Jh(_,A[fe]),Ze=Jh(_,A[(fe+1)%4]),it=Jh(_,Oe);mu[fe]=it,mu[(fe+1)%4]=Ze,mu[(fe+2)%4]=_,mu[(fe+3)%4]=we,(0,Cr.Fp)(mu.some(mt=>mt?.isLoaded||mt===_));const lt=mu.reduce((mt,Mt)=>Math.min(mt,Mt?.level??1/0),1/0);mu.forEach((mt,Mt)=>{mt?.level>lt&&(mu[Mt]=null)}),(0,Cr.Fp)(mu.some(mt=>mt?.isLoaded||mt===_));const dt=T.cornerNeighborData[fe].cornerTiles,Tt=T.cornerNeighborData[fe].cornerTileSamplerVersions;for(let mt=0;mt<4;++mt){const Mt=mu[mt],Pt=Mt?.renderData.geometryState.samplerDataVersion??-1,Nt=dt[mt]!==Mt,Bt=!Nt&&Tt[mt]!==Pt;(Nt||Bt)&&(dt[mt]=Mt,Tt[mt]=Pt,this._markCornerDirty(fe))}(0,Cr.Fp)(dt.some(mt=>mt?.isLoaded||mt===_))}Cr.jt&&(0,Cr.Fp)(this.geometryState.neighborData.edgeResolutions.every(fe=>fe>0));for(let fe=0;fe<4;++fe)mu[fe]=null}_updateGeometry(_){if(!this.tile.intersectsClippingArea)return;Cr.jt&&(0,Cr.Fp)(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(Oe=>Oe>0)),this.intersectionData=null;const T=this.tile,U=!this._vao||!this.geometryInfo.vertexAttributes||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,ne=!U&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),fe=!ne&&0!==this._dirtyCorners;U?(this._releaseGeometry(),this._createGeometry(_)):ne||fe?T.updateEdgeElevations():fe?T.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(_,T){return(0,Qe.pC)(this._texture)&&this._texture.descriptor.width!==_&&this.releaseTexture(),(0,Qe.Wi)(this._texture)&&(this._texture=T(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){(0,Qe.pC)(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(_){this._dirtyCorners|=1<<_}_markEdgeDirty(_){this._dirtyEdges|=1<<_}_markEdgeResolutionDirty(_){const T=1<<_;this._dirtyEdgeResolutions|=T,this._dirtyEdges|=T}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const _=this._getElevationInfo(),T=this.tile,x=_.samplerData?T.getElevationBasedVerticesPerSide(_.maxTileLevel):T.getDefaultVerticesPerRowOnLevel(),A=Math.max(x,5);let U=T.clippingArea;T.intersectsClippingArea&&!T.isWithinClippingArea||(U=null);const ne=this.geometryState;let fe=!1;ne.numVerticesPerSide!==A&&(this._numVerticesPerSideChanged=!0,ne.numVerticesPerSide=A,ne.samplerDataVersion++,fe=!0),_.changed&&(this._samplerDataChanged=!0,ne.samplerData=_.samplerData,ne.samplerDataVersion++,fe=!0),(0,pd.fS)(ne.clippingArea,U)||(this._clippingAreaChanged=!0,ne.clippingArea=U,fe=!0);const Oe=T.surface,we=Oe.wireframe;ne.wireframe!==we&&(this._wireframeChanged=!0,ne.wireframe=we,fe=!0);const Ze=Oe.shading;return ne.shading!==Ze&&(this._shadingChanged=Ze,ne.shading=Ze,fe=Ze),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=fe),fe&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(_){this.tile.createGeometry();const T=this.geometryInfo.vertexAttributes,x=this.geometryInfo.indices,A=_.gl;this._vao=new Dh.U(_,Lw,{geometry:(0,xh.K)(T.layout)},{geometry:Ra.f.createVertex(_,A.STATIC_DRAW,T.buffer)},Ra.f.createIndex(_,A.STATIC_DRAW,x)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,function SV(d){oO.release(d.vertexAttributes),d.vertexAttributes=null,d.indices=null}(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(_,T=Wd.Immediate){(0,Qe.pC)(_)&&_.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(_,T)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const _=this.geometryState.samplerData,T=this.tile.layerInfo[Bi.ELEVATION],x=T.length;let A=new Array(x),U=0,ne=0,fe=!1;for(let Oe=0;Oe<x;Oe++){const we=T[Oe];if((0,Qe.pC)(we.upsampleInfo)){const Ze=we.upsampleInfo.tile,it=Ze.layerInfo[Bi.ELEVATION][Oe].data,lt=it&&it.samplerData;_&&_[U]===lt||(fe=!0),A[U++]=lt,ne=Math.max(ne,Ze.lij[0])}else if(we.data){const Ze=this.tile.surface.layerViewByIndex(Oe,Bi.ELEVATION);if((0,Ko.yf)(this.tile,Ze.layer,!1)){const it=we.data;_&&_[U]===it.samplerData||(fe=!0),A[U++]=it.samplerData,ne=this.tile.level}}}return(0,Qe.pC)(_)&&_.length!==U&&(fe=!0),U>0?A.length=U:A=null,{changed:fe,samplerData:A,maxTileLevel:ne}}get estimatedGeometryMemoryUsage(){const _=(0,Qe.R2)(this.intersectionData,0,T=>T.estimatedMemoryUsage);return(this.geometryInfo.indices?.byteLength??0)+(this.geometryInfo.vertexAttributes?.byteLength??0)+_}get textureDescriptor(){return(0,Qe.pC)(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){if(!Cr.jt)return;const _=this.tile;if((0,Cr.Fp)(_?.isLoaded),!_.isLoaded||!_.intersectsClippingArea||0===_.level)return;const T=_.surface.extent;if((0,Qe.pC)(T)&&!_.intersectsExtent(T))return;const x=Cr.OC.map((fe,Oe)=>!!(0,Qe.pC)(T)&&(Oe<2?-1:1)*(_.extent[3-Oe]-T[3-Oe])<0),A=_.level;(0,Cr.Fp)(0===this._dirtyCorners),(0,Cr.Fp)(0===this._dirtyEdges),(0,Cr.Fp)(0===this._dirtyEdgeResolutions),(0,Cr.Fp)(!this._numVerticesPerSideChanged),(0,Cr.Fp)(!this._samplerDataChanged),(0,Cr.Fp)(!this._clippingAreaChanged),(0,Cr.Fp)(!this._wireframeChanged);const U=Cr.cA.map(fe=>_.findNeighborCornerTileExact(fe,Oe=>!Oe.intersectsClippingArea||Oe.isLoaded||Oe.level===_.level)??null).map(fe=>fe?.intersectsClippingArea?fe:null),ne=this.geometryState.neighborData;for(let fe=0;fe<4;++fe){const Oe=ne.cornerPeerNeighbors[fe],we=U[fe];(0,Cr.Fp)(we===Oe,`Tile[${_.lij}].corner[${fe}] out of date: cur=[${Oe?.lij}] exp=[${we?.lij}]`)}Cr.OC.forEach((fe,Oe)=>{if(x[Oe])return;const we=_.findNeighborTile(fe,lr=>(lr.level===A||lr?.isLoaded)&&lr?.intersectsClippingArea);if(!we){const lr=!_.surface.updatingRootTiles&&(0,Qe.pC)(_.surface.rootTiles)&&_.surface.rootTiles.length>0&&_.shouldHaveNeighbor(fe);return void(0,Cr.Fp)(!lr)}(0,Cr.Fp)(we.isLoaded||we.level===_.level),(0,Cr.Fp)(we===this.geometryState.neighborData.edgePeerNeighbors[Oe]);const Ze=A-we.level;if(!we.isLoaded)return(0,Cr.Fp)(!we.isLeaf),void(0,Cr.Fp)(0===Ze);(0,Cr.Fp)(function HV(d,_,T){if((0,Qe.Wi)(d)||(0,Qe.Wi)(_))return!1;if(0===d.level&&0===_.level&&(d.isEastEnd&&_.isWestEnd&&T===Vs.Xo.EAST||d.isWestEnd&&_.isEastEnd&&T===Vs.Xo.WEST))return!0;const x=Math.max(1e-6*(d.extent[2]-d.extent[0]),1);switch(T){case Vs.Xo.NORTH:return Vd(d.extent[3],_.extent[1],x);case Vs.Xo.SOUTH:return Vd(d.extent[1],_.extent[3],x);case Vs.Xo.EAST:return Vd(d.extent[2],_.extent[0],x)||Vd(d.extent[2],-_.extent[0],x);case Vs.Xo.WEST:return Vd(d.extent[0],_.extent[2],x)||Vd(d.extent[0],-_.extent[2],x)}}(_,we,fe)),(0,Cr.Fp)(Ze>=0);const it=2**Ze;if(Ze<0)return void(0,Cr.Fp)(!1);const lt=_.renderData.geometryInfo,dt=lt.outerEdges[Oe],Tt=lt.numVerticesPerSide-1,mt=we.renderData.geometryInfo;if(!mt)return void(0,Cr.Fp)(!1);{const lr=this.geometryState.neighborData.edgePeerNeighbors[Oe];(lr?.isLoaded||lr.isLoaded)&&((0,Cr.Fp)(lr==lr),(0,Cr.Fp)(_.renderData.geometryState.neighborData.edgePeerNeighborSamplerVersions[Oe]===lr.renderData.geometryState.samplerDataVersion),(0,Cr.Fp)(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[Oe]===lr.renderData.geometryState.samplerDataVersion))}const Mt=(Oe+2)%4,Pt=mt.outerEdges[Mt],Nt=dt.count-1,Bt=Pt.count-1;(0,Cr.Fp)(Nt*it===Bt,`Tile[${_.lij}]:e${Oe},res=${Nt} edgeRes mismatch with Neighbor[${we.lij}]:e${Mt},res=${Bt} (expected:${Nt*it})`);const Zt=_.extent,nr=fe===Vs.Xo.NORTH||fe===Vs.Xo.SOUTH,Jt=Pt.count-1,Rr=Jt/2**Ze,Br=dt.count-1;if(Rr<1)return void(0,Cr.Fp)(1===Br);(0,Cr.Fp)(Rr===Br),(0,Cr.Fp)((0,xr.wt)(Rr)),(0,Cr.Fp)(Ze>0||Rr===Math.max(mt.numVerticesPerSide-1,Tt));const Yr=_.getNeighborEdgeStartVertexIndex(Oe,we);(0,Cr.Fp)(0<=Yr&&Yr<it);const cs=Yr*Rr;(0,Cr.Fp)(0<=cs&&cs<=Jt-Rr);let Xr=0,os=cs;dt.getVertexPos(Ku,0),dt.getVertexPos(Zu,dt.count-1);const br=(0,pt.i)(Ku,Zu),Vr=Math.max(ZV,1e-4*br);for(let lr=0;lr<=Rr;++lr){dt.getVertexPos(Ku,Xr),Pt.getVertexPos(Zu,os);const wr=lr/Rr,Gr=nr?Zt[0]+wr*(Zt[2]-Zt[0]):fe===Vs.Xo.WEST?Zt[0]:Zt[2],zr=nr?fe===Vs.Xo.SOUTH?Zt[1]:Zt[3]:Zt[1]+wr*(Zt[3]-Zt[1]),rs=_.surface.extent;if((0,Qe.Wi)(rs)||(0,Bs.jE)(rs,Gr,zr)){const ls=(0,pt.j)(Ku,Zu),ms=(0,pt.u)(Ku)-gc.sv.radius,ss=(0,pt.u)(Zu)-gc.sv.radius,Ms=ls<Vr;if(!Ms){console.warn(`Tile edge vertex position mismatch: between [${_.lij}].edge${Oe}[${Xr}/${dt.count}] and [${we.lij}].edge${Mt}[${os}/${Pt.count}]`),(0,Qe.pC)(rs)&&console.warn("  surface extent= ",rs," x,y=",Gr,",",zr);const Hs=(0,ir.c)();(0,pt.b)(Hs,_.renderData.localOrigin,we.renderData.localOrigin),(0,pt.u)(Hs)>0&&console.warn(`   localOrigins: ${_.renderData.localOrigin} vs ${we.renderData.localOrigin} d=${(0,pt.u)(Hs)} [${Hs}]`),(()=>{const Js=(0,ir.a)(Ku),Gs=(0,ir.a)(Zu);_.updateEdgeElevations(),we.updateEdgeElevations(),dt.getVertexPos(Ku,Xr),Pt.getVertexPos(Zu,os);const bs=(0,ir.c)();(0,pt.y)(bs,Ku,Js),(0,pt.u)(bs)>0&&console.warn(`  XXX Tile[${_.lij}] edge out of date: ${Js} vs ${Ku} d=${(0,pt.u)(bs)} [${bs}]`),(0,pt.y)(bs,Zu,Gs),(0,pt.u)(bs)>0&&console.warn(`  XXX Neighbor[${we.lij}] edge out of date: ${Gs} vs ${Zu} d=${(0,pt.u)(bs)} [${bs}]`)})(),(0,Cr.Fp)(Ms,`Mismatch in tile [${_.lij}].edge[${Oe}][${Xr}/${dt.count}] vs neighbor [${we.lij}].edge[${Mt}][${os}/${Pt.count}] ${(0,Cr.zT)(Ku)} vs ${(0,Cr.zT)(Zu)}  dist=${ls} h(t|n|d)=${ms}|${ss}|${ss-ms}`)}if(_.surface.shading){dt.getNormal(sf,Xr),Pt.getNormal(nf,os),(0,pt.n)(Uw,sf),(0,pt.n)(Bw,nf);const Hs=(0,pt.e)(Uw,Bw),Js=!1,Gs=1-Hs<.01||Js||_===we;if(!Gs){const bs=(0,ir.c)();(0,pt.y)(bs,sf,nf);const ps=()=>`Mismatch in tile edge normal ${(0,Cr.sP)(_.lij)} (${Xr}/${dt.count-1}) edge ${Oe} vs neighbor ${(0,Cr.sP)(we.lij)}  (${os}/${Pt.count-1}) nedge ${Mt} :${(0,Cr.zT)(sf)} vs ${(0,Cr.zT)(nf)}  dot = ${Hs} : ${(0,Cr.zT)(bs)}`;console.warn("Mismatch in tile edge normal: ",ps());{_.updateEdgeElevations(),we.updateEdgeElevations();const _s=(0,ir.c)(),Is=(0,ir.c)();dt.getNormal(_s,Xr),Pt.getNormal(Is,os),(0,pt.F)(sf,_s)||console.warn("Missing update in tile normal: ",(0,Cr.zT)(sf)," => ",(0,Cr.zT)(_s)),(0,pt.F)(nf,Is)||console.warn("Missing update in neighbor normal: ",(0,Cr.zT)(nf)," => ",(0,Cr.zT)(Is))}(0,Cr.Fp)(Gs,ps())}}}Xr+=1,os+=1}})}}const Ku=(0,ir.c)(),Zu=(0,ir.c)(),sf=(0,ir.c)(),nf=(0,ir.c)(),Uw=(0,ir.c)(),Bw=(0,ir.c)(),ZV=1,mu=[null,null,null,null];function Jh(d,_){return _?.isLoaded||_===d?_:null}function jw(d){d.tile.intersectsClippingArea&&(Nw(d),Fw(d))}function Fw(d,_=!1){const T=d.geometryState,x=d.geometryInfo,A=T.neighborData,U=d.tile,ne=U.level,fe=U.extent,Oe=U.ellipsoid.radius,we=U.extentInRadians,Ze=we[0],it=we[2],lt=we[1],dt=we[3],Tt=T.samplerData,mt=fe[0],Mt=fe[2],Pt=fe[1],Nt=fe[3],Bt=_O(d),Zt=x.boundingBox,nr=d.localOrigin,Jt=nr[0],Rr=nr[1],Br=nr[2],$r=U.surface.shading||y0,Yr=x.vertexAttributes,cs=Yr.position,Xr=cs.typedBuffer,os=cs.typedBufferStride,br=Yr.uv0;for(let Vr=0;Vr<4;++Vr){const lr=1===Vr||3===Vr,wr=A.edgeResolutions[Vr];(0,Cr.Fp)((0,xr.wt)(wr));const Gr=wr+1,zr=Jh(U,A.edgePeerNeighbors[Vr]);if(Yw(U,zr,Vr)){Zw(d,Vr);continue}const rs=(0,Qe.pC)(zr);(0,Cr.Fp)(!rs||zr.level===U.level),(0,Cr.Fp)(!rs||(0,Ko.gl)(U,zr)<=0);const ls=zr?.renderData,ms=ls?.geometryState;if(Cr.jt){const _i=U.surface;if(!zr&&_i&&!_i.updatingRootTiles){const bi=Cr.OC[Vr],Ii=U.findNeighborTile(bi,sn=>sn.isLoaded||sn.isLeaf||sn.level===U.level);Ii?Ii.intersectsClippingArea&&((0,Cr.Fp)(!Ii.isLoaded),(0,Cr.Fp)(!Ii.isLeaf),(0,Cr.Fp)(Ii.level===ne)):(0,Cr.Fp)((0,Qe.Wi)(_i?.rootTiles)||!U.shouldHaveNeighbor(bi))}}const ss=1===Vr?fe[2]:fe[0],Ms=zr?.extent,Hs=rs&&lr?1===Vr?Ms[0]:Ms[2]:ss,Js=0===Vr?fe[3]:fe[1],Gs=1===Vr?1:0,bs=0===Vr?1:0,ps=1===Vr?it:Ze,_s=0===Vr?dt:lt,Is=Math.sin(ps),is=Math.cos(ps),ii=Math.sin(_s),Ys=Math.cos(_s),Zs=ms?.samplerData,ks=(_i,bi,Ii)=>wn(_i,bi,Tt),ds=(_i,bi,Ii)=>.5*(wn(_i,bi,Tt)+wn(Ii,bi,Zs)),qs=rs?ds:ks,Ni=x.outerEdges[Vr],Wi=_&&Gr>3?Gr-3:1,Pn=(0,Qe.pC)(Tt)&&Tt.some(_i=>null!=_i),bn=(0,Qe.pC)(Zs)&&Zs.some(_i=>null!=_i),an=Pn||bn,ji=1/wr,dn=Ni.index0;$r?((0,Cr.Fp)(!rs||(0,Cr.Wq)(Ms[2]-Ms[0],fe[2]-fe[0])),(()=>{const _i=1===Vr?-1:3===Vr?1:0,bi=0===Vr?-1:2===Vr?1:0,Ii=(fe[2]-fe[0])*ji,sn=_i*Ii,ln=bi*Ii,Vi=lr?_i*((it-Ze)*ji):0,Ai=lr?0:bi*ji,nn=bs,Vn=lr?ps+Vi:ps,Yi=lr?Math.sin(Vn):Is,Yn=lr?Math.cos(Vn):is,Xn=lr?ps-Vi:ps,Ta=lr?Math.sin(Xn):Is,Ba=lr?Math.cos(Xn):is,ic=lr?_s:Bt(nn+Ai),kc=lr?ii:Math.sin(ic),Sc=lr?Ys:Math.cos(ic),sa=lr?_s:Bt(nn-Ai),$o=lr?ii:Math.sin(sa),co=lr?Ys:Math.cos(sa),ka=(dn+0)*os;let Xi=Xr[ka+0]+Jt,Sn=Xr[ka+1]+Rr,Wo=Xr[ka+2]+Br,go=0,ia=0,Ac=0;{const To=1*ji,Vf=lr?ss:mt*(1-To)+Mt*To,wy=lr?Hs:Vf,Iy=lr?Pt*(1-To)+Nt*To:Js,Ly=lr?ps:Ze*(1-To)+it*To,$b=lr?Is:Math.sin(Ly),Yb=lr?is:Math.cos(Ly),zf=lr?Bt(To):_s,Uy=lr?Math.sin(zf):ii,Hf=lr?Math.cos(zf):Ys,By=Oe+qs(Vf,Iy,wy);go=Yb*Hf*By,ia=$b*Hf*By,Ac=Uy*By}for(let To=1;To<Gr-1;To+=Wi){let Vf=0,wy=0,Iy=0;{const ed=(dn+To+1)*os;if(To<Gr-2){const dl=(To+1)*ji,td=lr?ss:mt*(1-dl)+Mt*dl,qd=lr?Hs:td,Ja=lr?Pt*(1-dl)+Nt*dl:Js,Rc=lr?ps:Ze*(1-dl)+it*dl,lp=lr?Is:Math.sin(Rc),S0=lr?is:Math.cos(Rc),cp=lr?Bt(dl):_s,A0=lr?Math.sin(cp):ii,jy=lr?Math.cos(cp):Ys,kf=Oe+qs(td,Ja,qd);Vf=S0*jy*kf,wy=lp*jy*kf,Iy=A0*kf}else Vf=Xr[ed+0]+Jt,wy=Xr[ed+1]+Rr,Iy=Xr[ed+2]+Br}const Ly=Vf,$b=wy,Yb=Iy,zf=go,Uy=ia,Hf=Ac;go=Ly,ia=$b,Ac=Yb;{const ed=dn+To,dl=ed*os,td=zf-Jt,qd=Uy-Rr,Ja=Hf-Br;Xr[dl+0]=td,Xr[dl+1]=qd,Xr[dl+2]=Ja,al(td,qd,Ja,Zt);const Rc=To*ji;ql(br,ed,lr?Gs:Rc,lr?Rc:bs)}const By=Xi,YY=Sn,XY=Wo;Xi=zf,Sn=Uy,Wo=Hf;const Gf=zf,Kf=Uy,Zf=Hf;let $f=0,Yf=0,Xf=0;if(an){const ed=1/Math.sqrt(Gf*Gf+Kf*Kf+Zf*Zf),dl=Gf*ed,td=Kf*ed,qd=Zf*ed;{const Ja=Ly-By,Rc=$b-YY,lp=Yb-XY,S0=Rc*qd-lp*td,cp=lp*dl-Ja*qd,A0=Ja*td-Rc*dl;$f+=cp*lp-A0*Rc,Yf+=A0*Ja-S0*lp,Xf+=S0*Rc-cp*Ja}{const Ja=To*ji,Rc=lr?ss:mt*(1-Ja)+Mt*Ja,lp=lr?Hs:Rc,S0=lr?Pt*(1-Ja)+Nt*Ja:Js,cp=lr?ps:Ze*(1-Ja)+it*Ja,A0=lr?Is:Math.sin(cp),jy=lr?is:Math.cos(cp),kf=lr?Bt(Ja):_s,qU=lr?Math.sin(kf):ii,e5=lr?Math.cos(kf):Ys;let Ax=Gf,Rx=Kf,wx=Zf;if(rs){const R0=Oe+wn(lp-sn,S0-ln,Zs),Fy=lr?e5:co;Ax=(lr?Ba:jy)*Fy*R0,Rx=(lr?Ta:A0)*Fy*R0,wx=(lr?qU:$o)*R0}{const R0=Oe+wn(Rc+sn,S0+ln,Tt),Fy=lr?e5:Sc,t5=(lr?Yn:jy)*Fy*R0,r5=(lr?Yi:A0)*Fy*R0,s5=(lr?qU:kc)*R0;rs||(Ax=2*Gf-t5,Rx=2*Kf-r5,wx=2*Zf-s5);const Xb=Ax-t5,kb=Rx-r5,Jb=wx-s5,i5=kb*qd-Jb*td,n5=Jb*dl-Xb*qd,o5=Xb*td-kb*dl;$f+=n5*Jb-o5*kb,Yf+=o5*Xb-i5*Jb,Xf+=i5*kb-n5*Xb}}}else $f=Gf,Yf=Kf,Xf=Zf;const Sx=1/Math.sqrt($f*$f+Yf*Yf+Xf*Xf);Ni.setNormalFromValues(To,$f*Sx,Yf*Sx,Xf*Sx)}})()):(()=>{for(let _i=1;_i<Gr-1;_i+=Wi){const bi=_i*ji,Ii=lr?Gs:bi,sn=lr?bi:bs,ln=lr?ss:mt*(1-bi)+Mt*bi,Vi=lr?Pt*(1-bi)+Nt*bi:Js,Ai=lr?Hs:ln,nn=lr?ps:Ze*(1-bi)+it*bi,Vn=lr?Is:Math.sin(nn),Yi=lr?is:Math.cos(nn),Yn=lr?Bt(bi):_s,Xn=lr?Math.sin(Yn):ii,Ta=lr?Math.cos(Yn):Ys,Ba=qs(ln,Vi,Ai),ic=Oe+Ba,kc=Yi*Ta*ic-Jt,Sc=Vn*Ta*ic-Rr,sa=Xn*ic-Br;al(kc,Sc,sa,Zt);const $o=dn+_i,co=$o*os;Xr[co+0]=kc,Xr[co+1]=Sc,Xr[co+2]=sa,ql(br,$o,Ii,sn)}})()}}function Nw(d){$w(d)}function Ww(d,_){return Math.PI/2-2*Math.atan(Math.exp(-d/_))}function _O(d){const _=d.tile;if(_.surface.isWebMercator){const x=_.extent,A=_.ellipsoid.radius;return U=>function ez(d,_,T,x){return Ww(d*(1-x)+_*x,T)}(x[1],x[3],A,U)}const T=_.extentInRadians;return x=>function tz(d,_,T){return d*(1-T)+_*T}(T[1],T[3],x)}function Vw(d,_){d.tile.intersectsClippingArea&&(Hw(d),zw(d,!1))}function zw(d,_){const T=d.geometryState,x=T.neighborData,A=d.tile,U=A.surface,ne=U.shading||y0,fe=A.extent,Oe=T.clippingArea,we=(0,Qe.pC)(Oe)?Oe:IE,Ze=fe[0],it=fe[2],lt=fe[1],dt=fe[3],Tt=[dt>we[3],it>we[2],lt<we[1],Ze<we[0]],mt=d.geometryInfo,Mt=A.horizontalScale,Pt=fO(U.isWebMercatorOnPlateeCarree,A.ellipsoid.radius,Mt),Nt=mt.boundingBox,Bt=mt.uvRange[0],Zt=mt.uvRange[1],nr=mt.uvRange[2],Jt=mt.uvRange[3],Rr=Math.max(Ze,we[0]),Br=Math.min(it,we[2]),$r=Math.max(lt,we[1]),Yr=Math.min(dt,we[3]),cs=d.localOrigin,Xr=cs[0],os=cs[1],br=cs[2],Vr=T.samplerData;for(let lr=0;lr<4;++lr){const wr=1===lr||3===lr,Gr=x.edgeResolutions[lr];(0,Cr.Fp)((0,xr.wt)(Gr));const zr=Gr+1,rs=Tt[lr],ls=Jh(A,x.edgePeerNeighbors[lr]);if(!rs&&Yw(A,ls,lr)){Zw(d,lr);continue}const ms=(0,Qe.pC)(ls)&&!rs,ss=ls?.renderData,Ms=ss?.geometryState;if(Cr.jt&&((0,Cr.Fp)(!ms||ls.level===A.level),(0,Cr.Fp)(!ms||(0,Ko.gl)(A,ls)<=0),A&&!ls&&!U.updatingRootTiles)){const Zs=Cr.OC[lr],ks=A.findNeighborTile(Zs,ds=>ds.isLoaded||ds.isLeaf||ds.level===A.level);U.updatingRootTiles||(ks?ks.intersectsClippingArea&&((0,Cr.Fp)(!ks.isLoaded),(0,Cr.Fp)(!ks.isLeaf),(0,Cr.Fp)(ks.level===A.level)):(0,Cr.Fp)((0,Qe.Wi)(U?.rootTiles)||!A.shouldHaveNeighbor(Zs)))}const Hs=(0,xr.uZ)(1===lr?it:Ze,Rr,Br),Js=(0,xr.uZ)(0===lr?dt:lt,$r,Yr),Gs=Ms?.samplerData,bs=mt.outerEdges[lr],ps=_&&zr>3?zr-3:1,_s=(0,xr.uZ)(1===lr?1:0,Bt,nr),Is=(0,xr.uZ)(0===lr?1:0,Zt,Jt),is=(Zs,ks)=>wn(Zs,ks,Vr),ii=(Zs,ks)=>.5*(wn(Zs,ks,Gs)+wn(Zs,ks,Vr)),Ys=ms?ii:is;if(ne){const Zs=(it-Ze)/Gr,ks=wr?1===lr?Zs:-Zs:0,ds=wr?0:0===lr?Zs:-Zs,qs=-ks,Ni=-ds,Wi=bs.attributes.position.typedBuffer,Pn=bs.attributes.position.typedBufferStride,bn=bs.index0,an=bs.stride,ji=bn*Pn;let dn=Wi[ji+0]+Xr,_i=Wi[ji+1]+os,bi=Wi[ji+2]+br,Ii=0,sn=0,ln=0;{const Vi=1/Gr,Ai=wr?Hs:(0,xr.uZ)(Ze*(1-Vi)+it*Vi,Rr,Br),nn=wr?(0,xr.uZ)(lt*(1-Vi)+dt*Vi,$r,Yr):Js,Vn=Ys(Ai,nn),Yi=Ai*Mt,Yn=Pt(nn);Ii=Yi,sn=Yn,ln=Vn}for(let Vi=1;Vi<zr-1;Vi+=ps){const Ai=Vi/Gr,nn=Ii,Vn=sn,Yi=ln;{const Xi=wr?_s:(0,xr.uZ)(Ai,Bt,nr),Sn=wr?(0,xr.uZ)(Ai,Zt,Jt):Is,Wo=nn-Xr,go=Vn-os,ia=Yi-br;al(nn,go,ia,Nt),bs.setVertexFromValuesRawPositionUV(Vi,Wo,go,ia,Xi,Sn)}const Yn=Vi+1;if(Vi===zr-1){const Xi=(bn+Yn*an)*Pn;Ii=Wi[Xi+0]+Xr,sn=Wi[Xi+1]+os,ln=Wi[Xi+2]+br}else{const Xi=Yn/Gr,Sn=wr?Hs:(0,xr.uZ)(Ze*(1-Xi)+it*Xi,Rr,Br),Wo=wr?(0,xr.uZ)(lt*(1-Xi)+dt*Xi,$r,Yr):Js,go=Ys(Sn,Wo);Ii=Sn*Mt,sn=Pt(Wo),ln=go}const Xn=Ii,Ta=sn,Ba=ln,ic=dn,kc=_i,Sc=bi;dn=nn,_i=Vn,bi=Yi;let sa=0,$o=0,co=0;if(wr){{const Xi=Ta-Vn,Sn=kc-Vn;$o-=Sn*(Sc-Yi)+Xi*(Ba-Yi),co+=Sn*Sn+Xi*Xi}{const Xi=(0,xr.uZ)(lt*(1-Ai)+dt*Ai,$r,Yr),Sn=Hs+qs,Wo=Sn*Mt-nn;if(sa-=Wo*(wn(Sn,Xi,Vr)-Yi),co+=Wo*Wo,ms){const go=Hs+ks,ia=go*Mt-nn;sa-=ia*(wn(go,Xi,Gs)-Yi),co+=ia*ia}}}else{{const Xi=Xn-nn,Sn=ic-nn;sa-=Xi*(Ba-Yi)+Sn*(Sc-Yi),co+=Xi*Xi+Sn*Sn}{const Xi=(0,xr.uZ)(Ze*(1-Ai)+it*Ai,Rr,Br),Sn=Js+Ni,Wo=wn(Xi,Sn,Vr)-Yi,go=Pt(Sn)-Vn;if($o-=go*Wo,co+=go*go,ms){const ia=Xi,Ac=Js+ds,To=Pt(Ac)-Vn;$o-=To*(wn(ia,Ac,Gs)-Yi),co+=To*To}}}const ka=1/Math.sqrt(sa*sa+$o*$o+co*co);bs.setNormalFromValues(Vi,sa*ka,$o*ka,co*ka)}}else for(let Zs=1;Zs<zr-1;Zs+=ps){const ks=Zs/Gr,ds=wr?Hs:(0,xr.uZ)(Ze*(1-ks)+it*ks,Rr,Br),qs=wr?(0,xr.uZ)(lt*(1-ks)+dt*ks,$r,Yr):Js,Ni=wr?_s:(0,xr.uZ)(ks,Bt,nr),Wi=wr?(0,xr.uZ)(ks,Zt,Jt):Is,Pn=Ys(ds,qs),bn=ds*Mt-Xr,an=Pt(qs)-os,ji=Pn-br;al(bn,an,ji,Nt),bs.setVertexFromValuesRawPositionUV(Zs,bn,an,ji,Ni,Wi)}}}function Hw(d,_){$w(d)}function fO(d,_,T){return d?x=>function lz(d,_){return(Math.PI/2-2*Math.atan(Math.exp(-d/_)))*_}(x,_):x=>function cz(d,_){return d*_}(x,T)}function Gw(d,_,T,x,A,U){const ne=_-1,fe=d.vertexAttributes.count,Oe=2*(Math.min(_-2,x[1])-Math.max(1,x[0]))*(Math.min(_-2,A[1])-Math.max(1,A[0])),we=Cr.OC.map((Nt,Bt)=>0===Bt&&A[1]<_-2||1===Bt&&x[1]<_-2||2===Bt&&A[0]>1||3===Bt&&x[0]>1),Ze=d.outerEdges.reduce((Nt,Bt,Zt)=>Nt+(we[Zt]?0:ne-2+Bt.count-1),0),it=T.reduce((Nt,Bt)=>Nt+ne*(2*(Bt.latitudeResolution-1)+1),0),lt=U?2:1,dt=3*(Oe+Ze+it)*lt,Tt=fe>=65536?new Uint32Array(dt):new Uint16Array(dt);let mt=0;const Mt=_-2,Pt=ne-2;if((0,Cr.Fp)(Pt>=0),U){const Nt=(Zt,nr,Jt)=>{Tt[mt++]=Zt,Tt[mt++]=nr,Tt[mt++]=nr,Tt[mt++]=Jt,Tt[mt++]=Jt,Tt[mt++]=Zt,Cr.jt&&((0,Cr.Fp)(Zt<fe),(0,Cr.Fp)(nr<fe),(0,Cr.Fp)(Jt<fe),(0,Cr.Fp)(mt<=dt))};(()=>{for(let Zt=Math.max(A[0],1)-1;Zt<Math.min(A[1],_-2)-1;++Zt)for(let nr=Math.max(x[0],1)-1;nr<Math.min(x[1],_-2)-1;++nr){const Jt=Zt*Mt+nr,Rr=Jt+1,Br=Rr+Mt,$r=Br-1;Nt(Jt,Rr,Br),Nt(Br,$r,Jt)}})(),(0,Cr.Fp)(mt===3*Oe*lt),(()=>{for(let Zt=0;Zt<4;++Zt){const nr=mt;if(we[Zt])continue;const Jt=d.outerEdges[Zt],Rr=d.innerEdges[Zt];let Br=0,$r=0;const Yr=Jt.count,cs=Rr.count;(0,Cr.Fp)(cs===ne-1);let Xr=0;const os=1===Zt||2===Zt?(br,Vr,lr)=>Nt(br,Vr,lr):(br,Vr,lr)=>Nt(br,lr,Vr);for(;Br<Yr-1||$r<cs-1;){const br=Rr.getVertexIndex($r),Vr=Jt.getVertexIndex(Br),lr=Br<Yr-1,wr=$r<cs-1,Gr=lr?0+ne*(Br+.5)/(Yr-1):0,zr=wr?1+Pt*($r+.5)/(cs-1):0;lr&&(!wr||Gr<=zr)?(++Br,Cr.jt&&(0,Cr.Fp)(Br<Yr),os(br,Vr,Jt.getVertexIndex(Br)),Xr++):(++$r,Cr.jt&&(0,Cr.Fp)($r<cs),os(br,Vr,Rr.getVertexIndex($r)),Xr++)}Cr.jt&&((0,Cr.Fp)(Br===Yr-1),(0,Cr.Fp)($r===cs-1),(0,Cr.Fp)(Xr===Yr+cs-2),(0,Cr.Fp)(Xr===ne-2+Jt.count-1),(0,Cr.Fp)(mt===nr+3*Xr*lt))}})(),(0,Cr.Fp)(mt===3*(Oe+Ze)*lt),T.forEach(Zt=>{const nr=d.outerEdges[Zt.connectedOuterEdgeOffset];let Jt=nr.getVertexIndex(0),Rr=nr.stride;for(let Br=0;Br<Zt.latitudeResolution;++Br){const $r=0===Br?Zt.rowOffset:Jt+_;for(let Yr=0;Yr<ne;Yr++)Nt(Jt,Jt+1,$r+Yr),Br<Zt.latitudeResolution-1&&Nt(Jt+1,$r+Yr+1,$r+Yr),Jt+=Rr;Jt=$r,Rr=1}})}else(()=>{const Bt=Math.max(A[0],1)-1,Zt=Math.min(A[1],_-2)-1,nr=Math.max(x[0],1)-1,Jt=Math.min(x[1],_-2)-1;for(let Rr=Bt;Rr<Zt;++Rr){const Br=Rr*Mt;for(let $r=nr;$r<Jt;++$r){const Yr=Br+$r,cs=Yr+1,Xr=cs+Mt,os=Xr-1;Tt[mt+0]=Yr,Tt[mt+1]=cs,Tt[mt+2]=Xr,Tt[mt+3]=Xr,Tt[mt+4]=os,Tt[mt+5]=Yr,mt+=6}}})(),(0,Cr.Fp)(mt===3*Oe*lt),(()=>{for(let Bt=0;Bt<4;++Bt){if(we[Bt])continue;const Zt=d.outerEdges[Bt],nr=d.innerEdges[Bt];let Jt=0,Rr=0;const Br=Zt.count,$r=nr.count;(0,Cr.Fp)($r===ne-1);const Yr=1===Bt||2===Bt,cs=Yr?1:2,Xr=Yr?2:1,os=Zt.index0,br=Zt.stride,Vr=nr.index0,lr=nr.stride;for(;Jt<Br-1||Rr<$r-1;){const wr=Vr+Rr*lr,Gr=os+Jt*br,zr=Jt<Br-1,rs=Rr<$r-1,ls=zr?0+ne*(Jt+.5)/(Br-1):0,ms=rs?1+Pt*(Rr+.5)/($r-1):0,ss=zr&&(!rs||ls<=ms);ss?++Jt:++Rr;const Ms=ss?Gr+br:wr+lr;Tt[mt+0]=wr,Tt[mt+cs]=Gr,Tt[mt+Xr]=Ms,mt+=3}}})(),(0,Cr.Fp)(mt===3*(Oe+Ze)*lt),T.forEach(Bt=>{const Zt=d.outerEdges[Bt.connectedOuterEdgeOffset];let nr=Zt.getVertexIndex(0),Jt=Zt.stride;for(let Rr=0;Rr<Bt.latitudeResolution;++Rr){const Br=0===Rr?Bt.rowOffset:nr+_;for(let $r=0;$r<ne;$r++){const Yr=Br+$r;Tt[mt+0]=nr,Tt[mt+1]=nr+1,Tt[mt+2]=Yr,Rr<Bt.latitudeResolution-1?(Tt[mt+3]=nr+1,Tt[mt+4]=Yr+1,Tt[mt+5]=Yr,mt+=6):mt+=3,nr+=Jt}nr=Br,Jt=1}});(0,Cr.Fp)(mt===dt),d.indices=Tt,d.indexCount=dt}function Kw(d,_){const T=d.localOrigin,x=d.geometryInfo,A=d.geometryState.neighborData.edgeResolutions,U=x.numVerticesPerSide-2,ne=x.vertexAttributes;let fe=_;for(let Oe=0;Oe<4;++Oe){{const we=0===Oe||2===Oe;x.innerEdges[Oe]=new Tw(ne,T,(0===Oe?U-1:0)*U+(1===Oe?U-1:0),(we?0:1)*U+(we?1:0),U)}{const Ze=A[Oe]+1;x.outerEdges[Oe]=new Tw(ne,T,fe,1,Ze),fe+=Ze}}}function Zw(d,_){const T=(_+2)%4,A=d.tile,U=d.geometryState.neighborData,ne=Jh(A,U.edgePeerNeighbors[_]),fe=A.level-ne.level,Oe=1===_||3===_,we=U.edgeResolutions[_];(0,Cr.Fp)((0,xr.wt)(we));const Ze=we+1,it=d.geometryInfo,lt=it.boundingBox,dt=it.outerEdges[_],Tt=it.uvRange[0],mt=it.uvRange[1],Mt=it.uvRange[2],Pt=it.uvRange[3],Nt=(0,xr.uZ)(1===_?1:0,Tt,Mt),Bt=(0,xr.uZ)(0===_?1:0,mt,Pt),Zt=ne.renderData,nr=Zt.geometryState,Jt=Zt.geometryInfo.outerEdges[T],Rr=A.getNeighborEdgeStartVertexIndex(_,ne)*we,Br=we*2**fe;(0,Cr.Fp)(nr.neighborData.edgeResolutions[T]===Br),(0,Cr.Fp)(Jt.count-1===Br);const $r=Zt.localOrigin[0]-d.localOrigin[0],Yr=Zt.localOrigin[1]-d.localOrigin[1],cs=Zt.localOrigin[2]-d.localOrigin[2],Xr=dt.attributes,os=dt.index0,br=dt.stride,Vr=Xr.position.typedBuffer,lr=Xr.position.typedBufferStride,wr=Xr.normalCompressed.typedBuffer,Gr=Xr.normalCompressed.typedBufferStride,zr=Xr.uv0,rs=Jt.attributes,ls=Jt.index0,ms=Jt.stride,ss=rs.position.typedBuffer,Ms=rs.position.typedBufferStride,Hs=rs.normalCompressed.typedBuffer,Js=rs.normalCompressed.typedBufferStride;for(let Gs=1;Gs<Ze-1;++Gs){const bs=os+br*Gs,ps=ls+ms*(Rr+Gs),_s=bs*lr,Is=ps*Ms,is=ss[Is+0]+$r,ii=ss[Is+1]+Yr,Ys=ss[Is+2]+cs;Vr[_s+0]=is,Vr[_s+1]=ii,Vr[_s+2]=Ys,al(is,ii,Ys,lt);const Zs=bs*Gr,ks=ps*Js;wr[Zs+0]=Hs[ks+0],wr[Zs+1]=Hs[ks+1];const ds=Gs/we;ql(zr,bs,Oe?Nt:(0,xr.uZ)(ds,Tt,Mt),Oe?(0,xr.uZ)(ds,mt,Pt):Bt)}}function $w(d){const _=d.geometryState,x=d.localOrigin,A=_.neighborData.cornerNeighborData,U=d.geometryInfo,ne=U.outerEdges,fe=U.boundingBox,Oe=d.tile,we="local"===d.tile.surface.view?.viewingMode,Ze=Oe.ellipsoid.radius,it=Oe.extentInRadians,lt=Oe.horizontalScale;let dt=0,Tt=0,mt=0,Mt=0,Pt=0,Nt=0;const Zt=we?(()=>{const bs=d.geometryState.clippingArea,ps=Oe.extent,_s=(0,Qe.pC)(bs)&&(ps[3]>bs[3]||ps[2]>bs[2]||ps[1]<bs[1]||ps[0]<bs[0]),Is=fO(Oe.surface.isWebMercatorOnPlateeCarree,Oe.ellipsoid.radius,lt);return(is,ii,Ys)=>{const Zs=0===is?Yr[0]:Yr[2],ks=0===ii?Yr[1]:Yr[3],ds=_s?(0,xr.uZ)(Zs,bs[0],bs[2]):Zs,qs=_s?(0,xr.uZ)(ks,bs[1],bs[3]):ks,Ni=Ys;dt=ds*lt,Tt=Is(qs),mt=Ni}})():(bs,ps,_s)=>{const Is=it[0===ps?1:3],is=it[0===bs?0:2],ii=Math.cos(Is),Ys=Math.sin(Is),Zs=Math.sin(is),ks=Math.cos(is),ds=Ze+_s;dt=ks*ii*ds,Tt=Zs*ii*ds,mt=Ys*ds};let nr=0,Jt=0,Rr=0;const Br=we&&d.tile.surface.isWebMercatorOnPlateeCarree,$r=(bs,ps,_s,Is)=>{if(we){const is=ps*lt,ii=Br?(Math.PI/2-2*Math.atan(Math.exp(-_s/Ze)))*Ze:_s*lt,Ys=is-dt,Zs=ii-Tt,ks=Is-mt;nr+=-Ys*ks,Jt+=-Zs*ks,Rr+=Ys*Ys+Zs*Zs}else{const is=_O(bs),ii=bs.tile,Ys=ii.extent,Zs=ii.extentInRadians,ks=(ps-Ys[0])/(Ys[2]-Ys[0]),qs=Zs[0]*(1-ks)+Zs[2]*ks,Ni=is((_s-Ys[1])/(Ys[3]-Ys[1])),Wi=Math.cos(Ni),Pn=Math.sin(Ni),bn=Math.sin(qs),an=Math.cos(qs),ji=Ze+Is,dn=an*Wi*ji-dt,_i=bn*Wi*ji-Tt,bi=Pn*ji-mt,Ii=_i*Nt-bi*Pt,sn=bi*Mt-dn*Nt,ln=dn*Pt-_i*Mt;nr+=sn*bi-ln*_i,Jt+=ln*dn-Ii*bi,Rr+=Ii*_i-sn*dn}},Yr=Oe.extent,cs=_.clippingArea,Xr=(0,Qe.pC)(cs)?cs:IE,os=Yr[0],br=Yr[2],Vr=Yr[1],lr=Yr[3],wr=[lr>Xr[3],br>Xr[2],Vr<Xr[1],os<Xr[0]],Gr=Math.max(os,Xr[0]),zr=Math.min(br,Xr[2]),rs=Math.max(Vr,Xr[1]),ls=Math.min(lr,Xr[3]),ms=U.uvRange[0],ss=U.uvRange[1],Ms=U.uvRange[2],Hs=U.uvRange[3],Js=Oe.surface.shading||y0,Gs=bs=>{if(!we){const ds=1/Math.sqrt(dt*dt+Tt*Tt+mt*mt);Mt=dt*ds,Pt=Tt*ds,Nt=mt*ds}const ps=A[bs].cornerTiles;nr=0,Jt=0,Rr=0;let _s=1/0;for(let ds=0;ds<4;++ds)_s=Math.min(_s,ps[ds]?.level??1/0);for(let ds=0;ds<4;++ds){const qs=ps[ds];qg[ds]=qs?.level===_s?qs:null}let Is=1,is=0;for(let ds=0;ds<4;++ds){const qs=qg[ds];qs&&(Is=Math.max(Is,qs?.renderData.geometryState.numVerticesPerSide),is=qs.extent[2]-qs.extent[0])}const ii=is,Ys=Is;(0,Cr.Fp)(Ys>1);const Zs=ii/Ys;for(let ds=0;ds<4;++ds){const qs=qg[(ds+3)%4],Ni=qg[(ds+0)%4];if(!qs&&!Ni)continue;const Wi=0===ds?1:1===ds?2:2===ds?3:0,Pn=0===ds?2:1===ds?3:2===ds?0:1;if(qs&&Ni){const bn=mO[ds][0]*Zs,an=mO[ds][1]*Zs,ji=qs.extent,dn=ji[0===Wi||1===Wi?2:0]+bn,_i=ji[0===Wi||3===Wi?3:1]+an,bi=Ni.extent,Ii=bi[0===Pn||1===Pn?2:0]+bn,sn=bi[0===Pn||3===Pn?3:1]+an,ln=qs.renderData,Vi=Ni.renderData,Ai=wn(dn,_i,ln.geometryState.samplerData),nn=wn(Ii,sn,Vi.geometryState.samplerData);$r(ln,dn,_i,.5*(Ai+nn))}else{const bn=qs??Ni,an=qs?Wi:Pn,ji=bn.extent,dn=mO[ds],_i=ji[0===an||1===an?2:0]+dn[0]*Zs,bi=ji[0===an||3===an?3:1]+dn[1]*Zs,Ii=bn.renderData,sn=wn(_i,bi,Ii.geometryState.samplerData);$r(Ii,_i,bi,sn)}}const ks=1/Math.sqrt(nr*nr+Jt*Jt+Rr*Rr);nr*=ks,Jt*=ks,Rr*=ks};for(let bs=0;bs<4;++bs){const ps=bs,_s=(bs+1)%4,Is=0===bs||1===bs?1:0,is=0===bs||3===bs?1:0,ii=(0,xr.uZ)(Is,ms,Ms),Ys=(0,xr.uZ)(is,ss,Hs),Zs=ne[ps],ks=0===bs||3===bs?Zs.count-1:0,ds=ne[_s],qs=0===bs||1===bs?ds.count-1:0,Ni=A[bs].cornerTiles;let Wi=-1;for(let an=0;an<4;++an){const ji=Ni[an];ji&&(-1===Wi||(0,Ko.gl)(Ni[Wi],ji)>0)&&(Wi=an)}const Pn=Wi,bn=Ni[Pn];if(nr=0,Jt=0,Rr=1,bn!==Oe){const an=Oe.level-bn.level,ji=2**an,dn=[bn.lij[0]+an,bn.lij[1]*ji,bn.lij[2]*ji],_i=[dn[1]+ji===Oe.lij[1],0===bs&&(1===Pn||0===Pn&&bn!==Ni[3])||1===bs&&(0===Pn||1===Pn&&bn!==Ni[2]),dn[1]===Oe.lij[1]+1,2===bs&&(3===Pn||2===Pn&&bn!==Ni[1])||3===bs&&(2===Pn||3===Pn&&bn!==Ni[0])],bi=_i.reduce((Ai,nn)=>Ai+(nn?1:0),0);(0,Cr.Fp)(1===bi||2===bi);let Ii=-1,sn=-1;const ln=bn.renderData;if(1===bi){const Ai=_i.findIndex(Vn=>Vn);(0,Cr.Fp)(0<=Ai&&Ai<=3),Ii=(Ai+2)%4;const nn=d.geometryState.neighborData.edgeResolutions[Ai];sn=Oe.getNeighborEdgeStartVertexIndex(Ai,bn)*nn+nn*(0===Ai&&0===bs||1===Ai&&0===bs||2===Ai&&1===bs||3===Ai&&3===bs?1:0)}else{(0,Cr.Fp)(_i[1]||_i[3]),Ii=_i[1]?3:1;const Ai=ln.geometryState.neighborData.edgeResolutions[Ii];sn=0===bs||3===bs?0:Ai}const Vi=ln.geometryInfo.outerEdges[Ii];{const Ai=Zs.index0+ks*Zs.stride,nn=ds.index0+qs*ds.stride,Vn=Vi.index0+sn*Vi.stride;{const Yi=Vi.attributes.position,Yn=Yi.typedBuffer,Xn=Vn*Yi.typedBufferStride,Ta=d.localOrigin,Ba=Vi.localOrigin,ic=Yn[Xn+0]+Ba[0]-Ta[0],kc=Yn[Xn+1]+Ba[1]-Ta[1],Sc=Yn[Xn+2]+Ba[2]-Ta[2];al(ic,kc,Sc,fe);{const sa=Zs.attributes.position,$o=sa.typedBuffer,co=Ai*sa.typedBufferStride;$o[co+0]=ic,$o[co+1]=kc,$o[co+2]=Sc}{const sa=ds.attributes.position,$o=sa.typedBuffer,co=nn*sa.typedBufferStride;$o[co+0]=ic,$o[co+1]=kc,$o[co+2]=Sc}}ql(Zs.attributes.uv0,Ai,ii,Ys),ql(ds.attributes.uv0,nn,ii,Ys);{const Yi=Vi.attributes.normalCompressed.typedBuffer,Yn=Vn*Vi.attributes.normalCompressed.typedBufferStride;{const Xn=Zs.attributes.normalCompressed,Ta=Xn.typedBuffer,Ba=Ai*Xn.typedBufferStride;Ta[Ba+0]=Yi[Yn+0],Ta[Ba+1]=Yi[Yn+1]}{const Xn=ds.attributes.normalCompressed,Ta=Xn.typedBuffer,Ba=nn*Xn.typedBufferStride;Ta[Ba+0]=Yi[Yn+0],Ta[Ba+1]=Yi[Yn+1]}}}}else{const ji=wr[_s];let dn;dn=wr[ps]||ji?wn((0,xr.uZ)(os*(1-Is)+br*Is,Gr,zr),(0,xr.uZ)(Vr*(1-is)+lr*is,rs,ls),_.samplerData):uz(Ni),Zt(Is,is,dn),(Js||y0)&&Gs(bs);const _i=dt-x[0],bi=Tt-x[1],Ii=mt-x[2];al(_i,bi,Ii,fe),Zs.setVertexFromValuesRawPositionUVNormal(ks,_i,bi,Ii,ii,Ys,nr,Jt,Rr),ds.setVertexFromValuesRawPositionUVNormal(qs,_i,bi,Ii,ii,Ys,nr,Jt,Rr)}}for(let bs=0;bs<4;++bs)qg[bs]=null}function uz(d){const _=d.reduce((U,ne)=>Math.min(U,ne?.level??1/0),1/0);Cr.jt&&((0,Cr.Fp)(!d[0]||!d[2]||pO(d[0],d[2],Vs.Xo.SOUTH_WEST)),(0,Cr.Fp)(!d[1]||!d[3]||pO(d[1],d[3],Vs.Xo.NORTH_WEST)));let T=0,x=0;for(let U=0;U<4;++U){const ne=d[U];if(ne&&ne.level===_){const we=ne.extent,lt=ne.renderData?.geometryState?.samplerData;x+=wn(we[0===U||1===U?0:2],we[0===U||3===U?1:3],lt),T++}}const A=T?x/T:0;return(0,Cr.Fp)(null!=A),A}function wE(d){const T=d.geometryInfo.vertexAttributes.position.typedBuffer;d.vao.vertexBuffers.geometry.setSubData(T,0,0,T.length)}const mO=[[0,1],[1,0],[0,-1],[-1,0]],Io=new class RV{constructor(){this.sinLonLUT=new Array(po.HB+1),this.cosLonLUT=new Array(po.HB+1),this.sinLatLUT=new Array(po.HB+1),this.cosLatLUT=new Array(po.HB+1)}update(_,T,x){const A=T[0],U=T[2];for(let ne=0;ne<=_;ne++){const fe=ne/_,Oe=A*(1-fe)+U*fe;this.sinLonLUT[ne]=Math.sin(Oe),this.cosLonLUT[ne]=Math.cos(Oe);const we=x(fe);this.sinLatLUT[ne]=Math.sin(we),this.cosLatLUT[ne]=Math.cos(we)}}},IE=(0,Bs.al)(-1/0,-1/0,1/0,1/0),qg=[null,null,null,null];function Yw(d,_,T){if(!_)return!1;const x=(0,Ko.gl)(d,_);return x>0||0===x&&T<2}const y0=!0;var v0=v(57623);class dz extends uO{constructor(_,T,x){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=(0,Bs.Ue)(),void 0!==_&&this.init(_,T,x)}get horizontalScale(){return this._horizontalScaleFactor}init(_,T,x){super.init(_,T,x);const A=x.view.renderSpatialReference,U=x.spatialReference,ne=(0,Qe.pC)(A)&&(0,hc.QM)(A)&&(0,Qe.pC)(U)&&U.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=ne;const Oe=this._extentInRenderSR,we=this.extent;if(this.surface.isWebMercatorOnPlateeCarree){const Ze=(0,ir.f)(we[0],we[1],0);(0,di.SH)(Ze,to.Z.WebMercator,Ze,to.Z.PlateCarree);const it=(0,ir.f)(we[2],we[3],0);(0,di.SH)(it,to.Z.WebMercator,it,to.Z.PlateCarree),Oe[0]=Ze[0],Oe[1]=Ze[1],Oe[2]=it[0],Oe[3]=it[1]}else for(let Ze=0;Ze<4;++Ze)Oe[Ze]=we[Ze]*ne;this.centerAtSeaLevel[0]=.5*(Oe[0]+Oe[2]),this.centerAtSeaLevel[1]=.5*(Oe[1]+Oe[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(Oe[2]-Oe[0],Oe[3]-Oe[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const _=this._extentInRenderSR,T=.5*(_[2]-_[0]),x=.5*(_[3]-_[1]),A=Math.sqrt(T*T+x*x),ne=Math.max(A,.5*(this.elevationBounds[0]-this.elevationBounds[1]));this._center[ll.MIDDLE][3]=ne}_calculateFrustumVisibilityStatus(_){const T=this._aabb(),x=T[0],A=T[1],U=T[2],ne=T[3],fe=T[4],Oe=T[5];let we=!0;for(let Ze=0;Ze<6;Ze++){const it=_[Ze],lt=it[0],dt=it[1],Tt=it[2],mt=it[3];if(lt*(lt>0?x:ne)+dt*(dt>0?A:fe)+Tt*(Tt>0?U:Oe)+mt>=0)return Vs.ir.OUTSIDE;we=we&&lt*(lt<0?x:ne)+dt*(dt<0?A:fe)+Tt*(Tt<0?U:Oe)+mt<=0}return we?Vs.ir.INSIDE:Vs.ir.INTERSECTS}_aabb(){const _=this._extentInRenderSR;return(0,fo.re)(_[0],_[1],this.elevationBounds[0],_[2],_[3],this.elevationBounds[1])}intersectsRay(_,T,x,A){return LE[0]=1/T[0],LE[1]=1/T[1],LE[2]=1/T[2],(0,v0.Fw)(this._aabb(),_,LE,x,A)}createGeometry(){(function rz(d,_){const T=d.tile.extent,x=d.geometryState,A=T[0],U=T[1],ne=T[2]-A,fe=T[3]-U,Oe=x.clippingArea,we=(0,Qe.pC)(Oe)?Math.max(0,(Oe[0]-A)/ne):0,Ze=(0,Qe.pC)(Oe)?Math.max(0,(Oe[1]-U)/fe):0,it=(0,Qe.pC)(Oe)?Math.min(1,(Oe[2]-A)/ne):1,lt=(0,Qe.pC)(Oe)?Math.min(1,(Oe[3]-U)/fe):1,dt=x.numVerticesPerSide,Tt=(dt-2)**2,Mt=Mw(Tt+x.neighborData.edgeResolutions.reduce((Bt,Zt)=>Bt+Zt+1,0)),Pt=d.geometryInfo;(0,fo.cS)(Pt.boundingBox),Pt.numVerticesPerSide=x.numVerticesPerSide,Pt.vertexAttributes=Mt,(0,Qo.s)(Pt.uvRange,we,Ze,it,lt),function sz(d){const _=d.tile;_.intersectsClippingArea&&(_.surface.shading?function nz(d){const _=d.tile,T=_.surface;if(!T.shading&&!y0)return;const x=d.geometryState,A=x.samplerData,U=d.localOrigin,ne=T.isWebMercatorOnPlateeCarree,fe=x.clippingArea,Oe=(0,Qe.pC)(fe)?fe:IE,we=_.extent,Ze=we[0],it=we[1],lt=we[2],dt=we[3],Tt=Math.max(Ze,Oe[0]),mt=Math.min(lt,Oe[2]),Mt=Math.max(it,Oe[1]),Pt=Math.min(dt,Oe[3]),Nt=_.ellipsoid.radius,Bt=_.horizontalScale,Zt=x.numVerticesPerSide,nr=Zt-1,Jt=Zt-2,Rr=d.geometryInfo,Br=Rr.vertexAttributes,$r=Br.position,Yr=Br.uv0,cs=Br.normalCompressed,Xr=Rr.uvRange,os=Xr[0],br=Xr[1],Vr=Xr[2],lr=Xr[3],wr=Rr.boundingBox,Gr=U[0],zr=U[1],rs=U[2],ls=$r.typedBuffer,ms=$r.typedBufferStride;let ss=0;const Ms=(0,xr.uZ)(it,Mt,Pt),Hs=ne?(Math.PI/2-2*Math.atan(Math.exp(-Ms/Nt)))*Nt:Ms*Bt,Js=1/nr,Gs=(0,xr.uZ)(it*(1-Js)+dt*Js,Mt,Pt);let bs=Hs,ps=ne?(Math.PI/2-2*Math.atan(Math.exp(-Gs/Nt)))*Nt:Gs*Bt;for(let _s=1;_s<=Jt;_s++){const Is=_s/nr,is=(0,xr.uZ)(it*(1-Is)+dt*Is,Mt,Pt),ii=(0,xr.uZ)(Is,br,lr),Ys=ps,Zs=(_s-1)/nr,ks=(0,xr.uZ)(it*(1-Zs)+dt*Zs,Mt,Pt),ds=bs,qs=(_s+1)/nr,Ni=(0,xr.uZ)(it*(1-qs)+dt*qs,Mt,Pt),Wi=ne?(Math.PI/2-2*Math.atan(Math.exp(-Ni/Nt)))*Nt:Ni*Bt,Pn=(0,xr.uZ)(qs,br,lr);bs=ps,ps=Wi;const bn=(0,xr.uZ)(Ze,Tt,mt);let an=bn*Bt,ji=wn(bn,is,A);const dn=1/nr,_i=(0,xr.uZ)(dn,os,Vr),bi=(0,xr.uZ)(Ze*(1-_i)+lt*_i,Tt,mt);let Ii=_i,sn=bi,ln=bi*Bt,Vi=wn(bi,is,A);if(1===_s){const Ai=ln-Gr,nn=bs-zr,Vn=Vi-rs,Yi=0*ms;ls[Yi+0]=Ai,ls[Yi+1]=nn,ls[Yi+2]=Vn,al(Ai,nn,Vn,wr),ql(Yr,ss,(0,xr.uZ)(dn,os,Vr),ii)}for(let Ai=1;Ai<=Jt;Ai++){const nn=ln,Vn=Vi,Yi=(Ai+1)/nr,Yn=(0,xr.uZ)(Yi,os,Vr),Xn=(0,xr.uZ)(Ze*(1-Yi)+lt*Yi,Tt,mt),Ta=sn;sn=Xn;{const ka=ss+1,Xi=ka*ms;if(1===_s||Ai===Jt){const Sn=Xn*Bt,Wo=Ys,go=wn(Xn,is,A);if(1===_s&&Ai<Jt){const ia=Sn-Gr,Ac=Wo-zr,To=go-rs;ls[Xi+0]=ia,ls[Xi+1]=Ac,ls[Xi+2]=To,al(ia,Ac,To,wr),ql(Yr,ka,Yn,ii)}ln=Sn,Vi=go}else ln=ls[Xi+0]+Gr,Vi=ls[Xi+2]+rs}const Ba=ln,ic=Vi,kc=an,Sc=ji;an=nn,ji=Vn;const sa=(ss-Jt)*ms,$o=1===_s?wn(Ta,ks,A):ls[sa+2]+rs,co=wn(Ta,Ni,A);if(_s<Jt){const ka=ss+Jt,Xi=ka*ms,Sn=nn-Gr,Wo=Wi-zr,go=co-rs;ls[Xi+0]=Sn,ls[Xi+1]=Wo,ls[Xi+2]=go,al(Sn,Wo,go,wr);const ia=Ii;Ii=Yn,ql(Yr,ka,ia,Pn)}{const ka=Ba-kc,Xi=-ka*(ic-Sc),Sn=ds-Wi,Wo=-Sn*($o-co),go=ka*ka+Sn*Sn,ia=Xi*Xi+Wo*Wo+go*go;if(0===ia)Qg(cs,ss,0,0,1);else{const Ac=1/Math.sqrt(ia);Qg(cs,ss,Xi*Ac,Wo*Ac,go*Ac)}}++ss}}}(d):function iz(d){const _=d.geometryState,T=_.samplerData,x=d.tile,U=d.localOrigin,ne=x.surface.isWebMercatorOnPlateeCarree,fe=_.clippingArea,Oe=(0,Qe.pC)(fe)?fe:IE,we=x.extent,Ze=we[0],it=we[1],lt=we[2],dt=we[3],Tt=Math.max(Ze,Oe[0]),mt=Math.min(lt,Oe[2]),Mt=Math.max(it,Oe[1]),Pt=Math.min(dt,Oe[3]),Nt=U[0],Bt=U[1],Zt=U[2],Jt=x.horizontalScale,Rr=fO(ne,x.ellipsoid.radius,Jt),Br=_.numVerticesPerSide,$r=Br-1,Yr=Br-2,cs=d.geometryInfo,Xr=cs.uvRange,os=Xr[0],br=Xr[1],Vr=Xr[2],lr=Xr[3],wr=cs.boundingBox,Gr=cs.vertexAttributes,zr=Gr.position,rs=Gr.uv0;let ls=0;for(let ms=1;ms<=Yr;ms++){const ss=ms/$r,Ms=(0,xr.uZ)(it*(1-ss)+dt*ss,Mt,Pt),Hs=(0,xr.uZ)(ss,br,lr),Js=Rr(Ms)-Bt;for(let Gs=1;Gs<=Yr;Gs++){const bs=Gs/$r,ps=(0,xr.uZ)(Ze*(1-bs)+lt*bs,Tt,mt),_s=(0,xr.uZ)(bs,os,Vr),Is=ps*Jt-Nt,is=wn(ps,Ms,T)-Zt;al(Is,Js,is,wr),zr.setValues(ls,Is,Js,is),ql(rs,ls,_s,Hs),++ls}}}(d))}(d),Kw(d,Tt),Vw(d),Gw(Pt,x.numVerticesPerSide,[],[0,dt-1],[0,dt-1],x.wireframe),d.intersectionData=null})(this.renderData),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){!function oz(d,_){d.tile.intersectsClippingArea&&(Hw(d),zw(d,!0),wE(d))}(this.renderData)}updateEdgeElevations(){!function az(d,_){d.tile.intersectsClippingArea&&(Vw(d),wE(d))}(this.renderData)}}const LE=(0,ir.c)();var ey;!function(d){d[d.BACK_TO_FRONT=-1]="BACK_TO_FRONT",d[d.NONE=0]="NONE",d[d.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(ey||(ey={}));class hz extends uO{constructor(_,T,x){super(),this._obb=new Array(8);for(let A=0;A<8;A++)this._obb[A]=(0,ir.c)();void 0!==_&&this.init(_,T,x)}init(_,T,x){super.init(_,T,x);const A=this.ellipsoid.radius,U=this.extentInRadians[0],ne=this.extentInRadians[1],fe=this.extentInRadians[2],Oe=this.extentInRadians[3],we=_[0],Ze=(0,xr.t7)(ne,Oe,.5),it=(0,xr.t7)(U,fe,.5),lt=0===we?0:Math.min(Math.abs(ne),Math.abs(Oe));this._edgeLen=(fe-U)*Math.cos(lt)*A,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=A-Math.sqrt(A*A-this._edgeLen2/4),(0,di.zP)(this.centerAtSeaLevel,it,Ze,this.ellipsoid.radius);const dt=(0,ir.d)(this.centerAtSeaLevel);(0,pt.n)(dt,dt),this.up=dt,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(0===this.lij[0])(0,pt.s)(this._center[gu.MIDDLE],0,0,0),(0,pt.s)(this._center[gu.TOP],0,0,0),(0,pt.s)(this._center[gu.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=(0,En.Iu)(this.surface.spatialReference)),this._center[gu.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const _=Math.max((0,pt.d)(this._center[gu.MIDDLE],this._obb[0]),(0,pt.d)(this._center[gu.MIDDLE],this._obb[1]));this._center[gu.MIDDLE][3]=Math.sqrt(_)}}_calculateFrustumVisibilityStatus(_){if(!(0,rn.hr)(_,this._center[gu.MIDDLE]))return Vs.ir.OUTSIDE;if(this.lij[0]<10)return Vs.ir.INTERSECTS;const T=this._obb,x=this.surface.view.state.camera.near;let A=!0;for(let U=0;U<rn.tc.NUM;U++){const fe=_[U],Oe=fe[0],we=fe[1],Ze=fe[2],it=fe[3]-(U===rn.Nu.NEAR?x:0);let lt=!1;for(let dt=0;dt<8;++dt){const Tt=T[dt];if(Oe*Tt[0]+we*Tt[1]+Ze*Tt[2]+it<0){if(lt=!0,!A)break}else A=!1}if(!lt)return Vs.ir.OUTSIDE}return A?Vs.ir.INSIDE:Vs.ir.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const _=this._getPatchType(this.lij[1],this.lij[0]);(function YV(d,_){const T=d.tile,{extent:x,extentInRadians:A,surface:U}=T,ne=d.localOrigin,fe=d.geometryState,Oe=U.isWebMercator,we=U.shading||y0,Ze=fe.numVerticesPerSide,it=Ze-1,lt=(Ze-2)**2,dt=Oe&&(_===Vs.tk.HAS_SOUTH_POLE||_===Vs.tk.HAS_BOTH_POLES),Tt=Oe&&(_===Vs.tk.HAS_NORTH_POLE||_===Vs.tk.HAS_BOTH_POLES),Mt=6*((dt?1:0)+(Tt?1:0))*(it+1),Pt=fe.neighborData,Nt=Pt.edgeResolutions.reduce((Br,$r)=>Br+$r+1,0),Bt=Mw(lt+Mt+Nt),Zt=d.geometryInfo;Zt.numVerticesPerSide=fe.numVerticesPerSide,Zt.vertexAttributes=Bt;const nr=Zt.boundingBox;(0,fo.cS)(nr);const Jt=_O(d);Io.update(it,A,Jt),function XV(d){const _=d.tile;_.intersectsClippingArea&&(_.surface.shading||y0?function JV(d){const _=d.geometryState,T=_.numVerticesPerSide,x=T-2,A=T-1,U=d.geometryInfo,ne=U.vertexAttributes,fe=ne.position,Oe=ne.uv0,we=ne.normalCompressed,Ze=d.tile,it=Ze.extent,lt=it[0],dt=it[2],Tt=it[1],mt=it[3],Mt=Ze.ellipsoid.radius,Pt=_.samplerData,Nt=d.localOrigin,Bt=Nt[0],Zt=Nt[1],nr=Nt[2],Jt=fe.typedBuffer,Rr=fe.typedBufferStride,Br=1/A,$r=U.boundingBox;let Yr=0;if(1<=x){const cs=Br,Xr=Tt*(1-cs)+mt*cs,os=Io.sinLatLUT[1],br=Io.cosLatLUT[1];for(let Vr=1;Vr<=x;Vr++){const lr=Vr*Br,Gr=Io.sinLonLUT[Vr],zr=Io.cosLonLUT[Vr],rs=Mt+wn(lt*(1-lr)+dt*lr,Xr,Pt),ls=rs*zr*br-Bt,ms=rs*Gr*br-Zt,ss=rs*os-nr;al(ls,ms,ss,$r);const Ms=(Vr-1)*Rr;Jt[Ms+0]=ls,Jt[Ms+1]=ms,Jt[Ms+2]=ss,ql(Oe,Vr-1,lr,cs)}}for(let cs=1;cs<=x;cs++){const Xr=cs*Br,os=Tt*(1-Xr)+mt*Xr,br=Io.sinLatLUT[cs],Vr=Io.cosLatLUT[cs],lr=cs+1,wr=lr*Br,Gr=Tt*(1-wr)+mt*wr,zr=Io.sinLatLUT[lr],rs=Io.cosLatLUT[lr],ls=Io.sinLonLUT[0],ms=Io.cosLonLUT[0],ss=Mt+wn(lt,os,Pt);let Ms=ms*Vr*ss-Bt,Hs=ls*Vr*ss-Zt,Js=br*ss-nr;const Gs=Yr*Rr;let bs=Jt[Gs+0],ps=Jt[Gs+1],_s=Jt[Gs+2];for(let Is=1;Is<=x;Is++){const is=Is*Br,ii=lt*(1-is)+dt*is,Ys=Io.sinLonLUT[Is],Zs=Io.cosLonLUT[Is],ks=Zs*Vr,ds=Ys*Vr,qs=br;let Ni=0,Wi=0,Pn=0;{let an=0,ji=0,dn=0;if(Is<x){const Yi=(Yr+1)*Rr;an=Jt[Yi+0],ji=Jt[Yi+1],dn=Jt[Yi+2]}else{const Yi=Io.sinLonLUT[A],Yn=Io.cosLonLUT[A],Xn=Mt+wn(dt,os,Pt);an=Yn*Vr*Xn-Bt,ji=Yi*Vr*Xn-Zt,dn=br*Xn-nr}const _i=Ms,bi=Hs,Ii=Js;Ms=bs,Hs=ps,Js=_s,bs=an,ps=ji,_s=dn;const sn=an-_i,ln=ji-bi,Vi=dn-Ii,Ai=ln*qs-Vi*ds,nn=Vi*ks-sn*qs,Vn=sn*ds-ln*ks;Ni=nn*Vi-Vn*ln,Wi=Vn*sn-Ai*Vi,Pn=Ai*ln-nn*sn}{let an=0,ji=0,dn=0;if(cs>1){const _i=(Yr-x)*Rr;an=Jt[_i+0],ji=Jt[_i+1],dn=Jt[_i+2]}else{const _i=Io.sinLatLUT[0],bi=Io.cosLatLUT[0],Ii=Mt+wn(ii,Tt,Pt);an=Zs*bi*Ii-Bt,ji=Ys*bi*Ii-Zt,dn=_i*Ii-nr}{const _i=Mt+wn(ii,Gr,Pt),bi=Zs*rs*_i-Bt,Ii=Ys*rs*_i-Zt,sn=zr*_i-nr;if(cs<x){const Yn=Yr+x,Xn=Yn*Rr;Jt[Xn+0]=bi,Jt[Xn+1]=Ii,Jt[Xn+2]=sn,al(bi,Ii,sn,$r),ql(Oe,Yn,is,wr)}const ln=an-bi,Vi=ji-Ii,Ai=dn-sn,nn=Vi*qs-Ai*ds,Vn=Ai*ks-ln*qs,Yi=ln*ds-Vi*ks;Ni+=Vn*Ai-Yi*Vi,Wi+=Yi*ln-nn*Ai,Pn+=nn*Vi-Vn*ln}}const bn=1/Math.sqrt(Ni*Ni+Wi*Wi+Pn*Pn);Qg(we,Yr,Ni*bn,Wi*bn,Pn*bn),++Yr}}}(d):function kV(d){const _=d.geometryState,T=_.numVerticesPerSide,x=T-2,A=T-1,U=d.geometryInfo,ne=U.vertexAttributes,fe=ne.position,Oe=ne.uv0,we=d.tile,Ze=we.extent,it=Ze[0],lt=Ze[2],dt=Ze[1],Tt=Ze[3],mt=we.ellipsoid.radius,Mt=_.samplerData,Pt=d.localOrigin,Nt=Pt[0],Bt=Pt[1],Zt=Pt[2],nr=U.boundingBox,Jt=fe.typedBuffer,Rr=fe.typedBufferStride;let Br=0;for(let $r=1;$r<=x;$r++){const Yr=$r/A,cs=dt*(1-Yr)+Tt*Yr,Xr=Io.sinLatLUT[$r],os=Io.cosLatLUT[$r];for(let br=1;br<=x;br++){const Vr=br/A,wr=Io.sinLonLUT[br],Gr=Io.cosLonLUT[br],zr=mt+wn(it*(1-Vr)+lt*Vr,cs,Mt),rs=Gr*os*zr-Nt,ls=wr*os*zr-Bt,ms=Xr*zr-Zt;al(rs,ls,ms,nr);const ss=Br*Rr;Jt[ss+0]=rs,Jt[ss+1]=ls,Jt[ss+2]=ms,ql(Oe,Br,Vr,Yr),++Br}}}(d))}(d),Kw(d,lt),jw(d);const Rr=[];if((()=>{let Br=lt+Nt;const $r=ne[0],Yr=ne[1],cs=ne[2],Xr=T.ellipsoid.radius,os=x[1],br=x[3],Vr=(lr,wr)=>{const Gr=wr*Ze;al(-$r,-Yr,lr*Xr-cs,nr),Rr.push({connectedRowOffset:Gr,connectedOuterEdgeOffset:1===lr?0:2,rowOffset:Br,latitudeResolution:6});const zr=Ww(-1===lr?os:br,Xr),rs=lr*Math.PI/2-zr,ls=.99*(1===lr?1:-1),ms=Xr+0,ss=Bt.position,Ms=Bt.uv0,Hs=Bt.normalCompressed;for(let Js=1;Js<=6;++Js){const Gs=zr+rs*(Js/6),bs=Math.cos(Gs),ps=Math.sin(Gs);for(let _s=0;_s<=it;_s++){const Is=_s/it,ii=Io.cosLonLUT[_s]*bs,Ys=Io.sinLonLUT[_s]*bs,Zs=ps,ks=ii*ms-$r,ds=Ys*ms-Yr,qs=Zs*ms-cs;al(ks,ds,qs,nr),ss.setValues(Br,ks,ds,qs),ql(Ms,Br,Is,ls),we&&Qg(Hs,Br,ii,Ys,Zs),++Br}}};dt&&Vr(-1,0),Tt&&Vr(1,it)})(),Gw(Zt,fe.numVerticesPerSide,Rr,[0,Ze-1],[0,Ze-1],fe.wireframe),d.intersectionData=null,Cr.jt)for(let Br=0;Br<4;++Br)(0,Cr.Fp)(Zt.outerEdges[Br].count===Pt.edgeResolutions[Br]+1)})(this.renderData,_),this.setMemoryDirty()}_updateOBB(){const _=this.extentInRadians,T=this._obb;for(let x=0;x<2;x++){const A=this.elevationBounds[x];let U=4*x;(0,di.zP)(T[U++],_[0],_[1],this.ellipsoid.radius+A),(0,di.zP)(T[U++],_[0],_[3],this.ellipsoid.radius+A),(0,di.zP)(T[U++],_[2],_[3],this.ellipsoid.radius+A),(0,di.zP)(T[U++],_[2],_[1],this.ellipsoid.radius+A)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Vs.tk.HAS_NORTH_POLE:(0,pt.s)(T[1],0,0,this.ellipsoid.radius),(0,pt.s)(T[2],0,0,this.ellipsoid.radius),(0,pt.s)(T[5],0,0,this.ellipsoid.radius),(0,pt.s)(T[6],0,0,this.ellipsoid.radius);break;case Vs.tk.HAS_SOUTH_POLE:(0,pt.s)(T[0],0,0,-this.ellipsoid.radius),(0,pt.s)(T[3],0,0,-this.ellipsoid.radius),(0,pt.s)(T[4],0,0,-this.ellipsoid.radius),(0,pt.s)(T[7],0,0,-this.ellipsoid.radius)}}_getPatchType(_,T){return _===(1<<T)-1?0===_?Vs.tk.HAS_BOTH_POLES:Vs.tk.HAS_SOUTH_POLE:0===_?Vs.tk.HAS_NORTH_POLE:Vs.tk.REGULAR}intersectsRay(_,T,x,A){const U=this._center[gu.MIDDLE],ne=U[3]+x,Oe=U[0]-_[0],we=U[1]-_[1],Ze=U[2]-_[2],it=(Oe*T[0]+we*T[1]+Ze*T[2])/(T[0]*T[0]+T[1]*T[1]+T[2]*T[2]),lt=T[0]*it-Oe,dt=T[1]*it-we,Tt=T[2]*it-Ze;return lt*lt+dt*dt+Tt*Tt<ne*ne}getDefaultVerticesPerRowOnLevel(){return this.level<Xw.length?Xw[this.level]+1:2}updateCornerElevations(){!function qV(d){d.tile.intersectsClippingArea&&(Nw(d),Fw(d,!0),wE(d))}(this.renderData)}updateEdgeElevations(){!function QV(d){d.tile.intersectsClippingArea&&(jw(d),wE(d))}(this.renderData)}}const Xw=[128,64,32,16,16,8,8,4];var gu;!function(d){d[d.TOP=0]="TOP",d[d.MIDDLE=1]="MIDDLE",d[d.BOTTOM=2]="BOTTOM"}(gu||(gu={}));var of=v(60479);class pz{constructor(){this.extent=(0,Tn.c)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class _z{constructor(){this._queries=new wo.Z({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new wo.Z({initialSize:30}),this._queryPool=new Wu.Z(pz)}queryVisibleLevelRange(_,T,x,A){const U=this._queryPool.acquire();(0,Qo.c)(U.extent,_),U.minLevel=T||-Number.MAX_VALUE,U.maxLevel=x??Number.MAX_VALUE,U.callback=A,this._queryQueue.push(U)}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const _=this._queryQueue.pop();this._queries.push(_)}this._queriesInvPtr=this._queries.length}processQueries(){for(let _=0;_<this._queries.length;_++){const T=this._queries.data[_];this._queryPool.release(T),T.callback(_>=this._queriesInvPtr),T.callback=null}this._queries.clear()}scaleQueriesForTile(_){const T=_.level;let x=0;for(;x<this._queriesInvPtr;){const A=this._queries.data[x],U=A.extent;T>=A.minLevel&&T<=A.maxLevel&&U[0]<=_.extent[2]&&U[2]>=_.extent[0]&&U[1]<=_.extent[3]&&U[3]>=_.extent[1]?(this._queries.swapElements(x,this._queriesInvPtr-1),this._queriesInvPtr--):x++}}}var $u=v(7699);class kw extends pi.m{constructor(){super(...arguments),this.blendMode=$u.iM.Normal}}(0,Ve._)([(0,pi.o)({count:$u.iM.COUNT})],kw.prototype,"blendMode",void 0);var In=v(87191);class af extends kw{constructor(){super(...arguments),this.output=In.lG.Composite,this.baseOpacityMode=In.Iu.NotRequired,this.premultipliedSource=In.m9.Off,this.hasWebGL2Context=!1}}(0,Ve._)([(0,pi.o)({count:In.lG.COUNT})],af.prototype,"output",void 0),(0,Ve._)([(0,pi.o)({count:In.Iu.COUNT})],af.prototype,"baseOpacityMode",void 0),(0,Ve._)([(0,pi.o)()],af.prototype,"premultipliedSource",void 0),(0,Ve._)([(0,pi.o)()],af.prototype,"hasWebGL2Context",void 0);var fz=v(14273),UE=v(87204);class mz extends fz.R{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=ir.Z}}class BE extends so.A{initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2}initializeProgram(_){return new Gn.$(_.rctx,BE.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}BE.shader=new ro.J(UE.B,()=>v.e(7298).then(v.bind(v,7298)));class Jw extends af{constructor(){super(...arguments),this.background=UE.a.BelowLayer}}(0,Ve._)([(0,pi.o)()],Jw.prototype,"background",void 0);class gO{constructor(_,T,x,A,U,ne){this.texture=_,this.type=T,_.retain(),this.offsetAndScale=(0,Tn.f)(x.offset[0],x.offset[1],x.scale,x.scale),this.opacities=(0,ir.f)(A,U,ne)}destroy(){this.texture.release()}}var lf=v(62449),Dl=v(31478),gz=v(12225);Object.freeze(Object.defineProperty({__proto__:null,create:function Qh(){return[1,0,0,1,0,0]},clone:function yz(d){return[d[0],d[1],d[2],d[3],d[4],d[5]]},fromValues:function vz(d,_,T,x,A,U){return[d,_,T,x,A,U]},createView:function Ez(d,_){return new Float64Array(d,_,6)}},Symbol.toStringTag,{value:"Module"}));var cf=v(49966),Qw=v(9545),yO=v(75957);Math;function vO(d,_){return _.type?(0,ti.s)(d,_.x,_.y):(0,ti.c)(d,_)}function zd(d,_){const T=d.targetGeometry,x=_.targetGeometry;return T.x=x.x,T.y=x.y,T.spatialReference=x.spatialReference,d.scale=_.scale,d.rotation=_.rotation,d}const Mz=function(){const d=(0,un.a)();return function(_,T,x){const A=T.targetGeometry;vO(d,A);const U=.5*uf(T);return _.xmin=d[0]-U*x[0],_.ymin=d[1]-U*x[1],_.xmax=d[0]+U*x[0],_.ymax=d[1]+U*x[1],_.spatialReference=A.spatialReference,_}}(),sI=function(){const d=(0,un.a)();return function(_,T,x){return(0,ti.e)(_,function Sz(d,_){return(0,ti.b)(d,_,.5)}(_,T),function Tz(d,_,T){return T?(0,ti.s)(d,.5*(_[0]-T.right+T.left),.5*(_[1]-T.bottom+T.top)):(0,ti.b)(d,_,.5)}(d,T,x))}}();!function(){const d=[1,0,0,1,0,0],_=(0,un.a)()}();function uf(d){return d.scale*function xz(d){return(0,Qe.pC)(d)&&(0,hc.JY)(d.spatialReference)?1/(39.37*function rI(d){return(0,dM.c9)(d)}(d.spatialReference)*96):1}(d.targetGeometry)}function TO(d){return(0,OE.t)(d.rotation)||0}const MO=function(){const d=(0,un.a)(),_=(0,un.a)(),T=(0,un.a)();return function(x,A,U,ne,fe,Oe){return(0,ti.n)(d,A),(0,ti.b)(_,U,.5*Oe),(0,ti.s)(T,1/ne*Oe,-1/ne*Oe),(0,Dl.a)(x,_),fe&&(0,Dl.r)(x,x,fe),(0,Dl.s)(x,x,T),(0,Dl.t)(x,x,d),x}}(),PO=function(){const d=(0,un.a)();return function(_,T,x,A){const U=uf(T),ne=TO(T);return vO(d,T.targetGeometry),MO(_,d,x,U,ne,A)}}(),Az=function(){const d=(0,un.a)();return function(_,T,x,A){const U=uf(T);return vO(d,T.targetGeometry),MO(_,d,x,U,0,A)}}();(0,un.a)(),(0,un.a)(),(0,un.a)(),(0,un.a)();(function(){const d=(0,un.a)()})(),function(){const d=(0,un.a)()}();const iI=((0,un.a)(),(0,un.a)(),function(){const d=[1,0,0,1,0,0];return function(_,T,x,A){return(0,ti.t)(_,T,function Pz(d,_,T,x){return PO(d,_,T,x),(0,Dl.c)(d,d)}(d,x,A,1))}}()),nI=function(){const d=[1,0,0,1,0,0];return function(_,T,x,A){return(0,ti.t)(_,T,PO(d,x,A,1))}}(),OO=function(){const d=(0,un.a)(),_=[1,0,0,1,0,0];return function(T,x,A){zd(T,x);const U=uf(x),ne=T.targetGeometry;return(0,Dl.b)(_,TO(x)),(0,Dl.s)(_,_,(0,un.f)(U,U)),(0,ti.t)(d,A,_),ne.x+=d[0],ne.y+=d[1],T}}();var xO;const Hd=[0,0];let qh=xO=class extends zl.wq{constructor(d){super(d),this._viewpoint2D={center:(0,un.a)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new bl.Z,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=(0,cf.c)(),this.displayViewMat3=(0,cf.c)(),this.viewMat3=(0,cf.c)(),this.viewMat2d=(0,gz.c)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(d){this._set("pixelRatio",d),this._update()}set size(d){this._set("size",d),this._update()}set viewpoint(d){if(d){const _=this._viewpoint2D,T=d.targetGeometry;_.center[0]=T.x,_.center[1]=T.y,_.rotation=d.rotation,_.scale=d.scale,_.spatialReference=T.spatialReference}this._update()}copy(d){const _=this.size,T=this.viewpoint;return T&&_?(this.viewpoint=zd(T,d.viewpoint),this._set("size",(0,ti.c)(_,d.size))):(this.viewpoint=d.viewpoint.clone(),this._set("size",[d.size[0],d.size[1]])),this._set("pixelRatio",d.pixelRatio),this}clone(){return new xO({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(d,_,T){return(0,yO.lM)(_)?(0,ti.t)(d,_,this.inverseTransform):(Hd[0]=_,Hd[1]=T,(0,ti.t)(d,Hd,this.inverseTransform))}toScreen(d,_,T){return(0,yO.lM)(_)?(0,ti.t)(d,_,this.transform):(Hd[0]=_,Hd[1]=T,(0,ti.t)(d,Hd,this.transform))}toScreenNoRotation(d,_,T){return(0,yO.lM)(_)?(0,ti.t)(d,_,this.transformNoRotation):(Hd[0]=_,Hd[1]=T,(0,ti.t)(d,Hd,this.transformNoRotation))}getScreenTransform(d,_){const{center:T}=this._viewpoint2D,x=this._get("pixelRatio")||1,A=this._get("size");return MO(d,T,A,_,0,x),d}_update(){const{center:d,spatialReference:_,scale:T,rotation:x}=this._viewpoint2D,A=this._get("pixelRatio")||1,U=this._get("size"),ne=new iu({targetGeometry:new vn.Z(d[0],d[1],_),scale:T,rotation:x});if(this._set("viewpoint",ne),!U||!_||!T)return;this.resolution=uf(ne),this.rotation=x,this.scale=T,this.spatialReference=_,(0,ti.c)(this.center,d),(0,Co.s)(this.displayMat3,0!==U[0]?2/U[0]:0,0,0,0,0!==U[1]?-2/U[1]:0,0,-1,1,1);const we=(0,Co.g)(this.viewMat3),Ze=(0,Qw.f)(U[0]/2,U[1]/2),it=(0,Qw.f)(-U[0]/2,-U[1]/2),lt=(0,OE.t)(x);(0,Co.h)(we,we,Ze),(0,Co.r)(we,we,lt),(0,Co.h)(we,we,it),(0,Co.m)(this.displayViewMat3,this.displayMat3,we);const dt=(0,Dl.a)(this.viewMat2d,Ze);return(0,Dl.r)(dt,dt,lt),(0,Dl.t)(dt,dt,it),Mz(this.extent,ne,U),PO(this.transform,ne,U,A),(0,Dl.c)(this.inverseTransform,this.transform),Az(this.transformNoRotation,ne,U,A),this.worldScreenWidth=function wz(d,_){return Math.round(function Rz(d){const _=(0,hc.C5)(d);return _?_.valid[1]-_.valid[0]:0}(d)/_)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],qh.prototype,"id",void 0),(0,Ve._)([(0,ke.Cb)({value:1,json:{write:!0}})],qh.prototype,"pixelRatio",null),(0,Ve._)([(0,ke.Cb)({json:{write:!0}})],qh.prototype,"size",null),(0,Ve._)([(0,ke.Cb)()],qh.prototype,"spatialReference",void 0),(0,Ve._)([(0,ke.Cb)({type:iu,json:{write:!0}})],qh.prototype,"viewpoint",null),qh=xO=(0,Ve._)([(0,Wr.j)("esri.views.2d.ViewState")],qh);const Bz=qh;class Fz{constructor(){this._renderParams={context:null,drawPhase:1,state:new Bz({viewpoint:new iu({targetGeometry:new vn.Z(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(_,T,x,A,U,ne,fe,Oe,we,Ze){const it=ne.adjustLevel(T[0]),lt=this._renderParams;lt.context=_,lt.painter=A,lt.glyphMosaic=A.glyphMosaic,lt.spriteMosaic=A.spriteMosaic,lt.pixelRatio=Ze,lt.displayLevel=it,lt.requiredLevel=it;const dt=ne.getScale(T[0]),[Tt,mt]=ne.getShift(T,fe*dt),Mt=.125*fe*dt/we,Pt=x.transforms.dvs;Pt[0]=Mt,Pt[4]=-Mt,Pt[6]=-1-Tt-Oe[0]*fe*2,Pt[7]=1+mt+(1-Oe[1])*fe*2-2,lt.state.size[0]=we,lt.state.size[1]=we,x.stage||x.attachWithContext(_),x.triangleCount=0,A.drawTile(lt,x,U)}}var Nz=v(44796);class FE extends so.A{initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2}initializeProgram(_){return new Gn.$(_.rctx,FE.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}FE.shader=new ro.J(Nz.R,()=>v.e(9903).then(v.bind(v,89903)));class NE extends af{constructor(){super(...arguments),this.colorizerType=lf.U.Stretch,this.stretchType=lf.H.Noop,this.applyColormap=!0}}(0,Ve._)([(0,pi.o)({count:lf.U.COUNT})],NE.prototype,"colorizerType",void 0),(0,Ve._)([(0,pi.o)({count:lf.H.COUNT})],NE.prototype,"stretchType",void 0),(0,Ve._)([(0,pi.o)()],NE.prototype,"applyColormap",void 0);class oI{constructor(_){this._rctx=_,this._fbos=new Map}get(_){return this._getPool(_)}dispose(){this._fbos.forEach(_=>_.dispose()),this._fbos.clear()}_getPool(_){const T=this._fbos.get(_);if(T)return T;const x=new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.DEPTH_RENDER_BUFFER,width:_,height:_});return this._fbos.set(_,x),x}}const Wz=Us.Z.getLogger("esri.views.3d.terrain");class Vz{constructor(_,T){this._rctx=_,this._techniqueRepository=T,this._fbos=[],this._vectorTileHelper=new Fz,this._bindParameters=new hP.p(null,null,null),this._blendLayersTechniqueConfig=new Jw,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=(0,_a.ow)(this._rctx,P_.Bn)}dispose(){this._fbos.forEach(_=>{_.dispose(),_=null}),this._fbos=null,this._vtFBO=(0,Qe.M2)(this._vtFBO),this._vaoQuad=(0,Qe.M2)(this._vaoQuad),this._vectorTileHelper=(0,Qe.M2)(this._vectorTileHelper),this._backgroundTechnique=(0,Qe.RY)(this._backgroundTechnique),this._applyOpacityTechnique=(0,Qe.RY)(this._applyOpacityTechnique),this._blendLayersTechnique=(0,Qe.RY)(this._blendLayersTechnique)}_getBlendLayersTechnique(_,T,x,A=In.m9.Off,U=UE.a.BelowLayer){return this._blendLayersTechniqueConfig.output=T,this._blendLayersTechniqueConfig.blendMode=_,this._blendLayersTechniqueConfig.baseOpacityMode=x,this._blendLayersTechniqueConfig.premultipliedSource=A,this._blendLayersTechniqueConfig.background=U,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(BE,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(_,T){const x=this._getBlendLayersTechnique($u.iM.Normal,T?In.lG.ColorComposite:In.lG.GridComposite,In.Iu.NotRequired,In.m9.Off,UE.a.Only),A=this._rctx.bindTechnique(x,_,this._bindParameters);this._render(A)}_render(_){this._rctx.bindVAO(this._vaoQuad),_.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(this._vaoQuad,"geometry"))}drawGroup(_,T,x,A,U,ne=In.m9.On){T===In.lG.Composite&&(_.fboTexture=this._fbos[this.getLastOnHoldId()].get(x).colorTexture),_.texture=this.currentFBO(x).colorTexture,this.closeGroup(x);const fe=this._getBlendLayersTechnique(A,T,U,ne),Oe=this._rctx.bindTechnique(fe,_,this._bindParameters);this._render(Oe)}drawRasterData(_,T,x,A,U,ne=In.m9.Off){if((0,Qe.Wi)(_.texture))return;_.fboTexture=T===In.lG.GroupBackgroundComposite||A===$u.iM.Normal&&U===In.Iu.NotRequired&&ne===In.m9.Off?null:this.switch(x).colorTexture;const fe=this._getBlendLayersTechnique(A,T,U,ne),Oe=this._rctx.bindTechnique(fe,_,this._bindParameters);this._render(Oe)}drawImageryTileData(_,T,x,A,U,ne){const fe=ne.sourceLayerInfo.data;if(!fe.source||(ne.tile.surface.layerViewByIndex(ne.layerIndex,Bi.MAP).ensureSymbolizerParameters(fe),!fe.bind(this._rctx)))return;_.fboTexture=A===$u.iM.Normal&&U===In.Iu.NotRequired?null:this.switch(x).colorTexture;const Oe=this._getRasterColorizerTechnique(fe,T,A,U);fe.opacity=_.opacity;const we=fe.getUniforms();we.scale=ne.scale,we.offset=ne.offset,we.backgroundColor=_.backgroundColor,we.fboTexture=_.fboTexture,we.baseOpacity=_.baseOpacity;const Ze=this._rctx.bindTechnique(Oe,we,null);this._render(Ze)}_getRasterColorizerTechnique(_,T,x,A){const U=_.symbolizerParameters,ne=["stretch","lut","hillshade"].indexOf(U.type);return(0,Qe.Wi)(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new NE,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=T,this._rasterColorizerConfig.blendMode=x,this._rasterColorizerConfig.baseOpacityMode=A,this._rasterColorizerConfig.colorizerType=ne,this._rasterColorizerConfig.applyColormap=!!U.colormap,this._rasterColorizerConfig.stretchType=_.hasStretchTypeNone()?lf.H.Noop:lf.H.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(FE,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(_,T,x,A,U,ne,fe,Oe,we){const Ze=this._rctx,it=ne.sourceLayerInfo.data,lt=ne.tile.surface.layerViewByIndex(ne.layerIndex,Bi.MAP),dt=U===In.Iu.Required||_.opacity<1||A!==$u.iM.Normal||T!==In.lG.Composite,Tt=dt?In.m9.On:In.m9.Off;this._getBlendLayersTechnique(A,T,U,Tt).bindPipelineState(Ze);let mt=null,Mt=null;dt?(Mt=this.currentFBO(x),(0,Qe.Wi)(this._vtFBO)&&(this._vtFBO=new oI(this._rctx)),mt=this._vtFBO.get(x),Ze.bindFramebuffer(mt),this._clearCurrentFBO()):we&&Ze.clearSafe(xt.lk.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(Ze,ne.sourceLod,it,lt.painter,lt.layer.styleRepository,lt.schemaHelper,Math.round(1/ne.scale),ne.offset,Oe,fe)}catch(Pt){Wz.warnOnce("A render call containing vector tiles did not resolve correctly.",Pt)}return!(0,Qe.pC)(mt)||(Ze.bindFramebuffer(Mt),_.texture=mt.colorTexture,_.offset=un.Z,_.scale=1,this.drawRasterData(_,T,x,A,U,Tt),we)}copyFBOToTexture(_){const T=this._rctx,x=T.bindTexture(_.texture,Ro.x.TEXTURE_UNIT_FOR_UPDATES),A=_.descriptor;T.gl.copyTexImage2D(xt.No.TEXTURE_2D,0,A.pixelFormat,0,0,A.width,A.height,0),_.generateMipmap(),T.bindTexture(x,Ro.x.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(xt.lk.COLOR_BUFFER_BIT|xt.lk.DEPTH_BUFFER_BIT)}_initFBO(_,T,x){this._rctx.bindFramebuffer(_),x&&(this._rctx.setViewport(0,0,T,T),this._clearCurrentFBO())}ensureBuffer(_){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(_)}bind(_,T=0,x=!0){if(this._current=T,T>=this._fbos.length)for(let A=this._fbos.length;A<=T;A++)this._fbos.push(new oI(this._rctx));this._initFBO(this._fbos[T].get(_),_,x)}_bindNextFreeBuffer(_){this._lastUsedIds.length>0?this.bind(_,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(_,this._lastCreatedBufferId))}openGroup(_){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(_)}switch(_){const T=this.currentFBO(_),x=this._current;return this._bindNextFreeBuffer(_),this._lastUsedIds.push(x),T}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(_){const T=this._current;this._bindNextFreeBuffer(_),this._lastUsedIds.push(T),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(_){return this._fbos[this._current].get(_)}}class zz{constructor(_,T,x,A){this.start=_,this.end=T,this.blendMode=x,this.opacity=A}}class Hz{constructor(_,T,x){this._rctx=_,this.tileSize=T,this._techniqueRepository=x,this._passParameters=new mz,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Vz(this._rctx,this._techniqueRepository),this._blackTex=new tf((0,_a.YO)(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=(0,Qe.M2)(this._composition),this._backgroundTexture=(0,Qe.RY)(this._backgroundTexture),this._blackTex=(0,Qe.RY)(this._blackTex)}get backgroundIsGrid(){return(0,Qe.Wi)(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(_,T){if(!_.renderData)return;const x=_.surface,A=x.baseOpacity;let U=0,ne=0,fe=this.tileSize,Oe=!1;const we=x.view.state.pixelRatio;let Ze=!1;ry.clear(),df.length=0;const it=_.layerInfo[Bi.MAP];let lt=it.length,dt=0;for(;dt<it.length;dt++){const Mt=x.layerViewByIndex(dt,Bi.MAP),Pt=Mt.layer.opacity;cI[dt]=Pt;const Nt=Mt.fullOpacity;if(uI[dt]=Nt,(0,Gl.sy)(Mt.layer)&&lt>=it.length&&(lt=dt),(0,Cr.TK)(Mt)){dI[dt]=Mt.layer.blendMode;let Zt="normal"!==Mt.layer.blendMode;if((0,Cr.CY)(Mt.layer.parent)){const nr=SO(Mt.layer.parent);(0,Qe.pC)(nr)&&""!==nr&&(Zt=aI(Mt.layer.parent)||Zt)}Zt&&(Ze=Zt,Oe=!1)}if(0===Pt&&!Ze){it[dt].pendingUpdates&=~(ni.TEXTURE_NOFADING&ni.TEXTURE_FADING);continue}++ne;const Bt=DO(_,dt);if(Bt){if(it[dt].pendingUpdates&=~(ni.TEXTURE_NOFADING&ni.TEXTURE_FADING),(0,Cr.CY)(Mt.layer.parent)){const Zt=SO(Mt.layer.parent);(0,Qe.pC)(Zt)&&""!==Zt&&lI(Mt.layer.parent,dt)}(0,Cr.Q)(Mt)?fe=Math.max(fe,this.tileSize*we):1===A&&1===Nt&&(Mt.isOpaque||this._dataToTexture(Bt)&&Bt.sourceLayerInfo.data.descriptor.isOpaque)&&(Oe=!0),++U}}fe=function Gz(d){const _=(0,xr.Sf)(d),T=_*_,x=d*d;if(T===x)return d;const A=_/2;return T-x<x-A*A?_:A}(fe);const Tt=fe/this.tileSize,mt=dt-1;this._ensureBackgroundTexture(this.tileSize),0!==U?1===U&&!Ze&&this._useLayerTexture(_,mt,lt,uI[mt])||this._composeMapLayers(_,T,mt,lt,cI,dI,fe,Tt,!Oe||Ze,ry,Ze):this._useBackgroundTexture(_,ne)}_ensureBackgroundTexture(_){(0,Qe.Wi)(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(_),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(_),this._passParameters.offset=un.Z,this._passParameters.scale=1,this._passParameters.opacity=1,(0,Qe.pC)(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,(0,Qe.pC)(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(_,T){let x=Wd.Immediate;(_.surface.view.layerViewManager.updating||T>0)&&(x=Wd.Delayed),this._backgroundTexture&&(0,Qe.Wi)(_.renderData.textureReference)&&(x=Wd.Immediate),_.renderData.setTextureReference((0,Qe.pC)(this._backgroundTexture)?new gO(this._backgroundTexture,Vs.Ns.FADING,hI,_.surface.baseOpacity,0,1):null,x)}_useLayerTexture(_,T,x,A){const U=T<x,ne=U?1:_.surface.baseOpacity,fe=U?_.surface.baseOpacity:1,Oe=DO(_,T);return!!this._dataToTexture(Oe)&&(_.renderData.setTextureReference(new gO(Oe.sourceLayerInfo.data,Vs.Ns.FADING,Oe,ne,fe,A)),!0)}_composeMapLayers(_,T,x,A,U,ne,fe,Oe,we,Ze,it){this._composition.ensureBuffer(fe);const lt=_.surface.baseOpacity;let dt=!1,Tt=xt.cw.LINEAR_MIPMAP_LINEAR,mt=!1,Mt=0;for(let Nt=x;Nt>=0;Nt--){const Bt=DO(_,Nt);if(!Bt||0===U[Nt]&&!it)continue;const Zt=Nt<A&&lt<1&&!dt;this._passParameters.baseOpacity=Zt?lt:1;const nr=this._passParameters.baseOpacity<1?In.Iu.Required:In.Iu.NotRequired;Zt&&(dt=!0);let Jt=!1;Ze.forEach(Yr=>{Yr.start===Nt&&(df.push(Yr),this._composition.openGroup(fe),Jt=!0)});const Rr=0===Mt,Br=Jt?In.lG.GroupBackgroundComposite:we&&Rr?this.backgroundIsGrid?In.lG.GridComposite:In.lG.ColorComposite:In.lG.Composite,$r=$u.pU[ne[Nt]];for((0,Cr.Ke)(Bt)?(this._passParameters.opacity=U[Nt],mt=this._composition.drawVectorData(this._passParameters,Br,fe,$r,nr,Bt,Oe,this.tileSize,mt)):(0,Cr.Ay)(Bt)?(this._passParameters.opacity=U[Nt],this._composition.drawImageryTileData(this._passParameters,Br,fe,$r,nr,Bt),this._hasNearestInterpolation(Bt)&&(Tt=xt.cw.NEAREST)):this._dataToTexture(Bt)&&(this._passParameters.texture=Bt.sourceLayerInfo.data.texture,this._passParameters.offset=Bt.offset,this._passParameters.scale=Bt.scale,this._passParameters.opacity=U[Nt],this._composition.drawRasterData(this._passParameters,Br,fe,$r,nr));df.length>0&&df[df.length-1].end===Nt;){const Yr=df.pop();this._passParameters.opacity=Yr.opacity,this._passParameters.offset=un.Z,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,we&&Rr?this.backgroundIsGrid?In.lG.GridComposite:In.lG.ColorComposite:In.lG.Composite,fe,$u.pU[Yr.blendMode],nr)}Mt++}const Pt=_.renderData.ensureTexture(fe,()=>this._buildTexture(fe,Tt));this._composition.copyFBOToTexture(Pt),this._composition.unbind(),_.renderData.setTextureReference(new gO(Pt,T,hI,dt?1:lt,0,1))}_hasNearestInterpolation(_){const T=_.sourceLayerInfo.data;return!!T.source&&"nearest"===T.interpolation}_dataToTexture(_){if((0,Cr.L4)(_)){const T=_.sourceLayerInfo;T.data=this._buildTexture(T.data),_.tile.setMemoryDirty()}return(0,Cr.z7)(_)}setBackground(_){this._backgroundColor!==_&&(this._backgroundColor=_,this._backgroundDirty=!0)}_buildTexture(_,T=xt.cw.LINEAR_MIPMAP_LINEAR){if((0,Qe.Wi)(_))return null;const x={target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:T,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},A=this._rctx;let U;if("number"==typeof _)x.width=x.height=_,U=new tf(new Ro.x(A,x));else if(_ instanceof tO.nN)x.isOpaque=_.isOpaque,U=new tf(new Ro.x(A,x,_.image)),_.release();else try{x.width=_.width,x.height=_.height,U=new tf(new Ro.x(A,x,_))}catch{U=new tf((0,_a.l_)(A)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const ne=A.bindTexture(U.texture,Ro.x.TEXTURE_UNIT_FOR_UPDATES);return U.generateMipmap(),A.bindTexture(ne,Ro.x.TEXTURE_UNIT_FOR_UPDATES),U}get test(){return{backgroundTexture:this._backgroundTexture}}}function DO(d,_){xc.layerIndex=_;const T=d.layerInfo[Bi.MAP][_];if((0,Qe.pC)(T.data))return(0,ti.s)(xc.offset,0,0),xc.tile=d,xc.scale=1,xc.sourceLod=d.lij,xc.sourceLayerInfo=T,xc;const x=T.upsampleInfo;if((0,Qe.pC)(x)){const A=x.tile.layerInfo[Bi.MAP][_];return xc.tile=x.tile,(0,ti.c)(xc.offset,x.offset),xc.scale=x.scale,xc.sourceLod=x.tile.lij,xc.sourceLayerInfo=A,xc}return null}function SO(d){return d.get("uid")}function aI(d){let _="normal"!==d.blendMode;return(0,Cr.CY)(d.parent)&&(_=aI(d.parent)||_),_}function lI(d,_){(0,Cr.CY)(d.parent)&&lI(d.parent,_);const T=SO(d);(0,Qe.pC)(T)&&""!==T&&(ry.has(T)?ry.get(T).start=_:ry.set(T,new zz(_,_,d.blendMode,d.opacity)))}const cI=new Array,uI=new Array,dI=new Array,ry=new Map,df=new Array,xc={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},hI={offset:[0,0],scale:1},sy=1e-6;class _I{constructor(_,T,x,A,U){this.aabb=_,this.axis=T,this.d=x,this.midStartIndex=A,this.rightStartIndex=U}}let fI=(()=>{class d{constructor(T,x,A,U){this.globalTriangleVertexIndices=T,this.firstTriangleIndex=x,this.positionAttribute=U,this._rayDirection=(0,ir.c)(),this.bspNodeTree=new Array,this.vertexPositionBuffer=U.data,this.vertexPositionStride=U.stride;const ne=A-x,fe=ne<=mI?new Uint16Array(ne):new Uint32Array(ne);this.indices=fe;for(let Oe=0;Oe<ne;++Oe)fe[Oe]=Oe;{const Oe=function Qz(d,_,T,x,A){const U=T-_,ne=new Float32Array(6*U);for(let fe=0;fe<U;++fe){const Oe=3*(fe+_),we=d[Oe+0]*A,Ze=d[Oe+1]*A,it=d[Oe+2]*A;for(let lt=0;lt<3;++lt){const dt=x[we+lt],Tt=x[Ze+lt],mt=x[it+lt];ne[6*fe+lt]=Math.min(dt,Tt,mt),ne[6*fe+3+lt]=Math.max(dt,Tt,mt)}}return ne}(T,x,A,U.data,U.stride),we=(0,xr.uZ)(Math.log2(ne/40),2,10),Ze=(it,lt,dt)=>{const Tt=function kz(d,_,T,x){if(x<=T)return(0,fo.al)(NaN,NaN,NaN,NaN,NaN,NaN);{const A=6*d[T];for(let U=0;U<3;++U)hf[U]=_[A+0+U],pf[U]=_[A+3+U]}for(let A=T+1;A<x;++A){const U=6*d[A];for(let ne=0;ne<3;++ne)hf[ne]=Math.min(hf[ne],_[U+0+ne]),pf[ne]=Math.max(pf[ne],_[U+3+ne])}return(0,fo.al)(hf[0],hf[1],hf[2],pf[0],pf[1],pf[2])}(fe,Oe,it,lt),mt=lt-it;if(mt<=40){const nr=new _I(Tt,void 0,0,it,lt);return this.bspNodeTree.push(nr),nr}const{axis:Mt,midValue:Pt}=function Jz(d){const _=d[3]-d[0],T=d[4]-d[1],x=d[5]-d[2],A=_>T?_>x?0:T>x?1:2:T>x?1:x>_?2:0;return{axis:A,midValue:(d[A]+d[A+3])/2}}(Tt),Nt=function Xz(d,_,T,x,A,U){let ne=T,fe=x;for(;ne<fe;){const we=d[ne];_[6*we+A+3]<=U?++ne:(--fe,d[ne]=d[fe],d[fe]=we)}let Oe=ne;for(fe=x;Oe<fe;){const we=d[fe-1];_[6*we+A]>=U?--fe:(d[fe-1]=d[Oe],d[Oe]=we,++Oe)}return{next:ne,mid:Oe}}(fe,Oe,it,lt,Mt,Pt),Bt=(nr,Jt)=>{if(dt>we)return;const Rr=Jt-nr;return Rr<40||Rr>=.8*mt?void 0:Ze(nr,Jt,dt+1)},Zt=new _I(Tt,Mt,Pt,Nt.next,Nt.mid);return this.bspNodeTree.push(Zt),Zt.leftNode=Bt(it,Nt.next),Zt.rightNode=Bt(Nt.mid,lt),Zt};Ze(0,ne,0),this.triangleVertexIndices=function qz(d,_,T,x){const A=x-T;let U=0;for(let fe=T;fe<x;++fe)for(let Oe=0;Oe<3;++Oe)U=Math.max(_[3*fe+Oe],U);const ne=U<=mI?new Uint16Array(3*A):new Uint32Array(3*A);for(let fe=0;fe<A;++fe){const Oe=3*(d[fe]+T);for(let we=0;we<3;++we)ne[3*fe+we]=_[Oe+we]}return ne}(fe,T,x,A)}}intersectRayTriangleRange(T,x){{if(T>=x)return;const A=this.triangleVertexIndices,U=this.positionAttribute.data,ne=this.positionAttribute.stride,fe=this._rayOrigin,Oe=fe[0],we=fe[1],Ze=fe[2],it=this._rayDirection,lt=it[0],dt=it[1],Tt=it[2];for(let mt=T,Mt=3*T;mt<x;++mt){let Pt=A[Mt++]*ne;const Nt=U[Pt++],Bt=U[Pt++],Zt=U[Pt];Pt=A[Mt++]*ne;const nr=U[Pt++],Jt=U[Pt++],Rr=U[Pt];Pt=A[Mt++]*ne;const Br=nr-Nt,$r=Jt-Bt,Yr=Rr-Zt,cs=U[Pt++]-Nt,Xr=U[Pt++]-Bt,os=U[Pt]-Zt,br=dt*os-Xr*Tt,Vr=Tt*cs-os*lt,lr=lt*Xr-cs*dt,wr=Br*br+$r*Vr+Yr*lr;if(Math.abs(wr)<=Number.EPSILON)continue;const Gr=Oe-Nt,zr=we-Bt,rs=Ze-Zt,ls=Gr*br+zr*Vr+rs*lr;if(wr>0){if(ls<0||ls>wr)continue}else if(ls>0||ls<wr)continue;const ms=zr*Yr-$r*rs,ss=rs*Br-Yr*Gr,Ms=Gr*$r-Br*zr,Hs=lt*ms+dt*ss+Tt*Ms;if(wr>0){if(Hs<0||ls+Hs>wr)continue}else if(Hs>0||ls+Hs<wr)continue;const Js=(cs*ms+Xr*ss+os*Ms)/wr;if(Js>=0){const Gs=this.indices[mt]+this.firstTriangleIndex,bs=(0,v0.Mw)(Br,$r,Yr,cs,Xr,os,Yz);this._callback(Js,bs,Gs,!1)}}}d.numFacesTested+=x-T}intersectRay(T,x){d.numFacesTested=0;const A=(0,ir.f)(T.r0[0],T.r0[1],T.r0[2]),U=(0,ir.f)(T.r1[0],T.r1[1],T.r1[2]),ne=U[0]-A[0],fe=U[1]-A[1],Oe=U[2]-A[2];if(ne*ne+fe*fe+Oe*Oe<sy)return;this._rayOrigin=A;const we=this._rayDirection;we[0]=ne,we[1]=fe,we[2]=Oe;const Ze=this.triangleVertexIndices.length/3;this._callback=x,this.intersectRayBSP(this.bspNodeTree[0],0,Ze)}intersectRayBSP(T,x,A){const U=this._rayOrigin,ne=this._rayDirection;if(!function $z(d,_,T){const x=_,A=T;let U=0,ne=1/0;for(let fe=0;fe<3;++fe){{const Oe=d[fe];if(x[fe]<Oe){if(A[fe]<=sy)return!1;U=Math.max(U,(Oe-x[fe])/A[fe])}else A[fe]<=-sy&&(ne=Math.min(ne,(Oe-x[fe])/A[fe]));if(U>ne)return!1}{const Oe=d[fe+3];if(x[fe]>Oe){if(A[fe]>=-sy)return!1;U=Math.max(U,(Oe-x[fe])/A[fe])}else A[fe]>=sy&&(ne=Math.min(ne,(Oe-x[fe])/A[fe]));if(U>ne)return!1}}return!0}(T.aabb,U,ne))return;const fe=T.axis,Oe=T.d;if(U[fe]<Oe||ne[fe]<0){const we=x,Ze=T.midStartIndex;if(we<Ze){const it=T.leftNode;void 0!==it?this.intersectRayBSP(it,we,Ze):this.intersectRayTriangleRange(we,Ze)}}if(this.intersectRayTriangleRange(T.midStartIndex,T.rightStartIndex),U[fe]>Oe||ne[fe]>0){const we=T.rightStartIndex,Ze=A;if(we<Ze){const it=T.rightNode;void 0!==it?this.intersectRayBSP(it,we,Ze):this.intersectRayTriangleRange(we,Ze)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}return d.numFacesTested=0,d})();const Yz=(0,ir.c)(),hf=[1/0,1/0,1/0],pf=[-1/0,-1/0,-1/0],mI=65535;var iy=v(30249),_f=v(87633),tc=v(40723),gI=v(7949),WE=v(26859),eH=v(36603),ny=v(92724),yI=v(41528);class Zn extends yI.W{constructor(){super(...arguments),this.output=Xs.H.Color,this.overlayMode=iy.gT.Disabled,this.tileBlendInput=_f.R.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!Fo.Z.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=Fo.Z.TERRAIN_USE_LEGACY_SHADING,this.transparent=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1}}(0,Ve._)([(0,pi.o)({count:Xs.H.COUNT})],Zn.prototype,"output",void 0),(0,Ve._)([(0,pi.o)({count:iy.gT.COUNT})],Zn.prototype,"overlayMode",void 0),(0,Ve._)([(0,pi.o)({count:_f.R.COUNT})],Zn.prototype,"tileBlendInput",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"spherical",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"atmosphere",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"receiveShadows",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"hasSlicePlane",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"backfaceCullingEnabled",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"stencilEnabled",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"textureFadingEnabled",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"renderOccluded",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"hasScreenSpaceReflections",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"hasCloudsReflections",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"shading",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"useLegacyTerrainShading",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"transparent",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"tileBorders",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"visualizeNormals",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"screenSizePerspective",void 0),(0,Ve._)([(0,pi.o)()],Zn.prototype,"receiveAmbientOcclusion",void 0),(0,Ve._)([(0,pi.o)({constValue:ny.f7.Disabled})],Zn.prototype,"pbrMode",void 0),(0,Ve._)([(0,pi.o)({constValue:WE.h.CompressedAttribute})],Zn.prototype,"normalType",void 0),(0,Ve._)([(0,pi.o)({constValue:eH.N.Compressed})],Zn.prototype,"textureCoordinateType",void 0),(0,Ve._)([(0,pi.o)({constValue:!1})],Zn.prototype,"highStepCount",void 0),(0,Ve._)([(0,pi.o)({constValue:!1})],Zn.prototype,"useCustomDTRExponentForWater",void 0),(0,Ve._)([(0,pi.o)({constValue:!1})],Zn.prototype,"useFillLights",void 0);const wO=(0,fo.Ue)();var $a;!function(d){d[d.Opaque=0]="Opaque",d[d.Semitransparent=1]="Semitransparent",d[d.Invisible=2]="Invisible"}($a||($a={}));let rc=class extends Ns.Z{constructor(d){super(d),this.type=ya.q7.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Zn,this._passParameters=new Iw.T,this._rctx=null,this._scaleRangeQueries=new _z,this._renderDataPool=new Wu.Z(KV),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Ko.AA,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=$a.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=tc.yD.Occlude}get _isGlobal(){return this._stage.viewingMode===vi.JY.Global}get shading(){return this._techniqueConfiguration.shading}set shading(d){this._techniqueConfiguration.shading=d}initialize(){this._stage.addRenderPlugin([Mi.r.OPAQUE_TERRAIN,Mi.r.TRANSPARENT_TERRAIN,Mi.r.OCCLUDED_TERRAIN],this)}destroy(){this._stage.removeRenderPlugin(this),function DV(){oO.clear()}()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(d){this._set("renderingDisabled",!!d),this.setDirty()}set transparency(d){this._transparencyState!==d&&(this._techniqueConfiguration.transparent=d===$a.Invisible,this._transparencyState=d,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(d){this._techniqueConfiguration.tileBorders!==d&&(this._techniqueConfiguration.tileBorders=d,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(d){this._techniqueConfiguration.visualizeNormals!==d&&(this._techniqueConfiguration.visualizeNormals=d,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(d){this._techniqueConfiguration.backfaceCullingEnabled!==d&&(this._techniqueConfiguration.backfaceCullingEnabled=d,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(d){this._set("renderOrder",d),this._setSortingDirty()}set velvetOverground(d){this._velvetOverground!==d&&(this._velvetOverground=d,this.setNeedsRender())}get layerUid(){return bc.cy}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(d){this._techniqueConfiguration.hasSlicePlane!==d&&(this._techniqueConfiguration.hasSlicePlane=d,this.setNeedsRender())}set textureFadingEnabled(d){this._techniqueConfiguration.textureFadingEnabled!==d&&(this._techniqueConfiguration.textureFadingEnabled=d,this.setNeedsRender())}setDebugScreenSizePerspective(d){this._techniqueConfiguration.screenSizePerspective!==d&&(this._techniqueConfiguration.screenSizePerspective=d,this.setNeedsRender())}setRootTiles(d){this._rootTiles=d,this.setDirty()}setNeedsHighlight(d){this.needsHighlight=d,this.setNeedsRender()}setRenderOccludedOverlay(d){this.renderOccludedFlags=d?nO.Qi:tc.yD.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(d){this._stencilEnabledLayerExtents=d,this._setSortingDirty()}setTileSize(d){this._tileSize=d,(0,Qe.pC)(this._tileRenderer)&&(this._tileRenderer.tileSize=d),this.setDirty()}_prepareTileForLoading(d){d.renderData||(d.renderData=this._renderDataPool.acquire(),d.renderData.init(d),d.renderData.localOrigin=this._getLocalOriginOfTile(d))}loadTile(d){this._prepareTileForLoading(d),this.updateTileGeometryState(d),this.updateTileTexture(d,ni.TEXTURE_FADING)}queryVisibleLevelRange(d,_,T,x){this._scaleRangeQueries.queryVisibleLevelRange(d,_,T,x),this.setNeedsRender()}updateTileTexture(d,_){(0,Qe.pC)(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(d,_===ni.TEXTURE_FADING?Vs.Ns.FADING:Vs.Ns.UNFADED),this.setNeedsRender(),d.resetPendingUpdate(_))}updateTileGeometryState(d){for(const T of d.layerInfo[Bi.ELEVATION])T.pendingUpdates&=~ni.GEOMETRY;d.resetPendingUpdate(ni.GEOMETRY);const _=d.renderData.updateGeometryState();return _&&this.setDirty(),_}updateGeometryIfNeeded(d){d.isLoaded&&d.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(d){const _=d.renderData;_&&(_.releaseGeometry(),this._renderDataPool.release(_),_.clear(),d.renderData=null,d.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(d){const T=Math.max(0,7*Math.floor((d.level-3)/7));if(this._isGlobal&&0===T)return ir.Z;for(;d.parent&&d.level>T;)d=d.parent;return d.centerAtSeaLevel}setVisibility(d){this._visible=d,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(d){this._get("wireframe")!==d&&(this._set("wireframe",d),this.setNeedsRender())}setDirty(d=Fi.Xx.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(d)}_setSortingDirty(d=Fi.Xx.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(d)}setNeedsRender(d=Fi.Xx.UPDATE){this._context.requestRender(d)}initializeRenderContext(d){this._context=d,this._rctx=d.renderContext.rctx,this._techniqueRepository=d.shaderTechniqueRepository,this._tileRenderer=new Hz(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=(0,_a.l_)(this._rctx)}uninitializeRenderContext(){this._emptyTex=(0,Qe.M2)(this._emptyTex),this._tileRenderer=(0,Qe.M2)(this._tileRenderer)}intersect(d,_,T,x){if(!this._rootTiles||d.options.selectOpaqueTerrainOnly&&d.options.selectionMode&&this.transparency!==$a.Opaque)return;const A=rH,U=sH;(0,pt.b)(A,x,T),(0,pt.s)(U,1/A[0],1/A[1],1/A[2]);const ne=d.results.min,fe=d.results.max,Oe=d.results.ground,we=d.options.store===ya.eC.MIN,Ze=!!d.results.ground.target,it=(0,bc.lV)(d.verticalOffset),lt=d.tolerance;let dt,Tt=we&&(0,Qe.pC)(ne.dist)?ne.dist:1/0;const mt=Pt=>{const Nt=Pt.renderData;if(!Nt?.vao)return;const Bt=Nt.geometryInfo;(0,fo.t8)(wO,Bt.boundingBox);const Zt=Nt.localOrigin;(0,Qe.pC)(it)&&(it.localOrigin=Zt,it.applyToAabb(wO));const nr=wO;if(ff[0]=T[0]-Zt[0],ff[1]=T[1]-Zt[1],ff[2]=T[2]-Zt[2],!(0,v0.Fw)(nr,ff,U,lt,Tt))return;const Jt=(os,br,Vr)=>{os.set(this.type,Pt,br,Vr,gn.I),Tt=we&&(0,Qe.pC)(ne.dist)?ne.dist:1/0},Rr=(os,br)=>{if((0,Qe.pC)(br)&&os>=0&&(d.options.backfacesTerrain||(0,pt.e)(br,A)<0)&&(d.options.invisibleTerrain||!d.options.selectionMode||null==_||_(T,x,os))){if((null==Oe.dist||os<Oe.dist)&&Jt(Oe,os,br),d.options.isFiltered)return;d.options.store===ya.eC.ALL&&((0,Qe.Wi)(dt)?(dt=(0,Ga.LP)(d.ray),Jt(dt,os,br),d.results.all.push(dt)):os<dt.dist&&Jt(dt,os,br)),(null==ne.dist||os<ne.dist)&&Jt(ne,os,br),d.options.store!==ya.eC.MIN&&(null==fe.dist||os>fe.dist)&&Jt(fe,os,br)}},Br=iH;(0,pt.b)(Br,x,Zt);const $r=Bt.indices,Yr=Bt.vertexAttributes,cs={data:Yr.getField(Qi.T.POSITION,of.ct).typedBuffer,size:3,stride:Yr.stride/4},Xr=Bt.indexCount/3;if((0,Qe.Wi)(it)&&Xr>200){const os=Pt.renderData;(0,Qe.Wi)(os.intersectionData)&&(os.intersectionData=new fI($r,0,Xr,cs)),os.intersectionData.intersectRay({r0:ff,r1:Br},Rr)}else(0,v0.CN)(ff,Br,0,Xr,$r,cs,null,it,Rr)},Mt=this._rootTiles;(0,Qe.pC)(Mt)&&(()=>{const Pt=this._tileIterator;Pt.reset(Mt);const Nt=d.options.invisibleTerrain;for(;!Pt.done;){const Bt=Pt.next();!(Bt.visible||Nt&&Bt.intersectsClippingArea)||!(0,Qe.pC)(it)&&!Bt.intersectsRay(T,A,lt,Tt)||Ze&&this._useStencilForTile(Bt)?Pt.skipSubtree():mt(Bt)}})()}prepareTechnique(d){if(d.bindParameters.slot===Mi.r.OCCLUDED_TERRAIN){if(0==(d.renderOccludedMask&nO.Qi))return null}else if(d.bindParameters.slot!==(this.transparency===$a.Opaque?Mi.r.OPAQUE_TERRAIN:Mi.r.TRANSPARENT_TERRAIN))return null;switch(d.output){case Xs.H.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=d.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=(0,Qe.pC)(d.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=d.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=d.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty()?iy.gT.Disabled:this._overlayRenderer.hasWater?iy.gT.EnabledWithWater:iy.gT.Enabled,this._updateTechnique(Xs.H.Color,(d.bindParameters.slot===Mi.r.OCCLUDED_TERRAIN?Oc.$e.Occluded:Oc.$e.ColorAndWater)===Oc.$e.Occluded);case Xs.H.Shadow:case Xs.H.ShadowExludeHighlight:return this._castShadows&&1===d.bindParameters.lighting.globalFactor?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Xs.H.Shadow,!1)):null;case Xs.H.Depth:return this.transparency===$a.Invisible&&this._overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Xs.H.Depth,!1));case Xs.H.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Xs.H.Normal,!1);case Xs.H.ObjectAndLayerIdColor:return this._updateTechnique(Xs.H.ObjectAndLayerIdColor,!1);case Xs.H.Highlight:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Xs.H.Highlight,!1)):null}return null}render(d,_){const T=1===d.bindParameters.lighting.globalFactor;switch(this._updatePatchGroups(),_.useStencil=!1,d.output){case Xs.H.Color:{const x=d.bindParameters.slot===Mi.r.OCCLUDED_TERRAIN?Oc.$e.Occluded:Oc.$e.ColorAndWater;this.transparency===$a.Opaque?this._renderMaterialPass(d,_,x):d.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(d,_,x),d.offscreenRenderingHelper.tmpColor,d.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case Xs.H.Shadow:case Xs.H.ShadowExludeHighlight:this._castShadows&&T&&this._renderAuxiliaryPass(d,_,Oc.$e.None);break;case Xs.H.Depth:this.transparency===$a.Invisible&&this._overlayRenderer.isEmpty()||this._renderAuxiliaryPass(d,_,Oc.$e.None);break;case Xs.H.Normal:this._renderAuxiliaryPass(d,_,Oc.$e.None);break;case Xs.H.ObjectAndLayerIdColor:this._renderAuxiliaryPass(d,_,Oc.$e.ObjectAndLayerIdColor);break;case Xs.H.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(d,_,Oc.$e.Highlight)}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(d,_,T){const{rctx:x}=d;this._passParameters.overlaySource=T,x.bindTechnique(_,this._passParameters,d.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this._renderPatchGroups(d,_,T),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(d,_,T){const x=d.rctx;this._passParameters.overlaySource=T,x.bindTechnique(_,this._passParameters,d.bindParameters),this._renderPatchGroupsAuxiliary(d,_,T)}updateTileBackground(d=null){if((0,Qe.Wi)(this._tileRenderer))return;const _=this._tileRenderer;let T=null;if((0,Qe.pC)(d)){const x=lo.Z.toUnitRGBA(d);T=(0,ir.f)(x[0]||0,x[1]||0,x[2]||0)}_.setBackground(T),this._allTiles.forAll(x=>_.updateTileTexture(x,Vs.Ns.FADING)),this._techniqueConfiguration.tileBlendInput=_.backgroundIsGrid?_f.R.GridComposite:(0,Qe.pC)(_.backgroundColor)?_f.R.ColorComposite:_f.R.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==ey.NONE){const d=Array.from(this._patchGroups.values());d.forEach(_=>(0,Ko.zW)(this.renderOrder,_,this._stencilEnabledLayerExtents)),d.sort((_,T)=>(0,Ko.dF)(_[0],T[0],this.renderOrder)),this._patchGroups=new Map(d.map(_=>[_[0].renderData.localOrigin,_])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const d=this._rootTiles;if(!(0,Qe.Wi)(d)){d[0]?.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const _ of d)this._rebuildPatchGroupsForRootTile(_)}}_rebuildPatchGroupsForRootTile(d){const _=this._tileIterator;for(_.resetOne(d);!_.done;){const T=_.next(),x=T.renderData;if(!x||T.visible)if(T.rendered){if(x){const A=this._patchGroups.get(x.localOrigin)||new Array;this._patchGroups.set(x.localOrigin,A),A.push(T),(!this._highestVisibleLODTile||T.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=T),_.skipSubtree()}}else this._numTilesCulled++;else this._numTilesCulled++,_.skipSubtree()}}_useStencilForTile(d){for(const _ of this._stencilEnabledLayerExtents)if(d.intersectsExtent(_))return!0;return!1}_renderPatchGroupsAuxiliary(d,_,T){const x=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(A=>{_.program.bindDraw(new gI.w(A[0].renderData.localOrigin),d.bindParameters,this._passParameters);for(let ne=0;ne<A.length;ne++)this._renderPatch(d,_,A[ne],xt.MX.TRIANGLES,x,T)}),d.rctx.bindVAO(null)}_renderPatchGroups(d,_,T){const x=d.bindParameters.camera,A=_.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&(0,aE.Gw)(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:x.fovY});const U=this._stencilEnabledLayerExtents.length>0,ne=T===Oc.$e.Occluded;ne&&(A.bindTexture("tex",this._emptyTex),A.setUniform1f("blend",1),A.setUniform4fv("texOffsetAndScale",Tn.Z));const fe=(0,Qe.pC)(this._tileRenderer)&&(0,Qe.pC)(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:ir.Z;this._techniqueConfiguration.tileBlendInput===_f.R.ColorComposite&&A.setUniform3fv("backgroundColor",fe);const Oe=this.wireframe?xt.MX.LINES:xt.MX.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&A.bindTexture("texNext",this._emptyTex),this._patchGroups.forEach(we=>{_.program.bindDraw(new gI.w(we[0].renderData.localOrigin),d.bindParameters,this._passParameters),this._numOriginsRendered++;for(let it=0;it<we.length;it++){const lt=we[it],dt=lt.renderData.textureReference;if(!(0,Qe.Wi)(dt)){if(!ne){this._scaleRangeQueries.scaleQueriesForTile(lt),A.setUniform4fv("texOffsetAndScale",dt.offsetAndScale),A.bindTexture("tex",dt.texture.texture);const Tt=lt.renderData.textureFadeFactor,mt=Tt<1?lt.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&(0,Qe.pC)(mt)&&Tt<1?(A.setUniform1f("fadeFactor",Tt),A.setUniform4fv("nextTexOffsetAndScale",mt.offsetAndScale),A.setUniform3fv("nextTexOpacities",mt.opacities),A.bindTexture("texNext",mt.texture.texture)):A.setUniform1f("fadeFactor",1),lt.renderData.textureIsFading&&this.setNeedsRender(),A.setUniform3fv("textureOpacities",dt.opacities)}this._renderPatch(d,_,lt,Oe,U,T),lt.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}),d.rctx.bindVAO(null)}_renderPatch(d,_,T,x,A,U){const ne=T.renderData,fe=ne.vao,Oe=fe.indexBuffer;if((0,Qe.Wi)(Oe))return void(Cr.jt&&console.error("Rendered tile with no indices: ",T.lij," : ",ne));const we=_.program;U!==Oc.$e.None&&this._bindOverlayPatchData(we,ne.overlay),A&&(_.useStencil=this._useStencilForTile(T),_.bindPipelineState(d.rctx,d.bindParameters.slot));const Ze=ne.geometryInfo.indexCount;d.rctx.bindVAO(fe),we.assertCompatibleVertexAttributeLocations(fe),d.rctx.drawElements(x,Ze,Oe.indexType,0)}_bindOverlayPatchData(d,_){d.setUniform4fv("overlayTexOffset",_.offsets),d.setUniform4fv("overlayTexScale",_.scales)}_updateTechnique(d,_){return this._techniqueConfiguration.output=d,d===Xs.H.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=_,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(RE,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],rc.prototype,"_overlayRenderer",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],rc.prototype,"_stage",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],rc.prototype,"_isGlobal",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],rc.prototype,"_allTiles",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],rc.prototype,"_ellipsoidRadius",void 0),(0,Ve._)([(0,ke.Cb)({value:!1})],rc.prototype,"renderingDisabled",null),(0,Ve._)([(0,ke.Cb)()],rc.prototype,"renderPatchBorders",null),(0,Ve._)([(0,ke.Cb)()],rc.prototype,"visualizeNormals",null),(0,Ve._)([(0,ke.Cb)()],rc.prototype,"cullBackFaces",null),(0,Ve._)([(0,ke.Cb)({value:ey.FRONT_TO_BACK})],rc.prototype,"renderOrder",null),(0,Ve._)([(0,ke.Cb)()],rc.prototype,"wireframe",null),rc=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.TerrainRenderer")],rc);const rH=(0,ir.c)(),sH=(0,ir.c)(),ff=(0,ir.c)(),iH=(0,ir.c)();class nH{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var mf=v(23461);let Yu=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add((0,Ht.YP)(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=(0,Qe.SC)(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let d;if(this.layers.some(_=>!(!(0,Gl.iC)(_)||_.isRejected()||_.isFulfilled()&&!function oH(d,_,T){return(0,Qe.pC)((0,Cr.E_)(d,_,T))}(_,this.viewSpatialReference,this.viewingMode)||(d=_,"vector-tile"===_?.type||(0,Cr.x4)(_)))),d)if(d.isResolved()){const _=(0,Cr.E_)(d,this.viewSpatialReference,this.viewingMode);if((0,Qe.pC)(_)){const T=new mf.t(_.tileInfo);this._lockTilingScheme(T)}}else this._updateWhen(d)}_updateWhen(d){const _=d.when().catch(()=>{}).then(()=>{_!==this._waitTask||this.destroyed||this._update()});this._waitTask=_}_lockTilingScheme(d){if(this.viewingMode===vi.JY.Global){const _=d.levels.length-1;d.spatialReference.isWebMercator?d=mf.t.makeWebMercatorAuxiliarySphere(_):(0,di.jF)(d.spatialReference)&&(d=mf.t.makeGCSWithTileSize(d.spatialReference,d.pixelSize,_))}this.tilingSchemeLocked=!0,this.tilingScheme=d,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add((0,Ht.YP)(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===vi.JY.Global){const d=this.extentHelper.viewSpatialReference,_=(0,di.jF)(d)||(0,hc.BZ)(d)||(0,hc.V2)(d);d.isWebMercator?this.tilingScheme=mf.t.WebMercatorAuxiliarySphere:_&&(this.tilingScheme=mf.t.makeGCSWithTileSize(d,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const d=this.extentHelper.layerViewsExtent;(0,Qe.pC)(d)&&!(0,Bs.fS)(d,this.extent)&&(this.tilingScheme=mf.t.fromExtent(d,this.extentHelper.viewSpatialReference),this._set("extent",d))}}get test(){return{lockTilingScheme:d=>this._lockTilingScheme(d),done:!this._waitTask}}};(0,Ve._)([(0,ke.Cb)()],Yu.prototype,"tilingScheme",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Yu.prototype,"extent",void 0),(0,Ve._)([(0,ke.Cb)({value:!1})],Yu.prototype,"tilingSchemeLocked",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Yu.prototype,"viewSpatialReference",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Yu.prototype,"layers",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Yu.prototype,"extentHelper",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Yu.prototype,"viewingMode",void 0),Yu=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.TilingSchemeLogic")],Yu);class aH{constructor(){this.offset=(0,un.a)(),this.scale=0,this.tile=null}init(_,T,x,A){this.tile=_,this.offset[0]=T,this.offset[1]=x,this.scale=A}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}let Ui=class extends(Va.Z.EventedMixin(Ns.Z)){constructor(d){super(d),this._iteratorPool=new Wu.Z(Ko.AA,_=>_.remove=()=>this._iteratorPool.release(_)),this._postorderIterator=new Ko.rv,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new nH,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=(0,ir.c)(),this._eyePosSurfaceSR=(0,ir.c)(),this._splitLimits=new FV,this._frustum=(0,rn.Ue)(),this._viewProjectionMatrix=(0,gn.c)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ji.Z,this._watchUpdatingTracking=new l_.t,this._frameTask=Fn.sq,this._allTiles=new wo.Z,this._upsampleInfoPool=new Wu.Z(aH),this._rootTilesExtent=(0,Bs.Ue)(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=to.Z.WebMercator,this.visibleElevationBounds=new q_(1/0,-1/0),this.rootTileElevationBounds=new q_(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!d.view?.state?.isLocal}initialize(){this._lercDecoder=(0,hV.w)(this.view.resourceController),this._tilePool=new Wu.Z(this.view.state.isLocal?dz:hz);const d=this.view.resourceController.memoryController;this._upsampleMapCache=d.newCache("esri.views.3d.terrain.upsample",A=>A.unloadMapData()),this._elevationQueryCache=new dV(d.newCache("elevation-query")),this._set("overlayManager",new xl({surface:this})),this._handles.add([(0,Ht.YP)(()=>this.overlayManager.hasHighlights,A=>this._renderer.setNeedsHighlight(A)),(0,Ht.YP)(()=>this.overlayManager.rendersOccluded,A=>this._renderer.setRenderOccludedOverlay(A))],"overlayManager"),this._renderer=new rc({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:(0,En.Iu)(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([(0,Ht.YP)(()=>this.baseOpacity,A=>{this._handleLayerViewChanges(),this._updateBaseOpacity(A)},Ht.tX),(0,Ht.YP)(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Ht.tX),(0,Ht.YP)(()=>this.renderingDisabled,()=>this.view?._stage?.renderView.setRenderParameters({terrainRenderingEnabled:!this.renderingDisabled}),Ht.Z_),(0,Ht.YP)(()=>this.backgroundColor,A=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(A)},Ht.tX),(0,Ht.YP)(()=>this.snapLevel,()=>this._viewChanged=!0,Ht.Z_),(0,Ht.YP)(()=>this.view.pointsOfInterest,A=>{this._renderer.pointsOfInterest=A,this._watchUpdatingTracking.removeAll(),A&&this._watchUpdatingTracking.add(()=>A.focus.renderLocation,()=>this._allTilesSorted=!1)}),(0,Ht.YP)(()=>Fo.Z.TERRAIN_TILE_TREE_SHOW_TILES,A=>{A&&!this._treeDebugger?Promise.all([v.e(8592),v.e(1318)]).then(v.bind(v,21318)).then(({TerrainTileTree3DDebugger:U})=>{!this._treeDebugger&&Fo.Z.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new U({view:this.view}))}):A||(this._treeDebugger=(0,Qe.SC)(this._treeDebugger))},Ht.nn)]),this._extentHelper=function gV(d,_){return d===vi.JY.Global?new sO(_):new iO(_)}(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const _=new Sv.Z({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:A})=>A),getChildrenFunction:A=>A&&"layers"in A?A.layers:null}),T=new Yu({layers:_,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",T),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Xg.Bh.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Xg.Bh.BASEMAP),this._frameTask=this.view.resourceController.scheduler.registerTask(Fn.T8.TERRAIN_SURFACE,this),this._handles.add([(0,Ht.YP)(()=>this._extentHelper.stencilEnabledExtents,A=>this._renderer.setStencilEnabledLayerExtents(A),Ht.nn),(0,Ht.YP)(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Ht.Z_),(0,Ht.YP)(()=>this.extent,()=>this._updateRootTiles(),Ht.nn),this.view.on("resize",()=>this._viewChangeUpdate()),(0,Ht.YP)(()=>{const A=this.view,U=A.state;return[this._lodBias,this.lodSnapping,A.resourceController?.memoryController?.memoryFactor,U.camera,U.contentCamera,U.fixedContentCamera]},()=>this._viewChangeUpdate(),Ht.tX),(0,Ht.YP)(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,A=>this._renderer.textureFadingEnabled=A>0,Ht.nn),(0,Ht.YP)(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Ht.Z_)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([(0,Ht.YP)(()=>this.view?.map.ground.shading,()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=(0,Qe.RY)(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=(0,Qe.SC)(this._upsampleMapCache),this._elevationQueryCache=(0,Qe.SC)(this._elevationQueryCache);const d=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",(0,Qe.SC)(this.tilingSchemeLogic)),d.destroy(),this._basemapLayerViewHandles.forEach((_,T)=>this._unregisterTiledLayerView(T)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",(0,Qe.SC)(this.overlayManager)),this._tilePool=(0,Qe.SC)(this._tilePool),uO.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=(0,Qe.SC)(this._renderer),this._iteratorPool=(0,Qe.SC)(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=(0,Qe.SC)(this._upsampleInfoPool),(0,TE.K)(),function BV(){DE.size>0&&(console.log(`${DE.size} live TilePerLayerInfo allocations:`),DE.forEach(d=>console.log(d,"\n")))}()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===Vs.VB.ON){const d=this.view,_=this.tilingScheme,T=d.pointsOfInterest?.contentCameraOnSurface?.scale;if(T&&_){const x=d.state.contentCamera;let A=H1(d,x.eye,x.viewForward,x.up).tilt;A>90&&(A=180-A);const U=2*(A/90)**2,ne=_.levelAtScale(T)-U;return Math.round(ne)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Vs.VB.ON:Vs.VB.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:d}=this,{clippingArea:_}=this.view;if((0,Qe.Wi)(_)||(0,Qe.Wi)(d))return null;const T=(0,Bs.Ue)(),x=(0,lw.G)(_,T,d)?T:null,A=this._get("extent");return(0,Bs.fS)(x,A)?A:x}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const d=(0,Bs.jV)(this.groundExtent,this._userClippingExtent,(0,Bs.Ue)()),_=this._get("extent");return(0,Bs.fS)(d,_)?_:d}get groundExtent(){return(0,Qe.pC)(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(d){this.view.map.ground.opacity=d}get viewingMode(){return this.view.state.viewingMode}get ready(){return(0,Qe.pC)(this.rootTiles)}set renderOrder(d){this._renderer.renderOrder=d,this._set("renderOrder",d)}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(d){this.view.map.ground.surfaceColor=d}set slicePlaneEnabled(d){this._renderer.slicePlaneEnabled=d,this._set("slicePlaneEnabled",d),this._evaluateTransparency(this.baseOpacity)}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}set velvetOverground(d){d!==this.velvetOverground&&(this._renderer.velvetOverground=d),this._set("velvetOverground",d)}get wireframe(){return this._renderer.wireframe}set wireframe(d){d!==this._renderer.wireframe&&(this._renderer.wireframe=d,this._updateAllTileGeometries())}set _visible(d){d!==this._visibleCached&&(this._visibleCached=d,this._renderer.setVisibility(d),this.suspended=!d)}get opaque(){return this._renderer.transparency===$a.Opaque}set suspended(d){this._set("suspended",d),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(d,_,T,x){this._renderer.intersect(d,_,T,x)}getElevation(d,_,T,x){const A=this.rootTiles;if((0,Qe.Wi)(A)||!A.length||0===A[0].layerInfo[Bi.ELEVATION].length)return null;const U=Sl;return U[0]=d,U[1]=_,U[2]=T,(0,di.SH)(U,x,U,this._spatialReference)?bI(A,U[0],U[1]):(Us.Z.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(d,_,T){const x=this.rootTiles,A=x?x[0].layerInfo[Bi.ELEVATION].length:0;if(!(0,Qe.Wi)(x)&&x.length&&0!==A)for(let U=0;U<_;++U){const ne=3*U;T(U,bI(x,d[ne+0],d[ne+1]))}else for(let U=0;U<_;++U)T(U,null)}getScale(d){if(this.tilingScheme){if(!(0,di.KC)(d,Sl,this.spatialReference))return Us.Z.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const _=this.rootTiles;if((0,Qe.pC)(_))for(let T of _)if(T?.containsPoint(Sl)){for(;!T.isLeaf&&!T.rendered;){let x=0;Sl[0]>T.children[0].extent[2]&&(x+=1),Sl[1]<T.children[0].extent[1]&&(x+=2),T=T.children[x]}return this._getLodBiasCorrectedScale(T.level)}}return 1e100}getSphereElevationBounds(d,_,T,x,A){if(Sl[0]=d,Sl[1]=_,Sl[2]=T,Sl[3]=x,!(0,di.SH)(Sl,A,Sl,this.tilingScheme?.spatialReference))return Us.Z.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let U=1/0,ne=-1/0;const fe=we=>{if(we&&(0,Bs.hr)(we.extent,Sl))if(we.isLeaf||we.rendered)U=Math.min(U,we.elevationBounds[0]),ne=Math.max(ne,we.elevationBounds[1]);else for(const Ze of we.children)fe(Ze)},Oe=this.rootTiles;if((0,Qe.pC)(Oe))for(const we of Oe)fe(we);return{min:U,max:ne}}getSphereScale(d,_){if(!this.tilingScheme)return null;if(!(0,di.KC)(d,Sl,this.spatialReference))return Us.Z.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Sl[3]=_;let T=null;const x=U=>{if(U&&(0,Bs.hr)(U.extent,Sl))if(U.isLeaf||U.rendered){const ne=this._getLodBiasCorrectedScale(U.level);T=null==T?ne:Math.min(T,ne)}else for(const ne of U.children)x(ne)},A=this.rootTiles;if((0,Qe.pC)(A))for(const U of A)x(U);return T}queryVisibleScaleRange(d,_,T,x){const A=_?this.tilingScheme.levelAtScale(_):0,U=T?this.tilingScheme.levelAtScale(T):1/0,ne=this._lodBias;this._renderer.queryVisibleLevelRange(d,A+ne,U+ne,x)}_evaluateTransparency(d){const _=this._renderer.transparency,T=this._allSurfaceLayersTransparent()?$a.Invisible:d>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?$a.Opaque:$a.Semitransparent,x=_!==T;return x&&(this._renderer.transparency=T,this.view?._stage?.renderView.setRenderParameters({terrainTransparency:this._renderer.transparency})),x}_updateBaseOpacity(d){const _=this._evaluateTransparency(d);this._updateTileTextures(_?Vs.Ns.UNFADED:Vs.Ns.IMMEDIATE)}_updateTilingScheme(){const d=this.tilingSchemeLogic.tilingScheme;d!==this.tilingScheme&&((0,Cr.wu)(!!d,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles(),this._spatialReference=d?.spatialReference??to.Z.WebMercator,this._set("tilingScheme",d),this._updateClippingExtent(),d&&(this._updateTiledLayers(),this._renderer.setTileSize(d.pixelSize),this.overlayManager.setSpatialReference(d.spatialReference),this._updateRootTiles()),this._isWebMercator=!!this.tilingScheme?.spatialReference.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&(0,hc.QM)(this.view?.renderSpatialReference))}_acquireTile(d,_,T,x){const A=this._tilePool.acquire();return VE[0]=d,VE[1]=_,VE[2]=T,A.init(VE,x,this),A}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:d,tilingScheme:_}=this;if(!_)return;const T=uH;let x=_.rootTilesInExtent(d,T,5*po.$r);if((0,Qe.pC)(this.rootTiles)){if(x.length>po.$r)return void Us.Z.getLogger(this.declaredClass).warn(po.Tg);const A=this.rootTiles.map(ne=>ne.lij),U=(0,pd.e5)(A,x,vI);if(this._updatingRootTiles=!0,U.removed.length>0||U.added.length>0){const ne=this.rootTiles.filter(fe=>!(U.removed.findIndex(Oe=>vI(Oe,fe.lij))>-1&&(this._purgeTile(fe),1)));U.added.forEach(fe=>ne.push(this._newRootTile(fe))),this._setRootTiles(ne)}}else this._updatingRootTiles=!0,x.length>po.$r&&(Us.Z.getLogger(this.declaredClass).warn(po.iU),x=_.rootTilesInExtent(d,T,po.$r)),this._setRootTiles(x.map(A=>this._newRootTile(A)));(0,Bs.fS)(T,this._rootTilesExtent)||(this._rootTilesExtent=(0,Bs.Ue)(T)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const d=this._allTiles.filter(_=>_.isLoaded&&_.intersectsClippingArea);d.forEach(_=>this._renderer.updateTileGeometryState(_)),d.forEach(_=>_.renderData.updateNeighborData()),this._updateTilesGeometries(d),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(d){if(0===d.length)return;d.sort(Ko.gl);const _=this.renderer;d.forEach(T=>_.updateGeometryIfNeeded(T)),d.forEach(T=>this._pendingTilesForElevationUpdateEvent.add(T))}_shouldSplit(d){return d.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ni.SPLIT}_newRootTile(d){const _=this._acquireTile(0,d[1],d[2],null);return this._shouldSplit(_)&&_.setPendingUpdate(ni.SPLIT),this._loadTile(_),this._markTileToUpdate(_),this._updateRootTileElevationBounds(),_}_setRootTiles(d){if(this._set("rootTiles",d),this._allTiles.clear(),(0,Qe.pC)(d)){const _=this._iteratorPool.acquire();for(_.reset(d);!_.done;)this._allTiles.push(_.next());_.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(d)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(d){d.updateClippingStatus(this.extent)&&d.resetPendingUpdate(ni.GEOMETRY)&&this._updateTileGeometryState(d)}_updateTilesVisibility(d){if((0,Qe.Wi)(d))return;const _=(0,Ko.t8)(d),T=this.visibleElevationBounds;let x=_?T.min:1/0,A=_?T.max:-1/0;const U=this.extent,ne=this._viewProjectionMatrix;this.setTileTreeDirty();const fe=this._iteratorPool.acquire();for(fe.reset(d);!fe.done;){const Oe=fe.next();Oe.updateClippingStatus(U)&&Oe.resetPendingUpdate(ni.GEOMETRY)&&this._updateTileGeometryState(Oe),Oe.setPendingUpdate(ni.RENDERDATA),Oe.computeVisibility(),Oe.updateScreenDepth(ne),Oe.renderData&&(x=Math.min(Oe.elevationBounds[0],x),A=Math.max(Oe.elevationBounds[1],A))}fe.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(x)&&isFinite(A)&&(T.min!==x||T.max!==A)&&(this.visibleElevationBounds=new q_(x,A))}_updateRootTileElevationBounds(){let d=1/0,_=-1/0;const T=this.rootTiles;(0,Qe.pC)(T)&&T.forEach(({elevationBounds:A})=>{d=Math.min(d,A[0]),_=Math.max(_,A[1])});const x=this.rootTileElevationBounds;x.min===d&&x.max===_||(this.rootTileElevationBounds=new q_(d,_))}_updateViewDependentParameters(){const d=this.view.state.camera,_=this.view.state.contentCamera,T=Math.tan(.5*_.fovX),x=Math.tan(.5*_.fovY),A=this.tilingScheme.pixelSize,U=2**-this._lodBias*d.pixelRatio;this._splitLimits.aboveGround=d.aboveGround,this._splitLimits.fovX=T,this._splitLimits.fovY=x,this._splitLimits.relativeWidthLimit=A/d.width*this.maxTextureScale*U,this._splitLimits.relativeHeightLimit=A/d.height*this.maxTextureScale*U,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?((0,Qe.Wi)(this._splitLimits.frustum)&&(this._splitLimits.frustum=(0,rn.Ue)()),(0,rn.JG)(this._splitLimits.frustum,_.frustum)):this._splitLimits.frustum=null,(0,rn.JG)(this._frustum,d.frustum),(0,gi.m)(this._viewProjectionMatrix,_.projectionMatrix,_.viewMatrix),(0,pt.c)(this._eyePosRenderSR,_.eye),(0,di.SH)(d.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(d){d.rendered&&!d.shouldLoad&&(EI(d)?this._loadChildren(d):function cH(d){return d.isLeaf&&d.parent&&d.parent.shouldLoad}(d)&&this._loadParent(d))}_updateTileGeometryState(d){d.updateVisibility(),this._renderer.updateTileGeometryState(d)&&this._markTileToUpdate(d),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(d){const _=this._pendingTilesToUpdate;d.forEachLoadedNeighbor(T=>{_.add(T)})}_updateTileTexture(d,_){const T=d.resetPendingUpdate(ni.TEXTURE_FADING)?ni.TEXTURE_FADING:!!d.resetPendingUpdate(ni.TEXTURE_NOFADING)&&ni.TEXTURE_NOFADING;T&&(this._renderer.updateTileTexture(d,T),this._usedMemory=null,_.madeProgress())}_emitElevationUpdateEventForTiles(){const d=LO.extent;(0,Bs.cS)(d),this._pendingTilesForElevationUpdateEvent.forEach(_=>(0,Bs.jn)(d,_.extent,d)),this._pendingTilesForElevationUpdateEvent.clear(),LO.spatialReference=this.spatialReference,this.emit("elevation-change",LO)}runTask(d){this._handleLayerViewChanges(d),this._frameTask.processQueue(d),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(d),this._sortTiles(d);const _=!this.view.state.fixedContentCamera;this._mergeAndSplit(d,_),this._updateElevation(d),this._updateTextures(d),_||this._mergeAndSplit(d,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),d.done?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(d){if(!this._viewChanged||!this.rootTiles||d.done)return;this._viewChanged=!1;const _=this._iteratorPool.acquire();_.reset(this.rootTiles);const T=this.snapLevel,x=this._splitLimits,A=this._eyePosRenderSR;for(;!_.done;){const U=_.next(),ne=U.shouldSplit(x,A,T);if(ne!==ni.SPLIT){if(U.resetPendingUpdate(ni.SPLIT)&&U.updateAgentSuspension(),ne===ni.VSPLITMERGE&&U.updateAgents(Bi.ELEVATION),_.skipSubtree(),!U.isLeaf){U.setPendingUpdate(ni.MERGE),U.resetPendingUpdate(ni.SPLIT);const fe=this._iteratorPool.acquire();fe.resetOne(U);const Oe=this._viewProjectionMatrix;for(let we=fe.next();!fe.done;we=fe.next())this._updateClippingStatus(we),we.updateVisibility(),we.updateScreenDepth(Oe);fe.remove()}}else U.resetPendingUpdate(ni.MERGE),U.isLeaf&&(U.setPendingUpdate(ni.SPLIT),_.skipSubtree()),U.rendered&&U.setPendingUpdate(ni.RENDERDATA)}_.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),d.madeProgress()}_sortTiles(d){d.done||this._allTilesSorted||((0,Ko.b)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),d.madeProgress())}_markTileToUpdate(d){(0,Cr.Fp)(d.isLoaded),d.intersectsClippingArea&&(this._pendingTilesToUpdate.add(d),this._markAllTileNeighborsForGeometryUpdate(d))}_batchUpdatePendingTileGeometries(){const d=this._pendingTilesToUpdate;if(0===d.size)return;const _=Array.from(this._pendingTilesToUpdate.keys()).filter(A=>A.isLoaded&&A.intersectsClippingArea),T=(A,U)=>{!U?.isLoaded||!U.intersectsClippingArea||U.level<A.level||d.has(U)||(d.add(U),_.push(U),U.renderData.updateNeighborData())};_.sort(Ko.gl);const x=_.length;for(let A=0;A<x;++A){const U=_[A];(0,Cr.Fp)(U.isLoaded),(0,Cr.Fp)(U.intersectsClippingArea);const ne=U.renderData;ne.updateNeighborData();const fe=ne._dirtyEdgeResolutions,Oe=ne.geometryState.neighborData;for(let we=0;we<4;++we)if(fe&1<<we){const Ze=U.renderData.geometryState.neighborData.edgePeerNeighbors[we];Ze&&Ze?.level>=U.level&&Ze.forAllSubtreeOnSide((0,Cr._F)(Cr.OC[we]),it=>!(!it.isLoaded||!it.intersectsClippingArea||((0,Cr.Fp)(d.has(it)||(0,Ko.gl)(U,it)<0),T(U,it),0))),T(U,Oe.cornerPeerNeighbors[we]),T(U,Oe.cornerPeerNeighbors[(we+1)%4])}}d.clear(),this._updateTilesGeometries(_),Cr.jt&&Cr.XJ&&this.checkAllTilesWaterproofness()}_mergeAndSplit(d,_){if(this.suspended||d.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let T=!1,x=!1;for(;!d.done;){x=!0;let A=!1;const U=!this._allTiles.some(ne=>{if(!T&&!ne.loadable)return d.done;let fe=ne;if(ne.resetPendingUpdate(ni.MERGE)){if(!_)return ne.setPendingUpdate(ni.MERGE),d.done;for(;fe.parent?.resetPendingUpdate(ni.MERGE);)fe=fe.parent;this._mergeTile(fe),A=!0,d.madeProgress()}else ne.resetPendingUpdate(ni.SPLIT)&&(this._splitTile(ne),A=!0,d.madeProgress());return!d.done&&fe===ne&&ne.resetPendingUpdate(ni.RENDERDATA)&&(this._updateRenderData(ne),d.madeProgress()),d.done});if(A&&(this._allTilesSorted=!1,this._allTilesDirty=!0),U){if(!T){T=!0;continue}if(!A)break}else this._allTilesDirty=!0}x||(this._allTilesDirty=!0),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(d)}_updateElevation(d){d.done||(this._allTiles.some(_=>(_.resetPendingUpdate(ni.GEOMETRY)&&(this._updateTileGeometryState(_),this._updateTileTexture(_,d),this.shortBatches&&this._batchUpdatePendingTileGeometries(),d.madeProgress()),d.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(d){d.done||this._allTiles.some(_=>(this._updateTileTexture(_,d),d.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Fi.Xx.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*po.DR}_getLodBiasCorrectedScale(d){const _=this.tilingScheme.levels,T=(0,xr.uZ)(d-this._lodBias,0,_.length-1),x=T-Math.floor(T);return _[Math.floor(T)].scale*(1-x)+_[Math.ceil(T)].scale*x}_removeAllTiles(){(0,Qe.pC)(this.rootTiles)&&(this.rootTiles.forEach(d=>this._purgeTile(d)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(d){if(d.isLeaf)return!1;let _=!1;for(let T=0;T<4;++T)_=this._purgeTile(d.children[T])||_;return d.unsetChildren(),_}_purgeTile(d){const _=this._purgeDescendantTiles(d)||d.rendered;return this._allTiles.removeUnordered(d),this._unloadTile(d),this._tilePool.release(d),_}_unloadTile(d){this._pendingTilesToUpdate.delete(d),this._pendingTilesForElevationUpdateEvent.delete(d),d.unload(this._renderer)}_splitTile(d){(0,Cr.wu)(d.isLeaf,"tile that is already split should not be split again!");const _=d.level+1,T=2*d.lij[1],x=2*d.lij[2];d.setChildren(this._createTile(_,T,x,d),this._createTile(_,T,x+1,d),this._createTile(_,T+1,x,d),this._createTile(_,T+1,x+1,d)),d.setPendingUpdate(ni.RENDERDATA),d.updateAgentSuspension(),this._allTiles.pushArray(d.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(d,_=d.level){zE.spatialReference=this.spatialReference,zE.extent=d.extent,zE.scale=this._getLodBiasCorrectedScale(_),this.emit("scale-change",zE)}_createTile(d,_,T,x){(0,Cr.wu)(!!x,"_createTile sanity check");const A=this._acquireTile(d,_,T,x);return A.updateClippingStatus(this.extent),A.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(A)&&A.setPendingUpdate(ni.SPLIT),A}get shortBatches(){return this.view.state.mode!==Lu.n.IDLE}_mergeTile(d){(0,Cr.wu)(!d.hasPendingUpdate(ni.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(d)&&((0,Cr.wu)(!d.renderData,"_mergeTile sanity check"),this._loadTile(d),this._markTileToUpdate(d),this._emitTileScaleChange(d),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(d){(0,Cr.wu)(d.rendered,"parent should be rendered"),this._unloadTile(d);const _=d.children;_.forEach(T=>this._loadTile(T)),_.forEach(T=>this._pendingTilesToUpdate.add(T)),this._markAllTileNeighborsForGeometryUpdate(d),this._emitTileScaleChange(d,d.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(d){const _=d.parent;this._unloadChildren(_),this._loadTile(_),this._markTileToUpdate(_),this._emitTileScaleChange(_,_.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(d){if(!d.isLeaf)for(let _=0;_<4;++_){const T=d.children[_];this._unloadChildren(T),this._unloadTile(T)}}_loadTile(d){d.load(),d.setPendingUpdate(ni.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(d)}_elevationDataArrived(d,_,T){const x=new fV(d.lij,d.extent,T);d.dataArrived(_,Bi.ELEVATION,x);const A=[d],U=d.level,ne=this._iteratorPool.acquire();for(ne.reset(A);!ne.done;){const fe=ne.next();fe.findElevationBoundsForLayer(_,U),fe.computeElevationBounds()}0===U&&this._updateRootTileElevationBounds(),ne.remove(),this._updateTilesVisibility(A)}_handleLayerViewChanges(d=Fn.G5){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let _=!1;const T=new Set;let x=-1;for(const A of this.view.allLayerViews.items)if(T.add(A.uid),(0,Cr.wP)(A)||(0,Cr.a_)(A))if(this._basemapLayerViewHandles.has(A.uid)&&!(0,Cr.a_)(A)){const U=this._layerClassFromLayerView(A),ne=this._getLayerIdxByUID(U,A.uid);(0,Qe.pC)(ne)&&((ne<x||(0,Qe.Wi)(x))&&(_=!0),x=ne)}else this._registerTiledLayerView(A),A.layer.loaded&&(_=!0);this._basemapLayerViewHandles.forEach((A,U)=>{T.has(U)||(this._unregisterTiledLayerView(U),_=!0)}),_&&this._updateTiledLayers(),this._renderer.transparency=this._allSurfaceLayersTransparent()?$a.Invisible:this._renderer.transparency,this.hasCompositeBlendMode=this._hasCompositeBlendMode(),d.madeProgress()}_allSurfaceLayersTransparent(){let d=0===this.view.map?.ground?.opacity;for(const _ of this.view.allLayerViews.items)if((0,Cr.GL)(_)&&!(0,Gl.sy)(_.layer)&&0!==_.fullOpacity)return d=!1,d;return d}_hasCompositeBlendMode(){for(const d of this.view.allLayerViews.items)if(((0,Cr.TK)(d)||(0,Cr.a_)(d))&&(0,$u.MV)($u.pU[d.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(d){return(0,Cr._1)(d)?Bi.ELEVATION:Bi.MAP}_registerTiledLayerView(d){const _=[];if(((0,Cr.TK)(d)||(0,Cr.a_)(d))&&_.push((0,Ht.YP)(()=>d.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Vs.Ns.UNFADED)})),(0,Cr.a_)(d))return;const T=this._layerClassFromLayerView(d);_.push((0,Ht.YP)(()=>d.suspended,()=>this._updateTiledLayers())),_.push((0,Ht.YP)(()=>d.fullOpacity,()=>this._updateTileTextures(Vs.Ns.UNFADED))),_.push((0,Ht.YP)(()=>"effectiveScaleRange"in d.layer?d.layer.effectiveScaleRange:null,()=>this._restartAllAgents(T))),d.on("data-changed",()=>{const x=this._getLayerIdxByUID(T,d.uid);(0,Qe.pC)(x)&&this._invalidateLayerData(x,T)}),this._basemapLayerViewHandles.set(d.uid,_)}_unregisterTiledLayerView(d){const _=this._basemapLayerViewHandles.get(d);if(_){for(let T=0;T<_.length;T++)_[T].remove();this._basemapLayerViewHandles.delete(d)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const _=[[],[]];let T=null;this.view.allLayerViews.forEach(x=>{if(!x.layer||x.suspended||!(0,Cr.wP)(x)||!x.fullExtent)return;const A=this._layerClassFromLayerView(x);if(A===Bi.MAP){const U=x.displayLevelRange.maxLevel;U!==1/0&&(null===T||U>T)&&(T=U)}_[A].push(x)});for(const x of m0){const A=this._layerViews[x],U=_[x];U.reverse();const ne=U.length;let fe=A.length!==ne;const Oe=new Array(ne),we=new Array(A.length);this._layerIndexByUid[x].clear();for(let Ze=0;Ze<ne;Ze++){this._layerIndexByUid[x].set(U[Ze].uid,Ze);const lt=A.indexOf(U[Ze]);Oe[Ze]=lt,Ze!==lt&&(fe=!0),lt>-1&&(we[lt]=Ze)}if(fe){const Ze=this._postorderIterator;for(Ze.reset(this.rootTiles);!Ze.done;)Ze.next().modifyLayers(we,Oe,x);this._layerViews[x]=U,this._restartAllAgents(x),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(T)&&this._viewChangeUpdate()}_restartAllAgents(d){const _=this._postorderIterator;for(_.reset(this.rootTiles);!_.done;){const T=_.next();T.restartAgents(d),d===Bi.ELEVATION&&T.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(d,_){return this._layerViews[_][d]}numLayers(d){return this._layerViews[d].length}_updateTileTextures(d){this._allTiles.forAll(_=>{_.updateAgents(Bi.MAP),d===Vs.Ns.IMMEDIATE?this.renderer.updateTileTexture(_,ni.TEXTURE_NOFADING):_.updateRenderData(Bi.MAP,d)}),this._renderer.transparency=this._allSurfaceLayersTransparent()?$a.Invisible:this._renderer.transparency}_invalidateLayerData(d,_){this._allTiles.forAll(T=>T.removeLayerAgent(d,_)),this._allTiles.forAll(T=>T.invalidateLayerData(d,_))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(d=Fi.Xx.UPDATE){this.renderer.setNeedsRender(d)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(d,_,T,x){const A=this.layerViewByIndex(_,T),U=A.layer;return!U.tilemapCache||(0,Cr.Q)(A)?this._requestTileData(d,T,A,x):(++this._asyncWorkItems,U.tilemapCache.fetchAvailability(d.lij[0],d.lij[1],d.lij[2],{...x,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(ne=>{throw--this._asyncWorkItems,(0,ws.k_)(x),(0,ws.D_)(ne)||this._dataMissing(d,T,A,{notInTilemap:!0}),ne}).then(()=>this._frameTask.schedule(()=>this._requestTileData(d,T,A,x),x.signal)))}_requestTileData(d,_,T,x){return _===Bi.ELEVATION?(0,Cr._1)(T)?this._requestElevationTileData(d,T,x):Promise.reject():(0,Cr.GL)(T)?this._requestMapTileData(d,T,x):Promise.reject()}_requestElevationTileData(d,_,T){++this._asyncWorkItems;const x=ne=>{if((0,ws.Hc)(T))return;const fe=this._layerIndexByUid[Bi.ELEVATION].get(_.uid);null!=fe?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(d,fe,ne)):Us.Z.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",Bi.ELEVATION,d.lij.toString())},A=ne=>{(0,ws.D_)(ne)||(this._dataMissing(d,Bi.ELEVATION,_,ne),this.requestUpdate())};if((0,Cr.FZ)(_.layer))return _.layer.fetchTile(d.lij[0],d.lij[1],d.lij[2],{noDataValue:po.$7,signal:T.signal}).then(ne=>{if(!(0,ws.Hc)(T))return this._frameTask.schedule(()=>x(ne),T.signal,A);Us.Z.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},A).finally(()=>{--this._asyncWorkItems});const U=_.getTileUrl(d.lij[0],d.lij[1],d.lij[2]);return this._elevationDataRequester.request(U,"binary",T).then(ne=>this._lercDecoder.decode(ne,{noDataValue:po.$7},T.signal)).then(ne=>{ne?x({values:ne.pixelData,width:ne.width,height:ne.height,noDataValue:ne.noDataValue,minValue:ne.minValue,maxValue:ne.maxValue}):A(new Error("LERC decoding failed"))},A).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(d,_,T){++this._asyncWorkItems;const x=(we,Ze)=>{--this._asyncWorkItems,(0,Cr.z4)(Ze),(0,ws.Hc)(T)||(this._dataMissing(d,Bi.MAP,_,we),this.requestUpdate())},A=we=>Ze=>x(Ze,we),U=we=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),(0,ws.Hc)(T)?(0,Cr.z4)(we):this._mapTileDataArrived(d,_,we)},T.signal,A(we)).catch(A(we)),ne=(we,Ze=null)=>this._frameTask.schedule(()=>x(we,Ze));if((0,Cr.Q)(_)){const we=_.schemaHelper.getLevelRowColumn(d.lij);return _.fetchTile(we[0],we[1],we[2],T).then(U,ne)}if((0,Cr.sR)(_))return _.fetchTile(d.lij[0],d.lij[1],d.lij[2],T).then(U,ne);if((0,Cr.FH)(_)&&(0,Cr.FZ)(_.layer))return _.layer.fetchTile(d.lij[0],d.lij[1],d.lij[2],T).then(we=>{if((0,ws.Hc)(T))return Us.Z.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void ne((0,ws.zE)());U(we)},ne);let fe=_.getTileUrl(d.lij[0],d.lij[1],d.lij[2]);return(0,uV.d)(_.layer)&&_.layer.refreshTimestamp&&(fe+=`${fe.includes("?")?"&":"?"}_ts=${_.layer.refreshTimestamp}`),this._mapDataRequester.request(fe,_.hasMixedImageFormats?"image+type":"image",T).then(U,ne)}_mapTileDataArrived(d,_,T){const x=this._getLayerIdxByUID(Bi.MAP,_.uid);(0,Qe.pC)(x)?d.dataArrived(x,Bi.MAP,T):((0,Cr.z4)(T),Us.Z.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(d,_){return this._layerIndexByUid[d].get(_)}_dataMissing(d,_,T,x){const A=this._getLayerIdxByUID(_,T.uid);(0,Qe.pC)(A)?d.dataMissing(A,_,x):Us.Z.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(d){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(_=>{_.renderData&&this.overlayManager.setTileParameters(_)}),this._renderer.setNeedsRender(d))}get performanceInfo(){const d=this._performanceInfo;return d.numNodes=this._allTiles.length,d.numLeaves=d.numVisible=d.numRendered=d.numLoadedPerLevel.length=d.numRenderedPerLevel.length=0,this._allTiles.forAll(_=>{_.isLeaf&&d.numLeaves++;const T=_.level;_.renderData&&(d.numLoadedPerLevel[T]=(d.numLoadedPerLevel[T]||0)+1),_.visible&&(d.numVisible++,_.rendered&&(d.numRenderedPerLevel[T]=(d.numRenderedPerLevel[T]||0)+1,d.numRendered++))}),d}getUsedMemory(){return this.tilingScheme?((0,Qe.Wi)(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),(0,Qe.pC)(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((d,_)=>d+_.usedMemory,0):null}getUsedMemoryForLayerView(d){let _=0;const T=this._layerClassFromLayerView(d),x=this._getLayerIdxByUID(T,d.uid);return(0,Qe.pC)(x)&&this._allTiles.forAll(A=>_+=A.getUsedMemoryForLayer(T,x)),_}getTile(d){if((0,Qe.Wi)(d)||(0,Qe.Wi)(this.rootTiles))return null;const _=d.split("/").map(ne=>+ne);if(0===_[0])return this.rootTiles.find(ne=>ne.lij[1]===_[1]&&ne.lij[2]===_[2]);const T=2**_[0],x=Math.floor(_[1]/T),A=Math.floor(_[2]/T);let U;if(this.rootTiles.some(ne=>ne.lij[1]===x&&ne.lij[2]===A&&(U=ne,!0)),U){let ne=1<<_[0]-1;for(;U.lij[0]<_[0];){let fe=_[1]&ne?2:0;if((_[2]&ne)>0&&fe++,!U.children[fe])return null;U=U.children[fe],ne>>=1}return(0,Cr.wu)(U.lij[0]===_[0]&&U.lij[1]===_[1]&&U.lij[2]===_[2],"not the right tile?"),U}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(d){this._renderer.renderPatchBorders=d}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(d){this._renderer.visualizeNormals=d}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(d){this._renderer.renderingDisabled=d}get test(){const d=this;return{renderer:d._renderer,lercDecoder:d._lercDecoder,forceReload:()=>{(0,Qe.pC)(d.rootTiles)&&(d._mergeTile(d.rootTiles[0]),d._viewChangeUpdate())},getTiles:()=>d._allTiles.toArray(),getRenderedTiles(){IO.clear(),d._allTiles.forAll(T=>{T.visible&&T.rendered&&IO.push(T)});const _=IO.toArray();return(0,Ko.zW)(d.renderOrder,_),_},lockTilingScheme(_,T){d._extentHelper.defaultTiledLayersExtent=T,d.tilingSchemeLogic.test.lockTilingScheme(_)}}}checkAllTilesWaterproofness(){if(!Cr.XJ)return;const d=this.rootTiles;if((0,Qe.Wi)(d))return;const _=U=>U?.renderData?.geometryInfo?.indices?.length>0,T=(U,ne)=>{_(U)&&console.error("Tile[",U.lij,"] has geometry although parent[",ne.lij,"] has geom")},x=U=>{if(U.intersectsClippingArea)if(U.renderData&&!U.renderData.geometryState&&console.error("Tile[",U.lij,"] has renderData but not geometryState"),U.renderData&&!U.renderData.geometryInfo&&console.error("Tile[",U.lij,"] has renderData but not geometryInfo"),!U.renderData?.geometryInfo||(U.renderData.geometryInfo.indices?.length??0)>0||console.error("Tile[",U.lij,"] has renderData but no indices - geometryInfo: ",U.renderData.geometryInfo),_(U)){U.checkGeometryWaterproofness();for(const ne of U.children)T(ne,U)}else if(U.isLeaf)console.error("Tile[",U.lij,"] has no geometry and no children, from root to leaf");else for(const ne of U.children)x(ne)},A=U=>{const ne=U.parent?.visible??!0,fe=U.visible;U.computeVisibility();const Oe=U.visible;if(fe!==Oe&&ne&&console.error(" Tile[",U.lij,"] has out of date visibility: ",fe," instead of ",Oe),!U.isLeaf)for(const we of U.children)A(we)};for(const U of d)x(U),A(U)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){this.view?.map?.ground?.shading!==this._shading&&this._updateShading()}_updateShading(){const d=this.view?.map?.ground?.shading;this._shading=d,this.renderer&&(this.renderer.shading=d,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(d){return this.isGlobal&&d[2]===this.lijEastEnd(d[0])-1}isWestEndWrap(d){return this.isGlobal&&0===d[2]}lijEastEnd(d){return 2**(d+((0,Qe.pC)(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(d){const _=this.lijEastEnd(d[0]),T=d[2];return 0<=T&&T<_?d:this.isGlobal?[d[0],d[1],(T+(T<0?_:0))%_]:null}enableInternalChecks(d){(0,Cr.T9)(d)}enableWaterproofnessChecks(d){(0,Cr.b5)(d)}};(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_renderer",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_hasPendingUpdates",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_asyncWorkItems",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_allTilesDirty",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_allTilesSorted",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_viewChanged",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"_watchUpdatingTracking",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_frameTask",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"snapLevel",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"lodSnapping",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Ui.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_userClippingExtent",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_rootTilesExtent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"groundExtent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"_tilingSchemeExtent",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"running",null),(0,Ve._)([(0,ke.Cb)(pV.q)],Ui.prototype,"updatingProgress",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"updatingProgressValue",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_maxNumUpdating",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"baseOpacity",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"hasCompositeBlendMode",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"overlayManager",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"viewingMode",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"maxTextureScale",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"ready",null),(0,Ve._)([(0,ke.Cb)({value:ey.FRONT_TO_BACK})],Ui.prototype,"renderOrder",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"rootTiles",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"spatialReference",null),(0,Ve._)([(0,ke.Cb)({type:lo.Z})],Ui.prototype,"backgroundColor",null),(0,Ve._)([(0,ke.Cb)({value:!1})],Ui.prototype,"slicePlaneEnabled",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"tilingScheme",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"tilingSchemeLocked",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ui.prototype,"tilingSchemeLogic",void 0),(0,Ve._)([(0,ke.Cb)({value:!0})],Ui.prototype,"velvetOverground",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"wireframe",null),(0,Ve._)([(0,ke.Cb)({value:!1})],Ui.prototype,"suspended",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"textureFadeDuration",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"visibleElevationBounds",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"rootTileElevationBounds",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"_layerViewsDirty",void 0),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"renderPatchBorders",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"visualizeNormals",null),(0,Ve._)([(0,ke.Cb)()],Ui.prototype,"renderingDisabled",null),Ui=(0,Ve._)([(0,Wr.j)("esri.views.3d.terrain.TerrainSurface")],Ui);const lH=Ui;function vI(d,_){return d[0]===_[0]&&d[1]===_[1]&&d[2]===_[2]}function EI(d){return!d.isLeaf&&(d.children.some(_=>_.shouldLoad)||d.children.some(_=>EI(_)))}const Sl=(0,Tn.c)(),uH=(0,Bs.Ue)(),VE=[0,0,0],IO=new wo.Z,LO={spatialReference:null,extent:(0,Bs.Ue)(),context:"ground"},zE={spatialReference:null,extent:null,scale:0};function bI(d,_,T){for(const x of d){if(!x.containsPointXY(_,T))continue;let A=x;for(;A&&!A.renderData;)A=A.children[(_>A.extentMidX?1:0)+(T<A.extentMidY?2:0)];return wn(_,T,A?.renderData?.geometryState.samplerData??null)}return null}var Ea=v(2286),dH=v(26594),UO=v(24260),CI=v(57851),Ln=v(54840);class hH{constructor(_,T){this.geometryRecord=_,this.renderGeometry=T}}class pH{constructor(_,T,x){this.operation=_,this.geometryRecord=T,this.states=x}}let oy=class extends Ns.Z{constructor(d){super(d),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(d){this.dirty=!1,this._dirtyGeomRecords.forEach((_,T)=>this.commitLayer(T,d))}commitLayer(d,_){const T=this._dirtyGeomRecords.get(d);T&&(T.forEach((x,A)=>{const U=this._ensureGeomRecord(d,A);x.forEach(({geometryRecord:ne,operation:fe,states:Oe},we)=>{let Ze=!1;if(fe===Ln.T.UPDATE){const it=U.get(we);if(it){const lt=it.renderGeometry;if(Oe&Ln.$.TRANSFORMATION){const dt=this.model.getObject(A);this.model.updateRenderGeometryTransformation(dt,ne,lt)&&(Ze=!0)}Ze||_.updates.push({renderGeometry:lt,updateType:Oe})}else(0,Wc.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(fe===Ln.T.REMOVE||Ze){const it=U.get(we);it?(_.removes.push(it.renderGeometry),U.delete(we),it.geometryRecord.disposed&&UO.k.pool.release(it.geometryRecord)):fe===Ln.T.REMOVE&&(0,Wc.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(fe===Ln.T.ADD||Ze){const it=this.model.getObject(A);if((0,Qe.pC)(it)){const lt=this.model.getRenderGeometry(it,ne),dt=new hH(ne,lt);_.adds.push(lt),U.set(we,dt)}}}),0===U.size&&this._residentGeomRecords.get(d).delete(A)}),0===this._residentGeomRecords.get(d).size&&this._residentGeomRecords.delete(d),this._dirtyGeomRecords.delete(d))}getResidentRenderGeometries(d,_){const T=this._residentGeomRecords.get(d);T&&T.forEach(x=>x.forEach(A=>_.push(A.renderGeometry)))}_objectStateChanged(d,_){for(const T of _.geometryRecords)this._updateOrCreateDirtyRecord(_,T,null,Ln.T.UPDATE,d)}visibilityChanged(d){this._objectStateChanged(Ln.$.VISIBILITIES,d)}highlightChanged(d){this._objectStateChanged(Ln.$.HIGHLIGHTS,d)}occlusionChanged(d){this._objectStateChanged(Ln.$.OCCLUDEES,d)}vertexAttrsUpdated(d){this._updateOrCreateDirtyRecord(d.object,d.record,null,Ln.T.UPDATE,Ln.$.VERTEXATTRS)}layerAdded(d){d.objects.forAll(_=>this._layerObjectAdded(d,_))}layerRemoved(d){d.objects.forAll(_=>this._layerObjectRemoved(d,_))}layerObjectAdded(d){this._layerObjectAdded(d.layer,d.object)}_layerObjectAdded(d,_){const T=d.id;for(const x of _.geometryRecords)this._objectGeometryAdded(_,x,T)}layerObjectRemoved(d){this._layerObjectRemoved(d.layer,d.object)}layerObjectsAdded(d){for(const _ of d.objects)this._layerObjectAdded(d.layer,_)}layerObjectsRemoved(d){for(const _ of d.objects)this._layerObjectRemoved(d.layer,_)}_layerObjectRemoved(d,_){const T=d.id;for(const x of _.geometryRecords)this._objectGeometryRemoved(_,x,T)}shaderTransformationChanged(d){const _=this._residentGeomRecords.get(d.id);_&&_.forEach((T,x)=>{const A=this.model.getObject(x);A&&A.hasVolativeTransformation()&&T.forEach(U=>{U.renderGeometry.shaderTransformationChanged()})})}objectTransformation(d){const _=this._getParentLayerId(d);this._ensureGeomRecord(_,d.id).forEach(x=>{this._updateOrCreateDirtyRecord(d,x.geometryRecord,_,Ln.T.UPDATE,Ln.$.TRANSFORMATION)})}objectGeometryAdded(d){this._objectGeometryAdded(d.object,d.record)}_objectGeometryAdded(d,_,T=null){this._updateOrCreateDirtyRecord(d,_,T,Ln.T.ADD)}objectGeometryRemoved(d){this._objectGeometryRemoved(d.object,d.record)}_objectGeometryRemoved(d,_,T=null){this._updateOrCreateDirtyRecord(d,_,T,Ln.T.REMOVE)}_updateOrCreateDirtyRecord(d,_,T,x,A=Ln.$.NONE){T=(0,Qe.Pt)(T,this._getParentLayerId(d));const ne=_.id,fe=this._ensureDirtyRecord(T,d.id),Oe=fe.get(ne);if(Oe){const we=Oe.operation;we===Ln.T.REMOVE&&x===Ln.T.ADD&&Oe.states!==Ln.$.NONE?Oe.operation=Ln.T.UPDATE:we===Ln.T.REMOVE&&x===Ln.T.ADD||we===Ln.T.ADD&&x===Ln.T.REMOVE?(fe.delete(ne),Oe.geometryRecord.disposed&&UO.k.pool.release(Oe.geometryRecord)):we!==Ln.T.UPDATE||x!==Ln.T.REMOVE&&x!==Ln.T.UPDATE?((0,Wc.hu)((we===Ln.T.REMOVE||we===Ln.T.ADD)&&x===Ln.T.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),Oe.states|=A):(Oe.operation=x,Oe.states|=A)}else fe.set(ne,new pH(x,_,A));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(d,_){let T=this._residentGeomRecords.get(d);T||(T=new Map,this._residentGeomRecords.set(d,T));let x=T.get(_);return x||(x=new Map,T.set(_,x)),x}get _hasDirtyGeometryRecords(){return(0,El.oE)(this._dirtyGeomRecords,d=>(0,El.oE)(d,_=>_&&_.size>0))}_ensureDirtyRecord(d,_){let T=this._dirtyGeomRecords.get(d);T||(T=new Map,this._dirtyGeomRecords.set(d,T));let x=T.get(_);return x||(x=new Map,T.set(_,x)),x}_getParentLayerId(d){return(0,Qe.pC)(d.parentLayer)?d.parentLayer.id:dE.u}formatDebugInfo(){const d=["ADD","UPD",void 0,"REM"];let _="";return this._dirtyGeomRecords.forEach((T,x)=>{T.forEach((A,U)=>{_.length>0&&(_+="\n"),_+=x+"."+U;const ne=[];A.forEach(fe=>{const Oe=fe.operation;ne[Oe]||(ne[Oe]=[]),ne[Oe].push(fe.geometryRecord.geometry.id)});for(let fe=0;fe<ne.length;fe++)if(ne[fe]){_+=" "+d[fe-1]+": ";for(let Oe=0;Oe<ne[fe].length;Oe++)_+=ne[fe][Oe]+", "}})}),_}get test(){const d=this;return{get residentLayerCount(){return d._residentGeomRecords.size},get residentObjectCount(){return Array.from(d._residentGeomRecords.values()).reduce((_,T)=>_+T.size,0)}}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],oy.prototype,"model",void 0),(0,Ve._)([(0,ke.Cb)()],oy.prototype,"dirty",void 0),oy=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],oy);const _H=oy;var fH=v(53855);let HE=class extends Ns.Z{constructor(){super(...arguments),this.dirtySet=new _H({model:this}),this._content=new Map,this._originFactory=new CI.C(null)}getObject(d){return this._content.get(d)}add(d){const _=d.id;(0,Wc.hu)(!this._content.has(_),"Model/Stage already contains object to be added"),this._content.set(_,d),(0,Hg.e)(d)&&this.dirtySet.layerAdded(d)}remove(d){(0,Wc.hu)(this._content.has(d.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(d.id),d.unload(),(0,Hg.e)(d)&&this.dirtySet.layerRemoved(d)}addMany(d){for(const _ of d)(0,Qe.pC)(_)&&((0,Wc.hu)(!this._content.has(_.id),"Model/Stage already contains object to be added"),this._content.set(_.id,_))}removeMany(d){for(const _ of d)(0,Wc.hu)(this._content.has(_.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(_.id),_.unload()}has(d){return this._content.has(d.id)}forEachOfType(d,_){this._content.forEach(T=>{T.type===d&&_(T)})}getRenderGeometry(d,_){const{geometry:T,material:x,id:A,shaderTransformation:U,origin:ne,instanceParameters:fe}=_,Oe=new fH.z(T,x,{id:A,boundingInfo:T.boundingInfo,calculateShaderTransformation:U,castShadow:d.castShadow});return Oe.updateTransformation(we=>d.getCombinedStaticTransformation(_,we)),Oe.origin=(0,Qe.pC)(ne)?ne:this._originFactory.getOrigin(Oe.boundingSphere),Oe.instanceParameters=fe,Oe}updateRenderGeometryTransformation(d,_,T){if((0,Qe.Wi)(d))return!1;T.updateTransformation(A=>d.getCombinedStaticTransformation(_,A));const x=this._originFactory.getOrigin(T.boundingSphere);return T.origin!==x}getStats(){const d={},_=Array.from(this._content.values());for(let T=0;T<Y2.U.COUNT;++T)d[T]=_.filter(x=>x.type===T).length;return{contentTypes:d,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],HE.prototype,"dirtySet",void 0),HE=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.parts.Model")],HE);var mH=v(79800),TI=v(9554),gH=v(42964),ay=v(9044),ly=v(93394),yH=v(55713);class vH{constructor(_){this._totalCount=_,this._indexRanges=[0,_]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const _=this._indexRanges;let T=0;for(let x=0;x<_.length;x+=2)T+=_[x+1];return T}reset(_){this._indexRanges="all"===_||_.length===this._totalCount?[0,this._totalCount]:function EH(d){const _=new Array;if(0===d.length)return _;let T=d[0],x=1;for(let A=1;A<d.length;A++){const U=d[A];T+x===U?x+=1:(_.push(T),_.push(x),T=U,x=1)}return _.push(T),_.push(x),_}(_)}forEachComponent(_){const T=this._indexRanges;for(let x=0;x<T.length;x+=2){const A=T[x],U=A+T[x+1];for(let ne=A;ne<U;ne++)if(!_(ne))return!1}return!0}forEachComponentRange(_){const T=this._indexRanges;for(let x=0;x<T.length;x+=2){const A=T[x];if(!_(A,A+T[x+1]))return!1}return!0}computeOffsetRanges(_){const T=new Array(this._indexRanges.length),x=this._indexRanges;for(let A=0;A<x.length;A+=2){const U=x[A],fe=_[U],Oe=_[U+x[A+1]];T[A]=fe,T[A+1]=Oe-fe}return T}}class bH extends Ea.Xn{constructor(_,T){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=(0,yH.tP)(T);const x=this.count;this.visibility=new vH(x),this.materialDataBuffer=_.getBuffer(x),this.materialDataIndices=new Uint16Array(x);for(let A=0;A<x;A++)this.materialDataIndices[A]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let _=0;_<this.count;_++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[_])}get count(){return this.offsets.length-1}get geometryRanges(){return(0,Qe.Wi)(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return(0,Qe.Wi)(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return(0,Qe.Wi)(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if(((0,Qe.Wi)(this.cachedHighlightRanges)||(0,Qe.Wi)(this.cachedDefaultRanges))&&(0,Qe.pC)(this.highlightCounts)){const{highlightRanges:_,defaultRanges:T}=function CH(d,_,T){const x=[],A=[];let U=T.length,ne=T.length;return _.forEachComponent(fe=>(d[fe]>0?(U!==fe-1&&(x.length&&x.push(T[U+1]-x[x.length-1]),x.push(T[fe])),U=fe):(ne!==fe-1&&(A.length&&A.push(T[ne+1]-A[A.length-1]),A.push(T[fe])),ne=fe),!0)),x.length&&x.push(T[U+1]-x[x.length-1]),A.length&&A.push(T[ne+1]-A[A.length-1]),{highlightRanges:x,defaultRanges:A}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=_,this.cachedDefaultRanges=T}}}var GE=v(24225);function TH(d,_,T,x){if(T>=_)return d;null==d&&(d=function MH(d=!0){return{isVisibleBit:!d,data:new Uint32Array(0)}}());const A=d.isVisibleBit;let U=d.data;const ne=PI(U),fe=T/ne|0,Oe=T-ne*fe,we=(_-1)/ne|0,Ze=U,it=x===A;if(!(T<Ze.length*ne)&&it){const dt=fe+1,Tt=Math.ceil(1.5*Ze.length),mt=we+1;let Mt=Math.max(dt,Tt);Mt=Math.min(Mt,mt),U=new Uint32Array(Mt),U.set(Ze)}return fe<U.length&&(U[fe]=function OH(d,_,T){return d&~(1<<_)|(T?1:0)<<_}(U[fe],Oe,it)),d.data=U,d}function MI(d,_){if(null==d)return!0;const{isVisibleBit:T,data:x}=d,A=PI(x);return _<x.length*A?function PH(d,_,T,x){const A=T/x|0;return function xH(d,_){return 0!=(d&1<<_)}(_[A],T-A*x)===d}(T,x,_,A):!d.isVisibleBit}function PI(d){return 8*d.BYTES_PER_ELEMENT}var DH=v(37187);class SH{constructor(_,T){this._indices=(0,Qe.pC)(_.indices)?_.indices:(0,DH.p)(_.positions.length/3),this._positions=new of.ct(_.positions),this._components=T,this._componentIntersectionData=new Array(T.count)}getComponentAabb(_,T){if((0,Qe.pC)(this._perComponentAabbs)){for(let x=0;x<6;x++)T[x]=this._perComponentAabbs[6*_+x];return T}return this._computePerComponentAabbs(),this.getComponentAabb(_,T)}getComponentPositions(_,T){T.indices=this._indices,T.data=this._positions.typedBuffer,T.stride=this._positions.typedBufferStride,T.startIndex=this._components.offsets[_],T.endIndex=this._components.offsets[_+1]}intersect(_,T,x,A,U,ne,fe){const Oe={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},we=this._indices,Ze=this._components.offsets,it=(0,v0.Ue)(_,T,AH),lt=_[2],dt=T[2];this._components.visibility.forEachComponent(Tt=>{if(!MI(this._components.pickability,Tt))return!0;const mt=this.getComponentAabb(Tt,RH);if((0,Qe.pC)(ne)){const Zt=ne[Tt];(0,Qe.pC)(U)?U.componentOffset=Zt:(_[2]=lt-Zt,T[2]=dt-Zt)}if((0,Qe.pC)(U)&&U.applyToAabb(mt),!(0,v0.Tw)(mt,_,it,x))return!0;const Mt=Ze[Tt]/3,Pt=Ze[Tt+1]/3,Nt=(Zt,nr,Jt)=>{fe(Tt,Zt,(0,pt.t)(nr,nr,A),Jt)},Bt=Pt-Mt;return(0,Qe.Wi)(U)&&Bt>200?(null==this._componentIntersectionData[Tt]&&(this._componentIntersectionData[Tt]=new fI(this._indices,Mt,Pt,Oe)),this._componentIntersectionData[Tt].intersectRay({r0:_,r1:T},Nt)):(0,v0.CN)(_,T,Mt,Pt,we,Oe,void 0,U,Nt),!0})}_computePerComponentAabbs(){const _=this._components.count;this._perComponentAabbs=new Float32Array(6*_);const T=this._indices,x=this._positions.typedBuffer,A=this._positions.typedBufferStride,U=this._components.offsets;let ne=0;for(let fe=0;fe<_;fe++){const we=U[fe+1];let Ze=1/0,it=1/0,lt=1/0,dt=-1/0,Tt=-1/0,mt=-1/0;for(let Mt=U[fe];Mt<we;Mt++){const Pt=T[Mt]*A,Nt=x[Pt],Bt=x[Pt+1],Zt=x[Pt+2];Ze=Math.min(Ze,Nt),it=Math.min(it,Bt),lt=Math.min(lt,Zt),dt=Math.max(dt,Nt),Tt=Math.max(Tt,Bt),mt=Math.max(mt,Zt)}this._perComponentAabbs[ne++]=Ze,this._perComponentAabbs[ne++]=it,this._perComponentAabbs[ne++]=lt,this._perComponentAabbs[ne++]=dt,this._perComponentAabbs[ne++]=Tt,this._perComponentAabbs[ne++]=mt}}get positions(){return this._positions}get indices(){return this._indices}}const AH=(0,ir.c)(),RH=(0,fo.Ue)();class wH{constructor(_,T,x){this.material=_,this.geometry=T,this.meta=x}dispose(){this.material.dispose(),this.geometry.dispose()}}class OI extends Ea.Xn{constructor(_,T,x,A){super(),this.primitiveType=T,this.parameters=x,this.indexed=A,this.vao=_}}function cy(d){return d?uy(d,1/0,-1/0):function IH(d,_){return{near:d,far:_}}(1/0,-1/0)}function uy(d,_,T){return d.near=_,d.far=T,d}function gf(d,_,T=d){return T.near=Math.min(d.near,_.near),T.far=Math.max(d.far,_.far),T}function KE(d,_){return d.near<=_&&_<=d.far}(0,Ve._)([(0,Ea.gT)()],OI.prototype,"vao",void 0);const BO={near:0,far:0};const ZE=new wo.Z({allocator:d=>d||{near:1/0,far:-1/0,mask:0,object:null},deallocator:d=>(d.object=(0,Qe.wN)(d.object),d)}),Gd=cy(),Al=(0,ir.c)(),E0=(0,ir.c)(),UH=new wo.Z({deallocator:null}),BH=new wo.Z({deallocator:null});function jH(d,_,T){T.length=0;const x=_.length-3;jO(Al,_,x);const A=(0,Rn.jH)(d,Al);A<=0&&(T.push(Al[0]),T.push(Al[1]),T.push(Al[2]));let U=0,ne=A;for(;U<x;U+=3){jO(E0,_,U);const fe=(0,Rn.jH)(d,E0);ne*fe<0&&((0,pt.h)(Al,E0,Al,fe/(fe-ne)),Rl(T,Al)),fe<=0&&Rl(T,E0),ne=fe,(0,pt.c)(Al,E0)}ne*A<0&&(jO(E0,_,x),(0,pt.h)(Al,E0,Al,A/(A-ne)),Rl(T,Al))}function jO(d,_,T){return(0,pt.s)(d,_.data[T+0],_.data[T+1],_.data[T+2])}function Rl(d,_){d.push(_[0]),d.push(_[1]),d.push(_[2])}function FH(d,_,T,x){(0,q7.c)(SI,d.quaternion),(0,pt.y)(Dc,_,d.center),(0,pt.q)(Dc,Dc,SI);const A=8*((Dc[0]<-d.halfSize[0]?-1:Dc[0]>d.halfSize[0]?1:0)+3*(Dc[1]<-d.halfSize[1]?-1:Dc[1]>d.halfSize[1]?1:0)+9*(Dc[2]<-d.halfSize[2]?-1:Dc[2]>d.halfSize[2]?1:0)+13),U=xI[A];if(0===U)return U;(0,Co.c)($E,d.quaternion),(0,Co.d)($E,$E,d.halfSize);const ne=(fe,Oe)=>{const we=xI[A+Oe+1];return(0,pt.s)(fe,((1&we)<<1)-1,(2&we)-1,((4&we)>>1)-1),(0,pt.t)(fe,fe,$E),(0,pt.a)(fe,d.center,fe)};return T.length=0,Rl(T,ne(FO,0)),Rl(T,ne(AI,1)),Rl(T,ne(Dc,2)),Rl(T,ne(RI,3)),x(T),1===U||(T.length=0,Rl(T,FO),Rl(T,RI),Rl(T,ne(Dc,4)),Rl(T,ne(wI,5)),x(T),2===U||(T.length=0,Rl(T,FO),Rl(T,wI),Rl(T,ne(Dc,6)),Rl(T,AI),x(T))),U}const xI=(()=>{const d=new Int8Array(216);let _=0;const T=x=>{for(let A=0;A<x.length;A++)d[_+A]=x[A];_+=8};return T([3,0,6,2,3,1,5,4]),T([2,0,2,3,1,5,4,0]),T([3,1,0,2,3,7,5,4]),T([2,0,1,3,2,6,4,0]),T([1,0,1,3,2,0,0,0]),T([2,1,5,7,3,2,0,0]),T([3,2,0,1,3,7,6,4]),T([2,2,0,1,3,7,6,0]),T([3,3,0,1,5,7,6,2]),T([2,0,1,5,4,6,2,0]),T([1,0,1,5,4,0,0,0]),T([2,1,3,7,5,4,0,0]),T([1,0,2,6,4,0,0,0]),T([0,0,0,0,0,0,0,0]),T([1,1,3,7,5,0,0,0]),T([2,2,3,7,6,4,0,0]),T([1,2,3,7,6,0,0,0]),T([2,3,1,5,7,6,2,0]),T([3,4,0,1,5,7,6,2]),T([2,5,7,6,4,0,1,0]),T([3,5,0,1,3,7,6,4]),T([2,4,5,7,6,2,0,0]),T([1,4,5,7,6,0,0,0]),T([2,5,1,3,7,6,4,0]),T([3,6,0,2,3,7,5,4]),T([2,6,2,3,7,5,4,0]),T([3,7,6,2,3,1,5,4]),d})(),DI=4,$E=(0,xd.c)(),SI=(0,NP.a)(),Dc=(0,ir.c)(),FO=(0,ir.c)(),AI=(0,ir.c)(),RI=(0,ir.c)(),wI=(0,ir.c)();class WH{constructor(_){this._objects=_}submit(_,T){this._objects.preSubmit(T),this._objects.visibleObjects.forAll(x=>x.renderable.material.submit(_,T,x))}queryShadowCasterDepthRange(_){return this._objects.visibleObjects.length?function LH(d,_){const T=cy(),{eye:x,frustum:A,viewForward:U}=d;_.forAll(ne=>{const fe=(0,Qe.pC)(ne.offsetObb)?ne.offsetObb:ne.obb,Oe=(0,pt.e)((0,pt.y)(Dc,fe.center,x),U),we=(0,ly.xz)(fe,U);if(KE(T,Oe-we)&&KE(T,Oe+we))return;const Ze=function NH(d,_){let T=0;for(let x=0;x<DI;x++){const A=(0,ly.hZ)(d,_[x]);if(A>0)return-1;0===A&&(T|=1<<x)}return T}(fe,A);if(-1===Ze)return;if(0===Ze)return Gd.far=Oe+we,Gd.near=Oe-we,void gf(T,Gd);const it=ZE.pushNew();it.near=Oe-we,it.far=Oe+we,it.mask=Ze,it.object=ne});for(let ne=0;ne<ZE.length;ne++){const fe=ZE.data[ne];KE(T,fe.near)&&KE(T,fe.far)||(Gd.far=fe.far,Gd.near=1/0,0===FH((0,Qe.pC)(fe.object.offsetObb)?fe.object.offsetObb:fe.object.obb,x,UH,we=>{let Ze=BH;for(let it=0;it<DI&&we.length>0;it++){if(0==(fe.mask&1<<it))continue;jH(A[it],we,Ze);const lt=we;we=Ze,Ze=lt}for(let it=0;it<we.length;it+=3){(0,pt.s)(Al,we.data[it+0],we.data[it+1],we.data[it+2]);const lt=(0,pt.e)((0,pt.y)(Al,Al,x),U);Gd.near=Math.min(Gd.near,lt)}})&&(Gd.near=0),gf(T,Gd))}return ZE.length=0,T}(_,this._objects.visibleObjects):null}}var VH=v(27355),ep=v(75550),II=v(15261),LI=v(7228),yf=v(88569),Zc=v(44835);class YE extends so.A{initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2,T.spherical=_.viewingMode===vi.JY.Global,T.doublePrecisionRequiresObfuscation=(0,LI.I)(_.rctx)}initializeProgram(_){return new Gn.$(_.rctx,YE.shader.get().build(this.configuration),UI)}_setPipelineState(_){const T=this.configuration,x=T.integratedMeshMode!==ep.O.None,A=_===Zc.A.NONE,U=_===Zc.A.FrontFace;return(0,Ds.sm)({blending:T.output!==Xs.H.Color&&T.output!==Xs.H.Alpha||!T.blendingEnabled?null:A?yf.wu:(0,yf.j7)(_),culling:(0,Ds.zp)(T.cullFace),depthTest:{func:(0,yf.Bh)(_)},depthWrite:A||U?Ds.LZ:null,colorWrite:Ds.BK,stencilWrite:x||T.hasOccludees?AE.s3:null,stencilTest:x?(0,AE.ec)(Fi.hU.IntegratedMeshMaskExcluded):T.hasOccludees?AE.RY:null,polygonOffset:A||U?T.hasPolygonOffset?{factor:2,units:2}:null:yf.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}YE.shader=new ro.J(II.C,()=>v.e(6777).then(v.bind(v,26777)));const UI=new Map([[Qi.T.POSITION,0],[Qi.T.NORMAL,1],[Qi.T.NORMALCOMPRESSED,1],[Qi.T.COLOR,2],[Qi.T.UV0,3],[Qi.T.UVREGION,4],[Qi.T.COMPONENTINDEX,5]]);var XE=v(35357),dy=v(50574);class zH extends lu.K{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const _ of this._parameterBlocks)this[_]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const _ of this._parameterBlocks)if(this[_].dirty)return!0;return!1}}class NO{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function ao(d={}){return(_,T)=>{const x=_._parameterCount??0;if(_._parameterCount=x+1,d.vectorOps){const A=d.vectorOps;Object.defineProperty(_,T,{get(){return this[x]},set(U){const ne=this[x];if(null==ne)this[x]=U;else{if(A.equals(ne,U))return;A.copy(ne,U)}this._setDirty()}})}else Object.defineProperty(_,T,{get(){return this[x]},set(A){this[x]!==A&&(d.dispose&&this[x]&&this[x].dispose(),this[x]=A,this._setDirty())}})}}function BI(){return(d,_)=>{const T=d._parameterCount??0;d._parameterCount=T+1,d._parameterBlocks=d._parameterBlocks||[],d._parameterBlocks.push(T),Object.defineProperty(d,_,{get(){return this[T]},set(x){this[T]!==x&&(this[T]=x,this._setDirty())}})}}var Un=v(43553),jI=v(96395),HH=v(67022),GH=v(22799);class kE{constructor(_){this._low=(0,Tl.c)(),this._high=(0,Tl.c)(),_&&this.set(_)}get low(){return this._low}get high(){return this._high}set(_){const T=this._low,x=this._high;(0,pt.c)(T,_),(0,pt.y)(x,_,T)}setElements(_,T,x){(0,pt.s)(FI,_,T,x),this.set(FI)}get(_){return(0,pt.a)(_,this._low,this._high)}getLowScaled(_){return(0,pt.g)(_,this._low,1)}}const FI=(0,ir.c)();class ta extends zH{constructor(_,T){super(),this.toMapSpace=T,this.baseColor=(0,Zh.f)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=(0,Tl.f)(1,1,.5),this.emissiveFactor=(0,Tl.f)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new JE,this.componentParameters=new hy,this.textureAlphaCutoff=HH.F,this.alphaDiscardMode=Fi.JJ.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=GH.U.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ep._;const x=new kE(_.position),A=(0,cf.a)(_.rotationScale);(0,Co.e)(A,A),this.transformNormalGlobalFromModel=(0,Co.t)(A,A),this.transformWorldFromModelTL=x.low,this.transformWorldFromModelTH=x.high,this.transformWorldFromModelRS=_.rotationScale}dispose(){this._technique=(0,Qe.RY)(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return(0,Qe.pC)(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return(0,Qe.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return(0,Qe.pC)(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return(0,Qe.pC)(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return(0,Qe.pC)(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(_,T,x,A){const U=this._techniqueConfiguration;U.hasVertexColors=A.colors,U.hasNormals=A.normals,U.textureCoordinateType=A.textureCoordinates,U.hasMetallicRoughnessTexture=(0,Qe.pC)(this.metallicRoughnessTexture),U.hasEmissionTexture=(0,Qe.pC)(this.emissionTexture),U.hasOcclusionTexture=(0,Qe.pC)(this.occlusionTexture),U.hasNormalTexture=(0,Qe.pC)(this.normalTexture),U.transparencyPassType=T.identifier===Un.o9.Material&&null!=x.transparencyPassType?x.transparencyPassType:Zc.A.NONE,U.hasMultipassTerrain=T.identifier===Un.o9.Material&&null!=x.multipassTerrain&&x.multipassTerrain.enabled,U.cullAboveGround=T.identifier===Un.o9.Material&&null!=x.multipassTerrain&&x.multipassTerrain.cullAboveGround,U.ellipsoidMode=this.ellipsoidMode,U.componentData=this.componentParameters.type,U.cullFace=this.commonMaterialParameters.cullFace,U.doubleSidedMode=this.commonMaterialParameters.doubleSided?jI.q.View:jI.q.None,U.hasBaseColorTexture=(0,Qe.pC)(this.baseColorTexture);const ne=this._computeWhichMaterialPass();U.blendingEnabled=ne===ul.Transparent||ne===ul.OpaqueAndTransparent,U.alphaDiscardMode=this.alphaDiscardMode,U.integratedMeshMode=this.isIntegratedMesh?function $H(d){return 0!==d.overlays.length&&(0,Qe.pC)(d.overlays[Vs.fu.INNER].getColorTextureNoRasterImage())}(x)?(0,II.g)(x)?ep.O.ColorOverlayWithWater:ep.O.ColorOverlay:ep.O.NoOverlay:ep.O.None,U.useLegacyTerrainShading=this.isIntegratedMesh&&Fo.Z.TERRAIN_USE_LEGACY_SHADING,U.hasPolygonOffset=this.polygonOffsetEnabled;const fe=this.hasParametersFromSource&&(0,Qe.Wi)(this.baseColorTexture);return U.pbrMode=U.integratedMeshMode===ep.O.ColorOverlayWithWater?ny.f7.WaterOnIntegratedMesh:this.usePBR?fe?ny.f7.Schematic:ny.f7.Normal:ny.f7.Disabled,U.normalType=U.integratedMeshMode===ep.O.None?U.hasNormals?WE.h.CompressedAttribute:WE.h.ScreenDerivative:WE.h.Ground,U.hasSlicePlane=(0,Qe.pC)(x.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,T.identifier===Un.o9.ShadowMap?(U.output=Xs.H.Shadow,U.vertexDiscardMode=dy.a.None):T.identifier===Un.o9.Highlight?(U.output=Xs.H.Highlight,U.vertexDiscardMode=dy.a.None):(U.vertexDiscardMode=this._computeWhichMaterialPass()===ul.OpaqueAndTransparent?T.transparent?dy.a.Opaque:dy.a.Transparent:dy.a.None,U.output=function KH(d){switch(d){case Un.zp.Color:return Xs.H.Color;case Un.zp.Alpha:return Xs.H.Alpha;case Un.zp.Depth:return Xs.H.Depth;case Un.zp.Normal:return Xs.H.Normal;case Un.zp.ObjectAndLayerIdColor:return Xs.H.ObjectAndLayerIdColor}}(T.subPass),T.subPass===Un.zp.Alpha&&(U.hasOccludees=x.hasOccludees),T.subPass===Un.zp.Color?(U.receiveAmbientOcclusion=x.ssaoHelper.ready,U.hasOccludees=x.hasOccludees,U.receiveShadows=x.shadowMap.ready,U.hasScreenSpaceReflections=x.ssr.enabled,U.hasCloudsReflections=(0,Qe.pC)(x.cloudsFade.data)):(U.receiveAmbientOcclusion=!1,U.receiveShadows=!1),U.snowCover=this.hasSnowCover(x),T.subPass===Un.zp.ObjectAndLayerIdColor&&(U.objectAndLayerIdColor=!0)),this._technique=_.releaseAndAcquire(YE,U,this._technique),this._setClean(),this._technique}hasSnowCover(_){return(0,Qe.pC)(_.weather)&&_.weatherVisible&&"snowy"===_.weather.type&&"enabled"===_.weather.snowCover}submit(_,T,x){if(0===this.objectOpacity)return;const A=x.renderable.geometry,U=x.components,ne=x.renderable.meta.cameraDepthSquared,fe=U.geometryRanges,Oe=U.highlightRanges,we=U.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ul.Opaque:_.materialOpaque.submitDraw(this,A,fe,ne);break;case ul.Transparent:_.materialTransparent.submitDraw(this,A,fe,ne);break;case ul.OpaqueAndTransparent:_.materialOpaque.submitDraw(this,A,fe,ne),_.materialTransparent.submitDraw(this,A,fe,ne);break;case ul.IntegratedMesh:_.materialIntegratedMesh.submitDraw(this,A,fe,ne),function ZH(d){return 0!==d.overlays.length&&(0,Qe.pC)(d.overlays[Vs.fu.INNER].getValidTexture(Vs.NH.Highlight))}(T)&&_.highlightIntegratedMesh.submitDraw(this,A,fe,ne)}const Ze=this.componentParameters.castShadows!==Zo.None;Ze&&_.shadowMap.submitDraw(this,A,fe,ne),(0,Qe.pC)(Oe)&&(_.highlight.submitDraw(this,A,Oe,ne),Ze&&_.highlightShadowMap.submitDraw(this,A,Oe,ne)),Ze&&(0,Qe.pC)(we)&&_.defaultShadowMap.submitDraw(this,A,we,ne)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ul.IntegratedMesh:this.objectOpacity<1?ul.Transparent:this.componentParameters.opaqueOverride===Zo.All?ul.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Fi.JJ.Blend||this.alphaDiscardMode===Fi.JJ.MaskBlend?ul.Transparent:this.componentParameters.transparent===Zo.None?ul.Opaque:this.componentParameters.transparent===Zo.All?ul.Transparent:ul.OpaqueAndTransparent}}var ul,Zo;(0,Ve._)([ao({vectorOps:Qo.v})],ta.prototype,"baseColor",void 0),(0,Ve._)([ao()],ta.prototype,"usePBR",void 0),(0,Ve._)([ao()],ta.prototype,"hasParametersFromSource",void 0),(0,Ve._)([ao({vectorOps:pt.G})],ta.prototype,"mrrFactors",void 0),(0,Ve._)([ao({vectorOps:pt.G})],ta.prototype,"emissiveFactor",void 0),(0,Ve._)([ao({dispose:!0})],ta.prototype,"baseColorTexture",void 0),(0,Ve._)([ao({dispose:!0})],ta.prototype,"metallicRoughnessTexture",void 0),(0,Ve._)([ao({dispose:!0})],ta.prototype,"emissionTexture",void 0),(0,Ve._)([ao({dispose:!0})],ta.prototype,"occlusionTexture",void 0),(0,Ve._)([ao({dispose:!0})],ta.prototype,"normalTexture",void 0),(0,Ve._)([ao()],ta.prototype,"objectOpacity",void 0),(0,Ve._)([BI()],ta.prototype,"commonMaterialParameters",void 0),(0,Ve._)([BI()],ta.prototype,"componentParameters",void 0),(0,Ve._)([ao()],ta.prototype,"textureAlphaCutoff",void 0),(0,Ve._)([ao()],ta.prototype,"alphaDiscardMode",void 0),(0,Ve._)([ao()],ta.prototype,"isIntegratedMesh",void 0),(0,Ve._)([ao()],ta.prototype,"polygonOffsetEnabled",void 0),(0,Ve._)([ao()],ta.prototype,"ellipsoidMode",void 0),(0,Ve._)([ao()],ta.prototype,"hasOccludees",void 0),function(d){d[d.Opaque=0]="Opaque",d[d.Transparent=1]="Transparent",d[d.OpaqueAndTransparent=2]="OpaqueAndTransparent",d[d.IntegratedMesh=3]="IntegratedMesh"}(ul||(ul={}));class JE extends NO{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Fi.Vr.Back,this.hasSlicePlane=!0}}(0,Ve._)([ao()],JE.prototype,"doubleSided",void 0),(0,Ve._)([ao()],JE.prototype,"cullFace",void 0),(0,Ve._)([ao()],JE.prototype,"hasSlicePlane",void 0);class hy extends NO{constructor(){super(...arguments),this.externalColor=(0,Zh.f)(1,1,1,1),this.externalColorMixMode=ay.a9.Multiply,this.castShadows=Zo.All}get transparent(){return this.externalColor[3]<1?Zo.All:Zo.None}get opaqueOverride(){return this.externalColorMixMode===ay.a9.Replace&&1===this.externalColor[3]?Zo.All:Zo.None}get visible(){return this.externalColor[3]>0?Zo.All:Zo.None}get type(){return XE._N.Uniform}}(0,Ve._)([ao({vectorOps:Qo.v})],hy.prototype,"externalColor",void 0),(0,Ve._)([ao()],hy.prototype,"externalColorMixMode",void 0),(0,Ve._)([ao()],hy.prototype,"castShadows",void 0),function(d){d[d.All=0]="All",d[d.Some=1]="Some",d[d.None=2]="None"}(Zo||(Zo={}));class py extends NO{constructor(){super(...arguments),this.texture=null,this.transparent=Zo.None,this.opaqueOverride=Zo.None,this.castShadows=Zo.None}get type(){return XE._N.Varying}}(0,Ve._)([ao()],py.prototype,"texture",void 0),(0,Ve._)([ao()],py.prototype,"transparent",void 0),(0,Ve._)([ao()],py.prototype,"opaqueOverride",void 0),(0,Ve._)([ao()],py.prototype,"castShadows",void 0);var Kd=v(7184),YH=v(17827);class XH{constructor(_){this._maxCount=_,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(_){this._recycledIndices.push(_)}}class kH{constructor(_,T=1){this._rctx=_,this._fieldCount=T,this.textureWidth=4096,this._dirty=!0,this._texture=new Ro.x(this._rctx,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.NEAREST,wrapMode:xt.e8.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new of.mc(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(_,T,x,A,U,ne){const fe=_*this._fieldCount+T;this._dirty=!0,this._data.set(fe,0,x),this._data.set(fe,1,A),this._data.set(fe,2,U),this._data.set(fe,3,ne)}setDataElement(_,T,x,A){const U=_*this._fieldCount+T;this._dirty=!0,this._data.set(U,x,A)}resizeToFit(_){const T=_*this._fieldCount;if(T>=this._data.count){const x=Math.ceil((T+1)/this.textureWidth)*this.textureWidth,A=new of.mc(new ArrayBuffer(4*x));A.typedBuffer.set(this._data.typedBuffer),this._data=A}}updateTexture(){if(!this._dirty)return;const _=this._texture.descriptor.width;this._data.count>_*this._texture.descriptor.height&&this._texture.resize(_,this._data.count/_),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}class JH{constructor(_,T=1){this.textureBuffer=new kH(_,T),this._indexManager=new XH(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const _=this._indexManager.acquire();return this.textureBuffer.resizeToFit(_),_}releaseIndex(_){this._indexManager.release(_)}}class WI{constructor(_,T=1){this._rctx=_,this._fieldCount=T,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(_=>0!==_.activeCount||(_.dispose(),!1))}destroy(){this._buffers.forEach(_=>_.dispose()),this._buffers=[]}getBuffer(_){for(const x of this._buffers)if(x.availableCount>=_)return x;if(_>65536)return null;const T=new JH(this._rctx,this._fieldCount);return this._buffers.push(T),T}updateTextures(){for(const _ of this._buffers)_.textureBuffer.updateTexture()}}var _y=v(49353);const VI=Us.Z.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class QH{constructor(_,T){this._renderManager=_,this._viewingMode=T,this._objects=[new wo.Z,new wo.Z],this._renderSubmit=new WH(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=(0,So.Z)("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new WI(_.rctx,2+(this._hasObjectAndLayerId?1:0))}dispose(){(0,Wc.hu)(0===this._objects[GE.Z.Hidden].length&&0===this._objects[GE.Z.Visible].length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(_){const T=new GE.c;return T.toMapSpace=_.toMapSpace,T.transform=_.transform,T.obb=(0,ly.d9)(_.obb),T.components=new bH(this._componentBufferManager,_.geometry.componentOffsets),T.renderable=this._createRenderable(_,T.components),T.intersectionGeometry=new SH(_.geometry.positionData,T.components),this._objects[T.visible].push(T),T}destroyObject(_){const T=_;this._objects[T.visible].removeUnordered(T),T.dispose(),this._notifyDirty()}setObjectVisibility(_,T){const x=_;T!==x.visible&&(this._objects[x.visible].removeUnordered(x),this._objects[T].push(x),x.visible=T,this._notifyDirty())}preSubmit(_){const T=_.camera.eye;this.visibleObjects.forAll(x=>x.renderable.meta.cameraDepthSquared=(0,pt.d)(T,x.obb.center))}getMaterial(_){return _.renderable.material}updateMaterial(_,T){const x=_.renderable.material;T(x),x.dirty&&this._notifyDirty()}setAllComponentVisibilities(_,T){const x=_;x.components.visibility.reset(T),x.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(_,T){return _.components.visibility.forEachComponent(T)}getComponentCount(_){const T=_,x=T.components.visibility.componentCount();return{visible:x,invisible:T.components.count-x}}setComponentData(_,T){const x=_,A=x.renderable.material,U=x.components,ne=U.materialDataBuffer,fe=U.materialDataIndices,Oe={castShadows:!0,pickable:!0,externalColor:(0,Zh.c)(),externalColorMixMode:ay.a9.Multiply,elevationOffset:0,objectAndLayerIdColor:this._hasObjectAndLayerId?(0,Zh.c)():null},we=ne.textureBuffer,Ze=new Uint8Array(4),it=new Uint32Array(Ze.buffer);let lt=0,dt=0,Tt=0,mt=U.verticalOffsets,Mt=1/0,Pt=-1/0,Nt=!1,Bt=!1,Zt=0;for(let nr=0;nr<U.count;nr++){if(T(nr,Oe),lt+=+(Oe.externalColor[3]<1),dt+=+(Oe.externalColorMixMode===ay.a9.Replace&&1===Oe.externalColor[3]),Tt+=+Oe.castShadows,(0,ay.HB)(Oe.externalColor,Oe.externalColorMixMode,Ze),Ze[2]=254&Ze[2]|+Oe.castShadows,we.setData(fe[nr],0,Ze[0],Ze[1],Ze[2],Ze[3]),Nt||(Nt=nr>0&&Zt!==it[0]),Zt=it[0],Bt||(Bt=0!==Oe.elevationOffset),Bt&&(0,Qe.Wi)(mt)&&(mt=new Array(nr).fill(0)),(0,Qe.pC)(mt)&&(mt[nr]=Oe.elevationOffset),Mt=Math.min(Mt,Oe.elevationOffset),Pt=Math.max(Pt,Oe.elevationOffset),(0,XE.nO)(Oe.elevationOffset,Ze),we.setData(fe[nr],1,Ze[0],Ze[1],Ze[2],Ze[3]),this._hasObjectAndLayerId){const Jt=Oe.objectAndLayerIdColor;we.setData(fe[nr],2,Jt[0],Jt[1],Jt[2],Jt[3])}Oe.pickable!==MI(U.pickability,nr)&&(U.pickability=TH(U.pickability,U.count,nr,Oe.pickable))}U.verticalOffsets=Bt?mt:null,x.offsetObb=Bt?(0,gH.gI)(x.obb,Mt,Pt,this._viewingMode,(0,Qe.pC)(x.offsetObb)?x.offsetObb:(0,ly.d9)(x.obb)):null,Nt||Bt||this._hasObjectAndLayerId?(A.componentParameters=new py,A.componentParameters.castShadows=WO(Tt,U.count),A.componentParameters.transparent=WO(lt,U.count),A.componentParameters.opaqueOverride=WO(dt,U.count),A.componentParameters.texture=we,we.updateTexture()):(A.componentParameters=new hy,A.componentParameters.castShadows=Oe.castShadows?Zo.All:Zo.None,A.componentParameters.externalColor=Oe.externalColor,A.componentParameters.externalColorMixMode=Oe.externalColorMixMode),this._notifyDirty()}getComponentAabb(_,T,x,A=!1){_.intersectionGeometry.getComponentAabb(T,x);const U=_,ne=U.components.verticalOffsets;if(A||(0,Qe.Wi)(ne))return x;const fe=ne[T];if(this._viewingMode===vi.JY.Local||0===fe)return x[2]+=fe,x[5]+=fe,x;const Oe=(0,Qe.Wg)((0,bc.iO)(fe));return Oe.localOrigin=U.transform.position,Oe.applyToAabb(x)}getComponentObb(_){return _.obb}getObjectTransform(_){return _.transform}getComponentPositions(_,T,x){return _.intersectionGeometry.getComponentPositions(T,x)}intersect(_,T,x,A,U,ne){const fe=_;(0,Qe.pC)(U)&&(U.localOrigin=fe.transform.position);const Oe=(0,Co.e)(zI,fe.transform.rotationScale);(0,pt.y)(QE,T,fe.transform.position),(0,pt.y)(qE,x,fe.transform.position),(0,pt.t)(QE,QE,Oe),(0,pt.t)(qE,qE,Oe);const we=(0,Co.t)(zI,Oe);return fe.intersectionGeometry.intersect(QE,qE,A,we,U,fe.components.verticalOffsets,ne)}addEdges(_,T,x,A){const U=_,{indices:ne,positions:fe}=U.intersectionGeometry,Oe=U.components.offsets;return T.addComponentObject(_,U.transform,{center:U.obb.center,radius:(0,ly.q0)(U.obb)},fe,ne,Oe,x,A)}extractEdgeInformation(_,T,x){var A=this;return(0,kr.Z)(function*(){const U=_,ne=U.components.visibility;if(ne.allInvisible())return{buffer:YH.n_.createBuffer(0),origin:[0,0,0]};const{indices:fe,positions:Oe}=U.intersectionGeometry,we=U.components.offsets,Ze=Kd.tf.createBuffer(Oe.count);(0,TI.c)(Ze.position,Oe),(0,mH.a)(Ze.position,Ze.position,U.transform.rotationScale),A._setComponentIndices(Ze.componentIndex,fe,we);const lt=A._computeVisibilityIndices(fe,ne,we,Ze.count);return{origin:(0,ir.a)(U.transform.position),buffer:yield T.extractComponentsEdgeLocations({indices:lt,indicesLength:lt.length,skipDeduplicate:!0,data:Ze,writerSettings:{reducedPrecision:!1,variants:0}},x)}})()}_setComponentIndices(_,T,x){let A=0;for(let U=0;U<x.length-1;U++){const fe=x[U+1];for(let Oe=x[U];Oe<fe;Oe++)_.set(T?T[Oe]:Oe,A);A++}}_computeVisibilityIndices(_,T,x,A){if(_&&T.allVisible())return _;let U=0;T.forEachComponentRange((Oe,we)=>(U+=x[we]-x[Oe],!0));const ne=Array.isArray(_)?new Array(U):2===_?.BYTES_PER_ELEMENT||A<=65536?new Uint16Array(U):new Uint32Array(U);let fe=0;return T.forEachComponentRange((Oe,we)=>{const it=x[we];for(let lt=x[Oe];lt<it;lt++)ne[fe++]=_?_[lt]:lt;return!0}),ne}addComponentHighlight(_,T){const x=_.components;(0,Qe.Wi)(x.highlightCounts)&&(x.highlightCounts=new Uint32Array(x.count+1)),0==x.highlightCounts[T]++&&(x.highlightsDirty(),this._notifyDirty()),x.highlightCounts[x.count]++}removeComponentHighlight(_,T){const x=_.components;if((0,Qe.Wi)(x.highlightCounts))return void VI.warn("Removing non-existing highlight.");const A=x.highlightCounts[T],U=x.highlightCounts[x.count];if(0!==A){if(A>1)return x.highlightCounts[T]=A-1,void(x.highlightCounts[x.count]=U-1);x.highlightCounts[T]=0,x.highlightsDirty(),this._notifyDirty(),1===U?x.highlightCounts=null:x.highlightCounts[x.count]=U-1}else VI.warn("Removing non-existing highlight.")}clearHighlights(_){const T=_.components;(0,Qe.pC)(T.highlightCounts)&&(T.highlightCounts=null,T.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(_){return _.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[GE.Z.Visible]}_createRenderable(_,T){const x=this._renderManager.rctx,A=_.geometry,U=A.vertices.layoutParameters,ne=Ra.f.createVertex(x,xt.l1.STATIC_DRAW,A.vertices.data),fe=(0,Qe.yw)(A.indices,mt=>Ra.f.createIndex(x,xt.l1.STATIC_DRAW,mt)),Oe=(0,xh.K)((0,VH.N)(U)),we=new Uint16Array(A.vertices.count);for(let mt=0;mt<T.count;mt++){const Mt=T.offsets[mt],Pt=T.offsets[mt+1],Nt=T.materialDataIndices[mt];if((0,Qe.pC)(A.indices))for(let Bt=Mt;Bt<Pt;Bt++)we[A.indices[Bt]]=Nt;else for(let Bt=Mt;Bt<Pt;Bt++)we[Bt]=Nt}const Ze=Ra.f.createVertex(x,xt.l1.STATIC_DRAW,we.buffer),it=new ta(_.transform,_.toMapSpace),lt=new _y.U(x,UI,{data:Oe,componentIndices:qH},{data:ne,componentIndices:Ze},(0,Qe.Wg)(fe)),dt=new OI(lt,xt.MX.TRIANGLES,U,(0,Qe.pC)(fe)),Tt={cameraDepthSquared:.5,gpuMemoryEstimate:ne.byteSize+Ze.byteSize+((0,Qe.pC)(fe)?fe.byteSize:0)};return new wH(it,dt,Tt)}_notifyDirty(){this._renderManager.notifyDirty()}}const qH=(0,xh.K)((0,Xp.U$)().u16(Qi.T.COMPONENTINDEX));function WO(d,_){return d===_?Zo.All:0===d?Zo.None:Zo.Some}const zI=(0,cf.c)(),QE=(0,ir.c)(),qE=(0,ir.c)();var Ya,eG=v(45323),HI=v(70264);!function(d){d[d.None=0]="None",d[d.Alpha=1]="Alpha",d[d.PremultipliedAlpha=2]="PremultipliedAlpha",d[d.COUNT=3]="COUNT"}(Ya||(Ya={}));class VO extends pi.m{constructor(){super(...arguments),this.alphaMode=Ya.None,this.hasOpacityFactor=!1}}(0,Ve._)([(0,pi.o)({count:Ya.COUNT})],VO.prototype,"alphaMode",void 0),(0,Ve._)([(0,pi.o)()],VO.prototype,"hasOpacityFactor",void 0);class eb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,eb.shader.get().build(this.configuration),io.i)}initializePipeline(){switch(this.configuration.alphaMode){case Ya.None:return(0,Ds.sm)({colorWrite:Ds.BK});case Ya.Alpha:return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK});case Ya.PremultipliedAlpha:case Ya.COUNT:return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}}eb.shader=new ro.J(HI.a,()=>v.e(505).then(v.bind(v,40505)));var GI=v(19982);class tb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,tb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}tb.shader=new ro.J(GI.a,()=>v.e(7281).then(v.bind(v,97281)));var KI=v(51764);class rb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,rb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}rb.shader=new ro.J(KI.a,()=>v.e(8750).then(v.bind(v,88750)));var ZI=v(8651);class sb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,sb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}sb.shader=new ro.J(ZI.a,()=>v.e(4207).then(v.bind(v,84207)));class tG{constructor(_,T){this._rctx=_,this._techniqueRepository=T,this._configuration=new VO,this._passParameters=new HI.C,this._oitParameters=new KI.O,this._hudParameters=new GI.H,this._overlayParameters=new ZI.O}dispose(){this._vao=(0,Qe.M2)(this._vao)}compositeOIT(_,T,x,A){this._oitParameters.colorTexture=T,this._oitParameters.alphaTexture=x,this._oitParameters.frontFaceTexture=A;const U=this._rctx,ne=this._techniqueRepository.acquire(rb);U.bindTechnique(ne,this._oitParameters,_);const fe=this._ensureVAO();U.bindVAO(fe),U.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(fe,"geometry")),ne.release()}compositeHUD(_,T){this._hudParameters.texture=T;const x=this._rctx,A=this._techniqueRepository.acquire(tb);x.bindTechnique(A,this._hudParameters,_);const U=this._ensureVAO();x.bindVAO(U),x.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(U,"geometry")),A.release()}compositeOverlay(_,T,x,A){this._overlayParameters.texture=T,this._overlayParameters.opacity=x,this._overlayParameters.overlayIndex=A;const U=this._rctx,ne=this._techniqueRepository.acquire(sb);U.bindTechnique(ne,this._overlayParameters,_);const fe=this._ensureVAO();U.bindVAO(fe),U.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(fe,"geometry")),ne.release()}composite(_,T,x=Ya.None,A=1){const U=this._rctx;this._configuration.alphaMode=x,this._configuration.hasOpacityFactor=1!==A,this._passParameters.texture=T,this._passParameters.opacity=A;const ne=this._techniqueRepository.acquire(eb,this._configuration);U.bindTechnique(ne,this._passParameters,_);const fe=this._ensureVAO();U.bindVAO(fe),U.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(fe,"geometry")),ne.release()}_ensureVAO(){return(0,Qe.Wi)(this._vao)&&(this._vao=(0,_a.ow)(this._rctx)),this._vao}}var ib=v(36161),b0=v(82274);function oG(d,_,T){return(0,ib.v)(_,d)*(T[1]-T[0])+T[0]}function HO(d,_,T){if(!T.isVisible||!(0,rn.hr)(_.frustum,T.boundingVolumeWorldSpace.bounds))return;const x=T.transformation,A=_G;T.geometryRecords.forEach(U=>{(0,gi.m)(A,x,U.getShaderTransformation());const ne=(0,sl.u1)(A);$I(d,_,U.geometry.boundingInfo,A,ne)})}function $I(d,_,T,x,A){if((0,Qe.Wi)(T))return;(0,pt.m)(La,T.center,x);const{eye:U,viewForward:ne}=_,fe=ne[0]*(La[0]-U[0])+ne[1]*(La[1]-U[1])+ne[2]*(La[2]-U[2]);if(La[3]=T.radius*A,!(fe-La[3]>d.near&&fe+La[3]<d.far)&&(0,rn.hr)(_.frustum,La))if(T.radius>100&&T.getChildren()){const Oe=T.getChildren();for(let we=0;we<8;++we)Oe[we]&&$I(d,_,Oe[we],x,A)}else KO.unionDepthRangeWithAABB(d,_.viewProjectionMatrix,x,T.bbMin,T.bbMax)}function YI(d,_,T){const x=_.eye,A=_.viewForward,U=(T[0]-x[0])*A[0]+(T[1]-x[1])*A[1]+(T[2]-x[2])*A[2];d.near=Math.min(d.near,U-T[3]),d.far=Math.max(d.far,U+T[3])}const GO=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],La=(0,oo.c)(),_G=(0,gn.c)(),$c=cy(),vf=new class dG{constructor(){this._items=new wo.Z({allocator:_=>_||{obj:null,distance:0,near:0,far:0},deallocator:_=>(_.obj=null,_.distance=0,_.near=0,_.far=0,_)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(_){this._items.pushNew().obj=_}sort(_){const T=_.eye,x=_.viewForward;this._items.forAll(A=>{const U=A.obj.boundingVolumeWorldSpace.bounds,ne=(U[0]-T[0])*x[0]+(U[1]-T[1])*x[1]+(U[2]-T[2])*x[2];A.distance=ne,A.near=ne-U[3],A.far=ne+U[3]}),this._items.sort((A,U)=>A.distance-U.distance)}forEachInDepthRange(_,T,x){if(T===b0.Z.DepthOrder.FRONT_TO_BACK)for(let A=0;A<this._items.length;++A){const U=this._items.data[A];U.far<_.near||U.near>_.far||x(U.obj,U.near,U.far)}else for(let A=this._items.length-1;A>=0;--A){const U=this._items.data[A];U.far<_.near||U.near>_.far||x(U.obj,U.near,U.far)}}},fG=new class hG{constructor(){this._view=(0,gn.c)(),this._viewProj=(0,gn.c)(),this._frustum=(0,rn.Ue)(),this._geometries=[],this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._range={near:0,far:0},this._looseRange={near:0,far:0}}compute(_,T){this._reset(),(0,gi.c)(this._view,_.viewMatrix),(0,gi.m)(this._viewProj,_.projectionMatrix,this._view),(0,rn.JG)(this._frustum,_.frustum);const x=this._view,A=x[2],U=x[6],ne=x[10],fe=x[14],Oe=this._range;let we=0;if(T.forEach(dt=>{if(!dt.instanceParameters.visible||!dt.castShadow)return;let Tt;dt.hasShaderTransformation?(dt.computeBoundingSphere(dt.getShaderTransformation(),La,1),Tt=La):Tt=dt.boundingSphere;const mt=A*Tt[0]+U*Tt[1]+ne*Tt[2]+fe,Mt=mt-Tt[3],Pt=mt+Tt[3];this._geometries[we]=dt,this._near[we]=-Pt,this._far[we]=-Mt,++we}),0===this._geometries.length)return Oe;for(let dt=0;dt<this._geometries.length;++dt)this._near[dt]>Oe.far&&(Oe.far=this._near[dt]),this._near[dt]>2&&this._far[dt]<Oe.near&&(Oe.near=this._far[dt]);const Ze=this._looseRange;Ze.near=Math.max(.5*Oe.near,2),Ze.far=2*Oe.far;let it=0,lt=0;for(let dt=0;dt<this._geometries.length;++dt)this._near[dt]<Oe.near&&(this._near[dt]>=Ze.near?Oe.near=this._near[dt]:this._nearCandidates[it++]=dt),this._far[dt]>Oe.far&&(this._far[dt]<=Ze.far?Oe.far=this._far[dt]:this._farCandidates[lt++]=dt);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return Oe;this._nearCandidates.sort((dt,Tt)=>this._near[dt]<this._near[Tt]?-1:this._near[dt]>this._near[Tt]?1:0),this._farCandidates.sort((dt,Tt)=>this._far[dt]<this._far[Tt]?1:this._far[dt]>this._far[Tt]?-1:0);for(let dt=0;dt<this._nearCandidates.length;++dt){const Tt=this._nearCandidates[dt];if(this._near[Tt]<Oe.near){const mt=this._geometries[Tt];this._includeNearBoundingInfoRec(mt.boundingInfo,mt.getShaderTransformation())}}for(let dt=0;dt<this._farCandidates.length;++dt){const Tt=this._farCandidates[dt];if(this._far[Tt]>Oe.far){const mt=this._geometries[Tt];this._includeFarBoundingInfoRec(mt.boundingInfo,mt.getShaderTransformation())}}return Oe}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0,this._range.near=Number.MAX_VALUE,this._range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(_,T){if((0,Qe.Wi)(_))return;const x=_.getCenter();(0,pt.m)(La,x,T);const A=(0,sl.u1)(T),U=La[0],ne=La[1],fe=La[2],Oe=_.getBSRadius()*A,we=this._frustum;if(we[0][0]*U+we[0][1]*ne+we[0][2]*fe+we[0][3]>Oe||we[1][0]*U+we[1][1]*ne+we[1][2]*fe+we[1][3]>Oe||we[2][0]*U+we[2][1]*ne+we[2][2]*fe+we[2][3]>Oe||we[3][0]*U+we[3][1]*ne+we[3][2]*fe+we[3][3]>Oe)return;const Ze=this._view[2]*U+this._view[6]*ne+this._view[10]*fe+this._view[14],it=Ze+Oe;if(!(-(Ze-Oe)<2||-it>=this._range.near))if(-it>this._looseRange.near)this._range.near=-it;else{if(Oe>100){const lt=_.getChildren();if(void 0!==lt){for(let dt=0;dt<8;++dt)void 0!==lt[dt]&&this._includeNearBoundingInfoRec(lt[dt],T);return}}KO.unionDepthRangeWithAABB(this._range,this._viewProj,T,_.getBBMin(),_.getBBMax())}}_includeFarBoundingInfoRec(_,T){if((0,Qe.Wi)(_))return;let x=_.getBSRadius();const A=_.getCenter();(0,pt.m)(La,A,T);const U=(0,sl.u1)(T),ne=La[0],fe=La[1],Oe=La[2];x*=U;const we=this._frustum;if(we[0][0]*ne+we[0][1]*fe+we[0][2]*Oe+we[0][3]>x||we[1][0]*ne+we[1][1]*fe+we[1][2]*Oe+we[1][3]>x||we[2][0]*ne+we[2][1]*fe+we[2][2]*Oe+we[2][3]>x||we[3][0]*ne+we[3][1]*fe+we[3][2]*Oe+we[3][3]>x)return;const Ze=this._view[2]*ne+this._view[6]*fe+this._view[10]*Oe+this._view[14]-x;if(!(-Ze<=this._range.far))if(-Ze<this._looseRange.far)this._range.far=-Ze;else{if(x>100){const it=_.getChildren();if(void 0!==it){for(let lt=0;lt<8;++lt)void 0!==it[lt]&&this._includeFarBoundingInfoRec(it[lt],T);return}}KO.unionDepthRangeWithAABB(this._range,this._viewProj,T,_.getBBMin(),_.getBBMax())}}},KO=new class pG{constructor(){this._modelViewProj=(0,gn.c)(),this._clipPosition=[(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)(),(0,Tn.c)()]}unionDepthRangeWithAABB(_,T,x,A,U){const ne=this._modelViewProj;(0,gi.m)(ne,T,x);let fe=!1;for(let Oe=0;Oe<8;++Oe){const we=this._clipPosition[Oe],Ze=0===Oe||3===Oe||4===Oe||7===Oe?A[0]:U[0],it=0===Oe||1===Oe||4===Oe||5===Oe?A[1]:U[1],lt=Oe<4?A[2]:U[2];we[0]=ne[0]*Ze+ne[4]*it+ne[8]*lt+ne[12],we[1]=ne[1]*Ze+ne[5]*it+ne[9]*lt+ne[13],we[2]=ne[2]*Ze+ne[6]*it+ne[10]*lt+ne[14],we[3]=ne[3]*Ze+ne[7]*it+ne[11]*lt+ne[15]}for(let Oe=0;Oe<12;++Oe){const lt=this._clipTriangle(this._clipPosition[GO[Oe][0]],this._clipPosition[GO[Oe][1]],this._clipPosition[GO[Oe][2]]);let dt=!0;for(let Tt=0;Tt<lt.length;++Tt)if(lt[Tt][3]>=2){dt=!1;break}if(!dt){fe=!0;for(let Tt=0;Tt<lt.length;++Tt){const mt=lt[Tt][3];Number.isFinite(mt)&&(_.near=Math.min(mt,_.near),_.far=Math.max(mt,_.far))}}}return fe}_inside(_,T){return 0===T?_[0]>=-_[3]:1===T?_[1]>=-_[3]:2===T?_[0]<=_[3]:3===T?_[1]<=_[3]:void(0,Wc.hu)(!1)}_intersect(_,T,x){let A=0;return 0===x?A=(-_[3]-_[0])/(T[0]-_[0]+T[3]-_[3]):1===x?A=(-_[3]-_[1])/(T[1]-_[1]+T[3]-_[3]):2===x?A=(_[3]-_[0])/(T[0]-_[0]-T[3]+_[3]):3===x&&(A=(_[3]-_[1])/(T[1]-_[1]-T[3]+_[3])),(0,Qo.l)((0,Tn.c)(),_,T,A)}_clipTriangle(_,T,x){let A=[_,T,x];for(let U=0;U<4;++U){const ne=A;A=[];for(let fe=0;fe<ne.length;++fe){const Oe=ne[fe],we=ne[(fe+1)%ne.length];this._inside(we,U)?(this._inside(Oe,U)||A.push(this._intersect(Oe,we,U)),A.push(we)):this._inside(Oe,U)&&A.push(this._intersect(Oe,we,U))}}return A}};var mG=v(50907),C0=v(70026),XI=v(78038),gG=v(69960),yG=v(22355),ZO=v(35387);class vG{}class EG extends lu.K{constructor(){super(...arguments),this.textures=new vG}}const kI=(0,li.s1)(),TG=(0,li.gX)(),MG=(0,Tn.c)();function $O(){return $O=(0,kr.Z)(function*(d){const _=v.e(9080).then(v.bind(v,29080)),T=v.e(5690).then(v.bind(v,5690)),x=(0,C0.t)((yield _).default,{signal:d}),A=(0,C0.t)((yield T).default,{signal:d}),U={mask:yield x,overlay:yield A};return(0,ws.k_)(d),U}),$O.apply(this,arguments)}let Ef=class extends Ns.Z{constructor(){super(...arguments),this._handles=new Ji.Z,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new EG,this.events=new Va.Z,this.attributeLocations=new Map([[Qi.T.POSITION,0]]),this._tmpScreenPoint=(0,li.s1)(),this._tmpRenderPoint=(0,li.gX)()}get updating(){return(0,Qe.Wi)(this._imageSources)&&(0,Qe.pC)(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(d){if(d===this._magnifier)return;this._handles.removeAll(),this._magnifier=d;const _=()=>{this._updateResourceLoading(),this.events.emit("request-render")};(0,Qe.pC)(this._magnifier)&&this._handles.add((0,Ht.YP)(()=>(0,Qe.yw)(this._magnifier,T=>T.version),_)),_()}get enabled(){return(0,Qe.pC)(this._validMagnifier)}get _validMagnifier(){return(0,Qe.pC)(this._magnifier)&&this._magnifier.visible&&(0,Qe.pC)(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return(0,Qe.pC)(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),(0,Qe.pC)(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(d,_){const T=this._validMagnifier;if((0,Qe.Wi)(T))return;const A=Math.ceil(_.camera.pixelRatio*T.size);if(this._updateResources(d,A),(0,Qe.Wi)(this._resources))return;const U=this._passParameters.textures,ne=Math.ceil(1/this._factor*A);U.input.resize(ne,ne),(0,li.md)(T.position,this._tmpScreenPoint);const fe=_.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),we=_.camera.fullHeight,Ze=.5*ne,it=.5*ne;fe[0]=(0,xr.uZ)(fe[0],Ze,_.camera.fullWidth-Ze-1),fe[1]=(0,xr.uZ)(fe[1],it,we-it-1);const lt=Math.floor(fe[0]-Ze),dt=Math.floor(fe[1]-it),Tt=this._resources.program;Tt.bindTexture("textureInput",U.input),d.gl.copyTexImage2D(U.input.descriptor.target,0,U.input.descriptor.pixelFormat,lt,dt,ne,ne,0),this._passParameters.magnifier=T,d.useProgram(Tt),Tt.bindPass(this._passParameters,_),d.bindVAO(this._resources.vao),d.setPipelineState(this._resources.pipelineState),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){var d=this;const _=this._validMagnifier;if((0,Qe.Wi)(_))return;const T=_.maskUrl,x=_.overlayUrl;!(0,Qe.pC)(this._imageLoadTask)||this._imageLoadTask.maskUrl===T&&this._imageLoadTask.overlayUrl===x||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),(0,Qe.pC)(this._imageSources)||(0,Qe.pC)(this._imageLoadTask)||(this._imageLoadTask={maskUrl:T,overlayUrl:x,task:(0,wu.vr)(function(){var A=(0,kr.Z)(function*(U){const ne=(0,Qe.Wi)(T)||(0,Qe.Wi)(x)?function PG(d){return $O.apply(this,arguments)}(U):null,fe=(0,Qe.pC)(T)?(0,C0.t)(T,{signal:U}):ne.then(we=>we.mask),Oe=(0,Qe.pC)(x)?(0,C0.t)(x,{signal:U}):ne.then(we=>we.overlay);d._imageSources={mask:yield fe,overlay:yield Oe},d._disposeResources(),d.events.emit("request-render")});return function(U){return A.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(d,_){if(!this.enabled)return void this._disposeResources();if((0,Qe.pC)(this._resources)){if(this._passParameters.textures.size!==_){const x=this._createTextureResources(d,_);if((0,Qe.Wi)(x))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=x}return}const T=this._createTextureResources(d,_);(0,Qe.Wi)(T)||(this._resources={program:this._createProgram(d),vao:(0,_a.ow)(d,P_.QI,this.attributeLocations,0,1),pipelineState:(0,Ds.sm)({blending:(0,Ds.if)(xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ds.BK})},this._passParameters.textures=T)}_disposeResources(){(0,Qe.Wi)(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(d){d.mask.dispose(),d.overlay.dispose(),d.input.dispose()}_createTextureResources(d,_){if((0,Qe.Wi)(this._imageSources))return null;this._imageSources.overlay.width=_,this._imageSources.overlay.height=_,this._imageSources.mask.width=_,this._imageSources.mask.height=_;const T=new Ro.x(d,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,internalFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,flipped:!0,preMultiplyAlpha:!(0,ST.zd)(this._imageSources.overlay.src)||!d.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),x=new Ro.x(d,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.ALPHA,internalFormat:xt.VI.ALPHA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,flipped:!0},this._imageSources.mask);return{input:new Ro.x(d,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,internalFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR,flipped:!1}),mask:x,overlay:T,size:_}}_createProgram(d){return new Gn.$(d,function bG(){const d=new yG.kG;return d.attributes.add(Qi.T.POSITION,"vec2"),d.vertex.uniforms.add(new gG.N("drawPosition",(_,T)=>function CG(d,_){const T=_.camera.pixelRatio,x=d.magnifier.offset.x*T,A=d.magnifier.offset.y*T;(0,li.md)(d.magnifier.position,kI);const U=_.camera.screenToRender(kI,TG),ne=Math.ceil(T*d.magnifier.size),fe=_.camera.fullWidth,Oe=_.camera.fullHeight;return(0,Qo.s)(MG,(U[0]+x)/fe*2-1,(U[1]-A)/Oe*2-1,ne/fe*2,ne/Oe*2)}(_,T))),d.varyings.add("vUV","vec2"),d.vertex.code.add(lu.H`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),d.fragment.uniforms.add(new ZO.A("textureInput",_=>_.textures.input)),d.fragment.uniforms.add(new ZO.A("textureMask",_=>_.textures.mask)),d.fragment.uniforms.add(new ZO.A("textureOverlay",_=>_.textures.overlay)),d.fragment.uniforms.add(new XI.U("maskEnabled",_=>_.magnifier.maskEnabled)),d.fragment.uniforms.add(new XI.U("overlayEnabled",_=>_.magnifier.overlayEnabled)),d.fragment.code.add(lu.H`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),d}(),this.attributeLocations)}};(0,Ve._)([(0,ke.Cb)()],Ef.prototype,"_imageSources",void 0),(0,Ve._)([(0,ke.Cb)()],Ef.prototype,"_imageLoadTask",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Ef.prototype,"updating",null),Ef=(0,Ve._)([(0,Wr.j)("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Ef);class OG{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new of.mc(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(_,T,x,A,U,ne=null,fe=null,Oe=null){if(!(_&&T&&x&&A&&(this._layerUidToId.set(A,x),this._layerUidToPopupEnabled.set(A,U),U)))return;let we=this._layerUidToGraphicsUidToObjectId.get(A);we||(we=new Map,this._layerUidToGraphicsUidToObjectId.set(A,we)),we.set(T,{objectId:_,attributeNodeId:ne,attributeIndex:fe,subLayerId:Oe})}getObjectAndLayerIdColor(_){const T=this.getObjectAndLayerIdColorArray(_);return(0,Tn.f)(T.get(0,1),T.get(0,2),T.get(0,3),255)}getObjectAndLayerIdColorArray(_){if(!_.layerUid||!_.graphicUid)return this.colorZero;const T=this._layerUidToPopupEnabled.get(_.layerUid);if(void 0===T)return Us.Z.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+_.layerUid),this.colorZero;if(!1===T)return this.colorZero;let x=this._uidToRenderColor.get(_.layerUid);x||(x=new Map,this._uidToRenderColor.set(_.layerUid,x));let A=x.get(_.graphicUid);if(!A){for(;!A;){const ne=Math.floor(16777214*Math.random())+1;this._colorToUID.has(ne)||(A=ne)}if(A>16777215)throw new Error("Object ID Overflow");x.set(_.graphicUid,A),this._colorToUID.set(A,_)}const U=new ArrayBuffer(4);return new DataView(U).setUint32(0,A,!1),new of.mc(U)}getColorToObjectAndLayerIdMapping(){const _=new Map;for(const[T,x]of this._colorToUID.entries()){const A=this._layerUidToGraphicsUidToObjectId.get(x.layerUid);let U=null;A?(U=A.get(x.graphicUid),U||Us.Z.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+x.graphicUid)):Us.Z.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+x.layerUid);const ne=this._layerUidToId.get(x.layerUid);ne||Us.Z.getLogger(this.declaredClass).warn("no layerId found for uid "+x.layerUid),U&&ne&&_.set(T,U.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:U.objectId,lid:ne,attrId:U.attributeNodeId,attrIdx:U.attributeIndex,subLayerId:U.subLayerId}:{type:"object-and-layer-id",oid:U.objectId,lid:ne})}return _}}const JI=(0,mi.HA)(1e3),SG=(0,mi.HA)(1e3/30);var fy;!function(d){d[d.FrontToBack=0]="FrontToBack",d[d.BackToFront=1]="BackToFront"}(fy||(fy={}));class tp{constructor(_,T,x=fy.FrontToBack){this._rctx=_,this._techniqueRepository=T,this._sorting=x,this._draws=new wo.Z({initialSize:32,allocator:A=>A||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(_,T,x,A){const U=this._draws.pushNew();U.geometry=T,U.geometryRanges=x,U.material=_,U.depthSquaredHint=A,U.indexType=T.indexed?(0,Qe.Wg)(T.vao.indexBuffer).indexType:0}dispatch(_,T){const x=this._rctx;this._previouslyBoundDraw.clear();let A=null;const U=this._draws.map(fe=>fe.material.prepareTechnique(this._techniqueRepository,_,T,fe.geometry.parameters)),ne=this._draws.length;for(let fe=0;fe<ne;fe++){const Oe=U[fe];Oe===A&&Oe.configuration.transparencyPassType===Zc.A.NONE||(x.bindTechnique(Oe,_,T),A=Oe);const we=this._draws.data[fe],Ze=we.geometry;x.bindVAO(Ze.vao),this._previouslyBoundDraw.get(Oe)!==we.material&&(Oe.program.bindDraw(we.material,T,_),this._previouslyBoundDraw.set(Oe,we.material));const it=we.geometryRanges,lt=it.length;if(0!==we.indexType){const dt=nb.get(we.indexType);for(let Tt=0;Tt<lt;Tt+=2)x.drawElements(Ze.primitiveType,it[Tt+1],we.indexType,it[Tt]*dt)}else for(let dt=0;dt<lt;dt+=2)x.drawArrays(Ze.primitiveType,it[dt],it[dt+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const _=this._sorting===fy.FrontToBack?1:-1;this._draws.sort((T,x)=>{const A=_*(T.depthSquaredHint-x.depthSquaredHint);return 0!==A?A:T.geometry.vao.size-x.geometry.vao.size})}get count(){return this._draws.length}}const nb=new Map;nb.set(xt.g.UNSIGNED_BYTE,1),nb.set(xt.g.UNSIGNED_SHORT,2),nb.set(xt.g.UNSIGNED_INT,4);class AG{constructor(_,T){this.rctx=_,this.shaderTechniqueRepository=T,this.canRender=!0,this._materialPassParameters=new Un.SP,this._shadowPassParameters=new Un.kF,this._highlightPassParameters=new Un.T5,this._systems=new Set,this._passes={materialOpaque:new tp(_,T),materialTransparent:new tp(_,T,fy.BackToFront),materialIntegratedMesh:new tp(_,T),shadowMap:new tp(_,T),highlight:new tp(_,T),highlightIntegratedMesh:new tp(_,T),highlightShadowMap:new tp(_,T),defaultShadowMap:new tp(_,T)}}register(_){this._systems.add(_)}prepareRender(_){if(0!==this._systems.size){for(const T of Object.values(this._passes))T.prepareSubmit();this._systems.forEach(T=>T.submit(this._passes,_.bindParameters));for(const T of Object.values(this._passes))T.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(_){if(0!==this._systems.size)switch(this._configure(_),_.bindParameters.slot){case Mi.r.OPAQUE_MATERIAL:switch(_.output){case Xs.H.Color:return this._materialPassParameters.subPass=Un.zp.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Depth:return this._materialPassParameters.subPass=Un.zp.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Normal:return this._materialPassParameters.subPass=Un.zp.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,_.bindParameters);case Xs.H.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,_.bindParameters);case Xs.H.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,_.bindParameters);case Xs.H.ShadowExludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,_.bindParameters);case Xs.H.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Un.zp.ObjectAndLayerIdColor,this._passes.materialOpaque.dispatch(this._materialPassParameters,_.bindParameters)}return;case Mi.r.TRANSPARENT_MATERIAL:switch(_.output){case Xs.H.Color:return this._materialPassParameters.subPass=Un.zp.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Alpha:return this._materialPassParameters.subPass=Un.zp.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Depth:return this._materialPassParameters.subPass=Un.zp.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Normal:return this._materialPassParameters.subPass=Un.zp.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Un.zp.ObjectAndLayerIdColor,this._passes.materialTransparent.dispatch(this._materialPassParameters,_.bindParameters)}return;case Mi.r.INTEGRATED_MESH:switch(_.output){case Xs.H.Color:return this._materialPassParameters.subPass=Un.zp.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Depth:return this._materialPassParameters.subPass=Un.zp.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Normal:return this._materialPassParameters.subPass=Un.zp.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,_.bindParameters);case Xs.H.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,_.bindParameters);case Xs.H.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Un.zp.ObjectAndLayerIdColor,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,_.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Mi.r.OPAQUE_MATERIAL,Mi.r.TRANSPARENT_MATERIAL,Mi.r.INTEGRATED_MESH]}initializeRenderContext(_){this._context=_}uninitializeRenderContext(){}queryDepthRange(_){const T={near:1/0,far:-1/0};return this._systems.forEach(x=>{const A=x.queryShadowCasterDepthRange(_);(0,Qe.pC)(A)&&gf(T,A,T)}),T}_configure(_){this._updateParameters(_,_.output===Xs.H.Shadow||_.output===Xs.H.ShadowHighlight||_.output===Xs.H.ShadowExludeHighlight?this._shadowPassParameters:_.output===Xs.H.Highlight?this._highlightPassParameters:this._materialPassParameters)}_updateParameters(_,T){const x=_.bindParameters.camera,A=x.viewInverseTransposeMatrix;(0,pt.s)(YO,A[3],A[7],A[11]),XO.set(YO),(0,pt.c)(T.transformWorldFromViewTH,XO.high),(0,pt.c)(T.transformWorldFromViewTL,XO.low),(0,pt.c)(T.slicePlaneLocalOrigin,YO),(0,Co.f)(T.transformViewFromCameraRelativeRS,x.viewMatrix),(0,gi.c)(T.transformProjFromView,x.projectionMatrix),T.identifier===Un.o9.Material&&(this._materialPassParameters.transparent=_.bindParameters.slot===Mi.r.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=_.bindParameters.slot===Mi.r.INTEGRATED_MESH,(0,Co.t)(QI,T.transformViewFromCameraRelativeRS),(0,Co.e)(T.transformNormalViewFromGlobal,QI))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const YO=(0,ir.c)(),QI=(0,xd.c)(),XO=new kE;var Zd=v(42309),RG=v(98565),wG=v(17923);class ob extends so.A{initializeProgram(_){return new Gn.$(_.rctx,ob.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK})}}ob.shader=new ro.J(wG.H,()=>v.e(5265).then(v.bind(v,5265)));var qI=v(47482);class ab extends so.A{initializeProgram(_){return new Gn.$(_.rctx,ab.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:Ds.BK})}}ab.shader=new ro.J(qI.a,()=>v.e(2337).then(v.bind(v,52337)));var eL=v(36227);class lb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,lb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:Ds.BK})}}lb.shader=new ro.J(eL.a,()=>v.e(4496).then(v.bind(v,14496)));class tL extends lu.K{constructor(){super(...arguments),this.color=(0,Zh.f)(1,0,1,1),this.haloColor=(0,Zh.f)(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=(0,Tn.f)(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}class LG{constructor(_,T){this._techniqueRep=_,this._rctx=T,this._viewportToRestore=(0,Tn.c)(),this._passParameters=new tL,this._downsampleDrawParameters=new eL.H,this._blurDrawParameters=new qI.H,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=(0,_a.ow)(this._rctx);const _={colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE,width:0,height:0},T={target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Aa.X(this._rctx,_,T),this._blur1Fbo=new Aa.X(this._rctx,_,T),this._blurTechnique=this._techniqueRep.acquire(ab),this._downsampleTechnique=this._techniqueRep.acquire(lb),this._applyTechnique=this._techniqueRep.acquire(ob)}dispose(){if(this._blurTechnique=(0,Qe.RY)(this._blurTechnique),this._downsampleTechnique=(0,Qe.RY)(this._downsampleTechnique),this._applyTechnique=(0,Qe.RY)(this._applyTechnique),this._grid.coverageMipmap)for(let _=1;_<this._grid.coverageMipmap.length;_++)this._grid.coverageMipmap[_].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=(0,Qe.M2)(this._blur0Fbo),this._blur1Fbo=(0,Qe.M2)(this._blur1Fbo)}setDefaultOptions(_){this._passParameters={...new tL,..._}}render(_,T,x){this._passParameters.highlightColorTexture=T.colorTexture,this._assertResources();const A=_.camera;(0,Qo.c)(this._viewportToRestore,A.fullViewport);const ne=A.fullHeight,fe=A.pixelRatio,Oe=Math.ceil(A.fullWidth/fe),we=Math.ceil(ne/fe);this._blur0Fbo.resize(Oe,we),this._blur1Fbo.resize(Oe,we);const Ze=this._rctx;Ze.bindVAO(this._quadVAO);let it=null;this._gridUpdateResources(T,32),this._gridComputeMipmap(_),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,it=this._grid.vao;const lt=Ze.bindTechnique(this._blurTechnique,this._passParameters,_);Ze.bindVAO(it),Ze.bindFramebuffer(this._blur0Fbo),Ze.setViewport(0,0,Oe,we),Ze.setClearColor(0,0,0,0),Ze.clear(xt.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=T.colorTexture,(0,ti.s)(this._blurDrawParameters.blurSize,1/Oe,0),lt.bindDraw(this._blurDrawParameters,_,this._passParameters),Ze.drawArrays(this._blurTechnique.primitiveType,0,(0,No._V)(it,"geometry")),Ze.bindFramebuffer(this._blur1Fbo),Ze.clear(xt.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,(0,ti.s)(this._blurDrawParameters.blurSize,0,1/we),lt.bindDraw(this._blurDrawParameters,_,this._passParameters),Ze.drawArrays(this._blurTechnique.primitiveType,0,(0,No._V)(it,"geometry")),Ze.bindFramebuffer(x),Ze.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,Ze.bindTechnique(this._applyTechnique,this._passParameters,_),Ze.drawArrays(this._applyTechnique.primitiveType,0,(0,No._V)(it,"geometry")),Ze.bindVAO(null)}_gridUpdateResources(_,T){const x=this._rctx,A=this._grid;let U=!1;if(null===A.coverageMipmap&&(A.coverageMipmap=[_],U=!0),A.viewportWidth===_.width&&A.viewportHeight===_.height||(U=!0,A.viewportWidth=_.width,A.viewportHeight=_.height),A.coverageMipmap[0]=_,A.cellPixelSize!==T&&(A.cellPixelSize=T,U=!0),U){for(let Oe=1;Oe<A.coverageMipmap.length;Oe++)A.coverageMipmap[Oe].dispose();A.mipmapLevels=Math.ceil(Math.log(A.cellPixelSize)*Math.LOG2E),A.coverageMipmap.length=A.mipmapLevels+1;for(let Oe=0;Oe<A.mipmapLevels;Oe++){const we=A.coverageMipmap[Oe],Ze={target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGB,dataType:xt.Br.UNSIGNED_SHORT_5_6_5,samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:Math.ceil(we.width/2),height:Math.ceil(we.height/2)},it={colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE,width:Math.ceil(we.width/2),height:Math.ceil(we.height/2)};A.coverageMipmap[Oe+1]=new Aa.X(x,it,Ze)}}const ne=Math.ceil(_.height/A.cellPixelSize),fe=Math.ceil(_.width/A.cellPixelSize);if(!A.vao||A.verticalCellCount!==ne||A.horizontalCellCount!==fe){A.verticalCellCount=ne,A.horizontalCellCount=fe;const Oe=ne+1,we=fe+1,Ze=1/ne,it=1/fe,lt=6,dt=4,Tt=new Float32Array(lt*dt*Oe*we);let mt=0;for(let Mt=0;Mt<Oe;Mt++)for(let Pt=0;Pt<we;Pt++)Tt[mt+0]=(Pt-.5)*it*2-1,Tt[mt+1]=(Mt-.5)*Ze*2-1,Tt[mt+2]=Pt*it,Tt[mt+3]=Mt*Ze,Tt[mt+4]=(Pt+.5)*it*2-1,Tt[mt+5]=(Mt-.5)*Ze*2-1,Tt[mt+6]=Pt*it,Tt[mt+7]=Mt*Ze,Tt[mt+8]=(Pt-.5)*it*2-1,Tt[mt+9]=(Mt+.5)*Ze*2-1,Tt[mt+10]=Pt*it,Tt[mt+11]=Mt*Ze,Tt[mt+12]=(Pt-.5)*it*2-1,Tt[mt+13]=(Mt+.5)*Ze*2-1,Tt[mt+14]=Pt*it,Tt[mt+15]=Mt*Ze,Tt[mt+16]=(Pt+.5)*it*2-1,Tt[mt+17]=(Mt-.5)*Ze*2-1,Tt[mt+18]=Pt*it,Tt[mt+19]=Mt*Ze,Tt[mt+20]=(Pt+.5)*it*2-1,Tt[mt+21]=(Mt+.5)*Ze*2-1,Tt[mt+22]=Pt*it,Tt[mt+23]=Mt*Ze,mt+=lt*dt;A.vao&&A.vao.dispose(!0),A.vao=new Dh.U(x,io.i,{geometry:P_.Bn},{geometry:Ra.f.createVertex(x,xt.l1.STATIC_DRAW,Tt)})}}_gridComputeMipmap(_){const T=this._rctx,x=this._grid,A=T.bindTechnique(this._downsampleTechnique,this._passParameters,_);T.bindVAO(this._quadVAO);for(let U=0;U<x.mipmapLevels;U++){T.bindFramebuffer(x.coverageMipmap[U+1]);const ne=x.coverageMipmap[U+1].width,fe=x.coverageMipmap[U+1].height;this._downsampleDrawParameters.inputTexture=x.coverageMipmap[U].colorTexture,(0,ti.s)(this._downsampleDrawParameters.invFramebufferDim,1/ne,1/fe),A.bindDraw(this._downsampleDrawParameters,_,this._passParameters),T.setViewport(0,0,ne,fe),T.drawArrays(xt.MX.TRIANGLE_STRIP,0,(0,No._V)(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let _=((0,Qe.pC)(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+((0,Qe.pC)(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const T of this._grid.coverageMipmap)_+=T.gpuMemoryUsage;return _}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}var UG=v(49266);const BG={dataType:xt.Br.UNSIGNED_BYTE,internalFormat:xt.VI.RGBA},jG={};class FG{constructor(_){this._rctx=_,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=_.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(_=>_.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(_=>_.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(_=>_.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(_=>_.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(_){const T=_.id;this._activeTargets.has(T)&&(this._activeTargets.delete(T),this._disposeWithFramebuffers(this._depthTextures,T),this._disposeWithFramebuffers(this._depthBuffers,T),this._disposeWithFramebuffers(this._colorTextures,T))}_disposeWithFramebuffers(_,T){const x=_.get(T);x&&(this._framebuffers.forEach((A,U)=>{A.colorAttachment!==x&&A.depthStencilAttachment!==x||(A.detachAll(),A.dispose(),this._framebuffers.delete(U))}),x.dispose(),_.delete(T))}getDepthTexture(_,T){if(!this.depthTextureSupported)return null;let x=this._depthTextures.get(_.id);return!x||x.descriptor.width===T.width&&x.descriptor.height===T.height||(x.dispose(),x=(0,Qe.wN)()),x||(x=new Ro.x(this._rctx,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.DEPTH_STENCIL,dataType:xt.Br.UNSIGNED_INT_24_8,samplingMode:xt.cw.NEAREST,wrapMode:xt.e8.CLAMP_TO_EDGE,width:T.width,height:T.height}),this._depthTextures.set(_.id,x),this._activeTargets.add(_.id)),x}getAllocatedDepthTexture(_){return this._depthTextures.get(_.id)}getDepthBuffer(_,T){if(this.depthTextureSupported)return null;let x=this._depthBuffers.get(_.id);return x?x.descriptor.width===T.width&&x.descriptor.height===T.height||x.resize(T.width,T.height):(x=new UG.r(this._rctx,{internalFormat:xt.Tg.DEPTH_STENCIL,...T}),this._depthBuffers.set(_.id,x),this._activeTargets.add(_.id)),x}getColorTexture(_,T){let x=this._colorTextures.get(_.id);return x&&(x.descriptor.width===T.width&&x.descriptor.height===T.height||(x.dispose(),x=(0,Qe.wN)())),x||(x=new Ro.x(this._rctx,{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,internalFormat:_.internalFormat,dataType:_.dataType,samplingMode:null!=_.samplingMode?_.samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:T.width,height:T.height}),this._colorTextures.set(_.id,x),this._activeTargets.add(_.id)),x}getAllocatedColorTexture(_){return this._colorTextures.get(_.id)}registerDepthTarget(_={}){return{id:(0,dE.D)(),...jG,..._}}registerColorTarget(_={}){return{id:(0,dE.D)(),...BG,..._}}getFramebuffer(_,T,x){const A=this._getKey(T,x);let U=this._framebuffers.get(A);const ne=this.getColorTexture(T,_);if(this.depthTextureSupported){const Oe=x?this.getDepthTexture(x,_):void 0;return U?((U.width!==_.width||U.height!==_.height||U.colorTexture!==ne||U.depthStencilTexture!==Oe)&&(U.detachAll(),U.resize(_.width,_.height),U.attachColorTexture(ne),U.attachDepthStencilTexture(Oe)),U):(U=(0,Qe.pC)(x)?new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.DEPTH_STENCIL_TEXTURE},ne,Oe):new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},ne),this._framebuffers.set(A,U),U)}const fe=x?this.getDepthBuffer(x,_):void 0;return U?((U.width!==_.width||U.height!==_.height||U.colorTexture!==ne)&&(U.detachAll(),U.resize(_.width,_.height),U.attachColorTexture(ne),U.attachDepthStencilBuffer(fe)),U):(U=new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:x?xt.OU.DEPTH_STENCIL_RENDER_BUFFER:xt.OU.NONE},ne,fe),this._framebuffers.set(A,U),U)}_getKey(_,T){return`${_.id}_${T?T.id:"X"}_${_.name}${T?"_"+T.name:""}`}get gpuMemoryUsage(){let _=0;const T=new Set,x=A=>{T.has(A)||(T.add(A),_+=(0,No.un)(A))};return this._depthTextures.forEach(x),this._colorTextures.forEach(x),this._depthBuffers.forEach(x),_}}class NG{constructor(_,T){this._rctx=_,this._compositingHelper=T,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const x=_.type===cl.zO.WEBGL2;this._renderTargetHelper=new FG(_);const A=this._renderTargetHelper;this._mainColorTargets=[A.registerColorTarget({name:"mainColorTarget0"}),A.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=A.registerColorTarget({name:"frontFaceTarget"});const U=ne=>A.registerColorTarget({name:ne,dataType:xt.Br.FLOAT,internalFormat:x?xt.lP.RGBA32F:xt.VI.RGBA,samplingMode:xt.cw.NEAREST});this.colorFloatTarget=U("colorFloatTarget"),this.alphaFloatTarget=U("alphaFloatTarget"),this.mainDepth=A.registerDepthTarget({name:"mainDepth"}),this.linearDepth=A.registerColorTarget({name:"linearDepth",samplingMode:xt.cw.NEAREST}),this.terrainLinearDepth=A.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=A.registerColorTarget({name:"geometryLinearDepth"}),this.normal=A.registerColorTarget({name:"normal"}),this.highlight=A.registerColorTarget({name:"highlight",internalFormat:x?xt.lP.RGBA4:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=A.registerColorTarget({name:"hudVisibility",internalFormat:x?xt.lP.RGBA4:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=A.registerColorTarget({name:"tmpColor"}),this.tmpDepth=A.registerDepthTarget({name:"tmpDepth"}),this.hudColor=A.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(_){this._background=_}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(_,T){return this._renderTargetHelper.getFramebuffer(this._dimensions,_,T)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(_){_||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=0===this._mainColorTarget&&_?1:0}initializeFrame(_){const T=this._rctx;this._dimensions.width=_.fullWidth,this._dimensions.height=_.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),T.setClearStencil(0);const x=this._background.color;T.setClearColor(x[0]*x[3],x[1]*x[3],x[2]*x[3],x[3]),T.clearSafe(xt.lk.COLOR_BUFFER_BIT|xt.lk.DEPTH_BUFFER_BIT|xt.lk.STENCIL_BUFFER_BIT)}composite(_){(0,Qe.pC)(this.colorTexture)&&this._compositingHelper.composite(_,this.colorTexture,Ya.None)}renderTmpAndCompositeToMain(_,T,x,A=!1){this.renderToTargets(_,this.tmpColor,A?this.tmpDepth:this.mainDepth,WG),this._compositingHelper.composite(T,this._getColorTexture(this.tmpColor),x)}renderHUDVisibility(_,T=!1){this.renderToTargets(_,this.hudVisibility,T?this.tmpDepth:this.mainDepth,VG)}compositeTransparentTerrainOntoHUDVisibility(_){this.renderToTargets(()=>this._compositingHelper.compositeHUD(_,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(_,T,x){let A,U;switch(T){case Zc.A.Color:A=this.colorFloatTarget,U=[0,0,0,0];break;case Zc.A.Alpha:A=this.alphaFloatTarget,U=[1,1,1,1];break;case Zc.A.FrontFace:A=this.frontFaceTarget,U=[0,0,0,0]}x?this.renderToTargets(_,A,this.tmpDepth,U,!0,!0):this.renderToTargets(_,A,this.mainDepth,U,!1)}compositeTransparentTerrainOntoMain(_){this.bindFramebuffer(),this._compositingHelper.composite(_,this._getColorTexture(this.tmpColor),Ya.PremultipliedAlpha)}compositeOccludedOntoMain(_,T){this.bindFramebuffer(),this._compositingHelper.composite(_,this._getColorTexture(this.tmpColor),Ya.PremultipliedAlpha,T)}compositeTransparentOntoOpaque(_,T){T?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(xt.lk.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(_,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(_){this.bindTarget(this.currentColorTarget),_(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(_){this._renderTargetHelper.disposeTargetResource(_)}renderToFBO(_,T,x=!1,A=!1){const U=this._rctx;let ne=0;if(T){const Oe=Math.max(1e-13,T[3]);U.setClearColor(T[0],T[1],T[2],Oe),ne|=xt.lk.COLOR_BUFFER_BIT}x&&(ne|=xt.lk.DEPTH_BUFFER_BIT),!1===A?A=0:(!0===A&&(A=255),ne|=xt.lk.STENCIL_BUFFER_BIT),ne&&U.clearSafe(ne,A),_(),U.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(_,T,x,A,U=!1,ne=!1){const fe=this.bindTarget(T,x);return this.renderToFBO(_,A,U,ne),fe}bindTarget(_,T){const x=this._renderTargetHelper.getFramebuffer(this._dimensions,_,T);return this._rctx.bindFramebuffer(x),x}_getColorTexture(_){return this._renderTargetHelper.getColorTexture(_,this._dimensions)}get gpuMemoryUsage(){let _=0;return this._renderTargetHelper&&(_+=this._renderTargetHelper.gpuMemoryUsage),_}}const WG=[0,0,0,0],VG=[0,1,0,1];var zG=v(64624),HG=v(83196);class GG{constructor(_){this._context=_,this._renderPlugins=new wo.Z,this._slots=[];for(let T=0;T<Mi.r.MAX_SLOTS;++T)this._slots[T]=[]}add(_,T,x){const A=()=>{if(x?.aborted)throw T.uninitializeRenderContext(),(0,ws.zE)();this._renderPlugins.push(T);for(const ne of _)this._slots[ne].push(T);this._context.requestRender()},U=T.initializeRenderContext(this._context,x);if((0,ws.y8)(U))return U.then(A);A()}remove(_){if(null!=this._renderPlugins.removeUnordered(_)){for(let T=0;T<this._slots.length;++T)this._slots[T]=this._slots[T].filter(x=>x!==_);_.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(_=>{_.prepareRender&&_.prepareRender(this._context.renderContext)})}updateAnimation(_){let T=!1;return this._renderPlugins.forAll(x=>{x.updateAnimation&&(T=x.updateAnimation(_)||T)}),T}render(){const _=this._slots[this._context.renderContext.bindParameters.slot],T=new Array;_.filter(x=>{if(!x.canRender)return!1;if(function KG(d){return"prepareTechnique"in d}(x)){const A=x.prepareTechnique(this._context.renderContext);return!!A&&(T.push(A),!0)}return T.push(null),!0}).forEach((x,A)=>x.render(this._context.renderContext,T[A]))}queryDepthRange(_){const T=ZG;return T.near=1/0,T.far=-1/0,this._renderPlugins.forAll(x=>{if(x.queryDepthRange){const A=x.queryDepthRange(_);A&&gf(T,A,T)}}),T}get needsTransparentPass(){return this._renderPlugins.some(_=>_.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(_=>_.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(_=>_.needsLinearDepth)}get needsLaserlineWithContrastControl(){const _=this._slots[Mi.r.LASERLINES_CONTRAST_CONTROL];return!!_&&_.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((_,T)=>_|T.renderOccludedFlags,0)}}const ZG={near:0,far:0};var $G=v(82148);class cb extends so.A{constructor(_,T){super(_,T,()=>this.destroy())}initializeProgram(_){return new Gn.$(_.rctx,cb.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:yf.wu,colorWrite:Ds.BK,depthTest:null,depthWrite:null})}get primitiveType(){return xt.MX.TRIANGLE_STRIP}}cb.shader=new ro.J($G.S,()=>v.e(5915).then(v.bind(v,45915)));var rL=v(69828);const YG=(0,Tn.f)(.01,0,.25,1),sL=1/512;let ub=class extends Ns.Z{constructor(d,_,T,x){super({}),this._techniqueRepository=d,this._rctx=_,this._shadowAccumulator=T,this._requestRender=x,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:YG,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new rL.l,this._enabled=!1,this._vao=(0,_a.ow)(_),this._techniqueConfig.visualization=rL.w.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=(0,Qe.M2)(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(cb,this._techniqueConfig,this._technique),this._technique}render(d){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const _=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(_,this._passParameters,d),this._rctx.drawArrays(_.primitiveType,0,(0,No._V)(this._vao,"geometry"))}setOptions(d){void 0!==d.enabled&&this._setEnabled(d.enabled),void 0!==d.color&&this._setColor(d.color),void 0!==d.threshold&&(this._threshold=d.threshold),void 0!==d.visualization&&(this._visualization=d.visualization),void 0!==d.bandSize&&(this._bandSize=d.bandSize),void 0!==d.bandsEnabled&&(this._bandsEnabled=d.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(d){this._passParameters.opacityFromElevation!==d&&(this._passParameters.opacityFromElevation=d,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>sL}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(d){this._threshold!==d&&(this._passParameters.threshold=d,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(d){d!==this._visualization&&(this._techniqueConfig.visualization=d,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(d){d!==this._bandSize&&(this._passParameters.bandSize=d,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(d){d!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=d,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(d){(0,Qo.g)(d,this._passParameters.color)||((0,Qo.c)(this._passParameters.color,d),this._requestRenderIfRunning())}_setEnabled(d){d!==this._enabled&&(d?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};(0,Ve._)([(0,ke.Cb)()],ub.prototype,"opacityFromElevation",null),ub=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],ub);var my,db=v(53319),kO=v(94195);class hb extends pi.m{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}}(0,Ve._)([(0,pi.o)()],hb.prototype,"receiveShadows",void 0),(0,Ve._)([(0,pi.o)()],hb.prototype,"hasWebGL2Context",void 0);class pb extends so.A{constructor(_){super(_,new hb,()=>this.destroy())}initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2}initializeProgram(_){return new Gn.$(_.rctx,pb.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ONE,xt.zi.ONE,xt.zi.ONE),colorWrite:Ds.BK,depthTest:null,depthWrite:null})}get primitiveType(){return xt.MX.TRIANGLE_STRIP}}pb.shader=new ro.J(kO.a,()=>v.e(8897).then(v.bind(v,58897)));let Xa=my=class extends Ns.Z{constructor(d,_,T,x,A,U){super({}),this._rctx=d,this._stage=T,this._prepareForShadowMapPass=x,this._renderToShadowMap=A,this._requestRender=U,this._progress=0,this._sampleCount=0,this._passParameters=new kO.S,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=BO,this._previewingCached=!1,this._handles=new Ji.Z,this._cameraForcedForScreenshot=!1,this._bindParameters=new hP.p(new db.l(d,T.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new $i.V,this._vao=(0,_a.ow)(d),this._fbo=new Aa.X(d,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE,width:0,height:0},{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:0,height:0}),this._accumulationRenderer=new ub(_,d,this,U),this._handles.add(this._stage.resourceController.scheduler.registerTask(Fn.T8.SHADOW_ACCUMULATOR,this)),this._handles.add((0,Ht.YP)(()=>T.renderView,we=>{this._handles.remove(my.renderViewHandleKey),(0,Qe.Wi)(we)||this._handles.add(we.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),my.renderViewHandleKey)},Ht.tX))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){return(0,Qe.Wi)(this._accumulationTechniqueCached)&&(this._accumulationTechniqueCached=new pb({rctx:this._rctx,viewingMode:this._stage.viewingMode})),this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewingCached}get _isPreviewing(){return this._isActive&&this._previewingCached}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==BO&&this._opacityFromElevation>sL}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirectionsInternal(){return this._cachedLightDirections}set _lightDirectionsInternal(d){const _=this._cachedLightDirections;if((0,pd.fS)(_,d,pt.F))return;const T=d.length;_.length=T,this._sampleCount=Math.min(kO.s,T);for(let x=0;x<T;++x){const A=d[x],U=_[x]||(0,ir.c)();(0,pt.c)(U,A),_[x]=U}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(d){this._accumulationRenderer.opacityFromElevation=d}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(d){for(this._prepareForShadowMapPass(this._bindParameters);!d.done&&!this._isDoneAccumulating;)this._accumulateShadow(),d.madeProgress();this._requestRender()}renderAccumulation(d,_,T,x){if(this._passParameters.linearDepthTexture=d,this._depthRange=_,this._updateCamera(T),this._bindParameters.contentCamera=x,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewingCached||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const A=this._cameraForcedForScreenshot?this._sampleCount:Math.min(my.previewSamples,this._sampleCount-this._progress);for(let U=0;U<A;++U)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(d){this._accumulationRenderer.render(d)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=(0,Qe.M2)(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=(0,Qe.M2)(this._fbo),this._vao=(0,Qe.M2)(this._vao),this._accumulationTechniqueCached=(0,Qe.RY)(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(d){void 0!==d.enabled&&(this._enabled=d.enabled),void 0!==d.previewing&&(this._previewing=d.previewing),void 0!==d.lightDirections&&(this._lightDirections=d.lightDirections),this._accumulationRenderer.setOptions(d)}set _previewing(d){this._previewingCached!==d&&(this._previewingCached=d,this._requestRenderIfEnabled())}set _lightDirections(d){this._lightDirectionsInternal=d}readAccumulatedShadow(d,_){if(!this._isActive||this._progress<1||d<0||d>this._fbo.width||_<0||_>this._fbo.height)return 0;const T=JG;return this._fbo.readPixels(d,_,1,1,xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,T),T[0]/this._progress}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(xt.lk.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirectionsInternal[this._progress],this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const _=this._accumulationTechnique;this._rctx.bindTechnique(_,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(_.primitiveType,0,(0,No._V)(this._vao,"geometry")),this._progress++}_updateCamera(d){d.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(d),this._fbo.resize(d.fullWidth,d.fullHeight),this._opacityFromElevation=1-(0,xr.CW)(4e4,5e4,d.relativeElevation))}set _enabled(d){d!==this._enabledInternal&&(d?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const d=this;return{lightDirections:this._lightDirectionsInternal,get isDone(){return d._isDoneAccumulating},get isActive(){return d._isActive}}}};Xa.previewSamples=6,Xa.renderViewHandleKey="renderView",(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_progress",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_sampleCount",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_enabledInternal",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_depthRange",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_previewingCached",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_accumulationRenderer",void 0),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_isRefining",null),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_isActive",null),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"canAccumulate",null),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_isDoneAccumulating",null),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"_opacityFromElevation",null),(0,Ve._)([(0,ke.Cb)()],Xa.prototype,"running",null),Xa=my=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Xa);const JG=new Uint8Array(4);var QG=v(72968),qG=v(19263);class eK extends lu.K{constructor(){super(...arguments),this.shadowColor=(0,Tn.f)(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class _b extends so.A{constructor(_){super(_,new hb,()=>this.destroy())}initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2}initializeProgram(_){return new Gn.$(_.rctx,_b.shader.get().build(this.configuration),io.i)}initializePipeline(){return(0,Ds.sm)({blending:(0,Ds.wK)(xt.zi.SRC_ALPHA,xt.zi.ONE,xt.zi.ONE_MINUS_SRC_ALPHA,xt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:Ds.BK,depthTest:null,depthWrite:null})}get primitiveType(){return xt.MX.TRIANGLE_STRIP}}_b.shader=new ro.J(qG.S,()=>v.e(5147).then(v.bind(v,95147)));class iK{constructor(_,T){this._rctx=_,this._viewingMode=T,this._maxOpacity=1,this._passParameters=new eK,this._drawParameters=new QG.ry,this._vao=(0,_a.ow)(this._rctx)}get _technique(){return(0,Qe.Wi)(this._techniqueCached)&&(this._techniqueCached=new _b({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(_,T){if(!_.shadowMap.enabled||!_.linearDepthTexture||!this.isVisible)return;const x=this._technique;this._drawParameters.origin=_.camera.center,this._rctx.bindFramebuffer(T),this._rctx.bindTechnique(x,this._passParameters,_).bindDraw(this._drawParameters,_,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(x.primitiveType,0,(0,No._V)(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.size??0}setDefaultOptions(_){this._passParameters={...this._passParameters,..._},this._updateMaxOpacity()}updateParameters(_,T){this._passParameters.opacityElevation=1-(0,xr.CW)(4e4,5e4,_.relativeElevation);const x=this._viewingMode===vi.JY.Global?(0,pt.n)(iL,_.center):(0,pt.s)(iL,0,0,1),A=(0,pt.e)(x,T);this._passParameters.dayNightTerminator=(0,xr.CW)(0,1,(0,xr.uZ)(30*A,0,1))}dispose(){this._vao=(0,Qe.M2)(this._vao),this._techniqueCached=(0,Qe.RY)(this._techniqueCached)}get isVisible(){const{opacityElevation:_,dayNightTerminator:T}=this._passParameters;return this._maxOpacity*_*T>=.001953125}_updateMaxOpacity(){const _=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=_*this._passParameters.shadowColor[3]}}const iL=(0,ir.c)(),nL=(0,nu.a)();class nK{constructor(){this._plane=(0,nu.a)()}get isEnabled(){return!(0,nu.d)(this.plane,nL)}get plane(){return this._plane}set plane(_){(0,nu.c)(_||nL,this._plane)}}var oK=v(64949);class fb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,fb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:Ds.BK})}}fb.shader=new ro.J(oK.B,()=>v.e(4165).then(v.bind(v,85645)));var aK=v(39274);class mb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,mb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:Ds.BK})}}mb.shader=new ro.J(aK.B,()=>v.e(5068).then(v.bind(v,5068)));var lK=v(82488);class gb extends so.A{initializeProgram(_){return new Gn.$(_.rctx,gb.shader.get().build(),io.i)}initializePipeline(){return(0,Ds.sm)({colorWrite:Ds.BK})}}gb.shader=new ro.J(lK.E,()=>v.e(5425).then(v.bind(v,75425)));var cK=v(67093);let gy=class extends Ns.Z{constructor(d,_){super({}),this._rctx=d,this._techniqueRep=_,this._passParameters=new cK.PR,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=(0,Qe.IM)(this._abortController),this.disable()}_loadResources(d){if((0,Qe.pC)(this._abortController))return!1;if((0,Qe.pC)(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const _=this._abortController.signal;return v.e(3129).then(v.bind(v,63129)).then(T=>this._loadTextures(T,_)).then(()=>d()).finally(()=>this._abortController=null),!1}_loadTextures(d,_){return(0,ws.k_)(_),Promise.all([this._loadTextureFromBase64(d.areaTexture,xt.cw.LINEAR,xt.VI.RGB),this._loadTextureFromBase64(d.searchTexure,xt.cw.NEAREST,xt.VI.LUMINANCE)]).then(([T,x])=>{(0,ws.Hc)(_)?(T.dispose(),x.dispose(),(0,ws.k_)(_)):(this._passParameters.areaTexture=T,this._passParameters.searchTexture=x)})}get updating(){return(0,Qe.pC)(this._abortController)}enable(d){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const _=new pi.m;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(gb,_,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(fb,_,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(mb,_,this._blurTechnique)}return!!this._loadResources(d)&&(this._vao=(0,_a.E9)(this._rctx),this._passParameters.edges=new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGB,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Aa.X(this._rctx,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.LINEAR,wrapMode:xt.e8.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=(0,Qe.M2)(this._vao),this._passParameters.areaTexture=(0,Qe.M2)(this._passParameters.areaTexture),this._passParameters.searchTexture=(0,Qe.M2)(this._passParameters.searchTexture),this._passParameters.blend=(0,Qe.M2)(this._passParameters.blend),this._passParameters.edges=(0,Qe.M2)(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(d){const _=this._validPassParameters;if((0,Qe.Wi)(_))return;_.colorTexture=d;const T=this._rctx,x=T.getBoundFramebufferObject(),A=d.descriptor.width,U=d.descriptor.height;T.bindVAO(this._vao),T.setViewport(0,0,A,U),_.edges.resize(A,U),T.bindFramebuffer(_.edges),T.setClearColor(0,0,0,1),T.clear(xt.lk.COLOR_BUFFER_BIT),T.bindTechnique(this._edgeDetectTechnique,_,null),T.drawArrays(xt.MX.TRIANGLES,0,3),_.blend.resize(A,U),T.bindFramebuffer(_.blend),T.setClearColor(0,0,1,1),T.clear(xt.lk.COLOR_BUFFER_BIT),T.bindTechnique(this._blendWeightsTechnique,_,null),T.drawArrays(xt.MX.TRIANGLES,0,3),T.bindFramebuffer(x),T.setClearColor(0,1,0,1),T.clear(xt.lk.COLOR_BUFFER_BIT),T.bindTechnique(this._blurTechnique,_,null),T.drawArrays(xt.MX.TRIANGLES,0,3)}_loadTextureFromBase64(d,_,T){return(0,C0.t)(d).then(x=>new Ro.x(this._rctx,{pixelFormat:T,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.CLAMP_TO_EDGE,width:x.width,height:x.height,samplingMode:_},x))}};(0,Ve._)([(0,ke.Cb)()],gy.prototype,"_abortController",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],gy.prototype,"updating",null),gy=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],gy);var uK=v(95808);class pK{constructor(_){this._factory=_,this._originData=new Map}acquire(_){return this.register(this._factory.getOrigin(_))}register(_){const T=this._originData.get(_.id)||new _K(_);return T.refCount++,this._originData.has(T.origin.id)||this._originData.set(T.origin.id,T),T}release(_){_.refCount--,0===_.refCount&&this._originData.delete(_.origin.id)}updateViewMatrices(_){this._originData.forEach(T=>{(0,gi.c)(T.viewMatrix,_),function hK(d,_){const T=d[0],x=d[1],A=d[2];_[12]+=T*_[0]+x*_[4]+A*_[8],_[13]+=T*_[1]+x*_[5]+A*_[9],_[14]+=T*_[2]+x*_[6]+A*_[10],_[14]+=T*_[3]+x*_[7]+A*_[11]}(T.origin.vec3,T.viewMatrix)})}}class _K{constructor(_){this.origin=_,this.refCount=0,this.viewMatrix=(0,gn.c)()}}var fK=v(96867),oL=v(89917),aL=v(25558),lL=v(51040);class mK extends lL.su{constructor(_,T){super(),this.distanceFalloffFactor=_,this.transparency=T,this.transformNormalViewFromGlobal=(0,xd.c)()}}class gK extends lL.OU{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,xd.c)(),this.slicePlaneLocalOrigin=(0,ir.c)(),this.transformNormalGlobalFromModel=(0,xd.c)()}}var yK=v(71964);class yb extends so.A{initializeConfiguration(_,T){T.hasWebGL2Context=_.rctx.type===cl.zO.WEBGL2}initializeProgram(_){return new Gn.$(_.rctx,yb.shader.get().build(this.configuration),Kd.so)}initializePipeline(_){return(0,Ds.sm)(_.blendMinMax?{blending:(0,Ds.wK)(xt.zi.ONE,xt.zi.ONE,xt.zi.ZERO,xt.zi.ONE,xt.db.ADD,_.blendMinMax.MAX),depthTest:{func:xt.wb.LEQUAL},colorWrite:Ds.BK}:{depthTest:{func:xt.wb.LEQUAL},depthWrite:Ds.LZ,colorWrite:Ds.BK})}}yb.shader=new ro.J(yK.E,()=>v.e(6625).then(v.bind(v,76625)));var yy=v(73105);class Xu extends yI.W{constructor(){super(...arguments),this.mode=yy.Jb.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}(0,Ve._)([(0,pi.o)({count:yy.Jb.COUNT})],Xu.prototype,"mode",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"hasSlicePlane",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"silhouette",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"legacy",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"antialiasing",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"hasMultipassTerrain",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"cullAboveGround",void 0),(0,Ve._)([(0,pi.o)()],Xu.prototype,"spherical",void 0);var zi=v(17803);const EK={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},bK={solid:yy.Jb.SOLID,sketch:yy.Jb.SKETCH,uber:yy.Jb.MIXED};class vy{constructor(_,T,x){this._rctx=_,this._shaderTechniqueRepository=T,this._configuration=new Xu,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[zi.i.TRANSPARENT]:{[zi.i.TRANSPARENT]:new wo.Z,[zi.i.OPAQUE]:new wo.Z},[zi.i.OPAQUE]:{[zi.i.TRANSPARENT]:new wo.Z,[zi.i.OPAQUE]:new wo.Z}},this._renderablesDirty=!1,this._drawParameters=new gK,this._settings={...EK,...x},this.key=vy.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy),this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:Fo.Z.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=bK[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=(0,LI.I)(_),this._configuration.spherical=x.spherical}dispose(){this._technique=(0,Qe.RY)(this._technique)}addRenderable(_){this._renderables.add(_),this._renderablesDirty=!0}removeRenderable(_){this._renderables.delete(_),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(_,T){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[T][zi.i.TRANSPARENT].forAll(_),this._sortedRenderables[T][zi.i.OPAQUE].forAll(_)}updateTechnique(_,T){return this._configuration.hasMultipassTerrain=!!_.multipassTerrain.enabled,this._configuration.cullAboveGround=!!_.multipassTerrain.cullAboveGround,this._configuration.silhouette=T,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(yb,this._configuration,this._technique),this._technique}bindRegularEdges(_,T){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(T,!1),_,T)}bindSilhouetteEdges(_,T){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(T,!0),_,T)}renderRegularEdges(_,T,x,A,U){this._render(_,T,T.regular.vao,x,A,U)}renderSilhouetteEdges(_,T,x,A,U){this._render(_,T,T.silhouette.vao,x,A,U)}_render(_,T,x,A,U,ne){ne>0&&(this._bindDraw(_,T,A,U),this._rctx.bindVAO(x),this._rctx.capabilities.instancing.drawArraysInstanced(xt.MX.TRIANGLE_FAN,0,4,ne))}_bindDraw(_,T,x,A){if(this._drawParameters.componentDataTexture=T.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in T.transform)this._lastOriginId!==T.transform.origin.origin.id&&(_.setUniformMatrix4fv("localView",T.transform.origin.viewMatrix),this._lastOriginId=T.transform.origin.origin.id),_.setUniformMatrix4fv("model",T.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=T.transform.origin.origin.vec3;else{const U=new kE(T.transform.position),ne=(0,Co.t)(cL,(0,Co.e)(cL,T.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=U.low,this._drawParameters.transformWorldFromModelTH=U.high,this._drawParameters.transformWorldFromModelRS=T.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=ne;const fe=A.camera.viewInverseTransposeMatrix;(0,pt.s)(this._drawParameters.slicePlaneLocalOrigin,fe[3],fe[7],fe[11])}_.bindDraw(this._drawParameters,A,x)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[zi.i.TRANSPARENT][zi.i.TRANSPARENT].clear(),this._sortedRenderables[zi.i.TRANSPARENT][zi.i.OPAQUE].clear(),this._sortedRenderables[zi.i.OPAQUE][zi.i.TRANSPARENT].clear(),this._sortedRenderables[zi.i.OPAQUE][zi.i.OPAQUE].clear(),this._renderables.forEach(T=>{T.objectTransparency!==zi.i.INVISIBLE&&T.edgeTransparency!==zi.i.INVISIBLE&&this._sortedRenderables[T.objectTransparency][T.edgeTransparency].push(T)});const _=(T,x)=>"origin"in T.transform?"origin"in x.transform?T.transform.origin.origin.id<x.transform.origin.origin.id?-1:T.transform.origin.origin.id>x.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[zi.i.TRANSPARENT][zi.i.TRANSPARENT].sort(_),this._sortedRenderables[zi.i.TRANSPARENT][zi.i.OPAQUE].sort(_),this._sortedRenderables[zi.i.OPAQUE][zi.i.TRANSPARENT].sort(_),this._sortedRenderables[zi.i.OPAQUE][zi.i.OPAQUE].sort(_)}static getKey(_,T,x){return`edges-t:${_}:${T}:${x}`}}const cL=(0,cf.c)();var T0,CK=v(14171);function vb(d,_){if(!d)return null;const T=d.length/2,x=MK*T,A=new Array(T);let U=0;const ne=_===T0.PRESSURE;for(let fe=0;fe<d.length;fe+=2){const Oe=(d[fe]+d[fe+1])/2;A[U++]=ne?Math.min(x,1-(1-Oe)*uL):Math.min(x,Oe*uL)}return A}!function(d){d[d.DISTANCE=0]="DISTANCE",d[d.PRESSURE=1]="PRESSURE"}(T0||(T0={}));const MK=.1,uL=.5;class PK{constructor(_,T,x,A,U){this.resolution=_,this.normalizationScale=T,this.amplitude=x,this.variants=A,this.texture=U}dispose(){this.texture=(0,Qe.M2)(this.texture)}}const $d_amplitude=8,$d_resolution=256,$d_strokes=[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}];function dL(d){let _=null;for(const T of d){const x=T.type;if(OK(T))if((0,Qe.Wi)(_))_=x;else if(_!==x)return"uber"}return(0,Qe.pC)(_)?_:"uber"}function hL(d){let _=zi.i.INVISIBLE;for(const{material:T}of d)if(_L(T)){if(T.color[3]*T.opacity<1)return zi.i.TRANSPARENT;_=zi.i.OPAQUE}return _}function pL(d){let _=zi.i.INVISIBLE;for(const{material:T}of d)if(_L(T)){switch(T.objectTransparency){case zi.i.TRANSPARENT:case zi.i.INVISIBLE:return zi.i.TRANSPARENT;case zi.i.OPAQUE:if(T.opacity<1)return zi.i.TRANSPARENT}_=zi.i.OPAQUE}return _}function _L(d){return d.size*d.color[3]*d.opacity>0}function OK(d){return d.size*d.color[3]>0}function fL(d,_,T,x){for(let A=0;A<d.length;A++){const U=d[A].index,ne=_[A],fe=_[A+1];if(x)for(let Oe=ne;Oe<fe;Oe++)T.set(x[Oe],U);else for(let Oe=ne;Oe<fe;Oe++)T.set(Oe,U)}}let yu=class extends Ns.Z{constructor(d){super(d),this._updatingHandles=new l_.t,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=(0,ir.c)(),this._localOrigins=new pK(new CI.C(d.renderSR))}initialize(){this._worker=new CK.D(this.schedule),this._componentColorManager=new WI(this.rctx,3);const d=Kd.rD.createBuffer(4);for(let _=0;_<4;_++)d.sideness.set(_,0,0===_||3===_?0:1),d.sideness.set(_,1,0===_||1===_?0:1);this._verticesBufferObject=Ra.f.createVertex(this.rctx,xt.l1.STATIC_DRAW,d.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(d=>this._discardObjectEntry(d)),this._perObjectData.clear(),this._strokesTexture=(0,Qe.M2)(this._strokesTexture),this._componentColorManager=(0,Qe.SC)(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=(0,Qe.M2)(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}addComponentObject(d,_,T,x,A,U,ne,fe){var Oe=this;return(0,kr.Z)(function*(){if(Oe.hasObject(d))return Oe.getObjectMemoryUsage(d);let we;const Ze=new mL(new Promise(lt=>we=lt),T.center,T.radius);Oe._perObjectData.set(d,Ze);const it=yield Oe._updatingHandles.addPromise(Oe._addComponentGeometry(_,Ze,x,A,U,ne,fe));return Oe.setNeedsRender(),we(),it})()}addOrUpdateObject3D(d,_,T,x){var A=this;return(0,kr.Z)(function*(){if(A.destroyed)return void Us.Z.getLogger(A.declaredClass).warn("Attempt to add an object to a destroyed instance");const U=A._perObjectData.get(d);let ne;U?.renderables.length>0&&A._perObjectDataEvictionCache.add(U);const fe=d.boundingVolumeWorldSpace.bounds,Oe=new mL(new Promise(Ze=>ne=Ze),(0,oo.g)(fe),(0,oo.a)(fe));A._perObjectData.set(d,Oe);const we=new Array;if(T.mergeGeometries&&d.geometries.length>1&&function DK(d){let _=null,T=null;for(let x=0;x<d.geometries.length;x++){const A=d.geometryRecords[x];if(A.material.supportsEdges){if(_){if(!(0,pd.fS)(_,A.transformation))return!1}else _=A.transformation;if(!T&&(0,Qe.pC)(A.origin))T=A;else if((0,Qe.pC)(T?.origin)&&(0,Qe.pC)(A.origin)&&T.origin.id!==A.origin.id)return!1}}return!0}(d))we.push(A._addObjectMergedGeometries(d,Oe,_,T,x));else for(let Ze=0;Ze<d.geometries.length;Ze++){const it=d.geometryRecords[Ze];it.material.supportsEdges&&we.push(A._addGeometry(d,Oe,d.geometries[Ze],it,_[0],T,x))}yield A._updatingHandles.addPromise(Promise.all(we)),A._perObjectDataEvictionCache.delete(Oe),A._discardObjectEntry(U),A.setNeedsRender(),ne()})()}_discardObjectEntry(d){d&&(d.renderables.length&&(d.renderables.forEach(_=>this._removeRenderable(_)),this.setNeedsRender()),d.loaded=null)}hasObject(d){return this._perObjectData.has(d)}updateAllComponentOpacities(d,_){var T=this;return(0,kr.Z)(function*(){const x=yield T._updatingHandles.addPromise(T._getObjectEntry(d));if((0,Qe.Wi)(x))return;const A=_ instanceof Array?U=>_[U]:()=>_;x.renderables.forEach(U=>{const ne=U.components.meta.length;for(let fe=0;fe<ne;fe++){const Oe=A(fe),we=U.components.meta[fe],Ze=we.index;we.material.opacity=Oe,U.components.buffer.textureBuffer.setDataElement(Ze,1,3,255*Oe)}T._updateTransparency(U)}),T.setNeedsRender()})()}getObjectMemoryUsage(d){var _=this;return(0,kr.Z)(function*(){const T=yield _._getObjectEntry(d);return(0,Qe.pC)(T)?T.renderables.reduce((x,A)=>x+A.statistics.gpuMemoryUsage,0):0})()}updateAllComponentMaterials(d,_,T,x){var A=this;return(0,kr.Z)(function*(){const U=d instanceof fK.T,ne=!!T.hasSlicePlane,fe=dL(_),Oe=vy.getKey(fe,ne,U),we=yield A._updatingHandles.addPromise(A._getObjectEntry(d));(0,Qe.Wi)(we)||(we.renderables.forEach(Ze=>{if(Oe!==Ze.rendererKey){const it=A._renderers.get(Ze.rendererKey),lt=A._acquireRenderer(fe,ne,U);it.removeRenderable(Ze),--it.refCount,Ze.rendererKey=Oe,lt.addRenderable(Ze)}for(let it=0;it<_.length;it++)Ze.components.meta[it].material=_[it];x&&A._updateComponentBuffer(Ze.components),A._updateTransparency(Ze)}),A.setNeedsRender())})()}updateAllVerticalOffsets(d,_){var T=this;return(0,kr.Z)(function*(){const x=yield T._updatingHandles.addPromise(T._getObjectEntry(d));(0,Qe.Wi)(x)||(x.renderables.forEach(A=>{const U=A.components.meta;for(let ne=0;ne<U.length;ne++)A.components.meta[ne].verticalOffset=_?.[ne]??0;T._updateComponentBuffer(A.components)}),T.setNeedsRender())})()}updateObjectVisibility(d,_){var T=this;return(0,kr.Z)(function*(){const x=yield T._updatingHandles.addPromise(T._getObjectEntry(d));(0,Qe.pC)(x)&&(x.renderables.forEach(A=>A.visible=_),T.setNeedsRender())})()}removeObject(d){const _=this._perObjectData.get(d);_&&(this._perObjectData.delete(d),this._discardObjectEntry(_))}_getObjectEntry(d){var _=this;return(0,kr.Z)(function*(){const T=_._perObjectData.get(d);if(!T)throw"no object";return yield T.loaded,null==T.loaded?null:T})()}render(d,_){if((0,Qe.Wi)(this._componentColorManager))return;this._localOrigins.updateViewMatrices(d.camera.viewMatrix);const T=d.camera.viewInverseTransposeMatrix,x=(0,ir.c)(),A=new kE;let U=0,ne=0;if(this._renderers.forEach(Oe=>{if(0===Oe.refCount)this._renderers.delete(Oe.key),Oe.dispose();else{let we=!0,Ze=!0;Oe.forEachRenderable(it=>{it.visible&&(U+=it.statistics.averageEdgeLength,ne++,we&&it.regular&&(Oe.updateTechnique(d,!1),we=!1),Ze&&it.silhouette&&(Oe.updateTechnique(d,!0),Ze=!1))},_)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),0===ne)return;const fe=new mK(40*U/ne,_);(0,pt.s)(x,T[3],T[7],T[11]),A.set(x),(0,pt.c)(fe.transformWorldFromViewTH,A.high),(0,pt.c)(fe.transformWorldFromViewTL,A.low),(0,Co.f)(fe.transformViewFromCameraRelativeRS,d.camera.viewMatrix),(0,Co.t)(bL,fe.transformViewFromCameraRelativeRS),(0,Co.e)(fe.transformNormalViewFromGlobal,bL),fe.transformProjFromView=d.camera.projectionMatrix,this._updateObjectCameraDistances(d),this._renderers.forEach(Oe=>{this._renderRegularEdges(Oe,d,fe),this._renderSilhouetteEdges(Oe,d,fe)})}_updateTransparency(d){const _=hL(d.components.meta),T=pL(d.components.meta);_===d.edgeTransparency&&T===d.objectTransparency||(d.edgeTransparency=_,d.objectTransparency=T,this._renderers.get(d.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(d,_,T){d.getCombinedStaticTransformation(_,T);const x=(0,Qe.pC)(_.origin)?this._localOrigins.register(_.origin):this._localOrigins.acquire((0,pt.s)(this._tmpModelPosition,T[12],T[13],T[14]));return _.origin=x.origin,function dK(d,_){const T=-d[0],x=-d[1],A=-d[2],U=_[3],ne=_[7],fe=_[11],Oe=_[15];_[0]+=U*T,_[1]+=U*x,_[2]+=U*A,_[4]+=ne*T,_[5]+=ne*x,_[6]+=ne*A,_[8]+=fe*T,_[9]+=fe*x,_[10]+=fe*A,_[12]+=Oe*T,_[13]+=Oe*x,_[14]+=Oe*A}(x.origin.vec3,T),x}_updateComponentBuffer(d){const{meta:_,buffer:T}=d,x=new Uint8Array(4);for(let A=0;A<_.length;A++){const U=_[A].material,ne=_[A].index,fe=(0,xr.uZ)(Math.round(8*U.size),0,255),Oe=(0,xr.uZ)(U.extensionLength,-128,127)+128,we="solid"===U.type?aL.P.SOLID:aL.P.SKETCH,Ze=255*U.opacity,it=U.color;T.textureBuffer.setData(ne,0,255*it[0],255*it[1],255*it[2],255*it[3]),T.textureBuffer.setData(ne,1,fe,Oe,we,Ze),(0,XE.nO)(_[A].verticalOffset,x),T.textureBuffer.setData(ne,2,x[0],x[1],x[2],x[3])}}_createComponentBuffers(d){if((0,Qe.Wi)(this._componentColorManager))return null;const _=new Array,T=this._componentColorManager.getBuffer(d.length);for(let A=0;A<d.length;A++){const U=d[A],ne=T.acquireIndex();_.push({index:ne,verticalOffset:0,material:U})}const x=new SK(T,_);return this._updateComponentBuffer(x),x}_extractEdges(d,_,T,x,A,U=A.length){return this._worker.process({data:_,indices:A,indicesLength:U,writerSettings:d,skipDeduplicate:T},this._workerAbort.signal,x)}_createRenderable(d,_,T,x,A){const U=(0,Qe.pC)(this._verticesBufferObject)&&d.regular.lodInfo.lengths.length>0?new gL(new Dh.U(this.rctx,Kd.so,{vertices:Kd.dx,instances:oL.D9.glLayout},{vertices:this._verticesBufferObject,instances:Ra.f.createVertex(this.rctx,xt.l1.STATIC_DRAW,d.regular.instancesData.buffer)}),d.regular.lodInfo):null,ne=(0,Qe.pC)(this._verticesBufferObject)&&d.silhouette.lodInfo.lengths.length>0?new gL(new Dh.U(this.rctx,Kd.so,{vertices:Kd.dx,instances:oL.qE.glLayout},{vertices:this._verticesBufferObject,instances:Ra.f.createVertex(this.rctx,xt.l1.STATIC_DRAW,d.silhouette.instancesData.buffer)}),d.silhouette.lodInfo):null,fe=((0,Qe.pC)(U)?U.vao.size:0)+((0,Qe.pC)(ne)?ne.vao.size:0);return new RK(U,ne,{gpuMemoryUsage:fe,externalMemoryUsage:A,averageEdgeLength:d.averageEdgeLength},T,hL(_.meta),pL(_.meta),_,x)}_addGeometry(d,_,T,x,A,U,ne){var fe=this;return(0,kr.Z)(function*(){const Oe=T.vertexAttributes.get(Qi.T.POSITION),we=T.indices.get(Qi.T.POSITION),Ze=(0,gn.c)(),it=fe._computeModelTransformWithLocalOrigin(d,x,Ze),lt=new EL(Oe,we,Ze,it);return fe._addPositionData(_,lt,T.edgeIndicesLength,A,U,ne)})()}_addPositionData(d,_,T,x,A,U=!1){var ne=this;return(0,kr.Z)(function*(){if(null==d.loaded)return;const fe=ne._createComponentBuffers([x]);if((0,Qe.Wi)(fe)||T<=0)return;const Oe=ne._acquireRenderer(x.type,!!A.hasSlicePlane,!0),{modelTransform:we,origin:Ze}=_,it=_.indices,lt=_.position,dt=lt.data.length/lt.size,Tt=Kd.tf.createBuffer(dt);for(let Pt=0;Pt<dt;Pt++)Tt.position.set(Pt,0,lt.data[Pt*lt.size+0]),Tt.position.set(Pt,1,lt.data[Pt*lt.size+1]),Tt.position.set(Pt,2,lt.data[Pt*lt.size+2]);fL(fe.meta,[0,Tt.componentIndex.count],Tt.componentIndex);const mt=yield ne._updatingHandles.addPromise(ne._extractEdges(Oe.writerSettings,Tt,!1,U,it,T));if(null==d.loaded)return;const Mt=ne._createRenderable(mt,fe,new AK(we,Ze),Oe.key,!1);d.renderables.push(Mt),Oe.addRenderable(Mt),ne._gpuMemoryUsage+=Mt.statistics.gpuMemoryUsage})()}_addComponentGeometry(d,_,T,x,A,U,ne){var fe=this;return(0,kr.Z)(function*(){if(null==_.loaded)return 0;const Oe=fe._createComponentBuffers(U);if((0,Qe.Wi)(Oe))return 0;const we=dL(U),Ze=fe._acquireRenderer(we,ne.hasSlicePlane||!1,!1),it=Kd.tf.createBuffer(T.count);(0,TI.c)(it.position,T),fL(Oe.meta,A,it.componentIndex,x);const dt=Ze.writerSettings,Tt=yield fe._updatingHandles.addPromise(fe._extractEdges(dt,it,!0,!1,x));if(null==_.loaded)return 0;const mt=fe._createRenderable(Tt,Oe,d,Ze.key,!0);return _.renderables.push(mt),Ze.addRenderable(mt),mt.statistics.gpuMemoryUsage})()}_addObjectMergedGeometries(d,_,T,x,A){var U=this;return(0,kr.Z)(function*(){const ne=new Map;let fe=0,Oe=null,we=0;for(let Nt=0;Nt<d.geometries.length;Nt++){const Bt=d.geometries[Nt],Zt=d.geometryRecords[Nt];if(!Zt.material.supportsEdges)continue;!Oe&&Zt.origin&&(Oe=Zt);const nr=Bt.vertexAttributes.get(Qi.T.POSITION);we+=nr.data.length/nr.size,fe+=Bt.edgeIndicesLength}const Ze=we>=65536?Uint32Array:Uint16Array,it=fe?new Ze(fe):null,lt=[];let dt=0;for(let Nt=0;Nt<d.geometries.length;Nt++){const Bt=d.geometries[Nt];if(!d.geometryRecords[Nt].material.supportsEdges)continue;const Zt=Bt.vertexAttributes.get(Qi.T.POSITION),nr=Bt.indices.get(Qi.T.POSITION);let Jt=ne.get(Zt.data);if(null==Jt){Jt=lt.length/3;for(let Rr=0;Rr<Zt.data.length;Rr+=Zt.size)lt.push(Zt.data[Rr+0]),lt.push(Zt.data[Rr+1]),lt.push(Zt.data[Rr+2]);ne.set(Zt.data,Jt)}if(nr)for(let Rr=0;Rr<Bt.edgeIndicesLength;Rr++)it[dt++]=Jt+nr[Rr]}const Tt=Oe||d.geometryRecords[0],mt=(0,gn.c)(),Mt=U._computeModelTransformWithLocalOrigin(d,Tt,mt);for(let Nt=0;Nt<d.geometryRecords.length;Nt++)d.geometryRecords[Nt].origin=Mt.origin;const Pt=new EL({data:lt,size:3},it,mt,Mt);yield U._updatingHandles.addPromise(U._addPositionData(_,Pt,it.length,T[0],x,A))})()}_acquireRenderer(d,_,T){const x=vy.getKey(d,_,T);let A=this._renderers.get(x);return(0,Qe.Wi)(this._strokesTexture)&&(this._strokesTexture=function TK(d){const T=$d_resolution,x=T/2,A=new Uint8Array(4*T*T),U=4*T*x,ne=$d_amplitude,fe=2*ne,Oe=4*T,we=Math.log2(T)+1,Ze=$d_strokes.length;let it=(we-1)*Ze*Oe;for(const{distance:dt,pressure:Tt}of $d_strokes){let mt=dt,Mt=Tt,Pt=it;for(let Nt=0;Nt<we;Nt++){0!==Nt&&(mt=vb(mt,T0.DISTANCE),Mt=vb(Mt,T0.PRESSURE));for(let Bt=0;Bt<$d_resolution;Bt++){const nr=Mt?Mt[Bt%Mt.length]:1;(0,ib.I)(.5+(mt?mt[Bt%mt.length]/fe:0),A,Pt),(0,ib.I)(nr,A,Pt+U),Pt+=4}Pt-=Oe*(Ze+1)}it+=Oe}const lt=new Ro.x(d,{pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:xt.cw.LINEAR,width:T,height:T,wrapMode:xt.e8.REPEAT},A);return new PK(T,fe,ne,Ze,lt)}(this.rctx)),A||(A=new vy(this.rctx,this.techniqueRepository,{type:d,hasSlicePlane:_,strokesTexture:this._strokesTexture,legacy:T,spherical:this.viewingMode===vi.JY.Global}),this._renderers.set(x,A)),++A.refCount,A}_removeRenderable(d){!function xK(d){(0,Qe.pC)(d.regular)&&(d.regular.vao.vertexBuffers.instances.dispose(),d.regular.vao.dispose(!1),d.regular.vao=null),(0,Qe.pC)(d.silhouette)&&(d.silhouette.vao.vertexBuffers.instances.dispose(),d.silhouette.vao.dispose(!1),d.silhouette.vao=null)}(d);const _=this._renderers.get(d.rendererKey);if(_){_.removeRenderable(d),--_.refCount,"origin"in d.transform&&this._localOrigins.release(d.transform.origin),this._gpuMemoryUsage-=d.statistics.externalMemoryUsage?0:d.statistics.gpuMemoryUsage;for(const T of d.components.meta)d.components.buffer.releaseIndex(T.index)}}_updateObjectCameraDistances(d){const _=d.camera.eye,T=d.camera.viewForward,x=(0,ir.c)(),A=U=>{(0,pt.y)(x,U.center,_);const ne=(0,pt.e)(x,T),fe=U.radius,Oe=ne<-fe?1/0:ne<fe?0:ne-fe;U.renderables.forEach(we=>we.distanceToCamera=Oe)};this._perObjectData.forEach(A),this._perObjectDataEvictionCache.forEach(A)}_renderRegularEdges(d,_,T){const x=d.bindRegularEdges(T,_),U=_.camera.perScreenPixelRatio;d.forEachRenderable(ne=>{if(!yL(ne)||!ne.visible)return;const fe=Eb(ne.regular.lod.lengths,ne.distanceToCamera,U);d.renderRegularEdges(x,ne,T,_,fe)},T.transparency)}_renderSilhouetteEdges(d,_,T){const x=d.bindSilhouetteEdges(T,_),U=_.camera.perScreenPixelRatio;d.forEachRenderable(ne=>{if(!vL(ne)||!ne.visible)return;const fe=Eb(ne.silhouette.lod.lengths,ne.distanceToCamera,U);d.renderSilhouetteEdges(x,ne,T,_,fe)},T.transparency)}get test(){return{hasRenderedPrimitives:d=>{let _=!1;const T=d.perScreenPixelRatio,x=(A,U)=>A.forEachRenderable(ne=>{ne.visible&&!_&&(yL(ne)&&(_=Eb(ne.regular.lod.lengths,ne.distanceToCamera,T)>0),!_&&vL(ne)&&(_=Eb(ne.silhouette.lod.lengths,ne.distanceToCamera,T)>0))},U);return this._renderers.forEach(A=>{_||(x(A,zi.i.OPAQUE),x(A,zi.i.TRANSPARENT))}),_}}}};(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"rctx",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"renderSR",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"viewingMode",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"techniqueRepository",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"setNeedsRender",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],yu.prototype,"schedule",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],yu.prototype,"_updatingHandles",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],yu.prototype,"updating",null),yu=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],yu);class mL{constructor(_,T,x){this.center=T,this.radius=x,this.renderables=new Array,this.loaded=_,this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}}class SK{constructor(_,T){this.buffer=_,this.meta=T}}class gL{constructor(_,T){this.vao=_,this.lod=T}}class AK{constructor(_,T){this.modelMatrix=_,this.origin=T}}class RK{constructor(_,T,x,A,U,ne,fe,Oe){this.regular=_,this.silhouette=T,this.statistics=x,this.transform=A,this.edgeTransparency=U,this.objectTransparency=ne,this.components=fe,this.rendererKey=Oe,this.distanceToCamera=0,this.visible=!0}}function yL(d){return(0,Qe.pC)(d.regular)}function vL(d){return(0,Qe.pC)(d.silhouette)}function Eb(d,_,T){const x=_*T,A=(0,pd.$A)(d,x,!0);return-1===A?x<d[0]?d.length:0:d.length-A}class EL{constructor(_,T,x,A){this.position=_,this.indices=T,this.modelTransform=x,this.origin=A}}const bL=(0,xd.c)();var wK=v(38516),bb=v(73362),IK=v(52323),wl=v(38210);class CL{constructor(_,T,x,A,U,ne,fe,Oe,we){this.createQuery=_,this.deleteQuery=T,this.resultAvailable=x,this.getResult=A,this.disjoint=U,this.beginTimeElapsed=ne,this.endTimeElapsed=fe,this.createTimestamp=Oe,this.timestampBits=we}}let Yd=!1;class BK{constructor(_,T){this._timer=_,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,T.forEach(x=>{const A=this._timer.createQuery(),U=this._timer.createQuery();this._queryPool.push(A,U),this._queryResults.set(x,null)})}start(){Yd||(this._currentQuery=this._queryPool.pop(),(0,Qe.Wi)(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(_){if(this._timer.disjoint()||(0,Qe.Wi)(this._currentQuery)||!this._queryResults.has(_))return this.abort(),null;this._timer.endTimeElapsed();const T=this._queryResults.get(_);if((0,Qe.Wi)(T))return this._queryResults.set(_,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(T))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const x=this._timer.getResult(T)/1e6;return this._queryPool.unshift(T),this._queryResults.set(_,this._currentQuery),this._currentQuery=null,x}abort(){(0,Qe.pC)(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){(0,Qe.pC)(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(_=>{this._timer.deleteQuery(_)}),this._queryResults.forEach(_=>{(0,Qe.Wi)(_)||this._timer.deleteQuery(_)})}}var Mn;!function(d){d.OVERLAY="overlay",d.PREPARE="prepare",d.SHADOW_MAP="shadow map",d.LINEAR_DEPTH="linear depth",d.ACCUMULATED_SHADOWS="accumulated shadows",d.NORMALS="normals",d.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",d.SSAO="SSAO",d.OPAQUE="opaque",d.OPAQUE_EDGES="opaque edges",d.VOXEL="voxel",d.TRANSPARENT="transparent",d.TRANSPARENT_EDGES="transparent edges",d.HUD_VISIBILITY="HUD visibility",d.TRANSPARENT_TERRAIN="transparent terrain",d.ENVIRONMENT="environment",d.LASER_LINE="laser line",d.OCCLUDED="occluded",d.ANTIALIASING="antialiasing",d.HIGHLIGHTS="highlights",d.HUD_OCCLUDED="HUD occluded",d.HUD_NOT_OCCLUDED="HUD not occluded",d.FINISH="finish"}(Mn||(Mn={}));class jK{constructor(_){this._rctx=_,this._startTimeStampCPU=(0,mi.HA)(0),this._lastTimeStampCPU=(0,mi.HA)(0),this._totalCPUTime=new bb.Z("Total"),this._cpuTimeSamplers=new Map(Object.values(Mn).map(T=>[T,new bb.Z(T)])),this._enableGPUTimer=0,this._totalGPUTime=new bb.Z("GPU"),this._gpuTimeSamplers=new Map(Object.values(Mn).map(T=>[T,new bb.Z(T)])),this._totalTime=(0,mi.HA)(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return(0,Qe.pC)(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return(0,mi.HA)(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if((0,Qe.Wi)(this._gpuTimerPool)){const _=[...Object.values(Mn),"Total"];this._gpuTimerPool=function UK(d,_){const T=d.capabilities.disjointTimerQuery;return(0,Qe.Wi)(T)?null:new BK(T,_)}(this._rctx,_)}return(0,Qe.Wi)(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:(0,IK.IH)(()=>{--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=(0,Qe.M2)(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=(0,mi.HA)(performance.now()),(0,Qe.pC)(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(_){const T=(0,mi.HA)(performance.now());if(this._cpuTimeSamplers.get(_).record(T-this._lastTimeStampCPU),this._lastTimeStampCPU=T,(0,Qe.pC)(this._gpuTimerPool)){const x=this._gpuTimerPool.stop(_);this._gpuTimeSamplers.get(_).record(x),this._gpuTimerPool.start()}}finishFrame(){if((0,Qe.pC)(this._gpuTimerPool)){const T=this._gpuTimerPool.stop(Mn.FINISH);this._gpuTimeSamplers.get(Mn.FINISH).record(T)}const _=(0,mi.HA)(performance.now()-this._startTimeStampCPU);this._totalTime=(0,mi.HA)(this._totalTime+_),this._totalCPUTime.record(_),(0,Qe.pC)(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((T,x)=>T+(x.last||0),0)),++this._totalFrameCount}}let Xd=class extends Ns.Z{constructor(d,_,T,x,A,U,ne,fe,Oe){super({}),this._materialRepository=d,this._shaderTechniqueRepository=T,this._rctx=x,this._compositingHelper=A,this._magnifierHelper=U,this._requestRender=ne,this._stage=Oe,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=we=>{},this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new nK,this._antialiasing=!0,this._oitEnabled=!1,this._multipassTerrain=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=$a.Opaque,this._waterReflectionEnabled=!1,this._hasAnimations=!1,this._animationTimestep=JI,this._handles=new Ji.Z,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new gy(this._rctx,T),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new NG(this._rctx,this._compositingHelper),this.performanceInfo=new jK(this._rctx),this._shadowMap=new db.l(this._rctx,Oe.viewingMode),this._ssaoHelper=new uK.L(T,this._rctx,()=>this._requestRender()),this._highlight=new LG(T,this._rctx),this._shadowHighlight=new iK(this._rctx,Oe.viewingMode),this._shadowAccumulator=new Xa(this._rctx,T,Oe,we=>{const Ze=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(we.camera,we.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=Ze},(we,Ze,it)=>{we.shadowMap.start(we.camera,Ze,it),this._renderShadowCascades(Xs.H.Shadow,we.shadowMap),we.camera.setGLViewport(this._rctx),this._prepare(we.camera,we.contentCamera)},()=>this._requestRender()),this._renderContext=new zG.V(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new GG({renderContext:this._renderContext,shaderTechniqueRepository:T,textureRep:_,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:fe}),this.renderPassManager=new AG(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([(0,Ht.YP)(()=>this._stage.state.camera,()=>this._requestRender(),Ht.tX),(0,Ht.YP)(()=>Fo.Z.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,we=>{this._renderHiddenTransparentEdges=we?()=>this._renderEdges(zi.i.TRANSPARENT):()=>{},this._requestRender()},Ht.nn)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(d=>d.dispose()),this._materialRenderers.clear(),this._edgeView=(0,Qe.SC)(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=(0,Qe.M2)(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),RG.j.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||(0,Qe.pC)(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return(0,Qe.Wi)(this._edgeView)&&(this._edgeView=new yu({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:d=>this._stage.resourceController.schedule(d)}),this._handles.add((0,Ht.YP)(()=>(0,Qe.yw)(this._edgeView,d=>d.updating),()=>this._requestRender(),Ht.Z_)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return(0,gi.h)(this._bindParameters.ssr.reprojectionMatrix,gn.I)}set _reprojectionMatrix(d){(0,pd.Vx)(this._bindParameters.ssr.reprojectionMatrix,d)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setRenderParameters(d){const{_shadowMap:_,_ssaoHelper:T,_bindParameters:x}=this;if(void 0!==d.screenSpaceReflectionsEnabled&&x.ssr.enabled!==d.screenSpaceReflectionsEnabled&&(x.ssr.enabled=d.screenSpaceReflectionsEnabled,this._requestRender()),void 0!==d.shadowMap&&_.enabled!==d.shadowMap&&(_.enabled=d.shadowMap,this._requestRender()),void 0!==d.shadowMapMaxCascades&&_.maxCascades!==d.shadowMapMaxCascades&&(_.maxCascades=d.shadowMapMaxCascades,this._requestRender()),(0,Qe.pC)(d.environment)){(0,Qe.pC)(d.environment.weather)&&(this._bindParameters.weather=d.environment.weather,this._bindParameters.weatherVisible=d.weatherVisible),void 0!==d.environment.lighting.ambientOcclusionEnabled&&T.enabled!==d.environment.lighting.ambientOcclusionEnabled&&(T.enabled=d.environment.lighting.ambientOcclusionEnabled,this._requestRender()),void 0!==d.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==d.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=d.environment.lighting.waterReflectionEnabled,this._requestRender());const A="virtual"!==d.environment.lighting.type;x.enableFillLights!==A&&(x.enableFillLights=A,this._requestRender())}d.background&&this._offscreenRendering.background!==d.background&&(this._offscreenRendering.background=d.background,this._requestRender()),void 0!==d.antialiasingEnabled&&this._antialiasing!==d.antialiasingEnabled&&(this._antialiasing=d.antialiasingEnabled,this._requestRender()),void 0!==d.highQualityTransparency&&this._multipassTerrain!==d.highQualityTransparency&&(this._multipassTerrain=d.highQualityTransparency,this._oitEnabled=d.highQualityTransparency&&this._hasOITSupport,this._requestRender()),void 0!==d.defaultHighlightOptions&&(this._highlight.setDefaultOptions(d.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(d.defaultHighlightOptions),this._requestRender()),void 0!==d.overlays&&this._bindParameters.overlays!==d.overlays&&(this._bindParameters.overlays=d.overlays,this._requestRender()),void 0!==d.hasOverlayWater&&this._hasOverlayWater!==d.hasOverlayWater&&(this._hasOverlayWater=d.hasOverlayWater,this._requestRender()),void 0!==d.renderOverlay&&this._renderOverlay!==d.renderOverlay&&(this._renderOverlay=d.renderOverlay,this._requestRender()),void 0!==d.slicePlane&&this._sliceHelper.plane!==d.slicePlane&&(this._sliceHelper.plane=(0,Qe.Wg)(d.slicePlane),this._requestRender()),void 0!==d.terrainRenderingEnabled&&this._terrainRenderingEnabled!==d.terrainRenderingEnabled&&(this._terrainRenderingEnabled=d.terrainRenderingEnabled,this._requestRender()),void 0!==d.terrainTransparency&&this._terrainTransparency!==d.terrainTransparency&&(this._terrainTransparency=d.terrainTransparency,this._requestRender()),void 0!==d.shadowCastOptions&&this._shadowAccumulator.setOptions(d.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(d){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:_,removes:T,updates:x}=d;if(0===_.length&&0===T.length&&0===x.length)return;T.forAll(({id:ne})=>this._content.delete(ne)),_.forAll(ne=>this._content.set(ne.id,ne));const A=(0,HG.q)(d);let U=!1;A.forEach((ne,fe)=>{let Oe=this._materialRenderers.get(fe);if(!Oe){if(!(ne.adds.length>0))return;Oe=new wK.A(this._rctx,this._materialRepository,fe),this._materialRenderers.set(fe,Oe)}Oe.modify(ne),Oe.isEmpty&&(U=!0)}),U&&this._materialRenderers.forEach((ne,fe)=>{ne.isEmpty&&(this._materialRenderers.delete(fe),ne.dispose())}),this._hasHighlights=(0,El.oE)(this._materialRenderers,ne=>ne.hasHighlights),this._bindParameters.hasOccludees=(0,El.oE)(this._materialRenderers,ne=>ne.hasOccludees),this._hasWater=(0,El.oE)(this._materialRenderers,ne=>ne.hasWater),this._hasHUDElements=(0,El.oE)(this._materialRenderers,ne=>ne.requiresSlot(Mi.r.LINE_CALLOUTS_HUD_DEPTH,Xs.H.Color)||ne.requiresSlot(Mi.r.HUD_MATERIAL,Xs.H.Color)||ne.requiresSlot(Mi.r.LABEL_MATERIAL,Xs.H.Color)),this._requestRender()}updateAnimation(d){return this._hasAnimations=!1,this._materialRenderers.forEach(_=>this._hasAnimations=_.updateAnimation(d)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(d)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}render(d,_,T,x,A){this._isRendering=!0;const{camera:U,contentCamera:ne}=T;this._renderContext.time=A,this.performanceInfo.startFrame(),this._renderOverlay(A),this.performanceInfo.advance(Mn.OVERLAY),this._bindParameters.transparencyPassType=Zc.A.NONE;const fe=this._offscreenRendering;fe.setupRenderTarget(this.hasWaterReflection);const Oe=(0,nu.a)(this._sliceHelper.plane);x===Fi.Iq.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(d),U.setGLViewport(this._rctx),this._prepare(U,ne),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Mn.PREPARE);const we=this._computeDepthRange(U);this._renderShadowMap(d,U,this._bindParameters.lighting.mainLight.direction,we),this.performanceInfo.advance(Mn.SHADOW_MAP),fe.initializeFrame(U),this._ensureBindParameters(U,ne),this._renderLinearDepth(),this.performanceInfo.advance(Mn.LINEAR_DEPTH),this._accumulateShadows(we,U,ne),this.performanceInfo.advance(Mn.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Mn.NORMALS),this._ensureBindParametersSSR(),this._renderSSAO(),this.performanceInfo.advance(Mn.SSAO),this._renderContext.output=Xs.H.Color,fe.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Mn.OPAQUE);const Ze=this._terrainRenderingEnabled&&this._terrainTransparency!==$a.Opaque,it=this._multipassTerrain&&Ze;this._renderTerrainLinearDepth(it),this._setMultipassEnabled(it),this._setTerrainCulling(it),this._renderEdges(zi.i.OPAQUE),this.performanceInfo.advance(Mn.OPAQUE_EDGES),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Mi.r.VOXEL),this.performanceInfo.advance(Mn.VOXEL),this._renderHiddenTransparentEdges();const lt=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;lt&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Mn.TRANSPARENT),this._renderGeometryLinearDepth(it);const dt=this._renderHUDVisibility(this._multipassTerrain&&Ze);it||this._renderInternalSlot(Mi.r.LINE_CALLOUTS),this.performanceInfo.advance(Mn.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(_),this.performanceInfo.advance(Mn.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(zi.i.TRANSPARENT,it),this.performanceInfo.advance(Mn.TRANSPARENT_EDGES),this._renderTransparentTerrain(),Ze&&dt&&(it?this._renderLineCallouts(Zd.v.Occluded):fe.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Zd.v.Occluded,fe.framebuffer),this.performanceInfo.advance(Mn.HUD_OCCLUDED)),this.performanceInfo.advance(Mn.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),Ze&&(fe.compositeTransparentTerrainOntoMain(this._bindParameters),it&&(this._renderEdges(zi.i.OPAQUE),this.performanceInfo.advance(Mn.OPAQUE_EDGES),lt&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Mn.TRANSPARENT),this._renderEdges(zi.i.TRANSPARENT),this.performanceInfo.advance(Mn.TRANSPARENT_EDGES))),it&&this._renderLineCallouts(Zd.v.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),fe.renderToTargets(()=>{this._renderInternalSlot(Mi.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Mi.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Mi.r.LASERLINES)},fe.currentColorTarget,fe.mainDepth),this.performanceInfo.advance(Mn.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&fe.renderTmpAndCompositeToMain(()=>this._renderSlot(Mi.r.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Ya.PremultipliedAlpha),this.performanceInfo.advance(Mn.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Mn.OCCLUDED);const Tt=x===Fi.Iq.ON&&this._magnifierHelper.enabled,mt=Tt&&(0,Qe.Wi)(d)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):d;this._rctx.bindFramebuffer(mt);const Mt=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(Mt)&&(0,Qe.pC)(Mt)&&this._compositingHelper.composite(this._bindParameters,Mt,Ya.None),this.performanceInfo.advance(Mn.ANTIALIASING),this._renderHUD(Zd.v.NotOccluded,mt),this.performanceInfo.advance(Mn.HUD_NOT_OCCLUDED),this._renderHighlights(mt,this._bindParameters),this.performanceInfo.advance(Mn.HIGHLIGHTS),Tt&&this._magnifierHelper.render(this._rctx,this._bindParameters),mt!==d&&(this._rctx.bindFramebuffer(d),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Ya.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=Oe,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(d){(0,Qe.pC)(d)&&(0,So.Z)("enable-feature:objectAndLayerId-rendering")&&(this._rctx.bindFramebuffer(d),this._offscreenRendering.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(Xs.H.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(d),this._offscreenRendering.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Zd.v.NotOccluded,this._renderInternalSlot(Mi.r.HUD_MATERIAL)},null,!0,!0))}finish(d){if(this._hasAnimations||(this._animationTimestep=(0,mi.HA)(0)),d===Fi.Xx.BACKGROUND){let _=0;this.performanceInfo.gpuSamplingEnabled?_=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();const x=Math.max(this.performanceInfo.elapsedTime,_),A=(0,xr.uZ)(x/.5,SG,JI);this._animationTimestep=(0,mi.HA)(.9*this._animationTimestep+A*(1-.9))}}readDepthPixels(d,_,T){const x=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(d,d),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(xt.lk.COLOR_BUFFER_BIT|xt.lk.DEPTH_BUFFER_BIT|xt.lk.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(Xs.H.Depth)),x.readPixels(_[0],_[1],_[2],_[3],xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,T)}readHUDVisibility(d,_,T,x,A){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(d,_,T,x,xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,A)}readAccumulatedShadow(d,_){return this._shadowAccumulator.readAccumulatedShadow(d,_)}_setMultipassEnabled(d){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=d}_setTerrainCulling(d){this._bindParameters.multipassTerrain.cullAboveGround=d}_renderSlot(d){this._bindParameters.slot=d,this._renderPlugins.render()}_renderEdges(d,_=!1){const T=this._edgeView;(0,Qe.pC)(T)&&T.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>T.render(this._bindParameters,d),this._bindParameters,Ya.Alpha,_)}_renderShadowMap(d,_,T,x){const A=this._shadowMap;A.enabled&&(A.start(_,T,x),this._shadowHighlight.updateParameters(_,T),this._needsShadowHighlight?(this._renderShadowCascades(Xs.H.ShadowHighlight,this._shadowMap,U=>A.takeCascadeSnapshotTo(U,db.i.Highlight)),A.clear(),this._renderShadowCascades(Xs.H.ShadowExludeHighlight,this._shadowMap,U=>{A.takeCascadeSnapshotTo(U,db.i.Default),this._renderGeometryAndTransparentTerrainPass(Xs.H.ShadowHighlight)})):this._renderShadowCascades(Xs.H.Shadow),A.finish(d),_.setGLViewport(this._rctx))}_renderShadowCascades(d,_=this._shadowMap,T=(x=>{})){for(const x of _.getCascades())x.camera.setGLViewport(this._rctx),this._prepare(x.camera,x.camera),this._renderGeometryAndTransparentTerrainPass(d),T(x)}get _needsLinearDepth(){return this._ssaoHelper.ready||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(Xs.H.Depth),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(d){if(d){const _=this._renderContext.output;this._renderContext.output=Xs.H.Depth,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=_}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(d){if(d){const _=this._renderContext.output;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(Xs.H.Depth),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=_}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.ready}_renderNormal(){this._needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Xs.H.Normal)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(d){if(!this._needsDepthRange)return BO;const _=function aG(d,_,T){if(_.size<1e4)return fG.compute(d,_);const x=cy();return T.forAll(A=>{A.isVisible&&gf(x,function lG(d,_){if(!_.isVisible)return;const T=cy(),x=_.getSpatialQueryAccelerator();return(0,Qe.pC)(x)?function cG(d,_,T){const x=_.eye,A=_.viewForward,U=_.frustum,ne=Oe=>Oe.isVisible,fe=T.objectCount;if(fe<500)uy($c,_.near,Math.min(d.near,_.far)),T.forEachInDepthRange(x,A,b0.Z.DepthOrder.FRONT_TO_BACK,$c,(Oe,we)=>{HO(d,_,Oe),$c.far=d.near,we.setRange($c)},U,ne),uy($c,Math.max(d.far,_.near),_.far),T.forEachInDepthRange(x,A,b0.Z.DepthOrder.BACK_TO_FRONT,$c,(Oe,we)=>{HO(d,_,Oe),$c.near=d.far,we.setRange($c)},U,ne);else{const Oe=Math.max(Math.min(fe,500),Math.ceil(.1*fe)),we=T.findClosest(A,b0.Z.DepthOrder.FRONT_TO_BACK,U,ne,Oe),Ze=T.findClosest(A,b0.Z.DepthOrder.BACK_TO_FRONT,U,ne,Oe);we&&Ze&&(YI(d,_,we.boundingVolumeWorldSpace.bounds),YI(d,_,Ze.boundingVolumeWorldSpace.bounds))}}(T,d,x):function uG(d,_,T){vf.clear(),T.forAll(x=>{x.isVisible&&0!==x.geometryRecords.length&&vf.add(x)}),vf.empty||(vf.sort(_),uy($c,_.near,Math.min(d.near,_.far)),vf.forEachInDepthRange($c,b0.Z.DepthOrder.FRONT_TO_BACK,(x,A)=>{A<d.near&&HO(d,_,x)}),uy($c,Math.max(d.far,_.near),_.far),vf.forEachInDepthRange($c,b0.Z.DepthOrder.BACK_TO_FRONT,(x,A,U)=>{d.far=Math.max(d.far,U)}))}(T,d,_.objects),T}(d,A))}),x}(d,this._content,this._stage.layers);return gf(_,this.renderPlugins.queryDepthRange(d)),_.near=Math.max(d.near,_.near),_.far=Math.min(d.far,_.far),_}_renderGeometryAndTransparentTerrainPass(d){this._renderContext.output=d,this._renderGeometryPass(d),this._renderTransparentTerrain()}_renderGeometryPass(d){this._renderContext.output=d,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(){this._ssaoHelper.loading?this._requestRender():this._ssaoHelper.computeSSAO(this._bindParameters,this._offscreenRendering.linearDepthTexture,this._offscreenRendering.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Mi.r.INTEGRATED_MESH),this._renderSlot(Mi.r.OPAQUE_TERRAIN),this._renderInternalSlot(Mi.r.OPAQUE_MATERIAL),this._renderSlot(Mi.r.OPAQUE_MATERIAL),this._renderSlot(Mi.r.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Mi.r.TRANSPARENT_MATERIAL),this._renderSlot(Mi.r.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Mi.r.TRANSPARENT_TERRAIN)}_renderHUDVisibility(d){let _=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,_=this._renderInternalSlot(Mi.r.OCCLUSION_PIXELS)},d),_}_renderLineCallouts(d){this._bindParameters.renderTransparentlyOccludedHUD=d,d===Zd.v.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Mi.r.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Mi.r.LINE_CALLOUTS)}_renderHUD(d,_){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(d),!0),this._rctx.bindFramebuffer(_),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Ya.PremultipliedAlpha)):d===Zd.v.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Zd.v.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(d))}_renderHUDElements(d){this._bindParameters.renderTransparentlyOccludedHUD=d,this._renderInternalSlot(Mi.r.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Mi.r.HUD_MATERIAL),this._renderInternalSlot(Mi.r.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(d,_){if(!this._needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const T=this._highlight,x=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Xs.H.Highlight),this._rctx.clearSafe(xt.lk.DEPTH_BUFFER_BIT),this._renderHUDElements(Zd.v.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=x.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(_,d),T.render(this._bindParameters,x,d)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(d,_,T){this._needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,d,_,T)}_renderOrderIndependentTransparency(d,_){const T=A=>{this._bindParameters.transparencyPassType=A,this._offscreenRendering.renderOITPass(()=>d(),A,_)},x=this._renderContext.output;this._renderContext.output=Xs.H.Alpha,T(Zc.A.Alpha),this._renderContext.output=Xs.H.Color,T(Zc.A.Color),T(Zc.A.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,_),this._bindParameters.transparencyPassType=Zc.A.NONE,this._renderContext.output=x,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let d=0;this._materialRenderers.forEach((U,ne)=>{ne&&ne.isVisible()&&ne.renderOccluded===tc.yD.OccludeAndTransparentStencil&&(d|=ne.renderOccluded,by.push(ne))});const _=this._offscreenRendering,T=(U,ne,fe,Oe,we)=>{0!=(d&ne)&&(_.renderToTargets(fe,_.tmpColor,_.mainDepth,[0,0,0,0],Oe,we),_.compositeOccludedOntoMain(this._bindParameters,U))};0!==by.length&&(this._renderInternalSlot(Mi.r.OCCLUDER_MATERIAL,by),T(.5,tc.yD.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Mi.r.TRANSPARENT_OCCLUDER_MATERIAL,by),!1,!1),by.length=0),this._materialRenderers.forEach((U,ne)=>{ne&&ne.isVisible()&&(ne.renderOccluded===tc.yD.OccludeAndTransparent||ne.renderOccluded===tc.yD.Transparent||ne.renderOccluded===tc.yD.Opaque)&&(d|=ne.renderOccluded,Ey.push(ne))});const x=this._renderPlugins.renderOccludedFlags;if(d|=x,!d)return;const A=U=>{this._renderContext.renderOccludedMask=U,x>tc.yD.Occlude&&this._renderSlot(Mi.r.OCCLUDED_TERRAIN),this._renderInternalSlot(Mi.r.OPAQUE_MATERIAL,Ey),this._renderInternalSlot(Mi.r.TRANSPARENT_MATERIAL,Ey),this._renderInternalSlot(Mi.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ey),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=Xs.H.Color,T(.5,tc.yD.OccludeAndTransparent,()=>A(tc.yD.OccludeAndTransparent),!0,Fi.hU.OutlineVisualElementMask),T(.5,tc.yD.Transparent,()=>A(tc.yD.Transparent),!0,Fi.hU.OutlineVisualElementMask),T(1,tc.yD.Opaque,()=>A(tc.yD.Opaque),!0,Fi.hU.OutlineVisualElementMask),Ey.length=0}_renderAntiAliasing(d){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&(0,Qe.pC)(d))return this._smaaPass.render(d),!0}else this._smaaPass.disable();return!1}_prepare(d,_){this._needsTransparentPass=(0,El.oE)(this._materialRenderers,T=>T.requiresSlot(Mi.r.TRANSPARENT_MATERIAL,Xs.H.Color)),this._bindParameters.camera=d,this._bindParameters.contentCamera=_}_ensureBindParameters(d,_){this._bindParameters.camera=d,this._bindParameters.contentCamera=_;const T=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=T.hudVisibilityTexture,this._bindParameters.mainColorTexture=T.mainColorTexture,this._bindParameters.highlightDepthTexture=T.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=gn.I:((0,gi.a)(OL,this._bindParameters.camera.viewMatrix),(0,gi.a)(PL,this._bindParameters.camera.projectionMatrix),(0,gi.m)(bf,OL,PL),(0,gi.m)(bf,this._renderContext.lastFrameCamera.viewMatrix,bf),(0,gi.m)(bf,this._renderContext.lastFrameCamera.projectionMatrix,bf),this._reprojectionMatrix=bf),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(d,_){let T=!1;return this._bindParameters.slot=d,(0,Qe.pC)(_)?_.forEach(x=>{if(!x.shouldRender(this._renderContext))return;const A=this._materialRenderers.get(x);(0,Qe.pC)(A)&&(T=A.render(this._renderContext.output,this._bindParameters)||T)}):this._materialRenderers.forEach((x,A)=>{A.shouldRender(this._renderContext)&&x.render(this._renderContext.output,this._bindParameters)&&(T=!0)}),T}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=(0,_a.hf)(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreenRendering?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const d=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,getFramebufferTexture:_=>{switch(_){case rp.Color:return d._offscreenRendering.colorTexture;case rp.LinearDepth:return d._offscreenRendering.linearDepthTexture;case rp.Normals:return d._offscreenRendering.normalTexture;case rp.ShadowMap:return d._shadowMap.depthTexture;case rp.HudVisibility:return d._offscreenRendering.hudVisibilityTexture;case rp.Highlight:return d._offscreenRendering.highlightTexture}}}}};var rp;(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"_shadowAccumulator",void 0),(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"_smaaPass",void 0),(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"_antialiasing",void 0),(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"_edgeView",void 0),(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)()],Xd.prototype,"isCameraFinal",null),Xd=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.Renderer")],Xd),function(d){d[d.Color=0]="Color",d[d.LinearDepth=1]="LinearDepth",d[d.Normals=2]="Normals",d[d.ShadowMap=3]="ShadowMap",d[d.HudVisibility=4]="HudVisibility",d[d.Highlight=5]="Highlight"}(rp||(rp={}));const Ey=[],by=[],PL=(0,gn.c)(),OL=(0,gn.c)(),bf=(0,gn.c)();var vu=v(68598);class xL{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:xt.zi.ONE,dstRGB:xt.zi.ZERO,srcAlpha:xt.zi.ONE,dstAlpha:xt.zi.ZERO},this.blendEquation={mode:xt.db.ADD,modeAlpha:xt.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=xt.LR.BACK,this.frontFace=xt.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=xt.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:xt.LR.FRONT_AND_BACK,func:xt.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:xt.LR.FRONT_AND_BACK,fail:xt.xS.KEEP,zFail:xt.xS.KEEP,zPass:xt.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class FK{constructor(_){this._allocations=new Map,_?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(_){this._allocations.set(_,(new Error).stack)}remove(_){this._allocations.delete(_)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const _=new Map;this._allocations.forEach(T=>{_.set(T,(_.get(T)??0)+1)}),_.forEach((T,x)=>{const A=x.split("\n");A.shift(),A.shift(),console.log(`${T}: ${A.shift()}`),A.forEach(U=>console.log("   ",U))})}}}class WK{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new FK(false);this._current.length<xt._g.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(_,T){const x=++this._current[_];this._max[_]=Math.max(x,this._max[_]),this._allocations.add(T)}decrement(_,T){--this._current[_],this._allocations.remove(T)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((_,T)=>_+T,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let _=0;_<xt._g.COUNT;++_){const T=this._current[_];T>0&&console.log(`${xt._g[_]}: ${T}`)}}this._allocations.print()}}var VK=v(1101);const zK=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var SL,AL={exports:{}};void 0!==(SL=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(AL.exports=SL);const HK=AL.exports;var _,wL={exports:{}};void 0!==(_=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"])&&(wL.exports=_);const IL=wL.exports;var LL={exports:{}};!function(d){var T;void 0!==(T=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"])&&(d.exports=T)}(LL);const GK=LL.exports;var Eu=999,XK=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function QK(d){return function JK(d){var _=function kK(){var d,_,T,x=0,A=0,U=Eu,ne=[],fe=[],Oe=1,we=0,Ze=0,it=!1,lt=!1,dt="";return function(Xr){return fe=[],null!==Xr?function mt(Xr){var os;for(x=0,T=(dt+=Xr).length;d=dt[x],x<T;){switch(os=x,U){case 0:x="/"===d&&"*"===_?(ne.push(d),Tt(ne.join("")),U=Eu,x+1):(ne.push(d),_=d,x+1);break;case 1:case 2:x=Bt();break;case 3:x=Jt();break;case 4:x="."===d||/[eE]/.test(d)?(ne.push(d),U=5,_=d,x+1):"x"===d&&1===ne.length&&"0"===ne[0]?(U=11,ne.push(d),_=d,x+1):/[^\d]/.test(d)?(Tt(ne.join("")),U=Eu,x):(ne.push(d),_=d,x+1);break;case 11:x=/[^a-fA-F0-9]/.test(d)?(Tt(ne.join("")),U=Eu,x):(ne.push(d),_=d,x+1);break;case 5:"f"===d&&(ne.push(d),_=d,x+=1),x=/[eE]/.test(d)||"-"===d&&/[eE]/.test(_)?(ne.push(d),_=d,x+1):/[^\d]/.test(d)?(Tt(ne.join("")),U=Eu,x):(ne.push(d),_=d,x+1);break;case 9999:x=cs();break;case 9:x=/[^\s]/g.test(d)?(Tt(ne.join("")),U=Eu,x):(ne.push(d),_=d,x+1);break;case Eu:ne=ne.length?[]:ne,x="/"===_&&"*"===d?(Ze=A+x-1,U=0,_=d,x+1):"/"===_&&"/"===d?(Ze=A+x-1,U=1,_=d,x+1):"#"===d?(U=2,Ze=A+x,x):/\s/.test(d)?(U=9,Ze=A+x,x):(it=/\d/.test(d),lt=/[^\w_]/.test(d),Ze=A+x,U=it?4:lt?3:9999,x)}os!==x&&("\n"===dt[os]?(we=0,++Oe):++we)}return A+=x,dt=dt.slice(x),fe}(Xr.replace?Xr.replace(/\r\n/g,"\n"):Xr):function Mt(Xr){return ne.length&&Tt(ne.join("")),U=10,Tt("(eof)"),fe}()};function Tt(Xr){Xr.length&&fe.push({type:XK[U],data:Xr,position:Ze,line:Oe,column:we})}function Bt(){return"\r"!==d&&"\n"!==d||"\\"===_?(ne.push(d),_=d,x+1):(Tt(ne.join("")),U=Eu,x)}function Jt(){if("."===_&&/\d/.test(d))return U=5,x;if("/"===_&&"*"===d)return U=0,x;if("/"===_&&"/"===d)return U=1,x;if("."===d&&ne.length){for(;Rr(ne););return U=5,x}if(";"===d||")"===d||"("===d){if(ne.length)for(;Rr(ne););return Tt(d),U=Eu,x+1}var Xr=2===ne.length&&"="!==d;if(/[\w_\d\s]/.test(d)||Xr){for(;Rr(ne););return U=Eu,x}return ne.push(d),_=d,x+1}function Rr(Xr){for(var os,br,Vr=0;;){if(os=IL.indexOf(Xr.slice(0,Xr.length+Vr).join("")),br=IL[os],-1===os){if(Vr--+Xr.length>0)continue;br=Xr.slice(0,1).join("")}return Tt(br),Ze+=br.length,(ne=ne.slice(br.length)).length}}function cs(){if(/[^\d\w_]/.test(d)){var Xr=ne.join("");return U=HK.indexOf(Xr)>-1?8:GK.indexOf(Xr)>-1?7:6,Tt(ne.join("")),U=Eu,x}return ne.push(d),_=d,x+1}}(),T=[];return(T=T.concat(_(d))).concat(_(null))}(d)}const ex=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function tZ(d,_){for(let T=_-1;T>=0;T--){const x=d[T];if("whitespace"!==x.type&&"block-comment"!==x.type){if("keyword"!==x.type)break;if("attribute"===x.data||"in"===x.data)return!0}}return!1}function Cy(d,_,T,x){x=x||T;for(const A of d)if("ident"===A.type&&A.data===T)return x in _?_[x]++:_[x]=0,Cy(d,_,x+"_"+_[x],x);return T}function VL(d,_,T="afterVersion"){function x(Oe,we){for(let Ze=we;Ze<Oe.length;Ze++){const it=Oe[Ze];if("operator"===it.type&&";"===it.data)return Ze}return null}const U={data:"\n",type:"whitespace"},ne=Oe=>Oe<d.length&&/[^\r\n]$/.test(d[Oe].data);let fe=function A(Oe){let we=-1,Ze=0,it=-1;for(let lt=0;lt<Oe.length;lt++){const dt=Oe[lt];if("preprocessor"===dt.type&&(dt.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++Ze:dt.data.match(/\#endif\s*.*/)&&--Ze),"afterVersion"!==T&&"afterPrecision"!==T||"preprocessor"===dt.type&&/^#version/.test(dt.data)&&(it=Math.max(it,lt)),"afterPrecision"===T&&"keyword"===dt.type&&"precision"===dt.data){const Tt=x(Oe,lt);if(null===Tt)throw new Error("precision statement not followed by any semicolons!");it=Math.max(it,Tt)}we<it&&0===Ze&&(we=lt)}return we+1}(d);ne(fe-1)&&d.splice(fe++,0,U);for(const Oe of _)d.splice(fe++,0,Oe);ne(fe-1)&&ne(fe)&&d.splice(fe,0,U)}function rZ(d,_,T,x="lowp"){VL(d,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:x},{type:"whitespace",data:" "},{type:"keyword",data:T},{type:"whitespace",data:" "},{type:"ident",data:_},{type:"operator",data:";"}],"afterPrecision")}function sZ(d,_,T,x,A="lowp"){VL(d,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:x.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:T},{type:"whitespace",data:" "},{type:"ident",data:_},{type:"operator",data:";"}],"afterPrecision")}function iZ(d,_){let T,x,A=-1;for(let U=_;U<d.length;U++){const ne=d[U];if("operator"===ne.type&&("["===ne.data&&(T=U),"]"===ne.data)){x=U;break}"integer"===ne.type&&(A=parseInt(ne.data,10))}return T&&x&&d.splice(T,x-T+1),A}function zL(d,_){if((0,Qe.pC)(null))return null;const x=QK(d);if("300 es"===function eZ(d,_="100",T="300 es"){const x=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const A of d)if("preprocessor"===A.type){const U=x.exec(A.data);if(U){const ne=U[1].replace(/\s\s+/g," ");if(ne===T)return ne;if(ne===_)return A.data="#version "+T,_;throw new Error("unknown glsl version: "+ne)}}return d.splice(0,0,{type:"preprocessor",data:"#version "+T},{type:"whitespace",data:"\n"}),null}(x,"100","300 es"))return d;let A=null,U=null;const ne={},fe={};for(let Oe=0;Oe<x.length;++Oe){const we=x[Oe];switch(we.type){case"keyword":_===xt.Ho.VERTEX_SHADER&&"attribute"===we.data?we.data="in":"varying"===we.data&&(we.data=_===xt.Ho.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(we.data.trim())&&(we.data=we.data.replace(/(2D|Cube|EXT)/g,"")),_===xt.Ho.FRAGMENT_SHADER&&"gl_FragColor"===we.data&&(A||(A=Cy(x,ne,"fragColor"),rZ(x,A,"vec4")),we.data=A),_===xt.Ho.FRAGMENT_SHADER&&"gl_FragData"===we.data){const Ze=iZ(x,Oe+1),it=Cy(x,ne,"fragData");sZ(x,it,"vec4",Ze,"mediump"),we.data=it}else _===xt.Ho.FRAGMENT_SHADER&&"gl_FragDepthEXT"===we.data&&(U||(U=Cy(x,ne,"gl_FragDepth")),we.data=U);break;case"ident":if(zK.includes(we.data)){if(_===xt.Ho.VERTEX_SHADER&&tZ(x,Oe))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");we.data in fe||(fe[we.data]=Cy(x,ne,we.data)),we.data=fe[we.data]}}}for(let Oe=x.length-1;Oe>=0;--Oe){const we=x[Oe];if("preprocessor"===we.type){const Ze=we.data.match(/\#extension\s+(.*)\:/);if(Ze&&Ze[1]&&ex.includes(Ze[1].trim())){const dt=x[Oe+1];x.splice(Oe,dt&&"whitespace"===dt.type?2:1)}const it=we.data.match(/\#ifdef\s+(.*)/);it&&it[1]&&ex.includes(it[1].trim())&&(we.data="#if 1");const lt=we.data.match(/\#ifndef\s+(.*)/);lt&&lt[1]&&ex.includes(lt[1].trim())&&(we.data="#if 0")}}return function oZ(d,_){return _}(0,function qK(d){return d.map(_=>"eof"!==_.type?_.data:"").join("")}(x))}class lZ{constructor(_,T,x,A,U=new Map){this._context=_,this._locations=A,this._uniformBlockBindings=U,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,_||console.error("RenderingContext isn't initialized!"),0===T.length&&console.error("Shaders source should not be empty!"),this._context.type===cl.zO.WEBGL2&&(T=zL(T,xt.Ho.VERTEX_SHADER),x=zL(x,xt.Ho.FRAGMENT_SHADER)),this._vShader=GL(this._context,xt.Ho.VERTEX_SHADER,T),this._fShader=GL(this._context,xt.Ho.FRAGMENT_SHADER,x),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(xt._g.Shader,this),(0,vu.CG)()&&(this.vertexShader=T,this.fragmentShader=x)}get glName(){if((0,Qe.pC)(this._glName))return this._glName;if((0,Qe.Wi)(this._vShader))return null;const _=this._context.gl,T=_.createProgram();if(_.attachShader(T,this._vShader),_.attachShader(T,this._fShader),this._locations.forEach((x,A)=>_.bindAttribLocation(T,x,A)),_.linkProgram(T),(0,vu.CG)()&&!_.getProgramParameter(T,_.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${_.getProgramParameter(T,_.VALIDATE_STATUS)}, gl error ${_.getError()}, vertex: ${_.getShaderParameter(this._vShader,_.COMPILE_STATUS)}, fragment: ${_.getShaderParameter(this._fShader,_.COMPILE_STATUS)}, info log: ${_.getProgramInfoLog(T)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===cl.zO.WEBGL2){const x=_;for(const[A,U]of this._uniformBlockBindings){const ne=x.getUniformBlockIndex(T,A);ne<4294967295&&x.uniformBlockBinding(T,ne,U)}}return this._glName=T,this._context.instanceCounter.increment(xt._g.Program,this),T}get hasGLName(){return(0,Qe.pC)(this._glName)}get isCompiled(){if(this._compiled)return!0;const _=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==_?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,_.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const _=this._context.gl;this._vShader&&(_.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(xt._g.Shader,this)),this._fShader&&(_.deleteShader(this._fShader),this._fShader=null),this._glName&&(_.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(xt._g.Program,this))}ref(){++this._refCount}_getUniformLocation(_){return void 0===this._nameToUniformLocation[_]&&(++tx.numUniforms,this._nameToUniformLocation[_]=this._context.gl.getUniformLocation(this.glName,_)),this._nameToUniformLocation[_]}hasUniform(_){return null!==this._getUniformLocation(_)}setUniform1i(_,T){const x=this._nameToUniform1[_];void 0!==x&&T===x||(this._context.gl.uniform1i(this._getUniformLocation(_),T),this._nameToUniform1[_]=T)}setUniform1iv(_,T){ku(this._nameToUniform1v,_,T)&&this._context.gl.uniform1iv(this._getUniformLocation(_),T)}setUniform2iv(_,T){ku(this._nameToUniform2,_,T)&&this._context.gl.uniform2iv(this._getUniformLocation(_),T)}setUniform3iv(_,T){ku(this._nameToUniform3,_,T)&&this._context.gl.uniform3iv(this._getUniformLocation(_),T)}setUniform4iv(_,T){ku(this._nameToUniform4,_,T)&&this._context.gl.uniform4iv(this._getUniformLocation(_),T)}setUniform1f(_,T){const x=this._nameToUniform1[_];void 0!==x&&T===x||(this._context.gl.uniform1f(this._getUniformLocation(_),T),this._nameToUniform1[_]=T)}setUniform1fv(_,T){ku(this._nameToUniform1v,_,T)&&this._context.gl.uniform1fv(this._getUniformLocation(_),T)}setUniform2f(_,T,x){const A=this._nameToUniform2.get(_);void 0===A?(this._context.gl.uniform2f(this._getUniformLocation(_),T,x),this._nameToUniform2.set(_,[T,x])):T===A[0]&&x===A[1]||(this._context.gl.uniform2f(this._getUniformLocation(_),T,x),A[0]=T,A[1]=x)}setUniform2fv(_,T){ku(this._nameToUniform2,_,T)&&this._context.gl.uniform2fv(this._getUniformLocation(_),T)}setUniform3f(_,T,x,A){const U=this._nameToUniform3.get(_);void 0===U?(this._context.gl.uniform3f(this._getUniformLocation(_),T,x,A),this._nameToUniform3[_]=[T,x,A]):T===U[0]&&x===U[1]&&A===U[2]||(this._context.gl.uniform3f(this._getUniformLocation(_),T,x,A),U[0]=T,U[1]=x,U[2]=A)}setUniform3fv(_,T){ku(this._nameToUniform3,_,T)&&this._context.gl.uniform3fv(this._getUniformLocation(_),T)}setUniform4f(_,T,x,A,U){const ne=this._nameToUniform4.get(_);void 0===ne?(this._context.gl.uniform4f(this._getUniformLocation(_),T,x,A,U),this._nameToUniform4.set(_,[T,x,A,U])):void 0!==ne&&T===ne[0]&&x===ne[1]&&A===ne[2]&&U===ne[3]||(this._context.gl.uniform4f(this._getUniformLocation(_),T,x,A,U),ne[0]=T,ne[1]=x,ne[2]=A,ne[3]=U)}setUniform4fv(_,T){ku(this._nameToUniform4,_,T)&&this._context.gl.uniform4fv(this._getUniformLocation(_),T)}setUniformMatrix3fv(_,T,x=!1){ku(this._nameToUniformMatrix3,_,T)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(_),x,T)}setUniformMatrix4fv(_,T,x=!1){ku(this._nameToUniformMatrix4,_,T)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(_),x,T)}stop(){}}function GL(d,_,T){const x=d.gl,A=x.createShader(_);return x.shaderSource(A,T),x.compileShader(A),(0,vu.CG)()&&!x.getShaderParameter(A,x.COMPILE_STATUS)&&(console.error("Compile error in ".concat(_===xt.Ho.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(x.getShaderInfoLog(A)),console.error(function cZ(d){let _=2;return d.replace(/\n/g,()=>"\n"+function uZ(d){return d>=1e3?d.toString():("  "+d).slice(-3)}(_++)+":")}(T))),tx.enabled&&(tx.compiledLOC+=T.match(/\n/g).length+1),A}function ku(d,_,T){const x=d.get(_);return x?(0,pd.Vx)(x,T):(d.set(_,Array.from(T)),!0)}const tx={compiledLOC:0,numUniforms:0,enabled:!1};class dZ{constructor(_){this._rctx=_,this._store=new VK.r}dispose(){this._store.forEach(_=>_.forEach(T=>T.dispose())),this._store.clear()}acquire(_,T,x,A){const U=this._store.get(_,T);if((0,Qe.pC)(U))return U.ref(),U;const ne=new lZ(this._rctx,_,T,x,A);return ne.ref(),this._store.set(_,T,ne),ne}get test(){let _=0;return this._store.forEach(T=>T.forEach(x=>_+=x.hasGLName?2:1)),{cachedWebGLObjects:_}}}var KL=v(2757),M0=v(40852);function ZL(d,_){d.resetState();const T=new Aa.X(d,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,wrapMode:xt.e8.CLAMP_TO_EDGE,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.NEAREST,width:1,height:1}),x=Ra.f.createVertex(d,xt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),A=new _y.U(d,new Map([["position",0]]),{geometry:[new M0.G("position",2,xt.g.UNSIGNED_SHORT,0,4)]},{geometry:x}),U=(0,ir.f)(5633261.287538229,2626832.878767164,1434988.0495278358),ne=(0,ir.f)(5633271.46742708,2626873.6381334523,1434963.231608387),fe=function hZ(d,_,T,x){const ne=d.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${x?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),fe=new Float32Array(6);(0,KL.LF)(_,fe,3);const Oe=new Float32Array(6);return(0,KL.LF)(T,Oe,3),d.useProgram(ne),ne.setUniform3f("u_highA",fe[0],fe[2],fe[4]),ne.setUniform3f("u_lowA",fe[1],fe[3],fe[5]),ne.setUniform3f("u_highB",Oe[0],Oe[2],Oe[4]),ne.setUniform3f("u_lowB",Oe[1],Oe[3],Oe[5]),ne}(d,U,ne,_);d.bindFramebuffer(T),d.setViewport(0,0,1,1),d.bindVAO(A),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4);const Oe=new Uint8Array(4);T.readPixels(0,0,1,1,xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,Oe),fe.dispose(),A.dispose(!1),x.dispose(),T.dispose();const we=(U[2]-ne[2])/25,Ze=(0,ib.v)(Oe);return Math.abs(we-Ze)}var $L,XL,kL={exports:{}};$L=kL,void 0!==(XL=function(){var T={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},x=null,A=null;function U(mt){if(null==x)for(var Mt in x={},A={},mt)"number"==typeof mt[Mt]&&(x[mt[Mt]]=Mt,A[Mt]=mt[Mt])}function ne(){if(null==x)throw"WebGLDebugUtils.init(ctx) not called"}function Oe(mt){ne();var Mt=x[mt];return void 0!==Mt?"gl."+Mt:"/*UNKNOWN WebGL ENUM*/ 0x"+mt.toString(16)}function we(mt,Mt,Pt,Nt){var Bt;if(void 0!==(Bt=T[mt])&&void 0!==(Bt=Bt[Mt])&&Bt[Pt]){if("object"==typeof Bt[Pt]&&void 0!==Bt[Pt].enumBitwiseOr){for(var Zt=Bt[Pt].enumBitwiseOr,nr=0,Jt=[],Rr=0;Rr<Zt.length;++Rr){var Br=A[Zt[Rr]];0!=(Nt&Br)&&(nr|=Br,Jt.push(Oe(Br)))}return nr===Nt?Jt.join(" | "):Oe(Nt)}return Oe(Nt)}return null===Nt?"null":void 0===Nt?"undefined":Nt.toString()}function it(mt,Mt,Pt){mt.__defineGetter__(Pt,function(){return Mt[Pt]}),mt.__defineSetter__(Pt,function(Nt){Mt[Pt]=Nt})}function dt(mt){var Mt=mt.getParameter(mt.MAX_VERTEX_ATTRIBS),Pt=mt.createBuffer();mt.bindBuffer(mt.ARRAY_BUFFER,Pt);for(var Nt=0;Nt<Mt;++Nt)mt.disableVertexAttribArray(Nt),mt.vertexAttribPointer(Nt,4,mt.FLOAT,!1,0,0),mt.vertexAttrib1f(Nt,0);mt.deleteBuffer(Pt);var Bt=mt.getParameter(mt.MAX_TEXTURE_IMAGE_UNITS);for(Nt=0;Nt<Bt;++Nt)mt.activeTexture(mt.TEXTURE0+Nt),mt.bindTexture(mt.TEXTURE_CUBE_MAP,null),mt.bindTexture(mt.TEXTURE_2D,null);for(mt.activeTexture(mt.TEXTURE0),mt.useProgram(null),mt.bindBuffer(mt.ARRAY_BUFFER,null),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,null),mt.bindFramebuffer(mt.FRAMEBUFFER,null),mt.bindRenderbuffer(mt.RENDERBUFFER,null),mt.disable(mt.BLEND),mt.disable(mt.CULL_FACE),mt.disable(mt.DEPTH_TEST),mt.disable(mt.DITHER),mt.disable(mt.SCISSOR_TEST),mt.blendColor(0,0,0,0),mt.blendEquation(mt.FUNC_ADD),mt.blendFunc(mt.ONE,mt.ZERO),mt.clearColor(0,0,0,0),mt.clearDepth(1),mt.clearStencil(-1),mt.colorMask(!0,!0,!0,!0),mt.cullFace(mt.BACK),mt.depthFunc(mt.LESS),mt.depthMask(!0),mt.depthRange(0,1),mt.frontFace(mt.CCW),mt.hint(mt.GENERATE_MIPMAP_HINT,mt.DONT_CARE),mt.lineWidth(1),mt.pixelStorei(mt.PACK_ALIGNMENT,4),mt.pixelStorei(mt.UNPACK_ALIGNMENT,4),mt.pixelStorei(mt.UNPACK_FLIP_Y_WEBGL,!1),mt.pixelStorei(mt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),mt.UNPACK_COLORSPACE_CONVERSION_WEBGL&&mt.pixelStorei(mt.UNPACK_COLORSPACE_CONVERSION_WEBGL,mt.BROWSER_DEFAULT_WEBGL),mt.polygonOffset(0,0),mt.sampleCoverage(1,!1),mt.scissor(0,0,mt.canvas.width,mt.canvas.height),mt.stencilFunc(mt.ALWAYS,0,4294967295),mt.stencilMask(4294967295),mt.stencilOp(mt.KEEP,mt.KEEP,mt.KEEP),mt.viewport(0,0,mt.canvas.width,mt.canvas.height),mt.clear(mt.COLOR_BUFFER_BIT|mt.DEPTH_BUFFER_BIT|mt.STENCIL_BUFFER_BIT);mt.getError(););}return{init:U,mightBeEnum:function fe(mt){return ne(),void 0!==x[mt]},glEnumToString:Oe,glFunctionArgToString:we,glFunctionArgsToString:function Ze(mt,Mt){for(var Pt="",Nt=Mt.length,Bt=0;Bt<Nt;++Bt)Pt+=(0==Bt?"":", ")+we(mt,Nt,Bt,Mt[Bt]);return Pt},makeDebugContext:function lt(mt,Mt,Pt,Nt){Nt=Nt||mt,U(mt),Mt=Mt||function(Br,$r,Yr){for(var cs="",Xr=Yr.length,os=0;os<Xr;++os)cs+=(0==os?"":", ")+we($r,Xr,os,Yr[os]);!function(mt){window.console&&window.console.error?window.console.error(mt):function(mt){window.console&&window.console.log&&window.console.log(mt)}(mt)}("WebGL error "+Oe(Br)+" in "+$r+"("+cs+")")};var Bt={};function Zt(Br,$r){return function(){Pt&&Pt($r,arguments);var Yr=Br[$r].apply(Br,arguments),cs=Nt.getError();return 0!=cs&&(Bt[cs]=!0,Mt(cs,$r,arguments)),Yr}}var nr={};for(var Jt in mt)if("function"==typeof mt[Jt])if("getExtension"!=Jt)nr[Jt]=Zt(mt,Jt);else{var Rr=Zt(mt,Jt);nr[Jt]=function(){return lt(Rr.apply(mt,arguments),Mt,Pt,Nt)}}else it(nr,mt,Jt);return nr.getError=function(){for(var Br in Bt)if(Bt.hasOwnProperty(Br)&&Bt[Br])return Bt[Br]=!1,Br;return mt.NO_ERROR},nr},makeLostContextSimulatingCanvas:function Tt(mt){var Mt,Pt,Nt=[],Bt=[],Zt={},nr=1,Jt=!1,Rr=[],Br=0,$r=0,Yr=!1,cs=0,Xr={};function os(ss){return"function"==typeof ss?ss:function(Ms){ss.handleEvent(Ms)}}mt.getContext=(Pt=mt.getContext,function(){var ss=Pt.apply(mt,arguments);if(ss instanceof WebGLRenderingContext){if(ss!=Mt){if(Mt)throw"got different context";Zt=ms(Mt=ss)}return Zt}return ss});var br=function(ss){Nt.push(os(ss))},Vr=function(ss){Bt.push(os(ss))};function Gr(){++$r,Jt||Br==$r&&mt.loseContext()}function zr(ss,Ms){var Hs=ss[Ms];return function(){if(Gr(),!Jt)return Hs.apply(ss,arguments)}}function ls(ss){return{statusMessage:ss,preventDefault:function(){Yr=!0}}}return function lr(ss){var Ms=ss.addEventListener;ss.addEventListener=function(Hs,Js,Gs){switch(Hs){case"webglcontextlost":br(Js);break;case"webglcontextrestored":Vr(Js);break;default:Ms.apply(ss,arguments)}}}(mt),mt.loseContext=function(){if(!Jt){for(Jt=!0,Br=0,++nr;Mt.getError(););(function wr(){for(var ss=Object.keys(Xr),Ms=0;Ms<ss.length;++Ms)delete Xr[ss]})(),Xr[Mt.CONTEXT_LOST_WEBGL]=!0;var ss=ls("context lost"),Ms=Nt.slice();setTimeout(function(){for(var Hs=0;Hs<Ms.length;++Hs)Ms[Hs](ss);cs>=0&&setTimeout(function(){mt.restoreContext()},cs)},0)}},mt.restoreContext=function(){Jt&&Bt.length&&setTimeout(function(){if(!Yr)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function rs(){for(var ss=0;ss<Rr.length;++ss){var Ms=Rr[ss];Ms instanceof WebGLBuffer?Mt.deleteBuffer(Ms):Ms instanceof WebGLFramebuffer?Mt.deleteFramebuffer(Ms):Ms instanceof WebGLProgram?Mt.deleteProgram(Ms):Ms instanceof WebGLRenderbuffer?Mt.deleteRenderbuffer(Ms):Ms instanceof WebGLShader?Mt.deleteShader(Ms):Ms instanceof WebGLTexture&&Mt.deleteTexture(Ms)}})(),dt(Mt),Jt=!1,$r=0,Yr=!1;for(var ss=Bt.slice(),Ms=ls("context restored"),Hs=0;Hs<ss.length;++Hs)ss[Hs](Ms)},0)},mt.loseContextInNCalls=function(ss){if(Jt)throw"You can not ask a lost contet to be lost";Br=$r+ss},mt.getNumCalls=function(){return $r},mt.setRestoreTimeout=function(ss){cs=ss},mt;function ms(ss){for(var Ms in ss)"function"==typeof ss[Ms]?Zt[Ms]=zr(ss,Ms):it(Zt,ss,Ms);Zt.getError=function(){if(Gr(),!Jt)for(;_s=Mt.getError();)Xr[_s]=!0;for(var _s in Xr)if(Xr[_s])return delete Xr[_s],_s;return Zt.NO_ERROR};for(var Hs=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Js=0;Js<Hs.length;++Js){var Gs=Hs[Js];Zt[Gs]=function(_s){return function(){if(Gr(),Jt)return null;var Is=_s.apply(ss,arguments);return Is.__webglDebugContextLostId__=nr,Rr.push(Is),Is}}(ss[Gs])}var bs=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Js=0;Js<bs.length;++Js)Zt[Gs=bs[Js]]=function(_s){return function(){return Gr(),Jt?null:_s.apply(ss,arguments)}}(Zt[Gs]);var _s,ps=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Js=0;Js<ps.length;++Js)Zt[Gs=ps[Js]]=function(_s){return function(){return Gr(),!Jt&&_s.apply(ss,arguments)}}(Zt[Gs]);return Zt.checkFramebufferStatus=(_s=Zt.checkFramebufferStatus,function(){return Gr(),Jt?Zt.FRAMEBUFFER_UNSUPPORTED:_s.apply(ss,arguments)}),Zt.getAttribLocation=function(_s){return function(){return Gr(),Jt?-1:_s.apply(ss,arguments)}}(Zt.getAttribLocation),Zt.getVertexAttribOffset=function(_s){return function(){return Gr(),Jt?0:_s.apply(ss,arguments)}}(Zt.getVertexAttribOffset),Zt.isContextLost=function(){return Jt},Zt}},resetToInitialState:dt}}())&&($L.exports=XL),new M0.G("a_pos",2,xt.g.BYTE,0,2),new M0.G("a_pos",2,xt.g.BYTE,0,4),new M0.G("a_tex",2,xt.g.BYTE,2,4);const fZ={geometry:[new M0.G("a_pos",2,xt.g.UNSIGNED_SHORT,0,4)]};function rx(){return rx=(0,kr.Z)(function*(d){const _=new Image;if(_.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",_.width=5,_.height=5,yield _.decode(),!d.gl)return!0;const T=new Aa.X(d,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,wrapMode:xt.e8.CLAMP_TO_EDGE,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.NEAREST,width:1,height:1}),x=Ra.f.createVertex(d,xt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),A=new _y.U(d,new Map([["a_pos",0]]),fZ,{geometry:x}),fe=d.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));d.useProgram(fe);const Oe=new Ro.x(d,{dataType:xt.Br.UNSIGNED_BYTE,pixelFormat:xt.VI.RGBA,preMultiplyAlpha:!1,wrapMode:xt.e8.CLAMP_TO_EDGE,samplingMode:xt.cw.LINEAR},_);d.bindTexture(Oe,0),fe.setUniform1i("u_texture",0);const we=d.getBoundFramebufferObject(),{x:Ze,y:it,width:lt,height:dt}=d.getViewport();d.bindFramebuffer(T),d.setViewport(0,0,1,1),d.setClearColor(0,0,0,0),d.setBlendingEnabled(!1),d.clearSafe(xt.lk.COLOR_BUFFER_BIT),d.bindVAO(A),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4);const Tt=new Uint8Array(4);return T.readPixels(0,0,1,1,xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,Tt),fe.dispose(),A.dispose(!1),x.dispose(),T.dispose(),Oe.dispose(),d.setViewport(Ze,it,lt,dt),d.bindFramebuffer(we),_.src="",255===Tt[0]}),rx.apply(this,arguments)}class gZ{constructor(_){this.context=_,this._floatBufferBlendWorking=function pZ(d){if(!d.gl)return!1;if(d.type===cl.zO.WEBGL1)return!(!d.capabilities.textureFloat?.textureFloat||!d.capabilities.colorBufferFloat?.textureFloat);if(!(d.capabilities.textureFloat?.textureFloat&&d.capabilities.colorBufferFloat?.textureFloat&&d.capabilities.colorBufferFloat?.floatBlend))return!1;const _=new Aa.X(d,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,wrapMode:xt.e8.CLAMP_TO_EDGE,pixelFormat:xt.VI.RGBA,dataType:xt.Br.FLOAT,internalFormat:xt.lP.RGBA32F,samplingMode:xt.cw.NEAREST,width:1,height:1}),T=Ra.f.createVertex(d,xt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),x=new _y.U(d,new Map([["a_pos",0]]),{geometry:[new M0.G("a_pos",2,xt.g.UNSIGNED_SHORT,0,4)]},{geometry:T}),ne=d.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));d.useProgram(ne);const fe=d.getBoundFramebufferObject(),{x:Oe,y:we,width:Ze,height:it}=d.getViewport();d.bindFramebuffer(_),d.setViewport(0,0,1,1),d.bindVAO(x),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4);const lt=(0,Ds.sm)({blending:yf.IB});d.setPipelineState(lt),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4),kL.exports.init(d);const dt=d.gl.getError();return d.setViewport(Oe,we,Ze,it),d.bindFramebuffer(fe),ne.dispose(),x.dispose(!1),T.dispose(),_.dispose(),1282!==dt||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(_),function mZ(d){return rx.apply(this,arguments)}(_).then(T=>this._svgAlwaysPremultipliesAlpha=!T)}get floatBufferBlendWorking(){if((0,Qe.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if((0,Qe.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if((0,Qe.Wi)(this._doublePrecisionRequiresObfuscation)){const _=ZL(this.context,!1),T=ZL(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==_&&(0===T||_/T>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return(0,Qe.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=function _Z(d){const _=new Aa.X(d,{colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.NONE},{target:xt.No.TEXTURE_2D,wrapMode:xt.e8.CLAMP_TO_EDGE,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.NEAREST,width:1,height:1}),A=new Uint8Array(4),U=Ra.f.createVertex(d,xt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),ne=new _y.U(d,new Map([["a_position",0]]),{geometry:[new M0.G("a_position",2,xt.g.SHORT,0,4)]},{geometry:U}),fe=d.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]]));d.useProgram(fe);const Oe=new Ro.x(d,{target:xt.No.TEXTURE_2D,wrapMode:xt.e8.CLAMP_TO_EDGE,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,samplingMode:xt.cw.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));fe.setUniform1i("u_texture",0),d.bindTexture(Oe,0);const we=d.getBoundFramebufferObject();d.bindFramebuffer(_),d.useProgram(fe);const{x:Ze,y:it,width:lt,height:dt}=d.getViewport();d.setViewport(0,0,1,1),d.bindVAO(ne),d.drawArrays(xt.MX.TRIANGLE_STRIP,0,4),d.setViewport(Ze,it,lt,dt),_.readPixels(0,0,1,1,xt.VI.RGBA,xt.Br.UNSIGNED_BYTE,A),fe.dispose(),ne.dispose(!1),U.dispose(),_.dispose();const Tt=255!==A[0]||255!==A[1]||255!==A[2]||255!==A[3];return Tt&&Us.Z.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${A[0]}.${A[1]}.${A[2]}.${A[3]}]`),d.bindFramebuffer(we),Tt}(this.context)),this._ignoresSamplerPrecision}}function Ty(d,_,T,x,A){if(x&&(0,wl.Z)(d))return!0;if(_[T])return!1;for(const U of A)if(d.getExtension(U))return!0;return!1}class SZ{constructor(_,T){this._gl=_,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=T.disabledExtensions||{},this._debugWebGLExtensions=T.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=function yZ(d,_){if(_.disjointTimerQuery)return null;if((0,wl.Z)(d))return{drawBuffers:d.drawBuffers.bind(d),MAX_DRAW_BUFFERS:d.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:d.MAX_COLOR_ATTACHMENTS};if(_.drawBuffers)return null;const T=d.getExtension("WEBGL_draw_buffers");return T?{drawBuffers:T.drawBuffersWEBGL.bind(T),MAX_DRAW_BUFFERS:T.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:T.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=function vZ(d){if((0,wl.Z)(d))return d;const _=d.getExtension("ANGLE_instanced_arrays");return _?{drawArraysInstanced:_.drawArraysInstancedANGLE.bind(_),drawElementsInstanced:_.drawElementsInstancedANGLE.bind(_),vertexAttribDivisor:_.vertexAttribDivisorANGLE.bind(_)}:null}(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=function DZ(d,_){if((0,wl.Z)(d))return{createVertexArray:d.createVertexArray.bind(d),deleteVertexArray:d.deleteVertexArray.bind(d),bindVertexArray:d.bindVertexArray.bind(d)};if(_.vao)return null;const T=d.getExtension("OES_vertex_array_object")||d.getExtension("MOZ_OES_vertex_array_object")||d.getExtension("WEBKIT_OES_vertex_array_object");return T?{createVertexArray:T.createVertexArrayOES.bind(T),deleteVertexArray:T.deleteVertexArrayOES.bind(T),bindVertexArray:T.bindVertexArrayOES.bind(T)}:null}(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=function EZ(d,_){if(_.compressedTextureETC)return null;const T=d.getExtension("WEBGL_compressed_texture_etc");return T?{COMPRESSED_R11_EAC:T.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:T.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:T.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:T.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:T.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:T.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:T.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:T.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:T.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:T.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=function bZ(d,_){if(_.compressedTextureS3TC)return null;const T=d.getExtension("WEBGL_compressed_texture_s3tc");return T?{COMPRESSED_RGB_S3TC_DXT1:T.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:T.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:T.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:T.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=function TZ(d,_){if(_.textureFilterAnisotropic)return null;const T=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return T?{MAX_TEXTURE_MAX_ANISOTROPY:T.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:T.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=function LK(d,_){if(_.disjointTimerQuery)return null;let T=d.getExtension("EXT_disjoint_timer_query_webgl2");return T&&(0,wl.Z)(d)?new CL(()=>d.createQuery(),x=>{d.deleteQuery(x),Yd=!1},x=>d.getQueryParameter(x,d.QUERY_RESULT_AVAILABLE),x=>d.getQueryParameter(x,d.QUERY_RESULT),()=>d.getParameter(T.GPU_DISJOINT_EXT),x=>{Yd||(Yd=!0,d.beginQuery(T.TIME_ELAPSED_EXT,x))},()=>{d.endQuery(T.TIME_ELAPSED_EXT),Yd=!1},x=>T.queryCounterEXT(x,T.TIMESTAMP_EXT),()=>d.getQuery(T.TIMESTAMP_EXT,T.QUERY_COUNTER_BITS_EXT)):(T=d.getExtension("EXT_disjoint_timer_query"),T?new CL(()=>T.createQueryEXT(),x=>{T.deleteQueryEXT(x),Yd=!1},x=>T.getQueryObjectEXT(x,T.QUERY_RESULT_AVAILABLE_EXT),x=>T.getQueryObjectEXT(x,T.QUERY_RESULT_EXT),()=>d.getParameter(T.GPU_DISJOINT_EXT),x=>{Yd||(Yd=!0,T.beginQueryEXT(T.TIME_ELAPSED_EXT,x))},()=>{T.endQueryEXT(T.TIME_ELAPSED_EXT),Yd=!1},x=>T.queryCounterEXT(x,T.TIMESTAMP_EXT),()=>T.getQueryEXT(T.TIMESTAMP_EXT,T.QUERY_COUNTER_BITS_EXT)):null)}(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=function MZ(d,_){if((0,wl.Z)(d))return{textureFloat:!0,textureFloatLinear:!_.textureFloatLinear&&!!d.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:d.HALF_FLOAT,R16F:d.R16F,RG16F:d.RG16F,RGBA16F:d.RGBA16F,R32F:d.R32F,RG32F:d.RG32F,RGBA32F:d.RGBA32F,R11F_G11F_B10F:d.R11F_G11F_B10F,RGB16F:d.RGB16F};if(d instanceof WebGLRenderingContext){const T=!_.textureHalfFloat&&d.getExtension("OES_texture_half_float");return{textureFloat:!_.textureFloat&&!!d.getExtension("OES_texture_float"),textureFloatLinear:!_.textureFloatLinear&&!!d.getExtension("OES_texture_float_linear"),textureHalfFloat:!!T,textureHalfFloatLinear:!_.textureHalfFloatLinear&&!!d.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:T?T.HALF_FLOAT_OES:void 0}}return null}(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=function PZ(d,_){if((0,wl.Z)(d)){const T=!_.colorBufferHalfFloat&&d.getExtension("EXT_color_buffer_half_float")||!_.colorBufferFloat&&d.getExtension("EXT_color_buffer_float"),x=!_.colorBufferFloat&&d.getExtension("EXT_color_buffer_float"),A=!_.floatBlend&&!_.colorBufferFloat&&d.getExtension("EXT_float_blend");return T||x||A?{textureFloat:!!x,textureHalfFloat:!!T,floatBlend:!!A,R16F:d.R16F,RG16F:d.RG16F,RGBA16F:d.RGBA16F,R32F:d.R32F,RG32F:d.RG32F,RGBA32F:d.RGBA32F,R11F_G11F_B10F:d.R11F_G11F_B10F,RGB16F:d.RGB16F}:null}if(d instanceof WebGLRenderingContext){const T=!_.colorBufferHalfFloat&&d.getExtension("EXT_color_buffer_half_float"),x=!_.colorBufferFloat&&d.getExtension("WEBGL_color_buffer_float"),A=!_.floatBlend&&!_.colorBufferFloat&&d.getExtension("EXT_float_blend");return T||x||A?{textureFloat:!!x,textureHalfFloat:!!T,floatBlend:!!A,RGBA16F:T?T.RGBA16F_EXT:void 0,RGB16F:T?T.RGB16F_EXT:void 0,RGBA32F:x?x.RGBA32F_EXT:void 0}:null}return null}(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=function CZ(d,_){if((0,wl.Z)(d))return{MIN:d.MIN,MAX:d.MAX};if(_.blendMinMax)return null;{const T=d.getExtension("EXT_blend_minmax");return T?{MIN:T.MIN_EXT,MAX:T.MAX_EXT}:null}}(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return null===this._depthTexture&&(this._depthTexture=Ty(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return null===this._standardDerivatives&&(this._standardDerivatives=Ty(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return null===this._shaderTextureLOD&&(this._shaderTextureLOD=Ty(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return null===this._fragDepth&&(this._fragDepth=Ty(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=function xZ(d,_){const T=_.loseContext&&d.getExtension("WEBGL_lose_context");return T?{loseRenderingContext:()=>T.loseContext()}:null}(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=function OZ(d,_){if(!(0,wl.Z)(d)||_.textureNorm16)return null;const T=d.getExtension("EXT_texture_norm16");return T?{R16:T.R16_EXT,RG16:T.RG16_EXT,RGB16:T.RGB16_EXT,RGBA16:T.RGBA16_EXT,R16_SNORM:T.R16_SNORM_EXT,RG16_SNORM:T.RG16_SNORM_EXT,RGB16_SNORM:T.RGB16_SNORM_EXT,RGBA16_SNORM:T.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return null===this._textureFloatLinear&&(this._textureFloatLinear=Ty(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(_){return this[_]}}class AZ{constructor(_,T){this.gl=_,this.instanceCounter=new WK,this.programCache=new dZ(this),this._state=new xL,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=(0,wl.Z)(_)?cl.zO.WEBGL2:cl.zO.WEBGL1,this._loadExtensions(),this.configure(T)}configure(_){this._capabilities=new SZ(this.gl,_),this._parameters=this._loadParameters(_);const T=this.gl.getParameter(this.gl.VIEWPORT);this._state=new xL,this._state.viewport={x:T[0],y:T[1],width:T[2],height:T[3]},this._stateTracker=new Ds.jp({setBlending:x=>{if(x){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(x.opRgb,x.opAlpha),this.setBlendFunctionSeparate(x.srcRgb,x.dstRgb,x.srcAlpha,x.dstAlpha);const A=x.color;this.setBlendColor(A.r,A.g,A.b,A.a)}else this.setBlendingEnabled(!1)},setCulling:x=>{x?(this.setFaceCullingEnabled(!0),this.setCullFace(x.face),this.setFrontFace(x.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:x=>{x?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(x.factor,x.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:x=>{x?(this.setDepthTestEnabled(!0),this.setDepthFunction(x.func)):this.setDepthTestEnabled(!1)},setStencilTest:x=>{if(x){this.setStencilTestEnabled(!0);const A=x.function;this.setStencilFunction(A.func,A.ref,A.mask);const U=x.operation;this.setStencilOp(U.fail,U.zFail,U.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:x=>{x?(this.setDepthWriteEnabled(!0),this.setDepthRange(x.zNear,x.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:x=>{x?this.setColorMask(x.r,x.g,x.b,x.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:x=>{this.setStencilWriteMask(x?x.mask:0)}}),this.enforceState(),this._driverTest=new gZ(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(xt.w0.ARRAY_BUFFER),this.unbindBuffer(xt.w0.ELEMENT_ARRAY_BUFFER),(0,wl.Z)(this.gl)&&(this.unbindBuffer(xt.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.w0.COPY_READ_BUFFER),this.unbindBuffer(xt.w0.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,(0,vu.hZ)()&&this.instanceCounter.printResourceCount()}setPipelineState(_){this._stateTracker.setPipeline(_)}setBlendingEnabled(_){this._state.blend!==_&&(!0===_?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=_,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(_,T){for(let x=0;x<_.length;++x)this._state.textureUnitMap[_[x]]=null;T>=0&&(this._state.activeTexture=T)}externalVertexArrayObjectUpdate(){const _=this.capabilities.vao;_&&(_.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(_,T,x,A){_===this._state.blendColor.r&&T===this._state.blendColor.g&&x===this._state.blendColor.b&&A===this._state.blendColor.a||(this.gl.blendColor(_,T,x,A),this._state.blendColor.r=_,this._state.blendColor.g=T,this._state.blendColor.b=x,this._state.blendColor.a=A,this._stateTracker.invalidateBlending())}setBlendFunction(_,T){_===this._state.blendFunction.srcRGB&&T===this._state.blendFunction.dstRGB||(this.gl.blendFunc(_,T),this._state.blendFunction.srcRGB=_,this._state.blendFunction.srcAlpha=_,this._state.blendFunction.dstRGB=T,this._state.blendFunction.dstAlpha=T,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(_,T,x,A){this._state.blendFunction.srcRGB===_&&this._state.blendFunction.srcAlpha===x&&this._state.blendFunction.dstRGB===T&&this._state.blendFunction.dstAlpha===A||(this.gl.blendFuncSeparate(_,T,x,A),this._state.blendFunction.srcRGB=_,this._state.blendFunction.srcAlpha=x,this._state.blendFunction.dstRGB=T,this._state.blendFunction.dstAlpha=A,this._stateTracker.invalidateBlending())}setBlendEquation(_){this._state.blendEquation.mode!==_&&(this.gl.blendEquation(_),this._state.blendEquation.mode=_,this._state.blendEquation.modeAlpha=_,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(_,T){this._state.blendEquation.mode===_&&this._state.blendEquation.modeAlpha===T||(this.gl.blendEquationSeparate(_,T),this._state.blendEquation.mode=_,this._state.blendEquation.modeAlpha=T,this._stateTracker.invalidateBlending())}setColorMask(_,T,x,A){this._state.colorMask.r===_&&this._state.colorMask.g===T&&this._state.colorMask.b===x&&this._state.colorMask.a===A||(this.gl.colorMask(_,T,x,A),this._state.colorMask.r=_,this._state.colorMask.g=T,this._state.colorMask.b=x,this._state.colorMask.a=A,this._stateTracker.invalidateColorWrite())}setClearColor(_,T,x,A){this._state.clearColor.r===_&&this._state.clearColor.g===T&&this._state.clearColor.b===x&&this._state.clearColor.a===A||(this.gl.clearColor(_,T,x,A),this._state.clearColor.r=_,this._state.clearColor.g=T,this._state.clearColor.b=x,this._state.clearColor.a=A)}setFaceCullingEnabled(_){this._state.faceCulling!==_&&(!0===_?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=_,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(_){this._state.polygonOffsetFill!==_&&(!0===_?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=_,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(_,T){this._state.polygonOffset[0]===_&&this._state.polygonOffset[1]===T||(this._state.polygonOffset[0]=_,this._state.polygonOffset[1]=T,this.gl.polygonOffset(_,T),this._stateTracker.invalidatePolygonOffset())}setCullFace(_){this._state.cullFace!==_&&(this.gl.cullFace(_),this._state.cullFace=_,this._stateTracker.invalidateCulling())}setFrontFace(_){this._state.frontFace!==_&&(this.gl.frontFace(_),this._state.frontFace=_,this._stateTracker.invalidateCulling())}setScissorTestEnabled(_){this._state.scissorTest!==_&&(!0===_?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=_)}setScissorRect(_,T,x,A){this._state.scissorRect.x===_&&this._state.scissorRect.y===T&&this._state.scissorRect.width===x&&this._state.scissorRect.height===A||(this.gl.scissor(_,T,x,A),this._state.scissorRect.x=_,this._state.scissorRect.y=T,this._state.scissorRect.width=x,this._state.scissorRect.height=A)}setDepthTestEnabled(_){this._state.depthTest!==_&&(!0===_?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=_,this._stateTracker.invalidateDepthTest())}setClearDepth(_){this._state.clearDepth!==_&&(this.gl.clearDepth(_),this._state.clearDepth=_)}setDepthFunction(_){this._state.depthFunction!==_&&(this.gl.depthFunc(_),this._state.depthFunction=_,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(_){this._state.depthWrite!==_&&(this.gl.depthMask(_),this._state.depthWrite=_,this._stateTracker.invalidateDepthWrite())}setDepthRange(_,T){this._state.depthRange.zNear===_&&this._state.depthRange.zFar===T||(this.gl.depthRange(_,T),this._state.depthRange.zNear=_,this._state.depthRange.zFar=T,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(_){this._state.stencilTest!==_&&(!0===_?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=_,this._stateTracker.invalidateStencilTest())}setClearStencil(_){_!==this._state.clearStencil&&(this.gl.clearStencil(_),this._state.clearStencil=_)}setStencilFunction(_,T,x){this._state.stencilFunction.func===_&&this._state.stencilFunction.ref===T&&this._state.stencilFunction.mask===x||(this.gl.stencilFunc(_,T,x),this._state.stencilFunction.face=xt.LR.FRONT_AND_BACK,this._state.stencilFunction.func=_,this._state.stencilFunction.ref=T,this._state.stencilFunction.mask=x,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(_,T,x,A){this._state.stencilFunction.face===_&&this._state.stencilFunction.func===T&&this._state.stencilFunction.ref===x&&this._state.stencilFunction.mask===A||(this.gl.stencilFuncSeparate(_,T,x,A),this._state.stencilFunction.face=_,this._state.stencilFunction.func=T,this._state.stencilFunction.ref=x,this._state.stencilFunction.mask=A,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(_){this._state.stencilWriteMask!==_&&(this.gl.stencilMask(_),this._state.stencilWriteMask=_,this._stateTracker.invalidateStencilWrite())}setStencilOp(_,T,x){this._state.stencilOperation.face===xt.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===_&&this._state.stencilOperation.zFail===T&&this._state.stencilOperation.zPass===x||(this.gl.stencilOp(_,T,x),this._state.stencilOperation.face=xt.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=_,this._state.stencilOperation.zFail=T,this._state.stencilOperation.zPass=x,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(_,T,x,A){this._state.stencilOperation.face===_&&this._state.stencilOperation.fail===T&&this._state.stencilOperation.zFail===x&&this._state.stencilOperation.zPass===A||(this.gl.stencilOpSeparate(_,T,x,A),this._state.stencilOperation.face=_,this._state.stencilOperation.fail=T,this._state.stencilOperation.zFail=x,this._state.stencilOperation.zPass=A,this._stateTracker.invalidateStencilTest())}setActiveTexture(_,T=!1){const x=this._state.activeTexture;return _>=0&&(T||_!==this._state.activeTexture)&&(this.gl.activeTexture(xt.Ld+_),this._state.activeTexture=_),x}clear(_){_&&this.gl.clear(_)}clearSafe(_,T=255){_&&(_&xt.lk.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),_&xt.lk.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),_&xt.lk.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(T),this.gl.clear(_))}drawArrays(_,T,x){if((0,vu.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=JL(_,x)),this.gl.drawArrays(_,T,x),(0,vu.hZ)()){const A=(0,No.HH)(this);A&&console.error("drawArrays:",A)}}drawElements(_,T,x,A){if((0,vu.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=JL(_,T)),this.gl.drawElements(_,T,x,A),(0,vu.hZ)()){const U=(0,No.HH)(this);if(U){const ne=this.getBoundVAO(),fe=ne?.indexBuffer,Oe=ne?.vertexBuffers,we={indexBuffer:fe,vertexBuffers:Oe},Ze={mode:_,count:T,type:x,offset:A},it=(0,Qe.yw)(fe,Tt=>Tt.size)??0,lt=A+T;console.error(`drawElements: ${U}${it<lt?`. Buffer is too small. Attempted to draw index ${lt} of ${it}`:""}`,{args:Ze,vao:we})}}}logInfo(){(0,vu.hZ)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,vu.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(_,T,x,A){x=Math.max(Math.round(x),1),A=Math.max(Math.round(A),1);const U=this._state.viewport;U.x===_&&U.y===T&&U.width===x&&U.height===A||(U.x=_,U.y=T,U.width=x,U.height=A,this.gl.viewport(_,T,x,A))}getViewport(){const _=this._state.viewport;return{x:_.x,y:_.y,width:_.width,height:_.height}}useProgram(_){this._state.program!==_&&(this._state.program?.stop(),this._state.program=_,this.gl.useProgram(_?.glName??null))}bindTexture(_,T,x=!1){(T>=this.parameters.maxTextureImageUnits||T<0)&&console.error("Input texture unit is out of range of available units!");const A=this._state.textureUnitMap[T];return(0,Qe.Wi)(_)||null==_.glName?((0,Qe.pC)(A)&&(this.setActiveTexture(T,x),this.gl.bindTexture(A.descriptor.target,null)),this._state.textureUnitMap[T]=null,A):x||A!==_?(this.setActiveTexture(T,x),this.gl.bindTexture(_.descriptor.target,_.glName),_.applyChanges(),this._state.textureUnitMap[T]=_,A):(_.isDirty&&(this.setActiveTexture(T,x),_.applyChanges()),A)}unbindTexture(_){if(!(0,Qe.Wi)(_))for(let T=0;T<this.parameters.maxTextureImageUnits;T++)this._state.textureUnitMap[T]===_&&(this.bindTexture(null,T),this._state.textureUnitMap[T]=null)}bindFramebuffer(_,T=!1){if(T||this._state.readFramebuffer!==_||this._state.drawFramebuffer!==_){if((0,Qe.Wi)(_))return this.gl.bindFramebuffer(xt.qi.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);_.initializeAndBind(xt.qi.FRAMEBUFFER),this._state.readFramebuffer=_,this._state.drawFramebuffer=_}}bindFramebufferSeparate(_,T,x=!1){const A=T===xt.qi.READ_FRAMEBUFFER;(x||(A?this._state.readFramebuffer:this._state.drawFramebuffer)!==_)&&((0,Qe.Wi)(_)?this.gl.bindFramebuffer(T,null):_.initializeAndBind(T),A?this._state.readFramebuffer=(0,Qe.Pt)(_,null):this._state.drawFramebuffer=(0,Qe.Pt)(_,null))}blitFramebuffer(_,T,x=0,A=0,U=_.width,ne=_.height,fe=0,Oe=0,we=T.width,Ze=T.height,it=xt.lk.COLOR_BUFFER_BIT,lt=xt.cw.NEAREST){this.bindFramebufferSeparate(_,xt.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(T,xt.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(x,A,U,ne,fe,Oe,we,Ze,it,lt)}bindBuffer(_,T){if(_)switch(T??(T=_.bufferType),T){case xt.w0.ARRAY_BUFFER:this._state.vertexBuffer=sc(this.gl,_,T,this._state.vertexBuffer);break;case xt.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sc(this.gl,_,T,this._state.indexBuffer);break;case xt.w0.UNIFORM_BUFFER:this._state.uniformBuffer=sc(this.gl,_,T,this._state.uniformBuffer);break;case xt.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sc(this.gl,_,T,this._state.pixelPackBuffer);break;case xt.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sc(this.gl,_,T,this._state.pixelUnpackBuffer);break;case xt.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=sc(this.gl,_,T,this._state.copyReadBuffer);break;case xt.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sc(this.gl,_,T,this._state.copyWriteBuffer)}}bindRenderbuffer(_){const T=this.gl;_||(T.bindRenderbuffer(T.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==_&&(T.bindRenderbuffer(T.RENDERBUFFER,_.glName),this._state.renderbuffer=_)}_getBufferBinding(_,T){if(T>=this.parameters.maxUniformBufferBindings||T<0)return console.error("Uniform buffer binding point is out of range!"),null;const x=this._state.uniformBufferBindingPoints;let A=x[T];return(0,Qe.Wi)(A)&&(A={buffer:null,offset:0,size:0},x[T]=A),A}bindBufferBase(_,T,x){const A=this._getBufferBinding(_,T);(0,Qe.Wi)(A)||A.buffer===x&&0===A.offset&&0===A.size||(this.gl.bindBufferBase(_,T,x?x.glName:null),A.buffer=x,A.offset=0,A.size=0)}bindBufferRange(_,T,x,A,U){const ne=this._getBufferBinding(_,T);if(!(0,Qe.Wi)(ne)&&(ne.buffer!==x||ne.offset!==A||ne.size!==U)){if(A%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(_,T,x.glName,A,U),ne.buffer=x,ne.offset=A,ne.size=U}}bindUBO(_,T,x,A){(0,Qe.Wi)(T)?this.bindBufferBase(xt.w0.UNIFORM_BUFFER,_,null):((0,vu.hZ)()&&(A??T.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),T.initialize(),void 0!==x&&void 0!==A?this.bindBufferRange(xt.w0.UNIFORM_BUFFER,_,T.buffer,x,A):this.bindBufferBase(xt.w0.UNIFORM_BUFFER,_,T.buffer))}unbindUBO(_){for(let T=0,x=this._state.uniformBufferBindingPoints.length;T<x;T++){const A=this._state.uniformBufferBindingPoints[T];(0,Qe.pC)(A)&&A.buffer===_.buffer&&this.bindBufferBase(xt.w0.UNIFORM_BUFFER,T,null)}}unbindBuffer(_){switch(_){case xt.w0.ARRAY_BUFFER:this._state.vertexBuffer=sc(this.gl,null,_,this._state.vertexBuffer);break;case xt.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sc(this.gl,null,_,this._state.indexBuffer);break;case xt.w0.UNIFORM_BUFFER:this._state.uniformBuffer=sc(this.gl,null,_,this._state.uniformBuffer);break;case xt.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sc(this.gl,null,_,this._state.pixelPackBuffer);break;case xt.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sc(this.gl,null,_,this._state.pixelUnpackBuffer);break;case xt.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=sc(this.gl,null,_,this._state.copyReadBuffer);break;case xt.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sc(this.gl,null,_,this._state.copyWriteBuffer)}}bindVAO(_=null){(0,Qe.Wi)(_)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==_&&(_.bind(),this._state.vertexArrayObject=_)}clientWaitAsync(_=(0,mi.HA)(10)){var T=this;return(0,kr.Z)(function*(){const x=T.gl,A=x.fenceSync(xt.V7.SYNC_GPU_COMMANDS_COMPLETE,0);if(!A)throw new Error("Client wait failed, could not create sync object");let U;T.instanceCounter.increment(xt._g.Sync,A),x.flush();do{yield(0,ws.e4)(_),U=x.clientWaitSync(A,0,0)}while(U===xt.Y5.TIMEOUT_EXPIRED);if(T.instanceCounter.decrement(xt._g.Sync,A),x.deleteSync(A),U===xt.Y5.WAIT_FAILED)throw new Error("Client wait failed")})()}getBoundFramebufferObject(_=xt.qi.FRAMEBUFFER){return _===xt.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(xt.w0.ARRAY_BUFFER),this.unbindBuffer(xt.w0.ELEMENT_ARRAY_BUFFER),(0,wl.Z)(this.gl)&&(this.unbindBuffer(xt.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.w0.COPY_READ_BUFFER),this.unbindBuffer(xt.w0.COPY_WRITE_BUFFER));for(let _=0;_<this.parameters.maxTextureImageUnits;++_)this.bindTexture(null,_);this.setBlendingEnabled(!1),this.setBlendFunction(xt.zi.ONE,xt.zi.ZERO),this.setBlendEquation(xt.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(xt.LR.BACK),this.setFrontFace(xt.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(xt.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(xt.wb.ALWAYS,0,0),this.setStencilOp(xt.xS.KEEP,xt.xS.KEEP,xt.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const _=this.gl,T=this.capabilities.vao;T&&T.bindVertexArray(null);for(let A=0;A<this.parameters.maxVertexAttributes;A++)_.disableVertexAttribArray(A);if(this._state.vertexBuffer?_.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):_.bindBuffer(xt.w0.ARRAY_BUFFER,null),this._state.indexBuffer?_.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):_.bindBuffer(xt.w0.ELEMENT_ARRAY_BUFFER,null),(0,wl.Z)(_)){this._state.uniformBuffer?_.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):_.bindBuffer(xt.w0.UNIFORM_BUFFER,null);for(let A=0;A<this._parameters.maxUniformBufferBindings;A++){const U=this._state.uniformBufferBindingPoints[A];if((0,Qe.pC)(U)){const{buffer:ne,offset:fe,size:Oe}=U;null!==ne?0===fe&&0===Oe?_.bindBufferBase(xt.w0.UNIFORM_BUFFER,A,ne.glName):_.bindBufferRange(xt.w0.UNIFORM_BUFFER,A,ne.glName,fe,Oe):_.bindBufferBase(xt.w0.UNIFORM_BUFFER,A,null)}}this._state.pixelPackBuffer?_.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):_.bindBuffer(xt.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?_.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):_.bindBuffer(xt.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?_.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):_.bindBuffer(xt.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?_.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):_.bindBuffer(xt.w0.COPY_WRITE_BUFFER,null),_.bindFramebuffer(xt.qi.READ_FRAMEBUFFER,null),_.readBuffer(_.BACK),this._state.readFramebuffer&&(_.bindFramebuffer(xt.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),_.readBuffer(xt.VY.COLOR_ATTACHMENT0)),_.bindFramebuffer(xt.qi.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,_.bindFramebuffer(xt.qi.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(T&&this._state.vertexArrayObject){const A=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(A)}_.useProgram(this._state.program?.glName??null),_.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),_.bindRenderbuffer(_.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),!0===this._state.blend?_.enable(this.gl.BLEND):_.disable(this.gl.BLEND),_.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),_.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),_.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),_.clearDepth(this._state.clearDepth),_.clearStencil(this._state.clearStencil),_.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),_.cullFace(this._state.cullFace),_.depthFunc(this._state.depthFunction),_.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),_.depthMask(this._state.depthWrite),_.frontFace(this._state.frontFace),_.lineWidth(1),!0===this._state.faceCulling?_.enable(_.CULL_FACE):_.disable(_.CULL_FACE),_.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?_.enable(_.POLYGON_OFFSET_FILL):_.disable(_.POLYGON_OFFSET_FILL),_.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?_.enable(_.SCISSOR_TEST):_.disable(_.SCISSOR_TEST),_.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),_.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?_.enable(_.STENCIL_TEST):_.disable(_.STENCIL_TEST),_.stencilMask(this._state.stencilWriteMask);for(let A=0;A<this.parameters.maxTextureImageUnits;A++){_.activeTexture(xt.Ld+A),_.bindTexture(xt.No.TEXTURE_2D,null),_.bindTexture(xt.No.TEXTURE_CUBE_MAP,null),(0,wl.Z)(_)&&(_.bindTexture(xt.No.TEXTURE_3D,null),_.bindTexture(xt.No.TEXTURE_2D_ARRAY,null));const U=this._state.textureUnitMap[A];(0,Qe.pC)(U)&&_.bindTexture(U.descriptor.target,U.glName)}_.activeTexture(xt.Ld+this._state.activeTexture);const x=this._state.viewport;_.viewport(x.x,x.y,x.width,x.height),this.resetInfo()}_loadExtensions(){this.type===cl.zO.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(_){const T=this.capabilities.textureFilterAnisotropic,x=_.maxAnisotropy??1/0,A=(0,wl.Z)(this.gl),U=this.gl,ne={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:T?Math.min(this.gl.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY),x):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:A?U.getParameter(U.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:A?U.getParameter(U.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:A?U.getParameter(U.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:A?U.getParameter(U.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:A?U.getParameter(U.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:A?U.getParameter(U.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:A?U.getParameter(U.MAX_SAMPLES):1};return Ro.x.TEXTURE_UNIT_FOR_UPDATES=ne.maxTextureImageUnits-1,ne}}function sc(d,_,T,x){return _?x!==_&&d.bindBuffer(T,_.glName):d.bindBuffer(T,null),_}function JL(d,_){switch(d){case xt.MX.POINTS:return 2*_;case xt.MX.TRIANGLES:return _/3;case xt.MX.TRIANGLE_STRIP:case xt.MX.TRIANGLE_FAN:return _-2;default:return 0}}class QL extends AZ{constructor(_,T,x){super(_,T),this.newCache=x,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(_,T,x,A){return this.useProgram(_.program),_.bindPipelineState(this,x?.slot,A),_.program.bindPass(T,x),_.program}get test(){return this.programCache.test}}var RZ=v(80855),wZ=v(97825);let Cf=class extends Ns.Z{constructor(d,_,T){super({}),this._stage=d,this._techniqueRepository=_,this._rctx=T,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Va.Z,this._frameTask=d.resourceController.scheduler.registerTask(Fn.T8.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Y2.U.Texture,d=>d.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return(0,Qe.Wi)(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(RZ.K,new wZ.V)),this._textureTechnique}acquire(d){const _=this._textures.get(d);return _?(_.ref(),(0,Qe.Pt)(_.loadingPromise,_)):this._createNewRef(d)}update(){let d=!1;this._frameUpdates.forEach(_=>{const T=_.texture.frameUpdate(this._rctx,this.textureTechnique,_.previousToken);T>=0&&T!==_.previousToken&&(_.previousToken=T,d=!0)}),d&&this.events.emit("changed",Fi.Xx.BACKGROUND)}_createNewRef(d){const _=this._stage.getObject(d);if((0,Qe.Wi)(_))return(0,Wc.hu)(void 0!==_),null;const T=_.events.on("unloaded",()=>{T.remove(),this._onTextureUnloaded(d)}),x=new IZ(d,()=>{this._frameTask.schedule(()=>{x.isUnreferenced&&_.unload()})});return this._textures.set(d,x),x.ref(),(0,Qe.pC)(_.glTexture)?(this._updateGLTexture(x,_.glTexture),_.requiresFrameUpdates&&this._frameUpdates.set(d,{texture:_,previousToken:-1}),x):(this._loadingCount++,x.loadingPromise=this._stage.schedule(()=>{const A=_.load(this._rctx,()=>this.textureTechnique),U=fe=>(this._loadingCount--,x.loadingPromise=null,this._updateGLTexture(x,fe),_.requiresFrameUpdates&&this._frameUpdates.set(d,{texture:_,previousToken:-1}),x);return(0,ws.y8)(A)?A.then(U,fe=>(this._loadingCount--,x.loadingPromise=null,(0,ws.D_)(fe)||Us.Z.getLogger(this.declaredClass).error(fe),null)):U(A)}),x.loadingPromise)}_updateGLTexture(d,_){d.glTexture=_,this.events.emit("changed",Fi.Xx.UPDATE)}_onTextureUnloaded(d){this._textures.delete(d),this._frameUpdates.delete(d)}};(0,Ve._)([(0,ke.Cb)()],Cf.prototype,"_loadingCount",void 0),(0,Ve._)([(0,ke.Cb)()],Cf.prototype,"_frameTask",void 0),(0,Ve._)([(0,ke.Cb)()],Cf.prototype,"updating",null),Cf=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.lib.TextureRepository")],Cf);class IZ{constructor(_,T){this.id=_,this._release=T,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(Us.Z.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var LZ=v(51899);let My=class extends Ns.Z{constructor(){super(...arguments),this._passParameters=new BZ,this._loading=0}get passParameters(){return this._passParameters}dispose(){this._passParameters.waveNormal=(0,Qe.M2)(this._passParameters.waveNormal),this._passParameters.wavePertubation=(0,Qe.M2)(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(d){if(this._loading>0)return Fi.Rw.LOADING;if((0,Qe.pC)(this._passParameters.waveNormal)&&(0,Qe.pC)(this._passParameters.wavePertubation))return Fi.Rw.LOADED;const _={target:xt.No.TEXTURE_2D,pixelFormat:xt.VI.RGBA,dataType:xt.Br.UNSIGNED_BYTE,wrapMode:xt.e8.REPEAT,samplingMode:xt.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,(0,C0.t)((0,Uv.V)("esri/images/materials/water/normals.jpg")).then(T=>this._passParameters.waveNormal=new Ro.x(d,{..._,width:T.width,height:T.height},T)).catch(T=>Us.Z.getLogger(this.declaredClass).error("Failed to load water material normal texture.",T)).finally(()=>--this._loading),++this._loading,(0,C0.t)((0,Uv.V)("esri/images/materials/water/perturbation.jpg")).then(T=>this._passParameters.wavePertubation=new Ro.x(d,{..._,width:T.width,height:T.height},T)).catch(T=>Us.Z.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",T)).finally(()=>--this._loading),Fi.Rw.LOADING}};(0,Ve._)([(0,ke.Cb)()],My.prototype,"_loading",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],My.prototype,"updating",null),My=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],My);class BZ extends lu.K{}const jZ=new Map;function WZ(d,_){const{format:T,quality:x,rotation:A,disableDecorations:U}=d||{},ne=nx(d,_.padding),fe=function YZ(d,_){const T={x:0,y:0,width:_.width,height:_.height};if(d&&d.area){null!=d.area.x&&(T.x=Math.floor(d.area.x)),null!=d.area.y&&(T.y=Math.floor(d.area.y));const x=null!=d.area.width?Math.floor(d.area.width):null,A=null!=d.area.height?Math.floor(d.area.height):null;if(T.width=_.width-T.x,T.height=_.height-T.y,null!=x&&null!=A)T.width=Math.min(T.width,x),T.height=Math.min(T.height,A);else if(null==x&&null!=A){const U=Math.min(T.width,x);T.height=U/T.width*T.height,T.width=U}else if(null!=x&&null==A){const U=Math.min(T.height,A);T.width=U/T.height*T.width,T.height=U}}return function XZ(d,_){const T=Math.floor(Math.max(d.x,0)),x=Math.floor(Math.max(d.y,0)),A={x:T,y:x,width:Math.floor(Math.min(d.width,_.width-T)),height:Math.floor(Math.min(d.height,_.height-x))},U=A.width/A.height,ne=d.width/d.height;if(ne===U)return A;if(ne>U){const we=Math.floor(A.width/ne);return{x:A.x,y:Math.floor(A.y+(A.height-we)/2),width:A.width,height:we}}const fe=Math.floor(A.height*ne);return{x:Math.floor(A.x+(A.width-fe)/2),y:A.y,width:fe,height:A.height}}(function kZ(d,_){if(!_||null==_.width||null==_.height)return d;const T=_.width/_.height,x=d.width/d.height;if(x===T)return d;if(x<T){const U=Math.floor(d.height*T);return d.x-=(U-d.width)/2,d.width=U,d}const A=Math.floor(d.width/T);return d.y-=(A-d.height)/2,d.height=A,d}(T,d),_)}(d,{width:_.width-ne.left-ne.right,height:_.height-ne.top-ne.bottom}),{width:Oe,height:we}=function $Z(d,_){if(!d)return _;const T=d.width,x=d.height;if(null!=T&&null!=x)return{width:Math.floor(T),height:Math.floor(x)};if(null==T&&null==x)return _;const A=_.width/_.height;return null==x?{width:Math.floor(T),height:Math.floor(T/A)}:{width:Math.floor(x*A),height:Math.floor(x)}}(d,fe),Ze=function sU(d){switch(d){case"png":case"jpg":case"jpeg":return d;default:return e$}}(T);return{format:Ze,quality:(0,xr.uZ)(x??nU[Ze],0,100),area:fe,width:Oe,height:we,rotation:A,disableDecorations:!!U,ignoreBackground:!(!d||!d.ignoreBackground),ignorePadding:!(!d||!d.ignorePadding)}}function sx(d,_,T){const{ctx:x,canvas:A}=tU(d,T),U=x.getImageData(0,0,d.width,d.height),ne=function GZ(d,_){return d.toDataURL(qZ[_.format],_.quality/100)}(A,_);return rU(A),{dataUrl:ne,data:U}}function tU(d,_){const T=function HZ(){return(0,Qe.Wi)(ix)&&(ix=document.createElement("canvas")),ix}();_.premultipliedAlpha&&function QZ(d){const _=d.data,T=_.length;for(let x=0;x<T;x+=4){const A=_[x+3];if(255!==A&&A>0){const U=255/A;_[x+0]=_[x+0]*U,_[x+1]=_[x+1]*U,_[x+2]=_[x+2]*U}}}(d),T.width=d.width,T.height=d.height;const x=T.getContext("2d");return x.putImageData(d,0,0),_.flipY&&function JZ(d){d.save(),d.globalCompositeOperation="copy",d.scale(1,-1),d.translate(0,-d.canvas.height),d.drawImage(d.canvas,0,0),d.restore()}(x),{ctx:x,canvas:T}}function rU(d){d.width=0,d.height=0}let ix=null;function nx(d,_){return!_||d&&d.ignorePadding?t$:_}const qZ={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},e$="png",nU={png:100,jpg:98,jpeg:98},t$={top:0,right:0,bottom:0,left:0};var ox=v(90740);class r${constructor(_,T){this.viewCamera=_,this.frameHasDecorations=T}}class s$ extends Ea.Xn{constructor(_,T,x,A){super(),this._rctx=_,this._renderFunctions=T,this._forceCameraHook=x,this._disposeOffscreenBuffers=A,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(_){var T=this;return(0,kr.Z)(function*(){yield T._renderFunctions.prepareOverlay(),T._renderFunctions.requestRenderScene(Fi.Xx.BACKGROUND);const x=(0,ws.hh)();return T._screenshotQueue.push({settings:_,resolver:x}),x.promise})()}update(_,T){for(const x of this._screenshotQueue){if(this.isDisposed){x.resolver.reject();continue}const A={...x.settings,pixelRatio:x.settings.pixelRatio*_.viewCamera.pixelRatio},U=this._renderScreenshot(_,A,T);x.resolver(U)}this._screenshotQueue.length=0}_renderScreenshotOverlay(_,T,x){_.width=T.width,_.height=T.height;const A=_.getContext("2d"),U=x.pixelRatio;return A.save(),A.translate(0,T.height),A.scale(1,-1),x.region&&A.translate(-x.region.x,-x.region.y),A.scale(U,U),T=this._renderFunctions.renderOverlay(_,T),A.restore(),T}_readbackScreenshot(_,T){return _.resample?this._readbackScreenshotResampled(_,T):this._readbackScreenshotImmediate(_,T)}_readbackScreenshotResampled(_,T){const{framebufferWidth:x,framebufferHeight:A,region:U,resample:ne}=_,fe=this._ensureScreenshotEncodeCanvas();let Oe=(0,ox.r)(x,A,fe);return this._rctx.gl.readPixels(0,0,x,A,xt.VI.RGBA,xt.g.UNSIGNED_BYTE,new Uint8Array(Oe.data.buffer)),T(),Oe=this._renderScreenshotOverlay(fe,Oe,{..._,region:null}),function KZ(d,_,T,x=0,A=0,U=d.width-x,ne=d.height-A,fe=!1){const{data:Oe}=d,{width:we,height:Ze,data:it}=_,lt=U/we,dt=ne/Ze,Tt=Math.ceil(lt/2),mt=Math.ceil(dt/2),Mt=d.width;for(let Pt=0;Pt<Ze;Pt++)for(let Nt=0;Nt<we;Nt++){const Bt=4*(Nt+(fe?Ze-Pt-1:Pt)*we);let Zt=0,nr=0,Jt=0,Rr=0,Br=0,$r=0;const Yr=(Pt+.5)*dt;for(let cs=Math.floor(Pt*dt);cs<(Pt+1)*dt;cs++){const Xr=Math.abs(Yr-(cs+.5))/mt,os=(Nt+.5)*lt,br=Xr*Xr;for(let Vr=Math.floor(Nt*lt);Vr<(Nt+1)*lt;Vr++){const lr=Math.abs(os-(Vr+.5))/Tt,wr=Math.sqrt(br+lr*lr);if(wr>=1)continue;let Gr=2*wr*wr*wr-3*wr*wr+1;const zr=4*(x+Vr+(A+cs)*Mt);$r+=Gr*Oe[zr+3],nr+=Gr,!T&&Oe[zr+3]<255&&(Gr=Gr*Oe[zr+3]/255),Jt+=Gr*Oe[zr],Rr+=Gr*Oe[zr+1],Br+=Gr*Oe[zr+2],Zt+=Gr}}it[Bt]=Jt/Zt,it[Bt+1]=Rr/Zt,it[Bt+2]=Br/Zt,it[Bt+3]=$r/nr}return _}(Oe,(0,ox.r)(U.width,U.height,fe),!0,ne.region.x,A-(ne.region.y+ne.region.height),ne.region.width,ne.region.height)}_readbackScreenshotImmediate(_,T){const{framebufferHeight:x,region:A}=_,U=this._ensureScreenshotEncodeCanvas(),ne=(0,ox.r)(A.width,A.height,U);return this._rctx.gl.readPixels(A.x,x-(A.y+A.height),A.width,A.height,xt.VI.RGBA,xt.g.UNSIGNED_BYTE,new Uint8Array(ne.data.buffer)),T(),this._renderScreenshotOverlay(U,ne,_)}_renderScreenshot(_,T,x){let A=null,U=null;const ne=_.viewCamera,{framebufferWidth:fe,framebufferHeight:Oe}=T;let we=!1;const dt=fe!==ne.fullWidth||Oe!==ne.fullHeight||T.disableDecorations&&_.frameHasDecorations||T.ignorePadding&&ne.pixelRatio!==T.pixelRatio||T.objectAndLayerIdColor;if(T.objectAndLayerIdColor&&(U=new Aa.X(this._rctx,{width:fe,height:Oe,colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.DEPTH_STENCIL_RENDER_BUFFER})),dt){const Pt=ne.clone();if(T.ignorePadding){const Zt=(0,Tn.d)(Pt.padding);for(let nr=0;nr<4;nr++)Zt[nr]=Math.round(Zt[nr]/Pt.pixelRatio*T.pixelRatio);Pt.padding=Zt}Pt.fullWidth=fe,Pt.fullHeight=Oe,Pt.pixelRatio=T.pixelRatio;const Nt=ne.fovX-Pt.fovX,Bt=ne.fovY-Pt.fovY;Nt<0&&Nt<Bt?Pt.fovX=ne.fovX:Bt<0&&Bt<Nt&&(Pt.fovY=ne.fovY),this._forceCameraHook(Pt),we=!0,A=new Aa.X(this._rctx,{width:Pt.fullWidth,height:Pt.fullHeight,colorTarget:xt.Lm.TEXTURE,depthStencilTarget:xt.OU.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(A,U,Pt,T.disableDecorations?Fi.Iq.OFF:Fi.Iq.ON,x),this._disposeOffscreenBuffers()}const Tt=()=>{this._rctx.bindFramebuffer(null),(0,Qe.M2)(A)},mt=this._readbackScreenshot(T,Tt);Tt();let Mt=null;if(T.objectAndLayerIdColor){const Pt=()=>{this._rctx.bindFramebuffer(null),(0,Qe.M2)(U)};this._rctx.bindFramebuffer(U),Mt=this._readbackScreenshot(T,Pt),this._rctx.bindFramebuffer(null),Pt()}if(dt&&!this._rctx.contextAttributes.alpha)for(let Pt=3;Pt<mt.data.length;Pt+=4)mt.data[Pt]=255;if(Mt&&!this._rctx.contextAttributes.alpha)for(let Pt=3;Pt<Mt.data.length;Pt+=4)Mt.data[Pt]=255;return we&&this._forceCameraHook(ne),[mt,Mt]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let ba=class extends((0,Ea.TF)(Ns.Z)){constructor(d){super({}),this.events=new Va.Z,this.waterTextureRepository=new My,this._magnifierHelper=new Ef,this._objectAndLayerIdRenderHelper=(0,So.Z)("enable-feature:objectAndLayerId-rendering")?new OG:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=d.container,this._viewingMode=d.viewingMode,this._initializeContext(d),(0,Ht.YP)(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Ht.nn),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new LZ.h0(this._rctx),this._shaderTechniqueRepository=new eG.M({rctx:this._rctx,viewingMode:d.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new Cf(d,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",T=>this.requestRender(T)),this._materialRepository=new mG.h(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new tG(this._rctx,this._shaderTechniqueRepository),this._renderer=new Xd(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,T=>this.requestRender(T),(T,x)=>d.schedule(T,x),d),this._screenshotManager=new s$(this._rctx,{renderScene:(T,x,A,U,ne)=>this._renderer.render(T,x,{camera:A,contentCamera:A,mode:Lu.n.IDLE},U,ne),requestRenderScene:T=>this.requestRender(T),prepareOverlay:()=>d.options.screenshot.prepareOverlay(),renderOverlay:(T,x)=>d.options.screenshot.renderOverlay(T,x)},T=>this.events.emit("force-camera-for-screenshot",T),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(d)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=(0,Qe.hw)(this._frameTask),this._shaderTechniqueRepository=(0,Qe.M2)(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const d=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==d.getUsedTextureMemory?d.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==d.getUsedRenderbufferMemory?d.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==d.getUsedVBOMemory?d.getUsedVBOMemory():void 0}}requestRender(d=Fi.Xx.UPDATE){this._needsRender=!0,d===Fi.Xx.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(d){this._magnifierHelper.magnifier=d}setRenderParameters(d){void 0!==d.idleSuspend&&this._idleSuspend!==!!d.idleSuspend&&(this._idleSuspend=!!d.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(d)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(d){this._renderer.modify(d),d.clear()}get canvas(){return this._canvas}takeScreenshot(d){return this._screenshotManager.takeScreenshot(d).then(_=>_[0])}takeScreenshotWithOID(d){return d.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(d)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(d){return this._renderer.readAccumulatedShadow(d[0],d[1])}readHUDVisibility(d,_,T,x,A){this._renderer.readHUDVisibility(d,_,T,x,A)}getMinimalDepthForArea(d,_,T,x,A,U=A){const ne=x.constrainWindowSize(_,T,A*x.pixelRatio,U*x.pixelRatio),fe=this._ensureDepthBuffer(ne);this._renderer.readDepthPixels(x,ne,fe);let Oe=Number.MAX_VALUE;for(let we=0;we<ne[2]*ne[3];we++){const Ze=oG(4*we,fe,x.nearFar);Oe>Ze&&Ze!==x.nearFar[0]&&Ze!==x.nearFar[1]&&(Oe=Ze)}if((0,Qe.pC)(d)){const we=d.pickDepth(_*x.pixelRatio,T*x.pixelRatio,x);(0,Qe.pC)(we)&&Oe>we&&we!==x.nearFar[0]&&we!==x.nearFar[1]&&(Oe=we)}return Oe===Number.MAX_VALUE?void 0:Oe}_ensureDepthBuffer(d){const _=4*d[2]*d[3];return((0,Qe.Wi)(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<_)&&(this._tmpDepthBuffer=new Uint8Array(_)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}reloadShaders(){var d=this;return(0,kr.Z)(function*(){Cw(),yield d._shaderTechniqueRepository.reloadAll(),d.requestRender()})()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(d){const _=d.state;let T=!1,x=Fi.Xx.BACKGROUND,A=!1;this._frameTask=(0,gd.A)({preRender:({time:ne})=>{T=this.updating,x=this._needsUpdate?Fi.Xx.UPDATE:Fi.Xx.BACKGROUND,d.processSyncLayers(),(ne-this._lastAnimationUpdate>this.animationTimestep||(0,Qe.pC)(_.forcedAnimationTime)||T||this._needsRender)&&(ne=(0,Qe.Pt)(_.forcedAnimationTime,ne),this._renderer.updateAnimation({camera:_.camera,time:ne})&&this.requestRender(Fi.Xx.BACKGROUND),this._lastAnimationUpdate=ne)},render:({time:ne})=>{if((this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&_.camera.fullWidth>0&&_.camera.fullHeight>0){const fe=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,null,_,Fi.Iq.ON,ne),A=!0,fe&&this._renderer.hasWaterReflection&&(this.requestRender(Fi.Xx.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:ne})=>{const fe=new r$(_.camera,this._renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(fe,ne)},finish:()=>{A&&(this._renderer.finish(_.mode===Lu.n.IDLE?x:Fi.Xx.UPDATE),A=!1)}})}_initializeContext(d){const _=d.options;this._canvas=_.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const x=(0,cl.sj)("3d",this._canvas,{alpha:_.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==_.stencil||_.stencil,powerPreference:"high-performance",preserveDrawingBuffer:_.preserveDrawingBuffer??!1});if((0,Qe.Wi)(x)){const A=(0,So.Z)("esri-force-webgl");Us.Z.getLogger(this.declaredClass).error(A)}else this._rctx=this._newRenderingContext(x,d),this._loadShaderOnlyExtensions(),!_.alpha&&this._rctx.contextAttributes.alpha&&Us.Z.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&(0,So.Z)("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(d,_){const T={disabledExtensions:_.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:_.options.debugWebGLExtensions||{},maxAnisotropy:8},x=(A,U)=>_.resourceController.memoryController.newCache(A,U);return new QL(d,T,x)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}_getObjectAndLayerIdColor(d){return this._objectAndLayerIdRenderHelper?this._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(d):null}get componentObjectCollection(){return(0,Qe.Wi)(this._componentObjectCollection)&&(this._componentObjectCollection=new QH(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(d){this._componentObjectCollection=d}};(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0})],ba.prototype,"updating",null),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_rctx",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_container",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_canvas",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_stippleTextureRepository",void 0),(0,Ve._)([(0,Ea.gT)(),(0,ke.Cb)()],ba.prototype,"waterTextureRepository",void 0),(0,Ve._)([(0,Ea.gT)(),(0,ke.Cb)()],ba.prototype,"_magnifierHelper",void 0),(0,Ve._)([(0,ke.Cb)()],ba.prototype,"_objectAndLayerIdRenderHelper",void 0),(0,Ve._)([(0,Ea.gT)(),(0,ke.Cb)()],ba.prototype,"_textureRepository",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_compositingHelper",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_renderer",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_screenshotManager",void 0),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"componentObjectCollection",null),(0,Ve._)([(0,Ea.gT)()],ba.prototype,"_componentObjectCollection",void 0),(0,Ve._)([(0,ke.Cb)()],ba.prototype,"_needsUpdate",void 0),(0,Ve._)([(0,ke.Cb)()],ba.prototype,"_needsWaterReflectionUpdate",void 0),ba=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.parts.RenderView")],ba);(function qL(){return jZ})();var Tb;let Il=Tb=class extends((0,Ea.TF)(Ns.Z)){constructor(d){super(d),this._handles=new Ji.Z,this._model=new HE,this._layers=new wo.Z,this._changeSet=new dH.as,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ba(this)),this._frameTask=this.resourceController.scheduler.registerTask(Fn.T8.STAGE,this),this._handles.add(this._frameTask)}destroy(){UO.k.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(d){this._model.add(d),(0,Hg.e)(d)&&(d.attachStage(this),this._addLayer(d)),this.renderView.requestRender()}remove(d){(0,Qe.Wi)(d)||(this.renderView.requestRender(),this._model.remove(d),(0,Hg.e)(d)&&(this._removeLayer(d),d.detachStage()))}addMany(d){(0,Qe.pC)(d)&&(this._model.addMany(d),this.renderView.requestRender())}removeMany(d){(0,Qe.pC)(d)&&(this._model.removeMany(d),this.renderView.requestRender())}load(d){var _=this;return(0,kr.Z)(function*(){(0,Qe.Wi)(d)||(Array.isArray(d)||(d=[d]),yield Promise.all(d.filter(T=>(0,Qe.Wi)(T.glTexture)).map(T=>_.schedule(()=>_._model.has(T)?T.load(_.renderView.renderingContext,()=>_.renderView.textureRepository.textureTechnique):null))))})()}loadImmediate(d){return d.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(d,_){this._model.forEachOfType(d,_)}handleEvent(d,_){this.destroyed||(this._model.dirtySet[d](_),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(d){this._frameTask.processQueue(d),d.done||this._commit()}_commit(){const d=this._model.dirtySet;Tb.DebugSettings.logDirtySet&&console.log("Dirty set: "+d.formatDebugInfo()),d.commit(this._changeSet),Tb.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(_=>_.id)),console.log("RGs remove: "+this._changeSet.removes.map(_=>_.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(d,_){return this._frameTask.schedule(d,_)}syncLayer(d){this._layerSyncSet.add(d),this.renderView.requestRender()}processSyncLayers(){const d=this._model.dirtySet;this._layers.forAll(_=>{(this._layerSyncSet.has(_.id)||_.updatePolicy===Fi.jq.SYNC)&&(d.commitLayer(_.id,this._changeSet),this._layerSyncSet.delete(_.id))});for(const _ of this._layerSyncSet)d.commitLayer(_,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(d){return this._model.getObject(d)}get layers(){return this._layers}_addLayer(d){this._layers.includes(d)||this._layers.push(d)}_removeLayer(d){this._commit(),null!=this._layers.removeUnordered(d)&&(this._model.dirtySet.getResidentRenderGeometries(d.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(d,_,T){const x=this.renderView.renderPlugins.add(d,_,T),A=()=>{pw(_)&&this.sceneIntersectionHelper.addIntersectionHandler(_)};if((0,ws.y8)(x))return x.then(A);A()}removeRenderPlugin(d){pw(d)&&this.sceneIntersectionHelper.removeIntersectionHandler(d),this.renderView.renderPlugins.remove(d)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const d=this;return{getCount:_=>d._model.test.content.filter(T=>T.type===_).length,model:d._model}}};Il.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"resourceController",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"options",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"state",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"sceneIntersectionHelper",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Il.prototype,"viewingMode",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"container",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"renderSR",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"_handles",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Il.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Il.prototype,"_model",void 0),(0,Ve._)([(0,Ea.gT)(),(0,ke.Cb)()],Il.prototype,"renderView",void 0),Il=Tb=(0,Ve._)([(0,Wr.j)("esri.views.3d.webgl-engine.Stage")],Il);var Mb=v(55314);function ax(){return ax=(0,kr.Z)(function*(d,_){if("2d"===d.type)return d.hitTest(_);const T=yield d.hitTest(_);if(0===T.results.length)return T;const x=T.results[0],A=(0,Qe.pC)(x.distance)?x.distance*(1+o$):x.distance,U=T.results.findIndex(ne=>ne.distance>A);return-1!==U&&(T.results=T.results.slice(0,U)),T}),ax.apply(this,arguments)}const o$=.05;var a$=v(31637);let P0=class extends Ns.Z{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(d){const _=this._get("node");d!==_&&(d&&d.classList.add("esri-component"),_&&_.classList.remove("esri-component"),this._set("node",d))}castNode(d){return d?"string"==typeof d||function c$(d){return d&&"nodeType"in d}(d)?(this._set("widget",null),(0,md.L7)(d)):(function u$(d){return d&&"function"==typeof d.render}(d)&&!d.domNode&&(d.domNode=document.createElement("div")),this._set("widget",d),d.domNode):(this._set("widget",null),null)}};(0,Ve._)([(0,ke.Cb)({dependsOn:[]})],P0.prototype,"id",null),(0,Ve._)([(0,ke.Cb)()],P0.prototype,"node",null),(0,Ve._)([(0,ko.p)("node")],P0.prototype,"castNode",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],P0.prototype,"widget",void 0),P0=(0,Ve._)([(0,Wr.j)("esri.views.ui.Component")],P0);const Pb=P0,d$={left:0,top:0,bottom:0,right:0},cU={bottom:30,top:15,right:15,left:15},lx="manual",Ll_corner="esri-ui-corner";function cx(d){const _=d,T="object"==typeof _&&null!==_&&Object.getPrototypeOf(_);return null!==T&&T!==Object.prototype||!("component"in _||"index"in _||"position"in _)?null:d}function ux(d,{top:_,bottom:T,left:x,right:A}){d.style.top=_,d.style.bottom=T,d.style.left=x,d.style.right=A}let kd=class extends Va.Z.EventedAccessor{constructor(d){super(d),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Ji.Z,this.view=null,this._applyViewPadding=()=>{const _=this.container;_&&ux(_,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const _=this._innerContainer;_&&ux(_,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([(0,Ht.YP)(()=>[this.view?.padding,this.container],this._applyViewPadding,Ht.nn),(0,Ht.YP)(()=>this.padding,this._applyUIPadding,Ht.nn)])}destroy(){this.container=null;for(const d of this._components)d.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(d){const _=this._get("container");d!==_&&(d&&(d.classList.add("esri-ui"),function k6(d){(function J6(d){Array.from(d.classList).forEach(_=>{_.startsWith(bS)&&d.classList.remove(_)})})(d),d.classList.add(function X6(){return`${bS}${Vm()?"dark":"light"}`}())}(d),this._attachContainers(d)),_&&(_.classList.remove("esri-ui"),ux(_,{top:"",bottom:"",left:"",right:""}),(0,md.cS)(_)),this._set("container",d))}get height(){const d=this.get("view.height")||0;if(0===d)return d;const _=this._getViewPadding();return Math.max(d-(_.top+_.bottom),0)}get padding(){return this._get("padding")}set padding(d){this._overrideIfSome("padding",d)}castPadding(d){return"number"==typeof d?{bottom:d,top:d,right:d,left:d}:{...cU,...d}}get width(){const d=this.get("view.width")||0;if(0===d)return d;const _=this._getViewPadding();return Math.max(d-(_.left+_.right),0)}add(d,_){let T,x;if(Array.isArray(d))return void d.forEach(U=>this.add(U,_));const A=cx(d);A&&({index:T,position:_,component:d,key:x}=A),_&&"object"==typeof _&&({index:T,key:x,position:_}=_),!d||_&&!this._isValidPosition(_)||this._add(d,_,T,x)}remove(d,_){if(!d)return;if(Array.isArray(d))return d.map(x=>this.remove(x,_));const T=this._find(d);if(T){const x=this._componentToKey;if(x.has(d)&&x.get(d)!==_)return;const A=this._components.indexOf(T);return T.node.parentNode&&T.node.parentNode.removeChild(T.node),this._componentToKey.delete(d),this._components.splice(A,1)[0]}}empty(d){return Array.isArray(d)?d.map(_=>this.empty(_)).reduce((_,T)=>_.concat(T)):(d=d||lx)===lx?Array.prototype.slice.call(this._manualContainer.children).filter(_=>!_.classList.contains(Ll_corner)).map(_=>this.remove(_)):this._isValidPosition(d)?Array.prototype.slice.call(this._cornerNameToContainerLookup[d].children).map(this.remove,this):null}move(d,_){if(Array.isArray(d)&&d.forEach(U=>this.move(U,_)),!d)return;let T;const x=cx(d)||cx(_);if(x&&(T=x.index,_=x.position,d=x.component||d),_&&!this._isValidPosition(_))return;const A=this.remove(d);A&&this.add(A,{position:_,index:T})}find(d){if(!d)return null;const _=this._findById(d);return _&&(_.widget||_.node)}getPosition(d){for(const _ in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[_].contains(d))return _;return null}_add(d,_,T,x){d instanceof Pb||(d=new Pb({node:d})),this._place({component:d,position:_,index:T}),this._components.push(d),x&&this._componentToKey.set(d,x)}_find(d){return d?d instanceof Pb?this._findByComponent(d):"string"==typeof d?this._findById(d):this._findByNode(d.domNode||d):null}_getViewPadding(){return this.get("view.padding")||d$}_attachContainers(d){d.appendChild(this._innerContainer),d.appendChild(this._manualContainer)}_initContainers(){const d=document.createElement("div");d.classList.add("esri-ui-inner-container"),d.classList.add("esri-ui-corner-container");const _=document.createElement("div");_.classList.add("esri-ui-inner-container"),_.classList.add("esri-ui-manual-container");const T=document.createElement("div");T.classList.add("esri-ui-top-left"),T.classList.add(Ll_corner),d.appendChild(T);const x=document.createElement("div");x.classList.add("esri-ui-top-right"),x.classList.add(Ll_corner),d.appendChild(x);const A=document.createElement("div");A.classList.add("esri-ui-bottom-left"),A.classList.add(Ll_corner),d.appendChild(A);const U=document.createElement("div");U.classList.add("esri-ui-bottom-right"),U.classList.add(Ll_corner),d.appendChild(U),this._innerContainer=d,this._manualContainer=_;const ne=(0,uo.dZ)();this._cornerNameToContainerLookup={"top-left":T,"top-right":x,"bottom-left":A,"bottom-right":U,"top-leading":ne?x:T,"top-trailing":ne?T:x,"bottom-leading":ne?U:A,"bottom-trailing":ne?A:U},this._positionNameToContainerLookup={manual:_,...this._cornerNameToContainerLookup}}_isValidPosition(d){return!!this._positionNameToContainerLookup[d]}_place(d){const _=d.component,x=d.index,A=this._positionNameToContainerLookup[d.position||lx],U=x>-1;if(function h$(d){return d&&!d._started&&"function"==typeof d.postMixInProperties&&"function"==typeof d.buildRendering&&"function"==typeof d.postCreate&&"function"==typeof d.startup}(_.widget)&&_.widget.startup(),!U)return void A.appendChild(_.node);const ne=Array.prototype.slice.call(A.children);0!==x?x>=ne.length?A.appendChild(_.node):(0,md.Vt)(_.node,ne[x]):A.firstChild?(0,md.Vt)(_.node,A.firstChild):A.appendChild(_.node)}_toPxPosition(d){return{top:this._toPxUnit(d.top),left:this._toPxUnit(d.left),right:this._toPxUnit(d.right),bottom:this._toPxUnit(d.bottom)}}_toPxUnit(d){return 0===d?"0":d+"px"}_findByComponent(d){let _,T=null;return this._components.some(x=>(_=x===d,_&&(T=x),_)),T}_findById(d){let _,T=null;return this._components.some(x=>(_=x.id===d,_&&(T=x),_)),T}_findByNode(d){let _,T=null;return this._components.some(x=>(_=x.node===d,_&&(T=x),_)),T}};(0,Ve._)([(0,ke.Cb)()],kd.prototype,"container",null),(0,Ve._)([(0,ke.Cb)()],kd.prototype,"height",null),(0,Ve._)([(0,ke.Cb)({value:cU})],kd.prototype,"padding",null),(0,Ve._)([(0,ko.p)("padding")],kd.prototype,"castPadding",null),(0,Ve._)([(0,ke.Cb)()],kd.prototype,"view",void 0),(0,Ve._)([(0,ke.Cb)()],kd.prototype,"width",null),kd=(0,Ve._)([(0,Wr.j)("esri.views.ui.UI")],kd);const p$=kd;function uU(d,_){return d&&"copyright"in d&&(!_||"function"==typeof d.originOf&&"user"===d.originOf("copyright"))}function Ob(d,_,T){!T||!_||d.find(x=>x.layerView===_&&x.text===T)||d.push({text:T,layerView:_})}const sp=[];let Tf=class extends Ip.r{constructor(d){super(d),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new On.Z,this.view=null,this._allLayerViewsChange=_=>{this.handles.remove("suspension");const T=this.get("view.allLayerViews");T&&this.handles.add(T.map(x=>(0,Ht.YP)(()=>[x.suspended,x.layer?.attributionVisible],()=>this._updateAttributionItems())),"suspension"),_&&_.removed&&_.removed.forEach(x=>{this._pendingAttributions.delete(x),this._fetchedAttributionData.delete(x)}),this._updateAttributionItems()},this.handles.add([(0,Ht.on)(()=>this.view?.allLayerViews,"change",_=>this._allLayerViewsChange(_),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),(0,Ht.gx)(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const d=this.get("view.allLayerViews");sp.length=0,d?(d.forEach(_=>{if(_.suspended||!_.layer?.attributionVisible)return;const T=_.layer;if(uU(T,"user"))return void Ob(sp,_,T.copyright);if(T.hasAttributionData){if(this._fetchedAttributionData.has(_)){const A=this._fetchedAttributionData.get(_);return void(A?Ob(sp,_,this._getDynamicAttribution(A,this.view,T)):uU(T)&&Ob(sp,_,T.copyright))}return void this._fetchAttributionData(_)}const x=T.get("portalItem.accessInformation");Ob(sp,_,x||T.copyright)}),function _$(d,_){return d.length!==_.length||d.some((T,x)=>T.text!==_[x].text)}(this.items,sp)&&(this.items.removeAll(),this.items.addMany(sp)),sp.length=0,this.notifyChange("state")):this._clear()}_fetchAttributionData(d){var _=this;return(0,kr.Z)(function*(){if(_._pendingAttributions.has(d))return;_._pendingAttributions.add(d);const T=yield(0,wu.q6)(d.layer.fetchAttributionData());if(_._pendingAttributions.has(d)){const x=T.ok?_._createContributionIndex(T.value,function f$(d){return"bing-maps"===d.type}(d.layer)):null;_._pendingAttributions.delete(d),_._fetchedAttributionData.set(d,x)}_._updateAttributionItems()})()}_createContributionIndex(d,_){const T=d.contributors,x={};if(!T)return x;for(let A=0;A<T.length;A++){const U=T[A],ne=U.coverageAreas;if(!ne)return;for(const fe of ne){const Oe=fe.bbox,we=fe.zoomMin-(_&&fe.zoomMin?1:0),Ze=fe.zoomMax-(_&&fe.zoomMax?1:0),lt={extent:(0,au.$)({xmin:Oe[1],ymin:Oe[0],xmax:Oe[3],ymax:Oe[2],spatialReference:to.Z.WGS84}),attribution:U.attribution||"",score:null!=fe.score?fe.score:100,id:A};for(let dt=we;dt<=Ze;dt++)x[dt]=x[dt]||[],x[dt].push(lt)}}return x.maxKey=Math.max.apply(null,Object.keys(x)),x}_getDynamicAttribution(d,_,T){const{extent:x,scale:A}=_;let U=T.tileInfo.scaleToZoom(A);if(U=Math.min(d.maxKey,Math.round(U)),!x||null==U||U<=-1)return"";const ne=d[U],fe=(0,au.iV)(x.center.clone().normalize(),_.spatialReference),Oe={};return ne?ne.filter(we=>{const Ze=!Oe[we.id]&&fe&&(0,tA.aV)(we.extent,fe);return Ze&&(Oe[we.id]=!0),Ze}).sort((we,Ze)=>Ze.score-we.score||we.objectId-Ze.objectId).map(we=>we.attribution).join(", "):""}};(0,Ve._)([(0,ke.Cb)({readOnly:!0,type:On.Z})],Tf.prototype,"items",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Tf.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],Tf.prototype,"view",void 0),Tf=(0,Ve._)([(0,Wr.j)("esri.widgets.Attribution.AttributionViewModel")],Tf);const dU=Tf;let Ul=class extends ua.Z{constructor(d,_){super(d,_),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(T=>T.forEach(({target:x})=>this._checkSourceTextOverflow(x))),this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.messages=null,this.viewModel=new dU}initialize(){this.addHandles((0,Ht.on)(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((d,_)=>(d.includes(_.text)||d.push(_.text),d),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}render(){return(0,Yt.u)("div",{bind:this,class:this.classes("esri-attribution esri-widget",{"esri-attribution--open":this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return(0,Yt.u)("div",{class:"esri-attribution__powered-by"},"Powered by"," ",(0,Yt.u)("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const d=this._isOpen,_=this._isInteractive,T=_?"0":"",{attributionText:x}=this;return(0,Yt.u)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{"esri-attribution__sources--open":d,"esri-interactive":_}),innerHTML:x,tabindex:T})}_afterSourcesNodeCreate(d){this._prevSourceNodeHeight=d.clientWidth,this._resizeObserver.observe(d)}_checkSourceTextOverflow(d){let _=!1;const{clientHeight:T,clientWidth:x,scrollWidth:A}=d,U=A>x,ne=this._attributionTextOverflowed!==U;if(this._attributionTextOverflowed=U,ne&&(_=!0),this._isOpen){const fe=T<this._prevSourceNodeHeight;this._prevSourceNodeHeight=T,fe&&(this._isOpen=!1,_=!0)}_&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"_isOpen",void 0),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"_isInteractive",null),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"_attributionTextOverflowed",void 0),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"_prevSourceNodeHeight",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ul.prototype,"attributionText",null),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"itemDelimiter",void 0),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"label",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Attribution/t9n/Attribution")],Ul.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)()],Ul.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:dU})],Ul.prototype,"viewModel",void 0),(0,Ve._)([(0,fc.h)()],Ul.prototype,"_toggleState",null),Ul=(0,Ve._)([(0,Wr.j)("esri.widgets.Attribution")],Ul);const m$=Ul;let O0=class extends(ZS(Ns.Z)){constructor(d){super(d),this._handles=new Ji.Z,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add((0,Ht.YP)(()=>this.view,this._updateRotationWatcher,Ht.nn))}destroy(){this._handles=(0,Qe.hw)(this._handles),this.view=null}get canShowNorth(){const d=this.get("view.spatialReference");return!(!d||!d.isWebMercator&&!d.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const d={};"2d"===this.view.type?d.rotation=0:d.heading=0,this.callGoTo({target:d})}_updateForRotation(d){null!=d&&(this.orientation={z:d})}_updateForCamera(d){d&&(this.orientation={x:0,y:0,z:-d.heading})}_updateRotationWatcher(d){this._handles.removeAll(),d&&this._handles.add("2d"===d.type?(0,Ht.YP)(()=>d?.rotation,this._updateForRotation,Ht.nn):(0,Ht.YP)(()=>d?.camera,this._updateForCamera,Ht.nn))}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],O0.prototype,"canShowNorth",null),(0,Ve._)([(0,ke.Cb)()],O0.prototype,"orientation",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],O0.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],O0.prototype,"view",void 0),O0=(0,Ve._)([(0,Wr.j)("esri.widgets.CompassViewModel")],O0);const hU=O0;let Ju=class extends ua.Z{constructor(d,_){super(d,_),this.iconClass="esri-icon-locate-circled",this.messages=null,this.viewModel=new hU}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(d){this.viewModel.goToOverride=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}reset(){return this.viewModel.reset()}render(){const{orientation:d,state:_}=this.viewModel,T="disabled"===_,x="compass"==("rotation"===_?"rotation":"compass"),A=T?-1:0,U={"esri-disabled":T,"esri-interactive":!T},ne={"esri-icon-compass":x,"esri-icon-dial":!x},{messages:fe}=this;return(0,Yt.u)("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",U),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:A,"aria-label":fe.reset,title:fe.reset},(0,Yt.u)("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",ne),styles:this._toRotationTransform(d)}),(0,Yt.u)("span",{class:"esri-icon-font-fallback-text"},fe.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(d){return{transform:`rotateZ(${d.z}deg)`}}};(0,Ve._)([(0,ke.Cb)()],Ju.prototype,"goToOverride",null),(0,Ve._)([(0,ke.Cb)()],Ju.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],Ju.prototype,"label",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Compass/t9n/Compass")],Ju.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)()],Ju.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:hU})],Ju.prototype,"viewModel",void 0),(0,Ve._)([(0,fc.h)()],Ju.prototype,"_reset",null),Ju=(0,Ve._)([(0,Wr.j)("esri.widgets.Compass")],Ju);const y$=Ju;let Mf=class extends Ns.Z{constructor(d){super(d),this.navigationMode="pan",this.view=null}initialize(){this.own((0,Ht.gx)(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Mf.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],Mf.prototype,"navigationMode",void 0),(0,Ve._)([(0,ke.Cb)()],Mf.prototype,"view",void 0),Mf=(0,Ve._)([(0,Wr.j)("esri.widgets.NavigationToggleViewModel")],Mf);const pU=Mf,Yc_button="esri-navigation-toggle__button esri-widget--button";let Qu=class extends ua.Z{constructor(d,_){super(d,_),this.iconClass="esri-icon-pan2",this.messages=null,this.viewModel=new pU}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}set layout(d){"horizontal"!==d&&(d="vertical"),this._set("layout",d)}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}toggle(){return this.viewModel.toggle()}render(){const d="disabled"===this.get("viewModel.state"),_="pan"===this.get("viewModel.navigationMode"),x={"esri-navigation-toggle__button--active":_},A={"esri-navigation-toggle__button--active":!_},U=d?-1:0,ne=this.messages.toggle;return(0,Yt.u)("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{"esri-disabled":d,"esri-navigation-toggle--horizontal":"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:U,"aria-label":ne,title:ne},(0,Yt.u)("div",{class:this.classes(Yc_button,"esri-navigation-toggle__button--pan",x)},(0,Yt.u)("span",{class:"esri-icon-pan"})),(0,Yt.u)("div",{class:this.classes(Yc_button,"esri-navigation-toggle__button--rotate",A)},(0,Yt.u)("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};(0,Ve._)([(0,ke.Cb)()],Qu.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],Qu.prototype,"label",null),(0,Ve._)([(0,ke.Cb)({value:"vertical"})],Qu.prototype,"layout",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Qu.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)()],Qu.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:pU})],Qu.prototype,"viewModel",void 0),(0,Ve._)([(0,fc.h)()],Qu.prototype,"_toggle",null),Qu=(0,Ve._)([(0,Wr.j)("esri.widgets.NavigationToggle")],Qu);const v$=Qu;let op=class extends ua.Z{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const d=this.enabled?0:-1,T={[this.iconClass]:!!this.iconClass};return(0,Yt.u)("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{"esri-disabled":!this.enabled,"esri-interactive":this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,title:this.title},(0,Yt.u)("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",T)}),(0,Yt.u)("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};(0,Ve._)([(0,ke.Cb)()],op.prototype,"action",void 0),(0,Ve._)([(0,ke.Cb)()],op.prototype,"enabled",void 0),(0,Ve._)([(0,ke.Cb)()],op.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],op.prototype,"title",void 0),(0,Ve._)([(0,fc.h)()],op.prototype,"_triggerAction",null),op=(0,Ve._)([(0,Wr.j)("esri.widgets.IconButton")],op);const _U=op;let Pf=class extends Ns.Z{get canZoomIn(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),_=this.get("view.constraints.effectiveMaxScale");return 0===_||d>_}get canZoomOut(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),_=this.get("view.constraints.effectiveMinScale");return 0===_||d<_}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pf.prototype,"canZoomIn",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Pf.prototype,"canZoomOut",null),(0,Ve._)([(0,ke.Cb)()],Pf.prototype,"view",void 0),Pf=(0,Ve._)([(0,Wr.j)("esri.widgets.Zoom.ZoomConditions2D")],Pf);const E$=Pf;let Of=class extends Ns.Z{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Of.prototype,"canZoomIn",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Of.prototype,"canZoomOut",null),(0,Ve._)([(0,ke.Cb)()],Of.prototype,"view",void 0),Of=(0,Ve._)([(0,Wr.j)("esri.widgets.Zoom.ZoomConditions3D")],Of);const b$=Of;let ap=class extends Ns.Z{constructor(d){super(d)}destroy(){this.view=null}get canZoomIn(){return(0,Qe.pC)(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){return(0,Qe.pC)(this._zoomConditions)&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(d){d?"2d"===d.type?this._zoomConditions=new E$({view:d}):"3d"===d.type&&(this._zoomConditions=new b$({view:d})):this._zoomConditions=null,this._set("view",d)}zoomIn(){if(!this.canZoomIn)return;const d=this.view;"2d"===d.type?d.mapViewNavigation.zoomIn():(0,ws.R8)(d.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const d=this.view;"2d"===d.type?d.mapViewNavigation.zoomOut():(0,ws.R8)(d.goTo({zoomFactor:.5}))}};(0,Ve._)([(0,ke.Cb)()],ap.prototype,"_zoomConditions",void 0),(0,Ve._)([(0,ke.Cb)()],ap.prototype,"canZoomIn",null),(0,Ve._)([(0,ke.Cb)()],ap.prototype,"canZoomOut",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ap.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],ap.prototype,"view",null),ap=(0,Ve._)([(0,Wr.j)("esri.widgets.Zoom.ZoomViewModel")],ap);const fU=ap;let Jd=class extends ua.Z{constructor(d,_){super(d,_),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.messages=null,this.viewModel=new fU}initialize(){this._zoomInButton=new _U({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new _U({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton=(0,Qe.SC)(this._zoomInButton),this._zoomOutButton=(0,Qe.SC)(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}set layout(d){"horizontal"!==d&&(d="vertical"),this._set("layout",d)}set view(d){this.viewModel.view=d}get view(){return this.viewModel.view}render(){const d=this.viewModel,_={"esri-zoom--horizontal":"horizontal"===this.layout},{canZoomIn:T,canZoomOut:x}=d;this._zoomInButton.enabled=T,this._zoomOutButton.enabled=x;const{zoomIn:A,zoomOut:U}=this.messages;return this._zoomInButton.title=A,this._zoomOutButton.title=U,(0,Yt.u)("div",{class:this.classes("esri-zoom esri-widget",_)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};(0,Ve._)([(0,ke.Cb)()],Jd.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],Jd.prototype,"label",null),(0,Ve._)([(0,ke.Cb)({value:"vertical"})],Jd.prototype,"layout",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Zoom/t9n/Zoom")],Jd.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)()],Jd.prototype,"view",null),(0,Ve._)([(0,ke.Cb)({type:fU})],Jd.prototype,"viewModel",void 0),Jd=(0,Ve._)([(0,Wr.j)("esri.widgets.Zoom")],Jd);const C$=Jd;let xb=class extends p${constructor(d){super(d),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([(0,Ht.YP)(()=>this.components,this._componentsWatcher.bind(this),Ht.nn),(0,Ht.YP)(()=>this.view,this._updateViewAwareWidgets.bind(this),Ht.nn)])}_add(d,_,T,x){if("string"==typeof d&&this._defaultPositionLookup[d]){if(this._find(d))return;d=this._createComponent(d)}super._add(d,_,T,x)}_removeComponents(d){d.forEach(_=>{const T=this._find(_);T&&(this.remove(T),T.destroy())})}_updateViewAwareWidgets(d){this.components.forEach(_=>{const T=this._find(_),x=T&&T.widget;(function T$(d){return d&&void 0!==d.view})(x)&&(x.view=d)})}_componentsWatcher(d,_){this._removeComponents(_),this._addComponents(d),this._adjustPadding(d)}_adjustPadding(d){if(!d.includes("attribution")&&!this._isOverridden("padding")){const{top:_}=this.padding;this.padding=_}}_addComponents(d){this.constructed&&d.forEach(_=>this.add(this._createComponent(_),this._defaultPositionLookup[_]))}_createComponent(d){const _=this._createWidget(d);if(_)return new Pb({id:d,node:_})}_createWidget(d){return"attribution"===d?this._createAttribution():"compass"===d?this._createCompass():"navigation-toggle"===d?this._createNavigationToggle():"zoom"===d?this._createZoom():void 0}_createAttribution(){return new m$({view:this.view})}_createCompass(){return new y$({view:this.view})}_createNavigationToggle(){return new v$({view:this.view})}_createZoom(){return new C$({view:this.view})}};(0,Ve._)([(0,ke.Cb)()],xb.prototype,"components",void 0),xb=(0,Ve._)([(0,Wr.j)("esri.views.ui.DefaultUI")],xb);const M$=xb;let Db=class extends M${constructor(d){super(d),this.components=["attribution","zoom","navigation-toggle","compass"]}};(0,Ve._)([(0,ke.Cb)()],Db.prototype,"components",void 0),Db=(0,Ve._)([(0,Wr.j)("esri.views.ui.3d.DefaultUI3D")],Db);const mU=Db;let Qs=class extends(d4(V8(K8(iB)))){constructor(d){var _;super(d),_=this,this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Nh.L({slicePlane:nu.B},this),this._resourceController=function LW(d){return new Bd({view:d})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new H2({view:this}),this.labeler=new p0({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new a_,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Kp,this.environmentManager=new cu,this.floors=new On.Z,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new oB({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new bW,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new mU,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new q2,this.voxelWasm=null,this.voxelWasmPromise=null,(0,c4.j2)(),d&&d.environment||(this._defaults.environment=new M_,this.environment=this._defaults.environment);const T=(x=null)=>{(0,Qe.pC)(x)&&x.type===SD.y.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(function(){var A=(0,kr.Z)(function*(U){try{yield U.when()}catch{}_._updatingChanged()});return function(U){return A.apply(this,arguments)}}()))};this.handles.add([(0,Ht.on)(()=>this.map?.allLayers,"after-changes",x=>T(x),{onListenerAdd:()=>T(),onListenerRemove:()=>T(),sync:!0}),this.allLayerViews.on("after-changes",x=>this._updateUpdatingMonitors(x)),(0,Ht.YP)(()=>this.map,x=>{x&&"load"in x&&x.load&&x.load().catch(()=>{})})]),this.inputManager=new mN({view:this}),this.stateManager=new Ho({view:this})}initialize(){this.groundView=new G8({view:this}),this._updateUpdatingMonitors();const d=()=>this._updateDefaultToMapOptions();this.handles.add((0,Ht.on)(()=>this.map?.allLayers,"after-changes",d,{onListenerAdd:d,onListenerRemove:d})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,_=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=_)},Ht.nn),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,_=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=_)},Ht.nn),this.updatingHandles.add(()=>this.qualitySettings.frameRate,_=>(0,gd.bP)(_>0?1e3/Math.ceil(_):0),Ht.nn),this.updatingHandles.add(()=>this.map?.ground,d,Ht.tX),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ht.tX),this.handles.add((0,Ht.YP)(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Ht.Z_))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=(0,Qe.SC)(this.sharedSymbolResources),this._set("labeler",(0,Qe.SC)(this.labeler)),this._set("deconflictor",(0,Qe.SC)(this.deconflictor)),this._resourceController=(0,Qe.SC)(this._resourceController),this._set("stateManager",(0,Qe.SC)(this.stateManager)),this._set("inputManager",(0,Qe.SC)(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",(0,Qe.SC)(this.environmentManager)),this.groundView=(0,Qe.SC)(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(d){this.stateManager&&(this.stateManager.camera=d)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(d){this.stateManager&&(this.stateManager.contentCamera=d)}installContentCameraReset(d={sticky:!1}){return this.stateManager.installContentCameraReset(d)}get center(){return this.stateManager?.center}set center(d){this.stateManager&&(this.stateManager.center=d)}get clippingArea(){if("global"===this.viewingMode)return null;let d=this._userClippingArea||this.get("map.clippingArea");return!this._userClippingArea&&!this.get("map.clippingEnabled")||(0,Qe.Wi)(d)?(this._clippingArea=null,null):d instanceof bl.Z?this.spatialReference&&(d=Sb(d,this.spatialReference),(0,Qe.Wi)(d))?(Us.Z.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(d=d.clone(),(0,Qe.Wi)(d.intersection(this._groundAndLayersExtent))&&(d.xmin=d.xmax,d.ymin=d.ymax),d.zmin=void 0,d.zmax=void 0,d.equals(this._clippingArea)||(this._clippingArea=d),this._clippingArea):(Us.Z.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(d){this.ready&&"global"===this.viewingMode&&(0,Qe.pC)(d)?Us.Z.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=d}get renderDataExtent(){if(this.state.viewingMode===vi.JY.Global)return null;const d=this.renderSpatialReference,_=this.dataExtent;return(0,Qe.Wi)(_)||(0,Qe.Wi)(d)||_.spatialReference.equals(d)?_:Sb(_,d)}get dataExtent(){let d=this._groundAndLayersExtent;const T=Sb(this.clippingArea,this.spatialReference||to.Z.WGS84);(0,Qe.pC)(T)&&(d=(0,Qe.pC)(d)?d.intersection(T):T);const x=this._get("dataExtent");return(0,Qe.pC)(d)&&d.equals(x)?x:d}get _groundAndLayersExtent(){const d=this.spatialReference||to.Z.WGS84;let _;const T=U=>{const ne=Sb(U,d);(0,Qe.Wi)(ne)||((0,Qe.pC)(_)?_.union(ne):_=ne.clone())},x=this.basemapTerrain;if(x?.spatialReference){const U=x.groundExtent;T(new bl.Z({xmin:U[0],ymin:U[1],zmin:0,xmax:U[2],ymax:U[3],zmax:0,spatialReference:x.spatialReference}))}if(this.map){const U=ne=>{!(0,Qe.pC)(ne.fullExtent)||"graphics"===ne.type&&ne.internal||T(ne.fullExtent)};this.map.allLayers.forEach(ne=>U(ne))}if((0,Qe.Wi)(_))return null;_.hasZ?(_.zmin=Math.min(0,_.zmin),_.zmax=Math.max(0,_.zmax)):(_.zmin=0,_.zmax=0);const A=this._get("_groundAndLayersExtent");return _.equals(A)?A:_}set environment(d){d!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",d)}castEnvironment(d){return d?d instanceof M_?d:d instanceof PA?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(d):M_.fromWebsceneEnvironment(d):(0,Hl.se)(M_,d):new M_}get extent(){return this.stateManager?.extent}set extent(d){this.stateManager&&(this.stateManager.extent=d)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(0,Qe.pC)(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&((0,Qe.Wi)(this.state)||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(d){this.stateManager&&(this.stateManager.padding=d)}set qualityProfile(d){yE.isValidProfile(d)&&(yE.apply(d,this.qualitySettings),this._set("qualityProfile",d))}get qualityProfile(){return this._get("qualityProfile")||yE.getDefaultProfile()}set slicePlane(d){if((0,Qe.pC)(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:d}),(0,Qe.Wi)(d))return void this._set("slicePlane",null);const _=this._propertiesPool.get("slicePlane");(0,nu.c)(d,_),this._set("slicePlane",_)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?(0,RD.dp)(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(d){this.stateManager&&(this.stateManager.scale=d)}get heightModelInfo(){const d=this.getDefaultHeightModelInfo();return null!=d?AD.Z.deriveUnitFromSR(d,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let d=0,_=this.layerViewManager.updating,T=_?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(x=>{if(x.isFulfilled()){if(x.updating){if(_=!0,x.suspended||(0,Cr.wP)(x))return;++T,d+=x.updatingProgress}}else++T});for(const x of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])(0,Qe.pC)(x)&&x.updating&&(T+=.1,d+=.05);for(const x of[this.deconflictor,this.labeler,this.basemapTerrain])(0,Qe.pC)(x)&&x.updating&&(++T,d+=x.updatingProgress);if(_=!!(_||T>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some(x=>!x.isFulfilled())),_?(this._numUpdating=Math.max(T,this._numUpdating),d+=this._numUpdating-T):this._numUpdating=0,this._numUpdating>0?d/=this._numUpdating:d=_?0:1,this._get("updatingProgress")!==d){const x=performance.now();if(d<1){const A=Math.min((x-this._lastUpdateTime)/2e3,1);d=this.updatingProgress*(1-A)+d*A}this._set("updatingProgress",d),this._lastUpdateTime=_&&d<1?x:0}return _}get viewingMode(){const d=this._predeterminedViewingMode;if((0,Qe.pC)(d))return(0,vi.M7)(d);const _=this.spatialReference;return _?(0,Qe.pC)(this.defaultsFromMap?.viewingMode)&&_.equals(this.defaultsFromMap.spatialReference)?(0,vi.M7)(this.defaultsFromMap.viewingMode):(0,r2.D)(_,vi.JY.Global)?"global":"local":"global"}set viewingMode(d){this.ready?Us.Z.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",d)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(d){this.stateManager&&(this.stateManager.viewpoint=d)}get zoom(){return this.stateManager?.zoom}set zoom(d){this.stateManager&&(this.stateManager.zoom=d)}get resourceController(){return this._resourceController}get performanceInfo(){return new FW(this)}on(d,_,T,x){return this.viewEvents.on(d,_,T,x)||super.on(d,_)}hasEventListener(d){return super.hasEventListener(d)||this.viewEvents.hasHandler(d)}toMap(d,_){if(!this.ready)return Us.Z.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const T=_?this.externalToInternalIntersectOptions(_):this._defaultToMapOptions,x=(0,Qe.pC)(T.graphics)&&((0,Qe.pC)(T.graphics.include)||(0,Qe.pC)(T.graphics.exclude)),A=(0,$l.Rw)(d)?(0,$l.s6)(this,d):d,U=(0,li.md)(A);T.enableDraped=T.include&&!T.include.has(bc.cy)||T.exclude&&T.exclude.has(bc.cy);const ne=this.sceneIntersectionHelper,fe=(0,Ga.Z8)(this.state.viewingMode);if(fe.options.selectionMode=!0,fe.options.store=x?ya.eC.ALL:ya.eC.MIN,ne.intersectIntersectorScreen(U,fe,T),x){for(const Oe of fe.results.all){const we=(0,Mb.bK)(Oe,this);if((0,Qe.Wi)(we))return this._intersectResultToMapPoint(Oe);if("graphic"!==we.type||this._testGraphicUidFilter(T.graphics,we.graphic))return this._intersectResultToMapPoint(Oe)}return null}return this._intersectResultToMapPoint(fe.results.min)}toScreen(d){if(!this.ready)return Us.Z.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const _=(0,Qe.Pt)(null==d.z&&(0,W_.KO)(this.elevationProvider,d),0);return(0,di.KC)(d,xf,this.renderSpatialReference,_),this.state.camera.projectToScreen(xf,dx),(0,li.vW)(dx[0],dx[1])}pixelSizeAt(d){return this.ready?d?((0,di.KC)(d,xf,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(xf)):0:(Us.Z.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(d){const _=this.basemapTerrain.overlayManager;return _?_.overlayPixelSizeInMapUnits(d):1}hitTest(d,_){if(!this.ready)return Us.Z.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const T=(0,$l.Rw)(d)?(0,$l.s6)(this,d):d,x=(0,li.s1)(T.x,T.y),A=_?this.externalToInternalIntersectOptions(_):this._defaultHitTestOptions;A.requiresGroundFeedback=!0,A.enableDraped=!0;const U=(0,Ga.Z8)(this.state.viewingMode);U.options.selectionMode=!0,U.options.store=ya.eC.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(x,U,A);const ne=this._intersectResultsToHits(U.results.all,A.graphics),fe=U.results.ground,Oe=(0,Mb.J4)(fe,this),we=(0,Qe.pC)(Oe)&&"type"in Oe&&"integrated-mesh"===Oe.type?Oe:null,Ze={screenPoint:T,results:ne,ground:{mapPoint:this._intersectResultToMapPoint(fe),distance:(0,pE.nn)(fe)?fe.distanceInRenderSpace:0,layer:we}};return Fo.Z.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ze.intersector=U),Promise.resolve(Ze)}popupHitTest(d){var _=this;return(0,kr.Z)(function*(){const{results:T,ground:x}=yield function n$(d,_){return ax.apply(this,arguments)}(_,d);let A=null;return!(0===T.length||Math.abs((0,Qe.Pt)(T[0].distance,0)-x.distance)<1e-5)||x.layer&&"integrated-mesh"===x.layer.type||(A=x.mapPoint),{results:T,screenPoint:d,mapPoint:A}})()}goTo(d,_){return this.updatingHandles.addPromise(this.stateManager.goTo(d,_))}whenAnalysisView(d){var _=this;return(0,kr.Z)(function*(){if((0,Qe.Wi)(d.parent))throw new ai.Z("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:d});switch(d.parent.type){case"line-of-sight":case"dimension":return(yield _.whenLayerView(d.parent)).whenAnalysisView();default:return _.analysisViewManager.whenAnalysisView(d)}})()}whenLayerView(d){return super.whenLayerView(d)}takeScreenshot(d){var _=this;return(0,kr.Z)(function*(){const T=_._completeSettings(d);return yield _.whenReady(),sx(yield _._stage.renderView.takeScreenshot(T),T,_._pixelFormat())})()}_takeScreenshot(d){var _=this;return(0,kr.Z)(function*(){const T=_._completeSettings(d);return yield _.whenReady(),function zZ(d,_){const{ctx:T,canvas:x}=tU(d,_),A=T.getImageData(0,0,d.width,d.height);return rU(x),A}(yield _._stage.renderView.takeScreenshot(T),_._pixelFormat())})()}_completeSettings(d){const _=function VZ(d,_){const T=WZ(d,_),x=T.area,A=T.width/x.width,U=nx(T,_.padding),ne=U.left+U.right,fe=U.top+U.bottom,we=_.height-fe,Ze=Math.floor((_.width-ne)*A+ne),it=Math.floor(we*A+fe),lt=d&&d.layers?d.layers:[],dt=T.ignoreBackground,Tt=T.ignorePadding;return{framebufferWidth:Ze,framebufferHeight:it,region:{x:Math.floor(x.x*A)+U.left,y:Math.floor(x.y*A)+U.top,width:T.width,height:T.height},format:T.format,quality:T.quality,rotation:T.rotation,pixelRatio:A,layers:lt,disableDecorations:T.disableDecorations,ignoreBackground:dt,ignorePadding:Tt,objectAndLayerIdColor:!1}}(d,this);return _.pixelRatio/=this.state.pixelRatio,function ZZ(d,_,T){if(!_)return d;const{framebufferWidth:x,framebufferHeight:A,pixelRatio:U,region:ne}=d,fe=nx(d,T),Oe=fe.left+fe.right,we=fe.top+fe.bottom,Ze=x-Oe,it=A-we,lt=Math.min(8,Math.min((2048-Oe)/Ze,(2048-we)/it));return lt<1.5?d:{...d,framebufferWidth:Math.round(Ze*lt)+Oe,framebufferHeight:Math.round(it*lt)+we,pixelRatio:U*lt,resample:{region:{x:Math.round((ne.x-fe.left)*lt)+fe.left,y:Math.round((ne.y-fe.top)*lt)+fe.top,width:Math.round(ne.width*lt),height:Math.round(ne.height*lt)},width:x,height:A}}}(_,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:d=>this._takeScreenshot(d)}}takeScreenshotWithObjectAndLayerId(d){var _=this;return(0,kr.Z)(function*(){if(!(0,So.Z)("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const T=_._completeSettings(d);yield _.whenReady();const x=yield _._stage.renderView.takeScreenshotWithOID(T),A=sx(x[0],T,_._pixelFormat()),U=_._completeSettings(d);return U.format="png",[A,sx(x[1],U,_._pixelFormat())]})()}getColorToObjectAndLayerIdMapping(){if(!(0,So.Z)("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView._objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(d){return this.updatingHandles.addPromise(d)}importLayerView(d){return(d=>{const _=_A[d.type];if((0,Qe.Wi)(_))throw function nB(d){const _=d.declaredClass?d.declaredClass.slice(d.declaredClass.lastIndexOf(".")+1):"Unknown",T=_.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new ai.Z(`${T}:view-not-supported`,`${_} is not supported in 3D`)}(d);return _(d)})(d)}hasLayerViewModule(d){return(d=>(0,Qe.pC)(_A[d.type]))(d)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}validate(){var d=this;return(0,kr.Z)(function*(){let _=function l$(d){const _=(0,a$.hc)(d);if(!_.available)return new ai.Z("webgl:required","WebGL is required but not supported.");if("3d"===d&&_.majorPerformanceCaveat)return new ai.Z("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!_.supportsHighPrecisionFragment)return new ai.Z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!_.supportsVertexShaderSamplers)return new ai.Z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(_.type===cl.zO.WEBGL1){if(!_.supportsElementIndexUint)return new ai.Z("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!_.supportsStandardDerivatives)return new ai.Z("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!_.supportsInstancedArrays)return new ai.Z("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}(d.type);if((0,So.Z)("safari")&&(0,So.Z)("safari")<9&&(_=new ai.Z("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,So.Z)("safari")})),(0,Qe.pC)(_))throw Us.Z.getLogger(d.declaredClass).warn("#validate()",_.message),_})()}get _predeterminedViewingMode(){const d=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return(0,Qe.pC)(d)?(0,vi.wg)(d):null}getSpatialReferenceSupport({spatialReference:d,layer:_}){const T=this._predeterminedViewingMode;if((0,Qe.pC)(T))return this._validateSpatialReferenceForViewingMode(d,_,T)?{constraints:this._makeSpatialReferenceConstraints(d,_,T)}:null;const x=this._validateSpatialReferenceForViewingMode(d,_,vi.JY.Local),A=this._validateSpatialReferenceForViewingMode(d,_,vi.JY.Global);return x||A?x&&A?{constraints:this._makeSpatialReferenceConstraints(d,_,null)}:x?{constraints:this._makeSpatialReferenceConstraints(d,_,vi.JY.Local)}:{constraints:this._makeSpatialReferenceConstraints(d,_,vi.JY.Global)}:null}_validateSpatialReferenceForViewingMode(d,_,T){return!(!(0,r2.D)(d,T)||!(0,Qe.Wi)(_)&&!(0,Gl.Am)(_)&&((0,Gl.iC)(_)&&(0,Qe.Wi)((0,Cr.E_)(_,d,T))||(0,Gl.Tv)(_)&&T===vi.JY.Global))}_makeSpatialReferenceConstraints(d,_,T){if((0,Qe.Wi)(_))return[{spatialReference:d,viewingMode:T}];const x=d.isWebMercator,A=d.isWGS84;return(0,Gl.Am)(_)&&(x||A)?A&&T!==vi.JY.Local&&null!==(0,Cr.er)(_.tileInfo,_.fullExtent,d,vi.JY.Global)?[{spatialReference:x?to.Z.WGS84:to.Z.WebMercator,viewingMode:T}]:[{spatialReference:d,viewingMode:T},{spatialReference:to.Z.WebMercator,viewingMode:T}]:(0,Gl.iC)(_)||(0,Gl.Tv)(_)||!x&&!A?(0,Gl.iC)(_)&&x&&T!==vi.JY.Global?[{spatialReference:d,viewingMode:T},{spatialReference:to.Z.WGS84,viewingMode:vi.JY.Local}]:[{spatialReference:d,viewingMode:T}]:[{spatialReference:d,viewingMode:T},{spatialReference:x?to.Z.WGS84:to.Z.WebMercator,viewingMode:T}]}_validateSpatialReference(d){const _=(0,Qe.pC)(this.getSpatialReferenceSupport({spatialReference:d})),T=this._predeterminedViewingMode;return _||((0,Qe.pC)(T)?Us.Z.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${(0,vi.M7)(T)} viewing mode.`):d.isGeographic&&Us.Z.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),_}whenReady(){return new Promise(d=>{this.ready?d(this):this._resolveWhenReady.push(d)})}computeMapPointFromVec3d(d,_){let T=this.spatialReference||to.Z.WGS84;return(0,di.SH)(d,this.renderSpatialReference,d,T)||(T=to.Z.WGS84,(0,di.SH)(d,this.renderSpatialReference,d,T)),_?(_.x=d[0],_.y=d[1],_.z=d[2],_.spatialReference=T):_=new vn.Z(d,T),_}trackGraphicState(d){if(!d.graphic)return Us.Z.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const _=this.getViewForGraphic(d.graphic);let T=null,x=!1;const A=U=>{!x&&(0,Qe.pC)(U)&&"processor"in U&&"graphics-3d"===U.processor?.type&&U.processor.graphicsCore&&(T=U.processor.graphicsCore.trackGraphicState(d))};return(0,Qe.pC)(_)?A(_):this.whenViewForGraphic(d.graphic,{waitForLayer:!0}).then(U=>A(U),()=>{}).catch(()=>{}),{remove:()=>{x=!0,(0,Qe.pC)(T)&&(T.remove(),T=null)}}}highlight(d){if(Array.isArray(d))return(0,Sp.AL)(d.map(T=>this.highlight(T)));if(On.Z.isCollection(d))return(0,Sp.AL)(d.toArray().map(T=>this.highlight(T)));const _=this.getViewForGraphic(d);return _&&"highlight"in _?_.highlight(d):(0,Sp.kB)()}maskOccludee(d){if(!d)return Us.Z.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const _=this.getViewForGraphic(d);let T=null,x=!1;const A=U=>{!x&&(0,Qe.pC)(U)&&(0,LM._1)(U)&&(T=U.maskOccludee(d))};return(0,Qe.pC)(_)?A(_):this.whenViewForGraphic(d,{waitForLayer:!0}).then(U=>A(U),()=>{}).catch(()=>{}),{remove:()=>{x=!0,(0,Qe.pC)(T)&&(T.remove(),T=null)}}}getViewForGraphic(d){return d.layer===this.graphics?this.graphicsView:d.layer?this.allLayerViews.find(_=>_.layer===d.layer):null}graphicChanged(d){(0,Qe.pC)(this.graphicsView)&&this.graphicsView.graphicChanged(d)}whenViewForGraphic(d,_){var T=this;return(0,kr.Z)(function*(){if(d.layer===T)return yield(0,Ht.N1)(()=>T.graphicsView),T.graphicsView;if(!d.layer||!T.map)throw new ai.Z("no-view-for-graphic");return _&&_.waitForLayer&&!T.map.allLayers.includes(d.layer)?new Promise((x,A)=>{const U=T.map.allLayers.on("change",ne=>{ne.added.includes(d.layer)&&(U.remove(),T.whenLayerView(d.layer).then(x,A))})}):T.whenLayerView(d.layer)})()}externalToInternalIntersectOptions(d){const _=this._externalToInternalRenderItems(d.include,Dy.INCLUDE),T=this._externalToInternalRenderItems(d.exclude,Dy.EXCLUDE);return{include:_.layerUids,exclude:T.layerUids,graphics:{include:_.graphicUids,exclude:T.graphicUids}}}_intersectResultToMapPoint(d,_){return d.getIntersectionPoint(xf)?(_=this.computeMapPointFromVec3d(xf,_),d.intersector===ya.q7.TERRAIN&&this.basemapTerrain&&(_.z=(0,Qe.Pt)((0,W_.KO)(this.basemapTerrain,_),0)),_):null}_intersectResultsToHits(d,_){const T=new Array;let x=null;for(let A=0;A<d.length;A++){const U=d[A],ne=(0,Mb.J4)(U,this);if((0,Qe.pC)(ne)&&(ne===this.map.ground||"type"in ne&&"integrated-mesh"===ne.type))break;const fe=(0,Mb.bK)(U,this);if((0,Qe.Wi)(fe))continue;if("graphic"===fe.type){if((0,Qe.Wi)(x)&&A!==d.length-1&&(x=new Set),(0,Qe.pC)(x)){const Ze=this._getGraphicFilterUid(fe.graphic);if(x.has(Ze))continue;x.add(Ze)}if(!this._testGraphicUidFilter(_,fe.graphic))continue}const Oe=this._intersectResultToMapPoint(U),we=U.distanceInRenderSpace;T.push({...fe,mapPoint:Oe,distance:we})}return T}_getGraphicFilterUid(d){const _=d.sourceLayer,T=d.layer,x=_&&"objectIdField"in _?_:T&&"objectIdField"in T?T:_;if(x){const U=d.attributes[x.objectIdField??wD.d];if(U)return`o-${x.id}-${U}`}return`u-${d.uid}`}_testGraphicUidFilter(d,_){const T=this._getGraphicFilterUid(_);return(0,Qe.Wi)(d)||((0,Qe.Wi)(d.include)||d.include.has(T))&&((0,Qe.Wi)(d.exclude)||!d.exclude.has(T))}_externalToInternalRenderItems(d,_,T={layerUids:null,graphicUids:null}){if(!d)return T;if(d instanceof fd.Z)(function P$(d,_){d.graphicUids||(d.graphicUids=new Set),d.graphicUids.add(_)})(T,this._getGraphicFilterUid(d)),_===Dy.INCLUDE&&((0,Qe.pC)(this.graphicsView)&&d.layer===this?xy(T,this.graphicsView.processor.layer.id):d.layer&&xy(T,d.layer.uid));else if((0,DD.TW)(d))for(const x of d)x===this.graphics&&(0,Qe.pC)(this.graphicsView)?xy(T,this.graphicsView.processor.layer.id):x===this.map.ground?xy(T,bc.cy):this._externalToInternalRenderItems(x,_,T);else"uid"in d&&xy(T,d.uid);return T}_initBasemapTerrain(){this._set("basemapTerrain",new lH({view:this})),this._set("elevationProvider",new Yg({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Za({view:this})),this._set("featureTiles",new ga({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const d=()=>{const _=this.basemapTerrain?.extent;if(this.clippingArea||_)if(_&&this.basemapTerrain.spatialReference){const T=(0,Qe.pC)(this.basemapTerrain.extent)&&(0,Qe.pC)(this.basemapTerrain.spatialReference)?(0,di.iV)((0,Bs.HH)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.featureTiles.filterExtent=(0,Qe.pC)(this.clippingArea)?this.clippingArea.intersection(T):T}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Fo.Z.FEATURE_TILE_TREE_SHOW_TILES,_=>{_&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Promise.all([v.e(8592),v.e(5566)]).then(v.bind(v,15566))).then(({FeatureTileTree3DDebugger:T})=>{!this._featureTreeDebugger&&Fo.Z.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new T({view:this}))}):_||!this._featureTreeDebugger||Fo.Z.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ht.tX),this.updatingHandles.add(()=>this.clippingArea,d,Ht.tX),this.updatingHandles.add(()=>this.basemapTerrain.extent,d,Ht.tX)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const d=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(d)||this._set("mapCoordsHelper",new SW(this.map,d));const _=this.state.isGlobal,T=(0,o_.E2)(_,d);T!==this.renderSpatialReference&&(this._set("renderCoordsHelper",AW.Z.create(this.state.viewingMode,T)),_||this.handles.add((0,Ht.YP)(()=>this.basemapTerrain?.extent,x=>{x&&(0!==x[0]||0!==x[1]||0!==x[2]||0!==x[3])&&(0,di.dH)(x,this.basemapTerrain.spatialReference,gU,this.renderCoordsHelper.spatialReference)&&(this.renderCoordsHelper.extent=gU)},Ht.Z_),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Ga.vh/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(d=null){(0,Qe.pC)(d)&&d.type===SD.y.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(_=>{_.destroyed||(this.handles.add((0,Ht.YP)(()=>[_.updating,_.updatingProgress],()=>this._updatingChanged(),Ht.Z_),"updatingMonitors"),_.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_prepareScreenshotOverlay(){var d=this;return(0,kr.Z)(function*(){d.overlay&&(yield d.overlay.prepare())})()}_renderScreenshotOverlay(d,_){if(!this.overlay||!this.overlay.hasVisibleItems)return _;const T=d.getContext("2d");return T.putImageData(_,0,0),this.overlay.renderCanvas(d),T.getImageData(0,0,_.width,_.height)}_initStage(){const d={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(fe,Oe)=>this._renderScreenshotOverlay(fe,Oe)}},_=new CW(this.state.viewingMode,fe=>this._stage.layers.forAll(fe),this);this._set("sceneIntersectionHelper",_);const T=(0,md.L7)(this.surface),{resourceController:x,state:A,renderSpatialReference:U}=this;this._stage=new Il({options:d,container:T,resourceController:x,state:A,sceneIntersectionHelper:_,renderSR:U}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=(0,Dp.on)(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new ai.Z("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Ht.nn),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Ht.nn),(0,Ht.YP)(()=>this.magnifier,fe=>this._stage.renderView.magnifier=fe,Ht.tX)],"stage");const ne=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:q2.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],ne),"stage"),ne(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Ga.vh/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(d){this._exitSurface(),this.state.init(d,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new KW({view:this,viewingMode:d,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const d=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(d,d),this._updatingChanged()}_createGraphicsViewAsync(d){var _=this;return(0,kr.Z)(function*(){const T=(yield Promise.all([v.e(1832),v.e(8592),v.e(7898)]).then(v.bind(v,87312))).default;(0,ws.k_)(d),yield(0,Ht.N1)(()=>_.basemapTerrain?.ready,d),_._set("graphicsView",new T({view:_}))})()}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),(0,Qe.pC)(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const d=(0,vi.wg)(this.viewingMode);if(d===vi.JY.Global&&(this._clippingArea=null),this._initSurface(d),this._set("ready",!0),this.handles.add((0,Ht.on)(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const T=this.get("map.initialViewProperties.environment");T&&(this.environment=T)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const _=this._resolveWhenReady;this._resolveWhenReady=[],_.forEach(T=>T(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(bc.cy);for(const d of this.map.allLayers.items)"integrated-mesh"===d.type&&this._defaultToMapOptions.include.add(d.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(bc.cy);for(const d of this.map.allLayers.items)"integrated-mesh"===d.type&&d.opacity<1&&this._defaultToMapOptions.exclude.add(d.uid)}}addVoxelLayerViewToWasm(d){return(0,Qe.Wi)(this.voxelWasm)?((0,Qe.Wi)(this.voxelWasmPromise)&&(this.voxelWasmPromise=v.e(3208).then(v.bind(v,23208)).then(_=>(this.voxelWasm=new _.default(this),this.voxelWasm))),this.voxelWasmPromise.then(_=>_.addVoxelLayer(d))):this.voxelWasm.addVoxelLayer(d)}removeVoxelLayerViewFromWasm(d){(0,Qe.pC)(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(d)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function xy(d,_){d.layerUids||(d.layerUids=new Set),d.layerUids.add(_)}function Sb(d,_){return(0,Qe.pC)(d)&&(0,di.Up)(d.spatialReference,_)?(0,di.iV)(d,_):null}var Dy;Qs.type="3d",(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"_userClippingArea",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"_resourceController",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"_stage",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"deconflictor",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"labeler",void 0),(0,Ve._)([(0,ke.Cb)((0,Av.z)(a_,"analyses"))],Qs.prototype,"analyses",void 0),(0,Ve._)([(0,ke.Cb)({type:g_,readOnly:!0})],Qs.prototype,"animation",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"basemapTerrain",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"elevationProvider",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"camera",null),(0,Ve._)([(0,ke.Cb)({type:uc})],Qs.prototype,"contentCamera",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"canvas",void 0),(0,Ve._)([(0,ke.Cb)({type:vn.Z})],Qs.prototype,"center",null),(0,Ve._)([(0,ke.Cb)({type:bl.Z})],Qs.prototype,"clippingArea",null),(0,Ve._)([(0,ke.Cb)({type:Kp})],Qs.prototype,"constraints",void 0),(0,Ve._)([(0,ke.Cb)({type:bl.Z,readOnly:!0})],Qs.prototype,"renderDataExtent",null),(0,Ve._)([(0,ke.Cb)({type:bl.Z,readOnly:!0})],Qs.prototype,"dataExtent",null),(0,Ve._)([(0,ke.Cb)({type:bl.Z,readOnly:!0})],Qs.prototype,"_groundAndLayersExtent",null),(0,Ve._)([(0,ke.Cb)({value:null,type:M_})],Qs.prototype,"environment",null),(0,Ve._)([(0,ko.p)("environment")],Qs.prototype,"castEnvironment",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"environmentManager",void 0),(0,Ve._)([(0,ke.Cb)({type:bl.Z})],Qs.prototype,"extent",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"floors",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"screenCenter",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"frustum",null),(0,Ve._)([(0,ke.Cb)({type:Number,readOnly:!0})],Qs.prototype,"fullOpacity",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"graphicsView",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"analysisViewManager",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"groundView",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Qs.prototype,"initialExtentRequired",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"_defaultsFromMapSettings",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"interacting",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"stationary",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"navigating",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"map",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"mapCoordsHelper",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"padding",null),(0,Ve._)([(0,ke.Cb)({type:Za,readOnly:!0})],Qs.prototype,"pointsOfInterest",void 0),(0,Ve._)([(0,ke.Cb)({type:ga,readOnly:!0})],Qs.prototype,"featureTiles",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"_featureTreeDebugger",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Qs.prototype,"screenSizePerspectiveEnabled",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Qs.prototype,"deactivatedWebGLExtensions",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Qs.prototype,"debugWebGLExtensions",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Qs.prototype,"renderCanvas",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Qs.prototype,"state",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"inputManager",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"stateManager",void 0),(0,Ve._)([(0,ke.Cb)({type:["low","medium","high"]})],Qs.prototype,"qualityProfile",null),(0,Ve._)([(0,ke.Cb)({type:fw,get(){let d=this._get("qualitySettings");return d||(d=new fw,yE.apply(this.qualityProfile,d)),d}})],Qs.prototype,"qualitySettings",void 0),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"slicePlane",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"typeSpecificPreconditionsReady",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"renderCoordsHelper",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"sceneIntersectionHelper",void 0),(0,Ve._)([(0,ke.Cb)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Qs.prototype,"resolution",null),(0,Ve._)([(0,ke.Cb)({type:Number})],Qs.prototype,"scale",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"heightModelInfo",null),(0,Ve._)([(0,ke.Cb)()],Qs.prototype,"spatialReference",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,constructOnly:!0})],Qs.prototype,"alphaCompositingEnabled",void 0),(0,Ve._)([(0,ke.Cb)({constructOnly:!0})],Qs.prototype,"preserveDrawingBufferEnabled",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean})],Qs.prototype,"supersampleScreenshotsEnabled",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Qs.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)({type:mU})],Qs.prototype,"ui",void 0),(0,Ve._)([(0,ke.Cb)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],Qs.prototype,"updating",null),(0,Ve._)([(0,ke.Cb)({type:Number,readOnly:!0,dependsOn:["updating"]})],Qs.prototype,"updatingProgress",void 0),(0,Ve._)([(0,ke.Cb)({type:["global","local"]})],Qs.prototype,"viewingMode",null),(0,Ve._)([(0,ke.Cb)({type:iu})],Qs.prototype,"viewpoint",null),(0,Ve._)([(0,ke.Cb)({type:Number})],Qs.prototype,"zoom",null),(0,Ve._)([(0,ke.Cb)({type:q2})],Qs.prototype,"highlightOptions",void 0),Qs=(0,Ve._)([(0,Wr.j)("esri.views.SceneView")],Qs),function(d){d[d.INCLUDE=0]="INCLUDE",d[d.EXCLUDE=1]="EXCLUDE"}(Dy||(Dy={}));const xf=(0,ir.c)(),dx=(0,li.s1)(),gU=(0,Bs.Ue)(),O$=Qs;var x$=v(2076),Sy=v(31283),D$=v(29538),yU=v(53390);let qu=class extends Ns.Z{constructor(d){super(d),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,So.Z)("mapview-transitions-duration"),this.effects=[]}set effect(d){if(this._get("effect")!==(d=d||"")){this._set("effect",d);try{this._transitionTo(vU(d))}catch(_){this._transitionTo([]),Us.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:d,error:_})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(d){this._updateForScale(d)}get transitioning(){return null!==this._to}canTransitionTo(d){try{return this.scale>0&&EU(this._current,vU(d),this.scale)}catch{return!1}}transitionStep(d,_){this._applyTimeTransition(d),this._updateForScale(_)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(d){this.scale>0&&EU(this._current,d,this.scale)?(this._final=d,this._to=(0,hd.d9)(d),function S$(d,_,T){const x=d.length>_.length?d:_,A=d.length>_.length?_:d,U=A[A.length-1],ne=U?.scale??T,fe=U?.effects??[];for(let Oe=A.length;Oe<x.length;Oe++)A.push({scale:ne,effects:[...fe]});for(let Oe=0;Oe<x.length;Oe++)A[Oe].scale=-1===A[Oe].scale?T:A[Oe].scale,x[Oe].scale=-1===x[Oe].scale?T:x[Oe].scale,(0,yU.uF)(A[Oe].effects,x[Oe].effects)}(this._current,this._to,this.scale),this._from=(0,hd.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=d),this._set("effects",this._current[0]?(0,hd.d9)(this._current[0].effects):[])}_applyTimeTransition(d){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=d;const _=Math.min(1,this._time/this.duration);for(let T=0;T<this._current.length;T++){const x=this._current[T],A=this._from[T],U=this._to[T];x.scale=A$(A.scale,U.scale,_);for(let ne=0;ne<x.effects.length;ne++)x.effects[ne].interpolate(A.effects[ne],U.effects[ne],_)}1===_&&(this._current=this._final,this._set("effects",this._current[0]?(0,hd.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(d){if(this._set("scale",d),0===this._current.length)return;const _=this._current,T=this._current.length-1;let x,A,U=1;if(1===_.length||d>=_[0].scale)A=x=_[0].effects;else if(d<=_[T].scale)A=x=_[T].effects;else for(let ne=0;ne<T;ne++){const fe=_[ne],Oe=_[ne+1];if(fe.scale>=d&&Oe.scale<=d){U=(d-fe.scale)/(Oe.scale-fe.scale),x=fe.effects,A=Oe.effects;break}}for(let ne=0;ne<this.effects.length;ne++)this.effects[ne].interpolate(x[ne],A[ne],U)}};function vU(d){const _=(0,D$.Q)(d)||[];return function R$(d){const _=d[0];return!!_&&"type"in _}(_)?[{scale:-1,effects:_}]:_}function EU(d,_,T){return!d[0]?.effects||!_[0]?.effects||!((-1===d[0]?.scale||-1===_[0]?.scale)&&(d.length>1||_.length>1)&&T<=0)&&(0,yU.AS)(d[0].effects,_[0].effects)}function A$(d,_,T){return d+(_-d)*T}(0,Ve._)([(0,ke.Cb)()],qu.prototype,"_to",void 0),(0,Ve._)([(0,ke.Cb)()],qu.prototype,"duration",void 0),(0,Ve._)([(0,ke.Cb)({value:""})],qu.prototype,"effect",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],qu.prototype,"effects",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],qu.prototype,"hasEffects",null),(0,Ve._)([(0,ke.Cb)({value:0})],qu.prototype,"scale",null),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],qu.prototype,"transitioning",null),qu=(0,Ve._)([(0,Wr.j)("esri.layers.effects.EffectView")],qu);var w$=v(71149),I$=v(14772),L$=v(33474),U$=v(50134),B$=v(24729),bU=v(56445),j$=v(88115),W$=v(66960);const CU={HH:315,HL:45,LL:135,LH:225},V$={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function z$(d){if(!d)return;const{type:_}=d;if(_.includes("3d"))return(0,W$.getSymbolLayerFill)(d.symbolLayers.getItemAt(0));if("simple-line"===_){const T=(0,$v.mx)(d);return T&&T.color}if("simple-marker"===d.type&&("x"===d.style||"cross"===d.style)){const T=(0,$v.mx)(d);return T&&T.color}return(0,$v._M)(d)}function H$(d,_){const T=_.HH.label,x=_.LL.label,A=_.HL.label,U=_.LH.label;switch(d){case"HH":default:return{top:T,bottom:x,left:A,right:U};case"HL":return{top:A,bottom:U,left:x,right:T};case"LL":return{top:x,bottom:T,left:U,right:A};case"LH":return{top:U,bottom:A,left:T,right:x}}}function TU(d){let _=CU[d];return d&&null==_&&(_=CU.HH),_||0}var Df=v(57213);const MU=[255,255,255],PU=[200,200,200],Sf=[128,128,128];function J$(d,_){const T=d.length-1;return d.map((x,A)=>lS(x,A,T,_))}function Q$(d,_,T,x,A,U,ne){return _x.apply(this,arguments)}function _x(){return _x=(0,kr.Z)(function*(d,_,T,x,A,U,ne){const fe=_.legendOptions,Oe=fe&&fe.customValues,we=ne||(yield tY(d,T)),dt=_.stops&&_.stops.length>1;if(!we||!Oe&&!(null!=_.minSize&&null!=_.maxSize||dt&&!_.target))return;const mt=(0,da.YW)(we);let Mt=null,Pt=null,Nt=null;Pt=mt&&!dt?zv([_.minDataValue,_.maxDataValue]):Oe||(yield sY(_,we,x,A));const Bt=d?.authoringInfo,Zt="univariate-color-size"===Bt?.type,nr=Zt&&"above-and-below"===Bt?.univariateTheme;if(!Pt&&dt&&(Pt=_.stops.map($r=>$r.value),Mt=_.stops.some($r=>!!$r.label),"flow"===d.type&&(Pt=zv(Pt)),Mt&&(Nt=_.stops.map($r=>$r.label))),mt&&Pt?.length>2&&!nr&&(Pt=[Pt[0],Pt[Pt.length-1]]),!Pt)return null;Zt&&5!==Pt?.length&&(Pt=DU({minSize:Pt[0],maxSize:Pt[Pt.length-1]}));const Jt=mt?q$(d,Pt):null,Rr=(0,da.Y6)(we),Br=Mt?null:J$(Pt,U);return(yield Promise.all(Pt.map(function(){var $r=(0,kr.Z)(function*(Yr,cs){const Xr=mt?Jt[cs]:yield Af(_,we,Yr,x,A);return{value:Yr,symbol:oY(nr&&"class-breaks"===d.type?eY(d,cs):we,Xr),label:Mt?Nt[cs]:Br[cs],size:Xr,outlineSize:Rr}});return function(Yr,cs){return $r.apply(this,arguments)}}()))).reverse()}),_x.apply(this,arguments)}function q$(d,_){const T=d?.authoringInfo,x="univariate-color-size"===T?.type;let A=[12,30];if(x){const U=_[0],ne=_[_.length-1],fe=12,Oe=30;A=_.map(we=>fe+(we-U)/(ne-U)*(Oe-fe))}return x&&"below"===T?.univariateTheme&&A.reverse(),A}function eY(d,_){const T=d.classBreakInfos,x=T.length,A=x<2||!(_>=2)?T[0].symbol.clone():T[x-1].symbol.clone();return d.visualVariables.some(U=>"color"===U.type)&&(A.type.includes("3d")?OU(A):xU(A)),A}function tY(d,_){return fx.apply(this,arguments)}function fx(){return fx=(0,kr.Z)(function*(d,_){if("flow"===d.type)return cS(d,_);if("pie-chart"===d.type)return new Df.Z({color:null,outline:d.outline?.width?d.outline:new nS.Z});let T=null,x=null;if("simple"===d.type)T=d.symbol;else if("class-breaks"===d.type){const A=d.classBreakInfos;T=A&&A[0]&&A[0].symbol,x=A.length>1}else if("unique-value"===d.type){const A=d.uniqueValueInfos;T=A&&A[0]&&A[0].symbol,x=A.length>1}return!T||rY(T)?null:(T=T.clone(),(_||x)&&(T.type.includes("3d")?OU(T):xU(T)),T)}),fx.apply(this,arguments)}function rY(d){return!!d&&((0,iS.dU)(d)?!!d.symbolLayers&&d.symbolLayers.some(_=>_&&"fill"===_.type):d.type.includes("fill"))}function OU(d){d.symbolLayers.forEach("line-3d"===d.type?_=>{_.material={color:Sf}}:_=>{"icon"!==_.type||_.resource&&_.resource.href?_.material={color:PU}:(_.material={color:MU},_.outline={color:Sf,size:1.5})})}function xU(d){const _=Vm();"cim"===d.type?(0,bU.ZB)(d,new lo.Z(PU)):d.type.includes("line")?d.color=Sf:(d.color=_?Sf:MU,"simple-marker"===d.type&&(d.outline?"#ffffff"===d.outline?.color?.toHex()&&(d.outline.color=Sf):d.outline={color:Sf,width:1.5}))}function sY(d,_,T,x){return mx.apply(this,arguments)}function mx(){return mx=(0,kr.Z)(function*(d,_,T,x){const A=(yield Promise.resolve().then(v.bind(v,81808))).getSizeRangeAtScale(d,T,x),U=A&&DU(A);if(!A&&!U)return;let ne=U.map(fe=>iY(fe,d,A));ne=zv(ne);for(let fe=1;fe<ne.length-1;fe++){const Oe=yield nY(d,_,ne[fe],ne[fe-1],T,x);Oe&&(ne[fe]=Oe[0],U[fe]=Oe[1])}return ne}),mx.apply(this,arguments)}function DU(d){const _=d.minSize,A=(d.maxSize-_)/4,U=[];for(let ne=0;ne<5;ne++)U.push(_+A*ne);return U}function iY(d,_,T){const x=T.minSize,A=T.maxSize,U=_.minDataValue,ne=_.maxDataValue;let fe=null;return fe=d<=x?U:d>=A?ne:(d-x)/(A-x)*(ne-U)+U,fe}function nY(d,_,T,x,A,U){return gx.apply(this,arguments)}function gx(){return gx=(0,kr.Z)(function*(d,_,T,x,A,U){const ne=yield Af(d,_,T,A,U),fe=yield Af(d,_,x,A,U),Oe=Wv(T);let it=Oe.integer,lt=null,dt=null;T>0&&T<1&&(lt=10**Oe.fractional,it=Wv(T*=lt).integer);for(let Tt=it-1;Tt>=0;Tt--){const mt=10**Tt;let Mt=Math.floor(T/mt)*mt,Pt=Math.ceil(T/mt)*mt;null!=lt&&(Mt/=lt,Pt/=lt);let Nt=(Mt+Pt)/2;[,Nt]=zv([Mt,Nt,Pt],{indexes:[1]});const Bt=yield Af(d,_,Mt,A,U),Zt=yield Af(d,_,Pt,A,U),nr=yield Af(d,_,Nt,A,U),Jt=Vv(ne,Bt,fe,null),Rr=Vv(ne,Zt,fe,null),Br=Vv(ne,nr,fe,null);let $r=Jt.previous<=20,Yr=Rr.previous<=20;if($r&&Yr&&(Jt.previous<=Rr.previous?($r=!0,Yr=!1):(Yr=!0,$r=!1)),$r?dt=[Mt,Bt]:Yr?dt=[Pt,Zt]:Br.previous<=20&&(dt=[Nt,nr]),dt)break}return dt}),gx.apply(this,arguments)}function Af(d,_,T,x,A){return yx.apply(this,arguments)}function yx(){return yx=(0,kr.Z)(function*(d,_,T,x,A){const{getSize:U}=yield Promise.resolve().then(v.bind(v,81808));return U(d,T,{scale:x,view:A,shape:"simple-marker"===_.type?_.style:null})}),yx.apply(this,arguments)}function oY(d,_){const T=d.clone();if((0,iS.dU)(T))(0,da.YW)(T)||T.symbolLayers.forEach(x=>{"fill"!==x.type&&(x.size=_)});else if(function $$(d){return"esri.symbols.SimpleMarkerSymbol"===d.declaredClass}(T))T.size=_;else if(function Y$(d){return"esri.symbols.PictureMarkerSymbol"===d.declaredClass}(T)){const x=T.width,A=T.height;T.height=_,T.width=_*(x/A)}else!function X$(d){return"esri.symbols.SimpleLineSymbol"===d.declaredClass}(T)?function k$(d){return"esri.symbols.TextSymbol"===d.declaredClass}(T)&&T.font&&(T.font.size=_):T.width=_;return T}const Ab=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,hY=new x$.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),SU={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Rb=new Df.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),pY=new VM.Z({style:"solid"});function vx(d){return"flow"===d.type}function AU(d){return"vector-field"===d.type}function RU(d){return"raster-colormap"===d.type}function wU(d){return"raster-stretch"===d.type}function IU(d){return"raster-shaded-relief"===d.type}function Rf(d){return"esri.renderers.SimpleRenderer"===d.declaredClass}function wf(d){return"esri.renderers.ClassBreaksRenderer"===d.declaredClass}function wb(d){return"esri.renderers.UniqueValueRenderer"===d.declaredClass}function LU(d){return"esri.renderers.HeatmapRenderer"===d.declaredClass}function Ex(d){return"esri.renderers.PointCloudClassBreaksRenderer"===d.declaredClass}function bx(d){return"esri.renderers.PointCloudStretchRenderer"===d.declaredClass}function Cx(d){return"esri.renderers.PointCloudUniqueValueRenderer"===d.declaredClass}function UU(d){return"esri.renderers.DotDensityRenderer"===d.declaredClass}function BU(d){return"esri.renderers.PieChartRenderer"===d.declaredClass}function jU(d){return"esri.layers.SubtypeGroupLayer"===d.declaredClass}function FU(d){return"esri.layers.MapImageLayer"===d.declaredClass}function If(d){return"esri.layers.ImageryLayer"===d.declaredClass}function Ib(d){return"esri.layers.ImageryTileLayer"===d.declaredClass}const xY=new Df.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Lf={},ra=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new On.Z,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const d=()=>this.notifyChange("ready");this._handles.add([(0,Ht.on)(()=>this.children,"change",_=>{const{added:T,removed:x}=_,A=this._handles;T.forEach(U=>{const ne=`activeLayerInfo-ready-watcher-${U.layer.uid}`;A.add((0,Ht.YP)(()=>U.ready,d,Ht.nn),ne)}),x.forEach(U=>A.remove(U.layer.uid)),d()})]),this.keepCacheOnDestroy||(Lf={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Lf=null)}get effectList(){const d=this.layer;let _=null;return"effect"in d&&d.effect&&(_=new qu,_.effect=d.effect,_.endTransitions(),_.scale=this.scale),_}get opacity(){const d=this.layer.opacity,_=this.parent?.opacity,T=this.layer.parent,x=T&&"uid"in T?this._getParentLayerOpacity(T):null;return null!=_?_*d:null!=x?x*d:d}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const d=this.layer;if(null===d)return!1;if("effect"in d&&d.effect&&Array.isArray(d.effect))return!0;if("featureReduction"in d&&d.featureReduction){if("cluster"===d.featureReduction.type)return!0;if("binning"===d.featureReduction.type&&"renderer"in d.featureReduction&&d.featureReduction.renderer)return this._isRendererScaleDriven(d.featureReduction.renderer)}return"renderer"in d&&d.renderer?this._isRendererScaleDriven(d.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}buildLegendElementsForFeatureCollections(d){var _=this;return(0,kr.Z)(function*(){if(_.hideLayersNotInCurrentView&&!(yield _._isLayerInCurrentView()))return _.legendElements=[],void _.notifyChange("ready");const T=Array.from(d,x=>{if(function CY(d){return"esri.layers.FeatureLayer"===d.declaredClass}(x))return _._getRendererLegendElements(x.renderer,{title:x.title});if(x.featureSet&&x.featureSet.features.length){const A=x.layerDefinition,U=A&&A.drawingInfo,ne=U&&(0,L$.i)(U.renderer),fe=hY.read(A.geometryType);return ne?_._getRendererLegendElements(ne,{title:x.name,geometryType:fe}):(Us.Z.getLogger(_.declaredClass).warn("drawingInfo not available!"),null)}return null});try{const x=[];yield(0,ws.as)(T).then(A=>{A.forEach(({value:U})=>U&&x.push(...U))}),_.legendElements=x,_.notifyChange("ready")}catch(x){Us.Z.getLogger(_.declaredClass).warn("error while building legend for layer!",x)}})()}buildLegendElementsForRenderer(d){var _=this;return(0,kr.Z)(function*(){try{const T=!_.hideLayersNotInCurrentView||(yield _._isLayerInCurrentView());_.legendElements=T?yield _._getRendererLegendElements(d):[],_.notifyChange("ready")}catch(T){Us.Z.getLogger(_.declaredClass).warn("error while building legend for layer!",T)}})()}buildLegendElementsForFeatureReduction(d){var _=this;return(0,kr.Z)(function*(){try{const T=!_.hideLayersNotInCurrentView||(yield _._isLayerInCurrentView());_.legendElements=T?yield _._getLegendElementsForFeatureReduction(d):[],_.notifyChange("ready")}catch(T){Us.Z.getLogger(_.declaredClass).warn("error while building legend for layer!",T)}})()}buildLegendElementsForTools(){var d=this;return(0,kr.Z)(function*(){const _=d.layer;if(function yY(d){return"esri.layers.VoxelLayer"===d.declaredClass}(_))d._constructLegendElementsForVoxellayer();else if(function EY(d){return"esri.layers.WMTSLayer"===d.declaredClass}(_))d._constructLegendElementsForWMTSlayer();else if(function vY(d){return"esri.layers.WMSLayer"===d.declaredClass}(_))yield d._constructLegendElementsForWMSSublayers();else if(function gY(d){return"esri.layers.BuildingSceneLayer"===d.declaredClass}(_))yield d._constructLegendElementsForBuildingSceneLayer();else if(FU(_)||function bY(d){return"esri.layers.TileLayer"===d.declaredClass}(_)||jU(_))yield d._constructLegendElementsForSublayers();else{d._handles.remove("imageryLayers-watcher");let T="default";If(_)&&(T=(_?.renderingRule?.functionName||"default")+"_"+(_.bandIds?.length?_.bandIds.join(""):"###")),yield d._getLegendLayers(`${_.uid}-${T}`).then(function(){var x=(0,kr.Z)(function*(A){d.legendElements=[],d.notifyChange("ready");const U=A.map(function(){var ne=(0,kr.Z)(function*(fe){if(If(_)||Ib(_)){const we=(0,Ht.YP)(()=>["renderingRule"in _&&_.renderingRule,_.bandIds],()=>(0,ws.Ds)((0,kr.Z)(function*(){Lf.default=null,_.renderer?yield d.buildLegendElementsForRenderer(_.renderer):yield d.buildLegendElementsForTools()}))());d._handles.add(we,"imageryLayers-watcher")}const Oe=d._generateSymbolTableElementForLegendLayer(fe);Oe&&Oe.infos.length&&(If(_)&&(Oe.title=_.title),d.legendElements.push(Oe)),d.notifyChange("ready")});return function(fe){return ne.apply(this,arguments)}}());yield(0,ws.as)(U)});return function(A){return x.apply(this,arguments)}}()).catch(x=>{Us.Z.getLogger(d.declaredClass).warn("Request to server for legend has failed!",x)})}})()}_isLayerInCurrentView(){var d=this;return(0,kr.Z)(function*(){const _=d.layer,T=d.layerView,x=T&&"createQuery"in T&&"queryFeatureCount"in T;if(!(x||T&&"createQuery"in _&&"queryFeatureCount"in _))return!0;yield(0,Ht.N1)(()=>!T.updating);const A=x?"createQuery"in T&&T.createQuery():"createQuery"in _&&_.createQuery();return A.geometry=d.view.extent,0!==(x?"queryFeatureCount"in T&&(yield T.queryFeatureCount(A)):"queryFeatureCount"in _&&(yield _.queryFeatureCount(A)))})()}_getParentLayerOpacity(d){let _=1;const T=d.parent;return T&&"uid"in T&&(_=this._getParentLayerOpacity(T)),d.opacity*_}_isGroupActive(){const d=this.children;return!!d.length&&d.some(_=>_.ready)}_isRendererScaleDriven(d){if("dot-density"===d.type)return!0;if(Ab.test("valueExpression"in d&&d.valueExpression))return!0;const T="visualVariables"in d&&d.visualVariables;return!!T&&T.some(x=>this._isScaleDrivenSizeVariable(x))}_isScaleDrivenSizeVariable(d){if(d&&"size"!==d.type)return!1;const _=d,T=_.minSize,x=_.maxSize;return"object"==typeof T&&T?this._isScaleDrivenSizeVariable(T):"object"==typeof x&&x?this._isScaleDrivenSizeVariable(x):!!_.expression||Ab.test(_.valueExpression)}_isLayerScaleDriven(d){if("minScale"in d&&d.minScale>0||"maxScale"in d&&d.maxScale>0)return!0;if("sublayers"in d&&d.sublayers)return d.sublayers.some(T=>this._isLayerScaleDriven(T));const _=d.parent;if(!1===d.loaded&&_&&FU(_)&&"source"in d&&d.source&&"map-layer"===d.source.type)for(const T of _.sourceJSON.layers)if(T.id===d.source.mapLayerId&&(T.minScale>0||T.maxScale>0))return!0;return!1}_constructLegendElementsForVoxellayer(){var d=this;return(0,kr.Z)(function*(){d.legendElements=[],d._handles.remove("voxel-style-watcher"),d._handles.remove("voxel-current-variable");const _=d.layer;d._handles.add((0,Ht.YP)(()=>_.currentVariableId,()=>d._constructLegendElementsForVoxellayer()),"voxel-current-variable"),d._handles.add((0,Ht.YP)(()=>_.getVariableStyles(),()=>d._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const T=(0,Qe.Wg)(_.getVariableStyle(null)),x=[];if(T)if(T.uniqueValues?.length){const ne=[];T.uniqueValues.forEach(fe=>{fe.enabled&&ne.push({label:fe.label||`${fe.value}`,value:fe.value,symbol:new VM.Z({color:fe.color,outline:null})})}),ne.length&&x.push({type:"symbol-table",title:T.label,infos:ne})}else if(T.transferFunction){const{colorStops:ne,stretchRange:fe}=T.transferFunction,Oe=ne.toArray().reverse(),we=fe.map((it,lt)=>`${0===lt?"<":">"} ${function aY(d){const T=Math.floor(Math.log10(Math.abs(d)))+1,x=T<4||T>6?4:T,U=Math.abs(d)>=1e6?"compact":"standard";return(0,Lm.uf)(d,{notation:U,minimumSignificantDigits:2,maximumSignificantDigits:x})}(it)}`).reverse(),Ze=Oe.map(it=>({color:it.color,value:null,label:null}));Ze[0].label=we[0],Ze[Ze.length-1].label=we[1],x.push({type:"color-ramp",title:T.label,infos:Ze,preview:jp(Oe.map(it=>it.color))})}const A=_.opacity,U=x.reduce((ne,fe)=>ne.concat(d._getAllInfos(fe)),[]).filter(ne=>!!ne?.symbol).map(ne=>d._getSymbolPreview(ne,A));yield(0,ws.as)(U),d.legendElements=x,d.notifyChange("ready")})()}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const d=this.layer.activeLayer;if(this._handles.add((0,Ht.YP)(()=>{const{layer:_}=this;return _&&"activeLayer"in _&&_.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),d.styleId&&d.styles){let _=null;d.styles.some(T=>d.styleId===T.id&&(_=T.legendUrl,!0)),_&&(this.legendElements=[{type:"symbol-table",title:d.title,infos:[{src:_,opacity:this.opacity}]}])}this.notifyChange("ready")}_constructLegendElementsForWMSSublayers(){var d=this;return(0,kr.Z)(function*(){d.legendElements=[],d._handles.remove("wms-sublayers-watcher");const _=d.layer;let T=null;(_.customParameters||_.customLayerParameters)&&(T={..._.customParameters,..._.customLayerParameters}),d._handles.add((0,Ht.YP)(()=>{const{layer:x}=d;return x&&"sublayers"in x&&x.sublayers},()=>d._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),d.legendElements=yield d._generateLegendElementsForWMSSublayers(_.sublayers,T),d.notifyChange("ready")})()}_generateLegendElementsForWMSSublayers(d,_){var T=this;return(0,kr.Z)(function*(){const x=[];T._handles.add(d.on("change",()=>T._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const A=d.toArray();for(const U of A){const ne=(0,Ht.YP)(()=>[U.title,U.visible,U.legendEnabled],()=>T._constructLegendElementsForWMSSublayers());if(T._handles.add(ne,"wms-sublayers-watcher"),!T.respectLayerVisibility||U.visible&&U.legendEnabled){const fe=yield T._generateSymbolTableElementForWMSSublayer(U,_);fe&&fe.infos.length&&x.unshift(fe)}}return x})()}_generateSymbolTableElementForWMSSublayer(d,_){var T=this;return(0,kr.Z)(function*(){if(!d.legendUrl&&d.sublayers){const x=(yield T._generateLegendElementsForWMSSublayers(d.sublayers,_)).filter(A=>A);return{type:"symbol-table",title:d.title,infos:x}}return T._generateSymbolTableElementForLegendUrl(d,_)})()}_generateSymbolTableElementForLegendUrl(d,_){return(0,kr.Z)(function*(){let T=d.legendUrl;if(!T)return;const x={type:"symbol-table",title:d.title||d.name||d.id&&d.id+"",infos:[]};_&&(T=(0,ST.fl)(T,_));let A=null;const U=d.layer?.opacity;try{A=(yield(0,cM.default)(T,{responseType:"image"})).data,A&&(A.style.opacity=U)}catch{}return x.infos.push({src:T,preview:A,opacity:U}),x})()}_getLegendLayers(d,_){const T=Lf&&Lf[d];return T?Promise.resolve(T):this._legendRequest(_).then(x=>{const A=x.layers;return Lf[d]=A,A})}_legendRequest(d){const _=this.layer;let T={f:"json",dynamicLayers:d};if(If(_)){const A=_.exportImageServiceParameters.renderingRule;if(A&&(T.renderingRule=JSON.stringify(A.rasterFunctionDefinition||A.toJSON())),_.bandIds&&(T.bandIds=_.bandIds.join()),_.raster||_.viewId||_.customParameters){const{raster:U,viewId:ne,customParameters:fe}=_;T={raster:U,viewId:ne,...T,...fe}}}let x=_.url.replace(/(\/)+$/,"");if("version"in _&&_.version>=10.01){const A=x.indexOf("?");A>-1?x=x.substring(0,A)+"/legend"+x.substring(A):x+="/legend"}else{const A=x.toLowerCase().indexOf("/rest/"),U=x.substring(0,A)+x.substring(A+5,x.length);x="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(U)+"&returnbytes=true"}return(0,cM.default)(x,{query:T}).then(A=>A.data)}_constructLegendElementsForBuildingSceneLayer(){var d=this;return(0,kr.Z)(function*(){d.legendElements=[],d._handles.remove("sublayers-watcher");const _=d.layer;d._handles.add((0,Ht.YP)(()=>_.sublayers,()=>d._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{d.legendElements=yield d._generateLegendElementsForBuildingSublayers(_.sublayers,d.opacity),d.notifyChange("ready")}catch(T){Us.Z.getLogger(d.declaredClass).warn("Request to server for legend has failed!",T)}})()}_generateLegendElementsForBuildingSublayers(d,_){var T=this;return(0,kr.Z)(function*(){let x=[];T._handles.add(d.on("change",()=>T._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const A=d.toArray();for(const U of A){const ne=(0,Ht.YP)(()=>["renderer"in U&&U.renderer,U.opacity,U.title,U.visible],()=>T._constructLegendElementsForBuildingSceneLayer());if(T._handles.add(ne,"sublayers-watcher"),!T.respectLayerVisibility||U.visible){const fe=U&&null!=U.opacity?U.opacity:null,Oe=null!=fe?fe*_:_;if("building-group"===U.type){const we={type:"symbol-table",title:U.title,infos:[]},Ze=yield T._generateLegendElementsForBuildingSublayers(U.sublayers,Oe);we.infos.push(...Ze),x=[we,...x]}else U.renderer&&(x=[...yield T._getRendererLegendElements(U.renderer,{title:U.title,opacity:Oe,sublayer:U}),...x])}}return x.filter(U=>!!U&&(!("infos"in U)||U.infos.length>0))})()}_constructLegendElementsForSublayers(){var d=this;return(0,kr.Z)(function*(){d.legendElements=[],d._handles.remove("sublayers-watcher");const _=d.layer;d._handles.add((0,Ht.YP)(()=>_.sublayers,()=>d._constructLegendElementsForSublayers),"sublayers-watcher");try{d.legendElements=yield d._generateLegendElementsForSublayers(_.sublayers,d.opacity),d.notifyChange("ready")}catch(T){Us.Z.getLogger(d.declaredClass).warn("Request to server for legend has failed!",T)}})()}_generateLegendElementsForSublayers(d,_,T){var x=this;return(0,kr.Z)(function*(){const A=x.layer;let U=[];x._handles.add(d.on("change",()=>x._constructLegendElementsForSublayers()),"sublayers-watcher");let ne=d.toArray();!T&&x.sublayerIds&&x.sublayerIds.length&&(ne=x.sublayerIds.map(fe=>A.findSublayerById(fe)).filter(Boolean));for(const fe of ne){const Oe=(0,Ht.YP)(()=>[fe.renderer,fe.opacity,fe.title,fe.visible,fe.legendEnabled],()=>x._constructLegendElementsForSublayers());if(x._handles.add(Oe,"sublayers-watcher"),!x.respectLayerVisibility||fe.visible&&fe.legendEnabled&&x._isSublayerInScale(fe)){const we=fe&&null!=fe.opacity?fe.opacity:null,Ze=null!=we?we*_:_,it=!!jU(A)||fe.originIdOf("renderer")>Sy.s3.SERVICE;if(fe.renderer&&!fe.sublayers&&it)yield fe.load(),U=[...yield x._getRendererLegendElements(fe.renderer,{title:fe.title,opacity:Ze,sublayer:fe}),...U];else{const lt=yield x._generateSymbolTableElementForSublayer(fe,Ze,T);lt&&U.unshift(lt)}}}return U.filter(fe=>!!fe&&(!("infos"in fe)||fe.infos.length>0))})()}_generateSymbolTableElementForSublayer(d,_,T){var x=this;return(0,kr.Z)(function*(){if(!T){T=new Map;const U=x.layer,ne=d.source;let fe=null;if(ne&&("map-layer"!==ne.type||ne.mapLayerId!==d.id||ne.gdbVersion&&ne.gdbVersion!==("gdbVersion"in U&&U.gdbVersion))||d.originIdOf("renderer")>Sy.s3.SERVICE||d.originIdOf("labelingInfo")>Sy.s3.SERVICE||d.originIdOf("labelsVisible")>Sy.s3.SERVICE){const we=new I$.R({layer:x.layer});fe=we.hasDynamicLayers?we.dynamicLayers:null,we.destroy()}const Oe=fe||`${U.uid}-default`;(yield x._getLegendLayers(Oe,fe)).forEach(we=>T.set(we.layerId,we))}const A=T.get(d.id);if((!A||A?.subLayerIds&&A.defaultVisibility)&&d.sublayers){const U=yield x._generateLegendElementsForSublayers(d.sublayers,_,T);return{type:"symbol-table",title:d.title,infos:U}}return x._generateSymbolTableElementForLegendLayer(A,d,_)})()}_generateSymbolTableElementForLegendLayer(d,_,T){if(!d||!d.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(d,_))return null;const x=_?.renderer;let A=_?.title||d.layerName;if(x&&(!_||_?.originIdOf("renderer")>Sy.s3.SERVICE)){const fe=_?.title||this._getRendererTitle(x,_);fe&&(A&&"string"!=typeof fe&&"title"in fe&&(fe.title=A),A=fe)}const U={type:"symbol-table",title:A,legendType:d.legendType?d.legendType:null,infos:[]},ne=_?this._sanitizeLegendForSublayer(d.legend.slice(),_):d.legend;return d.legendGroups?.length>0?d.legendGroups.forEach(fe=>{const Oe={type:"symbol-table",title:fe.heading,legendType:d.legendType?d.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(ne.filter(we=>we.groupId===fe.id),d.layerId,T)};Oe.infos?.length>0&&U.infos.push(Oe)}):U.infos=this._generateSymbolTableElementInfosForLegendLayer(ne,d.layerId,T),U.infos.length>0?U:null}_generateSymbolTableElementInfosForLegendLayer(d,_,T){return d.map(x=>{let A=x.url;if(x.imageData&&x.imageData.length>0)A=`data:image/png;base64,${x.imageData}`;else{if(0===A.indexOf("http"))return null;A=(0,P6.Dp)(`${this.layer.url}/${_}/images/${A}`)}return{label:x.label,src:A,opacity:T??this.opacity,width:x.width,height:x.height}}).filter(x=>!!x)}_isSublayerInScale(d){const _=d.minScale||0;return!(_>0&&_<this.scale||(d.maxScale||0)>this.scale)}_isLegendLayerInScale(d,_){const T=_||this.layer;let x=null,A=null,U=!0;return!T.minScale&&0!==T.minScale||!T.maxScale&&0!==T.maxScale?(0===d.minScale&&T.tileInfo&&(x=T.tileInfo.lods[0].scale),0===d.maxScale&&T.tileInfo&&(A=T.tileInfo.lods[T.tileInfo.lods.length-1].scale)):(x=Math.min(T.minScale,d.minScale)||T.minScale||d.minScale,A=Math.max(T.maxScale,d.maxScale)),(x>0&&x<this.scale||A>this.scale)&&(U=!1),U}_sanitizeLegendForSublayer(d,_){if("version"in this.layer&&this.layer.version<10.1||0===d.length)return d;const T=_.renderer,x=d.some(ne=>ne.values);let A=null,U=null;return x&&d.some((ne,fe)=>(ne.values||(A=fe,U=ne,U.label||(U.label="others")),null!=U)),T?"unique-value"===T.type?U&&(d.splice(A,1),d.push(U)):"class-breaks"===T.type&&(U&&d.splice(A,1),d.reverse(),U&&d.push(U)):U&&(d.splice(A,1),d.push(U)),d}_getRendererLegendElements(d,_={}){var T=this;return(0,kr.Z)(function*(){if(!function mY(d,_){return Rf(d)||wf(d)||wb(d)||LU(d)||UU(d)||BU(d)?"2d"===_.type||(0,U$.e)(d):wU(d)||RU(d)||IU(d)||Ex(d)||bx(d)||Cx(d)||AU(d)||vx(d)}(d,T.view))return Us.Z.getLogger(T.declaredClass).warn(`Renderer of type '${d.type}' not supported!`),[];if(function _Y(d){return Ex(d)||bx(d)||Cx(d)||function fY(d){return"esri.renderers.PointCloudRGBRenderer"===d.declaredClass}(d)}(d))return T._constructPointCloudRendererLegendElements(d,_);if(UU(d))return T._constructDotDensityRendererLegendElements(d);const x=yield T._loadRenderer(d);return BU(x)?T._constructPieChartRendererLegendElements(x):T._constructRendererLegendElements(x,_)})()}_getLegendElementsForFeatureReduction(d){var _=this;return(0,kr.Z)(function*(){let T=null;return"binning"===d.type?T=d.renderer:"cluster"===d.type&&(T=_._getClusterRenderer(d)),T?_._getRendererLegendElements(T):[]})()}_getPointCloudRendererTitle(d){return d.legendOptions&&d.legendOptions.title||d.field}_constructPointCloudRendererLegendElements(d,_={}){const T=_.title,x=[];let A=null,U=null;if(Ex(d))A={type:"symbol-table",title:T||this._getPointCloudRendererTitle(d),infos:[]},d.colorClassBreakInfos.forEach(fe=>{A.infos.unshift({label:fe.label||fe.minValue+" - "+fe.maxValue,value:[fe.minValue,fe.maxValue],symbol:this._getAppliedCloneSymbol(Rb,fe.color)})});else if(bx(d)){const fe=d.stops;let Oe=null;if(fe.length&&(1===fe.length&&(Oe=fe[0].color),!Oe)){const Ze=fe[0].value,it=fe[fe.length-1].value;null!=Ze&&null!=it&&(Oe=dS(Ze+(it-Ze)/2,fe))}A={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Rb,Oe||Rb.color)}]};const we=function p6(d){let _=!1,T=[],x=[];if(T=d.map(fe=>fe.value),_=d.some(fe=>!!fe.label),_&&(x=d.map(fe=>fe.label)),null==T[0]&&null==T[T.length-1])return null;const ne=_?null:uS(T,!1);return T.map((fe,Oe)=>({value:fe,color:dS(fe,d),label:_?x[Oe]:ne[Oe]})).reverse()}(d.stops);U={type:"color-ramp",title:T||this._getPointCloudRendererTitle(d),infos:we,preview:jp(we.map(Ze=>Ze.color))}}else Cx(d)&&(A={type:"symbol-table",title:T||this._getPointCloudRendererTitle(d),infos:[]},d.colorUniqueValueInfos.forEach(fe=>{A.infos.push({label:fe.label||fe.values.join(", "),value:fe.values.join(", "),symbol:this._getAppliedCloneSymbol(Rb,fe.color)})}));A&&A.infos.length&&x.push(A),U&&U.infos.length&&x.push(U);const ne=x.reduce((fe,Oe)=>fe.concat(Oe.infos),[]).filter(fe=>!!fe.symbol).map(fe=>this._getSymbolPreview(fe,this.opacity,{symbolConfig:{applyColorModulation:!!d.colorModulation}}));return(0,ws.as)(ne).then(()=>x)}_getElementInfoForDotDensity(d,_){const{backgroundColor:T,outline:x,dotSize:A}=d,U=this.effectList?.effects.map(lt=>lt.toJSON()),ne=(0,w$.rM)(U),fe=A+"-"+_+"-"+T+"-"+(x&&JSON.stringify(x.toJSON()))+"-"+ne,Oe=this._dotDensityUrlCache,we=Oe.has(fe)?Oe.get(fe):function E8(d,_,T){const{backgroundColor:x,outline:A,dotSize:U}=d,ne=T&&T.swatchSize||WS.b_.size,Oe=Math.round(ne*ne/U**2*.8),we=window.devicePixelRatio,Ze=document.createElement("canvas"),it=ne*we;Ze.width=it,Ze.height=it,Ze.style.width=Ze.width/we+"px",Ze.style.height=Ze.height/we+"px";const lt=Ze.getContext("2d");if(x&&(lt.fillStyle=x.toCss(!0),lt.fillRect(0,0,it,it),lt.fill()),lt.fillStyle=_.toCss(!0),__&&__.length/2===Oe)for(let Tt=0;Tt<2*Oe;Tt+=2)lt.fillRect(__[Tt],__[Tt+1],U*we,U*we),lt.fill();else{__=[];for(let Tt=0;Tt<2*Oe;Tt+=2){const mt=HS(0,it),Mt=HS(0,it);__.push(mt,Mt),lt.fillRect(mt,Mt,U*we,U*we),lt.fill()}}A&&(A.color&&(lt.strokeStyle=A.color.toCss(!0)),lt.lineWidth=A.width,lt.strokeRect(0,0,it,it));const dt=new Image(ne,ne);return dt.src=Ze.toDataURL(),dt}(d,_);Oe.set(fe,we);const it=(0,VS.w)([[{shape:{type:"image",x:0,y:0,width:we.width,height:we.height,src:we.src},fill:null,stroke:null,offset:[0,0]}]],[we.width,we.height],{effectView:this.effectList});return{opacity:1,src:we.src,preview:it,width:we.width,height:we.height}}_constructDotDensityRendererLegendElements(d){const _=d.calculateDotValue(this.view.scale),T=d.legendOptions&&d.legendOptions.unit,x={type:"symbol-table",title:{value:_&&Math.round(_),unit:T||""},infos:[]};return d.attributes.forEach(A=>{const U=this._getElementInfoForDotDensity(d,A.color);U.label=A.label||A.valueExpressionTitle||A.field,x.infos.push(U)}),Promise.resolve([x])}_constructPieChartRendererLegendElements(d){var _=this;return(0,kr.Z)(function*(){const T=_.layer.opacity,x=[],A="Others",U=d.outline;d.attributes.forEach(we=>{const Ze=new Df.Z({color:we.color,outline:U});x.push({label:we.label||we.valueExpressionTitle||we.field,symbol:Ze})});const ne=x.length?[...x]:[];if(d.othersCategory?.color&&0!==d.othersCategory?.threshold){const we=new Df.Z({color:d.othersCategory.color,outline:U});x.push({label:d.othersCategory.label||A,symbol:we})}if(d.defaultColor?.a){const we=new Df.Z({color:d.defaultColor,outline:U});x.push({label:d.defaultLabel,symbol:we})}const fe=(yield _._getVisualVariableLegendElements(d,_.layer))||[];if(x.length){fe.unshift({type:"symbol-table",title:null,infos:x});const Ze=function b8(d,_={}){const T=_.radius||40,x=2*Math.PI*T,A=d.length,U=x/A,ne=[],fe=(0,$v.mx)(_.outline);null!=fe?.width&&(fe.width*=2),(fe||_.backgroundColor)&&ne.push({shape:{type:"circle",cx:T,cy:T,r:T},fill:_.backgroundColor,stroke:fe,offset:[0,0]});const Oe=_.values,we=Oe&&Oe.length===A&&100===Oe.reduce((Tt,mt)=>Tt+mt,0),Ze=[0];for(let Tt=0;Tt<A;Tt++){let mt=null;we&&(mt=Oe[Tt]*x/100,Ze.push(mt+Ze[Tt])),ne.push({shape:{type:"circle",cx:T,cy:T,r:T/2},fill:[0,0,0,0],stroke:{width:T,dashArray:`${(mt??U)/2} ${x}`,dashoffset:"-"+(we?Ze[Tt]/2:Tt*(U/2)),color:d[Tt]},offset:[0,0]})}let it=null;const lt=2*T+(fe?.width||0),dt=_.holePercentage;if(dt){fe&&ne.push({shape:{type:"circle",cx:T,cy:T,r:T*dt},fill:null,stroke:fe,offset:[0,0]});const Tt=lt/2;it=[[{shape:{type:"circle",cx:Tt,cy:Tt,r:Tt},fill:zS,stroke:fe?{...fe,color:zS}:null,offset:[0,0]},{shape:{type:"circle",cx:Tt,cy:Tt,r:T*dt},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return(0,VS.w)([ne],[lt,lt],{effectView:_.effectList,ignoreStrokeWidth:!0,masking:it,rotation:-90})}(ne.filter(it=>it.label!==A).map(it=>it.symbol.color).filter(Boolean),{holePercentage:d.holePercentage,backgroundColor:d.backgroundFillSymbol?.color,effectList:_.effectList,outline:U});fe.unshift({type:"pie-chart-ramp",title:_._getRendererTitle(d,_.layer),infos:x,preview:Ze})}const Oe=fe.reduce((we,Ze)=>we.concat(_._getAllInfos(Ze)),[]).filter(we=>!!we?.symbol&&!we?.preview).map(we=>_._getSymbolPreview(we,T,{effectList:_.effectList}));return yield(0,ws.as)(Oe),fe})()}_constructRendererLegendElements(d,_={}){var T=this;return(0,kr.Z)(function*(){const{title:x,sublayer:A}=_,U=A||T.layer;T._hasColorRamp=!1,T._hasOpacityRamp=!1,T._hasSizeRamp=!1,T._scaleDrivenSizeVariable=null;const ne=(yield T._getVisualVariableLegendElements(d,U))||[],fe={type:"symbol-table",title:x||T._getRendererTitle(d,U),infos:[]};let Oe=null,we=!1;const Ze=new Set;if(vx(d)&&!T._hasSizeRamp){const Mt=yield cS(d);fe.infos.push({label:null,symbol:Mt})}else if(function PY(d){return"univariate-color-size"===("authoringInfo"in d&&d?.authoringInfo)?.type}(d)){let Mt=x;const Pt=function OY(d){const _="authoringInfo"in d&&d?.authoringInfo;return"univariate-color-size"===_?.type&&"above-and-below"===_?.univariateTheme}(d)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",Nt=ne.findIndex(Rr=>"color-ramp"===Rr.type),Bt=-1!==Nt?ne.splice(Nt,1)[0]:null,Zt=ne.findIndex(Rr=>"size-ramp"===Rr.type),nr=-1!==Zt?ne.splice(Zt,1)[0]:null,Jt=[];Bt&&(Mt=Bt.title,Jt.push(Bt)),nr&&(Mt=nr.title,Jt.push(nr)),Jt.length>0&&ne.push({type:Pt,title:Mt,infos:Jt})}else if(LU(d)){const Mt=hS(d);ne.push({type:"heatmap-ramp",title:x||T._getRendererTitle(d,U),infos:Mt,preview:jp(Mt.map(Pt=>Pt.color),{effectList:T.effectList})})}else if(wb(d)){const Mt=d&&d.authoringInfo;if(Mt&&"relationship"===Mt.type){const{focus:Pt,numClasses:Nt,field1:Bt,field2:Zt}=Mt;if(Nt&&Bt&&Zt){const nr=[Bt,Zt];let Jt=TU(Pt)||0;for(const Br of nr){const{field:$r,normalizationField:Yr,label:cs}=Br,Xr=cs||{field:T._getFieldAlias($r,U),normField:Yr&&T._getFieldAlias(Yr,U)},os=xY.clone();os.angle=Jt,fe.infos.push({label:Xr,symbol:os}),Ze.add(os),Jt+=90}const Rr=function G$(d){const{focus:_,infos:T,numClasses:x}=d,A=V$[x],U={};T.forEach(fe=>{U[fe.value]={label:fe.label,fill:z$(fe.symbol)}});const ne=[];for(let fe=0;fe<x;fe++){const Oe=[];for(let we=0;we<x;we++)Oe.push(U[A[fe][we]].fill);ne.push(Oe)}return{type:"relationship-ramp",numClasses:x,focus:_,colors:ne,labels:H$(_,U),rotation:TU(_)}}({focus:Pt,numClasses:Nt,infos:d.uniqueValueInfos});ne.unshift(Rr)}}else if(If(T.layer)||Ib(T.layer))d.uniqueValueInfos.forEach(Pt=>{Pt.symbol&&fe.infos.push({label:Pt.label||Pt.value,value:Pt.value,symbol:Pt.symbol})});else{const{field:Pt,field2:Nt,field3:Bt,fieldDelimiter:Zt,valueExpression:nr}=d,Jt=!(!Pt&&!nr||!Nt&&!Bt),Rr=[];if(d.uniqueValueGroups.forEach(Br=>{const $r={type:"symbol-table",title:Br.heading,infos:[]};Br.classes.forEach(Yr=>{const{symbol:cs,values:Xr}=Yr;if(cs){const os=[],br=[];for(const wr of Xr){const{value:Gr,value2:zr,value3:rs}=wr,ls=[],ms=[];(Pt||nr)&&(ls.push(Gr),ms.push(T._getDomainName(Pt,Gr,U))),Nt&&(ls.push(zr),ms.push(T._getDomainName(Nt,zr,U))),Bt&&(ls.push(rs),ms.push(T._getDomainName(Bt,rs,U))),os.push(Jt?ls.join(Zt||""):ls[0]),br.push(ms.join(" - "))}const Vr=os.join(", ");let lr=Yr.label;if(!lr){const wr=br.filter(Boolean);lr=wr.length?wr.join(", "):Vr}$r.infos.push({label:lr,value:Vr,symbol:cs})}}),$r.infos.length&&Rr.push($r)}),Rr.length){const Br=Rr[0];1===Rr.length&&"title"in Br&&!Br.title?fe.infos.push(...Br.infos):fe.infos.push(...Rr)}}d.defaultSymbol&&(fe.infos.push({label:d.defaultLabel||"others",symbol:d.defaultSymbol}),we=!0)}else if(wf(d))Oe=T._isUnclassedRenderer(d),(!Oe||!T._hasSizeRamp)&&(d.classBreakInfos.forEach(Mt=>{Mt.symbol&&fe.infos.unshift({label:Mt.label||(Oe?null:Mt.minValue+" - "+Mt.maxValue),value:[Mt.minValue,Mt.maxValue],symbol:Mt.symbol})}),Oe&&(fe.title=null),T._updateInfosforClassedSizeRenderer(d,fe.infos)),d.defaultSymbol&&!Oe&&(fe.infos.push({label:d.defaultLabel||"others",symbol:d.defaultSymbol}),we=!0);else if(wU(d))if(Ib(T.layer)||function TY(d){return"esri.layers.WCSLayer"===d.declaredClass}(T.layer)){const Mt=T._constructTileImageryStretchRendererElements(d);!function MY(d){return"stretch-ramp"===d.type}(Mt)?fe.infos=Mt:ne.push(Mt)}else{const Mt=T.layer;let Pt,Nt;d.statistics&&d.statistics.length&&(Pt=null!=d.statistics[0].min?d.statistics[0].min:d.statistics[0][0],Nt=null!=d.statistics[0].max?d.statistics[0].max:d.statistics[0][1]);let Bt=[];const Zt=(0,Qe.Wg)(Mt.renderingRule?yield Mt.generateRasterInfo(Mt.renderingRule):Mt.serviceRasterInfo),nr=Zt.keyProperties.BandProperties,Jt=SU[Mt.rasterInfo.pixelType.toLowerCase()];1===Zt.bandCount||Mt.bandIds&&1===Mt.bandIds.length?(Pt=Pt??(Zt.statistics?Zt.statistics[Mt.bandIds[0]].min:Jt[0]),Nt=Nt??(Zt.statistics?Zt.statistics[Mt.bandIds[0]].max:Jt[1]),Pt||Nt?ne.push(T._getStretchLegendElements(d,{min:Pt,max:Nt})):T._getServerSideLegend()):Zt.bandCount>=3?nr&&nr.length>=Zt.bandCount?Mt.bandIds&&3===Mt.bandIds.length?(Bt=Mt.bandIds.map(Rr=>nr[Rr].BandName),fe.infos=T._createSymbolTableElementMultiBand(Bt)):"lerc"===Mt.format?(Bt=[0,1,2].map(Rr=>nr[Rr].BandName),fe.infos=T._createSymbolTableElementMultiBand(Bt)):T._getServerSideLegend():"lerc"===Mt.format?(Bt=["band1","band2","band3"],fe.infos=T._createSymbolTableElementMultiBand(Bt)):T._getServerSideLegend():T._getServerSideLegend()}else if(RU(d))d.colormapInfos.forEach(Mt=>{fe.infos.push({label:Mt.label,value:Mt.value,symbol:T._getAppliedCloneSymbol(pY,Mt.color)})});else if(Rf(d)){let Mt=d.symbol;switch(_.geometryType){case"point":Mt="pointSymbol"in U&&U.pointSymbol;break;case"polyline":Mt="lineSymbol"in U&&U.lineSymbol;break;case"polygon":Mt="polygonSymbol"in U&&U.polygonSymbol}const Pt=T._hasClusterSizeVariable&&T._getClusterSymbol()||!T._hasSizeRamp;d.symbol&&Pt&&fe.infos.push({label:d.label,symbol:Mt})}else if(AU(d)){d.outputUnit&&(T.title="("+d.toJSON().outputUnit+")"),fe.title=d.attributeField;const Mt=d.getClassBreakInfos();Mt?.length?Mt.forEach(Pt=>{fe.infos.push({label:Pt.minValue+" - "+Pt.maxValue,symbol:Pt.symbol})}):fe.infos.push({label:d.attributeField,symbol:d.getDefaultSymbol()})}else IU(d)&&ne.push(T._getStretchLegendElements(d,{min:0,max:255}));const it=d.defaultSymbol;!it||we||Rf(d)||Oe&&!T._hasColorRamp&&!T._hasSizeRamp&&!T._hasOpacityRamp||ne.push({type:"symbol-table",infos:[{label:d.defaultLabel||"others",symbol:it}]}),fe.infos.length&&ne.unshift(fe);const lt=_.opacity??T.opacity,dt=T._isTallSymbol("visualVariables"in d&&d.visualVariables),Tt=If(T.layer)||Ib(T.layer),mt=ne.reduce((Mt,Pt)=>Mt.concat(T._getAllInfos(Pt)),[]).filter(Mt=>!!Mt?.symbol).map(Mt=>T._getSymbolPreview(Mt,lt,{isDefault:Mt.symbol===it,applyScaleDrivenSize:!Ze.has(Mt.symbol),symbolConfig:{isTall:dt,isSquareFill:Tt},effectList:Ze.has(Mt.symbol)?null:T.effectList}));return d=null,yield(0,ws.as)(mt),ne})()}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(d){const _=d?.infos;return _?_.reduce((T,x)=>T.concat(this._getAllInfos(x)),[]):[d]}_constructTileImageryStretchRendererElements(d){const _=this.layer,T=_.rasterInfo,x=T.bandCount||d.statistics.length;let A,U,ne=[];const fe=T.keyProperties&&T.keyProperties.BandProperties,Oe=d?.statistics?.length?d.statistics:T?.statistics;if(Oe)A=void 0!==Oe[0].min?Oe[0].min:Oe[0][0],U=Oe[0].max||Oe[0][1];else{const Ze=SU[_.rasterInfo.pixelType.toLowerCase()];A=Ze[0],U=Ze[1]}if(_.hasStandardTime()&&(A=_.getStandardTimeValue(A),U=_.getStandardTimeValue(U)),1===T.bandCount||1===_.bandIds?.length)return this._getStretchLegendElements(d,{min:A,max:U});function we(Ze){const it=(_?.bandIds?.length?_.bandIds:Array.from(Array(Math.min(T.bandCount,3)).keys())).map(lt=>Ze&&Ze[lt]&&Ze[lt].BandName||"band"+(lt+1));return it.length<3?it.push(it[1]):it.length>3&&it.splice(3),it}return ne=fe&&fe.length>=x?we(fe):we(),this._createSymbolTableElementMultiBand(ne)}_getStretchLegendElements(d,_){const x=function f6(d,_){let T=[];if(d&&"multipart"===d.type)d.colorRamps.reverse().forEach((x,A)=>{T.push(0===A?{value:_.max,color:new lo.Z(x.toColor),label:"high"}:{value:null,color:new lo.Z(x.toColor),label:""}),T.push(A===d.colorRamps.length-1?{value:_.min,color:new lo.Z(x.fromColor),label:"low"}:{value:null,color:new lo.Z(x.fromColor),label:""})});else{let x,A;d&&"algorithmic"===d.type?(x=d.fromColor,A=d.toColor):(x=[0,0,0,1],A=[255,255,255,1]),T=[{value:_.max,color:new lo.Z(A),label:"high"},{value:_.min,color:new lo.Z(x),label:"low"}]}return T}(d.colorRamp,_);return{type:"stretch-ramp",title:"",infos:x,preview:jp(x.map(A=>A.color))}}_getClusterSymbol(){const d=this.layer,_="featureReduction"in d&&d.featureReduction,T=_&&"symbol"in _&&_.renderer;return T&&!0!==T?.authoringInfo?.isAutoGenerated?null:_&&"symbol"in _&&_.symbol}_getSizeLegendElement(d,_,T,x){var A=this;return(0,kr.Z)(function*(){return{type:"size-ramp",title:A._hasClusterSizeVariable?A._getClusterTitle(_):d,infos:yield Q$(T,_,yield tM(T),A.scale,A.view.type,x,A._hasClusterSizeVariable?A._getClusterSymbol():null)}})()}_createSymbolTableElementMultiBand(d){const _=[],T=["red","green","blue"];return d.forEach((x,A)=>{_.push({label:{colorName:T[A],bandName:x},src:u6[A],opacity:this.opacity??1})}),_}_updateInfosforClassedSizeRenderer(d,_){const T=d.authoringInfo&&"class-breaks-size"===d.authoringInfo.type,x=d.classBreakInfos.some(A=>(0,da.YW)(A.symbol));if(T&&x){const A=30,ne=d.classBreakInfos.length,fe=(A-12)/(ne>1?ne-1:ne);_.forEach((Oe,we)=>{Oe.size=A-fe*we})}}_isTallSymbol(d){let _=!1,T=!1;if(d)for(let x=0;x<d.length&&(!_||!T);x++){const A=d[x];"size"===A.type&&("height"===A.axis&&(_=!0),"width-and-depth"===A.axis&&(T=!0))}return _&&T}_getSymbolPreview(d,_,T){var x=this;return(0,kr.Z)(function*(){let A=!T?.isDefault&&null==d.size&&x._hasSizeRamp?(0,li.Wz)(WS.b_.size):d.size;if(x._scaleDrivenSizeVariable&&T?.applyScaleDrivenSize){const{getSize:U}=yield Promise.resolve().then(v.bind(v,81808));A=U(x._scaleDrivenSizeVariable,null,{view:x.view.type,scale:x.scale,shape:"simple-marker"===d.symbol.type?d.symbol.style:null})}return GS(d.symbol,{size:A,opacity:_,scale:!1,symbolConfig:T?.symbolConfig,effectView:T?.effectList}).then(U=>(d.preview=U,d)).catch(()=>(d.preview=null,d))})()}_getClusterRenderer(d){this._hasClusterSizeVariable=!1;const _="renderer"in this.layer&&this.layer.renderer,T=d.renderer?.clone()||_?.clone(),x=(0,Qe.Wg)(function N$(d,_){if(!d||!("visualVariables"in d)||!d.visualVariables)return null;const T=d.visualVariables.find(A=>"size"===A.type),x=((d,_)=>{const T=d.featuresTilingScheme.getClosestInfoForScale(d.scale).level;return _?.levels?_.levels[T]:null})(_,T);return x?new j$.Z({field:T.field,minSize:x[2].size,minDataValue:x[2].value,maxSize:x[3].size,maxDataValue:x[3].value}):null}(this.layerView._effectiveRenderer,this.view));if(x&&"visualVariables"in T&&!T.visualVariables?.some(U=>"size"===U.type&&"outline"!==U.target&&!Ab.test(U.valueExpression))){if("clusterMinSize"in d&&"clusterMaxSize"in d){const{clusterMinSize:ne,clusterMaxSize:fe}=d;x.legendOptions=new B$.Z({showLegend:ne!==fe})}T.visualVariables=(T.visualVariables||[]).concat([x]),this._hasClusterSizeVariable=!0}return T}_loadRenderer(d){var _=this;return(0,kr.Z)(function*(){const T=[],x=d.clone(),A=yield tM(x);if(wf(x)||wb(x)){const U=(x.classBreakInfos||x.uniqueValueInfos).map(ne=>_._fetchSymbol(ne.symbol,A).then(fe=>{ne.symbol=fe}).catch(()=>{ne.symbol=null}));Array.prototype.push.apply(T,U)}return T.push(_._fetchSymbol(x.symbol||x.defaultSymbol,x.defaultSymbol?null:A).then(U=>{_._applySymbolToRenderer(x,U,Rf(x))}).catch(()=>{_._applySymbolToRenderer(x,null,Rf(x))})),(0,ws.as)(T).then(()=>x)})()}_applySymbolToRenderer(d,_,T){T?d.symbol=_:d.defaultSymbol=_}_fetchSymbol(d,_){var T=this;return(0,kr.Z)(function*(){if(!d)throw new Error;if("web-style"===d.type){const x=T._webStyleSymbolCache;try{const A=yield"2d"===T.view.type?d.fetchCIMSymbol({cache:x}):d.fetchSymbol({cache:x});return T._getAppliedCloneSymbol(A,_)}catch{throw Us.Z.getLogger(T.declaredClass).warn("Fetching web-style failed!"),new Error}}return T._getAppliedCloneSymbol(d,_)})()}_getAppliedCloneSymbol(d,_){if(!d||!_)return d;const T=d.clone(),x=_&&_.toRgba();return T.type.includes("3d")?this._applyColorTo3dSymbol(T,x):"cim"===T.type?(0,bU.ZB)(T,_):T.color&&(T.color=new lo.Z(x||T.color)),T}_applyColorTo3dSymbol(d,_){_&&d.symbolLayers.forEach(T=>{T&&(T.material||(T.material={}),T.material.color=new lo.Z(_))})}_getVisualVariableLegendElements(d,_){var T=this;return(0,kr.Z)(function*(){if(!("visualVariables"in d)||!d.visualVariables||"vector-field"===d.type)return null;const x=d.visualVariables,A=[],U=[],ne=[];for(const it of x)"color"===it.type?A.push(it):"size"===it.type?U.push(it):"opacity"===it.type&&ne.push(it);const fe=[...A,...U,...ne];let Oe,we;if(0===A.length&&wf(d)&&d.classBreakInfos&&1===d.classBreakInfos.length){const it=d.classBreakInfos[0];Oe=it&&it.symbol}if(0===A.length&&Rf(d)&&(Oe=d.symbol),Oe)if(Oe.type.includes("3d")){const it=Oe.symbolLayers.getItemAt(0);"water"===it.type?(0,Qe.pC)(it.color)&&(we=it.color):(0,Qe.pC)(it.material)&&(0,Qe.pC)(it.material.color)&&(we=it.material.color)}else Oe.url||(we=Oe.color);const Ze=T.effectList;return(yield Promise.all(fe.map(function(){var it=(0,kr.Z)(function*(lt){if(!lt.legendOptions||!1!==lt.legendOptions.showLegend){const dt=vx(d)?lt.field:T._getRampTitle(lt,_);let Tt=null;const mt="getField"in _&&_.getField&&_.getField(lt.field),Mt=mt&&(0,Iv.y2)(mt);if("color"===lt.type){const Pt=yield iM(lt,null,Mt);Tt={type:"color-ramp",title:dt,infos:Pt,preview:jp(Pt.map(Nt=>Nt.color),{effectList:Ze})},T._hasColorRamp||(T._hasColorRamp=!(null==Tt.infos||!Tt.infos.length))}else if("size"===lt.type&&"outline"!==lt.target)Ab.test(lt.valueExpression)?T._hasClusterSizeVariable||(T._scaleDrivenSizeVariable=lt):(Tt=yield T._getSizeLegendElement(dt,lt,d,Mt),T._hasSizeRamp||(T._hasSizeRamp=!(null==Tt.infos||!Tt.infos.length)));else if("opacity"===lt.type){const Pt=yield iM(lt,we,Mt);Tt={type:"opacity-ramp",title:dt,infos:Pt,preview:jp(Pt.map(Nt=>Nt.color),{effectList:Ze})},T._hasOpacityRamp||(T._hasOpacityRamp=!(null==Tt.infos||!Tt.infos.length))}return Tt&&Tt.infos?Tt:null}});return function(lt){return it.apply(this,arguments)}}()))).filter(it=>!!it)})()}_getDomainName(d,_,T){if(d&&"function"!=typeof d){const x="getField"in T&&T.getField&&T.getField(d),A=x&&"getFieldDomain"in T&&T.getFieldDomain?T.getFieldDomain(x.name):null;return A&&"coded-value"===A.type?A.getName(_):null}return null}_getClusterTitle(d){const _=this.layer,T=d.field;if("featureReduction"in _&&_.featureReduction&&"cluster"===_.featureReduction.type){const x=_.featureReduction,A="popupTemplate"in x&&x.popupTemplate,U=A&&A.fieldInfos;if(U)for(const ne of U)if(ne.fieldName===T)return"cluster_count"===T?ne.label||{showCount:!0}:ne.label}return{showCount:!0}}_getRampTitle(d,_){let T=d.field,x=d.normalizationField,A=!1,U=!1,ne=!1,fe=null;T="function"==typeof T?null:T,x="function"==typeof x?null:x;const Oe=d.legendOptions&&d.legendOptions.title;if(null!=Oe)fe=Oe;else if(d.valueExpressionTitle)fe=d.valueExpressionTitle;else{if("renderer"in _&&_.renderer&&"authoringInfo"in _.renderer&&_.renderer.authoringInfo&&_.renderer.authoringInfo.visualVariables){const we=_.renderer.authoringInfo.visualVariables;for(let Ze=0;Ze<we.length;Ze++){const it=we[Ze];if("color"===it.type){if("ratio"===it.style){A=!0;break}if("percent"===it.style){U=!0;break}if("percent-of-total"===it.style){ne=!0;break}}}}fe={field:T&&this._getFieldAlias(T,_),normField:x&&this._getFieldAlias(x,_),ratio:A,ratioPercent:U,ratioPercentTotal:ne}}return fe}_getRendererTitle(d,_){const T=d;if(T.legendOptions&&T.legendOptions.title)return T.legendOptions.title;if(T.valueExpressionTitle)return T.valueExpressionTitle;let x=T.field,A=null,U=null;if(wf(T)&&(A=T.normalizationField,U="percent-of-total"===T.normalizationType),x="function"==typeof x?null:x,A="function"==typeof A?null:A,wb(T)){const{field2:fe,field3:Oe,fieldDelimiter:we}=T;let Ze=x&&this._getFieldAlias(x,_);return fe&&(Ze=`<${Ze}>${we}<${this._getFieldAlias(fe,_)}>`,Oe&&(Ze=`${Ze}${we}<${this._getFieldAlias(Oe,_)}>`)),Ze}let ne=null;return(x||A)&&(ne={field:x&&this._getFieldAlias(x,_),normField:A&&this._getFieldAlias(A,_),normByPct:U}),ne}_getFieldAlias(d,_){const T="popupTemplate"in _&&_.popupTemplate,x=T&&T.fieldInfos;let A=null;x&&x.some(Ze=>d===Ze.fieldName&&(A=Ze,!0));let U=null;"getField"in _&&_.getField?U=_.getField(d):"fieldsIndex"in _&&_.fieldsIndex&&(U=_.fieldsIndex.get(d));let ne=null;const fe="featureReduction"in _&&_.featureReduction;fe&&(!A&&"popupTemplate"in fe&&fe.popupTemplate&&fe.popupTemplate.fieldInfos&&fe.popupTemplate.fieldInfos.some(Ze=>d?.toLowerCase()===Ze.fieldName?.toLowerCase()&&(A=Ze,!0)),"fields"in fe&&fe.fields&&(ne=fe.fields.find(Ze=>Ze.name?.toLowerCase()===d?.toLowerCase())));const Oe=A||U||ne;let we=null;return Oe&&(we=A?.label||U?.alias||ne?.alias||"name"in Oe&&Oe.name||"fieldName"in Oe&&Oe.fieldName),we}_isUnclassedRenderer(d){const _=d.visualVariables;let T=!1;return wf(d)&&d.classBreakInfos&&1===d.classBreakInfos.length&&_&&(T=d.field?_.some(x=>!(!x||d.field!==x.field||(d.normalizationField||x.normalizationField)&&d.normalizationField!==x.normalizationField)):!!_.length),T}};(0,Ve._)([(0,ke.Cb)()],ra.prototype,"children",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ra.prototype,"effectList",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"layerView",void 0),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"layer",void 0),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"legendElements",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ra.prototype,"opacity",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"parent",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:[]})],ra.prototype,"ready",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"hideLayersNotInCurrentView",void 0),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"keepCacheOnDestroy",void 0),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"respectLayerVisibility",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ra.prototype,"scale",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"sublayerIds",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],ra.prototype,"isScaleDriven",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"title",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],ra.prototype,"version",null),(0,Ve._)([(0,ke.Cb)()],ra.prototype,"view",void 0),ra=(0,Ve._)([(0,Wr.j)("esri.widgets.Legend.support.ActiveLayerInfo")],ra);const NU=ra,WU=On.Z.ofType(NU),DY=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],VU="view.basemapView.baseLayerViews",zU="view.groundView.layerViews",HU="view.basemapView.referenceLayerViews",SY=[VU,zU,"view.layerViews",HU];let Xc=class extends Ns.Z{constructor(d){super(d),this._handles=new Ji.Z,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new On.Z,this.activeLayerInfos=new WU,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add((0,Ht.YP)(()=>this.view,()=>this._viewHandles(),Ht.nn),"view"),this._handles.add((0,vS.qe)(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove("state"),this.view&&this._handles.add((0,Ht.YP)(()=>this.state,()=>this._stateHandles(),Ht.nn),"state")}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove(["all-layer-views","legend-properties"]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(d){this._handles.remove(d);const _=this._activeLayerInfosByLayerViewId[d];delete this._activeLayerInfosByLayerViewId[d],_&&_.parent&&_.parent.children.remove(_)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:d}=this.view;d.length&&this._refresh(),this._handles.add(d.on("change",_=>this._allLayerViewsChangeHandle(_)),"all-layer-views"),this._handles.add((0,Ht.YP)(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),"legend-properties")}_allLayerViewsChangeHandle(d){d.removed.forEach(_=>this._destroyViewActiveLayerInfo(_.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(d){if(d.length<2)return;const _=[];d.forEach(x=>{if(!x.parent){const A=x.layer.parent,U=A&&"uid"in A&&this._layerViewByLayerId[A.uid],ne=U&&this._activeLayerInfosByLayerViewId[U.uid];ne&&d.includes(ne)&&(_.push(x),x.parent=ne,ne.children.add(x),this._sortActiveLayerInfos(ne.children))}}),d.removeMany(_);const T={};this.view.allLayerViews.forEach((x,A)=>T[x.layer.uid]=A),d.sort((x,A)=>(T[A.layer.uid]||0)-(T[x.layer.uid]||0))}_generateLayerViews(){const d=[];return SY.filter(this._filterLayerViews,this).map(this.get,this).filter(_=>null!=_).forEach(this._collectLayerViews("layerViews",d)),d}_filterLayerViews(d){return!(!this.basemapLegendVisible&&(d===VU||d===HU)||!this.groundLegendVisible&&d===zU)}_collectLayerViews(d,_){const T=x=>(x&&x.forEach(A=>{_.push(A),T(A[d])}),_);return T}_filterLayerViewsByLayerInfos(d){const _=this.layerInfos;return!_||!_.length||_.some(T=>this._hasLayerInfo(T,d))}_hasLayerInfo(d,_){const T=this._isLayerUIDMatching(d.layer,_.layer.uid);return T&&(this._layerInfosByLayerViewId[_.uid]=d),T}_isLayerUIDMatching(d,_){return d&&(d.uid===_||this._hasLayerUID(d.layers,_))}_hasLayerUID(d,_){return d&&d.some(T=>this._isLayerUIDMatching(T,_))}_isLayerViewSupported(d){return!!DY.includes(d.layer.declaredClass)&&(this._layerViewByLayerId[d.layer.uid]=d,!0)}_generateActiveLayerInfo(d){this._isLayerActive(d)?this._buildActiveLayerInfo(d):(this._handles.remove(d.uid),this._handles.add((0,Ht.YP)(()=>[d.legendEnabled,d.layer?.legendEnabled],()=>this._layerActiveHandle(d)),d.uid))}_layerActiveHandle(d){this._isLayerActive(d)&&(this._handles.remove(d.uid),this._buildActiveLayerInfo(d))}_isLayerActive(d){return!this.respectLayerVisibility||d.legendEnabled&&d.get("layer.legendEnabled")}_buildActiveLayerInfo(d){const _=d.layer,T=d.uid,x=this._layerInfosByLayerViewId[T];let A=this._activeLayerInfosByLayerViewId[T];if(A||(A=new NU({layer:_,layerView:d,title:x&&void 0!==x.title&&x.layer.uid===_.uid?x.title:_.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:x&&x.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[T]=A),A.parent=this._activeLayerInfosByLayerViewId[(_.parent&&"uid"in _.parent&&this._layerViewByLayerId[_.parent?.uid])?.uid],!this._handles.has(T)){const ne=[(0,Ht.YP)(()=>_.title,fe=>this._titleHandle(fe,A)),(0,Ht.YP)(()=>[_.opacity,"renderer"in _&&_.renderer,"pointSymbol"in _&&_.pointSymbol,"lineSymbol"in _&&_.lineSymbol,"polygonSymbol"in _&&_.polygonSymbol],()=>this._constructLegendElements(A)),(0,Ht.gx)(()=>!0===this.view?.stationary,()=>this._scaleHandle(A),Ht.nn),(0,Ht.YP)(()=>d._effectiveRenderer,()=>this._constructLegendElements(A)),(0,Ht.YP)(()=>"effect"in _&&_.effect,()=>this._constructLegendElements(A))];if(this.respectLayerVisibility){const fe=(0,Ht.YP)(()=>d.legendEnabled,we=>this._legendEnabledHandle(we,A)),Oe=(0,Ht.YP)(()=>_.legendEnabled,we=>this._legendEnabledHandle(we,A));ne.push(fe,Oe)}this._handles.add(ne,T)}A.isScaleDriven||this._constructLegendElements(A),this._addActiveLayerInfo(A)}_titleHandle(d,_){_.title=d,this._constructLegendElements(_)}_legendEnabledHandle(d,_){d?this._addActiveLayerInfo(_):this._removeActiveLayerInfo(_)}_scaleHandle(d){(d.isScaleDriven||d.hideLayersNotInCurrentView)&&this._constructLegendElements(d)}_addActiveLayerInfo(d){const{layerView:_,layer:T}=d;if(this._isLayerActive(_)&&!this.activeLayerInfos.includes(d)){const x=d.parent;if(x)x.children.includes(d)||x.children.push(d),this._sortActiveLayerInfos(x.children);else{const A=this.layerInfos?.some(U=>U.layer.uid===T.uid);T.parent&&"uid"in T.parent&&!A?this._activeLayerInfosWithNoParent.add(d):(this.activeLayerInfos.add(d),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const A=[];this._activeLayerInfosWithNoParent.forEach(U=>{const ne=U.layer.parent,Oe=this._activeLayerInfosByLayerViewId[(ne&&"uid"in ne&&this._layerViewByLayerId[ne?.uid])?.uid];Oe&&(A.push(U),U.parent=Oe)}),A.length&&(this._activeLayerInfosWithNoParent.removeMany(A),A.forEach(U=>this._addActiveLayerInfo(U)))}}}_removeActiveLayerInfo(d){const _=d.parent;_?_.children.remove(d):this.activeLayerInfos.remove(d)}_constructLegendElements(d){const _=d.layer;"featureCollections"in _&&_.featureCollections?d.buildLegendElementsForFeatureCollections(_.featureCollections):"featureReduction"in _&&_.featureReduction&&"renderer"in _.featureReduction&&("binning"===_.featureReduction.type||"cluster"===_.featureReduction.type)?d.buildLegendElementsForFeatureReduction(_.featureReduction):"renderer"in _&&_.renderer&&!("sublayers"in _)?d.buildLegendElementsForRenderer(_.renderer):"url"in _&&_.url?d.buildLegendElementsForTools():d.children.forEach(T=>this._constructLegendElements(T))}};(0,Ve._)([(0,ke.Cb)({type:WU})],Xc.prototype,"activeLayerInfos",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"basemapLegendVisible",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"groundLegendVisible",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"hideLayersNotInCurrentView",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"keepCacheOnDestroy",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"respectLayerVisibility",void 0),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"layerInfos",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],Xc.prototype,"state",null),(0,Ve._)([(0,ke.Cb)()],Xc.prototype,"view",void 0),Xc=(0,Ve._)([(0,Wr.j)("esri.widgets.Legend.LegendViewModel")],Xc);const AY=Xc;var Qd=v(30695);const $n_squareTableRow="esri-relationship-ramp--square__table-row",$n_squareTableCell="esri-relationship-ramp--square__table-cell",$n_squareTableLabel="esri-relationship-ramp--square__table-label";function GU(d,_,T,x){const{focus:A,labels:U}=d,ne=!!A,fe=function wY(d,_,T,x,A=60){const{focus:U,numClasses:ne,colors:fe,rotation:Oe}=d,we=!!U,Ze=Math.sqrt(A**2+A**2)+(we?0:5),it=[],lt=[],dt=[],Tt=(A||75)/ne;for(let Yr=0;Yr<ne;Yr++){const cs=Yr*Tt;for(let Xr=0;Xr<ne;Xr++){const os=Xr*Tt,br=(0,Qd.jA)(fe[Yr][Xr]),Vr=(0,Qd.kQ)(null),lr={type:"rect",x:os,y:cs,width:Tt,height:Tt};it.push((0,Qd.ch)(br)),lt.push((0,Qd.vq)(lr,br.fill,Vr,null)),dt.push((0,Qd.A5)(lr))}}let Bt=null;we||(Bt="margin: -15px -15px -18px -15px");const Zt=KU("left",U,_),nr=KU("right",U,_),Jt=(0,Qd.al)(dt),Rr=(0,Qd.iL)(Jt,Ze,Ze,0,!1,Oe,!1),Br=(0,Qd.iL)(Jt,Ze,Ze,0,!1,we?-45:null,!1),$r={filter:(0,da.wJ)(x),opacity:null==T?null:`${T}`};return(0,Yt.u)("div",{styles:$r,class:we?"esri-relationship-ramp--diamond__middle-column--ramp":$n_squareTableCell},(0,Yt.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Ze,height:Ze,style:Bt},(0,Yt.u)("defs",null,(0,Yt.u)("marker",{id:`${_}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,Yt.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,Yt.u)("marker",{id:`${_}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,Yt.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),it),(0,Yt.u)("g",{transform:Rr},lt),(0,Yt.u)("g",{transform:Br},(0,Yt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":Zt.markerStart,"marker-end":Zt.markerEnd,x1:-10,y1:A-15,x2:-10,y2:15}),(0,Yt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":nr.markerStart,"marker-end":nr.markerEnd,x1:15,y1:A+10,x2:A-15,y2:A+10}))))}(d,_,T,x),we=(0,uo.dZ)();return ne?(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__container",styles:{justifyContent:"center"}},(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__left-column"},we?U.right:U.left),(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__middle-column"},(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},U.top),fe,(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},U.bottom)),(0,Yt.u)("div",{class:"esri-relationship-ramp--diamond__right-column"},we?U.left:U.right)):(0,Yt.u)("div",{class:"esri-relationship-ramp--square__table"},(0,Yt.u)("div",{class:$n_squareTableRow},(0,Yt.u)("div",{class:(0,uo.Sh)($n_squareTableCell,$n_squareTableLabel,"esri-relationship-ramp--square__table-label--right-bottom")},we?U.top:U.left),(0,Yt.u)("div",{class:$n_squareTableCell}),(0,Yt.u)("div",{class:(0,uo.Sh)($n_squareTableCell,$n_squareTableLabel,"esri-relationship-ramp--square__table-label--left-bottom")},we?U.left:U.top)),(0,Yt.u)("div",{class:$n_squareTableRow},(0,Yt.u)("div",{class:$n_squareTableCell}),fe,(0,Yt.u)("div",{class:$n_squareTableCell})),(0,Yt.u)("div",{class:$n_squareTableRow},(0,Yt.u)("div",{class:(0,uo.Sh)($n_squareTableCell,$n_squareTableLabel,"esri-relationship-ramp--square__table-label--right-top")},we?U.right:U.bottom),(0,Yt.u)("div",{class:$n_squareTableCell}),(0,Yt.u)("div",{class:(0,uo.Sh)($n_squareTableCell,$n_squareTableLabel,"esri-relationship-ramp--square__table-label--left-top")},we?U.bottom:U.right)))}function KU(d,_,T){const x=`${T}_arrowStart`,A=`${T}_arrowEnd`,U="left"===d,ne={markerStart:null,markerEnd:null};switch(_){case"HL":U?ne.markerStart=`url(#${A})`:ne.markerEnd=`url(#${x})`;break;case"LL":ne.markerStart=`url(#${A})`;break;case"LH":U?ne.markerEnd=`url(#${x})`:ne.markerStart=`url(#${A})`;break;default:ne.markerEnd=`url(#${x})`}return ne}const IY=(0,jT.E)();function LY(d="vertical"){const _="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===d?(0,Yt.u)("svg",{height:"4",width:"10"},(0,Yt.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:_})):(0,Yt.u)("svg",{height:"10",width:"10"},(0,Yt.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:_}))}function UY(d,_="vertical"){const T=document.createElement("div");return T.style.height="20px",T.className="esri-univariate-above-and-below-ramp__symbol",null!=d&&(T.style.opacity=d.toString()),IY.append(T,LY.bind(null,_)),T}function $U(d,_,T="vertical",x){d.infos.forEach((A,U)=>{if(x&&2===U)A.preview=UY(_,T);else{const ne=(0,li.F2)(A.size)+("horizontal"===T?20:10),fe="div"===A.preview.tagName.toLowerCase(),Oe=fe?A.preview:document.createElement("div");Oe.className="esri-univariate-above-and-below-ramp__symbol","horizontal"===T?Oe.style.width=`${ne}px`:Oe.style.height=`${ne}px`,fe||Oe.appendChild(A.preview),A.preview=Oe}})}function Ub(d,_="classic"){const T=d.infos;return"classic"===_?((0,li.F2)(T[0].size)+10)/2:((0,li.F2)(T[0].size)-(0,li.F2)(T[T.length-1].size))/2}function Uf(d,_){if(!d)return null;const T=d.infos.map(A=>A.color),x=jp("full"===_.type?T:"above"===_.type?T.slice(0,3):T.slice(2,5),{width:_.width,height:_.height,align:_.rampAlignment,effectList:_.effectList});return x.className="esri-legend__color-ramp",null!=_.opacity&&(x.style.opacity=_.opacity.toString()),x}function Ox(d,_,T,x="vertical"){let A=0;const U=d.infos,ne=Math.floor(U.length/2),Oe="full"===_||"below"===_?U.length-1:ne;for(let we="full"===_||"above"===_?0:ne;we<=Oe;we++)A+=T&&we===ne?"horizontal"===x?10:20:(0,li.F2)(U[we].size)+("horizontal"===x?20:10);return Math.round(A)}function Bf(d,_,T,x="vertical"){const A=Ox(d,_,T,x),U=d.infos,ne=Math.floor(U.length/2),fe="full"===_||"above"===_?0:ne,Oe="full"===_||"below"===_?U.length-1:ne,Ze=T?"vertical"===x?20:10:0,it="vertical"===x?10*("full"===_?2:1):20*("full"===_?2:1);return Math.round(A-((0,li.F2)("full"===_?U[fe].size+U[Oe].size:"above"===_?U[fe].size:U[Oe].size)/2+Ze/2+it/2))}function YU(d,_,T="vertical"){const x=d.infos;let A=x.find(({type:ne})=>"size-ramp"===ne),U=x.find(({type:ne})=>"color-ramp"===ne);return A&&(A={...A},A.infos=[...A.infos],$U(A,_,T,!0)),U&&(U={...U},U.infos=[...U.infos]),"horizontal"===T&&(A?.infos.reverse(),U?.infos.reverse()),{sizeRampElement:A,colorRampElement:U}}function XU(d,_="vertical"){const T=d.infos;let x=T.find(({type:U})=>"size-ramp"===U),A=T.find(({type:U})=>"color-ramp"===U);return x&&(x={...x},x.infos=[...x.infos],$U(x,null,_,!1)),A&&(A={...A},A.infos=[...A.infos]),"horizontal"===_&&(x?.infos.reverse(),A?.infos.reverse()),{sizeRampElement:x,colorRampElement:A}}function Ca(d){d.appendChild(this)}function jf(d,_,T){if(!_)return;if("string"==typeof _||"number"==typeof _)return _;if("value"in _||"unit"in _)return(0,_c.n)(d.dotValue,_);if("colorName"in _||"bandName"in _)return d[_.colorName]+": "+(d[_.bandName]||_.bandName);if("showCount"in _)return _.showCount?d.clusterCountTitle:null;let x=null;return function BY(d,_){return _}(0,T)?x=_.ratioPercentTotal?"showRatioPercentTotal":_.ratioPercent?"showRatioPercent":_.ratio?"showRatio":_.normField?"showNormField":_.field?"showField":null:kU(0,T)&&(x=_.normField?"showNormField":_.normByPct?"showNormPct":_.field?"showField":null),x?(0,_c.n)("showField"===x?"{field}":d[x],{field:_.field,normField:_.normField}):null}function kU(d,_){return!_}function JU(d,_){return!!(_&&"Stretched"===_&&d.version>=10.3&&"esri.layers.ImageryLayer"===d.declaredClass)}const ci_layerRow="esri-legend--card__layer-row",ci_rampLabel="esri-legend--card__ramp-label",ci_symbol="esri-legend--card__symbol",ci_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info";var Ry;!function(d){d.Auto="auto",d.Stack="stack",d.SideBySide="side-by-side"}(Ry||(Ry={}));const Ff=window.devicePixelRatio;let bu=class extends ua.Z{constructor(d,_){super(d,_),this._handles=new Ji.Z,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=Ry.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles((0,Ht.YP)(()=>this.activeLayerInfos,d=>{this._handles.removeAll(),this._watchForSectionChanges(d)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===Ry.Auto&&this.view.container.clientWidth<=768||this.layout===Ry.Stack;const d=this.activeLayerInfos,_=d&&d.toArray().map(fe=>this._renderLegendForLayer(fe)).filter(fe=>!!fe);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const T=this._sectionNames.length,x=this._sectionNames.map((fe,Oe)=>{const we=(0,_c.n)(this.messagesCommon.pagination.pageText,{index:Oe+1,total:T});return(0,Yt.u)("div",{key:fe,role:"tab",id:fe,"aria-label":we,"aria-controls":`${fe}-panel`,"aria-selected":(this._selectedSectionName===fe).toString(),tabIndex:this._selectedSectionName===fe?0:-1,title:we,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{"esri-legend--card__carousel-indicator--activated":this._selectedSectionName===fe}),"data-section-name":fe})}),A=this._hasIndicators&&T>1?(0,Yt.u)("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation",role:"tablist"},x):null,U=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):_&&_.length?_:null;return(0,Yt.u)("div",{class:this.classes("esri-legend--card",{"esri-legend--stacked":this._hasIndicators})},U||(0,Yt.u)("div",{class:"esri-legend--card__message"},this.messages.noLegend),A)}_selectSection(d){const _=d.target.getAttribute("data-section-name");_&&(this._selectedSectionName=_)}_focusSection(d){switch(d.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(d);break;case"Enter":case" ":this._selectSection(d)}}_switchSectionOnArrowPress(d){const _=d.key,T="ArrowLeft"===_?-1:1,x=d.target.getAttribute("data-section-name"),A=this._sectionNames.indexOf(x),U=this._sectionNames;let ne=null;-1!==A&&(U[A+T]?ne=document.getElementById(U[A+T]):"ArrowLeft"===_?ne=document.getElementById(U[U.length-1]):"ArrowRight"===_&&(ne=document.getElementById(U[0])),ne&&ne.focus())}_watchForSectionChanges(d){if(this._generateSectionNames(),d){d.forEach(T=>{const x=`activeLayerInfo-${T.layer.uid}-version-change`;this._handles.remove(x),this._watchForSectionChanges(T.children),this._handles.add((0,Ht.YP)(()=>T.version,()=>this._generateSectionNames()),x)});const _="activeLayerInfos-collection-change";this._handles.remove(_),this._handles.add(d.on("change",()=>this._watchForSectionChanges(d)),_)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(d,_,T){return`${this.id}${d.uid}-type-${_.type}-${T}`}_generateSectionNamesForActiveLayerInfo(d){d.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),d.legendElements&&d.legendElements.forEach((_,T)=>{this._sectionNames.push(this._getSectionName(d.layer,_,T))})}_renderLegendForLayer(d){if(!d.ready)return null;if(d.children.length){const _=d.children.map(T=>this._renderLegendForLayer(T)).toArray();return(0,Yt.u)("div",{key:d.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},(0,Yt.u)("div",{class:"esri-legend--card__service-caption-container"},d.title),_)}{const _=d.legendElements;if(_&&!_.length)return null;const T=_.some(U=>"relationship-ramp"===U.type),x=_.map((U,ne)=>this._renderLegendForElement(U,d,ne,T)).filter(U=>!!U);return x.length?(0,Yt.u)("div",{key:d.layer.uid,class:this.classes("esri-legend--card__service",{"esri-legend--card__group-layer-child":!!d.parent})},(0,Yt.u)("div",{class:"esri-legend--card__service-caption-container"},(0,Yt.u)("div",{class:"esri-legend--card__service-caption-text"},d.title)),(0,Yt.u)("div",{class:"esri-legend--card__service-content"},x)):null}}_renderLegendForElement(d,_,T,x=!1,A=!1){const fe="size-ramp"===d.type,Oe=_.layer;let we=null;if("string"==typeof d.title)we=d.title;else if(d.title){const mt=d.title,Mt=jf(this.messages,mt,"color-ramp"===d.type||"opacity-ramp"===d.type);we=mt.title?`${mt.title} (${Mt})`:Mt}const Ze=this._getSectionName(Oe,d,T),it=this._hasIndicators&&!A?(0,Yt.u)("div",null,(0,Yt.u)(wp,{level:this.headingLevel,class:"esri-legend--card__carousel-title"},_.title),(0,Yt.u)(wp,{level:k4(this.headingLevel),class:"esri-legend--card__layer-caption"},we)):we?(0,Yt.u)(wp,{level:this.headingLevel,class:"esri-legend--card__layer-caption"},we):null,lt=_.effectList;let dt=null;if("symbol-table"===d.type){const mt=d.infos.map((Mt,Pt)=>this._renderLegendForElementInfo(Mt,_,d.legendType,Pt)).filter(Mt=>!!Mt);mt.length&&(dt=(0,Yt.u)("div",{class:this.classes({"esri-legend--card__label-container":!(mt[0].properties.classes&&mt[0].properties.classes["esri-legend--card__symbol-row"]||x),"esri-legend--card__relationship-label-container":x})},mt))}else"color-ramp"===d.type||"opacity-ramp"===d.type||"heatmap-ramp"===d.type?dt=this._renderLegendForRamp(d,Oe.opacity,lt):fe?dt=this._renderSizeRamp(d,Oe.opacity):"pie-chart-ramp"===d.type?dt=this._renderPieChartRamp(d):"relationship-ramp"===d.type?dt=GU(d,this.id,Oe.opacity,lt):"univariate-above-and-below-ramp"===d.type?dt=this._renderUnivariateAboveAndBelowRamp(d,Oe.opacity,lt):"univariate-color-size-ramp"===d.type&&(dt=this._renderUnivariateColorSizeRamp(d,Oe.opacity,lt));if(!dt)return null;const Tt=(0,Yt.u)("div",{key:Ze,class:"esri-legend--card__section",id:`${Ze}-panel`,role:"tabpanel","aria-labelledby":Ze,tabIndex:0},[it,dt]);return A||this._sectionMap.set(Ze,Tt),Tt}_renderPieChartRamp(d){return(0,Yt.u)("div",{class:"esri-legend--card__pie-chart-ramp-preview",bind:d.preview,afterCreate:Ca})}_renderUnivariateAboveAndBelowRamp(d,_,T){const{sizeRampElement:x,colorRampElement:A}=YU(d,_,"horizontal");if(!x)return null;const U=Ox(x,"full",!0,"horizontal"),ne=Bf(x,"above",!0,"horizontal"),fe=Bf(x,"below",!0,"horizontal"),we=Uf(A,{width:ne,height:12,rampAlignment:"horizontal",opacity:_,type:"above",effectList:T}),Ze=Uf(A,{width:fe,height:12,rampAlignment:"horizontal",opacity:_,type:"below",effectList:T}),it=Ub(x,"card"),lt=x.infos.map(Bt=>Bt.label),dt=lt.length-1,Tt=lt.map((Bt,Zt)=>0===Zt||Zt===dt?(0,Yt.u)("div",{key:Zt},Bt):null),Pt={marginTop:"3px",display:"flex"};(0,uo.dZ)(this.container)?Pt.marginRight=`${it}px`:Pt.marginLeft=`${it}px`;const Nt={width:`${U}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Yt.u)("div",{class:ci_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Yt.u)("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},x.infos.map((Bt,Zt)=>(0,Yt.u)("div",{key:Zt,class:ci_symbol,bind:Bt.preview,afterCreate:Ca}))),we?(0,Yt.u)("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:Pt,key:"color-ramp-preview"},(0,Yt.u)("div",{bind:we,afterCreate:Ca}),(0,Yt.u)("div",{bind:Ze,afterCreate:Ca})):null,(0,Yt.u)("div",{class:ci_layerInfo},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:Nt},Tt)))}_renderUnivariateColorSizeRamp(d,_,T){const{sizeRampElement:x,colorRampElement:A}=XU(d,"horizontal");if(!x)return null;const U=Ox(x,"full",!1,"horizontal"),fe=Uf(A,{width:Bf(x,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:_,type:"full",effectList:T}),Oe=Ub(x,"card"),we=x.infos.length-1,Ze=x.infos.map((mt,Mt)=>0===Mt||Mt===we?(0,Yt.u)("div",{key:Mt},mt.label):null),dt={marginTop:"3px",display:"flex"};(0,uo.dZ)(this.container)?dt.marginRight=`${Oe}px`:dt.marginLeft=`${Oe}px`;const Tt={width:`${U}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Yt.u)("div",{class:ci_layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Yt.u)("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},x.infos.map((mt,Mt)=>(0,Yt.u)("div",{key:Mt,class:ci_symbol,bind:mt.preview,afterCreate:Ca}))),(0,Yt.u)("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:dt,key:"color-ramp-preview"},(0,Yt.u)("div",{bind:fe,afterCreate:Ca})),(0,Yt.u)("div",{class:ci_layerInfo},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:Tt},Ze)))}_renderLegendForElementInfo(d,_,T,x){const A=_.layer;if(d.type)return this._renderLegendForElement(d,_,x,!1,!0);const U=JU(A,T);if(d.preview){if(!d.symbol||!d.symbol.type.includes("simple-fill")){if(!d.label)return(0,Yt.u)("div",{key:x,bind:d.preview,afterCreate:Ca});const Bt={"esri-legend--card__symbol-cell":this._hasIndicators};return(0,Yt.u)("div",{key:x,class:this.classes(ci_layerRow,{"esri-legend--card__symbol-row":this._hasIndicators})},(0,Yt.u)("div",{class:this.classes(Bt),bind:d.preview,afterCreate:Ca}),(0,Yt.u)("div",{class:this.classes("esri-legend--card__image-label",{"esri-legend--card__label-cell":this._hasIndicators})},jf(this.messages,d.label,!1)||""))}let ne=255,fe=255,Oe=255,we=0,Ze=255,it=255,lt=255,dt=0;const Tt=d.symbol.color&&d.symbol.color.a,mt=d.symbol.outline&&d.symbol.outline.color&&d.symbol.outline.color.a;Tt&&(ne=d.symbol.color.r,fe=d.symbol.color.g,Oe=d.symbol.color.b,we=d.symbol.color.a*A.opacity),mt&&(Ze=d.symbol.outline.color.r,it=d.symbol.outline.color.g,lt=d.symbol.outline.color.b,dt=d.symbol.outline.color.a*A.opacity);const Mt=d.symbol.color?.isBright??!0,Pt=Mt?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",Nt={background:Tt?`rgba(${ne}, ${fe}, ${Oe}, ${we})`:"none",color:Mt?"black":"white",textShadow:`-1px -1px 0 ${Pt},\n                                              1px -1px 0 ${Pt},\n                                              -1px 1px 0 ${Pt},\n                                              1px 1px 0 ${Pt}`,border:mt?`1px solid rgba(${Ze}, ${it}, ${lt}, ${dt})`:"none",filter:(0,da.wJ)(_.effectList)};return(0,Yt.u)("div",{key:x,class:ci_layerRow},(0,Yt.u)("div",{class:"esri-legend--card__label-element",styles:Nt}," ",d.label," "))}if(d.src){const ne=this._renderImage(d,A,U);return(0,Yt.u)("div",{key:x,class:ci_layerRow},ne,(0,Yt.u)("div",{class:"esri-legend--card__image-label"},d.label||""))}}_renderImage(d,_,T){const{label:x,src:A,opacity:U}=d,ne={"esri-legend--card__imagery-layer-image--stretched":T,[ci_symbol]:!T},fe={opacity:`${U??_.opacity}`};return(0,Yt.u)("img",{alt:jf(this.messages,x,!1),src:A,border:0,width:d.width,height:d.height,class:this.classes(ne),styles:fe})}_renderSizeRampLines(d){const _=d.infos,T=_[0],x=_[_.length-1],A=T.symbol,U=this._hasIndicators,ne=(0,li.F2)(T.size+T.outlineSize)*Ff,fe=(0,li.F2)(x.size+x.outlineSize)*Ff,Oe=U?ne:ne+50*Ff,we=U?ne/2+50*Ff:ne,Ze=function HY(d){if(d){if(d.type.includes("3d")){const _=d.symbolLayers&&d.symbolLayers.length;if(!_)return;const T=d.symbolLayers.getItemAt(_-1).get("resource.primitive");return"triangle"===T||"cone"===T||"tetrahedron"===T}return"triangle"===d.style}}(A),it=function zY(d){if(d){if(d.type.includes("3d")){const _=d.symbolLayers&&d.symbolLayers.length;if(!_)return;const T=d.symbolLayers.getItemAt(_-1),x=T.resource&&T.resource.primitive;return"circle"===x||"cross"===x||"kite"===x||"sphere"===x||"cube"===x||"diamond"===x}{const _=d.style;return"circle"===_||"diamond"===_||"cross"===_}}}(A),lt=document.createElement("canvas");lt.width=Oe,lt.height=we,lt.style.width=lt.width/Ff+"px",lt.style.height=lt.height/Ff+"px";const dt=lt.getContext("2d");if(U){dt.beginPath();const Mt=Oe/2-fe/2,Pt=we;dt.moveTo(0,0),dt.lineTo(Mt,Pt);const Zt=Oe/2+fe/2,nr=we;dt.moveTo(Oe,0),dt.lineTo(Zt,nr)}else{dt.beginPath();const Mt=Oe,Pt=0;dt.moveTo(0,we/2-fe/2),dt.lineTo(Mt,Pt);const Zt=Oe,nr=we;dt.moveTo(0,we/2+fe/2),dt.lineTo(Zt,nr)}return dt.strokeStyle="#ddd",dt.stroke(),(0,Yt.u)("div",{bind:lt,afterCreate:Ca,styles:U?{display:"flex",marginTop:`-${Ze?0:it?ne/2:0}px`,marginBottom:`-${Ze?fe:it?fe/2:0}px`}:{display:"flex",marginRight:`-${Ze?0:it?ne/2:0}px`,marginLeft:`-${Ze?0:it?fe/2:0}px`}})}_renderSizeRamp(d,_){const T=d.infos,x=T[0].label,A=T[T.length-1].label;let U=T[0].preview,ne=T[T.length-1].preview;const fe=this._hasIndicators,Oe={"flex-direction":fe?"column":"row-reverse"};U&&(U=U.cloneNode(!0),U.style.display="flex"),ne&&(ne=ne.cloneNode(!0),ne.style.display="flex");const we={opacity:null!=_?`${_}`:""};return(0,Yt.u)("div",{class:this.classes(ci_layerRow,{"esri-legend--card__size-ramp-row":fe})},(0,Yt.u)("div",{class:ci_rampLabel},fe?x:A),(0,Yt.u)("div",{class:"esri-legend--card__size-ramp-container",styles:Oe},(0,Yt.u)("div",{bind:U,afterCreate:Ca,class:"esri-legend--card__size-ramp-preview",styles:we}),this._renderSizeRampLines(d),(0,Yt.u)("div",{bind:ne,afterCreate:Ca,class:"esri-legend--card__size-ramp-container",styles:we})),(0,Yt.u)("div",{class:ci_rampLabel},fe?A:x))}_renderLegendForRamp(d,_,T){const x=d.infos,A="heatmap-ramp"===d.type,U=x.length-1,fe=U>2&&!A?25*U:100,Oe=fe+20,Ze=x.slice(0).reverse();Ze.forEach((nr,Jt)=>{nr.offset=A?nr.ratio:Jt/U});const it=Ze.length-1,lt=Ze.length%2!=0&&Ze[Ze.length/2|0],dt=lt&&(0,Yt.u)("div",{class:"esri-legend--card__interval-separators-container"},(0,Yt.u)("div",{class:"esri-legend--card__interval-separator"},"|"),(0,Yt.u)("div",{class:ci_rampLabel},lt.label)),Tt=x[x.length-1].label,mt=x[0].label,Pt=(0,Qd.KB)([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:Ze[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:fe,height:25},fill:{type:"linear",x1:10,y1:0,x2:fe+10,y2:0,colors:Ze},stroke:{width:0}},{shape:{type:"path",path:`M${fe+10} 0 L${Oe} 12.5 L${fe+10} 25 Z`},fill:Ze[it].color,stroke:{width:0}}]],Oe,25),{messages:Nt}=this,Bt={filter:(0,da.wJ)(T),opacity:null==_?null:`${_}`};return(0,Yt.u)("div",{class:ci_layerRow,styles:{justifyContent:"center"}},(0,Yt.u)("div",{class:ci_rampLabel},A?Nt[Tt]:Tt),(0,Yt.u)("div",{class:"esri-legend--card__symbol-container"},(0,Yt.u)("div",{styles:Bt},Pt),dt),(0,Yt.u)("div",{class:ci_rampLabel},A?Nt[mt]:mt))}};(0,Ve._)([(0,ke.Cb)()],bu.prototype,"activeLayerInfos",void 0),(0,Ve._)([(0,ke.Cb)()],bu.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],bu.prototype,"layout",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Legend/t9n/Legend")],bu.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/t9n/common")],bu.prototype,"messagesCommon",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],bu.prototype,"type",void 0),(0,Ve._)([(0,ke.Cb)()],bu.prototype,"view",void 0),(0,Ve._)([(0,fc.h)()],bu.prototype,"_selectSection",null),bu=(0,Ve._)([(0,Wr.j)("esri.widgets.Legend.styles.Card")],bu);const xx=bu,Si_layerRow="esri-legend__layer-row",Si_layerInfo="esri-legend__layer-cell esri-legend__layer-cell--info",Si_symbolContainer="esri-legend__layer-cell esri-legend__layer-cell--symbols",Si_symbol="esri-legend__symbol",Si_sizeRamp="esri-legend__size-ramp",Si_rampLabel="esri-legend__ramp-label",QU={display:"flex",alignItems:"flex-start"},Dx={marginLeft:"3px"},Nf={display:"table-cell",verticalAlign:"middle"};let D0=class extends ua.Z{constructor(d,_){super(d,_),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const d=this.activeLayerInfos,_=d&&d.toArray().map(T=>this._renderLegendForLayer(T)).filter(T=>!!T);return(0,Yt.u)("div",null,_&&_.length?_:(0,Yt.u)("div",{class:"esri-legend__message"},this.messages.noLegend))}_renderLegendForLayer(d){if(!d.ready)return null;const _=!!d.children.length,T=`esri-legend__${d.layer.uid}-version-${d.version}`,x=d.title?wp({level:this.headingLevel,class:this.classes("esri-widget__heading","esri-legend__service-label")},d.title):null;if(_){const A=d.children.map(U=>this._renderLegendForLayer(U)).toArray();return(0,Yt.u)("div",{key:T,class:this.classes("esri-legend__service","esri-legend__group-layer")},x,A)}{const A=d.legendElements;if(A&&!A.length)return null;const U=A.map(fe=>this._renderLegendForElement(fe,d.layer,d.effectList)).filter(fe=>!!fe);return U.length?(0,Yt.u)("div",{key:T,class:this.classes("esri-legend__service",{"esri-legend__group-layer-child":!!d.parent}),tabIndex:0},x,(0,Yt.u)("div",{class:"esri-legend__layer"},U)):null}}_renderLegendForElement(d,_,T,x){const A="color-ramp"===d.type,U="opacity-ramp"===d.type,ne="size-ramp"===d.type;let fe=null;if("symbol-table"===d.type||ne){const dt=d.infos.map(Tt=>this._renderLegendForElementInfo(Tt,_,T,ne,d.legendType)).filter(Tt=>!!Tt);dt.length&&(fe=(0,Yt.u)("div",{class:"esri-legend__layer-body"},dt))}else"color-ramp"===d.type||"opacity-ramp"===d.type||"heatmap-ramp"===d.type||"stretch-ramp"===d.type?fe=this._renderLegendForRamp(d,_.opacity):"relationship-ramp"===d.type?fe=GU(d,this.id,_.opacity,T):"pie-chart-ramp"===d.type?fe=this._renderPieChartRamp(d):"univariate-above-and-below-ramp"===d.type?fe=this._renderUnivariateAboveAndBelowRamp(d,_.opacity,T):"univariate-color-size-ramp"===d.type&&(fe=this._renderUnivariateColorSizeRamp(d,_.opacity,T));if(!fe)return null;const Oe=d.title;let we=null;if("string"==typeof Oe)we=Oe;else if(Oe){const dt=jf(this.messages,Oe,A||U);we=kU(0,A||U)&&Oe.title?`${Oe.title} (${dt})`:dt}const Ze=x?"esri-legend__layer-child-table":"esri-legend__layer-table",it=we?(0,Yt.u)("div",{class:"esri-legend__layer-caption"},we):null;return(0,Yt.u)("div",{class:this.classes(Ze,{"esri-legend__layer-table--size-ramp":ne||!x})},it,fe)}_renderPieChartRamp(d){return(0,Yt.u)("div",{bind:d.preview,afterCreate:Ca})}_renderUnivariateAboveAndBelowRamp(d,_,T){const{sizeRampElement:x,colorRampElement:A}=YU(d,_);if(!x)return null;const U=Bf(x,"above",!0),ne=Bf(x,"below",!0),Oe=Uf(A,{width:12,height:U,rampAlignment:"vertical",opacity:_,type:"above",effectList:T}),we=Uf(A,{width:12,height:ne,rampAlignment:"vertical",opacity:_,type:"below",effectList:T}),Ze=Ub(x),it=x.infos.map(Zt=>Zt.label),lt=it.map((Zt,nr)=>0===nr?(0,Yt.u)("div",{key:nr,class:Zt?Oe?"esri-univariate-above-and-below-ramp__label":Si_rampLabel:null},Zt):2===nr?(0,Yt.u)("div",null):null),dt=it.length-1,Tt=Math.floor(it.length/2),mt=it.map((Zt,nr)=>nr===Tt||nr===dt?(0,Yt.u)("div",{key:nr,class:Zt?Oe?"esri-univariate-above-and-below-ramp__label":Si_rampLabel:null},Zt):null),Mt={display:"table-cell",verticalAlign:"middle"},Pt={marginTop:`${Ze}px`},Nt={height:`${U}px`},Bt={height:`${ne}px`};return(0,Yt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:QU},(0,Yt.u)("div",{class:"esri-legend__layer-body"},x.infos.map((Zt,nr)=>(0,Yt.u)("div",{class:this.classes(Si_layerRow,Si_sizeRamp)},(0,Yt.u)("div",{class:Si_symbol,styles:Mt,bind:Zt.preview,afterCreate:Ca}),Oe||nr%2!=0?null:(0,Yt.u)("div",{class:Si_layerInfo},it[nr])))),Oe?(0,Yt.u)("div",{styles:Pt,key:"color-ramp-preview"},(0,Yt.u)("div",{styles:Dx},(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramps",bind:Oe,afterCreate:Ca})),(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:Nt},lt))),(0,Yt.u)("div",{styles:Dx},(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramps",bind:we,afterCreate:Ca})),(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:Bt},mt)))):null)}_renderUnivariateColorSizeRamp(d,_,T){const{sizeRampElement:x,colorRampElement:A}=XU(d);if(!x)return null;const U=Ub(x),fe=Bf(x,"full",!1),Oe=Uf(A,{width:12,height:fe,rampAlignment:"vertical",opacity:_,type:"full",effectList:T}),we=x.infos.length-1,Ze=x.infos.map((Tt,mt)=>0===mt||mt===we?(0,Yt.u)("div",{key:mt,class:Tt.label?A?"esri-univariate-above-and-below-ramp__label":Si_rampLabel:null},Tt.label):null),it={display:"table-cell",verticalAlign:"middle"},lt={marginTop:`${U}px`},dt={height:`${fe}px`};return(0,Yt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:QU},(0,Yt.u)("div",{class:"esri-legend__layer-body"},x.infos.map(Tt=>(0,Yt.u)("div",{class:this.classes(Si_layerRow,Si_sizeRamp)},(0,Yt.u)("div",{class:Si_symbol,styles:it,bind:Tt.preview,afterCreate:Ca})))),(0,Yt.u)("div",{styles:lt,key:"color-ramp-preview"},(0,Yt.u)("div",{styles:Dx},(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramps",bind:Oe,afterCreate:Ca})),(0,Yt.u)("div",{styles:Nf},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:dt},Ze)))))}_renderLegendForRamp(d,_){const T=d.infos,A="heatmap-ramp"===d.type,U="stretch-ramp"===d.type,ne=d.preview;ne.className="esri-legend__color-ramp "+("opacity-ramp"===d.type?"esri-legend__opacity-ramp":""),null!=_&&(ne.style.opacity=_.toString());const Oe=T.map(it=>(0,Yt.u)("div",{class:it.label?Si_rampLabel:null},A?this.messages[it.label]||it.label:U?this._getStretchStopLabel(it):it.label)),Ze={height:ne.style.height};return(0,Yt.u)("div",{class:Si_layerRow},(0,Yt.u)("div",{class:Si_symbolContainer,styles:{width:"24px"}},(0,Yt.u)("div",{class:"esri-legend__ramps",bind:ne,afterCreate:Ca})),(0,Yt.u)("div",{class:Si_layerInfo},(0,Yt.u)("div",{class:"esri-legend__ramp-labels",styles:Ze},Oe)))}_getStretchStopLabel(d){return d.label?this.messages[d.label]+": "+("string"==typeof d.value?d.value:(0,Lm.uf)(d.value,{style:"decimal",notation:d.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(d,_,T,x,A){if(d.type)return this._renderLegendForElement(d,_,T,!0);let U=null;const ne=JU(_,A);if(d.preview?U=(0,Yt.u)("div",{class:Si_symbol,bind:d.preview,afterCreate:Ca}):d.src&&(U=this._renderImage(d,_,ne)),!U)return null;const fe={"esri-legend__imagery-layer-info--stretched":ne};return(0,Yt.u)("div",{class:Si_layerRow},(0,Yt.u)("div",{class:this.classes(Si_symbolContainer,{"esri-legend__imagery-layer-info--stretched":ne,[Si_sizeRamp]:!ne&&x})},U),(0,Yt.u)("div",{class:this.classes(Si_layerInfo,fe)},jf(this.messages,d.label,!1)||""))}_renderImage(d,_,T){const{label:x,src:A,opacity:U}=d,ne={"esri-legend__imagery-layer-image--stretched":T,[Si_symbol]:!T},fe={opacity:`${U??_.opacity}`};return(0,Yt.u)("img",{alt:jf(this.messages,x,!1),src:A,border:0,width:d.width,height:d.height,class:this.classes(ne),styles:fe})}};(0,Ve._)([(0,ke.Cb)()],D0.prototype,"activeLayerInfos",void 0),(0,Ve._)([(0,ke.Cb)()],D0.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Legend/t9n/Legend")],D0.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)({readOnly:!0})],D0.prototype,"type",void 0),D0=(0,Ve._)([(0,Wr.j)("esri.widgets.Legend.styles.Classic")],D0);const Wf=D0;let Ua=class extends ua.Z{constructor(d,_){super(d,_),this._handles=new Ji.Z,this.headingLevel=3,this.iconClass="esri-icon-layer-list",this.messages=null,this.style=new Wf,this.viewModel=new AY}initialize(){this.addHandles([(0,Ht.on)(()=>this.view,"resize",()=>this.scheduleRender()),(0,Ht.on)(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),(0,Ht.YP)(()=>this.headingLevel,d=>{const{style:_}=this;_&&(_.headingLevel=d)}),(0,Ht.YP)(()=>this.style,(d,_)=>{_&&d!==_&&_.destroy(),d&&(d.activeLayerInfos=this.activeLayerInfos,"card"===d.type&&(d.view=this.view),d.headingLevel=this.headingLevel)},Ht.nn)])}destroy(){this._handles=(0,Qe.SC)(this._handles)}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(d){this.viewModel.activeLayerInfos=d}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(d){this.viewModel.basemapLegendVisible=d}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(d){this.viewModel.groundLegendVisible=d}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(d){this.viewModel.hideLayersNotInCurrentView=d}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(d){this.viewModel.keepCacheOnDestroy=d}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(d){this.viewModel.respectLayerVisibility=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(d){this.viewModel.layerInfos=d}castStyle(d){if(d instanceof xx||d instanceof Wf)return d;if("string"==typeof d)return"card"===d?new xx:new Wf;if(d&&"string"==typeof d.type){const _={...d};return delete _.type,new("card"===d.type?xx:Wf)(_)}return new Wf}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}render(){return(0,Yt.u)("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof Wf?"esri-widget--panel":null)},this.style.render())}_refreshActiveLayerInfos(d){this._handles.removeAll(),d.forEach(_=>this._renderOnActiveLayerInfoChange(_)),this.scheduleRender()}_renderOnActiveLayerInfoChange(d){const _=(0,Ht.YP)(()=>d.version,()=>this.scheduleRender());this._handles.add(_,`version_${d.layer.uid}`);const T=(0,Ht.on)(()=>d.children,"change",()=>d.children.forEach(x=>this._renderOnActiveLayerInfoChange(x)),Ht.nn);this._handles.add(T,`children_${d.layer.uid}`),d.children.forEach(x=>this._renderOnActiveLayerInfoChange(x))}};(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"activeLayerInfos",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"basemapLegendVisible",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"groundLegendVisible",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"headingLevel",void 0),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"hideLayersNotInCurrentView",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"keepCacheOnDestroy",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"respectLayerVisibility",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"iconClass",void 0),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"label",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"layerInfos",null),(0,Ve._)([(0,ke.Cb)(),(0,Jo.H)("esri/widgets/Legend/t9n/Legend")],Ua.prototype,"messages",void 0),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"style",void 0),(0,Ve._)([(0,ko.p)("style")],Ua.prototype,"castStyle",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"view",null),(0,Ve._)([(0,ke.Cb)()],Ua.prototype,"viewModel",void 0),Ua=(0,Ve._)([(0,Wr.j)("esri.widgets.Legend")],Ua);const ZY=Ua,$Y=["mapRef"];class jb{ngAfterViewInit(){this.initMap()}initMap(){if(this.mapRef){const T=new lD.default({url:"https://sampleserver6.arcgisonline.com/arcgis/rest/services/Hurricanes/MapServer/0",renderer:{type:"simple",symbol:{type:"point-3d",symbolLayers:[{type:"object",resource:{primitive:"cone"},width:5e4}]},label:"hurricane location",visualVariables:[{type:"color",field:"PRESSURE",stops:[{value:950,color:"red"},{value:1020,color:"blue"}]},{type:"size",field:"WINDSPEED",stops:[{value:20,size:6e4},{value:150,size:5e5}],axis:"height"},{type:"size",axis:"width-and-depth",useSymbolValue:!0}]}}),x=new PD({basemap:"oceans",layers:[T]}),U=new O$({map:x,container:this.mapRef.nativeElement,camera:{position:{x:-7094839,y:-113987,z:8032780,spatialReference:{wkid:3857}},heading:358.8,tilt:13.7},environment:{lighting:{type:"virtual"}}}),ne=new ZY({view:U});U.ui.add(ne,"bottom-left")}}static#e=this.\u0275fac=function(T){return new(T||jb)};static#t=this.\u0275cmp=$.Xpm({type:jb,selectors:[["porrtal-hurricane-map"]],viewQuery:function(T,x){if(1&T&&$.Gf($Y,5),2&T){let A;$.iGM(A=$.CRH())&&(x.mapRef=A.first)}},inputs:{viewState:"viewState"},standalone:!0,features:[$.jDz],decls:2,vars:0,consts:[[1,"container"],["mapRef",""]],template:function(T,x){1&T&&$._UZ(0,"div",0,1)},dependencies:[D.ez],styles:['@import"https://js.arcgis.com/4.24/@arcgis/core/assets/esri/themes/light/main.css";.container[_ngcontent-%COMP%]{position:absolute;inset:0}'],changeDetection:0})}class Fb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Fb)};static#t=this.\u0275cmp=$.Xpm({type:Fb,selectors:[["porrtal-earthquake-map"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"earthquake-map works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Nb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Nb)};static#t=this.\u0275cmp=$.Xpm({type:Nb,selectors:[["porrtal-digital-elevation-map"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"digital-elevation-map works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Wb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Wb)};static#t=this.\u0275cmp=$.Xpm({type:Wb,selectors:[["porrtal-building-scene-with-query"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"building-scene-with-query works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Vb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Vb)};static#t=this.\u0275cmp=$.Xpm({type:Vb,selectors:[["porrtal-zoomable-circle-pack"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"zoomable-circle-pack works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class zb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||zb)};static#t=this.\u0275cmp=$.Xpm({type:zb,selectors:[["porrtal-zoomable-sunburst"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"zoomable-sunburst works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Hb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Hb)};static#t=this.\u0275cmp=$.Xpm({type:Hb,selectors:[["porrtal-zoomable-treemap"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"zoomable-treemap works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Gb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Gb)};static#t=this.\u0275cmp=$.Xpm({type:Gb,selectors:[["porrtal-zoomable-icicle"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"zoomable-icicle works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Kb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Kb)};static#t=this.\u0275cmp=$.Xpm({type:Kb,selectors:[["porrtal-collapsible-tree"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"collapsible-tree works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}class Zb{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(T){return new(T||Zb)};static#t=this.\u0275cmp=$.Xpm({type:Zb,selectors:[["porrtal-hierarchical-bar-chart"]],standalone:!0,features:[$.jDz],decls:2,vars:0,template:function(T,x){1&T&&($.TgZ(0,"p"),$._uU(1,"hierarchical-bar-chart works!"),$.qZA())},dependencies:[D.ez],changeDetection:0})}},76210:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z5:()=>re,HY:()=>pn,mv:()=>Ma,AA:()=>Be,yM:()=>rt,xE:()=>Dt,K3:()=>Y,h:()=>We,GH:()=>Gt,YY:()=>ee});var D=v(15861);let Q,$,W,X=!1,te=!1,ae=!1,oe=!1,le=null,se=!1;const re={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},Y=Ot=>{const It=new URL(Ot,Ei.$resourcesUrl$);return It.origin!==An.location.origin?It.href:It.pathname},ee=Ot=>Ei.$resourcesUrl$=Ot,Se="http://www.w3.org/1999/xlink",ye={},Ke=Ot=>"object"==(Ot=typeof Ot)||"function"===Ot,We=(Ot,It,...Xt)=>{let ur=null,Er=null,Mr=null,Nr=!1,ts=!1;const es=[],hs=ri=>{for(let Ci=0;Ci<ri.length;Ci++)ur=ri[Ci],Array.isArray(ur)?hs(ur):null!=ur&&"boolean"!=typeof ur&&((Nr="function"!=typeof Ot&&!Ke(ur))&&(ur=String(ur)),Nr&&ts?es[es.length-1].$text$+=ur:es.push(Nr?Ce(null,ur):ur),ts=Nr)};if(hs(Xt),It&&(It.key&&(Er=It.key),It.name&&(Mr=It.name),true)){const ri=It.className||It.class;ri&&(It.class="object"!=typeof ri?ri:Object.keys(ri).filter(Ci=>ri[Ci]).join(" "))}if("function"==typeof Ot)return Ot(null===It?{}:It,es,je);const Ks=Ce(Ot,null);return Ks.$attrs$=It,es.length>0&&(Ks.$children$=es),Ks.$key$=Er,Ks.$name$=Mr,Ks},Ce=(Ot,It)=>{const Xt={$flags$:0,$tag$:Ot,$text$:It,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null};return Xt},Be={},Fe=Ot=>Ot&&Ot.$tag$===Be,je={forEach:(Ot,It)=>Ot.map(Re).forEach(It),map:(Ot,It)=>Ot.map(Re).map(It).map(He)},Re=Ot=>({vattrs:Ot.$attrs$,vchildren:Ot.$children$,vkey:Ot.$key$,vname:Ot.$name$,vtag:Ot.$tag$,vtext:Ot.$text$}),He=Ot=>{if("function"==typeof Ot.vtag){const Xt=Object.assign({},Ot.vattrs);return Ot.vkey&&(Xt.key=Ot.vkey),Ot.vname&&(Xt.name=Ot.vname),We(Ot.vtag,Xt,...Ot.vchildren||[])}const It=Ce(Ot.vtag,Ot.vtext);return It.$attrs$=Ot.vattrs,It.$children$=Ot.vchildren,It.$key$=Ot.vkey,It.$name$=Ot.vname,It},rt=(Ot,It,Xt)=>{const ur=Ot;return{emit:Er=>tt(ur,It,{bubbles:!!(4&Xt),composed:!!(2&Xt),cancelable:!!(1&Xt),detail:Er})}},tt=(Ot,It,Xt)=>{const ur=Ei.ce(It,Xt);return Ot.dispatchEvent(ur),ur},et=new WeakMap,ot=(Ot,It,Xt,ur)=>{let Er=_t(It,Xt);const Mr=Po.get(Er);if(Ot=11===Ot.nodeType?Ot:_n,Mr)if("string"==typeof Mr){let ts,Nr=et.get(Ot=Ot.head||Ot);Nr||et.set(Ot,Nr=new Set),Nr.has(Er)||(ts=_n.createElement("style"),ts.innerHTML=Mr,Ot.insertBefore(ts,Ot.querySelector("link")),Nr&&Nr.add(Er))}else!Ot.adoptedStyleSheets.includes(Mr)&&(Ot.adoptedStyleSheets=[...Ot.adoptedStyleSheets,Mr]);return Er},_t=(Ot,It)=>"sc-"+(It&&32&Ot.$flags$?Ot.$tagName$+"-"+It:Ot.$tagName$),vt=(Ot,It,Xt,ur,Er,Mr)=>{if(Xt!==ur){let Nr=js(Ot,It),ts=It.toLowerCase();if("class"===It){const es=Ot.classList,hs=jt(Xt),Ks=jt(ur);es.remove(...hs.filter(ri=>ri&&!Ks.includes(ri))),es.add(...Ks.filter(ri=>ri&&!hs.includes(ri)))}else if("style"===It){for(const es in Xt)(!ur||null==ur[es])&&(es.includes("-")?Ot.style.removeProperty(es):Ot.style[es]="");for(const es in ur)(!Xt||ur[es]!==Xt[es])&&(es.includes("-")?Ot.style.setProperty(es,ur[es]):Ot.style[es]=ur[es])}else if("key"!==It)if("ref"===It)ur&&ur(Ot);else if(Ot.__lookupSetter__(It)||"o"!==It[0]||"n"!==It[1]){{const es=Ke(ur);if((Nr||es&&null!==ur)&&!Er)try{if(Ot.tagName.includes("-"))Ot[It]=ur;else{const Ks=ur??"";"list"===It?Nr=!1:(null==Xt||Ot[It]!=Ks)&&(Ot[It]=Ks)}}catch{}let hs=!1;ts!==(ts=ts.replace(/^xlink\:?/,""))&&(It=ts,hs=!0),null==ur||!1===ur?(!1!==ur||""===Ot.getAttribute(It))&&(hs?Ot.removeAttributeNS(Se,It):Ot.removeAttribute(It)):(!Nr||4&Mr||Er)&&!es&&(ur=!0===ur?"":ur,hs?Ot.setAttributeNS(Se,It,ur):Ot.setAttribute(It,ur))}}else It="-"===It[2]?It.slice(3):js(An,ts)?ts.slice(2):ts[2]+It.slice(3),Xt&&Ei.rel(Ot,It,Xt,!1),ur&&Ei.ael(Ot,It,ur,!1)}},Lt=/\s/,jt=Ot=>Ot?Ot.split(Lt):[],$t=(Ot,It,Xt,ur)=>{const Er=11===It.$elm$.nodeType&&It.$elm$.host?It.$elm$.host:It.$elm$,Mr=Ot&&Ot.$attrs$||ye,Nr=It.$attrs$||ye;for(ur in Mr)ur in Nr||vt(Er,ur,Mr[ur],void 0,Xt,It.$flags$);for(ur in Nr)vt(Er,ur,Mr[ur],Nr[ur],Xt,It.$flags$)},Wt=(Ot,It,Xt,ur)=>{const Er=It.$children$[Xt];let Nr,ts,es,Mr=0;if(!X&&(ae=!0,"slot"===Er.$tag$&&(Q&&ur.classList.add(Q+"-s"),Er.$flags$|=Er.$children$?2:1)),null!==Er.$text$)Nr=Er.$elm$=_n.createTextNode(Er.$text$);else if(1&Er.$flags$)Nr=Er.$elm$=_n.createTextNode("");else{if(!oe&&(oe="svg"===Er.$tag$),Nr=Er.$elm$=_n.createElementNS(oe?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&Er.$flags$?"slot-fb":Er.$tag$),oe&&"foreignObject"===Er.$tag$&&(oe=!1),$t(null,Er,oe),(Ot=>null!=Ot)(Q)&&Nr["s-si"]!==Q&&Nr.classList.add(Nr["s-si"]=Q),Er.$children$)for(Mr=0;Mr<Er.$children$.length;++Mr)ts=Wt(Ot,Er,Mr,Nr),ts&&Nr.appendChild(ts);"svg"===Er.$tag$?oe=!1:"foreignObject"===Nr.tagName&&(oe=!0)}return Nr["s-hn"]=W,3&Er.$flags$&&(Nr["s-sr"]=!0,Nr["s-cr"]=$,Nr["s-sn"]=Er.$name$||"",es=Ot&&Ot.$children$&&Ot.$children$[Xt],es&&es.$tag$===Er.$tag$&&Ot.$elm$&&pr(Ot.$elm$,!1)),Nr},pr=(Ot,It)=>{Ei.$flags$|=1;const Xt=Ot.childNodes;for(let ur=Xt.length-1;ur>=0;ur--){const Er=Xt[ur];Er["s-hn"]!==W&&Er["s-ol"]&&(or(Er).insertBefore(Er,wt(Er)),Er["s-ol"].remove(),Er["s-ol"]=void 0,ae=!0),It&&pr(Er,It)}Ei.$flags$&=-2},gr=(Ot,It,Xt,ur,Er,Mr)=>{let ts,Nr=Ot["s-cr"]&&Ot["s-cr"].parentNode||Ot;for(Nr.shadowRoot&&Nr.tagName===W&&(Nr=Nr.shadowRoot);Er<=Mr;++Er)ur[Er]&&(ts=Wt(null,Xt,Er,Ot),ts&&(ur[Er].$elm$=ts,Nr.insertBefore(ts,wt(It))))},ar=(Ot,It,Xt,ur,Er)=>{for(;It<=Xt;++It)(ur=Ot[It])&&(Er=ur.$elm$,zt(ur),te=!0,Er["s-ol"]?Er["s-ol"].remove():pr(Er,!0),Er.remove())},mr=(Ot,It)=>Ot.$tag$===It.$tag$&&("slot"===Ot.$tag$?Ot.$name$===It.$name$:Ot.$key$===It.$key$),wt=Ot=>Ot&&Ot["s-ol"]||Ot,or=Ot=>(Ot["s-ol"]?Ot["s-ol"]:Ot).parentNode,sr=(Ot,It)=>{const Xt=It.$elm$=Ot.$elm$,ur=Ot.$children$,Er=It.$children$,Mr=It.$tag$,Nr=It.$text$;let ts;null!==Nr?(ts=Xt["s-cr"])?ts.parentNode.textContent=Nr:Ot.$text$!==Nr&&(Xt.data=Nr):(oe="svg"===Mr||"foreignObject"!==Mr&&oe,"slot"===Mr||$t(Ot,It,oe),null!==ur&&null!==Er?((Ot,It,Xt,ur)=>{let hl,oa,Er=0,Mr=0,Nr=0,ts=0,es=It.length-1,hs=It[0],Ks=It[es],ri=ur.length-1,Ci=ur[0],Qn=ur[ri];for(;Er<=es&&Mr<=ri;)if(null==hs)hs=It[++Er];else if(null==Ks)Ks=It[--es];else if(null==Ci)Ci=ur[++Mr];else if(null==Qn)Qn=ur[--ri];else if(mr(hs,Ci))sr(hs,Ci),hs=It[++Er],Ci=ur[++Mr];else if(mr(Ks,Qn))sr(Ks,Qn),Ks=It[--es],Qn=ur[--ri];else if(mr(hs,Qn))("slot"===hs.$tag$||"slot"===Qn.$tag$)&&pr(hs.$elm$.parentNode,!1),sr(hs,Qn),Ot.insertBefore(hs.$elm$,Ks.$elm$.nextSibling),hs=It[++Er],Qn=ur[--ri];else if(mr(Ks,Ci))("slot"===hs.$tag$||"slot"===Qn.$tag$)&&pr(Ks.$elm$.parentNode,!1),sr(Ks,Ci),Ot.insertBefore(Ks.$elm$,hs.$elm$),Ks=It[--es],Ci=ur[++Mr];else{for(Nr=-1,ts=Er;ts<=es;++ts)if(It[ts]&&null!==It[ts].$key$&&It[ts].$key$===Ci.$key$){Nr=ts;break}Nr>=0?(oa=It[Nr],oa.$tag$!==Ci.$tag$?hl=Wt(It&&It[Mr],Xt,Nr,Ot):(sr(oa,Ci),It[Nr]=void 0,hl=oa.$elm$),Ci=ur[++Mr]):(hl=Wt(It&&It[Mr],Xt,Mr,Ot),Ci=ur[++Mr]),hl&&or(hs.$elm$).insertBefore(hl,wt(hs.$elm$))}Er>es?gr(Ot,null==ur[ri+1]?null:ur[ri+1].$elm$,Xt,ur,Mr,ri):Mr>ri&&ar(It,Er,es)})(Xt,ur,It,Er):null!==Er?(null!==Ot.$text$&&(Xt.textContent=""),gr(Xt,null,It,Er,0,Er.length-1)):null!==ur&&ar(ur,0,ur.length-1),oe&&"svg"===Mr&&(oe=!1))},rr=Ot=>{const It=Ot.childNodes;let Xt,ur,Er,Mr,Nr,ts;for(ur=0,Er=It.length;ur<Er;ur++)if(Xt=It[ur],1===Xt.nodeType){if(Xt["s-sr"])for(Nr=Xt["s-sn"],Xt.hidden=!1,Mr=0;Mr<Er;Mr++)if(ts=It[Mr].nodeType,It[Mr]["s-hn"]!==Xt["s-hn"]||""!==Nr){if(1===ts&&Nr===It[Mr].getAttribute("slot")){Xt.hidden=!0;break}}else if(1===ts||3===ts&&""!==It[Mr].textContent.trim()){Xt.hidden=!0;break}rr(Xt)}},Et=[],St=Ot=>{let It,Xt,ur,Er,Mr,Nr,ts=0;const es=Ot.childNodes,hs=es.length;for(;ts<hs;ts++){if(It=es[ts],It["s-sr"]&&(Xt=It["s-cr"])&&Xt.parentNode)for(ur=Xt.parentNode.childNodes,Er=It["s-sn"],Nr=ur.length-1;Nr>=0;Nr--)Xt=ur[Nr],!Xt["s-cn"]&&!Xt["s-nr"]&&Xt["s-hn"]!==It["s-hn"]&&(Ft(Xt,Er)?(Mr=Et.find(Ks=>Ks.$nodeToRelocate$===Xt),te=!0,Xt["s-sn"]=Xt["s-sn"]||Er,Mr?Mr.$slotRefNode$=It:Et.push({$slotRefNode$:It,$nodeToRelocate$:Xt}),Xt["s-sr"]&&Et.map(Ks=>{Ft(Ks.$nodeToRelocate$,Xt["s-sn"])&&(Mr=Et.find(ri=>ri.$nodeToRelocate$===Xt),Mr&&!Ks.$slotRefNode$&&(Ks.$slotRefNode$=Mr.$slotRefNode$))})):Et.some(Ks=>Ks.$nodeToRelocate$===Xt)||Et.push({$nodeToRelocate$:Xt}));1===It.nodeType&&St(It)}},Ft=(Ot,It)=>1===Ot.nodeType?null===Ot.getAttribute("slot")&&""===It||Ot.getAttribute("slot")===It:Ot["s-sn"]===It||""===It,zt=Ot=>{Ot.$attrs$&&Ot.$attrs$.ref&&Ot.$attrs$.ref(null),Ot.$children$&&Ot.$children$.map(zt)},dr=(Ot,It)=>{const Xt=Ot.$hostElement$,ur=Ot.$cmpMeta$,Er=Ot.$vnode$||Ce(null,null),Mr=Fe(It)?It:We(null,null,It);if(W=Xt.tagName,ur.$attrsToReflect$&&(Mr.$attrs$=Mr.$attrs$||{},ur.$attrsToReflect$.map(([Nr,ts])=>Mr.$attrs$[ts]=Xt[Nr])),Mr.$tag$=null,Mr.$flags$|=4,Ot.$vnode$=Mr,Mr.$elm$=Er.$elm$=Xt.shadowRoot||Xt,Q=Xt["s-sc"],$=Xt["s-cr"],X=Jn&&0!=(1&ur.$flags$),te=!1,sr(Er,Mr),Ei.$flags$|=1,ae){St(Mr.$elm$);let Nr,ts,es,hs,Ks,ri,Ci=0;for(;Ci<Et.length;Ci++)Nr=Et[Ci],ts=Nr.$nodeToRelocate$,ts["s-ol"]||(es=_n.createTextNode(""),es["s-nr"]=ts,ts.parentNode.insertBefore(ts["s-ol"]=es,ts));for(Ci=0;Ci<Et.length;Ci++)if(Nr=Et[Ci],ts=Nr.$nodeToRelocate$,Nr.$slotRefNode$){for(hs=Nr.$slotRefNode$.parentNode,Ks=Nr.$slotRefNode$.nextSibling,es=ts["s-ol"];es=es.previousSibling;)if(ri=es["s-nr"],ri&&ri["s-sn"]===ts["s-sn"]&&hs===ri.parentNode&&(ri=ri.nextSibling,!ri||!ri["s-nr"])){Ks=ri;break}(!Ks&&hs!==ts.parentNode||ts.nextSibling!==Ks)&&ts!==Ks&&(!ts["s-hn"]&&ts["s-ol"]&&(ts["s-hn"]=ts["s-ol"].parentNode.nodeName),hs.insertBefore(ts,Ks))}else 1===ts.nodeType&&(ts.hidden=!0)}te&&rr(Mr.$elm$),Ei.$flags$&=-2,Et.length=0},Lr=(Ot,It)=>{Ot.$flags$|=16;const Xt=()=>Hr(Ot,It);return Na(Xt)},Hr=(Ot,It)=>{const Xt=Ot.$hostElement$,ur=()=>{},Er=Xt;let Mr;return It?(tr(Xt,"componentWillLoad"),Mr=At(Er,"componentWillLoad")):(tr(Xt,"componentWillUpdate"),Mr=At(Er,"componentWillUpdate")),tr(Xt,"componentWillRender"),Mr=Kt(Mr,()=>At(Er,"componentWillRender")),ur(),Kt(Mr,()=>Qr(Ot,Er,It))},Qr=function(){var Ot=(0,D.Z)(function*(It,Xt,ur){const Er=It.$hostElement$,Mr=()=>{};ur&&(Ot=>{const It=Ot.$cmpMeta$,Xt=Ot.$hostElement$,ur=It.$flags$,Er=()=>{},Mr=ot(Jn&&Xt.shadowRoot?Xt.shadowRoot:Xt.getRootNode(),It,Ot.$modeName$);10&ur&&(Xt["s-sc"]=Mr,Xt.classList.add(Mr+"-h"),2&ur&&Xt.classList.add(Mr+"-s")),Er()})(It);const ts=()=>{};Jr(It,Xt,Er),ts(),Mr(),Cs(It)});return function(Xt,ur,Er){return Ot.apply(this,arguments)}}(),Jr=(Ot,It,Xt)=>{try{le=It,It=It.render&&It.render(),Ot.$flags$&=-17,Ot.$flags$|=2,dr(Ot,It)}catch(ts){Ls(ts,Ot.$hostElement$)}return le=null,null},Cs=Ot=>{const Xt=Ot.$hostElement$,ur=()=>{},Er=Xt;At(Er,"componentDidRender"),tr(Xt,"componentDidRender"),64&Ot.$flags$?(At(Er,"componentDidUpdate"),tr(Xt,"componentDidUpdate"),ur()):(Ot.$flags$|=64,At(Er,"componentDidLoad"),tr(Xt,"componentDidLoad"),ur())},Dt=Ot=>{{const It=Vt(Ot),Xt=It.$hostElement$.isConnected;return Xt&&2==(18&It.$flags$)&&Lr(It,!1),Xt}},At=(Ot,It,Xt)=>{if(Ot&&Ot[It])try{return Ot[It](Xt)}catch(ur){Ls(ur)}},Kt=(Ot,It)=>Ot&&Ot.then?Ot.then(It):It(),tr=(Ot,It)=>{},qt=(Ot,It,Xt)=>{if(It.$members$){Ot.watchers&&(It.$watchers$=Ot.watchers);const ur=Object.entries(It.$members$),Er=Ot.prototype;ur.map(([Mr,[Nr]])=>{(31&Nr||32&Nr)&&Object.defineProperty(Er,Mr,{get(){return((Ot,It)=>Vt(this).$instanceValues$.get(It))(0,Mr)},set(ts){((Ot,It,Xt,ur)=>{const Er=Vt(Ot),Mr=Ot,Nr=Er.$instanceValues$.get(It),ts=Er.$flags$,es=Mr;Xt=((Ot,It)=>null==Ot||Ke(Ot)?Ot:4&It?"false"!==Ot&&(""===Ot||!!Ot):2&It?parseFloat(Ot):1&It?String(Ot):Ot)(Xt,ur.$members$[It][0]);const hs=Number.isNaN(Nr)&&Number.isNaN(Xt);if(Xt!==Nr&&!hs&&(Er.$instanceValues$.set(It,Xt),1)){if(ur.$watchers$&&128&ts){const ri=ur.$watchers$[It];ri&&ri.map(Ci=>{try{es[Ci](Xt,Nr,It)}catch(Qn){Ls(Qn,Mr)}})}if(2==(18&ts)){if(es.componentShouldUpdate&&!1===es.componentShouldUpdate(Xt,Nr,It))return;Lr(Er,!1)}}})(this,Mr,ts,It)},configurable:!0,enumerable:!0})});{const Mr=new Map;Er.attributeChangedCallback=function(Nr,ts,es){Ei.jmp(()=>{const hs=Mr.get(Nr);if(this.hasOwnProperty(hs))es=this[hs],delete this[hs];else if(Er.hasOwnProperty(hs)&&"number"==typeof this[hs]&&this[hs]==es)return;this[hs]=(null!==es||"boolean"!=typeof this[hs])&&es})},Ot.observedAttributes=ur.filter(([Nr,ts])=>15&ts[0]).map(([Nr,ts])=>{const es=ts[1]||Nr;return Mr.set(es,Nr),512&ts[0]&&It.$attrsToReflect$.push([Nr,es]),es})}}return Ot},Ir=function(){var Ot=(0,D.Z)(function*(It,Xt,ur,Er,Mr){if(0==(32&Xt.$flags$)&&(Mr=It.constructor,Xt.$flags$|=32,customElements.whenDefined(ur.$tagName$).then(()=>Xt.$flags$|=128),Mr.style)){let es=Mr.style;"string"!=typeof es&&(es=es[Xt.$modeName$=(Ot=>ja.map(It=>It(Ot)).find(It=>!!It))(It)]);const hs=_t(ur,Xt.$modeName$);if(!Po.has(hs)){const Ks=()=>{};((Ot,It,Xt)=>{let ur=Po.get(Ot);Lo&&Xt?(ur=ur||new CSSStyleSheet,"string"==typeof ur?ur=It:ur.replaceSync(It)):ur=It,Po.set(Ot,ur)})(hs,es,!!(1&ur.$flags$)),Ks()}}const ts=()=>Lr(Xt,!0);ts()});return function(Xt,ur,Er,Mr,Nr){return Ot.apply(this,arguments)}}(),Sr=Ot=>{},at=Ot=>{const It=Ot["s-cr"]=_n.createComment("");It["s-cn"]=!0,Ot.insertBefore(It,Ot.firstChild)},Gt=(Ot,It)=>{const Xt={$flags$:It[0],$tagName$:It[1]};Xt.$members$=It[2],Xt.$listeners$=It[3],Xt.$watchers$=Ot.$watchers$,Xt.$attrsToReflect$=[],!Jn&&1&Xt.$flags$&&(Xt.$flags$|=8);const ur=Ot.prototype.connectedCallback,Er=Ot.prototype.disconnectedCallback;return Object.assign(Ot.prototype,{__registerHost(){ys(this,Xt)},connectedCallback(){(Ot=>{if(0==(1&Ei.$flags$)){const It=Vt(Ot),Xt=It.$cmpMeta$,ur=()=>{};if(1&It.$flags$)Bl(Ot,It,Xt.$listeners$,!1),Sr(It.$lazyInstance$);else{let Er;It.$flags$|=1,!Er&&12&Xt.$flags$&&at(Ot),Xt.$members$&&Object.entries(Xt.$members$).map(([Mr,[Nr]])=>{if(31&Nr&&Ot.hasOwnProperty(Mr)){const ts=Ot[Mr];delete Ot[Mr],Ot[Mr]=ts}}),Ir(Ot,It,Xt)}ur()}})(this),ur&&ur.call(this)},disconnectedCallback(){(Ot=>{if(0==(1&Ei.$flags$)){const It=Vt(Ot);It.$rmListeners$&&(It.$rmListeners$.map(ur=>ur()),It.$rmListeners$=void 0)}})(this),Er&&Er.call(this)},__attachShadow(){Jn?this.attachShadow({mode:"open",delegatesFocus:!!(16&Xt.$flags$)}):this.shadowRoot=this}}),Ot.is=Xt.$tagName$,qt(Ot,Xt)},pn=(Ot,It)=>It,Bl=(Ot,It,Xt,ur)=>{Xt&&Xt.map(([Er,Mr,Nr])=>{const ts=Yo(Ot,Er),es=yo(It,Nr),hs=qi(Er);Ei.ael(ts,Mr,es,hs),(It.$rmListeners$=It.$rmListeners$||[]).push(()=>Ei.rel(ts,Mr,es,hs))})},yo=(Ot,It)=>Xt=>{try{Ot.$hostElement$[It](Xt)}catch(ur){Ls(ur)}},Yo=(Ot,It)=>4&It?_n:8&It?An:16&It?_n.body:Ot,qi=Ot=>jl?{passive:0!=(1&Ot),capture:0!=(2&Ot)}:0!=(2&Ot),Qt=new WeakMap,Vt=Ot=>Qt.get(Ot),ys=(Ot,It)=>{const Xt={$flags$:0,$hostElement$:Ot,$cmpMeta$:It,$instanceValues$:new Map};return Bl(Ot,Xt,It.$listeners$,!1),Qt.set(Ot,Xt)},js=(Ot,It)=>It in Ot,Ls=(Ot,It)=>(0,console.error)(Ot,It),Po=new Map,ja=[],An=typeof window<"u"?window:{},_n=An.document||{head:{}},Ma=An.HTMLElement||class{},Ei={$flags$:0,$resourcesUrl$:"",jmp:Ot=>Ot(),raf:Ot=>requestAnimationFrame(Ot),ael:(Ot,It,Xt,ur)=>Ot.addEventListener(It,Xt,ur),rel:(Ot,It,Xt,ur)=>Ot.removeEventListener(It,Xt,ur),ce:(Ot,It)=>new CustomEvent(Ot,It)},Jn=!0,jl=(()=>{let Ot=!1;try{_n.addEventListener("e",null,Object.defineProperty({},"passive",{get(){Ot=!0}}))}catch{}return Ot})(),Lo=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),Fa=[],Pa=[],ns=(Ot,It)=>Xt=>{Ot.push(Xt),se||(se=!0,It&&4&Ei.$flags$?cn(Bn):Ei.raf(Bn))},vs=Ot=>{for(let It=0;It<Ot.length;It++)try{Ot[It](performance.now())}catch(Xt){Ls(Xt)}Ot.length=0},Bn=()=>{vs(Fa),vs(Pa),(se=Fa.length>0)&&Ei.raf(Bn)},cn=Ot=>Promise.resolve(void 0).then(Ot),Na=ns(Pa,!0)},41993:nt=>{function Ae(v){return Promise.resolve().then(()=>{var D=new Error("Cannot find module '"+v+"'");throw D.code="MODULE_NOT_FOUND",D})}Ae.keys=()=>[],Ae.resolve=Ae,Ae.id=41993,nt.exports=Ae},73386:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>me});var ce,D=v(15861),R=v(17626),G=v(46160),Z=v(89726),Q=v(55538),$=v(86810),W=v(58817),B=v(47996),H=v(47877),X=v(63290),te=v(62208),ae=v(10699),oe=v(21726),le=v(77712),se=(v(90912),v(76898)),re=v(99433),j=v(65234),Y=v(84687),ee=v(55463),ie=v(33954),J=v(32584);let ue=0;const pe="esri.Basemap";let he=ce=class extends((0,$.eC)(B.Z)){constructor(ge){super(ge),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+ue++,this.baseLayers=new G.Z,this.referenceLayers=new G.Z;const _e=De=>{De.parent&&De.parent!==this&&"remove"in De.parent&&De.parent.remove(De),De.parent=this,"elevation"===De.type&&X.Z.getLogger(this.declaredClass).error(`Layer '${De.title}, id:${De.id}' of type '${De.type}' is not supported as a basemap layer and will therefore be ignored.`)},Ee=De=>{De.parent=null};this.baseLayers.on("after-add",De=>_e(De.item)),this.referenceLayers.on("after-add",De=>_e(De.item)),this.baseLayers.on("after-remove",De=>Ee(De.item)),this.referenceLayers.on("after-remove",De=>Ee(De.item))}initialize(){this.when().catch(ge=>{X.Z.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,ge)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const ge=this.baseLayers.removeAll();for(const Ee of ge)Ee.destroy();const _e=this.referenceLayers.removeAll();for(const Ee of _e)Ee.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(ge){return ge&&"resourceInfo"in ge&&(this._set("resourceInfo",ge.resourceInfo),delete(ge={...ge}).resourceInfo),ge}set baseLayers(ge){this._set("baseLayers",(0,Z.Z)(ge,this._get("baseLayers")))}_writeBaseLayers(ge,_e,Ee){const De=[];ge&&(Ee={...Ee,layerContainerType:"basemap"},this.baseLayers.forEach(be=>{const Se=(0,J.Nw)(be,Ee.webmap?Ee.webmap.getLayerJSONFromResourceInfo(be):null,Ee);(0,te.pC)(Se)&&De.push(Se)}),this.referenceLayers.forEach(be=>{const Se=(0,J.Nw)(be,Ee.webmap?Ee.webmap.getLayerJSONFromResourceInfo(be):null,Ee);(0,te.pC)(Se)&&(Se.isReference=!0,De.push(Se))})),_e.baseMapLayers=De}set referenceLayers(ge){this._set("referenceLayers",(0,Z.Z)(ge,this._get("referenceLayers")))}writeTitle(ge,_e){_e.title=ge||"Basemap"}load(ge){return this.addResolvingPromise(this._loadFromSource(ge)),Promise.resolve(this)}loadAll(){return(0,H.G)(this,ge=>{ge(this.baseLayers,this.referenceLayers)})}clone(){const ge={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(ge.loadStatus="loaded"),new ce({resourceInfo:this.resourceInfo}).set(ge)}read(ge,_e){this.resourceInfo||this._set("resourceInfo",{data:ge,context:_e}),super.read(ge,_e)}write(ge,_e){return ge=ge||{},_e&&_e.origin||(_e={origin:"web-map",..._e}),super.write(ge,_e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(ge.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(Ee=>{const De=(0,W.d9)(Ee);return De.url&&(0,oe.oC)(De.url)&&(De.url=`https:${De.url}`),De.templateUrl&&(0,oe.oC)(De.templateUrl)&&(De.templateUrl=`https:${De.templateUrl}`),De})),ge}_loadFromSource(ge){var _e=this;return(0,D.Z)(function*(){const{resourceInfo:Ee,portalItem:De}=_e;(0,ae.k_)(ge);const be=[];Ee?(be.push(_e._loadLayersFromJSON(Ee.data,Ee.context?Ee.context.url:null,ge)),Ee.data.id&&!Ee.data.title&&be.push((0,ie.g)(Ee.data.id).then(ve=>{ve&&_e.read({title:ve},Ee.context)}))):De&&be.push(_e._loadFromItem(De,ge)),yield Promise.all(be)})()}_loadLayersFromJSON(ge,_e,Ee){var De=this;return(0,D.Z)(function*(){const be=De.resourceInfo&&De.resourceInfo.context,Se=De.portalItem&&De.portalItem.portal||be&&be.portal||null,ye=be&&"web-scene"===be.origin?"web-scene":"web-map",{populateOperationalLayers:ve}=yield Promise.all([v.e(7534),v.e(1074)]).then(v.bind(v,71074)),xe=[];if((0,ae.k_)(Ee),ge.baseMapLayers&&Array.isArray(ge.baseMapLayers)){const ze={context:{origin:ye,url:_e,portal:Se,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},Ke=ve(De.baseLayers,ge.baseMapLayers.filter(Ce=>!Ce.isReference),ze);xe.push(Ke);const We=ve(De.referenceLayers,ge.baseMapLayers.filter(Ce=>Ce.isReference),ze);xe.push(We)}yield(0,ae.as)(xe)})()}_loadFromItem(ge,_e){var Ee=this;return(0,D.Z)(function*(){const De=yield ge.load(_e),be=yield De.fetchData("json",_e),Se=(0,oe.mN)(ge.itemUrl??"");return Ee._set("resourceInfo",{data:be.baseMap??{},context:{origin:"web-map",portal:ge.portal||Y.Z.getDefault(),url:Se}}),Ee.read(Ee.resourceInfo.data,Ee.resourceInfo.context),Ee.read({spatialReference:be.spatialReference},Ee.resourceInfo.context),Ee.read({title:ge.title,thumbnailUrl:ge.thumbnailUrl},{origin:"portal-item",portal:ge.portal||Y.Z.getDefault(),url:Se}),Ee._loadLayersFromJSON(Ee.resourceInfo.data,Se,_e)})()}static fromId(ge){const _e=ie.s[ge];if(_e){if(_e.deprecated){let Ee=null;"dark-gray"===ge?Ee="dark-gray-vector":"gray"===ge?Ee="gray-vector":"streets"===ge?Ee="streets-vector":"topo"===ge&&(Ee="topo-vector"),(0,Q.x9)(X.Z.getLogger(pe),`The ${ge} basemap has entered mature support and is no longer being updated.`,{replacement:Ee,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return ce.fromJSON(_e)}return null}};(0,R._)([(0,le.Cb)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(ge,_e,Ee,De){this._writeBaseLayers(ge,_e,De)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:G.Z}},writer(ge,_e,Ee,De){this._writeBaseLayers(ge,_e,De)}}}}}})],he.prototype,"baseLayers",null),(0,R._)([(0,le.Cb)({type:String,json:{origins:{"web-scene":{write:!0}}}})],he.prototype,"id",void 0),(0,R._)([(0,le.Cb)({type:ee.default})],he.prototype,"portalItem",void 0),(0,R._)([(0,le.Cb)()],he.prototype,"referenceLayers",null),(0,R._)([(0,le.Cb)({readOnly:!0})],he.prototype,"resourceInfo",void 0),(0,R._)([(0,le.Cb)({type:j.Z})],he.prototype,"spatialReference",void 0),(0,R._)([(0,le.Cb)()],he.prototype,"thumbnailUrl",void 0),(0,R._)([(0,le.Cb)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],he.prototype,"title",void 0),(0,R._)([(0,re.c)("title")],he.prototype,"writeTitle",null),he=ce=(0,R._)([(0,se.j)(pe)],he);const me=he},91558:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var H,X,D=v(20414),R=v(21286),G=v(62208),Z=v(90912);function Q(H){return(0,R.uZ)((0,Z.vU)(H),0,255)}function $(H,X,te){return H=Number(H),isNaN(H)?te:H<X?X:H>te?te:H}class W{constructor(X){this.r=255,this.g=255,this.b=255,this.a=1,X&&this.setColor(X)}static blendColors(X,te,ae,oe=new W){return oe.r=Math.round(X.r+(te.r-X.r)*ae),oe.g=Math.round(X.g+(te.g-X.g)*ae),oe.b=Math.round(X.b+(te.b-X.b)*ae),oe.a=X.a+(te.a-X.a)*ae,oe._sanitize()}static fromRgb(X,te){const ae=X.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(ae){const oe=ae[2].split(/\s*,\s*/),le=ae[1];if("rgb"===le&&3===oe.length||"rgba"===le&&4===oe.length){const de=oe[0];if("%"===de.charAt(de.length-1)){const se=oe.map(re=>2.56*parseFloat(re));return 4===oe.length&&(se[3]=parseFloat(oe[3])),W.fromArray(se,te)}return W.fromArray(oe.map(se=>parseFloat(se)),te)}if("hsl"===le&&3===oe.length||"hsla"===le&&4===oe.length)return W.fromArray((0,D.B7)(parseFloat(oe[0]),parseFloat(oe[1])/100,parseFloat(oe[2])/100,parseFloat(oe[3])),te)}return null}static fromHex(X,te=new W){if(4!==X.length&&7!==X.length||"#"!==X[0])return null;const ae=4===X.length?4:8,oe=(1<<ae)-1;let le=Number("0x"+X.substr(1));return isNaN(le)?null:(["b","g","r"].forEach(de=>{const se=le&oe;le>>=ae,te[de]=4===ae?17*se:se}),te.a=1,te)}static fromArray(X,te=new W){return te._set(Number(X[0]),Number(X[1]),Number(X[2]),Number(X[3])),isNaN(te.a)&&(te.a=1),te._sanitize()}static fromString(X,te){const ae=(0,D.St)(X)?(0,D.h$)(X):null;return ae&&W.fromArray(ae,te)||W.fromRgb(X,te)||W.fromHex(X,te)}static fromJSON(X){return X&&new W([X[0],X[1],X[2],X[3]/255])}static toUnitRGB(X){return(0,G.pC)(X)?[X.r/255,X.g/255,X.b/255]:null}static toUnitRGBA(X){return(0,G.pC)(X)?[X.r/255,X.g/255,X.b/255,null!=X.a?X.a:1]:null}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(X){return"string"==typeof X?W.fromString(X,this):Array.isArray(X)?W.fromArray(X,this):(this._set(X.r??0,X.g??0,X.b??0,X.a??1),X instanceof W||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const X=this.r.toString(16),te=this.g.toString(16),ae=this.b.toString(16);return`#${X.length<2?"0"+X:X}${te.length<2?"0"+te:te}${ae.length<2?"0"+ae:ae}`}toCss(X=!1){const te=this.r+", "+this.g+", "+this.b;return X?`rgba(${te}, ${this.a})`:`rgb(${te})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(X=W.AlphaMode.ALWAYS){const te=Q(this.r),ae=Q(this.g),oe=Q(this.b);return X===W.AlphaMode.ALWAYS||1!==this.a?[te,ae,oe,Q(255*this.a)]:[te,ae,oe]}clone(){return new W(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(X){return(0,G.pC)(X)&&X.r===this.r&&X.g===this.g&&X.b===this.b&&X.a===this.a}_sanitize(){return this.r=Math.round($(this.r,0,255)),this.g=Math.round($(this.g,0,255)),this.b=Math.round($(this.b,0,255)),this.a=$(this.a,0,1),this}_set(X,te,ae,oe){this.r=X,this.g=te,this.b=ae,this.a=oe}}W.prototype.declaredClass="esri.Color",(X=(H=W||(W={})).AlphaMode||(H.AlphaMode={}))[X.ALWAYS=0]="ALWAYS",X[X.UNLESS_OPAQUE=1]="UNLESS_OPAQUE";const B=W},88879:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>re});var D=v(17626),R=v(29132),G=v(73281),Z=v(20383),Q=v(79608),$=v(86810),W=v(62208),B=v(86236),H=v(77712),ae=(v(85931),v(90912),v(76898)),oe=v(91179);function de(j){if(!(0,W.pC)(j))return null;const Y={};for(const ee in j){const ie=j[ee];ie&&(Y[ee]=ie.toJSON())}return 0!==Object.keys(Y).length?Y:null}let se=class extends((0,Q.J)($.wq)){constructor(...j){super(...j),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:(0,B.D)(),configurable:!0})}normalizeCtorArgs(j,Y,ee,ie){return j&&!j.declaredClass?j:{geometry:j,symbol:Y,attributes:ee,popupTemplate:ie}}set aggregateGeometries(j){const Y=this._get("aggregateGeometries");JSON.stringify(Y)!==JSON.stringify(j)&&this._set("aggregateGeometries",j)}set attributes(j){const Y=this._get("attributes");Y!==j&&(this._set("attributes",j),this._notifyLayer("attributes",Y,j))}set geometry(j){const Y=this._get("geometry");Y!==j&&(this._set("geometry",j),this._notifyLayer("geometry",Y,j))}set symbol(j){const Y=this._get("symbol");Y!==j&&(this._set("symbol",j),this._notifyLayer("symbol",Y,j))}set visible(j){const Y=this._get("visible");Y!==j&&(this._set("visible",j),this._notifyLayer("visible",Y,j))}getEffectivePopupTemplate(j=!1){if(this.popupTemplate)return this.popupTemplate;for(const Y of[this.sourceLayer,this.layer])if(Y){if("popupTemplate"in Y&&Y.popupTemplate)return Y.popupTemplate;if(j&&"defaultPopupTemplate"in Y&&(0,W.pC)(Y.defaultPopupTemplate))return Y.defaultPopupTemplate}return null}getAttribute(j){return this.attributes?.[j]}setAttribute(j,Y){if(this.attributes){const ee=this.getAttribute(j);this.attributes[j]=Y,this._notifyLayer("attributes",ee,Y,j)}else this.attributes={[j]:Y},this._notifyLayer("attributes",void 0,Y,j)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:de(this.aggregateGeometries),geometry:(0,W.pC)(this.geometry)?this.geometry.toJSON():null,symbol:(0,W.pC)(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){(0,W.pC)(this.geometry)&&"mesh"===this.geometry.type&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(j,Y,ee,ie){if(!this.layer||!("graphicChanged"in this.layer))return;const J={graphic:this,property:j,oldValue:Y,newValue:ee};"attributes"===j&&(J.attributeName=ie),this.layer.graphicChanged(J)}};(0,D._)([(0,H.Cb)({value:null,json:{read:function le(j){if(!j)return null;const Y={};for(const ee in j){const ie=(0,oe.im)(j[ee]);ie&&(Y[ee]=ie)}return 0!==Object.keys(Y).length?Y:null}}})],se.prototype,"aggregateGeometries",null),(0,D._)([(0,H.Cb)({value:null})],se.prototype,"attributes",null),(0,D._)([(0,H.Cb)({value:null,types:R.qM,json:{read:oe.im}})],se.prototype,"geometry",null),(0,D._)([(0,H.Cb)({type:Boolean})],se.prototype,"isAggregate",void 0),(0,D._)([(0,H.Cb)({clonable:"reference"})],se.prototype,"layer",void 0),(0,D._)([(0,H.Cb)({type:G.Z})],se.prototype,"popupTemplate",void 0),(0,D._)([(0,H.Cb)({clonable:"reference"})],se.prototype,"sourceLayer",void 0),(0,D._)([(0,H.Cb)({value:null,types:Z.LB})],se.prototype,"symbol",null),(0,D._)([(0,H.Cb)({type:Boolean,value:!0})],se.prototype,"visible",null),se=(0,D._)([(0,ae.j)("esri.Graphic")],se),(se||(se={})).generateUID=B.D;const re=se},73281:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Pe});var D=v(15861),R=v(17626),G=v(79608),Z=v(46160),Q=v(86810),$=v(58817),W=v(63290),B=v(10699),H=v(77712),X=v(66656),te=v(68653),ae=v(76898),oe=v(99433),le=v(90912),de=v(36630),se=v(55664),re=v(55013),j=v(16615),Y=v(82561),ee=v(75484),ie=v(64531),J=v(6785),ce=v(501);const pe={base:null,key:"type",typeMap:{attachment:se.Z,media:ie.Z,text:ce.Z,expression:Y.Z,field:ee.Z,relationship:J.Z}};var _e,he=v(38439),me=v(25621);v(85931);let Ee=_e=class extends Q.wq{constructor(Le){super(Le),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new _e({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};(0,R._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],Ee.prototype,"returnTopmostRaster",void 0),(0,R._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],Ee.prototype,"showNoDataRecords",void 0),Ee=_e=(0,R._)([(0,ae.j)("esri.popup.LayerOptions")],Ee);const De=Ee;var Se,be=v(51686);let ye=Se=class extends Q.wq{constructor(Le){super(Le),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Se({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?(0,$.d9)(this.orderByFields):null})}};(0,R._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"showRelatedRecords",void 0),(0,R._)([(0,H.Cb)({type:[be.Z],json:{write:!0}})],ye.prototype,"orderByFields",void 0),ye=Se=(0,R._)([(0,ae.j)("esri.popup.RelatedRecordsInfo")],ye);const ve=ye;var xe=v(65560),ze=v(59397),Ke=v(48753),We=v(10671);const Be=W.Z.getLogger("esri.PopupTemplate"),Fe="relationships/",je="expression/",Re=Z.Z.ofType({key:"type",defaultKeyValue:"button",base:ze.Z,typeMap:{button:Ke.Z,toggle:We.Z}}),He={base:re.Z,key:"type",typeMap:{media:ie.Z,custom:j.Z,text:ce.Z,attachments:se.Z,fields:ee.Z,expression:Y.Z,relationship:J.Z}},Ie=["attachments","fields","media","text","expression","relationship"];let Ge=class extends((0,G.J)(Q.wq)){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(Le){return Array.isArray(Le)?Le.map(Me=>(0,le.N7)(He,Me)):"string"==typeof Le||"function"==typeof Le||Le instanceof HTMLElement||(0,B.y8)(Le)?Le:(Be.error("content error","unsupported content value",{value:Le}),null)}readContent(Le,Me){const{popupElements:Ne}=Me;return Array.isArray(Ne)&&Ne.length>0?this._readPopupInfoElements(Me.description,Me.mediaInfos,Ne):this._readPopupInfo(Me)}writeContent(Le,Me,Ne,Xe){"string"!=typeof Le?Array.isArray(Le)&&(Me.popupElements=Le.filter(Ye=>Ie.includes(Ye.type)).map(Ye=>Ye&&Ye.toJSON(Xe)),Me.popupElements.forEach(Ye=>{"attachments"===Ye.type?this._writeAttachmentContent(Me):"media"===Ye.type?this._writeMediaContent(Ye,Me):"text"===Ye.type?this._writeTextContent(Ye,Me):"relationship"===Ye.type&&this._writeRelationshipContent(Ye,Me)})):Me.description=Le}writeFieldInfos(Le,Me,Ne,Xe){const{content:Ye}=this,Je=Array.isArray(Ye)?Ye:null;if(Le){const rt=Je?Je.filter(et=>"fields"===et.type):[],tt=rt.length&&rt.every(et=>et.fieldInfos?.length);Me.fieldInfos=Le.filter(Boolean).map(et=>{const qe=et.toJSON(Xe);return tt&&(qe.visible=!1),qe})}if(Je)for(const rt of Je)"fields"===rt.type&&this._writeFieldsContent(rt,Me)}writeLayerOptions(Le,Me,Ne,Xe){Me[Ne]=!Le||null===Le.showNoDataRecords&&null===Le.returnTopmostRaster?null:Le.toJSON(Xe)}writeTitle(Le,Me){Me.title=Le||""}collectRequiredFields(Le,Me){var Ne=this;return(0,D.Z)(function*(){const Xe=Ne.expressionInfos||[];yield Ne._collectExpressionInfoFields(Le,Me,[...Xe,...Ne._getContentExpressionInfos(Ne.content,Xe)]),(0,de.gd)(Le,Me,[...Ne.outFields||[],...Ne._getActionsFields(Ne.actions),...Ne._getTitleFields(Ne.title),...Ne._getContentFields(Ne.content)])})()}getRequiredFields(Le){var Me=this;return(0,D.Z)(function*(){const Ne=new Set;return yield Me.collectRequiredFields(Ne,Le),[...Ne].sort()})()}_writeFieldsContent(Le,Me){if(!Array.isArray(Le.fieldInfos)||!Le.fieldInfos.length)return;const Ne=(0,$.d9)(Le.fieldInfos);Array.isArray(Me.fieldInfos)?Ne.forEach(Xe=>{const Ye=Me.fieldInfos.find(Je=>Je.fieldName.toLowerCase()===Xe.fieldName.toLowerCase());Ye?Ye.visible=!0:Me.fieldInfos.push(Xe)}):Me.fieldInfos=Ne}_writeAttachmentContent(Le){Le.showAttachments||(Le.showAttachments=!0)}_writeRelationshipContent(Le,Me){const Ne=Le.orderByFields?.map(Ye=>this._toFieldOrderJSON(Ye,Le.relationshipId))||[],Xe=[...Me.relatedRecordsInfo?.orderByFields||[],...Ne];Me.relatedRecordsInfo={showRelatedRecords:!0,...Xe?.length&&{orderByFields:Xe}}}_writeTextContent(Le,Me){!Me.description&&Le.text&&(Me.description=Le.text)}_writeMediaContent(Le,Me){if(!Array.isArray(Le.mediaInfos)||!Le.mediaInfos.length)return;const Ne=(0,$.d9)(Le.mediaInfos);Me.mediaInfos=Array.isArray(Me.mediaInfos)?[...Me.mediaInfos,...Ne]:Ne}_readPopupInfoElements(Le,Me,Ne){const Xe={description:!1,mediaInfos:!1};return Ne.map(Ye=>"media"===Ye.type?(Ye.mediaInfos||!Me||Xe.mediaInfos||(Ye.mediaInfos=Me,Xe.mediaInfos=!0),ie.Z.fromJSON(Ye)):"text"===Ye.type?(Ye.text||!Le||Xe.description||(Ye.text=Le,Xe.description=!0),ce.Z.fromJSON(Ye)):"attachments"===Ye.type?se.Z.fromJSON(Ye):"fields"===Ye.type?ee.Z.fromJSON(Ye):"expression"===Ye.type?Y.Z.fromJSON(Ye):"relationship"===Ye.type?J.Z.fromJSON(Ye):void 0).filter(Boolean)}_toRelationshipContent(Le){const{field:Me,order:Ne}=Le;if(!Me?.startsWith(Fe))return null;const Xe=Me.replace(Fe,"").split("/");if(2!==Xe.length)return null;const Ye=parseInt(Xe[0],10),Je=Xe[1];return"number"==typeof Ye&&Je?J.Z.fromJSON({relationshipId:Ye,orderByFields:[{field:Je,order:Ne}]}):null}_toFieldOrderJSON(Le,Me){const{order:Ne,field:Xe}=Le;return{field:`${Fe}${Me}/${Xe}`,order:Ne}}_readPopupInfo({description:Le,mediaInfos:Me,showAttachments:Ne,relatedRecordsInfo:Xe={showRelatedRecords:!1}}){const Ye=[];Ye.push(Le?new ce.Z({text:Le}):new ee.Z),Array.isArray(Me)&&Me.length&&Ye.push(ie.Z.fromJSON({mediaInfos:Me})),Ne&&Ye.push(se.Z.fromJSON({displayType:"auto"}));const{showRelatedRecords:Je,orderByFields:rt}=Xe;return Je&&rt?.length&&rt.forEach(tt=>{const et=this._toRelationshipContent(tt);et&&Ye.push(et)}),Ye.length?Ye:Le}_getContentElementFields(Le){const Me=Le?.type;if("attachments"===Me)return[...this._extractFieldNames(Le.title),...this._extractFieldNames(Le.description)];if("custom"===Me)return Le.outFields||[];if("fields"===Me)return[...this._extractFieldNames(Le.title),...this._extractFieldNames(Le.description),...this._getFieldInfoFields(Le.fieldInfos??this.fieldInfos)];if("media"===Me){const Ne=Le.mediaInfos||[];return[...this._extractFieldNames(Le.title),...this._extractFieldNames(Le.description),...Ne.reduce((Xe,Ye)=>[...Xe,...this._getMediaInfoFields(Ye)],[])]}return"text"===Me?this._extractFieldNames(Le.text):[]}_getMediaInfoFields(Le){const{caption:Me,title:Ne,value:Xe}=Le,Ye=Xe||{},{fields:Je,normalizeField:rt,tooltipField:tt,sourceURL:et,linkURL:qe}=Ye,ot=[...this._extractFieldNames(Ne),...this._extractFieldNames(Me),...this._extractFieldNames(et),...this._extractFieldNames(qe),...Je??[]];return rt&&ot.push(rt),tt&&ot.push(tt),ot}_getContentExpressionInfos(Le,Me){return Array.isArray(Le)?Le.reduce((Ne,Xe)=>[...Ne,..."expression"===Xe.type&&Xe.expressionInfo?[Xe.expressionInfo]:[]],Me):[]}_getContentFields(Le){return"string"==typeof Le?this._extractFieldNames(Le):Array.isArray(Le)?Le.reduce((Me,Ne)=>[...Me,...this._getContentElementFields(Ne)],[]):[]}_collectExpressionInfoFields(Le,Me,Ne){return(0,D.Z)(function*(){Ne&&(yield Promise.all(Ne.map(Xe=>(0,de.io)(Le,Me,Xe.expression))))})()}_getFieldInfoFields(Le){return Le?Le.filter(Me=>void 0===Me.visible||!!Me.visible).map(Me=>Me.fieldName).filter(Me=>!Me.startsWith(Fe)&&!Me.startsWith(je)):[]}_getActionsFields(Le){return Le?Le.toArray().reduce((Me,Ne)=>[...Me,...this._getActionFields(Ne)],[]):[]}_getActionFields(Le){const{className:Me,title:Ne,type:Xe}=Le,Ye="button"===Xe||"toggle"===Xe?Le.image:"";return[...this._extractFieldNames(Ne),...this._extractFieldNames(Me),...this._extractFieldNames(Ye)]}_getTitleFields(Le){return"string"==typeof Le?this._extractFieldNames(Le):[]}_extractFieldNames(Le){if(!Le||"string"!=typeof Le)return[];const Ne=Le.match(/{[^}]*}/g);if(!Ne)return[];const Xe=/\{(\w+):.+\}/,Ye=Ne.filter(Je=>!(0===Je.indexOf(`{${Fe}`)||0===Je.indexOf(`{${je}`))).map(Je=>Je.replace(Xe,"{$1}"));return Ye?Ye.map(Je=>Je.slice(1,-1)):[]}};(0,R._)([(0,H.Cb)({type:Re})],Ge.prototype,"actions",void 0),(0,R._)([(0,H.Cb)()],Ge.prototype,"content",void 0),(0,R._)([(0,X.p)("content")],Ge.prototype,"castContent",null),(0,R._)([(0,te.r)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Ge.prototype,"readContent",null),(0,R._)([(0,oe.c)("content",{popupElements:{type:Z.Z.ofType(pe)},showAttachments:{type:Boolean},mediaInfos:{type:Z.Z.ofType(xe.V)},description:{type:String},relatedRecordsInfo:{type:ve}})],Ge.prototype,"writeContent",null),(0,R._)([(0,H.Cb)({type:[he.Z],json:{write:!0}})],Ge.prototype,"expressionInfos",void 0),(0,R._)([(0,H.Cb)({type:[me.Z]})],Ge.prototype,"fieldInfos",void 0),(0,R._)([(0,oe.c)("fieldInfos")],Ge.prototype,"writeFieldInfos",null),(0,R._)([(0,H.Cb)({type:De})],Ge.prototype,"layerOptions",void 0),(0,R._)([(0,oe.c)("layerOptions")],Ge.prototype,"writeLayerOptions",null),(0,R._)([(0,H.Cb)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Ge.prototype,"lastEditInfoEnabled",void 0),(0,R._)([(0,H.Cb)()],Ge.prototype,"outFields",void 0),(0,R._)([(0,H.Cb)()],Ge.prototype,"overwriteActions",void 0),(0,R._)([(0,H.Cb)()],Ge.prototype,"returnGeometry",void 0),(0,R._)([(0,H.Cb)({json:{type:String}})],Ge.prototype,"title",void 0),(0,R._)([(0,oe.c)("title")],Ge.prototype,"writeTitle",null),Ge=(0,R._)([(0,ae.j)("esri.PopupTemplate")],Ge);const Pe=Ge},97478:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var te,D=v(17626),R=v(86810),G=v(62208),Z=v(28170),Q=v(77712),B=(v(85931),v(90912),v(68653)),H=v(76898),X=v(99433);let ae=te=class extends R.wq{constructor(se){super(se),this.end=null,this.start=null}static get allTime(){return oe}static get empty(){return le}readEnd(se,re){return null!=re.end?new Date(re.end):null}writeEnd(se,re){re.end=se?se.getTime():null}get isAllTime(){return this.equals(te.allTime)}get isEmpty(){return this.equals(te.empty)}readStart(se,re){return null!=re.start?new Date(re.start):null}writeStart(se,re){re.start=se?se.getTime():null}clone(){return new te({end:this.end,start:this.start})}equals(se){if(!se)return!1;const re=(0,G.pC)(this.start)?this.start.getTime():this.start,j=(0,G.pC)(this.end)?this.end.getTime():this.end,Y=(0,G.pC)(se.start)?se.start.getTime():se.start,ee=(0,G.pC)(se.end)?se.end.getTime():se.end;return re===Y&&j===ee}expandTo(se){if(this.isEmpty||this.isAllTime)return this.clone();const re=(0,G.yw)(this.start,Y=>(0,Z.JE)(Y,se)),j=(0,G.yw)(this.end,Y=>{const ee=(0,Z.JE)(Y,se);return Y.getTime()===ee.getTime()?ee:(0,Z.Nm)(ee,1,se)});return new te({start:re,end:j})}intersection(se){if(!se)return this.clone();if(this.isEmpty||se.isEmpty)return te.empty;if(this.isAllTime)return se.clone();if(se.isAllTime)return this.clone();const re=(0,G.R2)(this.start,-1/0,ce=>ce.getTime()),j=(0,G.R2)(this.end,1/0,ce=>ce.getTime()),Y=(0,G.R2)(se.start,-1/0,ce=>ce.getTime()),ee=(0,G.R2)(se.end,1/0,ce=>ce.getTime());let ie,J;if(Y>=re&&Y<=j?ie=Y:re>=Y&&re<=ee&&(ie=re),j>=Y&&j<=ee?J=j:ee>=re&&ee<=j&&(J=ee),null!=ie&&null!=J&&!isNaN(ie)&&!isNaN(J)){const ce=new te;return ce.start=ie===-1/0?null:new Date(ie),ce.end=J===1/0?null:new Date(J),ce}return te.empty}offset(se,re){if(this.isEmpty||this.isAllTime)return this.clone();const j=new te,{start:Y,end:ee}=this;return(0,G.pC)(Y)&&(j.start=(0,Z.Nm)(Y,se,re)),(0,G.pC)(ee)&&(j.end=(0,Z.Nm)(ee,se,re)),j}union(se){if(!se||se.isEmpty)return this.clone();if(this.isEmpty)return se.clone();if(this.isAllTime||se.isAllTime)return oe.clone();const re=(0,G.pC)(this.start)&&(0,G.pC)(se.start)?new Date(Math.min(this.start.getTime(),se.start.getTime())):null,j=(0,G.pC)(this.end)&&(0,G.pC)(se.end)?new Date(Math.max(this.end.getTime(),se.end.getTime())):null;return new te({start:re,end:j})}};(0,D._)([(0,Q.Cb)({type:Date,json:{write:{allowNull:!0}}})],ae.prototype,"end",void 0),(0,D._)([(0,B.r)("end")],ae.prototype,"readEnd",null),(0,D._)([(0,X.c)("end")],ae.prototype,"writeEnd",null),(0,D._)([(0,Q.Cb)({readOnly:!0,json:{read:!1}})],ae.prototype,"isAllTime",null),(0,D._)([(0,Q.Cb)({readOnly:!0,json:{read:!1}})],ae.prototype,"isEmpty",null),(0,D._)([(0,Q.Cb)({type:Date,json:{write:{allowNull:!0}}})],ae.prototype,"start",void 0),(0,D._)([(0,B.r)("start")],ae.prototype,"readStart",null),(0,D._)([(0,X.c)("start")],ae.prototype,"writeStart",null),ae=te=(0,D._)([(0,H.j)("esri.TimeExtent")],ae);const oe=new ae,le=new ae({start:void 0,end:void 0}),de=ae},20849:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(86810),G=v(28170),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(58926);let X=H=class extends R.wq{constructor(ae){super(ae),this.value=0,this.unit="milliseconds"}toMilliseconds(){return(0,G.rJ)(this.value,this.unit,"milliseconds")}clone(){return new H({value:this.value,unit:this.unit})}};(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0},nonNullable:!0})],X.prototype,"value",void 0),(0,D._)([(0,Z.Cb)({type:B.v.apiValues,json:{type:B.v.jsonValues,read:B.v.read,write:B.v.write},nonNullable:!0})],X.prototype,"unit",void 0),X=H=(0,D._)([(0,W.j)("esri.TimeInterval")],X);const te=X},54346:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>B,b:()=>W});var D=v(59318),R=v(84792),G=v(26584),Z=v(63290),Q=v(21726);const $=Z.Z.getLogger("esri.assets");function W(H,X){return(0,R.default)(B(H),X)}function B(H){if(!D.Z.assetsPath)throw $.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new G.Z("assets:path-not-set","config.assetsPath is not set");return(0,Q.v_)(D.Z.assetsPath,H)}},87204:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>te,a:()=>H,b:()=>X});var H,ae,D=v(89798),R=v(87191),G=v(14273),Z=v(97139),Q=v(65787),$=v(17625),W=v(22355),B=v(35387);function X(ae){const oe=new W.kG;if(oe.include(G.T),ae.background===H.Only){const le=ae.output===R.lG.ColorComposite;return le?oe.fragment.uniforms.add(new Z.J("backgroundColor",de=>de.backgroundColor)):(oe.extensions.add("GL_OES_standard_derivatives"),oe.fragment.include(D.H)),oe.fragment.code.add($.H`
    void main() {
      gl_FragColor = ${le?$.H`vec4(backgroundColor, 1.0)`:$.H`gridColor(uv)`};
    }
  `),oe}return oe.include(R.JT,ae),oe.fragment.uniforms.add(new B.A("tex",le=>le.texture)),oe.fragment.uniforms.add(new Q.p("opacity",le=>le.opacity)),oe.fragment.code.add($.H`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),oe}(ae=H||(H={}))[ae.BelowLayer=0]="BelowLayer",ae[ae.Only=1]="Only",ae[ae.COUNT=2]="COUNT";const te=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return H},build:X},Symbol.toStringTag,{value:"Module"}))},64949:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>B,b:()=>W});var D=v(17625),R=v(22355),G=v(35387),Z=v(16396),Q=v(67093);function W(){const H=new R.kG,{attributes:X,varyings:te,vertex:ae,fragment:oe}=H;return X.add(Z.T.POSITION,"vec2"),te.add("fTexCoord","vec2"),te.add("fOffset[3]","vec4"),te.add("fPixCoord","vec2"),(0,Q.dz)(ae),ae.code.add(D.H`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${D.H.int(8)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),oe.uniforms.add(new G.A("tEdges",le=>le.edges.colorTexture)),oe.uniforms.add(new G.A("tArea",le=>le.areaTexture)),oe.uniforms.add(new G.A("tSearch",le=>le.searchTexture)),oe.uniforms.add(new G.A("tColor",le=>le.colorTexture)),(0,Q.dz)(oe),oe.code.add(D.H`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${D.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${D.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${D.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${D.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${D.H.int(16)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `),H}const B=Object.freeze(Object.defineProperty({__proto__:null,build:W},Symbol.toStringTag,{value:"Module"}))},39274:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>W,b:()=>$});var D=v(17625),R=v(22355),G=v(35387),Z=v(16396),Q=v(67093);function $(){const B=new R.kG,{attributes:H,varyings:X,vertex:te,fragment:ae}=B;return H.add(Z.T.POSITION,"vec2"),X.add("fTexCoord","vec2"),X.add("fOffset[2]","vec4"),(0,Q.dz)(te),te.code.add(D.H`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),ae.uniforms.add(new G.A("tBlendWeights",oe=>oe.blend.colorTexture)),ae.uniforms.add(new G.A("tColor",oe=>oe.colorTexture)),(0,Q.dz)(ae),ae.code.add(D.H`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`),B}const W=Object.freeze(Object.defineProperty({__proto__:null,build:$},Symbol.toStringTag,{value:"Module"}))},56598:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>pe,a:()=>ce,b:()=>j});var D=v(28347),R=v(43703),G=v(28093),Z=v(61343),Q=v(36603),$=v(47923),W=v(96896),B=v(31166),H=v(95285),X=v(97139),te=v(69960),ae=v(65787),oe=v(17625),le=v(63123),de=v(22355),se=v(35387),re=v(16396);const j=(0,G.f)(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),ee=(0,G.f)(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),J=(0,G.f)(parseFloat(Number(j[0]+ee[0]).toFixed(6)),parseFloat(Number(j[1]+ee[1]).toFixed(6)),parseFloat(Number(j[2]+ee[2]).toFixed(6)));function ce(he){const me=new de.kG;me.attributes.add(re.T.POSITION,"vec2"),me.include(Q.D,{textureCoordinateType:Q.N.Default}),me.varyings.add("worldRay","vec3"),me.varyings.add("eyeDir","vec3");const{vertex:ge,fragment:_e}=me;return ge.uniforms.add([new le.g("inverseProjectionMatrix",(Ee,De)=>De.camera.inverseProjectionMatrix),new le.g("inverseViewMatrix",(Ee,De)=>(0,D.a)(ue,De.camera.viewMatrix))]),ge.code.add(oe.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),_e.uniforms.add([new H.A("radii",Ee=>Ee.radii),new X.J("cameraPosition",(Ee,De)=>De.camera.eye),new te.N("heightParameters",Ee=>Ee.heightParameters),new ae.p("innerFadeDistance",Ee=>Ee.innerFadeDistance),new ae.p("altitudeFade",Ee=>Ee.altitudeFade),new se.A("depthTex",Ee=>Ee.depthTex),new ae.p("hazeStrength",Ee=>Ee.hazeStrength)]),_e.constants.add("betaRayleigh","vec3",j),_e.constants.add("betaCombined","vec3",J),_e.constants.add("betaMie","float",3996e-9),_e.constants.add("scaleHeight","float",Z.TR*Z.k8),(0,B.Pe)(_e),me.include(W.D),he.haze&&(_e.include($.S),_e.uniforms.add(new H.A("nearFar",(Ee,De)=>De.camera.nearFar))),_e.code.add(oe.H`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),_e.code.add(oe.H`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),_e.code.add(oe.H`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),_e.code.add(oe.H`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${he.haze?oe.H`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${he.haze?oe.H``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${he.haze?"":oe.H`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${he.haze?oe.H`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:oe.H`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${he.haze?oe.H`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:oe.H`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${he.haze?oe.H`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:oe.H`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${he.haze?"":oe.H`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),me}const ue=(0,R.c)(),pe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:j,build:ce},Symbol.toStringTag,{value:"Module"}))},89803:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>se,a:()=>re,b:()=>ee,c:()=>j});var D=v(21286),R=v(62208),G=v(550),Z=v(67831),Q=v(99770),$=v(85073),W=v(32849),B=v(85755),H=v(98071),X=v(95285),te=v(65787),ae=v(17625),oe=v(9546),le=v(22355),de=v(35387);class se extends ae.K{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=$.L.default.raymarchingSteps,this.weatherTile=(0,Q.a)()}}class re extends ae.K{constructor(){super(...arguments),this.viewMatrix=(0,G.c)()}}function j(ie){const J=new le.kG;J.include(H.k,!1);const ce=J.fragment;return ce.uniforms.add([new te.p("cloudRadius",ue=>ue.cloudRadius),new te.p("power",ue=>(0,D.t7)(35,120,ue.absorption)),new te.p("sigmaE",ue=>1+ue.absorption),new te.p("density",ue=>(0,D.t7)(0,.3,ue.density)),new te.p("cloudSize",ue=>(0,D.t7)(0,.02,Math.max(.01,1-ue.cloudSize))),new te.p("detailSize",ue=>(0,D.t7)(0,.2,Math.max(.01,1-ue.detailSize))),new te.p("smoothness",ue=>(0,D.t7)(0,.5,1-ue.smoothness)),new te.p("cloudHeight",ue=>(0,D.t7)(0,1500,ue.cloudHeight)),new te.p("coverage",ue=>ue.coverage),new oe.j("view",ue=>ue.viewMatrix),new de.A("cloudShapeTexture",ue=>(0,R.pC)(ue.noiseTexture)?ue.noiseTexture.textureAtlas:null),new X.A("cloudVariables",ue=>(0,Z.s)(Y,ue.coverage,ue.absorption))]),ce.constants.add("halfCubeMapSize","float",.5*ie.cubeMapSize),ce.code.add(ae.H`
    const int STEPS = ${ie.steps===W.p.SIXTEEN?ae.H`16`:ie.steps===W.p.HUNDRED?ae.H`100`:ae.H`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),ce.code.add(ae.H`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${ae.H.float(B.IQ)};
      const float dataWidth = ${ae.H.float(B.IQ)};
      const float tileRows = ${ae.H.float(B.jy)};
      const vec3 atlasDimensions = vec3(${ae.H.float(B.I_)}, ${ae.H.float(B.I_)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${ae.H.float(B.kR)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${ae.H.float(B.QZ)} * p) / ${ae.H.float(B.IQ)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),ce.code.add(ae.H`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),ce.code.add(ae.H`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),ce.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      float luminance = 0.0;\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),ce.code.add(ae.H`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),ce.code.add(ae.H`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),ce.code.add(ae.H`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),J}const Y=(0,Q.a)(),ee=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:se,CloudsDrawParameters:re,build:j},Symbol.toStringTag,{value:"Module"}))},50722:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>j,b:()=>se});var D=v(28347),R=v(43703),G=v(44965),Z=v(96896),Q=v(31166),$=v(92724),W=v(39337),B=v(69602),H=v(33726),X=v(19278),te=v(97139),ae=v(17625),oe=v(63123),le=v(22355),de=v(16396);function se(){const Y=new le.kG;Y.attributes.add(de.T.POSITION,"vec2"),Y.varyings.add("worldRay","vec3");const{vertex:ee,fragment:ie}=Y;return ee.uniforms.add([new oe.g("inverseProjectionMatrix",(J,ce)=>ce.camera.inverseProjectionMatrix),new oe.g("inverseViewMatrix",(J,ce)=>(0,D.a)(re,ce.camera.viewMatrix))]),ee.code.add(ae.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),ie.include(H.Y),ie.include(X.n),Y.include(G._,{pbrMode:$.f7.Disabled,lightingSphericalHarmonicsOrder:2}),Y.include(W.e),Y.include(Z.D),Y.include(Q.kR,{useLegacyTerrainShading:!1}),Y.include(B.j,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),ie.uniforms.add([new te.J("cameraPosition",(J,ce)=>ce.camera.eye)]),ie.code.add(ae.H`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),Y}const re=(0,R.c)(),j=Object.freeze(Object.defineProperty({__proto__:null,build:se},Symbol.toStringTag,{value:"Module"}))},89652:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>Y,b:()=>j});var D=v(52382),R=v(13934),G=v(78925),Z=v(24255),Q=v(23164),$=v(58173),W=v(54120),B=v(62952),H=v(10109),X=v(67022),te=v(33726),ae=v(2166),oe=v(69960),le=v(17625),de=v(22355),se=v(44835),re=v(16396);function j(ee){const ie=new de.kG,{vertex:J,fragment:ce}=ie,ue=ee.output===R.H.Depth,pe=ee.hasMultipassTerrain&&(ee.output===R.H.Color||ee.output===R.H.Alpha);return(0,ae.Sv)(J,ee),ie.include(Z.w,ee),ie.include($.c,ee),ie.include(Q.R,ee),ie.attributes.add(re.T.POSITION,"vec3"),ie.varyings.add("vpos","vec3"),pe&&ie.varyings.add("depth","float"),ue&&(ie.include(W.F,ee),(0,D.Zu)(ie),(0,D.Lm)(ie)),J.code.add(le.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${pe?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${ue?le.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:le.H`transformPosition(proj, view, vpos);`}
    }
  `),ie.include(G.f5,ee),pe&&ie.include(H.l,ee),ce.include(te.Y),ce.uniforms.add(new oe.N("eColor",he=>he.color)),ee.output===R.H.Highlight&&ie.include(B.bA,ee),ce.code.add(le.H`
  void main() {
    discardBySlice(vpos);
    ${pe?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${ee.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${le.H.float(X.b)}) {
      discard;
    }

    ${ee.output===R.H.Alpha?le.H`gl_FragColor = vec4(fColor.a);`:""}

    ${ee.output===R.H.Color?le.H`gl_FragColor = highlightSlice(fColor, vpos); ${ee.transparencyPassType===se.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${ee.output===R.H.Highlight?le.H`outputHighlight();`:""};
    ${ee.output===R.H.Depth?le.H`outputDepth(linearDepth);`:""};
    ${ee.output===R.H.ObjectAndLayerIdColor?le.H`outputObjectAndLayerIdColor();`:""}
  }
  `),ie}const Y=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},15261:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>xe,b:()=>ye,g:()=>ve});var D=v(94425),R=v(75224),G=v(75550),Z=v(35357),Q=v(50574),$=v(52382),W=v(13934),B=v(78925),H=v(26859),X=v(36603),te=v(58173),ae=v(21799),oe=v(51040),le=v(54120),de=v(62952),se=v(47923),re=v(2122),j=v(29052),Y=v(75819),ee=v(13146),ie=v(31166),J=v(10109),ce=v(92724),ue=v(37926),pe=v(72968),he=v(30249),me=v(67022),ge=v(93609),_e=v(22799),Ee=v(17625),De=v(22355),be=v(35387),Se=v(44835);function ye(ze){const Ke=new De.kG;Ke.include(oe.up,ze),Ke.include(ae.Bb,ze),Ke.include(te.c,ze),Ke.include(X.D,ze),Ke.include($.qj,ze),Ke.include(Z.AD,ze),Ke.include(ge.o,ze),Ke.include(B.P_,ze),Ke.include(ue.s,ze),Ke.include(Q.z,ze);const{vertex:We,fragment:Ce}=Ke;ze.pbrMode!==ce.f7.Normal&&ze.pbrMode!==ce.f7.Schematic||(Ke.include(ce.jV,ze),ze.hasNormalTexture&&Ke.include(j.Q,ze));const Be=ze.output===W.H.Shadow||ze.output===W.H.ShadowHighlight||ze.output===W.H.ShadowExludeHighlight;We.code.add(Be&&ze.componentData===Z._N.Varying?Ee.H`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`:Ee.H`#define discardShadows(castShadows) {}`);const Fe=ze.integratedMeshMode===G.O.ColorOverlay||ze.integratedMeshMode===G.O.ColorOverlayWithWater,je=Fe&&ze.output===W.H.Color&&ze.pbrMode===ce.f7.WaterOnIntegratedMesh;return Fe&&(Ke.include(ee.XP,ze),Ke.include(he.WB,ze),We.code.add(ze.spherical?Ee.H`
      const float invEllipsoidRadius = ${Ee.H.float(1/(ze.ellipsoidMode===_e.U.Earth?D.sv.radius:ze.ellipsoidMode===_e.U.Mars?D.yr.radius:D.Z1.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `:Ee.H`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),je&&(Ke.varyings.add("tbnTangent","vec3"),Ke.varyings.add("tbnBiTangent","vec3"),Ke.varyings.add("groundNormal","vec3")),We.code.add(Ee.H`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${Ee.H.float(me.b)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${ze.output===W.H.ObjectAndLayerIdColor?Ee.H`forwardObjectAndLayerIdColor();`:""}
      ${je?ze.spherical?Ee.H`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:Ee.H`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${Fe?Ee.H`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),ze.output===W.H.Alpha&&(Ce.include(se.S),Ke.include(J.l,ze),Ke.include(re.P,ze),Fe&&Ce.uniforms.add(new be.A("ovColorTex",(Re,He)=>(0,he.Tw)(Re,He))),Ce.code.add(Ee.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${ze.hasMultipassTerrain?Ee.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Fe?Ee.H`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),ze.output===W.H.Color&&(Ce.include(se.S),Ke.include(J.l,ze),Ke.include(re.P,ze),Ke.include(Y.B,ze),Ke.include(ee.XP,ze),ze.receiveShadows?(Ke.include(pe.hb,ze),Ce.code.add(Ee.H`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):Ce.code.add(Ee.H`float evaluateShadow() { return 0.0; }`),Fe&&Ce.uniforms.add(new be.A("ovColorTex",(Re,He)=>(0,he.Tw)(Re,He))),Ce.code.add(Ee.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${ze.hasMultipassTerrain?Ee.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Fe?Ee.H`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),ze.pbrMode===ce.f7.Normal||ze.pbrMode===ce.f7.Schematic?((0,ie.F1)(Ce),Ce.code.add(Ee.H`
        ${ze.pbrMode===ce.f7.Normal?Ee.H`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),Ce.code.add(ze.hasNormalTexture?Ee.H`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:Ee.H`vec3 shadingNormal = normalVertex;`),Ce.code.add(Ee.H`${ze.spherical?Ee.H`vec3 normalGround = normalize(positionWorld());`:Ee.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),Ce.code.add(Ee.H`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${ze.snowCover?Ee.H`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${Fe?Ee.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(ze.receiveShadows?Ce.code.add(Ee.H`float shadow = evaluateShadow();`):ze.spherical?((0,ee.sC)(Ce),Ce.code.add(Ee.H`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):Ce.code.add(Ee.H`float shadow = 0.0;`),je&&Ce.uniforms.add(new be.A("ovNormalTex",(Re,He)=>ve(He))),ze.snowCover&&(Ke.extensions.add("GL_OES_standard_derivatives"),Ce.code.add(Ee.H`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),Ce.code.add(Ee.H`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${Fe?Ee.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${je?Ee.H`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),Ce.code.add(Ee.H`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${ze.transparencyPassType===Se.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(ze.output===W.H.Depth||Be)&&(Ke.include(le.F,ze),Ce.code.add(Ee.H`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),ze.output===W.H.Normal&&(Ke.include(Y.B,ze),Ce.code.add(Ee.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${ze.normalType===H.h.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),ze.output===W.H.ObjectAndLayerIdColor&&Ke.fragment.code.add(Ee.H`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputObjectAndLayerIdColor();
}`),ze.output===W.H.Highlight&&(Ke.include(de.bA,ze),Ce.code.add(Ee.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Fe?Ee.H`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),Ke}function ve(ze){return 0===ze.overlays.length?null:ze.overlays[R.fu.INNER].getValidTexture(R.NH.Water)}const xe=Object.freeze(Object.defineProperty({__proto__:null,build:ye,getOverlayNormalTexture:ve},Symbol.toStringTag,{value:"Module"}))},70264:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>$,a:()=>B,b:()=>W});var D=v(98071),R=v(65787),G=v(17625),Z=v(22355),Q=v(35387);class $ extends G.K{constructor(){super(...arguments),this.opacity=1}}function W(H){const X=new Z.kG;return X.include(D.k),X.fragment.uniforms.add(new Q.A("tex",te=>te.texture)),H.hasOpacityFactor&&X.fragment.uniforms.add(new R.p("opacity",te=>te.opacity)),X.fragment.code.add(G.H`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${H.hasOpacityFactor?"* opacity":""};
    }`),X}const B=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$,build:W},Symbol.toStringTag,{value:"Module"}))},96160:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>Fe,b:()=>Be});var D=v(62208),R=v(43703),G=v(52382),Z=v(73132),Q=v(13934),$=v(78925),W=v(24255),B=v(60355),H=v(26859),X=v(84833),te=v(99579),ae=v(36603),oe=v(58173),le=v(21799),de=v(66085),se=v(58208),re=v(29052),j=v(54662),Y=v(13146),ee=v(31166),ie=v(10109),J=v(96395),ce=v(98898),ue=v(92724),pe=v(72968),he=v(70489),me=v(92836),ge=v(67022),_e=v(93609),Ee=v(28137),De=v(2166),be=v(97139),Se=v(69960),ye=v(65787),ve=v(17625),xe=v(63123),ze=v(22355),Ke=v(35387),We=v(44835),Ce=v(16396);function Be(je){const Re=new ze.kG,{vertex:He,fragment:Ie,varyings:Ge}=Re;return(0,De.Sv)(He,je),Re.include(X.f),Ge.add("vpos","vec3"),Re.include(me.k,je),Re.include(B.f,je),Re.include(de.L,je),je.hasColorTextureTransform&&Re.include(he.av),je.output!==Q.H.Color&&je.output!==Q.H.Alpha||(je.hasNormalTextureTransform&&Re.include(he.NI),je.hasEmissionTextureTransform&&Re.include(he.R5),je.hasOcclusionTextureTransform&&Re.include(he.jF),je.hasMetallicRoughnessTextureTransform&&Re.include(he.DT),(0,De.hY)(He,je),Re.include(H.O,je),Re.include(W.w,je),je.normalType===H.h.Attribute&&je.offsetBackfaces&&Re.include(Z.w),Re.include(re.Q,je),Re.include(le.Bb,je),je.instancedColor&&Re.attributes.add(Ce.T.INSTANCECOLOR,"vec4"),Ge.add("localvpos","vec3"),Re.include(ae.D,je),Re.include(G.qj,je),Re.include(te.R,je),Re.include(oe.c,je),He.uniforms.add(new Se.N("externalColor",Pe=>Pe.externalColor)),Ge.add("vcolorExt","vec4"),je.hasMultipassTerrain&&Ge.add("depth","float"),je.hasModelTransformation&&He.uniforms.add(new xe.g("model",Pe=>(0,D.pC)(Pe.modelTransformation)?Pe.modelTransformation:R.I)),He.code.add(ve.H`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${je.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${ve.H.float(ge.b)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${je.normalType===H.h.Attribute?ve.H`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${je.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${je.hasModelTransformation?"model,":""} vpos);
          ${je.normalType===H.h.Attribute&&je.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${je.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${je.hasColorTextureTransform?ve.H`forwardColorUV();`:""}
        ${je.hasNormalTextureTransform?ve.H`forwardNormalUV();`:""}
        ${je.hasEmissionTextureTransform?ve.H`forwardEmissiveUV();`:""}
        ${je.hasOcclusionTextureTransform?ve.H`forwardOcclusionUV();`:""}
        ${je.hasMetallicRoughnessTextureTransform?ve.H`forwardMetallicRoughnessUV();`:""}
      }
    `)),je.output===Q.H.Alpha&&(Re.include($.f5,je),Re.include(_e.z,je),Re.include(ie.l,je),Ie.uniforms.add([new ye.p("opacity",Pe=>Pe.opacity),new ye.p("layerOpacity",Pe=>Pe.layerOpacity)]),je.hasColorTexture&&Ie.uniforms.add(new Ke.A("tex",Pe=>Pe.texture)),Ie.include(Ee.y),Ie.code.add(ve.H`
      void main() {
        discardBySlice(vpos);
        ${je.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${je.hasColorTexture?ve.H`
                vec4 texColor = texture2D(tex, ${je.hasColorTextureTransform?ve.H`colorUV`:ve.H`vuv0`});
                ${je.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:ve.H`vec4 texColor = vec4(1.0);`}
        ${je.hasVertexColors?ve.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:ve.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),je.output===Q.H.Color&&(Re.include($.f5,je),Re.include(Y.XP,je),Re.include(j.K,je),Re.include(_e.z,je),Re.include(je.instancedDoublePrecision?pe.hb:pe.XE,je),Re.include(ie.l,je),(0,De.hY)(Ie,je),Ie.uniforms.add([He.uniforms.get("localOrigin"),new be.J("ambient",Pe=>Pe.ambient),new be.J("diffuse",Pe=>Pe.diffuse),new ye.p("opacity",Pe=>Pe.opacity),new ye.p("layerOpacity",Pe=>Pe.layerOpacity)]),je.hasColorTexture&&Ie.uniforms.add(new Ke.A("tex",Pe=>Pe.texture)),Re.include(ue.jV,je),Re.include(ce.T,je),Ie.include(Ee.y),Re.include(J.k,je),(0,Y.PN)(Ie),(0,Y.sC)(Ie),(0,ee.F1)(Ie),Ie.code.add(ve.H`
      void main() {
        discardBySlice(vpos);
        ${je.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${je.hasColorTexture?ve.H`
                vec4 texColor = texture2D(tex, ${je.hasColorTextureTransform?ve.H`colorUV`:ve.H`vuv0`});
                ${je.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:ve.H`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${je.normalType===H.h.ScreenDerivative?ve.H`
                vec3 normal = screenDerivativeNormal(localvpos);`:ve.H`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${je.pbrMode===ue.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${je.receiveShadows?"readShadowMap(vpos, linearDepth)":je.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${je.hasVertexColors?ve.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:ve.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${je.hasNormalTexture?ve.H`
                mat3 tangentSpace = ${je.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:ve.H`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${je.spherical?ve.H`normalize(posWorld);`:ve.H`vec3(0.0, 0.0, 1.0);`}

        ${je.snowCover?ve.H`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${je.pbrMode===ue.f7.Normal||je.pbrMode===ue.f7.Schematic?ve.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${je.snowCover?ve.H`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:ve.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${je.transparencyPassType===We.A.Color?ve.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),Re.include(se.s,je),Re}const Fe=Object.freeze(Object.defineProperty({__proto__:null,build:Be},Symbol.toStringTag,{value:"Module"}))},82488:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>B,b:()=>W});var D=v(17625),R=v(22355),G=v(35387),Z=v(16396),Q=v(67093);function W(){const H=new R.kG,{attributes:X,varyings:te,vertex:ae,fragment:oe}=H;return X.add(Z.T.POSITION,"vec2"),(0,Q.dz)(ae),te.add("fTexCoord","vec2"),te.add("fOffset[3]","vec4"),ae.code.add(D.H`void EdgeDetectEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0) * 0.5;
gl_Position = vec4(position, 0, 1);
EdgeDetectEdgeDetectionVS(fTexCoord);
}`),oe.uniforms.add(new G.A("tColor",le=>le.colorTexture)),oe.code.add(D.H`
    vec4 EdgeDetectColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
      vec2 threshold = vec2( ${D.H.float(.05)} );

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D( colorTex, texcoord ).rgb;

      vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
      vec3 t = abs( C - Cleft );
      delta.x = max( max( t.r, t.g ), t.b );

      vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
      t = abs( C - Ctop );
      delta.y = max( max( t.r, t.g ), t.b );

      // We do the usual threshold:
      vec2 edges = step( threshold, delta.xy );

      // Then discard if there is no edge:
      if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
          discard;

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
      t = abs( C - Cright );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
      t = abs( C - Cbottom );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
      t = abs( C - Cleftleft );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
      t = abs( C - Ctoptop );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the final maximum delta:
      maxDelta = max( max( maxDelta, delta.z ), delta.w );

      // Local contrast adaptation in action:
      edges.xy *= step( maxDelta, float(${D.H.float(2)}) * delta.xy );

      return vec4( edges, 0.0, 0.0 );
    }

    void main() {
      gl_FragColor = EdgeDetectColorEdgeDetectionPS(fTexCoord, fOffset, tColor);
    }
  `),H}const B=Object.freeze(Object.defineProperty({__proto__:null,build:W},Symbol.toStringTag,{value:"Module"}))},71964:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>ce,b:()=>ee});var D=v(67831),R=v(99770),G=v(78925),Z=v(10109),Q=v(95285),$=v(69960),W=v(65787),B=v(17625),H=v(22355),X=v(85930),te=v(16396),ae=v(57008),oe=v(98828),le=v(72175),de=v(98412),se=v(73105),re=v(10967),j=v(82716),Y=v(69276);function ee(ue){const pe=new H.kG,{vertex:he,fragment:me}=pe;return ue.antialiasing&&(he.code.add(B.H`#define ANTIALIASING 1`),me.code.add(B.H`#define ANTIALIASING 1`)),ue.legacy&&he.uniforms.add([new J("model"),new J("localView")]),pe.include(ae.g,ue),pe.include(se.UR,ue),pe.include(re.B,ue),pe.include(Y.H,ue),pe.include(j.N,ue),pe.include(G.f5,ue),pe.include(le.o,ue),pe.include(oe.S,ue),pe.include(de.l,ue),pe.include(Z.l,ue),pe.varyings.add("vColor","vec4"),pe.varyings.add("vRadius","float"),pe.varyings.add("vPosition","vec3"),pe.varyings.add("vWorldPosition","vec3"),pe.varyings.add("vViewPos","vec3"),pe.varyings.add("vLineLengthPixels","float"),pe.varyings.add("vSizeFalloffFactor","float"),he.uniforms.add([new Q.A("pixelToNDC",(ge,_e)=>(0,D.s)(ie,2/_e.camera.fullViewport[2],2/_e.camera.fullViewport[3])),new $.N("viewport",(ge,_e)=>_e.camera.fullViewport),new W.p("pixelRatio",(ge,_e)=>_e.camera.pixelRatio)]),pe.attributes.add(te.T.POSITION0,"vec3"),pe.attributes.add(te.T.POSITION1,"vec3"),pe.attributes.add(te.T.VARIANTOFFSET,"float"),pe.attributes.add(te.T.VARIANTSTROKE,"float"),pe.attributes.add(te.T.VARIANTEXTENSION,"float"),he.code.add(B.H`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),pe.fragment.code.add(B.H`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${ue.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),pe}const ie=(0,R.a)();class J extends X.x{constructor(pe){super(pe,"mat4")}}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:ee},Symbol.toStringTag,{value:"Module"}))},41918:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>de,H:()=>j,b:()=>se});var D=v(28347),R=v(43703),G=v(28093),Z=v(36603),Q=v(47923),$=v(96896),W=v(95285),B=v(97139),H=v(65787),X=v(17625),te=v(63123),ae=v(22355),oe=v(35387),le=v(16396);class de extends X.K{constructor(){super(...arguments),this.fogColor=(0,G.c)(),this.hazeColor=(0,G.c)(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1}}function se(Y){const ee=new ae.kG;ee.attributes.add(le.T.POSITION,"vec2"),ee.include(Z.D,{textureCoordinateType:Z.N.Default}),ee.varyings.add("worldRay","vec3"),ee.varyings.add("eyeDir","vec3");const{vertex:ie,fragment:J}=ee;return ie.uniforms.add([new te.g("inverseProjectionMatrix",(ce,ue)=>ue.camera.inverseProjectionMatrix),new te.g("inverseViewMatrix",(ce,ue)=>(0,D.a)(re,ue.camera.viewMatrix))]),ie.code.add(X.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),J.uniforms.add(new H.p("atmosphereC",ce=>ce.atmosphereC)),J.uniforms.add(new B.J("cameraPosition",(ce,ue)=>ue.camera.eye)),J.uniforms.add(new W.A("nearFar",(ce,ue)=>ue.camera.nearFar)),J.uniforms.add(new oe.A("depthTex",ce=>ce.depthTexture)),J.uniforms.add(new H.p("fogStrength",ce=>Y.haze?ce.hazeStrength:ce.fogStrength)),J.uniforms.add(new H.p("fogAmount",ce=>Y.haze?ce.hazeAmount:ce.fogAmount)),J.uniforms.add(new B.J("fogColor",ce=>Y.haze?ce.hazeColor:ce.fogColor)),ee.include($.D),J.include(Q.S),J.code.add(X.H`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),J.code.add(X.H`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),J.code.add(X.H`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${Y.haze?X.H`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),ee}const re=(0,R.c)(),j=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:de,build:se},Symbol.toStringTag,{value:"Module"}))},19982:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>Q,a:()=>W,b:()=>$});var D=v(98071),R=v(17625),G=v(22355),Z=v(35387);class Q extends R.K{}function $(){const B=new G.kG;return B.include(D.k),B.fragment.uniforms.add(new Z.A("tex",H=>H.texture)),B.fragment.code.add(R.H`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),B}const W=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Q,build:$},Symbol.toStringTag,{value:"Module"}))},6467:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>ye,b:()=>_e,c:()=>De});var D=v(62208),R=v(67831),G=v(99770),Z=v(4794),Q=v(8782),$=v(13934),W=v(78925),B=v(23164),H=v(35283),X=v(97347),te=v(27776),ae=v(62952),oe=v(92836),le=v(67022),de=v(33726),se=v(19278),re=v(71850),j=v(95285),Y=v(69960),ee=v(48565),ie=v(65787),J=v(7090),ce=v(17625),ue=v(22355),pe=v(35387),he=v(44835),me=v(16396),ge=v(41857);function _e(ve){const xe=new ue.kG,ze=ve.signedDistanceFieldEnabled;if(xe.include(H.H),xe.include(X.R,ve),xe.include(W.f5,ve),ve.occlusionPass)return xe.include(te.R,ve),xe;const{vertex:Ke,fragment:We}=xe;xe.include(re.cK),We.include(se.n),We.include(de.Y),xe.include(oe.k,ve),xe.include(B.R,ve),xe.varyings.add("vcolor","vec4"),xe.varyings.add("vtc","vec2"),xe.varyings.add("vsize","vec2"),ve.binaryHighlightOcclusionEnabled&&xe.varyings.add("voccluded","float"),Ke.uniforms.add([new Y.N("viewport",(Re,He)=>He.camera.fullViewport),new j.A("screenOffset",(Re,He)=>(0,R.s)(Se,2*Re.screenOffset[0]*He.camera.pixelRatio,2*Re.screenOffset[1]*He.camera.pixelRatio)),new j.A("anchorPosition",Re=>De(Re)),new Y.N("materialColor",Re=>Re.color),new ie.p("pixelRatio",(Re,He)=>He.camera.pixelRatio)]),ze&&(Ke.uniforms.add(new Y.N("outlineColor",Re=>Re.outlineColor)),We.uniforms.add([new Y.N("outlineColor",Re=>Ee(Re)?Re.outlineColor:Z.Z),new ie.p("outlineSize",Re=>Ee(Re)?Re.outlineSize:0)])),ve.hasScreenSizePerspective&&((0,re.ww)(Ke),(0,re.m8)(Ke)),(ve.debugDrawLabelBorder||ve.binaryHighlightOcclusionEnabled)&&xe.varyings.add("debugBorderCoords","vec4"),xe.attributes.add(me.T.UV0,"vec2"),xe.attributes.add(me.T.COLOR,"vec4"),xe.attributes.add(me.T.SIZE,"vec2"),xe.attributes.add(me.T.AUXPOS2,"vec4"),Ke.code.add(ce.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${ve.hasScreenSizePerspective?ce.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:ce.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${ve.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${ve.occlusionTestEnabled||ve.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${ve.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const Ce=ce.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,Be=ve.pixelSnappingEnabled?ze?ce.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:ce.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:ce.H`posProj += quadOffset;`;ve.vvColor&&Ke.uniforms.add([new ee.b("vvColorColors",Re=>Re.vvColorColors,ge.x),new J.O("vvColorValues",Re=>Re.vvColorValues,ge.x)]),Ke.uniforms.add(new j.A("textureCoordinateScaleFactor",Re=>(0,D.pC)(Re.texture)&&(0,D.pC)(Re.texture.descriptor.textureCoordinateScaleFactor)?Re.texture.descriptor.textureCoordinateScaleFactor:G.O)),Ke.code.add(ce.H`
    ${ve.occlusionTestEnabled?"if (visible) {":""}
    ${Ce}
    ${ve.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${ce.H.float(le.b)};
    ${ze?`alphaDiscard = alphaDiscard && outlineColor.a < ${ce.H.float(le.b)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${Be}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${ve.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${ve.occlusionTestEnabled?ce.H`} else { vtc = vec2(0.0);
      ${ve.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),We.uniforms.add(new pe.A("tex",Re=>Re.texture));const Fe=ve.debugDrawLabelBorder?ce.H`(isBorder > 0.0 ? 0.0 : ${ce.H.float(le.F)})`:ce.H.float(le.F),je=ce.H`
    ${ve.debugDrawLabelBorder?ce.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${ze?ce.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${ce.H.float(Q.Ph)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${Fe} ||
          fillPixelColor.a + outlinePixelColor.a < ${ce.H.float(le.b)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${Fe}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:ce.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${Fe}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${ve.debugDrawLabelBorder?ce.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return ve.output===$.H.Alpha&&We.code.add(ce.H`
      void main() {
        ${je}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),ve.output===$.H.ObjectAndLayerIdColor&&We.code.add(ce.H`
      void main() {
        ${je}
        outputObjectAndLayerIdColor();
      }
      `),ve.output===$.H.Color&&We.code.add(ce.H`
    void main() {
      ${je}
      ${ve.transparencyPassType===he.A.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),ve.output===$.H.Highlight&&(xe.include(ae.bA,ve),We.code.add(ce.H`
    void main() {
      ${je}
      ${ve.binaryHighlightOcclusionEnabled?ce.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),xe}function Ee(ve){return ve.outlineColor[3]>0&&ve.outlineSize>0}function De(ve,xe=Se){return ve.textureIsSignedDistanceField?function be(ve,xe,ze){(0,D.pC)(xe)?(0,R.s)(ze,ve[0]*(xe[2]-xe[0])+xe[0],ve[1]*(xe[3]-xe[1])+xe[1]):(0,R.s)(ze,0,0)}(ve.anchorPosition,ve.distanceFieldBoundingBox,xe):(0,R.c)(xe,ve.anchorPosition),xe}const Se=(0,G.a)(),ye=Object.freeze(Object.defineProperty({__proto__:null,build:_e,calculateAnchorPosForRendering:De},Symbol.toStringTag,{value:"Module"}))},17923:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>ae,b:()=>X});var D=v(993),R=v(4794),G=v(69960),Z=v(17625),Q=v(22355),$=v(35387),W=v(16396);function X(){const oe=new Q.kG,{vertex:le,fragment:de}=oe,se=le.code,re=de.code;return oe.attributes.add(W.T.POSITION,"vec2"),oe.varyings.add("uv","vec2"),oe.attributes.add(W.T.UV0,"vec2"),le.uniforms.add(new $.A("coverageTex",j=>j.coverageTexture)),se.add(Z.H`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),de.uniforms.add(new $.A("tex",j=>j.blurColorTexture)),de.uniforms.add(new $.A("origin",j=>j.highlightColorTexture)),de.uniforms.add(new G.N("uColor",j=>j.color)),de.uniforms.add(new G.N("haloColor",j=>j.haloColor)),de.uniforms.add(new G.N("opacities",j=>(0,D.s)(te,j.haloOpacity,j.haloOpacityOccluded,j.fillOpacity,j.fillOpacityOccluded))),de.constants.add("outlineSize","float",8.6),de.constants.add("blurSize","float",.4),re.add(Z.H`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),oe}const te=(0,R.c)(),ae=Object.freeze(Object.defineProperty({__proto__:null,build:X},Symbol.toStringTag,{value:"Module"}))},47482:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>B,a:()=>X,b:()=>H});var D=v(99770),R=v(32181),G=v(17625),Z=v(22355),Q=v(5864),$=v(35387),W=v(16396);class B extends G.K{constructor(){super(...arguments),this.blurSize=(0,D.a)()}}function H(){const te=new Z.kG,{vertex:ae,fragment:oe}=te,le=ae.code,de=oe.code;return te.attributes.add(W.T.POSITION,"vec2"),te.attributes.add(W.T.UV0,"vec2"),te.varyings.add("blurCoordinate","vec3"),ae.uniforms.add(new $.A("coverageTex",se=>se.coverageTexture)),oe.uniforms.add(new R.q("blurSize",se=>se.blurSize)),le.add(G.H`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),oe.uniforms.add(new Q.R("tex",se=>se.blurInputTexture)),de.add(G.H`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),te}const X=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:B,build:H},Symbol.toStringTag,{value:"Module"}))},36227:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>W,a:()=>H,b:()=>B});var D=v(99770),R=v(32181),G=v(17625),Z=v(22355),Q=v(5864),$=v(16396);class W extends G.K{constructor(){super(...arguments),this.invFramebufferDim=(0,D.a)()}}function B(){const X=new Z.kG,{vertex:te,fragment:ae}=X,oe=te.code,le=ae.code;return X.attributes.add($.T.POSITION,"vec2"),oe.add(G.H`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),ae.uniforms.add(new Q.R("tex",de=>de.inputTexture)),ae.uniforms.add(new R.q("invFramebufferDim",de=>de.invFramebufferDim)),le.add(G.H`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),X}const H=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:W,build:B},Symbol.toStringTag,{value:"Module"}))},76269:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>Y,b:()=>se});var D=v(62208),R=v(67831),G=v(99770),Z=v(4794),Q=v(78925),$=v(35283),W=v(97347),B=v(82793),H=v(71850),X=v(95285),te=v(69960),ae=v(65787),oe=v(17625),le=v(22355),de=v(16396);function se(ee){const ie=new le.kG;ie.include($.H),ie.include(W.R,ee),ie.include(Q.f5,ee),ie.attributes.add(de.T.UV0,"vec2");const{vertex:J,fragment:ce}=ie;return J.uniforms.add([new te.N("viewport",(ue,pe)=>pe.camera.fullViewport),new ae.p("lineSize",(ue,pe)=>Math.ceil(ue.size)*pe.camera.pixelRatio),new X.A("pixelToNDC",(ue,pe)=>(0,R.s)(j,2/pe.camera.fullViewport[2],2/pe.camera.fullViewport[3])),new ae.p("borderSize",(ue,pe)=>(0,D.pC)(ue.borderColor)?pe.camera.pixelRatio:0),new X.A("screenOffset",(ue,pe)=>(0,R.s)(j,ue.screenOffset[0]*pe.camera.pixelRatio,ue.screenOffset[1]*pe.camera.pixelRatio))]),ie.varyings.add("coverageSampling","vec4"),ie.varyings.add("lineSizes","vec2"),ee.hasMultipassGeometry&&ie.varyings.add("depth","float"),ee.hasScreenSizePerspective&&(0,H.m8)(J),J.code.add(oe.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${ee.occlusionTestEnabled?oe.H`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${ee.hasScreenSizePerspective?oe.H`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:oe.H`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${ee.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${ee.depthHudEnabled?ee.depthHudAlignStartEnabled?oe.H`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:oe.H`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${ee.hasScreenSizePerspective?oe.H`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:oe.H`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),ce.uniforms.add([new te.N("uColor",ue=>re(ue.color)),new te.N("borderColor",ue=>re(ue.borderColor))]),ee.hasMultipassGeometry&&(ce.include(B.S,ee),ce.uniforms.add(new X.A("inverseViewport",(ue,pe)=>pe.inverseViewport))),ce.code.add(oe.H`
    void main() {
      ${ee.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${ee.depthHudEnabled?oe.H`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:oe.H`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),ie}function re(ee){return(0,D.pC)(ee)?ee:Z.Z}const j=(0,G.a)(),Y=Object.freeze(Object.defineProperty({__proto__:null,build:se},Symbol.toStringTag,{value:"Module"}))},71530:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>te});var H,D=v(17626),R=v(91558),G=v(86810),Z=v(58817),Q=v(77712),W=(v(90912),v(76898)),B=v(60958);let X=H=class extends G.wq{constructor(){super(...arguments),this.color=new R.Z("white")}clone(){return new H({color:(0,Z.d9)(this.color)})}};(0,D._)([(0,Q.Cb)(B.a)],X.prototype,"color",void 0),X=H=(0,D._)([(0,W.j)("esri.symbols.callouts.LineCallout3DBorder")],X);const te=X;Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}))},62718:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>ue,b:()=>ce});var D=v(81805),R=v(52382),G=v(13934),Z=v(78925),Q=v(39645),$=v(54120),W=v(50823),B=v(10109),H=v(67022),X=v(33726),te=v(19278),ae=v(2166),oe=v(95285),le=v(69960),de=v(65787),se=v(17625),re=v(63123),j=v(22355),Y=v(35387),ee=v(44835),ie=v(16396),J=v(46359);function ce(pe){const he=new j.kG,me=pe.hasMultipassTerrain&&(pe.output===G.H.Color||pe.output===G.H.Alpha),ge=pe.space===J.I9.World;pe.hasTip&&ge&&he.extensions.add("GL_OES_standard_derivatives"),he.include(Q.U,pe),he.include(W.Q,pe),pe.output===G.H.Depth&&he.include($.F,pe);const{vertex:_e,fragment:Ee}=he;return Ee.include(te.n),(0,ae.Sv)(_e,pe),he.attributes.add(ie.T.POSITION,"vec3"),he.attributes.add(ie.T.UV0,"vec2"),he.attributes.add(ie.T.AUXPOS1,"vec3"),he.varyings.add("vColor","vec4"),he.varyings.add("vpos","vec3"),he.varyings.add("vUV","vec2"),he.varyings.add("vSize","float"),(0,R.Lm)(he),me&&he.varyings.add("depth","float"),pe.hasTip&&he.varyings.add("vLineWidth","float"),_e.uniforms.add([new oe.A("nearFar",(De,be)=>be.camera.nearFar),new le.N("viewport",(De,be)=>be.camera.fullViewport)]),_e.code.add(se.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),_e.code.add(se.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),ge?(he.attributes.add(ie.T.NORMAL,"vec3"),(0,ae._8)(_e),_e.constants.add("tiltThreshold","float",.7),_e.code.add(se.H`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):_e.code.add(se.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),_e.code.add(se.H`
      #define vecN ${ge?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${ge?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${pe.anchor===J.i5.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),pe.space===J.I9.Screen&&(_e.uniforms.add(new re.g("inverseProjectionMatrix",(De,be)=>be.camera.inverseProjectionMatrix)),_e.code.add(se.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),_e.code.add(se.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),_e.uniforms.add(new de.p("perScreenPixelRatio",(De,be)=>be.camera.perScreenPixelRatio)),_e.code.add(se.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${pe.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),_e.uniforms.add(new de.p("pixelRatio",(De,be)=>be.camera.pixelRatio)),(0,R.bA)(he),_e.code.add(se.H`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),ge?(pe.hideOnShortSegments&&_e.code.add(se.H`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),_e.code.add(se.H`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(_e.code.add(se.H`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),pe.space===J.I9.Screen&&_e.code.add(se.H`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),_e.code.add(se.H`
        ${me?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${ge?"":"vUV *= displacedPosScreen.w;"}

        ${pe.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),me&&he.include(B.l,pe),he.include(Z.f5,pe),Ee.uniforms.add([new le.N("intrinsicColor",De=>De.color),new Y.A("tex",De=>De.texture)]),Ee.include(X.Y),he.constants.add("texelSize","float",1/D.vT),Ee.code.add(se.H`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),pe.hasTip&&(he.constants.add("relativeMarkerSize","float",D.Ch/D.vT),he.constants.add("relativeTipLineWidth","float",D.Hl),Ee.code.add(se.H`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${ge?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),he.constants.add("symbolAlphaCutoff","float",H.b),Ee.code.add(se.H`
  void main() {
    discardBySlice(vpos);
    ${me?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${ge?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${pe.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${pe.output===G.H.Alpha?se.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${pe.output===G.H.Color?se.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${pe.output===G.H.Color&&pe.transparencyPassType===ee.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${pe.output===G.H.Highlight?se.H`gl_FragColor = vec4(1.0);`:""}
    ${pe.output===G.H.Depth?se.H`outputDepth(linearDepth);`:""}
  }
  `),he}const ue=Object.freeze(Object.defineProperty({__proto__:null,build:ce},Symbol.toStringTag,{value:"Module"}))},32616:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>de,b:()=>le});var D=v(13934),R=v(78925),G=v(24255),Z=v(58173),Q=v(62952),$=v(92484),W=v(67022),B=v(2166),H=v(69960),X=v(65787),te=v(17625),ae=v(22355),oe=v(16396);function le(se){const re=new ae.kG,{vertex:j,fragment:Y}=re;return re.include(G.w,se),re.include(Z.c,se),re.include($.q,se),(0,B.Sv)(j,se),se.stippleEnabled&&(re.attributes.add(oe.T.UV0,"vec2"),re.attributes.add(oe.T.AUXPOS1,"vec3"),j.uniforms.add(new H.N("viewport",(ee,ie)=>ie.camera.fullViewport))),re.attributes.add(oe.T.POSITION,"vec3"),re.varyings.add("vpos","vec3"),j.code.add(te.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),se.stippleEnabled&&(j.code.add(te.H`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),se.draped?j.uniforms.add(new X.p("worldToScreenRatio",(ee,ie)=>1/ie.screenToPCSRatio)):j.code.add(te.H`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),j.code.add(te.H`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),j.code.add(se.draped?te.H`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`:te.H`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),j.uniforms.add(new X.p("stipplePatternPixelSize",ee=>(0,$.C)(ee))),j.code.add(te.H`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),j.code.add(te.H`}`),se.output===D.H.Highlight&&re.include(Q.bA,se),re.include(R.f5,se),Y.uniforms.add(new X.p("alphaCoverage",(ee,ie)=>Math.min(1,ee.width*ie.camera.pixelRatio))),se.hasVertexColors||Y.uniforms.add(new H.N("constantColor",ee=>ee.color)),Y.code.add(te.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${se.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${te.H.float(W.b)}) {
      discard;
    }

    ${se.output===D.H.Color?te.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${se.output===D.H.Highlight?te.H`outputHighlight();`:""}
  }
  `),re}const de=Object.freeze(Object.defineProperty({__proto__:null,build:le},Symbol.toStringTag,{value:"Module"}))},42474:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>B,a:()=>X,b:()=>H});var D=v(99770),R=v(64312),G=v(85755),Z=v(98071),Q=v(95285),$=v(17625),W=v(22355);class B extends $.K{constructor(){super(...arguments),this.weatherTile=(0,D.f)(0,0)}}function H(te){const ae=new W.kG;return ae.include(Z.k,!1),ae.fragment.code.add($.H`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),te.mode===R.u.Full&&ae.fragment.code.add($.H`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${$.H.float(G.jy)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${$.H.float(8)});

      float worley0 = worley(p, ${$.H.float(2)} * 2.0);
      float worley1 = worley(p, ${$.H.float(2)} * 8.0);
      float worley2 = worley(p, ${$.H.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${$.H.float(2)});
      float worley1 = worley(p, ${$.H.float(2)} * 2.0);
      float worley2 = worley(p, ${$.H.float(2)} * 4.0);
      float worley3 = worley(p, ${$.H.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),ae.fragment.uniforms.add(new Q.A("weatherTile",oe=>oe.weatherTile)),ae.fragment.code.add($.H`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${$.H.float(G.A)});

      // Get global coordinates of p
      p += weatherTile * ${$.H.float(G.A)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${$.H.float(G.iZ)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),ae.fragment.code.add($.H`void main() {`),te.mode===R.u.Full&&ae.fragment.code.add($.H`
        float padWidth = 1.0;
        float paddedSize = ${$.H.float(G.I_)} + 2.0 * padWidth;
        float tileCount = ${$.H.float(G.jy)} * ${$.H.float(G.jy)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${$.H.float(G.I_)};
          }

          if (startPadY) {
            pixel.y += ${$.H.float(G.I_)};
          }

          if (endPadX) {
            pixel.x -= ${$.H.float(G.I_)};
          }

          if (endPadY) {
            pixel.y -= ${$.H.float(G.I_)};
          }

          uv = vec2(pixel.xy / ${$.H.float(G.I_)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${$.H.float(G.I_)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${$.H.float(G.jy)} * ${$.H.float(G.jy)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${$.H.float(G.jy)} * ${$.H.float(G.jy)});
        p = p_;
        p.z /= (${$.H.float(G.jy)} * ${$.H.float(G.jy)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),ae.fragment.code.add($.H`
      vec2 mapUV = ${$.H.float(G.A)} * (gl_FragCoord.xy / ${$.H.float(G.IQ)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${te.mode===R.u.Full?$.H`gl_FragColor.ba = vec2(0.0, map);`:$.H`gl_FragColor = vec4(map);`};
    }
  `),ae}const X=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:B,build:H},Symbol.toStringTag,{value:"Module"}))},51764:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>Q,a:()=>W,b:()=>$});var D=v(98071),R=v(17625),G=v(22355),Z=v(35387);class Q extends R.K{}function $(){const B=new G.kG;return B.include(D.k),B.fragment.uniforms.add([new Z.A("colorTexture",H=>H.colorTexture),new Z.A("alphaTexture",H=>H.alphaTexture),new Z.A("frontFaceTexture",H=>H.frontFaceTexture)]),B.fragment.code.add(R.H`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),B}const W=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Q,build:$},Symbol.toStringTag,{value:"Module"}))},8651:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>B,a:()=>X,b:()=>H});var D=v(75224),R=v(98071),G=v(65787),Z=v(18952),Q=v(17625),$=v(22355),W=v(35387);class B extends Q.K{constructor(){super(...arguments),this.overlayIndex=D.fu.INNER,this.opacity=1}}function H(){const te=new $.kG;return te.include(R.k),te.fragment.uniforms.add(new W.A("tex",ae=>ae.texture)),te.fragment.uniforms.add(new Z._("overlayIdx",ae=>ae.overlayIndex)),te.fragment.uniforms.add(new G.p("opacity",ae=>ae.opacity)),te.fragment.code.add(Q.H`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),te}const X=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:B,build:H},Symbol.toStringTag,{value:"Module"}))},24079:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>ce,b:()=>J});var D=v(52382),R=v(13934),G=v(78925),Z=v(24255),Q=v(68565),$=v(54120),W=v(62952),B=v(54662),H=v(13146),X=v(31166),te=v(10109),ae=v(96395),oe=v(7025),le=v(72968),de=v(33726),se=v(2166),re=v(97139),j=v(65787),Y=v(17625),ee=v(22355),ie=v(44835);function J(ue){const pe=new ee.kG,{vertex:he,fragment:me}=pe;switch((0,se.Sv)(he,ue),pe.varyings.add("vpos","vec3"),pe.include(Q.W,ue),ue.output!==R.H.Color&&ue.output!==R.H.Alpha||(pe.include(Z.w,ue),pe.include(le.XE,ue),pe.include(D.qj,ue),pe.varyings.add("vnormal","vec3"),pe.varyings.add("vcolor","vec4"),ue.hasMultipassTerrain&&pe.varyings.add("depth","float"),he.code.add(Y.H`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${ue.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${ue.output===R.H.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),pe.include(te.l,ue),ue.output){case R.H.Alpha:pe.include(G.f5,ue),me.uniforms.add(new j.p("opacity",ge=>ge.opacity)),me.code.add(Y.H`
      void main() {
        discardBySlice(vpos);
        ${ue.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case R.H.Color:pe.include(G.f5,ue),pe.include(H.XP,ue),pe.include(B.K,ue),pe.include(le.XE,ue),pe.include(ae.k,ue),(0,se.hY)(me,ue),(0,H.PN)(me),(0,H.sC)(me),me.uniforms.add([he.uniforms.get("localOrigin"),new re.J("ambient",ge=>ge.ambient),new re.J("diffuse",ge=>ge.diffuse),new re.J("specular",ge=>ge.specular),new j.p("opacity",ge=>ge.opacity)]),me.include(de.Y),(0,X.F1)(me),me.code.add(Y.H`
        void main() {
          discardBySlice(vpos);
          ${ue.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${ue.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":ue.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${ue.transparencyPassType===ie.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case R.H.Depth:case R.H.Shadow:case R.H.ShadowHighlight:case R.H.ShadowExludeHighlight:pe.include(Z.w,ue),(0,D.Zu)(pe),pe.varyings.add("depth","float"),he.code.add(Y.H`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),pe.include(G.f5,ue),pe.include($.F,ue),me.code.add(Y.H`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case R.H.Normal:pe.include(Z.w,ue),pe.include(oe.n,ue),(0,se._8)(he),pe.varyings.add("vnormal","vec3"),he.code.add(Y.H`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),pe.include(G.f5,ue),me.code.add(Y.H`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case R.H.Highlight:pe.include(Z.w,ue),pe.include(oe.n,ue),pe.varyings.add("vnormal","vec3"),he.code.add(Y.H`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),pe.include(G.f5,ue),pe.include(W.bA,ue),me.code.add(Y.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return pe}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:J},Symbol.toStringTag,{value:"Module"}))},66401:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>ue,b:()=>J});var D=v(52382),R=v(13934),G=v(78925),Z=v(24255),Q=v(58173),$=v(54120),W=v(62952),B=v(10109),H=v(67022),X=v(33726),te=v(2166),ae=v(69960),oe=v(65787),le=v(17625),de=v(22355),se=v(44835),re=v(16396),j=v(95402);const Y=.70710678118,ee=Y;function J(pe){const he=new de.kG,me=pe.hasMultipassTerrain&&(pe.output===R.H.Color||pe.output===R.H.Alpha);pe.draped||he.extensions.add("GL_OES_standard_derivatives");const{vertex:ge,fragment:_e}=he;(0,te.Sv)(ge,pe),he.include(Z.w,pe),he.include(Q.c,pe),pe.draped?ge.uniforms.add(new oe.p("worldToScreenRatio",(be,Se)=>1/Se.screenToPCSRatio)):he.attributes.add(re.T.BOUNDINGRECT,"mat3"),he.attributes.add(re.T.POSITION,"vec3"),he.attributes.add(re.T.UVMAPSPACE,"vec4"),he.varyings.add("vpos","vec3"),he.varyings.add("vuv","vec2"),me&&he.varyings.add("depth","float");const Ee=pe.style===j.b.ForwardDiagonal||pe.style===j.b.BackwardDiagonal||pe.style===j.b.DiagonalCross;Ee&&ge.code.add(le.H`
      const mat2 rotate45 = mat2(${le.H.float(Y)}, ${le.H.float(-ee)},
                                 ${le.H.float(ee)}, ${le.H.float(Y)});
    `),pe.draped||((0,te.hY)(ge,pe),ge.uniforms.add(new oe.p("worldToScreenPerDistanceRatio",(be,Se)=>1/Se.camera.perScreenPixelRatio)),ge.code.add(le.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),ge.code.add(le.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),ge.code.add(le.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${le.H.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),ge.code.add(le.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${Ee?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${Ee?" * rotate45":""};

      ${pe.draped?"":le.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${le.H.float(pe.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const De=pe.output===R.H.Depth;return De&&(he.include($.F,pe),(0,D.Zu)(he),(0,D.Lm)(he)),ge.code.add(le.H`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${me?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${De?le.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:le.H`transformPosition(proj, view, vpos);`}
    }
  `),he.include(G.f5,pe),_e.include(X.Y),pe.draped&&_e.uniforms.add(new oe.p("texelSize",(be,Se)=>1/Se.camera.pixelRatio)),pe.output===R.H.Highlight&&he.include(W.bA,pe),me&&he.include(B.l,pe),pe.output!==R.H.Highlight&&(_e.code.add(le.H`
      const float lineWidth = ${le.H.float(pe.lineWidth)};
      const float spacing = ${le.H.float(pe.patternSpacing)};
      const float spacingINV = ${le.H.float(1/pe.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),pe.draped||_e.code.add(le.H`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),_e.uniforms.add(new ae.N("uColor",be=>be.color)),_e.code.add(le.H`
    void main() {
      discardBySlice(vpos);
      ${me?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${pe.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${pe.output!==R.H.Highlight?le.H`color.a *= ${function ce(pe){function he(me){return pe.draped?le.H`coverage(vuv.${me}, texelSize)`:le.H`sample(vuv.${me})`}switch(pe.style){case j.b.ForwardDiagonal:case j.b.Horizontal:return he("y");case j.b.BackwardDiagonal:case j.b.Vertical:return he("x");case j.b.DiagonalCross:case j.b.Cross:return le.H`
        1.0 - (1.0 - ${he("x")}) * (1.0 - ${he("y")})
      `;default:return"0.0"}}(pe)};`:""}

      if (color.a < ${le.H.float(H.b)}) {
        discard;
      }

      ${pe.output===R.H.Alpha?le.H`gl_FragColor = vec4(color.a);`:""}

      ${pe.output===R.H.Color?le.H`gl_FragColor = color; ${pe.transparencyPassType===se.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${pe.output===R.H.Highlight?le.H`outputHighlight();`:""}
      ${pe.output===R.H.Depth?le.H`outputDepth(linearDepth);`:""};
    }
  `),he}const ue=Object.freeze(Object.defineProperty({__proto__:null,build:J},Symbol.toStringTag,{value:"Module"}))},5585:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>j,b:()=>X});var D=v(84161),R=v(28093),G=v(6067),Z=v(97139),Q=v(65787),$=v(17625),W=v(63123),B=v(22355),H=v(16396);function X(Y){const ee=new B.kG;return ee.attributes.add(H.T.POSITION,"vec3"),ee.attributes.add(H.T.INSTANCEFEATUREATTRIBUTE,"float"),ee.vertex.uniforms.add(new Z.J("cameraPosition",(ie,J)=>J.camera.eye)),ee.vertex.uniforms.add(new Z.J("offset",(ie,J)=>function te(Y,ee){const ie=ee.camera.eye,J=.5*Y.width,ce=1/Y.width,ue=(0,D.H)(oe,(0,D.s)(oe,(ie[0]+J)*ce,(ie[1]+J)*ce,(ie[2]+J)*ce));return(0,D.y)(ue,ie,(0,D.g)(ue,ue,Y.width))}(ie,J))),ee.vertex.uniforms.add(new Q.p("width",ie=>ie.width)),ee.vertex.uniforms.add(new W.g("proj",(ie,J)=>J.camera.projectionMatrix)),ee.vertex.uniforms.add(new W.g("view",(ie,J)=>J.camera.viewMatrix)),ee.vertex.uniforms.add(new Q.p("time",ie=>ie.time)),ee.varyings.add("vUv","vec2"),ee.vertex.code.add($.H`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${Y.type===G.H.Rain?$.H`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:$.H`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),ee.fragment.uniforms.add([new Q.p("opacity",ie=>ie.opacity),new Z.J("particleColor",(ie,J)=>function ae(Y,ee){const ie=ee.type===G.H.Rain?se:de,J=(0,D.g)(oe,ie,re);(0,D.n)(le,Y.camera.eye);const ue=Math.max(0,(0,D.e)(le,Y.lighting.mainLight.direction));return(0,D.h)(J,J,ie,ue)}(J,Y))]),ee.fragment.code.add($.H`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${Y.type===G.H.Rain?$.H`d = 0.35 * smoothstep(0.5, 0.0, d);`:$.H`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),ee}const oe=(0,R.c)(),le=(0,R.c)(),de=(0,R.f)(1,1,1),se=(0,R.f)(.85,.85,.85),re=.7,j=Object.freeze(Object.defineProperty({__proto__:null,build:X},Symbol.toStringTag,{value:"Module"}))},44796:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>se,R:()=>ce,a:()=>re,b:()=>j,c:()=>Y});var D=v(28093),R=v(62449),G=v(3802),Z=v(76301),Q=v(87191),$=v(14273),W=v(33726),B=v(78038),H=v(95285),X=v(65787),te=v(7090),ae=v(18952),oe=v(17625),le=v(22355),de=v(35387);class se extends Z.J{constructor(pe,he,me,ge,_e,Ee){super(pe,ge,_e),this.colormap=he,this.symbolizer=me,this.u_colormap=Ee,this.backgroundColor=D.Z,this.fboTexture=null,this.baseOpacity=1}}class re extends se{}class j extends se{}function Y(ue){const pe=new le.kG;return pe.include($.T),pe.include(Z.G,ue),pe.include(G.i,ue),pe.include(Q.JT,ue),pe.fragment.code.add(oe.H`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),ue.colorizerType===R.U.Stretch?function ie(ue,pe){ue.fragment.uniforms.add([new ae._("u_bandCount",me=>me.symbolizer.u_bandCount),new te.O("u_minCutOff",me=>me.symbolizer.u_minCutOff,3),new te.O("u_maxCutOff",me=>me.symbolizer.u_maxCutOff,3),new te.O("u_factor",me=>me.symbolizer.u_factor,3),new X.p("u_minOutput",me=>me.symbolizer.u_minOutput),new X.p("u_maxOutput",me=>me.symbolizer.u_maxOutput),new B.U("u_useGamma",me=>me.symbolizer.u_useGamma),new te.O("u_gamma",me=>me.symbolizer.u_gamma,3),new te.O("u_gammaCorrection",me=>me.symbolizer.u_gammaCorrection,3),new X.p("u_opacity",me=>me.common.u_opacity)]),ue.fragment.code.add(oe.H`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const he=pe.applyColormap?oe.H`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:oe.H`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;ue.fragment.code.add(oe.H`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${pe.stretchType===R.H.Noop?oe.H`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:oe.H`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${he}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}(pe,ue):ue.colorizerType===R.U.Lut?function ee(ue){ue.fragment.code.add(oe.H`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}(pe):ue.colorizerType===R.U.Hillshade&&function J(ue,pe){const he=ue.fragment;he.uniforms.add([new de.A("u_image",ge=>ge.u_image),new ae._("u_hillshadeType",ge=>ge.symbolizer.u_hillshadeType),new te.O("u_sinZcosAs",ge=>ge.symbolizer.u_sinZcosAs,6),new te.O("u_sinZsinAs",ge=>ge.symbolizer.u_sinZsinAs,6),new te.O("u_cosZs",ge=>ge.symbolizer.u_cosZs,6),new te.O("u_weights",ge=>ge.symbolizer.u_weights,6),new H.A("u_factor",ge=>ge.symbolizer.u_factor),new X.p("u_minValue",ge=>ge.symbolizer.u_minValue),new X.p("u_maxValue",ge=>ge.symbolizer.u_maxValue),new H.A("u_srcImageSize",ge=>ge.common.u_srcImageSize)]),he.include(W.Y),he.code.add(oe.H`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),he.code.add(oe.H`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const me=pe.applyColormap?oe.H`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:oe.H`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;he.code.add(oe.H`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${me}
    }
  `)}(pe,ue),pe}const ce=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:se,ColorizerStretchUniforms:re,ColorizerHillshadeUniforms:j,build:Y},Symbol.toStringTag,{value:"Module"}))},77133:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>ve,b:()=>ye});var D=v(52382),R=v(73132),G=v(13934),Z=v(78925),Q=v(24255),$=v(60355),W=v(26859),B=v(84833),H=v(99579),X=v(36603),te=v(58173),ae=v(66085),oe=v(58208),le=v(54662),de=v(13146),se=v(31166),re=v(10109),j=v(98898),Y=v(92724),ee=v(72968),ie=v(92836),J=v(67022),ce=v(93609),ue=v(28137),pe=v(2166),he=v(97139),me=v(69960),ge=v(65787),_e=v(17625),Ee=v(22355),De=v(35387),be=v(44835),Se=v(16396);function ye(xe){const ze=new Ee.kG,{vertex:Ke,fragment:We,varyings:Ce}=ze;return(0,pe.Sv)(Ke,xe),ze.include(B.f),Ce.add("vpos","vec3"),ze.include(ie.k,xe),ze.include($.f,xe),ze.include(ae.L,xe),xe.output!==G.H.Color&&xe.output!==G.H.Alpha||((0,pe.hY)(ze.vertex,xe),ze.include(W.O,xe),ze.include(Q.w,xe),xe.offsetBackfaces&&ze.include(R.w),xe.instancedColor&&ze.attributes.add(Se.T.INSTANCECOLOR,"vec4"),Ce.add("vNormalWorld","vec3"),Ce.add("localvpos","vec3"),xe.hasMultipassTerrain&&Ce.add("depth","float"),ze.include(X.D,xe),ze.include(D.qj,xe),ze.include(H.R,xe),ze.include(te.c,xe),Ke.uniforms.add(new me.N("externalColor",Be=>Be.externalColor)),Ce.add("vcolorExt","vec4"),Ke.code.add(_e.H`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${xe.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${_e.H.float(J.b)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${xe.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${xe.hasMultipassTerrain?_e.H`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),xe.output===G.H.Alpha&&(ze.include(Z.f5,xe),ze.include(ce.z,xe),ze.include(re.l,xe),We.uniforms.add([new ge.p("opacity",Be=>Be.opacity),new ge.p("layerOpacity",Be=>Be.layerOpacity)]),xe.hasColorTexture&&We.uniforms.add(new De.A("tex",Be=>Be.texture)),We.include(ue.y),We.code.add(_e.H`
      void main() {
        discardBySlice(vpos);
        ${xe.hasMultipassTerrain?_e.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${xe.hasColorTexture?_e.H`
                vec4 texColor = texture2D(tex, ${xe.hasColorTextureTransform?_e.H`colorUV`:_e.H`vuv0`});
                ${xe.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:_e.H`vec4 texColor = vec4(1.0);`}
        ${xe.hasVertexColors?_e.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:_e.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),xe.output===G.H.Color&&(ze.include(Z.f5,xe),ze.include(de.XP,xe),ze.include(le.K,xe),ze.include(ce.z,xe),ze.include(xe.instancedDoublePrecision?ee.hb:ee.XE,xe),ze.include(re.l,xe),(0,pe.hY)(ze.fragment,xe),(0,se.Pe)(We),(0,de.PN)(We),(0,de.sC)(We),We.uniforms.add([Ke.uniforms.get("localOrigin"),Ke.uniforms.get("view"),new he.J("ambient",Be=>Be.ambient),new he.J("diffuse",Be=>Be.diffuse),new ge.p("opacity",Be=>Be.opacity),new ge.p("layerOpacity",Be=>Be.layerOpacity)]),xe.hasColorTexture&&We.uniforms.add(new De.A("tex",Be=>Be.texture)),ze.include(Y.jV,xe),ze.include(j.T,xe),We.include(ue.y),ze.extensions.add("GL_OES_standard_derivatives"),(0,se.F1)(We),We.code.add(_e.H`
      void main() {
        discardBySlice(vpos);
        ${xe.hasMultipassTerrain?_e.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${xe.hasColorTexture?_e.H`
                vec4 texColor = texture2D(tex, ${xe.hasColorTextureTransform?_e.H`colorUV`:_e.H`vuv0`});
                ${xe.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:_e.H`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${xe.pbrMode===Y.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${xe.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":xe.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${xe.hasVertexColors?_e.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:_e.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${xe.snowCover?_e.H`albedo = mix(albedo, vec3(1), 0.9);`:_e.H``}
        ${_e.H`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${xe.pbrMode===Y.f7.Normal||xe.pbrMode===Y.f7.Schematic?xe.spherical?_e.H`vec3 normalGround = normalize(vpos + localOrigin);`:_e.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:_e.H``}
        ${xe.pbrMode===Y.f7.Normal||xe.pbrMode===Y.f7.Schematic?_e.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${xe.snowCover?_e.H`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:_e.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${xe.transparencyPassType===be.A.Color?_e.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:_e.H``}
      }
    `)),ze.include(oe.s,xe),ze}const ve=Object.freeze(Object.defineProperty({__proto__:null,build:ye},Symbol.toStringTag,{value:"Module"}))},3393:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>pe,R:()=>me,b:()=>he});var D=v(62208),R=v(52382),G=v(13934),Z=v(78925),Q=v(23164),$=v(39645),W=v(54120),B=v(92484),H=v(50823),X=v(10109),te=v(39337),ae=v(67022),oe=v(33726),le=v(2166),de=v(95285),se=v(69960),re=v(65787),j=v(17625),Y=v(63123),ee=v(22355),ie=v(44835),J=v(16396),ce=v(46359),ue=v(39401);const pe=1;function he(ge){const _e=new ee.kG,{vertex:Ee,fragment:De}=_e,be=ge.hasMultipassTerrain&&(ge.output===G.H.Color||ge.output===G.H.Alpha);_e.include(te.e),_e.include($.U,ge),_e.include(B.q,ge);const Se=ge.applyMarkerOffset&&!ge.draped;Se&&(Ee.uniforms.add(new re.p("markerScale",Be=>Be.markerScale)),_e.include(H.Q,{space:ce.I9.World})),ge.output===G.H.Depth&&_e.include(W.F,ge),_e.include(Q.R,ge),(0,le.Sv)(Ee,ge),Ee.uniforms.add([new Y.g("inverseProjectionMatrix",(Be,Fe)=>Fe.camera.inverseProjectionMatrix),new de.A("nearFar",(Be,Fe)=>Fe.camera.nearFar),new re.p("miterLimit",Be=>"miter"!==Be.join?0:Be.miterLimit),new se.N("viewport",(Be,Fe)=>Fe.camera.fullViewport)]),Ee.constants.add("LARGE_HALF_FLOAT","float",65500),_e.attributes.add(J.T.POSITION,"vec3"),_e.attributes.add(J.T.SUBDIVISIONFACTOR,"float"),_e.attributes.add(J.T.UV0,"vec2"),_e.attributes.add(J.T.AUXPOS1,"vec3"),_e.attributes.add(J.T.AUXPOS2,"vec3"),_e.varyings.add("vColor","vec4"),_e.varyings.add("vpos","vec3"),(0,R.Lm)(_e),be&&_e.varyings.add("depth","float");const ye=ge.capType===ue.R.ROUND,ve=ge.stippleEnabled&&ge.stippleScaleWithLineWidth||ye;ve&&_e.varyings.add("vLineWidth","float");const xe=ge.stippleEnabled&&ge.stippleScaleWithLineWidth;xe&&_e.varyings.add("vLineSizeInv","float");const ze=ge.innerColorEnabled||ye;ze&&_e.varyings.add("vLineDistance","float");const Ke=ge.stippleEnabled&&ye,We=ge.falloffEnabled||Ke;return We&&_e.varyings.add("vLineDistanceNorm","float"),ye&&(_e.varyings.add("vSegmentSDF","float"),_e.varyings.add("vReverseSegmentSDF","float")),Ee.code.add(j.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),Ee.code.add(j.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),(0,R.bA)(_e),Ee.code.add(j.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${be?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),Ee.uniforms.add(new re.p("pixelRatio",(Be,Fe)=>Fe.camera.pixelRatio)),Ee.code.add(j.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${ve?j.H`vLineWidth = lineWidth;`:""}
      ${xe?j.H`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),Se&&Ee.code.add(j.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),Ee.code.add(j.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(ge.stippleEnabled||ye)&&Ee.code.add(j.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${ye?j.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),Ee.code.add(j.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),Ee.code.add(ge.roundJoins?j.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${ge.stippleEnabled?j.H`min(1.0, subdivisionFactor * ${j.H.float((pe+2)/(pe+1))})`:j.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `:j.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),Ee.code.add(j.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${ge.capType!==ue.R.BUTT?j.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),Ee.code.add(j.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${We||ze?j.H`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${ze?j.H`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${We?j.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),ye&&Ee.code.add(j.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),ge.stippleEnabled&&(ge.draped?Ee.uniforms.add(new re.p("worldToScreenRatio",(Be,Fe)=>1/Fe.screenToPCSRatio)):Ee.code.add(j.H`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),Ee.code.add(j.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),Ee.code.add(ge.draped?j.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`:j.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),Ee.uniforms.add(new re.p("stipplePatternPixelSize",Be=>(0,B.C)(Be))),Ee.code.add(j.H`
      float patternLength = ${ge.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),Ee.code.add(j.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${ge.wireframe&&!ge.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),be&&_e.include(X.l,ge),_e.include(Z.f5,ge),De.include(oe.Y),De.code.add(j.H`
  void main() {
    discardBySlice(vpos);
    ${be?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),ge.wireframe?De.code.add(j.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(ye&&De.code.add(j.H`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${j.H.float(ae.b)}) {
        discard;
      }
    `),De.code.add(Ke?j.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${j.H.float(ae.b)}, stippleCoverage);
      `:j.H`float stippleAlpha = getStippleAlpha();`),De.uniforms.add(new se.N("intrinsicColor",Be=>Be.color)),De.code.add(j.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),ge.innerColorEnabled&&(De.uniforms.add(new se.N("innerColor",Be=>(0,D.Pt)(Be.innerColor,Be.color))),De.uniforms.add(new re.p("innerWidth",(Be,Fe)=>Be.innerWidth*Fe.camera.pixelRatio)),De.code.add(j.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),De.code.add(j.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),ge.falloffEnabled&&(De.uniforms.add(new re.p("falloff",Be=>Be.falloff)),De.code.add(j.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),De.code.add(j.H`
    if (finalColor.a < ${j.H.float(ae.b)}) {
      discard;
    }

    ${ge.output===G.H.Alpha?j.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${ge.output===G.H.Color?j.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${ge.output===G.H.Color&&ge.transparencyPassType===ie.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${ge.output===G.H.Highlight?j.H`gl_FragColor = vec4(1.0);`:""}
    ${ge.output===G.H.Depth?j.H`outputDepth(linearDepth);`:""}
    ${ge.output===G.H.ObjectAndLayerIdColor?j.H`outputObjectAndLayerIdColor();`:""}
  }
  `),_e}const me=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:pe,build:he},Symbol.toStringTag,{value:"Module"}))},52376:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>re,b:()=>le});var D=v(62208),R=v(67831),G=v(99770),Z=v(98071),Q=v(47923),$=v(39832),W=v(95285),B=v(65787),H=v(17625),X=v(22355),te=v(35387);function le(){const j=new X.kG,Y=j.fragment;return j.include(Z.k),Y.include(Q.S),j.include($.G),Y.uniforms.add(new B.p("radius",(ee,ie)=>de(ie))),Y.code.add(H.H`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),Y.code.add(H.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),Y.uniforms.add([new W.A("nearFar",(ee,ie)=>ie.camera.nearFar),new te.A("normalMap",ee=>ee.normalTexture),new te.A("depthMap",ee=>ee.depthTexture),new W.A("zScale",(ee,ie)=>(0,$.R)(ie)),new B.p("projScale",ee=>ee.projScale),new te.A("rnm",ee=>ee.noiseTexture),new W.A("rnmScale",(ee,ie)=>(0,R.s)(se,ie.camera.fullWidth/(0,D.Wg)(ee.noiseTexture).descriptor.width,ie.camera.fullHeight/(0,D.Wg)(ee.noiseTexture).descriptor.height)),new B.p("intensity",(ee,ie)=>2/de(ie)**6),new W.A("screenSize",(ee,ie)=>(0,R.s)(se,ie.camera.fullWidth,ie.camera.fullHeight))]),Y.code.add(H.H`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${H.H.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${H.H.int(16)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),j}function de(j){return Math.max(10,20*j.camera.computeRenderPixelSizeAtDist(Math.abs(4*j.camera.relativeElevation)))}const se=(0,G.a)(),re=Object.freeze(Object.defineProperty({__proto__:null,build:le},Symbol.toStringTag,{value:"Module"}))},86962:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>oe,b:()=>ae});var D=v(84161),R=v(98071),G=v(47923),Z=v(32181),Q=v(95285),$=v(65787),W=v(17625),B=v(22355),H=v(5864),X=v(35387);function ae(){const le=new B.kG,de=le.fragment;return le.include(R.k),de.include(G.S),de.uniforms.add([new X.A("depthMap",j=>j.depthTexture),new H.R("tex",j=>j.colorTexture),new Z.q("blurSize",j=>j.blurSize),new $.p("projScale",(j,Y)=>{const ee=(0,D.i)(Y.camera.eye,Y.camera.center);return ee>5e4?Math.max(0,j.projScale-(ee-5e4)):j.projScale}),new Q.A("nearFar",(j,Y)=>Y.camera.nearFar)]),de.code.add(W.H`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${W.H.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),de.code.add(W.H`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${W.H.int(4)}; r <= ${W.H.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),le}const oe=Object.freeze(Object.defineProperty({__proto__:null,build:ae},Symbol.toStringTag,{value:"Module"}))},94195:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>oe,a:()=>j,b:()=>se,s:()=>le});var D=v(28347),R=v(43703),G=v(98071),Z=v(47923),Q=v(72968),$=v(39832),W=v(19278),B=v(95285),H=v(17625),X=v(63123),te=v(22355),ae=v(35387);class oe extends Q.ry{}const le=255,de=1/le;function se(Y){const ee=new te.kG,ie=ee.fragment;return ie.include(W.n),ie.include(Z.S),ee.include($.G),ee.include(G.k),ee.include(Q.hb,Y),ie.uniforms.add([new ae.A("depthMap",J=>J.linearDepthTexture),new X.g("inverseViewMatrix",(J,ce)=>(0,D.a)(re,(0,D.v)(re,ce.camera.viewMatrix,ce.camera.center))),new B.A("nearFar",(J,ce)=>ce.camera.nearFar)]),ie.constants.add("sampleValue","float",de),ie.code.add(H.H`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),ee}const re=(0,R.c)(),j=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:oe,shadowCastMaxSamples:le,build:se},Symbol.toStringTag,{value:"Module"}))},82148:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>oe,b:()=>ae});var D=v(98071),R=v(47923),G=v(39832),Z=v(19278),Q=v(69960),$=v(65787),W=v(17625),B=v(22355),H=v(35387),X=v(94195),te=v(69828);function ae(le){const de=new B.kG,se=de.fragment;se.include(Z.n),se.include(R.S),de.include(G.G),de.include(D.k);const{visualization:re,bandsEnabled:j}=le;se.constants.add("inverseSampleValue","float",X.s),se.uniforms.add([new H.A("shadowCastMap",ie=>ie.shadowCastMap),new $.p("sampleScale",ie=>ie.sampleScale),new $.p("opacityFromElevation",ie=>ie.opacityFromElevation),new Q.N("uColor",ie=>ie.color)]);const Y=re===te.w.Gradient,ee=re===te.w.Threshold;return Y&&j?se.uniforms.add(new $.p("bandSize",ie=>ie.bandSize)):ee&&se.uniforms.add(new $.p("threshold",ie=>ie.threshold)),se.code.add(W.H`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${ee?W.H`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${Y&&j?W.H`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${Y?W.H`* strength`:""});
      }
    `),de}const oe=Object.freeze(Object.defineProperty({__proto__:null,build:ae},Symbol.toStringTag,{value:"Module"}))},19263:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>ge,b:()=>ue});var D=v(62208),R=v(28347),G=v(43703),Z=v(67831),Q=v(99770),$=v(84161),W=v(28093),B=v(98071),H=v(62952),X=v(47923),te=v(72968),ae=v(39832),oe=v(19278),le=v(95285),de=v(97139),se=v(69960),re=v(65787),j=v(17625),Y=v(63123),ee=v(22355),ie=v(35387),J=v(53319);function ue(_e){const Ee=new ee.kG;Ee.include(te.XE,_e);const De=Ee.fragment;return De.include(oe.n),De.include(X.S),Ee.include(ae.G),Ee.include(B.k),De.uniforms.add([new ie.A("defaultDepthTex",(be,Se)=>Se.shadowMap.getSnapshot(J.i.Default)),new ie.A("highlightDepthTex",(be,Se)=>Se.shadowMap.getSnapshot(J.i.Highlight)),new ie.A("depthMap",(be,Se)=>Se.linearDepthTexture),new ie.A("highlightMap",(be,Se)=>Se.highlightColorTexture),new se.N("uColor",be=>be.shadowColor),new le.A("nearFar",(be,Se)=>Se.camera.nearFar),new re.p("opacity",be=>be.shadowOpacity),new re.p("occludedOpacity",be=>be.occludedShadowOpacity),new re.p("terminationFactor",be=>be.opacityElevation*be.dayNightTerminator),new de.J("lightingMainDirectionView",(be,Se)=>(0,$.n)(he,(0,$.m)(he,Se.lighting.mainLight.direction,Se.camera.viewInverseTransposeMatrix))),new le.A("texelSize",(be,Se)=>(0,D.pC)(Se.linearDepthTexture)?(0,Z.s)(me,1/Se.linearDepthTexture.descriptor.width,1/Se.linearDepthTexture.descriptor.height):Q.Z),new Y.g("inverseViewMatrix",(be,Se)=>(0,R.a)(pe,(0,R.v)(pe,Se.camera.viewMatrix,Se.camera.center)))]),De.constants.add("unoccludedHighlightFlag","vec4",H.ck).add("highlightedThreshold","float",.99999).add("selfShadowThreshold","float",.025),De.code.add(j.H`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),De.code.add(j.H`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),Ee}const pe=(0,G.c)(),he=(0,W.c)(),me=(0,Q.a)(),ge=Object.freeze(Object.defineProperty({__proto__:null,build:ue},Symbol.toStringTag,{value:"Module"}))},4300:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>le,a:()=>re,b:()=>de,c:()=>se});var D=v(99770),R=v(28093),G=v(49115),Z=v(24255),Q=v(31166),$=v(95285),W=v(97139),B=v(65787),H=v(17625),X=v(63123),te=v(22355),ae=v(35387),oe=v(16396);class le extends H.K{constructor(){super(...arguments),this.texV=(0,D.a)(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new de}}class de{constructor(){this.center=(0,R.c)(),this.v1=(0,R.c)(),this.v2=(0,R.c)()}}function se(j){const Y=new te.kG,{vertex:ee,fragment:ie}=Y;if((0,Q.Pe)(ee),j.geometry===G.n.Underground)Y.attributes.add(oe.T.POSITION,"vec2"),Y.varyings.add("color","vec4"),ee.uniforms.add([new W.J("cameraPosition",(J,ce)=>ce.camera.eye),new B.p("undergroundFadeAlpha",J=>J.undergroundFadeAlpha)]),ee.code.add(H.H`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),ie.code.add(H.H`void main() {
gl_FragColor = color;
}`);else{Y.include(Z.w,j),Y.attributes.add(oe.T.POSITION,"vec3"),Y.varyings.add("vtc","vec2"),Y.varyings.add("falloff","float");const J=j.geometry===G.n.Cylinder;ee.uniforms.add([new X.g("proj",(pe,he)=>he.camera.projectionMatrix),new X.g("view",(pe,he)=>he.camera.viewMatrix)]),J||(Y.varyings.add("innerFactor","float"),ee.uniforms.add(new W.J("silCircleCenter",pe=>pe.silhouette.center)),ee.uniforms.add(new W.J("silCircleV1",pe=>pe.silhouette.v1)),ee.uniforms.add(new W.J("silCircleV2",pe=>pe.silhouette.v2)),ee.uniforms.add(new $.A("texV",pe=>pe.texV)),ee.uniforms.add(new B.p("innerScale",pe=>pe.innerScale)));const ce=6.2831853,ue=1/128;ee.code.add(H.H`
		void main(void) {
      ${J?H.H`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:H.H`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${H.H.float(ce*ue)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${H.H.float(ue)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),ie.uniforms.add(new ae.A("tex",pe=>pe.texture)),J||ie.uniforms.add(new B.p("altitudeFade",pe=>pe.altitudeFade)),ie.code.add(H.H`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${J?H.H`gl_FragColor = atmosphereColor;`:H.H`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return Y}const re=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:le,SilhouetteCircle:de,build:se},Symbol.toStringTag,{value:"Module"}))},45695:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>oe,b:()=>X});var D=v(28347),R=v(43703),G=v(35283),Z=v(69960),Q=v(65787),$=v(17625),W=v(63123),B=v(22355),H=v(16396);function X(){const le=new B.kG;return le.attributes.add(H.T.POSITION,"vec3"),le.attributes.add(H.T.COLOR,"vec4"),le.attributes.add(H.T.SIZE,"float"),le.varyings.add("vcolor","vec4"),le.varyings.add("vsize","float"),le.vertex.uniforms.add([new W.g("transform",(de,se)=>function te(le,de){return(0,D.c)(ae,de.camera.projectionMatrix),ae[10]=24e-8-1,ae[11]=-1,ae[14]=(24e-8-2)*de.camera.near,(0,D.m)(ae,ae,de.camera.viewMatrix),(0,D.m)(ae,ae,le.modelMatrix)}(de,se)),new Z.N("viewport",(de,se)=>se.camera.fullViewport),new Q.p("pixelRatio",(de,se)=>se.camera.pixelRatio)]),le.include(G.H),le.vertex.code.add($.H`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),le.fragment.code.add($.H`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),le}const ae=(0,R.c)(),oe=Object.freeze(Object.defineProperty({__proto__:null,build:X},Symbol.toStringTag,{value:"Module"}))},73693:(nt,Ae,v)=>{"use strict";v.d(Ae,{T:()=>De,a:()=>ve,b:()=>be});var D=v(28347),R=v(43703),G=v(84161),Z=v(28093),Q=v(75224),$=v(52382),W=v(13934),B=v(78925),H=v(24255),X=v(26859),te=v(84833),ae=v(36603),oe=v(43880),le=v(54120),de=v(62952),se=v(54662),re=v(13146),j=v(31166),Y=v(7025),ee=v(92724),ie=v(72968),J=v(30249),ce=v(91528),ue=v(2166),pe=v(43177),he=v(97139),me=v(17625),ge=v(47205),_e=v(22355),Ee=v(35387);class De extends ce.uS{}function be(xe){const ze=new _e.kG,{vertex:Ke,fragment:We,varyings:Ce}=ze;ze.include(te.f),ze.include(X.O,xe),ze.include(ae.D,xe);const Be=()=>{ze.include(Y.n,xe),Ke.code.add(me.H`
  vec3 decodeNormalTerrain(vec2 e) {
    float z = 1.0 - abs(e.x) - abs(e.y);
    vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
    return normalize(n);
  }

  vec3 getNormal() {
    return  ${xe.shading?me.H`normalize(decodeNormalTerrain(normalCompressed))`:me.H`getLocalUp(position, localOrigin)`};
  }
  `)};(0,ue.Sv)(Ke,xe),ze.include(H.w,xe);const Fe=xe.overlayMode!==J.gT.Disabled;switch(xe.output){case W.H.Color:{ze.include(ce.EK,xe),ze.include(re.XP,xe);const je=xe.overlayMode===J.gT.EnabledWithWater;Fe&&ze.include(ce.yl,{...xe,pbrMode:ee.f7.Water}),je&&ze.include(oe.M,xe),Ce.add("vnormal","vec3"),Ce.add("vpos","vec3"),Be(),(xe.atmosphere||xe.screenSizePerspective)&&(0,ue._8)(Ke);const Re=xe.receiveShadows&&!xe.renderOccluded;Re&&ze.include($.qj,xe),xe.atmosphere&&Ce.add("wnormal","vec3"),xe.screenSizePerspective&&(Ce.add("screenSizeDistanceToCamera","float"),Ce.add("screenSizeCosAngle","float")),Ke.code.add(me.H`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          ${je?me.H`forwardVertexTangent(vnormal);`:me.H``}

          ${xe.atmosphere?me.H`
          wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Fe?me.H`setOverlayVTC(uv);`:""}
          ${xe.tileBorders?me.H`forwardTextureCoordinates();`:""}

          ${xe.screenSizePerspective?me.H`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${Re?me.H`forwardLinearDepth();`:""}

        }
      `),ze.extensions.add("GL_OES_standard_derivatives"),ze.extensions.add("GL_EXT_shader_texture_lod"),ze.include(B.f5,xe),ze.include(re.XP,xe),ze.include(se.K,xe),ze.include(ie.XE,xe),je&&(0,ue.hY)(We,xe),(0,re.PN)(We),(0,re.sC)(We),We.uniforms.add([Ke.uniforms.get("localOrigin"),new he.J("viewDirection",(He,Ie)=>(0,G.n)(ye,(0,G.s)(ye,Ie.camera.viewMatrix[12],Ie.camera.viewMatrix[13],Ie.camera.viewMatrix[14])))]),je&&We.uniforms.add([new Ee.A("ovWaterTex",(He,Ie)=>0===Ie.overlays.length?null:Ie.overlays[Q.fu.INNER].getNormalTexture(He.overlaySource)),new ge.K("view",(He,Ie)=>(0,D.v)(Se,Ie.camera.viewMatrix,He.origin))]),We.code.add(me.H`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),(0,j.Pe)(We),(0,j.F1)(We),We.code.add(me.H`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${xe.receiveShadows&&!xe.renderOccluded?"readShadowMap(vpos, linearDepth)":xe.spherical&&xe.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Fe?me.H`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${xe.transparent?me.H`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
          if (rejectBySlice(vpos)) {
            tileColor *= sliceOpacity;
          }
          ${xe.atmosphere?me.H`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${xe.atmosphere?me.H`atm + tileColor.rgb;`:me.H`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
          ${je?me.H`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
          ${xe.screenSizePerspective?me.H`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${xe.visualizeNormals?xe.spherical?me.H`
              vec3 localUp = normalize(vpos + localOrigin);
              vec3 right = normalize(cross(vec3(0.0,0.0,1.0),localUp));
              vec3 forward = normalize(cross(localUp,right));
              mat3 tbn = mat3(right, forward, localUp);
              vec3 tNormal = normalize(normal* tbn);
              gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
          `:me.H`
          vec3 tNormal = normalize(normal);
          gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
      `:""}
          ${xe.tileBorders?me.H`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case W.H.Depth:ze.include(ce.yl,xe),ze.include(le.F,xe),(0,$.Lm)(ze),(0,$.Zu)(ze),Ke.code.add(me.H`
              void main(void) {
                ${Fe?me.H`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),We.code.add(me.H`
              void main() {
                ${Fe?me.H`
                  vec4 overlayColor = getCombinedOverlayColor();
                  ${xe.transparent?me.H`if (overlayColor.a == 0.0) { discard; }`:""}`:""}
                outputDepth(linearDepth);
              }
          `);break;case W.H.Shadow:case W.H.ShadowHighlight:case W.H.ShadowExludeHighlight:ze.include(le.F,xe),(0,$.Lm)(ze),(0,$.Zu)(ze),Ke.code.add(me.H`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),We.code.add(me.H`void main() {
outputDepth(linearDepth);
}`);break;case W.H.Normal:Ce.add("vnormal","vec3"),(0,ue._8)(Ke),Be(),Ke.code.add(me.H`void main(void) {
vec3 normal = getNormal();
gl_Position = transformPosition(proj, view, position);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),We.code.add(me.H`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`);break;case W.H.Highlight:ze.include(ce.yl,xe),Ke.code.add(me.H`void main() {
setOverlayVTC(getUV0());
gl_Position = transformPosition(proj, view, position);
}`),ze.include(de.bA,xe),We.code.add(me.H`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
discard;
}
outputHighlight();
}`)}return xe.output===W.H.ObjectAndLayerIdColor&&(ze.include(ce.yl,{...xe,pbrMode:ee.f7.Disabled}),Ke.code.add(me.H`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),We.code.add(me.H`
        void main() {
          vec2 texDim =  ${(0,pe.w_)(xe,"ovColorTex")};
          gl_FragColor =  ${(0,pe.b6)(xe,"ovColorTex","vec2(vtcOverlay.x * 0.5, vtcOverlay.y)*texDim")};
        }
    `)),ze}const Se=(0,R.c)(),ye=(0,Z.c)(),ve=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:De,build:be},Symbol.toStringTag,{value:"Module"}))},98361:(nt,Ae,v)=>{"use strict";v.d(Ae,{T:()=>W,a:()=>H,b:()=>B});var D=v(4794),R=v(98071),G=v(69960),Z=v(17625),Q=v(22355),$=v(35387);class W extends Z.K{constructor(){super(...arguments),this.color=(0,D.f)(1,1,1,1)}}function B(){const X=new Q.kG;return X.include(R.k),X.fragment.uniforms.add([new $.A("tex",te=>te.texture),new G.N("uColor",te=>te.color)]),X.fragment.code.add(Z.H`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),X}const H=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:W,build:B},Symbol.toStringTag,{value:"Module"}))},61584:(nt,Ae,v)=>{"use strict";v.d(Ae,{W:()=>ue,b:()=>ce});var D=v(52382),R=v(13934),G=v(78925),Z=v(24255),Q=v(62952),$=v(44965),W=v(31166),B=v(10109),H=v(7025),X=v(92724),te=v(72968),ae=v(69117),oe=v(45780),le=v(67022),de=v(33726),se=v(2166),re=v(69960),j=v(65787),Y=v(17625),ee=v(22355),ie=v(44835),J=v(16396);function ce(pe){const he=new ee.kG,{vertex:me,fragment:ge}=he;(0,se.Sv)(me,pe),he.include(Z.w,pe),he.attributes.add(J.T.POSITION,"vec3"),he.attributes.add(J.T.UV0,"vec2");const _e=new re.N("waterColor",Ee=>Ee.color);if(pe.output===R.H.Color&&pe.isDraped)return he.varyings.add("vpos","vec3"),me.uniforms.add(_e),me.code.add(Y.H`
        void main(void) {
          if (waterColor.a < ${Y.H.float(le.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),ge.uniforms.add(_e),ge.code.add(Y.H`void main() {
gl_FragColor = waterColor;
}`),he;switch(pe.output!==R.H.Color&&pe.output!==R.H.Alpha||(he.include(H.n,pe),he.include(D.qj,pe),he.varyings.add("vuv","vec2"),he.varyings.add("vpos","vec3"),he.varyings.add("vnormal","vec3"),he.varyings.add("vtbnMatrix","mat3"),pe.hasMultipassTerrain&&he.varyings.add("depth","float"),me.uniforms.add(_e),me.code.add(Y.H`
      void main(void) {
        if (waterColor.a < ${Y.H.float(le.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${pe.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${pe.output===R.H.Color?"forwardLinearDepth();":""}
      }
    `)),he.include(B.l,pe),pe.output){case R.H.Alpha:he.include(G.f5,pe),ge.uniforms.add(_e),ge.code.add(Y.H`
        void main() {
          discardBySlice(vpos);
          ${pe.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case R.H.Color:he.include(W.kR,pe),he.include($._,{pbrMode:X.f7.Disabled,lightingSphericalHarmonicsOrder:2}),he.include(oe.M),he.include(G.f5,pe),he.include(te.XE,pe),he.include(ae.B,pe),ge.uniforms.add([_e,new j.p("timeElapsed",Ee=>Ee.timeElapsed),me.uniforms.get("view"),me.uniforms.get("localOrigin")]),(0,se.hY)(ge,pe),ge.include(de.Y),(0,W.Pe)(ge),(0,W.F1)(ge),ge.code.add(Y.H`
      void main() {
        discardBySlice(vpos);
        ${pe.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${pe.receiveShadows?Y.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${pe.transparencyPassType===ie.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case R.H.Normal:he.include(H.n,pe),he.include(oe.M,pe),he.include(G.f5,pe),he.varyings.add("vpos","vec3"),he.varyings.add("vuv","vec2"),me.uniforms.add(_e),me.code.add(Y.H`
        void main(void) {
          if (waterColor.a < ${Y.H.float(le.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),ge.uniforms.add(new j.p("timeElapsed",Ee=>Ee.timeElapsed)),ge.code.add(Y.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case R.H.Highlight:he.include(Q.bA,pe),he.varyings.add("vpos","vec3"),me.uniforms.add(_e),me.code.add(Y.H`
      void main(void) {
        if (waterColor.a < ${Y.H.float(le.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),he.include(G.f5,pe),ge.code.add(Y.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return he}const ue=Object.freeze(Object.defineProperty({__proto__:null,build:ce},Symbol.toStringTag,{value:"Module"}))},1719:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>G,c:()=>D,g:()=>R});var D=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function R(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}function G(Z){throw new Error('Could not dynamically require "'+Z+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}},41743:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>se,a:()=>re,b:()=>et,c:()=>Y,d:()=>We,e:()=>ve,f:()=>ie,g:()=>pe,h:()=>Se,i:()=>he,n:()=>Fe,r:()=>Be,t:()=>Ce,u:()=>J}),v(8314);var R=v(63290),G=v(21286),Z=v(97535),Q=v(28347),$=v(43703),W=v(84161),B=v(28093),H=v(78172),X=v(13777),te=v(90014),ae=v(70562),oe=v(34054),le=v(26242);const de=R.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class se{constructor(){this.plane=(0,te.Ue)(),this.origin=(0,B.c)(),this.basis1=(0,B.c)(),this.basis2=(0,B.c)()}}function re(qe=Le){return{plane:(0,te.Ue)(qe.plane),origin:(0,B.a)(qe.origin),basis1:(0,B.a)(qe.basis1),basis2:(0,B.a)(qe.basis2)}}function Y(qe,ot=re()){return ie(qe.origin,qe.basis1,qe.basis2,ot)}function ie(qe,ot,ut,_t=re()){return(0,W.c)(_t.origin,qe),(0,W.c)(_t.basis1,ot),(0,W.c)(_t.basis2,ut),J(_t),function Ge(qe,ot){Math.abs((0,W.e)(qe.basis1,qe.basis2)/((0,W.l)(qe.basis1)*(0,W.l)(qe.basis2)))>1e-6&&de.warn(ot,"Provided basis vectors are not perpendicular"),Math.abs((0,W.e)(qe.basis1,Fe(qe)))>1e-6&&de.warn(ot,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,W.e)(Fe(qe),qe.origin)-qe.plane[3])>1e-6&&de.warn(ot,"Plane offset is not consistent with plane origin")}(_t,"fromValues()"),_t}function J(qe){(0,te.my)(qe.basis2,qe.basis1,qe.origin,qe.plane)}function ce(qe,ot,ut){qe!==ut&&Y(qe,ut);const _t=(0,W.g)(le.WM.get(),Fe(qe),ot);return(0,W.a)(ut.origin,ut.origin,_t),ut.plane[3]-=ot,ut}function pe(qe,ot=re()){const ut=(qe[2]-qe[0])/2,_t=(qe[3]-qe[1])/2;return(0,W.s)(ot.origin,qe[0]+ut,qe[1]+_t,0),(0,W.s)(ot.basis1,ut,0,0),(0,W.s)(ot.basis2,0,_t,0),(0,te.al)(0,0,1,0,ot.plane),ot}function he(qe,ot,ut){return!!(0,te.BR)(qe.plane,ot,ut)&&Re(qe,ut)}function ge(qe,ot,ut){const _t=Me.get();Pe(qe,ot,_t,Me.get());let Ct=Number.POSITIVE_INFINITY;for(const vt of Je){const Lt=Ie(qe,vt,Ne.get()),jt=le.WM.get();if((0,te.rx)(_t,Lt,jt)){const $t=(0,W.r)(le.WM.get(),ot.origin,jt),Wt=Math.abs((0,G.ZF)((0,W.e)(ot.direction,$t)));Wt<Ct&&(Ct=Wt,(0,W.c)(ut,jt))}}return Ct===Number.POSITIVE_INFINITY?_e(qe,ot,ut):ut}function _e(qe,ot,ut){if(he(qe,ot,ut))return ut;const _t=Me.get(),Ct=Me.get();Pe(qe,ot,_t,Ct);let vt=Number.POSITIVE_INFINITY;for(const Lt of Je){const jt=Ie(qe,Lt,Ne.get()),$t=le.WM.get();if((0,te.dZ)(_t,jt,$t)){const Wt=(0,ae.Jk)(ot,$t);if(!(0,te.Ac)(Ct,$t))continue;Wt<vt&&(vt=Wt,(0,W.c)(ut,$t))}}return be(qe,ot.origin)<vt&&Ee(qe,ot.origin,ut),ut}function Ee(qe,ot,ut){const _t=(0,te.nF)(qe.plane,ot,le.WM.get()),Ct=(0,X.ct)(He(qe,qe.basis1),_t,-1,1,le.WM.get()),vt=(0,X.ct)(He(qe,qe.basis2),_t,-1,1,le.WM.get());return(0,W.b)(ut,(0,W.a)(le.WM.get(),Ct,vt),qe.origin),ut}function De(qe,ot,ut){const{origin:_t,basis1:Ct,basis2:vt}=qe,Lt=(0,W.b)(le.WM.get(),ot,_t),jt=(0,oe.SR)(Ct,Lt),$t=(0,oe.SR)(vt,Lt),Wt=(0,oe.SR)(Fe(qe),Lt);return(0,W.s)(ut,jt,$t,Wt)}function be(qe,ot){const ut=De(qe,ot,le.WM.get()),{basis1:_t,basis2:Ct}=qe,vt=(0,W.l)(_t),Lt=(0,W.l)(Ct),jt=Math.max(Math.abs(ut[0])-vt,0),$t=Math.max(Math.abs(ut[1])-Lt,0),Wt=ut[2];return jt*jt+$t*$t+Wt*Wt}function Se(qe,ot){return Math.sqrt(be(qe,ot))}function ve(qe,ot){return(0,te.Ac)(qe.plane,ot)&&Re(qe,ot)}function ze(qe,ot){const ut=-qe.plane[3];return(0,oe.SR)(Fe(qe),ot)-ut}function We(qe,ot){return(0,W.k)(qe.basis1,ot.basis1)&&(0,W.k)(qe.basis2,ot.basis2)&&(0,W.k)(qe.origin,ot.origin)}function Ce(qe,ot,ut){return qe!==ut&&Y(qe,ut),(0,Q.a)(rt,ot),(0,Q.t)(rt,rt),(0,W.m)(ut.basis1,qe.basis1,rt),(0,W.m)(ut.basis2,qe.basis2,rt),(0,W.m)((0,te.mJ)(ut.plane),(0,te.mJ)(qe.plane),rt),(0,W.m)(ut.origin,qe.origin,ot),(0,te.T5)(ut.plane,ut.plane,ut.origin),ut}function Be(qe,ot,ut,_t){return qe!==_t&&Y(qe,_t),(0,Q.d)(tt,ot,ut),(0,W.m)(_t.basis1,qe.basis1,tt),(0,W.m)(_t.basis2,qe.basis2,tt),J(_t),_t}function Fe(qe){return(0,te.mJ)(qe.plane)}function Re(qe,ot){const ut=(0,W.b)(le.WM.get(),ot,qe.origin),_t=(0,W.p)(qe.basis1),Ct=(0,W.p)(qe.basis2),vt=(0,W.e)(qe.basis1,ut),Lt=(0,W.e)(qe.basis2,ut);return-vt-_t<0&&vt-_t<0&&-Lt-Ct<0&&Lt-Ct<0}function He(qe,ot){const ut=Ne.get();return(0,W.c)(ut.origin,qe.origin),(0,W.c)(ut.vector,ot),ut}function Ie(qe,ot,ut){const{basis1:_t,basis2:Ct,origin:vt}=qe,Lt=(0,W.g)(le.WM.get(),_t,ot.origin[0]),jt=(0,W.g)(le.WM.get(),Ct,ot.origin[1]);(0,W.a)(ut.origin,Lt,jt),(0,W.a)(ut.origin,ut.origin,vt);const $t=(0,W.g)(le.WM.get(),_t,ot.direction[0]),Wt=(0,W.g)(le.WM.get(),Ct,ot.direction[1]);return(0,W.g)(ut.vector,(0,W.a)($t,$t,Wt),2),ut}function Pe(qe,ot,ut,_t){const Ct=Fe(qe);(0,te.my)(Ct,ot.direction,ot.origin,ut),(0,te.my)((0,te.mJ)(ut),Ct,ot.origin,_t)}const Le={plane:(0,te.Ue)(),origin:(0,B.f)(0,0,0),basis1:(0,B.f)(1,0,0),basis2:(0,B.f)(0,1,0)},Me=new Z.x(te.Ue),Ne=new Z.x(X.Ue),Xe=(0,B.c)(),Ye=new Z.x(()=>re()),Je=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],rt=(0,$.c)(),tt=(0,$.c)(),et=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:se,create:re,wrap:function j(qe,ot,ut){const _t=Ye.get();return _t.origin=qe,_t.basis1=ot,_t.basis2=ut,_t.plane=(0,te.re)(0,0,0,0),J(_t),_t},copy:Y,copyWithoutVerify:function ee(qe,ot){(0,W.c)(ot.origin,qe.origin),(0,W.c)(ot.basis1,qe.basis1),(0,W.c)(ot.basis2,qe.basis2),(0,te.JG)(ot.plane,qe.plane)},fromValues:ie,updateUnboundedPlane:J,elevate:ce,setExtent:function ue(qe,ot,ut){return pe(ot,ut),ce(ut,ze(qe,qe.origin),ut),ut},fromAABoundingRect:pe,intersectRay:he,intersectRayClosestSilhouette:function me(qe,ot,ut){if(he(qe,ot,ut))return ut;const _t=ge(qe,ot,le.WM.get());return(0,W.a)(ut,ot.origin,(0,W.g)(le.WM.get(),ot.direction,(0,W.i)(ot.origin,_t)/(0,W.l)(ot.direction))),ut},closestPointOnSilhouette:ge,closestPoint:_e,projectPoint:Ee,projectPointLocal:De,distance2:be,distance:Se,distanceToSilhouette:function ye(qe,ot){let ut=Number.NEGATIVE_INFINITY;for(const _t of Je){const Ct=Ie(qe,_t,Ne.get()),vt=(0,X.Jk)(Ct,ot);vt>ut&&(ut=vt)}return Math.sqrt(ut)},extrusionContainsPoint:ve,axisAt:function xe(qe,ot,ut,_t){return function je(qe,ot,ut){switch(ot){case H.R.X:(0,W.c)(ut,qe.basis1),(0,W.n)(ut,ut);break;case H.R.Y:(0,W.c)(ut,qe.basis2),(0,W.n)(ut,ut);break;case H.R.Z:(0,W.c)(ut,Fe(qe))}return ut}(qe,ut,_t)},altitudeAt:ze,setAltitudeAt:function Ke(qe,ot,ut,_t){const Ct=ze(qe,ot),vt=(0,W.g)(Xe,Fe(qe),ut-Ct);return(0,W.a)(_t,ot,vt),_t},equals:We,transform:Ce,rotate:Be,normal:Fe,UP:Le},Symbol.toStringTag,{value:"Module"}))},39863:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>Z,a:()=>B,g:()=>R,t:()=>W});let D=1e-6;function R(){return D}const Z=Math.random,Q=Math.PI/180,$=180/Math.PI;function W(te){return te*Q}function B(te){return te*$}Object.freeze(Object.defineProperty({__proto__:null,getEpsilon:R,setEpsilon:function G(te){D=te},RANDOM:Z,toRadian:W,toDegree:B,equals:function H(te,ae){return Math.abs(te-ae)<=D*Math.max(1,Math.abs(te),Math.abs(ae))}},Symbol.toStringTag,{value:"Module"}))},11915:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>Q});var D,G,Z={exports:{}};D=Z,void 0!==(G=function(){function $(We,Ce,Be){Be=Be||2;var Fe,je,Re,He,Ie,Ge,Pe,Le=Ce&&Ce.length,Me=Le?Ce[0]*Be:We.length,Ne=W(We,0,Me,Be,!0),Xe=[];if(!Ne||Ne.next===Ne.prev)return Xe;if(Le&&(Ne=function le(We,Ce,Be,Fe){var je,Re,He,Ie=[];for(je=0,Re=Ce.length;je<Re;je++)(He=W(We,Ce[je]*Fe,je<Re-1?Ce[je+1]*Fe:We.length,Fe,!1))===He.next&&(He.steiner=!0),Ie.push(ce(He));for(Ie.sort(de),je=0;je<Ie.length;je++)Be=B(Be=re(Ie[je],Be),Be.next);return Be}(We,Ce,Ne,Be)),We.length>80*Be){Fe=Re=We[0],je=He=We[1];for(var Ye=Be;Ye<Me;Ye+=Be)(Ie=We[Ye])<Fe&&(Fe=Ie),(Ge=We[Ye+1])<je&&(je=Ge),Ie>Re&&(Re=Ie),Ge>He&&(He=Ge);Pe=0!==(Pe=Math.max(Re-Fe,He-je))?1/Pe:0}return H(Ne,Xe,Be,Fe,je,Pe),Xe}function W(We,Ce,Be,Fe,je){var Re,He;if(je===Ke(We,Ce,Be,Fe)>0)for(Re=Ce;Re<Be;Re+=Fe)He=ve(Re,We[Re],We[Re+1],He);else for(Re=Be-Fe;Re>=Ce;Re-=Fe)He=ve(Re,We[Re],We[Re+1],He);if(He&&me(He,He.next)){var Ie=He.next;xe(He),He=Ie}return He}function B(We,Ce){if(!We)return We;Ce||(Ce=We);var Be,Fe=We;do{if(Be=!1,Fe.steiner||!me(Fe,Fe.next)&&0!==he(Fe.prev,Fe,Fe.next))Fe=Fe.next;else{var je=Fe.prev;if(xe(Fe),(Fe=Ce=je)===Fe.next)break;Be=!0}}while(Be||Fe!==Ce);return Ce}function H(We,Ce,Be,Fe,je,Re,He){if(We){!He&&Re&&function ee(We,Ce,Be,Fe){var je=We;do{null===je.z&&(je.z=J(je.x,je.y,Ce,Be,Fe)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next}while(je!==We);je.prevZ.nextZ=null,je.prevZ=null,function ie(We){var Ce,Be,Fe,je,Re,He,Ie,Ge,Pe=1;do{for(Be=We,We=null,Re=null,He=0;Be;){for(He++,Fe=Be,Ie=0,Ce=0;Ce<Pe&&(Ie++,Fe=Fe.nextZ);Ce++);for(Ge=Pe;Ie>0||Ge>0&&Fe;)0!==Ie&&(0===Ge||!Fe||Be.z<=Fe.z)?(je=Be,Be=Be.nextZ,Ie--):(je=Fe,Fe=Fe.nextZ,Ge--),Re?Re.nextZ=je:We=je,je.prevZ=Re,Re=je;Be=Fe}Re.nextZ=null,Pe*=2}while(He>1)}(je)}(We,Fe,je,Re);for(var Ie,Ge,Pe=We;We.prev!==We.next;)if(Ie=We.prev,Ge=We.next,Re?te(We,Fe,je,Re):X(We))Ce.push(Ie.i/Be),Ce.push(We.i/Be),Ce.push(Ge.i/Be),xe(We),We=Ge.next,Pe=Ge.next;else if((We=Ge)===Pe){He?1===He?H(We=ae(B(We),Ce,Be),Ce,Be,Fe,je,Re,2):2===He&&oe(We,Ce,Be,Fe,je,Re):H(B(We),Ce,Be,Fe,je,Re,1);break}}}function X(We){var Ce=We.prev,Be=We,Fe=We.next;if(he(Ce,Be,Fe)>=0)return!1;for(var je=We.next.next;je!==We.prev;){if(ue(Ce.x,Ce.y,Be.x,Be.y,Fe.x,Fe.y,je.x,je.y)&&he(je.prev,je,je.next)>=0)return!1;je=je.next}return!0}function te(We,Ce,Be,Fe){var je=We.prev,Re=We,He=We.next;if(he(je,Re,He)>=0)return!1;for(var Pe=je.x>Re.x?je.x>He.x?je.x:He.x:Re.x>He.x?Re.x:He.x,Le=je.y>Re.y?je.y>He.y?je.y:He.y:Re.y>He.y?Re.y:He.y,Me=J(je.x<Re.x?je.x<He.x?je.x:He.x:Re.x<He.x?Re.x:He.x,je.y<Re.y?je.y<He.y?je.y:He.y:Re.y<He.y?Re.y:He.y,Ce,Be,Fe),Ne=J(Pe,Le,Ce,Be,Fe),Xe=We.prevZ,Ye=We.nextZ;Xe&&Xe.z>=Me&&Ye&&Ye.z<=Ne;){if(Xe!==We.prev&&Xe!==We.next&&ue(je.x,je.y,Re.x,Re.y,He.x,He.y,Xe.x,Xe.y)&&he(Xe.prev,Xe,Xe.next)>=0||(Xe=Xe.prevZ,Ye!==We.prev&&Ye!==We.next&&ue(je.x,je.y,Re.x,Re.y,He.x,He.y,Ye.x,Ye.y)&&he(Ye.prev,Ye,Ye.next)>=0))return!1;Ye=Ye.nextZ}for(;Xe&&Xe.z>=Me;){if(Xe!==We.prev&&Xe!==We.next&&ue(je.x,je.y,Re.x,Re.y,He.x,He.y,Xe.x,Xe.y)&&he(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.prevZ}for(;Ye&&Ye.z<=Ne;){if(Ye!==We.prev&&Ye!==We.next&&ue(je.x,je.y,Re.x,Re.y,He.x,He.y,Ye.x,Ye.y)&&he(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.nextZ}return!0}function ae(We,Ce,Be){var Fe=We;do{var je=Fe.prev,Re=Fe.next.next;!me(je,Re)&&ge(je,Fe,Fe.next,Re)&&be(je,Re)&&be(Re,je)&&(Ce.push(je.i/Be),Ce.push(Fe.i/Be),Ce.push(Re.i/Be),xe(Fe),xe(Fe.next),Fe=We=Re),Fe=Fe.next}while(Fe!==We);return B(Fe)}function oe(We,Ce,Be,Fe,je,Re){var He=We;do{for(var Ie=He.next.next;Ie!==He.prev;){if(He.i!==Ie.i&&pe(He,Ie)){var Ge=ye(He,Ie);return He=B(He,He.next),Ge=B(Ge,Ge.next),H(He,Ce,Be,Fe,je,Re),void H(Ge,Ce,Be,Fe,je,Re)}Ie=Ie.next}He=He.next}while(He!==We)}function de(We,Ce){return We.x-Ce.x}function se(We){if(We.next.prev===We)return We;let Ce=We;for(;;){const Be=Ce.next;if(Be.prev===Ce||Be===Ce||Be===We)break;Ce=Be}return Ce}function re(We,Ce){var Be=function j(We,Ce){var Be,Fe=Ce,je=We.x,Re=We.y,He=-1/0;do{if(Re<=Fe.y&&Re>=Fe.next.y&&Fe.next.y!==Fe.y){var Ie=Fe.x+(Re-Fe.y)*(Fe.next.x-Fe.x)/(Fe.next.y-Fe.y);if(Ie<=je&&Ie>He){if(He=Ie,Ie===je){if(Re===Fe.y)return Fe;if(Re===Fe.next.y)return Fe.next}Be=Fe.x<Fe.next.x?Fe:Fe.next}}Fe=Fe.next}while(Fe!==Ce);if(!Be)return null;if(je===He)return Be;var Ge,Pe=Be,Le=Be.x,Me=Be.y,Ne=1/0;Fe=Be;do{je>=Fe.x&&Fe.x>=Le&&je!==Fe.x&&ue(Re<Me?je:He,Re,Le,Me,Re<Me?He:je,Re,Fe.x,Fe.y)&&(Ge=Math.abs(Re-Fe.y)/(je-Fe.x),be(Fe,We)&&(Ge<Ne||Ge===Ne&&(Fe.x>Be.x||Fe.x===Be.x&&Y(Be,Fe)))&&(Be=Fe,Ne=Ge)),Fe=Fe.next}while(Fe!==Pe);return Be}(We,Ce);if(!Be)return Ce;var Fe=ye(Be,We),je=B(Be,Be.next);let Re=se(Fe);return B(Re,Re.next),je=se(je),se(Ce===Be?je:Ce)}function Y(We,Ce){return he(We.prev,We,Ce.prev)<0&&he(Ce.next,We,We.next)<0}function J(We,Ce,Be,Fe,je){return(We=1431655765&((We=858993459&((We=252645135&((We=16711935&((We=32767*(We-Be)*je)|We<<8))|We<<4))|We<<2))|We<<1))|(Ce=1431655765&((Ce=858993459&((Ce=252645135&((Ce=16711935&((Ce=32767*(Ce-Fe)*je)|Ce<<8))|Ce<<4))|Ce<<2))|Ce<<1))<<1}function ce(We){var Ce=We,Be=We;do{(Ce.x<Be.x||Ce.x===Be.x&&Ce.y<Be.y)&&(Be=Ce),Ce=Ce.next}while(Ce!==We);return Be}function ue(We,Ce,Be,Fe,je,Re,He,Ie){return(je-He)*(Ce-Ie)-(We-He)*(Re-Ie)>=0&&(We-He)*(Fe-Ie)-(Be-He)*(Ce-Ie)>=0&&(Be-He)*(Re-Ie)-(je-He)*(Fe-Ie)>=0}function pe(We,Ce){return We.next.i!==Ce.i&&We.prev.i!==Ce.i&&!function De(We,Ce){var Be=We;do{if(Be.i!==We.i&&Be.next.i!==We.i&&Be.i!==Ce.i&&Be.next.i!==Ce.i&&ge(Be,Be.next,We,Ce))return!0;Be=Be.next}while(Be!==We);return!1}(We,Ce)&&(be(We,Ce)&&be(Ce,We)&&function Se(We,Ce){var Be=We,Fe=!1,je=(We.x+Ce.x)/2,Re=(We.y+Ce.y)/2;do{Be.y>Re!=Be.next.y>Re&&Be.next.y!==Be.y&&je<(Be.next.x-Be.x)*(Re-Be.y)/(Be.next.y-Be.y)+Be.x&&(Fe=!Fe),Be=Be.next}while(Be!==We);return Fe}(We,Ce)&&(he(We.prev,We,Ce.prev)||he(We,Ce.prev,Ce))||me(We,Ce)&&he(We.prev,We,We.next)>0&&he(Ce.prev,Ce,Ce.next)>0)}function he(We,Ce,Be){return(Ce.y-We.y)*(Be.x-Ce.x)-(Ce.x-We.x)*(Be.y-Ce.y)}function me(We,Ce){return We.x===Ce.x&&We.y===Ce.y}function ge(We,Ce,Be,Fe){var je=Ee(he(We,Ce,Be)),Re=Ee(he(We,Ce,Fe)),He=Ee(he(Be,Fe,We)),Ie=Ee(he(Be,Fe,Ce));return je!==Re&&He!==Ie||!(0!==je||!_e(We,Be,Ce))||!(0!==Re||!_e(We,Fe,Ce))||!(0!==He||!_e(Be,We,Fe))||!(0!==Ie||!_e(Be,Ce,Fe))}function _e(We,Ce,Be){return Ce.x<=Math.max(We.x,Be.x)&&Ce.x>=Math.min(We.x,Be.x)&&Ce.y<=Math.max(We.y,Be.y)&&Ce.y>=Math.min(We.y,Be.y)}function Ee(We){return We>0?1:We<0?-1:0}function be(We,Ce){return he(We.prev,We,We.next)<0?he(We,Ce,We.next)>=0&&he(We,We.prev,Ce)>=0:he(We,Ce,We.prev)<0||he(We,We.next,Ce)<0}function ye(We,Ce){var Be=new ze(We.i,We.x,We.y),Fe=new ze(Ce.i,Ce.x,Ce.y),je=We.next,Re=Ce.prev;return We.next=Ce,Ce.prev=We,Be.next=je,je.prev=Be,Fe.next=Be,Be.prev=Fe,Re.next=Fe,Fe.prev=Re,Fe}function ve(We,Ce,Be,Fe){var je=new ze(We,Ce,Be);return Fe?(je.next=Fe.next,je.prev=Fe,Fe.next.prev=je,Fe.next=je):(je.prev=je,je.next=je),je}function xe(We){We.next.prev=We.prev,We.prev.next=We.next,We.prevZ&&(We.prevZ.nextZ=We.nextZ),We.nextZ&&(We.nextZ.prevZ=We.prevZ)}function ze(We,Ce,Be){this.i=We,this.x=Ce,this.y=Be,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ke(We,Ce,Be,Fe){for(var je=0,Re=Ce,He=Be-Fe;Re<Be;Re+=Fe)je+=(We[He]-We[Re])*(We[Re+1]+We[He+1]),He=Re;return je}return $.deviation=function(We,Ce,Be,Fe){var je=Ce&&Ce.length,He=Math.abs(Ke(We,0,je?Ce[0]*Be:We.length,Be));if(je)for(var Ie=0,Ge=Ce.length;Ie<Ge;Ie++)He-=Math.abs(Ke(We,Ce[Ie]*Be,Ie<Ge-1?Ce[Ie+1]*Be:We.length,Be));var Me=0;for(Ie=0;Ie<Fe.length;Ie+=3){var Ne=Fe[Ie]*Be,Xe=Fe[Ie+1]*Be,Ye=Fe[Ie+2]*Be;Me+=Math.abs((We[Ne]-We[Ye])*(We[Xe+1]-We[Ne+1])-(We[Ne]-We[Xe])*(We[Ye+1]-We[Ne+1]))}return 0===He&&0===Me?0:Math.abs((Me-He)/He)},$.flatten=function(We){for(var Ce=We[0][0].length,Be={vertices:[],holes:[],dimensions:Ce},Fe=0,je=0;je<We.length;je++){for(var Re=0;Re<We[je].length;Re++)for(var He=0;He<Ce;He++)Be.vertices.push(We[je][Re][He]);je>0&&Be.holes.push(Fe+=We[je-1].length)}return Be},$}())&&(D.exports=G);const Q=Z.exports},31478:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>oe,b:()=>te,c:()=>Q,f:()=>ae,i:()=>G,m:()=>W,r:()=>B,s:()=>H,t:()=>X});var D=v(39863);function G(pe){return pe[0]=1,pe[1]=0,pe[2]=0,pe[3]=1,pe[4]=0,pe[5]=0,pe}function Q(pe,he){const me=he[0],ge=he[1],_e=he[2],Ee=he[3],De=he[4],be=he[5];let Se=me*Ee-ge*_e;return Se?(Se=1/Se,pe[0]=Ee*Se,pe[1]=-ge*Se,pe[2]=-_e*Se,pe[3]=me*Se,pe[4]=(_e*be-Ee*De)*Se,pe[5]=(ge*De-me*be)*Se,pe):null}function W(pe,he,me){const ge=he[0],_e=he[1],Ee=he[2],De=he[3],be=he[4],Se=he[5],ye=me[0],ve=me[1],xe=me[2],ze=me[3],Ke=me[4],We=me[5];return pe[0]=ge*ye+Ee*ve,pe[1]=_e*ye+De*ve,pe[2]=ge*xe+Ee*ze,pe[3]=_e*xe+De*ze,pe[4]=ge*Ke+Ee*We+be,pe[5]=_e*Ke+De*We+Se,pe}function B(pe,he,me){const ge=he[0],_e=he[1],Ee=he[2],De=he[3],be=he[4],Se=he[5],ye=Math.sin(me),ve=Math.cos(me);return pe[0]=ge*ve+Ee*ye,pe[1]=_e*ve+De*ye,pe[2]=ge*-ye+Ee*ve,pe[3]=_e*-ye+De*ve,pe[4]=be,pe[5]=Se,pe}function H(pe,he,me){const _e=he[1],Ee=he[2],De=he[3],be=he[4],Se=he[5],ye=me[0],ve=me[1];return pe[0]=he[0]*ye,pe[1]=_e*ye,pe[2]=Ee*ve,pe[3]=De*ve,pe[4]=be,pe[5]=Se,pe}function X(pe,he,me){const ge=he[0],_e=he[1],Ee=he[2],De=he[3],be=he[4],Se=he[5],ye=me[0],ve=me[1];return pe[0]=ge,pe[1]=_e,pe[2]=Ee,pe[3]=De,pe[4]=ge*ye+Ee*ve+be,pe[5]=_e*ye+De*ve+Se,pe}function te(pe,he){const me=Math.sin(he),ge=Math.cos(he);return pe[0]=ge,pe[1]=me,pe[2]=-me,pe[3]=ge,pe[4]=0,pe[5]=0,pe}function ae(pe,he){return pe[0]=he[0],pe[1]=0,pe[2]=0,pe[3]=he[1],pe[4]=0,pe[5]=0,pe}function oe(pe,he){return pe[0]=1,pe[1]=0,pe[2]=0,pe[3]=1,pe[4]=he[0],pe[5]=he[1],pe}function re(pe,he,me){return pe[0]=he[0]-me[0],pe[1]=he[1]-me[1],pe[2]=he[2]-me[2],pe[3]=he[3]-me[3],pe[4]=he[4]-me[4],pe[5]=he[5]-me[5],pe}Object.freeze(Object.defineProperty({__proto__:null,copy:function R(pe,he){return pe[0]=he[0],pe[1]=he[1],pe[2]=he[2],pe[3]=he[3],pe[4]=he[4],pe[5]=he[5],pe},identity:G,set:function Z(pe,he,me,ge,_e,Ee,De){return pe[0]=he,pe[1]=me,pe[2]=ge,pe[3]=_e,pe[4]=Ee,pe[5]=De,pe},invert:Q,determinant:function $(pe){return pe[0]*pe[3]-pe[1]*pe[2]},multiply:W,rotate:B,scale:H,translate:X,fromRotation:te,fromScaling:ae,fromTranslation:oe,str:function le(pe){return"mat2d("+pe[0]+", "+pe[1]+", "+pe[2]+", "+pe[3]+", "+pe[4]+", "+pe[5]+")"},frob:function de(pe){return Math.sqrt(pe[0]**2+pe[1]**2+pe[2]**2+pe[3]**2+pe[4]**2+pe[5]**2+1)},add:function se(pe,he,me){return pe[0]=he[0]+me[0],pe[1]=he[1]+me[1],pe[2]=he[2]+me[2],pe[3]=he[3]+me[3],pe[4]=he[4]+me[4],pe[5]=he[5]+me[5],pe},subtract:re,multiplyScalar:function j(pe,he,me){return pe[0]=he[0]*me,pe[1]=he[1]*me,pe[2]=he[2]*me,pe[3]=he[3]*me,pe[4]=he[4]*me,pe[5]=he[5]*me,pe},multiplyScalarAndAdd:function Y(pe,he,me,ge){return pe[0]=he[0]+me[0]*ge,pe[1]=he[1]+me[1]*ge,pe[2]=he[2]+me[2]*ge,pe[3]=he[3]+me[3]*ge,pe[4]=he[4]+me[4]*ge,pe[5]=he[5]+me[5]*ge,pe},exactEquals:function ee(pe,he){return pe[0]===he[0]&&pe[1]===he[1]&&pe[2]===he[2]&&pe[3]===he[3]&&pe[4]===he[4]&&pe[5]===he[5]},equals:function ie(pe,he){const me=pe[0],ge=pe[1],_e=pe[2],Ee=pe[3],De=pe[4],be=pe[5],Se=he[0],ye=he[1],ve=he[2],xe=he[3],ze=he[4],Ke=he[5],We=(0,D.g)();return Math.abs(me-Se)<=We*Math.max(1,Math.abs(me),Math.abs(Se))&&Math.abs(ge-ye)<=We*Math.max(1,Math.abs(ge),Math.abs(ye))&&Math.abs(_e-ve)<=We*Math.max(1,Math.abs(_e),Math.abs(ve))&&Math.abs(Ee-xe)<=We*Math.max(1,Math.abs(Ee),Math.abs(xe))&&Math.abs(De-ze)<=We*Math.max(1,Math.abs(De),Math.abs(ze))&&Math.abs(be-Ke)<=We*Math.max(1,Math.abs(be),Math.abs(Ke))},mul:W,sub:re},Symbol.toStringTag,{value:"Module"}))},12225:(nt,Ae,v)=>{"use strict";function D(){const B=new Float32Array(6);return B[0]=1,B[3]=1,B}function Q(B,H,X,te){const ae=H[te],oe=H[te+1];B[te]=X[0]*ae+X[2]*oe+X[4],B[te+1]=X[1]*ae+X[3]*oe+X[5]}function $(B,H,X,te=0,ae=0,oe=2){const le=ae||H.length/oe;for(let de=te;de<le;de++)Q(B,H,X,de*oe)}v.d(Ae,{c:()=>D,t:()=>$}),Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:function R(B){const H=new Float32Array(6);return H[0]=B[0],H[1]=B[1],H[2]=B[2],H[3]=B[3],H[4]=B[4],H[5]=B[5],H},fromValues:function G(B,H,X,te,ae,oe){const le=new Float32Array(6);return le[0]=B,le[1]=H,le[2]=X,le[3]=te,le[4]=ae,le[5]=oe,le},createView:function Z(B,H){return new Float32Array(B,H,6)},transform:Q,transformMany:$},Symbol.toStringTag,{value:"Module"}))},30217:(nt,Ae,v)=>{"use strict";v.d(Ae,{b:()=>ie,c:()=>Y,d:()=>oe,e:()=>W,f:()=>R,g:()=>Q,h:()=>te,i:()=>De,m:()=>X,n:()=>ee,r:()=>ae,s:()=>Z,t:()=>$});var D=v(39863);function R(ve,xe){return ve[0]=xe[0],ve[1]=xe[1],ve[2]=xe[2],ve[3]=xe[4],ve[4]=xe[5],ve[5]=xe[6],ve[6]=xe[8],ve[7]=xe[9],ve[8]=xe[10],ve}function Z(ve,xe,ze,Ke,We,Ce,Be,Fe,je,Re){return ve[0]=xe,ve[1]=ze,ve[2]=Ke,ve[3]=We,ve[4]=Ce,ve[5]=Be,ve[6]=Fe,ve[7]=je,ve[8]=Re,ve}function Q(ve){return ve[0]=1,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=1,ve[5]=0,ve[6]=0,ve[7]=0,ve[8]=1,ve}function $(ve,xe){if(ve===xe){const ze=xe[1],Ke=xe[2],We=xe[5];ve[1]=xe[3],ve[2]=xe[6],ve[3]=ze,ve[5]=xe[7],ve[6]=Ke,ve[7]=We}else ve[0]=xe[0],ve[1]=xe[3],ve[2]=xe[6],ve[3]=xe[1],ve[4]=xe[4],ve[5]=xe[7],ve[6]=xe[2],ve[7]=xe[5],ve[8]=xe[8];return ve}function W(ve,xe){const ze=xe[0],Ke=xe[1],We=xe[2],Ce=xe[3],Be=xe[4],Fe=xe[5],je=xe[6],Re=xe[7],He=xe[8],Ie=He*Be-Fe*Re,Ge=-He*Ce+Fe*je,Pe=Re*Ce-Be*je;let Le=ze*Ie+Ke*Ge+We*Pe;return Le?(Le=1/Le,ve[0]=Ie*Le,ve[1]=(-He*Ke+We*Re)*Le,ve[2]=(Fe*Ke-We*Be)*Le,ve[3]=Ge*Le,ve[4]=(He*ze-We*je)*Le,ve[5]=(-Fe*ze+We*Ce)*Le,ve[6]=Pe*Le,ve[7]=(-Re*ze+Ke*je)*Le,ve[8]=(Be*ze-Ke*Ce)*Le,ve):null}function X(ve,xe,ze){const Ke=xe[0],We=xe[1],Ce=xe[2],Be=xe[3],Fe=xe[4],je=xe[5],Re=xe[6],He=xe[7],Ie=xe[8],Ge=ze[0],Pe=ze[1],Le=ze[2],Me=ze[3],Ne=ze[4],Xe=ze[5],Ye=ze[6],Je=ze[7],rt=ze[8];return ve[0]=Ge*Ke+Pe*Be+Le*Re,ve[1]=Ge*We+Pe*Fe+Le*He,ve[2]=Ge*Ce+Pe*je+Le*Ie,ve[3]=Me*Ke+Ne*Be+Xe*Re,ve[4]=Me*We+Ne*Fe+Xe*He,ve[5]=Me*Ce+Ne*je+Xe*Ie,ve[6]=Ye*Ke+Je*Be+rt*Re,ve[7]=Ye*We+Je*Fe+rt*He,ve[8]=Ye*Ce+Je*je+rt*Ie,ve}function te(ve,xe,ze){const Ke=xe[0],We=xe[1],Ce=xe[2],Be=xe[3],Fe=xe[4],je=xe[5],Re=xe[6],He=xe[7],Ie=xe[8],Ge=ze[0],Pe=ze[1];return ve[0]=Ke,ve[1]=We,ve[2]=Ce,ve[3]=Be,ve[4]=Fe,ve[5]=je,ve[6]=Ge*Ke+Pe*Be+Re,ve[7]=Ge*We+Pe*Fe+He,ve[8]=Ge*Ce+Pe*je+Ie,ve}function ae(ve,xe,ze){const Ke=xe[0],We=xe[1],Ce=xe[2],Be=xe[3],Fe=xe[4],je=xe[5],Re=xe[6],He=xe[7],Ie=xe[8],Ge=Math.sin(ze),Pe=Math.cos(ze);return ve[0]=Pe*Ke+Ge*Be,ve[1]=Pe*We+Ge*Fe,ve[2]=Pe*Ce+Ge*je,ve[3]=Pe*Be-Ge*Ke,ve[4]=Pe*Fe-Ge*We,ve[5]=Pe*je-Ge*Ce,ve[6]=Re,ve[7]=He,ve[8]=Ie,ve}function oe(ve,xe,ze){const Ke=ze[0],We=ze[1],Ce=ze[2];return ve[0]=Ke*xe[0],ve[1]=Ke*xe[1],ve[2]=Ke*xe[2],ve[3]=We*xe[3],ve[4]=We*xe[4],ve[5]=We*xe[5],ve[6]=Ce*xe[6],ve[7]=Ce*xe[7],ve[8]=Ce*xe[8],ve}function Y(ve,xe){const ze=xe[0],Ke=xe[1],We=xe[2],Ce=xe[3],Be=ze+ze,Fe=Ke+Ke,je=We+We,Re=ze*Be,He=Ke*Be,Ie=Ke*Fe,Ge=We*Be,Pe=We*Fe,Le=We*je,Me=Ce*Be,Ne=Ce*Fe,Xe=Ce*je;return ve[0]=1-Ie-Le,ve[3]=He-Xe,ve[6]=Ge+Ne,ve[1]=He+Xe,ve[4]=1-Re-Le,ve[7]=Pe-Me,ve[2]=Ge-Ne,ve[5]=Pe+Me,ve[8]=1-Re-Ie,ve}function ee(ve,xe){const ze=xe[0],Ke=xe[1],We=xe[2],Ce=xe[4],Be=xe[5],Fe=xe[6],je=xe[8],Re=xe[9],He=xe[10],Ie=He*Be-Fe*Re,Ge=-He*Ce+Fe*je,Pe=Re*Ce-Be*je,Le=ze*Ie+Ke*Ge+We*Pe;if(!Le)return null;const Me=1/Le;return ve[0]=Ie*Me,ve[1]=(-He*Ke+We*Re)*Me,ve[2]=(Fe*Ke-We*Be)*Me,ve[3]=Ge*Me,ve[4]=(He*ze-We*je)*Me,ve[5]=(-Fe*ze+We*Ce)*Me,ve[6]=Pe*Me,ve[7]=(-Re*ze+Ke*je)*Me,ve[8]=(Be*ze-Ke*Ce)*Me,ve}function ie(ve,xe){const ze=xe[0],Ke=xe[1],We=xe[2],Ce=xe[3],Be=xe[4],Fe=xe[5],je=xe[6],Re=xe[7],He=xe[8],Ie=xe[9],Ge=xe[10],Pe=xe[11],Le=xe[12],Me=xe[13],Ne=xe[14],Xe=xe[15],Ye=ze*Fe-Ke*Be,Je=ze*je-We*Be,rt=ze*Re-Ce*Be,tt=Ke*je-We*Fe,et=Ke*Re-Ce*Fe,qe=We*Re-Ce*je,ot=He*Me-Ie*Le,ut=He*Ne-Ge*Le,_t=He*Xe-Pe*Le,Ct=Ie*Ne-Ge*Me,vt=Ie*Xe-Pe*Me,Lt=Ge*Xe-Pe*Ne;let jt=Ye*Lt-Je*vt+rt*Ct+tt*_t-et*ut+qe*ot;return jt?(jt=1/jt,ve[0]=(Fe*Lt-je*vt+Re*Ct)*jt,ve[1]=(je*_t-Be*Lt-Re*ut)*jt,ve[2]=(Be*vt-Fe*_t+Re*ot)*jt,ve[3]=(We*vt-Ke*Lt-Ce*Ct)*jt,ve[4]=(ze*Lt-We*_t+Ce*ut)*jt,ve[5]=(Ke*_t-ze*vt-Ce*ot)*jt,ve[6]=(Me*qe-Ne*et+Xe*tt)*jt,ve[7]=(Ne*rt-Le*qe-Xe*Je)*jt,ve[8]=(Le*et-Me*rt+Xe*Ye)*jt,ve):null}function he(ve,xe,ze){return ve[0]=xe[0]-ze[0],ve[1]=xe[1]-ze[1],ve[2]=xe[2]-ze[2],ve[3]=xe[3]-ze[3],ve[4]=xe[4]-ze[4],ve[5]=xe[5]-ze[5],ve[6]=xe[6]-ze[6],ve[7]=xe[7]-ze[7],ve[8]=xe[8]-ze[8],ve}function De(ve){const xe=(0,D.g)(),ze=ve[0],Ke=ve[1],We=ve[2],Ce=ve[3],Be=ve[4],Fe=ve[5],je=ve[6],Re=ve[7],He=ve[8];return Math.abs(1-(ze*ze+Ce*Ce+je*je))<=xe&&Math.abs(1-(Ke*Ke+Be*Be+Re*Re))<=xe&&Math.abs(1-(We*We+Fe*Fe+He*He))<=xe}Object.freeze(Object.defineProperty({__proto__:null,fromMat4:R,copy:function G(ve,xe){return ve[0]=xe[0],ve[1]=xe[1],ve[2]=xe[2],ve[3]=xe[3],ve[4]=xe[4],ve[5]=xe[5],ve[6]=xe[6],ve[7]=xe[7],ve[8]=xe[8],ve},set:Z,identity:Q,transpose:$,invert:W,adjoint:function B(ve,xe){const ze=xe[0],Ke=xe[1],We=xe[2],Ce=xe[3],Be=xe[4],Fe=xe[5],je=xe[6],Re=xe[7],He=xe[8];return ve[0]=Be*He-Fe*Re,ve[1]=We*Re-Ke*He,ve[2]=Ke*Fe-We*Be,ve[3]=Fe*je-Ce*He,ve[4]=ze*He-We*je,ve[5]=We*Ce-ze*Fe,ve[6]=Ce*Re-Be*je,ve[7]=Ke*je-ze*Re,ve[8]=ze*Be-Ke*Ce,ve},determinant:function H(ve){const We=ve[3],Ce=ve[4],Be=ve[5],Fe=ve[6],je=ve[7],Re=ve[8];return ve[0]*(Re*Ce-Be*je)+ve[1]*(-Re*We+Be*Fe)+ve[2]*(je*We-Ce*Fe)},multiply:X,translate:te,rotate:ae,scale:oe,scaleByVec2:function le(ve,xe,ze){const Ke=ze[0],We=ze[1];return ve[0]=Ke*xe[0],ve[1]=Ke*xe[1],ve[2]=Ke*xe[2],ve[3]=We*xe[3],ve[4]=We*xe[4],ve[5]=We*xe[5],ve},fromTranslation:function de(ve,xe){return ve[0]=1,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=1,ve[5]=0,ve[6]=xe[0],ve[7]=xe[1],ve[8]=1,ve},fromRotation:function se(ve,xe){const ze=Math.sin(xe),Ke=Math.cos(xe);return ve[0]=Ke,ve[1]=ze,ve[2]=0,ve[3]=-ze,ve[4]=Ke,ve[5]=0,ve[6]=0,ve[7]=0,ve[8]=1,ve},fromScaling:function re(ve,xe){return ve[0]=xe[0],ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=xe[1],ve[5]=0,ve[6]=0,ve[7]=0,ve[8]=1,ve},fromMat2d:function j(ve,xe){return ve[0]=xe[0],ve[1]=xe[1],ve[2]=0,ve[3]=xe[2],ve[4]=xe[3],ve[5]=0,ve[6]=xe[4],ve[7]=xe[5],ve[8]=1,ve},fromQuat:Y,normalFromMat4Legacy:ee,normalFromMat4:ie,projection:function J(ve,xe,ze){return ve[0]=2/xe,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=-2/ze,ve[5]=0,ve[6]=-1,ve[7]=1,ve[8]=1,ve},str:function ce(ve){return"mat3("+ve[0]+", "+ve[1]+", "+ve[2]+", "+ve[3]+", "+ve[4]+", "+ve[5]+", "+ve[6]+", "+ve[7]+", "+ve[8]+")"},frob:function ue(ve){return Math.sqrt(ve[0]**2+ve[1]**2+ve[2]**2+ve[3]**2+ve[4]**2+ve[5]**2+ve[6]**2+ve[7]**2+ve[8]**2)},add:function pe(ve,xe,ze){return ve[0]=xe[0]+ze[0],ve[1]=xe[1]+ze[1],ve[2]=xe[2]+ze[2],ve[3]=xe[3]+ze[3],ve[4]=xe[4]+ze[4],ve[5]=xe[5]+ze[5],ve[6]=xe[6]+ze[6],ve[7]=xe[7]+ze[7],ve[8]=xe[8]+ze[8],ve},subtract:he,multiplyScalar:function me(ve,xe,ze){return ve[0]=xe[0]*ze,ve[1]=xe[1]*ze,ve[2]=xe[2]*ze,ve[3]=xe[3]*ze,ve[4]=xe[4]*ze,ve[5]=xe[5]*ze,ve[6]=xe[6]*ze,ve[7]=xe[7]*ze,ve[8]=xe[8]*ze,ve},multiplyScalarAndAdd:function ge(ve,xe,ze,Ke){return ve[0]=xe[0]+ze[0]*Ke,ve[1]=xe[1]+ze[1]*Ke,ve[2]=xe[2]+ze[2]*Ke,ve[3]=xe[3]+ze[3]*Ke,ve[4]=xe[4]+ze[4]*Ke,ve[5]=xe[5]+ze[5]*Ke,ve[6]=xe[6]+ze[6]*Ke,ve[7]=xe[7]+ze[7]*Ke,ve[8]=xe[8]+ze[8]*Ke,ve},exactEquals:function _e(ve,xe){return ve[0]===xe[0]&&ve[1]===xe[1]&&ve[2]===xe[2]&&ve[3]===xe[3]&&ve[4]===xe[4]&&ve[5]===xe[5]&&ve[6]===xe[6]&&ve[7]===xe[7]&&ve[8]===xe[8]},equals:function Ee(ve,xe){const ze=ve[0],Ke=ve[1],We=ve[2],Ce=ve[3],Be=ve[4],Fe=ve[5],je=ve[6],Re=ve[7],He=ve[8],Ie=xe[0],Ge=xe[1],Pe=xe[2],Le=xe[3],Me=xe[4],Ne=xe[5],Xe=xe[6],Ye=xe[7],Je=xe[8],rt=(0,D.g)();return Math.abs(ze-Ie)<=rt*Math.max(1,Math.abs(ze),Math.abs(Ie))&&Math.abs(Ke-Ge)<=rt*Math.max(1,Math.abs(Ke),Math.abs(Ge))&&Math.abs(We-Pe)<=rt*Math.max(1,Math.abs(We),Math.abs(Pe))&&Math.abs(Ce-Le)<=rt*Math.max(1,Math.abs(Ce),Math.abs(Le))&&Math.abs(Be-Me)<=rt*Math.max(1,Math.abs(Be),Math.abs(Me))&&Math.abs(Fe-Ne)<=rt*Math.max(1,Math.abs(Fe),Math.abs(Ne))&&Math.abs(je-Xe)<=rt*Math.max(1,Math.abs(je),Math.abs(Xe))&&Math.abs(Re-Ye)<=rt*Math.max(1,Math.abs(Re),Math.abs(Ye))&&Math.abs(He-Je)<=rt*Math.max(1,Math.abs(He),Math.abs(Je))},isOrthoNormal:De,mul:X,sub:he},Symbol.toStringTag,{value:"Module"}))},49966:(nt,Ae,v)=>{"use strict";function D(){const $=new Float32Array(9);return $[0]=1,$[4]=1,$[8]=1,$}function R($){const W=new Float32Array(9);return W[0]=$[0],W[1]=$[1],W[2]=$[2],W[3]=$[3],W[4]=$[4],W[5]=$[5],W[6]=$[6],W[7]=$[7],W[8]=$[8],W}function G($,W,B,H,X,te,ae,oe,le){const de=new Float32Array(9);return de[0]=$,de[1]=W,de[2]=B,de[3]=H,de[4]=X,de[5]=te,de[6]=ae,de[7]=oe,de[8]=le,de}v.d(Ae,{a:()=>R,c:()=>D,f:()=>G}),Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,createView:function Z($,W){return new Float32Array($,W,9)}},Symbol.toStringTag,{value:"Module"}))},550:(nt,Ae,v)=>{"use strict";function D(){return[1,0,0,0,1,0,0,0,1]}function Z($,W){return new Float64Array($,W,9)}v.d(Ae,{a:()=>Z,c:()=>D}),Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:function R($){return[$[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],$[8]]},fromValues:function G($,W,B,H,X,te,ae,oe,le){return[$,W,B,H,X,te,ae,oe,le]},createView:Z},Symbol.toStringTag,{value:"Module"}))},28347:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>he,C:()=>j,D:()=>De,a:()=>W,b:()=>J,c:()=>G,d:()=>Y,e:()=>oe,f:()=>re,g:()=>_e,h:()=>He,i:()=>Q,j:()=>Re,k:()=>ae,l:()=>me,m:()=>X,n:()=>de,o:()=>se,p:()=>be,q:()=>xe,r:()=>le,s:()=>Z,t:()=>$,u:()=>ze,v:()=>te,w:()=>ve,x:()=>Ie,y:()=>ee});var D=v(28093),R=v(39863);function G(Me,Ne){return Me[0]=Ne[0],Me[1]=Ne[1],Me[2]=Ne[2],Me[3]=Ne[3],Me[4]=Ne[4],Me[5]=Ne[5],Me[6]=Ne[6],Me[7]=Ne[7],Me[8]=Ne[8],Me[9]=Ne[9],Me[10]=Ne[10],Me[11]=Ne[11],Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15],Me}function Z(Me,Ne,Xe,Ye,Je,rt,tt,et,qe,ot,ut,_t,Ct,vt,Lt,jt,$t){return Me[0]=Ne,Me[1]=Xe,Me[2]=Ye,Me[3]=Je,Me[4]=rt,Me[5]=tt,Me[6]=et,Me[7]=qe,Me[8]=ot,Me[9]=ut,Me[10]=_t,Me[11]=Ct,Me[12]=vt,Me[13]=Lt,Me[14]=jt,Me[15]=$t,Me}function Q(Me){return Me[0]=1,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=1,Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[10]=1,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me}function $(Me,Ne){if(Me===Ne){const Xe=Ne[1],Ye=Ne[2],Je=Ne[3],rt=Ne[6],tt=Ne[7],et=Ne[11];Me[1]=Ne[4],Me[2]=Ne[8],Me[3]=Ne[12],Me[4]=Xe,Me[6]=Ne[9],Me[7]=Ne[13],Me[8]=Ye,Me[9]=rt,Me[11]=Ne[14],Me[12]=Je,Me[13]=tt,Me[14]=et}else Me[0]=Ne[0],Me[1]=Ne[4],Me[2]=Ne[8],Me[3]=Ne[12],Me[4]=Ne[1],Me[5]=Ne[5],Me[6]=Ne[9],Me[7]=Ne[13],Me[8]=Ne[2],Me[9]=Ne[6],Me[10]=Ne[10],Me[11]=Ne[14],Me[12]=Ne[3],Me[13]=Ne[7],Me[14]=Ne[11],Me[15]=Ne[15];return Me}function W(Me,Ne){const Xe=Ne[0],Ye=Ne[1],Je=Ne[2],rt=Ne[3],tt=Ne[4],et=Ne[5],qe=Ne[6],ot=Ne[7],ut=Ne[8],_t=Ne[9],Ct=Ne[10],vt=Ne[11],Lt=Ne[12],jt=Ne[13],$t=Ne[14],Wt=Ne[15],pr=Xe*et-Ye*tt,gr=Xe*qe-Je*tt,ar=Xe*ot-rt*tt,Fr=Ye*qe-Je*et,mr=Ye*ot-rt*et,wt=Je*ot-rt*qe,or=ut*jt-_t*Lt,sr=ut*$t-Ct*Lt,rr=ut*Wt-vt*Lt,Et=_t*$t-Ct*jt,St=_t*Wt-vt*jt,Ft=Ct*Wt-vt*$t;let zt=pr*Ft-gr*St+ar*Et+Fr*rr-mr*sr+wt*or;return zt?(zt=1/zt,Me[0]=(et*Ft-qe*St+ot*Et)*zt,Me[1]=(Je*St-Ye*Ft-rt*Et)*zt,Me[2]=(jt*wt-$t*mr+Wt*Fr)*zt,Me[3]=(Ct*mr-_t*wt-vt*Fr)*zt,Me[4]=(qe*rr-tt*Ft-ot*sr)*zt,Me[5]=(Xe*Ft-Je*rr+rt*sr)*zt,Me[6]=($t*ar-Lt*wt-Wt*gr)*zt,Me[7]=(ut*wt-Ct*ar+vt*gr)*zt,Me[8]=(tt*St-et*rr+ot*or)*zt,Me[9]=(Ye*rr-Xe*St-rt*or)*zt,Me[10]=(Lt*mr-jt*ar+Wt*pr)*zt,Me[11]=(_t*ar-ut*mr-vt*pr)*zt,Me[12]=(et*sr-tt*Et-qe*or)*zt,Me[13]=(Xe*Et-Ye*sr+Je*or)*zt,Me[14]=(jt*gr-Lt*Fr-$t*pr)*zt,Me[15]=(ut*Fr-_t*gr+Ct*pr)*zt,Me):null}function X(Me,Ne,Xe){const Ye=Ne[0],Je=Ne[1],rt=Ne[2],tt=Ne[3],et=Ne[4],qe=Ne[5],ot=Ne[6],ut=Ne[7],_t=Ne[8],Ct=Ne[9],vt=Ne[10],Lt=Ne[11],jt=Ne[12],$t=Ne[13],Wt=Ne[14],pr=Ne[15];let gr=Xe[0],ar=Xe[1],Fr=Xe[2],mr=Xe[3];return Me[0]=gr*Ye+ar*et+Fr*_t+mr*jt,Me[1]=gr*Je+ar*qe+Fr*Ct+mr*$t,Me[2]=gr*rt+ar*ot+Fr*vt+mr*Wt,Me[3]=gr*tt+ar*ut+Fr*Lt+mr*pr,gr=Xe[4],ar=Xe[5],Fr=Xe[6],mr=Xe[7],Me[4]=gr*Ye+ar*et+Fr*_t+mr*jt,Me[5]=gr*Je+ar*qe+Fr*Ct+mr*$t,Me[6]=gr*rt+ar*ot+Fr*vt+mr*Wt,Me[7]=gr*tt+ar*ut+Fr*Lt+mr*pr,gr=Xe[8],ar=Xe[9],Fr=Xe[10],mr=Xe[11],Me[8]=gr*Ye+ar*et+Fr*_t+mr*jt,Me[9]=gr*Je+ar*qe+Fr*Ct+mr*$t,Me[10]=gr*rt+ar*ot+Fr*vt+mr*Wt,Me[11]=gr*tt+ar*ut+Fr*Lt+mr*pr,gr=Xe[12],ar=Xe[13],Fr=Xe[14],mr=Xe[15],Me[12]=gr*Ye+ar*et+Fr*_t+mr*jt,Me[13]=gr*Je+ar*qe+Fr*Ct+mr*$t,Me[14]=gr*rt+ar*ot+Fr*vt+mr*Wt,Me[15]=gr*tt+ar*ut+Fr*Lt+mr*pr,Me}function te(Me,Ne,Xe){const Ye=Xe[0],Je=Xe[1],rt=Xe[2];if(Ne===Me)Me[12]=Ne[0]*Ye+Ne[4]*Je+Ne[8]*rt+Ne[12],Me[13]=Ne[1]*Ye+Ne[5]*Je+Ne[9]*rt+Ne[13],Me[14]=Ne[2]*Ye+Ne[6]*Je+Ne[10]*rt+Ne[14],Me[15]=Ne[3]*Ye+Ne[7]*Je+Ne[11]*rt+Ne[15];else{const tt=Ne[0],et=Ne[1],qe=Ne[2],ot=Ne[3],ut=Ne[4],_t=Ne[5],Ct=Ne[6],vt=Ne[7],Lt=Ne[8],jt=Ne[9],$t=Ne[10],Wt=Ne[11];Me[0]=tt,Me[1]=et,Me[2]=qe,Me[3]=ot,Me[4]=ut,Me[5]=_t,Me[6]=Ct,Me[7]=vt,Me[8]=Lt,Me[9]=jt,Me[10]=$t,Me[11]=Wt,Me[12]=tt*Ye+ut*Je+Lt*rt+Ne[12],Me[13]=et*Ye+_t*Je+jt*rt+Ne[13],Me[14]=qe*Ye+Ct*Je+$t*rt+Ne[14],Me[15]=ot*Ye+vt*Je+Wt*rt+Ne[15]}return Me}function ae(Me,Ne,Xe){const Ye=Xe[0],Je=Xe[1],rt=Xe[2];return Me[0]=Ne[0]*Ye,Me[1]=Ne[1]*Ye,Me[2]=Ne[2]*Ye,Me[3]=Ne[3]*Ye,Me[4]=Ne[4]*Je,Me[5]=Ne[5]*Je,Me[6]=Ne[6]*Je,Me[7]=Ne[7]*Je,Me[8]=Ne[8]*rt,Me[9]=Ne[9]*rt,Me[10]=Ne[10]*rt,Me[11]=Ne[11]*rt,Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15],Me}function oe(Me,Ne,Xe,Ye){let Je,rt,tt,et,qe,ot,ut,_t,Ct,vt,Lt,jt,$t,Wt,pr,gr,ar,Fr,mr,wt,or,sr,rr,Et,St=Ye[0],Ft=Ye[1],zt=Ye[2],dr=Math.sqrt(St*St+Ft*Ft+zt*zt);return dr<(0,R.g)()?null:(dr=1/dr,St*=dr,Ft*=dr,zt*=dr,Je=Math.sin(Xe),rt=Math.cos(Xe),tt=1-rt,et=Ne[0],qe=Ne[1],ot=Ne[2],ut=Ne[3],_t=Ne[4],Ct=Ne[5],vt=Ne[6],Lt=Ne[7],jt=Ne[8],$t=Ne[9],Wt=Ne[10],pr=Ne[11],gr=St*St*tt+rt,ar=Ft*St*tt+zt*Je,Fr=zt*St*tt-Ft*Je,mr=St*Ft*tt-zt*Je,wt=Ft*Ft*tt+rt,or=zt*Ft*tt+St*Je,sr=St*zt*tt+Ft*Je,rr=Ft*zt*tt-St*Je,Et=zt*zt*tt+rt,Me[0]=et*gr+_t*ar+jt*Fr,Me[1]=qe*gr+Ct*ar+$t*Fr,Me[2]=ot*gr+vt*ar+Wt*Fr,Me[3]=ut*gr+Lt*ar+pr*Fr,Me[4]=et*mr+_t*wt+jt*or,Me[5]=qe*mr+Ct*wt+$t*or,Me[6]=ot*mr+vt*wt+Wt*or,Me[7]=ut*mr+Lt*wt+pr*or,Me[8]=et*sr+_t*rr+jt*Et,Me[9]=qe*sr+Ct*rr+$t*Et,Me[10]=ot*sr+vt*rr+Wt*Et,Me[11]=ut*sr+Lt*rr+pr*Et,Ne!==Me&&(Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15]),Me)}function le(Me,Ne,Xe){const Ye=Math.sin(Xe),Je=Math.cos(Xe),rt=Ne[4],tt=Ne[5],et=Ne[6],qe=Ne[7],ot=Ne[8],ut=Ne[9],_t=Ne[10],Ct=Ne[11];return Ne!==Me&&(Me[0]=Ne[0],Me[1]=Ne[1],Me[2]=Ne[2],Me[3]=Ne[3],Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15]),Me[4]=rt*Je+ot*Ye,Me[5]=tt*Je+ut*Ye,Me[6]=et*Je+_t*Ye,Me[7]=qe*Je+Ct*Ye,Me[8]=ot*Je-rt*Ye,Me[9]=ut*Je-tt*Ye,Me[10]=_t*Je-et*Ye,Me[11]=Ct*Je-qe*Ye,Me}function de(Me,Ne,Xe){const Ye=Math.sin(Xe),Je=Math.cos(Xe),rt=Ne[0],tt=Ne[1],et=Ne[2],qe=Ne[3],ot=Ne[8],ut=Ne[9],_t=Ne[10],Ct=Ne[11];return Ne!==Me&&(Me[4]=Ne[4],Me[5]=Ne[5],Me[6]=Ne[6],Me[7]=Ne[7],Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15]),Me[0]=rt*Je-ot*Ye,Me[1]=tt*Je-ut*Ye,Me[2]=et*Je-_t*Ye,Me[3]=qe*Je-Ct*Ye,Me[8]=rt*Ye+ot*Je,Me[9]=tt*Ye+ut*Je,Me[10]=et*Ye+_t*Je,Me[11]=qe*Ye+Ct*Je,Me}function se(Me,Ne,Xe){const Ye=Math.sin(Xe),Je=Math.cos(Xe),rt=Ne[0],tt=Ne[1],et=Ne[2],qe=Ne[3],ot=Ne[4],ut=Ne[5],_t=Ne[6],Ct=Ne[7];return Ne!==Me&&(Me[8]=Ne[8],Me[9]=Ne[9],Me[10]=Ne[10],Me[11]=Ne[11],Me[12]=Ne[12],Me[13]=Ne[13],Me[14]=Ne[14],Me[15]=Ne[15]),Me[0]=rt*Je+ot*Ye,Me[1]=tt*Je+ut*Ye,Me[2]=et*Je+_t*Ye,Me[3]=qe*Je+Ct*Ye,Me[4]=ot*Je-rt*Ye,Me[5]=ut*Je-tt*Ye,Me[6]=_t*Je-et*Ye,Me[7]=Ct*Je-qe*Ye,Me}function re(Me,Ne){return Me[0]=1,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=1,Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[10]=1,Me[11]=0,Me[12]=Ne[0],Me[13]=Ne[1],Me[14]=Ne[2],Me[15]=1,Me}function j(Me,Ne){return Me[0]=Ne[0],Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=Ne[1],Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[10]=Ne[2],Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me}function Y(Me,Ne,Xe){if(0===Ne)return Q(Me);let Ye,Je,rt,tt=Xe[0],et=Xe[1],qe=Xe[2],ot=Math.sqrt(tt*tt+et*et+qe*qe);return ot<(0,R.g)()?null:(ot=1/ot,tt*=ot,et*=ot,qe*=ot,Ye=Math.sin(Ne),Je=Math.cos(Ne),rt=1-Je,Me[0]=tt*tt*rt+Je,Me[1]=et*tt*rt+qe*Ye,Me[2]=qe*tt*rt-et*Ye,Me[3]=0,Me[4]=tt*et*rt-qe*Ye,Me[5]=et*et*rt+Je,Me[6]=qe*et*rt+tt*Ye,Me[7]=0,Me[8]=tt*qe*rt+et*Ye,Me[9]=et*qe*rt-tt*Ye,Me[10]=qe*qe*rt+Je,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me)}function ee(Me,Ne){const Xe=Math.sin(Ne),Ye=Math.cos(Ne);return Me[0]=1,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=Ye,Me[6]=Xe,Me[7]=0,Me[8]=0,Me[9]=-Xe,Me[10]=Ye,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me}function J(Me,Ne){const Xe=Math.sin(Ne),Ye=Math.cos(Ne);return Me[0]=Ye,Me[1]=Xe,Me[2]=0,Me[3]=0,Me[4]=-Xe,Me[5]=Ye,Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[10]=1,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me}function ce(Me,Ne,Xe){const Ye=Ne[0],Je=Ne[1],rt=Ne[2],tt=Ne[3],et=Ye+Ye,qe=Je+Je,ot=rt+rt,ut=Ye*et,_t=Ye*qe,Ct=Ye*ot,vt=Je*qe,Lt=Je*ot,jt=rt*ot,$t=tt*et,Wt=tt*qe,pr=tt*ot;return Me[0]=1-(vt+jt),Me[1]=_t+pr,Me[2]=Ct-Wt,Me[3]=0,Me[4]=_t-pr,Me[5]=1-(ut+jt),Me[6]=Lt+$t,Me[7]=0,Me[8]=Ct+Wt,Me[9]=Lt-$t,Me[10]=1-(ut+vt),Me[11]=0,Me[12]=Xe[0],Me[13]=Xe[1],Me[14]=Xe[2],Me[15]=1,Me}const pe=(0,D.c)();function he(Me,Ne){return Me[0]=Ne[12],Me[1]=Ne[13],Me[2]=Ne[14],Me}function me(Me,Ne){const Xe=Ne[0],Ye=Ne[1],Je=Ne[2],rt=Ne[4],tt=Ne[5],et=Ne[6],qe=Ne[8],ot=Ne[9],ut=Ne[10];return Me[0]=Math.sqrt(Xe*Xe+Ye*Ye+Je*Je),Me[1]=Math.sqrt(rt*rt+tt*tt+et*et),Me[2]=Math.sqrt(qe*qe+ot*ot+ut*ut),Me}function _e(Me,Ne,Xe,Ye){const Je=Ne[0],rt=Ne[1],tt=Ne[2],et=Ne[3],qe=Je+Je,ot=rt+rt,ut=tt+tt,_t=Je*qe,Ct=Je*ot,vt=Je*ut,Lt=rt*ot,jt=rt*ut,$t=tt*ut,Wt=et*qe,pr=et*ot,gr=et*ut,ar=Ye[0],Fr=Ye[1],mr=Ye[2];return Me[0]=(1-(Lt+$t))*ar,Me[1]=(Ct+gr)*ar,Me[2]=(vt-pr)*ar,Me[3]=0,Me[4]=(Ct-gr)*Fr,Me[5]=(1-(_t+$t))*Fr,Me[6]=(jt+Wt)*Fr,Me[7]=0,Me[8]=(vt+pr)*mr,Me[9]=(jt-Wt)*mr,Me[10]=(1-(_t+Lt))*mr,Me[11]=0,Me[12]=Xe[0],Me[13]=Xe[1],Me[14]=Xe[2],Me[15]=1,Me}function De(Me,Ne){const Xe=Ne[0],Ye=Ne[1],Je=Ne[2],rt=Ne[3],tt=Xe+Xe,et=Ye+Ye,qe=Je+Je,ot=Xe*tt,ut=Ye*tt,_t=Ye*et,Ct=Je*tt,vt=Je*et,Lt=Je*qe,jt=rt*tt,$t=rt*et,Wt=rt*qe;return Me[0]=1-_t-Lt,Me[1]=ut+Wt,Me[2]=Ct-$t,Me[3]=0,Me[4]=ut-Wt,Me[5]=1-ot-Lt,Me[6]=vt+jt,Me[7]=0,Me[8]=Ct+$t,Me[9]=vt-jt,Me[10]=1-ot-_t,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me}function be(Me,Ne,Xe,Ye,Je,rt,tt){const et=1/(Xe-Ne),qe=1/(Je-Ye),ot=1/(rt-tt);return Me[0]=2*rt*et,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=2*rt*qe,Me[6]=0,Me[7]=0,Me[8]=(Xe+Ne)*et,Me[9]=(Je+Ye)*qe,Me[10]=(tt+rt)*ot,Me[11]=-1,Me[12]=0,Me[13]=0,Me[14]=tt*rt*2*ot,Me[15]=0,Me}function ve(Me,Ne,Xe,Ye,Je,rt,tt){const et=1/(Ne-Xe),qe=1/(Ye-Je),ot=1/(rt-tt);return Me[0]=-2*et,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=-2*qe,Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[10]=2*ot,Me[11]=0,Me[12]=(Ne+Xe)*et,Me[13]=(Je+Ye)*qe,Me[14]=(tt+rt)*ot,Me[15]=1,Me}function xe(Me,Ne,Xe,Ye){let Je,rt,tt,et,qe,ot,ut,_t,Ct,vt;const Lt=Ne[0],jt=Ne[1],$t=Ne[2],Wt=Ye[0],pr=Ye[1],gr=Ye[2],ar=Xe[0],Fr=Xe[1],mr=Xe[2],wt=(0,R.g)();return Math.abs(Lt-ar)<wt&&Math.abs(jt-Fr)<wt&&Math.abs($t-mr)<wt?Q(Me):(ut=Lt-ar,_t=jt-Fr,Ct=$t-mr,vt=1/Math.sqrt(ut*ut+_t*_t+Ct*Ct),ut*=vt,_t*=vt,Ct*=vt,Je=pr*Ct-gr*_t,rt=gr*ut-Wt*Ct,tt=Wt*_t-pr*ut,vt=Math.sqrt(Je*Je+rt*rt+tt*tt),vt?(vt=1/vt,Je*=vt,rt*=vt,tt*=vt):(Je=0,rt=0,tt=0),et=_t*tt-Ct*rt,qe=Ct*Je-ut*tt,ot=ut*rt-_t*Je,vt=Math.sqrt(et*et+qe*qe+ot*ot),vt?(vt=1/vt,et*=vt,qe*=vt,ot*=vt):(et=0,qe=0,ot=0),Me[0]=Je,Me[1]=et,Me[2]=ut,Me[3]=0,Me[4]=rt,Me[5]=qe,Me[6]=_t,Me[7]=0,Me[8]=tt,Me[9]=ot,Me[10]=Ct,Me[11]=0,Me[12]=-(Je*Lt+rt*jt+tt*$t),Me[13]=-(et*Lt+qe*jt+ot*$t),Me[14]=-(ut*Lt+_t*jt+Ct*$t),Me[15]=1,Me)}function ze(Me,Ne,Xe,Ye){const Je=Ne[0],rt=Ne[1],tt=Ne[2],et=Ye[0],qe=Ye[1],ot=Ye[2];let ut=Je-Xe[0],_t=rt-Xe[1],Ct=tt-Xe[2],vt=ut*ut+_t*_t+Ct*Ct;vt>0&&(vt=1/Math.sqrt(vt),ut*=vt,_t*=vt,Ct*=vt);let Lt=qe*Ct-ot*_t,jt=ot*ut-et*Ct,$t=et*_t-qe*ut;return vt=Lt*Lt+jt*jt+$t*$t,vt>0&&(vt=1/Math.sqrt(vt),Lt*=vt,jt*=vt,$t*=vt),Me[0]=Lt,Me[1]=jt,Me[2]=$t,Me[3]=0,Me[4]=_t*$t-Ct*jt,Me[5]=Ct*Lt-ut*$t,Me[6]=ut*jt-_t*Lt,Me[7]=0,Me[8]=ut,Me[9]=_t,Me[10]=Ct,Me[11]=0,Me[12]=Je,Me[13]=rt,Me[14]=tt,Me[15]=1,Me}function Be(Me,Ne,Xe){return Me[0]=Ne[0]-Xe[0],Me[1]=Ne[1]-Xe[1],Me[2]=Ne[2]-Xe[2],Me[3]=Ne[3]-Xe[3],Me[4]=Ne[4]-Xe[4],Me[5]=Ne[5]-Xe[5],Me[6]=Ne[6]-Xe[6],Me[7]=Ne[7]-Xe[7],Me[8]=Ne[8]-Xe[8],Me[9]=Ne[9]-Xe[9],Me[10]=Ne[10]-Xe[10],Me[11]=Ne[11]-Xe[11],Me[12]=Ne[12]-Xe[12],Me[13]=Ne[13]-Xe[13],Me[14]=Ne[14]-Xe[14],Me[15]=Ne[15]-Xe[15],Me}function Re(Me,Ne){return Me[0]===Ne[0]&&Me[1]===Ne[1]&&Me[2]===Ne[2]&&Me[3]===Ne[3]&&Me[4]===Ne[4]&&Me[5]===Ne[5]&&Me[6]===Ne[6]&&Me[7]===Ne[7]&&Me[8]===Ne[8]&&Me[9]===Ne[9]&&Me[10]===Ne[10]&&Me[11]===Ne[11]&&Me[12]===Ne[12]&&Me[13]===Ne[13]&&Me[14]===Ne[14]&&Me[15]===Ne[15]}function He(Me,Ne){if(Me===Ne)return!0;const Xe=Me[0],Ye=Me[1],Je=Me[2],rt=Me[3],tt=Me[4],et=Me[5],qe=Me[6],ot=Me[7],ut=Me[8],_t=Me[9],Ct=Me[10],vt=Me[11],Lt=Me[12],jt=Me[13],$t=Me[14],Wt=Me[15],pr=Ne[0],gr=Ne[1],ar=Ne[2],Fr=Ne[3],mr=Ne[4],wt=Ne[5],or=Ne[6],sr=Ne[7],rr=Ne[8],Et=Ne[9],St=Ne[10],Ft=Ne[11],zt=Ne[12],dr=Ne[13],hr=Ne[14],Tr=Ne[15],Dr=(0,R.g)();return Math.abs(Xe-pr)<=Dr*Math.max(1,Math.abs(Xe),Math.abs(pr))&&Math.abs(Ye-gr)<=Dr*Math.max(1,Math.abs(Ye),Math.abs(gr))&&Math.abs(Je-ar)<=Dr*Math.max(1,Math.abs(Je),Math.abs(ar))&&Math.abs(rt-Fr)<=Dr*Math.max(1,Math.abs(rt),Math.abs(Fr))&&Math.abs(tt-mr)<=Dr*Math.max(1,Math.abs(tt),Math.abs(mr))&&Math.abs(et-wt)<=Dr*Math.max(1,Math.abs(et),Math.abs(wt))&&Math.abs(qe-or)<=Dr*Math.max(1,Math.abs(qe),Math.abs(or))&&Math.abs(ot-sr)<=Dr*Math.max(1,Math.abs(ot),Math.abs(sr))&&Math.abs(ut-rr)<=Dr*Math.max(1,Math.abs(ut),Math.abs(rr))&&Math.abs(_t-Et)<=Dr*Math.max(1,Math.abs(_t),Math.abs(Et))&&Math.abs(Ct-St)<=Dr*Math.max(1,Math.abs(Ct),Math.abs(St))&&Math.abs(vt-Ft)<=Dr*Math.max(1,Math.abs(vt),Math.abs(Ft))&&Math.abs(Lt-zt)<=Dr*Math.max(1,Math.abs(Lt),Math.abs(zt))&&Math.abs(jt-dr)<=Dr*Math.max(1,Math.abs(jt),Math.abs(dr))&&Math.abs($t-hr)<=Dr*Math.max(1,Math.abs($t),Math.abs(hr))&&Math.abs(Wt-Tr)<=Dr*Math.max(1,Math.abs(Wt),Math.abs(Tr))}function Ie(Me){const Ne=(0,R.g)(),Xe=Me[0],Ye=Me[1],Je=Me[2],rt=Me[4],tt=Me[5],et=Me[6],qe=Me[8],ot=Me[9],ut=Me[10];return Math.abs(1-(Xe*Xe+rt*rt+qe*qe))<=Ne&&Math.abs(1-(Ye*Ye+tt*tt+ot*ot))<=Ne&&Math.abs(1-(Je*Je+et*et+ut*ut))<=Ne}Object.freeze(Object.defineProperty({__proto__:null,copy:G,set:Z,identity:Q,transpose:$,invert:W,adjoint:function B(Me,Ne){const Xe=Ne[0],Ye=Ne[1],Je=Ne[2],rt=Ne[3],tt=Ne[4],et=Ne[5],qe=Ne[6],ot=Ne[7],ut=Ne[8],_t=Ne[9],Ct=Ne[10],vt=Ne[11],Lt=Ne[12],jt=Ne[13],$t=Ne[14],Wt=Ne[15];return Me[0]=et*(Ct*Wt-vt*$t)-_t*(qe*Wt-ot*$t)+jt*(qe*vt-ot*Ct),Me[1]=-(Ye*(Ct*Wt-vt*$t)-_t*(Je*Wt-rt*$t)+jt*(Je*vt-rt*Ct)),Me[2]=Ye*(qe*Wt-ot*$t)-et*(Je*Wt-rt*$t)+jt*(Je*ot-rt*qe),Me[3]=-(Ye*(qe*vt-ot*Ct)-et*(Je*vt-rt*Ct)+_t*(Je*ot-rt*qe)),Me[4]=-(tt*(Ct*Wt-vt*$t)-ut*(qe*Wt-ot*$t)+Lt*(qe*vt-ot*Ct)),Me[5]=Xe*(Ct*Wt-vt*$t)-ut*(Je*Wt-rt*$t)+Lt*(Je*vt-rt*Ct),Me[6]=-(Xe*(qe*Wt-ot*$t)-tt*(Je*Wt-rt*$t)+Lt*(Je*ot-rt*qe)),Me[7]=Xe*(qe*vt-ot*Ct)-tt*(Je*vt-rt*Ct)+ut*(Je*ot-rt*qe),Me[8]=tt*(_t*Wt-vt*jt)-ut*(et*Wt-ot*jt)+Lt*(et*vt-ot*_t),Me[9]=-(Xe*(_t*Wt-vt*jt)-ut*(Ye*Wt-rt*jt)+Lt*(Ye*vt-rt*_t)),Me[10]=Xe*(et*Wt-ot*jt)-tt*(Ye*Wt-rt*jt)+Lt*(Ye*ot-rt*et),Me[11]=-(Xe*(et*vt-ot*_t)-tt*(Ye*vt-rt*_t)+ut*(Ye*ot-rt*et)),Me[12]=-(tt*(_t*$t-Ct*jt)-ut*(et*$t-qe*jt)+Lt*(et*Ct-qe*_t)),Me[13]=Xe*(_t*$t-Ct*jt)-ut*(Ye*$t-Je*jt)+Lt*(Ye*Ct-Je*_t),Me[14]=-(Xe*(et*$t-qe*jt)-tt*(Ye*$t-Je*jt)+Lt*(Ye*qe-Je*et)),Me[15]=Xe*(et*Ct-qe*_t)-tt*(Ye*Ct-Je*_t)+ut*(Ye*qe-Je*et),Me},determinant:function H(Me){const Ne=Me[0],Xe=Me[1],Ye=Me[2],Je=Me[3],rt=Me[4],tt=Me[5],et=Me[6],qe=Me[7],ot=Me[8],ut=Me[9],_t=Me[10],Ct=Me[11],vt=Me[12],Lt=Me[13],jt=Me[14],$t=Me[15];return(Ne*tt-Xe*rt)*(_t*$t-Ct*jt)-(Ne*et-Ye*rt)*(ut*$t-Ct*Lt)+(Ne*qe-Je*rt)*(ut*jt-_t*Lt)+(Xe*et-Ye*tt)*(ot*$t-Ct*vt)-(Xe*qe-Je*tt)*(ot*jt-_t*vt)+(Ye*qe-Je*et)*(ot*Lt-ut*vt)},multiply:X,translate:te,scale:ae,rotate:oe,rotateX:le,rotateY:de,rotateZ:se,fromTranslation:re,fromScaling:j,fromRotation:Y,fromXRotation:ee,fromYRotation:function ie(Me,Ne){const Xe=Math.sin(Ne),Ye=Math.cos(Ne);return Me[0]=Ye,Me[1]=0,Me[2]=-Xe,Me[3]=0,Me[4]=0,Me[5]=1,Me[6]=0,Me[7]=0,Me[8]=Xe,Me[9]=0,Me[10]=Ye,Me[11]=0,Me[12]=0,Me[13]=0,Me[14]=0,Me[15]=1,Me},fromZRotation:J,fromRotationTranslation:ce,fromQuat2:function ue(Me,Ne){const Xe=pe,Ye=-Ne[0],Je=-Ne[1],rt=-Ne[2],tt=Ne[3],et=Ne[4],qe=Ne[5],ot=Ne[6],ut=Ne[7],_t=Ye*Ye+Je*Je+rt*rt+tt*tt;return _t>0?(Xe[0]=2*(et*tt+ut*Ye+qe*rt-ot*Je)/_t,Xe[1]=2*(qe*tt+ut*Je+ot*Ye-et*rt)/_t,Xe[2]=2*(ot*tt+ut*rt+et*Je-qe*Ye)/_t):(Xe[0]=2*(et*tt+ut*Ye+qe*rt-ot*Je),Xe[1]=2*(qe*tt+ut*Je+ot*Ye-et*rt),Xe[2]=2*(ot*tt+ut*rt+et*Je-qe*Ye)),ce(Me,Ne,Xe),Me},getTranslation:he,getScaling:me,getRotation:function ge(Me,Ne){const Xe=Ne[0]+Ne[5]+Ne[10];let Ye=0;return Xe>0?(Ye=2*Math.sqrt(Xe+1),Me[3]=.25*Ye,Me[0]=(Ne[6]-Ne[9])/Ye,Me[1]=(Ne[8]-Ne[2])/Ye,Me[2]=(Ne[1]-Ne[4])/Ye):Ne[0]>Ne[5]&&Ne[0]>Ne[10]?(Ye=2*Math.sqrt(1+Ne[0]-Ne[5]-Ne[10]),Me[3]=(Ne[6]-Ne[9])/Ye,Me[0]=.25*Ye,Me[1]=(Ne[1]+Ne[4])/Ye,Me[2]=(Ne[8]+Ne[2])/Ye):Ne[5]>Ne[10]?(Ye=2*Math.sqrt(1+Ne[5]-Ne[0]-Ne[10]),Me[3]=(Ne[8]-Ne[2])/Ye,Me[0]=(Ne[1]+Ne[4])/Ye,Me[1]=.25*Ye,Me[2]=(Ne[6]+Ne[9])/Ye):(Ye=2*Math.sqrt(1+Ne[10]-Ne[0]-Ne[5]),Me[3]=(Ne[1]-Ne[4])/Ye,Me[0]=(Ne[8]+Ne[2])/Ye,Me[1]=(Ne[6]+Ne[9])/Ye,Me[2]=.25*Ye),Me},fromRotationTranslationScale:_e,fromRotationTranslationScaleOrigin:function Ee(Me,Ne,Xe,Ye,Je){const rt=Ne[0],tt=Ne[1],et=Ne[2],qe=Ne[3],ot=rt+rt,ut=tt+tt,_t=et+et,Ct=rt*ot,vt=rt*ut,Lt=rt*_t,jt=tt*ut,$t=tt*_t,Wt=et*_t,pr=qe*ot,gr=qe*ut,ar=qe*_t,Fr=Ye[0],mr=Ye[1],wt=Ye[2],or=Je[0],sr=Je[1],rr=Je[2],Et=(1-(jt+Wt))*Fr,St=(vt+ar)*Fr,Ft=(Lt-gr)*Fr,zt=(vt-ar)*mr,dr=(1-(Ct+Wt))*mr,hr=($t+pr)*mr,Tr=(Lt+gr)*wt,Dr=($t-pr)*wt,Lr=(1-(Ct+jt))*wt;return Me[0]=Et,Me[1]=St,Me[2]=Ft,Me[3]=0,Me[4]=zt,Me[5]=dr,Me[6]=hr,Me[7]=0,Me[8]=Tr,Me[9]=Dr,Me[10]=Lr,Me[11]=0,Me[12]=Xe[0]+or-(Et*or+zt*sr+Tr*rr),Me[13]=Xe[1]+sr-(St*or+dr*sr+Dr*rr),Me[14]=Xe[2]+rr-(Ft*or+hr*sr+Lr*rr),Me[15]=1,Me},fromQuat:De,frustum:be,perspective:function Se(Me,Ne,Xe,Ye,Je){const rt=1/Math.tan(Ne/2);let tt;return Me[0]=rt/Xe,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=rt,Me[6]=0,Me[7]=0,Me[8]=0,Me[9]=0,Me[11]=-1,Me[12]=0,Me[13]=0,Me[15]=0,null!=Je&&Je!==1/0?(tt=1/(Ye-Je),Me[10]=(Je+Ye)*tt,Me[14]=2*Je*Ye*tt):(Me[10]=-1,Me[14]=-2*Ye),Me},perspectiveFromFieldOfView:function ye(Me,Ne,Xe,Ye){const Je=Math.tan(Ne.upDegrees*Math.PI/180),rt=Math.tan(Ne.downDegrees*Math.PI/180),tt=Math.tan(Ne.leftDegrees*Math.PI/180),et=Math.tan(Ne.rightDegrees*Math.PI/180),qe=2/(tt+et),ot=2/(Je+rt);return Me[0]=qe,Me[1]=0,Me[2]=0,Me[3]=0,Me[4]=0,Me[5]=ot,Me[6]=0,Me[7]=0,Me[8]=-(tt-et)*qe*.5,Me[9]=(Je-rt)*ot*.5,Me[10]=Ye/(Xe-Ye),Me[11]=-1,Me[12]=0,Me[13]=0,Me[14]=Ye*Xe/(Xe-Ye),Me[15]=0,Me},ortho:ve,lookAt:xe,targetTo:ze,str:function Ke(Me){return"mat4("+Me[0]+", "+Me[1]+", "+Me[2]+", "+Me[3]+", "+Me[4]+", "+Me[5]+", "+Me[6]+", "+Me[7]+", "+Me[8]+", "+Me[9]+", "+Me[10]+", "+Me[11]+", "+Me[12]+", "+Me[13]+", "+Me[14]+", "+Me[15]+")"},frob:function We(Me){return Math.sqrt(Me[0]**2+Me[1]**2+Me[2]**2+Me[3]**2+Me[4]**2+Me[5]**2+Me[6]**2+Me[7]**2+Me[8]**2+Me[9]**2+Me[10]**2+Me[11]**2+Me[12]**2+Me[13]**2+Me[14]**2+Me[15]**2)},add:function Ce(Me,Ne,Xe){return Me[0]=Ne[0]+Xe[0],Me[1]=Ne[1]+Xe[1],Me[2]=Ne[2]+Xe[2],Me[3]=Ne[3]+Xe[3],Me[4]=Ne[4]+Xe[4],Me[5]=Ne[5]+Xe[5],Me[6]=Ne[6]+Xe[6],Me[7]=Ne[7]+Xe[7],Me[8]=Ne[8]+Xe[8],Me[9]=Ne[9]+Xe[9],Me[10]=Ne[10]+Xe[10],Me[11]=Ne[11]+Xe[11],Me[12]=Ne[12]+Xe[12],Me[13]=Ne[13]+Xe[13],Me[14]=Ne[14]+Xe[14],Me[15]=Ne[15]+Xe[15],Me},subtract:Be,multiplyScalar:function Fe(Me,Ne,Xe){return Me[0]=Ne[0]*Xe,Me[1]=Ne[1]*Xe,Me[2]=Ne[2]*Xe,Me[3]=Ne[3]*Xe,Me[4]=Ne[4]*Xe,Me[5]=Ne[5]*Xe,Me[6]=Ne[6]*Xe,Me[7]=Ne[7]*Xe,Me[8]=Ne[8]*Xe,Me[9]=Ne[9]*Xe,Me[10]=Ne[10]*Xe,Me[11]=Ne[11]*Xe,Me[12]=Ne[12]*Xe,Me[13]=Ne[13]*Xe,Me[14]=Ne[14]*Xe,Me[15]=Ne[15]*Xe,Me},multiplyScalarAndAdd:function je(Me,Ne,Xe,Ye){return Me[0]=Ne[0]+Xe[0]*Ye,Me[1]=Ne[1]+Xe[1]*Ye,Me[2]=Ne[2]+Xe[2]*Ye,Me[3]=Ne[3]+Xe[3]*Ye,Me[4]=Ne[4]+Xe[4]*Ye,Me[5]=Ne[5]+Xe[5]*Ye,Me[6]=Ne[6]+Xe[6]*Ye,Me[7]=Ne[7]+Xe[7]*Ye,Me[8]=Ne[8]+Xe[8]*Ye,Me[9]=Ne[9]+Xe[9]*Ye,Me[10]=Ne[10]+Xe[10]*Ye,Me[11]=Ne[11]+Xe[11]*Ye,Me[12]=Ne[12]+Xe[12]*Ye,Me[13]=Ne[13]+Xe[13]*Ye,Me[14]=Ne[14]+Xe[14]*Ye,Me[15]=Ne[15]+Xe[15]*Ye,Me},exactEquals:Re,equals:He,isOrthoNormal:Ie,mul:X,sub:Be},Symbol.toStringTag,{value:"Module"}))},55494:(nt,Ae,v)=>{"use strict";function D(){const W=new Float32Array(16);return W[0]=1,W[5]=1,W[10]=1,W[15]=1,W}v.d(Ae,{c:()=>D});const Q=D();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:function R(W){const B=new Float32Array(16);return B[0]=W[0],B[1]=W[1],B[2]=W[2],B[3]=W[3],B[4]=W[4],B[5]=W[5],B[6]=W[6],B[7]=W[7],B[8]=W[8],B[9]=W[9],B[10]=W[10],B[11]=W[11],B[12]=W[12],B[13]=W[13],B[14]=W[14],B[15]=W[15],B},fromValues:function G(W,B,H,X,te,ae,oe,le,de,se,re,j,Y,ee,ie,J){const ce=new Float32Array(16);return ce[0]=W,ce[1]=B,ce[2]=H,ce[3]=X,ce[4]=te,ce[5]=ae,ce[6]=oe,ce[7]=le,ce[8]=de,ce[9]=se,ce[10]=re,ce[11]=j,ce[12]=Y,ce[13]=ee,ce[14]=ie,ce[15]=J,ce},createView:function Z(W,B){return new Float32Array(W,B,16)},IDENTITY:Q},Symbol.toStringTag,{value:"Module"}))},43703:(nt,Ae,v)=>{"use strict";function D(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R(W){return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9],W[10],W[11],W[12],W[13],W[14],W[15]]}function G(W,B,H,X,te,ae,oe,le,de,se,re,j,Y,ee,ie,J){return[W,B,H,X,te,ae,oe,le,de,se,re,j,Y,ee,ie,J]}function Z(W,B){return new Float64Array(W,B,16)}v.d(Ae,{I:()=>Q,a:()=>Z,b:()=>R,c:()=>D,f:()=>G});const Q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,createView:Z,IDENTITY:Q},Symbol.toStringTag,{value:"Module"}))},44956:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>X,f:()=>H,g:()=>B,h:()=>le,i:()=>Q,j:()=>Y,l:()=>W,p:()=>he});var D=v(54346),R=v(8314);let G,Z=null;function Q(){return!!Z}function W(){return G||(G=v.e(3714).then(v.bind(v,73714)).then(me=>me.p).then(({default:me})=>me({locateFile:ge=>(0,D.V)(`esri/geometry/support/${ge}`)})).then(me=>{ie(me)}),G)}var B,H,X,me;(function(me){function ge(be,Se,ye){Z.ensureCache.prepare();const ve=ue(ye),xe=ye===ve,ze=Z.ensureFloat64(ve),Ke=Z._pe_geog_to_proj(Z.getPointer(be),Se,ze);return Ke&&pe(ye,Se,ze,xe),Ke}function Ee(be,Se,ye){return De(be,Se,ye,0)}function De(be,Se,ye,ve){Z.ensureCache.prepare();const xe=ue(ye),ze=ye===xe,Ke=Z.ensureFloat64(xe),We=Z._pe_proj_to_geog_center(Z.getPointer(be),Se,Ke,ve);return We&&pe(ye,Se,Ke,ze),We}me.geogToProj=ge,me.projGeog=function _e(be,Se,ye,ve){switch(ve){case H.PE_TRANSFORM_P_TO_G:return Ee(be,Se,ye);case H.PE_TRANSFORM_G_TO_P:return ge(be,Se,ye)}return 0},me.projToGeog=Ee,me.projToGeogCenter=De})(B||(B={})),(me=H||(H={})).init=function ge(){me.PE_BUFFER_MAX=Z.PeDefs.prototype.PE_BUFFER_MAX,me.PE_NAME_MAX=Z.PeDefs.prototype.PE_NAME_MAX,me.PE_MGRS_MAX=Z.PeDefs.prototype.PE_MGRS_MAX,me.PE_USNG_MAX=Z.PeDefs.prototype.PE_USNG_MAX,me.PE_DD_MAX=Z.PeDefs.prototype.PE_DD_MAX,me.PE_DDM_MAX=Z.PeDefs.prototype.PE_DDM_MAX,me.PE_DMS_MAX=Z.PeDefs.prototype.PE_DMS_MAX,me.PE_UTM_MAX=Z.PeDefs.prototype.PE_UTM_MAX,me.PE_PARM_MAX=Z.PeDefs.prototype.PE_PARM_MAX,me.PE_TYPE_NONE=Z.PeDefs.prototype.PE_TYPE_NONE,me.PE_TYPE_GEOGCS=Z.PeDefs.prototype.PE_TYPE_GEOGCS,me.PE_TYPE_PROJCS=Z.PeDefs.prototype.PE_TYPE_PROJCS,me.PE_TYPE_GEOGTRAN=Z.PeDefs.prototype.PE_TYPE_GEOGTRAN,me.PE_TYPE_COORDSYS=Z.PeDefs.prototype.PE_TYPE_COORDSYS,me.PE_TYPE_UNIT=Z.PeDefs.prototype.PE_TYPE_UNIT,me.PE_TYPE_LINUNIT=Z.PeDefs.prototype.PE_TYPE_LINUNIT,me.PE_STR_OPTS_NONE=Z.PeDefs.prototype.PE_STR_OPTS_NONE,me.PE_STR_AUTH_NONE=Z.PeDefs.prototype.PE_STR_AUTH_NONE,me.PE_STR_AUTH_TOP=Z.PeDefs.prototype.PE_STR_AUTH_TOP,me.PE_STR_NAME_CANON=Z.PeDefs.prototype.PE_STR_NAME_CANON,me.PE_PARM_X0=Z.PeDefs.prototype.PE_PARM_X0,me.PE_PARM_ND=Z.PeDefs.prototype.PE_PARM_ND,me.PE_TRANSFORM_1_TO_2=Z.PeDefs.prototype.PE_TRANSFORM_1_TO_2,me.PE_TRANSFORM_2_TO_1=Z.PeDefs.prototype.PE_TRANSFORM_2_TO_1,me.PE_TRANSFORM_P_TO_G=Z.PeDefs.prototype.PE_TRANSFORM_P_TO_G,me.PE_TRANSFORM_G_TO_P=Z.PeDefs.prototype.PE_TRANSFORM_G_TO_P,me.PE_HORIZON_RECT=Z.PeDefs.prototype.PE_HORIZON_RECT,me.PE_HORIZON_POLY=Z.PeDefs.prototype.PE_HORIZON_POLY,me.PE_HORIZON_LINE=Z.PeDefs.prototype.PE_HORIZON_LINE,me.PE_HORIZON_DELTA=Z.PeDefs.prototype.PE_HORIZON_DELTA},function(me){const ge={},_e={},Ee=Ce=>{if(Ce){const Be=Ce.getType();switch(Be){case H.PE_TYPE_GEOGCS:Ce=Z.castObject(Ce,Z.PeGeogcs);break;case H.PE_TYPE_PROJCS:Ce=Z.castObject(Ce,Z.PeProjcs);break;case H.PE_TYPE_GEOGTRAN:Ce=Z.castObject(Ce,Z.PeGeogtran);break;default:Be&H.PE_TYPE_UNIT&&(Ce=Z.castObject(Ce,Z.PeUnit))}}return Ce};function Se(Ce,Be){let Fe=null,je=ge[Ce];if(je||(je={},ge[Ce]=je),je.hasOwnProperty(String(Be)))Fe=je[Be];else{const Re=Z.PeFactory.prototype.factoryByType(Ce,Be);Z.compare(Re,Z.NULL)||(Fe=Re,je[Be]=Fe)}return Fe=Ee(Fe),Fe}me.initialize=function De(){Z.PeFactory.prototype.initialize(null)},me.coordsys=function be(Ce){return Se(H.PE_TYPE_COORDSYS,Ce)},me.factoryByType=Se,me.fromString=function ye(Ce,Be){let Fe=null,je=_e[Ce];if(je||(je={},_e[Ce]=je),je.hasOwnProperty(Be))Fe=je[Be];else{const Re=Z.PeFactory.prototype.fromString(Ce,Be);Z.compare(Re,Z.NULL)||(Fe=Re,je[Be]=Fe)}return Fe=Ee(Fe),Fe},me.geogcs=function ve(Ce){return Se(H.PE_TYPE_GEOGCS,Ce)},me.geogtran=function xe(Ce){return Se(H.PE_TYPE_GEOGTRAN,Ce)},me.getCode=function ze(Ce){return Z.PeFactory.prototype.getCode(Ce)},me.projcs=function Ke(Ce){return Se(H.PE_TYPE_PROJCS,Ce)},me.unit=function We(Ce){return Se(H.PE_TYPE_UNIT,Ce)}}(X||(X={}));let te=null;var ae,oe,le,de,se,re,j,Y,ee;function ie(me){function ge(be,Se,ye){be[Se]=ye(be[Se])}Z=me,H.init(),ae.init(),se.init(),j.init(),Y.init(),te=class extends Z.PeGCSExtent{destroy(){Z.destroy(this)}};const _e=[Z.PeDatum,Z.PeGeogcs,Z.PeGeogtran,Z.PeObject,Z.PeParameter,Z.PePrimem,Z.PeProjcs,Z.PeSpheroid,Z.PeUnit];for(const be of _e)ge(be.prototype,"getName",Se=>function(){return Se.call(this,new Array(H.PE_NAME_MAX))});for(const be of[Z.PeGeogtran,Z.PeProjcs])ge(be.prototype,"getParameters",Se=>function(){const ye=new Array(H.PE_PARM_MAX);let ve=Se.call(this);for(let xe=0;xe<ye.length;xe++){const ze=Z.getValue(ve,"*");ye[xe]=ze?Z.wrapPointer(ze,Z.PeParameter):null,ve+=Int32Array.BYTES_PER_ELEMENT}return ye});ge(Z.PeHorizon.prototype,"getCoord",be=>function(){const Se=this.getSize();if(!Se)return null;const ye=[];return pe(ye,Se,be.call(this)),ye}),ge(Z.PeGTlistExtendedEntry.prototype,"getEntries",be=>{const Se=Z._pe_getPeGTlistExtendedGTsSize();return function(){let ye=null;const ve=be.call(this);if(!Z.compare(ve,Z.NULL)){ye=[ve];const xe=this.getSteps();if(xe>1){const ze=Z.getPointer(ve);for(let Ke=1;Ke<xe;Ke++)ye.push(Z.wrapPointer(ze+Se*Ke,Z.PeGTlistExtendedGTs))}}return ye}});const Ee=Z._pe_getPeHorizonSize(),De=be=>function(){let Se=this._cache;if(Se||(Se=new Map,this._cache=Se),Se.has(be))return Se.get(be);let ye=null;const ve=be.call(this);if(!Z.compare(ve,Z.NULL)){ye=[ve];const xe=ve.getNump();if(xe>1){const ze=Z.getPointer(ve);for(let Ke=1;Ke<xe;Ke++)ye.push(Z.wrapPointer(ze+Ee*Ke,Z.PeHorizon))}}return Se.set(be,ye),ye};ge(Z.PeProjcs.prototype,"horizonGcsGenerate",De),ge(Z.PeProjcs.prototype,"horizonPcsGenerate",De),Z.PeObject.prototype.toString=function(be=H.PE_STR_OPTS_NONE){Z.ensureCache.prepare();const Se=Z.getPointer(this),ye=Z.ensureInt8(new Array(H.PE_BUFFER_MAX));return Z.UTF8ToString(Z._pe_object_to_string_ext(Se,be,ye))}}function J(me){if(!me)return;const ge=Z.getClass(me);if(!ge)return;const _e=Z.getCache(ge);if(!_e)return;const Ee=Z.getPointer(me);Ee&&delete _e[Ee]}function ce(me,ge){const _e=[],Ee=new Array(ge);for(let De=0;De<me;De++)_e.push(Z.ensureInt8(Ee));return _e}function ue(me){let ge;return Array.isArray(me[0])?(ge=[],me.forEach(_e=>{ge.push(_e[0],_e[1])})):ge=me,ge}function pe(me,ge,_e,Ee=!1){if(Ee)for(let De=0;De<2*ge;De++)me[De]=Z.getValue(_e+De*Float64Array.BYTES_PER_ELEMENT,"double");else{const De=0===me.length;for(let be=0;be<ge;be++)De&&(me[be]=new Array(2)),me[be][0]=Z.getValue(_e,"double"),me[be][1]=Z.getValue(_e+Float64Array.BYTES_PER_ELEMENT,"double"),_e+=2*Float64Array.BYTES_PER_ELEMENT}}(function(me){let ge;me.init=function _e(){me.PE_GTLIST_OPTS_COMMON=Z.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,ge=Z._pe_getPeGTlistExtendedEntrySize()},me.getGTlist=function Ee(De,be,Se,ye,ve,xe){let ze=null;const Ke=new Z.PeInteger(xe);try{const We=Z.PeGTlistExtended.prototype.getGTlist(De,be,Se,ye,ve,Ke);if((xe=Ke.val)&&(ze=[We],xe>1)){const Ce=Z.getPointer(We);for(let Be=1;Be<xe;Be++)ze.push(Z.wrapPointer(Ce+ge*Be,Z.PeGTlistExtendedEntry))}}finally{Z.destroy(Ke)}return ze}})(ae||(ae={})),function(me){me.destroy=function ge(_e){if(_e&&_e.length){for(const Ee of _e)J(Ee),Ee.getEntries().forEach(De=>{J(De);const be=De.getGeogtran();J(be),be.getParameters().forEach(J),[be.getGeogcs1(),be.getGeogcs2()].forEach(Se=>{J(Se);const ye=Se.getDatum();J(ye),J(ye.getSpheroid()),J(Se.getPrimem()),J(Se.getUnit())})});Z.PeGTlistExtendedEntry.prototype.Delete(_e[0])}}}(oe||(oe={})),function(me){me.geogToGeog=function ge(_e,Ee,De,be,Se){Z.ensureCache.prepare();const ye=ue(De),ve=De===ye,xe=Z.ensureFloat64(ye);let ze=0;be&&(ze=Z.ensureFloat64(be));const Ke=Z._pe_geog_to_geog(Z.getPointer(_e),Ee,xe,ze,Se);return Ke&&pe(De,Ee,xe,ve),Ke}}(le||(le={})),function(me){const ge=(xe,ze,Ke,We,Ce,Be)=>{let Fe,je;switch(Z.ensureCache.prepare(),xe){case"dd":Fe=Z._pe_geog_to_dd,je=H.PE_DD_MAX;break;case"ddm":Fe=Z._pe_geog_to_ddm,je=H.PE_DDM_MAX;break;case"dms":Fe=Z._pe_geog_to_dms,je=H.PE_DMS_MAX}let Re=0;ze&&(Re=Z.getPointer(ze));const He=ue(We),Ie=Z.ensureFloat64(He),Ge=ce(Ke,je),Pe=Fe(Re,Ke,Ie,Ce,Z.ensureInt32(Ge));if(Pe)for(let Le=0;Le<Ke;Le++)Be[Le]=Z.UTF8ToString(Ge[Le]);return Pe},_e=(xe,ze,Ke,We,Ce)=>{let Be;switch(Z.ensureCache.prepare(),xe){case"dd":Be=Z._pe_dd_to_geog;break;case"ddm":Be=Z._pe_ddm_to_geog;break;case"dms":Be=Z._pe_dms_to_geog}let Fe=0;ze&&(Fe=Z.getPointer(ze));const je=We.map(Ge=>Z.ensureString(Ge)),Re=Z.ensureInt32(je),He=Z.ensureFloat64(new Array(2*Ke)),Ie=Be(Fe,Ke,Re,He);return Ie&&pe(Ce,Ke,He),Ie};me.geogToDms=function Ee(xe,ze,Ke,We,Ce){return ge("dms",xe,ze,Ke,We,Ce)},me.dmsToGeog=function De(xe,ze,Ke,We){return _e("dms",xe,ze,Ke,We)},me.geogToDdm=function be(xe,ze,Ke,We,Ce){return ge("ddm",xe,ze,Ke,We,Ce)},me.ddmToGeog=function Se(xe,ze,Ke,We){return _e("ddm",xe,ze,Ke,We)},me.geogToDd=function ye(xe,ze,Ke,We,Ce){return ge("dd",xe,ze,Ke,We,Ce)},me.ddToGeog=function ve(xe,ze,Ke,We){return _e("dd",xe,ze,Ke,We)}}(de||(de={})),function(me){me.init=function ge(){me.PE_MGRS_STYLE_NEW=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,me.PE_MGRS_STYLE_OLD=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,me.PE_MGRS_STYLE_AUTO=Z.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,me.PE_MGRS_180_ZONE_1_PLUS=Z.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,me.PE_MGRS_ADD_SPACES=Z.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},me.geogToMgrsExtended=function _e(De,be,Se,ye,ve,xe,ze){Z.ensureCache.prepare();let Ke=0;De&&(Ke=Z.getPointer(De));const We=ue(Se),Ce=Z.ensureFloat64(We),Be=ce(be,H.PE_MGRS_MAX),Fe=Z.ensureInt32(Be),je=Z._pe_geog_to_mgrs_extended(Ke,be,Ce,ye,ve,xe,Fe);if(je)for(let Re=0;Re<be;Re++)ze[Re]=Z.UTF8ToString(Be[Re]);return je},me.mgrsToGeogExtended=function Ee(De,be,Se,ye,ve){Z.ensureCache.prepare();let xe=0;De&&(xe=Z.getPointer(De));const ze=Se.map(Be=>Z.ensureString(Be)),Ke=Z.ensureInt32(ze),We=Z.ensureFloat64(new Array(2*be)),Ce=Z._pe_mgrs_to_geog_extended(xe,be,Ke,ye,We);return Ce&&pe(ve,be,We),Ce}}(se||(se={})),function(me){me.geogToUsng=function ge(Ee,De,be,Se,ye,ve,xe){Z.ensureCache.prepare();let ze=0;Ee&&(ze=Z.getPointer(Ee));const Ke=ue(be),We=Z.ensureFloat64(Ke),Ce=ce(De,H.PE_MGRS_MAX),Be=Z.ensureInt32(Ce),Fe=Z._pe_geog_to_usng(ze,De,We,Se,ye,ve,Be);if(Fe)for(let je=0;je<De;je++)xe[je]=Z.UTF8ToString(Ce[je]);return Fe},me.usngToGeog=function _e(Ee,De,be,Se){Z.ensureCache.prepare();let ye=0;Ee&&(ye=Z.getPointer(Ee));const ve=be.map(We=>Z.ensureString(We)),xe=Z.ensureInt32(ve),ze=Z.ensureFloat64(new Array(2*De)),Ke=Z._pe_usng_to_geog(ye,De,xe,ze);return Ke&&pe(Se,De,ze),Ke}}(re||(re={})),function(me){me.init=function ge(){me.PE_UTM_OPTS_NONE=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,me.PE_UTM_OPTS_ADD_SPACES=Z.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,me.PE_UTM_OPTS_NS=Z.PeNotationUtm.prototype.PE_UTM_OPTS_NS},me.geogToUtm=function _e(De,be,Se,ye,ve){Z.ensureCache.prepare();let xe=0;De&&(xe=Z.getPointer(De));const ze=ue(Se),Ke=Z.ensureFloat64(ze),We=ce(be,H.PE_UTM_MAX),Ce=Z.ensureInt32(We),Be=Z._pe_geog_to_utm(xe,be,Ke,ye,Ce);if(Be)for(let Fe=0;Fe<be;Fe++)ve[Fe]=Z.UTF8ToString(We[Fe]);return Be},me.utmToGeog=function Ee(De,be,Se,ye,ve){Z.ensureCache.prepare();let xe=0;De&&(xe=Z.getPointer(De));const ze=Se.map(Be=>Z.ensureString(Be)),Ke=Z.ensureInt32(ze),We=Z.ensureFloat64(new Array(2*be)),Ce=Z._pe_utm_to_geog(xe,be,Ke,ye,We);return Ce&&pe(ve,be,We),Ce}}(j||(j={})),function(me){const ge=new Map;me.init=function _e(){me.PE_PCSINFO_OPTION_NONE=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,me.PE_PCSINFO_OPTION_DOMAIN=Z.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,me.PE_POLE_OUTSIDE_BOUNDARY=Z.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,me.PE_POLE_POINT=Z.PePCSInfo.prototype.PE_POLE_POINT},me.generate=function Ee(De,be=me.PE_PCSINFO_OPTION_DOMAIN){let Se=null,ye=null;return ge.has(De)&&(ye=ge.get(De),ye[be]&&(Se=ye[be])),Se||(Se=Z.PePCSInfo.prototype.generate(De,be),ye||(ye=[],ge.set(De,ye)),ye[be]=Se),Se}}(Y||(Y={})),function(me){me.versionString=function ge(){return Z.PeVersion.prototype.version_string()}}(ee||(ee={}));const he=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return Z},isLoaded:Q,isSupported:function $(){return!!(0,R.Z)("esri-wasm")},load:W,get PeCSTransformations(){return B},get PeDefs(){return H},get PeFactory(){return X},get PeGCSExtent(){return te},get PeGTlistExtended(){return ae},get PeGTlistExtendedEntry(){return oe},get PeGTTransformations(){return le},get PeNotationDms(){return de},get PeNotationMgrs(){return se},get PeNotationUsng(){return re},get PeNotationUtm(){return j},get PePCSInfo(){return Y},get PeVersion(){return ee},_init:ie},Symbol.toStringTag,{value:"Module"}))},29840:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>oe,a:()=>le,e:()=>te,f:()=>G,i:()=>H,p:()=>X,r:()=>Q,t:()=>Z,w:()=>$});var D=v(62208),R=v(21726);function G(de,se){const re=se&&se.url&&se.url.path;if(de&&re&&(de=(0,R.hF)(de,re,{preserveProtocolRelative:!0}),se.portalItem&&se.readResourcePaths)){const j=(0,R.PF)(de,se.portalItem.itemUrl);null!=j&&B.test(j)&&se.readResourcePaths.push(se.portalItem.resourceFromPath(j).path)}return ae(de,se&&se.portal)}function Z(de,se,re=oe.YES){if(null==de)return de;!(0,R.YP)(de)&&se&&se.blockedRelativeUrls&&se.blockedRelativeUrls.push(de);let j=(0,R.hF)(de);if(se){const Y=se.verifyItemRelativeUrls&&se.verifyItemRelativeUrls.rootPath||se.url&&se.url.path;if(Y){const ee=ae(Y,se.portal);j=(0,R.PF)(ae(j,se.portal),ee,ee),null!=j&&j!==de&&se.verifyItemRelativeUrls&&se.verifyItemRelativeUrls.writtenUrls.push(j)}}return j=te(j,se?.portal),(0,R.YP)(j)&&(j=(0,R.Fv)(j)),se?.resources&&se?.portalItem&&!(0,R.YP)(j)&&!(0,R.HK)(j)&&re===oe.YES&&se.resources.toKeep.push({resource:se.portalItem.resourceFromPath(j),compress:!1}),j}function Q(de,se,re){return G(de,re)}function $(de,se,re,j){const Y=Z(de,j);void 0!==Y&&(se[re]=Y)}const W=/\/items\/([^\/]+)\/resources\/(.*)/,B=/^\.\/resources\//;function H(de){return(de?.match(W)??null)?.[1]??null}function X(de){const se=de?.match(W)??null;if(null==se)return null;const re=se[2],j=re.lastIndexOf("/");if(-1===j){const{path:ie,extension:J}=(0,R.fZ)(re);return{prefix:null,filename:ie,extension:(0,D.Wg)(J)}}const{path:Y,extension:ee}=(0,R.fZ)(re.slice(j+1));return{prefix:re.slice(0,j),filename:Y,extension:(0,D.Wg)(ee)}}function te(de,se){return se&&!se.isPortal&&se.urlKey&&se.customBaseUrl?(0,R.Ie)(de,`${se.urlKey}.${se.customBaseUrl}`,se.portalHostname):de}function ae(de,se){if(!se||se.isPortal||!se.urlKey||!se.customBaseUrl)return de;const re=`${se.urlKey}.${se.customBaseUrl}`,j=(0,R.TI)();return(0,R.D6)(j,`${j.scheme}://${re}`)?(0,R.Ie)(de,se.portalHostname,re):(0,R.Ie)(de,re,se.portalHostname)}var oe,de;(de=oe||(oe={}))[de.YES=0]="YES",de[de.NO=1]="NO";const le=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:G,toJSON:Z,read:Q,write:$,itemIdFromResourceUrl:H,prefixAndFilenameFromResourceUrl:X,ensureMainOnlineDomain:te,get MarkKeep(){return oe}},Symbol.toStringTag,{value:"Module"}))},48977:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>J,c:()=>j,g:()=>H,j:()=>ye,k:()=>ee,m:()=>X,r:()=>xe,s:()=>B});var D=v(550),R=v(78451),G=v(28093),Z=v(39863),Q=v(84161),$=v(993);function B(Ie,Ge,Pe){Pe*=.5;const Le=Math.sin(Pe);return Ie[0]=Le*Ge[0],Ie[1]=Le*Ge[1],Ie[2]=Le*Ge[2],Ie[3]=Math.cos(Pe),Ie}function H(Ie,Ge){const Pe=2*Math.acos(Ge[3]),Le=Math.sin(Pe/2);return Le>(0,Z.g)()?(Ie[0]=Ge[0]/Le,Ie[1]=Ge[1]/Le,Ie[2]=Ge[2]/Le):(Ie[0]=1,Ie[1]=0,Ie[2]=0),Pe}function X(Ie,Ge,Pe){const Le=Ge[0],Me=Ge[1],Ne=Ge[2],Xe=Ge[3],Ye=Pe[0],Je=Pe[1],rt=Pe[2],tt=Pe[3];return Ie[0]=Le*tt+Xe*Ye+Me*rt-Ne*Je,Ie[1]=Me*tt+Xe*Je+Ne*Ye-Le*rt,Ie[2]=Ne*tt+Xe*rt+Le*Je-Me*Ye,Ie[3]=Xe*tt-Le*Ye-Me*Je-Ne*rt,Ie}function de(Ie,Ge,Pe,Le){const Me=Ge[0],Ne=Ge[1],Xe=Ge[2],Ye=Ge[3];let Je,rt,tt,et,qe,ot=Pe[0],ut=Pe[1],_t=Pe[2],Ct=Pe[3];return rt=Me*ot+Ne*ut+Xe*_t+Ye*Ct,rt<0&&(rt=-rt,ot=-ot,ut=-ut,_t=-_t,Ct=-Ct),1-rt>(0,Z.g)()?(Je=Math.acos(rt),tt=Math.sin(Je),et=Math.sin((1-Le)*Je)/tt,qe=Math.sin(Le*Je)/tt):(et=1-Le,qe=Le),Ie[0]=et*Me+qe*ot,Ie[1]=et*Ne+qe*ut,Ie[2]=et*Xe+qe*_t,Ie[3]=et*Ye+qe*Ct,Ie}function j(Ie,Ge){return Ie[0]=-Ge[0],Ie[1]=-Ge[1],Ie[2]=-Ge[2],Ie[3]=Ge[3],Ie}function Y(Ie,Ge){const Pe=Ge[0]+Ge[4]+Ge[8];let Le;if(Pe>0)Le=Math.sqrt(Pe+1),Ie[3]=.5*Le,Le=.5/Le,Ie[0]=(Ge[5]-Ge[7])*Le,Ie[1]=(Ge[6]-Ge[2])*Le,Ie[2]=(Ge[1]-Ge[3])*Le;else{let Me=0;Ge[4]>Ge[0]&&(Me=1),Ge[8]>Ge[3*Me+Me]&&(Me=2);const Ne=(Me+1)%3,Xe=(Me+2)%3;Le=Math.sqrt(Ge[3*Me+Me]-Ge[3*Ne+Ne]-Ge[3*Xe+Xe]+1),Ie[Me]=.5*Le,Le=.5/Le,Ie[3]=(Ge[3*Ne+Xe]-Ge[3*Xe+Ne])*Le,Ie[Ne]=(Ge[3*Ne+Me]+Ge[3*Me+Ne])*Le,Ie[Xe]=(Ge[3*Xe+Me]+Ge[3*Me+Xe])*Le}return Ie}function ee(Ie,Ge,Pe,Le){const Me=.5*Math.PI/180;Ge*=Me,Pe*=Me,Le*=Me;const Ne=Math.sin(Ge),Xe=Math.cos(Ge),Ye=Math.sin(Pe),Je=Math.cos(Pe),rt=Math.sin(Le),tt=Math.cos(Le);return Ie[0]=Ne*Je*tt-Xe*Ye*rt,Ie[1]=Xe*Ye*tt+Ne*Je*rt,Ie[2]=Xe*Je*rt-Ne*Ye*tt,Ie[3]=Xe*Je*tt+Ne*Ye*rt,Ie}const J=$.c,ce=$.s,ue=$.a,pe=X,he=$.b,me=$.d,ge=$.l,_e=$.e,Ee=_e,De=$.f,be=De,Se=$.n,ye=$.g,ve=$.h;function xe(Ie,Ge,Pe){const Le=(0,Q.e)(Ge,Pe);return Le<-.999999?((0,Q.f)(ze,Ke,Ge),(0,Q.u)(ze)<1e-6&&(0,Q.f)(ze,We,Ge),(0,Q.n)(ze,ze),B(Ie,ze,Math.PI),Ie):Le>.999999?(Ie[0]=0,Ie[1]=0,Ie[2]=0,Ie[3]=1,Ie):((0,Q.f)(ze,Ge,Pe),Ie[0]=ze[0],Ie[1]=ze[1],Ie[2]=ze[2],Ie[3]=1+Le,Se(Ie,Ie))}const ze=(0,G.c)(),Ke=(0,G.f)(1,0,0),We=(0,G.f)(0,1,0),Be=(0,R.a)(),Fe=(0,R.a)(),Re=(0,D.c)();Object.freeze(Object.defineProperty({__proto__:null,identity:function W(Ie){return Ie[0]=0,Ie[1]=0,Ie[2]=0,Ie[3]=1,Ie},setAxisAngle:B,getAxisAngle:H,multiply:X,rotateX:function te(Ie,Ge,Pe){Pe*=.5;const Le=Ge[0],Me=Ge[1],Ne=Ge[2],Xe=Ge[3],Ye=Math.sin(Pe),Je=Math.cos(Pe);return Ie[0]=Le*Je+Xe*Ye,Ie[1]=Me*Je+Ne*Ye,Ie[2]=Ne*Je-Me*Ye,Ie[3]=Xe*Je-Le*Ye,Ie},rotateY:function ae(Ie,Ge,Pe){Pe*=.5;const Le=Ge[0],Me=Ge[1],Ne=Ge[2],Xe=Ge[3],Ye=Math.sin(Pe),Je=Math.cos(Pe);return Ie[0]=Le*Je-Ne*Ye,Ie[1]=Me*Je+Xe*Ye,Ie[2]=Ne*Je+Le*Ye,Ie[3]=Xe*Je-Me*Ye,Ie},rotateZ:function oe(Ie,Ge,Pe){Pe*=.5;const Le=Ge[0],Me=Ge[1],Ne=Ge[2],Xe=Ge[3],Ye=Math.sin(Pe),Je=Math.cos(Pe);return Ie[0]=Le*Je+Me*Ye,Ie[1]=Me*Je-Le*Ye,Ie[2]=Ne*Je+Xe*Ye,Ie[3]=Xe*Je-Ne*Ye,Ie},calculateW:function le(Ie,Ge){const Pe=Ge[0],Le=Ge[1],Me=Ge[2];return Ie[0]=Pe,Ie[1]=Le,Ie[2]=Me,Ie[3]=Math.sqrt(Math.abs(1-Pe*Pe-Le*Le-Me*Me)),Ie},slerp:de,random:function se(Ie){const Ge=Z.R,Pe=Ge(),Le=Ge(),Me=Ge(),Ne=Math.sqrt(1-Pe),Xe=Math.sqrt(Pe);return Ie[0]=Ne*Math.sin(2*Math.PI*Le),Ie[1]=Ne*Math.cos(2*Math.PI*Le),Ie[2]=Xe*Math.sin(2*Math.PI*Me),Ie[3]=Xe*Math.cos(2*Math.PI*Me),Ie},invert:function re(Ie,Ge){const Pe=Ge[0],Le=Ge[1],Me=Ge[2],Ne=Ge[3],Xe=Pe*Pe+Le*Le+Me*Me+Ne*Ne,Ye=Xe?1/Xe:0;return Ie[0]=-Pe*Ye,Ie[1]=-Le*Ye,Ie[2]=-Me*Ye,Ie[3]=Ne*Ye,Ie},conjugate:j,fromMat3:Y,fromEuler:ee,str:function ie(Ie){return"quat("+Ie[0]+", "+Ie[1]+", "+Ie[2]+", "+Ie[3]+")"},copy:J,set:ce,add:ue,mul:pe,scale:he,dot:me,lerp:ge,length:_e,len:Ee,squaredLength:De,sqrLen:be,normalize:Se,exactEquals:ye,equals:ve,rotationTo:xe,sqlerp:function Ce(Ie,Ge,Pe,Le,Me,Ne){return de(Be,Ge,Me,Ne),de(Fe,Pe,Le,Ne),de(Ie,Be,Fe,2*Ne*(1-Ne)),Ie},setAxes:function je(Ie,Ge,Pe,Le){const Me=Re;return Me[0]=Pe[0],Me[3]=Pe[1],Me[6]=Pe[2],Me[1]=Le[0],Me[4]=Le[1],Me[7]=Le[2],Me[2]=-Ge[0],Me[5]=-Ge[1],Me[8]=-Ge[2],Se(Ie,Y(Ie,Me))}},Symbol.toStringTag,{value:"Module"}))},56729:(nt,Ae,v)=>{"use strict";function D(){const $=new Float32Array(4);return $[3]=1,$}function R($){const W=new Float32Array(4);return W[0]=$[0],W[1]=$[1],W[2]=$[2],W[3]=$[3],W}function Z($,W){return new Float32Array($,W,4)}v.d(Ae,{a:()=>Z,b:()=>R,c:()=>D}),Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:function G($,W,B,H){const X=new Float32Array(4);return X[0]=$,X[1]=W,X[2]=B,X[3]=H,X},createView:Z},Symbol.toStringTag,{value:"Module"}))},78451:(nt,Ae,v)=>{"use strict";function D(){return[0,0,0,1]}function R(W){return[W[0],W[1],W[2],W[3]]}function Z(W,B){return new Float64Array(W,B,4)}v.d(Ae,{I:()=>Q,a:()=>D,b:()=>R,c:()=>Z});const Q=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:function G(W,B,H,X){return[W,B,H,X]},createView:Z,IDENTITY:Q},Symbol.toStringTag,{value:"Module"}))},98148:(nt,Ae,v)=>{"use strict";function R(Z,Q){const $=Z.count;Q||(Q=new Z.TypedArrayConstructor($));for(let W=0;W<$;W++)Q[W]=Z.get(W);return Q}v.d(Ae,{m:()=>R}),Object.freeze(Object.defineProperty({__proto__:null,copy:function D(Z,Q,$){const W=Z.typedBuffer,B=Z.typedBufferStride,H=Q.typedBuffer,X=Q.typedBufferStride,te=$?$.count:Q.count;let ae=($&&$.dstIndex?$.dstIndex:0)*B,oe=($&&$.srcIndex?$.srcIndex:0)*X;for(let le=0;le<te;++le)W[ae]=H[oe],ae+=B,oe+=X},makeDense:R},Symbol.toStringTag,{value:"Module"}))},97126:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>ee,b:()=>_e,c:()=>le,d:()=>be,e:()=>Y,f:()=>J,g:()=>ie,h:()=>de,i:()=>pe,j:()=>me,k:()=>se,l:()=>j,m:()=>Ke,s:()=>Be,t:()=>Ce,w:()=>re}),v(8314);var R=v(63290),G=v(21286),Z=v(62208),Q=v(28347),$=v(84161),W=v(28093),B=v(993),H=v(4794),X=v(78172),te=v(70562),ae=v(34054),oe=v(26242);function le(){return(0,H.c)()}function de(Fe,je=le()){return(0,B.c)(je,Fe)}function se(Fe,je){return(0,H.f)(Fe[0],Fe[1],Fe[2],je)}function re(Fe){return Fe}function j(Fe){Fe[0]=Fe[1]=Fe[2]=Fe[3]=0}function Y(Fe,je){return Fe[0]=Fe[1]=Fe[2]=0,Fe[3]=je,Fe}function ee(Fe){return Fe[3]}function ie(Fe){return Fe}function J(Fe,je,Re,He){return(0,H.f)(Fe,je,Re,He)}function pe(Fe,je,Re){if((0,Z.Wi)(je))return!1;const{origin:He,direction:Ie}=je,Ge=he;Ge[0]=He[0]-Fe[0],Ge[1]=He[1]-Fe[1],Ge[2]=He[2]-Fe[2];const Pe=Ie[0]*Ie[0]+Ie[1]*Ie[1]+Ie[2]*Ie[2];if(0===Pe)return!1;const Le=2*(Ie[0]*Ge[0]+Ie[1]*Ge[1]+Ie[2]*Ge[2]),Me=Le*Le-4*Pe*(Ge[0]*Ge[0]+Ge[1]*Ge[1]+Ge[2]*Ge[2]-Fe[3]*Fe[3]);if(Me<0)return!1;const Ne=Math.sqrt(Me);let Xe=(-Le-Ne)/(2*Pe);const Ye=(-Le+Ne)/(2*Pe);return(Xe<0||Ye<Xe&&Ye>0)&&(Xe=Ye),!(Xe<0||(Re&&(Re[0]=He[0]+Ie[0]*Xe,Re[1]=He[1]+Ie[1]*Xe,Re[2]=He[2]+Ie[2]*Xe),0))}const he=(0,W.c)();function me(Fe,je){return pe(Fe,je,null)}function _e(Fe,je,Re){const He=oe.WM.get(),Ie=oe.MP.get();(0,$.f)(He,je.origin,je.direction);const Ge=ee(Fe);(0,$.f)(Re,He,je.origin),(0,$.g)(Re,Re,1/(0,$.l)(Re)*Ge);const Pe=Se(Fe,je.origin),Le=(0,ae.EU)(je.origin,Re);return(0,Q.d)(Ie,Le+Pe,He),(0,$.m)(Re,Re,Ie),Re}function De(Fe,je,Re){const He=(0,$.b)(oe.WM.get(),je,Fe),Ie=(0,$.g)(oe.WM.get(),He,Fe[3]/(0,$.l)(He));return(0,$.a)(Re,Ie,Fe)}function be(Fe,je){const Re=(0,$.b)(oe.WM.get(),je,Fe),He=(0,$.p)(Re);return Math.sqrt(Math.abs(He-Fe[3]*Fe[3]))}function Se(Fe,je){const Re=(0,$.b)(oe.WM.get(),je,Fe),He=(0,$.l)(Re),Ie=ee(Fe),Ge=Ie+Math.abs(Ie-He);return(0,G.ZF)(Ie/Ge)}const ye=(0,W.c)();function ve(Fe,je,Re,He){const Ie=(0,$.b)(ye,je,Fe);switch(Re){case X.R.X:{const Ge=(0,G.jE)(Ie,ye)[2];return(0,$.s)(He,-Math.sin(Ge),Math.cos(Ge),0)}case X.R.Y:{const Ge=(0,G.jE)(Ie,ye),Pe=Ge[1],Le=Ge[2],Me=Math.sin(Pe);return(0,$.s)(He,-Me*Math.cos(Le),-Me*Math.sin(Le),Math.cos(Pe))}case X.R.Z:return(0,$.n)(He,Ie);default:return}}function xe(Fe,je){const Re=(0,$.b)(We,je,Fe);return(0,$.l)(Re)-Fe[3]}function Ke(Fe,je){const Re=(0,$.d)(Fe,je),He=ee(Fe);return Re<=He*He}const We=(0,W.c)(),Ce=le(),Be=Object.freeze(Object.defineProperty({__proto__:null,create:le,copy:de,fromCenterAndRadius:se,wrap:re,clear:j,fromRadius:Y,getRadius:ee,getCenter:ie,fromValues:J,elevate:function ce(Fe,je,Re){return Fe!==Re&&(0,$.c)(Re,Fe),Re[3]=Fe[3]+je,Re},setExtent:function ue(Fe,je,Re){return R.Z.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),Fe===Re?Re:de(Fe,Re)},intersectRay:pe,intersectsRay:me,intersectRayClosestSilhouette:function ge(Fe,je,Re){if(pe(Fe,je,Re))return Re;const He=_e(Fe,je,oe.WM.get());return(0,$.a)(Re,je.origin,(0,$.g)(oe.WM.get(),je.direction,(0,$.i)(je.origin,He)/(0,$.l)(je.direction))),Re},closestPointOnSilhouette:_e,closestPoint:function Ee(Fe,je,Re){return pe(Fe,je,Re)?Re:((0,te.JI)(je,Fe,Re),De(Fe,Re,Re))},projectPoint:De,distanceToSilhouette:be,angleToSilhouette:Se,axisAt:ve,altitudeAt:xe,setAltitudeAt:function ze(Fe,je,Re,He){const Ie=xe(Fe,je),Ge=ve(Fe,je,X.R.Z,We),Pe=(0,$.g)(We,Ge,Re-Ie);return(0,$.a)(He,je,Pe)},containsPoint:Ke,tmpSphere:Ce},Symbol.toStringTag,{value:"Module"}))},17626:(nt,Ae,v)=>{"use strict";function D(R,G,Z,Q){var $,W=arguments.length,B=W<3?G:null===Q?Q=Object.getOwnPropertyDescriptor(G,Z):Q;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)B=Reflect.decorate(R,G,Z,Q);else for(var H=R.length-1;H>=0;H--)($=R[H])&&(B=(W<3?$(B):W>3?$(G,Z,B):$(G,Z))||B);return W>3&&B&&Object.defineProperty(G,Z,B),B}v.d(Ae,{_:()=>D})},67831:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>Q,b:()=>oe,c:()=>R,d:()=>de,e:()=>ze,f:()=>ie,g:()=>ce,h:()=>J,i:()=>re,j:()=>Z,k:()=>se,l:()=>ue,m:()=>Se,n:()=>Y,o:()=>ye,p:()=>Ce,q:()=>he,r:()=>Ee,s:()=>G,t:()=>me,u:()=>ve,v:()=>j,w:()=>le});var D=v(39863);function R(Re,He){return Re[0]=He[0],Re[1]=He[1],Re}function G(Re,He,Ie){return Re[0]=He,Re[1]=Ie,Re}function Z(Re,He,Ie){return Re[0]=He[0]+Ie[0],Re[1]=He[1]+Ie[1],Re}function Q(Re,He,Ie){return Re[0]=He[0]-Ie[0],Re[1]=He[1]-Ie[1],Re}function $(Re,He,Ie){return Re[0]=He[0]*Ie[0],Re[1]=He[1]*Ie[1],Re}function W(Re,He,Ie){return Re[0]=He[0]/Ie[0],Re[1]=He[1]/Ie[1],Re}function oe(Re,He,Ie){return Re[0]=He[0]*Ie,Re[1]=He[1]*Ie,Re}function le(Re,He,Ie,Ge){return Re[0]=He[0]+Ie[0]*Ge,Re[1]=He[1]+Ie[1]*Ge,Re}function de(Re,He){const Ie=He[0]-Re[0],Ge=He[1]-Re[1];return Math.sqrt(Ie*Ie+Ge*Ge)}function se(Re,He){const Ie=He[0]-Re[0],Ge=He[1]-Re[1];return Ie*Ie+Ge*Ge}function re(Re){const He=Re[0],Ie=Re[1];return Math.sqrt(He*He+Ie*Ie)}function j(Re){const He=Re[0],Ie=Re[1];return He*He+Ie*Ie}function Y(Re,He){return Re[0]=-He[0],Re[1]=-He[1],Re}function ie(Re,He){const Ie=He[0],Ge=He[1];let Pe=Ie*Ie+Ge*Ge;return Pe>0&&(Pe=1/Math.sqrt(Pe),Re[0]=He[0]*Pe,Re[1]=He[1]*Pe),Re}function J(Re,He){return Re[0]*He[0]+Re[1]*He[1]}function ce(Re,He,Ie){const Ge=He[0]*Ie[1]-He[1]*Ie[0];return Re[0]=Re[1]=0,Re[2]=Ge,Re}function ue(Re,He,Ie,Ge){const Pe=He[0],Le=He[1];return Re[0]=Pe+Ge*(Ie[0]-Pe),Re[1]=Le+Ge*(Ie[1]-Le),Re}function he(Re,He,Ie){const Ge=He[0],Pe=He[1];return Re[0]=Ie[0]*Ge+Ie[2]*Pe,Re[1]=Ie[1]*Ge+Ie[3]*Pe,Re}function me(Re,He,Ie){const Ge=He[0],Pe=He[1];return Re[0]=Ie[0]*Ge+Ie[2]*Pe+Ie[4],Re[1]=Ie[1]*Ge+Ie[3]*Pe+Ie[5],Re}function Ee(Re,He,Ie,Ge){const Pe=He[0]-Ie[0],Le=He[1]-Ie[1],Me=Math.sin(Ge),Ne=Math.cos(Ge);return Re[0]=Pe*Ne-Le*Me+Ie[0],Re[1]=Pe*Me+Le*Ne+Ie[1],Re}function Se(Re,He){return Re[0]===He[0]&&Re[1]===He[1]}function ye(Re,He){const Ie=Re[0],Ge=Re[1],Pe=He[0],Le=He[1],Me=(0,D.g)();return Math.abs(Ie-Pe)<=Me*Math.max(1,Math.abs(Ie),Math.abs(Pe))&&Math.abs(Ge-Le)<=Me*Math.max(1,Math.abs(Ge),Math.abs(Le))}function ve(Re,He,Ie,Ge,Pe){let Le=He[0]-Ie[0],Me=He[1]-Ie[1];const Ne=(Ge[0]*Le+Ge[1]*Me)*(Pe-1);return Le=Ge[0]*Ne,Me=Ge[1]*Ne,Re[0]=He[0]+Le,Re[1]=He[1]+Me,Re}const ze=Q,Ce=de;Object.freeze(Object.defineProperty({__proto__:null,copy:R,set:G,add:Z,subtract:Q,multiply:$,divide:W,ceil:function B(Re,He){return Re[0]=Math.ceil(He[0]),Re[1]=Math.ceil(He[1]),Re},floor:function H(Re,He){return Re[0]=Math.floor(He[0]),Re[1]=Math.floor(He[1]),Re},min:function X(Re,He,Ie){return Re[0]=Math.min(He[0],Ie[0]),Re[1]=Math.min(He[1],Ie[1]),Re},max:function te(Re,He,Ie){return Re[0]=Math.max(He[0],Ie[0]),Re[1]=Math.max(He[1],Ie[1]),Re},round:function ae(Re,He){return Re[0]=Math.round(He[0]),Re[1]=Math.round(He[1]),Re},scale:oe,scaleAndAdd:le,distance:de,squaredDistance:se,length:re,squaredLength:j,negate:Y,inverse:function ee(Re,He){return Re[0]=1/He[0],Re[1]=1/He[1],Re},normalize:ie,dot:J,cross:ce,lerp:ue,random:function pe(Re,He){He=He||1;const Ie=2*(0,D.R)()*Math.PI;return Re[0]=Math.cos(Ie)*He,Re[1]=Math.sin(Ie)*He,Re},transformMat2:he,transformMat2d:me,transformMat3:function ge(Re,He,Ie){const Ge=He[0],Pe=He[1];return Re[0]=Ie[0]*Ge+Ie[3]*Pe+Ie[6],Re[1]=Ie[1]*Ge+Ie[4]*Pe+Ie[7],Re},transformMat4:function _e(Re,He,Ie){const Ge=He[0],Pe=He[1];return Re[0]=Ie[0]*Ge+Ie[4]*Pe+Ie[12],Re[1]=Ie[1]*Ge+Ie[5]*Pe+Ie[13],Re},rotate:Ee,angle:function De(Re,He){const Ie=Re[0],Ge=Re[1],Pe=He[0],Le=He[1];let Me=Ie*Ie+Ge*Ge;Me>0&&(Me=1/Math.sqrt(Me));let Ne=Pe*Pe+Le*Le;Ne>0&&(Ne=1/Math.sqrt(Ne));const Xe=(Ie*Pe+Ge*Le)*Me*Ne;return Xe>1?0:Xe<-1?Math.PI:Math.acos(Xe)},str:function be(Re){return"vec2("+Re[0]+", "+Re[1]+")"},exactEquals:Se,equals:ye,projectAndScale:ve,len:re,sub:ze,mul:$,div:W,dist:Ce,sqrDist:se,sqrLen:j},Symbol.toStringTag,{value:"Module"}))},35995:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>Z,n:()=>G});var D=v(81096);function R($,W,B){const H=$.typedBuffer,X=$.typedBufferStride,te=W.typedBuffer,ae=W.typedBufferStride,oe=B?B.count:W.count;let le=(B&&B.dstIndex?B.dstIndex:0)*X,de=(B&&B.srcIndex?B.srcIndex:0)*ae;for(let se=0;se<oe;++se)H[le]=te[de],H[le+1]=te[de+1],le+=X,de+=ae}function G($,W,B){const H=$.typedBuffer,X=$.typedBufferStride,te=W.typedBuffer,ae=W.typedBufferStride,oe=B?B.count:W.count;let le=(B&&B.dstIndex?B.dstIndex:0)*X,de=(B&&B.srcIndex?B.srcIndex:0)*ae;if((0,D.U)(W.elementType)){const se=(0,D.Op)(W.elementType);if((0,D.B3)(W.elementType))for(let re=0;re<oe;++re)H[le]=Math.max(te[de]/se,-1),H[le+1]=Math.max(te[de+1]/se,-1),le+=X,de+=ae;else for(let re=0;re<oe;++re)H[le]=te[de]/se,H[le+1]=te[de+1]/se,le+=X,de+=ae}else R($,W,B);return $}function Z($,W,B,H){const X=$.typedBuffer,te=$.typedBufferStride,ae=H?.count??$.count;let oe=(H?.dstIndex??0)*te;for(let le=0;le<ae;++le)X[oe]=W,X[oe+1]=B,oe+=te}Object.freeze(Object.defineProperty({__proto__:null,copy:R,normalizeIntegerBuffer:G,fill:Z},Symbol.toStringTag,{value:"Module"}))},9545:(nt,Ae,v)=>{"use strict";function D(){return new Float32Array(2)}function G(le,de){const se=new Float32Array(2);return se[0]=le,se[1]=de,se}function Q(){return D()}function $(){return G(1,1)}function W(){return G(1,0)}function B(){return G(0,1)}v.d(Ae,{O:()=>X,Z:()=>H,c:()=>D,f:()=>G});const H=Q(),X=$(),te=W(),ae=B();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:function R(le){const de=new Float32Array(2);return de[0]=le[0],de[1]=le[1],de},fromValues:G,createView:function Z(le,de){return new Float32Array(le,de,2)},zeros:Q,ones:$,unitX:W,unitY:B,ZEROS:H,ONES:X,UNIT_X:te,UNIT_Y:ae},Symbol.toStringTag,{value:"Module"}))},99770:(nt,Ae,v)=>{"use strict";function D(){return[0,0]}function R(de){return[de[0],de[1]]}function G(de,se){return[de,se]}function Z(de){const se=[0,0],re=Math.min(2,de.length);for(let j=0;j<re;++j)se[j]=de[j];return se}function Q(de,se){return new Float64Array(de,se,2)}function W(){return G(1,1)}function B(){return G(1,0)}function H(){return G(0,1)}v.d(Ae,{O:()=>te,Z:()=>X,a:()=>D,b:()=>Z,c:()=>Q,d:()=>R,f:()=>G});const X=[0,0],te=W(),ae=B(),oe=H();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,fromArray:Z,createView:Q,zeros:function $(){return[0,0]},ones:W,unitX:B,unitY:H,ZEROS:X,ONES:te,UNIT_X:ae,UNIT_Y:oe},Symbol.toStringTag,{value:"Module"}))},84161:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>oe,B:()=>B,C:()=>H,D:()=>Me,E:()=>Pe,F:()=>Fe,G:()=>Ne,H:()=>te,a:()=>$,b:()=>W,c:()=>Z,d:()=>ee,e:()=>pe,f:()=>he,g:()=>re,h:()=>me,i:()=>Y,j:()=>Ge,k:()=>Be,l:()=>G,m:()=>De,n:()=>ue,o:()=>J,p:()=>ie,q:()=>Se,r:()=>je,s:()=>Q,t:()=>be,u:()=>Le,v:()=>ze,w:()=>ae,x:()=>le,y:()=>Re,z:()=>j});var D=v(28093),R=v(39863);function G(Xe){const Ye=Xe[0],Je=Xe[1],rt=Xe[2];return Math.sqrt(Ye*Ye+Je*Je+rt*rt)}function Z(Xe,Ye){return Xe[0]=Ye[0],Xe[1]=Ye[1],Xe[2]=Ye[2],Xe}function Q(Xe,Ye,Je,rt){return Xe[0]=Ye,Xe[1]=Je,Xe[2]=rt,Xe}function $(Xe,Ye,Je){return Xe[0]=Ye[0]+Je[0],Xe[1]=Ye[1]+Je[1],Xe[2]=Ye[2]+Je[2],Xe}function W(Xe,Ye,Je){return Xe[0]=Ye[0]-Je[0],Xe[1]=Ye[1]-Je[1],Xe[2]=Ye[2]-Je[2],Xe}function B(Xe,Ye,Je){return Xe[0]=Ye[0]*Je[0],Xe[1]=Ye[1]*Je[1],Xe[2]=Ye[2]*Je[2],Xe}function H(Xe,Ye,Je){return Xe[0]=Ye[0]/Je[0],Xe[1]=Ye[1]/Je[1],Xe[2]=Ye[2]/Je[2],Xe}function te(Xe,Ye){return Xe[0]=Math.floor(Ye[0]),Xe[1]=Math.floor(Ye[1]),Xe[2]=Math.floor(Ye[2]),Xe}function ae(Xe,Ye){return Xe[0]=Math.abs(Ye[0]),Xe[1]=Math.abs(Ye[1]),Xe[2]=Math.abs(Ye[2]),Xe}function oe(Xe,Ye){return Xe[0]=Math.sign(Ye[0]),Xe[1]=Math.sign(Ye[1]),Xe[2]=Math.sign(Ye[2]),Xe}function le(Xe,Ye,Je){return Xe[0]=Math.min(Ye[0],Je[0]),Xe[1]=Math.min(Ye[1],Je[1]),Xe[2]=Math.min(Ye[2],Je[2]),Xe}function re(Xe,Ye,Je){return Xe[0]=Ye[0]*Je,Xe[1]=Ye[1]*Je,Xe[2]=Ye[2]*Je,Xe}function j(Xe,Ye,Je,rt){return Xe[0]=Ye[0]+Je[0]*rt,Xe[1]=Ye[1]+Je[1]*rt,Xe[2]=Ye[2]+Je[2]*rt,Xe}function Y(Xe,Ye){const Je=Ye[0]-Xe[0],rt=Ye[1]-Xe[1],tt=Ye[2]-Xe[2];return Math.sqrt(Je*Je+rt*rt+tt*tt)}function ee(Xe,Ye){const Je=Ye[0]-Xe[0],rt=Ye[1]-Xe[1],tt=Ye[2]-Xe[2];return Je*Je+rt*rt+tt*tt}function ie(Xe){const Ye=Xe[0],Je=Xe[1],rt=Xe[2];return Ye*Ye+Je*Je+rt*rt}function J(Xe,Ye){return Xe[0]=-Ye[0],Xe[1]=-Ye[1],Xe[2]=-Ye[2],Xe}function ue(Xe,Ye){const Je=Ye[0],rt=Ye[1],tt=Ye[2];let et=Je*Je+rt*rt+tt*tt;return et>0&&(et=1/Math.sqrt(et),Xe[0]=Ye[0]*et,Xe[1]=Ye[1]*et,Xe[2]=Ye[2]*et),Xe}function pe(Xe,Ye){return Xe[0]*Ye[0]+Xe[1]*Ye[1]+Xe[2]*Ye[2]}function he(Xe,Ye,Je){const rt=Ye[0],tt=Ye[1],et=Ye[2],qe=Je[0],ot=Je[1],ut=Je[2];return Xe[0]=tt*ut-et*ot,Xe[1]=et*qe-rt*ut,Xe[2]=rt*ot-tt*qe,Xe}function me(Xe,Ye,Je,rt){const tt=Ye[0],et=Ye[1],qe=Ye[2];return Xe[0]=tt+rt*(Je[0]-tt),Xe[1]=et+rt*(Je[1]-et),Xe[2]=qe+rt*(Je[2]-qe),Xe}function De(Xe,Ye,Je){const rt=Ye[0],tt=Ye[1],et=Ye[2];return Xe[0]=Je[0]*rt+Je[4]*tt+Je[8]*et+Je[12],Xe[1]=Je[1]*rt+Je[5]*tt+Je[9]*et+Je[13],Xe[2]=Je[2]*rt+Je[6]*tt+Je[10]*et+Je[14],Xe}function be(Xe,Ye,Je){const rt=Ye[0],tt=Ye[1],et=Ye[2];return Xe[0]=rt*Je[0]+tt*Je[3]+et*Je[6],Xe[1]=rt*Je[1]+tt*Je[4]+et*Je[7],Xe[2]=rt*Je[2]+tt*Je[5]+et*Je[8],Xe}function Se(Xe,Ye,Je){const rt=Je[0],tt=Je[1],et=Je[2],ot=Ye[0],ut=Ye[1],_t=Ye[2];let Ct=tt*_t-et*ut,vt=et*ot-rt*_t,Lt=rt*ut-tt*ot,jt=tt*Lt-et*vt,$t=et*Ct-rt*Lt,Wt=rt*vt-tt*Ct;const pr=2*Je[3];return Ct*=pr,vt*=pr,Lt*=pr,jt*=2,$t*=2,Wt*=2,Xe[0]=ot+Ct+jt,Xe[1]=ut+vt+$t,Xe[2]=_t+Lt+Wt,Xe}function ze(Xe,Ye){Z(Ke,Xe),Z(We,Ye),ue(Ke,Ke),ue(We,We);const Je=pe(Ke,We);return Je>1?0:Je<-1?Math.PI:Math.acos(Je)}const Ke=(0,D.c)(),We=(0,D.c)();function Be(Xe,Ye){return Xe[0]===Ye[0]&&Xe[1]===Ye[1]&&Xe[2]===Ye[2]}function Fe(Xe,Ye){if(Xe===Ye)return!0;const Je=Xe[0],rt=Xe[1],tt=Xe[2],et=Ye[0],qe=Ye[1],ot=Ye[2],ut=(0,R.g)();return Math.abs(Je-et)<=ut*Math.max(1,Math.abs(Je),Math.abs(et))&&Math.abs(rt-qe)<=ut*Math.max(1,Math.abs(rt),Math.abs(qe))&&Math.abs(tt-ot)<=ut*Math.max(1,Math.abs(tt),Math.abs(ot))}function je(Xe,Ye,Je){const rt=Je[0]-Ye[0],tt=Je[1]-Ye[1],et=Je[2]-Ye[2];let qe=rt*rt+tt*tt+et*et;return qe>0?(qe=1/Math.sqrt(qe),Xe[0]=rt*qe,Xe[1]=tt*qe,Xe[2]=et*qe,Xe):(Xe[0]=0,Xe[1]=0,Xe[2]=0,Xe)}const Re=W,Ge=Y,Pe=ee,Le=G,Me=ie,Ne=Object.freeze(Object.defineProperty({__proto__:null,length:G,copy:Z,set:Q,add:$,subtract:W,multiply:B,divide:H,ceil:function X(Xe,Ye){return Xe[0]=Math.ceil(Ye[0]),Xe[1]=Math.ceil(Ye[1]),Xe[2]=Math.ceil(Ye[2]),Xe},floor:te,abs:ae,sign:oe,min:le,max:function de(Xe,Ye,Je){return Xe[0]=Math.max(Ye[0],Je[0]),Xe[1]=Math.max(Ye[1],Je[1]),Xe[2]=Math.max(Ye[2],Je[2]),Xe},round:function se(Xe,Ye){return Xe[0]=Math.round(Ye[0]),Xe[1]=Math.round(Ye[1]),Xe[2]=Math.round(Ye[2]),Xe},scale:re,scaleAndAdd:j,distance:Y,squaredDistance:ee,squaredLength:ie,negate:J,inverse:function ce(Xe,Ye){return Xe[0]=1/Ye[0],Xe[1]=1/Ye[1],Xe[2]=1/Ye[2],Xe},normalize:ue,dot:pe,cross:he,lerp:me,hermite:function ge(Xe,Ye,Je,rt,tt,et){const qe=et*et,ot=qe*(2*et-3)+1,ut=qe*(et-2)+et,_t=qe*(et-1),Ct=qe*(3-2*et);return Xe[0]=Ye[0]*ot+Je[0]*ut+rt[0]*_t+tt[0]*Ct,Xe[1]=Ye[1]*ot+Je[1]*ut+rt[1]*_t+tt[1]*Ct,Xe[2]=Ye[2]*ot+Je[2]*ut+rt[2]*_t+tt[2]*Ct,Xe},bezier:function _e(Xe,Ye,Je,rt,tt,et){const qe=1-et,ot=qe*qe,ut=et*et,_t=ot*qe,Ct=3*et*ot,vt=3*ut*qe,Lt=ut*et;return Xe[0]=Ye[0]*_t+Je[0]*Ct+rt[0]*vt+tt[0]*Lt,Xe[1]=Ye[1]*_t+Je[1]*Ct+rt[1]*vt+tt[1]*Lt,Xe[2]=Ye[2]*_t+Je[2]*Ct+rt[2]*vt+tt[2]*Lt,Xe},random:function Ee(Xe,Ye){Ye=Ye||1;const Je=R.R,rt=2*Je()*Math.PI,tt=2*Je()-1,et=Math.sqrt(1-tt*tt)*Ye;return Xe[0]=Math.cos(rt)*et,Xe[1]=Math.sin(rt)*et,Xe[2]=tt*Ye,Xe},transformMat4:De,transformMat3:be,transformQuat:Se,rotateX:function ye(Xe,Ye,Je,rt){const tt=[],et=[];return tt[0]=Ye[0]-Je[0],tt[1]=Ye[1]-Je[1],tt[2]=Ye[2]-Je[2],et[0]=tt[0],et[1]=tt[1]*Math.cos(rt)-tt[2]*Math.sin(rt),et[2]=tt[1]*Math.sin(rt)+tt[2]*Math.cos(rt),Xe[0]=et[0]+Je[0],Xe[1]=et[1]+Je[1],Xe[2]=et[2]+Je[2],Xe},rotateY:function ve(Xe,Ye,Je,rt){const tt=[],et=[];return tt[0]=Ye[0]-Je[0],tt[1]=Ye[1]-Je[1],tt[2]=Ye[2]-Je[2],et[0]=tt[2]*Math.sin(rt)+tt[0]*Math.cos(rt),et[1]=tt[1],et[2]=tt[2]*Math.cos(rt)-tt[0]*Math.sin(rt),Xe[0]=et[0]+Je[0],Xe[1]=et[1]+Je[1],Xe[2]=et[2]+Je[2],Xe},rotateZ:function xe(Xe,Ye,Je,rt){const tt=[],et=[];return tt[0]=Ye[0]-Je[0],tt[1]=Ye[1]-Je[1],tt[2]=Ye[2]-Je[2],et[0]=tt[0]*Math.cos(rt)-tt[1]*Math.sin(rt),et[1]=tt[0]*Math.sin(rt)+tt[1]*Math.cos(rt),et[2]=tt[2],Xe[0]=et[0]+Je[0],Xe[1]=et[1]+Je[1],Xe[2]=et[2]+Je[2],Xe},angle:ze,str:function Ce(Xe){return"vec3("+Xe[0]+", "+Xe[1]+", "+Xe[2]+")"},exactEquals:Be,equals:Fe,direction:je,sub:Re,mul:B,div:H,dist:Ge,sqrDist:Pe,len:Le,sqrLen:Me},Symbol.toStringTag,{value:"Module"}))},79800:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>G,b:()=>$,n:()=>Q,s:()=>Z,t:()=>R});var D=v(96286);function R(B,H,X){if(B.count!==H.count)return void D.c.error("source and destination buffers need to have the same number of elements");const te=B.count,ae=X[0],oe=X[1],le=X[2],de=X[4],se=X[5],re=X[6],j=X[8],Y=X[9],ee=X[10],ie=X[12],J=X[13],ce=X[14],ue=B.typedBuffer,pe=B.typedBufferStride,he=H.typedBuffer,me=H.typedBufferStride;for(let ge=0;ge<te;ge++){const _e=ge*pe,Ee=ge*me,De=he[Ee],be=he[Ee+1],Se=he[Ee+2];ue[_e]=ae*De+de*be+j*Se+ie,ue[_e+1]=oe*De+se*be+Y*Se+J,ue[_e+2]=le*De+re*be+ee*Se+ce}}function G(B,H,X){if(B.count!==H.count)return void D.c.error("source and destination buffers need to have the same number of elements");const te=B.count,ae=X[0],oe=X[1],le=X[2],de=X[3],se=X[4],re=X[5],j=X[6],Y=X[7],ee=X[8],ie=B.typedBuffer,J=B.typedBufferStride,ce=H.typedBuffer,ue=H.typedBufferStride;for(let pe=0;pe<te;pe++){const he=pe*J,me=pe*ue,ge=ce[me],_e=ce[me+1],Ee=ce[me+2];ie[he]=ae*ge+de*_e+j*Ee,ie[he+1]=oe*ge+se*_e+Y*Ee,ie[he+2]=le*ge+re*_e+ee*Ee}}function Z(B,H,X){const te=Math.min(B.count,H.count),ae=B.typedBuffer,oe=B.typedBufferStride,le=H.typedBuffer,de=H.typedBufferStride;for(let se=0;se<te;se++){const re=se*oe,j=se*de;ae[re]=X*le[j],ae[re+1]=X*le[j+1],ae[re+2]=X*le[j+2]}}function Q(B,H){const X=Math.min(B.count,H.count),te=B.typedBuffer,ae=B.typedBufferStride,oe=H.typedBuffer,le=H.typedBufferStride;for(let de=0;de<X;de++){const se=de*ae,re=de*le,j=oe[re],Y=oe[re+1],ee=oe[re+2],ie=j*j+Y*Y+ee*ee;if(ie>0){const J=1/Math.sqrt(ie);te[se]=J*j,te[se+1]=J*Y,te[se+2]=J*ee}}}function $(B,H,X){const te=Math.min(B.count,H.count),ae=B.typedBuffer,oe=B.typedBufferStride,le=H.typedBuffer,de=H.typedBufferStride;for(let se=0;se<te;se++){const re=se*oe,j=se*de;ae[re]=le[j]>>X,ae[re+1]=le[j+1]>>X,ae[re+2]=le[j+2]>>X}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:R,transformMat3:G,scale:Z,normalize:Q,shiftRight:$},Symbol.toStringTag,{value:"Module"}))},9554:(nt,Ae,v)=>{"use strict";function D(Z,Q,$){const W=Z.typedBuffer,B=Z.typedBufferStride,H=Q.typedBuffer,X=Q.typedBufferStride,te=$?$.count:Q.count;let ae=($&&$.dstIndex?$.dstIndex:0)*B,oe=($&&$.srcIndex?$.srcIndex:0)*X;for(let le=0;le<te;++le)W[ae]=H[oe],W[ae+1]=H[oe+1],W[ae+2]=H[oe+2],ae+=B,oe+=X}function R(Z,Q,$,W,B){const H=Z.typedBuffer,X=Z.typedBufferStride,te=B?.count??Z.count;let ae=(B?.dstIndex??0)*X;for(let oe=0;oe<te;++oe)H[ae]=Q,H[ae+1]=$,H[ae+2]=W,ae+=X}v.d(Ae,{c:()=>D,f:()=>R}),Object.freeze(Object.defineProperty({__proto__:null,copy:D,fill:R},Symbol.toStringTag,{value:"Module"}))},14658:(nt,Ae,v)=>{"use strict";function D(){return new Float32Array(3)}function R(se){const re=new Float32Array(3);return re[0]=se[0],re[1]=se[1],re[2]=se[2],re}function G(se,re,j){const Y=new Float32Array(3);return Y[0]=se,Y[1]=re,Y[2]=j,Y}function Z(se,re){return new Float32Array(se,re,3)}function Q(){return D()}function $(){return G(1,1,1)}function W(){return G(1,0,0)}function B(){return G(0,1,0)}function H(){return G(0,0,1)}v.d(Ae,{a:()=>Z,b:()=>R,c:()=>D,f:()=>G,z:()=>Q});const X=Q(),te=$(),ae=W(),oe=B(),le=H();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,createView:Z,zeros:Q,ones:$,unitX:W,unitY:B,unitZ:H,ZEROS:X,ONES:te,UNIT_X:ae,UNIT_Y:oe,UNIT_Z:le},Symbol.toStringTag,{value:"Module"}))},28093:(nt,Ae,v)=>{"use strict";function D(){return[0,0,0]}function R(re){return[re[0],re[1],re[2]]}function G(re,j,Y){return[re,j,Y]}function Z(re){const j=[0,0,0],Y=Math.min(3,re.length);for(let ee=0;ee<Y;++ee)j[ee]=re[ee];return j}function Q(re,j){return new Float64Array(re,j,3)}function W(){return G(1,1,1)}function B(){return G(1,0,0)}function H(){return G(0,1,0)}function X(){return G(0,0,1)}v.d(Ae,{O:()=>ae,U:()=>de,Z:()=>te,a:()=>R,b:()=>Q,c:()=>D,d:()=>Z,f:()=>G,u:()=>X});const te=[0,0,0],ae=W(),oe=B(),le=H(),de=X();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,fromArray:Z,createView:Q,zeros:function $(){return[0,0,0]},ones:W,unitX:B,unitY:H,unitZ:X,ZEROS:te,ONES:ae,UNIT_X:oe,UNIT_Y:le,UNIT_Z:de},Symbol.toStringTag,{value:"Module"}))},993:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>Z,b:()=>oe,c:()=>R,d:()=>J,e:()=>re,f:()=>j,g:()=>ge,h:()=>_e,i:()=>se,l:()=>ce,n:()=>ie,s:()=>G,t:()=>pe,v:()=>ze});var D=v(39863);function R(Ke,We){return Ke[0]=We[0],Ke[1]=We[1],Ke[2]=We[2],Ke[3]=We[3],Ke}function G(Ke,We,Ce,Be,Fe){return Ke[0]=We,Ke[1]=Ce,Ke[2]=Be,Ke[3]=Fe,Ke}function Z(Ke,We,Ce){return Ke[0]=We[0]+Ce[0],Ke[1]=We[1]+Ce[1],Ke[2]=We[2]+Ce[2],Ke[3]=We[3]+Ce[3],Ke}function Q(Ke,We,Ce){return Ke[0]=We[0]-Ce[0],Ke[1]=We[1]-Ce[1],Ke[2]=We[2]-Ce[2],Ke[3]=We[3]-Ce[3],Ke}function $(Ke,We,Ce){return Ke[0]=We[0]*Ce[0],Ke[1]=We[1]*Ce[1],Ke[2]=We[2]*Ce[2],Ke[3]=We[3]*Ce[3],Ke}function W(Ke,We,Ce){return Ke[0]=We[0]/Ce[0],Ke[1]=We[1]/Ce[1],Ke[2]=We[2]/Ce[2],Ke[3]=We[3]/Ce[3],Ke}function oe(Ke,We,Ce){return Ke[0]=We[0]*Ce,Ke[1]=We[1]*Ce,Ke[2]=We[2]*Ce,Ke[3]=We[3]*Ce,Ke}function de(Ke,We){const Ce=We[0]-Ke[0],Be=We[1]-Ke[1],Fe=We[2]-Ke[2],je=We[3]-Ke[3];return Math.sqrt(Ce*Ce+Be*Be+Fe*Fe+je*je)}function se(Ke,We){const Ce=We[0]-Ke[0],Be=We[1]-Ke[1],Fe=We[2]-Ke[2],je=We[3]-Ke[3];return Ce*Ce+Be*Be+Fe*Fe+je*je}function re(Ke){const We=Ke[0],Ce=Ke[1],Be=Ke[2],Fe=Ke[3];return Math.sqrt(We*We+Ce*Ce+Be*Be+Fe*Fe)}function j(Ke){const We=Ke[0],Ce=Ke[1],Be=Ke[2],Fe=Ke[3];return We*We+Ce*Ce+Be*Be+Fe*Fe}function ie(Ke,We){const Ce=We[0],Be=We[1],Fe=We[2],je=We[3];let Re=Ce*Ce+Be*Be+Fe*Fe+je*je;return Re>0&&(Re=1/Math.sqrt(Re),Ke[0]=Ce*Re,Ke[1]=Be*Re,Ke[2]=Fe*Re,Ke[3]=je*Re),Ke}function J(Ke,We){return Ke[0]*We[0]+Ke[1]*We[1]+Ke[2]*We[2]+Ke[3]*We[3]}function ce(Ke,We,Ce,Be){const Fe=We[0],je=We[1],Re=We[2],He=We[3];return Ke[0]=Fe+Be*(Ce[0]-Fe),Ke[1]=je+Be*(Ce[1]-je),Ke[2]=Re+Be*(Ce[2]-Re),Ke[3]=He+Be*(Ce[3]-He),Ke}function pe(Ke,We,Ce){const Be=We[0],Fe=We[1],je=We[2],Re=We[3];return Ke[0]=Ce[0]*Be+Ce[4]*Fe+Ce[8]*je+Ce[12]*Re,Ke[1]=Ce[1]*Be+Ce[5]*Fe+Ce[9]*je+Ce[13]*Re,Ke[2]=Ce[2]*Be+Ce[6]*Fe+Ce[10]*je+Ce[14]*Re,Ke[3]=Ce[3]*Be+Ce[7]*Fe+Ce[11]*je+Ce[15]*Re,Ke}function ge(Ke,We){return Ke[0]===We[0]&&Ke[1]===We[1]&&Ke[2]===We[2]&&Ke[3]===We[3]}function _e(Ke,We){const Ce=Ke[0],Be=Ke[1],Fe=Ke[2],je=Ke[3],Re=We[0],He=We[1],Ie=We[2],Ge=We[3],Pe=(0,D.g)();return Math.abs(Ce-Re)<=Pe*Math.max(1,Math.abs(Ce),Math.abs(Re))&&Math.abs(Be-He)<=Pe*Math.max(1,Math.abs(Be),Math.abs(He))&&Math.abs(Fe-Ie)<=Pe*Math.max(1,Math.abs(Fe),Math.abs(Ie))&&Math.abs(je-Ge)<=Pe*Math.max(1,Math.abs(je),Math.abs(Ge))}const ze=Object.freeze(Object.defineProperty({__proto__:null,copy:R,set:G,add:Z,subtract:Q,multiply:$,divide:W,ceil:function B(Ke,We){return Ke[0]=Math.ceil(We[0]),Ke[1]=Math.ceil(We[1]),Ke[2]=Math.ceil(We[2]),Ke[3]=Math.ceil(We[3]),Ke},floor:function H(Ke,We){return Ke[0]=Math.floor(We[0]),Ke[1]=Math.floor(We[1]),Ke[2]=Math.floor(We[2]),Ke[3]=Math.floor(We[3]),Ke},min:function X(Ke,We,Ce){return Ke[0]=Math.min(We[0],Ce[0]),Ke[1]=Math.min(We[1],Ce[1]),Ke[2]=Math.min(We[2],Ce[2]),Ke[3]=Math.min(We[3],Ce[3]),Ke},max:function te(Ke,We,Ce){return Ke[0]=Math.max(We[0],Ce[0]),Ke[1]=Math.max(We[1],Ce[1]),Ke[2]=Math.max(We[2],Ce[2]),Ke[3]=Math.max(We[3],Ce[3]),Ke},round:function ae(Ke,We){return Ke[0]=Math.round(We[0]),Ke[1]=Math.round(We[1]),Ke[2]=Math.round(We[2]),Ke[3]=Math.round(We[3]),Ke},scale:oe,scaleAndAdd:function le(Ke,We,Ce,Be){return Ke[0]=We[0]+Ce[0]*Be,Ke[1]=We[1]+Ce[1]*Be,Ke[2]=We[2]+Ce[2]*Be,Ke[3]=We[3]+Ce[3]*Be,Ke},distance:de,squaredDistance:se,length:re,squaredLength:j,negate:function Y(Ke,We){return Ke[0]=-We[0],Ke[1]=-We[1],Ke[2]=-We[2],Ke[3]=-We[3],Ke},inverse:function ee(Ke,We){return Ke[0]=1/We[0],Ke[1]=1/We[1],Ke[2]=1/We[2],Ke[3]=1/We[3],Ke},normalize:ie,dot:J,lerp:ce,random:function ue(Ke,We){const Ce=D.R;let Be,Fe,je,Re,He,Ie;We=We||1;do{Be=2*Ce()-1,Fe=2*Ce()-1,He=Be*Be+Fe*Fe}while(He>=1);do{je=2*Ce()-1,Re=2*Ce()-1,Ie=je*je+Re*Re}while(Ie>=1);const Ge=Math.sqrt((1-He)/Ie);return Ke[0]=We*Be,Ke[1]=We*Fe,Ke[2]=We*je*Ge,Ke[3]=We*Re*Ge,Ke},transformMat4:pe,transformQuat:function he(Ke,We,Ce){const Be=We[0],Fe=We[1],je=We[2],Re=Ce[0],He=Ce[1],Ie=Ce[2],Ge=Ce[3],Pe=Ge*Be+He*je-Ie*Fe,Le=Ge*Fe+Ie*Be-Re*je,Me=Ge*je+Re*Fe-He*Be,Ne=-Re*Be-He*Fe-Ie*je;return Ke[0]=Pe*Ge+Ne*-Re+Le*-Ie-Me*-He,Ke[1]=Le*Ge+Ne*-He+Me*-Re-Pe*-Ie,Ke[2]=Me*Ge+Ne*-Ie+Pe*-He-Le*-Re,Ke[3]=We[3],Ke},str:function me(Ke){return"vec4("+Ke[0]+", "+Ke[1]+", "+Ke[2]+", "+Ke[3]+")"},exactEquals:ge,equals:_e,sub:Q,mul:$,div:W,dist:de,sqrDist:se,len:re,sqrLen:j},Symbol.toStringTag,{value:"Module"}))},63657:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>$,n:()=>Z,s:()=>Q,t:()=>G});var D=v(96286);function G(B,H,X){if(B.count!==H.count)return void D.c.error("source and destination buffers need to have the same number of elements");const te=B.count,ae=X[0],oe=X[1],le=X[2],de=X[3],se=X[4],re=X[5],j=X[6],Y=X[7],ee=X[8],ie=B.typedBuffer,J=B.typedBufferStride,ce=H.typedBuffer,ue=H.typedBufferStride;for(let pe=0;pe<te;pe++){const he=pe*J,me=pe*ue,ge=ce[me],_e=ce[me+1],Ee=ce[me+2],De=ce[me+3];ie[he]=ae*ge+de*_e+j*Ee,ie[he+1]=oe*ge+se*_e+Y*Ee,ie[he+2]=le*ge+re*_e+ee*Ee,ie[he+3]=De}}function Z(B,H){const X=Math.min(B.count,H.count),te=B.typedBuffer,ae=B.typedBufferStride,oe=H.typedBuffer,le=H.typedBufferStride;for(let de=0;de<X;de++){const se=de*ae,re=de*le,j=oe[re],Y=oe[re+1],ee=oe[re+2],ie=j*j+Y*Y+ee*ee;if(ie>0){const J=1/Math.sqrt(ie);te[se]=J*j,te[se+1]=J*Y,te[se+2]=J*ee}}}function Q(B,H,X){const te=Math.min(B.count,H.count),ae=B.typedBuffer,oe=B.typedBufferStride,le=H.typedBuffer,de=H.typedBufferStride;for(let se=0;se<te;se++){const re=se*oe,j=se*de;ae[re]=X*le[j],ae[re+1]=X*le[j+1],ae[re+2]=X*le[j+2],ae[re+3]=X*le[j+3]}}function $(B,H,X){const te=Math.min(B.count,H.count),ae=B.typedBuffer,oe=B.typedBufferStride,le=H.typedBuffer,de=H.typedBufferStride;for(let se=0;se<te;se++){const re=se*oe,j=se*de;ae[re]=le[j]>>X,ae[re+1]=le[j+1]>>X,ae[re+2]=le[j+2]>>X,ae[re+3]=le[j+3]>>X}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:function R(B,H,X){if(B.count!==H.count)return void D.c.error("source and destination buffers need to have the same number of elements");const te=B.count,ae=X[0],oe=X[1],le=X[2],de=X[3],se=X[4],re=X[5],j=X[6],Y=X[7],ee=X[8],ie=X[9],J=X[10],ce=X[11],ue=X[12],pe=X[13],he=X[14],me=X[15],ge=B.typedBuffer,_e=B.typedBufferStride,Ee=H.typedBuffer,De=H.typedBufferStride;for(let be=0;be<te;be++){const Se=be*_e,ye=be*De,ve=Ee[ye],xe=Ee[ye+1],ze=Ee[ye+2],Ke=Ee[ye+3];ge[Se]=ae*ve+se*xe+ee*ze+ue*Ke,ge[Se+1]=oe*ve+re*xe+ie*ze+pe*Ke,ge[Se+2]=le*ve+j*xe+J*ze+he*Ke,ge[Se+3]=de*ve+Y*xe+ce*ze+me*Ke}},transformMat3:G,normalize:Z,scale:Q,shiftRight:$},Symbol.toStringTag,{value:"Module"}))},63470:(nt,Ae,v)=>{"use strict";function D(Z,Q,$){const W=Z.typedBuffer,B=Z.typedBufferStride,H=Q.typedBuffer,X=Q.typedBufferStride,te=$?$.count:Q.count;let ae=($&&$.dstIndex?$.dstIndex:0)*B,oe=($&&$.srcIndex?$.srcIndex:0)*X;for(let le=0;le<te;++le)W[ae]=H[oe],W[ae+1]=H[oe+1],W[ae+2]=H[oe+2],W[ae+3]=H[oe+3],ae+=B,oe+=X}function R(Z,Q,$,W,B,H){const X=Z.typedBuffer,te=Z.typedBufferStride,ae=H?.count??Z.count;let oe=(H?.dstIndex??0)*te;for(let le=0;le<ae;++le)X[oe]=Q,X[oe+1]=$,X[oe+2]=W,X[oe+3]=B,oe+=te}v.d(Ae,{c:()=>D,f:()=>R}),Object.freeze(Object.defineProperty({__proto__:null,copy:D,fill:R},Symbol.toStringTag,{value:"Module"}))},67709:(nt,Ae,v)=>{"use strict";function D(){return new Float32Array(4)}function R(j){const Y=new Float32Array(4);return Y[0]=j[0],Y[1]=j[1],Y[2]=j[2],Y[3]=j[3],Y}function G(j,Y,ee,ie){const J=new Float32Array(4);return J[0]=j,J[1]=Y,J[2]=ee,J[3]=ie,J}function Q(){return D()}function $(){return G(1,1,1,1)}function W(){return G(1,0,0,0)}function B(){return G(0,1,0,0)}function H(){return G(0,0,1,0)}function X(){return G(0,0,0,1)}v.d(Ae,{a:()=>R,c:()=>D,f:()=>G});const te=Q(),ae=$(),oe=W(),le=B(),de=H(),se=X();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,createView:function Z(j,Y){return new Float32Array(j,Y,4)},zeros:Q,ones:$,unitX:W,unitY:B,unitZ:H,unitW:X,ZEROS:te,ONES:ae,UNIT_X:oe,UNIT_Y:le,UNIT_Z:de,UNIT_W:se},Symbol.toStringTag,{value:"Module"}))},4794:(nt,Ae,v)=>{"use strict";function D(){return[0,0,0,0]}function R(Y){return[Y[0],Y[1],Y[2],Y[3]]}function G(Y,ee,ie,J){return[Y,ee,ie,J]}function Z(Y){const ee=[0,0,0,0],ie=Math.min(4,Y.length);for(let J=0;J<ie;++J)ee[J]=Y[J];return ee}function Q(Y,ee){return new Float64Array(Y,ee,4)}function W(){return G(1,1,1,1)}function B(){return G(1,0,0,0)}function H(){return G(0,1,0,0)}function X(){return G(0,0,1,0)}function te(){return G(0,0,0,1)}v.d(Ae,{O:()=>oe,Z:()=>ae,a:()=>Q,b:()=>Z,c:()=>D,d:()=>R,f:()=>G});const ae=[0,0,0,0],oe=W(),le=B(),de=H(),se=X(),re=te();Object.freeze(Object.defineProperty({__proto__:null,create:D,clone:R,fromValues:G,fromArray:Z,createView:Q,zeros:function $(){return[0,0,0,0]},ones:W,unitX:B,unitY:H,unitZ:X,unitW:te,ZEROS:ae,ONES:oe,UNIT_X:le,UNIT_Y:de,UNIT_Z:se,UNIT_W:re},Symbol.toStringTag,{value:"Module"}))},20414:(nt,Ae,v)=>{"use strict";v.d(Ae,{B7:()=>$,St:()=>R,VL:()=>Z,h$:()=>G,rW:()=>W});const D={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function R(B){return D[B]||D[B.toLowerCase()]}function G(B){return D[B]??D[B.toLowerCase()]}function Z(B){return[...G(B)]}function Q(B,H,X){X<0&&++X,X>1&&--X;const te=6*X;return te<1?B+(H-B)*te:2*X<1?H:3*X<2?B+(H-B)*(2/3-X)*6:B}function $(B,H,X,te=1){const ae=(B%360+360)%360/360,oe=X<=.5?X*(H+1):X+H-X*H,le=2*X-oe;return[Math.round(255*Q(le,oe,ae+1/3)),Math.round(255*Q(le,oe,ae)),Math.round(255*Q(le,oe,ae-1/3)),te]}function W(B){const H=B.length>5,X=H?8:4,te=(1<<X)-1,ae=H?1:17,oe=H?9===B.length:5===B.length;let le=Number("0x"+B.substr(1));if(isNaN(le))return null;const de=[0,0,0,1];let se;return oe&&(se=le&te,le>>=X,de[3]=ae*se/255),se=le&te,le>>=X,de[2]=ae*se,se=le&te,le>>=X,de[1]=ae*se,se=le&te,le>>=X,de[0]=ae*se,de}},59318:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G}),v(8314);var R=v(94113);const G={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};globalThis.esriConfig&&((0,R.RH)(G,globalThis.esriConfig,!0),delete G.has),G.assetsPath||(G.assetsPath=`https://js.arcgis.com/${"4.25.5".slice(0,-2)}/@arcgis/core/assets`,G.defaultAssetsPath=G.assetsPath)},14517:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>be});var D=v(72392),R=v(62208),G=v(34595),Z=v(34117),$=(v(8314),v(58817)),W=v(63290),B=v(27899),H=v(44648),X=v(31283),te=v(36082),ae=v(2345),oe=v(12196);class le{constructor(ye,ve,xe){this.properties=ye,this.propertyName=ve,this.metadata=xe,this._observers=null,this._accessed=null,this._handles=null,this.flags=ae.v.Dirty|(xe.nonNullable?ae.v.NonNullable:0)|(xe.hasOwnProperty("value")?ae.v.HasDefaultValue:0)|(void 0===xe.get?ae.v.DepTrackingInitialized:0)|(void 0===xe.dependsOn?ae.v.AutoTracked:0)}destroy(){if(this.flags&ae.v.Dirty&&this._observers){const ye=this._observers.slice();for(const ve of ye)ve.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){(0,te.it)(this);const ye=this.properties.store,ve=this.propertyName,xe=this.flags,ze=ye.get(ve);if(xe&ae.v.Computing||~xe&ae.v.Dirty&&ye.has(ve))return ze;this.flags|=ae.v.Computing;const Ke=this.properties.host;let We;xe&ae.v.AutoTracked?We=(0,te.LJ)(this,this.metadata.get,Ke):((0,te.GF)(Ke,this),We=this.metadata.get.call(Ke)),ye.set(ve,We,X.s3.COMPUTED);const Ce=ye.get(ve);return Ce===ze?this.flags&=~ae.v.Dirty:(0,te.gb)(this.commit,this),this.flags&=~ae.v.Computing,Ce}onObservableAccessed(ye){ye!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(ye)||this._accessed.push(ye))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=ae.v.DepTrackingInitialized;const ye=this._accessed;if(null===ye)return;let ve=this._handles;null===ve&&(ve=this._handles=[]);for(let xe=0;xe<ye.length;++xe)ve.push(ye[xe].observe(this));ye.length=0}observe(ye){return null===this._observers&&(this._observers=[]),this._observers.includes(ye)||this._observers.push(ye),new oe.X(this._observers,ye)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&ae.v.Overriden&&(this.flags|=ae.v.Dirty);const ye=this._observers;if(null!==ye)for(let ve=0;ve<ye.length;++ve)ye[ve].onInvalidated()}commit(){this.flags&=~ae.v.Dirty,this.onCommitted()}onCommitted(){if(null===this._observers)return;const ye=this._observers.slice();for(let ve=0;ve<ye.length;++ve)ye[ve].onCommitted()}_clearObservationHandles(){const ye=this._handles;if(null!==ye){for(let ve=0;ve<ye.length;++ve)ye[ve].remove();ye.length=0}}}class de{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(ye){const ve=new de;return this._values.forEach((xe,ze)=>{ye&&ye.has(ze)||ve.set(ze,(0,$.d9)(xe))}),ve}get(ye){return this._values.get(ye)}originOf(){return X.s3.USER}keys(){return[...this._values.keys()]}set(ye,ve){this._values.set(ye,ve)}delete(ye){this._values.delete(ye)}has(ye){return this._values.has(ye)}forEach(ye){this._values.forEach(ye)}}var se=v(52323);function re(Se,ye,ve){return void 0!==Se}function j(Se,ye,ve,xe){return!(void 0===Se||null==ve&&Se.flags&ae.v.NonNullable)}W.Z.getLogger("esri.core.accessorSupport.Properties");class ee{constructor(ye){this.host=ye,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=H.F.INITIALIZING,this.store=new de,this._origin=X.s3.USER;const ve=this.host.constructor.__accessorMetadata__,xe=ve.properties;for(const ze in xe){const Ke=new le(this,ze,xe[ze]);this.properties.set(ze,Ke)}this.metadatas=xe,this._autoDestroy=ve.autoDestroy}initialize(){this.lifecycle=H.F.CONSTRUCTING}constructed(){this.lifecycle=H.F.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[ye,ve]of this.properties){const xe=this.internalGet(ye);xe&&(Se=xe)&&"function"==typeof Se.destroy&&(xe.destroy(),~ve.flags&ae.v.NonNullable&&this._internalSet(ve,null)),ve.destroy()}else for(const[ye,ve]of this.properties)ve.destroy();var Se}get initialized(){return this.lifecycle!==H.F.INITIALIZING}get(ye){const ve=this.properties.get(ye);if(ve.metadata.get)return ve.getComputed();(0,te.it)(ve);const xe=this.store;return xe.has(ye)?xe.get(ye):ve.metadata.value}originOf(ye){const ve=this.store.originOf(ye);if(void 0===ve){const xe=this.properties.get(ye);if(void 0!==xe&&xe.flags&ae.v.HasDefaultValue)return"defaults"}return(0,X.x3)(ve)}has(ye){return!!this.properties.has(ye)&&this.store.has(ye)}keys(){return[...this.properties.keys()]}internalGet(ye){const ve=this.properties.get(ye);if(re(ve))return this.store.has(ye)?this.store.get(ye):ve.metadata.value}internalSet(ye,ve){const xe=this.properties.get(ye);re(xe)&&this._internalSet(xe,ve)}getDependsInfo(ye,ve,xe){const ze=this.properties.get(ve);if(!re(ze))return"";const Ke=new Set,We=(0,te.LJ)({onObservableAccessed:Be=>Ke.add(Be),onTrackingEnd:()=>{}},()=>ze.metadata.get?.call(ye));let Ce=`${xe}${ye.declaredClass.split(".").pop()}.${ve}: ${We}\n`;if(0===Ke.size)return Ce;xe+="  ";for(const Be of Ke){if(!(Be instanceof le))continue;const Fe=Be.properties.host,je=Be.propertyName,Re=(0,se.vw)(Fe);Ce+=Re?Re.getDependsInfo(Fe,je,xe):`${xe}${je}: undefined\n`}return Ce}setAtOrigin(ye,ve,xe){const ze=this.properties.get(ye);if(re(ze))return this._setAtOrigin(ze,ve,xe)}isOverridden(ye){const ve=this.properties.get(ye);return void 0!==ve&&!!(ve.flags&ae.v.Overriden)}clearOverride(ye){const ve=this.properties.get(ye);void 0!==ve&&ve.flags&ae.v.Overriden&&(ve.flags&=~ae.v.Overriden,ve.notifyChange())}override(ye,ve){const xe=this.properties.get(ye);if(!j(xe,0,ve))return;const ze=xe.metadata.cast;if(ze){const Ke=this._cast(ze,ve),{valid:We,value:Ce}=Ke;if(J.release(Ke),!We)return;ve=Ce}xe.flags|=ae.v.Overriden,this._internalSet(xe,ve)}set(ye,ve){const xe=this.properties.get(ye);if(!j(xe,0,ve))return;const ze=xe.metadata.cast;if(ze){const We=this._cast(ze,ve),{valid:Ce,value:Be}=We;if(J.release(We),!Ce)return;ve=Be}const Ke=xe.metadata.set;Ke?Ke.call(this.host,ve):this._internalSet(xe,ve)}setDefaultOrigin(ye){this._origin=(0,X.M9)(ye)}getDefaultOrigin(){return(0,X.x3)(this._origin)}notifyChange(ye){const ve=this.properties.get(ye);void 0!==ve&&ve.notifyChange()}invalidate(ye){const ve=this.properties.get(ye);void 0!==ve&&ve.invalidate()}commit(ye){const ve=this.properties.get(ye);void 0!==ve&&ve.commit()}_internalSet(ye,ve){this._setAtOrigin(ye,ve,this.lifecycle!==H.F.INITIALIZING?this._origin:X.s3.DEFAULTS)}_setAtOrigin(ye,ve,xe){const ze=this.store,Ke=ye.propertyName;ze.has(Ke,xe)&&(0,$.fS)(ve,ze.get(Ke))&&~ye.flags&ae.v.Overriden&&xe===ze.originOf(Ke)||(ye.invalidate(),ze.set(Ke,ve,xe),ye.commit(),(0,te.mS)(this.host,ye))}_cast(ye,ve){const xe=J.acquire();return xe.valid=!0,xe.value=ve,ye&&(xe.value=ye.call(this.host,ve,xe)),xe}}const J=new B.Z(class ie{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var me,ge,ce=v(82255),ue=v(30755),pe=v(77712),he=v(76898);function _e(Se){if(null==Se)return{value:Se};if(Array.isArray(Se))return{type:[Se[0]],value:null};switch(typeof Se){case"object":return Se.constructor?.__accessorMetadata__||Se instanceof Date?{type:Se.constructor,value:Se}:Se;case"boolean":return{type:Boolean,value:Se};case"string":return{type:String,value:Se};case"number":return{type:Number,value:Se};case"function":return{type:Se,value:null};default:return}}const Ee=Symbol("Accessor-Handles"),De=Symbol("Accessor-Initialized");class be{constructor(...ye){if(this[me]=null,this[ge]=!1,this.constructor===be)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new ee(this)}),ye.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,ye))}static createSubclass(ye={}){if(Array.isArray(ye))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:ve,declaredClass:xe,constructor:ze}=ye;delete ye.declaredClass,delete ye.properties,delete ye.constructor;const Ke=this;class We extends Ke{constructor(...Be){super(...Be),this.inherited=null,ze&&ze.apply(this,Be)}}(0,Z.JT)(We.prototype);for(const Ce in ye){const Be=ye[Ce];We.prototype[Ce]="function"==typeof Be?function(...Fe){const je=this.inherited;let Re;this.inherited=function(...He){if(Ke.prototype[Ce])return Ke.prototype[Ce].apply(this,He)};try{Re=Be.apply(this,Fe)}catch(He){throw this.inherited=je,He}return this.inherited=je,Re}:ye[Ce]}for(const Ce in ve){const Be=_e(ve[Ce]);(0,pe.Cb)(Be)(We.prototype,Ce)}return(0,he.j)(xe)(We)}postscript(ye){const ve=this.__accessor__,xe=ve.ctorArgs||ye;ve.initialize(),xe&&(this.set(xe),ve.ctorArgs=null),ve.constructed(),this.initialize(),this[De]=!0}initialize(){}destroy(){this.destroyed||(this[Ee]=(0,R.SC)(this[Ee]),(0,ue.BT)(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[De]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(ye){this.get(ye)}get(ye){return(0,G.U2)(this,ye)}hasOwnProperty(ye){return this.__accessor__?this.__accessor__.has(ye):Object.prototype.hasOwnProperty.call(this,ye)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(ye,ve){return(0,ce.t)(this,ye,ve),this}watch(ye,ve,xe){return(0,ue.YP)(this,ye,ve,xe)}own(ye){this.addHandles(ye)}addHandles(ye,ve){let xe=this[Ee];(0,R.Wi)(xe)&&(xe=this[Ee]=new D.Z),xe.add(ye,ve)}removeHandles(ye){const ve=this[Ee];(0,R.Wi)(ve)||ve.remove(ye)}hasHandles(ye){const ve=this[Ee];return!!(0,R.pC)(ve)&&ve.has(ye)}_override(ye,ve){void 0===ve?this.__accessor__.clearOverride(ye):this.__accessor__.override(ye,ve)}_clearOverride(ye){return this.__accessor__.clearOverride(ye)}_overrideIfSome(ye,ve){null==ve?this.__accessor__.clearOverride(ye):this.__accessor__.override(ye,ve)}_isOverridden(ye){return this.__accessor__.isOverridden(ye)}notifyChange(ye){this.__accessor__.notifyChange(ye)}_get(ye){return this.__accessor__.internalGet(ye)}_set(ye,ve){return this.__accessor__.internalSet(ye,ve),this}}me=Ee,ge=De},35575:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G});var D=v(27899);function R(Q){Q.length=0}class G{constructor($=50,W=50){this._pool=new D.Z(Array,void 0,R,W,$)}acquire(){return this._pool.acquire()}release($){this._pool.release($)}prune(){this._pool.prune(0)}static acquire(){return Z.acquire()}static release($){return Z.release($)}static prune(){Z.prune()}}const Z=new G(100)},79608:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>X,j:()=>te});var D=v(17626),R=v(14517),Z=(v(8314),v(58817)),$=(v(63290),v(62208)),W=v(31283),B=v(52323),H=v(76898);const X=ae=>{let oe=class extends ae{clone(){const le=(0,$.s3)((0,B.vw)(this),"unable to clone instance of non-accessor class"),de=le.metadatas,se=le.store,re={},j=new Map;for(const ee in de){const ie=de[ee],J=se?.originOf(ee),ce=ie.clonable;if(ie.readOnly||!1===ce||J!==W.s3.USER&&J!==W.s3.DEFAULTS&&J!==W.s3.WEB_MAP&&J!==W.s3.WEB_SCENE)continue;const ue=this[ee];let pe=null;pe="function"==typeof ce?ce(ue):"reference"===ce?ue:(0,Z.Vo)(ue),null!=ue&&null==pe||(J===W.s3.DEFAULTS?j.set(ee,pe):re[ee]=pe)}const Y=new(Object.getPrototypeOf(this).constructor)(re);if(j.size){const ee=(0,B.vw)(Y)?.store;if(ee)for(const[ie,J]of j)ee.set(ie,J,W.s3.DEFAULTS)}return Y}};return oe=(0,D._)([(0,H.j)("esri.core.Clonable")],oe),oe};let te=class extends(X(R.Z)){};te=(0,D._)([(0,H.j)("esri.core.Clonable")],te)},46160:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>_e});var de,D=v(17626),R=v(35575),G=v(61885),Z=v(58817),Q=v(62208),$=v(27899),W=v(73234),B=v(50618),H=v(77712),X=v(90912),te=v(61039),ae=v(76898),oe=v(36082),le=v(48902);const re=new $.Z(class se{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(De){this.defaultPrevented=!1,this.item=De}},void 0,Ee=>{Ee.item=null,Ee.target=null,Ee.defaultPrevented=!1,Ee.cancellable=!1}),j=()=>{};function Y(Ee){return Ee?Ee instanceof ge?Ee.toArray():Ee.length?Array.prototype.slice.apply(Ee):[]:[]}function ee(Ee){if(Ee&&Ee.length)return Ee[0]}function ie(Ee,De,be,Se){const ye=Math.min(Ee.length-be,De.length-Se);let ve=0;for(;ve<ye&&Ee[be+ve]===De[Se+ve];)ve++;return ve}function J(Ee,De,be,Se){De&&De.forEach((ye,ve,xe)=>{Ee.push(ye),J(Ee,be.call(Se,ye,ve,xe),be,Se)})}const ce=new Set,ue=new Set,pe=new Set,he=new Map;let me=0,ge=de=class extends G.Z.EventedAccessor{constructor(Ee){super(Ee),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new le.s,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:me++})}static isCollection(Ee){return null!=Ee&&Ee instanceof de}normalizeCtorArgs(Ee){return Ee?Array.isArray(Ee)||Ee instanceof de?{items:Ee}:Ee:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return(0,oe.it)(this._observable),this._items}set items(Ee){this._emitBeforeChanges(W.y.ADD)||(this._splice(0,this.length,Y(Ee)),this._emitAfterChanges(W.y.ADD))}hasEventListener(Ee){return"change"===Ee?this._chgListeners.length>0:this._emitter.hasEventListener(Ee)}on(Ee,De){if("change"===Ee){const be=this._chgListeners,Se={removed:!1,callback:De};return be.push(Se),this._notifications&&this._notifications.push({listeners:be.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=j,Se.removed=!0,be.splice(be.indexOf(Se),1)}}}return this._emitter.on(Ee,De)}once(Ee,De){const be=this.on(Ee,De);return{remove(){be.remove()}}}add(Ee,De){if((0,oe.it)(this._observable),this._emitBeforeChanges(W.y.ADD))return this;const be=this.getNextIndex(De??null);return this._splice(be,0,[Ee]),this._emitAfterChanges(W.y.ADD),this}addMany(Ee,De=this._items.length){if((0,oe.it)(this._observable),!Ee||!Ee.length)return this;if(this._emitBeforeChanges(W.y.ADD))return this;const be=this.getNextIndex(De);return this._splice(be,0,Y(Ee)),this._emitAfterChanges(W.y.ADD),this}at(Ee){if((0,oe.it)(this._observable),(Ee=Math.trunc(Ee)||0)<0&&(Ee+=this.length),!(Ee<0||Ee>=this.length))return this._items[Ee]}removeAll(){if((0,oe.it)(this._observable),!this.length||this._emitBeforeChanges(W.y.REMOVE))return[];const Ee=this._splice(0,this.length)||[];return this._emitAfterChanges(W.y.REMOVE),Ee}clone(){return(0,oe.it)(this._observable),this._createNewInstance({items:this._items.map(Z.d9)})}concat(...Ee){(0,oe.it)(this._observable);const De=Ee.map(Y);return this._createNewInstance({items:this._items.concat(...De)})}drain(Ee,De){if((0,oe.it)(this._observable),!this.length||this._emitBeforeChanges(W.y.REMOVE))return;const be=(0,Q.j0)(this._splice(0,this.length)),Se=be.length;for(let ye=0;ye<Se;ye++)Ee.call(De,be[ye],ye,be);this._emitAfterChanges(W.y.REMOVE)}every(Ee,De){return(0,oe.it)(this._observable),this._items.every(Ee,De)}filter(Ee,De){let be;return(0,oe.it)(this._observable),be=2===arguments.length?this._items.filter(Ee,De):this._items.filter(Ee),this._createNewInstance({items:be})}find(Ee,De){return(0,oe.it)(this._observable),this._items.find(Ee,De)}findIndex(Ee,De){return(0,oe.it)(this._observable),this._items.findIndex(Ee,De)}flatten(Ee,De){(0,oe.it)(this._observable);const be=[];return J(be,this,Ee,De),new de(be)}forEach(Ee,De){return(0,oe.it)(this._observable),this._items.forEach(Ee,De)}getItemAt(Ee){return(0,oe.it)(this._observable),this._items[Ee]}getNextIndex(Ee){(0,oe.it)(this._observable);const De=this.length;return(Ee=Ee??De)<0?Ee=0:Ee>De&&(Ee=De),Ee}includes(Ee,De=0){return(0,oe.it)(this._observable),this._items.includes(Ee,De)}indexOf(Ee,De=0){return(0,oe.it)(this._observable),this._items.indexOf(Ee,De)}join(Ee=","){return(0,oe.it)(this._observable),this._items.join(Ee)}lastIndexOf(Ee,De=this.length-1){return(0,oe.it)(this._observable),this._items.lastIndexOf(Ee,De)}map(Ee,De){(0,oe.it)(this._observable);const be=this._items.map(Ee,De);return new de({items:be})}reorder(Ee,De=this.length-1){(0,oe.it)(this._observable);const be=this.indexOf(Ee);if(-1!==be){if(De<0?De=0:De>=this.length&&(De=this.length-1),be!==De){if(this._emitBeforeChanges(W.y.MOVE))return Ee;this._splice(be,1),this._splice(De,0,[Ee]),this._emitAfterChanges(W.y.MOVE)}return Ee}}pop(){if((0,oe.it)(this._observable),!this.length||this._emitBeforeChanges(W.y.REMOVE))return;const Ee=ee(this._splice(this.length-1,1));return this._emitAfterChanges(W.y.REMOVE),Ee}push(...Ee){return(0,oe.it)(this._observable),this._emitBeforeChanges(W.y.ADD)||(this._splice(this.length,0,Ee),this._emitAfterChanges(W.y.ADD)),this.length}reduce(Ee,De){(0,oe.it)(this._observable);const be=this._items;return 2===arguments.length?be.reduce(Ee,De):be.reduce(Ee)}reduceRight(Ee,De){(0,oe.it)(this._observable);const be=this._items;return 2===arguments.length?be.reduceRight(Ee,De):be.reduceRight(Ee)}remove(Ee){return(0,oe.it)(this._observable),this.removeAt(this.indexOf(Ee))}removeAt(Ee){if((0,oe.it)(this._observable),Ee<0||Ee>=this.length||this._emitBeforeChanges(W.y.REMOVE))return;const De=ee(this._splice(Ee,1));return this._emitAfterChanges(W.y.REMOVE),De}removeMany(Ee){if((0,oe.it)(this._observable),!Ee||!Ee.length||this._emitBeforeChanges(W.y.REMOVE))return[];const De=Ee instanceof de?Ee.toArray():Ee,be=this._items,Se=[],ye=De.length;for(let ve=0;ve<ye;ve++){const ze=be.indexOf(De[ve]);if(ze>-1){const Ke=1+ie(De,be,ve+1,ze+1),We=this._splice(ze,Ke);We&&We.length>0&&Se.push.apply(Se,We),ve+=Ke-1}}return this._emitAfterChanges(W.y.REMOVE),Se}reverse(){if((0,oe.it)(this._observable),this._emitBeforeChanges(W.y.MOVE))return this;const Ee=this._splice(0,this.length);return Ee&&(Ee.reverse(),this._splice(0,0,Ee)),this._emitAfterChanges(W.y.MOVE),this}shift(){if((0,oe.it)(this._observable),!this.length||this._emitBeforeChanges(W.y.REMOVE))return;const Ee=ee(this._splice(0,1));return this._emitAfterChanges(W.y.REMOVE),Ee}slice(Ee=0,De=this.length){return(0,oe.it)(this._observable),this._createNewInstance({items:this._items.slice(Ee,De)})}some(Ee,De){return(0,oe.it)(this._observable),this._items.some(Ee,De)}sort(Ee){if((0,oe.it)(this._observable),!this.length||this._emitBeforeChanges(W.y.MOVE))return this;const De=(0,Q.j0)(this._splice(0,this.length));return arguments.length?De.sort(Ee):De.sort(),this._splice(0,0,De),this._emitAfterChanges(W.y.MOVE),this}splice(Ee,De,...be){(0,oe.it)(this._observable);const Se=(De?W.y.REMOVE:0)|(be.length?W.y.ADD:0);if(this._emitBeforeChanges(Se))return[];const ye=this._splice(Ee,De,be)||[];return this._emitAfterChanges(Se),ye}toArray(){return(0,oe.it)(this._observable),this._items.slice()}toJSON(){return(0,oe.it)(this._observable),this.toArray()}toLocaleString(){return(0,oe.it)(this._observable),this._items.toLocaleString()}toString(){return(0,oe.it)(this._observable),this._items.toString()}unshift(...Ee){return(0,oe.it)(this._observable),!Ee.length||this._emitBeforeChanges(W.y.ADD)||(this._splice(0,0,Ee),this._emitAfterChanges(W.y.ADD)),this.length}_createNewInstance(Ee){return new this.constructor(Ee)}_splice(Ee,De,be){const Se=this._items,ye=this.itemType;let ve,xe;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=(0,B.Os)(()=>this._dispatchChange())),De){if(xe=Se.splice(Ee,De),this.hasEventListener("before-remove")){const ze=re.acquire();ze.target=this,ze.cancellable=!0;for(let Ke=0,We=xe.length;Ke<We;Ke++)ve=xe[Ke],ze.reset(ve),this.emit("before-remove",ze),ze.defaultPrevented&&(xe.splice(Ke,1),Se.splice(Ee,0,ve),Ee+=1,Ke-=1,We-=1);re.release(ze)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const ze=re.acquire();ze.target=this,ze.cancellable=!1;const Ke=xe.length;for(let We=0;We<Ke;We++)ze.reset(xe[We]),this.emit("after-remove",ze);re.release(ze)}}if(be&&be.length){if(ye){const Ce=[];for(const Be of be){const Fe=ye.ensureType(Be);null==Fe&&null!=Be||Ce.push(Fe)}be=Ce}const ze=this.hasEventListener("before-add"),Ke=this.hasEventListener("after-add"),We=Ee===this.length;if(ze||Ke){const Ce=re.acquire();Ce.target=this,Ce.cancellable=!0;const Be=re.acquire();Be.target=this,Be.cancellable=!1;for(const Fe of be)ze?(Ce.reset(Fe),this.emit("before-add",Ce),Ce.defaultPrevented||(We?Se.push(Fe):Se.splice(Ee++,0,Fe),this._set("length",Se.length),Ke&&(Be.reset(Fe),this.emit("after-add",Be)))):(We?Se.push(Fe):Se.splice(Ee++,0,Fe),this._set("length",Se.length),Be.reset(Fe),this.emit("after-add",Be));re.release(Be),re.release(Ce)}else{if(We)for(const Ce of be)Se.push(Ce);else Se.splice(Ee,0,...be);this._set("length",Se.length)}}return(be&&be.length||xe&&xe.length)&&this._notifyChangeEvent(be,xe),xe}_emitBeforeChanges(Ee){let De=!1;if(this.hasEventListener("before-changes")){const be=re.acquire();be.target=this,be.cancellable=!0,be.type=Ee,this.emit("before-changes",be),De=be.defaultPrevented,re.release(be)}return De}_emitAfterChanges(Ee){if(this.hasEventListener("after-changes")){const De=re.acquire();De.target=this,De.cancellable=!1,De.type=Ee,this.emit("after-changes",De),re.release(De)}this._observable.notify()}_notifyChangeEvent(Ee,De){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:Ee,removed:De})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const Ee=this._notifications;this._notifications=null;for(const De of Ee){const be=De.changes;ce.clear(),ue.clear(),pe.clear();for(const{added:Ke,removed:We}of be){if(Ke)if(0===pe.size&&0===ue.size)for(const Ce of Ke)ce.add(Ce);else for(const Ce of Ke)ue.has(Ce)?(pe.add(Ce),ue.delete(Ce)):pe.has(Ce)||ce.add(Ce);if(We)if(0===pe.size&&0===ce.size)for(const Ce of We)ue.add(Ce);else for(const Ce of We)ce.has(Ce)?ce.delete(Ce):(pe.delete(Ce),ue.add(Ce))}const Se=R.Z.acquire();ce.forEach(Ke=>{Se.push(Ke)});const ye=R.Z.acquire();ue.forEach(Ke=>{ye.push(Ke)});const ve=this._items,xe=De.items,ze=R.Z.acquire();if(pe.forEach(Ke=>{xe.indexOf(Ke)!==ve.indexOf(Ke)&&ze.push(Ke)}),De.listeners&&(Se.length||ye.length||ze.length)){const Ke={target:this,added:Se,removed:ye,moved:ze},We=De.listeners.length;for(let Ce=0;Ce<We;Ce++){const Be=De.listeners[Ce];Be.removed||Be.callback.call(this,Ke)}}R.Z.release(Se),R.Z.release(ye),R.Z.release(ze)}ce.clear(),ue.clear(),pe.clear()}};ge.ofType=Ee=>{if(!Ee)return de;if(he.has(Ee))return he.get(Ee);let De=null;if("function"==typeof Ee)De=Ee.prototype.declaredClass;else if(Ee.base)De=Ee.base.prototype.declaredClass;else for(const Se in Ee.typeMap){const ye=Ee.typeMap[Se].prototype.declaredClass;De?De+=` | ${ye}`:De=ye}let be=class extends de{};return(0,D._)([(0,te.c)({Type:Ee,ensureType:"function"==typeof Ee?(0,X.se)(Ee):(0,X.N7)(Ee)})],be.prototype,"itemType",void 0),be=(0,D._)([(0,ae.j)(`esri.core.Collection<${De}>`)],be),he.set(Ee,be),be},(0,D._)([(0,H.Cb)()],ge.prototype,"length",void 0),(0,D._)([(0,H.Cb)()],ge.prototype,"items",null),ge=de=(0,D._)([(0,ae.j)("esri.core.Collection")],ge);const _e=ge},46882:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var D=v(17626),R=v(46160),G=v(62208),B=(v(8314),v(26584),v(63290),v(30755),v(21352)),H=v(77712),ae=(v(85931),v(90912),v(76898));let oe=class extends R.Z{constructor(de){super(de),this.getCollections=null}initialize(){this.own((0,B.EH)(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const de=(0,G.pC)(this.getCollections)?this.getCollections():null;if((0,G.Wi)(de))return void this.removeAll();let se=0;for(const re of de)(0,G.pC)(re)&&(se=this._processCollection(se,re));this.splice(se,this.length)}_createNewInstance(de){return new R.Z(de)}_processCollection(de,se){if(!se)return de;const re=this.itemFilterFunction?this.itemFilterFunction:j=>!!j;for(const j of se)if(j){if(re(j)){const Y=this.indexOf(j,de);Y>=0?Y!==de&&this.reorder(j,de):this.add(j,de),++de}if(this.getChildrenFunction){const Y=this.getChildrenFunction(j);if(Array.isArray(Y))for(const ee of Y)de=this._processCollection(de,ee);else de=this._processCollection(de,Y)}}return de}};(0,D._)([(0,H.Cb)()],oe.prototype,"getCollections",void 0),(0,D._)([(0,H.Cb)()],oe.prototype,"getChildrenFunction",void 0),(0,D._)([(0,H.Cb)()],oe.prototype,"itemFilterFunction",void 0),oe=(0,D._)([(0,ae.j)("esri.core.CollectionFlattener")],oe);const le=oe},23719:(nt,Ae,v)=>{"use strict";v.d(Ae,{BV:()=>$,Q4:()=>Q,c5:()=>Z,pE:()=>R});var D=v(21286);class R{constructor(B,H){this.min=B,this.max=H,this.range=H-B}ndiff(B,H=0){return Math.ceil((B-H)/this.range)*this.range+H}_normalize(B,H,X,te=0,ae=!1){return(X-=te)<B?X+=this.ndiff(B-X):X>H&&(X-=this.ndiff(X-H)),ae&&X===H&&(X=B),X+te}normalize(B,H=0,X=!1){return this._normalize(this.min,this.max,B,H,X)}clamp(B,H=0){return(0,D.uZ)(B-H,this.min,this.max)+H}monotonic(B,H,X){return B<H?H:H+this.ndiff(B-H,X)}minimalMonotonic(B,H,X){return this._normalize(B,B+this.range,H,X)}center(B,H,X){return H=this.monotonic(B,H,X),this.normalize((B+H)/2,X)}diff(B,H,X){return this.monotonic(B,H,X)-B}shortestSignedDiff(B,H){B=this.normalize(B);const X=(H=this.normalize(H))-B,te=H<B?this.minimalMonotonic(B,H)-B:H-this.minimalMonotonic(H,B);return Math.abs(X)<Math.abs(te)?X:te}contains(B,H,X){return H=this.minimalMonotonic(B,H),(X=this.minimalMonotonic(B,X))>B&&X<H}}function G(W){for(const B in W){const H=W[B];H instanceof Function&&(W[B]=H.bind(W))}return W}const Z=G(new R(0,2*Math.PI)),Q=G(new R(-Math.PI,Math.PI)),$=G(new R(0,360))},26584:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Z});var D=v(58817),R=v(63290),G=v(90888);class Z extends G.Z{constructor($,W,B){if(super($,W,B),!(this instanceof Z))return new Z($,W,B)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,($,W)=>{if(W&&"object"==typeof W&&"function"==typeof W.toJSON)return W;try{return(0,D.d9)(W)}catch{return"[object]"}}))}}catch($){throw R.Z.getLogger("esri.core.Error").error($),$}return{name:this.name,message:this.message,details:this.details}}static fromJSON($){return new Z($.name,$.message,$.details)}}Z.prototype.type="error"},61885:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>$});var D=v(17626),R=v(14517),G=v(54024),Z=v(76898);class Q{constructor(){this._emitter=new Q.EventEmitter(this)}emit(B,H){return this._emitter.emit(B,H)}on(B,H){return this._emitter.on(B,H)}once(B,H){return this._emitter.once(B,H)}hasEventListener(B){return this._emitter.hasEventListener(B)}}!function(W){class B{constructor(te=null){this._target=te,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(te,ae){const oe=this._listenersMap&&this._listenersMap.get(te);if(!oe)return!1;const le=this._target||this;return[...oe].forEach(de=>{de.call(le,ae)}),oe.length>0}on(te,ae){if(Array.isArray(te)){const le=te.map(de=>this.on(de,ae));return(0,G.AL)(le)}if(te.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const oe=this._listenersMap.get(te)||[];return oe.push(ae),this._listenersMap.set(te,oe),{remove:()=>{const le=this._listenersMap&&this._listenersMap.get(te)||[],de=le.indexOf(ae);de>=0&&le.splice(de,1)}}}once(te,ae){const oe=this.on(te,le=>{oe.remove(),ae.call(null,le)});return oe}hasEventListener(te){const ae=this._listenersMap&&this._listenersMap.get(te);return null!=ae&&ae.length>0}}W.EventEmitter=B,W.EventedMixin=X=>{let te=class extends X{constructor(){super(...arguments),this._emitter=new B}destroy(){this._emitter.clear()}emit(ae,oe){return this._emitter.emit(ae,oe)}on(ae,oe){return this._emitter.on(ae,oe)}once(ae,oe){return this._emitter.once(ae,oe)}hasEventListener(ae){return this._emitter.hasEventListener(ae)}};return te=(0,D._)([(0,Z.j)("esri.core.Evented")],te),te};let H=class extends R.Z{constructor(){super(...arguments),this._emitter=new Q.EventEmitter(this)}destroy(){this._emitter.clear()}emit(X,te){return this._emitter.emit(X,te)}on(X,te){return this._emitter.on(X,te)}once(X,te){return this._emitter.once(X,te)}hasEventListener(X){return this._emitter.hasEventListener(X)}};H=(0,D._)([(0,Z.j)("esri.core.Evented")],H),W.EventedAccessor=H}(Q||(Q={}));const $=Q},80542:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>W,r:()=>B});var D=v(17626),R=v(14517),G=v(72392),Z=v(77712),Q=v(76898),$=v(17760);const W=H=>{let X=class extends H{destroy(){this.destroyed||(this._get("handles")?.destroy(),this._get("updatingHandles")?.destroy())}get handles(){return this._get("handles")||new G.Z}get updatingHandles(){return this._get("updatingHandles")||new $.t}};return(0,D._)([(0,Z.Cb)({readOnly:!0})],X.prototype,"handles",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],X.prototype,"updatingHandles",null),X=(0,D._)([(0,Q.j)("esri.core.HandleOwner")],X),X};let B=class extends(W(R.Z)){};B=(0,D._)([(0,Q.j)("esri.core.HandleOwner")],B)},72392:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G});var D=v(56354),R=v(62208);class G{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let Q=0;return this._groups.forEach($=>{Q+=$.length}),Q}add(Q,$){if((0,D.TW)(Q)){const W=this._getOrCreateGroup($);for(const B of Q)this._isHandle(B)&&W.push(B)}else this._isHandle(Q)&&this._getOrCreateGroup($).push(Q);return this}forEach(Q,$){if("function"==typeof Q)this._groups.forEach(W=>W.forEach(Q));else{const W=this._getGroup(Q);W&&$&&W.forEach($)}}has(Q){return this._groups.has(this._ensureGroupKey(Q))}remove(Q){if("string"!=typeof Q&&(0,D.TW)(Q)){for(const $ of Q)this.remove($);return this}return this.has(Q)?(this._removeAllFromGroup(this._getGroup(Q)),this._groups.delete(this._ensureGroupKey(Q)),this):this}removeAll(){return this._groups.forEach(Q=>this._removeAllFromGroup(Q)),this._groups.clear(),this}_isHandle(Q){return Q&&!!Q.remove}_getOrCreateGroup(Q){if(this.has(Q))return this._getGroup(Q);const $=[];return this._groups.set(this._ensureGroupKey(Q),$),$}_getGroup(Q){return(0,R.j0)(this._groups.get(this._ensureGroupKey(Q)))}_ensureGroupKey(Q){return Q||"_default_"}_removeAllFromGroup(Q){Q.forEach($=>$.remove())}}},61996:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ej:()=>$,IG:()=>Z});var D=v(17626),R=v(76898);let G=0;const Z=W=>{let B=class extends W{constructor(...H){super(...H),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+G++})}};return B=(0,D._)([(0,R.j)("esri.core.Identifiable")],B),B};let $=class extends(Z(class{})){};$=(0,D._)([(0,R.j)("esri.core.Identifiable")],$)},78498:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(1036);class R{constructor(Z,Q){this._storage=new D.WJ,this._storage.maxSize=Z,Q&&this._storage.registerRemoveFunc("",Q)}put(Z,Q){this._storage.put(Z,Q,1,1)}pop(Z){return this._storage.pop(Z)}get(Z){return this._storage.get(Z)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},86810:(nt,Ae,v)=>{"use strict";v.d(Ae,{wq:()=>se,eC:()=>oe});var D=v(17626),R=v(14517),G=v(62208),Z=v(58817),Q=v(31283);class ${constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(j){const Y=new $;return this._values.forEach((ee,ie)=>{j&&j.has(ie)||Y.set(ie,(0,Z.d9)(ee.value),ee.origin)}),Y}get(j,Y){Y=this._normalizeOrigin(Y);const ee=this._values.get(j);return null==Y||ee?.origin===Y?ee?.value:void 0}originOf(j){return this._values.get(j)?.origin??Q.s3.USER}keys(j){j=this._normalizeOrigin(j);const Y=[...this._values.keys()];return null==j?Y:Y.filter(ee=>this._values.get(ee)?.origin===j)}set(j,Y,ee){if((ee=this._normalizeOrigin(ee))===Q.s3.DEFAULTS){const ie=this._values.get(j);if(ie&&null!=ie.origin&&ie.origin>ee)return}this._values.set(j,new W(Y,ee))}delete(j,Y){null!=(Y=this._normalizeOrigin(Y))&&this._values.get(j)?.origin!==Y||this._values.delete(j)}has(j,Y){return null!=(Y=this._normalizeOrigin(Y))?this._values.get(j)?.origin===Y:this._values.has(j)}forEach(j){this._values.forEach(({value:Y},ee)=>j(Y,ee))}_normalizeOrigin(j){if(null!=j)return j===Q.s3.DEFAULTS?j:Q.s3.USER}}class W{constructor(j,Y){this.value=j,this.origin=Y}}var B=v(12590),H=v(29338),X=v(52323),te=v(36054),ae=v(76898);const oe=re=>{let j=class extends re{constructor(...Y){super(...Y);const ee=(0,G.j0)((0,X.vw)(this)),ie=ee.store,J=new $;ee.store=J,(0,B.M)(ee,ie,J)}read(Y,ee){(0,H.i)(this,Y,ee)}write(Y={},ee){return(0,te.c)(this,Y,ee)}toJSON(Y){return this.write({},Y)}static fromJSON(Y,ee){return le.call(this,Y,ee)}};return j=(0,D._)([(0,ae.j)("esri.core.JSONSupport")],j),j.prototype.toJSON.isDefaultToJSON=!0,j};function le(re,j){if(!re)return null;if(re.declaredClass)throw new Error("JSON object is already hydrated");const Y=new this;return Y.read(re,j),Y}let se=class extends(oe(R.Z)){};se=(0,D._)([(0,ae.j)("esri.core.JSONSupport")],se)},93961:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(1036);class R{constructor(Z,Q){this._storage=new D.WJ,this._storage.maxSize=Z,Q&&this._storage.registerRemoveFunc("",Q)}put(Z,Q,$){this._storage.put(Z,Q,$,1)}pop(Z){return this._storage.pop(Z)}get(Z){return this._storage.get(Z)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(Z){this._storage.maxSize=Z}}},47996:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var D=v(17626),R=v(26584),G=v(60330),Z=v(10699),Q=v(14889),$=v(77712),W=v(76898);const ae=de=>{let se=class extends de{constructor(...re){super(...re),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(j=>{const Y=this.load.bind(this);this.load=ee=>{const ie=new Promise((J,ce)=>{const ue=(0,Z.$F)(ee,ce);this.destroyed&&ce(new R.Z("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(J,ce).finally(()=>{ue&&ue.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const J=this._loadController=new AbortController;Y({signal:J.signal}),(0,Z.fu)(J.signal,()=>{this._promiseProps.abort()})}return j(),ie}})),this.when(()=>{this._set("loadStatus","loaded"),this._loadController=null},j=>{this._set("loadStatus","failed"),this._set("loadError",j),this._loadController=null})}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new R.Z("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return(0,D._)([(0,$.Cb)({readOnly:!0})],se.prototype,"loaded",null),(0,D._)([(0,$.Cb)({readOnly:!0})],se.prototype,"loadError",void 0),(0,D._)([(0,$.Cb)({clonable:!1})],se.prototype,"loadStatus",void 0),(0,D._)([(0,$.Cb)({type:[Q.Z],readOnly:!0})],se.prototype,"loadWarnings",null),se=(0,D._)([(0,W.j)("esri.core.Loadable")],se),se};let oe=class extends(ae(G.D)){};var de;oe=(0,D._)([(0,W.j)("esri.core.Loadable")],oe),(de=oe||(oe={})).LoadableMixin=ae,de.isLoadable=function se(re){return!(!re||!re.load)};const le=oe},63290:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>$});var D=v(59318),G=(v(8314),v(62208)),Z=v(77275);const Q={info:0,warn:1,error:2,none:3};class ${constructor(B){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=B.level&&(this.level=B.level),null!=B.writer&&(this.writer=B.writer),this._module=B.module,$._loggers[this.module]=this;const H=this.module.lastIndexOf(".");-1!==H&&(this._parent=$.getLogger(this.module.slice(0,H)))}get module(){return this._module}get parent(){return this._parent}error(...B){this._log("error","always",...B)}warn(...B){this._log("warn","always",...B)}info(...B){this._log("info","always",...B)}errorOnce(...B){this._log("error","once",...B)}warnOnce(...B){this._log("warn","once",...B)}infoOnce(...B){this._log("info","once",...B)}errorOncePerTick(...B){this._log("error","oncePerTick",...B)}warnOncePerTick(...B){this._log("warn","oncePerTick",...B)}infoOncePerTick(...B){this._log("info","oncePerTick",...B)}get test(){const B=this;return{loggedMessages:B._loggedMessages,clearLoggedWarnings:()=>B._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(B={}){const H=$._loggers;return $._loggers=B,H},set throttlingDisabled(B){$._throttlingDisabled=B}}}static getLogger(B){let H=$._loggers[B];return H||(H=new $({module:B})),H}_log(B,H,...X){if(this._matchLevel(B)){if("always"!==H&&!$._throttlingDisabled){const te=this._argsToKey(X),ae=this._loggedMessages[B].get(te);if("once"===H&&null!=ae||"oncePerTick"===H&&ae&&ae>=$._tickCounter)return;this._loggedMessages[B].set(te,$._tickCounter),$._scheduleTickCounterIncrement()}for(const te of D.Z.log.interceptors)if(te(B,this.module,...X))return;this._inheritedWriter()(B,this.module,...X)}}_parentWithMember(B,H){let X=this;for(;(0,G.pC)(X);){const te=X[B];if((0,G.pC)(te))return te;X=X.parent}return H}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(B,H,...X){console[B](`[${H}]`,...X)}_matchLevel(B){return Q[this._parentWithMember("level",D.Z.log.level?D.Z.log.level:"warn")]<=Q[B]}_argsToKey(...B){return(0,Z.hP)(JSON.stringify(B,(X,te)=>"object"!=typeof te||Array.isArray(te)?te:"[Object]"))}static _scheduleTickCounterIncrement(){$._tickCounterScheduled||($._tickCounterScheduled=!0,Promise.resolve().then(()=>{$._tickCounter++,$._tickCounterScheduled=!1}))}}$._loggers={},$._tickCounter=0,$._tickCounterScheduled=!1,$._throttlingDisabled=!1},50011:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>se,M:()=>D});const D={Base64:0,Hex:1,String:2,Raw:3};function Z(re,j){const Y=(65535&re)+(65535&j);return(re>>16)+(j>>16)+(Y>>16)<<16|65535&Y}function X(re,j,Y,ee,ie,J){return Z(function H(re,j){return re<<j|re>>>32-j}(Z(Z(j,re),Z(ee,J)),ie),Y)}function te(re,j,Y,ee,ie,J,ce){return X(j&Y|~j&ee,re,j,ie,J,ce)}function ae(re,j,Y,ee,ie,J,ce){return X(j&ee|Y&~ee,re,j,ie,J,ce)}function oe(re,j,Y,ee,ie,J,ce){return X(j^Y^ee,re,j,ie,J,ce)}function le(re,j,Y,ee,ie,J,ce){return X(Y^(j|~ee),re,j,ie,J,ce)}function se(re,j=D.Hex){const Y=j||D.Base64,ee=function de(re,j){re[j>>5]|=128<<j%32,re[14+(j+64>>>9<<4)]=j;let Y=1732584193,ee=-271733879,ie=-1732584194,J=271733878;for(let ce=0;ce<re.length;ce+=16){const ue=Y,pe=ee,he=ie,me=J;Y=te(Y,ee,ie,J,re[ce+0],7,-680876936),J=te(J,Y,ee,ie,re[ce+1],12,-389564586),ie=te(ie,J,Y,ee,re[ce+2],17,606105819),ee=te(ee,ie,J,Y,re[ce+3],22,-1044525330),Y=te(Y,ee,ie,J,re[ce+4],7,-176418897),J=te(J,Y,ee,ie,re[ce+5],12,1200080426),ie=te(ie,J,Y,ee,re[ce+6],17,-1473231341),ee=te(ee,ie,J,Y,re[ce+7],22,-45705983),Y=te(Y,ee,ie,J,re[ce+8],7,1770035416),J=te(J,Y,ee,ie,re[ce+9],12,-1958414417),ie=te(ie,J,Y,ee,re[ce+10],17,-42063),ee=te(ee,ie,J,Y,re[ce+11],22,-1990404162),Y=te(Y,ee,ie,J,re[ce+12],7,1804603682),J=te(J,Y,ee,ie,re[ce+13],12,-40341101),ie=te(ie,J,Y,ee,re[ce+14],17,-1502002290),ee=te(ee,ie,J,Y,re[ce+15],22,1236535329),Y=ae(Y,ee,ie,J,re[ce+1],5,-165796510),J=ae(J,Y,ee,ie,re[ce+6],9,-1069501632),ie=ae(ie,J,Y,ee,re[ce+11],14,643717713),ee=ae(ee,ie,J,Y,re[ce+0],20,-373897302),Y=ae(Y,ee,ie,J,re[ce+5],5,-701558691),J=ae(J,Y,ee,ie,re[ce+10],9,38016083),ie=ae(ie,J,Y,ee,re[ce+15],14,-660478335),ee=ae(ee,ie,J,Y,re[ce+4],20,-405537848),Y=ae(Y,ee,ie,J,re[ce+9],5,568446438),J=ae(J,Y,ee,ie,re[ce+14],9,-1019803690),ie=ae(ie,J,Y,ee,re[ce+3],14,-187363961),ee=ae(ee,ie,J,Y,re[ce+8],20,1163531501),Y=ae(Y,ee,ie,J,re[ce+13],5,-1444681467),J=ae(J,Y,ee,ie,re[ce+2],9,-51403784),ie=ae(ie,J,Y,ee,re[ce+7],14,1735328473),ee=ae(ee,ie,J,Y,re[ce+12],20,-1926607734),Y=oe(Y,ee,ie,J,re[ce+5],4,-378558),J=oe(J,Y,ee,ie,re[ce+8],11,-2022574463),ie=oe(ie,J,Y,ee,re[ce+11],16,1839030562),ee=oe(ee,ie,J,Y,re[ce+14],23,-35309556),Y=oe(Y,ee,ie,J,re[ce+1],4,-1530992060),J=oe(J,Y,ee,ie,re[ce+4],11,1272893353),ie=oe(ie,J,Y,ee,re[ce+7],16,-155497632),ee=oe(ee,ie,J,Y,re[ce+10],23,-1094730640),Y=oe(Y,ee,ie,J,re[ce+13],4,681279174),J=oe(J,Y,ee,ie,re[ce+0],11,-358537222),ie=oe(ie,J,Y,ee,re[ce+3],16,-722521979),ee=oe(ee,ie,J,Y,re[ce+6],23,76029189),Y=oe(Y,ee,ie,J,re[ce+9],4,-640364487),J=oe(J,Y,ee,ie,re[ce+12],11,-421815835),ie=oe(ie,J,Y,ee,re[ce+15],16,530742520),ee=oe(ee,ie,J,Y,re[ce+2],23,-995338651),Y=le(Y,ee,ie,J,re[ce+0],6,-198630844),J=le(J,Y,ee,ie,re[ce+7],10,1126891415),ie=le(ie,J,Y,ee,re[ce+14],15,-1416354905),ee=le(ee,ie,J,Y,re[ce+5],21,-57434055),Y=le(Y,ee,ie,J,re[ce+12],6,1700485571),J=le(J,Y,ee,ie,re[ce+3],10,-1894986606),ie=le(ie,J,Y,ee,re[ce+10],15,-1051523),ee=le(ee,ie,J,Y,re[ce+1],21,-2054922799),Y=le(Y,ee,ie,J,re[ce+8],6,1873313359),J=le(J,Y,ee,ie,re[ce+15],10,-30611744),ie=le(ie,J,Y,ee,re[ce+6],15,-1560198380),ee=le(ee,ie,J,Y,re[ce+13],21,1309151649),Y=le(Y,ee,ie,J,re[ce+4],6,-145523070),J=le(J,Y,ee,ie,re[ce+11],10,-1120210379),ie=le(ie,J,Y,ee,re[ce+2],15,718787259),ee=le(ee,ie,J,Y,re[ce+9],21,-343485551),Y=Z(Y,ue),ee=Z(ee,pe),ie=Z(ie,he),J=Z(J,me)}return[Y,ee,ie,J]}(function Q(re){const j=[];for(let Y=0,ee=8*re.length;Y<ee;Y+=8)j[Y>>5]|=(255&re.charCodeAt(Y/8))<<Y%32;return j}(re),8*re.length);switch(Y){case D.Raw:return ee;case D.Hex:return function W(re){const j="0123456789abcdef",Y=[];for(let ee=0,ie=4*re.length;ee<ie;ee++)Y.push(j.charAt(re[ee>>2]>>ee%4*8+4&15)+j.charAt(re[ee>>2]>>ee%4*8&15));return Y.join("")}(ee);case D.String:return function $(re){const j=[];for(let Y=0,ee=32*re.length;Y<ee;Y+=8)j.push(String.fromCharCode(re[Y>>5]>>>Y%32&255));return j.join("")}(ee);case D.Base64:return function B(re){const ee=[];for(let ie=0,J=4*re.length;ie<J;ie+=3){const ce=(re[ie>>2]>>ie%4*8&255)<<16|(re[ie+1>>2]>>(ie+1)%4*8&255)<<8|re[ie+2>>2]>>(ie+2)%4*8&255;for(let ue=0;ue<4;ue++)ee.push(8*ie+6*ue>32*re.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(ce>>6*(3-ue)&63))}return ee.join("")}(ee)}}},88159:(nt,Ae,v)=>{"use strict";function D(Q,$){for(const[W,B]of Q)if($(B,W))return!0;return!1}function R(Q,$){for(const[W,B]of Q)if($(B,W))return B;return null}function G(Q,$,W){const B=Q.get($);if(void 0!==B)return B;const H=W();return Q.set($,H),H}v.d(Ae,{fQ:()=>R,oE:()=>D,s1:()=>G})},1036:(nt,Ae,v)=>{"use strict";v.d(Ae,{WJ:()=>$,Xq:()=>Q,an:()=>G,lN:()=>Z});var D=v(62208),R=v(77029);const G=-3;var Z,W;(W=Z||(Z={}))[W.ALL=0]="ALL",W[W.SOME=1]="SOME";class Q{constructor(B,H,X){this._namespace=B,this._storage=H,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",X&&(this._storage.registerRemoveFunc(this._namespace,X),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(B,H,X,te=0){this._storage.put(this._namespace+B,H,X,te)}get(B){const H=this._storage.get(this._namespace+B);return void 0===H?++this._miss:++this._hit,H}pop(B){const H=this._storage.pop(this._namespace+B);return void 0===H?++this._miss:++this._hit,H}updateSize(B,H,X){this._storage.updateSize(this._namespace+B,H,X)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class ${constructor(B=10485760){this._maxSize=B,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new R.Z,this._users=new R.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(B){this._users.push(B)}deregister(B){this._users.removeUnordered(B)}registerRemoveFunc(B,H){this._removeFuncs.push([B,H])}deregisterRemoveFunc(B){this._removeFuncs.filterInPlace(H=>H[0]!==B)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(B){this._maxSize=Math.max(B,0),this._checkSizeLimit()}put(B,H,X,te){const ae=this._db.get(B);if(ae&&(this._size-=ae.size,this._db.delete(B),ae.entry!==H&&this._notifyRemove(B,ae.entry,Z.ALL)),X>this._maxSize)return void this._notifyRemove(B,H,Z.ALL);if(void 0===H)return void console.warn("Refusing to cache undefined entry ");if(!X||X<0)return void console.warn("Refusing to cache entry with invalid size "+X);const oe=1+Math.max(te,G)-G;this._db.set(B,{entry:H,size:X,lifetime:oe,lives:oe}),this._size+=X,this._checkSizeLimit()}updateSize(B,H,X){const te=this._db.get(B);if(te&&te.entry===H){for(this._size-=te.size;X>this._maxSize;){const ae=this._notifyRemove(B,H,Z.SOME);if(!((0,D.pC)(ae)&&ae>0))return void this._db.delete(B);X=ae}te.size=X,this._size+=X,this._checkSizeLimit()}}pop(B){const H=this._db.get(B);if(H)return this._size-=H.size,this._db.delete(B),++this._hit,H.entry;++this._miss}get(B){const H=this._db.get(B);if(void 0!==H)return this._db.delete(B),H.lives=H.lifetime,this._db.set(B,H),++this._hit,H.entry;++this._miss}getStats(){const B={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},H={},X=new Array;this._db.forEach((oe,le)=>{const de=oe.lifetime;X[de]=(X[de]||0)+oe.size,this._users.forAll(se=>{const re=se.namespace;le.startsWith(re)&&(H[re]=(H[re]||0)+oe.size)})});const te={};this._users.forAll(oe=>{const le=oe.namespace;!isNaN(oe.hitRate)&&oe.hitRate>0?(H[le]=H[le]||0,te[le]=Math.round(100*oe.hitRate)+"%"):te[le]="0%"});const ae=Object.keys(H);ae.sort((oe,le)=>H[le]-H[oe]),ae.forEach(oe=>B[oe]=Math.round(H[oe]/2**20)+"MB / "+te[oe]);for(let oe=X.length-1;oe>=0;--oe){const le=X[oe];le&&(B["Priority "+(oe+G-1)]=Math.round(le/this.size*100)+"%")}return B}resetStats(){this._hit=this._miss=0,this._users.forAll(B=>B.resetHitRate())}clear(B){this._db.forEach((H,X)=>{X.startsWith(B)&&(this._size-=H.size,this._db.delete(X),this._notifyRemove(X,H.entry,Z.ALL))})}clearAll(){this._db.forEach((B,H)=>this._notifyRemove(H,B.entry,Z.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(B,H,X){let te;return this._removeFuncs.some(ae=>{if(B.startsWith(ae[0])){const oe=ae[1](H,X);return"number"==typeof oe&&(te=oe),!0}return!1}),te}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[B,H]of this._db){if(this._db.delete(B),H.lives<=1){this._size-=H.size;const X=this._notifyRemove(B,H.entry,Z.SOME);(0,D.pC)(X)&&X>0&&(this._size+=X,H.lives=H.lifetime,H.size=X,this._db.set(B,H))}else--H.lives,this._db.set(B,H);if(this._size<=.9*this.maxSize)return}}}},90888:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G});var D=v(94113);class G{constructor(Q,$,W){this.name=Q,this.details=W,this instanceof G&&(this.message=($&&function R(Z,Q){return Z.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,($,W)=>{if(""===W)return"$";const H=(0,D.hS)(W,Q)??"";if(void 0===H)throw new Error(`could not find key "${W}" in template`);return H.toString()})}($,W))??"")}toString(){return"["+this.name+"]: "+this.message}}},99959:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>re,w:()=>j});var D=v(17626),R=v(14517),G=v(62208),Z=v(12590),Q=v(58817),$=v(31283);class W{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array($.kk),this._values=new Map,this.multipleOriginsSupported=!0}clone(ee){const ie=new W,J=this._originStores[$.s3.DEFAULTS];J&&J.forEach((ce,ue)=>{ie.set(ue,(0,Q.d9)(ce),$.s3.DEFAULTS)});for(let ce=$.s3.SERVICE;ce<$.kk;ce++){const ue=this._originStores[ce];ue&&ue.forEach((pe,he)=>{ee&&ee.has(he)||ie.set(he,(0,Q.d9)(pe),ce)})}return ie}get(ee,ie){const J=void 0===ie?this._values:this._originStores[ie];return J?J.get(ee):void 0}keys(ee){const ie=null==ee?this._values:this._originStores[ee];return ie?[...ie.keys()]:[]}set(ee,ie,J=$.s3.USER){let ce=this._originStores[J];if(ce||(ce=new Map,this._originStores[J]=ce),ce.set(ee,ie),!this._values.has(ee)||(0,G.j0)(this._propertyOriginMap.get(ee))<=J){const ue=this._values.get(ee);return this._values.set(ee,ie),this._propertyOriginMap.set(ee,J),ue!==ie}return!1}delete(ee,ie=$.s3.USER){const J=this._originStores[ie];if(!J)return;const ce=J.get(ee);if(J.delete(ee),this._values.has(ee)&&this._propertyOriginMap.get(ee)===ie){this._values.delete(ee);for(let ue=ie-1;ue>=0;ue--){const pe=this._originStores[ue];if(pe&&pe.has(ee)){this._values.set(ee,pe.get(ee)),this._propertyOriginMap.set(ee,ue);break}}}return ce}has(ee,ie){const J=void 0===ie?this._values:this._originStores[ie];return!!J&&J.has(ee)}revert(ee,ie){for(;ie>0&&!this.has(ee,ie);)--ie;const J=this._originStores[ie],ce=J&&J.get(ee),ue=this._values.get(ee);return this._values.set(ee,ce),this._propertyOriginMap.set(ee,ie),ue!==ce}originOf(ee){return this._propertyOriginMap.get(ee)||$.s3.DEFAULTS}forEach(ee){this._values.forEach(ee)}}var B=v(29338),H=v(52323),X=v(76898);const te=Y=>{let ee=class extends Y{constructor(...ie){super(...ie);const J=(0,G.j0)((0,H.vw)(this)),ce=J.store,ue=new W;J.store=ue,(0,Z.M)(J,ce,ue)}read(ie,J){(0,B.i)(this,ie,J)}getAtOrigin(ie,J){const ce=ae(this),ue=(0,$.M9)(J);if("string"==typeof ie)return ce.get(ie,ue);const pe={};return ie.forEach(he=>{pe[he]=ce.get(he,ue)}),pe}originOf(ie){return(0,$.x3)(this.originIdOf(ie))}originIdOf(ie){return ae(this).originOf(ie)}revert(ie,J){const ce=ae(this),ue=(0,$.M9)(J),pe=(0,H.vw)(this);let he;he="string"==typeof ie?"*"===ie?ce.keys(ue):[ie]:ie,he.forEach(me=>{pe.invalidate(me),ce.revert(me,ue),pe.commit(me)})}};return ee=(0,D._)([(0,X.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],ee),ee};function ae(Y){return(0,H.vw)(Y).store}let oe=class extends(te(R.Z)){};oe=(0,D._)([(0,X.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],oe);var le=v(36054);const de=Y=>{let ee=class extends Y{constructor(...ie){super(...ie)}clear(ie,J="user"){return se(this).delete(ie,(0,$.M9)(J))}write(ie={},J){return(0,le.c)(this,ie=ie||{},J),ie}setAtOrigin(ie,J,ce){(0,H.vw)(this).setAtOrigin(ie,J,(0,$.M9)(ce))}removeOrigin(ie){const J=se(this),ce=(0,$.M9)(ie),ue=J.keys(ce);for(const pe of ue)J.originOf(pe)===ce&&J.set(pe,J.get(pe,ce),$.s3.USER)}updateOrigin(ie,J){const ce=se(this),ue=(0,$.M9)(J),pe=this.get(ie);for(let he=ue+1;he<$.kk;++he)ce.delete(ie,he);ce.set(ie,pe,ue)}toJSON(ie){return this.write({},ie)}};return ee=(0,D._)([(0,X.j)("esri.core.WriteableMultiOriginJSONSupport")],ee),ee.prototype.toJSON.isDefaultToJSON=!0,ee};function se(Y){return(0,H.vw)(Y).store}const re=Y=>{let ee=class extends(de(te(Y))){constructor(...ie){super(...ie)}};return ee=(0,D._)([(0,X.j)("esri.core.MultiOriginJSONSupport")],ee),ee};let j=class extends(re(R.Z)){};j=(0,D._)([(0,X.j)("esri.core.MultiOriginJSONSupport")],j)},1101:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>D});class D{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(G,Z){return this._outer.get(G)?.get(Z)}set(G,Z,Q){const $=this._outer.get(G);$?$.set(Z,Q):this._outer.set(G,new Map([[Z,Q]]))}delete(G,Z){const Q=this._outer.get(G);Q&&(Q.delete(Z),0===Q.size&&this._outer.delete(G))}forEach(G){this._outer.forEach((Z,Q)=>G(Z,Q))}}},27899:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G});let G=(()=>{class Z{constructor($,W,B,H=1,X=0){if(this._ctor=$,this._acquireFunction=W,this._releaseFunction=B,this.allocationSize=H,this._pool=new Array(X),this._initialSize=X,this._ctor)for(let te=0;te<X;te++)this._pool[te]=new this._ctor;this.allocationSize=Math.max(H,1)}destroy(){this.prune(0)}acquire(...$){let W;if(Z.test.disabled)W=new this._ctor;else{if(0===this._pool.length){const B=this.allocationSize;for(let H=0;H<B;H++)this._pool[H]=new this._ctor}W=this._pool.pop()}return this._acquireFunction?this._acquireFunction(W,...$):function R(Z){return Z&&Z.acquire&&"function"==typeof Z.acquire}(W)&&W.acquire(...$),W}release($){$&&!Z.test.disabled&&(this._releaseFunction?this._releaseFunction($):function D(Z){return Z&&Z.release&&"function"==typeof Z.release}($)&&$.release(),this._pool.push($))}prune($=this._initialSize){if(!($>=this._pool.length)){for(let W=$;W<this._pool.length;++W)this._dispose(this._pool[W]);this._pool.length=$}}_dispose($){$.dispose&&"function"==typeof $.dispose&&$.dispose()}}return Z.test={disabled:!1},Z})()},97535:(nt,Ae,v)=>{"use strict";v.d(Ae,{x:()=>R});var D=v(79682);class R{constructor(Q){this._allocator=Q,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,D.Y)(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const Q=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*G);this._items.length=Math.min(Q,this._items.length),this._itemsPtr=0}_grow(){for(let Q=0;Q<Math.max(8,Math.min(this._items.length,G));Q++)this._items.push(this._allocator())}}const G=1024},73234:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{y:()=>D}),(R=D||(D={}))[R.ADD=1]="ADD",R[R.REMOVE=2]="REMOVE",R[R.MOVE=4]="MOVE"},73362:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(62208);class R{constructor(Z,Q=30){this.name=Z,this._counter=0,this._samples=new Array(Q)}record(Z){(0,D.pC)(Z)&&(this._samples[++this._counter%this._samples.length]=Z)}get median(){return this._samples.slice().sort((Z,Q)=>Z-Q)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((Z,Q)=>Z+Q,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}},77029:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>$});var R,D=v(85931);!function(B){const H=(oe,le,de,se)=>{let re=le,j=le;const Y=de>>>1,ee=oe[re-1];for(;j<=Y;){j=re<<1,j<de&&se(oe[j-1],oe[j])<0&&++j;const ie=oe[j-1];if(se(ie,ee)<=0)break;oe[re-1]=ie,re=j}oe[re-1]=ee},X=(oe,le)=>oe<le?-1:oe>le?1:0;B.sort=function te(oe,le,de,se){void 0===le&&(le=0),void 0===de&&(de=oe.length),void 0===se&&(se=X);for(let j=de>>>1;j>le;j--)H(oe,j,de,se);const re=le+1;for(let j=de-1;j>le;j--){const Y=oe[le];oe[le]=oe[j],oe[j]=Y,H(oe,re,j,se)}},B.iterableSort=function*ae(oe,le,de,se){void 0===le&&(le=0),void 0===de&&(de=oe.length),void 0===se&&(se=X);for(let j=de>>>1;j>le;j--)H(oe,j,de,se),yield;const re=le+1;for(let j=de-1;j>le;j--){const Y=oe[le];oe[le]=oe[j],oe[j]=Y,H(oe,re,j,se),yield}}}(R||(R={}));const G=R;class ${constructor(H){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new D.SO,H&&(H.initialSize&&(this.data=new Array(H.initialSize)),H.allocator&&(this._allocator=H.allocator),void 0!==H.deallocator&&(this._deallocator=H.deallocator),H.shrink&&(this._shrink=()=>W(this)))}toArray(){return this.data.slice(0,this.length)}filter(H){const X=new Array;for(let te=0;te<this._length;te++){const ae=this.data[te];H(ae)&&X.push(ae)}return X}getItemAt(H){if(!(H<0||H>=this._length))return this.data[H]}includes(H,X){const te=this.data.indexOf(H,X);return-1!==te&&te<this.length}get length(){return this._length}set length(H){if(H>this._length){if(this._allocator){for(;this._length<H;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=H}else{if(this._deallocator)for(let X=H;X<this._length;++X)this.data[X]=this._deallocator(this.data[X]);this._length=H,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(H){this.data[this._length++]=H}pushArray(H,X=H.length){for(let te=0;te<X;te++)this.data[this._length++]=H[te]}fill(H,X){for(let te=0;te<X;te++)this.data[this._length++]=H}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const H=this.data[this._length];return++this._length,H}unshift(H){this.data.unshift(H),this._length++,W(this)}pop(){if(0===this.length)return;const H=this.data[this.length-1];return this.length=this.length-1,this._shrink(),H}remove(H){const X=(0,D.cq)(this.data,H,this.length,this._hint);if(-1!==X)return this.data.splice(X,1),this.length=this.length-1,H}removeUnordered(H){return this.removeUnorderedIndex((0,D.cq)(this.data,H,this.length,this._hint))}removeUnorderedIndex(H){if(!(H>=this.length||H<0))return this.swapElements(H,this.length-1),this.pop()}removeUnorderedMany(H,X=H.length,te){this.length=(0,D.FY)(this.data,H,this.length,X,this._hint,te),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(H,X){if(H>=this.length||X>=this.length||H===X)return;const te=this.data[H];this.data[H]=this.data[X],this.data[X]=te}sort(H){G.sort(this.data,0,this.length,H)}iterableSort(H){return G.iterableSort(this.data,0,this.length,H)}some(H,X){for(let te=0;te<this.length;++te)if(H.call(X,this.data[te],te,this.data))return!0;return!1}filterInPlace(H,X){let te=0;for(let ae=0;ae<this._length;++ae){const oe=this.data[ae];H.call(X,oe,ae,this.data)&&(this.data[ae]=this.data[te],this.data[te]=oe,te++)}if(this._deallocator)for(let ae=te;ae<this._length;ae++)this.data[ae]=this._deallocator(this.data[ae]);return this._length=te,this._shrink(),this}forAll(H,X){const te=this.length,ae=this.data;for(let oe=0;oe<te;++oe)H.call(X,ae[oe],oe,ae)}forEach(H,X){for(let te=0;te<this.length;++te)H.call(X,this.data[te],te,this.data)}map(H,X){const te=new Array(this.length);for(let ae=0;ae<this.length;++ae)te[ae]=H.call(X,this.data[ae],ae,this.data);return te}reduce(H,X){let te=X;for(let ae=0;ae<this.length;++ae)te=H(te,this.data[ae],ae,this.data);return te}has(H){const X=this.length,te=this.data;for(let ae=0;ae<X;++ae)if(te[ae]===H)return!0;return!1}}function W(B){B.data.length>1.5*B.length&&(B.data.length=Math.floor(1.1*B.length))}},60330:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>H,v:()=>B});var $,X,D=v(17626),R=v(14517),G=v(62208),Z=v(10699),Q=v(76898);(X=$||($={}))[X.PENDING=0]="PENDING",X[X.RESOLVED=1]="RESOLVED",X[X.REJECTED=2]="REJECTED";class W{constructor(te){this.instance=te,this._resolver=(0,Z.dD)(),this._status=$.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=$.RESOLVED,this._cleanUp()},()=>{this._status=$.REJECTED,this._cleanUp()})}addResolvingPromise(te){this._resolvingPromises.push(te),this._tryResolve()}isResolved(){return this._status===$.RESOLVED}isRejected(){return this._status===$.REJECTED}isFulfilled(){return this._status!==$.PENDING}abort(){this._resolver.reject((0,Z.zE)())}when(te,ae){return this._resolver.promise.then(te,ae)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const te=(0,Z.dD)(),ae=[...this._resolvingPromises,(0,G.j0)(te.promise)],oe=this._allPromise=Promise.all(ae);oe.then(()=>{this.isFulfilled()||this._allPromise!==oe||this._resolver.resolve(this.instance)},le=>{this.isFulfilled()||this._allPromise!==oe||(0,Z.D_)(le)||this._resolver.reject(le)}),te.resolve()}}const B=X=>{let te=class extends X{constructor(...ae){super(...ae),this._promiseProps=new W(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(ae,oe){return new Promise((le,de)=>{this._promiseProps.when(le,de)}).then(ae,oe)}catch(ae){return this.when(null,ae)}addResolvingPromise(ae){ae&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in ae?ae.when():ae)}};return te=(0,D._)([(0,Q.j)("esri.core.Promise")],te),te};let H=class extends(B(R.Z)){};H=(0,D._)([(0,Q.j)("esri.core.Promise")],H)},35133:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(62208);class R{constructor(Z=(Q=>Q.values().next().value)){this._peeker=Z,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(0===this._items.size)return;let Z;for(Z of this._items);return Z}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(Z){this.contains(Z)||this._items.add(Z)}contains(Z){return this._items.has(Z)}pop(){if(0===this.length)return;const Z=this.peek();return this._items.delete((0,D.j0)(Z)),Z}popLast(){if(0===this.length)return;const Z=this.last();return this._items.delete((0,D.j0)(Z)),Z}remove(Z){this._items.delete(Z)}filter(Z){return this._items.forEach(Q=>{Z(Q)||this._items.delete(Q)}),this}}},4619:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>D});class D{constructor(G=1){this._seed=G}set seed(G){this._seed=G??Math.random()*D._m}getInt(){return this._seed=(D._a*this._seed+D._c)%D._m,this._seed}getFloat(){return this.getInt()/(D._m-1)}getIntRange(G,Z){return Math.round(this.getFloatRange(G,Z))}getFloatRange(G,Z){const Q=Z-G;return G+this.getInt()/D._m*Q}}D._m=2147483647,D._a=48271,D._c=0},94530:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>G});var D=v(62208),R=v(27899);class G extends R.Z{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=(0,D.wN)(this._set)}acquire(...Q){const $=super.acquire(...Q);return this._set.delete($),$}release(Q){Q&&!this._set.has(Q)&&(super.release(Q),this._set.add(Q))}_dispose(Q){this._set.delete(Q),super._dispose(Q)}}},28862:(nt,Ae,v)=>{"use strict";function D(G,Z){for(const Q of G.entries())if(Z(Q[0]))return!0;return!1}v.d(Ae,{f:()=>D})},10349:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>R});var D=v(26584);class R{constructor(Z,Q,$=""){this.major=Z,this.minor=Q,this._context=$}lessThan(Z,Q){return this.major<Z||Z===this.major&&this.minor<Q}since(Z,Q){return!this.lessThan(Z,Q)}validate(Z){if(this.major!==Z.major)throw new D.Z((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:Z})}clone(){return new R(this.major,this.minor,this._context)}static parse(Z,Q=""){const[$,W]=Z.split("."),B=/^\s*\d+\s*$/;if(!$||!$.match||!$.match(B))throw new D.Z((Q&&Q+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:Z});if(!W||!W.match||!W.match(B))throw new D.Z((Q&&Q+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:Z});const H=parseInt($,10),X=parseInt(W,10);return new R(H,X,Q)}}},14889:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(90888);class R extends D.Z{constructor(Z,Q,$){if(super(Z,Q,$),!(this instanceof R))return new R(Z,Q,$)}}R.prototype.type="warning"},31283:(nt,Ae,v)=>{"use strict";v.d(Ae,{M9:()=>Z,Wm:()=>W,kk:()=>G,s3:()=>R,x3:()=>Q});var R,X,D=v(62208);(X=R||(R={}))[X.DEFAULTS=0]="DEFAULTS",X[X.COMPUTED=1]="COMPUTED",X[X.SERVICE=2]="SERVICE",X[X.PORTAL_ITEM=3]="PORTAL_ITEM",X[X.WEB_SCENE=4]="WEB_SCENE",X[X.WEB_MAP=5]="WEB_MAP",X[X.USER=6]="USER";const G=R.USER+1;function Z(X){switch(X){case"defaults":return R.DEFAULTS;case"service":return R.SERVICE;case"portal-item":return R.PORTAL_ITEM;case"web-scene":return R.WEB_SCENE;case"web-map":return R.WEB_MAP;case"user":return R.USER;default:return null}}function Q(X){switch(X){case R.DEFAULTS:return"defaults";case R.SERVICE:return"service";case R.PORTAL_ITEM:return"portal-item";case R.WEB_SCENE:return"web-scene";case R.WEB_MAP:return"web-map";case R.USER:return"user"}return(0,D.j0)(void 0)}function W(X){return Q(X)}},66656:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>W});var D=v(90912),R=v(34117);const G=Object.prototype.toString;function Z(B){const H="__accessorMetadata__"in B?(0,D.se)(B):B;return function(...X){if(X.push(H),"number"==typeof X[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Q.apply(this,X)}}function Q(B,H,X,te){(0,R.VZ)(B,H).cast=te}function W(...B){if(3!==B.length||"string"!=typeof B[1])return 1===B.length&&"[object Function]"===G.call(B[0])?Z(B[0]):1===B.length&&"string"==typeof B[0]?function $(B){return(H,X)=>{(0,R.VZ)(H,B).cast=H[X]}}(B[0]):void 0}},55342:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>G});var D=v(2076),R=v(77712);function G(Z,Q={}){const $=Z instanceof D.X?Z:new D.X(Z,Q),W={type:Q?.ignoreUnknown??1?$.apiValues:String,json:{type:$.jsonValues,read:!Q?.readOnly&&{reader:$.read},write:{writer:$.write}}};return void 0!==Q?.readOnly&&(W.readOnly=!!Q.readOnly),void 0!==Q?.default&&(W.json.default=Q.default),void 0!==Q?.name&&(W.json.name=Q.name),(0,R.Cb)(W)}},77712:(nt,Ae,v)=>{"use strict";v.d(Ae,{CJ:()=>W,Cb:()=>$,Eg:()=>H});var D=v(63290),R=v(90912),G=v(34595),Z=v(34117),Q=v(82255);function $(X={}){return(te,ae)=>{if(te===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${te.name}.${ae}. Accessor does not support static properties.`);const oe=Object.getOwnPropertyDescriptor(te,ae),le=(0,Z.VZ)(te,ae);oe&&(oe.get||oe.set?(le.get=oe.get||le.get,le.set=oe.set||le.set):"value"in oe&&("value"in X&&D.Z.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${ae}" on "${te.constructor.name}" already defined in the metadata`,X),le.value=X.value=oe.value)),null!=X.readOnly&&(le.readOnly=X.readOnly);const de=X.aliasOf;if(de){const j="string"==typeof de?de:de.source,Y="string"==typeof de?null:!0===de.overridable;let ee;le.dependsOn=[j],le.get=function(){let ie=(0,G.U2)(this,j);if("function"==typeof ie){ee||(ee=j.split(".").slice(0,-1).join("."));const J=(0,G.U2)(this,ee);J&&(ie=ie.bind(J))}return ie},le.readOnly||(le.set=Y?function(ie){this._override(ae,ie)}:function(ie){(0,Q.t)(this,j,ie)})}const se=X.type,re=X.types;le.cast||(se?le.cast=function B(X){let te=0,ae=X;if((0,R.AY)(X))return(0,R.sY)(X);for(;Array.isArray(ae)&&1===ae.length&&"string"!=typeof ae[0]&&"number"!=typeof ae[0];)ae=ae[0],te++;const oe=ae;if((0,R.gB)(oe))return 0===te?(0,R.i$)(oe):(0,R.Iu)((0,R.i$)(oe),te);if(1===te)return(0,R.rY)(oe);if(te>1)return(0,R.di)(oe,te);return X.from?X.from:(0,R.se)(X)}(se):re&&(le.cast=Array.isArray(re)?(0,R.Ls)((0,R.N7)(re[0])):(0,R.N7)(re))),(0,Z.tz)(le,X),X.range&&(le.cast=H(le.cast,X.range))}}function W(X,te,ae){const oe=(0,Z.VZ)(X,ae);oe.json||(oe.json={});let le=oe.json;return void 0!==te&&(le.origins||(le.origins={}),le.origins[te]||(le.origins[te]={}),le=le.origins[te]),le}function H(X,te){return ae=>{let oe=+X(ae);return null!=te.step&&(oe=Math.round(oe/te.step)*te.step),null!=te.min&&(oe=Math.max(te.min,oe)),null!=te.max&&(oe=Math.min(te.max,oe)),oe}}},68653:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>R});var D=v(77712);function R(G,Z,Q){let $,W;return void 0===Z||Array.isArray(Z)?(W=G,Q=Z,$=[void 0]):(W=Z,$=Array.isArray(G)?G:[G]),(B,H)=>{const X=B.constructor.prototype;$.forEach(te=>{const ae=(0,D.CJ)(B,te,W);ae.read&&"object"==typeof ae.read||(ae.read={}),ae.read.reader=X[H],Q&&(ae.read.source=(ae.read.source||[]).concat(Q))})}}},61039:(nt,Ae,v)=>{"use strict";function D(R){return(G,Z)=>{G[Z]=R}}v.d(Ae,{c:()=>D})},76898:(nt,Ae,v)=>{"use strict";v.d(Ae,{j:()=>B}),v(8314);var R=v(44648),G=v(34117),Z=v(36082),Q=v(33794);const $=new Set,W=new Set;function B(te){return ae=>{ae.prototype.declaredClass=te,function X(te){const oe=(0,G.JT)(te.prototype).properties,le={};for(const de of Object.getOwnPropertyNames(oe)){const se=oe[de];(0,Q.OM)(se),le[de]={enumerable:!0,configurable:!0,get:H(de,se),set(re){const j=this.__accessor__;if(void 0!==j){if(!Object.isFrozen(this)){if(j.initialized&&se.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${de}' of ${this.declaredClass}`);if(j.lifecycle===R.F.CONSTRUCTED&&se.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${de}' of ${this.declaredClass}`);j.set(de,re)}}else Object.defineProperty(this,de,{enumerable:!0,configurable:!0,writable:!0,value:re})}}}Object.defineProperties(te.prototype,le)}(ae);const oe=[],le=[];let de=ae.prototype;for(;de;)de.hasOwnProperty("initialize")&&!$.has(de.initialize)&&($.add(de.initialize),oe.push(de.initialize)),de.hasOwnProperty("destroy")&&!W.has(de.destroy)&&(W.add(de.destroy),le.push(de.destroy)),de=Object.getPrototypeOf(de);$.clear(),W.clear();class se extends ae{constructor(...j){if(super(...j),this.constructor===se&&"function"==typeof this.postscript){if(oe.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let Y=oe.length-1;Y>=0;Y--)oe[Y].call(this)}}),le.length){let Y=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!Y){Y=!0;for(let ee=0;ee<le.length;ee++)le[ee].call(this)}}})}this.postscript(...j)}}}return se.__accessorMetadata__=(0,G.JT)(ae.prototype),se.prototype.declaredClass=te,se}}function H(te,ae){return null==ae.get?function(){const oe=this.__accessor__.properties.get(te);if(void 0===oe)return;(0,Z.it)(oe);const le=this.__accessor__.store;return le.has(te)?le.get(te):oe.metadata.value}:function(){const oe=this.__accessor__.properties.get(te);if(void 0!==oe)return oe.getComputed()}}},99433:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>R});var D=v(77712);function R(G,Z,Q){let $,W;return void 0===Z?(W=G,$=[void 0]):"string"!=typeof Z?(W=G,$=[void 0],Q=Z):(W=Z,$=Array.isArray(G)?G:[G]),(B,H)=>{const X=B.constructor.prototype;for(const te of $){const ae=(0,D.CJ)(B,te,W);ae.write&&"object"==typeof ae.write||(ae.write={}),Q&&(ae.write.target=Q),ae.write.writer=X[H]}}}},12590:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>R});var D=v(31283);function R(G,Z,Q){Z.keys().forEach(W=>{Q.set(W,Z.get(W),D.s3.DEFAULTS)}),Object.keys(G.metadatas).forEach(W=>{G.internalGet(W)&&Q.set(W,G.internalGet(W),D.s3.DEFAULTS)})}},84682:(nt,Ae,v)=>{"use strict";v.d(Ae,{Hg:()=>le,V7:()=>oe,uD:()=>ae,xb:()=>de});var D=v(14517),R=v(46160),G=v(62208),Z=v(52323);const Q=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function $(se){return se instanceof D.Z}function W(se){return se instanceof R.Z?Object.keys(se.items):$(se)?(0,Z.vw)(se).keys():se?Object.keys(se):[]}function B(se,re){return se instanceof R.Z?se.items[re]:se[re]}function X(se){return se?se.declaredClass:null}function te(se,re){const j=se.diff;if(j&&"function"==typeof j)return j(se,re);const Y=W(se),ee=W(re);if(0===Y.length&&0===ee.length)return;if(!Y.length||!ee.length||function H(se,re){return!(!Array.isArray(se)||!Array.isArray(re))&&se.length!==re.length}(se,re))return{type:"complete",oldValue:se,newValue:re};const ie=ee.filter(me=>!Y.includes(me)),J=Y.filter(me=>!ee.includes(me)),ce=Y.filter(me=>ee.includes(me)&&B(se,me)!==B(re,me)).concat(ie,J).sort(),ue=X(se);if(ue&&Q.includes(ue)&&ce.length)return{type:"complete",oldValue:se,newValue:re};let pe;const he=$(se)&&$(re);for(const me of ce){const ge=B(se,me),_e=B(re,me);let Ee;if((he||"function"!=typeof ge&&"function"!=typeof _e)&&ge!==_e&&(null!=ge||null!=_e)){if(j&&j[me]&&"function"==typeof j[me])Ee=j[me](ge,_e);else if(ge instanceof Date&&_e instanceof Date){if(ge.getTime()===_e.getTime())continue;Ee={type:"complete",oldValue:ge,newValue:_e}}else Ee="object"==typeof ge&&"object"==typeof _e&&X(ge)===X(_e)?te(ge,_e):{type:"complete",oldValue:ge,newValue:_e};(0,G.pC)(Ee)&&((0,G.pC)(pe)?pe.diff[me]=Ee:pe={type:"partial",diff:{[me]:Ee}})}}return pe}function ae(se,re){if((0,G.Wi)(se))return!1;const j=re.split(".");let Y=se;for(const ee of j){if("complete"===Y.type)return!0;if("partial"!==Y.type)return!1;{const ie=Y.diff[ee];if(!ie)return!1;Y=ie}}return!0}function oe(se,re){for(const j of re)if(ae(se,j))return!0;return!1}function le(se,re){if(!("function"==typeof se||"function"==typeof re||(0,G.Wi)(se)&&(0,G.Wi)(re)))return(0,G.Wi)(se)||(0,G.Wi)(re)||"object"==typeof se&&"object"==typeof re&&X(se)!==X(re)?{type:"complete",oldValue:se,newValue:re}:te(se,re)}function de(se){if((0,G.Wi)(se))return!0;switch(se.type){case"complete":return!1;case"collection":{const re=se;for(const j of re.added)if(!de(j))return!1;for(const j of re.removed)if(!de(j))return!1;for(const j of re.changed)if(!de(j))return!1;return!0}case"partial":for(const re in se.diff)if(!de(se.diff[re]))return!1;return!0}}},90912:(nt,Ae,v)=>{"use strict";v.d(Ae,{AY:()=>De,Iu:()=>ue,Ls:()=>ie,N7:()=>ge,TJ:()=>se,V5:()=>Ee,Zs:()=>W,di:()=>pe,gB:()=>he,i$:()=>me,q9:()=>B,rY:()=>J,sY:()=>be,se:()=>ee,vU:()=>H,z8:()=>_e}),v(8314);var R=v(63290),G=v(88159);const Z=R.Z.getLogger("esri.core.accessorSupport.ensureTypes");function Q(xe){return null==xe?xe:new Date(xe)}function $(xe){return null==xe?xe:!!xe}function W(xe){return null==xe?xe:xe.toString()}function B(xe){return null==xe?xe:(xe=parseFloat(xe),isNaN(xe)?0:xe)}function H(xe){return null==xe?xe:Math.round(parseFloat(xe))}function X(xe){return xe&&xe.constructor&&void 0!==xe.constructor.__accessorMetadata__}function te(xe,ze){return null!=ze&&xe&&!(ze instanceof xe)}function ae(xe){return xe&&"isCollection"in xe}function oe(xe){return xe&&xe.Type?"function"==typeof xe.Type?xe.Type:xe.Type.base:null}function de(xe,ze){return!!X(ze)&&(Z.error("Accessor#set","Assigning an instance of '"+(ze.declaredClass||"unknown")+"' which is not a subclass of '"+re(xe)+"'"),!0)}function se(xe,ze){return null==ze?ze:ae(xe)?function le(xe,ze){if(!ze||!ze.constructor||!ae(ze.constructor))return de(xe,ze)?ze:new xe(ze);const Ke=oe(xe.prototype.itemType),We=oe(ze.constructor.prototype.itemType);return Ke?We?Ke===We?ze:Ke.prototype.isPrototypeOf(We.prototype)?new xe(ze):(de(xe,ze),ze):new xe(ze):ze}(xe,ze):te(xe,ze)?de(xe,ze)?ze:new xe(ze):ze}function re(xe){return xe&&xe.prototype&&xe.prototype.declaredClass||"unknown"}const j=new WeakMap;function Y(xe){switch(xe){case Number:return B;case _e:return H;case Boolean:return $;case String:return W;case Date:return Q;default:return(0,G.s1)(j,xe,()=>se.bind(null,xe))}}function ee(xe,ze){const Ke=Y(xe);return 1===arguments.length?Ke:Ke(ze)}function ie(xe,ze,Ke){return 1===arguments.length?ie.bind(null,xe):ze&&(Array.isArray(ze)?ze.map(We=>xe(We,Ke)):[xe(ze,Ke)])}function J(xe,ze){return 1===arguments.length?ie(ee.bind(null,xe)):ie(ee.bind(null,xe),ze)}function ce(xe,ze,Ke){return 0!==ze&&Array.isArray(Ke)?Ke.map(We=>ce(xe,ze-1,We)):xe(Ke)}function ue(xe,ze,Ke){if(2===arguments.length)return ue.bind(null,xe,ze);if(!Ke)return Ke;let We=ze,Ce=Ke=ce(xe,ze,Ke);for(;We>0&&Array.isArray(Ce);)We--,Ce=Ce[0];if(void 0!==Ce)for(let Be=0;Be<We;Be++)Ke=[Ke];return Ke}function pe(xe,ze,Ke){return 2===arguments.length?ue(ee.bind(null,xe),ze):ue(ee.bind(null,xe),ze,Ke)}function he(xe){return!!Array.isArray(xe)&&!xe.some(ze=>{const Ke=typeof ze;return!("string"===Ke||"number"===Ke||"function"===Ke&&xe.length>1)})}function me(xe,ze){if(2===arguments.length)return me(xe).call(null,ze);const Ke=new Set,We=xe.filter(je=>"function"!=typeof je),Ce=xe.filter(je=>"function"==typeof je);for(const je of xe)"string"!=typeof je&&"number"!=typeof je||Ke.add(je);let Be=null,Fe=null;return(je,Re)=>{if(null==je)return je;const He=typeof je,Ie="string"===He||"number"===He;return Ie&&(Ke.has(je)||Ce.some(Ge=>"string"===He&&Ge===String||"number"===He&&Ge===Number))||"object"===He&&Ce.some(Ge=>!te(je,Ge))?je:(Ie&&We.length?(Be||(Be=We.map(Ge=>"string"==typeof Ge?`'${Ge}'`:`${Ge}`).join(", ")),Z.error("Accessor#set",`'${je}' is not a valid value for this property, only the following values are valid: ${Be}`)):"object"==typeof je&&Ce.length?(Fe||(Fe=Ce.map(Ge=>re(Ge)).join(", ")),Z.error("Accessor#set",`'${je}' is not a valid value for this property, value must be one of ${Fe}`)):Z.error("Accessor#set",`'${je}' is not a valid value for this property`),Re&&(Re.valid=!1),null)}}function ge(xe,ze){if(2===arguments.length)return ge(xe).call(null,ze);const Ke={},We=[],Ce=[];for(const Re in xe.typeMap){const He=xe.typeMap[Re];Ke[Re]=ee(He),We.push(re(He)),Ce.push(Re)}const Be=()=>`'${We.join("', '")}'`,Fe=()=>`'${Ce.join("', '")}'`,je="string"==typeof xe.key?Re=>Re[xe.key]:xe.key;return Re=>{if(xe.base&&!te(xe.base,Re)||null==Re)return Re;const He=je(Re)||xe.defaultKeyValue,Ie=Ke[He];if(!Ie)return Z.error("Accessor#set",`Invalid property value, value needs to be one of ${Be()}, or a plain object that can autocast (having .type = ${Fe()})`),null;if(!te(xe.typeMap[He],Re))return Re;if("string"==typeof xe.key&&!X(Re)){const Ge={};for(const Pe in Re)Pe!==xe.key&&(Ge[Pe]=Re[Pe]);return Ie(Ge)}return Ie(Re)}}class _e{}const Ee={native:xe=>({type:"native",value:xe}),array:xe=>({type:"array",value:xe}),oneOf:xe=>({type:"one-of",values:xe})};function De(xe){if(!xe||!("type"in xe))return!1;switch(xe.type){case"native":case"array":case"one-of":return!0}return!1}function be(xe){switch(xe.type){case"native":return ee(xe.value);case"array":return ie(be(xe.value));case"one-of":return function Se(xe){let ze=null;return(Ke,We)=>ve(Ke,xe)?Ke:(null==ze&&(ze=ye(xe)),Z.error("Accessor#set",`Invalid property value, value needs to be of type ${ze}`),We&&(We.valid=!1),null)}(xe);default:return null}}function ye(xe){switch(xe.type){case"native":switch(xe.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case _e:return"integer";case Date:return"date";default:return re(xe.value)}case"array":return`array of ${ye(xe.value)}`;case"one-of":{const ze=xe.values.map(Ke=>ye(Ke));return`one of ${ze.slice(0,ze.length-1)} or ${ze[ze.length-1]}`}}return"unknown"}function ve(xe,ze){if(null==xe)return!0;switch(ze.type){case"native":switch(ze.value){case Number:case _e:return"number"==typeof xe;case Boolean:return"boolean"==typeof xe;case String:return"string"==typeof xe}return xe instanceof ze.value;case"array":return!!Array.isArray(xe)&&!xe.some(Ke=>!ve(Ke,ze.value));case"one-of":return ze.values.some(Ke=>ve(xe,Ke))}}},33794:(nt,Ae,v)=>{"use strict";v.d(Ae,{hk:()=>te,HS:()=>H,Ah:()=>X,OM:()=>re});var D=v(90912),G=v(383);function Q(j){j.name&&(j.read&&"object"==typeof j.read?void 0===j.read.source&&(j.read.source=j.name):j.read={source:j.name},j.write&&"object"==typeof j.write?void 0===j.write.target&&(j.write.target=j.name):j.write={target:j.name})}function $(j){"boolean"==typeof j.read?j.read={enabled:j.read}:"function"==typeof j.read?j.read={enabled:!0,reader:j.read}:j.read&&"object"==typeof j.read&&void 0===j.read.enabled&&(j.read.enabled=!0)}function W(j){"boolean"==typeof j.write?j.write={enabled:j.write}:"function"==typeof j.write?j.write={enabled:!0,writer:j.write}:j.write&&"object"==typeof j.write&&void 0===j.write.enabled&&(j.write.enabled=!0)}var B=v(23025);function H(j,Y){return te(j,"read",Y)}function X(j,Y){return te(j,"write",Y)}function te(j,Y,ee){let ie=j&&j.json;if(j&&j.json&&j.json.origins&&ee){const J=ee.origin&&j.json.origins[ee.origin];J&&("any"===Y||Y in J)&&(ie=J)}return ie}function le(j){return j.type?de(j):se(j)}function de(j){if(!j.type)return;let Y=0,ee=j.type;for(;Array.isArray(ee)&&!(0,D.gB)(ee);)ee=ee[0],Y++;return{type:ee,ndimArray:Y}}function se(j){if(!j.types)return;let Y=0,ee=j.types;for(;Array.isArray(ee);)ee=ee[0],Y++;return{types:ee,ndimArray:Y}}function re(j){(function Z(j){if(j.json||(j.json={}),$(j.json),W(j.json),Q(j.json),j.json.origins)for(const Y in j.json.origins)$(j.json.origins[Y]),W(j.json.origins[Y]),Q(j.json.origins[Y]);return!0})(j)&&(function R(j){if(j.json&&j.json.origins){const Y=j.json.origins,ee={"web-document":["web-scene","web-map"]};for(const ie in ee)if(Y[ie]){const J=Y[ie];ee[ie].forEach(ce=>{Y[ce]=J}),delete Y[ie]}}}(j),function ae(j){const Y=function oe(j){return j.json.types?se(j.json):j.type?de(j):se(j)}(j);if(j.json.origins)for(const ee in j.json.origins){const ie=j.json.origins[ee],J=ie.types?le(ie):Y;(0,G.U)(J,ie,!1),ie.types&&!ie.write&&j.json.write&&j.json.write.enabled&&(ie.write={...j.json.write}),(0,B.U)(J,ie)}(0,G.U)(Y,j.json,!0),(0,B.U)(Y,j.json)}(j))}},383:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>W,d:()=>B});var D=v(63290),R=v(94113),G=v(14889),Z=v(34117),Q=v(94056);const $=D.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function W(ee,ie,J){ee&&(!J&&!ie.read||ie.read?.reader||!1===ie.read?.enabled||function de(ee){return"types"in ee?re(ee.types):se(ee.type)}(ee)&&(0,R.RB)("read.reader",B(ee),ie))}function B(ee){const ie=ee.ndimArray??0;if(ie>1)return function ae(ee){const ie=H(ee),J=te.bind(null,ie),ce=ee.ndimArray??0;return(ue,pe,he)=>{if(null==ue)return ue;ue=J(ue,he,ce);let me=ce,ge=ue;for(;me>0&&Array.isArray(ge);)me--,ge=ge[0];if(void 0!==ge)for(let _e=0;_e<me;_e++)ue=[ue];return ue}}(ee);if(1===ie)return oe(ee);if("type"in ee&&le(ee.type)){const J=ee.type.prototype?.itemType?.Type,ce=oe("function"==typeof J?{type:J}:{types:J});return(ue,pe,he)=>{const me=ce(ue,pe,he);return me&&new ee.type(me)}}return H(ee)}function H(ee){return"type"in ee?function X(ee){return ee.prototype.read?(ie,J,ce)=>{if(null==ie)return ie;const ue=typeof ie;if("object"!==ue)return void $.error(`Expected JSON value of type 'object' to deserialize type '${ee.prototype.declaredClass}', but got '${ue}'`);const pe=new ee;return pe.read(ie,ce),pe}:ee.fromJSON}(ee.type):function j(ee){let ie=null;const J=ee.errorContext??"type";return(ce,ue,pe)=>{if(null==ce)return ce;const he=typeof ce;if("object"!==he)return void $.error(`Expected JSON value of type 'object' to deserialize, but got '${he}'`);ie||(ie=function Y(ee){const ie={};for(const J in ee.typeMap){const ce=ee.typeMap[J],ue=(0,Z.JT)(ce.prototype);if("function"==typeof ee.key)continue;const pe=ue.properties[ee.key];if(!pe)continue;pe.json?.type&&Array.isArray(pe.json.type)&&1===pe.json.type.length&&"string"==typeof pe.json.type[0]&&(ie[pe.json.type[0]]=ce);const he=pe.json?.write;if(!he||!he.writer){ie[J]=ce;continue}const me=he.target,ge="string"==typeof me?me:ee.key,_e={};he.writer(J,_e,ge),_e[ge]&&(ie[_e[ge]]=ce)}return ie}(ee));const me=ee.key;if("string"!=typeof me)return;const ge=ce[me],_e=ge?ie[ge]:ee.defaultKeyValue?ee.typeMap[ee.defaultKeyValue]:void 0;if(!_e){const De=`Type '${ge||"unknown"}' is not supported`;return pe&&pe.messages&&ce&&pe.messages.push(new G.Z(`${J}:unsupported`,De,{definition:ce,context:pe})),void $.error(De)}const Ee=new _e;return Ee.read(ce,pe),Ee}}(ee.types)}function te(ee,ie,J,ce){return 0!==ce&&Array.isArray(ie)?ie.map(ue=>te(ee,ue,J,ce-1)):ee(ie,void 0,J)}function oe(ee){const ie=H(ee);return(J,ce,ue)=>{if(null==J)return J;if(Array.isArray(J)){const he=[];for(const me of J){const ge=ie(me,void 0,ue);void 0!==ge&&he.push(ge)}return he}const pe=ie(J,void 0,ue);return void 0!==pe?[pe]:void 0}}function le(ee){if(!(0,Q.u)(ee))return!1;const ie=ee.prototype.itemType;return!(!ie||!ie.Type)&&("function"==typeof ie.Type?se(ie.Type):re(ie.Type))}function se(ee){return!Array.isArray(ee)&&!!ee&&ee.prototype&&("read"in ee.prototype||"fromJSON"in ee||le(ee))}function re(ee){for(const ie in ee.typeMap)if(!se(ee.typeMap[ie]))return!1;return!0}},94056:(nt,Ae,v)=>{"use strict";function D(R){return!!R&&R.prototype&&R.prototype.declaredClass&&0===R.prototype.declaredClass.indexOf("esri.core.Collection")}v.d(Ae,{u:()=>D})},23025:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>Q,k:()=>te});var D=v(26584),R=v(63290),G=v(94113),Z=v(94056);function Q(de,se){if(!se.write||se.write.writer||!1===se.write.enabled&&!se.write.overridePolicy)return;const re=de?.ndimArray??0;se.write.writer=de&&(1===re||"type"in de&&(0,Z.u)(de.type))?ae:re>1?function le(de){return(se,re,j,Y)=>{let ee;if(null===se)ee=null;else{ee=oe(se,Y,de);let ie=de,J=ee;for(;ie>0&&Array.isArray(J);)ie--,J=J[0];if(void 0!==J)for(let ce=0;ce<ie;ce++)ee=[ee]}(0,G.RB)(j,ee,re)}}(re):se.types?Array.isArray(se.types)?function B(de){return(se,re,j,Y)=>se&&Array.isArray(se)?H(se.filter(ee=>W(ee,de,Y)),re,j,Y):H(se,re,j,Y)}(se.types[0]):function $(de){return(se,re,j,Y)=>se?W(se,de,Y)?H(se,re,j,Y):void 0:H(se,re,j,Y)}(se.types):H}function W(de,se,re){for(const j in se.typeMap)if(de instanceof se.typeMap[j])return!0;if(re?.messages){const j=se.errorContext??"type",Y=`Values of type '${("function"!=typeof se.key?de[se.key]:de.declaredClass)??"Unknown"}' cannot be written`;re&&re.messages&&de&&re.messages.push(new D.Z(`${j}:unsupported`,Y,{definition:de,context:re})),R.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(Y)}return!1}function H(de,se,re,j){(0,G.RB)(re,X(de,j),se)}function X(de,se){return de&&"function"==typeof de.write?de.write({},se):de&&"function"==typeof de.toJSON?de.toJSON():"number"==typeof de?te(de):de}function te(de){return de===-1/0?-Number.MAX_VALUE:de===1/0?Number.MAX_VALUE:isNaN(de)?null:de}function ae(de,se,re,j){let Y;null===de?Y=null:de&&"function"==typeof de.map?(Y=de.map(ee=>X(ee,j)),"function"==typeof Y.toArray&&(Y=Y.toArray())):Y=[X(de,j)],(0,G.RB)(re,Y,se)}function oe(de,se,re){return 0!==re&&Array.isArray(de)?de.map(j=>oe(j,se,re-1)):X(de,se)}},34595:(nt,Ae,v)=>{"use strict";v.d(Ae,{$z:()=>Z,Gg:()=>$,U2:()=>Q});var D=v(52323);function R(W,B){const H="?"===W[W.length-1]?W.slice(0,-1):W;if(null!=B.getItemAt||Array.isArray(B)){const te=parseInt(H,10);if(!isNaN(te))return Array.isArray(B)?B[te]:B.getItemAt(te)}const X=(0,D.vw)(B);return(0,D.b6)(X,H)?X.get(H):B[H]}function G(W,B,H){if(null==W)return W;const X=R(B[H],W);return!X&&H<B.length-1?void 0:H===B.length-1?X:G(X,B,H+1)}function Z(W,B,H=0){return"string"!=typeof B||B.includes(".")?G(W,(0,D.NI)(B),H):R(B,W)}function Q(W,B){return Z(W,B)}function $(W,B){return void 0!==Z(B,W)}},44648:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{F:()=>D}),(R=D||(D={}))[R.INITIALIZING=0]="INITIALIZING",R[R.CONSTRUCTING=1]="CONSTRUCTING",R[R.CONSTRUCTED=2]="CONSTRUCTED"},34117:(nt,Ae,v)=>{"use strict";v.d(Ae,{JT:()=>Q,VZ:()=>W,tz:()=>X});var D=v(58817),R=v(62208),G=v(52323);class Z{constructor(se){this.autoDestroy=!1,this.properties=se}}function Q(de){let se=de.constructor.__accessorMetadata__;const re=Object.prototype.hasOwnProperty.call(de.constructor,"__accessorMetadata__");if(se){if(!re){const j=Object.create(se.properties),Y=se.autoDestroy;for(const ee in j)j[ee]=(0,D.d9)(j[ee]);se=new Z(j),se.autoDestroy=Y,Object.defineProperty(de.constructor,"__accessorMetadata__",{value:se,enumerable:!1,configurable:!0,writable:!0})}}else se=new Z({}),Object.defineProperty(de.constructor,"__accessorMetadata__",{value:se,enumerable:!1,configurable:!0,writable:!0});return(0,R.j0)(de.constructor.__accessorMetadata__)}function W(de,se){const re=function $(de){return Q(de).properties}(de);let j=re[se];return j||(j=re[se]={}),j}function X(de,se){return(0,G.TS)(de,se,ae)}const te=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function ae(de){return te.test(de)?"replace":"merge"}},29338:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>X,i:()=>H});var D=v(34595),R=v(52323),G=v(33794);function Z(te,ae,oe){if(!te||!te.read||!1===te.read.enabled||!te.read.source)return!1;const le=te.read.source;if("string"==typeof le){if(le===ae||le.includes(".")&&0===le.indexOf(ae)&&(0,D.Gg)(le,oe))return!0}else for(const de of le)if(de===ae||de.includes(".")&&0===de.indexOf(ae)&&(0,D.Gg)(de,oe))return!0;return!1}function $(te,ae,oe,le,de){let se=(0,G.HS)(ae[oe],de);(function Q(te){return te&&(!te.read||!1!==te.read.enabled&&!te.read.source)})(se)&&(te[oe]=!0);for(const re of Object.getOwnPropertyNames(ae))se=(0,G.HS)(ae[re],de),Z(se,oe,le)&&(te[re]=!0)}function W(te,ae,oe,le){const se=(0,G.hk)(oe.metadatas[ae],"any",le),re=se&&se.default;if(void 0===re)return;const j="function"==typeof re?re.call(te,ae,le):re;void 0!==j&&oe.set(ae,j)}const B={origin:"service"};function H(te,ae,oe=B){if(!ae||"object"!=typeof ae)return;const le=(0,R.vw)(te),de=le.metadatas,se={};for(const re of Object.getOwnPropertyNames(ae))$(se,de,re,ae,oe);le.setDefaultOrigin(oe.origin);for(const re of Object.getOwnPropertyNames(se)){const j=(0,G.HS)(de[re],oe).read,Y=j&&j.source;let ee;ee=Y&&"string"==typeof Y?(0,D.$z)(ae,Y):ae[re],j&&j.reader&&(ee=j.reader.call(te,ee,ae,oe)),void 0!==ee&&le.set(re,ee)}if(!oe||!oe.ignoreDefaults){le.setDefaultOrigin("defaults");for(const re of Object.getOwnPropertyNames(de))se[re]||W(te,re,le,oe)}le.setDefaultOrigin("user")}function X(te,ae,oe,le=B){const de={...le,messages:[]};oe(de),de.messages?.forEach(se=>{"warning"!==se.type||te.loaded?le&&le.messages&&le.messages.push(se):te.loadWarnings.push(se)})}},82255:(nt,Ae,v)=>{"use strict";v.d(Ae,{t:()=>Q});var D=v(26584),R=v(8314),Z=(v(63290),v(34595));function Q(H,X,te){if(H&&X)if("object"==typeof X)for(const ae of Object.getOwnPropertyNames(X))Q(H,ae,X[ae]);else{if(X.includes(".")){const oe=X.split("."),le=oe.splice(oe.length-1,1)[0];return void Q((0,Z.U2)(H,oe),le,te)}const ae=H.__accessor__;null!=ae&&function $(H,X){if((0,R.Z)("esri-unknown-property-errors")&&!function W(H,X){return null!=X.metadatas[H]}(H,X))throw new D.Z("set:unknown-property",function B(H,X){return"setting unknown property '"+H+"' on instance of "+X.host.declaredClass}(H,X))}(X,ae),H[X]=te}}},36082:(nt,Ae,v)=>{"use strict";v.d(Ae,{GF:()=>j,LJ:()=>te,gb:()=>ae,it:()=>B,mS:()=>se}),v(8314);var R=v(63290),G=v(52323),Z=v(2345);const Q={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},$=[];let W=Q;function B(ee){W.onObservableAccessed(ee)}let H=!1,X=!1;function te(ee,ie,J){if(H)return oe(ee,ie,J);le(ee);const ce=ie.call(J);return de(),ce}function ae(ee,ie){return te(Q,ee,ie)}function oe(ee,ie,J){const ce=H;H=!0,le(ee);let ue=null;try{ue=ie.call(J)}catch(pe){X&&R.Z.getLogger("esri.core.accessorSupport.tracking").error(pe)}return de(),H=ce,ue}function le(ee){W=ee,$.push(ee)}function de(){const ee=$.length;if(ee>1){const ie=$.pop();W=$[ee-2],ie.onTrackingEnd()}else if(1===ee){const ie=$.pop();W=Q,ie.onTrackingEnd()}else W=Q}function se(ee,ie){if(ie.flags&Z.v.DepTrackingInitialized)return;const J=X;X=!1,ie.flags&Z.v.AutoTracked?oe(ie,ie.metadata.get,ee):j(ee,ie),X=J}const re=[];function j(ee,ie){ie.flags&Z.v.ExplicitlyTracking||(ie.flags|=Z.v.ExplicitlyTracking,oe(ie,()=>{const J=ie.metadata.dependsOn||re;for(const ce of J)if("string"!=typeof ce||ce.includes(".")){const ue=(0,G.NI)(ce);for(let pe=0,he=ee;pe<ue.length&&null!=he&&"object"==typeof he;++pe)he=Y(he,ue[pe],pe!==ue.length-1)}else Y(ee,ce,!1)}),ie.flags&=~Z.v.ExplicitlyTracking)}function Y(ee,ie,J){const ce="?"===ie[ie.length-1]?ie.slice(0,-1):ie;if(null!=ee.getItemAt||Array.isArray(ee)){const pe=parseInt(ce,10);if(!isNaN(pe))return Array.isArray(ee)?ee[pe]:ee.getItemAt(pe)}const ue=(0,G.vw)(ee)?.properties.get(ce);return ue&&(B(ue),se(ee,ue)),J?ee[ce]:void 0}},2345:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{v:()=>D}),(R=D||(D={}))[R.Dirty=1]="Dirty",R[R.Overriden=2]="Overriden",R[R.Computing=4]="Computing",R[R.NonNullable=8]="NonNullable",R[R.HasDefaultValue=16]="HasDefaultValue",R[R.DepTrackingInitialized=32]="DepTrackingInitialized",R[R.AutoTracked=64]="AutoTracked",R[R.ExplicitlyTracking=128]="ExplicitlyTracking"},84395:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>G});var D=v(36082),R=v(48902);class G{constructor(Q){this._observable=new R.s,this._value=Q}get(){return(0,D.it)(this._observable),this._value}set(Q){Q!==this._value&&(this._value=Q,this._observable.notify())}}},12196:(nt,Ae,v)=>{"use strict";v.d(Ae,{X:()=>R});var D=v(85931);class R{constructor(Z,Q){this._observers=Z,this._observer=Q}remove(){(0,D.Od)(this._observers,this._observer)}}},48902:(nt,Ae,v)=>{"use strict";v.d(Ae,{s:()=>R});var D=v(12196);class R{constructor(){this._observers=[]}observe(Z){return this._observers.includes(Z)||this._observers.push(Z),new D.X(this._observers,Z)}notify(){const Z=this._observers.slice();for(let Q=0;Q<Z.length;++Q){const $=Z[Q];$.onInvalidated(),$.onCommitted()}}}},819:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>D});class D{constructor(G){this._notify=G,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const G=this._invalidCount;if(1===G)return this._invalidCount=0,void this._notify();this._invalidCount=G>0?G-1:0}onObservableAccessed(G){this._accessed.includes(G)||this._accessed.push(G)}onTrackingEnd(){const G=this._handles,Z=this._accessed;for(let Q=0;Q<Z.length;++Q)G.push(Z[Q].observe(this));Z.length=0}clear(){const G=this._handles;for(let Z=0;Z<G.length;++Z)G[Z].remove();G.length=0}}},21352:(nt,Ae,v)=>{"use strict";v.d(Ae,{EH:()=>W,U5:()=>Q,Xz:()=>$});var D=v(36082),R=v(819);let G=!1;const Z=[];function Q(X,te){let ae=new R.M(function de(){if(!ae||le)return;if(G)return void B(de);const re=oe;ae.clear(),G=!0,le=!0,oe=(0,D.LJ)(ae,X),le=!1,G=!1,te(oe,re),H()}),oe=null,le=!1;return le=!0,oe=(0,D.LJ)(ae,X),le=!1,{remove:function se(){ae&&(ae.destroy(),ae=null,oe=null)}}}function $(X,te){let ae=new R.M(function le(){te(oe,se)}),oe=null;function se(){return ae?(ae.clear(),oe=(0,D.LJ)(ae,X),oe):null}return se(),{remove:function de(){ae&&(ae.destroy(),ae=null),oe=null}}}function W(X){let te=new R.M(function oe(){te&&!ae&&(G?B(oe):(te.clear(),G=!0,ae=!0,(0,D.LJ)(te,X),ae=!1,G=!1,H()))}),ae=!1;return ae=!0,(0,D.LJ)(te,X),ae=!1,{remove:function le(){te&&(te.destroy(),te=null)}}}function B(X){Z.includes(X)||Z.unshift(X)}function H(){for(;Z.length;)Z.pop()()}},52323:(nt,Ae,v)=>{"use strict";v.d(Ae,{IH:()=>de,NI:()=>X,Qc:()=>le,TS:()=>W,b6:()=>Q,vw:()=>Z});var D=v(54024),R=v(58817),G=v(62208);function Z(se){return se?se.__accessor__?se.__accessor__:se.propertyInvalidated?se:null:null}function Q(se,re){return null!=se&&se.metadatas&&null!=se.metadatas[re]}function W(se,re,j){return B(se,re,j?{policy:j,path:""}:null)}function B(se,re,j){return re?Object.keys(re).reduce((Y,ee)=>{let ie=null,J="merge";if(j&&(ie=j.path?`${j.path}.${ee}`:ee,J=j.policy(ie)),"replace"===J)return Y[ee]=re[ee],Y;if(void 0===Y[ee])return Y[ee]=(0,R.d9)(re[ee]),Y;let ce=Y[ee],ue=re[ee];if(ce===ue)return Y;if(Array.isArray(ue)||Array.isArray(Y))ce=Y[ee]=ce?Array.isArray(ce)?ce.concat():[ce]:[],ue&&(Array.isArray(ue)||(ue=[ue]),ue.forEach(pe=>{ce.includes(pe)||ce.push(pe)}));else if(ue&&"object"==typeof ue)if(j){const pe=j.path;j.path=(0,G.j0)(ie),Y[ee]=B(ce,ue,j),j.path=pe}else Y[ee]=B(ce,ue,null);else Y.hasOwnProperty(ee)&&!re.hasOwnProperty(ee)||(Y[ee]=ue);return Y},se||{}):se}function X(se){return Array.isArray(se)?se:se.split(".")}function te(se){return se.includes(",")?se.split(",").map(re=>re.trim()):[se.trim()]}function le(se,re,j,Y){const ee=function ae(se){if(Array.isArray(se)){const re=[];for(const j of se)re.push(...te(j));return re}return te(se)}(re);if(1!==ee.length){const ie=ee.map(J=>Y(se,J,j));return(0,D.AL)(ie)}return Y(se,ee[0],j)}function de(se){let re=!1;return()=>{re||(re=!0,se())}}},30755:(nt,Ae,v)=>{"use strict";v.d(Ae,{BT:()=>re,Fs:()=>ie,NC:()=>ge,YP:()=>ue,aQ:()=>me});var X,_e,D=v(35575),R=v(58817),G=v(94530),Z=v(50618),Q=v(28862),$=v(86236),W=v(34595),B=v(21352),H=v(52323);(_e=X||(X={}))[_e.Untracked=0]="Untracked",_e[_e.Tracked=1]="Tracked";class te{constructor(){this.uid=(0,$.D)(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(Ee,De,be,Se,ye){return this.pool.acquire(X.Untracked,Ee,De,be,Se,ye,R.fS)}static acquireTracked(Ee,De,be,Se){return this.pool.acquire(X.Tracked,Ee,De,be,null,null,Se)}notify(Ee,De){this.type===X.Untracked?this.callback.call(this.target,Ee,De,this.path,this.target):this.callback.call(null,Ee,De)}acquire(Ee,De,be,Se,ye,ve,xe){this.uid=(0,$.D)(),this.removed=!1,this.type=Ee,this.oldValue=De,this.callback=be,this.getValue=Se,this.target=ye,this.path=ve,this.equals=xe}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=(0,$.D)(),this.removed=!0}}te.pool=new G.e(te);const ae=new D.Z,oe=new Set;let le;function de(_e){oe.delete(_e),oe.add(_e),le||(le=(0,Z.Os)(j))}function se(_e){if(_e.removed)return;const Ee=_e.oldValue,De=_e.getValue();_e.equals(Ee,De)||(_e.oldValue=De,_e.notify(De,Ee))}function re(_e){for(const Ee of oe.values())Ee.target===_e&&(Ee.removed=!0)}function j(){let _e=10;for(;le&&_e--;){le=null;const Ee=Y(),De=ae.acquire();for(const be of Ee){const Se=be.uid;se(be),Se===be.uid&&be.removed&&De.push(be)}for(const be of oe)be.removed&&(De.push(be),oe.delete(be));for(const be of De)te.pool.release(be);ae.release(De),ae.release(Ee),ee.forEach(be=>be())}}function Y(){const _e=ae.acquire();_e.length=oe.size;let Ee=0;for(const De of oe)_e[Ee]=De,++Ee;return oe.clear(),_e}const ee=new Set;function ie(_e){return ee.add(_e),{remove(){ee.delete(_e)}}}function ue(_e,Ee,De,be=!1){return!_e.__accessor__||_e.__accessor__.destroyed?{remove(){}}:be?function ce(_e,Ee,De){const be=(0,H.Qc)(_e,Ee,De,(Se,ye,ve)=>{let xe=!1;return(0,B.U5)(()=>(0,W.$z)(Se,ye),(ze,Ke)=>{Se.__accessor__.destroyed?be.remove():xe||(xe=!0,(0,R.fS)(Ke,ze)||ve.call(Se,ze,Ke,ye,Se),xe=!1)})});return be}(_e,Ee,De):function J(_e,Ee,De){let be=(0,H.Qc)(_e,Ee,De,(Se,ye,ve)=>{let xe,ze,Ke=(0,B.Xz)(()=>(0,W.$z)(Se,ye),(We,Ce)=>{Se.__accessor__.destroyed||xe&&xe.uid!==ze?be.remove():(xe||(xe=te.acquireUntracked(We,ve,Ce,Se,ye),ze=xe.uid),de(xe))});return{remove:(0,H.IH)(()=>{Ke.remove(),xe&&(xe.uid!==ze||xe.removed||(xe.removed=!0,de(xe)),xe=null),be=Ke=null})}});return be}(_e,Ee,De)}function me(_e,Ee,De=!1,be=R.y7){return De?function he(_e,Ee,De){let be=!1;return(0,B.U5)(_e,(Se,ye)=>{be||(be=!0,De(ye,Se)||Ee(Se,ye),be=!1)})}(_e,Ee,be):function pe(_e,Ee,De){let be,Se,ye=(0,B.Xz)(_e,(ve,xe)=>{be&&be.uid!==Se?ye.remove():(be||(be=te.acquireTracked(ve,Ee,xe,De),Se=be.uid),de(be))});return{remove:(0,H.IH)(()=>{ye.remove(),be&&(be.uid!==Se||be.removed||(be.removed=!0,de(be)),be=null),ye=null})}}(_e,Ee,be)}function ge(_e){return(0,Q.f)(oe,Ee=>Ee.oldValue===_e)}},36054:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>te,d:()=>X});var D=v(85931),R=v(26584),G=v(63290),Z=v(31283),Q=v(52323),$=v(33794);function W(ae,oe,le,de,se){const re={};return oe.write?.writer?.call(ae,de,re,le,se),re}function B(ae,oe,le,de,se,re){if(!de||!de.write)return!1;const j=ae.get(le);if(!se&&de.write.overridePolicy){const Y=de.write.overridePolicy.call(ae,j,le,re);void 0!==Y&&(se=Y)}if(se||(se=de.write),!se||!1===se.enabled)return!1;if((null===j&&!se.allowNull&&!se.writerEnsuresNonNull||void 0===j)&&se.isRequired){const Y=new R.Z("web-document-write:property-required",`Missing value for required property '${le}' on '${ae.declaredClass}'`,{propertyName:le,target:ae});return Y&&re&&re.messages?re.messages.push(Y):Y&&!re&&G.Z.getLogger("esri.core.accessorSupport.write").error(Y.name,Y.message),!1}return!(void 0===j||null===j&&!se.allowNull&&!se.writerEnsuresNonNull||(!oe.store.multipleOriginsSupported||oe.store.originOf(le)===Z.s3.DEFAULTS)&&function H(ae,oe,le,de,se){const re=de.default;if(void 0===re)return!1;if(null!=de.defaultEquals)return de.defaultEquals(se);if("function"==typeof re){if(Array.isArray(se)){const j=re.call(ae,oe,le);return(0,D.fS)(j,se)}return!1}return re===se}(ae,le,re,de,j)||!se.ignoreOrigin&&re&&re.origin&&oe.store.multipleOriginsSupported&&oe.store.originOf(le)<(0,Z.M9)(re.origin))}function X(ae,oe,le,de){const se=(0,Q.vw)(ae),j=(0,$.Ah)(se.metadatas[oe],de);return!!j&&B(ae,se,oe,j,le,de)}function te(ae,oe,le){if(ae&&"function"==typeof ae.toJSON&&(!ae.toJSON.isDefaultToJSON||!ae.write))return(0,Q.TS)(oe,ae.toJSON(le));const de=(0,Q.vw)(ae),se=de.metadatas;for(const re in se){const j=(0,$.Ah)(se[re],le);if(!B(ae,de,re,j,void 0,le))continue;const Y=ae.get(re),ee=W(ae,j,j.write&&"string"==typeof j.write.target?j.write.target:re,Y,le);Object.keys(ee).length>0&&(oe=(0,Q.TS)(oe,ee),le?.resources?.pendingOperations?.length&&Promise.all(le.resources.pendingOperations).then(()=>(0,Q.TS)(oe,ee)),le&&le.writtenProperties&&le.writtenProperties.push({target:ae,propName:re,oldOrigin:(0,Z.Wm)(de.store.originOf(re)),newOrigin:le.origin}))}return oe}},85931:(nt,Ae,v)=>{"use strict";v.d(Ae,{$A:()=>j,FY:()=>pe,Ms:()=>De,Od:()=>Ee,SO:()=>ee,TV:()=>ge,Tw:()=>B,Vx:()=>X,a9:()=>se,cq:()=>J,e$:()=>ce,e5:()=>te,fS:()=>H,vr:()=>le,w6:()=>re,zG:()=>oe});var D=v(62208),R=v(4619);function B(be,Se){return be.filter(Se?(ye,ve,xe)=>xe.findIndex(Se.bind(null,ye))===ve:(ye,ve,xe)=>xe.indexOf(ye)===ve)}function H(be,Se,ye){if((0,D.Wi)(be)&&(0,D.Wi)(Se))return!0;if((0,D.Wi)(be)||(0,D.Wi)(Se)||be.length!==Se.length)return!1;if(ye){for(let ve=0;ve<be.length;ve++)if(!ye(be[ve],Se[ve]))return!1}else for(let ve=0;ve<be.length;ve++)if(be[ve]!==Se[ve])return!1;return!0}function X(be,Se){let ye=be.length!==Se.length;ye&&(be.length=Se.length);for(let ve=0;ve<Se.length;++ve)be[ve]!==Se[ve]&&(be[ve]=Se[ve],ye=!0);return ye}function te(be,Se,ye){let ve,xe;return ye?(ve=Se.filter(ze=>!be.some(Ke=>ye(Ke,ze))),xe=be.filter(ze=>!Se.some(Ke=>ye(Ke,ze)))):(ve=Se.filter(ze=>!be.includes(ze)),xe=be.filter(ze=>!Se.includes(ze))),{added:ve,removed:xe}}function oe(be){return be&&"number"==typeof be.length}function le(be,Se){const ye=be.length;if(0===ye)return[];const ve=[];for(let xe=0;xe<ye;xe+=Se)ve.push(be.slice(xe,xe+Se));return ve}const de=!!Array.prototype.fill;function se(be,Se){if(de)return new Array(be).fill(Se);const ye=new Array(be);for(let ve=0;ve<be;ve++)ye[ve]=Se;return ye}function re(be,Se){void 0===Se&&(Se=be,be=0);const ye=new Array(Se-be);for(let ve=be;ve<Se;ve++)ye[ve-be]=ve;return ye}function j(be,Se,ye){const ve=be.length;let xe=0,ze=ve-1;for(;xe<ze;){const We=xe+Math.floor((ze-xe)/2);Se>be[We]?xe=We+1:ze=We}const Ke=be[xe];return ye?Se>=be[ve-1]?-1:Ke===Se?xe:xe-1:Ke===Se?xe:-1}class ee{constructor(){this.last=0}}const ie=new ee;function J(be,Se,ye,ve){ve=ve||ie;const xe=Math.max(0,ve.last-10);for(let Ke=xe;Ke<ye;++Ke)if(be[Ke]===Se)return ve.last=Ke,Ke;const ze=Math.min(xe,ye);for(let Ke=0;Ke<ze;++Ke)if(be[Ke]===Se)return ve.last=Ke,Ke;return-1}function ce(be,Se,ye,ve){const xe=ye??be.length,ze=J(be,Se,xe,ve);if(-1!==ze)return be[ze]=be[xe-1],null==ye&&be.pop(),Se}const ue=new Set;function pe(be,Se,ye=be.length,ve=Se.length,xe,ze){if(0===ve||0===ye)return ye;ue.clear();for(let We=0;We<ve;++We)ue.add(Se[We]);xe=xe||ie;const Ke=Math.max(0,xe.last-10);for(let We=Ke;We<ye;++We)if(ue.has(be[We])&&(ze&&ze.push(be[We]),ue.delete(be[We]),be[We]=be[ye-1],--ye,--We,0===ue.size||0===ye))return ue.clear(),ye;for(let We=0;We<Ke;++We)if(ue.has(be[We])&&(ze&&ze.push(be[We]),ue.delete(be[We]),be[We]=be[ye-1],--ye,--We,0===ue.size||0===ye))return ue.clear(),ye;return ue.clear(),ye}function ge(be,Se){const ye=function me(be){return be?(_e.seed=be,()=>_e.getFloat()):Math.random}(Se);for(let ve=be.length-1;ve>0;ve--){const xe=Math.floor(ye()*(ve+1)),ze=be[ve];be[ve]=be[xe],be[xe]=ze}return be}const _e=new R.Z;function Ee(be,Se){const ye=be.indexOf(Se);return-1!==ye?(be.splice(ye,1),Se):null}function De(be,Se){const ye=new Map,ve=be.length;for(let xe=0;xe<ve;xe++){const ze=be[xe],Ke=Se(ze,xe,be),We=ye.get(Ke);We?We.push(ze):ye.set(Ke,[ze])}return ye}},59213:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ed:()=>X,UI:()=>te,mt:()=>Y,q6:()=>re,vr:()=>J,w6:()=>ie});var D=v(15861),R=v(17626),G=v(14517),Z=v(62208),Q=v(10699),$=v(77712),H=(v(85931),v(90912),v(76898));function X(ue,pe,he){return(0,Q.as)(ue.map((me,ge)=>pe.apply(he,[me,ge])))}function te(ue,pe,he){return ae.apply(this,arguments)}function ae(){return(ae=(0,D.Z)(function*(ue,pe,he){return(yield(0,Q.as)(ue.map((me,ge)=>pe.apply(he,[me,ge])))).map(me=>me.value)})).apply(this,arguments)}function oe(ue){return{ok:!0,value:ue}}function le(ue){return{ok:!1,error:ue}}function re(ue){return j.apply(this,arguments)}function j(){return(j=(0,D.Z)(function*(ue){if((0,Z.Wi)(ue))return{ok:!1,error:new Error("no promise provided")};try{return oe(yield ue)}catch(pe){return le(pe)}})).apply(this,arguments)}function Y(ue){return ee.apply(this,arguments)}function ee(){return(ee=(0,D.Z)(function*(ue){try{return oe(yield ue)}catch(pe){return(0,Q.r9)(pe),le(pe)}})).apply(this,arguments)}function ie(ue){if(!0===ue.ok)return ue.value;throw ue.error}function J(ue,pe){return new ce(ue,pe)}let ce=class extends G.Z{constructor(ue,pe){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=(0,Z.IM)(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:he}=this._abortController;this.promise=ue(he),this.promise.then(me=>{this._result=oe(me),this._cleanup()},me=>{this._result=le(me),this._cleanup()}),this._abortHandle=(0,Q.fu)(pe,this.abort)}get value(){return function de(ue){return(0,Z.pC)(ue)&&!0===ue.ok?ue.value:null}(this._result)}get error(){return function se(ue){return(0,Z.pC)(ue)&&!1===ue.ok?ue.error:null}(this._result)}get finished(){return(0,Z.pC)(this._result)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=(0,Z.hw)(this._abortHandle),this._abortController=null}};(0,R._)([(0,$.Cb)()],ce.prototype,"value",null),(0,R._)([(0,$.Cb)()],ce.prototype,"error",null),(0,R._)([(0,$.Cb)()],ce.prototype,"finished",null),(0,R._)([(0,$.Cb)()],ce.prototype,"promise",void 0),(0,R._)([(0,$.Cb)()],ce.prototype,"_result",void 0),ce=(0,R._)([(0,H.j)("esri.core.asyncUtils.ReactiveTask")],ce)},27306:(nt,Ae,v)=>{"use strict";function D(te){return 32+te.length}function R(te){return 16}function G(te){if(!te)return 0;let ae=B;for(const oe in te)if(te.hasOwnProperty(oe)){const le=te[oe];switch(typeof le){case"string":ae+=D(le);break;case"number":ae+=16;break;case"boolean":ae+=4}}return ae}function Z(te){if(!te)return 0;if(Array.isArray(te))return function Q(te){const ae=te.length;if(0===ae||"number"==typeof te[0])return 32+8*ae;let oe=H;for(let le=0;le<ae;le++)oe+=$(te[le]);return oe}(te);let ae=B;for(const oe in te)te.hasOwnProperty(oe)&&(ae+=$(te[oe]));return ae}function $(te){switch(typeof te){case"object":return Z(te);case"string":return D(te);case"number":return 16;case"boolean":return 4;default:return 8}}function W(te,ae){return H+te.length*ae}v.d(Ae,{G3:()=>R,Ul:()=>Z,Y8:()=>X,do:()=>W,f2:()=>G,hH:()=>D});const B=32,H=32;var X,te;(te=X||(X={}))[te.KILOBYTES=1024]="KILOBYTES",te[te.MEGABYTES=1048576]="MEGABYTES",te[te.GIGABYTES=1073741824]="GIGABYTES"},84244:(nt,Ae,v)=>{"use strict";v.d(Ae,{m:()=>R});const R=function D(G){return{setTimeout:(Z,Q)=>{const $=G.setTimeout(Z,Q);return{remove:()=>G.clearTimeout($)}}}}(globalThis)},89726:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>G,Z:()=>R});var D=v(46160);function R(Q,$,W=D.Z){return $||($=new W),$===Q||($.removeAll(),function Z(Q){return Q&&(Array.isArray(Q)||"items"in Q&&Array.isArray(Q.items))}(Q)?$.addMany(Q):Q&&$.add(Q)),$}function G(Q){return Q}},78260:(nt,Ae,v)=>{"use strict";function R(me){return"h"in me&&"s"in me&&"v"in me}function G(me){return"l"in me&&"a"in me&&"b"in me}function Z(me){return"l"in me&&"c"in me&&"h"in me}v.d(Ae,{Y3:()=>ce,_Y:()=>J,sJ:()=>ue,xr:()=>ie});const $=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],W=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function B(me,ge){const _e=[];let Ee,De;if(me[0].length!==ge.length)throw"dimensions do not match";const be=me.length,Se=me[0].length;let ye=0;for(Ee=0;Ee<be;Ee++){for(ye=0,De=0;De<Se;De++)ye+=me[Ee][De]*ge[De];_e.push(ye)}return _e}function H(me){const ge=[me.r/255,me.g/255,me.b/255].map(Ee=>Ee<=.04045?Ee/12.92:((Ee+.055)/1.055)**2.4),_e=B($,ge);return{x:100*_e[0],y:100*_e[1],z:100*_e[2]}}function X(me){const ge=B(W,[me.x/100,me.y/100,me.z/100]).map(_e=>Math.min(1,Math.max(_e<=.0031308?12.92*_e:1.055*_e**.4166666666666667-.055,0)));return{r:Math.round(255*ge[0]),g:Math.round(255*ge[1]),b:Math.round(255*ge[2])}}function te(me){const ge=[me.x/95.047,me.y/100,me.z/108.883].map(_e=>_e>.008856451679035631?_e**.3333333333333333:7.787037037037035*_e+.13793103448275862);return{l:116*ge[1]-16,a:500*(ge[0]-ge[1]),b:200*(ge[1]-ge[2])}}function ae(me){const ge=me.l,_e=[(ge+16)/116+me.a/500,(ge+16)/116,(ge+16)/116-me.b/200].map(Ee=>Ee>6/29?Ee**3:3*(6/29)**2*(Ee-4/29));return{x:95.047*_e[0],y:100*_e[1],z:108.883*_e[2]}}function ie(me){return function D(me){return"r"in me&&"g"in me&&"b"in me}(me)?me:Z(me)?function j(me){return X(ae(function le(me){const _e=me.c,Ee=me.h;return{l:me.l,a:_e*Math.cos(Ee),b:_e*Math.sin(Ee)}}(me)))}(me):G(me)?function se(me){return X(ae(me))}(me):function Q(me){return"x"in me&&"y"in me&&"z"in me}(me)?X(me):R(me)?function ee(me){const ge=(me.h+360)%360/60,Ee=me.v/100*255,De=Ee*(me.s/100),be=De*(1-Math.abs(ge%2-1));let Se;switch(Math.floor(ge)){case 0:Se={r:De,g:be,b:0};break;case 1:Se={r:be,g:De,b:0};break;case 2:Se={r:0,g:De,b:be};break;case 3:Se={r:0,g:be,b:De};break;case 4:Se={r:be,g:0,b:De};break;case 5:case 6:Se={r:De,g:0,b:be};break;default:Se={r:0,g:0,b:0}}return Se.r=Math.round(Se.r+Ee-De),Se.g=Math.round(Se.g+Ee-De),Se.b=Math.round(Se.b+Ee-De),Se}(me):me}function J(me){return R(me)?me:function Y(me){const ge=me.r,_e=me.g,Ee=me.b,De=Math.max(ge,_e,Ee),be=De-Math.min(ge,_e,Ee);let Se=De,ye=0===be?0:De===ge?(_e-Ee)/be%6:De===_e?(Ee-ge)/be+2:(ge-_e)/be+4,ve=0===be?0:be/Se;return ye<0&&(ye+=6),ye*=60,ve*=100,Se*=100/255,{h:ye,s:ve,v:Se}}(ie(me))}function ce(me){return G(me)?me:function de(me){return te(H(me))}(ie(me))}function ue(me){return Z(me)?me:function re(me){return function oe(me){const ge=me.l,_e=me.a,Ee=me.b,De=Math.sqrt(_e*_e+Ee*Ee);let be=Math.atan2(Ee,_e);return be=be>0?be:be+2*Math.PI,{l:ge,c:De,h:be}}(te(H(me)))}(ie(me))}},94573:(nt,Ae,v)=>{"use strict";function R(Q){}function Z(Q){return()=>Q}v.d(Ae,{Bg:()=>R,sM:()=>Z}),v(8314)},55538:(nt,Ae,v)=>{"use strict";v.d(Ae,{Mr:()=>$,x9:()=>W});var D=v(8314);const R=new Set;function $(B,H,X={}){if((0,D.Z)("esri-deprecation-warnings")){const{moduleName:te}=X;W(B,"Property: "+(te?te+"::":"")+H,X)}}function W(B,H,X={}){if((0,D.Z)("esri-deprecation-warnings")){const{replacement:te,version:ae,see:oe,warnOnce:le}=X;let de=H;te&&(de+=`\n\t\u{1f6e0}\ufe0f Replacement: ${te}`),ae&&(de+=`\n\t\u2699\ufe0f Version: ${ae}`),oe&&(de+=`\n\t\u{1f517} See ${oe} for more details.`),function G(B,H,X=!1){X&&R.has(H)||(X&&R.add(H),B.warn(`\u{1f6d1} DEPRECATED - ${H}`))}(B,de,le)}}},83100:(nt,Ae,v)=>{"use strict";function D(H){return H=H||globalThis.location.hostname,B.some(X=>null!=H?.match(X))}function R(H,X){return H&&(X=X||globalThis.location.hostname)?null!=X.match(Z)||null!=X.match($)?H.replace("static.arcgis.com","staticdev.arcgis.com"):null!=X.match(Q)||null!=X.match(W)?H.replace("static.arcgis.com","staticqa.arcgis.com"):H:H}v.d(Ae,{XO:()=>D,pJ:()=>R});const Z=/^devext.arcgis.com$/,Q=/^qaext.arcgis.com$/,$=/^[\w-]*\.mapsdevext.arcgis.com$/,W=/^[\w-]*\.mapsqa.arcgis.com$/,B=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,Z,Q,/^jsapps.esri.com$/,$,W]},40764:(nt,Ae,v)=>{"use strict";function D(B){return"string"==typeof B?document.getElementById(B):B??null}function R(B){for(;B.hasChildNodes();)B.removeChild(B.firstChild)}function Z(B,H){const X=H.parentNode;X&&X.insertBefore(B,H)}function Q(B,H){for(;;){const X=B.firstChild;if(!X)break;H.appendChild(X)}}v.d(Ae,{L7:()=>D,Vt:()=>Z,YD:()=>Q,cS:()=>R}),(()=>{if("function"==typeof Element.prototype.closest)return(H,X)=>H.closest(X);Element.prototype.matches||Element})()},17770:(nt,Ae,v)=>{"use strict";function D(W){return W&&("function"==typeof W.on||"function"==typeof W.addEventListener)}function R(W,B,H){if(!D(W))throw new TypeError("target is not a Evented or EventTarget object");if("on"in W)return W.on(B,H);if(Array.isArray(B)){const X=B.slice();for(const te of X)W.addEventListener(te,H);return{remove(){for(const te of X)W.removeEventListener(te,H)}}}return W.addEventListener(B,H),{remove(){W.removeEventListener(B,H)}}}function G(W,B,H){if(!D(W))throw new TypeError("target is not a Evented or EventTarget object");if("once"in W)return W.once(B,H);const X=R(W,B,te=>{X.remove(),H.call(W,te)});return{remove(){X.remove()}}}v.d(Ae,{IH:()=>G,kK:()=>$,on:()=>R,vT:()=>D});const Q={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function $({key:W}){return Q[W]||W}},36161:(nt,Ae,v)=>{"use strict";v.d(Ae,{I:()=>R,v:()=>G});var D=v(21286);function R(B,H,X=0){const te=(0,D.uZ)(B,0,$);for(let ae=0;ae<4;ae++)H[X+ae]=Math.floor(256*W(te*Z[ae]))}function G(B,H=0){let X=0;for(let te=0;te<4;te++)X+=B[H+te]*Q[te];return X}const Z=[1,256,65536,16777216],Q=[1/256,1/65536,1/16777216,1/4294967296],$=G(new Uint8ClampedArray([255,255,255,255]));function W(B){return B-Math.floor(B)}},54024:(nt,Ae,v)=>{"use strict";v.d(Ae,{AL:()=>R,ed:()=>Q,kB:()=>G});var D=v(62208);function R(B){return G(()=>B.forEach(H=>(0,D.pC)(H)&&H.remove()))}function G(B){return{remove:()=>{B&&(B(),B=void 0)}}}function Q(B){return G((0,D.pC)(B)?()=>B.destroy():void 0)}},8314:(nt,Ae,v)=>{"use strict";let D;function R(G){return"function"==typeof D[G]?D[G]=D[G](globalThis):D[G]}v.d(Ae,{Z:()=>R}),D=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},R.add=(G,Z,Q,$)=>(($||void 0===D[G])&&(D[G]=Z),Q&&R(G)),R.cache=D,R.add("esri-deprecation-warnings",!0),(()=>{R.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const G=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(R.add("host-browser",G),R.add("host-node","object"==typeof globalThis.process&&globalThis.process.versions?.node&&globalThis.process.versions.v8),R.add("dom",G),R("host-browser")){const Z=navigator,Q=Z.userAgent,$=Z.appVersion,W=parseFloat($);if(R.add("wp",parseFloat(Q.split("Windows Phone")[1])||void 0),R.add("msapp",parseFloat(Q.split("MSAppHost/")[1])||void 0),R.add("khtml",$.includes("Konqueror")?W:void 0),R.add("edge",parseFloat(Q.split("Edge/")[1])||void 0),R.add("opr",parseFloat(Q.split("OPR/")[1])||void 0),R.add("webkit",!R("wp")&&!R("edge")&&parseFloat(Q.split("WebKit/")[1])||void 0),R.add("chrome",!R("edge")&&!R("opr")&&parseFloat(Q.split("Chrome/")[1])||void 0),R.add("android",!R("wp")&&parseFloat(Q.split("Android ")[1])||void 0),R.add("safari",!$.includes("Safari")||R("wp")||R("chrome")||R("android")||R("edge")||R("opr")?void 0:parseFloat($.split("Version/")[1])),R.add("mac",$.includes("Macintosh")),!R("wp")&&Q.match(/(iPhone|iPod|iPad)/)){const B=RegExp.$1.replace(/P/,"p"),H=Q.match(/OS ([\d_]+)/)?RegExp.$1:"1",X=parseFloat(H.replace(/_/,".").replace(/_/g,""));R.add(B,X),R.add("ios",X)}R.add("trident",parseFloat($.split("Trident/")[1])||void 0),R("webkit")||(!Q.includes("Gecko")||R("wp")||R("khtml")||R("trident")||R("edge")||R.add("mozilla",W),R("mozilla")&&R.add("ff",parseFloat(Q.split("Firefox/")[1]||Q.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const G=navigator.userAgent,Z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(G),Q=/iPhone/i.test(G);Z&&R.add("esri-mobile",Z),Q&&R.add("esri-iPhone",Q),R.add("esri-geolocation",!!navigator.geolocation)}R.add("esri-canvas-svg-support",!R("trident")),R.add("esri-wasm","WebAssembly"in globalThis),R.add("esri-shared-array-buffer",()=>{const G="SharedArrayBuffer"in globalThis,Z=!1===globalThis.crossOriginIsolated;return G&&!Z}),R.add("wasm-simd",()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))),R.add("esri-atomics","Atomics"in globalThis),R.add("esri-workers","Worker"in globalThis),R.add("web-feat:cache","caches"in globalThis),R.add("esri-workers-arraybuffer-transfer",!R("safari")||Number(R("safari"))>=12),R.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),R.add("featurelayer-simplify-payload-size-factors",[1,1,4]),R.add("featurelayer-snapshot-enabled",!0),R.add("featurelayer-snapshot-point-min-threshold",8e4),R.add("featurelayer-snapshot-point-max-threshold",4e5),R.add("featurelayer-snapshot-point-coverage",.1),R.add("featurelayer-advanced-symbols",!1),R.add("featurelayer-pbf",!0),R.add("featurelayer-pbf-statistics",!1),R.add("feature-layers-workers",!0),R.add("feature-polyline-generalization-factor",1),R.add("mapview-transitions-duration",200),R.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),R.add("mapserver-pbf-enabled",!1),R.add("mapimagelayer-popup-identify-max-tolerance",20),R.add("heatmap-allow-raster-fallback",!0),R.add("heatmap-force-raster",!1),R("host-webworker")||R("host-browser")&&(R.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),R.add("esri-image-decode",()=>{if("decode"in new Image){const G=new Image;return G.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void G.decode().then(()=>{R.add("esri-image-decode",!0,!0,!0)}).catch(()=>{R.add("esri-image-decode",!1,!0,!0)})}return!1}),R.add("esri-url-encodes-apostrophe",()=>{const G=window.document.createElement("a");return G.href="?'",G.href.includes("?%27")}))})()},90740:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>Z,r:()=>G});let D=null,R=!0;function G(W,B,H){if(!W||!B)throw new Error("Cannot construct image data without dimensions");if(R)try{return new ImageData(W,B)}catch{R=!1}return $(W,B,H)}function Z(W,B,H,X){if(!B||!H)throw new Error("Cannot construct image data without dimensions");if(R)try{return new ImageData(W,B,H)}catch{R=!1}const te=$(B,H,X);return te.data.set(W,0),te}function $(W,B,H){return H||(H=function Q(){return D||(D=document.createElement("canvas"),D.width=1,D.height=1),D}()),H.getContext("2d").createImageData(W,B)}},56354:(nt,Ae,v)=>{"use strict";function D(Z){const Q=[];return function*(){yield*Q;for(const $ of Z)Q.push($),yield $}}function R(Z,Q){for(const $ of Z)if(null!=$&&Q($))return $}function G(Z){return null!=Z&&"function"==typeof Z[Symbol.iterator]}v.d(Ae,{Fs:()=>D,TW:()=>G,sE:()=>R})},2076:(nt,Ae,v)=>{"use strict";v.d(Ae,{X:()=>R,w:()=>G});var D=v(94113);class R{constructor(Q,$={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=Q,this._options=$,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(Q),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=W=>this.fromJSON(W),this.write=(W,B,H)=>{const X=this.toJSON(W);void 0!==X&&(0,D.RB)(H,X,B)},this.write.isJSONMapWriter=!0}toJSON(Q){if(this._apiToJSON.hasOwnProperty(Q)){const $=this._apiToJSON[Q];return this._options.useNumericKeys?+$:$}return this._options.ignoreUnknown?void 0:Q}fromJSON(Q){return this._jsonToAPI.hasOwnProperty(Q)?this._jsonToAPI[Q]:this._options.ignoreUnknown?void 0:Q}_invertMap(Q){const $={};for(const W in Q)$[Q[W]]=W;return $}_getKeysSorted(Q){const $=[];for(const W in Q)$.push(W);return $.sort(),$}}function G(){return function(Z,Q){return new R(Z,{ignoreUnknown:!0,...Q})}}},58817:(nt,Ae,v)=>{"use strict";v.d(Ae,{Vo:()=>$,d9:()=>Q,fS:()=>ae,y7:()=>oe,yd:()=>Z});var D=v(85931),R=v(62208),G=v(55713);function Z(re,j){let Y;if(j)for(Y in re)re.hasOwnProperty(Y)&&(void 0===re[Y]?delete re[Y]:re[Y]instanceof Object&&Z(re[Y],!0));else for(Y in re)re.hasOwnProperty(Y)&&void 0===re[Y]&&delete re[Y];return re}function Q(re){if(!re||"object"!=typeof re||"function"==typeof re)return re;const j=te(re);if((0,R.pC)(j))return j;if(W(re))return re.clone();if(B(re))return re.map(Q);if(H(re))return re.clone();const Y={};for(const ee of Object.getOwnPropertyNames(re))Y[ee]=Q(re[ee]);return Y}function $(re){if(!re||"object"!=typeof re||"function"==typeof re||"HTMLElement"in globalThis&&re instanceof HTMLElement)return re;const j=te(re);if((0,R.pC)(j))return j;if(B(re)){let Y=!0;const ee=re.map(ie=>{const J=$(ie);return null!=ie&&null==J&&(Y=!1),J});return Y?ee:null}if(W(re))return re.clone();if(!H(re)){const Y=new(Object.getPrototypeOf(re).constructor);for(const ee of Object.getOwnPropertyNames(re)){const ie=re[ee],J=$(ie);if(null!=ie&&null==J)return null;Y[ee]=J}return Y}return null}function W(re){return"function"==typeof re.clone}function B(re){return"function"==typeof re.map&&"function"==typeof re.forEach}function H(re){return"function"==typeof re.notifyChange&&"function"==typeof re.watch}function X(re){if("[object Object]"!==Object.prototype.toString.call(re))return!1;const j=Object.getPrototypeOf(re);return null===j||j===Object.prototype}function te(re){if((0,G.W0)(re)||(0,G.lq)(re)||(0,G.KZ)(re)||(0,G.z3)(re)||(0,G.Uc)(re)||(0,G.Hx)(re)||(0,G.ZY)(re)||(0,G.xZ)(re)||(0,G.fS)(re))return(0,G.tP)(re);if(re instanceof Date)return new Date(re.getTime());if(re instanceof ArrayBuffer)return re.slice(0,re.byteLength);if(re instanceof Map){const j=new Map;for(const[Y,ee]of re)j.set(Y,Q(ee));return j}if(re instanceof Set){const j=new Set;for(const Y of re)j.add(Q(Y));return j}return null}function ae(re,j){return re===j||"number"==typeof re&&isNaN(re)&&"number"==typeof j&&isNaN(j)||"function"==typeof(re||{}).getTime&&"function"==typeof(j||{}).getTime&&re.getTime()===j.getTime()||!1}function oe(re,j){return re===j||(null==re||"string"==typeof re?re===j:"number"==typeof re?re===j||"number"==typeof j&&isNaN(re)&&isNaN(j):re instanceof Date?j instanceof Date&&re.getTime()===j.getTime():Array.isArray(re)?Array.isArray(j)&&(0,D.fS)(re,j):re instanceof Set?j instanceof Set&&function de(re,j){if(re.size!==j.size)return!1;for(const Y of re)if(!j.has(Y))return!1;return!0}(re,j):re instanceof Map?j instanceof Map&&function se(re,j){if(re.size!==j.size)return!1;for(const[Y,ee]of re){const ie=j.get(Y);if(ie!==ee||void 0===ie&&!j.has(Y))return!1}return!0}(re,j):!!X(re)&&X(j)&&function le(re,j){if(null===re||null===j)return!1;const Y=Object.keys(re);if(null===j||Object.keys(j).length!==Y.length)return!1;for(const ee of Y)if(re[ee]!==j[ee]||!Object.prototype.hasOwnProperty.call(j,ee))return!1;return!0}(re,j))}},75957:(nt,Ae,v)=>{"use strict";function G(Z){return function D(Z){return Z instanceof Float32Array&&Z.length>=2}(Z)||function R(Z){return Array.isArray(Z)&&Z.length>=2}(Z)}v.d(Ae,{lM:()=>G})},47877:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>$,w:()=>B});var D=v(15861),R=v(59213),G=v(46160),Z=v(47996),Q=v(62208);function $(te,ae){return W.apply(this,arguments)}function W(){return(W=(0,D.Z)(function*(te,ae){return yield te.load(),B(te,ae)})).apply(this,arguments)}function B(te,ae){return H.apply(this,arguments)}function H(){return H=(0,D.Z)(function*(te,ae){const oe=[],le=(...se)=>{for(const re of se)(0,Q.Wi)(re)||(Array.isArray(re)?le(...re):G.Z.isCollection(re)?re.forEach(j=>le(j)):Z.Z.isLoadable(re)&&oe.push(re))};ae(le);let de=null;if(yield(0,R.UI)(oe,function(){var se=(0,D.Z)(function*(re){!1!==(yield(0,R.q6)(X(re)?re.loadAll():re.load())).ok||de||(de=re)});return function(re){return se.apply(this,arguments)}}()),de)throw de.loadError;return te}),H.apply(this,arguments)}function X(te){return"loadAll"in te&&"function"==typeof te.loadAll}},21286:(nt,Ae,v)=>{"use strict";v.d(Ae,{BV:()=>oe,CW:()=>_e,H:()=>be,Kt:()=>se,Sf:()=>Z,Vl:()=>ae,W8:()=>re,Y8:()=>pe,ZF:()=>de,_3:()=>ye,b_:()=>le,fp:()=>B,jE:()=>Ee,oK:()=>he,oc:()=>Se,sk:()=>H,t7:()=>X,uZ:()=>Q,wt:()=>W});var D=v(84161),R=v(993);const G=new Float32Array(1);function Z(ve){--ve;for(let xe=1;xe<32;xe<<=1)ve|=ve>>xe;return ve+1}function Q(ve,xe,ze){return Math.min(Math.max(ve,xe),ze)}function W(ve){return 0==(ve&ve-1)}function B(ve){return ve--,ve|=ve>>1,ve|=ve>>2,ve|=ve>>4,ve|=ve>>8,ve|=ve>>16,++ve}function H(ve){return 10**Math.ceil(Math.LOG10E*Math.log(ve))}function X(ve,xe,ze){return ve+(xe-ve)*ze}function ae(ve){return ve*Math.PI/180}function oe(ve){return 180*ve/Math.PI}function le(ve,xe=1e-6){return(ve<0?-1:1)/Math.max(Math.abs(ve),xe)}function de(ve){return Math.acos(Q(ve,-1,1))}function se(ve){return Math.asin(Q(ve,-1,1))}function re(ve,xe,ze=1e-6){return ve===xe||!(!Number.isFinite(ve)||!Number.isFinite(xe))&&(ve>xe?ve-xe:xe-ve)<=ze}const j=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));const ie=BigInt("1000000");function pe(ve,xe,ze=1e-6){if(ve===xe)return!0;if(!Number.isFinite(ve)||!Number.isFinite(xe))return!1;const Ke=Math.abs(ve-xe),We=Math.abs(ve),Ce=Math.abs(xe);if(0===ve||0===xe||We<1e-12&&Ce<1e-12){if(Ke>.01*ze)return!1}else if(Ke/(We+Ce)>ze)return!1;return!0}function he(ve){return me(Math.max(-ye,Math.min(ve,ye)))}function me(ve){return G[0]=ve,G[0]}function _e(ve,xe,ze){const Ke=Q((ze-ve)/(xe-ve),0,1);return Ke*Ke*(3-2*Ke)}function Ee(ve,xe){const ze=(0,D.l)(ve),Ke=se(ve[2]/ze),We=Math.atan2(ve[1]/ze,ve[0]/ze);return(0,D.s)(xe,ze,Ke,We),xe}function be(ve,xe,ze){return(0,R.s)(ve,xe[0],xe[1],xe[2],xe[3]*ze)}function Se(ve){const ze=ve[3]*ve[3]+ve[4]*ve[4]+ve[5]*ve[5],Ke=ve[6]*ve[6]+ve[7]*ve[7]+ve[8]*ve[8];return!(re(ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2],1)&&re(ze,1)&&re(Ke,1))}!function ce(ve){const xe=function Y(ve){return j.setFloat64(0,ve),j.getBigInt64(0)}(ve=Math.abs(ve)),ze=function ee(ve){return j.setBigInt64(0,ve),j.getFloat64(0)}(xe<=ie?ie:xe-ie);return Math.abs(ve-ze)}(1);const ye=me(34028234663852886e22)},62208:(nt,Ae,v)=>{"use strict";v.d(Ae,{Fd:()=>Y,IM:()=>le,JR:()=>ee,M2:()=>ae,O3:()=>B,Pt:()=>H,R2:()=>ie,RY:()=>de,SC:()=>te,U2:()=>ue,Wg:()=>$,Wi:()=>G,YP:()=>D,_W:()=>se,e8:()=>j,hw:()=>oe,j0:()=>pe,lV:()=>ce,pC:()=>R,s3:()=>W,wN:()=>re,yl:()=>X,yw:()=>Q});const D=null;function R(he){return null!=he}function G(he){return null==he}function Q(he,me){return R(he)?me(he):D}function $(he){return he}function W(he,me){return B(he,me),he}function B(he,me){if(G(he))throw new Error(me??"value is None")}function H(he,me){return R(he)?he:"function"==typeof me?me():me}function X(he,me){return R(he)?he:me}function te(he){return R(he)&&he.destroy(),null}function ae(he){return R(he)&&he.dispose(),null}function oe(he){return R(he)&&he.remove(),null}function le(he){return R(he)&&he.abort(),null}function de(he){return R(he)&&he.release(),null}function se(he,me,ge){return R(he)&&R(me)?R(ge)?ge(he,me):he.equals(me):he===me}function re(he){return null}function j(he,me){const ge=new Array;return he.forEach(_e=>{const Ee=me(_e);R(Ee)&&ge.push(Ee)}),ge}function Y(he,me){const ge=new Array;for(const _e of he)ge.push(ie(_e,null,me));return ge}function ee(he,me){for(const ge of he)Q(ge,me)}function ie(he,me,ge){return R(he)?ge(he):me}function ce(he){return he.filter(me=>R(me))}function ue(he,...me){let ge=he;for(let _e=0;_e<me.length&&ge;++_e)ge=ge[me[_e]];return ge}function pe(he){return he}},79682:(nt,Ae,v)=>{"use strict";v.d(Ae,{Y:()=>R});const D=[];function R(G){D.push(G),1===D.length&&queueMicrotask(()=>{const Z=D.slice();D.length=0;for(const Q of Z)Q()})}},94113:(nt,Ae,v)=>{"use strict";v.d(Ae,{RB:()=>Z,RH:()=>R,hS:()=>G});var D=v(58817);function R(W,B,H=!1){return $(W,B,H)}function G(W,B){if(null!=B)return B[W]||Q(W.split("."),!1,B)}function Z(W,B,H){const X=W.split("."),te=X.pop(),ae=Q(X,!0,H);ae&&te&&(ae[te]=B)}function Q(W,B,H){let X=H;for(const te of W){if(null==X)return;if(!(te in X)){if(!B)return;X[te]={}}X=X[te]}return X}function $(W,B,H){return B?Object.keys(B).reduce((X,te)=>{let ae=X[te],oe=B[te];return ae===oe?X:void 0===ae?(X[te]=(0,D.d9)(oe),X):(Array.isArray(oe)||Array.isArray(X)?(ae=X[te]=ae?Array.isArray(ae)?ae.concat():[ae]:[],oe&&(Array.isArray(oe)||(oe=[oe]),H?oe.forEach(le=>{ae.includes(le)||ae.push(le)}):X[te]=oe.concat())):oe&&"object"==typeof oe?X[te]=$(ae,oe,H):X.hasOwnProperty(te)&&!B.hasOwnProperty(te)||(X[te]=oe),X)},W||{}):W}},24192:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>W});var G,B,D=v(8314),R=v(27899);(B=G||(G={}))[B.varint=0]="varint",B[B.fixed64=1]="fixed64",B[B.delimited=2]="delimited",B[B.fixed32=5]="fixed32",B[B.unknown=99]="unknown";const Z=4294967296,Q=new TextDecoder("utf-8"),$=(0,D.Z)("safari")||(0,D.Z)("ios")?6:(0,D.Z)("ff")?12:32;class W{constructor(H,X,te=0,ae=(H?H.byteLength:0)){this._tag=0,this._dataType=G.unknown,this._init(H,X,te,ae)}_init(H,X,te,ae){this._data=H,this._dataView=X,this._pos=te,this._end=ae}asUnsafe(){return this}clone(){return new W(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(H){this._pos=H}nextTag(H){for(;;){if(this._pos===this._end)return!1;const X=this._decodeVarint();if(this._tag=X>>3,this._dataType=7&X,!H||H===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const H=this._decodeVarint();return this._tag=H>>3,this._dataType=7&H,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let H=4294967295;return H=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?H:(H=(H|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?H:(H=(H|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?H:(H=(H|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?H:(H=(H|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?H:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const H=this.getUInt32();if(void 0!==H)return H>>>1^-(1&H)|0}getSInt64(){return this._decodeSVarint()}getBool(){const H=0!==this._data[this._pos];return this._skip(1),H}getEnum(){return this._decodeVarint()}getFixed64(){const H=this._dataView,X=this._pos,te=H.getUint32(X,!0)+H.getUint32(X+4,!0)*Z;return this._skip(8),te}getSFixed64(){const H=this._dataView,X=this._pos,te=H.getUint32(X,!0)+H.getInt32(X+4,!0)*Z;return this._skip(8),te}getDouble(){const H=this._dataView.getFloat64(this._pos,!0);return this._skip(8),H}getFixed32(){const H=this._dataView.getUint32(this._pos,!0);return this._skip(4),H}getSFixed32(){const H=this._dataView.getInt32(this._pos,!0);return this._skip(4),H}getFloat(){const H=this._dataView.getFloat32(this._pos,!0);return this._skip(4),H}getString(){const H=this._getLength(),X=this._pos,te=this._toString(this._data,X,X+H);return this._skip(H),te}getBytes(){const H=this._getLength(),X=this._pos,te=this._toBytes(this._data,X,X+H);return this._skip(H),te}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(H,X,te,ae){const oe=this.getMessage(),le=H(oe,X,te,ae);return oe.release(),le}processMessage(H){const X=this.getMessage(),te=H(X);return X.release(),te}getMessage(){const H=this._getLength(),X=W.pool.acquire();return X._init(this._data,this._dataView,this._pos,this._pos+H),this._skip(H),X}release(){W.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case G.varint:this._decodeVarint();break;case G.fixed64:this._skip(8);break;case G.delimited:this._skip(this._getLength());break;case G.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(H){this._skip(H)}_skip(H){if(this._pos+H>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=H}_decodeVarint(){const H=this._data;let X=this._pos,te=0,ae=0;if(this._end-X>=10)do{if(ae=H[X++],te|=127&ae,0==(128&ae)||(ae=H[X++],te|=(127&ae)<<7,0==(128&ae))||(ae=H[X++],te|=(127&ae)<<14,0==(128&ae))||(ae=H[X++],te|=(127&ae)<<21,0==(128&ae))||(ae=H[X++],te+=268435456*(127&ae),0==(128&ae))||(ae=H[X++],te+=34359738368*(127&ae),0==(128&ae))||(ae=H[X++],te+=4398046511104*(127&ae),0==(128&ae))||(ae=H[X++],te+=562949953421312*(127&ae),0==(128&ae))||(ae=H[X++],te+=72057594037927940*(127&ae),0==(128&ae))||(ae=H[X++],te+=0x8000000000000000*(127&ae),0==(128&ae)))break;throw new Error("Varint too long!")}while(0);else{let oe=1;for(;X!==this._end&&(ae=H[X],0!=(128&ae));)++X,te+=(127&ae)*oe,oe*=128;if(X===this._end)throw new Error("Varint overrun!");++X,te+=ae*oe}return this._pos=X,te}_decodeSVarint(){const H=this._data;let X=this._pos,te=0,ae=0;const oe=1&H[X];if(this._end-X>=10)do{if(ae=H[X++],te|=127&ae,0==(128&ae)||(ae=H[X++],te|=(127&ae)<<7,0==(128&ae))||(ae=H[X++],te|=(127&ae)<<14,0==(128&ae))||(ae=H[X++],te|=(127&ae)<<21,0==(128&ae))||(ae=H[X++],te+=268435456*(127&ae),0==(128&ae))||(ae=H[X++],te+=34359738368*(127&ae),0==(128&ae))||(ae=H[X++],te+=4398046511104*(127&ae),0==(128&ae))||(ae=H[X++],te+=562949953421312*(127&ae),0==(128&ae))||(ae=H[X++],te+=72057594037927940*(127&ae),0==(128&ae))||(ae=H[X++],te+=0x8000000000000000*(127&ae),0==(128&ae)))break;throw new Error("Varint too long!")}while(0);else{let le=1;for(;X!==this._end&&(ae=H[X],0!=(128&ae));)++X,te+=(127&ae)*le,le*=128;if(X===this._end)throw new Error("Varint overrun!");++X,te+=ae*le}return this._pos=X,oe?-(te+1)/2:te/2}_getLength(){if(this._dataType!==G.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(H,X,te){if((te=Math.min(this._end,te))-X>$){const le=H.subarray(X,te);return Q.decode(le)}let ae="",oe="";for(let le=X;le<te;++le){const de=H[le];128&de?oe+="%"+de.toString(16):(ae+=decodeURIComponent(oe)+String.fromCharCode(de),oe="")}return oe.length&&(ae+=decodeURIComponent(oe)),ae}_toBytes(H,X,te){return te=Math.min(this._end,te),new Uint8Array(H.buffer,X,te-X)}}W.pool=new R.Z(W,void 0,B=>{B._data=null,B._dataView=null})},10699:(nt,Ae,v)=>{"use strict";v.d(Ae,{$F:()=>j,Bx:()=>ze,D_:()=>ie,Ds:()=>ve,H9:()=>se,Hc:()=>le,Hl:()=>Y,R8:()=>J,U3:()=>ue,WW:()=>_e,Yn:()=>Ke,as:()=>me,dD:()=>he,e4:()=>De,fu:()=>re,gx:()=>ye,hh:()=>xe,k_:()=>ae,r9:()=>de,y8:()=>Se,zE:()=>te});var D=v(15861),R=v(84244),Z=(v(55538),v(26584)),Q=v(17770),$=v(63290),W=v(62208);function te(Ce="Aborted"){return new Z.Z("AbortError",Ce)}function ae(Ce,Be="Aborted"){if(le(Ce))throw te(Be)}function oe(Ce){return(0,W.pC)(Ce)?"aborted"in Ce?Ce:Ce.signal:Ce}function le(Ce){const Be=oe(Ce);return(0,W.pC)(Be)&&Be.aborted}function de(Ce){if(ie(Ce))throw Ce}function se(Ce){if(!ie(Ce))throw Ce}function re(Ce,Be){const Fe=oe(Ce);if(!(0,W.Wi)(Fe)){if(!Fe.aborted)return(0,Q.IH)(Fe,"abort",()=>Be());Be()}}function j(Ce,Be){const Fe=oe(Ce);if(!(0,W.Wi)(Fe))return ae(Fe),(0,Q.IH)(Fe,"abort",()=>Be(te()))}function Y(Ce,Be){const Fe=oe(Be);return(0,W.Wi)(Fe)?Ce:new Promise((je,Re)=>{let He=re(Be,()=>Re(te()));const Ie=()=>He=(0,W.hw)(He);Ce.then(Ie,Ie),Ce.then(je,Re)})}function ie(Ce){return"AbortError"===Ce?.name}function J(Ce){return ce.apply(this,arguments)}function ce(){return(ce=(0,D.Z)(function*(Ce){try{return yield Ce}catch(Be){if(!ie(Be))throw Be;return}})).apply(this,arguments)}function ue(Ce){return pe.apply(this,arguments)}function pe(){return(pe=(0,D.Z)(function*(Ce,Be=$.Z.getLogger("esri")){try{return yield Ce}catch(Fe){ie(Fe)||Be.error(Fe)}})).apply(this,arguments)}function he(){let Ce=null;const Be=new Promise((Fe,je)=>{Ce={promise:void 0,resolve:Fe,reject:je}});return Ce.promise=Be,Ce}function me(Ce){return ge.apply(this,arguments)}function ge(){return(ge=(0,D.Z)(function*(Ce){if(!Ce)return;if("function"!=typeof Ce.forEach){const Fe=Object.keys(Ce),je=Fe.map(Ie=>Ce[Ie]),Re=yield me(je),He={};return Fe.map((Ie,Ge)=>He[Ie]=Re[Ge]),He}const Be=Ce;return new Promise(Fe=>{const je=[];let Re=Be.length;0===Re&&Fe(je),Be.forEach(He=>{const Ie={promise:He||Promise.resolve(He)};je.push(Ie),Ie.promise.then(Ge=>{Ie.value=Ge}).catch(Ge=>{Ie.error=Ge}).then(()=>{--Re,0===Re&&Fe(je)})})})})).apply(this,arguments)}function _e(Ce){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,D.Z)(function*(Ce){return(yield me(Ce)).filter(Be=>!!Be.value).map(Be=>Be.value)})).apply(this,arguments)}function De(Ce,Be,Fe){const je=new AbortController;return re(Fe,()=>je.abort()),new Promise((Re,He)=>{let Ie=setTimeout(()=>{Ie=0,Re(Be)},Ce);re(je,()=>{Ie&&(clearTimeout(Ie),He(te()))})})}function Se(Ce){return Ce&&"function"==typeof Ce.then}function ye(Ce){return Se(Ce)?Ce:Promise.resolve(Ce)}function ve(Ce,Be=-1){let Fe,je,Re,He,Ie=null;const Ge=(...Pe)=>{if(Fe){je=Pe,He&&He.reject(te()),He=he();const Xe=(0,W.j0)(He.promise);if(Ie){const Ye=Ie;Ie=null,Ye.abort()}return Xe}if(Re=He||he(),He=null,Be>0){const Xe=new AbortController;Fe=ye(Ce(...Pe,Xe.signal));const Ye=Fe;De(Be).then(()=>{Fe===Ye&&(He?Xe.abort():Ie=Xe)})}else Fe=1,Fe=ye(Ce(...Pe));const Le=()=>{const Xe=je;je=Re=Fe=Ie=null,null!=Xe&&Ge(...Xe)},Me=Fe,Ne=Re;return Me.then(Le,Le),Me.then(Ne.resolve,Ne.reject),(0,W.j0)(Ne.promise)};return Ge}function xe(){let Ce,Be;const Fe=new Promise((Re,He)=>{Ce=Re,Be=He}),je=Re=>{Ce(Re)};return je.resolve=Re=>Ce(Re),je.reject=Re=>Be(Re),je.timeout=(Re,He)=>R.m.setTimeout(()=>je.reject(He),Re),je.promise=Fe,je}function ze(Ce,Be){return Ce.then(Be,Be)}function Ke(Ce){return We.apply(this,arguments)}function We(){return(We=(0,D.Z)(function*(Ce){yield Promise.resolve(),ae(Ce)})).apply(this,arguments)}},32917:(nt,Ae,v)=>{"use strict";v.d(Ae,{N1:()=>ae,YP:()=>W,Z_:()=>re,gx:()=>B,nn:()=>j,on:()=>X,tX:()=>Y});var D=v(17770),R=v(54024),G=v(62208),Z=v(10699),Q=v(30755);function W(ee,ie,J={}){return H(ee,ie,J,le)}function B(ee,ie,J={}){return H(ee,ie,J,de)}function H(ee,ie,J={},ce){let ue=null;const pe=J.once?(he,me)=>{ce(he)&&((0,G.hw)(ue),ie(he,me))}:(he,me)=>{ce(he)&&ie(he,me)};if(ue=(0,Q.aQ)(ee,pe,J.sync,J.equals),J.initial){const he=ee();pe(he,he)}return ue}function X(ee,ie,J,ce={}){let ue=null,pe=null,he=null;function me(){ue&&pe&&(pe.remove(),ce.onListenerRemove?.(ue),ue=null,pe=null)}function ge(Ee){ce.once&&ce.once&&(0,G.hw)(he),J(Ee)}const _e=W(ee,(Ee,De)=>{me(),(0,D.vT)(Ee)&&(ue=Ee,pe=(0,D.on)(Ee,ie,ge),ce.onListenerAdd?.(Ee))},{sync:ce.sync,initial:!0});return he=(0,R.kB)(()=>{_e.remove(),me()}),he}function ae(ee,ie){return function oe(ee,ie,J){if((0,Z.Hc)(J))return Promise.reject((0,Z.zE)());const ce=ee();if(ie?.(ce))return Promise.resolve(ce);let ue=null;function pe(){ue=(0,G.hw)(ue)}return new Promise((he,me)=>{ue=(0,R.AL)([(0,Z.fu)(J,()=>{pe(),me((0,Z.zE)())}),H(ee,ge=>{pe(),he(ge)},{sync:!1,once:!0},ie??le)])})}(ee,de,ie)}function le(ee){return!0}function de(ee){return!!ee}v(21352);const re={sync:!0},j={initial:!0},Y={sync:!0,initial:!0}},50618:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>j,MU:()=>me,Os:()=>re,bP:()=>ie});var D=v(62208),R=v(79682),G=v(73362),Z=v(77029),Q=v(10699),$=v(27422);class W{constructor(be){this.phases=be,this.paused=!1,this.ticks=-1,this.removed=!1}}class B{constructor(be){this.callback=be,this.isActive=!0}remove(){this.isActive=!1}}let H=0,X=0;const te={time:(0,$.HA)(0),deltaTime:(0,$.HA)(0),elapsedFrameTime:(0,$.HA)(0),frameDuration:(0,$.HA)(0)},ae=["prepare","preRender","render","postRender","update","finish"],oe=[],le=new Z.Z;class de{constructor(be){this._task=be}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const se={frameTasks:le,willDispatch:!1,clearFrameTasks:function ee(De=!1){le.forAll(be=>{be.removed=!0}),De&&pe()},dispatch:he,executeFrameTasks:function ce(De){const be=(0,$.HA)(De-H);H=De;const Se=X>0?X:1e3/60,ye=Math.max(0,be-Se);for(let ve=0;ve<ae.length;ve++){const xe=performance.now(),ze=ae[ve];le.forAll(Ke=>{Ke.paused||Ke.removed||(0===ve&&Ke.ticks++,Ke.phases[ze]&&(te.time=De,te.deltaTime=0===Ke.ticks?(0,$.HA)(0):be,te.elapsedFrameTime=(0,$.HA)(performance.now()-De),te.frameDuration=(0,$.HA)(Se-ye),Ke.phases[ze]?.call(Ke,te)))}),_e[ve].record(performance.now()-xe)}pe(),Ee.record(performance.now()-De)}};function re(De){const be=new B(De);return oe.push(be),se.willDispatch||(se.willDispatch=!0,(0,R.Y)(he)),be}function j(De){const be=new W(De);return le.push(be),null==Y&&(H=performance.now(),Y=requestAnimationFrame(J)),new de(be)}let Y=null;function ie(De){X=Math.max(0,De)}function J(){const De=performance.now();Y=null,Y=le.length>0?requestAnimationFrame(J):null,se.executeFrameTasks(De)}const ue=new Z.Z;function pe(){le.forAll(De=>{De.removed&&ue.push(De)}),le.removeUnorderedMany(ue.data,ue.length),ue.clear()}function he(){for(;oe.length;){const De=(0,D.j0)(oe.shift());De.isActive&&De.callback()}se.willDispatch=!1}function me(De=1,be){const Se=(0,Q.hh)(),ye=()=>{(0,Q.Hc)(be)?Se.reject((0,Q.zE)()):0===De?Se():(--De,(0,R.Y)(()=>ye()))};return ye(),Se.promise}const _e=ae.map(De=>new G.Z(De)),Ee=new G.Z("total")},23841:(nt,Ae,v)=>{"use strict";v.d(Ae,{F2:()=>Z,J$:()=>te,So:()=>ae,Wv:()=>oe,Wz:()=>Q,c$:()=>le,gX:()=>X,md:()=>se,s1:()=>B,t_:()=>$,vW:()=>W});const D=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function Z(re){return re?re/72*96:0}function Q(re){return re?72*re/96:0}function $(re){if("string"==typeof re){const j=re.match(D);if(j){const Y=Number(j[1]),ee=j[3]&&j[3].toLowerCase(),ie="-"===re.charAt(0),J="px"===ee?Q(Y):Y;return ie?-J:J}return console.warn("screenUtils.toPt: input not recognized!"),null}return re}function W(re=0,j=0){return{x:re,y:j}}function B(re=0,j=0){return[re,j]}function X(re=0,j=0){return[re,j]}function te(re=0,j=0,Y=0){return[re,j,Y]}function ae(re){return re}function oe(re){return re}function le(re){return re}function se(re,j){return j?(j[0]=re.x,j[1]=re.y,j.length>2&&(j[2]=0),j):[re.x,re.y]}},95737:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>G,_:()=>Q});var D=v(15861),R=v(62208);function G($,W){return Z.apply(this,arguments)}function Z(){return(Z=(0,D.Z)(function*($,W){const{WhereClause:B}=yield v.e(410).then(v.bind(v,10410));return B.create($,W)})).apply(this,arguments)}function Q($,W){return(0,R.pC)($)?(0,R.pC)(W)?`(${$}) AND (${W})`:$:W}},77275:(nt,Ae,v)=>{"use strict";v.d(Ae,{Cb:()=>W,Qs:()=>Q,gx:()=>Z,hP:()=>$});var D=v(94113);const R=/\{([^\}]+)\}/g;function G(B){return B??""}function Z(B,H){return B.replace(R,"object"==typeof H?(X,te)=>G((0,D.hS)(te,H)):(X,te)=>G(H(te)))}function Q(B,H){return B.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,X=>H&&H.includes(X)?X:`\\${X}`)}function $(B){let H=0;for(let X=0;X<B.length;X++)H=(H<<5)-H+B.charCodeAt(X),H|=0;return H}function W(B){return(new DOMParser).parseFromString(B||"","text/html").body.innerText||""}},28705:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>ae,z:()=>oe});var D=v(17626),R=v(46160),G=v(89726),Z=v(80542),W=(v(8314),v(63290),v(62208)),B=v(77712),te=(v(85931),v(90912),v(76898));let ae=class extends((0,Z.p)(R.Z)){constructor(le){super(le),this.handles.add([this.on("before-add",de=>{(0,W.Wi)(de.item)&&de.preventDefault()}),this.on("after-add",de=>this._own(de.item)),this.on("after-remove",de=>this._release(de.item))])}get owner(){return this._get("owner")}set owner(le){le!==this._get("owner")&&(this._releaseAll(),this._set("owner",le),this._ownAll())}_ownAll(){for(const le of this.items)this._own(le)}_releaseAll(){for(const le of this.items)this._release(le)}_createNewInstance(le){return this.itemType?new(R.Z.ofType(this.itemType.Type))(le):new R.Z(le)}};function oe(le,de){return{type:le,cast:G.R,set(se){const re=(0,G.Z)(se,this._get(de),le);re.owner=this,this._set(de,re)}}}(0,D._)([(0,B.Cb)()],ae.prototype,"owner",null),ae=(0,D._)([(0,te.j)("esri.core.support.OwningCollection")],ae)},17760:(nt,Ae,v)=>{"use strict";v.d(Ae,{t:()=>H});var D=v(17626),R=v(14517),G=v(72392),Z=v(62208),Q=v(32917),$=v(50618),W=v(77712),B=v(76898);let H=class extends R.Z{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new G.Z,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(te,ae,oe={}){return this._installWatch(te,ae,oe,Q.YP)}addWhen(te,ae,oe={}){return this._installWatch(te,ae,oe,Q.gx)}addOnCollectionChange(te,ae,{initial:oe=!1,final:le=!1}={}){const de=++this._handleId;return this._handles.add([(0,Q.on)(te,"after-changes",this._createSyncUpdatingCallback(),Q.Z_),(0,Q.on)(te,"change",ae,{onListenerAdd:oe?se=>ae({added:se.toArray(),removed:[]}):void 0,onListenerRemove:le?se=>ae({added:[],removed:se.toArray()}):void 0})],de),{remove:()=>this._handles.remove(de)}}addPromise(te){if((0,Z.Wi)(te))return te;const ae=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(te)&&(0!==this._pendingPromises.size||this._handles.has(X)||this._set("updating",!1))}},ae),this._pendingPromises.add(te),this._set("updating",!0);const oe=()=>this._handles.remove(ae);return te.then(oe,oe),te}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(te,ae,oe={},le){const de=++this._handleId;oe.sync||this._installSyncUpdatingWatch(te,de);const se=le(te,ae,oe);return this._handles.add(se,de),{remove:()=>this._handles.remove(de)}}_installSyncUpdatingWatch(te,ae){const oe=this._createSyncUpdatingCallback(),le=(0,Q.YP)(te,oe,{sync:!0,equals:()=>!1});return this._handles.add(le,ae),le}_createSyncUpdatingCallback(){return()=>{this._handles.remove(X),++this._scheduleHandleId;const te=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add((0,$.Os)(()=>{te===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(X))}),X)}}};(0,D._)([(0,W.Cb)({readOnly:!0})],H.prototype,"updating",void 0),H=(0,D._)([(0,B.j)("esri.core.support.WatchUpdatingTracking")],H);const X=-42},27422:(nt,Ae,v)=>{"use strict";function D(Q){return Q}function R(Q){return 1e3*Q}function G(Q){return Q}function Z(Q){return.001*Q}v.d(Ae,{D9:()=>Z,HA:()=>D,_H:()=>G,up:()=>R})},28170:(nt,Ae,v)=>{"use strict";v.d(Ae,{JE:()=>W,Nm:()=>Q,rJ:()=>ae}),v(8314);const R={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},G={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Q(oe,le,de){const se=new Date(oe.getTime());if(le&&de){const re=G[de],{getter:j,setter:Y,multiplier:ee}=re;if("months"===de){const ie=function Z(oe,le){const de=new Date(oe,le+1,1);return de.setDate(0),de.getDate()}(se.getFullYear(),se.getMonth()+le);se.getDate()>ie&&se.setDate(ie)}se[Y](se[j]()+le*ee)}return se}function W(oe,le){switch(le){case"milliseconds":return new Date(oe.getTime());case"seconds":return new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),oe.getHours(),oe.getMinutes(),oe.getSeconds());case"minutes":return new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),oe.getHours(),oe.getMinutes());case"hours":return new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),oe.getHours());case"days":return new Date(oe.getFullYear(),oe.getMonth(),oe.getDate());case"weeks":return new Date(oe.getFullYear(),oe.getMonth(),oe.getDate()-oe.getDay());case"months":return new Date(oe.getFullYear(),oe.getMonth(),1);case"years":return new Date(oe.getFullYear(),0,1);case"decades":return new Date(oe.getFullYear()-oe.getFullYear()%10,0,1);case"centuries":return new Date(oe.getFullYear()-oe.getFullYear()%100,0,1);default:return new Date}}function ae(oe,le,de){return 0===oe?0:oe*R[le]/R[de]}},55713:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ed:()=>R,Hx:()=>X,KZ:()=>W,Uc:()=>H,W0:()=>Q,Xw:()=>de,ZY:()=>te,eP:()=>Z,fS:()=>oe,lq:()=>$,qo:()=>le,tP:()=>G,xZ:()=>ae,z3:()=>B});var D=v(62208);function R(se,re){if(se.forEach)se.forEach(re);else for(let j=0;j<se.length;j++)re(se[j],j,se)}function G(se,re,j){if(se.slice)return se.slice(re,j);void 0===re?re=0:(re<0&&(re+=se.length),re=Math.min(se.length,Math.max(0,re))),void 0===j?j=se.length:(j<0&&(j+=se.length),j=Math.min(se.length,Math.max(0,j)));const Y=Math.max(0,j-re),ee=new se.constructor(Y);for(let ie=0;ie<Y;ie++)ee[ie]=se[re+ie];return ee}function Z(se){return se instanceof ArrayBuffer||se&&se.constructor&&"ArrayBuffer"===se.constructor.name}function Q(se){return se instanceof Int8Array||se&&se.constructor&&"Int8Array"===se.constructor.name}function $(se){return se instanceof Uint8Array||se&&se.constructor&&"Uint8Array"===se.constructor.name}function W(se){return se instanceof Uint8ClampedArray||se&&se.constructor&&"Uint8ClampedArray"===se.constructor.name}function B(se){return se instanceof Int16Array||se&&se.constructor&&"Int16Array"===se.constructor.name}function H(se){return se instanceof Uint16Array||se&&se.constructor&&"Uint16Array"===se.constructor.name}function X(se){return se instanceof Int32Array||se&&se.constructor&&"Int32Array"===se.constructor.name}function te(se){return se instanceof Uint32Array||se&&se.constructor&&"Uint32Array"===se.constructor.name}function ae(se){return se instanceof Float32Array||se&&se.constructor&&"Float32Array"===se.constructor.name}function oe(se){return se instanceof Float64Array||se&&se.constructor&&"Float64Array"===se.constructor.name}function le(se){const re=new Array(se.length);for(let j=0;j<se.length;j++)re[j]=se[j];return re}function de(se){return(0,D.Wi)(se)?0:128+se.buffer.byteLength+64}},86236:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>G,u:()=>R});let D=0;const R=0;function G(){return++D}},90466:(nt,Ae,v)=>{"use strict";v.d(Ae,{Rd:()=>X,Ud:()=>le,VG:()=>B,Wv:()=>ae,Zv:()=>se,sS:()=>_e});var D=v(27306),G=(v(23719),v(21286)),Z=v(77275),Q=v(16730),$=v(15348);function B(Ee,De,be,Se=2,ye="abbr"){return`${(0,$.uf)(De,{minimumFractionDigits:Se,maximumFractionDigits:Se,signDisplay:De>0?"never":"exceptZero"})} ${function W(Ee,De,be){return Ee.units[De][be]}(Ee,be,ye)}`}function X(Ee,De,be,Se=2,ye="abbr"){const ve=(0,Q.KU)(De,be);return B(Ee,(0,Q.En)(De,be,ve),ve,Se,ye)}function ae(Ee,De,be,Se=2,ye="abbr"){const ve=(0,Q.OG)(De,be);return B(Ee,(0,Q.En)(De,be,ve),ve,Se,ye)}function le(Ee,De,be,Se=2,ye="abbr"){const ve=(0,Q.FN)(De,be);return B(Ee,(0,Q.En)(De,be,ve),ve,Se,ye)}function se(Ee,De,be,Se=2,ye="abbr"){const ve=(0,Q.qv)(De,be);return B(Ee,(0,Q.En)(De,be,ve),ve,Se,ye)}const ge=["B","kB","MB","GB","TB"];function _e(Ee,De){let be=0===De?0:Math.floor(Math.log(De)/Math.log(D.Y8.KILOBYTES));be=(0,G.uZ)(be,0,ge.length-1);const Se=(0,$.uf)(De/D.Y8.KILOBYTES**be,{maximumFractionDigits:2});return(0,Z.gx)(Ee.units.bytes[ge[be]],{fileSize:Se})}},16730:(nt,Ae,v)=>{"use strict";v.d(Ae,{$C:()=>Ce,En:()=>_e,FN:()=>ve,Jo:()=>_t,KU:()=>Se,OG:()=>ye,RG:()=>et,UF:()=>pe,Yl:()=>Ke,_R:()=>Fe,c9:()=>Re,cM:()=>je,gV:()=>ut,hd:()=>B,iS:()=>Ee,j5:()=>Le,ov:()=>De,qE:()=>Pe,qv:()=>xe,tQ:()=>ze,ty:()=>We}),v(8314);var R=v(2076),G=v(62208),Z=v(12080),Q=v(94425),$=v(37053),W=v(84029);const B=39.37,H=Q.sv.radius*Math.PI/200,X=/UNIT\[([^\]]+)\]\]$/i,te=W.Z,ae=/UNIT\[([^\]]+)\]/i,oe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),le=(0,R.w)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),de=vt=>vt*vt,se=vt=>vt*vt*vt,re={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:de(.001)},"square-centimeters":{inBaseUnits:de(.01)},"square-decimeters":{inBaseUnits:de(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:de(1e3)},"square-inches":{inBaseUnits:de(.0254)},"square-feet":{inBaseUnits:de(.3048)},"square-yards":{inBaseUnits:de(.9144)},"square-miles":{inBaseUnits:de(1609.344)},"square-us-feet":{inBaseUnits:de(1200/3937)},acres:{inBaseUnits:.0015625*de(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*se(.001)},"cubic-centimeters":{inBaseUnits:1e3*se(.01)},"cubic-decimeters":{inBaseUnits:1e3*se(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*se(1e3)},"cubic-inches":{inBaseUnits:1e3*se(.0254)},"cubic-feet":{inBaseUnits:1e3*se(.3048)},"cubic-yards":{inBaseUnits:1e3*se(.9144)},"cubic-miles":{inBaseUnits:1e3*se(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},j=(()=>{const vt={};for(const Lt in re)for(const jt in re[Lt].units)vt[jt]=Lt;return vt})(),J=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function pe(vt){const Lt=j[vt];if(!Lt)throw new Error("unknown type");return Lt}function ge(vt,Lt=null){return Lt=Lt||pe(vt),re[Lt].baseUnit===vt}function _e(vt,Lt,jt){if(Lt===jt)return vt;const $t=pe(Lt);if($t!==pe(jt))throw new Error("incompatible units");const Wt=ge(Lt,$t)?vt:function Y(vt,Lt,jt){return vt*re[jt].units[Lt].inBaseUnits}(vt,Lt,$t);return ge(jt,$t)?Wt:function ee(vt,Lt,jt){return vt/re[jt].units[Lt].inBaseUnits}(Wt,jt,$t)}function Ee(vt,Lt,jt){switch(jt){case"metric":return Se(vt,Lt);case"imperial":return ve(vt,Lt);default:return jt}}function De(vt,Lt,jt){switch(jt){case"metric":return ye(vt,Lt);case"imperial":return xe(vt,Lt);default:return jt}}function Se(vt,Lt){const jt=_e(vt,Lt,"meters");return Math.abs(jt)<3e3?"meters":"kilometers"}function ye(vt,Lt){const jt=_e(vt,Lt,"meters");return Math.abs(jt)<1e5?"meters":"kilometers"}function ve(vt,Lt){const jt=_e(vt,Lt,"feet");return Math.abs(jt)<1e3?"feet":"miles"}function xe(vt,Lt){const jt=_e(vt,Lt,"feet");return Math.abs(jt)<1e5?"feet":"miles"}function ze(vt,Lt){const jt=_e(vt,Lt,"square-meters");return Math.abs(jt)<3e6?"square-meters":"square-kilometers"}function Ke(vt,Lt){const jt=_e(vt,Lt,"square-feet");return Math.abs(jt)<1e6?"square-feet":"square-miles"}function We(vt,Lt,jt){return _e(vt,Lt,"meters")/(jt*Math.PI/180)}function Ce(vt){return le.fromJSON(vt.toLowerCase())||null}function Fe(vt){if((0,G.pC)(vt)&&!(0,$.N$)(vt))return 1;const Lt=Re(vt);return Lt>1e5?1:Lt}function je(vt){return Re(vt)>=(0,Z.Iu)(vt).metersPerDegree?"meters":Pe(vt)}function Re(vt,Lt=Q.sv.metersPerDegree){return(0,G.Pt)(function He(vt,Lt=!1){const jt=(0,G.pC)(vt)?vt.wkid:null,$t=(0,G.pC)(vt)?vt.wkt:null;let Wt=null;if(jt){if((0,$.o$)(jt))return Q.yr.metersPerDegree;if((0,$.ME)(jt))return Q.Z1.metersPerDegree;Wt=te.values[te[jt]],!Wt&&Lt&&oe.has(jt)&&(Wt=H)}else $t&&(Ye($t)?Wt=Ie(X.exec($t),Wt):Xe($t)&&(Wt=Ie(ae.exec($t),Wt)));return Wt}(vt,!0),Lt)}function Ie(vt,Lt){return vt&&vt[1]?Ge(vt[1]):Lt}function Ge(vt){return parseFloat(vt.split(",")[1])}function Pe(vt){const Lt=(0,G.pC)(vt)?vt.wkid:null,jt=(0,G.pC)(vt)?vt.wkt:null;let $t=null;if(Lt)$t=te.units[te[Lt]];else if(jt){const Wt=Ye(jt)?X:Xe(jt)?ae:null;if(Wt){const pr=Wt.exec(jt);pr&&pr[1]&&($t=function rt(vt){const Lt=/[\\"\\']{1}([^\\"\\']+)/.exec(vt);let jt=Lt&&Lt[1];if(!jt||!te.units.includes(jt)){const $t=Ge(vt);jt=null;const Wt=te.values;for(let pr=0;pr<Wt.length;++pr)if(Math.abs($t-Wt[pr])<1e-7){jt=te.units[pr];break}}return jt}(pr[1]))}}return(0,G.pC)($t)?Ce($t):null}function Le(vt){const Lt=Pe(vt);return(0,G.Wi)(Lt)||!J.includes(Lt)?null:Lt}function Xe(vt){return/^GEOCCS/i.test(vt)}function Ye(vt){return/^PROJCS/i.test(vt)}function et(vt){const Lt="metric";if((0,G.Wi)(vt))return Lt;const jt=vt.map,$t=jt&&"portalItem"in jt?jt.portalItem?.portal:null;if($t)switch($t?.user?.units??$t.units){case Lt:return Lt;case"english":return"imperial"}return(0,G.Pt)(function tt(vt){const Lt=Pe(vt);if((0,G.Wi)(Lt))return null;switch(Lt){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}(vt.spatialReference),Lt)}const qe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},ot={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},ut=(0,R.w)()(qe),_t=(0,R.w)()(ot);(0,R.w)()({...qe,...ot})},21726:(nt,Ae,v)=>{"use strict";v.d(Ae,{$U:()=>jt,AH:()=>Ne,B7:()=>_e,D6:()=>Ce,Fv:()=>He,HK:()=>Me,Hu:()=>Dr,Ie:()=>dr,L:()=>ce,Ml:()=>Jr,P$:()=>Ge,PF:()=>Re,Qj:()=>Et,R9:()=>se,TI:()=>J,YP:()=>Pe,Yd:()=>or,ZN:()=>Lr,_l:()=>rt,b7:()=>Ee,ed:()=>xe,fZ:()=>Ss,fl:()=>Hr,hF:()=>je,hO:()=>gr,io:()=>qe,jc:()=>Le,kl:()=>Be,mN:()=>he,oC:()=>vt,oh:()=>We,qg:()=>De,rS:()=>Xe,sJ:()=>Je,tD:()=>ve,tm:()=>ze,u0:()=>me,v_:()=>Ie,vt:()=>sr,zd:()=>Tr});var D=v(59318),R=v(26584),G=v(63290),Z=v(62208);const Q=G.Z.getLogger("esri.core.urlUtils"),$=D.Z.request,W="esri/config: esriConfig.request.proxyUrl is not set.",B=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,H=/^\s*http:/i,X=/^\s*https:/i,te=/^\s*file:/i,ae=/:\d+$/,oe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,le=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),de=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class se{constructor(At=""){this.uri=At,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let Kt=(0,Z.j0)(this.uri.match(le));this.scheme=Kt[2]||(Kt[1]?"":null),this.authority=Kt[4]||(Kt[3]?"":null),this.path=Kt[5],this.query=Kt[7]||(Kt[6]?"":null),this.fragment=Kt[9]||(Kt[8]?"":null),null!=this.authority&&(Kt=(0,Z.j0)(this.authority.match(de)),this.user=Kt[3]||null,this.password=Kt[4]||null,this.host=Kt[6]||Kt[7],this.port=Kt[9]||null)}toString(){return this.uri}}const re={};let Y=new se(D.Z.applicationUrl);let ie=function ue(){const ct=(0,Z.j0)(Y.path),At=ct.substring(0,ct.lastIndexOf(ct.split("/")[ct.split("/").length-1]));return`${Y.scheme}://${Y.host}${null!=Y.port?`:${Y.port}`:""}${At}`}();const J=()=>Y,ce=()=>ie;function he(ct){if(!ct)return null;const At={path:null,query:null},Kt=new se(ct),tr=ct.indexOf("?");return null===Kt.query?At.path=ct:(At.path=ct.substring(0,tr),At.query=me(Kt.query)),Kt.fragment&&(At.hash=Kt.fragment,null===Kt.query&&(At.path=At.path.substring(0,At.path.length-(Kt.fragment.length+1)))),At}function me(ct){const At=ct.split("&"),Kt={};for(const tr of At){if(!tr)continue;const _r=tr.indexOf("=");let Or,gs;_r<0?(Or=decodeURIComponent(tr),gs=""):(Or=decodeURIComponent(tr.slice(0,_r)),gs=decodeURIComponent(tr.slice(_r+1)));let Kr=Kt[Or];"string"==typeof Kr&&(Kr=Kt[Or]=[Kr]),Array.isArray(Kr)?Kr.push(gs):Kt[Or]=gs}return Kt}function ge(ct){return ct&&"object"==typeof ct&&"toJSON"in ct&&"function"==typeof ct.toJSON}function _e(ct,At){return ct?At&&"function"==typeof At?Object.keys(ct).map(Kt=>encodeURIComponent(Kt)+"="+encodeURIComponent(At(Kt,ct[Kt]))).join("&"):Object.keys(ct).map(Kt=>{const tr=ct[Kt];if(null==tr)return"";const _r=encodeURIComponent(Kt)+"=",Or=At&&At[Kt];return Or?_r+encodeURIComponent(Or(tr)):Array.isArray(tr)?tr.map(gs=>ge(gs)?_r+encodeURIComponent(JSON.stringify(gs)):_r+encodeURIComponent(gs)).join("&"):ge(tr)?_r+encodeURIComponent(JSON.stringify(tr)):_r+encodeURIComponent(tr)}).filter(Kt=>Kt).join("&"):""}function Ee(ct=!1){let At,Kt=$.proxyUrl;if("string"==typeof ct){At=jt(ct);const tr=xe(ct);tr&&(Kt=tr.proxyUrl)}else At=!!ct;if(!Kt)throw Q.warn(W),new R.Z("urlutils:proxy-not-set",W);return At&&Fr()&&(Kt=gr(Kt)),he(Kt)}function De(ct){const At=xe(ct);let Kt,tr;if(At){const _r=Se(At.proxyUrl);Kt=_r.path,tr=_r.query?me(_r.query):null}if(Kt){const _r=he(ct);ct=Kt+"?"+_r.path;const Or=_e({...tr,..._r.query});Or&&(ct=`${ct}?${Or}`)}return ct}const be={path:"",query:""};function Se(ct){const At=ct.indexOf("?");return-1!==At?(be.path=ct.slice(0,At),be.query=ct.slice(At+1)):(be.path=ct,be.query=null),be}function ye(ct){return(ct=mr(ct=function rr(ct){return ct&&"/"===ct[ct.length-1]?ct:`${ct}/`}(ct=Se(ct).path),!0)).toLowerCase()}function ve(ct){const At={proxyUrl:ct.proxyUrl,urlPrefix:ye(ct.urlPrefix)},Kt=$.proxyRules,tr=At.urlPrefix;let _r=Kt.length;for(let Or=0;Or<Kt.length;Or++){const gs=Kt[Or].urlPrefix;if(0===tr.indexOf(gs)){if(tr.length===gs.length)return-1;_r=Or;break}0===gs.indexOf(tr)&&(_r=Or+1)}return Kt.splice(_r,0,At),_r}function xe(ct){const At=$.proxyRules,Kt=ye(ct);for(let tr=0;tr<At.length;tr++)if(0===Kt.indexOf(At[tr].urlPrefix))return At[tr]}function ze(ct,At){return ct=Ke(ct),At=Ke(At),mr(ct)===mr(At)}function Ke(ct){const At=(ct=He(ct)).indexOf("/sharing");return At>0?ct.substring(0,At):ct.replace(/\/+$/,"")}function We(ct){const At=tr=>null==tr||tr instanceof RegExp&&tr.test(ct)||"string"==typeof tr&&ct.startsWith(tr),Kt=$.interceptors;if(Kt)for(const tr of Kt)if(Array.isArray(tr.urls)){if(tr.urls.some(At))return tr}else if(At(tr.urls))return tr;return null}function Ce(ct,At,Kt=!1){if(!ct||!At)return!1;const tr=hr(ct),_r=hr(At);return!(!Kt&&tr.scheme!==_r.scheme)&&null!=tr.host&&null!=_r.host&&tr.host.toLowerCase()===_r.host.toLowerCase()&&tr.port===_r.port}function Be(ct){if("string"==typeof ct){if(!Pe(ct))return!0;ct=hr(ct)}if(Ce(ct,Y))return!0;const At=$.trustedServers||[];for(let Kt=0;Kt<At.length;Kt++){const tr=Fe(At[Kt]);for(let _r=0;_r<tr.length;_r++)if(Ce(ct,tr[_r]))return!0}return!1}function Fe(ct){return re[ct]||(re[ct]=Lt(ct)||vt(ct)?[new se(je(ct))]:[new se(`http://${ct}`),new se(`https://${ct}`)]),re[ct]}function je(ct,At=ie,Kt){return vt(ct)?Kt&&Kt.preserveProtocolRelative?ct:"http"===Y.scheme&&Y.authority===Ge(ct).slice(2)?`http:${ct}`:`https:${ct}`:Lt(ct)?ct:(0,Z.j0)(Ie("/"===ct[0]?function wt(ct){const At=ct.indexOf("//"),Kt=ct.indexOf("/",At+2);return-1===Kt?ct:ct.slice(0,Kt)}(At):At,ct))}function Re(ct,At=ie,Kt){if(null==ct||!Pe(ct))return ct;const tr=He(ct),_r=tr.toLowerCase(),Or=He(At).toLowerCase().replace(/\/+$/,""),gs=Kt?He(Kt).toLowerCase().replace(/\/+$/,""):null;if(gs&&0!==Or.indexOf(gs))return ct;const Kr=(fs,at,bt)=>-1===(bt=fs.indexOf(at,bt))?fs.length:bt;let qt=Kr(_r,"/",_r.indexOf("//")+2),Ir=-1;for(;_r.slice(0,qt+1)===Or.slice(0,qt)+"/"&&(Ir=qt+1,qt!==_r.length);)qt=Kr(_r,"/",qt+1);if(-1===Ir||gs&&Ir<gs.length)return ct;ct=tr.slice(Ir);const Sr=Or.slice(Ir-1).replace(/[^/]+/g,"").length;if(Sr>0)for(let fs=0;fs<Sr;fs++)ct=`../${ct}`;else ct=`./${ct}`;return ct}function He(ct){return function zt(ct){const At=$.httpsDomains;if(!function $t(ct){return null!=ct&&H.test(ct)||"http"===Y.scheme&&vt(ct)}(ct))return ct;const Kt=ct.indexOf("/",7);let tr;if(tr=-1===Kt?ct:ct.slice(0,Kt),tr=tr.toLowerCase().slice(7),ae.test(tr)){if(!tr.endsWith(":80"))return ct;tr=tr.slice(0,-3),ct=ct.replace(":80","")}return function ar(){return"http"===Y.scheme}()&&tr===Y.authority&&!oe.test(ct)||(Fr()&&tr===Y.authority||At&&At.some(_r=>tr===_r||tr.endsWith(`.${_r}`))||Fr()&&!xe(ct))&&(ct=gr(ct)),ct}(ct=function Ft(ct){return ct.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(ct=function St(ct){if(/^https?:\/\//i.test(ct)){const At=Se(ct);ct=(ct=At.path.replace(/\/{2,}/g,"/")).replace("/","//"),At.query&&(ct+=`?${At.query}`)}return ct}(ct=je(ct=ct.trim()))))}function Ie(...ct){const At=ct.filter(Z.pC);if(!At||!At.length)return;const Kt=[];if(Pe(At[0])){const _r=At[0],Or=_r.indexOf("//");-1!==Or&&(Kt.push(_r.slice(0,Or+1)),function Wt(ct){return null!=ct&&te.test(ct)}(At[0])&&(Kt[0]+="/"),At[0]=_r.slice(Or+2))}else"/"===At[0][0]&&Kt.push("");const tr=At.reduce((_r,Or)=>Or?_r.concat(Or.split("/")):_r,[]);for(let _r=0;_r<tr.length;_r++){const Or=tr[_r];".."===Or&&Kt.length>0&&".."!==Kt[Kt.length-1]?Kt.pop():(!Or&&_r===tr.length-1||Or&&("."!==Or||0===Kt.length))&&Kt.push(Or)}return Kt.join("/")}function Ge(ct,At=!1){if(null==ct||Le(ct)||Me(ct))return null;let Kt=ct.indexOf("://");if(-1===Kt&&vt(ct))Kt=2;else{if(-1===Kt)return null;Kt+=3}const tr=ct.indexOf("/",Kt);return-1!==tr&&(ct=ct.slice(0,tr)),At&&(ct=mr(ct,!0)),ct}function Pe(ct){return vt(ct)||Lt(ct)}function Le(ct){return null!=ct&&"blob:"===ct.slice(0,5)}function Me(ct){return null!=ct&&"data:"===ct.slice(0,5)}function Ne(ct){const At=Je(ct);if(!At||!At.isBase64)return null;const Kt=atob(At.data),tr=new Uint8Array(Kt.length);for(let _r=0;_r<Kt.length;_r++)tr[_r]=Kt.charCodeAt(_r);return tr.buffer}function Xe(ct){return btoa(String.fromCharCode.apply(null,ct)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const Ye=/^data:(.*?)(;base64)?,(.*)$/;function Je(ct){const At=ct.match(Ye);if(!At)return null;const[,Kt,tr,_r]=At;return{mediaType:Kt,isBase64:!!tr,data:_r}}function rt(ct){return ct.isBase64?`data:${ct.mediaType};base64,${ct.data}`:`data:${ct.mediaType},${ct.data}`}function qe(ct,At){(function ut(ct,At){if(!ct)return!1;const Kt=document.createElement("a");if(!("download"in Kt))return!1;const tr=URL.createObjectURL(ct);return Kt.download=At,Kt.href=tr,Kt.style.display="none",document.body.appendChild(Kt),Kt.click(),document.body.removeChild(Kt),URL.revokeObjectURL(tr),!0})(ct,At)||function Ct(ct,At){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(ct,At)}(ct,At)}function vt(ct){return null!=ct&&"/"===ct[0]&&"/"===ct[1]}function Lt(ct){return null!=ct&&B.test(ct)}function jt(ct){return null!=ct&&X.test(ct)||"https"===Y.scheme&&vt(ct)}function gr(ct){return vt(ct)?`https:${ct}`:ct.replace(H,"https:")}function Fr(){return"https"===Y.scheme}function mr(ct,At=!1){return vt(ct)?ct.slice(2):(ct=ct.replace(B,""),At&&ct.length>1&&"/"===ct[0]&&"/"===ct[1]&&(ct=ct.slice(2)),ct)}function or(ct){let At=0;if(Pe(ct)){const tr=ct.indexOf("//");-1!==tr&&(At=tr+2)}const Kt=ct.lastIndexOf("/");return Kt<At?ct:ct.slice(0,Kt+1)}function sr(ct,At){if(!ct)return"";const Kt=he(ct).path.replace(/\/+$/,""),tr=Kt.substring(Kt.lastIndexOf("/")+1);if(!At?.length)return tr;const _r=new RegExp(`.(${At.join("|")})$`,"ig");return tr.replace(_r,"")}function Et(ct){return ct.replace(/\/+$/,"")}function dr(ct,At,Kt){if(!(At&&Kt&&ct&&Pe(ct)))return ct;const tr=ct.indexOf("//"),_r=ct.indexOf("/",tr+2),Or=ct.indexOf(":",tr+2),gs=Math.min(_r<0?ct.length:_r,Or<0?ct.length:Or);return ct.slice(tr+2,gs).toLowerCase()!==At.toLowerCase()?ct:`${ct.slice(0,tr+2)}${Kt}${ct.slice(gs)}`}function hr(ct){return"string"==typeof ct?new se(je(ct)):(ct.scheme||(ct.scheme=Y.scheme),ct)}function Tr(ct){return Dt.test(ct)}function Dr(ct,At){const Kt=he(ct),tr=Object.keys(Kt.query||{});return tr.length>0&&At&&At.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${tr.join(", ")}.`),Kt.path}function Lr(ct,At,Kt){const tr=he(ct),_r=tr.query||{};return _r[At]=String(Kt),`${tr.path}?${_e(_r)}`}function Hr(ct,At){const Kt=he(ct),tr=Kt.query||{};for(const Or in At)tr[Or]=At[Or];const _r=_e(tr);return _r?`${Kt.path}?${_r}`:Kt.path}function Jr(ct){if((0,Z.Wi)(ct))return null;const At=ct.match(Cs);return At?At[2]:null}function Ss(ct){if((0,Z.Wi)(ct))return null;const At=ct.match(Cs);return At?{path:At[1],extension:At[2]}:{path:ct,extension:null}}const Cs=/([^.]*)\.([^\/]*)$/,Dt=/(^data:image\/svg|\.svg$)/i},35948:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>R});const D="randomUUID"in crypto;function R(){if(D)return crypto.randomUUID();const G=crypto.getRandomValues(new Uint16Array(8));G[3]=4095&G[3]|16384,G[4]=16383&G[4]|32768;const Z=Q=>G[Q].toString(16).padStart(4,"0");return Z(0)+Z(1)+"-"+Z(2)+"-"+Z(3)+"-"+Z(4)+"-"+Z(5)+Z(6)+Z(7)}},93662:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>$});var D=v(54024),R=v(63290),G=v(10699),Z=v(35133),Q=v(89951);class ${constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Z.Z}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(B,H){return new Promise((X,te)=>{let ae=!0;const oe=le=>{(0,G.k_)(H.signal),ae&&(ae=!1,le())};this._clients.length=B.length,this._clientPromises.length=B.length,this._inUseClients.length=B.length;for(let le=0;le<B.length;++le){const de=B[le];(0,G.y8)(de)?this._clientPromises[le]=de.then(se=>(this._clients[le]=new Q.Z(se,H,()=>this._ongoingJobsQueue.pop()??null),oe(X),this._clients[le]),()=>(oe(te),null)):(this._clients[le]=new Q.Z(de,H,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[le]=Promise.resolve(this._clients[le]),oe(X))}})}broadcast(B,H,X){const te=new Array(this._clientPromises.length);for(let ae=0;ae<this._clientPromises.length;++ae)te[ae]=this._clientPromises[ae].then(le=>le?.invoke(B,H,X));return te}close(){let B;for(;B=this._ongoingJobsQueue.pop();)B.deferred.reject((0,G.zE)(`Worker closing, aborting job calling '${B.methodName}'`));for(const H of this._clientPromises)H.then(X=>X?.close());this._clients.length=0,this._clientPromises.length=0}invoke(B,H,X){let te;Array.isArray(X)?(R.Z.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),te={transferList:X}):te=X;const ae=(0,G.dD)();this._ongoingJobsQueue.push({methodName:B,data:H,invokeOptions:te,deferred:ae});for(let oe=0;oe<this._clientPromises.length;oe++){const le=this._clients[oe];le?le.jobAdded():this._clientPromises[oe].then(de=>de?.jobAdded())}return ae.promise}on(B,H){return Promise.all(this._clientPromises).then(()=>(0,D.AL)(this._clients.map(X=>X.on(B,H))))}openPorts(){return new Promise(B=>{const H=new Array(this._clientPromises.length);let X=H.length;for(let te=0;te<this._clientPromises.length;++te)this._clientPromises[te].then(ae=>{ae&&(H[te]=ae.openPort()),0==--X&&B(H)})})}get test(){return{numClients:this._clients.length}}}},89951:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>re});var D=v(24263),R=v(26584),G=v(17770),Z=v(62208),Q=v(10699),$=v(13126),W=v(38365);const B={statsWorker:()=>Promise.all([v.e(6072),v.e(4135)]).then(v.bind(v,44135)),geometryEngineWorker:()=>Promise.all([v.e(4918),v.e(8592),v.e(1843)]).then(v.bind(v,77692)),CSVSourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(8592),v.e(9155)]).then(v.bind(v,39155)),EdgeProcessingWorker:()=>v.e(1563).then(v.bind(v,81563)),ElevationSamplerWorker:()=>Promise.all([v.e(8592),v.e(8149)]).then(v.bind(v,28149)),FeatureServiceSnappingSourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(8592),v.e(6354)]).then(v.bind(v,86354)),GeoJSONSourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(8592),v.e(4079)]).then(v.bind(v,84079)),LercWorker:()=>v.e(7300).then(v.bind(v,57300)),MemorySourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(8592),v.e(7728)]).then(v.bind(v,7728)),PBFDecoderWorker:()=>v.e(4287).then(v.bind(v,84287)),Pipeline:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(9372),v.e(9628),v.e(8592),v.e(1288)]).then(v.bind(v,11288)),PointCloudWorker:()=>Promise.all([v.e(4471),v.e(4056)]).then(v.bind(v,44056)),RasterWorker:()=>Promise.all([v.e(1533),v.e(8594),v.e(6455),v.e(5976)]).then(v.bind(v,15976)),SceneLayerSnappingSourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(1269)]).then(v.bind(v,21269)),SceneLayerWorker:()=>v.e(375).then(v.bind(v,30375)),WFSSourceWorker:()=>Promise.all([v.e(410),v.e(6072),v.e(3308),v.e(3464),v.e(3774),v.e(8592),v.e(2305)]).then(v.bind(v,62305)),WorkerTileHandler:()=>Promise.all([v.e(3751),v.e(8364),v.e(4522),v.e(195)]).then(v.bind(v,90195))},{CLOSE:H,ABORT:X,INVOKE:te,RESPONSE:ae,OPEN_PORT:oe,ON:le}=$.Cs;class se{constructor(Y){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=Y,this._timer=null,this._process=this._process.bind(this)}push(Y){Y.type===$.Cs.ABORT?this._cancelledJobIds.add(Y.jobId):(this._invokeMessages.push(Y),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const Y of this._invokeMessages)this._cancelledJobIds.has(Y.jobId)||this._invoke(Y);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class re{constructor(Y,ee,ie){this._port=Y,this._getNextJob=ie,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new se(J=>this._onInvokeMessage(J)),this._client=ee.client,this._onMessage=this._onMessage.bind(this),this._channel=ee.channel,this._schedule=ee.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(Y){const ee=new MessageChannel;let ie;ie="function"==typeof Y?new Y:"default"in Y&&"function"==typeof Y.default?new Y.default:Y;const J=new re(ee.port1,{channel:ee,client:ie},()=>null);return"object"==typeof ie&&"remoteClient"in ie&&(ie.remoteClient=J),re.clients.set(J,ie),ee.port2}static loadWorker(Y){const ee=B[Y];return ee?ee():Promise.resolve(null)}close(){this._post({type:H}),this._close()}isBusy(){return this._outJobs.size>0}invoke(Y,ee,ie){const J=ie&&ie.signal,ce=ie&&ie.transferList;if(!this._port)return Promise.reject(new R.Z("worker:port-closed",`Cannot call invoke('${Y}'), port is closed`,{methodName:Y,data:ee}));const ue=(0,$.jt)();return new Promise((pe,he)=>{if((0,Q.Hc)(J))return this._processWork(),void he((0,Q.zE)());const me=(0,Q.fu)(J,()=>{const _e=this._outJobs.get(ue);_e&&(this._outJobs.delete(ue),this._processWork(),(0,Z.hw)(_e.abortHandle),this._post({type:X,jobId:ue}),he((0,Q.zE)()))});this._outJobs.set(ue,{resolve:pe,reject:he,abortHandle:me,debugInfo:Y}),this._post({type:te,jobId:ue,methodName:Y,abortable:null!=J},ee,ce)})}on(Y,ee){const ie=new MessageChannel;function J(ce){ee(ce.data)}return this._port.postMessage({type:$.Cs.ON,eventType:Y,port:ie.port2},[ie.port2]),ie.port1.addEventListener("message",J),ie.port1.start(),{remove(){ie.port1.postMessage({type:$.Cs.CLOSE}),ie.port1.close(),ie.port1.removeEventListener("message",J)}}}jobAdded(){this._processWork()}openPort(){const Y=new MessageChannel;return this._post({type:oe,port:Y.port2}),Y.port1}_processWork(){if(this._outJobs.size>=2)return;const Y=this._getNextJob();if(!Y)return;const{methodName:ee,data:ie,invokeOptions:J,deferred:ce}=Y;this.invoke(ee,ie,J).then(ue=>ce.resolve(ue)).catch(ue=>ce.reject(ue))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(Y=>{(0,Z.hw)(Y.abortHandle),Y.reject((0,Q.zE)(`Worker closing, aborting job calling '${Y.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(Y){(0,Z.pC)(this._schedule)?this._schedule(()=>this._processMessage(Y)):this._processMessage(Y)}_processMessage(Y){const ee=(0,$.QM)(Y);if(ee)switch(ee.type){case ae:this._onResponseMessage(ee);break;case te:this._invokeQueue.push(ee);break;case X:this._onAbortMessage(ee);break;case H:this._onCloseMessage();break;case oe:this._onOpenPortMessage(ee);break;case le:this._onOnMessage(ee)}}_onAbortMessage(Y){const ee=this._inJobs,ie=Y.jobId,J=ee.get(ie);this._invokeQueue.push(Y),J&&(J.controller&&J.controller.abort(),ee.delete(ie))}_onCloseMessage(){const Y=this._client;this._close(),Y&&"destroy"in Y&&re.clients.get(this)===Y&&Y.destroy(),re.clients.delete(this),Y&&Y.remoteClient&&(Y.remoteClient=null)}_onInvokeMessage(Y){const{methodName:ee,jobId:ie,data:J,abortable:ce}=Y,ue=ce?new AbortController:null,pe=this._inJobs;let he,me=this._client,ge=me[ee];try{if(!ge&&ee&&ee.includes(".")){const _e=ee.split(".");for(let Ee=0;Ee<_e.length-1;Ee++)me=me[_e[Ee]],ge=me[_e[Ee+1]]}if("function"!=typeof ge)throw new TypeError(`${ee} is not a function`);he=ge.call(me,J,{client:this,signal:ue?ue.signal:null})}catch(_e){return void this._post({type:ae,jobId:ie,error:(0,$.AB)(_e)})}(0,Q.y8)(he)?(pe.set(ie,{controller:ue,promise:he}),he.then(_e=>{pe.has(ie)&&(pe.delete(ie),this._post({type:ae,jobId:ie},_e))},_e=>{pe.has(ie)&&(pe.delete(ie),(0,Q.D_)(_e)||this._post({type:ae,jobId:ie,error:(0,$.AB)(_e||{message:`Error encountered at method ${ee}`})}))})):this._post({type:ae,jobId:ie},he)}_onOpenPortMessage(Y){new re(Y.port,{client:this._client},()=>null)}_onOnMessage(Y){const{port:ee}=Y,ie=this._client.on(Y.eventType,ce=>{ee.postMessage(ce)}),J=(0,G.on)(Y.port,"message",ce=>{(0,$.QM)(ce)?.type===$.Cs.CLOSE&&(J.remove(),ie.remove(),ee.close())})}_onResponseMessage(Y){const{jobId:ee,error:ie,data:J}=Y,ce=this._outJobs;if(!ce.has(ee))return;const ue=ce.get(ee);ce.delete(ee),this._processWork(),(0,Z.hw)(ue.abortHandle),ie?ue.reject(R.Z.fromJSON(JSON.parse(ie))):ue.resolve(J)}_post(Y,ee,ie){return(0,$.oi)(this._port,Y,ee,ie)}}re.kernelInfo={revision:W.$,version:D.i8,buildDate:W.r},re.clients=new Map},42930:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>W});var D=v(85931),R=v(54024),G=v(63290),Z=v(62208),Q=v(10699),$=v(59289);class W{constructor(H,X,te,ae,oe={}){this._mainMethod=X,this._transferLists=te,this._listeners=[],this._promise=(0,$.bA)(H,{...oe,schedule:ae}).then(le=>{if(void 0===this._thread){this._thread=le,this._promise=null,oe.hasInitialize&&this.broadcast({},"initialize");for(const de of this._listeners)this._connectListener(de)}else le.close()}),this._promise.catch(le=>G.Z.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${H} worker: ${le}`))}on(H,X){const te={removed:!1,eventName:H,callback:X,threadHandle:null};return this._listeners.push(te),this._connectListener(te),(0,R.kB)(()=>{te.removed=!0,(0,D.Od)(this._listeners,te),this._thread&&(0,Z.pC)(te.threadHandle)&&te.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(H,X){return this.invokeMethod(this._mainMethod,H,X)}invokeMethod(H,X,te){if(this._thread){const ae=this._transferLists[H],oe=ae?ae(X):[];return this._thread.invoke(H,X,{transferList:oe,signal:te})}return this._promise?this._promise.then(()=>((0,Q.k_)(te),this.invokeMethod(H,X,te))):Promise.reject(null)}broadcast(H,X){return this._thread?Promise.all(this._thread.broadcast(X,H)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(H,X)):Promise.reject()}get promise(){return this._promise}_connectListener(H){this._thread&&this._thread.on(H.eventName,H.callback).then(X=>{H.removed||(H.threadHandle=X)})}}},13126:(nt,Ae,v)=>{"use strict";v.d(Ae,{AB:()=>$,Cs:()=>R,QM:()=>B,jt:()=>Z,oi:()=>W});var R,te,D=v(8314);(te=R||(R={}))[te.HANDSHAKE=0]="HANDSHAKE",te[te.OPEN=1]="OPEN",te[te.OPENED=2]="OPENED",te[te.RESPONSE=3]="RESPONSE",te[te.INVOKE=4]="INVOKE",te[te.ABORT=5]="ABORT",te[te.CLOSE=6]="CLOSE",te[te.OPEN_PORT=7]="OPEN_PORT",te[te.ON=8]="ON";let G=0;function Z(){return G++}function $(te){return te?"string"==typeof te?JSON.stringify({name:"message",message:te}):te.toJSON?JSON.stringify(te):JSON.stringify({name:te.name,message:te.message,details:te.details||{stack:te.stack}}):null}function W(te,ae,oe,le){if(ae.type===R.OPEN_PORT)return void te.postMessage(ae,[ae.port]);if(ae.type!==R.INVOKE&&ae.type!==R.RESPONSE)return void te.postMessage(ae);let de;if(function Q(te){return te&&"object"==typeof te&&("result"in te||"transferList"in te)}(oe)?(de=H(oe.transferList),ae.data=oe.result):(de=H(le),ae.data=oe),de){if((0,D.Z)("ff"))for(const se of de)if("byteLength"in se&&se.byteLength>267386880){const re="Worker call with large ArrayBuffer would crash Firefox";switch(ae.type){case R.INVOKE:throw re;case R.RESPONSE:return void W(te,{type:R.RESPONSE,jobId:ae.jobId,error:$(re)})}}te.postMessage(ae,de)}else te.postMessage(ae)}function B(te){if(!te)return null;const ae=te.data;return ae?"string"==typeof ae?JSON.parse(ae):ae:null}function H(te){if(!te||!te.length)return null;if((0,D.Z)("esri-workers-arraybuffer-transfer"))return te;const ae=te.filter(oe=>!function X(te){return te instanceof ArrayBuffer||te&&te.constructor&&"ArrayBuffer"===te.constructor.name}(oe));return ae.length?ae:null}},59289:(nt,Ae,v)=>{"use strict";v.d(Ae,{j2:()=>He,bA:()=>Le});var D=v(15861),R=v(26584),G=v(8314),Z=v(10699),Q=v(93662),$=v(89951),W=v(24263),B=v(63290),H=v(62208),X=v(13126),te=v(54346),ae=v(59318),le=(v(52515),v(21726));const se={};var Y=v(79682);class ee{constructor(){const et=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(qe=>{this[qe]=(...ot)=>et[qe](...ot)})}}class ie{constructor(){this._dispatcher=new ee,this._workerPostMessage({type:X.Cs.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(et){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=et,et&&this.addEventListener("message",et)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(et){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=et,et&&this.addEventListener("messageerror",et)}get onerror(){return this._onerrorHandler}set onerror(et){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=et,et&&this.addEventListener("error",et)}postMessage(et){(0,Y.Y)(()=>{this._workerMessageHandler(new MessageEvent("message",{data:et}))})}dispatchEvent(et){return this._dispatcher.dispatchEvent(et)}addEventListener(et,qe,ot){this._dispatcher.addEventListener(et,qe,ot)}removeEventListener(et,qe,ot){this._dispatcher.removeEventListener(et,qe,ot)}_workerPostMessage(et){(0,Y.Y)(()=>{this.dispatchEvent(new MessageEvent("message",{data:et}))})}_workerMessageHandler(et){var qe=this;return(0,D.Z)(function*(){const ot=(0,X.QM)(et);if(ot&&ot.type===X.Cs.OPEN){const{modulePath:ut,jobId:_t}=ot;let Ct=yield $.Z.loadWorker(ut);Ct||(Ct=yield import(ut));const vt=$.Z.connect(Ct);qe._workerPostMessage({type:X.Cs.OPENED,jobId:_t,data:vt})}})()}}var J=v(56683),ce=v(38365);const ue=B.Z.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:pe}=X.Cs,he='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let me,ge;const _e="Failed to create Worker. Fallback to execute module in main thread";function De(){return(De=(0,D.Z)(function*(){if(!(0,G.Z)("esri-workers")||((0,G.Z)("mozilla"),0))return be(new ie);if(!me&&!ge)try{const et=he.split('"{CONFIGURATION}"').join(`'${ye()}'`);me=URL.createObjectURL(new Blob([et],{type:"text/javascript"}))}catch(et){ge=et||{}}let tt;if(me)try{tt=new Worker(me,{name:"esri-worker-"+ve++})}catch{ue.warn(_e,ge),tt=new ie}else ue.warn(_e,ge),tt=new ie;return be(tt)})).apply(this,arguments)}function be(tt){return Se.apply(this,arguments)}function Se(){return(Se=(0,D.Z)(function*(tt){return new Promise(et=>{function qe(ut){const _t=(0,X.QM)(ut);_t&&_t.type===pe&&(tt.removeEventListener("message",qe),tt.removeEventListener("error",ot),et(tt))}function ot(ut){ut.preventDefault(),tt.removeEventListener("message",qe),tt.removeEventListener("error",ot),ue.warn("Failed to create Worker. Fallback to execute module in main thread",ut),(tt=new ie).addEventListener("message",qe),tt.addEventListener("error",ot)}tt.addEventListener("message",qe),tt.addEventListener("error",ot)})})).apply(this,arguments)}function ye(){let tt;if(null!=ae.Z.default){const ut={...ae.Z};delete ut.default,tt=JSON.parse(JSON.stringify(ut))}else tt=JSON.parse(JSON.stringify(ae.Z));tt.assetsPath=(0,le.hF)(tt.assetsPath),tt.defaultAssetsPath=tt.defaultAssetsPath?(0,le.hF)(tt.defaultAssetsPath):void 0,tt.request.interceptors=[],tt.log.interceptors=[],tt.locale=(0,J.Kd)(),tt.has={"esri-csp-restrictions":(0,G.Z)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,G.Z)("esri-2d-update-debug"),"featurelayer-pbf":(0,G.Z)("featurelayer-pbf"),"featurelayer-simplify-thresholds":(0,G.Z)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,G.Z)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,G.Z)("featurelayer-simplify-mobile-factor"),"esri-atomics":(0,G.Z)("esri-atomics"),"esri-shared-array-buffer":(0,G.Z)("esri-shared-array-buffer"),"esri-tiles-debug":(0,G.Z)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,G.Z)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,G.Z)("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":(0,G.Z)("polylabel-placement-enabled")},tt.workers.loaderUrl&&(tt.workers.loaderUrl=(0,le.hF)(tt.workers.loaderUrl)),tt.workers.workerPath=(0,le.hF)(tt.workers.workerPath?tt.workers.workerPath:(0,te.V)("esri/core/workers/RemoteClient.js")),tt.workers.useDynamicImport=!1;const et=ae.Z.workers.loaderConfig,qe=function j(tt){const et={async:tt.async,isDebug:tt.isDebug,locale:tt.locale,baseUrl:tt.baseUrl,has:{...tt.has},map:{...tt.map},packages:tt.packages&&tt.packages.concat()||[],paths:{...tt.paths}};return tt.hasOwnProperty("async")||(et.async=!0),tt.hasOwnProperty("isDebug")||(et.isDebug=!1),tt.baseUrl||(et.baseUrl=se.baseUrl),se.packages?.forEach(qe=>{!function re(tt,et){for(const qe of tt)if(qe.name===et.name)return;tt.push(et)}(et.packages??[],qe)}),et}({baseUrl:et?.baseUrl,locale:(0,J.Kd)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...et?.has},map:{...et?.map},paths:{...et?.paths},packages:et?.packages||[]});return JSON.stringify({esriConfig:tt,loaderConfig:qe,kernelInfo:{version:W.i8,buildDate:ce.r,revision:ce.$}})}let ve=0;const{ABORT:xe,INVOKE:ze,OPEN:Ke,OPENED:We,RESPONSE:Ce}=X.Cs;class Be{constructor(et,qe){this._outJobs=new Map,this._inJobs=new Map,this.worker=et,this.id=qe,et.addEventListener("message",this._onMessage.bind(this)),et.addEventListener("error",ot=>{ot.preventDefault(),B.Z.getLogger("esri.core.workers.WorkerOwner").error(ot)})}static create(et){return(0,D.Z)(function*(){const qe=yield function Ee(){return De.apply(this,arguments)}();return new Be(qe,et)})()}terminate(){this.worker.terminate()}open(et,qe={}){var ot=this;return(0,D.Z)(function*(){const{signal:ut}=qe,_t=(0,X.jt)();return new Promise((Ct,vt)=>{const Lt={resolve:Ct,reject:vt,abortHandle:(0,Z.$F)(ut,()=>{ot._outJobs.delete(_t),ot._post({type:xe,jobId:_t})})};ot._outJobs.set(_t,Lt),ot._post({type:Ke,jobId:_t,modulePath:et})})})()}_onMessage(et){const qe=(0,X.QM)(et);if(qe)switch(qe.type){case We:this._onOpenedMessage(qe);break;case Ce:this._onResponseMessage(qe);break;case xe:this._onAbortMessage(qe);break;case ze:this._onInvokeMessage(qe)}}_onAbortMessage(et){const qe=this._inJobs,ot=et.jobId,ut=qe.get(ot);ut&&(ut.controller&&ut.controller.abort(),qe.delete(ot))}_onInvokeMessage(et){const{methodName:qe,jobId:ot,data:ut,abortable:_t}=et,Ct=_t?new AbortController:null,vt=this._inJobs,Lt=W.Nv[qe];let jt;try{if("function"!=typeof Lt)throw new TypeError(`${qe} is not a function`);jt=Lt.call(null,ut,{signal:Ct?Ct.signal:null})}catch($t){return void this._post({type:Ce,jobId:ot,error:(0,X.AB)($t)})}(0,Z.y8)(jt)?(vt.set(ot,{controller:Ct,promise:jt}),jt.then($t=>{vt.has(ot)&&(vt.delete(ot),this._post({type:Ce,jobId:ot},$t))},$t=>{vt.has(ot)&&(vt.delete(ot),$t||($t={message:"Error encountered at method"+qe}),(0,Z.D_)($t)||this._post({type:Ce,jobId:ot,error:(0,X.AB)($t||{message:`Error encountered at method ${qe}`})}))})):this._post({type:Ce,jobId:ot},jt)}_onOpenedMessage(et){const{jobId:qe,data:ot}=et,ut=this._outJobs.get(qe);ut&&(this._outJobs.delete(qe),(0,H.hw)(ut.abortHandle),ut.resolve(ot))}_onResponseMessage(et){const{jobId:qe,error:ot,data:ut}=et,_t=this._outJobs.get(qe);_t&&(this._outJobs.delete(qe),(0,H.hw)(_t.abortHandle),ot?_t.reject(R.Z.fromJSON(JSON.parse(ot))):_t.resolve(ut))}_post(et,qe,ot){return(0,X.oi)(this.worker,et,qe,ot)}}let Fe=(0,G.Z)("esri-workers-debug")?1:(0,G.Z)("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):(0,G.Z)("host-browser")?navigator.hardwareConcurrency-1:0;Fe||(Fe=(0,G.Z)("safari")&&(0,G.Z)("mac")||(0,G.Z)("trident")?7:2);let je=0;const Re=[];function He(){Je()}function Ge(tt,et){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,D.Z)(function*(tt,et){const qe=new Q.Z;return yield qe.open(tt,et),qe})).apply(this,arguments)}function Le(tt){return Me.apply(this,arguments)}function Me(){return(Me=(0,D.Z)(function*(tt,et={}){if("string"!=typeof tt)throw new R.Z("workers:undefined-module","modulePath is missing");let qe=et.strategy||"distributed";if((0,G.Z)("host-webworker")&&!(0,G.Z)("esri-workers")&&(qe="local"),"local"===qe){let ot=yield $.Z.loadWorker(tt);ot||(ot=yield import(tt)),(0,Z.k_)(et.signal);const ut=et.client||ot;return Ge([$.Z.connect(ot)],{...et,client:ut})}if(yield Je(),(0,Z.k_)(et.signal),"dedicated"===qe){const ot=je++%Fe;return Ge([yield Re[ot].open(tt,et)],et)}if(et.maxNumWorkers&&et.maxNumWorkers>0){const ot=Math.min(et.maxNumWorkers,Fe);if(ot<Fe){const ut=new Array(ot);for(let _t=0;_t<ot;++_t){const Ct=je++%Fe;ut[_t]=Re[Ct].open(tt,et)}return Ge(ut,et)}}return Ge(Re.map(ot=>ot.open(tt,et)),et)})).apply(this,arguments)}let Xe,Ye=null;function Je(){return rt.apply(this,arguments)}function rt(){return(rt=(0,D.Z)(function*(){if(Ye)return Ye;Xe=new AbortController;const tt=[];for(let et=0;et<Fe;et++){const qe=Be.create(et).then(ot=>(Re[et]=ot,ot));tt.push(qe)}return Ye=Promise.all(tt),Ye})).apply(this,arguments)}},27402:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>gr});var te,D=v(17626),R=v(86810),G=v(58817),Z=v(77712),Q=v(66656),$=v(68653),W=v(76898),B=v(99433),X=(v(85931),v(90912));let ae=te=class extends R.wq{constructor(ar){super(ar),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new te({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ae.prototype,"expression",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ae.prototype,"name",void 0),(0,D._)([(0,Z.Cb)({type:["boolean","date","number","string"],json:{write:!0}})],ae.prototype,"returnType",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ae.prototype,"title",void 0),ae=te=(0,D._)([(0,W.j)("esri.form.ExpressionInfo")],ae);const oe=ae;let le=class extends R.wq{constructor(ar){super(ar),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],le.prototype,"description",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],le.prototype,"label",void 0),(0,D._)([(0,Z.Cb)()],le.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],le.prototype,"visibilityExpression",void 0),le=(0,D._)([(0,W.j)("esri.form.elements.Element")],le);const de=le;var se;let re=se=class extends R.wq{constructor(ar){super(ar),this.type=null}clone(){return new se({type:this.type})}};(0,D._)([(0,Z.Cb)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],re.prototype,"type",void 0),re=se=(0,D._)([(0,W.j)("esri.form.elements.inputs.AttachmentInput")],re);const j=re;var Y;let ee=Y=class extends de{constructor(ar){super(ar),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new Y({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ee.prototype,"attachmentKeyword",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"editable",void 0),(0,D._)([(0,Z.Cb)({type:j,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ee.prototype,"input",void 0),(0,D._)([(0,Z.Cb)({type:["attachment"],json:{read:!1,write:!0}})],ee.prototype,"type",void 0),ee=Y=(0,D._)([(0,W.j)("esri.form.elements.AttachmentElement")],ee);const ie=ee;let J=class extends R.wq{constructor(ar){super(ar),this.type=null}};(0,D._)([(0,Z.Cb)()],J.prototype,"type",void 0),J=(0,D._)([(0,W.j)("esri.form.elements.inputs.Input")],J);const ce=J;let ue=class extends ce{constructor(ar){super(ar),this.maxLength=null,this.minLength=0}};(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ue.prototype,"maxLength",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ue.prototype,"minLength",void 0),ue=(0,D._)([(0,W.j)("esri.form.elements.inputs.TextInput")],ue);const pe=ue;var he;let me=he=class extends pe{constructor(ar){super(ar),this.type="barcode-scanner"}clone(){return new he({maxLength:this.maxLength,minLength:this.minLength})}};(0,D._)([(0,Z.Cb)({type:["barcode-scanner"],json:{read:!1,write:!0}})],me.prototype,"type",void 0),me=he=(0,D._)([(0,W.j)("esri.form.elements.inputs.BarcodeScannerInput")],me);const ge=me;var _e;let Ee=_e=class extends ce{constructor(ar){super(ar),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new _e({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Ee.prototype,"noValueOptionLabel",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],Ee.prototype,"showNoValueOption",void 0),(0,D._)([(0,Z.Cb)({type:["combo-box"],json:{read:!1,write:!0}})],Ee.prototype,"type",void 0),Ee=_e=(0,D._)([(0,W.j)("esri.form.elements.inputs.ComboBoxInput")],Ee);const De=Ee;var be;function Se(ar){return null!=ar?new Date(ar):null}function ye(ar){return ar?ar.getTime():null}let ve=be=class extends ce{constructor(ar){super(ar),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(ar,Fr){return Se(Fr.max)}writeMax(ar,Fr){Fr.max=ye(ar)}readMin(ar,Fr){return Se(Fr.min)}writeMin(ar,Fr){Fr.min=ye(ar)}clone(){return new be({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],ve.prototype,"includeTime",void 0),(0,D._)([(0,Z.Cb)({type:Date,json:{type:Number,write:!0}})],ve.prototype,"max",void 0),(0,D._)([(0,$.r)("max")],ve.prototype,"readMax",null),(0,D._)([(0,B.c)("max")],ve.prototype,"writeMax",null),(0,D._)([(0,Z.Cb)({type:Date,json:{type:Number,write:!0}})],ve.prototype,"min",void 0),(0,D._)([(0,$.r)("min")],ve.prototype,"readMin",null),(0,D._)([(0,B.c)("min")],ve.prototype,"writeMin",null),(0,D._)([(0,Z.Cb)({type:["datetime-picker"],json:{read:!1,write:!0}})],ve.prototype,"type",void 0),ve=be=(0,D._)([(0,W.j)("esri.form.elements.inputs.DateTimePickerInput")],ve);const xe=ve;var ze;let Ke=ze=class extends ce{constructor(ar){super(ar),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new ze({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Ke.prototype,"noValueOptionLabel",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],Ke.prototype,"showNoValueOption",void 0),(0,D._)([(0,Z.Cb)({type:["radio-buttons"],json:{read:!1,write:!0}})],Ke.prototype,"type",void 0),Ke=ze=(0,D._)([(0,W.j)("esri.form.elements.inputs.RadioButtonsInput")],Ke);const We=Ke;var Ce;let Be=Ce=class extends ce{constructor(ar){super(ar),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Ce({offValue:this.offValue,onValue:this.onValue})}};(0,D._)([(0,Z.Cb)({type:[String,Number],json:{write:!0}})],Be.prototype,"offValue",void 0),(0,D._)([(0,Z.Cb)({type:[String,Number],json:{write:!0}})],Be.prototype,"onValue",void 0),(0,D._)([(0,Z.Cb)({type:["switch"],json:{read:!1,write:!0}})],Be.prototype,"type",void 0),Be=Ce=(0,D._)([(0,W.j)("esri.form.elements.inputs.SwitchInput")],Be);const Fe=Be;var je;let Re=je=class extends pe{constructor(ar){super(ar),this.type="text-area"}clone(){return new je({maxLength:this.maxLength,minLength:this.minLength})}};(0,D._)([(0,Z.Cb)({type:["text-area"],json:{read:!1,write:!0}})],Re.prototype,"type",void 0),Re=je=(0,D._)([(0,W.j)("esri.form.elements.inputs.TextAreaInput")],Re);const He=Re;var Ie;let Ge=Ie=class extends pe{constructor(ar){super(ar),this.type="text-box"}clone(){return new Ie({maxLength:this.maxLength,minLength:this.minLength})}};(0,D._)([(0,Z.Cb)({type:["text-box"],json:{read:!1,write:!0}})],Ge.prototype,"type",void 0),Ge=Ie=(0,D._)([(0,W.j)("esri.form.elements.inputs.TextBoxInput")],Ge);const Le={base:ce,key:"type",typeMap:{"barcode-scanner":ge,"combo-box":De,"datetime-picker":xe,"radio-buttons":We,switch:Fe,"text-area":He,"text-box":Ge}};var Ne,Me=v(67945);let Xe=Ne=class extends de{constructor(ar){super(ar),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new Ne({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};(0,D._)([(0,Z.Cb)({types:Me.V5,json:{read:{reader:Me.im},write:!0}})],Xe.prototype,"domain",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],Xe.prototype,"editable",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Xe.prototype,"editableExpression",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Xe.prototype,"fieldName",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Xe.prototype,"hint",void 0),(0,D._)([(0,Z.Cb)({types:Le,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Xe.prototype,"input",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Xe.prototype,"requiredExpression",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{read:!1,write:!0}})],Xe.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],Xe.prototype,"valueExpression",void 0),Xe=Ne=(0,D._)([(0,W.j)("esri.form.elements.FieldElement")],Xe);const Ye=Xe;var rt,Je=v(51686);let tt=rt=class extends de{constructor(ar){super(ar),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new rt({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:(0,G.d9)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],tt.prototype,"displayCount",void 0),(0,D._)([(0,Z.Cb)({type:["list"],json:{write:!0}})],tt.prototype,"displayType",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],tt.prototype,"editable",void 0),(0,D._)([(0,Z.Cb)({type:[Je.Z],json:{write:!0}})],tt.prototype,"orderByFields",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],tt.prototype,"relationshipId",void 0),(0,D._)([(0,Z.Cb)({type:["relationship"],json:{read:!1,write:!0}})],tt.prototype,"type",void 0),tt=rt=(0,D._)([(0,W.j)("esri.form.elements.RelationshipElement")],tt);const et=tt;function qe(ar){return{typesWithGroup:{base:de,key:"type",typeMap:{attachment:ie,field:Ye,group:ar,relationship:et}},typesWithoutGroup:{base:de,key:"type",typeMap:{attachment:ie,field:Ye,relationship:et}}}}function ot(ar,Fr,mr=!0){if(!ar)return null;const wt=mr?Fr.typesWithGroup.typeMap:Fr.typesWithoutGroup.typeMap;return ar.filter(or=>wt[or.type]).map(or=>wt[or.type].fromJSON(or))}function ut(ar,Fr,mr=!0){if(!ar)return null;const wt=mr?Fr.typesWithGroup.typeMap:Fr.typesWithoutGroup.typeMap;return ar.filter(or=>wt[or.type]).map(or=>or.toJSON())}function _t(ar,Fr,mr=!0){return ar?ar.map(wt=>(0,X.N7)(mr?Fr.typesWithGroup:Fr.typesWithoutGroup,wt)):null}var Ct;let vt=Ct=class extends de{constructor(ar){super(ar),this.elements=null,this.initialState="expanded",this.type="group"}castElements(ar){return _t(ar,Lt,!1)}readElements(ar,Fr){return ot(Fr.formElements,Lt,!1)}writeElements(ar,Fr){Fr.formElements=ut(ar,Lt,!1)}clone(){return new Ct({description:this.description,elements:(0,G.d9)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,D._)([(0,Z.Cb)({json:{write:!0}})],vt.prototype,"elements",void 0),(0,D._)([(0,Q.p)("elements")],vt.prototype,"castElements",null),(0,D._)([(0,$.r)("elements",["formElements"])],vt.prototype,"readElements",null),(0,D._)([(0,B.c)("elements")],vt.prototype,"writeElements",null),(0,D._)([(0,Z.Cb)({type:["collapsed","expanded"],json:{write:!0}})],vt.prototype,"initialState",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{read:!1,write:!0}})],vt.prototype,"type",void 0),vt=Ct=(0,D._)([(0,W.j)("esri.form.elements.GroupElement")],vt);const Lt=qe(vt);var $t;const Wt=qe(vt);let pr=$t=class extends R.wq{constructor(ar){super(ar),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(ar){return _t(ar,Wt)}readElements(ar,Fr){return ot(Fr.formElements,Wt)}writeElements(ar,Fr){Fr.formElements=ut(ar,Wt)}clone(){return new $t({description:this.description,expressionInfos:(0,G.d9)(this.expressionInfos),elements:(0,G.d9)(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],pr.prototype,"description",void 0),(0,D._)([(0,Z.Cb)({json:{write:!0}})],pr.prototype,"elements",void 0),(0,D._)([(0,Q.p)("elements")],pr.prototype,"castElements",null),(0,D._)([(0,$.r)("elements",["formElements"])],pr.prototype,"readElements",null),(0,D._)([(0,B.c)("elements")],pr.prototype,"writeElements",null),(0,D._)([(0,Z.Cb)({type:[oe],json:{write:!0}})],pr.prototype,"expressionInfos",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{default:!1,write:!0}})],pr.prototype,"preserveFieldValuesWhenHidden",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],pr.prototype,"title",void 0),pr=$t=(0,D._)([(0,W.j)("esri.form.FormTemplate")],pr);const gr=pr},29132:(nt,Ae,v)=>{"use strict";v.d(Ae,{qM:()=>ae});var D=v(90912),R=v(2004),G=v(21674),Z=v(72854),Q=v(72642),$=v(37118),W=v(55214);v(65234),v(71774),v(91179);const ae={base:G.Z,key:"type",typeMap:{extent:R.Z,multipoint:Z.Z,point:Q.Z,polyline:W.Z,polygon:$.Z}};(0,D.N7)(ae)},2004:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Y});var de,D=v(17626),R=v(62208),G=v(77275),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(21674),H=v(72642),X=v(65234),te=v(33190),ae=v(11519),oe=v(37053),le=v(46367);function re(ee,ie,J){return null==ie?J:null==J?ie:ee(ie,J)}let j=de=class extends B.Z{constructor(...ee){super(...ee),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(ee,ie,J,ce,ue){return function se(ee){return ee&&("esri.geometry.SpatialReference"===ee.declaredClass||null!=ee.wkid)}(ee)?{spatialReference:ee,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof ee?(ee.spatialReference=ee.spatialReference??X.Z.WGS84,ee):{xmin:ee,ymin:ie,xmax:J,ymax:ce,spatialReference:ue??X.Z.WGS84}}static fromBounds(ee,ie){return new de({xmin:ee[0],ymin:ee[1],xmax:ee[2],ymax:ee[3],spatialReference:ie})}static fromPoint(ee){return new de({xmin:ee.x,ymin:ee.y,zmin:ee.z,xmax:ee.x,ymax:ee.y,zmax:ee.z,spatialReference:ee.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const ee=new H.Z({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(ee.z=.5*(this.zmin+this.zmax)),this.hasM&&(ee.m=.5*(this.mmin+this.mmax)),ee}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(ee){const ie=this.center;return null!=ee.z&&this.hasZ?this.offset(ee.x-ie.x,ee.y-ie.y,ee.z-ie.z):this.offset(ee.x-ie.x,ee.y-ie.y)}clone(){const ee=new de;return ee.xmin=this.xmin,ee.ymin=this.ymin,ee.xmax=this.xmax,ee.ymax=this.ymax,ee.spatialReference=this.spatialReference,null!=this.zmin&&(ee.zmin=this.zmin,ee.zmax=this.zmax),null!=this.mmin&&(ee.mmin=this.mmin,ee.mmax=this.mmax),ee}contains(ee){if(!ee)return!1;const ie=this.spatialReference,J=ee.spatialReference;return ie&&J&&!ie.equals(J)&&(0,le.Q8)(ie,J)&&(ee=ie.isWebMercator?(0,le.$)(ee):(0,le.Sx)(ee,!0)),"point"===ee.type?(0,te.aV)(this,ee):"extent"===ee.type&&(0,te.uP)(this,ee)}equals(ee){if(this===ee)return!0;if((0,R.Wi)(ee))return!1;const ie=this.spatialReference,J=ee.spatialReference;return ie&&J&&!ie.equals(J)&&(0,le.Q8)(ie,J)&&(ee=ie.isWebMercator?(0,le.$)(ee):(0,le.Sx)(ee,!0)),this.xmin===ee.xmin&&this.ymin===ee.ymin&&this.zmin===ee.zmin&&this.mmin===ee.mmin&&this.xmax===ee.xmax&&this.ymax===ee.ymax&&this.zmax===ee.zmax&&this.mmax===ee.mmax}expand(ee){const ie=.5*(1-ee),J=this.width*ie,ce=this.height*ie;if(this.xmin+=J,this.ymin+=ce,this.xmax-=J,this.ymax-=ce,this.hasZ){const ue=(this.zmax-this.zmin)*ie;this.zmin+=ue,this.zmax-=ue}if(this.hasM){const ue=(this.mmax-this.mmin)*ie;this.mmin+=ue,this.mmax-=ue}return this}intersects(ee){if((0,R.Wi)(ee))return!1;"mesh"===ee.type&&(ee=ee.extent);const ie=this.spatialReference,J=ee.spatialReference;return ie&&J&&!(0,oe.fS)(ie,J)&&(0,le.Q8)(ie,J)&&(ee=ie.isWebMercator?(0,le.$)(ee):(0,le.Sx)(ee,!0)),(0,ae.IY)(ee.type)(this,ee)}normalize(){const ee=this._normalize(!1,!0);return Array.isArray(ee)?ee:[ee]}offset(ee,ie,J){return this.xmin+=ee,this.ymin+=ie,this.xmax+=ee,this.ymax+=ie,null!=J&&(this.zmin+=J,this.zmax+=J),this}shiftCentralMeridian(){return this._normalize(!0)}union(ee){return this===ee||(this.xmin=Math.min(this.xmin,ee.xmin),this.ymin=Math.min(this.ymin,ee.ymin),this.xmax=Math.max(this.xmax,ee.xmax),this.ymax=Math.max(this.ymax,ee.ymax),(this.hasZ||ee.hasZ)&&(this.zmin=re(Math.min,this.zmin,ee.zmin),this.zmax=re(Math.max,this.zmax,ee.zmax)),(this.hasM||ee.hasM)&&(this.mmin=re(Math.min,this.mmin,ee.mmin),this.mmax=re(Math.max,this.mmax,ee.mmax))),this}intersection(ee){return this===ee?this:(0,R.Wi)(ee)||!this.intersects(ee)?null:(this.xmin=Math.max(this.xmin,ee.xmin),this.ymin=Math.max(this.ymin,ee.ymin),this.xmax=Math.min(this.xmax,ee.xmax),this.ymax=Math.min(this.ymax,ee.ymax),(this.hasZ||ee.hasZ)&&(this.zmin=re(Math.max,this.zmin,ee.zmin),this.zmax=re(Math.min,this.zmax,ee.zmax)),(this.hasM||ee.hasM)&&(this.mmin=re(Math.max,this.mmin,ee.mmin),this.mmax=re(Math.min,this.mmax,ee.mmax)),this)}toJSON(ee){return this.write({},ee)}_shiftCM(ee=(0,oe.C5)(this.spatialReference)){if(!ee||!this.spatialReference)return this;const ie=this.spatialReference,J=this._getCM(ee);if(J){const ce=ie.isWebMercator?(0,le.Sx)(J):J;this.xmin-=J.x,this.xmax-=J.x,ie.isWebMercator||(ce.x=this._normalizeX(ce.x,ee).x),this.spatialReference=new X.Z((0,G.gx)((ie.isWGS84?ee.altTemplate:null)??ee.wkTemplate,{Central_Meridian:ce.x}))}return this}_getCM(ee){let ie=null;const[J,ce]=ee.valid,ue=this.xmin,pe=this.xmax;return ue>=J&&ue<=ce&&pe>=J&&pe<=ce||(ie=this.center),ie}_normalize(ee,ie,J){const ce=this.spatialReference;if(!ce)return this;const ue=J??(0,oe.C5)(ce);if(null==ue)return this;const pe=this._getParts(ue).map(ge=>ge.extent);if(pe.length<2)return pe[0]||this;if(pe.length>2)return ee?this._shiftCM(ue):this.set({xmin:ue.valid[0],xmax:ue.valid[1]});if(ee)return this._shiftCM(ue);if(ie)return pe;let he=!0,me=!0;return pe.forEach(ge=>{ge.hasZ||(he=!1),ge.hasM||(me=!1)}),{rings:pe.map(ge=>{const _e=[[ge.xmin,ge.ymin],[ge.xmin,ge.ymax],[ge.xmax,ge.ymax],[ge.xmax,ge.ymin],[ge.xmin,ge.ymin]];if(he){const Ee=(ge.zmax-ge.zmin)/2;for(let De=0;De<_e.length;De++)_e[De].push(Ee)}if(me){const Ee=(ge.mmax-ge.mmin)/2;for(let De=0;De<_e.length;De++)_e[De].push(Ee)}return _e}),hasZ:he,hasM:me,spatialReference:ce}}_getParts(ee){let ie=this.cache._parts;if(!ie){ie=[];const{ymin:ue,ymax:pe,spatialReference:he}=this,me=this.width,ge=this.xmin,_e=this.xmax;let Ee;ee=ee||(0,oe.C5)(he);const[De,be]=ee.valid;Ee=this._normalizeX(this.xmin,ee);const Se=Ee.x,ye=Ee.frameId;Ee=this._normalizeX(this.xmax,ee);const ve=Ee.x,xe=Ee.frameId,ze=Se===ve&&me>0;if(me>2*be){const Ke=new de(ge<_e?Se:ve,ue,be,pe,he),We=new de(De,ue,ge<_e?ve:Se,pe,he),Ce=new de(0,ue,be,pe,he),Be=new de(De,ue,0,pe,he),Fe=[],je=[];Ke.contains(Ce)&&Fe.push(ye),Ke.contains(Be)&&je.push(ye),We.contains(Ce)&&Fe.push(xe),We.contains(Be)&&je.push(xe);for(let Re=ye+1;Re<xe;Re++)Fe.push(Re),je.push(Re);ie.push({extent:Ke,frameIds:[ye]},{extent:We,frameIds:[xe]},{extent:Ce,frameIds:Fe},{extent:Be,frameIds:je})}else Se>ve||ze?ie.push({extent:new de(Se,ue,be,pe,he),frameIds:[ye]},{extent:new de(De,ue,ve,pe,he),frameIds:[xe]}):ie.push({extent:new de(Se,ue,ve,pe,he),frameIds:[ye]});this.cache._parts=ie}const J=this.hasZ,ce=this.hasM;if(J||ce){const ue={};J&&(ue.zmin=this.zmin,ue.zmax=this.zmax),ce&&(ue.mmin=this.mmin,ue.mmax=this.mmax);for(let pe=0;pe<ie.length;pe++)ie[pe].extent.set(ue)}return ie}_normalizeX(ee,ie){const[J,ce]=ie.valid,ue=2*ce;let pe,he=0;return ee>ce?(pe=Math.ceil(Math.abs(ee-ce)/ue),ee-=pe*ue,he=pe):ee<J&&(pe=Math.ceil(Math.abs(ee-J)/ue),ee+=pe*ue,he=-pe),{x:ee,frameId:he}}};(0,D._)([(0,Z.Cb)({readOnly:!0})],j.prototype,"cache",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],j.prototype,"center",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],j.prototype,"extent",null),(0,D._)([(0,Z.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],j.prototype,"hasM",null),(0,D._)([(0,Z.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],j.prototype,"hasZ",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],j.prototype,"height",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],j.prototype,"width",null),(0,D._)([(0,Z.Cb)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],j.prototype,"xmin",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],j.prototype,"ymin",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],j.prototype,"mmin",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],j.prototype,"zmin",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],j.prototype,"xmax",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],j.prototype,"ymax",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],j.prototype,"mmax",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],j.prototype,"zmax",void 0),j=de=(0,D._)([(0,W.j)("esri.geometry.Extent")],j),j.prototype.toJSON.isDefaultToJSON=!0;const Y=j},21674:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(68653)),W=v(76898),B=v(65234);let H=class extends R.wq{constructor(...te){super(...te),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=B.Z.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(te,ae){if(te instanceof B.Z)return te;if(null!=te){const oe=new B.Z;return oe.read(te,ae),oe}return te}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(te){return this.cache[te]}setCacheValue(te,ae){this.cache[te]=ae}};(0,D._)([(0,G.Cb)()],H.prototype,"type",void 0),(0,D._)([(0,G.Cb)({readOnly:!0})],H.prototype,"cache",null),(0,D._)([(0,G.Cb)({readOnly:!0})],H.prototype,"extent",null),(0,D._)([(0,G.Cb)({type:Boolean,json:{write:{overridePolicy:te=>({enabled:te})}}})],H.prototype,"hasM",void 0),(0,D._)([(0,G.Cb)({type:Boolean,json:{write:{overridePolicy:te=>({enabled:te})}}})],H.prototype,"hasZ",void 0),(0,D._)([(0,G.Cb)({type:B.Z,json:{write:!0}})],H.prototype,"spatialReference",void 0),(0,D._)([(0,$.r)("spatialReference")],H.prototype,"readSpatialReference",null),H=(0,D._)([(0,W.j)("esri.geometry.Geometry")],H);const X=H},79334:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Y});var ae,D=v(17626),R=v(85931),G=v(2076),Z=v(86810),Q=v(16730),$=v(14889),W=v(77712),H=(v(90912),v(68653)),X=v(76898),te=v(99433);const oe=(0,G.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),le=oe.jsonValues.slice();(0,R.e$)(le,"orthometric");const de=(0,G.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let se=ae=class extends Z.wq{constructor(ee){super(ee),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(ee,ie,J){return oe.write(ee,ie,J)}readHeightModel(ee,ie,J){return oe.read(ee)||(J&&J.messages&&J.messages.push(function j(ee,ie){return new $.Z("height-model:unsupported",`Height model of value '${ee}' is not supported`,ie)}(ee,{context:J})),null)}readHeightUnit(ee,ie,J){return de.read(ee)||(J&&J.messages&&J.messages.push(re(ee,{context:J})),null)}readHeightUnitService(ee,ie,J){return(0,Q.$C)(ee)||de.read(ee)||(J&&J.messages&&J.messages.push(re(ee,{context:J})),null)}readVertCRS(ee,ie){return ie.vertCRS||ie.ellipsoid||ie.geoid}clone(){return new ae({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(ee){return!!ee&&(this===ee||this.heightModel===ee.heightModel&&this.heightUnit===ee.heightUnit&&this.vertCRS===ee.vertCRS)}static deriveUnitFromSR(ee,ie){const J=(0,Q.cM)(ie);return new ae({heightModel:ee.heightModel,heightUnit:J,vertCRS:ee.vertCRS})}write(ee,ie){return ie={origin:"web-scene",...ie},super.write(ee,ie)}static fromJSON(ee){if(!ee)return null;const ie=new ae;return ie.read(ee,{origin:"web-scene"}),ie}};function re(ee,ie){return new $.Z("height-unit:unsupported",`Height unit of value '${ee}' is not supported`,ie)}(0,D._)([(0,W.Cb)({type:oe.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:le,default:"ellipsoidal"}}}})],se.prototype,"heightModel",void 0),(0,D._)([(0,te.c)("web-scene","heightModel")],se.prototype,"writeHeightModel",null),(0,D._)([(0,H.r)(["web-scene","service"],"heightModel")],se.prototype,"readHeightModel",null),(0,D._)([(0,W.Cb)({type:de.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:de.jsonValues,write:de.write}}}})],se.prototype,"heightUnit",void 0),(0,D._)([(0,H.r)("web-scene","heightUnit")],se.prototype,"readHeightUnit",null),(0,D._)([(0,H.r)("service","heightUnit")],se.prototype,"readHeightUnitService",null),(0,D._)([(0,W.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],se.prototype,"vertCRS",void 0),(0,D._)([(0,H.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],se.prototype,"readVertCRS",null),se=ae=(0,D._)([(0,X.j)("esri.geometry.HeightModelInfo")],se);const Y=se},72854:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var te,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(76898)),$=v(99433),W=v(2004),B=v(21674),H=v(72642),X=v(18945);function ae(se){return(re,j)=>null==re?j:null==j?re:se(re,j)}let le=te=class extends B.Z{constructor(...se){super(...se),this.points=[],this.type="multipoint"}normalizeCtorArgs(se,re){if(!se&&!re)return{};const j={};Array.isArray(se)?(j.points=se,j.spatialReference=re):function oe(se){return se&&("esri.geometry.SpatialReference"===se.declaredClass||null!=se.wkid)}(se)?j.spatialReference=se:(se.points&&(j.points=se.points),se.spatialReference&&(j.spatialReference=se.spatialReference),se.hasZ&&(j.hasZ=se.hasZ),se.hasM&&(j.hasM=se.hasM));const Y=j.points&&j.points[0];return Y&&(void 0===j.hasZ&&void 0===j.hasM?(j.hasZ=Y.length>2,j.hasM=!1):void 0===j.hasZ?j.hasZ=Y.length>3:void 0===j.hasM&&(j.hasM=Y.length>3)),j}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const se=this.points;if(!se.length)return null;const re=new W.Z,j=this.hasZ,Y=this.hasM,ee=j?3:2,ie=se[0],J=ae(Math.min),ce=ae(Math.max);let ue,pe,he,me,[ge,_e]=ie,[Ee,De]=ie;for(let be=0,Se=se.length;be<Se;be++){const ye=se[be],[ve,xe]=ye;if(ge=J(ge,ve),_e=J(_e,xe),Ee=ce(Ee,ve),De=ce(De,xe),j&&ye.length>2){const ze=ye[2];ue=J(ue,ze),he=ce(he,ze)}if(Y&&ye.length>ee){const ze=ye[ee];pe=J(pe,ze),me=ce(me,ze)}}return re.xmin=ge,re.ymin=_e,re.xmax=Ee,re.ymax=De,re.spatialReference=this.spatialReference,j?(re.zmin=ue,re.zmax=he):(re.zmin=void 0,re.zmax=void 0),Y?(re.mmin=pe,re.mmax=me):(re.mmin=void 0,re.mmax=void 0),re}writePoints(se,re){re.points=(0,R.d9)(this.points)}addPoint(se){return(0,X.l)(this,se),Array.isArray(se)?this.points.push(se):this.points.push(se.toArray()),this.notifyChange("points"),this}clone(){const se={points:(0,R.d9)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(se.hasZ=!0),this.hasM&&(se.hasM=!0),new te(se)}getPoint(se){if(!this._validateInputs(se))return null;const re=this.points[se],j={x:re[0],y:re[1],spatialReference:this.spatialReference};let Y=2;return this.hasZ&&(j.z=re[2],Y=3),this.hasM&&(j.m=re[Y]),new H.Z(j)}removePoint(se){if(!this._validateInputs(se))return null;const re=new H.Z(this.points.splice(se,1)[0],this.spatialReference);return this.notifyChange("points"),re}setPoint(se,re){return this._validateInputs(se)?((0,X.l)(this,re),Array.isArray(re)||(re=re.toArray()),this.points[se]=re,this.notifyChange("points"),this):this}toJSON(se){return this.write({},se)}_validateInputs(se){return null!=se&&se>=0&&se<this.points.length}};(0,D._)([(0,G.Cb)({readOnly:!0})],le.prototype,"cache",null),(0,D._)([(0,G.Cb)()],le.prototype,"extent",null),(0,D._)([(0,G.Cb)({type:[[Number]],json:{write:{isRequired:!0}}})],le.prototype,"points",void 0),(0,D._)([(0,$.c)("points")],le.prototype,"writePoints",null),le=te=(0,D._)([(0,Q.j)("esri.geometry.Multipoint")],le),le.prototype.toJSON.isDefaultToJSON=!0;const de=le},72642:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ie});var re,D=v(17626),R=v(63290),G=v(62208),Z=v(77712),$=(v(85931),v(66656)),W=v(68653),B=v(76898),H=v(99433),X=v(90912),te=v(21674),ae=v(65234),de=v(37053),se=v(46367);const j=[0,0];function Y(J){return J&&("esri.geometry.SpatialReference"===J.declaredClass||null!=J.wkid)}let ee=re=class extends te.Z{constructor(...J){super(...J),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(J,ce){ce._set("x",J._get("x")),ce._set("y",J._get("y")),ce._set("z",J._get("z")),ce._set("m",J._get("m"));const ue=J._get("spatialReference");ce._set("spatialReference",Object.isFrozen(ue)?ue:ue.clone())}normalizeCtorArgs(J,ce,ue,pe,he){let me;if(Array.isArray(J))me=J,he=ce,J=me[0],ce=me[1],ue=me[2],pe=me[3];else if(J&&"object"==typeof J){if(me=J,J=null!=me.x?me.x:me.longitude,ce=null!=me.y?me.y:me.latitude,ue=me.z,pe=me.m,(he=me.spatialReference)&&"esri.geometry.SpatialReference"!==he.declaredClass&&(he=new ae.Z(he)),null!=me.longitude||null!=me.latitude)if(null==me.longitude)R.Z.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(null==me.latitude)R.Z.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!me.declaredClass&&he&&he.isWebMercator){const _e=(0,se.hG)(me.longitude,me.latitude,j);J=_e[0],ce=_e[1]}}else Y(ue)?(he=ue,ue=null):Y(pe)&&(he=pe,pe=null);const ge={x:J,y:ce};return null==ge.x&&null!=ge.y?R.Z.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):null==ge.y&&null!=ge.x&&R.Z.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),null!=he&&(ge.spatialReference=he),null!=ue&&(ge.z=ue),null!=pe&&(ge.m=pe),ge}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(J){J!==(void 0!==this._get("m"))&&(this._set("m",J?0:void 0),this._set("hasM",J))}get hasZ(){return void 0!==this.z}set hasZ(J){J!==(void 0!==this._get("z"))&&(this._set("z",J?0:void 0),this._set("hasZ",J))}get latitude(){const{spatialReference:J,x:ce,y:ue}=this;if(J){if(J.isWebMercator)return(0,se.R6)(ce,ue,j)[1];if(J.isGeographic)return ue}return null}set latitude(J){const{spatialReference:ce,x:ue}=this;null!=J&&ce&&(ce.isWebMercator?this._set("y",(0,se.hG)(ue,J,j)[1]):ce.isGeographic&&this._set("y",J),this._set("latitude",J))}get longitude(){const{x:J,y:ce,spatialReference:ue}=this;if(ue){if(ue.isWebMercator)return(0,se.R6)(J,ce,j)[0];if(ue.isGeographic)return J}return null}set longitude(J){const{y:ce,spatialReference:ue}=this;null!=J&&ue&&(ue.isWebMercator?this._set("x",(0,se.hG)(J,ce,j)[0]):ue.isGeographic&&this._set("x",J),this._set("longitude",J))}writeX(J,ce,ue){ce[ue]=isNaN(J)?"NaN":J}readX(J){return"string"==typeof J?NaN:J}clone(){const J=new re;return J.x=this.x,J.y=this.y,J.z=this.z,J.m=this.m,J.spatialReference=this.spatialReference,J}copy(J){return re.copy(J,this),this}equals(J){if((0,G.Wi)(J))return!1;const{x:ce,y:ue,z:pe,m:he,spatialReference:me}=this,{z:ge,m:_e}=J;let{x:Ee,y:De,spatialReference:be}=J;if(!me.equals(be))if(me.isWebMercator&&be.isWGS84)[Ee,De]=(0,se.hG)(Ee,De),be=me;else{if(!me.isWGS84||!be.isWebMercator)return!1;[Ee,De]=(0,se.R6)(Ee,De),be=me}return ce===Ee&&ue===De&&pe===ge&&he===_e&&me.wkid===be.wkid}offset(J,ce,ue){return this.x+=J,this.y+=ce,null!=ue&&(this.z=(this.z??0)+ue),this}normalize(){if(!this.spatialReference)return this;const J=(0,de.C5)(this.spatialReference);if(!J)return this;let ce=this.x;const[ue,pe]=J.valid,he=2*pe;let me;return ce>pe?(me=Math.ceil(Math.abs(ce-pe)/he),ce-=me*he):ce<ue&&(me=Math.ceil(Math.abs(ce-ue)/he),ce+=me*he),this._set("x",ce),this}distance(J){return function oe(J,ce){const ue=J.x-ce.x,pe=J.y-ce.y,he=J.hasZ&&ce.hasZ?J.z-ce.z:0;return Math.sqrt(ue*ue+pe*pe+he*he)}(this,J)}toArray(){const J=this.hasZ,ce=this.hasM;return J&&ce?[this.x,this.y,this.z,this.m]:J?[this.x,this.y,this.z]:ce?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(J){return this.write({},J)}};(0,D._)([(0,Z.Cb)({readOnly:!0})],ee.prototype,"cache",null),(0,D._)([(0,Z.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ee.prototype,"hasM",null),(0,D._)([(0,Z.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ee.prototype,"hasZ",null),(0,D._)([(0,Z.Cb)({type:Number})],ee.prototype,"latitude",null),(0,D._)([(0,Z.Cb)({type:Number})],ee.prototype,"longitude",null),(0,D._)([(0,Z.Cb)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),(0,$.p)(J=>isNaN(J)?J:(0,X.q9)(J))],ee.prototype,"x",void 0),(0,D._)([(0,H.c)("x")],ee.prototype,"writeX",null),(0,D._)([(0,W.r)("x")],ee.prototype,"readX",null),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ee.prototype,"y",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ee.prototype,"z",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],ee.prototype,"m",void 0),ee=re=(0,D._)([(0,B.j)("esri.geometry.Point")],ee),ee.prototype.toJSON.isDefaultToJSON=!0;const ie=ee},37118:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ce});var ee,D=v(17626),R=v(85931),G=v(58817),Z=v(62208),Q=v(77712),W=(v(90912),v(76898)),B=v(99433),H=v(2004),X=v(21674),te=v(72642),ae=v(65234),oe=v(27105),le=v(33190),de=v(25748),se=v(15176),re=v(11519),j=v(46367),Y=v(18945);function ie(ue){return!Array.isArray(ue[0])}let J=ee=class extends X.Z{constructor(...ue){super(...ue),this.rings=[],this.type="polygon"}static fromExtent(ue){const pe=ue.clone().normalize(),he=ue.spatialReference;let me=!1,ge=!1;for(const Ee of pe)Ee.hasZ&&(me=!0),Ee.hasM&&(ge=!0);const _e={rings:pe.map(Ee=>{const De=[[Ee.xmin,Ee.ymin],[Ee.xmin,Ee.ymax],[Ee.xmax,Ee.ymax],[Ee.xmax,Ee.ymin],[Ee.xmin,Ee.ymin]];if(me&&Ee.hasZ){const be=Ee.zmin+.5*(Ee.zmax-Ee.zmin);for(let Se=0;Se<De.length;Se++)De[Se].push(be)}if(ge&&Ee.hasM){const be=Ee.mmin+.5*(Ee.mmax-Ee.mmin);for(let Se=0;Se<De.length;Se++)De[Se].push(be)}return De}),spatialReference:he};return me&&(_e.hasZ=!0),ge&&(_e.hasM=!0),new ee(_e)}normalizeCtorArgs(ue,pe){let he,me,ge=null,_e=null;return ue&&!Array.isArray(ue)?(ge=ue.rings?ue.rings:null,pe||(ue.spatialReference?pe=ue.spatialReference:ue.rings||(pe=ue)),he=ue.hasZ,me=ue.hasM):ge=ue,ge=ge||[],ge.length&&ge[0]&&null!=ge[0][0]&&"number"==typeof ge[0][0]&&(ge=[ge]),_e=ge[0]&&ge[0][0],_e&&(void 0===he&&void 0===me?(he=_e.length>2,me=_e.length>3):void 0===he?he=me?_e.length>3:_e.length>2:void 0===me&&(me=he?_e.length>3:_e.length>2)),{rings:ge,spatialReference:pe=pe||ae.Z.WGS84,hasZ:he,hasM:me}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const ue=(0,oe.tO)(this);if(!ue||isNaN(ue[0])||isNaN(ue[1])||this.hasZ&&isNaN(ue[2]))return null;const pe=new te.Z;return pe.x=ue[0],pe.y=ue[1],pe.spatialReference=this.spatialReference,this.hasZ&&(pe.z=ue[2]),pe}get extent(){const{spatialReference:ue}=this,pe=(0,se._w)(this);if(!pe)return null;const he=new H.Z(pe);return he.spatialReference=ue,he}get isSelfIntersecting(){return(0,re.Ff)(this.rings)}writeRings(ue,pe){pe.rings=(0,G.d9)(this.rings)}addRing(ue){if(!ue)return;const pe=this.rings,he=pe.length;if(ie(ue)){const me=[];for(let ge=0,_e=ue.length;ge<_e;ge++)me[ge]=ue[ge].toArray();pe[he]=me}else pe[he]=ue.concat();return this.notifyChange("rings"),this}clone(){const ue=new ee;return ue.spatialReference=this.spatialReference,ue.rings=(0,G.d9)(this.rings),ue.hasZ=this.hasZ,ue.hasM=this.hasM,ue}equals(ue){if(this===ue)return!0;if((0,Z.Wi)(ue))return!1;const pe=this.spatialReference,he=ue.spatialReference;if((0,Z.pC)(pe)!==(0,Z.pC)(he)||(0,Z.pC)(pe)&&(0,Z.pC)(he)&&!pe.equals(he)||this.rings.length!==ue.rings.length)return!1;const me=([ge,_e,Ee,De],[be,Se,ye,ve])=>ge===be&&_e===Se&&(null==Ee&&null==ye||Ee===ye)&&(null==De&&null==ve||De===ve);for(let ge=0;ge<this.rings.length;ge++)if(!(0,R.fS)(this.rings[ge],ue.rings[ge],me))return!1;return!0}contains(ue){if(!ue)return!1;const pe=(0,j.iV)(ue,this.spatialReference);return(0,le.CI)(this,(0,Z.pC)(pe)?pe:ue)}isClockwise(ue){let pe;return pe=ie(ue)?ue.map(he=>this.hasZ?this.hasM?[he.x,he.y,he.z,he.m]:[he.x,he.y,he.z]:[he.x,he.y]):ue,(0,de.bu)(pe,this.hasM,this.hasZ)}getPoint(ue,pe){if(!this._validateInputs(ue,pe))return null;const he=this.rings[ue][pe],me=this.hasZ,ge=this.hasM;return me&&!ge?new te.Z(he[0],he[1],he[2],void 0,this.spatialReference):ge&&!me?new te.Z(he[0],he[1],void 0,he[2],this.spatialReference):me&&ge?new te.Z(he[0],he[1],he[2],he[3],this.spatialReference):new te.Z(he[0],he[1],this.spatialReference)}insertPoint(ue,pe,he){return this._validateInputs(ue,pe,!0)?((0,Y.l)(this,he),Array.isArray(he)||(he=he.toArray()),this.rings[ue].splice(pe,0,he),this.notifyChange("rings"),this):this}removePoint(ue,pe){if(!this._validateInputs(ue,pe))return null;const he=new te.Z(this.rings[ue].splice(pe,1)[0],this.spatialReference);return this.notifyChange("rings"),he}removeRing(ue){if(!this._validateInputs(ue,null))return null;const pe=this.rings.splice(ue,1)[0],he=this.spatialReference,me=pe.map(ge=>new te.Z(ge,he));return this.notifyChange("rings"),me}setPoint(ue,pe,he){return this._validateInputs(ue,pe)?((0,Y.l)(this,he),Array.isArray(he)||(he=he.toArray()),this.rings[ue][pe]=he,this.notifyChange("rings"),this):this}_validateInputs(ue,pe,he=!1){if(null==ue||ue<0||ue>=this.rings.length)return!1;if(null!=pe){const me=this.rings[ue];if(he&&(pe<0||pe>me.length)||!he&&(pe<0||pe>=me.length))return!1}return!0}toJSON(ue){return this.write({},ue)}};(0,D._)([(0,Q.Cb)({readOnly:!0})],J.prototype,"cache",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],J.prototype,"centroid",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],J.prototype,"extent",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],J.prototype,"isSelfIntersecting",null),(0,D._)([(0,Q.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],J.prototype,"rings",void 0),(0,D._)([(0,B.c)("rings")],J.prototype,"writeRings",null),J=ee=(0,D._)([(0,W.j)("esri.geometry.Polygon")],J),J.prototype.toJSON.isDefaultToJSON=!0;const ce=J},55214:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var oe,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(76898)),$=v(99433),W=v(2004),B=v(21674),H=v(72642),X=v(65234),te=v(15176),ae=v(18945);let de=oe=class extends B.Z{constructor(...re){super(...re),this.paths=[],this.type="polyline"}normalizeCtorArgs(re,j){let Y,ee,ie=null,J=null;return re&&!Array.isArray(re)?(ie=re.paths?re.paths:null,j||(re.spatialReference?j=re.spatialReference:re.paths||(j=re)),Y=re.hasZ,ee=re.hasM):ie=re,ie=ie||[],ie.length&&ie[0]&&null!=ie[0][0]&&"number"==typeof ie[0][0]&&(ie=[ie]),J=ie[0]&&ie[0][0],J&&(void 0===Y&&void 0===ee?(Y=J.length>2,ee=!1):void 0===Y?Y=!ee&&J.length>3:void 0===ee&&(ee=!Y&&J.length>3)),{paths:ie,spatialReference:j=j||X.Z.WGS84,hasZ:Y,hasM:ee}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:re}=this,j=(0,te.Wn)(this);if(!j)return null;const Y=new W.Z(j);return Y.spatialReference=re,Y}writePaths(re,j){j.paths=(0,R.d9)(this.paths)}addPath(re){if(!re)return;const j=this.paths,Y=j.length;if(function le(re){return!Array.isArray(re[0])}(re)){const ee=[];for(let ie=0,J=re.length;ie<J;ie++)ee[ie]=re[ie].toArray();j[Y]=ee}else j[Y]=re.concat();return this.notifyChange("paths"),this}clone(){const re=new oe;return re.spatialReference=this.spatialReference,re.paths=(0,R.d9)(this.paths),re.hasZ=this.hasZ,re.hasM=this.hasM,re}getPoint(re,j){if(!this._validateInputs(re,j))return null;const Y=this.paths[re][j],ee=this.hasZ,ie=this.hasM;return ee&&!ie?new H.Z(Y[0],Y[1],Y[2],void 0,this.spatialReference):ie&&!ee?new H.Z(Y[0],Y[1],void 0,Y[2],this.spatialReference):ee&&ie?new H.Z(Y[0],Y[1],Y[2],Y[3],this.spatialReference):new H.Z(Y[0],Y[1],this.spatialReference)}insertPoint(re,j,Y){return this._validateInputs(re,j,!0)?((0,ae.l)(this,Y),Array.isArray(Y)||(Y=Y.toArray()),this.paths[re].splice(j,0,Y),this.notifyChange("paths"),this):this}removePath(re){if(!this._validateInputs(re,null))return null;const j=this.paths.splice(re,1)[0],Y=this.spatialReference,ee=j.map(ie=>new H.Z(ie,Y));return this.notifyChange("paths"),ee}removePoint(re,j){if(!this._validateInputs(re,j))return null;const Y=new H.Z(this.paths[re].splice(j,1)[0],this.spatialReference);return this.notifyChange("paths"),Y}setPoint(re,j,Y){return this._validateInputs(re,j)?((0,ae.l)(this,Y),Array.isArray(Y)||(Y=Y.toArray()),this.paths[re][j]=Y,this.notifyChange("paths"),this):this}_validateInputs(re,j,Y=!1){if(null==re||re<0||re>=this.paths.length)return!1;if(null!=j){const ee=this.paths[re];if(Y&&(j<0||j>ee.length)||!Y&&(j<0||j>=ee.length))return!1}return!0}toJSON(re){return this.write({},re)}};(0,D._)([(0,G.Cb)({readOnly:!0})],de.prototype,"cache",null),(0,D._)([(0,G.Cb)({readOnly:!0})],de.prototype,"extent",null),(0,D._)([(0,G.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],de.prototype,"paths",void 0),(0,D._)([(0,$.c)("paths")],de.prototype,"writePaths",null),de=oe=(0,D._)([(0,Q.j)("esri.geometry.Polyline")],de),de.prototype.toJSON.isDefaultToJSON=!0;const se=de},65234:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(86810),G=v(58817),Z=v(90912),Q=v(77712),$=v(76898),W=v(99433),B=v(37053);let X=H=class extends R.wq{constructor(ae){super(ae),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(ae){if(!ae)return null;if(ae.wkid){if(102100===ae.wkid)return H.WebMercator;if(4326===ae.wkid)return H.WGS84}const oe=new H;return oe.read(ae),oe}normalizeCtorArgs(ae){return ae&&"object"==typeof ae?ae:{["string"==typeof ae?"wkt":"wkid"]:ae}}get isWGS84(){return(0,B.oR)(this)}get isWebMercator(){return(0,B.sS)(this)}get isGeographic(){return(0,B.sT)(this)}get isWrappable(){return(0,B.MP)(this)}writeWkt(ae,oe){this.wkid||(oe.wkt=ae)}clone(){if(this===H.WGS84)return H.WGS84;if(this===H.WebMercator)return H.WebMercator;const ae=new H;return null!=this.wkid?(ae.wkid=this.wkid,null!=this.latestWkid&&(ae.latestWkid=this.latestWkid),null!=this.vcsWkid&&(ae.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(ae.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(ae.wkt=this.wkt),this.imageCoordinateSystem&&(ae.imageCoordinateSystem=(0,G.d9)(this.imageCoordinateSystem)),ae}equals(ae){if(null==ae)return!1;if(this.imageCoordinateSystem||ae.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==ae.imageCoordinateSystem)return!1;const{id:oe,referenceServiceName:le}=ae.imageCoordinateSystem,{geodataXform:de}=ae.imageCoordinateSystem,se=this.imageCoordinateSystem;return null==oe||de?JSON.stringify(se)===JSON.stringify(ae.imageCoordinateSystem):le?se.id===oe&&se.referenceServiceName===le:se.id===oe}return(0,B.fS)(this,ae)}toJSON(ae){return this.write(void 0,ae)}};X.GCS_NAD_1927=null,X.WGS84=null,X.WebMercator=null,X.PlateCarree=null,(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"isWGS84",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"isWebMercator",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"isGeographic",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"isWrappable",null),(0,D._)([(0,Q.Cb)({type:Z.z8,json:{write:!0}})],X.prototype,"latestWkid",void 0),(0,D._)([(0,Q.Cb)({type:Z.z8,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkt}}}}}}})],X.prototype,"wkid",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkid}}}}}}})],X.prototype,"wkt",void 0),(0,D._)([(0,W.c)("wkt"),(0,W.c)("web-scene","wkt")],X.prototype,"writeWkt",null),(0,D._)([(0,Q.Cb)({type:Z.z8,json:{write:!0}})],X.prototype,"vcsWkid",void 0),(0,D._)([(0,Q.Cb)({type:Z.z8,json:{write:!0}})],X.prototype,"latestVcsWkid",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"imageCoordinateSystem",void 0),X=H=(0,D._)([(0,$.j)("esri.geometry.SpatialReference")],X),X.prototype.toJSON.isDefaultToJSON=!0,X.GCS_NAD_1927=new X({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),X.WGS84=new X(B.Zn),X.WebMercator=new X(B.R_),X.PlateCarree=new X(B.WR),Object.freeze&&(Object.freeze(X.GCS_NAD_1927),Object.freeze(X.WGS84),Object.freeze(X.WebMercator));const te=X},55915:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bm:()=>rr,CM:()=>gr,JY:()=>xe,KC:()=>vt,MT:()=>Ct,PR:()=>fs,Qr:()=>ar,Rg:()=>Lt,SH:()=>jt,UY:()=>$t,Up:()=>Re,Wt:()=>et,X4:()=>sr,YD:()=>Ge,dH:()=>or,dz:()=>ve,fA:()=>_t,fM:()=>je,fi:()=>Pe,gH:()=>Lr,iQ:()=>He,iV:()=>Se,jF:()=>Or,kR:()=>De,ke:()=>Wt,nF:()=>Le,oj:()=>ye,rS:()=>ze,st:()=>mr,yH:()=>St,zD:()=>be,zP:()=>gs});var D=v(15861),R=v(26584),G=v(21286),Z=v(62208),Q=v(10699),$=v(16730),W=v(36082),B=v(48902),H=v(28347),X=v(84161),te=v(28093),ae=v(2004),oe=v(72854),le=v(44956),de=v(72642),se=v(37118),re=v(55214),j=v(12080),Y=v(65401),ee=v(94425),ie=v(37299),J=v(98346),ce=v(37053),ue=v(6178),pe=v(33696);let he=null,me=null,ge=null,_e={};const Ee=new B.s;function De(){return!!he&&(0,le.i)()}function be(kt){return(0,Z.Wi)(ge)&&(ge=Promise.all([(0,le.l)(),v.e(4918).then(v.bind(v,4918)).then(Qt=>Qt.g),v.e(7777).then(v.bind(v,77777))])),ge.then(([,Qt,{hydratedAdapter:Vt}])=>{(0,Q.k_)(kt),me=Vt,he=Qt.default,he._enableProjection(le.p),Ee.notify()})}function Se(kt,Qt,Vt=null,yr=null){return Array.isArray(kt)?0===kt.length?[]:ye(me,kt,kt[0].spatialReference,Qt,Vt,yr):ye(me,[kt],kt.spatialReference,Qt,Vt,yr)[0]}function ye(kt,Qt,Vt,yr,ys=null,js=null){if((0,Z.Wi)(Vt)||(0,Z.Wi)(yr))return Qt;if(Re(Vt,yr,ys))return Qt.map(Ls=>(0,Z.Wg)(Pe(Ls,Vt,yr)));if((0,Z.Wi)(ys)){const Ls=J.Z.cacheKey(Vt,yr);void 0!==_e[Ls]?ys=_e[Ls]:(ys=ze(Vt,yr,void 0),(0,Z.Wi)(ys)&&(ys=new J.Z),_e[Ls]=ys)}if((0,Z.Wi)(he)||(0,Z.Wi)(kt))throw new We;return(0,Z.pC)(js)?he._project(kt,Qt,Vt,yr,ys,js):he._project(kt,Qt,Vt,yr,ys)}function ve(kt,Qt){const Vt=xe([kt],Qt);return(0,Z.pC)(Vt.pending)?{pending:Vt.pending,geometry:null}:(0,Z.pC)(Vt.geometries)?{pending:null,geometry:Vt.geometries[0]}:{pending:null,geometry:null}}function xe(kt,Qt){if(!De())for(const Vt of kt)if((0,Z.pC)(Vt)&&!(0,ce.fS)(Vt.spatialReference,Qt)&&(0,ce.JY)(Vt.spatialReference)&&(0,ce.JY)(Qt)&&!Re(Vt.spatialReference,Qt))return(0,W.it)(Ee),{pending:be(),geometries:null};return{pending:null,geometries:kt.map(Vt=>(0,Z.Wi)(Vt)?null:(0,ce.fS)(Vt.spatialReference,Qt)?Vt:(0,ce.JY)(Vt.spatialReference)&&(0,ce.JY)(Qt)?je(Vt,Qt):null)}}function ze(kt,Qt,Vt=null){if((0,Z.Wi)(kt)||(0,Z.Wi)(Qt))return null;if((0,Z.Wi)(he)||(0,Z.Wi)(me))throw new We;const yr=he._getTransformation(me,kt,Qt,Vt,Vt?.spatialReference);return null!==yr?J.Z.fromGE(yr):null}class We extends R.Z{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var Ce,kt;function je(kt,Qt){try{const Vt=Se(kt,Qt);if(null==Vt)return null;"xmin"in kt&&"xmin"in Vt&&(Vt.zmin=kt.zmin,Vt.zmax=kt.zmax);const yr=(0,pe.k)(Vt.type,kt.spatialReference,Qt);return(0,Z.pC)(yr)&&yr(Vt),Vt}catch(Vt){if(!(Vt instanceof We))throw Vt;return null}}function Re(kt,Qt,Vt){return!Vt&&(!!(0,ce.fS)(kt,Qt)||(0,ce.JY)(kt)&&(0,ce.JY)(Qt)&&!!Ws(kt,Qt,pn))}function He(kt,Qt,Vt,yr){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,D.Z)(function*(kt,Qt,Vt,yr){if(De())return(0,Q.Yn)(yr);if(Array.isArray(kt)){for(const{source:ys,dest:js,geographicTransformation:Ls}of kt)if(!Re(ys,js,Ls))return be(yr)}else if(!Re(kt,Qt,Vt))return be(yr);return(0,Q.Yn)(yr)}),Ie.apply(this,arguments)}function Ge(kt,Qt){switch(Ws(kt,Qt,pn)){case dr:return"copy3";case Sr:return"wgs84ToSphericalECEF";case Hr:return"wgs84ToWebMercator";case Ss:return"wgs84ToPlateCarree";case us:return"wgs84ToWGS84ECEF";case hr:return"webMercatorToWGS84";case Tr:return"webMercatorToSphericalECEF";case Dr:return"webMercatorToWGS84ECEF";case Dt:return"webMercatorToPlateCarree";case as:return"wgs84ECEFToWGS84";case Ps:return"wgs84ECEFToSphericalECEF";case Fs:return"wgs84ECEFToWebMercator";case gt:return"sphericalECEFToWGS84";case Gt:return"sphericalECEFToWebMercator";case bt:return"sphericalMarsPCPFToMars2000";case at:return"sphericalMoonPCPFToMoon2000";case fr:return"sphericalECEFToWGS84ECEF";case Ir:return"mars2000ToSphericalPCPF";case qt:return"moon2000ToSphericalPCPF";default:return null}}function Pe(kt,Qt,Vt){return kt?"x"in kt?Me(kt,Qt,new de.Z,Vt,0):"xmin"in kt?function ut(kt,Qt,Vt,yr,ys){const{xmin:js,ymin:Ls,xmax:Os,ymax:$s,hasZ:As,hasM:xi}=kt;return Lt(js,Ls,As?kt.zmin:ys,Qt,ui,yr)?(Vt.xmin=ui[0],Vt.ymin=ui[1],As&&(Vt.zmin=ui[2]),Lt(Os,$s,As?kt.zmax:ys,Qt,ui,yr)?(Vt.xmax=ui[0],Vt.ymax=ui[1],As&&(Vt.zmax=ui[2]),xi&&(Vt.mmin=kt.mmin,Vt.mmax=kt.mmax),Vt.spatialReference=yr,Vt):null):null}(kt,Qt,new ae.Z,Vt,0):"rings"in kt?qe(kt,Qt,new se.Z,Vt,0):"paths"in kt?function Je(kt,Qt,Vt,yr,ys){const{paths:js,hasZ:Ls,hasM:Os}=kt,$s=[];return Fr(js,Ls??!1,Os??!1,Qt,$s,yr,ys)?(Vt.paths=$s,Vt.spatialReference=yr,Vt.hasZ=Ls,Vt.hasM=Os,Vt):null}(kt,Qt,new re.Z,Vt,0):"points"in kt?function Xe(kt,Qt,Vt,yr,ys){const{points:js,hasZ:Ls,hasM:Os}=kt,$s=[],As=js.length,xi=[];for(const en of js)xi.push(en[0],en[1],Ls?en[2]:ys);if(!gr(xi,Qt,0,xi,yr,0,As))return null;for(let en=0;en<As;++en){const Mo=3*en,na=xi[Mo],Po=xi[Mo+1];$s.push(Ls&&Os?[na,Po,xi[Mo+2],js[en][3]]:Ls?[na,Po,xi[Mo+2]]:Os?[na,Po,js[en][2]]:[na,Po])}return Vt.points=$s,Vt.spatialReference=yr,Vt.hasZ=Ls,Vt.hasM=Os,Vt}(kt,Qt,new oe.Z,Vt,0):null:null}function Le(kt,Qt,Vt=Qt.spatialReference,yr=0){return(0,Z.pC)(Vt)&&(0,Z.pC)(kt.spatialReference)&&(0,Z.pC)(Me(kt,kt.spatialReference,Qt,Vt,yr))}function Me(kt,Qt,Vt,yr,ys){ui[0]=kt.x,ui[1]=kt.y;const js=kt.z;return ui[2]=void 0!==js?js:ys,gr(ui,Qt,0,ui,yr,0,1)?(Vt.x=ui[0],Vt.y=ui[1],Vt.spatialReference=yr,void 0===js?(Vt.z=void 0,Vt.hasZ=!1):(Vt.z=ui[2],Vt.hasZ=!0),void 0===kt.m?(Vt.m=void 0,Vt.hasM=!1):(Vt.m=kt.m,Vt.hasM=!0),Vt):null}function et(kt,Qt,Vt=Qt.spatialReference,yr=0){return(0,Z.pC)(kt.spatialReference)&&(0,Z.pC)(Vt)&&(0,Z.pC)(qe(kt,kt.spatialReference,Qt,Vt,yr))}function qe(kt,Qt,Vt,yr,ys){const{rings:js,hasZ:Ls,hasM:Os}=kt,$s=[];return Fr(js,Ls??!1,Os??!1,Qt,$s,yr,ys)?(Vt.rings=$s,Vt.spatialReference=yr,Vt.hasZ=Ls,Vt.hasM=Os,Vt):null}function _t(kt,Qt,Vt){if((0,Z.Wi)(Qt)||(0,Z.Wi)(Vt))return null;const yr=new de.Z({spatialReference:Vt});return gr(kt,Qt,0,ui,Vt,0,1)?(yr.x=ui[0],yr.y=ui[1],yr.z=ui[2],yr):null}function Ct(kt,Qt,Vt){return gr(kt,Qt,0,ui,Vt.spatialReference,0,1)?(Vt.x=ui[0],Vt.y=ui[1],Vt.z=ui[2],Vt):null}function vt(kt,Qt,Vt,yr=0){ui[0]=kt.x,ui[1]=kt.y;const ys=kt.z;return ui[2]=void 0!==ys?ys:yr,gr(ui,kt.spatialReference,0,Qt,Vt,0,1)}function Lt(kt,Qt,Vt,yr,ys,js){return qi[0]=kt,qi[1]=Qt,qi[2]=Vt,gr(qi,yr,0,ys,js,0,1)}function jt(kt,Qt,Vt,yr){return!((0,Z.Wi)(Qt)||(0,Z.Wi)(yr)||kt.length<2)&&(2===kt.length&&(qi[0]=kt[0],qi[1]=kt[1],qi[2]=0,kt=qi),gr(kt,Qt,0,Vt,yr,0,1))}function $t(kt,Qt){ui[0]=kt.x,ui[1]=kt.y;const Vt=kt.z;return ui[2]=void 0!==Vt?Vt:0,Wt(ui,kt.spatialReference,Qt)}function Wt(kt,Qt,Vt){return function pr(kt,Qt,Vt){if((0,Z.Wi)(Qt))return!1;const yr=zt(Qt,oi),ys=xs[yr][Ce.WGS84_COMPARABLE_LON_LAT];return!(0,Z.Wi)(ys)&&(ys(kt,0,qi,0),Vt!==qi&&(Vt[0]=qi[0],Vt[1]=qi[1],Vt.length>2&&(Vt[2]=qi[2])),!0)}(kt,Qt,Vt)}function gr(kt,Qt,Vt,yr,ys,js,Ls=1){const Os=Ws(Qt,ys,pn);if((0,Z.Wi)(Os))return!1;if(Os===dr){if(kt===yr&&Vt===js)return!0;const As=Vt+3*Ls;for(let xi=Vt,en=js;xi<As;xi++,en++)yr[en]=kt[xi];return!0}const $s=Vt+3*Ls;for(let As=Vt,xi=js;As<$s;As+=3,xi+=3)Os(kt,As,yr,xi);return!0}function ar(kt,Qt,Vt,yr,ys){(0,X.c)(ui,kt),(0,X.a)(zn,kt,Qt),jt(ui,Vt,ui,ys),jt(zn,Vt,zn,ys),(0,X.b)(yr,zn,ui),(0,X.n)(yr,yr)}function Fr(kt,Qt,Vt,yr,ys,js,Ls=0){const Os=new Array;for(const As of kt)for(const xi of As)Os.push(xi[0],xi[1],Qt?xi[2]:Ls);if(!gr(Os,yr,0,Os,js,0,Os.length/3))return!1;let $s=0;ys.length=0;for(const As of kt){const xi=new Array;for(const en of As)Qt&&Vt?xi.push([Os[$s++],Os[$s++],Os[$s++],en[3]]):Qt?xi.push([Os[$s++],Os[$s++],Os[$s++]]):Vt?(xi.push([Os[$s++],Os[$s++],en[2]]),$s++):(xi.push([Os[$s++],Os[$s++]]),$s++);ys.push(xi)}return!0}function mr(kt,Qt,Vt,yr){if((0,Z.Wi)(Qt)||(0,Z.Wi)(yr))return!1;const ys=yi(Qt,yr,Bl);if(ys.projector===dr)return Vt[0]=kt[0],Vt[1]=kt[1],Vt[2]=kt[2],Vt[3]=kt[3],!0;if((0,Z.Wi)(ys.projector))return!1;const{source:js,dest:Ls}=ys;if(Ls.spatialReferenceId===Ce.WEB_MERCATOR){const Os=xs[js.spatialReferenceId][Ce.WGS84];return!(0,Z.Wi)(Os)&&(Os(kt,0,jr,0),Hr(jr,0,Vt,0),Vt[3]=wt(jr[1],kt[2],kt[3],ee.sv.radius),!0)}if(js.spatialReferenceId!==Ce.WGS84&&js.spatialReferenceId!==Ce.CGCS2000||Ls.spatialReferenceId!==Ce.PLATE_CARREE)ys.projector(kt,0,Vt,0),Vt[3]=kt[3]*(js.metersPerUnit??1)/(Ls.metersPerUnit??1);else{const $s=xs[Ce.SPHERICAL_ECEF][Ce.PLATE_CARREE];let As=kt[3];(0,Z.pC)(xs[js.spatialReferenceId][Ce.SPHERICAL_ECEF])&&(0,Z.pC)($s)&&(As=wt(kt[1],kt[2],kt[3],ee.sv.radius)),ys.projector(kt,0,Vt,0),Vt[3]=As}return!0}function wt(kt,Qt,Vt,yr){const ys=yr+Qt;if(ys<yr/2||Vt>ys)return Number.MAX_VALUE;const js=Math.abs(yo*kt)+Math.asin(Vt/ys);return js>=Math.PI/2?Number.MAX_VALUE:Vt/Math.cos(js)}function or(kt,Qt,Vt,yr){return!(null==kt||((0,ce.fS)(Qt,yr)?((0,Y.JG)(Vt,kt),0):(qi[0]=kt[0],qi[1]=kt[1],qi[2]=0,!gr(qi,Qt,0,qi,yr,0,1)||(Vt[0]=qi[0],Vt[1]=qi[1],qi[0]=kt[2],qi[1]=kt[3],qi[2]=0,!gr(qi,Qt,0,qi,yr,0,1)||(Vt[2]=qi[0],Vt[3]=qi[1],0)))))}function sr(kt,Qt,Vt,yr){if((0,Z.Wi)(Qt)||(0,Z.Wi)(yr))return!1;const ys=zt(Qt,oi),js=zt(yr,kn);if(ys===js&&ys!==Ce.UNKNOWN||(0,ce.fS)(Qt,yr))return Vt[0]=1,Vt[1]=1,Vt[2]=1,!0;if(ys===Ce.SPHERICAL_ECEF){const Ls=(0,X.l)(kt),Os=Ls/Math.sqrt(kt[0]*kt[0]+kt[1]*kt[1]),$s=Ls/ee.sv.radius;if(js===Ce.WEB_MERCATOR)return Vt[0]=Os*$s,Vt[1]=Os*$s,Vt[2]=1,!0;if(js===Ce.WGS84||js===Ce.CGCS2000){const As=Jr;return Vt[0]=As*Os*$s,Vt[1]=As*$s,Vt[2]=1,!0}}else if(ys===Ce.PLATE_CARREE){if(js===Ce.WGS84||js===Ce.CGCS2000)return Vt[0]=Jr,Vt[1]=Jr,Vt[2]=1,!0;if(js===Ce.WEB_MERCATOR){const Ls=kt[1]/ee.sv.radius;return Vt[0]=1,Vt[1]=1/Math.cos(Ls),Vt[2]=1,!0}}return!1}function rr(kt,Qt,Vt,yr){if((0,Z.Wi)(kt)||(0,Z.Wi)(yr))return!1;const ys=zt(kt,oi),js=zt(yr,kn);if(ys===js&&!Et(js)&&(ys!==Ce.UNKNOWN||(0,ce.fS)(kt,yr)))return(0,H.f)(Vt,Qt),!0;if(Et(js)){const Ls=xs[ys][Ce.LON_LAT],Os=xs[Ce.LON_LAT][js];return!(0,Z.Wi)(Ls)&&!(0,Z.Wi)(Os)&&(Ls(Qt,0,jr,0),Os(jr,0,Gi,0),St(yo*jr[0],yo*jr[1],Vt),Vt[12]=Gi[0],Vt[13]=Gi[1],Vt[14]=Gi[2],!0)}if((js===Ce.WEB_MERCATOR||js===Ce.PLATE_CARREE)&&(ys===Ce.WGS84||ys===Ce.CGCS2000&&js===Ce.PLATE_CARREE||ys===Ce.SPHERICAL_ECEF||ys===Ce.WEB_MERCATOR)){const Ls=xs[ys][Ce.LON_LAT],Os=xs[Ce.LON_LAT][js];return!(0,Z.Wi)(Ls)&&!(0,Z.Wi)(Os)&&(Ls(Qt,0,jr,0),Os(jr,0,Gi,0),ys===Ce.SPHERICAL_ECEF?function Ft(kt,Qt,Vt){St(kt,Qt,Vt),(0,H.t)(Vt,Vt)}(yo*jr[0],yo*jr[1],Vt):(0,H.i)(Vt),Vt[12]=Gi[0],Vt[13]=Gi[1],Vt[14]=Gi[2],!0)}return!1}function Et(kt){return kt===Ce.SPHERICAL_ECEF||kt===Ce.SPHERICAL_MARS_PCPF||kt===Ce.SPHERICAL_MOON_PCPF}function St(kt,Qt,Vt){const yr=Math.sin(kt),ys=Math.cos(kt),js=Math.sin(Qt),Ls=Math.cos(Qt),Os=Vt;return Os[0]=-yr,Os[4]=-js*ys,Os[8]=Ls*ys,Os[12]=0,Os[1]=ys,Os[5]=-js*yr,Os[9]=Ls*yr,Os[13]=0,Os[2]=0,Os[6]=Ls,Os[10]=js,Os[14]=0,Os[3]=0,Os[7]=0,Os[11]=0,Os[15]=1,Os}function zt(kt,Qt){return kt?Qt.spatialReference===kt?Qt.spatialReferenceId:(Qt.spatialReference=kt,"metersPerUnit"in Qt&&(Qt.metersPerUnit=(0,$.c9)(kt,1)),Qt.spatialReferenceId=kt.wkt===j.GG.wkt?Ce.SPHERICAL_ECEF:(0,ce.oR)(kt)?Ce.WGS84:(0,ce.sS)(kt)?Ce.WEB_MERCATOR:(0,ce.QM)(kt)?Ce.PLATE_CARREE:kt.wkt===j.wY.wkt?Ce.WGS84_ECEF:kt.wkid===ue.W.CGCS2000?Ce.CGCS2000:kt.wkt===j.HQ.wkt?Ce.SPHERICAL_MARS_PCPF:kt.wkt===j.VY.wkt?Ce.SPHERICAL_MOON_PCPF:(0,ce.BZ)(kt)?Ce.GCSMARS2000:(0,ce.V2)(kt)?Ce.GCSMOON2000:Ce.UNKNOWN):Ce.UNKNOWN}function dr(kt,Qt,Vt,yr){kt!==Vt&&(Vt[yr++]=kt[Qt++],Vt[yr++]=kt[Qt++],Vt[yr]=kt[Qt])}function hr(kt,Qt,Vt,yr){Vt[yr++]=Yo*(kt[Qt++]/ee.sv.radius),Vt[yr++]=Yo*(Math.PI/2-2*Math.atan(Math.exp(-kt[Qt++]/ee.sv.radius))),Vt[yr]=kt[Qt]}function Tr(kt,Qt,Vt,yr){hr(kt,Qt,Vt,yr),Sr(Vt,yr,Vt,yr)}function Dr(kt,Qt,Vt,yr){hr(kt,Qt,Vt,yr),us(Vt,yr,Vt,yr)}function Lr(kt,Qt,Vt,yr,ys){const js=.4999999*Math.PI,Ls=(0,G.uZ)(yo*kt[Qt+1],-js,js),Os=Math.sin(Ls);Vt[yr++]=yo*kt[Qt]*ys.radius,Vt[yr++]=ys.halfSemiMajorAxis*Math.log((1+Os)/(1-Os)),Vt[yr]=kt[Qt+2]}function Hr(kt,Qt,Vt,yr){Lr(kt,Qt,Vt,yr,ee.sv)}(kt=Ce||(Ce={}))[kt.UNKNOWN=0]="UNKNOWN",kt[kt.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",kt[kt.WGS84=2]="WGS84",kt[kt.WEB_MERCATOR=3]="WEB_MERCATOR",kt[kt.WGS84_ECEF=4]="WGS84_ECEF",kt[kt.CGCS2000=5]="CGCS2000",kt[kt.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",kt[kt.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",kt[kt.GCSMARS2000=8]="GCSMARS2000",kt[kt.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",kt[kt.GCSMOON2000=10]="GCSMOON2000",kt[kt.LON_LAT=11]="LON_LAT",kt[kt.PLATE_CARREE=12]="PLATE_CARREE";const Qr=ee.sv.radius*Math.PI/180,Jr=180/(ee.sv.radius*Math.PI);function Ss(kt,Qt,Vt,yr){Vt[yr]=kt[Qt]*Qr,Vt[yr+1]=kt[Qt+1]*Qr,Vt[yr+2]=kt[Qt+2]}function Cs(kt,Qt,Vt,yr){Vt[yr]=kt[Qt]*Jr,Vt[yr+1]=kt[Qt+1]*Jr,Vt[yr+2]=kt[Qt+2]}function Dt(kt,Qt,Vt,yr){hr(kt,Qt,Vt,yr),Ss(Vt,yr,Vt,yr)}function Or(kt){if((0,Z.Wi)(kt))return!1;const Qt=zt(kt,oi);return!!xs[Qt][Ce.WGS84_COMPARABLE_LON_LAT]}function gs(kt,Qt,Vt,yr){const ys=Math.cos(Vt);kt[0]=Math.cos(Qt)*ys*yr,kt[1]=Math.sin(Qt)*ys*yr,kt[2]=Math.sin(Vt)*yr}function Kr(kt,Qt,Vt,yr,ys){const js=ys+kt[Qt+2],Ls=yo*kt[Qt+1],Os=yo*kt[Qt],$s=Math.cos(Ls);Vt[yr++]=Math.cos(Os)*$s*js,Vt[yr++]=Math.sin(Os)*$s*js,Vt[yr]=Math.sin(Ls)*js}function qt(kt,Qt,Vt,yr){Kr(kt,Qt,Vt,yr,ee.Z1.radius)}function Ir(kt,Qt,Vt,yr){Kr(kt,Qt,Vt,yr,ee.yr.radius)}function Sr(kt,Qt,Vt,yr){Kr(kt,Qt,Vt,yr,ee.sv.radius)}function fs(kt,Qt,Vt,yr,ys){const js=kt[Qt],Ls=kt[Qt+1],Os=kt[Qt+2],$s=Math.sqrt(js*js+Ls*Ls+Os*Os),As=(0,G.Kt)(Os/(0===$s?1:$s)),xi=Math.atan2(Ls,js);Vt[yr++]=Yo*xi,Vt[yr++]=Yo*As,Vt[yr]=$s-ys}function at(kt,Qt,Vt,yr){fs(kt,Qt,Vt,yr,ee.Z1.radius)}function bt(kt,Qt,Vt,yr){fs(kt,Qt,Vt,yr,ee.yr.radius)}function gt(kt,Qt,Vt,yr){fs(kt,Qt,Vt,yr,ee.sv.radius)}function Gt(kt,Qt,Vt,yr){gt(kt,Qt,Vt,yr),Hr(Vt,yr,Vt,yr)}function fr(kt,Qt,Vt,yr){gt(kt,Qt,Vt,yr),us(Vt,yr,Vt,yr)}function us(kt,Qt,Vt,yr){!function Ar(kt,Qt,Vt,yr,ys){const js=yo*kt[Qt],Ls=yo*kt[Qt+1],Os=kt[Qt+2],$s=Math.sin(Ls),As=Math.cos(Ls),xi=ys.radius/Math.sqrt(1-ys.eccentricitySquared*$s*$s);Vt[yr++]=(xi+Os)*As*Math.cos(js),Vt[yr++]=(xi+Os)*As*Math.sin(js),Vt[yr++]=(xi*(1-ys.eccentricitySquared)+Os)*$s}(kt,Qt,Vt,yr,ee.sv)}function as(kt,Qt,Vt,yr){const ys=ie.cD,js=kt[Qt],Ls=kt[Qt+1],Os=kt[Qt+2];let $s,As,xi,en,Mo,na,Po,ja,An,Ki,_n,Ma,Ei,nc,Jn,jl,oc,Lo,Fa,Pa,cr;$s=Math.abs(Os),As=js*js+Ls*Ls,xi=Math.sqrt(As),en=As+Os*Os,Mo=Math.sqrt(en),Pa=Math.atan2(Ls,js),na=Os*Os/en,Po=As/en,nc=ys.a2/Mo,Jn=ys.a3-ys.a4/Mo,Po>.3?(ja=$s/Mo*(1+Po*(ys.a1+nc+na*Jn)/Mo),Fa=Math.asin(ja),Ki=ja*ja,An=Math.sqrt(1-Ki)):(An=xi/Mo*(1-na*(ys.a5-nc-Po*Jn)/Mo),Fa=Math.acos(An),Ki=1-An*An,ja=Math.sqrt(Ki)),_n=1-ee.sv.eccentricitySquared*Ki,Ma=ee.sv.radius/Math.sqrt(_n),Ei=ys.a6*Ma,nc=xi-Ma*An,Jn=$s-Ei*ja,oc=An*nc+ja*Jn,jl=An*Jn-ja*nc,Lo=jl/(Ei/_n+oc),Fa+=Lo,cr=oc+jl*Lo/2,Os<0&&(Fa=-Fa),Vt[yr++]=Yo*Pa,Vt[yr++]=Yo*Fa,Vt[yr]=cr}function Ps(kt,Qt,Vt,yr){as(kt,Qt,Vt,yr),Sr(Vt,yr,Vt,yr)}function Fs(kt,Qt,Vt,yr){as(kt,Qt,Vt,yr),Hr(Vt,yr,Vt,yr)}const xs={[Ce.WGS84]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:dr,[Ce.SPHERICAL_ECEF]:Sr,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:Hr,[Ce.PLATE_CARREE]:Ss,[Ce.WGS84]:dr,[Ce.WGS84_ECEF]:us},[Ce.CGCS2000]:{[Ce.CGCS2000]:dr,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:dr,[Ce.SPHERICAL_ECEF]:Sr,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:Ss,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:us},[Ce.GCSMARS2000]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:dr,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:null,[Ce.SPHERICAL_ECEF]:null,[Ce.SPHERICAL_MARS_PCPF]:Ir,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:null,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:null},[Ce.GCSMOON2000]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:dr,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:null,[Ce.SPHERICAL_ECEF]:null,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:qt,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:null,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:null},[Ce.WEB_MERCATOR]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:hr,[Ce.WGS84_COMPARABLE_LON_LAT]:hr,[Ce.SPHERICAL_ECEF]:Tr,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:dr,[Ce.PLATE_CARREE]:Dt,[Ce.WGS84]:hr,[Ce.WGS84_ECEF]:Dr},[Ce.WGS84_ECEF]:{[Ce.CGCS2000]:as,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:as,[Ce.WGS84_COMPARABLE_LON_LAT]:as,[Ce.SPHERICAL_ECEF]:Ps,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:Fs,[Ce.PLATE_CARREE]:function ct(kt,Qt,Vt,yr){as(kt,Qt,Vt,yr),Ss(Vt,yr,Vt,yr)},[Ce.WGS84]:as,[Ce.WGS84_ECEF]:dr},[Ce.SPHERICAL_ECEF]:{[Ce.CGCS2000]:gt,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:gt,[Ce.WGS84_COMPARABLE_LON_LAT]:gt,[Ce.SPHERICAL_ECEF]:dr,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:Gt,[Ce.PLATE_CARREE]:function At(kt,Qt,Vt,yr){gt(kt,Qt,Vt,yr),Ss(Vt,yr,Vt,yr)},[Ce.WGS84]:gt,[Ce.WGS84_ECEF]:fr},[Ce.SPHERICAL_MARS_PCPF]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:bt,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:bt,[Ce.WGS84_COMPARABLE_LON_LAT]:null,[Ce.SPHERICAL_ECEF]:null,[Ce.SPHERICAL_MARS_PCPF]:dr,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:null,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:null},[Ce.SPHERICAL_MOON_PCPF]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:at,[Ce.LON_LAT]:at,[Ce.WGS84_COMPARABLE_LON_LAT]:null,[Ce.SPHERICAL_ECEF]:null,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:dr,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:null,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:null},[Ce.UNKNOWN]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:null,[Ce.WGS84_COMPARABLE_LON_LAT]:null,[Ce.SPHERICAL_ECEF]:null,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:dr,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:null,[Ce.WGS84]:null,[Ce.WGS84_ECEF]:null},[Ce.LON_LAT]:{[Ce.CGCS2000]:dr,[Ce.GCSMARS2000]:dr,[Ce.GCSMOON2000]:dr,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:dr,[Ce.SPHERICAL_ECEF]:Sr,[Ce.SPHERICAL_MARS_PCPF]:Ir,[Ce.SPHERICAL_MOON_PCPF]:qt,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:Hr,[Ce.PLATE_CARREE]:Ss,[Ce.WGS84]:dr,[Ce.WGS84_ECEF]:us},[Ce.WGS84_COMPARABLE_LON_LAT]:{[Ce.CGCS2000]:null,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:dr,[Ce.WGS84_COMPARABLE_LON_LAT]:dr,[Ce.SPHERICAL_ECEF]:Sr,[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:null,[Ce.PLATE_CARREE]:Ss,[Ce.WGS84]:dr,[Ce.WGS84_ECEF]:us},[Ce.PLATE_CARREE]:{[Ce.CGCS2000]:Cs,[Ce.GCSMARS2000]:null,[Ce.GCSMOON2000]:null,[Ce.LON_LAT]:Cs,[Ce.WGS84_COMPARABLE_LON_LAT]:Cs,[Ce.SPHERICAL_ECEF]:function Kt(kt,Qt,Vt,yr){Cs(kt,Qt,Vt,yr),Sr(Vt,yr,Vt,yr)},[Ce.SPHERICAL_MARS_PCPF]:null,[Ce.SPHERICAL_MOON_PCPF]:null,[Ce.UNKNOWN]:null,[Ce.WEB_MERCATOR]:function tr(kt,Qt,Vt,yr){Cs(kt,Qt,Vt,yr),Hr(Vt,yr,Vt,yr)},[Ce.PLATE_CARREE]:dr,[Ce.WGS84]:Cs,[Ce.WGS84_ECEF]:function _r(kt,Qt,Vt,yr){Cs(kt,Qt,Vt,yr),us(Vt,yr,Vt,yr)}}};function Ws(kt,Qt,Vt=hn()){return(0,Z.Wi)(kt)||(0,Z.Wi)(Qt)?null:yi(kt,Qt,Vt).projector}function yi(kt,Qt,Vt){if((0,Z.Wi)(kt)||(0,Z.Wi)(Qt)||Vt.source.spatialReference===kt&&Vt.dest.spatialReference===Qt)return Vt;const yr=zt(kt,Vt.source),ys=zt(Qt,Vt.dest);return Vt.projector=yr===Ce.UNKNOWN&&ys===Ce.UNKNOWN?(0,ce.fS)(kt,Qt)?dr:null:xs[yr][ys],Vt}function hn(){return{source:{spatialReference:null,spatialReferenceId:Ce.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Ce.UNKNOWN,metersPerUnit:1},projector:dr}}const oi={spatialReference:null,spatialReferenceId:Ce.UNKNOWN},kn={spatialReference:null,spatialReferenceId:Ce.UNKNOWN},pn=hn(),Bl=hn(),yo=(0,G.Vl)(1),Yo=(0,G.BV)(1),qi=(0,te.c)(),jr=(0,te.c)(),Gi=(0,te.c)(),ui=(0,te.c)(),zn=(0,te.c)()},12080:(nt,Ae,v)=>{"use strict";v.d(Ae,{GG:()=>$,HQ:()=>W,Iu:()=>ae,VY:()=>B,e8:()=>oe,rS:()=>te,wY:()=>H});var D=v(62208),R=v(65234),G=v(94425),Z=v(37053);function Q(le){return new R.Z({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${le.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const $=Q(G.sv),W=Q(G.yr),B=Q(G.Z1),H=new R.Z({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${G.sv.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function te(le){return le&&((0,Z.BZ)(le)||le===W)?W:le&&((0,Z.V2)(le)||le===B)?B:$}function ae(le){return(0,D.pC)(le)&&((0,Z.BZ)(le)||le===W)?G.yr:(0,D.pC)(le)&&((0,Z.V2)(le)||le===B)?G.Z1:G.sv}function oe(le){return(0,Z.o$)(le)?G.yr:(0,Z.ME)(le)?G.Z1:G.sv}},78172:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{R:()=>D}),(R=D||(D={}))[R.X=0]="X",R[R.Y=1]="Y",R[R.Z=2]="Z"},94425:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z1:()=>Z,sv:()=>R,yr:()=>G});class D{constructor($,W,B,H){this.semiMajorAxis=$,this.flattening=W,this.outerAtmosphereRimWidth=B,this.semiMinorAxis=this.semiMajorAxis*(1-this.flattening),this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=H||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const R=new D(6378137,1/298.257223563,3e5,.006694379990137799),G=new D(3396190,1/169.8944472236118,23e4),Z=new D(1737400,0,0)},98346:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>G});let D=0;class R{constructor(Q){this.uid=D++,Q?(this._wkt=null!=Q.wkt?Q.wkt:null,this._wkid=null!=Q.wkid?Q.wkid:-1,this._isInverse=null!=Q.isInverse&&!0===Q.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(Q){const $=new R;return $._wkt=Q.wkt,$._wkid=Q.wkid,$._isInverse=Q.isInverse,$}get wkt(){return this._wkt}set wkt(Q){this._wkt=Q,this.uid=D++}get wkid(){return this._wkid}set wkid(Q){this._wkid=Q,this.uid=D++}get isInverse(){return this._isInverse}set isInverse(Q){this._isInverse=Q,this.uid=D++}getInverse(){const Q=new R;return Q._wkt=this.wkt,Q._wkid=this._wkid,Q._isInverse=!this.isInverse,Q}}class G{constructor(Q){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,Q&&Q.steps)for(const $ of Q.steps)this.steps.push($ instanceof R?$:new R({wkid:$.wkid,wkt:$.wkt,isInverse:$.isInverse}))}static cacheKey(Q,$){return[null!=Q.wkid?Q.wkid.toString():"-1",null!=Q.wkt?Q.wkt.toString():"",null!=$.wkid?$.wkid.toString():"-1",null!=$.wkt?$.wkt.toString():""].join(",")}static fromGE(Q){const $=new G;let W="";for(const B of Q.steps){const H=R.fromGE(B);$.steps.push(H),W+=H.uid.toString()+","}return $._cachedProjection={},$._gtlistentry=null,$._chain=W,$}getInverse(){const Q=new G;Q.steps=[];for(let $=this.steps.length-1;$>=0;$--)Q.steps.push(this.steps[$].getInverse());return Q}getGTListEntry(){let Q="";for(const $ of this.steps)Q+=$.uid.toString()+",";return Q!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=Q),this._gtlistentry}assignCachedGe(Q,$,W){this._cachedProjection[G.cacheKey(Q,$)]=W}getCachedGeTransformation(Q,$){let W="";for(const H of this.steps)W+=H.uid.toString()+",";W!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=W);const B=this._cachedProjection[G.cacheKey(Q,$)];return void 0===B?null:B}}},61751:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var ae,D=v(17626),R=v(86810),G=v(58817),Z=v(63290),Q=v(77712),$=v(66656),W=v(76898),B=v(90912),H=v(45348),X=v(27530),te=v(92529);const oe="esri.geometry.support.MeshComponent",le=Z.Z.getLogger(oe);let de=ae=class extends R.wq{constructor(re){super(re),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(re){return(0,B.TJ)(ae,re)}castFaces(re){return(0,te.X)(re,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},le)}castMaterial(re){return(0,B.TJ)(re&&"object"==typeof re&&("metallic"in re||"roughness"in re||"metallicRoughnessTexture"in re)?X.Z:H.Z,re)}clone(){return new ae({faces:(0,G.d9)(this.faces),shading:this.shading,material:(0,G.d9)(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(re,j){const Y={faces:(0,G.d9)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(re,j):null,trustSourceNormals:this.trustSourceNormals};return new ae(Y)}};(0,D._)([(0,Q.Cb)({json:{write:!0}})],de.prototype,"faces",void 0),(0,D._)([(0,$.p)("faces")],de.prototype,"castFaces",null),(0,D._)([(0,Q.Cb)({type:H.Z,json:{write:!0}})],de.prototype,"material",void 0),(0,D._)([(0,$.p)("material")],de.prototype,"castMaterial",null),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],de.prototype,"shading",void 0),(0,D._)([(0,Q.Cb)({type:Boolean})],de.prototype,"trustSourceNormals",void 0),de=ae=(0,D._)([(0,W.j)(oe)],de);const se=de},45348:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),R=v(91558),G=v(86810),Z=v(62208),Q=v(77712),B=(v(85931),v(90912),v(76898)),H=v(1607);let te=X=class extends G.wq{constructor(oe){super(oe),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(oe,le){const de=(0,Z.pC)(oe)?oe.get(this):null;if(de)return de;const se=new X(this.clonePropertiesWithDeduplication(le));return(0,Z.pC)(oe)&&oe.set(this,se),se}clonePropertiesWithDeduplication(oe){return{color:(0,Z.pC)(this.color)?this.color.clone():null,colorTexture:(0,Z.pC)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(oe):null,normalTexture:(0,Z.pC)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(oe):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(0,Z.pC)(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:(0,Z.pC)(this.normalTextureTransform)?this.normalTextureTransform:null}}};(0,D._)([(0,Q.Cb)({type:R.Z,json:{write:!0}})],te.prototype,"color",void 0),(0,D._)([(0,Q.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"colorTexture",void 0),(0,D._)([(0,Q.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"normalTexture",void 0),(0,D._)([(0,Q.Cb)({nonNullable:!0,json:{write:!0}})],te.prototype,"alphaMode",void 0),(0,D._)([(0,Q.Cb)({nonNullable:!0,json:{write:!0}})],te.prototype,"alphaCutoff",void 0),(0,D._)([(0,Q.Cb)({nonNullable:!0,json:{write:!0}})],te.prototype,"doubleSided",void 0),(0,D._)([(0,Q.Cb)()],te.prototype,"colorTextureTransform",void 0),(0,D._)([(0,Q.Cb)()],te.prototype,"normalTextureTransform",void 0),te=X=(0,D._)([(0,B.j)("esri.geometry.support.MeshMaterial")],te);const ae=te},27530:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),R=v(91558),G=v(62208),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(45348),H=v(1607);let te=X=class extends B.Z{constructor(oe){super(oe),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(oe,le){const de=(0,G.pC)(oe)?oe.get(this):null;if(de)return de;const se=new X(this.clonePropertiesWithDeduplication(le));return(0,G.pC)(oe)&&oe.set(this,se),se}clonePropertiesWithDeduplication(oe){return{...super.clonePropertiesWithDeduplication(oe),emissiveColor:(0,G.pC)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:(0,G.pC)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(oe):null,occlusionTexture:(0,G.pC)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(oe):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(0,G.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(oe):null,occlusionTextureTransform:(0,G.pC)(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:(0,G.pC)(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:(0,G.pC)(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};(0,D._)([(0,Z.Cb)({type:R.Z,json:{write:!0}})],te.prototype,"emissiveColor",void 0),(0,D._)([(0,Z.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"emissiveTexture",void 0),(0,D._)([(0,Z.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"occlusionTexture",void 0),(0,D._)([(0,Z.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],te.prototype,"metallic",void 0),(0,D._)([(0,Z.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],te.prototype,"roughness",void 0),(0,D._)([(0,Z.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"metallicRoughnessTexture",void 0),(0,D._)([(0,Z.Cb)()],te.prototype,"occlusionTextureTransform",void 0),(0,D._)([(0,Z.Cb)()],te.prototype,"emissiveTextureTransform",void 0),(0,D._)([(0,Z.Cb)()],te.prototype,"metallicRoughnessTextureTransform",void 0),te=X=(0,D._)([(0,W.j)("esri.geometry.support.MeshMaterialMetallicRoughness")],te);const ae=te},1607:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var ae,D=v(17626),G=(v(8314),v(90740)),Z=v(86810),Q=v(77712),W=(v(85931),v(90912)),B=v(68653),H=v(76898),X=v(99433),te=v(29840);const oe=new WeakMap;let le=0,de=ae=class extends Z.wq{constructor(re){super(re),this.wrap="repeat"}get url(){return this._get("url")||null}set url(re){this._set("url",re),re&&this._set("data",null)}get data(){return this._get("data")||null}set data(re){this._set("data",re),re&&this._set("url",null)}writeData(re,j,Y,ee){if(re instanceof HTMLImageElement){const ie={type:"image-element",src:(0,te.t)(re.src,ee),crossOrigin:re.crossOrigin};j[Y]=ie}else if(re instanceof HTMLCanvasElement){const ie=re.getContext("2d").getImageData(0,0,re.width,re.height),J={type:"canvas-element",imageData:this._encodeImageData(ie)};j[Y]=J}else if(re instanceof HTMLVideoElement){const ie={type:"video-element",src:(0,te.t)(re.src,ee),autoplay:re.autoplay,loop:re.loop,muted:re.muted,crossOrigin:re.crossOrigin,preload:re.preload};j[Y]=ie}else{const ie={type:"image-data",imageData:this._encodeImageData(re)};j[Y]=ie}}readData(re){switch(re.type){case"image-element":{const j=new Image;return j.src=re.src,j.crossOrigin=re.crossOrigin,j}case"canvas-element":{const j=this._decodeImageData(re.imageData),Y=document.createElement("canvas");return Y.width=j.width,Y.height=j.height,Y.getContext("2d").putImageData(j,0,0),Y}case"image-data":return this._decodeImageData(re.imageData);case"video-element":{const j=document.createElement("video");return j.src=re.src,j.crossOrigin=re.crossOrigin,j.autoplay=re.autoplay,j.loop=re.loop,j.muted=re.muted,j.preload=re.preload,j}default:return}}get transparent(){const re=this.data,j=this.url;if(re instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(re.getContext("2d").getImageData(0,0,re.width,re.height));if(re instanceof ImageData)return this._imageDataContainsTransparent(re);if(j){const Y=j.substr(j.length-4,4).toLowerCase(),ee=j.substr(0,15).toLocaleLowerCase();if(".png"===Y||"data:image/png;"===ee)return!0}return!1}set transparent(re){this._overrideIfSome("transparent",re)}get contentHash(){const re="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",j=(Y="")=>`d:${Y},t:${this.transparent},w:${re}`;return null!=this.url?j(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?j(this.data.src):(oe.has(this.data)||oe.set(this.data,++le),j(oe.get(this.data))):j()}clone(){const re={url:this.url,data:this.data,wrap:this._cloneWrap()};return new ae(re)}cloneWithDeduplication(re){const j=re.get(this);if(j)return j;const Y=this.clone();return re.set(this,Y),Y}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(re){let j="";for(let Y=0;Y<re.data.length;Y++)j+=String.fromCharCode(re.data[Y]);return{data:btoa(j),width:re.width,height:re.height}}_decodeImageData(re){const j=atob(re.data),Y=new Uint8ClampedArray(j.length);for(let ee=0;ee<j.length;ee++)Y[ee]=j.charCodeAt(ee);return(0,G.J)(Y,re.width,re.height)}_imageDataContainsTransparent(re){for(let j=3;j<re.data.length;j+=4)if(255!==re.data[j])return!0;return!1}static from(re){return"string"==typeof re?new ae({url:re}):re instanceof HTMLImageElement||re instanceof HTMLCanvasElement||re instanceof ImageData||re instanceof HTMLVideoElement?new ae({data:re}):(0,W.TJ)(ae,re)}};(0,D._)([(0,Q.Cb)({type:String,json:{write:te.w}})],de.prototype,"url",null),(0,D._)([(0,Q.Cb)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,Q.Cb)()],de.prototype,"data",null),(0,D._)([(0,X.c)("data")],de.prototype,"writeData",null),(0,D._)([(0,B.r)("data")],de.prototype,"readData",null),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],de.prototype,"transparent",null),(0,D._)([(0,Q.Cb)({json:{write:!0}})],de.prototype,"wrap",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],de.prototype,"contentHash",null),de=ae=(0,D._)([(0,H.j)("esri.geometry.support.MeshTexture")],de);const se=de},92529:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>te,X:()=>oe});var B,D=v(17626),R=v(86810),G=v(58817),Z=v(63290),Q=v(77712),$=v(66656),W=v(76898);const H="esri.geometry.support.MeshVertexAttributes",X=Z.Z.getLogger(H);let te=B=class extends R.wq{constructor(se){super(se),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(se){return oe(se,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},X)}castPosition(se){return se&&se instanceof Float32Array&&X.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),oe(se,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},X)}castUv(se){return oe(se,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},X)}castNormal(se){return oe(se,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},X)}castTangent(se){return oe(se,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},X)}clone(){const se={position:(0,G.d9)(this.position),uv:(0,G.d9)(this.uv),normal:(0,G.d9)(this.normal),tangent:(0,G.d9)(this.tangent),color:(0,G.d9)(this.color)};return new B(se)}clonePositional(){const se={position:(0,G.d9)(this.position),normal:(0,G.d9)(this.normal),tangent:(0,G.d9)(this.tangent),uv:this.uv,color:this.color};return new B(se)}};function ae(se,re,j,Y){const{loggerTag:ee,stride:ie}=re;return se.length%ie!=0?(Y.error(ee,`Invalid array length, expected a multiple of ${ie}`),new j([])):se}function oe(se,re,j,Y,ee){if(!se)return se;if(se instanceof re)return ae(se,Y,re,ee);for(const ie of j)if(se instanceof ie)return ae(new re(se),Y,re,ee);if(Array.isArray(se))return ae(new re(se),Y,re,ee);{const ie=j.map(J=>`'${J.name}'`);return ee.error(`Failed to set property, expected one of ${ie}, but got ${se.constructor.name}`),new re([])}}function le(se,re,j){re[j]=function de(se){const re=new Array(se.length);for(let j=0;j<se.length;j++)re[j]=se[j];return re}(se)}(0,D._)([(0,Q.Cb)({json:{write:le}})],te.prototype,"color",void 0),(0,D._)([(0,$.p)("color")],te.prototype,"castColor",null),(0,D._)([(0,Q.Cb)({nonNullable:!0,json:{write:le}})],te.prototype,"position",void 0),(0,D._)([(0,$.p)("position")],te.prototype,"castPosition",null),(0,D._)([(0,Q.Cb)({json:{write:le}})],te.prototype,"uv",void 0),(0,D._)([(0,$.p)("uv")],te.prototype,"castUv",null),(0,D._)([(0,Q.Cb)({json:{write:le}})],te.prototype,"normal",void 0),(0,D._)([(0,$.p)("normal")],te.prototype,"castNormal",null),(0,D._)([(0,Q.Cb)({json:{write:le}})],te.prototype,"tangent",void 0),(0,D._)([(0,$.p)("tangent")],te.prototype,"castTangent",null),te=B=(0,D._)([(0,W.j)(H)],te)},6178:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{W:()=>D}),(R=D||(D={}))[R.CGCS2000=4490]="CGCS2000",R[R.GCSMARS2000=104971]="GCSMARS2000",R[R.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",R[R.GCSMOON2000=104903]="GCSMOON2000"},84029:(nt,Ae,v)=>{"use strict";let D;v.d(Ae,{Z:()=>R});const R={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(D=2e3;D<=2045;D++)R[D]=0;for(D=2056;D<=2065;D++)R[D]=0;for(D=2067;D<=2135;D++)R[D]=0;for(D=2137;D<=2154;D++)R[D]=0;for(D=2161;D<=2170;D++)R[D]=0;for(D=2172;D<=2193;D++)R[D]=0;for(D=2195;D<=2198;D++)R[D]=0;for(D=2200;D<=2203;D++)R[D]=0;for(D=2205;D<=2217;D++)R[D]=0;for(D=2222;D<=2224;D++)R[D]=1;for(D=2225;D<=2250;D++)R[D]=2;for(D=2251;D<=2253;D++)R[D]=1;for(D=2257;D<=2264;D++)R[D]=2;for(D=2274;D<=2279;D++)R[D]=2;for(D=2280;D<=2282;D++)R[D]=1;for(D=2283;D<=2289;D++)R[D]=2;for(D=2290;D<=2292;D++)R[D]=0;for(D=2308;D<=2313;D++)R[D]=0;for(D=2315;D<=2491;D++)R[D]=0;for(D=2494;D<=2866;D++)R[D]=0;for(D=2867;D<=2869;D++)R[D]=1;for(D=2870;D<=2888;D++)R[D]=2;for(D=2891;D<=2895;D++)R[D]=2;for(D=2896;D<=2898;D++)R[D]=1;for(D=2902;D<=2908;D++)R[D]=2;for(D=2915;D<=2920;D++)R[D]=2;for(D=2921;D<=2923;D++)R[D]=1;for(D=2924;D<=2930;D++)R[D]=2;for(D=2931;D<=2962;D++)R[D]=0;for(D=2964;D<=2968;D++)R[D]=2;for(D=2969;D<=2973;D++)R[D]=0;for(D=2975;D<=2991;D++)R[D]=0;for(D=2995;D<=3051;D++)R[D]=0;for(D=3054;D<=3079;D++)R[D]=0;for(D=3081;D<=3088;D++)R[D]=0;for(D=3092;D<=3101;D++)R[D]=0;for(D=3106;D<=3138;D++)R[D]=0;for(D=3146;D<=3151;D++)R[D]=0;for(D=3153;D<=3166;D++)R[D]=0;for(D=3168;D<=3172;D++)R[D]=0;for(D=3174;D<=3203;D++)R[D]=0;for(D=3294;D<=3358;D++)R[D]=0;for(D=3367;D<=3403;D++)R[D]=0;for(D=3408;D<=3416;D++)R[D]=0;for(D=3417;D<=3438;D++)R[D]=2;for(D=3441;D<=3446;D++)R[D]=2;for(D=3447;D<=3450;D++)R[D]=0;for(D=3451;D<=3459;D++)R[D]=2;for(D=3460;D<=3478;D++)R[D]=0;for(D=3554;D<=3559;D++)R[D]=0;for(D=3560;D<=3570;D++)R[D]=2;for(D=3571;D<=3581;D++)R[D]=0;for(D=3594;D<=3597;D++)R[D]=0;for(D=3601;D<=3604;D++)R[D]=0;for(D=3637;D<=3639;D++)R[D]=0;for(D=3665;D<=3667;D++)R[D]=0;for(D=3693;D<=3695;D++)R[D]=0;for(D=3701;D<=3727;D++)R[D]=0;for(D=3728;D<=3739;D++)R[D]=2;for(D=3740;D<=3751;D++)R[D]=0;for(D=3753;D<=3760;D++)R[D]=2;for(D=3761;D<=3773;D++)R[D]=0;for(D=3775;D<=3777;D++)R[D]=0;for(D=3779;D<=3781;D++)R[D]=0;for(D=3783;D<=3785;D++)R[D]=0;for(D=3788;D<=3791;D++)R[D]=0;for(D=3797;D<=3802;D++)R[D]=0;for(D=3814;D<=3816;D++)R[D]=0;for(D=3825;D<=3829;D++)R[D]=0;for(D=3832;D<=3841;D++)R[D]=0;for(D=3844;D<=3852;D++)R[D]=0;for(D=3873;D<=3885;D++)R[D]=0;for(D=3890;D<=3893;D++)R[D]=0;for(D=3907;D<=3912;D++)R[D]=0;for(D=3942;D<=3950;D++)R[D]=0;for(D=3968;D<=3970;D++)R[D]=0;for(D=3973;D<=3976;D++)R[D]=0;for(D=3986;D<=3989;D++)R[D]=0;for(D=3994;D<=3997;D++)R[D]=0;for(D=4048;D<=4051;D++)R[D]=0;for(D=4056;D<=4063;D++)R[D]=0;for(D=4093;D<=4096;D++)R[D]=0;for(D=4390;D<=4398;D++)R[D]=0;for(D=4399;D<=4413;D++)R[D]=2;for(D=4418;D<=4433;D++)R[D]=2;for(D=4455;D<=4457;D++)R[D]=2;for(D=4484;D<=4489;D++)R[D]=0;for(D=4491;D<=4554;D++)R[D]=0;for(D=4568;D<=4589;D++)R[D]=0;for(D=4652;D<=4656;D++)R[D]=0;for(D=4766;D<=4800;D++)R[D]=0;for(D=5014;D<=5016;D++)R[D]=0;for(D=5069;D<=5072;D++)R[D]=0;for(D=5105;D<=5130;D++)R[D]=0;for(D=5173;D<=5188;D++)R[D]=0;for(D=5253;D<=5259;D++)R[D]=0;for(D=5269;D<=5275;D++)R[D]=0;for(D=5292;D<=5311;D++)R[D]=0;for(D=5329;D<=5331;D++)R[D]=0;for(D=5343;D<=5349;D++)R[D]=0;for(D=5355;D<=5357;D++)R[D]=0;for(D=5387;D<=5389;D++)R[D]=0;for(D=5459;D<=5463;D++)R[D]=0;for(D=5479;D<=5482;D++)R[D]=0;for(D=5518;D<=5520;D++)R[D]=0;for(D=5530;D<=5539;D++)R[D]=0;for(D=5550;D<=5552;D++)R[D]=0;for(D=5562;D<=5583;D++)R[D]=0;for(D=5623;D<=5625;D++)R[D]=2;for(D=5631;D<=5639;D++)R[D]=0;for(D=5649;D<=5653;D++)R[D]=0;for(D=5663;D<=5680;D++)R[D]=0;for(D=5682;D<=5685;D++)R[D]=0;for(D=5875;D<=5877;D++)R[D]=0;for(D=5896;D<=5899;D++)R[D]=0;for(D=5921;D<=5940;D++)R[D]=0;for(D=6050;D<=6125;D++)R[D]=0;for(D=6244;D<=6275;D++)R[D]=0;for(D=6328;D<=6348;D++)R[D]=0;for(D=6350;D<=6356;D++)R[D]=0;for(D=6366;D<=6372;D++)R[D]=0;for(D=6381;D<=6387;D++)R[D]=0;for(D=6393;D<=6404;D++)R[D]=0;for(D=6480;D<=6483;D++)R[D]=0;for(D=6511;D<=6514;D++)R[D]=0;for(D=6579;D<=6581;D++)R[D]=0;for(D=6619;D<=6624;D++)R[D]=0;for(D=6625;D<=6627;D++)R[D]=2;for(D=6628;D<=6632;D++)R[D]=0;for(D=6634;D<=6637;D++)R[D]=0;for(D=6669;D<=6692;D++)R[D]=0;for(D=6707;D<=6709;D++)R[D]=0;for(D=6720;D<=6723;D++)R[D]=0;for(D=6732;D<=6738;D++)R[D]=0;for(D=6931;D<=6933;D++)R[D]=0;for(D=6956;D<=6959;D++)R[D]=0;for(D=7005;D<=7007;D++)R[D]=0;for(D=7057;D<=7070;D++)R[D]=2;for(D=7074;D<=7082;D++)R[D]=0;for(D=7109;D<=7118;D++)R[D]=0;for(D=7119;D<=7127;D++)R[D]=1;for(D=7374;D<=7376;D++)R[D]=0;for(D=7528;D<=7586;D++)R[D]=0;for(D=7587;D<=7645;D++)R[D]=2;for(D=7692;D<=7696;D++)R[D]=0;for(D=7755;D<=7787;D++)R[D]=0;for(D=7791;D<=7795;D++)R[D]=0;for(D=7799;D<=7801;D++)R[D]=0;for(D=7803;D<=7805;D++)R[D]=0;for(D=7825;D<=7831;D++)R[D]=0;for(D=7845;D<=7859;D++)R[D]=0;for(D=8013;D<=8032;D++)R[D]=0;for(D=8065;D<=8068;D++)R[D]=1;for(D=8518;D<=8529;D++)R[D]=2;for(D=8533;D<=8536;D++)R[D]=2;for(D=8538;D<=8540;D++)R[D]=2;for(D=8677;D<=8679;D++)R[D]=0;for(D=8836;D<=8840;D++)R[D]=0;for(D=8857;D<=8859;D++)R[D]=0;for(D=8908;D<=8910;D++)R[D]=0;for(D=9154;D<=9159;D++)R[D]=0;for(D=9205;D<=9218;D++)R[D]=0;for(D=9271;D<=9273;D++)R[D]=0;for(D=9295;D<=9297;D++)R[D]=0;for(D=9356;D<=9360;D++)R[D]=0;for(D=9404;D<=9407;D++)R[D]=0;for(D=9476;D<=9482;D++)R[D]=0;for(D=9487;D<=9494;D++)R[D]=0;for(D=9697;D<=9699;D++)R[D]=0;for(D=20002;D<=20032;D++)R[D]=0;for(D=20062;D<=20092;D++)R[D]=0;for(D=20135;D<=20138;D++)R[D]=0;for(D=20248;D<=20258;D++)R[D]=0;for(D=20348;D<=20358;D++)R[D]=0;for(D=20436;D<=20440;D++)R[D]=0;for(D=20822;D<=20824;D++)R[D]=0;for(D=20904;D<=20932;D++)R[D]=0;for(D=20934;D<=20936;D++)R[D]=0;for(D=21004;D<=21032;D++)R[D]=0;for(D=21035;D<=21037;D++)R[D]=0;for(D=21095;D<=21097;D++)R[D]=0;for(D=21148;D<=21150;D++)R[D]=0;for(D=21207;D<=21264;D++)R[D]=0;for(D=21307;D<=21364;D++)R[D]=0;for(D=21413;D<=21423;D++)R[D]=0;for(D=21453;D<=21463;D++)R[D]=0;for(D=21473;D<=21483;D++)R[D]=0;for(D=21780;D<=21782;D++)R[D]=0;for(D=21891;D<=21894;D++)R[D]=0;for(D=21896;D<=21899;D++)R[D]=0;for(D=22171;D<=22177;D++)R[D]=0;for(D=22181;D<=22187;D++)R[D]=0;for(D=22191;D<=22197;D++)R[D]=0;for(D=22234;D<=22236;D++)R[D]=0;for(D=22521;D<=22525;D++)R[D]=0;for(D=22991;D<=22994;D++)R[D]=0;for(D=23028;D<=23038;D++)R[D]=0;for(D=23830;D<=23853;D++)R[D]=0;for(D=23866;D<=23872;D++)R[D]=0;for(D=23877;D<=23884;D++)R[D]=0;for(D=23886;D<=23894;D++)R[D]=0;for(D=23946;D<=23948;D++)R[D]=0;for(D=24311;D<=24313;D++)R[D]=0;for(D=24342;D<=24347;D++)R[D]=0;for(D=24370;D<=24374;D++)R[D]=10;for(D=24375;D<=24381;D++)R[D]=0;for(D=24718;D<=24721;D++)R[D]=0;for(D=24817;D<=24821;D++)R[D]=0;for(D=24877;D<=24882;D++)R[D]=0;for(D=24891;D<=24893;D++)R[D]=0;for(D=25391;D<=25395;D++)R[D]=0;for(D=25828;D<=25838;D++)R[D]=0;for(D=26191;D<=26195;D++)R[D]=0;for(D=26391;D<=26393;D++)R[D]=0;for(D=26701;D<=26722;D++)R[D]=0;for(D=26729;D<=26799;D++)R[D]=2;for(D=26801;D<=26803;D++)R[D]=2;for(D=26811;D<=26813;D++)R[D]=2;for(D=26847;D<=26870;D++)R[D]=2;for(D=26891;D<=26899;D++)R[D]=0;for(D=26901;D<=26923;D++)R[D]=0;for(D=26929;D<=26946;D++)R[D]=0;for(D=26948;D<=26998;D++)R[D]=0;for(D=27037;D<=27040;D++)R[D]=0;for(D=27205;D<=27232;D++)R[D]=0;for(D=27258;D<=27260;D++)R[D]=0;for(D=27391;D<=27398;D++)R[D]=0;for(D=27561;D<=27564;D++)R[D]=0;for(D=27571;D<=27574;D++)R[D]=0;for(D=27581;D<=27584;D++)R[D]=0;for(D=27591;D<=27594;D++)R[D]=0;for(D=28191;D<=28193;D++)R[D]=0;for(D=28348;D<=28358;D++)R[D]=0;for(D=28402;D<=28432;D++)R[D]=0;for(D=28462;D<=28492;D++)R[D]=0;for(D=29118;D<=29122;D++)R[D]=0;for(D=29168;D<=29172;D++)R[D]=0;for(D=29177;D<=29185;D++)R[D]=0;for(D=29187;D<=29195;D++)R[D]=0;for(D=29900;D<=29903;D++)R[D]=0;for(D=30161;D<=30179;D++)R[D]=0;for(D=30491;D<=30494;D++)R[D]=0;for(D=30729;D<=30732;D++)R[D]=0;for(D=31251;D<=31259;D++)R[D]=0;for(D=31265;D<=31268;D++)R[D]=0;for(D=31275;D<=31279;D++)R[D]=0;for(D=31281;D<=31297;D++)R[D]=0;for(D=31461;D<=31469;D++)R[D]=0;for(D=31491;D<=31495;D++)R[D]=0;for(D=31917;D<=31922;D++)R[D]=0;for(D=31965;D<=32e3;D++)R[D]=0;for(D=32001;D<=32003;D++)R[D]=2;for(D=32005;D<=32031;D++)R[D]=2;for(D=32033;D<=32060;D++)R[D]=2;for(D=32064;D<=32067;D++)R[D]=2;for(D=32074;D<=32077;D++)R[D]=2;for(D=32081;D<=32086;D++)R[D]=0;for(D=32107;D<=32130;D++)R[D]=0;for(D=32133;D<=32158;D++)R[D]=0;for(D=32164;D<=32167;D++)R[D]=2;for(D=32180;D<=32199;D++)R[D]=0;for(D=32201;D<=32260;D++)R[D]=0;for(D=32301;D<=32360;D++)R[D]=0;for(D=32601;D<=32662;D++)R[D]=0;for(D=32664;D<=32667;D++)R[D]=2;for(D=32701;D<=32761;D++)R[D]=0;for(D=53001;D<=53004;D++)R[D]=0;for(D=53008;D<=53019;D++)R[D]=0;for(D=53021;D<=53032;D++)R[D]=0;for(D=53034;D<=53037;D++)R[D]=0;for(D=53042;D<=53046;D++)R[D]=0;for(D=53074;D<=53080;D++)R[D]=0;for(D=54001;D<=54004;D++)R[D]=0;for(D=54008;D<=54019;D++)R[D]=0;for(D=54021;D<=54032;D++)R[D]=0;for(D=54034;D<=54037;D++)R[D]=0;for(D=54042;D<=54046;D++)R[D]=0;for(D=54048;D<=54053;D++)R[D]=0;for(D=54074;D<=54080;D++)R[D]=0;for(D=54098;D<=54101;D++)R[D]=0;for(D=102001;D<=102040;D++)R[D]=0;for(D=102042;D<=102063;D++)R[D]=0;for(D=102065;D<=102067;D++)R[D]=0;for(D=102070;D<=102117;D++)R[D]=0;for(D=102122;D<=102216;D++)R[D]=0;for(D=102221;D<=102377;D++)R[D]=0;for(D=102382;D<=102388;D++)R[D]=0;for(D=102389;D<=102398;D++)R[D]=2;for(D=102399;D<=102444;D++)R[D]=0;for(D=102445;D<=102447;D++)R[D]=2;for(D=102448;D<=102458;D++)R[D]=0;for(D=102459;D<=102468;D++)R[D]=2;for(D=102469;D<=102499;D++)R[D]=0;for(D=102500;D<=102519;D++)R[D]=1;for(D=102520;D<=102524;D++)R[D]=0;for(D=102525;D<=102529;D++)R[D]=2;for(D=102530;D<=102588;D++)R[D]=0;for(D=102590;D<=102598;D++)R[D]=0;for(D=102601;D<=102603;D++)R[D]=0;for(D=102605;D<=102628;D++)R[D]=0;for(D=102629;D<=102646;D++)R[D]=2;for(D=102648;D<=102700;D++)R[D]=2;for(D=102701;D<=102703;D++)R[D]=0;for(D=102707;D<=102730;D++)R[D]=2;for(D=102733;D<=102758;D++)R[D]=2;for(D=102767;D<=102900;D++)R[D]=0;for(D=102901;D<=102933;D++)R[D]=2;for(D=102934;D<=102950;D++)R[D]=13;for(D=102951;D<=102955;D++)R[D]=0;for(D=102961;D<=102963;D++)R[D]=0;for(D=102965;D<=102969;D++)R[D]=0;for(D=102971;D<=102973;D++)R[D]=0;for(D=102975;D<=102989;D++)R[D]=0;for(D=102990;D<=102992;D++)R[D]=1;for(D=102997;D<=103002;D++)R[D]=0;for(D=103003;D<=103008;D++)R[D]=2;for(D=103009;D<=103011;D++)R[D]=0;for(D=103012;D<=103014;D++)R[D]=2;for(D=103019;D<=103021;D++)R[D]=0;for(D=103022;D<=103024;D++)R[D]=2;for(D=103029;D<=103031;D++)R[D]=0;for(D=103032;D<=103034;D++)R[D]=2;for(D=103065;D<=103068;D++)R[D]=0;for(D=103074;D<=103076;D++)R[D]=0;for(D=103077;D<=103079;D++)R[D]=1;for(D=103080;D<=103082;D++)R[D]=0;for(D=103083;D<=103085;D++)R[D]=2;for(D=103090;D<=103093;D++)R[D]=0;for(D=103097;D<=103099;D++)R[D]=0;for(D=103100;D<=103102;D++)R[D]=2;for(D=103107;D<=103109;D++)R[D]=0;for(D=103110;D<=103112;D++)R[D]=2;for(D=103113;D<=103116;D++)R[D]=0;for(D=103117;D<=103120;D++)R[D]=2;for(D=103153;D<=103157;D++)R[D]=0;for(D=103158;D<=103162;D++)R[D]=2;for(D=103163;D<=103165;D++)R[D]=0;for(D=103166;D<=103168;D++)R[D]=1;for(D=103169;D<=103171;D++)R[D]=2;for(D=103186;D<=103188;D++)R[D]=0;for(D=103189;D<=103191;D++)R[D]=2;for(D=103192;D<=103195;D++)R[D]=0;for(D=103196;D<=103199;D++)R[D]=2;for(D=103200;D<=103224;D++)R[D]=0;for(D=103225;D<=103227;D++)R[D]=1;for(D=103232;D<=103237;D++)R[D]=0;for(D=103238;D<=103243;D++)R[D]=2;for(D=103244;D<=103246;D++)R[D]=0;for(D=103247;D<=103249;D++)R[D]=2;for(D=103254;D<=103256;D++)R[D]=0;for(D=103257;D<=103259;D++)R[D]=2;for(D=103264;D<=103266;D++)R[D]=0;for(D=103267;D<=103269;D++)R[D]=2;for(D=103300;D<=103375;D++)R[D]=0;for(D=103381;D<=103383;D++)R[D]=0;for(D=103384;D<=103386;D++)R[D]=1;for(D=103387;D<=103389;D++)R[D]=0;for(D=103390;D<=103392;D++)R[D]=2;for(D=103397;D<=103399;D++)R[D]=0;for(D=103400;D<=103471;D++)R[D]=2;for(D=103476;D<=103478;D++)R[D]=0;for(D=103479;D<=103481;D++)R[D]=2;for(D=103486;D<=103488;D++)R[D]=0;for(D=103489;D<=103491;D++)R[D]=2;for(D=103492;D<=103495;D++)R[D]=0;for(D=103496;D<=103499;D++)R[D]=2;for(D=103528;D<=103543;D++)R[D]=0;for(D=103544;D<=103548;D++)R[D]=2;for(D=103549;D<=103551;D++)R[D]=0;for(D=103552;D<=103554;D++)R[D]=1;for(D=103555;D<=103557;D++)R[D]=2;for(D=103558;D<=103560;D++)R[D]=0;for(D=103571;D<=103573;D++)R[D]=0;for(D=103574;D<=103576;D++)R[D]=2;for(D=103577;D<=103580;D++)R[D]=0;for(D=103581;D<=103583;D++)R[D]=2;for(D=103595;D<=103694;D++)R[D]=0;for(D=103696;D<=103699;D++)R[D]=0;for(D=103700;D<=103793;D++)R[D]=2;for(D=103794;D<=103887;D++)R[D]=0;for(D=103900;D<=103971;D++)R[D]=2},5548:(nt,Ae,v)=>{"use strict";v.d(Ae,{BD:()=>ue,Cb:()=>Y,G1:()=>oe,Gv:()=>Re,HH:()=>B,JR:()=>Ke,TC:()=>X,Tn:()=>ye,Ue:()=>Q,VK:()=>te,Wi:()=>de,Ye:()=>j,Zp:()=>ge,al:()=>$,bA:()=>Ee,bd:()=>je,be:()=>ie,bf:()=>re,cS:()=>xe,cv:()=>_e,dp:()=>J,fS:()=>Be,kK:()=>me,op:()=>Se,pp:()=>ae,r3:()=>he,re:()=>Fe,sU:()=>se,t8:()=>ve,wp:()=>Ce,wz:()=>ee,xE:()=>He,y8:()=>ze});var D=v(62208),R=v(2004),G=v(65401);function Q(Ge=He){return[Ge[0],Ge[1],Ge[2],Ge[3],Ge[4],Ge[5]]}function $(Ge,Pe,Le,Me,Ne,Xe,Ye=Q()){return Ye[0]=Ge,Ye[1]=Pe,Ye[2]=Le,Ye[3]=Me,Ye[4]=Ne,Ye[5]=Xe,Ye}function B(Ge,Pe){const Le=isFinite(Ge[2])||isFinite(Ge[5]);return new R.Z(Le?{xmin:Ge[0],xmax:Ge[3],ymin:Ge[1],ymax:Ge[4],zmin:Ge[2],zmax:Ge[5],spatialReference:Pe}:{xmin:Ge[0],xmax:Ge[3],ymin:Ge[1],ymax:Ge[4],spatialReference:Pe})}function X(Ge,Pe){Ge[0]=Math.min(Ge[0],Pe[0]),Ge[1]=Math.min(Ge[1],Pe[1]),Ge[2]=Math.min(Ge[2],Pe[2]),Ge[3]=Math.max(Ge[3],Pe[3]),Ge[4]=Math.max(Ge[4],Pe[4]),Ge[5]=Math.max(Ge[5],Pe[5])}function te(Ge,Pe){Ge[0]=Math.min(Ge[0],Pe[0]),Ge[1]=Math.min(Ge[1],Pe[1]),Ge[3]=Math.max(Ge[3],Pe[2]),Ge[4]=Math.max(Ge[4],Pe[3])}function ae(Ge,Pe){Ge[0]=Math.min(Ge[0],Pe[0]),Ge[1]=Math.min(Ge[1],Pe[1]),Ge[2]=Math.min(Ge[2],Pe[2]),Ge[3]=Math.max(Ge[3],Pe[0]),Ge[4]=Math.max(Ge[4],Pe[1]),Ge[5]=Math.max(Ge[5],Pe[2])}function oe(Ge,Pe,Le=0,Me=Pe.length/3){let Ne=Ge[0],Xe=Ge[1],Ye=Ge[2],Je=Ge[3],rt=Ge[4],tt=Ge[5];for(let et=0;et<Me;et++)Ne=Math.min(Ne,Pe[Le+3*et]),Xe=Math.min(Xe,Pe[Le+3*et+1]),Ye=Math.min(Ye,Pe[Le+3*et+2]),Je=Math.max(Je,Pe[Le+3*et]),rt=Math.max(rt,Pe[Le+3*et+1]),tt=Math.max(tt,Pe[Le+3*et+2]);Ge[0]=Ne,Ge[1]=Xe,Ge[2]=Ye,Ge[3]=Je,Ge[4]=rt,Ge[5]=tt}function de(Ge,Pe,Le){const Me=Pe.length;let Ne=Ge[0],Xe=Ge[1],Ye=Ge[2],Je=Ge[3],rt=Ge[4],tt=Ge[5];if(Le)for(let et=0;et<Me;et++){const qe=Pe[et];Ne=Math.min(Ne,qe[0]),Xe=Math.min(Xe,qe[1]),Ye=Math.min(Ye,qe[2]),Je=Math.max(Je,qe[0]),rt=Math.max(rt,qe[1]),tt=Math.max(tt,qe[2])}else for(let et=0;et<Me;et++){const qe=Pe[et];Ne=Math.min(Ne,qe[0]),Xe=Math.min(Xe,qe[1]),Je=Math.max(Je,qe[0]),rt=Math.max(rt,qe[1])}Ge[0]=Ne,Ge[1]=Xe,Ge[2]=Ye,Ge[3]=Je,Ge[4]=rt,Ge[5]=tt}function se(Ge){for(let Pe=0;Pe<6;Pe++)if(!isFinite(Ge[Pe]))return!1;return!0}function re(Ge){return Ge[0]>=Ge[3]?0:Ge[3]-Ge[0]}function j(Ge){return Ge[1]>=Ge[4]?0:Ge[4]-Ge[1]}function Y(Ge){return Ge[2]>=Ge[5]?0:Ge[5]-Ge[2]}function ee(Ge){const Pe=re(Ge),Le=Y(Ge),Me=j(Ge);return Math.sqrt(Pe*Pe+Le*Le+Me*Me)}function ie(Ge,Pe=[0,0,0]){return Pe[0]=Ge[0]+re(Ge)/2,Pe[1]=Ge[1]+j(Ge)/2,Pe[2]=Ge[2]+Y(Ge)/2,Pe}function J(Ge,Pe=[0,0,0]){return Pe[0]=re(Ge),Pe[1]=j(Ge),Pe[2]=Y(Ge),Pe}function ue(Ge,Pe){return Pe[0]>=Ge[0]&&Pe[1]>=Ge[1]&&Pe[2]>=Ge[2]&&Pe[0]<=Ge[3]&&Pe[1]<=Ge[4]&&Pe[2]<=Ge[5]}function he(Ge,Pe){return Pe[0]>=Ge[0]&&Pe[1]>=Ge[1]&&Pe[2]>=Ge[2]&&Pe[3]<=Ge[3]&&Pe[4]<=Ge[4]&&Pe[5]<=Ge[5]}function me(Ge,Pe){return Math.max(Pe[0],Ge[0])<=Math.min(Pe[3],Ge[3])&&Math.max(Pe[1],Ge[1])<=Math.min(Pe[4],Ge[4])&&Math.max(Pe[2],Ge[2])<=Math.min(Pe[5],Ge[5])}function ge(Ge,Pe){return!!(0,D.Wi)(Pe)||me(Ge,Pe)}function _e(Ge,Pe,Le,Me,Ne=Ge){return Ne[0]=Ge[0]+Pe,Ne[1]=Ge[1]+Le,Ne[2]=Ge[2]+Me,Ne[3]=Ge[3]+Pe,Ne[4]=Ge[4]+Le,Ne[5]=Ge[5]+Me,Ne}function Ee(Ge,Pe,Le=Ge){const Me=Ge[0]+re(Ge)/2,Ne=Ge[1]+j(Ge)/2,Xe=Ge[2]+Y(Ge)/2;return Le[0]=Me+(Ge[0]-Me)*Pe,Le[1]=Ne+(Ge[1]-Ne)*Pe,Le[2]=Xe+(Ge[2]-Xe)*Pe,Le[3]=Me+(Ge[3]-Me)*Pe,Le[4]=Ne+(Ge[4]-Ne)*Pe,Le[5]=Xe+(Ge[5]-Xe)*Pe,Le}function Se(Ge,Pe,Le=Ge){return Le[0]=Pe[0],Le[1]=Pe[1],Le[2]=Pe[2],Le!==Ge&&(Le[3]=Ge[3],Le[4]=Ge[4],Le[5]=Ge[5]),Le}function ye(Ge,Pe,Le=Ge){return Le[3]=Pe[0],Le[4]=Pe[1],Le[5]=Pe[2],Le!==Ge&&(Le[0]=Ge[0],Le[1]=Ge[1],Le[2]=Ge[2]),Ge}function ve(Ge,Pe){return Ge[0]=Pe[0],Ge[1]=Pe[1],Ge[2]=Pe[2],Ge[3]=Pe[3],Ge[4]=Pe[4],Ge[5]=Pe[5],Ge}function xe(Ge){return Ge?ve(Ge,Re):Q(Re)}function ze(Ge,Pe){return Pe||(Pe=(0,G.Ue)()),Pe[0]=Ge[0],Pe[1]=Ge[1],Pe[2]=Ge[3],Pe[3]=Ge[4],Pe}function Ke(Ge,Pe){return Ge[0]=Pe[0],Ge[1]=Pe[1],Ge[2]=Number.NEGATIVE_INFINITY,Ge[3]=Pe[2],Ge[4]=Pe[3],Ge[5]=Number.POSITIVE_INFINITY,Ge}function We(Ge){return 6===Ge.length}function Ce(Ge){return 0===re(Ge)&&0===j(Ge)&&0===Y(Ge)}function Be(Ge,Pe,Le){if((0,D.Wi)(Ge)||(0,D.Wi)(Pe))return Ge===Pe;if(!We(Ge)||!We(Pe))return!1;if(Le){for(let Me=0;Me<Ge.length;Me++)if(!Le(Ge[Me],Pe[Me]))return!1}else for(let Me=0;Me<Ge.length;Me++)if(Ge[Me]!==Pe[Me])return!1;return!0}function Fe(Ge,Pe,Le,Me,Ne,Xe){return $(Ge,Pe,Le,Me,Ne,Xe,Ie)}const je=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Re=[1/0,1/0,1/0,-1/0,-1/0,-1/0],He=[0,0,0,0,0,0],Ie=Q()},65401:(nt,Ae,v)=>{"use strict";v.d(Ae,{BD:()=>ee,Cb:()=>re,Gv:()=>Be,HH:()=>te,Ho:()=>ae,I7:()=>J,JG:()=>B,Qn:()=>ce,SO:()=>j,TE:()=>Ee,Ue:()=>$,Wi:()=>le,Zm:()=>he,al:()=>H,bd:()=>Ce,be:()=>Y,bf:()=>se,cS:()=>xe,cv:()=>be,d9:()=>W,fS:()=>We,hr:()=>ie,jE:()=>ue,jV:()=>_e,jn:()=>oe,kK:()=>me,oJ:()=>X,r3:()=>ge,sU:()=>de,wp:()=>Ke}),v(8314);var R=v(21286),G=v(62208),Z=v(2004);function $(Re=Fe){return[Re[0],Re[1],Re[2],Re[3]]}function W(Re){return[Re[0],Re[1],Re[2],Re[3]]}function B(Re,He){return Re!==He&&(Re[0]=He[0],Re[1]=He[1],Re[2]=He[2],Re[3]=He[3]),Re}function H(Re,He,Ie,Ge,Pe=$()){return Pe[0]=Re,Pe[1]=He,Pe[2]=Ie,Pe[3]=Ge,Pe}function X(Re,He=$()){return He[0]=Re.xmin,He[1]=Re.ymin,He[2]=Re.xmax,He[3]=Re.ymax,He}function te(Re,He){return new Z.Z({xmin:Re[0],ymin:Re[1],xmax:Re[2],ymax:Re[3],spatialReference:He})}function ae(Re,He){He[0]<Re[0]&&(Re[0]=He[0]),He[0]>Re[2]&&(Re[2]=He[0]),He[1]<Re[1]&&(Re[1]=He[1]),He[1]>Re[3]&&(Re[3]=He[1])}function oe(Re,He,Ie){if((0,G.Wi)(He))B(Ie,Re);else if("length"in He)ze(He)?(Ie[0]=Math.min(Re[0],He[0]),Ie[1]=Math.min(Re[1],He[1]),Ie[2]=Math.max(Re[2],He[2]),Ie[3]=Math.max(Re[3],He[3])):2!==He.length&&3!==He.length||(Ie[0]=Math.min(Re[0],He[0]),Ie[1]=Math.min(Re[1],He[1]),Ie[2]=Math.max(Re[2],He[0]),Ie[3]=Math.max(Re[3],He[1]));else switch(He.type){case"extent":Ie[0]=Math.min(Re[0],He.xmin),Ie[1]=Math.min(Re[1],He.ymin),Ie[2]=Math.max(Re[2],He.xmax),Ie[3]=Math.max(Re[3],He.ymax);break;case"point":Ie[0]=Math.min(Re[0],He.x),Ie[1]=Math.min(Re[1],He.y),Ie[2]=Math.max(Re[2],He.x),Ie[3]=Math.max(Re[3],He.y)}}function le(Re,He,Ie=Re){const Ge=He.length;let Pe=Re[0],Le=Re[1],Me=Re[2],Ne=Re[3];for(let Xe=0;Xe<Ge;Xe++){const Ye=He[Xe];Pe=Math.min(Pe,Ye[0]),Le=Math.min(Le,Ye[1]),Me=Math.max(Me,Ye[0]),Ne=Math.max(Ne,Ye[1])}return Ie[0]=Pe,Ie[1]=Le,Ie[2]=Me,Ie[3]=Ne,Ie}function de(Re){for(let He=0;He<4;He++)if(!isFinite(Re[He]))return!1;return!0}function se(Re){return(0,G.Wi)(Re)||Re[0]>=Re[2]?0:Re[2]-Re[0]}function re(Re){return Re[1]>=Re[3]?0:Re[3]-Re[1]}function j(Re){return se(Re)*re(Re)}function Y(Re,He=[0,0]){return He[0]=(Re[0]+Re[2])/2,He[1]=(Re[1]+Re[3])/2,He}function ee(Re,He){return ue(Re,He[0],He[1])}function ie(Re,He){const Ie=He[3],Pe=Math.abs(He[0]-.5*(Re[0]+Re[2])),Le=.5*(Re[2]-Re[0]);if(Pe>Ie+Le)return!1;const Ne=.5*(Re[3]-Re[1]),Xe=Math.abs(He[1]-.5*(Re[1]+Re[3]));if(Xe>Ie+Ne)return!1;if(Pe<Le||Xe<Ne)return!0;const Ye=Pe-Le,Je=Xe-Ne;return Ye*Ye+Je*Je<=Ie*Ie}function J(Re,He,Ie){const Ge=Re[0],Pe=Re[1],Le=Re[2],Me=Re[3],{x:Ne,y:Xe}=He,{x:Ye,y:Je}=Ie,rt=(ut,_t)=>(Je-Xe)*ut+(Ne-Ye)*_t+(Ye*Xe-Ne*Je)<0,tt=rt(Ge,Me),et=rt(Le,Me),qe=rt(Le,Pe),ot=rt(Ge,Pe);return!(tt===et&&et===qe&&qe===ot&&ot===tt||Ne<Ge&&Ye<Ge||Ne>Le&&Ye>Le||Xe>Me&&Je>Me||Xe<Pe&&Je<Pe)}function ce(Re,He){return ue(Re,He.x,He.y)}function ue(Re,He,Ie){return He>=Re[0]&&Ie>=Re[1]&&He<=Re[2]&&Ie<=Re[3]}function he(Re,He,Ie){return He[0]>=Re[0]-Ie&&He[1]>=Re[1]-Ie&&He[0]<=Re[2]+Ie&&He[1]<=Re[3]+Ie}function me(Re,He){return Math.max(He[0],Re[0])<=Math.min(He[2],Re[2])&&Math.max(He[1],Re[1])<=Math.min(He[3],Re[3])}function ge(Re,He){return He[0]>=Re[0]&&He[2]<=Re[2]&&He[1]>=Re[1]&&He[3]<=Re[3]}function _e(Re,He,Ie){if((0,G.Wi)(He))return B(Ie,Re);const Ge=He[0],Pe=He[1],Le=He[2],Me=He[3];return Ie[0]=(0,R.uZ)(Re[0],Ge,Le),Ie[1]=(0,R.uZ)(Re[1],Pe,Me),Ie[2]=(0,R.uZ)(Re[2],Ge,Le),Ie[3]=(0,R.uZ)(Re[3],Pe,Me),Ie}function Ee(Re,He){const Ge=(Re[1]+Re[3])/2,Pe=Math.max(Math.abs(He[0]-(Re[0]+Re[2])/2)-se(Re)/2,0),Le=Math.max(Math.abs(He[1]-Ge)-re(Re)/2,0);return Math.sqrt(Pe*Pe+Le*Le)}function be(Re,He,Ie,Ge=Re){return Ge[0]=Re[0]+He,Ge[1]=Re[1]+Ie,Ge[2]=Re[2]+He,Ge[3]=Re[3]+Ie,Ge}function xe(Re){return Re?B(Re,Be):$(Be)}function ze(Re){return null!=Re&&4===Re.length}function Ke(Re){return!(0!==se(Re)&&isFinite(Re[0])||0!==re(Re)&&isFinite(Re[1]))}function We(Re,He){return ze(Re)&&ze(He)?Re[0]===He[0]&&Re[1]===He[1]&&Re[2]===He[2]&&Re[3]===He[3]:Re===He}const Ce=[-1/0,-1/0,1/0,1/0],Be=[1/0,1/0,-1/0,-1/0],Fe=[0,0,0,0]},89586:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ue:()=>Q,WH:()=>de,ZZ:()=>oe,qC:()=>ae,uT:()=>X,zk:()=>te});var D=v(21286),R=v(48977),G=v(78451),Z=v(84161);function Q(ie=re){return[ie[0],ie[1],ie[2],ie[3]]}function X(ie,J,ce=Q()){return(0,Z.c)(ce,ie),ce[3]=J,ce}function te(ie,J,ce=Q()){return(0,Z.f)(ce,ie,J),(0,Z.n)(ce,ce),ce[3]=-(0,Z.v)(ie,J),ce}function ae(ie,J,ce=Q()){return(0,R.s)(j,ie,de(ie)),(0,R.s)(Y,J,de(J)),(0,R.m)(j,Y,j),function se(ie,J){return ie[3]=J,ie}(ce,(0,D.BV)((0,R.g)(ce,j)))}function oe(ie){return ie}function de(ie){return(0,D.Vl)(ie[3])}const re=[0,0,1,0],j=(0,G.a)(),Y=(0,G.a)();Q()},32442:(nt,Ae,v)=>{"use strict";function D(se){return void 0!==se.xmin&&void 0!==se.ymin&&void 0!==se.xmax&&void 0!==se.ymax}function R(se){return void 0!==se.points}function G(se){return void 0!==se.x&&void 0!==se.y}function Z(se){return void 0!==se.paths}function Q(se){return void 0!==se.rings}function $(se){return function re(j,Y){return null==j?Y:null==Y?j:se(j,Y)}}v.d(Ae,{$P:()=>H,C6:()=>te,Yg:()=>X,lC:()=>oe});const W=$(Math.min),B=$(Math.max);function H(se,re){return Z(re)?te(se,re.paths,!1,!1):Q(re)?te(se,re.rings,!1,!1):R(re)?oe(se,re.points,!1,!1,!1,!1):D(re)?ae(se,re):(G(re)&&(se[0]=re.x,se[1]=re.y,se[2]=re.x,se[3]=re.y),se)}function X(se,re){return Z(re)?te(se,re.paths,!0,!1):Q(re)?te(se,re.rings,!0,!1):R(re)?oe(se,re.points,!0,!1,!0,!1):D(re)?ae(se,re,0,0,!0,!1):(G(re)&&(se[0]=re.x,se[1]=re.y,se[2]=re.z,se[3]=re.x,se[4]=re.y,se[5]=re.z),se)}function te(se,re,j,Y){const ee=j?3:2;if(!re.length||!re[0].length)return null;let ie,J,ce,ue,[pe,he]=re[0][0],[me,ge]=re[0][0];for(let _e=0;_e<re.length;_e++){const Ee=re[_e];for(let De=0;De<Ee.length;De++){const be=Ee[De],[Se,ye]=be;if(pe=W(pe,Se),he=W(he,ye),me=B(me,Se),ge=B(ge,ye),j&&be.length>2){const ve=be[2];ie=W(ie,ve),J=B(J,ve)}if(Y&&be.length>ee){const ve=be[ee];ce=W(ie,ve),ue=B(J,ve)}}}return j?Y?(se[0]=pe,se[1]=he,se[2]=ie,se[3]=ce,se[4]=me,se[5]=ge,se[6]=J,se[7]=ue,se.length=8,se):(se[0]=pe,se[1]=he,se[2]=ie,se[3]=me,se[4]=ge,se[5]=J,se.length=6,se):Y?(se[0]=pe,se[1]=he,se[2]=ce,se[3]=me,se[4]=ge,se[5]=ue,se.length=6,se):(se[0]=pe,se[1]=he,se[2]=me,se[3]=ge,se.length=4,se)}function ae(se,re,j,Y,ee,ie){const J=re.xmin,ce=re.xmax,ue=re.ymin,pe=re.ymax;let he=re.zmin,me=re.zmax,ge=re.mmin,_e=re.mmax;return ee?(he=he||0,me=me||0,ie?(ge=ge||0,_e=_e||0,se[0]=J,se[1]=ue,se[2]=he,se[3]=ge,se[4]=ce,se[5]=pe,se[6]=me,se[7]=_e,se):(se[0]=J,se[1]=ue,se[2]=he,se[3]=ce,se[4]=pe,se[5]=me,se)):ie?(ge=ge||0,_e=_e||0,se[0]=J,se[1]=ue,se[2]=ge,se[3]=ce,se[4]=pe,se[5]=_e,se):(se[0]=J,se[1]=ue,se[2]=ce,se[3]=pe,se)}function oe(se,re,j,Y,ee,ie){const J=j?3:2,ce=Y&&ie,ue=j&&ee;if(!re.length||!re[0].length)return null;let pe,he,me,ge,[_e,Ee]=re[0],[De,be]=re[0];for(let Se=0;Se<re.length;Se++){const ye=re[Se],[ve,xe]=ye;if(_e=W(_e,ve),Ee=W(Ee,xe),De=B(De,ve),be=B(be,xe),ue&&ye.length>2){const ze=ye[2];pe=W(pe,ze),he=B(he,ze)}if(ce&&ye.length>J){const ze=ye[J];me=W(pe,ze),ge=B(he,ze)}}return ee?(pe=pe||0,he=he||0,ie?(me=me||0,ge=ge||0,se[0]=_e,se[1]=Ee,se[2]=pe,se[3]=me,se[4]=De,se[5]=be,se[6]=he,se[7]=ge,se):(se[0]=_e,se[1]=Ee,se[2]=pe,se[3]=De,se[4]=be,se[5]=he,se)):ie?(me=me||0,ge=ge||0,se[0]=_e,se[1]=Ee,se[2]=me,se[3]=De,se[4]=be,se[5]=ge,se):(se[0]=_e,se[1]=Ee,se[2]=De,se[3]=be,se)}},60479:(nt,Ae,v)=>{"use strict";v.d(Ae,{ly:()=>X,oS:()=>j,o7:()=>Ke,Jj:()=>Fe,Hz:()=>ye,gK:()=>le,ey:()=>de,bj:()=>se,O1:()=>re,av:()=>he,Nu:()=>Ee,D_:()=>J,Eu:()=>te,q6:()=>Y,or:()=>We,wA:()=>je,Vs:()=>ve,TS:()=>me,qt:()=>De,xA:()=>ce,ct:()=>ae,fP:()=>ee,n1:()=>Ce,PP:()=>Re,P_:()=>xe,mw:()=>ge,G5:()=>be,ne:()=>ue,ek:()=>oe,Cd:()=>ie,zO:()=>Be,TN:()=>He,ir:()=>ze,v6:()=>_e,hu:()=>Se,mc:()=>pe});let D=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.elementCount=9;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=9*Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}getMat(Pe,Le){let Me=Pe*this.typedBufferStride;for(let Ne=0;Ne<9;Ne++)Le[Ne]=this.typedBuffer[Me++];return Le}setMat(Pe,Le){let Me=Pe*this.typedBufferStride;for(let Ne=0;Ne<9;Ne++)this.typedBuffer[Me++]=Le[Ne]}get(Pe,Le){return this.typedBuffer[Pe*this.typedBufferStride+Le]}set(Pe,Le,Me){this.typedBuffer[Pe*this.typedBufferStride+Le]=Me}copyFrom(Pe,Le,Me){const Ne=this.typedBuffer,Xe=Le.typedBuffer;let Ye=Pe*this.typedBufferStride,Je=Me*Le.typedBufferStride;for(let rt=0;rt<9;++rt)Ne[Ye++]=Xe[Je++]}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=9,Ie})(),R=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.elementCount=16;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=16*Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}getMat(Pe,Le){let Me=Pe*this.typedBufferStride;for(let Ne=0;Ne<16;Ne++)Le[Ne]=this.typedBuffer[Me++];return Le}setMat(Pe,Le){let Me=Pe*this.typedBufferStride;for(let Ne=0;Ne<16;Ne++)this.typedBuffer[Me++]=Le[Ne]}get(Pe,Le){return this.typedBuffer[Pe*this.typedBufferStride+Le]}set(Pe,Le,Me){this.typedBuffer[Pe*this.typedBufferStride+Le]=Me}copyFrom(Pe,Le,Me){const Ne=this.typedBuffer,Xe=Le.typedBuffer;let Ye=Pe*this.typedBufferStride,Je=Me*Le.typedBufferStride;for(let rt=0;rt<16;++rt)Ne[Ye++]=Xe[Je++]}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=16,Ie})(),G=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.elementCount=1;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.stride=Ne,this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}get(Pe){return this.typedBuffer[Pe*this.typedBufferStride]}set(Pe,Le){this.typedBuffer[Pe*this.typedBufferStride]=Le}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=1,Ie})();var Z=v(67831);let Q=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.elementCount=2;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=2*Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}getVec(Pe,Le){return(0,Z.s)(Le,this.typedBuffer[Pe*=this.typedBufferStride],this.typedBuffer[Pe+1])}setVec(Pe,Le){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le[0],this.typedBuffer[Pe]=Le[1]}get(Pe,Le){return this.typedBuffer[Pe*this.typedBufferStride+Le]}set(Pe,Le,Me){this.typedBuffer[Pe*this.typedBufferStride+Le]=Me}setValues(Pe,Le,Me){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le,this.typedBuffer[Pe]=Me}copyFrom(Pe,Le,Me){const Ne=this.typedBuffer,Xe=Le.typedBuffer;let Ye=Pe*this.typedBufferStride,Je=Me*Le.typedBufferStride;Ne[Ye++]=Xe[Je++],Ne[Ye]=Xe[Je]}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=2,Ie})();var $=v(84161);let W=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.elementCount=3;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=3*Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}getVec(Pe,Le){return(0,$.s)(Le,this.typedBuffer[Pe*=this.typedBufferStride],this.typedBuffer[Pe+1],this.typedBuffer[Pe+2])}setVec(Pe,Le){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le[0],this.typedBuffer[Pe++]=Le[1],this.typedBuffer[Pe]=Le[2]}get(Pe,Le){return this.typedBuffer[Pe*this.typedBufferStride+Le]}set(Pe,Le,Me){this.typedBuffer[Pe*this.typedBufferStride+Le]=Me}setValues(Pe,Le,Me,Ne){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le,this.typedBuffer[Pe++]=Me,this.typedBuffer[Pe]=Ne}copyFrom(Pe,Le,Me){const Ne=this.typedBuffer,Xe=Le.typedBuffer;let Ye=Pe*this.typedBufferStride,Je=Me*Le.typedBufferStride;Ne[Ye++]=Xe[Je++],Ne[Ye++]=Xe[Je++],Ne[Ye]=Xe[Je]}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=3,Ie})();var B=v(993);let H=(()=>{class Ie{constructor(Pe,Le,Me=0,Ne,Xe){this.TypedArrayConstructor=Pe,this.start=Me,this.elementCount=4;const Ye=this.TypedArrayConstructor;void 0===Ne&&(Ne=4*Ye.BYTES_PER_ELEMENT);const Je=0===Le.byteLength?0:Me;this.typedBuffer=null==Xe?new Ye(Le,Je):new Ye(Le,Je,(Xe-Me)/Ye.BYTES_PER_ELEMENT),this.typedBufferStride=Ne/Ye.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(Pe,Le,Me=this.count-Le){const Ne=this.typedBuffer.byteOffset+Le*this.stride;return new Pe(this.buffer,Ne,this.stride,Ne+Me*this.stride)}getVec(Pe,Le){return Pe*=this.typedBufferStride,(0,B.s)(Le,this.typedBuffer[Pe++],this.typedBuffer[Pe++],this.typedBuffer[Pe++],this.typedBuffer[Pe])}setVec(Pe,Le){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le[0],this.typedBuffer[Pe++]=Le[1],this.typedBuffer[Pe++]=Le[2],this.typedBuffer[Pe]=Le[3]}get(Pe,Le){return this.typedBuffer[Pe*this.typedBufferStride+Le]}set(Pe,Le,Me){this.typedBuffer[Pe*this.typedBufferStride+Le]=Me}setValues(Pe,Le,Me,Ne,Xe){Pe*=this.typedBufferStride,this.typedBuffer[Pe++]=Le,this.typedBuffer[Pe++]=Me,this.typedBuffer[Pe++]=Ne,this.typedBuffer[Pe]=Xe}copyFrom(Pe,Le,Me){const Ne=this.typedBuffer,Xe=Le.typedBuffer;let Ye=Pe*this.typedBufferStride,Je=Me*Le.typedBufferStride;Ne[Ye++]=Xe[Je++],Ne[Ye++]=Xe[Je++],Ne[Ye++]=Xe[Je++],Ne[Ye]=Xe[Je]}get buffer(){return this.typedBuffer.buffer}}return Ie.ElementCount=4,Ie})(),X=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),te=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),ae=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),oe=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),le=(()=>{class Ie extends D{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),de=(()=>{class Ie extends D{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),se=(()=>{class Ie extends R{constructor(Pe,Le=0,Me,Ne){super(Float32Array,Pe,Le,Me,Ne),this.elementType="f32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f32",Ie})(),re=(()=>{class Ie extends R{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),j=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),Y=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),ee=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),ie=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Float64Array,Pe,Le,Me,Ne),this.elementType="f64"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="f64",Ie})(),J=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Uint8Array,Pe,Le,Me,Ne),this.elementType="u8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u8",Ie})(),ce=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Uint8Array,Pe,Le,Me,Ne),this.elementType="u8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u8",Ie})(),ue=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Uint8Array,Pe,Le,Me,Ne),this.elementType="u8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u8",Ie})(),pe=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Uint8Array,Pe,Le,Me,Ne),this.elementType="u8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u8",Ie})(),he=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Uint16Array,Pe,Le,Me,Ne),this.elementType="u16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u16",Ie})(),me=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Uint16Array,Pe,Le,Me,Ne),this.elementType="u16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u16",Ie})(),ge=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Uint16Array,Pe,Le,Me,Ne),this.elementType="u16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u16",Ie})(),_e=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Uint16Array,Pe,Le,Me,Ne),this.elementType="u16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u16",Ie})(),Ee=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Uint32Array,Pe,Le,Me,Ne),this.elementType="u32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u32",Ie})(),De=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Uint32Array,Pe,Le,Me,Ne),this.elementType="u32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u32",Ie})(),be=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Uint32Array,Pe,Le,Me,Ne),this.elementType="u32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u32",Ie})(),Se=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Uint32Array,Pe,Le,Me,Ne),this.elementType="u32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="u32",Ie})(),ye=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Int8Array,Pe,Le,Me,Ne),this.elementType="i8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i8",Ie})(),ve=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Int8Array,Pe,Le,Me,Ne),this.elementType="i8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i8",Ie})(),xe=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Int8Array,Pe,Le,Me,Ne),this.elementType="i8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i8",Ie})(),ze=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Int8Array,Pe,Le,Me,Ne),this.elementType="i8"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i8",Ie})(),Ke=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Int16Array,Pe,Le,Me,Ne),this.elementType="i16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i16",Ie})(),We=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Int16Array,Pe,Le,Me,Ne),this.elementType="i16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i16",Ie})(),Ce=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Int16Array,Pe,Le,Me,Ne),this.elementType="i16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i16",Ie})(),Be=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Int16Array,Pe,Le,Me,Ne),this.elementType="i16"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i16",Ie})(),Fe=(()=>{class Ie extends G{constructor(Pe,Le=0,Me,Ne){super(Int32Array,Pe,Le,Me,Ne),this.elementType="i32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i32",Ie})(),je=(()=>{class Ie extends Q{constructor(Pe,Le=0,Me,Ne){super(Int32Array,Pe,Le,Me,Ne),this.elementType="i32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i32",Ie})(),Re=(()=>{class Ie extends W{constructor(Pe,Le=0,Me,Ne){super(Int32Array,Pe,Le,Me,Ne),this.elementType="i32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i32",Ie})(),He=(()=>{class Ie extends H{constructor(Pe,Le=0,Me,Ne){super(Int32Array,Pe,Le,Me,Ne),this.elementType="i32"}slice(Pe,Le){return this.sliceBuffer(Ie,Pe,Le)}static fromTypedArray(Pe,Le){return new Ie(Pe.buffer,Pe.byteOffset,Le,Pe.byteOffset+Pe.byteLength)}}return Ie.ElementType="i32",Ie})()},96286:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>R});const R=v(63290).Z.getLogger("esri.views.3d.support.buffer.math")},81096:(nt,Ae,v)=>{"use strict";function D(Q){switch(Q){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function R(Q){switch(Q){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function G(Q){switch(Q){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function Z(Q){switch(Q){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}v.d(Ae,{B3:()=>R,Op:()=>Z,U:()=>G,n1:()=>D})},60490:(nt,Ae,v)=>{"use strict";v.d(Ae,{gS:()=>X});var D=v(81096);function X(te,ae){return new te(new ArrayBuffer(ae*te.ElementCount*(0,D.n1)(te.ElementType)))}Object.freeze(Object.defineProperty({__proto__:null,copy:function R(te,ae,oe){const le=te.typedBuffer,de=te.typedBufferStride,se=ae.typedBuffer,re=ae.typedBufferStride,j=oe?oe.count:ae.count;let Y=(oe&&oe.dstIndex?oe.dstIndex:0)*de,ee=(oe&&oe.srcIndex?oe.srcIndex:0)*re;for(let ie=0;ie<j;++ie){for(let J=0;J<9;++J)le[Y+J]=se[ee+J];Y+=de,ee+=re}}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:function Z(te,ae,oe){const le=te.typedBuffer,de=te.typedBufferStride,se=ae.typedBuffer,re=ae.typedBufferStride,j=oe?oe.count:ae.count;let Y=(oe&&oe.dstIndex?oe.dstIndex:0)*de,ee=(oe&&oe.srcIndex?oe.srcIndex:0)*re;for(let ie=0;ie<j;++ie){for(let J=0;J<16;++J)le[Y+J]=se[ee+J];Y+=de,ee+=re}}},Symbol.toStringTag,{value:"Module"})),v(98148),v(35995),v(9554),v(63470)},27105:(nt,Ae,v)=>{"use strict";v.d(Ae,{$G:()=>R,DS:()=>Q,NA:()=>B,a:()=>Z,tO:()=>G});var D=v(25748);function R(te){return te?te.hasZ?[te.xmax-te.xmin/2,te.ymax-te.ymin/2,te.zmax-te.zmin/2]:[te.xmax-te.xmin/2,te.ymax-te.ymin/2]:null}function G(te){return te?Z(te.rings,te.hasZ??!1):null}function Z(te,ae){if(!te||!te.length)return null;const oe=[],le=[],de=ae?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let se=0,re=te.length;se<re;se++){const j=Q(te[se],ae,de);j&&le.push(j)}if(le.sort((se,re)=>{let j=se[2]-re[2];return 0===j&&ae&&(j=se[4]-re[4]),j}),le.length&&(oe[0]=le[0][0],oe[1]=le[0][1],ae&&(oe[2]=le[0][3]),(oe[0]<de[0]||oe[0]>de[1]||oe[1]<de[2]||oe[1]>de[3]||ae&&(oe[2]<de[4]||oe[2]>de[5]))&&(oe.length=0)),!oe.length){const se=te[0]&&te[0].length?function $(te,ae){const oe=ae?[0,0,0]:[0,0],le=ae?[0,0,0]:[0,0];let de=0,se=0,re=0,j=0;for(let Y=0,ee=te.length;Y<ee-1;Y++){const ie=te[Y],J=te[Y+1];if(ie&&J){oe[0]=ie[0],oe[1]=ie[1],le[0]=J[0],le[1]=J[1],ae&&ie.length>2&&J.length>2&&(oe[2]=ie[2],le[2]=J[2]);const ce=(0,D.xA)(oe,le);if(ce){de+=ce;const ue=(0,D.Gi)(ie,J);se+=ce*ue[0],re+=ce*ue[1],ae&&ue.length>2&&(j+=ce*ue[2])}}}return de>0?ae?[se/de,re/de,j/de]:[se/de,re/de]:te.length?te[0]:null}(te[0],ae):null;if(!se)return null;oe[0]=se[0],oe[1]=se[1],ae&&se.length>2&&(oe[2]=se[2])}return oe}function Q(te,ae,oe){let le=0,de=0,se=0,re=0,j=0;const Y=te.length?te[0][0]:0,ee=te.length?te[0][1]:0,ie=te.length&&ae?te[0][2]:0;for(let ce=0;ce<te.length;ce++){const ue=te[ce],pe=te[(ce+1)%te.length],[he,me,ge]=ue,_e=he-Y,Ee=me-ee,[De,be,Se]=pe,ye=De-Y,ve=be-ee,xe=_e*ve-ye*Ee;if(re+=xe,le+=(_e+ye)*xe,de+=(Ee+ve)*xe,ae&&ue.length>2&&pe.length>2){const ze=ge-ie,Ke=Se-ie,We=_e*Ke-ye*ze;se+=(ze+Ke)*We,j+=We}he<oe[0]&&(oe[0]=he),he>oe[1]&&(oe[1]=he),me<oe[2]&&(oe[2]=me),me>oe[3]&&(oe[3]=me),ae&&(ge<oe[4]&&(oe[4]=ge),ge>oe[5]&&(oe[5]=ge))}if(re>0&&(re*=-1),j>0&&(j*=-1),!re)return null;re*=.5,j*=.5;const J=[le/(6*re)+Y,de/(6*re)+ee,re];return ae&&(oe[4]===oe[5]||0===j?(J[3]=(oe[4]+oe[5])/2,J[4]=0):(J[3]=se/(6*j)+ie,J[4]=j)),J}function B(te){if(!te||!te.rings)return null;const{rings:ae}=te;let oe=0;for(let se=0;se<ae.length;se++)oe+=(0,D.Sm)(ae[se]);if(oe<1e-6)return Z(ae,!1);const le=[0,0],de=ae[0][0];for(let se=0;se<ae.length;se++)X(le,de,ae[se]);return le[0]*=1/oe,le[1]*=1/oe,le[0]+=de[0],le[1]+=de[1],le}function X(te,ae,oe){if(!te||!oe||oe.length<3)return null;const le=oe[0],de=[0,0],se=[oe[1][0]-le[0],oe[1][1]-le[1]];let re;for(let ee=2;ee<oe.length;ee++)de[0]=oe[ee][0]-le[0],de[1]=oe[ee][1]-le[1],re=.16666666666666666*(de[0]*se[1]-de[1]*se[0]),te[0]+=re*(se[0]+de[0]),te[1]+=re*(se[1]+de[1]),se[0]=de[0],se[1]=de[1];const j=(0,D.Sm)(oe),Y=[le[0],le[1]];return Y[0]-=ae[0],Y[1]-=ae[1],Y[0]*=j,Y[1]*=j,te[0]+=Y[0],te[1]+=Y[1],te}},85072:(nt,Ae,v)=>{"use strict";v.d(Ae,{S$:()=>oe,Ue:()=>Q,Ws:()=>ae,_k:()=>te,iL:()=>H});var D=v(97535),R=v(84161),G=v(70562);function Q(se){return se?{ray:(0,G.Ue)(se.ray),c0:se.c0,c1:se.c1}:{ray:(0,G.Ue)(),c0:0,c1:Number.MAX_VALUE}}function H(se,re=Q()){return(0,G.JG)(se,re.ray),re.c0=0,re.c1=Number.MAX_VALUE,re}function te(se,re,j=Q()){const Y=(0,R.l)(se.vector);return(0,G.al)(se.origin,re,j.ray),j.c0=0,j.c1=Y,j}function ae(se,re){return le(se,se.c0,re)}function oe(se,re){return le(se,se.c1,re)}function le(se,re,j){return(0,R.a)(j,se.ray.origin,(0,R.g)(j,se.ray.direction,re))}v(26242),new D.x(()=>Q())},33190:(nt,Ae,v)=>{"use strict";v.d(Ae,{CI:()=>H,Kv:()=>B,OQ:()=>$,Qg:()=>W,aV:()=>G,lQ:()=>Z,uP:()=>Q,wP:()=>te});var D=v(62208);const R=[0,0];function G(le,de){return!!(0,D.pC)(de)&&B(le,de.x,de.y,de.z)}function Z(le,de){if(!de.points||de.points.length)return!1;for(const se of de.points)if(!$(le,se))return!1;return!0}function Q(le,de){const{xmin:se,ymin:re,zmin:j,xmax:Y,ymax:ee,zmax:ie}=de;return le.hasZ&&de.hasZ?B(le,se,re,j)&&B(le,se,ee,j)&&B(le,Y,ee,j)&&B(le,Y,re,j)&&B(le,se,re,ie)&&B(le,se,ee,ie)&&B(le,Y,ee,ie)&&B(le,Y,re,ie):B(le,se,re)&&B(le,se,ee)&&B(le,Y,ee)&&B(le,Y,re)}function $(le,de){return B(le,de[0],de[1])}function W(le,de){return B(le,de[0],de[1],de[2])}function B(le,de,se,re){return de>=le.xmin&&de<=le.xmax&&se>=le.ymin&&se<=le.ymax&&(null==re||!le.hasZ||re>=le.zmin&&re<=le.zmax)}function H(le,de){return R[1]=de.y,R[0]=de.x,function X(le,de){return te(le.rings,de)}(le,R)}function te(le,de){if(!le)return!1;if(function ae(le){return!Array.isArray(le[0][0])}(le))return oe(!1,le,de);let se=!1;for(let re=0,j=le.length;re<j;re++)se=oe(se,le[re],de);return se}function oe(le,de,se){const[re,j]=se;let Y=le,ee=0;for(let ie=0,J=de.length;ie<J;ie++){ee++,ee===J&&(ee=0);const[ce,ue]=de[ie],[pe,he]=de[ee];(ue<j&&he>=j||he<j&&ue>=j)&&ce+(j-ue)/(he-ue)*(pe-ce)<re&&(Y=!Y)}return Y}},93088:(nt,Ae,v)=>{"use strict";v.d(Ae,{BR:()=>Y,E2:()=>Se,Is:()=>he,Kf:()=>j,NE:()=>ge,P0:()=>re,Tz:()=>be,Ue:()=>H,ej:()=>J,id:()=>pe,pb:()=>de,pt:()=>oe,qf:()=>X,rF:()=>me,yS:()=>De});var D=v(28347),R=v(84161),G=v(28093),Z=v(12080),Q=v(65234),$=v(78172),W=v(41743),B=v(97126);function H(ve){const{value:xe,operations:ze}=ve;return{operations:ze,value:ze.create(xe)}}function X(ve,xe,ze){return ve.operations.setExtent(ve.value,xe,ze.value),ze}function ae(ve,xe,ze=function te(ve){return{operations:ve,value:ve.create()}}(ve)){return ze.operations=ve,ve.copy(xe,ze.value),ze}function oe(ve){return ae(B.s,(0,B.f)(0,0,0,(0,Z.Iu)(ve).radius))}const le=2**50;function de(){return ae(W.b,(0,W.f)([0,0,0],[le,0,0],[0,le,0]))}function re(ve,xe,ze){return ve.operations.axisAt(ve.value,xe,$.R.Z,ze)}function j(ve,xe,ze,Ke){return ve.operations.axisAt(ve.value,xe,ze,Ke)}function Y(ve,xe,ze){return ve.operations.intersectRay(ve.value,xe,ze)}function J(ve,xe,ze){return ve.operations.intersectRayClosestSilhouette(ve.value,xe,ze)}function pe(ve,xe){return ve.operations.altitudeAt(ve.value,xe)}function he(ve,xe,ze,Ke){return ve.operations.setAltitudeAt(ve.value,xe,ze,Ke)}function me(ve,xe,ze,Ke){return xe!==Ke&&(0,D.c)(Ke,xe),(0,R.s)(_e,Ke[12],Ke[13],Ke[14]),he(ve,_e,ze,_e),Ke[12]=_e[0],Ke[13]=_e[1],Ke[14]=_e[2],Ke}function ge(ve,xe,ze){return ve.operations.elevate(ve.value,xe,ze.value)}const _e=(0,G.c)();function De(ve,xe,ze,Ke,We){return We[0]=(0,R.e)(ve,xe),We[1]=(0,R.e)(ve,ze),We[2]=(0,R.e)(ve,Ke),We}function be(ve,xe,ze,Ke,We){(0,R.c)(ze,ve),(0,R.c)(ye,xe),(0,R.n)(ye,ye),(0,R.f)(Ke,ye,ze),(0,R.f)(We,Ke,ze)}function Se(ve,xe){return ve?(0,Z.rS)(xe):xe.isGeographic?Q.Z.PlateCarree:xe}const ye=(0,G.c)()},25748:(nt,Ae,v)=>{"use strict";v.d(Ae,{Gi:()=>H,Sm:()=>Y,Tx:()=>$,Zy:()=>de,bu:()=>ae,ko:()=>W,n8:()=>te,ok:()=>X,xA:()=>Z});var D=v(85931);function Z(ee,ie){const J=ie[0]-ee[0],ce=ie[1]-ee[1];if(ee.length>2&&ie.length>2){const ue=ee[2]-ie[2];return Math.sqrt(J*J+ce*ce+ue*ue)}return Math.sqrt(J*J+ce*ce)}function Q(ee,ie,J){const ce=ee[0]+J*(ie[0]-ee[0]),ue=ee[1]+J*(ie[1]-ee[1]);return ee.length>2&&ie.length>2?[ce,ue,ee[2]+J*(ie[2]-ee[2])]:[ce,ue]}function $(ee,ie,J,ce){const[ue,pe]=ie,[he,me]=J[ce],[ge,_e]=J[ce+1],Ee=ge-he,De=_e-me,ye=Math.min(1,Math.max(0,((ue-he)*Ee+(pe-me)*De)/(Ee*Ee+De*De)));return ee[0]=he+Ee*ye,ee[1]=me+De*ye,ee}function W(ee,ie,J){const ce=J.rings;let ue,pe,he=!1,me=1/0;for(let ge=0;ge<ce.length;ge++){const _e=ce[ge];for(let Ee=0,De=_e.length-1;Ee<_e.length;De=Ee++)ue=_e[Ee],pe=_e[De],ue[1]>ie!=pe[1]>ie&&ee<(pe[0]-ue[0])*(ie-ue[1])/(pe[1]-ue[1])+ue[0]&&(he=!he),me=Math.min(me,B(ee,ie,ue,pe))}return 0===me?0:(he?1:-1)*Math.sqrt(me)}function B(ee,ie,J,ce){let ue=J[0],pe=J[1],he=ce[0]-ue,me=ce[1]-pe;if(0!==he||0!==me){const ge=((ee-ue)*he+(ie-pe)*me)/(he*he+me*me);ge>1?(ue=ce[0],pe=ce[1]):ge>0&&(ue+=he*ge,pe+=me*ge)}return he=ee-ue,me=ie-pe,he*he+me*me}function H(ee,ie){return Q(ee,ie,.5)}function X(ee){const ie=ee.length;let J=0;for(let ce=0;ce<ie-1;++ce)J+=Z(ee[ce],ee[ce+1]);return J}function te(ee,ie){if(ie<=0)return ee[0];const J=ee.length;let ce=0;for(let ue=0;ue<J-1;++ue){const pe=Z(ee[ue],ee[ue+1]);if(ie-ce<pe)return Q(ee[ue],ee[ue+1],(ie-ce)/pe);ce+=pe}return ee[J-1]}function ae(ee,ie,J){const ce=ee.length;let ue=0,pe=0,he=0;for(let me=0;me<ce;me++){const ge=ee[me],_e=ee[(me+1)%ce];let Ee=2;ue+=ge[0]*_e[1]-_e[0]*ge[1],ge.length>2&&_e.length>2&&J&&(pe+=ge[0]*_e[2]-_e[0]*ge[2],Ee=3),ge.length>Ee&&_e.length>Ee&&ie&&(he+=ge[0]*_e[Ee]-_e[0]*ge[Ee])}return ue<=0&&pe<=0&&he<=0}function oe(ee){const ie=ee.length;return ie>2&&(0,D.fS)(ee[0],ee[ie-1])}function de(ee){if("rings"in ee)for(const ie of ee.rings)oe(ie)||ie.push(ie[0].slice())}function Y(ee){if(!ee||ee.length<3)return 0;let ie=0;const J=ee.length-1;for(let ce=0;ce<J;ce++)ie+=(ee[ce][0]-ee[ce+1][0])*(ee[ce][1]+ee[ce+1][1]);return ie+=(ee[J][0]-ee[0][0])*(ee[J][1]+ee[0][1]),-.5*ie}v(37053)},15176:(nt,Ae,v)=>{"use strict";v.d(Ae,{Wn:()=>re,_w:()=>se,aO:()=>oe});var D=v(32442);const W=[];function B(j,Y,ee,ie){return{xmin:j,ymin:Y,xmax:ee,ymax:ie}}function H(j,Y,ee,ie,J,ce){return{xmin:j,ymin:Y,zmin:ee,xmax:ie,ymax:J,zmax:ce}}function X(j,Y,ee,ie,J,ce){return{xmin:j,ymin:Y,mmin:ee,xmax:ie,ymax:J,mmax:ce}}function te(j,Y,ee,ie,J,ce,ue,pe){return{xmin:j,ymin:Y,zmin:ee,mmin:ie,xmax:J,ymax:ce,zmax:ue,mmax:pe}}function ae(j,Y=!1,ee=!1){return Y?ee?te(j[0],j[1],j[2],j[3],j[4],j[5],j[6],j[7]):H(j[0],j[1],j[2],j[3],j[4],j[5]):ee?X(j[0],j[1],j[2],j[3],j[4],j[5]):B(j[0],j[1],j[2],j[3])}function oe(j){return j?function R(j){return void 0!==j.xmin&&void 0!==j.ymin&&void 0!==j.xmax&&void 0!==j.ymax}(j)?j:function Z(j){return void 0!==j.x&&void 0!==j.y}(j)?function de(j){const{x:Y,y:ee,z:ie,m:J}=j,ce=null!=J;return null!=ie?ce?te(Y,ee,ie,J,Y,ee,ie,J):H(Y,ee,ie,Y,ee,ie):ce?X(Y,ee,J,Y,ee,J):B(Y,ee,Y,ee)}(j):function $(j){return void 0!==j.rings}(j)?se(j):function Q(j){return void 0!==j.paths}(j)?re(j):function G(j){return void 0!==j.points}(j)?function le(j){const{hasZ:Y,hasM:ee,points:ie}=j;return ae((0,D.lC)(W,ie,Y??!1,ee??!1),Y,ee)}(j):null:null}function se(j){const{hasZ:Y,hasM:ee,rings:ie}=j,J=(0,D.C6)(W,ie,Y??!1,ee??!1);return J?ae(J,Y,ee):null}function re(j){const{hasZ:Y,hasM:ee,paths:ie}=j,J=(0,D.C6)(W,ie,Y??!1,ee??!1);return J?ae(J,Y,ee):null}},8834:(nt,Ae,v)=>{"use strict";v.d(Ae,{Hf:()=>te,JG:()=>ae,Jp:()=>le,NQ:()=>J,Nu:()=>ie,Ue:()=>X,Zr:()=>se,g8:()=>Y,hr:()=>de,q_:()=>oe,rN:()=>j,tc:()=>ue,xu:()=>ce,zq:()=>re});var ie,J,_e,D=v(97535),R=v(28347),G=v(84161),Z=v(28093),Q=v(993),$=v(4794),W=v(85072),B=v(90014),H=v(26242);function X(_e){return _e?[(0,B.Ue)(_e[0]),(0,B.Ue)(_e[1]),(0,B.Ue)(_e[2]),(0,B.Ue)(_e[3]),(0,B.Ue)(_e[4]),(0,B.Ue)(_e[5])]:[(0,B.Ue)(),(0,B.Ue)(),(0,B.Ue)(),(0,B.Ue)(),(0,B.Ue)(),(0,B.Ue)()]}function te(){return[(0,Z.c)(),(0,Z.c)(),(0,Z.c)(),(0,Z.c)(),(0,Z.c)(),(0,Z.c)(),(0,Z.c)(),(0,Z.c)()]}function ae(_e,Ee){for(let De=0;De<ue.NUM;De++)(0,B.JG)(_e[De],Ee[De])}function oe(_e,Ee,De,be=ge){const Se=(0,R.m)(H.MP.get(),Ee,_e);(0,R.a)(Se,Se);for(let ye=0;ye<pe.NUM;++ye){const ve=(0,Q.t)(H.o6.get(),he[ye],Se);(0,G.s)(be[ye],ve[0]/ve[3],ve[1]/ve[3],ve[2]/ve[3])}le(De,be)}function le(_e,Ee){(0,B.zk)(Ee[J.FAR_BOTTOM_LEFT],Ee[J.NEAR_BOTTOM_LEFT],Ee[J.NEAR_TOP_LEFT],_e[ie.LEFT]),(0,B.zk)(Ee[J.NEAR_BOTTOM_RIGHT],Ee[J.FAR_BOTTOM_RIGHT],Ee[J.FAR_TOP_RIGHT],_e[ie.RIGHT]),(0,B.zk)(Ee[J.FAR_BOTTOM_LEFT],Ee[J.FAR_BOTTOM_RIGHT],Ee[J.NEAR_BOTTOM_RIGHT],_e[ie.BOTTOM]),(0,B.zk)(Ee[J.NEAR_TOP_LEFT],Ee[J.NEAR_TOP_RIGHT],Ee[J.FAR_TOP_RIGHT],_e[ie.TOP]),(0,B.zk)(Ee[J.NEAR_BOTTOM_LEFT],Ee[J.NEAR_BOTTOM_RIGHT],Ee[J.NEAR_TOP_RIGHT],_e[ie.NEAR]),(0,B.zk)(Ee[J.FAR_BOTTOM_RIGHT],Ee[J.FAR_BOTTOM_LEFT],Ee[J.FAR_TOP_LEFT],_e[ie.FAR])}function de(_e,Ee){for(let De=0;De<ue.NUM;De++){const be=_e[De];if(be[0]*Ee[0]+be[1]*Ee[1]+be[2]*Ee[2]+be[3]>=Ee[3])return!1}return!0}function se(_e,Ee){return ee(_e,(0,W.iL)(Ee,me.get()))}function re(_e,Ee){for(let De=0;De<ue.NUM;De++)if(!(0,B.Er)(_e[De],Ee))return!1;return!0}function j(_e,Ee,De){return ee(_e,(0,W._k)(Ee,De,me.get()))}function Y(_e,Ee){for(let De=0;De<ue.NUM;De++)if((0,B.jH)(_e[De],Ee)>0)return!1;return!0}function ee(_e,Ee){for(let De=0;De<ue.NUM;De++)if(!(0,B.oq)(_e[De],Ee))return!1;return!0}(_e=ie||(ie={}))[_e.LEFT=0]="LEFT",_e[_e.RIGHT=1]="RIGHT",_e[_e.BOTTOM=2]="BOTTOM",_e[_e.TOP=3]="TOP",_e[_e.NEAR=4]="NEAR",_e[_e.FAR=5]="FAR",function(_e){_e[_e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",_e[_e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",_e[_e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",_e[_e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",_e[_e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",_e[_e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",_e[_e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",_e[_e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(J||(J={}));const ce={bottom:[J.FAR_BOTTOM_RIGHT,J.NEAR_BOTTOM_RIGHT,J.NEAR_BOTTOM_LEFT,J.FAR_BOTTOM_LEFT],near:[J.NEAR_BOTTOM_LEFT,J.NEAR_BOTTOM_RIGHT,J.NEAR_TOP_RIGHT,J.NEAR_TOP_LEFT],far:[J.FAR_BOTTOM_RIGHT,J.FAR_BOTTOM_LEFT,J.FAR_TOP_LEFT,J.FAR_TOP_RIGHT],right:[J.NEAR_BOTTOM_RIGHT,J.FAR_BOTTOM_RIGHT,J.FAR_TOP_RIGHT,J.NEAR_TOP_RIGHT],left:[J.FAR_BOTTOM_LEFT,J.NEAR_BOTTOM_LEFT,J.NEAR_TOP_LEFT,J.FAR_TOP_LEFT],top:[J.FAR_TOP_LEFT,J.NEAR_TOP_LEFT,J.NEAR_TOP_RIGHT,J.FAR_TOP_RIGHT]};var ue,pe;(function(_e){_e[_e.NUM=6]="NUM"})(ue||(ue={})),function(_e){_e[_e.NUM=8]="NUM"}(pe||(pe={}));const he=[(0,$.f)(-1,-1,-1,1),(0,$.f)(1,-1,-1,1),(0,$.f)(1,1,-1,1),(0,$.f)(-1,1,-1,1),(0,$.f)(-1,-1,1,1),(0,$.f)(1,-1,1,1),(0,$.f)(1,1,1,1),(0,$.f)(-1,1,1,1)],me=new D.x(W.Ue),ge=te()},37299:(nt,Ae,v)=>{"use strict";v.d(Ae,{Dg:()=>W,Yr:()=>R,cD:()=>$,yB:()=>G});var D=v(94425);const R=Math.PI/180,G=/SPHEROID\[([^\]]+)]/i,Z=D.sv.radius,Q=D.sv.eccentricitySquared,$={a1:Z*Q,a2:Z*Q*Z*Q,a3:Z*Q*Q/2,a4:Z*Q*Z*Q*2.5,a5:Z*Q+Z*Q*Q/2,a6:1-Q},W={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:D.sv.radius,f:D.sv.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:D.Z1.radius,f:D.Z1.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:D.yr.radius,f:D.yr.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:D.yr.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},36947:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ku:()=>ae,Wt:()=>W,qC:()=>se}),v(8314);var H,Y,R=v(26584),G=v(62208),Z=v(79334),Q=v(38305);function W(Y,ee,ie){const J=ae(Y),ce=ee,ue=function B(Y,ee,ie){if(!X(Y)||!X(ee))return H.Unsupported;if(null==Y||null==ee)return H.Ok;if(!ie&&Y.heightUnit!==ee.heightUnit)return H.Units;if(Y.heightModel!==ee.heightModel)return H.HeightModel;switch(Y.heightModel){case"gravity-related-height":return H.Ok;case"ellipsoidal":return Y.vertCRS===ee.vertCRS?H.Ok:H.CRS;default:return H.Unsupported}}(J,ce,ie);if(J){const pe=Z.Z.deriveUnitFromSR(J,Y.spatialReference).heightUnit;if(!ie&&pe!==J.heightUnit){const he=new R.Z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${pe})`,{horizontalUnit:pe});return new R.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:J,error:he})}}if(!function te(Y){return"heightModelInfo"in Y&&null!=Y.heightModelInfo||null!=Y.spatialReference||!de(Y)}(Y)||ue===H.Unsupported)return new R.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:J});switch(ue){case H.Units:{const pe=J?.heightUnit||"unknown",he=ce?.heightUnit||"unknown",me=new R.Z("layerview:incompatible-height-unit",`The vertical units of the layer (${pe}) must match the vertical units of the scene (${he})`,{layerUnit:pe,sceneUnit:he});return new R.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:J,sceneHeightModelInfo:ce,error:me})}case H.HeightModel:{const pe=J?.heightModel||"unknown",he=ce?.heightModel||"unknown",me=new R.Z("layerview:incompatible-height-model",`The height model of the layer (${pe}) must match the height model of the scene (${he})`,{layerHeightModel:pe,sceneHeightModel:he});return new R.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:J,sceneHeightModelInfo:ce,error:me})}case H.CRS:{const pe=J?.vertCRS||"unknown",he=ce?.vertCRS||"unknown",me=new R.Z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${pe}) must match the vertical datum of the scene (${he})`,{layerDatum:pe,sceneDatum:he});return new R.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:J,sceneHeightModelInfo:ce,error:me})}}return null}function X(Y){return null==Y||null!=Y.heightModel&&null!=Y.heightUnit}function ae(Y){const ee=Y.url?(0,Q.Qc)(Y.url):void 0;return null==Y.spatialReference?.vcsWkid&&(0,G.pC)(ee)&&"ImageServer"===ee.serverType||!oe(Y)||!Y.heightModelInfo?de(Y)?Z.Z.deriveUnitFromSR(j,Y.spatialReference):null:Y.heightModelInfo}function oe(Y){return"heightModelInfo"in Y}function le(Y){if("unknown"===Y.type||!("capabilities"in Y))return!1;switch(Y.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":return!0;default:return!1}}function de(Y){return le(Y)?!!(Y.capabilities&&Y.capabilities.data&&Y.capabilities.data.supportsZ):re(Y)}function se(Y){return null!=Y.layers||re(Y)||le(Y)||oe(Y)}function re(Y){switch(Y.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(Y=H||(H={}))[Y.Ok=0]="Ok",Y[Y.Units=1]="Units",Y[Y.HeightModel=2]="HeightModel",Y[Y.CRS=3]="CRS",Y[Y.Unsupported=4]="Unsupported";const j=new Z.Z({heightModel:"gravity-related-height"})},11519:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ff:()=>de,IY:()=>j,UT:()=>re,h_:()=>G});var D=v(33190);function R(Y,ee){return(0,D.aV)(Y,ee)}function G(Y,ee){let J,ce,ue;if(Y.xmin<=ee.xmin){if(J=ee.xmin,Y.xmax<J)return!1}else if(J=Y.xmin,ee.xmax<J)return!1;if(Y.ymin<=ee.ymin){if(ce=ee.ymin,Y.ymax<ce)return!1}else if(ce=Y.ymin,ee.ymax<ce)return!1;if(Y.hasZ&&ee.hasZ&&ee.hasZ)if(Y.zmin<=ee.zmin){if(ue=ee.zmin,Y.zmax<ue)return!1}else if(ue=Y.zmin,ee.zmax<ue)return!1;return!0}function Z(Y,ee){const{points:ie,hasZ:J}=ee,ce=J?D.Qg:D.OQ;for(const ue of ie)if(ce(Y,ue))return!0;return!1}const Q=[0,0],$=[0,0],W=[0,0],B=[0,0],H=[Q,$,W,B],X=[[W,Q],[Q,$],[$,B],[B,W]];function te(Y,ee){return function ae(Y,ee){Q[0]=Y.xmin,Q[1]=Y.ymax,$[0]=Y.xmax,$[1]=Y.ymax,W[0]=Y.xmin,W[1]=Y.ymin,B[0]=Y.xmax,B[1]=Y.ymin;for(const ie of H)if((0,D.wP)(ee,ie))return!0;for(const ie of ee){if(!ie.length)continue;let J=ie[0];if((0,D.OQ)(Y,J))return!0;for(let ce=1;ce<ie.length;ce++){const ue=ie[ce];if((0,D.OQ)(Y,ue)||se(J,ue,X))return!0;J=ue}}return!1}(Y,ee.rings)}function oe(Y,ee){Q[0]=Y.xmin,Q[1]=Y.ymax,$[0]=Y.xmax,$[1]=Y.ymax,W[0]=Y.xmin,W[1]=Y.ymin,B[0]=Y.xmax,B[1]=Y.ymin;const ie=ee.paths;for(const J of ie){if(!ie.length)continue;let ce=J[0];if((0,D.OQ)(Y,ce))return!0;for(let ue=1;ue<J.length;ue++){const pe=J[ue];if((0,D.OQ)(Y,pe)||se(ce,pe,X))return!0;ce=pe}}return!1}const le=[0,0];function de(Y){for(let ee=0;ee<Y.length;ee++){const ie=Y[ee];for(let ce=0;ce<ie.length-1;ce++){const ue=ie[ce],pe=ie[ce+1];for(let he=ee+1;he<Y.length;he++)for(let me=0;me<Y[he].length-1;me++){const ge=Y[he][me],_e=Y[he][me+1];if(re(ue,pe,ge,_e,le)&&!(le[0]===ue[0]&&le[1]===ue[1]||le[0]===ge[0]&&le[1]===ge[1]||le[0]===pe[0]&&le[1]===pe[1]||le[0]===_e[0]&&le[1]===_e[1]))return!0}}const J=ie.length;if(!(J<=4))for(let ce=0;ce<J-3;ce++){let ue=J-1;0===ce&&(ue=J-2);const pe=ie[ce],he=ie[ce+1];for(let me=ce+2;me<ue;me++){const ge=ie[me],_e=ie[me+1];if(re(pe,he,ge,_e,le)&&!(le[0]===pe[0]&&le[1]===pe[1]||le[0]===ge[0]&&le[1]===ge[1]||le[0]===he[0]&&le[1]===he[1]||le[0]===_e[0]&&le[1]===_e[1]))return!0}}}return!1}function se(Y,ee,ie){for(let J=0;J<ie.length;J++)if(re(Y,ee,ie[J][0],ie[J][1]))return!0;return!1}function re(Y,ee,ie,J,ce){const[ue,pe]=Y,[he,me]=ee,[ge,_e]=ie,[Ee,De]=J,be=Ee-ge,Se=ue-ge,ye=he-ue,ve=De-_e,xe=pe-_e,ze=me-pe,Ke=ve*ye-be*ze;if(0===Ke)return!1;const We=(be*xe-ve*Se)/Ke,Ce=(ye*xe-ze*Se)/Ke;return We>=0&&We<=1&&Ce>=0&&Ce<=1&&(ce&&(ce[0]=ue+We*(he-ue),ce[1]=pe+We*(me-pe)),!0)}function j(Y){switch(Y){case"esriGeometryEnvelope":case"extent":return G;case"esriGeometryMultipoint":case"multipoint":return Z;case"esriGeometryPoint":case"point":return R;case"esriGeometryPolygon":case"polygon":return te;case"esriGeometryPolyline":case"polyline":return oe}}},91179:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ji:()=>de,YX:()=>B,aW:()=>H,im:()=>le,l9:()=>te,oU:()=>ae,q9:()=>re,wp:()=>X});var D=v(62208),R=v(2004),G=v(21674),Z=v(72854),Q=v(72642),$=v(37118),W=v(55214);function B(j){return void 0!==j.xmin&&void 0!==j.ymin&&void 0!==j.xmax&&void 0!==j.ymax}function H(j){return void 0!==j.points}function X(j){return void 0!==j.x&&void 0!==j.y}function te(j){return void 0!==j.paths}function ae(j){return void 0!==j.rings}function le(j){return(0,D.Wi)(j)?null:j instanceof G.Z?j:X(j)?Q.Z.fromJSON(j):te(j)?W.Z.fromJSON(j):ae(j)?$.Z.fromJSON(j):H(j)?Z.Z.fromJSON(j):B(j)?R.Z.fromJSON(j):null}function de(j){return j?X(j)?"esriGeometryPoint":te(j)?"esriGeometryPolyline":ae(j)?"esriGeometryPolygon":B(j)?"esriGeometryEnvelope":H(j)?"esriGeometryMultipoint":null:null}const se={esriGeometryPoint:Q.Z,esriGeometryPolyline:W.Z,esriGeometryPolygon:$.Z,esriGeometryEnvelope:R.Z,esriGeometryMultipoint:Z.Z};function re(j){return j&&se[j]||null}},13777:(nt,Ae,v)=>{"use strict";v.d(Ae,{AR:()=>re,Gr:()=>se,JG:()=>B,Jk:()=>te,KU:()=>le,Ue:()=>$,al:()=>H,ct:()=>de,nF:()=>oe,zk:()=>X});var D=v(21286),R=v(97535),G=v(84161),Z=v(28093),Q=v(26242);function $(J){return J?{origin:(0,Z.a)(J.origin),vector:(0,Z.a)(J.vector)}:{origin:(0,Z.c)(),vector:(0,Z.c)()}}function B(J,ce=$()){return H(J.origin,J.vector,ce)}function H(J,ce,ue=$()){return(0,G.c)(ue.origin,J),(0,G.c)(ue.vector,ce),ue}function X(J,ce,ue=$()){return(0,G.c)(ue.origin,J),(0,G.b)(ue.vector,ce,J),ue}function te(J,ce){const ue=(0,G.b)(Q.WM.get(),ce,J.origin),pe=(0,G.e)(J.vector,ue),he=(0,G.e)(J.vector,J.vector),me=(0,D.uZ)(pe/he,0,1),ge=(0,G.b)(Q.WM.get(),(0,G.g)(Q.WM.get(),J.vector,me),ue);return(0,G.e)(ge,ge)}function oe(J,ce,ue){return de(J,ce,0,1,ue)}function le(J,ce,ue){return(0,G.a)(ue,J.origin,(0,G.g)(ue,J.vector,ce))}function de(J,ce,ue,pe,he){const{vector:me,origin:ge}=J,_e=(0,G.b)(Q.WM.get(),ce,ge),Ee=(0,G.e)(me,_e)/(0,G.p)(me);return(0,G.g)(he,me,(0,D.uZ)(Ee,ue,pe)),(0,G.a)(he,he,J.origin)}function se(J,ce){if(Y(J,function W(J,ce){const ue=ie.get();return ue.origin=J,ue.vector=ce,ue}(ce.origin,ce.direction),!1,ee)){const{tA:ue,pB:pe,distance2:he}=ee;if(ue>=0&&ue<=1)return he;if(ue<0)return(0,G.d)(J.origin,pe);if(ue>1)return(0,G.d)((0,G.a)(Q.WM.get(),J.origin,J.vector),pe)}return null}function re(J,ce,ue){return!!Y(J,ce,!0,ee)&&((0,G.c)(ue,ee.pA),!0)}function Y(J,ce,ue,pe){const me=J.origin,ge=(0,G.a)(Q.WM.get(),me,J.vector),_e=ce.origin,Ee=(0,G.a)(Q.WM.get(),_e,ce.vector),De=Q.WM.get(),be=Q.WM.get();if(De[0]=me[0]-_e[0],De[1]=me[1]-_e[1],De[2]=me[2]-_e[2],be[0]=Ee[0]-_e[0],be[1]=Ee[1]-_e[1],be[2]=Ee[2]-_e[2],Math.abs(be[0])<1e-6&&Math.abs(be[1])<1e-6&&Math.abs(be[2])<1e-6)return!1;const Se=Q.WM.get();if(Se[0]=ge[0]-me[0],Se[1]=ge[1]-me[1],Se[2]=ge[2]-me[2],Math.abs(Se[0])<1e-6&&Math.abs(Se[1])<1e-6&&Math.abs(Se[2])<1e-6)return!1;const ye=De[0]*be[0]+De[1]*be[1]+De[2]*be[2],ve=be[0]*Se[0]+be[1]*Se[1]+be[2]*Se[2],xe=De[0]*Se[0]+De[1]*Se[1]+De[2]*Se[2],ze=be[0]*be[0]+be[1]*be[1]+be[2]*be[2],Ke=(Se[0]*Se[0]+Se[1]*Se[1]+Se[2]*Se[2])*ze-ve*ve;if(Math.abs(Ke)<1e-6)return!1;let We=(ye*ve-xe*ze)/Ke,Ce=(ye+ve*We)/ze;ue&&(We=(0,D.uZ)(We,0,1),Ce=(0,D.uZ)(Ce,0,1));const Be=Q.WM.get(),Fe=Q.WM.get();return Be[0]=me[0]+We*Se[0],Be[1]=me[1]+We*Se[1],Be[2]=me[2]+We*Se[2],Fe[0]=_e[0]+Ce*be[0],Fe[1]=_e[1]+Ce*be[1],Fe[2]=_e[2]+Ce*be[2],pe.tA=We,pe.tB=Ce,pe.pA=Be,pe.pB=Fe,pe.distance2=(0,G.d)(Be,Fe),!0}const ee={tA:0,tB:0,pA:(0,Z.c)(),pB:(0,Z.c)(),distance2:0},ie=new R.x(()=>$())},13757:(nt,Ae,v)=>{"use strict";v.d(Ae,{d:()=>R});var D=v(21286);function R(W,B,H){const X=W.byteLength/(4*B),te=new Uint32Array(W,0,X*B);let ae=new Uint32Array(X);const oe=H?.minReduction??0,le=H?.originalIndices||null,de=le?le.length:0,se=H?.componentOffsets||null;let re=0;if(se)for(let ge=0;ge<se.length-1;ge++){const _e=se[ge+1]-se[ge];_e>re&&(re=_e)}else re=X;const j=Math.floor(1.1*re)+1;(null==$||$.length<2*j)&&($=new Uint32Array((0,D.Sf)(2*j)));for(let ge=0;ge<2*j;ge++)$[ge]=0;let Y=0;const ee=!!se&&!!le,ie=ee?de:X,J=ee?new Uint32Array(de):null;let ue=0!==oe?Math.ceil(7.84*1.96/(oe*oe)*oe*(1-oe)):ie,pe=1,he=se?se[1]:ie;for(let ge=0;ge<ie;ge++){if(ge===ue){const ye=1-Y/ge;if(ye+1.96*Math.sqrt(ye*(1-ye)/ge)<oe)return null;ue*=2}if(ge===he){for(let ye=0;ye<2*j;ye++)$[ye]=0;if(le)for(let ye=se[pe-1];ye<se[pe];ye++)J[ye]=ae[le[ye]];he=se[++pe]}const _e=ee?le[ge]:ge,Ee=_e*B,De=Q(te,Ee,B);let be=De%j,Se=Y;for(;0!==$[2*be+1];){if($[2*be]===De){const ye=$[2*be+1]-1;if(G(te,Ee,ye*B,B)){Se=ae[ye];break}}be++,be>=j&&(be-=j)}Se===Y&&($[2*be]=De,$[2*be+1]=_e+1,Y++),ae[_e]=Se}if(0!==oe&&1-Y/X<oe)return null;if(ee){for(let ge=se[pe-1];ge<J.length;ge++)J[ge]=ae[le[ge]];ae=J}const me=new Uint32Array(B*Y);Y=0;for(let ge=0;ge<ie;ge++)ae[ge]===Y&&(Z(te,(ee?le[ge]:ge)*B,me,Y*B,B),Y++);if(le&&!ee){const ge=new Uint32Array(de);for(let _e=0;_e<ge.length;_e++)ge[_e]=ae[le[_e]];ae=ge}return{buffer:me.buffer,indices:ae,uniqueCount:Y}}function G(W,B,H,X){for(let te=0;te<X;te++)if(W[B+te]!==W[H+te])return!1;return!0}function Z(W,B,H,X,te){for(let ae=0;ae<te;ae++)H[X+ae]=W[B+ae]}function Q(W,B,H){let X=0;for(let te=0;te<H;te++)X=W[B+te]+X|0,X=X+(X<<11)+(X>>>2)|0;return X>>>0}let $=null},65231:(nt,Ae,v)=>{"use strict";v.d(Ae,{Iz:()=>de,M2:()=>ce,To:()=>j,VS:()=>ie,XO:()=>re,Yk:()=>se,w9:()=>ee,wi:()=>J,zZ:()=>Y});var D=v(63290),R=v(62208),G=v(30217),Z=v(550),Q=v(43703),$=v(84161),W=v(28093),B=v(55915),H=v(12080),X=v(37053),te=v(46367),ae=v(60479),oe=v(79800);const le=D.Z.getLogger("esri.geometry.support.meshUtils.normalProjection");function de(Se,ye,ve,xe,ze){return pe(xe)?(ue(ge.TO_PCPF,ae.ct.fromTypedArray(Se),ae.fP.fromTypedArray(ye),ae.fP.fromTypedArray(ve),xe,ae.ct.fromTypedArray(ze)),ze):(le.error("Cannot convert spatial reference to PCPF"),ze)}function se(Se,ye,ve,xe,ze){return pe(xe)?(ue(ge.FROM_PCPF,ae.ct.fromTypedArray(Se),ae.fP.fromTypedArray(ye),ae.fP.fromTypedArray(ve),xe,ae.ct.fromTypedArray(ze)),ze):(le.error("Cannot convert to spatial reference from PCPF"),ze)}function re(Se,ye,ve){return(0,B.CM)(Se,ye,0,ve,(0,H.rS)(ye),0,Se.length/3),ve}function j(Se,ye,ve){return(0,B.CM)(Se,(0,H.rS)(ve),0,ye,ve,0,Se.length/3),ye}function Y(Se,ye,ve){if((0,R.Wi)(Se))return ye;const xe=ae.fP.fromTypedArray(Se),ze=ae.fP.fromTypedArray(ye);return(0,oe.t)(ze,xe,ve),ye}function ee(Se,ye,ve){if((0,R.Wi)(Se))return ye;(0,G.b)(be,ve);const xe=ae.ct.fromTypedArray(Se),ze=ae.ct.fromTypedArray(ye);return(0,oe.a)(ze,xe,be),(0,G.i)(be)||(0,oe.n)(ze,ze),ye}function ie(Se,ye,ve){if((0,R.Wi)(Se))return ye;(0,G.b)(be,ve);const xe=ae.ct.fromTypedArray(Se,4*Float32Array.BYTES_PER_ELEMENT),ze=ae.ct.fromTypedArray(ye,4*Float32Array.BYTES_PER_ELEMENT);if((0,oe.a)(ze,xe,be),(0,G.i)(be)||(0,oe.n)(ze,ze),Se!==ye)for(let Ke=3;Ke<Se.length;Ke+=4)ye[Ke]=Se[Ke];return ye}function J(Se,ye,ve,xe,ze){if(!pe(xe))return le.error("Cannot convert spatial reference to PCPF"),ze;ue(ge.TO_PCPF,ae.ct.fromTypedArray(Se,4*Float32Array.BYTES_PER_ELEMENT),ae.fP.fromTypedArray(ye),ae.fP.fromTypedArray(ve),xe,ae.ct.fromTypedArray(ze,4*Float32Array.BYTES_PER_ELEMENT));for(let Ke=3;Ke<Se.length;Ke+=4)ze[Ke]=Se[Ke];return ze}function ce(Se,ye,ve,xe,ze){if(!pe(xe))return le.error("Cannot convert to spatial reference from PCPF"),ze;ue(ge.FROM_PCPF,ae.ct.fromTypedArray(Se,16),ae.fP.fromTypedArray(ye),ae.fP.fromTypedArray(ve),xe,ae.ct.fromTypedArray(ze,16));for(let Ke=3;Ke<Se.length;Ke+=4)ze[Ke]=Se[Ke];return ze}function ue(Se,ye,ve,xe,ze,Ke){if(!ye)return;const We=ve.count,Ce=(0,H.rS)(ze);if(he(ze))for(let Be=0;Be<We;Be++)xe.getVec(Be,_e),ye.getVec(Be,Ee),(0,B.Bm)(Ce,_e,De,Ce),(0,G.f)(be,De),Se===ge.FROM_PCPF&&(0,G.t)(be,be),(0,$.t)(Ee,Ee,be),Ke.setVec(Be,Ee);else for(let Be=0;Be<We;Be++){xe.getVec(Be,_e),ye.getVec(Be,Ee),(0,B.Bm)(Ce,_e,De,Ce),(0,G.f)(be,De);const Fe=(0,te.mZ)(ve.get(Be,1));let je=Math.cos(Fe);Se===ge.TO_PCPF&&(je=1/je),be[0]*=je,be[1]*=je,be[2]*=je,be[3]*=je,be[4]*=je,be[5]*=je,Se===ge.FROM_PCPF&&(0,G.t)(be,be),(0,$.t)(Ee,Ee,be),(0,$.n)(Ee,Ee),Ke.setVec(Be,Ee)}return Ke}function pe(Se){return he(Se)||function me(Se){return Se.isWebMercator}(Se)}function he(Se){return Se.isWGS84||(0,X.yW)(Se)||(0,X.BZ)(Se)||(0,X.V2)(Se)}var ge,Se;(Se=ge||(ge={}))[Se.TO_PCPF=0]="TO_PCPF",Se[Se.FROM_PCPF=1]="FROM_PCPF";const _e=(0,W.c)(),Ee=(0,W.c)(),De=(0,Q.c)(),be=(0,Z.c)()},93555:(nt,Ae,v)=>{"use strict";v.d(Ae,{aX:()=>Ee});var D=v(15861),R=v(59318),G=v(26584),Z=v(63290),Q=v(62208),$=v(37118),W=v(55214),B=v(74618),H=v(37053),X=v(46367),ae=(v(29132),v(84792)),oe=v(91179),le=v(2618);function de(ye,ve,xe,ze){return se.apply(this,arguments)}function se(){return(se=(0,D.Z)(function*(ye,ve,xe,ze){const Ke=(0,le.en)(ye),We=ve[0].spatialReference,Ce={...ze,query:{...Ke.query,f:"json",sr:JSON.stringify(We),target:JSON.stringify({geometryType:(0,oe.Ji)(ve[0]),geometries:ve}),cutter:JSON.stringify(xe)}},Be=yield(0,ae.default)(Ke.path+"/cut",Ce),{cutIndexes:Fe,geometries:je=[]}=Be.data;return{cutIndexes:Fe,geometries:je.map(Re=>{const He=(0,oe.im)(Re);return He.spatialReference=We,He})}})).apply(this,arguments)}var re=v(21726),j=v(10920);function Y(ye,ve,xe){return ee.apply(this,arguments)}function ee(){return(ee=(0,D.Z)(function*(ye,ve,xe){const ze="string"==typeof ye?(0,re.mN)(ye):ye,Ke=ve[0].spatialReference,We=(0,oe.Ji)(ve[0]),Ce={...xe,query:{...ze.query,f:"json",sr:Ke.wkid?Ke.wkid:JSON.stringify(Ke),geometries:JSON.stringify((0,j.F)(ve))}},{data:Be}=yield(0,ae.default)(ze.path+"/simplify",Ce);return(0,j.o)(Be.geometries,We,Ke)})).apply(this,arguments)}const ie=Z.Z.getLogger("esri.geometry.support.normalizeUtils");function ce(ye){return"polygon"===ye[0].type}function ue(ye){return"polyline"===ye[0].type}function me(ye,ve,xe){if(ve){const ze=function he(ye,ve){if(!(ye instanceof W.Z||ye instanceof $.Z)){const Ke="straightLineDensify: the input geometry is neither polyline nor polygon";throw ie.error(Ke),new G.Z(Ke)}const xe=(0,B.x3)(ye),ze=[];for(const Ke of xe){const We=[];ze.push(We),We.push([Ke[0][0],Ke[0][1]]);for(let Ce=0;Ce<Ke.length-1;Ce++){const Be=Ke[Ce][0],Fe=Ke[Ce][1],je=Ke[Ce+1][0],Re=Ke[Ce+1][1],He=Math.sqrt((je-Be)*(je-Be)+(Re-Fe)*(Re-Fe)),Ie=(Re-Fe)/He,Ge=(je-Be)/He,Pe=He/ve;if(Pe>1){for(let Xe=1;Xe<=Pe-1;Xe++){const Ye=Xe*ve;We.push([Ge*Ye+Be,Ie*Ye+Fe])}const Le=(He+Math.floor(Pe-1)*ve)/2;We.push([Ge*Le+Be,Ie*Le+Fe])}We.push([je,Re])}}return function J(ye){return"polygon"===ye.type}(ye)?new $.Z({rings:ze,spatialReference:ye.spatialReference}):new W.Z({paths:ze,spatialReference:ye.spatialReference})}(ye,1e6);ye=(0,X.Sx)(ze,!0)}return xe&&(ye=(0,B.Sy)(ye,xe)),ye}function ge(ye,ve,xe){if(Array.isArray(ye)){const ze=ye[0];if(ze>ve){const Ke=(0,B.XZ)(ze,ve);ye[0]=ze+Ke*(-2*ve)}else if(ze<xe){const Ke=(0,B.XZ)(ze,xe);ye[0]=ze+Ke*(-2*xe)}}else{const ze=ye.x;if(ze>ve){const Ke=(0,B.XZ)(ze,ve);ye=ye.clone().offset(Ke*(-2*ve),0)}else if(ze<xe){const Ke=(0,B.XZ)(ze,xe);ye=ye.clone().offset(Ke*(-2*xe),0)}}return ye}function _e(ye,ve){let xe=-1;for(let ze=0;ze<ve.cutIndexes.length;ze++){const Ke=ve.cutIndexes[ze],We=ve.geometries[ze],Ce=(0,B.x3)(We);for(let Be=0;Be<Ce.length;Be++){const Fe=Ce[Be];Fe.some(je=>{if(je[0]<180)return!0;{let Re=0;for(let Ie=0;Ie<Fe.length;Ie++){const Ge=Fe[Ie][0];Re=Ge>Re?Ge:Re}Re=Number(Re.toFixed(9));const He=-360*(0,B.XZ)(Re,180);for(let Ie=0;Ie<Fe.length;Ie++){const Ge=We.getPoint(Be,Ie);We.setPoint(Be,Ie,Ge.clone().offset(He,0))}return!0}})}if(Ke===xe){if(ce(ye))for(const Be of(0,B.x3)(We))ye[Ke]=ye[Ke].addRing(Be);else if(ue(ye))for(const Be of(0,B.x3)(We))ye[Ke]=ye[Ke].addPath(Be)}else xe=Ke,ye[Ke]=We}return ye}function Ee(ye,ve,xe){return De.apply(this,arguments)}function De(){return(De=(0,D.Z)(function*(ye,ve,xe){if(!Array.isArray(ye))return Ee([ye],ve);ve&&"string"!=typeof ve&&ie.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const ze="string"==typeof ve?ve:ve?.url??R.Z.geometryServiceUrl;let Ke,We,Ce,Be,Fe,je,Re,He,Ie=0;const Ge=[],Pe=[];for(const Je of ye)if((0,Q.Wi)(Je))Pe.push(Je);else if(Ke||(Ke=Je.spatialReference,We=(0,H.C5)(Ke),Ce=Ke.isWebMercator,je=Ce?102100:4326,Be=B.UZ[je].maxX,Fe=B.UZ[je].minX,Re=B.UZ[je].plus180Line,He=B.UZ[je].minus180Line),We)if("mesh"===Je.type)Pe.push(Je);else if("point"===Je.type)Pe.push(ge(Je.clone(),Be,Fe));else if("multipoint"===Je.type){const rt=Je.clone();rt.points=rt.points.map(tt=>ge(tt,Be,Fe)),Pe.push(rt)}else if("extent"===Je.type){const rt=Je.clone()._normalize(!1,!1,We);Pe.push(rt.rings?new $.Z(rt):rt)}else if(Je.extent){const rt=Je.extent,tt=(0,B.XZ)(rt.xmin,Fe)*(2*Be);let et=0===tt?Je.clone():(0,B.Sy)(Je.clone(),tt);rt.offset(tt,0),rt.intersects(Re)&&rt.xmax!==Be?(Ie=rt.xmax>Ie?rt.xmax:Ie,et=me(et,Ce),Ge.push(et),Pe.push("cut")):rt.intersects(He)&&rt.xmin!==Fe?(Ie=rt.xmax*(2*Be)>Ie?rt.xmax*(2*Be):Ie,et=me(et,Ce,360),Ge.push(et),Pe.push("cut")):Pe.push(et)}else Pe.push(Je.clone());else Pe.push(Je);let Le=(0,B.XZ)(Ie,Be),Me=-90;const Ne=Le,Xe=new W.Z;for(;Le>0;){const Je=360*Le-180;Xe.addPath([[Je,Me],[Je,-1*Me]]),Me*=-1,Le--}if(Ge.length>0&&Ne>0){const Je=_e(Ge,yield de(ze,Ge,Xe,xe)),rt=[],tt=[];for(let ot=0;ot<Pe.length;ot++){const ut=Pe[ot];if("cut"!==ut)tt.push(ut);else{const _t=Je.shift(),Ct=ye[ot];(0,Q.pC)(Ct)&&"polygon"===Ct.type&&Ct.rings&&Ct.rings.length>1&&_t.rings.length>=Ct.rings.length?(rt.push(_t),tt.push("simplify")):tt.push(Ce?(0,X.$)(_t):_t)}}if(!rt.length)return tt;const et=yield Y(ze,rt,xe),qe=[];for(let ot=0;ot<tt.length;ot++){const ut=tt[ot];qe.push("simplify"!==ut?ut:Ce?(0,X.$)(et.shift()):et.shift())}return qe}const Ye=[];for(let Je=0;Je<Pe.length;Je++){const rt=Pe[Je];if("cut"!==rt)Ye.push(rt);else{const tt=Ge.shift();Ye.push(!0===Ce?(0,X.$)(tt):tt)}}return Ye})).apply(this,arguments)}},74618:(nt,Ae,v)=>{"use strict";v.d(Ae,{Sy:()=>$,UZ:()=>Z,XZ:()=>Q,x3:()=>W});var D=v(55214),R=v(65234),G=v(91179);const Z={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new D.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:R.Z.WebMercator}),minus180Line:new D.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:R.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new D.Z({paths:[[[180,-180],[180,180]]],spatialReference:R.Z.WGS84}),minus180Line:new D.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:R.Z.WGS84})}};function Q(B,H){return Math.ceil((B-H)/(2*H))}function $(B,H){const X=W(B);for(const te of X)for(const ae of te)ae[0]+=H;return B}function W(B){return(0,G.oU)(B)?B.rings:B.paths}},90014:(nt,Ae,v)=>{"use strict";v.d(Ae,{$I:()=>re,Ac:()=>Se,BR:()=>ge,Er:()=>xe,JG:()=>te,Oy:()=>oe,T5:()=>ue,Ue:()=>H,Yq:()=>le,_l:()=>We,al:()=>ae,dZ:()=>Ee,fn:()=>me,jH:()=>Be,mJ:()=>je,my:()=>he,nF:()=>ze,oq:()=>ve,re:()=>X,rx:()=>_e,tk:()=>pe,zk:()=>de});var D=v(21286),R=v(62208),G=v(84161),Z=v(28093),W=(v(97126),v(34054),v(26242));function H(Pe=Re){return[Pe[0],Pe[1],Pe[2],Pe[3]]}function X(Pe=Re[0],Le=Re[1],Me=Re[2],Ne=Re[3]){return ae(Pe,Le,Me,Ne,W.o6.get())}function te(Pe,Le){return ae(Le[0],Le[1],Le[2],Le[3],Pe)}function ae(Pe,Le,Me,Ne,Xe=H()){return Xe[0]=Pe,Xe[1]=Le,Xe[2]=Me,Xe[3]=Ne,Xe}function oe(Pe,Le,Me){return(0,G.c)(Me,Pe),Me[3]=Le,Me}function le(Pe,Le,Me){const Ne=Le[0]*Le[0]+Le[1]*Le[1]+Le[2]*Le[2],Xe=Math.abs(Ne-1)>1e-5&&Ne>1e-12?1/Math.sqrt(Ne):1;return Me[0]=Le[0]*Xe,Me[1]=Le[1]*Xe,Me[2]=Le[2]*Xe,Me[3]=-(Me[0]*Pe[0]+Me[1]*Pe[1]+Me[2]*Pe[2]),Me}function de(Pe,Le,Me,Ne=H()){const Xe=Me[0]-Le[0],Ye=Me[1]-Le[1],Je=Me[2]-Le[2],rt=Pe[0]-Le[0],tt=Pe[1]-Le[1],et=Pe[2]-Le[2],qe=Ye*et-Je*tt,ot=Je*rt-Xe*et,ut=Xe*tt-Ye*rt,_t=qe*qe+ot*ot+ut*ut,Ct=Math.abs(_t-1)>1e-5&&_t>1e-12?1/Math.sqrt(_t):1;return Ne[0]=qe*Ct,Ne[1]=ot*Ct,Ne[2]=ut*Ct,Ne[3]=-(Ne[0]*Pe[0]+Ne[1]*Pe[1]+Ne[2]*Pe[2]),Ne}function re(Pe,Le,Me,Ne,Xe){if(Pe.count<3)return!1;Pe.getVec(Me,Y);let Ye=Ne,Je=!1;for(;Ye<Pe.count-1&&!Je;)Pe.getVec(Ye,ee),Ye++,Je=!(0,G.k)(Y,ee);if(!Je)return!1;for(Ye=Math.max(Ye,Xe),Je=!1;Ye<Pe.count&&!Je;)Pe.getVec(Ye,ie),Ye++,(0,G.b)(J,Y,ee),(0,G.n)(J,J),(0,G.b)(ce,ee,ie),(0,G.n)(ce,ce),Je=!(0,G.k)(Y,ie)&&!(0,G.k)(ee,ie)&&Math.abs((0,G.e)(J,ce))<j;return Je?(de(Y,ee,ie,Le),!0):(0!==Me||1!==Ne||2!==Xe)&&re(Pe,Le,0,1,2)}v(98943);const j=.99619469809,Y=(0,Z.c)(),ee=(0,Z.c)(),ie=(0,Z.c)(),J=(0,Z.c)(),ce=(0,Z.c)();function ue(Pe,Le,Me){return Le!==Pe&&te(Pe,Le),Pe[3]=-(0,G.e)(Pe,Me),Pe}function pe(Pe,Le){return Le[0]=-Pe[0],Le[1]=-Pe[1],Le[2]=-Pe[2],Le[3]=-Pe[3],Le}function he(Pe,Le,Me,Ne){return(0,G.f)(ie,Le,Pe),le(Me,ie,Ne)}function me(Pe,Le,Me,Ne){return Fe(Pe,Le,(0,G.b)(W.WM.get(),Me,Le),Ie,Ne)}function ge(Pe,Le,Me){return!!(0,R.pC)(Le)&&Fe(Pe,Le.origin,Le.direction,Ge,Me)}function _e(Pe,Le,Me){return Fe(Pe,Le.origin,Le.vector,He.NONE,Me)}function Ee(Pe,Le,Me){return Fe(Pe,Le.origin,Le.vector,He.CLAMP,Me)}function Se(Pe,Le){return Be(Pe,Le)>=0}function ve(Pe,Le){const Me=(0,G.e)(Pe,Le.ray.direction),Ne=-Be(Pe,Le.ray.origin);if(Ne<0&&Me>=0)return!1;if(Me>-1e-6&&Me<1e-6)return Ne>0;if((Ne<0||Me<0)&&!(Ne<0&&Me<0))return!0;const Xe=Ne/Me;return Me>0?Xe<Le.c1&&(Le.c1=Xe):Xe>Le.c0&&(Le.c0=Xe),Le.c0<=Le.c1}function xe(Pe,Le){const Me=(0,G.e)(Pe,Le.ray.direction),Ne=-Be(Pe,Le.ray.origin);if(Me>-1e-6&&Me<1e-6)return Ne>0;const Xe=Ne/Me;return Me>0?Xe<Le.c1&&(Le.c1=Xe):Xe>Le.c0&&(Le.c0=Xe),Le.c0<=Le.c1}function ze(Pe,Le,Me){const Ne=(0,G.g)(W.WM.get(),Pe,-Pe[3]),Xe=We(Pe,(0,G.b)(W.WM.get(),Le,Ne),W.WM.get());return(0,G.a)(Me,Xe,Ne),Me}function We(Pe,Le,Me){const Ne=(0,G.g)(W.WM.get(),Pe,(0,G.e)(Pe,Le));return(0,G.b)(Me,Le,Ne),Me}function Be(Pe,Le){return(0,G.e)(Pe,Le)+Pe[3]}function Fe(Pe,Le,Me,Ne,Xe){const Ye=(0,G.e)(Pe,Me);if(0===Ye)return!1;let Je=-((0,G.e)(Pe,Le)+Pe[3])/Ye;return Ne&He.CLAMP&&(Je=(0,D.uZ)(Je,0,1)),!(!(Ne&He.INFINITE_MIN)&&Je<0||!(Ne&He.INFINITE_MAX)&&Je>1||((0,G.a)(Xe,Le,(0,G.g)(Xe,Me,Je)),0))}function je(Pe){return Pe}const Re=[0,0,1,0];var He,Pe;(Pe=He||(He={}))[Pe.NONE=0]="NONE",Pe[Pe.CLAMP=1]="CLAMP",Pe[Pe.INFINITE_MIN=4]="INFINITE_MIN",Pe[Pe.INFINITE_MAX=8]="INFINITE_MAX";const Ie=He.INFINITE_MIN|He.INFINITE_MAX,Ge=He.INFINITE_MAX},7848:(nt,Ae,v)=>{"use strict";v.d(Ae,{G6:()=>We,Ie:()=>Ke,J9:()=>xe,RF:()=>De,U1:()=>ze,vY:()=>W});var D=v(62208);v(91179);const Z=(Ce,Be,Fe)=>[Be,Fe],Q=(Ce,Be,Fe)=>[Be,Fe,Ce[2]],$=(Ce,Be,Fe)=>[Be,Fe,Ce[2],Ce[3]];function W(Ce){return Ce?{originPosition:"upper-left"===Ce.originPosition?"upperLeft":"lower-left"===Ce.originPosition?"lowerLeft":Ce.originPosition,scale:Ce.tolerance?[Ce.tolerance,Ce.tolerance]:[1,1],translate:(0,D.pC)(Ce.extent)?[Ce.extent.xmin,Ce.extent.ymax]:[0,0]}:null}function se({scale:Ce,translate:Be},Fe){return Fe*Ce[0]+Be[0]}function re({scale:Ce,translate:Be},Fe){return Be[1]-Fe*Ce[1]}function j(Ce,Be,Fe){const je=new Array(Fe.length);if(!Fe.length)return je;const[Re,He]=Ce.scale;let Ie=se(Ce,Fe[0][0]),Ge=re(Ce,Fe[0][1]);je[0]=Be(Fe[0],Ie,Ge);for(let Pe=1;Pe<Fe.length;Pe++){const Le=Fe[Pe];Ie+=Le[0]*Re,Ge-=Le[1]*He,je[Pe]=Be(Le,Ie,Ge)}return je}function Y(Ce,Be,Fe){const je=new Array(Fe.length);for(let Re=0;Re<Fe.length;Re++)je[Re]=j(Ce,Be,Fe[Re]);return je}function De(Ce,Be,Fe,je,Re){return Be.x=function H({scale:Ce,translate:Be},Fe){return Math.round((Fe-Be[0])/Ce[0])}(Ce,Fe.x),Be.y=function X({scale:Ce,translate:Be},Fe){return Math.round((Be[1]-Fe)/Ce[1])}(Ce,Fe.y),Be!==Fe&&(je&&(Be.z=Fe.z),Re&&(Be.m=Fe.m)),Be}function xe(Ce,Be,Fe,je,Re){return(0,D.pC)(Fe)&&(Be.points=function ie(Ce,Be,Fe,je){return j(Ce,Fe?je?$:Q:je?Q:Z,Be)}(Ce,Fe.points,je,Re)),Be}function ze(Ce,Be,Fe,je,Re){return(0,D.Wi)(Fe)||(Be.x=se(Ce,Fe.x),Be.y=re(Ce,Fe.y),Be!==Fe&&(je&&(Be.z=Fe.z),Re&&(Be.m=Fe.m))),Be}function Ke(Ce,Be,Fe,je,Re){return(0,D.pC)(Fe)&&(Be.rings=function ce(Ce,Be,Fe,je){return Y(Ce,Fe?je?$:Q:je?Q:Z,Be)}(Ce,Fe.rings,je,Re)),Be}function We(Ce,Be,Fe,je,Re){return(0,D.pC)(Fe)&&(Be.paths=function J(Ce,Be,Fe,je){return Y(Ce,Fe?je?$:Q:je?Q:Z,Be)}(Ce,Fe.paths,je,Re)),Be}},70562:(nt,Ae,v)=>{"use strict";v.d(Ae,{JG:()=>X,JI:()=>de,Jk:()=>oe,Ue:()=>$,al:()=>ae,fS:()=>B,re:()=>H,zk:()=>te});var D=v(85931),R=v(97535),G=v(84161),Z=v(28093),Q=v(26242);function $(re){return re?W((0,Z.a)(re.origin),(0,Z.a)(re.direction)):W((0,Z.c)(),(0,Z.c)())}function W(re,j){return{origin:re,direction:j}}function B(re,j){return(0,D.fS)(re.origin,j.origin)&&(0,D.fS)(re.direction,j.direction)}function H(re,j){const Y=se.get();return Y.origin=re,Y.direction=j,Y}function X(re,j=$()){return ae(re.origin,re.direction,j)}function te(re,j,Y=$()){return(0,G.c)(Y.origin,re),(0,G.b)(Y.direction,j,re),Y}function ae(re,j,Y=$()){return(0,G.c)(Y.origin,re),(0,G.c)(Y.direction,j),Y}function oe(re,j){const Y=(0,G.f)(Q.WM.get(),(0,G.n)(Q.WM.get(),re.direction),(0,G.b)(Q.WM.get(),j,re.origin));return(0,G.e)(Y,Y)}function de(re,j,Y){const ee=(0,G.e)(re.direction,(0,G.b)(Y,j,re.origin));return(0,G.a)(Y,re.origin,(0,G.g)(Y,re.direction,ee)),Y}const se=new R.x(()=>$())},83137:(nt,Ae,v)=>{"use strict";v.d(Ae,{DE:()=>Q,dp:()=>Z,yZ:()=>G});var D=v(16730);function G(B,H){const X=H||B.extent,te=B.width,ae=(0,D.c9)(X&&X.spatialReference);return X&&te?X.width/te*ae*D.hd*96:0}function Z(B,H){return B/((0,D.c9)(H)*D.hd*96)}function Q(B){return B/(96*D.hd)}},37053:(nt,Ae,v)=>{"use strict";v.d(Ae,{BZ:()=>ee,C5:()=>ae,JY:()=>ue,ME:()=>ie,MP:()=>ce,N$:()=>le,QM:()=>j,R_:()=>he,V2:()=>J,WR:()=>me,Zn:()=>pe,fS:()=>te,o$:()=>Y,oR:()=>de,sS:()=>re,sT:()=>oe,yW:()=>se});var D=v(62208),R=v(77275),G=v(6178),Z=v(84029);const Q={102113:!0,102100:!0,3857:!0,3785:!0},$={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},W='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',B=[-20037508.342788905,20037508.342788905],H=[-20037508.342787,20037508.342787],X={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:B,origin:H,dx:1e-5},102100:{wkTemplate:W,valid:B,origin:H,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:B,origin:H,dx:1e-5},3857:{wkTemplate:W,valid:B,origin:H,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function te(ge,_e){return ge===_e||!(0,D.Wi)(ge)&&!(0,D.Wi)(_e)&&(null!=ge.wkid||null!=_e.wkid?ge.wkid===_e.wkid||re(ge)&&re(_e)||null!=_e.latestWkid&&ge.wkid===_e.latestWkid||null!=ge.latestWkid&&_e.wkid===ge.latestWkid:!(!ge.wkt||!_e.wkt)&&ge.wkt.toUpperCase()===_e.wkt.toUpperCase())}function ae(ge){return ue(ge)&&ge.wkid&&X[ge.wkid]||null}function oe(ge){return!!ue(ge)&&(ge.wkid?null==Z.Z[ge.wkid]:!!ge.wkt&&!!/^\s*GEOGCS/i.test(ge.wkt))}function le(ge){return!(ee(ge)||J(ge))}function de(ge){return ue(ge)&&4326===ge.wkid}function se(ge){return ue(ge)&&ge.wkid===G.W.CGCS2000}function re(ge){return ue(ge)&&null!=ge.wkid&&!0===Q[ge.wkid]}function j(ge){return ue(ge)&&32662===ge.wkid}function Y(ge){return ge===G.W.GCSMARS2000||ge===G.W.GCSMARS2000_SPHERE}function ee(ge){return ue(ge)&&null!=ge.wkid&&Y(ge.wkid)}function ie(ge){return ge===G.W.GCSMOON2000}function J(ge){return ue(ge)&&null!=ge.wkid&&ie(ge.wkid)}function ce(ge){return ue(ge)&&null!=ge.wkid&&!0===$[ge.wkid]}function ue(ge){return(0,D.pC)(ge)&&(null!=ge.wkid&&ge.wkid>=2e3||null!=ge.wkt)}const pe={wkid:4326,wkt:(0,R.gx)(X[4326].wkTemplate,{Central_Meridian:"0.0"})},he={wkid:102100,latestWkid:3857},me={wkid:32662}},11544:(nt,Ae,v)=>{"use strict";v.d(Ae,{bE:()=>le,wu:()=>ae});var D=v(97535),R=v(84161),G=v(28093),Z=v(13777);function ae(Y,ee,ie){return.5*Math.abs((ee[0]-Y[0])*(ie[1]-Y[1])-(ee[1]-Y[1])*(ie[0]-Y[0]))}function le(Y,ee,ie){return(0,R.b)(re,ee,Y),(0,R.b)(j,ie,Y),(0,R.l)((0,R.f)(re,re,j))/2}v(26242),new D.x(Z.Ue),new D.x(()=>function $(Y){return Y?{p0:(0,G.a)(Y.p0),p1:(0,G.a)(Y.p1),p2:(0,G.a)(Y.p2)}:{p0:(0,G.c)(),p1:(0,G.c)(),p2:(0,G.c)()}}());const re=(0,G.c)(),j=(0,G.c)()},85334:(nt,Ae,v)=>{"use strict";v.d(Ae,{Mk:()=>$,ZI:()=>H,bT:()=>Z});var H,X,D=v(11915),R=v(25748),G=v(13757);function Z(X){const te=$(X.rings,X.hasZ,H.CCW_IS_HOLE),ae=new Array;let oe=0,le=0;for(const re of te.polygons){const Y=re.index,ee=new Float64Array(te.position.buffer,3*Y*te.position.BYTES_PER_ELEMENT,3*re.count),ie=re.holeIndices.map(ce=>ce-Y),J=new Uint32Array((0,D.e)(ee,ie,3));ae.push({position:ee,faces:J}),oe+=ee.length,le+=J.length}const de=function Q(X,te,ae){if(1===X.length)return X[0];const oe=new Float64Array(te),le=new Uint32Array(ae);let de=0,se=0,re=0;for(const j of X){for(let Y=0;Y<j.position.length;Y++)oe[de++]=j.position[Y];for(let Y=0;Y<j.faces.length;Y++)le[se++]=j.faces[Y]+re;re=de/3}return{position:oe,faces:le}}(ae,oe,le),se=(0,G.d)(de.position.buffer,6,{originalIndices:de.faces});return de.position=new Float64Array(se.buffer),de.faces=se.indices,de}function $(X,te,ae){const oe=X.length,le=new Array(oe),de=new Array(oe),se=new Array(oe);let re=0,j=0,Y=0,ee=0;for(let ce=0;ce<oe;++ce)ee+=X[ce].length;const ie=new Float64Array(3*ee);let J=0;for(let ce=oe-1;ce>=0;ce--){const ue=X[ce],pe=ae===H.CCW_IS_HOLE&&B(ue);if(pe&&1!==oe)le[re++]=ue;else{let he=ue.length;for(let ge=0;ge<re;++ge)he+=le[ge].length;const me={index:J,pathLengths:new Array(re+1),count:he,holeIndices:new Array(re)};me.pathLengths[0]=ue.length,ue.length>0&&(se[Y++]={index:J,count:ue.length}),J=pe?W(ue,ue.length-1,-1,ie,J,ue.length,te):W(ue,0,1,ie,J,ue.length,te);for(let ge=0;ge<re;++ge){const _e=le[ge];me.holeIndices[ge]=J,me.pathLengths[ge+1]=_e.length,_e.length>0&&(se[Y++]={index:J,count:_e.length}),J=W(_e,0,1,ie,J,_e.length,te)}re=0,me.count>0&&(de[j++]=me)}}for(let ce=0;ce<re;++ce){const ue=le[ce];ue.length>0&&(se[Y++]={index:J,count:ue.length}),J=W(ue,0,1,ie,J,ue.length,te)}return de.length=j,se.length=Y,{position:ie,polygons:de,outlines:se}}function W(X,te,ae,oe,le,de,se){le*=3;for(let re=0;re<de;++re){const j=X[te];oe[le++]=j[0],oe[le++]=j[1],oe[le++]=se?j[2]:0,te+=ae}return le/3}function B(X){return!(0,R.bu)(X,!1,!1)}(X=H||(H={}))[X.NONE=0]="NONE",X[X.CCW_IS_HOLE=1]="CCW_IS_HOLE"},71774:(nt,Ae,v)=>{"use strict";v.d(Ae,{Mk:()=>G,P$:()=>Z});var D=v(2076);const G=(0,D.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Z=(0,D.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"})},34054:(nt,Ae,v)=>{"use strict";v.d(Ae,{EU:()=>$,SR:()=>Q,cp:()=>W});var D=v(21286),R=v(84161),G=v(28093);function Q(X,te){return(0,R.e)(X,te)/(0,R.l)(X)}function $(X,te){const ae=(0,R.e)(X,te)/((0,R.l)(X)*(0,R.l)(te));return-(0,D.ZF)(ae)}function W(X,te,ae){(0,R.n)(B,X),(0,R.n)(H,te);const oe=(0,R.e)(B,H),le=(0,D.ZF)(oe),de=(0,R.f)(B,B,H);return(0,R.e)(de,ae)<0?2*Math.PI-le:le}const B=(0,G.c)(),H=(0,G.c)()},26242:(nt,Ae,v)=>{"use strict";v.d(Ae,{MP:()=>de,vD:()=>se,qW:()=>te,WM:()=>ae,o6:()=>oe});var D=v(27306),R=v(79682),G=v(550),Z=v(43703),Q=v(78451),$=v(99770),W=v(28093),B=v(4794);class H{constructor(j,Y,ee){this._itemByteSize=j,this._itemCreate=Y,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(ee/this._itemByteSize)}get(){0===this._itemsPtr&&(0,R.Y)(()=>this._reset());const j=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=j;){const Y=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let ee=0;ee<this._itemsPerBuffer;++ee)this._items.push(this._itemCreate(Y,ee*this._itemByteSize));this._buffers.push(Y)}return this._items[this._itemsPtr++]}_reset(){const j=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>j;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(j=X){return new H(16,$.c,j)}static createVec3f64(j=X){return new H(24,W.b,j)}static createVec4f64(j=X){return new H(32,B.a,j)}static createMat3f64(j=X){return new H(72,G.a,j)}static createMat4f64(j=X){return new H(128,Z.a,j)}static createQuatf64(j=X){return new H(32,Q.c,j)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const X=4*D.Y8.KILOBYTES,te=H.createVec2f64(),ae=H.createVec3f64(),oe=H.createVec4f64(),de=(H.createMat3f64(),H.createMat4f64()),se=H.createQuatf64()},46367:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>Y,Q8:()=>de,R6:()=>j,Sx:()=>ee,hG:()=>re,iV:()=>se,mZ:()=>te,tp:()=>X});var D=v(58817),R=v(62208),G=v(65234),Z=v(94425),Q=v(37053);function B(ie){return 57.29577951308232*ie}function H(ie){return.017453292519943*ie}function X(ie){return ie/Z.sv.radius}function te(ie){return Math.PI/2-2*Math.atan(Math.exp(-ie/Z.sv.radius))}function ae(ie){return null!=ie.wkid||null!=ie.wkt}const oe=[0,0];function le(ie,J,ce,ue,pe){const he=ie,me=pe;if(me.spatialReference=ce,"x"in he&&"x"in me)[me.x,me.y]=J(he.x,he.y,oe,ue);else if("xmin"in he&&"xmin"in me)[me.xmin,me.ymin]=J(he.xmin,he.ymin,oe,ue),[me.xmax,me.ymax]=J(he.xmax,he.ymax,oe,ue);else if("paths"in he&&"paths"in me||"rings"in he&&"rings"in me){const ge="paths"in he?he.paths:he.rings,_e=[];let Ee;for(let De=0;De<ge.length;De++){const be=ge[De];Ee=[],_e.push(Ee);for(let Se=0;Se<be.length;Se++)Ee.push(J(be[Se][0],be[Se][1],[0,0],ue)),be[Se].length>2&&Ee[Se].push(be[Se][2]),be[Se].length>3&&Ee[Se].push(be[Se][3])}"paths"in me?me.paths=_e:me.rings=_e}else if("points"in he&&"points"in me){const ge=he.points,_e=[];for(let Ee=0;Ee<ge.length;Ee++)_e[Ee]=J(ge[Ee][0],ge[Ee][1],[0,0],ue),ge[Ee].length>2&&_e[Ee].push(ge[Ee][2]),ge[Ee].length>3&&_e[Ee].push(ge[Ee][3]);me.points=_e}return pe}function de(ie,J){const ce=ie&&(ae(ie)?ie:ie.spatialReference),ue=J&&(ae(J)?J:J.spatialReference);return!(ie&&"type"in ie&&"mesh"===ie.type||J&&"type"in J&&"mesh"===J.type||!ce||!ue)&&(!!(0,Q.fS)(ue,ce)||(0,Q.sS)(ue)&&(0,Q.oR)(ce)||(0,Q.sS)(ce)&&(0,Q.oR)(ue))}function se(ie,J){if((0,R.Wi)(ie))return null;const ce=ie.spatialReference,ue=J&&(ae(J)?J:J.spatialReference);return de(ce,ue)?(0,Q.fS)(ce,ue)?(0,D.d9)(ie):(0,Q.sS)(ue)?le(ie,re,G.Z.WebMercator,!1,(0,D.d9)(ie)):(0,Q.oR)(ue)?le(ie,j,G.Z.WGS84,!1,(0,D.d9)(ie)):null:null}function re(ie,J,ce=[0,0]){J>89.99999?J=89.99999:J<-89.99999&&(J=-89.99999);const ue=H(J);return ce[0]=H(ie)*Z.sv.radius,ce[1]=Z.sv.halfSemiMajorAxis*Math.log((1+Math.sin(ue))/(1-Math.sin(ue))),ce}function j(ie,J,ce=[0,0],ue=!1){const pe=B(ie/Z.sv.radius);return ce[0]=ue?pe:pe-360*Math.floor((pe+180)/360),ce[1]=B(Math.PI/2-2*Math.atan(Math.exp(-J/Z.sv.radius))),ce}function Y(ie,J=!1,ce=(0,D.d9)(ie)){return le(ie,re,G.Z.WebMercator,J,ce)}function ee(ie,J=!1,ce=(0,D.d9)(ie)){return le(ie,j,G.Z.WGS84,J,ce)}},18945:(nt,Ae,v)=>{"use strict";function D(R,G,Z=!1){let{hasM:Q,hasZ:$}=R;Array.isArray(G)?4!==G.length||Q||$?3===G.length&&Z&&!Q?($=!0,Q=!1):3===G.length&&Q&&$&&(Q=!1,$=!1):(Q=!0,$=!0):($=!$&&G.hasZ&&(!Q||G.hasM),Q=!Q&&G.hasM&&(!$||G.hasZ)),R.hasZ=$,R.hasM=Q}v.d(Ae,{l:()=>D})},33696:(nt,Ae,v)=>{"use strict";v.d(Ae,{k:()=>Z});var D=v(62208),R=v(16730),G=v(37053);function Z(X,te,ae){if((0,D.Wi)(te)||(0,D.Wi)(ae)||ae.vcsWkid||(0,G.fS)(te,ae))return null;const oe=(0,R._R)(te)/(0,R._R)(ae);if(1===oe)return null;switch(X){case"point":case"esriGeometryPoint":return le=>function Q(X,te){X&&null!=X.z&&(X.z*=te)}(le,oe);case"polyline":case"esriGeometryPolyline":return le=>function W(X,te){if(X)for(const ae of X.paths)for(const oe of ae)oe.length>2&&(oe[2]*=te)}(le,oe);case"polygon":case"esriGeometryPolygon":return le=>function $(X,te){if(X)for(const ae of X.rings)for(const oe of ae)oe.length>2&&(oe[2]*=te)}(le,oe);case"multipoint":case"esriGeometryMultipoint":return le=>function B(X,te){if(X)for(const ae of X.points)ae.length>2&&(ae[2]*=te)}(le,oe);case"extent":case"esriGeometryExtent":return le=>function H(X,te){X&&null!=X.zmin&&null!=X.zmax&&(X.zmin*=te,X.zmax*=te)}(le,oe);default:return null}}},52515:(nt,Ae,v)=>{"use strict";v(88411),v(15348),v(97059),v(56683);var Q=v(41840),$=v(15861),W=v(84792),B=v(26584),H=v(62208);function te(){return(te=(0,$.Z)(function*(j,Y,ee,ie){const J=Y.exec(ee);if(!J)throw new B.Z("esri-intl:invalid-bundle",`Bundle id "${ee}" is not compatible with the pattern "${Y}"`);const ce=J[1]?`${J[1]}/`:"",ue=J[2],pe=(0,Q.Su)(ie),he=`${ce}${ue}.json`,me=pe?`${ce}${ue}_${pe}.json`:he;let ge;try{ge=yield ae(j(me))}catch(_e){if(me===he)throw new B.Z("intl:unknown-bundle",`Bundle "${ee}" cannot be loaded`,{error:_e});try{ge=yield ae(j(he))}catch(Ee){throw new B.Z("intl:unknown-bundle",`Bundle "${ee}" cannot be loaded`,{error:Ee})}}return ge})).apply(this,arguments)}function ae(j){return oe.apply(this,arguments)}function oe(){return(oe=(0,$.Z)(function*(j){if((0,H.pC)(se.fetchBundleAsset))return se.fetchBundleAsset(j);const Y=yield(0,W.default)(j,{responseType:"text"});return JSON.parse(Y.data)})).apply(this,arguments)}class le{constructor({base:Y="",pattern:ee,location:ie=new URL(window.location.href)}){let J;J="string"==typeof ie?ce=>new URL(ce,new URL(ie,window.location.href)).href:ie instanceof URL?ce=>new URL(ce,ie).href:ie,this.pattern="string"==typeof ee?new RegExp(`^${ee}`):ee,this.getAssetUrl=J,Y=Y?Y.endsWith("/")?Y:Y+"/":"",this.matcher=new RegExp(`^${Y}(?:(.*)/)?(.*)$`)}fetchMessageBundle(Y,ee){return function X(j,Y,ee,ie){return te.apply(this,arguments)}(this.getAssetUrl,this.matcher,Y,ee)}}const se={};var re=v(54346);(0,Q.tz)(function de(j){return new le(j)}({pattern:"esri/",location:re.V}))},88411:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ze:()=>j,p6:()=>Y});var D=v(2076),R=v(56683);const G={year:"numeric",month:"numeric",day:"numeric"},Z={year:"numeric",month:"long",day:"numeric"},Q={year:"numeric",month:"short",day:"numeric"},$={year:"numeric",month:"long",weekday:"long",day:"numeric"},W={hour:"numeric",minute:"numeric"},B={...W,second:"numeric"},H={"short-date":G,"short-date-short-time":{...G,...W},"short-date-short-time-24":{...G,...W,hour12:!1},"short-date-long-time":{...G,...B},"short-date-long-time-24":{...G,...B,hour12:!1},"short-date-le":G,"short-date-le-short-time":{...G,...W},"short-date-le-short-time-24":{...G,...W,hour12:!1},"short-date-le-long-time":{...G,...B},"short-date-le-long-time-24":{...G,...B,hour12:!1},"long-month-day-year":Z,"long-month-day-year-short-time":{...Z,...W},"long-month-day-year-short-time-24":{...Z,...W,hour12:!1},"long-month-day-year-long-time":{...Z,...B},"long-month-day-year-long-time-24":{...Z,...B,hour12:!1},"day-short-month-year":Q,"day-short-month-year-short-time":{...Q,...W},"day-short-month-year-short-time-24":{...Q,...W,hour12:!1},"day-short-month-year-long-time":{...Q,...B},"day-short-month-year-long-time-24":{...Q,...B,hour12:!1},"long-date":$,"long-date-short-time":{...$,...W},"long-date-short-time-24":{...$,...W,hour12:!1},"long-date-long-time":{...$,...B},"long-date-long-time-24":{...$,...B,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":W,"long-time":B},X=(0,D.w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),le=(X.toJSON.bind(X),X.fromJSON.bind(X),{ar:"ar-u-nu-latn-ca-gregory"});let de=new WeakMap,se=H["short-date-short-time"];function j(ee){return ee?H[ee]:null}function Y(ee,ie){return function re(ee){const ie=ee||se;let J=de.get(ie);if(!J){const ce=(0,R.Kd)(),ue=le[(0,R.Kd)()]||ce;J=new Intl.DateTimeFormat(ue,ie),de.set(ie,J)}return J}(ie).format(ee)}(0,R.Ze)(()=>{de=new WeakMap,se=H["short-date-short-time"]})},56683:(nt,Ae,v)=>{"use strict";let R;v.d(Ae,{Kd:()=>Q,Ze:()=>oe,qe:()=>te});const G=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function Z(){return G??globalThis.navigator?.language??"en"}function Q(){return void 0===R&&(R=Z()),R}const X=[];function te(de){return X.push(de),{remove(){X.splice(X.indexOf(de),1)}}}const ae=[];function oe(de){return ae.push(de),{remove(){X.splice(ae.indexOf(de),1)}}}globalThis.addEventListener?.("languagechange",function le(){const de=Z();R!==de&&(R=de,[...ae].forEach(se=>{se.call(null,de)}),[...X].forEach(se=>{se.call(null,de)}))})},41840:(nt,Ae,v)=>{"use strict";v.d(Ae,{ME:()=>ae,Su:()=>le,tz:()=>te});var D=v(15861),R=v(26584),G=v(10699),Z=v(56683);const Q=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,$={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function W(ee){return $[ee]??!1}const B=[],H=new Map;function X(ee){for(const ie of H.keys())re(ee.pattern,ie)&&H.delete(ie)}function te(ee){return B.includes(ee)||(X(ee),B.unshift(ee)),{remove(){const ie=B.indexOf(ee);ie>-1&&(B.splice(ie,1),X(ee))}}}function ae(ee){return oe.apply(this,arguments)}function oe(){return(oe=(0,D.Z)(function*(ee){const ie=(0,Z.Kd)();H.has(ee)||H.set(ee,de(ee,ie));const J=H.get(ee);return J&&(yield j.add(J)),J})).apply(this,arguments)}function le(ee){if(!Q.test(ee))return null;const ie=Q.exec(ee);if(null===ie)return null;const[,J,ce]=ie,ue=J+(ce?"-"+ce.toUpperCase():"");return W(ue)?ue:W(J)?J:null}function de(ee,ie){return se.apply(this,arguments)}function se(){return(se=(0,D.Z)(function*(ee,ie){const J=[];for(const ce of B)if(re(ce.pattern,ee))try{return yield ce.fetchMessageBundle(ee,ie)}catch(ue){J.push(ue)}throw J.length?new R.Z("intl:message-bundle-error",`Errors occurred while loading "${ee}"`,{errors:J}):new R.Z("intl:no-message-bundle-loader",`No loader found for message bundle "${ee}"`)})).apply(this,arguments)}function re(ee,ie){return"string"==typeof ee?ie.startsWith(ee):ee.test(ie)}(0,Z.Ze)(()=>{H.clear()});const j=new class{constructor(){this._numLoading=0,this._dfd=null}waitForAll(){var ee=this;return(0,D.Z)(function*(){ee._dfd&&(yield ee._dfd.promise)})()}add(ee){return this._increase(),ee.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,G.dD)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},15348:(nt,Ae,v)=>{"use strict";v.d(Ae,{sh:()=>W,uf:()=>B});var D=v(62208),R=v(56683);const G={ar:"ar-u-nu-latn"};let Z=new WeakMap,Q={};function W(H={}){const X={};return null!=H.digitSeparator&&(X.useGrouping=H.digitSeparator),null!=H.places&&(X.minimumFractionDigits=X.maximumFractionDigits=H.places),X}function B(H,X){return-0===H&&(H=0),function $(H){const X=H||Q;if(!Z.has(X)){const te=(0,R.Kd)(),ae=G[(0,R.Kd)()]||te;Z.set(X,new Intl.NumberFormat(ae,H))}return(0,D.j0)(Z.get(X))}(X).format(H)}(0,R.Ze)(()=>{Z=new WeakMap,Q={}})},97059:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>W});var D=v(63290),R=v(94113),G=v(77275),Z=v(88411),Q=v(15348);const $=D.Z.getLogger("esri.intl.substitute");function W(ae,oe,le={}){const{format:de={}}=le;return(0,G.gx)(ae,se=>function B(ae,oe,le){let de,se;const re=ae.indexOf(":");if(-1===re?de=ae.trim():(de=ae.slice(0,re).trim(),se=ae.slice(re+1).trim()),!de)return"";const j=(0,R.hS)(de,oe);if(null==j)return"";const Y=(se?le?.[se]:null)??le?.[de];return Y?function H(ae,oe){switch(oe.type){case"date":return(0,Z.p6)(ae,oe.intlOptions);case"number":return(0,Q.uf)(ae,oe.intlOptions);default:return $.warn("missing format descriptor for key {key}"),te(ae)}}(j,Y):se?function X(ae,oe){switch(oe.toLowerCase()){case"dateformat":return(0,Z.p6)(ae);case"numberformat":return(0,Q.uf)(ae);default:return $.warn(`inline format is unsupported since 4.12: ${oe}`),/^(dateformat|datestring)/i.test(oe)?(0,Z.p6)(ae):/^numberformat/i.test(oe)?(0,Q.uf)(ae):te(ae)}}(j,se):te(j)}(se,oe,de))}function te(ae){switch(typeof ae){case"string":return ae;case"number":return(0,Q.uf)(ae);case"boolean":return""+ae;default:return ae instanceof Date?(0,Z.p6)(ae):""}}},24263:(nt,Ae,v)=>{"use strict";v.d(Ae,{Dp:()=>B,Nv:()=>Q,i8:()=>Z,id:()=>$,qh:()=>W});var D=v(15861),R=v(8314),G=v(21726);const Z="4.25",Q={request:(H,X)=>(0,D.Z)(function*(){const{default:te}=yield Promise.resolve().then(v.bind(v,84792)),ae=H.options,oe=ae.responseType;ae.signal=X?.signal,ae.responseType="native"===oe||"native-request-init"===oe?"native-request-init":oe&&["blob","json","text"].includes(oe)&&(0,G.oh)(H.url)?.after?oe:"array-buffer";const le=yield te(H.url,ae),de={data:le.data,ssl:le.ssl};switch(le.requestOptions?.responseType){case"native-request-init":return delete de.data.signal,de;case"blob":de.data=yield de.data.arrayBuffer();break;case"json":de.data=(new TextEncoder).encode(JSON.stringify(de.data)).buffer;break;case"text":de.data=(new TextEncoder).encode(de.data).buffer}return{result:de,transferList:[de.data]}})()};let $;function W(H){$=H}function B(H){const X=$&&$.findCredential(H);return X&&X.token?(0,G.ZN)(H,"token",X.token):H}(0,R.Z)("host-webworker")},80415:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>at});var D=v(15861),R=v(17626),G=v(73281),X=(v(4832),v(49067),v(96794),v(69747),v(40425),v(69357),v(40342)),te=v(73640),ae=v(33474),oe=v(32088),le=v(84792),de=v(20383),se=v(79608),re=v(46160),j=v(26584),Y=v(72392),ee=v(58817),ie=v(63290),J=v(62208),ce=v(99959),ue=v(94113),pe=v(10699),he=v(95737),me=v(21726),ge=v(77712),_e=v(66656),Ee=v(68653),De=v(76898),be=v(99433),Se=v(383),ye=v(27402),ve=v(65234),xe=v(44917),Ke=(v(29132),v(88879)),We=v(80542),Ce=v(8314),Be=v(47996),Fe=v(60330),je=v(59289),He=(v(85931),v(90912)),Ie=v(61039),Ge=v(20514),Pe=v(61515),Le=v(17253),Me=v(2004),Ne=v(37118),Xe=v(71774);let Ye=0;const Je="esri.layers.graphics.sources.MemorySource",rt=ie.Z.getLogger(Je);let tt=class extends(Be.Z.LoadableMixin((0,Fe.v)((0,We.p)(re.Z)))){constructor(bt){super(bt),this._idToClientGraphic=null,this.type="memory"}load(bt){const gt=(0,J.pC)(bt)?bt.signal:null;return this.addResolvingPromise(this._startWorker(gt)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const bt=this.layer?.geometryType;return bt?this._geometryTypeRequiresClientGraphicMapping(bt)?"polygon":bt:null}applyEdits(bt){return this.load().then(()=>this._applyEdits(bt))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(bt,gt={}){var Gt=this;return(0,D.Z)(function*(){yield Gt.load(gt);const fr=yield Gt._connection.invoke("queryFeatures",bt?bt.toJSON():null,gt);(0,Pe.p)(bt,Gt.layer.spatialReference,fr);const Ar=Le.default.fromJSON(fr);if(!Gt._requiresClientGraphicMapping())return Ar;const us=Gt.layer.objectIdField;for(const as of Ar.features){const Fs=Gt._idToClientGraphic.get(as.attributes[us]);Fs&&(as.geometry=Fs.geometry)}return Ar.geometryType=Gt.layer.geometryType,Ar})()}queryFeaturesJSON(bt,gt={}){var Gt=this;return(0,D.Z)(function*(){if(Gt._requiresClientGraphicMapping())throw new j.Z("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");yield Gt.load(gt);const fr=yield Gt._connection.invoke("queryFeatures",bt?bt.toJSON():null,gt);return(0,Pe.p)(bt,Gt.layer.spatialReference,fr),fr})()}queryFeatureCount(bt,gt={}){return this.load(gt).then(()=>this._connection.invoke("queryFeatureCount",bt?bt.toJSON():null,gt))}queryObjectIds(bt,gt={}){return this.load(gt).then(()=>this._connection.invoke("queryObjectIds",bt?bt.toJSON():null,gt))}queryExtent(bt,gt={}){return this.load(gt).then(()=>this._connection.invoke("queryExtent",bt?bt.toJSON():null,gt)).then(Gt=>({count:Gt.count,extent:Me.Z.fromJSON(Gt.extent)}))}querySnapping(bt,gt={}){return this.load(gt).then(()=>this._connection.invoke("querySnapping",bt,gt))}_applyEdits(bt){var gt=this;return(0,D.Z)(function*(){if(!gt._connection)throw new j.Z("feature-layer-source:edit-failure","Memory source not loaded");const Gt=gt.layer.objectIdField;let fr=null;const Ar=[],us=[];yield Promise.all([gt._prepareClientMapping(bt.addFeatures,null),gt._prepareClientMapping(bt.updateFeatures,null)]);const as=Ws=>"objectId"in Ws&&null!=Ws.objectId?Ws.objectId:"attributes"in Ws&&null!=Ws.attributes[Gt]?Ws.attributes[Gt]:null;if(bt.addFeatures&&(fr=gt._prepareAddFeatures(bt.addFeatures)),bt.deleteFeatures)for(const Ws of bt.deleteFeatures){const yi=as(Ws);null!=yi&&Ar.push(yi)}const Ps=bt.updateFeatures&&gt._idToClientGraphic?new Map:null;if(bt.updateFeatures)for(const Ws of bt.updateFeatures)if(us.push(gt._serializeFeature(Ws)),Ps){const yi=as(Ws);null!=yi&&Ps.set(yi,Ws)}(0,Ge.P)(fr?fr.features:null,us,gt.layer.spatialReference);const{fullExtent:Fs,featureEditResults:xs}=yield gt._connection.invoke("applyEdits",{adds:fr?fr.features:[],updates:us,deletes:Ar});return gt.fullExtent=Fs,fr&&fr.finish(xs.uidToObjectId),gt._updateClientGraphicIds(Ps,xs),gt._createEditsResult(xs)})()}_prepareClientMapping(bt,gt){var Gt=this;return(0,D.Z)(function*(){if("mesh"!==Gt._layerOrSourceGeometryType||(0,J.Wi)(bt))return;const fr=[];for(const{geometry:Ar}of bt)!(0,J.pC)(Ar)||"mesh"!==Ar.type||Ar.hasExtent||Ar.loaded||fr.push(Ar.load({signal:gt}));fr.length&&(yield Promise.all(fr))})()}_updateClientGraphicIds(bt,gt){if(this._idToClientGraphic){if(bt)for(const Gt of gt.updateResults){if(!Gt.success)continue;const fr=bt.get(Gt.objectId);null!=fr&&this._addIdToClientGraphic(fr)}for(const Gt of gt.deleteResults)Gt.success&&this._idToClientGraphic.delete(Gt.objectId)}}_createEditsResult(bt){return{addFeatureResults:bt.addResults?bt.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:bt.updateResults?bt.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:bt.deleteResults?bt.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(bt){const gt=!0===bt.success?null:bt.error||{code:void 0,description:void 0};return{objectId:bt.objectId,globalId:bt.globalId,error:gt?new j.Z("feature-layer-source:edit-failure",gt.description,{code:gt.code}):null}}_prepareAddFeatures(bt){const gt=new Map,Gt=new Array(bt.length);let fr=null;for(let us=0;us<bt.length;us++){const as=bt[us],Ps=this._serializeFeature(as);!fr&&(0,J.pC)(as.geometry)&&(fr=as.geometry.type),Gt[us]=Ps,gt.set(`${Ps.uid}`,as)}const Ar=this;return{features:Gt,inferredGeometryType:fr,finish(us){const as=Ar.sourceJSON.objectIdField;for(const Ps in us){const Fs=us[Ps],xs=gt.get(Ps);xs&&(xs.attributes||(xs.attributes={}),-1===Fs?delete xs.attributes[as]:xs.attributes[as]=Fs,Ar._addIdToClientGraphic(xs))}}}}_addIdToClientGraphic(bt){if(!this._idToClientGraphic)return;const Gt=bt.attributes&&bt.attributes[this.sourceJSON.objectIdField];null!=Gt&&this._idToClientGraphic.set(Gt,bt)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(bt){return this._geometryTypeRequiresClientGraphicMapping(bt.type)}_geometryTypeRequiresClientGraphicMapping(bt){return"mesh"===bt||"multipatch"===bt||"extent"===bt}_serializeFeature(bt){const{attributes:gt}=bt,Gt=this._geometryForSerialization(bt),fr=(Ye++).toString();return Gt?{uid:fr,geometry:Gt.toJSON(),attributes:gt}:{uid:fr,attributes:gt}}_geometryForSerialization(bt){const{geometry:gt}=bt;return(0,J.Wi)(gt)?null:this._geometryRequiresClientGraphicMapping(gt)?gt.extent?Ne.Z.fromExtent(gt.extent):null:gt}_startWorker(bt){var gt=this;return(0,D.Z)(function*(){gt._connection=yield(0,je.bA)("MemorySourceWorker",{strategy:(0,Ce.Z)("feature-layers-workers")?"dedicated":"local",signal:bt});const{fields:Gt,spatialReference:fr,objectIdField:Ar,hasM:us,hasZ:as,timeInfo:Ps}=gt.layer,Fs="defaults"===gt.layer.originOf("spatialReference");yield gt._prepareClientMapping(gt.items,bt);const xs=gt._prepareAddFeatures(gt.items);gt.handles.add(gt.on("before-changes",oi=>{rt.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),oi.preventDefault()}));const Ws={features:xs.features,fields:Gt&&Gt.map(oi=>oi.toJSON()),geometryType:Xe.P$.toJSON(gt._workerGeometryType),hasM:"mesh"!==gt._layerOrSourceGeometryType&&us,hasZ:"mesh"===gt._layerOrSourceGeometryType||as,objectIdField:Ar,spatialReference:Fs?null:fr&&fr.toJSON(),timeInfo:Ps?Ps.toJSON():null},yi=yield gt._connection.invoke("load",Ws,{signal:bt});for(const oi of yi.warnings)rt.warn(oi.message,{layer:gt.layer,warning:oi});yi.featureErrors.length&&rt.warn(`Encountered ${yi.featureErrors.length} validation errors while loading features`,yi.featureErrors);const hn=yi.layerDefinition;gt._geometryTypeRequiresClientGraphicMapping(xs.inferredGeometryType)&&(hn.geometryType=Xe.P$.toJSON(xs.inferredGeometryType)),gt.sourceJSON=hn,gt._requiresClientGraphicMapping()&&(gt._idToClientGraphic=new Map),xs.finish(yi.assignedObjectIds)})()}};(0,R._)([(0,Ie.c)({Type:Ke.Z,ensureType:(0,He.se)(Ke.Z)})],tt.prototype,"itemType",void 0),(0,R._)([(0,ge.Cb)()],tt.prototype,"type",void 0),(0,R._)([(0,ge.Cb)({constructOnly:!0})],tt.prototype,"layer",void 0),(0,R._)([(0,ge.Cb)({readOnly:!0})],tt.prototype,"_workerGeometryType",null),(0,R._)([(0,ge.Cb)()],tt.prototype,"sourceJSON",void 0),tt=(0,R._)([(0,De.j)(Je)],tt);var et=v(50085),qe=v(65088),ot=v(552),ut=v(50107),_t=v(6733),Ct=v(35126),vt=v(87987),Lt=v(81380),jt=v(49286),$t=v(32629),Wt=v(6647),pr=v(14517);let gr=class extends pr.Z{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};(0,R._)([(0,ge.Cb)()],gr.prototype,"updating",void 0),(0,R._)([(0,ge.Cb)()],gr.prototype,"status",void 0),gr=(0,R._)([(0,De.j)("esri.layers.support.PublishingInfo")],gr);const ar=gr,Fr="esri.layers.mixins.PublishableLayer";Symbol(Fr);const or=bt=>{let gt=class extends bt{get publishingInfo(){if(this.destroyed)return null;const Gt=this._get("publishingInfo");if(Gt)return Gt;const fr=new ar;return this._checkPublishingStatus(fr),fr}_checkPublishingStatus(Gt){var fr=this;let as=0;const Ps=function(){var xs=(0,D.Z)(function*(Ws){let yi;Gt.updating=!0;try{yi=yield fr.fetchPublishingStatus()}catch{yi="unavailable"}"published"!==yi&&"unavailable"!==yi||("publishing"===Gt.status&&fr.refresh(),Fs.remove()),Gt.status=yi,Gt.updating=!1,Fs.removed||(as=setTimeout(Ps,Ws,Ws+125))});return function(yi){return xs.apply(this,arguments)}}(),Fs={removed:!1,remove(){this.removed=!0,clearTimeout(as)}};this.when().catch(()=>Fs.remove()),Ps(250),this.own(Fs)}};return(0,R._)([(0,ge.Cb)({readOnly:!0,clonable:!1})],gt.prototype,"publishingInfo",null),gt=(0,R._)([(0,De.j)(Fr)],gt),gt};var sr=v(30346),rr=v(99555),Et=v(97941),St=v(38305),Ft=v(13812),zt=v(26331),dr=v(32777),hr=v(41638),Tr=v(55911),Dr=v(36630),Lr=v(170),Hr=v(62667),Qr=v(62708),Jr=v(5676),Ss=v(15283),Cs=v(39683),Dt=v(96854),ct=v(6871),At=v(49430),Kt=v(92236);const tr="FeatureLayer",_r="esri.layers.FeatureLayer",Or=ie.Z.getLogger(_r);function gs(bt,gt){return new j.Z("layer:unsupported",`Layer (${bt.title}, ${bt.id}) of type '${bt.declaredClass}' ${gt}`,{layer:bt})}function Kr(bt){return bt&&bt instanceof re.Z}const qt=(0,Tr.v)();function Ir(bt,gt,Gt){const fr=!!Gt?.writeLayerSchema;return{enabled:fr,ignoreOrigin:fr}}let Sr=class extends((0,vt.B)((0,Lt.M)((0,Ct.b)(or((0,_t.o1)((0,ot.h)((0,$t.c)((0,Et.n)((0,rr.M)((0,sr.Q)((0,qe.Y)((0,jt.q)((0,Wt.I)((0,ce.R)((0,ut.N)((0,et.V)((0,se.J)(xe.Z)))))))))))))))))){constructor(...bt){super(...bt),this._handles=new Y.Z,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=ve.Z.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){this.source?.destroy(),this._handles=(0,J.SC)(this._handles)}normalizeCtorArgs(bt,gt){return"string"==typeof bt?{url:bt,...gt}:bt}load(bt){var gt=this;const Gt=(0,J.pC)(bt)?bt.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(Gt).then(Ar=>this.initLayerProperties(Ar))),Promise.resolve(this);const fr=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},bt).catch(pe.r9).then((0,D.Z)(function*(){if(gt.url&&null==gt.layerId&&/FeatureServer|MapServer\/*$/i.test(gt.url)){const Ar=yield gt._fetchFirstLayerId(Gt);null!=Ar&&(gt.layerId=Ar)}if(!gt.url&&!gt._hasMemorySource())throw new j.Z("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return gt.initLayerProperties(yield gt.createGraphicsSource(Gt))})).then(()=>this.finishLoadEditablePortalLayer(bt));return this.addResolvingPromise(fr),Promise.resolve(this)}readCapabilities(bt,gt){return(0,zt.hu)(bt,gt=gt.layerDefinition||gt,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(bt){this._overrideIfSome("editingEnabled",bt)}readEditingEnabled(bt,gt){return this._readEditingEnabled(gt,!1)}readEditingEnabledFromWebMap(bt,gt,Gt){return this._readEditingEnabled(gt,!0,Gt)}writeEditingEnabled(bt,gt){this._writeEditingEnabled(bt,gt,!1)}writeEditingEnabledToWebMap(bt,gt,Gt,fr){this._writeEditingEnabled(bt,gt,!0,fr)}readIsTable(bt,gt){return"Table"===(gt=gt?.layerDefinition??gt).type||!gt.geometryType}writeIsTable(bt,gt,Gt,fr){fr?.writeLayerSchema&&(0,ue.RB)(Gt,bt?"Table":"Feature Layer",gt)}readGlobalIdField(bt,gt){return(0,zt.rk)(gt.layerDefinition||gt)}readObjectIdField(bt,gt){return(0,zt.kZ)(gt.layerDefinition||gt)}get parsedUrl(){const bt=(0,me.mN)(this.url);return null!=bt&&(null!=this.dynamicDataSource?bt.path=(0,me.v_)(bt.path,"dynamicLayer"):null!=this.layerId&&(bt.path=(0,me.v_)(bt.path,this.layerId.toString()))),bt}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(bt){(0,Dr.YN)(bt,this.fieldsIndex),this._set("renderer",bt)}readRenderer(bt,gt,Gt){const fr=(gt=gt.layerDefinition||gt).drawingInfo?.renderer;if(fr){const Ar=(0,ae.a)(fr,gt,Gt)??void 0;return Ar||Or.error("Failed to create renderer",{rendererDefinition:gt.drawingInfo.renderer,layer:this,context:Gt}),Ar}if(gt.defaultSymbol)return gt.types&&gt.types.length?new te.Z({defaultSymbol:fs(gt.defaultSymbol,gt,Gt),field:gt.typeIdField,uniqueValueInfos:gt.types.map(Ar=>({id:Ar.id,symbol:fs(Ar.symbol,Ar,Gt)}))}):new X.Z({symbol:fs(gt.defaultSymbol,gt,Gt)})}set source(bt){const gt=this._get("source");gt!==bt&&(Kr(gt)&&this._resetMemorySource(gt),Kr(bt)&&this._initMemorySource(bt),this._set("source",bt))}castSource(bt){return bt?Array.isArray(bt)||bt instanceof re.Z?new tt({layer:this,items:bt}):bt:null}readSource(bt,gt){const Gt=Le.default.fromJSON(gt.featureSet);return new tt({layer:this,items:Gt?.features??[]})}readTemplates(bt,gt){const Gt=gt.editFieldsInfo,fr=Gt&&Gt.creatorField,Ar=Gt&&Gt.editorField;return bt=bt&&bt.map(us=>dr.Z.fromJSON(us)),this._fixTemplates(bt,fr),this._fixTemplates(bt,Ar),bt}readTitle(bt,gt){const Gt=gt.layerDefinition?.name??gt.name,fr=gt.title||gt.layerDefinition&&gt.layerDefinition.title;if(Gt){const Ar=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,St.a7)(this.url,Gt):Gt;let us=Gt;if(!us&&this.url){const as=(0,St.Qc)(this.url);(0,J.pC)(as)&&(us=as.title)}return us?("item-title-and-service-name"===this.sublayerTitleMode&&Ar&&Ar!==us&&(us=Ar+" - "+us),(0,St.ld)(us)):void 0}if("item-title"===this.sublayerTitleMode&&fr)return fr}readTitleFromWebMap(bt,gt){return gt.title||gt.layerDefinition&&gt.layerDefinition.name}readTypeIdField(bt,gt){let Gt=(gt=gt.layerDefinition||gt).typeIdField;if(Gt&&gt.fields){Gt=Gt.toLowerCase();const fr=gt.fields.find(Ar=>Ar.name.toLowerCase()===Gt);fr&&(Gt=fr.name)}return Gt}readTypes(bt,gt){bt=(gt=gt.layerDefinition||gt).types;const Gt=gt.editFieldsInfo,fr=Gt&&Gt.creatorField,Ar=Gt&&Gt.editorField;return bt&&bt.map(us=>(us=hr.Z.fromJSON(us),this._fixTemplates(us.templates,fr),this._fixTemplates(us.templates,Ar),us))}readVisible(bt,gt){return gt.layerDefinition&&null!=gt.layerDefinition.defaultVisibility?!!gt.layerDefinition.defaultVisibility:null!=gt.visibility?!!gt.visibility:void 0}addAttachment(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.JD)(Gt,bt,gt,tr)})()}updateAttachment(bt,gt,Gt){var fr=this;return(0,D.Z)(function*(){return(0,zt.Y5)(fr,bt,gt,Gt,tr)})()}applyEdits(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.Jj)(Gt,bt,gt)})()}on(bt,gt){return super.on(bt,gt)}createPopupTemplate(bt){return(0,At.eZ)(this,bt)}createGraphicsSource(bt){var gt=this;return(0,D.Z)(function*(){if(gt._hasMemorySource()&&gt.source)return gt.source.load({signal:bt});const{default:Gt}=yield(0,pe.Hl)(v.e(4516).then(v.bind(v,14516)),bt);return new Gt({layer:gt}).load({signal:bt})})()}createQuery(){const bt=(0,zt.rP)(this);bt.dynamicDataSource=this.dynamicDataSource;const gt=(0,J.pC)(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,Gt=(0,he._)(this.definitionExpression,gt);return bt.where=Gt||"1=1",bt}deleteAttachments(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.FV)(Gt,bt,gt,tr)})()}fetchRecomputedExtents(bt){var gt=this;return(0,D.Z)(function*(){return(0,zt.Ci)(gt,bt,tr)})()}getFeatureType(bt){const{typeIdField:gt,types:Gt}=this;if(!gt||!bt)return null;const fr=bt.attributes?bt.attributes[gt]:void 0;if(null==fr)return null;let Ar=null;return Gt?.some(us=>{const{id:as}=us;return null!=as&&(as.toString()===fr.toString()&&(Ar=us),!!Ar)}),Ar}getFieldDomain(bt,gt){const fr=this.getFeatureType(gt&&gt.feature);if(fr){const Ar=fr.domains&&fr.domains[bt];if(Ar&&"inherited"!==Ar.type)return Ar}return this._getLayerDomain(bt)}getField(bt){return this.fieldsIndex.get(bt)}queryAttachments(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.SU)(Gt,bt,gt,tr)})()}queryFeatures(bt,gt){var Gt=this;return(0,D.Z)(function*(){const fr=yield Gt.load(),Ar=yield fr.source.queryFeatures(Dt.Z.from(bt)??fr.createQuery(),gt);if(Ar?.features)for(const us of Ar.features)us.layer=us.sourceLayer=fr;return Ar})()}queryObjectIds(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.tD)(Gt,bt,gt,tr)})()}queryFeatureCount(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.VG)(Gt,bt,gt,tr)})()}queryExtent(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.KE)(Gt,bt,gt,tr)})()}queryRelatedFeatures(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.kp)(Gt,bt,gt,tr)})()}queryRelatedFeaturesCount(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(0,zt.C9)(Gt,bt,gt,tr)})()}queryTopFeatures(bt,gt){var Gt=this;return(0,D.Z)(function*(){const{source:fr,capabilities:Ar}=yield Gt.load();if(!fr.queryTopFeatures||!Ar?.query?.supportsTopFeaturesQuery)throw new j.Z(tr,"Layer source does not support queryTopFeatures capability");const us=yield fr.queryTopFeatures(ct.Z.from(bt),gt);if(us?.features)for(const as of us.features)as.layer=as.sourceLayer=Gt;return us})()}queryTopObjectIds(bt,gt){var Gt=this;return(0,D.Z)(function*(){const{source:fr,capabilities:Ar}=yield Gt.load();if(!fr.queryTopObjectIds||!Ar?.query.supportsTopFeaturesQuery)throw new j.Z(tr,"Layer source does not support queryTopObjectIds capability");return fr.queryTopObjectIds(ct.Z.from(bt),gt)})()}queryTopFeaturesExtent(bt,gt){var Gt=this;return(0,D.Z)(function*(){const{source:fr,capabilities:Ar}=yield Gt.load();if(!fr.queryTopExtents||!Ar?.query?.supportsTopFeaturesQuery)throw new j.Z(tr,"Layer source does not support queryTopExtents capability");return fr.queryTopExtents(ct.Z.from(bt),gt)})()}queryTopFeatureCount(bt,gt){var Gt=this;return(0,D.Z)(function*(){const{source:fr,capabilities:Ar}=yield Gt.load();if(!fr.queryTopCount||!Ar?.query?.supportsTopFeaturesQuery)throw new j.Z(tr,"Layer source does not support queryFeatureCount capability");return fr.queryTopCount(ct.Z.from(bt),gt)})()}read(bt,gt){const Gt=bt.featureCollection;if(Gt){const fr=Gt.layers;fr&&1===fr.length&&(super.read(fr[0],gt),null!=Gt.showLegend&&super.read({showLegend:Gt.showLegend},gt))}super.read(bt,gt),gt&&"service"===gt.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(bt,gt){gt={...gt,origin:gt?.origin??void 0,writeLayerSchema:gt?.writeLayerSchema??this._hasMemorySource()};const{origin:Gt,layerContainerType:fr,messages:Ar}=gt;if(this.dynamicDataSource)return Ar?.push(gs(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if("web-scene"===Gt||"web-map"===Gt&&"tables"!==fr)return Ar?.push(gs(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return Ar?.push(gs(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&"web-map"===Gt&&"tables"===fr)return Ar?.push(gs(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(bt,gt)}clone(){if(this._hasMemorySource())throw new j.Z(tr,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(bt){return!!this.loaded&&("memory"===this.source?.type||(0,Jr.D)(this,bt))}save(bt){var gt=this;return(0,D.Z)(function*(){return(yield Promise.all([v.e(8592),v.e(6912)]).then(v.bind(v,36912))).save(gt,bt)})()}saveAs(bt,gt){var Gt=this;return(0,D.Z)(function*(){return(yield Promise.all([v.e(8592),v.e(6912)]).then(v.bind(v,36912))).saveAs(Gt,bt,gt)})()}_readEditingEnabled(bt,gt,Gt){let fr=bt.layerDefinition?.capabilities;return fr?this._hasEditingCapability(fr):(fr=bt.capabilities,gt&&"web-map"===Gt?.origin&&!this._hasMemorySource()&&fr?this._hasEditingCapability(fr):void 0)}_hasEditingCapability(bt){return bt.toLowerCase().split(",").map(gt=>gt.trim()).includes("editing")}_writeEditingEnabled(bt,gt,Gt,fr){if(!bt){const Ar=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";(0,ue.RB)("layerDefinition.capabilities",Ar,gt),Gt&&!fr?.writeLayerSchema&&(gt.capabilities=Ar)}}_getLayerDomain(bt){const gt=this.fieldsIndex.get(bt);return gt?gt.domain:null}_fetchFirstLayerId(bt){return(0,le.default)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:bt}).then(gt=>{const Gt=gt.data;if(Gt)return Array.isArray(Gt.layers)&&Gt.layers.length>0?Gt.layers[0].id:Array.isArray(Gt.tables)&&Gt.tables.length>0?Gt.tables[0].id:void 0})}initLayerProperties(bt){var gt=this;return(0,D.Z)(function*(){return gt._set("source",bt),bt.sourceJSON&&(gt.sourceJSON=bt.sourceJSON,gt.read(bt.sourceJSON,{origin:"service",url:gt.parsedUrl})),gt._verifySource(),gt._verifyFields(),(0,Dr.YN)(gt.renderer,gt.fieldsIndex),(0,Dr.UF)(gt.timeInfo,gt.fieldsIndex),(0,Cs.y)(gt,{origin:"service"})})()}hasDataChanged(){var bt=this;return(0,D.Z)(function*(){return(0,zt.gG)(bt)})()}fetchPublishingStatus(){var bt=this;return(0,D.Z)(function*(){const gt=bt.source;return gt?.fetchPublishingStatus?gt.fetchPublishingStatus():"unavailable"})()}_verifyFields(){const bt=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+bt+")"),this.isTable||this._hasMemorySource()||-1!==bt.search(/\/FeatureServer\//i)||this.fields?.some(gt=>"geometry"===gt.type)||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+bt+")")}_fixTemplates(bt,gt){bt&&bt.forEach(Gt=>{const fr=Gt.prototype&&Gt.prototype.attributes;fr&&gt&&delete fr[gt]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new j.Z("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new j.Z("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(bt){bt.forEach(gt=>{gt.layer=this,gt.sourceLayer=this}),this._handles.add([bt.on("after-add",gt=>{gt.item.layer=this,gt.item.sourceLayer=this}),bt.on("after-remove",gt=>{gt.item.layer=null,gt.item.sourceLayer=null})],"fl-source")}_resetMemorySource(bt){bt.forEach(gt=>{gt.layer=null,gt.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};(0,R._)([(0,Ee.r)("service","capabilities")],Sr.prototype,"readCapabilities",null),(0,R._)([(0,ge.Cb)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Sr.prototype,"charts",void 0),(0,R._)([(0,ge.Cb)({readOnly:!0})],Sr.prototype,"createQueryVersion",null),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.copyrightText"}}})],Sr.prototype,"copyright",void 0),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.displayField"}}})],Sr.prototype,"displayField",void 0),(0,R._)([(0,ge.Cb)({types:de.LB,readOnly:!0})],Sr.prototype,"defaultSymbol",void 0),(0,R._)([(0,ge.Cb)({type:Ss.n})],Sr.prototype,"dynamicDataSource",void 0),(0,R._)([(0,ge.Cb)({type:Boolean})],Sr.prototype,"editingEnabled",null),(0,R._)([(0,Ee.r)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Sr.prototype,"readEditingEnabled",null),(0,R._)([(0,Ee.r)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Sr.prototype,"readEditingEnabledFromWebMap",null),(0,R._)([(0,be.c)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Sr.prototype,"writeEditingEnabled",null),(0,R._)([(0,be.c)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Sr.prototype,"writeEditingEnabledToWebMap",null),(0,R._)([(0,ge.Cb)({...qt.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Ir}}}}})],Sr.prototype,"fields",void 0),(0,R._)([(0,ge.Cb)(qt.fieldsIndex)],Sr.prototype,"fieldsIndex",void 0),(0,R._)([(0,ge.Cb)({type:ye.Z,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Sr.prototype,"formTemplate",void 0),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.extent"}}})],Sr.prototype,"fullExtent",void 0),(0,R._)([(0,ge.Cb)({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Ir,writer(bt,gt,Gt){const fr=bt?zt.Fr.toJSON(bt):null;fr&&(0,ue.RB)(Gt,fr,gt)}}}},read:{source:"layerDefinition.geometryType",reader:zt.Fr.read}}})],Sr.prototype,"geometryType",void 0),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.hasM"}}})],Sr.prototype,"hasM",void 0),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.hasZ"}}})],Sr.prototype,"hasZ",void 0),(0,R._)([(0,ge.Cb)(Ft.id)],Sr.prototype,"id",void 0),(0,R._)([(0,ge.Cb)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Sr.prototype,"infoFor3D",void 0),(0,R._)([(0,ge.Cb)({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Sr.prototype,"isTable",void 0),(0,R._)([(0,Ee.r)("service","isTable",["type","geometryType"]),(0,Ee.r)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Sr.prototype,"readIsTable",null),(0,R._)([(0,be.c)("web-map","isTable")],Sr.prototype,"writeIsTable",null),(0,R._)([(0,ge.Cb)(Ft.iR)],Sr.prototype,"labelsVisible",void 0),(0,R._)([(0,ge.Cb)({type:[Lr.Z],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Hr.r},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Hr.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Sr.prototype,"labelingInfo",void 0),(0,R._)([(0,ge.Cb)((()=>{const bt=(0,ee.d9)(Ft.bT);return bt.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(gt,Gt,fr){(0,ue.RB)(fr,(0,Kt.a)(gt),Gt)}}},bt})())],Sr.prototype,"opacity",void 0),(0,R._)([(0,ge.Cb)(Ft.rn)],Sr.prototype,"legendEnabled",void 0),(0,R._)([(0,ge.Cb)({type:["show","hide"],json:(()=>{const bt=(0,ee.d9)(Ft.rT.json);return bt.origins["portal-item"]={read:!1,write:!1},bt})()})],Sr.prototype,"listMode",void 0),(0,R._)([(0,Ee.r)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Sr.prototype,"readGlobalIdField",null),(0,R._)([(0,ge.Cb)({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Ir}}}}})],Sr.prototype,"objectIdField",void 0),(0,R._)([(0,Ee.r)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Sr.prototype,"readObjectIdField",null),(0,R._)([(0,ge.Cb)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Sr.prototype,"operationalLayerType",void 0),(0,R._)([(0,ge.Cb)(qt.outFields)],Sr.prototype,"outFields",void 0),(0,R._)([(0,ge.Cb)({readOnly:!0})],Sr.prototype,"parsedUrl",null),(0,R._)([(0,ge.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Sr.prototype,"path",void 0),(0,R._)([(0,ge.Cb)(Ft.C_)],Sr.prototype,"popupEnabled",void 0),(0,R._)([(0,ge.Cb)({type:G.Z,json:{name:"popupInfo",write:!0}})],Sr.prototype,"popupTemplate",void 0),(0,R._)([(0,ge.Cb)({readOnly:!0})],Sr.prototype,"defaultPopupTemplate",null),(0,R._)([(0,ge.Cb)({types:oe.A,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:oe.o,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(bt,gt,Gt)=>({ignoreOrigin:Gt?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(bt,gt,Gt)=>({ignoreOrigin:Gt?.writeLayerSchema})}}})],Sr.prototype,"renderer",null),(0,R._)([(0,Ee.r)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,Ee.r)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Sr.prototype,"readRenderer",null),(0,R._)([(0,ge.Cb)((()=>{const bt=(0,ee.d9)(Ft.YI);return bt.json.origins["portal-item"]={read:!1,write:!1},bt})())],Sr.prototype,"screenSizePerspectiveEnabled",void 0),(0,R._)([(0,ge.Cb)({clonable:!1})],Sr.prototype,"source",null),(0,R._)([(0,_e.p)("source")],Sr.prototype,"castSource",null),(0,R._)([(0,Ee.r)("portal-item","source",["featureSet"]),(0,Ee.r)("web-map","source",["featureSet"])],Sr.prototype,"readSource",null),(0,R._)([(0,ge.Cb)({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Sr.prototype,"spatialReference",void 0),(0,R._)([(0,ge.Cb)({type:Number})],Sr.prototype,"subtypeCode",void 0),(0,R._)([(0,ge.Cb)({type:[dr.Z]})],Sr.prototype,"templates",void 0),(0,R._)([(0,Ee.r)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Sr.prototype,"readTemplates",null),(0,R._)([(0,ge.Cb)({type:Qr.Z})],Sr.prototype,"timeInfo",void 0),(0,R._)([(0,ge.Cb)()],Sr.prototype,"title",void 0),(0,R._)([(0,Ee.r)("service","title",["name"]),(0,Ee.r)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Sr.prototype,"readTitle",null),(0,R._)([(0,Ee.r)("web-map","title",["layerDefinition.name","title"])],Sr.prototype,"readTitleFromWebMap",null),(0,R._)([(0,ge.Cb)({type:String})],Sr.prototype,"sublayerTitleMode",void 0),(0,R._)([(0,ge.Cb)({json:{read:!1}})],Sr.prototype,"type",void 0),(0,R._)([(0,ge.Cb)({type:String})],Sr.prototype,"typeIdField",void 0),(0,R._)([(0,Ee.r)("service","typeIdField"),(0,Ee.r)("typeIdField",["layerDefinition.typeIdField"])],Sr.prototype,"readTypeIdField",null),(0,R._)([(0,ge.Cb)({type:[hr.Z]})],Sr.prototype,"types",void 0),(0,R._)([(0,Ee.r)("service","types",["types"]),(0,Ee.r)("types",["layerDefinition.types"])],Sr.prototype,"readTypes",null),(0,R._)([(0,ge.Cb)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Sr.prototype,"visible",void 0),(0,R._)([(0,Ee.r)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Sr.prototype,"readVisible",null),Sr=(0,R._)([(0,De.j)(_r)],Sr);const fs=(0,Se.d)({types:de.QT}),at=Sr},44917:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ce});var D=v(15861),R=v(17626),Z=(v(29132),v(84792)),Q=v(26584),$=v(61885),W=v(61996),B=v(47996),H=v(63290),X=v(10699),te=v(21726),ae=v(77712),de=(v(85931),v(90912),v(76898)),se=v(59318);function j(){return(j=(0,D.Z)(function*(ue){const pe="portalItem"in ue?ue:{portalItem:ue},he=yield v.e(7534).then(v.bind(v,7534));try{return yield he.fromItem(pe)}catch(me){const ge=pe&&pe.portalItem,_e=ge&&ge.id||"unset",Ee=ge&&ge.portal&&ge.portal.url||se.Z.portalUrl;throw H.Z.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+Ee+"', id: '"+_e+"')",me),me}})).apply(this,arguments)}var Y=v(2004),ee=v(65234);let ie=0,J=class extends($.Z.EventedMixin((0,W.IG)(B.Z))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Y.Z(-180,-90,180,90,ee.Z.WGS84),this.id=Date.now().toString(16)+"-layer-"+ie++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=ee.Z.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static fromArcGISServerUrl(ue){return(0,D.Z)(function*(){const pe="string"==typeof ue?{url:ue}:ue;return(yield Promise.all([v.e(8592),v.e(4578)]).then(v.bind(v,24578))).fromUrl(pe)})()}static fromPortalItem(ue){return function re(ue){return j.apply(this,arguments)}(ue)}initialize(){this.when().catch(ue=>{(0,X.D_)(ue)||H.Z.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:ue})})}destroy(){if(this.parent){const ue=this,pe=this.parent;"layers"in pe&&pe.layers.includes(ue)?pe.layers.remove(ue):"tables"in pe&&pe.tables.includes(ue)?pe.tables.remove(ue):"baseLayers"in pe&&pe.baseLayers.includes(ue)?pe.baseLayers.remove(ue):"baseLayers"in pe&&pe.referenceLayers.includes(ue)&&pe.referenceLayers.remove(ue)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){return(0,te.mN)(this.url)}fetchAttributionData(){var ue=this;return(0,D.Z)(function*(){const pe=ue.attributionDataUrl;if(ue.hasAttributionData&&pe)return(yield(0,Z.default)(pe,{query:{f:"json"},responseType:"json"})).data;throw new Q.Z("layer:no-attribution-data","Layer does not have attribution data")})()}};(0,R._)([(0,ae.Cb)({type:String})],J.prototype,"attributionDataUrl",void 0),(0,R._)([(0,ae.Cb)({type:Y.Z})],J.prototype,"fullExtent",void 0),(0,R._)([(0,ae.Cb)({readOnly:!0})],J.prototype,"hasAttributionData",null),(0,R._)([(0,ae.Cb)({type:String,clonable:!1})],J.prototype,"id",void 0),(0,R._)([(0,ae.Cb)({type:Boolean,nonNullable:!0})],J.prototype,"legendEnabled",void 0),(0,R._)([(0,ae.Cb)({type:["show","hide","hide-children"]})],J.prototype,"listMode",void 0),(0,R._)([(0,ae.Cb)({type:Number,range:{min:0,max:1},nonNullable:!0})],J.prototype,"opacity",void 0),(0,R._)([(0,ae.Cb)({clonable:!1})],J.prototype,"parent",void 0),(0,R._)([(0,ae.Cb)({readOnly:!0})],J.prototype,"parsedUrl",null),(0,R._)([(0,ae.Cb)({type:Boolean})],J.prototype,"popupEnabled",void 0),(0,R._)([(0,ae.Cb)({type:Boolean})],J.prototype,"attributionVisible",void 0),(0,R._)([(0,ae.Cb)({type:ee.Z})],J.prototype,"spatialReference",void 0),(0,R._)([(0,ae.Cb)({type:String})],J.prototype,"title",void 0),(0,R._)([(0,ae.Cb)({readOnly:!0,json:{read:!1}})],J.prototype,"type",void 0),(0,R._)([(0,ae.Cb)()],J.prototype,"url",void 0),(0,R._)([(0,ae.Cb)({type:Boolean,nonNullable:!0})],J.prototype,"visible",void 0),J=(0,R._)([(0,de.j)("esri.layers.Layer")],J);const ce=J},5437:(nt,Ae,v)=>{"use strict";v.d(Ae,{d:()=>D});const D="OBJECTID"},58141:(nt,Ae,v)=>{"use strict";v.d(Ae,{rk:()=>ae,Tj:()=>oe,GI:()=>le,CE:()=>de,Tq:()=>se,Zx:()=>re,Ee:()=>ee});var D=v(20414),R=v(23841),G=v(55494),Z=v(28347);class ae{constructor(J,ce,ue){this.strength=J,this.radius=ce,this.threshold=ue,this.type="bloom"}interpolate(J,ce,ue){this.strength=j(J.strength,ce.strength,ue),this.radius=j(J.radius,ce.radius,ue),this.threshold=j(J.threshold,ce.threshold,ue)}clone(){return new ae(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:Y(this.radius),strength:this.strength,threshold:this.threshold}}}class oe{constructor(J){this.radius=J,this.type="blur"}interpolate(J,ce,ue){this.radius=Math.round(j(J.radius,ce.radius,ue))}clone(){return new oe(this.radius)}toJSON(){return{type:"blur",radius:Y(this.radius)}}}class le{constructor(J,ce){this.type=J,this.amount=ce,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(J,ce,ue){this.amount=j(J.amount,ce.amount,ue),this._updateMatrix()}clone(){return new le(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const J=this._colorMatrix||(0,G.c)();switch(this.type){case"brightness":this._colorMatrix=((ie,J)=>{const ce=(0,Z.s)(ie,J,0,0,0,0,J,0,0,0,0,J,0,0,0,0,1);return(0,Z.t)(ce,ce)})(J,this.amount);break;case"contrast":this._colorMatrix=((ie,J)=>{const ce=(0,Z.s)(ie,J,0,0,.5-.5*J,0,J,0,.5-.5*J,0,0,J,.5-.5*J,0,0,0,1);return(0,Z.t)(ce,ce)})(J,this.amount);break;case"grayscale":this._colorMatrix=((ie,J)=>{const ce=1-this.amount,ue=(0,Z.s)(ie,.2126+.7874*ce,.7152-.7152*ce,.0722-.0722*ce,0,.2126-.2126*ce,.7152+.2848*ce,.0722-.0722*ce,0,.2126-.2126*ce,.7152-.7152*ce,.0722+.9278*ce,0,0,0,0,1);return(0,Z.t)(ue,ue)})(J);break;case"invert":this._colorMatrix=((ie,J)=>{const ce=1-2*J,ue=(0,Z.s)(ie,ce,0,0,J,0,ce,0,J,0,0,ce,J,0,0,0,1);return(0,Z.t)(ue,ue)})(J,this.amount);break;case"saturate":this._colorMatrix=((ie,J)=>{const ce=(0,Z.s)(ie,.213+.787*J,.715-.715*J,.072-.072*J,0,.213-.213*J,.715+.285*J,.072-.072*J,0,.213-.213*J,.715-.715*J,.072+.928*J,0,0,0,0,1);return(0,Z.t)(ce,ce)})(J,this.amount);break;case"sepia":this._colorMatrix=((ie,J)=>{const ce=1-this.amount,ue=(0,Z.s)(ie,.393+.607*ce,.769-.769*ce,.189-.189*ce,0,.349-.349*ce,.686+.314*ce,.168-.168*ce,0,.272-.272*ce,.534-.534*ce,.131+.869*ce,0,0,0,0,1);return(0,Z.t)(ue,ue)})(J)}}}class de{constructor(J,ce,ue,pe){this.offsetX=J,this.offsetY=ce,this.blurRadius=ue,this.color=pe,this.type="drop-shadow"}interpolate(J,ce,ue){this.offsetX=j(J.offsetX,ce.offsetX,ue),this.offsetY=j(J.offsetY,ce.offsetY,ue),this.blurRadius=j(J.blurRadius,ce.blurRadius,ue),this.color[0]=Math.round(j(J.color[0],ce.color[0],ue)),this.color[1]=Math.round(j(J.color[1],ce.color[1],ue)),this.color[2]=Math.round(j(J.color[2],ce.color[2],ue)),this.color[3]=j(J.color[3],ce.color[3],ue)}clone(){return new de(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const J=[...this.color];return J[3]*=255,{type:"drop-shadow",xoffset:Y(this.offsetX),yoffset:Y(this.offsetY),blurRadius:Y(this.blurRadius),color:J}}}class se{constructor(J){this.angle=J,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(J,ce,ue){this.angle=j(J.angle,ce.angle,ue),this._updateMatrix()}clone(){return new se(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const J=this._colorMatrix||(0,G.c)();this._colorMatrix=((ie,J)=>{const ce=Math.sin(J*Math.PI/180),ue=Math.cos(J*Math.PI/180),pe=(0,Z.s)(ie,.213+.787*ue-.213*ce,.715-.715*ue-.715*ce,.072-.072*ue+.928*ce,0,.213-.213*ue+.143*ce,.715+.285*ue+.14*ce,.072-.072*ue-.283*ce,0,.213-.213*ue-.787*ce,.715-.715*ue+.715*ce,.072+.928*ue+.072*ce,0,0,0,0,1);return(0,Z.t)(pe,pe)})(J,this.angle)}}class re{constructor(J){this.amount=J,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(J,ce,ue){this.amount=j(J.amount,ce.amount,ue)}clone(){return new re(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function j(ie,J,ce){return ie+(J-ie)*ce}function Y(ie){return Math.round(1e3*(0,R.Wz)(ie))/1e3}function ee(ie){switch(ie.type){case"grayscale":case"sepia":case"invert":return new le(ie.type,0);case"saturate":case"brightness":case"contrast":return new le(ie.type,1);case"opacity":return new re(1);case"hue-rotate":return new se(0);case"blur":return new oe(0);case"drop-shadow":return new de(0,0,0,[...(0,D.h$)("transparent")]);case"bloom":return new ae(0,0,1)}}},71149:(nt,Ae,v)=>{"use strict";v.d(Ae,{cW:()=>$,ij:()=>Q,rM:()=>X});var D=v(26584),R=v(94113),G=v(29538),Z=v(53390);function Q(oe,le,de){try{return function B(oe){if(!oe||0===oe.length)return null;if(function H(oe){const le=oe[0];return!!le&&"scale"in le}(oe)){const le=[];for(const de of oe)le.push({scale:de.scale,value:X(de.value)});return le}return X(oe)}(oe)}catch(se){de?.messages?.push(se)}return null}function $(oe,le,de,se){try{const re=function W(oe){const le=(0,G.Q)(oe);return le?(0,Z.Cb)(le)?le.map(de=>de.toJSON()):le.map(({scale:de,effects:se})=>({scale:de,value:se.map(re=>re.toJSON())})):null}(oe);(0,R.RB)(de,re,le)}catch(re){se.messages&&se.messages.push(re)}}function X(oe){if(!oe||!oe.length)return"";const le=[];for(const de of oe){let se=[];switch(de.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":se=[te(de,"amount")];break;case"blur":se=[te(de,"radius","pt")];break;case"hue-rotate":se=[te(de,"angle","deg")];break;case"drop-shadow":se=[te(de,"xoffset","pt"),te(de,"yoffset","pt"),te(de,"blurRadius","pt"),ae(de,"color")];break;case"bloom":se=[te(de,"strength"),te(de,"radius","pt"),te(de,"threshold")]}const re=`${de.type}(${se.filter(Boolean).join(" ")})`;(0,G.Q)(re),le.push(re)}return le.join(" ")}function te(oe,le,de){if(null==oe[le])throw new D.Z("effect:missing-parameter",`Missing parameter '${le}' in ${oe.type} effect`,{effect:oe});return de?oe[le]+de:""+oe[le]}function ae(oe,le){if(null==oe[le])throw new D.Z("effect:missing-parameter",`Missing parameter '${le}' in ${oe.type} effect`,{effect:oe});const de=oe[le];return`rgba(${de[0]||0}, ${de[1]||0}, ${de[2]||0}, ${de[3]/255||0})`}},29538:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>H});var $,D=v(20414),R=v(26584),G=v(58141),Q=(v(1719),v(53390)),B={exports:{}};function H(xe){if(!xe||0===xe.length)return null;if("string"==typeof xe){const Ke=X(xe);return Ke&&0!==Ke.length?Ke:null}const ze=xe.map(Ke=>{if(!Number.isFinite(Ke.scale)||Ke.scale<=0)throw new R.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:Ke});return{scale:Ke.scale,effects:X(Ke.value)}});ze.sort((Ke,We)=>We.effects.length-Ke.effects.length);for(let Ke=0;Ke<ze.length-1;Ke++){if(!(0,Q.AS)(ze[Ke].effects,ze[Ke+1].effects))throw new R.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:ze[Ke].effects,b:ze[Ke+1].effects});(0,Q.uF)(ze[Ke].effects,ze[Ke+1].effects)}return ze.sort((Ke,We)=>We.scale-Ke.scale),ze}function X(xe){let ze;if(!xe)return[];try{ze=B.exports.parse(xe)}catch(Ke){throw new R.Z("effect:invalid-syntax","Invalid effect syntax",{value:xe,error:Ke})}return ze.map(Ke=>function te(xe){try{switch(xe.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function ae(xe){let ze=1;return j(xe.parameters,1),1===xe.parameters.length&&(ze=me(xe.parameters[0])),new G.GI(xe.name,ze)}(xe);case"opacity":return function oe(xe){let ze=1;return j(xe.parameters,1),1===xe.parameters.length&&(ze=me(xe.parameters[0])),new G.Zx(ze)}(xe);case"hue-rotate":return function le(xe){let ze=0;return j(xe.parameters,1),1===xe.parameters.length&&(ze=function _e(xe){return function ue(xe){if("quantity"!==xe.type||!(0===xe.value&&null===xe.unit||xe.unit&&null!=ce[xe.unit]))throw new R.Z("effect:type-error",`Expected <angle>, Actual: ${Y(xe)}`,{term:xe})}(xe),xe.value*ce[xe.unit]||0}(xe.parameters[0])),new G.Tq(ze)}(xe);case"blur":return function de(xe){let ze=0;return j(xe.parameters,1),1===xe.parameters.length&&(ze=Ee(xe.parameters[0]),ee(ze,xe.parameters[0])),new G.Tj(ze)}(xe);case"drop-shadow":return function se(xe){const ze=[];let Ke=null;for(const We of xe.parameters)if("color"===We.type){if(ze.length&&Object.freeze(ze),Ke)throw new R.Z("effect:type-error","Accepts only one color",{});Ke=De(We)}else{const Ce=Ee(We);if(Object.isFrozen(ze))throw new R.Z("effect:type-error","<length> parameters not consecutive",{lengths:ze});ze.push(Ce),3===ze.length&&ee(Ce,We)}if(ze.length<2||ze.length>3)throw new R.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${ze.length}}`,{lengths:ze});return new G.CE(ze[0],ze[1],ze[2]||0,Ke||be("black"))}(xe);case"bloom":return function re(xe){let ze=1,Ke=0,We=0;return j(xe.parameters,3),xe.parameters[0]&&(ze=me(xe.parameters[0])),xe.parameters[1]&&(Ke=Ee(xe.parameters[1]),ee(Ke,xe.parameters[1])),xe.parameters[2]&&(We=me(xe.parameters[2])),new G.rk(ze,Ke,We)}(xe)}}catch(ze){throw ze.details.filter=xe,ze}throw new R.Z("effect:unknown-effect",`Effect '${xe.name}' is not supported`,{effect:xe})}(Ke))}function j(xe,ze){if(xe.length>ze)throw new R.Z("effect:type-error",`Function supports up to ${ze} parameters, Actual: ${xe.length}`,{parameters:xe})}function Y(xe){if("color"===xe.type)return"<color>";if(xe.unit){if(pe[xe.unit])return"<length>";if(ce[xe.unit])return"<angle>";if("%"===xe.unit)return"<percentage>"}return"<double>"}function ee(xe,ze){if(xe<0)throw new R.Z("effect:type-error",`Negative values are not allowed, Actual: ${xe}`,{term:ze})}($=B).exports&&($.exports=function(){function ze(Ce,Be,Fe,je){var Re=Error.call(this,Ce);return Object.setPrototypeOf&&Object.setPrototypeOf(Re,ze.prototype),Re.expected=Be,Re.found=Fe,Re.location=je,Re.name="SyntaxError",Re}function Ke(Ce,Be,Fe){return Fe=Fe||" ",Ce.length>Be?Ce:Ce+(Fe+=Fe.repeat(Be-=Ce.length)).slice(0,Be)}return function xe(Ce,Be){function Fe(){this.constructor=Ce}Fe.prototype=Be.prototype,Ce.prototype=new Fe}(ze,Error),ze.prototype.format=function(Ce){var Be="Error: "+this.message;if(this.location){var Fe,je=null;for(Fe=0;Fe<Ce.length;Fe++)if(Ce[Fe].source===this.location.source){je=Ce[Fe].text.split(/\r\n|\n|\r/g);break}var Re=this.location.start,He=this.location.source+":"+Re.line+":"+Re.column;if(je){var Ie=this.location.end,Ge=Ke("",Re.line.toString().length," "),Pe=je[Re.line-1],Le=(Re.line===Ie.line?Ie.column:Pe.length+1)-Re.column||1;Be+="\n --\x3e "+He+"\n"+Ge+" |\n"+Re.line+" | "+Pe+"\n"+Ge+" | "+Ke("",Re.column-1," ")+Ke("",Le,"^")}else Be+="\n at "+He}return Be},ze.buildMessage=function(Ce,Be){var Fe={literal:function(Le){return'"'+Re(Le.text)+'"'},class:function(Le){var Me=Le.parts.map(function(Ne){return Array.isArray(Ne)?He(Ne[0])+"-"+He(Ne[1]):He(Ne)});return"["+(Le.inverted?"^":"")+Me.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(Le){return Le.description}};function je(Le){return Le.charCodeAt(0).toString(16).toUpperCase()}function Re(Le){return Le.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Me){return"\\x0"+je(Me)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Me){return"\\x"+je(Me)})}function He(Le){return Le.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Me){return"\\x0"+je(Me)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Me){return"\\x"+je(Me)})}function Ie(Le){return Fe[Le.type](Le)}return"Expected "+function Ge(Le){var Me,Ne,Xe=Le.map(Ie);if(Xe.sort(),Xe.length>0){for(Me=1,Ne=1;Me<Xe.length;Me++)Xe[Me-1]!==Xe[Me]&&(Xe[Ne]=Xe[Me],Ne++);Xe.length=Ne}switch(Xe.length){case 1:return Xe[0];case 2:return Xe[0]+" or "+Xe[1];default:return Xe.slice(0,-1).join(", ")+", or "+Xe[Xe.length-1]}}(Ce)+" but "+function Pe(Le){return Le?'"'+Re(Le)+'"':"end of input"}(Be)+" found."},{SyntaxError:ze,parse:function We(Ce,Be){var Fe,je={},Re=(Be=void 0!==Be?Be:{}).grammarSource,He={start:en},Ie=en,jt=/^[ \t\n\r]/,$t=/^[a-z\-]/,Wt=/^[0-9a-fA-F]/,pr=/^[+\-]/,gr=/^[0-9]/,ar=Ls("none"),Fr=yr("none",!1),mr=yr(")",!1),wt=yr(",",!1),or=Ls("whitespace"),sr=ys([" ","\t","\n","\r"],!1,!1),rr=Ls("function"),Et=yr("(",!1),St=Ls("identifier"),Ft=ys([["a","z"],"-"],!1,!1),zt=Ls("percentage"),dr=yr("%",!1),hr=Ls("length"),Tr=yr("px",!1),Dr=yr("cm",!1),Lr=yr("mm",!1),Hr=yr("in",!1),Qr=yr("pt",!1),Jr=yr("pc",!1),Ss=Ls("angle"),Cs=yr("deg",!1),Dt=yr("rad",!1),ct=yr("grad",!1),At=yr("turn",!1),Kt=Ls("number"),tr=Ls("color"),_r=yr("#",!1),Or=ys([["0","9"],["a","f"],["A","F"]],!1,!1),gs=ys(["+","-"],!1,!1),Kr=ys([["0","9"]],!1,!1),qt=yr(".",!1),Ir=yr("e",!1),jr=0,Gi=0,ui=[{line:1,column:1}],zn=0,kt=[],Qt=0;if("startRule"in Be){if(!(Be.startRule in He))throw new Error("Can't start parsing from rule \""+Be.startRule+'".');Ie=He[Be.startRule]}function Vt(){return Ce.substring(Gi,jr)}function yr(cr,ns){return{type:"literal",text:cr,ignoreCase:ns}}function ys(cr,ns,vs){return{type:"class",parts:cr,inverted:ns,ignoreCase:vs}}function Ls(cr){return{type:"other",description:cr}}function Os(cr){var ns,vs=ui[cr];if(vs)return vs;for(ns=cr-1;!ui[ns];)ns--;for(vs={line:(vs=ui[ns]).line,column:vs.column};ns<cr;)10===Ce.charCodeAt(ns)?(vs.line++,vs.column=1):vs.column++,ns++;return ui[cr]=vs,vs}function As(cr){jr<zn||(jr>zn&&(zn=jr,kt=[]),kt.push(cr))}function en(){var cr;return(cr=function Mo(){var cr,ns;return Qt++,cr=jr,Ki(),"none"===Ce.substr(jr,4)?(ns="none",jr+=4):(ns=je,0===Qt&&As(Fr)),ns!==je?(Ki(),Gi=cr,cr=[]):(jr=cr,cr=je),Qt--,cr===je&&0===Qt&&As(ar),cr}())===je&&(cr=function na(){var cr,ns;if(cr=[],(ns=Po())!==je)for(;ns!==je;)cr.push(ns),ns=Po();else cr=je;return cr}()),cr}function Po(){var cr,ns,vs,Ri;return cr=jr,Ki(),(ns=function _n(){var cr,ns,vs;return Qt++,cr=jr,(ns=Ma())!==je?(40===Ce.charCodeAt(jr)?(vs="(",jr++):(vs=je,0===Qt&&As(Et)),vs!==je?(Gi=cr,cr=ns):(jr=cr,cr=je)):(jr=cr,cr=je),Qt--,cr===je&&(ns=je,0===Qt&&As(rr)),cr}())!==je?(Ki(),(vs=function ja(){var cr,ns,vs,Ri,Bn,cn,Uo,Na;if(cr=jr,(ns=An())!==je){for(vs=[],Ri=jr,Bn=Ki(),44===Ce.charCodeAt(jr)?(cn=",",jr++):(cn=je,0===Qt&&As(wt)),cn===je&&(cn=null),Uo=Ki(),(Na=An())!==je?Ri=Bn=[Bn,cn,Uo,Na]:(jr=Ri,Ri=je);Ri!==je;)vs.push(Ri),Ri=jr,Bn=Ki(),44===Ce.charCodeAt(jr)?(cn=",",jr++):(cn=je,0===Qt&&As(wt)),cn===je&&(cn=null),Uo=Ki(),(Na=An())!==je?Ri=Bn=[Bn,cn,Uo,Na]:(jr=Ri,Ri=je);Gi=cr,cr=function(cr,ns){return ns.length>0?function Pa(cr,ns,vs){return[cr].concat(function Fa(cr,ns){return cr.map(function(vs){return vs[ns]})}(ns,vs))}(cr,ns,3):[cr]}(ns,vs)}else jr=cr,cr=je;return cr}())===je&&(vs=null),Ki(),41===Ce.charCodeAt(jr)?(Ri=")",jr++):(Ri=je,0===Qt&&As(mr)),Ri!==je?(Ki(),Gi=cr,cr=function(cr,ns){return{type:"function",name:cr,parameters:ns||[]}}(ns,vs)):(jr=cr,cr=je)):(jr=cr,cr=je),cr}function An(){var cr,ns;return cr=jr,(ns=function Ei(){var cr,ns,vs;return Qt++,cr=jr,Ki(),(ns=Lo())!==je?(37===Ce.charCodeAt(jr)?(vs="%",jr++):(vs=je,0===Qt&&As(dr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"%"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),Qt--,cr===je&&0===Qt&&As(zt),cr}())===je&&(ns=function nc(){var cr,ns,vs;return Qt++,cr=jr,Ki(),(ns=Lo())!==je?("px"===Ce.substr(jr,2)?(vs="px",jr+=2):(vs=je,0===Qt&&As(Tr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"px"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,Ki(),(ns=Lo())!==je?("cm"===Ce.substr(jr,2)?(vs="cm",jr+=2):(vs=je,0===Qt&&As(Dr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"cm"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,Ki(),(ns=Lo())!==je?("mm"===Ce.substr(jr,2)?(vs="mm",jr+=2):(vs=je,0===Qt&&As(Lr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"mm"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,Ki(),(ns=Lo())!==je?("in"===Ce.substr(jr,2)?(vs="in",jr+=2):(vs=je,0===Qt&&As(Hr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"in"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,Ki(),(ns=Lo())!==je?("pt"===Ce.substr(jr,2)?(vs="pt",jr+=2):(vs=je,0===Qt&&As(Qr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"pt"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,Ki(),(ns=Lo())!==je?("pc"===Ce.substr(jr,2)?(vs="pc",jr+=2):(vs=je,0===Qt&&As(Jr)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"pc"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je)))))),Qt--,cr===je&&0===Qt&&As(hr),cr}())===je&&(ns=function Jn(){var cr,ns,vs;return Qt++,cr=jr,(ns=Lo())!==je?("deg"===Ce.substr(jr,3)?(vs="deg",jr+=3):(vs=je,0===Qt&&As(Cs)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"deg"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,(ns=Lo())!==je?("rad"===Ce.substr(jr,3)?(vs="rad",jr+=3):(vs=je,0===Qt&&As(Dt)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"rad"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,(ns=Lo())!==je?("grad"===Ce.substr(jr,4)?(vs="grad",jr+=4):(vs=je,0===Qt&&As(ct)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"grad"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je),cr===je&&(cr=jr,(ns=Lo())!==je?("turn"===Ce.substr(jr,4)?(vs="turn",jr+=4):(vs=je,0===Qt&&As(At)),vs!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:"turn"}}(ns)):(jr=cr,cr=je)):(jr=cr,cr=je)))),Qt--,cr===je&&(ns=je,0===Qt&&As(Ss)),cr}())===je&&(ns=function jl(){var cr,ns;return Qt++,cr=jr,Ki(),(ns=Lo())!==je?(Gi=cr,cr=function(cr){return{value:cr,unit:null}}(ns)):(jr=cr,cr=je),Qt--,cr===je&&0===Qt&&As(Kt),cr}()),ns!==je&&(Gi=cr,ns=function(cr){return{type:"quantity",value:cr.value,unit:cr.unit}}(ns)),(cr=ns)===je&&(cr=jr,(ns=function oc(){var cr,ns,vs,Ri;if(Qt++,cr=jr,35===Ce.charCodeAt(jr)?(ns="#",jr++):(ns=je,0===Qt&&As(_r)),ns!==je){if(vs=[],Wt.test(Ce.charAt(jr))?(Ri=Ce.charAt(jr),jr++):(Ri=je,0===Qt&&As(Or)),Ri!==je)for(;Ri!==je;)vs.push(Ri),Wt.test(Ce.charAt(jr))?(Ri=Ce.charAt(jr),jr++):(Ri=je,0===Qt&&As(Or));else vs=je;vs!==je?(Gi=cr,cr={type:"hex",value:Vt()}):(jr=cr,cr=je)}else jr=cr,cr=je;return cr===je&&(cr=jr,(ns=Po())!==je&&(Gi=cr,ns=function(cr){return{type:"function",value:cr}}(ns)),(cr=ns)===je&&(cr=jr,(ns=Ma())!==je&&(Gi=cr,ns={type:"named",value:Vt()}),cr=ns)),Qt--,cr===je&&(ns=je,0===Qt&&As(tr)),cr}())!==je&&(Gi=cr,ns=function(cr){return{type:"color",colorType:cr.type,value:cr.value}}(ns)),cr=ns),cr}function Ki(){var cr,ns;for(Qt++,cr=[],jt.test(Ce.charAt(jr))?(ns=Ce.charAt(jr),jr++):(ns=je,0===Qt&&As(sr));ns!==je;)cr.push(ns),jt.test(Ce.charAt(jr))?(ns=Ce.charAt(jr),jr++):(ns=je,0===Qt&&As(sr));return Qt--,ns=je,0===Qt&&As(or),cr}function Ma(){var cr,ns,vs;if(Qt++,cr=jr,ns=[],$t.test(Ce.charAt(jr))?(vs=Ce.charAt(jr),jr++):(vs=je,0===Qt&&As(Ft)),vs!==je)for(;vs!==je;)ns.push(vs),$t.test(Ce.charAt(jr))?(vs=Ce.charAt(jr),jr++):(vs=je,0===Qt&&As(Ft));else ns=je;return ns!==je&&(Gi=cr,ns=Vt()),Qt--,(cr=ns)===je&&(ns=je,0===Qt&&As(St)),cr}function Lo(){var cr,ns,vs,Ri,Bn,cn,Uo;for(cr=jr,pr.test(Ce.charAt(jr))?(Ce.charAt(jr),jr++):0===Qt&&As(gs),ns=jr,vs=[],gr.test(Ce.charAt(jr))?(Ri=Ce.charAt(jr),jr++):(Ri=je,0===Qt&&As(Kr));Ri!==je;)vs.push(Ri),gr.test(Ce.charAt(jr))?(Ri=Ce.charAt(jr),jr++):(Ri=je,0===Qt&&As(Kr));if(46===Ce.charCodeAt(jr)?(Ri=".",jr++):(Ri=je,0===Qt&&As(qt)),Ri!==je){if(Bn=[],gr.test(Ce.charAt(jr))?(cn=Ce.charAt(jr),jr++):(cn=je,0===Qt&&As(Kr)),cn!==je)for(;cn!==je;)Bn.push(cn),gr.test(Ce.charAt(jr))?(cn=Ce.charAt(jr),jr++):(cn=je,0===Qt&&As(Kr));else Bn=je;Bn!==je?ns=vs=[vs,Ri,Bn]:(jr=ns,ns=je)}else jr=ns,ns=je;if(ns===je)if(ns=[],gr.test(Ce.charAt(jr))?(vs=Ce.charAt(jr),jr++):(vs=je,0===Qt&&As(Kr)),vs!==je)for(;vs!==je;)ns.push(vs),gr.test(Ce.charAt(jr))?(vs=Ce.charAt(jr),jr++):(vs=je,0===Qt&&As(Kr));else ns=je;if(ns!==je){if(vs=jr,101===Ce.charCodeAt(jr)?(Ri="e",jr++):(Ri=je,0===Qt&&As(Ir)),Ri!==je){if(pr.test(Ce.charAt(jr))?(Bn=Ce.charAt(jr),jr++):(Bn=je,0===Qt&&As(gs)),Bn===je&&(Bn=null),cn=[],gr.test(Ce.charAt(jr))?(Uo=Ce.charAt(jr),jr++):(Uo=je,0===Qt&&As(Kr)),Uo!==je)for(;Uo!==je;)cn.push(Uo),gr.test(Ce.charAt(jr))?(Uo=Ce.charAt(jr),jr++):(Uo=je,0===Qt&&As(Kr));else cn=je;cn!==je?vs=Ri=[Ri,Bn,cn]:(jr=vs,vs=je)}else jr=vs,vs=je;vs===je&&(vs=null),Gi=cr,cr=parseFloat(Vt())}else jr=cr,cr=je;return cr}if((Fe=Ie())!==je&&jr===Ce.length)return Fe;throw Fe!==je&&jr<Ce.length&&As({type:"end"}),function xi(cr,ns,vs){return new ze(ze.buildMessage(cr,ns),cr,ns,vs)}(kt,zn<Ce.length?Ce.charAt(zn):null,function $s(cr,ns){var vs=Os(cr),Ri=Os(ns);return{source:Re,start:{offset:cr,line:vs.line,column:vs.column},end:{offset:ns,line:Ri.line,column:Ri.column}}}(zn,zn<Ce.length?zn+1:zn))}}}());const ce={deg:1,grad:.9,rad:180/Math.PI,turn:360},pe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function me(xe){!function J(xe){if("quantity"!==xe.type||null!==xe.unit&&"%"!==xe.unit)throw new R.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${Y(xe)}`,{term:xe})}(xe);const ze=xe.value;return ee(ze,xe),"%"===xe.unit?.01*ze:ze}function Ee(xe){return function he(xe){if("quantity"!==xe.type||!(0===xe.value&&null===xe.unit||xe.unit&&null!=pe[xe.unit]))throw new R.Z("effect:type-error",`Expected <length>, Actual: ${Y(xe)}`,{term:xe})}(xe),xe.value*pe[xe.unit]||0}function De(xe){switch(xe.colorType){case"hex":return(0,D.rW)(xe.value);case"named":return be(xe.value);case"function":return function ve(xe){if(j(xe.parameters,4),Se.test(xe.name))return[me(xe.parameters[0]),me(xe.parameters[1]),me(xe.parameters[2]),xe.parameters[3]?me(xe.parameters[3]):1];if(ye.test(xe.name))return(0,D.B7)(function ge(xe){return function ie(xe){if("quantity"!==xe.type||null!==xe.unit)throw new R.Z("effect:type-error",`Expected <double>, Actual: ${Y(xe)}`,{term:xe})}(xe),ee(xe.value,xe),xe.value}(xe.parameters[0]),me(xe.parameters[1]),me(xe.parameters[2]),xe.parameters[3]?me(xe.parameters[3]):1);throw new R.Z("effect:syntax-error",`Invalid color function '${xe.name}'`,{colorFunction:xe})}(xe.value)}}function be(xe){if(!(0,D.St)(xe))throw new R.Z("effect:unknown-color",`color '${xe}' isn't valid`,{namedColor:xe});return(0,D.VL)(xe)}const Se=/^rgba?/i,ye=/^hsla?/i},53390:(nt,Ae,v)=>{"use strict";v.d(Ae,{AS:()=>R,Cb:()=>Z,uF:()=>G});var D=v(58141);function R(Q,$){const W=Q.length>$.length?Q:$;return(Q.length>$.length?$:Q).every((B,H)=>B.type===W[H].type)}function G(Q,$){const W=Q.length>$.length?Q:$,B=Q.length>$.length?$:Q;for(let H=B.length;H<W.length;H++)B.push((0,D.Ee)(W[H]))}function Z(Q){const $=Q[0];return!!$&&"type"in $}},66385:(nt,Ae,v)=>{"use strict";v.d(Ae,{S6:()=>G,nd:()=>Z,u_:()=>R});var D=v(62208);class R{constructor($=null,W={},B,H){this.geometry=$,this.attributes=W,this.centroid=B,this.objectId=H,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const $=new R(this.geometry,this.attributes,this.centroid,this.objectId);return $.displayId=this.displayId,$.geohashX=this.geohashX,$.geohashY=this.geohashY,$}}function G(Q){return!((0,D.Wi)(Q.geometry)||!Q.geometry.coords||!Q.geometry.coords.length)}class Z extends R{}},95786:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>D});class D{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const G=new D;return G.objectIdFieldName=this.objectIdFieldName,G.globalIdFieldName=this.globalIdFieldName,G.geohashFieldName=this.geohashFieldName,G.geometryProperties=this.geometryProperties,G.geometryType=this.geometryType,G.spatialReference=this.spatialReference,G.hasZ=this.hasZ,G.hasM=this.hasM,G.features=this.features,G.fields=this.fields,G.transform=this.transform,G.exceededTransferLimit=this.exceededTransferLimit,G.uniqueIdField=this.uniqueIdField,G.queryGeometry=this.queryGeometry,G.queryGeometryType=this.queryGeometryType,G}}},88071:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>D});class D{constructor(G=[],Z=[],Q=!1){this.lengths=G??[],this.coords=Z??[],this.hasIndeterminateRingOrder=Q}static fromRect(G){const[Z,Q,$,W]=G,B=$-Z,H=W-Q;return new D([5],[Z,Q,B,0,0,H,-B,0,0,-H])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((G,Z)=>G+Z)}forEachVertex(G){let Z=0;this.lengths.length||G(this.coords[0],this.coords[1]);for(let Q=0;Q<this.lengths.length;Q++){const $=this.lengths[Q];for(let W=0;W<$;W++)G(this.coords[2*(W+Z)],this.coords[2*(W+Z)+1]);Z+=$}}clone(G){return G?(G.set(this.coords),new D(this.lengths.slice(),G,this.hasIndeterminateRingOrder)):new D(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}},82141:(nt,Ae,v)=>{"use strict";function D(G,Z,Q){return{objectId:G,target:Z,distance:Q,type:"vertex"}}function R(G,Z,Q,$,W,B=!1){return{objectId:G,target:Z,distance:Q,type:"edge",start:$,end:W,draped:B}}v.d(Ae,{p:()=>R,u:()=>D})},53639:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>oe,k:()=>$}),v(8314);var R=v(62208),G=v(37053);function Z(le,de){if(le===de)return!0;if(null==le||null==de||le.length!==de.length)return!1;for(let se=0;se<le.length;se++){const re=le[se],j=de[se];if(re.length!==j.length)return!1;for(let Y=0;Y<re.length;Y++)if(re[Y]!==j[Y])return!1}return!0}function Q(le,de){if(le===de)return!0;if(null==le||null==de||le.length!==de.length)return!1;for(let se=0;se<le.length;se++)if(!Z(le[se],de[se]))return!1;return!0}function $(le,de){return le===de||(0,R.pC)(le)&&(0,R.pC)(de)&&(0,G.fS)(le.spatialReference,de.spatialReference)&&le.x===de.x&&le.y===de.y&&le.z===de.z&&le.m===de.m}function oe(le,de){return le===de||null!=le&&null!=de&&le.objectId===de.objectId&&!!function te(le,de){if(le===de)return!0;if((0,R.Wi)(le)||(0,R.Wi)(de)||le.type!==de.type)return!1;switch(le.type){case"point":return $(le,de);case"extent":return function X(le,de){return le.hasZ===de.hasZ&&le.hasM===de.hasM&&!!(0,G.fS)(le.spatialReference,de.spatialReference)&&le.xmin===de.xmin&&le.ymin===de.ymin&&le.zmin===de.zmin&&le.xmax===de.xmax&&le.ymax===de.ymax&&le.zmax===de.zmax}(le,de);case"polyline":return function W(le,de){return le.hasZ===de.hasZ&&le.hasM===de.hasM&&!!(0,G.fS)(le.spatialReference,de.spatialReference)&&Q(le.paths,de.paths)}(le,de);case"polygon":return function B(le,de){return le.hasZ===de.hasZ&&le.hasM===de.hasM&&!!(0,G.fS)(le.spatialReference,de.spatialReference)&&Q(le.rings,de.rings)}(le,de);case"multipoint":return function H(le,de){return le.hasZ===de.hasZ&&le.hasM===de.hasM&&!!(0,G.fS)(le.spatialReference,de.spatialReference)&&Z(le.points,de.points)}(le,de);case"mesh":return!1;default:return}}(le.geometry,de.geometry)&&!!function ae(le,de){if(le===de)return!0;if(!le||!de)return!1;const se=Object.keys(le),re=Object.keys(de);if(se.length!==re.length)return!1;for(const j of se)if(le[j]!==de[j])return!1;return!0}(le.attributes,de.attributes)}},88530:(nt,Ae,v)=>{"use strict";function D(R){return"point"===R.type}v.d(Ae,{f:()=>D})},38114:(nt,Ae,v)=>{"use strict";v.d(Ae,{FS:()=>pe,MS:()=>_e,PA:()=>re,Pj:()=>se,R3:()=>ce,S6:()=>le,TF:()=>me,Tx:()=>ee,Wh:()=>oe,Xw:()=>J,dF:()=>ue});var D=v(27306),G=(v(8314),v(62208)),Z=v(55713),Q=v(86236),$=v(65234),W=v(5548),B=v(65401),H=v(7848),X=v(71774),te=v(36255);v(53639);class oe{constructor(Se,ye,ve){this.uid=Se,this.geometry=ye,this.attributes=ve,this.visible=!0,this.objectId=null,this.centroid=null}}function le(be){return(0,G.pC)(be.geometry)}class se{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function re(be){const Se=X.Mk.fromJSON(be.geometryType),ye=$.Z.fromJSON(be.spatialReference),ve=be.transform,xe=be.features.map(ze=>{const Ke=function j(be,Se,ye,ve){return{uid:(0,Q.D)(),objectId:ve&&be.attributes?be.attributes[ve]:null,attributes:be.attributes,geometry:Y(be.geometry,Se,ye),visible:!0}}(ze,Se,ye,be.objectIdFieldName),We=Ke.geometry;if((0,G.pC)(We)&&ve)switch(We.type){case"point":Ke.geometry=(0,H.U1)(ve,We,We,We.hasZ,We.hasM);break;case"multipoint":Ke.geometry=(0,H.J9)(ve,We,We,We.hasZ,We.hasM);break;case"polygon":Ke.geometry=(0,H.Ie)(ve,We,We,We.hasZ,We.hasM);break;case"polyline":Ke.geometry=(0,H.G6)(ve,We,We,We.hasZ,We.hasM);break;case"extent":case"mesh":Ke.geometry=We}return Ke});return{geometryType:Se,features:xe,spatialReference:ye,fields:be.fields?be.fields.map(ze=>te.Z.fromJSON(ze)):null,objectIdFieldName:be.objectIdFieldName,globalIdFieldName:be.globalIdFieldName,geohashFieldName:be.geohashFieldName,geometryProperties:be.geometryProperties,hasZ:be.hasZ,hasM:be.hasM,exceededTransferLimit:be.exceededTransferLimit,transform:null}}function Y(be,Se,ye){if((0,G.Wi)(be))return null;switch(Se){case"point":return{x:be.x,y:be.y,z:be.z,m:be.m,hasZ:null!=be.z,hasM:null!=be.m,type:"point",spatialReference:ye};case"polyline":return{paths:be.paths,hasZ:!!be.hasZ,hasM:!!be.hasM,type:"polyline",spatialReference:ye};case"polygon":return{rings:be.rings,hasZ:!!be.hasZ,hasM:!!be.hasM,type:"polygon",spatialReference:ye};case"multipoint":return{points:be.points,hasZ:!!be.hasZ,hasM:!!be.hasM,type:"multipoint",spatialReference:ye}}}function ee(be,Se,ye,ve){return{x:be,y:Se,z:ye,hasZ:null!=ye,hasM:!1,spatialReference:ve,type:"point"}}function J(be){let Se=32;return Se+=(0,D.f2)(be.attributes),Se+=3,Se+=8+function ie(be){if((0,G.Wi)(be))return 0;let Se=32;switch(be.type){case"point":Se+=42;break;case"polyline":case"polygon":{let ye=0;const ve=2+(be.hasZ?1:0)+(be.hasM?1:0),xe="polyline"===be.type?be.paths:be.rings;for(const ze of xe)ye+=ze.length;Se+=8*ye*ve+64,Se+=128*ye,Se+=34,Se+=32*(xe.length+1);break}case"multipoint":{const ve=be.points.length;Se+=8*ve*(2+(be.hasZ?1:0)+(be.hasM?1:0))+64,Se+=128*ve,Se+=34,Se+=32;break}case"extent":Se+=98,be.hasM&&(Se+=32),be.hasZ&&(Se+=32);break;case"mesh":Se+=(0,Z.Xw)(be.vertexAttributes.position),Se+=(0,Z.Xw)(be.vertexAttributes.normal),Se+=(0,Z.Xw)(be.vertexAttributes.uv),Se+=(0,Z.Xw)(be.vertexAttributes.tangent)}return Se}(be.geometry),Se}function ce(be){if((0,G.Wi)(be))return 0;switch(be.type){case"point":return 1;case"polyline":{let Se=0;for(const ye of be.paths)Se+=ye.length;return Se}case"polygon":{let Se=0;for(const ye of be.rings)Se+=ye.length;return Se}case"multipoint":return be.points.length;case"extent":return 2;case"mesh":{const Se=be.vertexAttributes&&be.vertexAttributes.position;return Se?Se.length/3:0}default:return}}function ue(be){if((0,G.Wi)(be))return!1;switch(be.type){case"extent":case"point":return!0;case"polyline":for(const Se of be.paths)if(Se.length>0)return!0;return!1;case"polygon":for(const Se of be.rings)if(Se.length>0)return!0;return!1;case"multipoint":return be.points.length>0;case"mesh":return!be.loaded||be.vertexAttributes.position.length>0}}function pe(be,Se){switch((0,W.cS)(Se),"mesh"===be.type&&(be=be.extent),be.type){case"point":Se[0]=Se[3]=be.x,Se[1]=Se[4]=be.y,be.hasZ&&(Se[2]=Se[5]=be.z);break;case"polyline":for(let ye=0;ye<be.paths.length;ye++)(0,W.Wi)(Se,be.paths[ye],be.hasZ);break;case"polygon":for(let ye=0;ye<be.rings.length;ye++)(0,W.Wi)(Se,be.rings[ye],be.hasZ);break;case"multipoint":(0,W.Wi)(Se,be.points,be.hasZ);break;case"extent":Se[0]=be.xmin,Se[1]=be.ymin,Se[3]=be.xmax,Se[4]=be.ymax,null!=be.zmin&&(Se[2]=be.zmin),null!=be.zmax&&(Se[5]=be.zmax)}}function me(be,Se){switch((0,B.cS)(Se),"mesh"===be.type&&(be=be.extent),be.type){case"point":Se[0]=Se[2]=be.x,Se[1]=Se[3]=be.y;break;case"polyline":for(let ye=0;ye<be.paths.length;ye++)(0,B.Wi)(Se,be.paths[ye]);break;case"polygon":for(let ye=0;ye<be.rings.length;ye++)(0,B.Wi)(Se,be.rings[ye]);break;case"multipoint":(0,B.Wi)(Se,be.points);break;case"extent":Se[0]=be.xmin,Se[1]=be.ymin,Se[2]=be.xmax,Se[3]=be.ymax}}function _e(be,Se){return null!=be.objectId?be.objectId:be.attributes&&Se?be.attributes[Se]:null}(0,W.Ue)(),(0,B.Ue)()},82054:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>jt,$g:()=>Wt,EI:()=>Xe,GH:()=>Ye,IN:()=>re,Iv:()=>ve,J6:()=>We,Jd:()=>se,Nh:()=>_t,RZ:()=>ut,Uy:()=>He,XA:()=>Le,Yn:()=>Me,cn:()=>et,dd:()=>Se,di:()=>Je,eG:()=>je,fQ:()=>ie,hY:()=>pr,h_:()=>qe,lM:()=>ot,lz:()=>Fr,oB:()=>wt,zj:()=>Ct});var D=v(26584),R=v(63290),G=v(62208),Z=v(91179),Q=v(66385),$=v(95786),W=v(88071);function B(Et,St){return Et?St?4:3:St?3:2}const H=R.Z.getLogger("esri.layers.graphics.featureConversionUtils"),X={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},te=(Et,St,Ft,zt,dr,hr)=>{Et[Ft]=dr,Et[Ft+1]=hr},ae=(Et,St,Ft,zt,dr,hr)=>{Et[Ft]=dr,Et[Ft+1]=hr,Et[Ft+2]=St[zt+2]},oe=(Et,St,Ft,zt,dr,hr)=>{Et[Ft]=dr,Et[Ft+1]=hr,Et[Ft+2]=St[zt+3]},le=(Et,St,Ft,zt,dr,hr)=>{Et[Ft]=dr,Et[Ft+1]=hr,Et[Ft+2]=St[zt+2],Et[Ft+3]=St[zt+3]};function de(Et,St,Ft,zt){if(Et){if(Ft)return St&&zt?le:ae;if(St&&zt)return oe}else if(St&&zt)return ae;return te}function se({scale:Et,translate:St},Ft){return Math.round((Ft-St[0])/Et[0])}function re({scale:Et,translate:St},Ft){return Math.round((St[1]-Ft)/Et[1])}function ee({scale:Et,translate:St},Ft,zt){return Ft*Et[zt]+St[zt]}function ie(Et,St,Ft){return Et?St?Ft?ge(Et):ue(Et):Ft?he(Et):J(Et):null}function J(Et){const St=Et.coords;return{x:St[0],y:St[1]}}function ce(Et,St){return Et.coords[0]=St.x,Et.coords[1]=St.y,Et}function ue(Et){const St=Et.coords;return{x:St[0],y:St[1],z:St[2]}}function pe(Et,St){return Et.coords[0]=St.x,Et.coords[1]=St.y,Et.coords[2]=St.z,Et}function he(Et){const St=Et.coords;return{x:St[0],y:St[1],m:St[2]}}function me(Et,St){return Et.coords[0]=St.x,Et.coords[1]=St.y,Et.coords[2]=St.m,Et}function ge(Et){const St=Et.coords;return{x:St[0],y:St[1],z:St[2],m:St[3]}}function _e(Et,St){return Et.coords[0]=St.x,Et.coords[1]=St.y,Et.coords[2]=St.z,Et.coords[3]=St.m,Et}function De(Et,St){return Et&&St?_e:Et?pe:St?me:ce}function Se(Et,St,Ft=De(null!=St.z,null!=St.m)){return Ft(Et,St)}function ve(Et,St,Ft){if((0,G.Wi)(Et))return null;const zt=B(St,Ft),dr=[];for(let hr=0;hr<Et.coords.length;hr+=zt){const Tr=[];for(let Dr=0;Dr<zt;Dr++)Tr.push(Et.coords[hr+Dr]);dr.push(Tr)}return St?Ft?{points:dr,hasZ:St,hasM:Ft}:{points:dr,hasZ:St}:Ft?{points:dr,hasM:Ft}:{points:dr}}function ze(Et,St,Ft=B(St.hasZ,St.hasM)){Et.lengths[0]=St.points.length;const zt=Et.coords;let dr=0;for(const hr of St.points)for(let Tr=0;Tr<Ft;Tr++)zt[dr++]=hr[Tr];return Et}function We(Et,St,Ft){if(!Et)return null;const zt=B(St,Ft),{coords:dr,lengths:hr}=Et,Tr=[];let Dr=0;for(const Lr of hr){const Hr=[];for(let Qr=0;Qr<Lr;Qr++){const Jr=[];for(let Ss=0;Ss<zt;Ss++)Jr.push(dr[Dr++]);Hr.push(Jr)}Tr.push(Hr)}return St?Ft?{paths:Tr,hasZ:St,hasM:Ft}:{paths:Tr,hasZ:St}:Ft?{paths:Tr,hasM:Ft}:{paths:Tr}}function Be(Et,St,Ft=B(St.hasZ,St.hasM)){const{lengths:zt,coords:dr}=Et;let hr=0;for(const Tr of St.paths){for(const Dr of Tr)for(let Lr=0;Lr<Ft;Lr++)dr[hr++]=Dr[Lr];zt.push(Tr.length)}return Et}function je(Et,St,Ft){if(!Et)return null;const zt=B(St,Ft),{coords:dr,lengths:hr}=Et,Tr=[];let Dr=0;for(const Lr of hr){const Hr=[];for(let Qr=0;Qr<Lr;Qr++){const Jr=[];for(let Ss=0;Ss<zt;Ss++)Jr.push(dr[Dr++]);Hr.push(Jr)}Tr.push(Hr)}return St?Ft?{rings:Tr,hasZ:St,hasM:Ft}:{rings:Tr,hasZ:St}:Ft?{rings:Tr,hasM:Ft}:{rings:Tr}}function He(Et,St,Ft=St.hasZ,zt=St.hasM){return function Ie(Et,St,Ft,zt){const dr=B(Ft,zt),{lengths:hr,coords:Tr}=Et;let Dr=0;or(Et);for(const Lr of St){for(const Hr of Lr)for(let Qr=0;Qr<dr;Qr++)Tr[Dr++]=Hr[Qr];hr.push(Lr.length)}}(Et,St.rings,Ft,zt),Et}const Ge=[],Pe=[];function Le(Et,St,Ft,zt,dr){Ge[0]=Et;const[hr]=Me(Pe,Ge,St,Ft,zt,dr);return sr(Ge),sr(Pe),hr}function Me(Et,St,Ft,zt,dr,hr){if(sr(Et),!Ft){for(const Tr of St)Et.push(new Q.u_(null,Tr.attributes,null,hr?Tr.attributes[hr]:void 0));return Et}switch(Ft){case"esriGeometryPoint":return function be(Et,St,Ft,zt,dr){const hr=De(Ft,zt);for(const{geometry:Tr,attributes:Dr}of St){const Lr=(0,G.pC)(Tr)?hr(new W.Z,Tr):null;Et.push(new Q.u_(Lr,Dr,null,dr?Dr[dr]:void 0))}return Et}(Et,St,zt,dr,hr);case"esriGeometryMultipoint":return function xe(Et,St,Ft,zt,dr){const hr=B(Ft,zt);for(const{geometry:Tr,attributes:Dr}of St){const Lr=(0,G.pC)(Tr)?ze(new W.Z,Tr,hr):null;Et.push(new Q.u_(Lr,Dr,null,dr?Dr[dr]:void 0))}return Et}(Et,St,zt,dr,hr);case"esriGeometryPolyline":return function Ce(Et,St,Ft,zt,dr){const hr=B(Ft,zt);for(const{geometry:Tr,attributes:Dr}of St){const Lr=(0,G.pC)(Tr)?Be(new W.Z,Tr,hr):null;Et.push(new Q.u_(Lr,Dr,null,dr?Dr[dr]:void 0))}return Et}(Et,St,zt,dr,hr);case"esriGeometryPolygon":return function Re(Et,St,Ft,zt,dr){for(const{geometry:hr,centroid:Tr,attributes:Dr}of St){const Lr=(0,G.pC)(hr)?He(new W.Z,hr,Ft,zt):null,Hr=dr?Dr[dr]:void 0;(0,G.pC)(Tr)?Et.push(new Q.u_(Lr,Dr,ce(new W.Z,Tr),Hr)):Et.push(new Q.u_(Lr,Dr,null,Hr))}return Et}(Et,St,zt,dr,hr);default:H.error("convertToFeatureSet:unknown-geometry",new D.Z(`Unable to parse unknown geometry type '${Ft}'`)),sr(Et)}return Et}function Xe(Et,St,Ft,zt){Pe[0]=Et,tt(Ge,Pe,St,Ft,zt);const dr=Ge[0];return sr(Ge),sr(Pe),dr}function Ye(Et,St,Ft){if((0,G.Wi)(Et))return null;const zt=new W.Z;return"hasZ"in Et&&null==St&&(St=Et.hasZ),"hasM"in Et&&null==Ft&&(Ft=Et.hasM),(0,Z.wp)(Et)?De(St??null!=Et.z,Ft??null!=Et.m)(zt,Et):(0,Z.oU)(Et)?He(zt,Et,St,Ft):(0,Z.l9)(Et)?Be(zt,Et,B(St,Ft)):(0,Z.aW)(Et)?ze(zt,Et,B(St,Ft)):void H.error("convertFromGeometry:unknown-geometry",new D.Z(`Unable to parse unknown geometry type '${Et}'`))}function Je(Et,St,Ft,zt){const dr=Et&&("coords"in Et?Et:Et.geometry);if((0,G.Wi)(dr))return null;switch(St){case"esriGeometryPoint":{let hr=J;return Ft&&zt?hr=ge:Ft?hr=ue:zt&&(hr=he),hr(dr)}case"esriGeometryMultipoint":return ve(dr,Ft,zt);case"esriGeometryPolyline":return We(dr,Ft,zt);case"esriGeometryPolygon":return je(dr,Ft,zt);default:return H.error("convertToGeometry:unknown-geometry",new D.Z(`Unable to parse unknown geometry type '${St}'`)),null}}function tt(Et,St,Ft,zt,dr){if(sr(Et),(0,G.Wi)(Ft))return function rt(Et,St){for(const Ft of St)Et.push({attributes:Ft.attributes});return Et}(Et,St);switch(Ft){case"esriGeometryPoint":return function Ee(Et,St,Ft,zt){let dr=J;Ft&&zt?dr=ge:Ft?dr=ue:zt&&(dr=he);for(const hr of St){const{geometry:Tr,attributes:Dr}=hr,Lr=(0,G.pC)(Tr)?dr(Tr):null;Et.push({attributes:Dr,geometry:Lr})}return Et}(Et,St,zt,dr);case"esriGeometryMultipoint":return function ye(Et,St,Ft,zt){for(const{geometry:dr,attributes:hr}of St)Et.push({attributes:hr,geometry:(0,G.pC)(dr)?ve(dr,Ft,zt):null});return Et}(Et,St,zt,dr);case"esriGeometryPolyline":return function Ke(Et,St,Ft,zt){for(const{geometry:dr,attributes:hr}of St)Et.push({attributes:hr,geometry:(0,G.pC)(dr)?We(dr,Ft,zt):null});return Et}(Et,St,zt,dr);case"esriGeometryPolygon":return function Fe(Et,St,Ft,zt){for(const{geometry:dr,attributes:hr,centroid:Tr}of St){const Dr=(0,G.pC)(dr)?je(dr,Ft,zt):null;if((0,G.pC)(Tr)){const Lr=J(Tr);Et.push({attributes:hr,centroid:Lr,geometry:Dr})}else Et.push({attributes:hr,geometry:Dr})}return Et}(Et,St,zt,dr);default:H.error("convertToFeatureSet:unknown-geometry",new D.Z(`Unable to parse unknown geometry type '${Ft}'`))}return Et}function et(Et){const{objectIdFieldName:St,spatialReference:Ft,transform:zt,fields:dr,hasM:hr,hasZ:Tr,features:Dr,geometryType:Lr,exceededTransferLimit:Hr,uniqueIdField:Qr,queryGeometry:Jr,queryGeometryType:Ss}=Et,Cs={features:tt([],Dr,Lr,Tr,hr),fields:dr,geometryType:Lr,objectIdFieldName:St,spatialReference:Ft,uniqueIdField:Qr,queryGeometry:Je(Jr,Ss,!1,!1)};return zt&&(Cs.transform=zt),Hr&&(Cs.exceededTransferLimit=Hr),hr&&(Cs.hasM=hr),Tr&&(Cs.hasZ=Tr),Cs}function qe(Et,St){const Ft=new $.Z,{hasM:zt,hasZ:dr,features:hr,objectIdFieldName:Tr,spatialReference:Dr,geometryType:Lr,exceededTransferLimit:Hr,transform:Qr,fields:Jr}=Et;return Jr&&(Ft.fields=Jr),Ft.geometryType=Lr??null,Ft.objectIdFieldName=Tr??St??null,Ft.spatialReference=Dr??null,Ft.objectIdFieldName?(hr&&Me(Ft.features,hr,Lr,dr,zt,Ft.objectIdFieldName),Hr&&(Ft.exceededTransferLimit=Hr),zt&&(Ft.hasM=zt),dr&&(Ft.hasZ=dr),Qr&&(Ft.transform=Qr),Ft):(H.error(new D.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),Ft)}function ot(Et){const{transform:St,features:Ft,hasM:zt,hasZ:dr}=Et;if(!St)return Et;for(const hr of Ft)(0,G.pC)(hr.geometry)&&Wt(hr.geometry,hr.geometry,zt,dr,St),(0,G.pC)(hr.centroid)&&Wt(hr.centroid,hr.centroid,zt,dr,St);return Et.transform=null,Et}function ut(Et,St){const{geometryType:Ft,features:zt,hasM:dr,hasZ:hr}=St;if(!Et)return St;for(let Tr=0;Tr<zt.length;Tr++){const Dr=zt[Tr],Lr=Dr.weakClone();Lr.geometry=new W.Z,_t(Lr.geometry,Dr.geometry,dr,hr,Ft,Et),Dr.centroid&&(Lr.centroid=new W.Z,_t(Lr.centroid,Dr.centroid,dr,hr,"esriGeometryPoint",Et)),zt[Tr]=Lr}return St.transform=Et,St}function _t(Et,St,Ft,zt,dr,hr,Tr=Ft,Dr=zt){if(or(Et),(0,G.Wi)(St)||!St.coords.length)return null;const Lr=X[dr],{coords:Hr,lengths:Qr}=St,Jr=B(Ft,zt),Ss=B(Ft&&Tr,zt&&Dr),Cs=de(Ft,zt,Tr,Dr);if(!Qr.length)return Cs(Et.coords,Hr,0,0,se(hr,Hr[0]),re(hr,Hr[1])),or(Et,Jr,0),Et;let Dt,ct,At,Kt,tr=0,_r=0,Or=_r;for(const gs of Qr){if(gs<Lr)continue;let Kr=0;_r=Or,At=Dt=se(hr,Hr[tr]),Kt=ct=re(hr,Hr[tr+1]),Cs(Et.coords,Hr,_r,tr,At,Kt),Kr++,tr+=Jr,_r+=Ss;for(let qt=1;qt<gs;qt++,tr+=Jr)At=se(hr,Hr[tr]),Kt=re(hr,Hr[tr+1]),At===Dt&&Kt===ct||(Cs(Et.coords,Hr,_r,tr,At-Dt,Kt-ct),_r+=Ss,Kr++,Dt=At,ct=Kt);Kr>=Lr&&(Et.lengths.push(Kr),Or=_r)}return sr(Et.coords,Or),Et.coords.length?Et:null}function Ct(Et,St,Ft,zt,dr,hr,Tr=Ft,Dr=zt){if(or(Et),!St||!St.coords.length)return null;const Lr=X[dr],{coords:Hr,lengths:Qr}=St,Jr=B(Ft,zt),Ss=B(Ft&&Tr,zt&&Dr),Cs=de(Ft,zt,Tr,Dr);if(!Qr.length)return Cs(Et.coords,Hr,0,0,Hr[0],Hr[1]),or(Et,Jr,0),Et;let Dt=0;const ct=hr*hr;for(const At of Qr){if(At<Lr){Dt+=At*Jr;continue}const Kt=Et.coords.length/Ss,tr=Dt,_r=Dt+(At-1)*Jr;Cs(Et.coords,Hr,Et.coords.length,tr,Hr[tr],Hr[tr+1]),Lt(Et.coords,Hr,Jr,ct,Cs,tr,_r),Cs(Et.coords,Hr,Et.coords.length,_r,Hr[_r],Hr[_r+1]);const Or=Et.coords.length/Ss-Kt;Or>=Lr?Et.lengths.push(Or):sr(Et.coords,Kt*Ss),Dt+=At*Jr}return Et.coords.length?Et:null}function vt(Et,St,Ft,zt){const dr=Et[St],hr=Et[St+1],Lr=Et[zt],Hr=Et[zt+1];let Qr=Et[Ft],Jr=Et[Ft+1],Ss=Lr-Qr,Cs=Hr-Jr;if(0!==Ss||0!==Cs){const Dt=((dr-Qr)*Ss+(hr-Jr)*Cs)/(Ss*Ss+Cs*Cs);Dt>1?(Qr=Lr,Jr=Hr):Dt>0&&(Qr+=Ss*Dt,Jr+=Cs*Dt)}return Ss=dr-Qr,Cs=hr-Jr,Ss*Ss+Cs*Cs}function Lt(Et,St,Ft,zt,dr,hr,Tr){let Dr,Lr=zt,Hr=0;for(let Qr=hr+Ft;Qr<Tr;Qr+=Ft)Dr=vt(St,Qr,hr,Tr),Dr>Lr&&(Hr=Qr,Lr=Dr);Lr>zt&&(Hr-hr>Ft&&Lt(Et,St,Ft,zt,dr,hr,Hr),dr(Et,St,Et.length,Hr,St[Hr],St[Hr+1]),Tr-Hr>Ft&&Lt(Et,St,Ft,zt,dr,Hr,Tr))}function jt(Et,St,Ft,zt){if((0,G.Wi)(St)||!St.coords||!St.coords.length)return null;const dr=B(Ft,zt);let hr=Number.POSITIVE_INFINITY,Tr=Number.POSITIVE_INFINITY,Dr=Number.NEGATIVE_INFINITY,Lr=Number.NEGATIVE_INFINITY;if(St&&St.coords){const Hr=St.coords;for(let Qr=0;Qr<Hr.length;Qr+=dr){const Jr=Hr[Qr],Ss=Hr[Qr+1];hr=Math.min(hr,Jr),Dr=Math.max(Dr,Jr),Tr=Math.min(Tr,Ss),Lr=Math.max(Lr,Ss)}}return Et[0]=hr,Et[1]=Tr,Et[2]=Dr,Et[3]=Lr,Et}function Wt(Et,St,Ft,zt,dr){const{coords:hr,lengths:Tr}=St,Dr=B(Ft,zt);if(!hr.length)return Et!==St&&or(Et),Et;(0,G.O3)(dr);const{originPosition:Lr,scale:Hr,translate:Qr}=dr,Jr=rr;Jr.originPosition=Lr;const Ss=Jr.scale;Ss[0]=Hr[0]??1,Ss[1]=-(Hr[1]??1),Ss[2]=Hr[2]??1,Ss[3]=Hr[3]??1;const Cs=Jr.translate;if(Cs[0]=Qr[0]??0,Cs[1]=Qr[1]??0,Cs[2]=Qr[2]??0,Cs[3]=Qr[3]??0,!Tr.length){for(let ct=0;ct<Dr;++ct)Et.coords[ct]=ee(Jr,hr[ct],ct);return Et!==St&&or(Et,Dr,0),Et}let Dt=0;for(let ct=0;ct<Tr.length;ct++){const At=Tr[ct];Et.lengths[ct]=At;for(let _r=0;_r<Dr;++_r)Et.coords[Dt+_r]=ee(Jr,hr[Dt+_r],_r);let Kt=Et.coords[Dt],tr=Et.coords[Dt+1];Dt+=Dr;for(let _r=1;_r<At;_r++,Dt+=Dr){Kt+=hr[Dt]*Ss[0],tr+=hr[Dt+1]*Ss[1],Et.coords[Dt]=Kt,Et.coords[Dt+1]=tr;for(let Or=2;Or<Dr;++Or)Et.coords[Dt+Or]=ee(Jr,hr[Dt+Or],Or)}}return Et!==St&&or(Et,hr.length,Tr.length),Et}function pr(Et,St,Ft,zt,dr,hr){if(or(Et),Et.lengths.push(...St.lengths),Ft===dr&&zt===hr)for(let Tr=0;Tr<St.coords.length;Tr++)Et.coords.push(St.coords[Tr]);else{const Tr=B(Ft,zt),Dr=de(Ft,zt,dr,hr),Lr=St.coords;for(let Hr=0;Hr<Lr.length;Hr+=Tr)Dr(Et.coords,Lr,Et.coords.length,Hr,Lr[Hr],Lr[Hr+1])}return Et}function ar(Et,St,Ft,zt){let dr=0,hr=Et[zt*St],Tr=Et[zt*(St+1)];for(let Dr=1;Dr<Ft;Dr++){const Lr=hr+Et[zt*(St+Dr)],Hr=Tr+Et[zt*(St+Dr)+1],Qr=(Lr-hr)*(Hr+Tr);hr=Lr,Tr=Hr,dr+=Qr}return.5*dr}function Fr(Et,St){const{coords:Ft,lengths:zt}=Et;let dr=0,hr=0;for(let Tr=0;Tr<zt.length;Tr++){const Dr=zt[Tr];hr+=ar(Ft,dr,Dr,St),dr+=Dr}return Math.abs(hr)}function wt(Et,St){if((0,G.Wi)(Et))return null;const Ft=Et.clone(),zt=Et.coords,dr=Et.lengths;let hr=0;for(let Tr=0;Tr<dr.length;Tr++){const Dr=dr[Tr];let Lr=zt[St*hr],Hr=zt[St*hr+1];for(let Qr=1;Qr<Dr;Qr++){const Jr=Lr+zt[St*(hr+Qr)],Ss=Hr+zt[St*(hr+Qr)+1];Ft.coords[St*(hr+Qr)]=Jr,Ft.coords[St*(hr+Qr)+1]=Ss,Lr=Jr,Hr=Ss}hr+=Dr}return Ft}function or(Et,St=0,Ft=0){sr(Et.lengths,Ft),sr(Et.coords,St)}function sr(Et,St=0){Et.length!==St&&(Et.length=St)}const rr={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},84786:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>ie,Ou:()=>X,WG:()=>ee,kB:()=>le,mW:()=>oe}),v(29132);var R=v(88879),Z=(v(8314),v(58817)),Q=v(62208),$=v(55713),W=v(91179),B=v(38114),H=v(65234);function X(J){return"declaredClass"in J}function te(J){return"declaredClass"in J}function oe(J,ce){if(!J)return null;if(function ae(J){return"declaredClass"in J}(J))return J;const ue=new R.Z({layer:ce,sourceLayer:ce});return ue.visible=J.visible,ue.symbol=(0,Z.d9)(J.symbol),ue.attributes=(0,Z.d9)(J.attributes),ue.geometry=le(J.geometry),ue}function le(J){return(0,Q.Wi)(J)?null:X(J)?J:(0,W.im)(function de(J){const{wkid:ce,wkt:ue,latestWkid:pe}=J.spatialReference,he={wkid:ce,wkt:ue,latestWkid:pe};switch(J.type){case"point":{const{x:me,y:ge,z:_e,m:Ee}=J;return{x:me,y:ge,z:_e,m:Ee,spatialReference:he}}case"polygon":{const{rings:me,hasZ:ge,hasM:_e}=J;return{rings:se(me),hasZ:ge,hasM:_e,spatialReference:he}}case"polyline":{const{paths:me,hasZ:ge,hasM:_e}=J;return{paths:se(me),hasZ:ge,hasM:_e,spatialReference:he}}case"extent":{const{xmin:me,xmax:ge,ymin:_e,ymax:Ee,zmin:De,zmax:be,mmin:Se,mmax:ye,hasZ:ve,hasM:xe}=J;return{xmin:me,xmax:ge,ymin:_e,ymax:Ee,zmin:De,zmax:be,mmin:Se,mmax:ye,hasZ:ve,hasM:xe,spatialReference:he}}case"multipoint":{const{points:me,hasZ:ge,hasM:_e}=J;return{points:Y(me)?re(me):me,hasZ:ge,hasM:_e,spatialReference:he}}default:return}}(J))}function se(J){return function j(J){for(const ce of J)if(0!==ce.length)return Y(ce);return!1}(J)?J.map(ce=>re(ce)):J}function re(J){return J.map(ce=>(0,$.qo)(ce))}function Y(J){return J.length&&((0,$.xZ)(J[0])||(0,$.fS)(J[0]))}function ee(J,ce){if(!J)return null;let ue;if(te(J)){if(null==ce)return J.clone();if(te(ce))return ce.copy(J)}return null!=ce?(ue=ce,ue.x=J.x,ue.y=J.y,ue.spatialReference=J.spatialReference,J.hasZ?(ue.z=J.z,ue.hasZ=J.hasZ):(ue.z=null,ue.hasZ=!1),J.hasM?(ue.m=J.m,ue.hasM=!0):(ue.m=null,ue.hasM=!1)):(ue=(0,B.Tx)(J.x,J.y,J.z,J.spatialReference),J.hasM&&(ue.m=J.m,ue.hasM=!0)),ue}function ie(J){const{wkid:ce,wkt:ue,latestWkid:pe}=J;return H.Z.fromJSON({wkid:ce,wkt:ue,latestWkid:pe})}},50085:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>W});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898));const W=B=>{let H=class extends B{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function $(B){return"portalItem"in B}(this)?this.portalItem?.apiKey:null}set apiKey(X){null!=X?this._override("apiKey",X):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,D._)([(0,R.Cb)({type:String})],H.prototype,"apiKey",null),H=(0,D._)([(0,Q.j)("esri.layers.mixins.APIKeyMixin")],H),H}},65088:(nt,Ae,v)=>{"use strict";v.d(Ae,{Y:()=>H});var D=v(17626),R=v(63290),G=v(62208),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(38305);const H=X=>{let te=class extends X{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const ae=(0,B.Qc)(this.url);if((0,G.pC)(ae)&&ae.title)return ae.title}return this._get("title")||""}set title(ae){this._set("title",ae)}set url(ae){this._set("url",(0,B.Nm)(ae,R.Z.getLogger(this.declaredClass)))}};return(0,D._)([(0,Z.Cb)()],te.prototype,"title",null),(0,D._)([(0,Z.Cb)({type:String})],te.prototype,"url",null),te=(0,D._)([(0,W.j)("esri.layers.mixins.ArcGISService")],te),te}},552:(nt,Ae,v)=>{"use strict";v.d(Ae,{h:()=>B});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(71149);const W={read:{reader:$.ij},write:{allowNull:!0,writer:$.cW}},B=H=>{let X=class extends H{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,D._)([(0,R.Cb)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],X.prototype,"blendMode",void 0),(0,D._)([(0,R.Cb)({json:{read:!1,write:!1,origins:{"web-map":W,"portal-item":W}}})],X.prototype,"effect",void 0),X=(0,D._)([(0,Q.j)("esri.layers.mixins.BlendLayer")],X),X}},50107:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>$});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898));const $=W=>{let B=class extends W{constructor(){super(...arguments),this.customParameters=null}};return(0,D._)([(0,R.Cb)({type:Object,json:{write:{overridePolicy:H=>({enabled:!!(H&&Object.keys(H).length>0)})}}})],B.prototype,"customParameters",void 0),B=(0,D._)([(0,Q.j)("esri.layers.mixins.CustomParametersMixin")],B),B}},6733:(nt,Ae,v)=>{"use strict";v.d(Ae,{dU:()=>H,lQ:()=>ae,o1:()=>oe});var D=v(17626),R=v(61885),G=v(58817),B=(v(63290),v(90912),v(26584),v(8314),v(76898));const H=new R.Z.EventEmitter,X="esri.layers.mixins.EditBusLayer",te=Symbol(X);function ae(le){return null!=le&&"object"==typeof le&&te in le}const oe=le=>{var de;let se=class extends le{constructor(...re){super(...re),this[de]=!0,this.when().then(()=>{this.own([H.on("edits",j=>{const ie="layer"in j?j.layer?.layerId:j.layerId,J=j.event;if(("layer"in j?j.layer:null)===this||("layer"in j?j.layer?.url:j.serviceUrl)!==this.url)return;if(null!=ie&&null!=this.layerId&&ie===this.layerId)return void this.emit("edits",(0,G.d9)(J));const ce=J.editedFeatures?.find(({layerId:ue})=>ue===this.layerId);if(ce){const{adds:ue,updates:pe,deletes:he}=ce.editedFeatures,me={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:ue?ue.map(({attributes:ge})=>({objectId:this.objectIdField&&ge[this.objectIdField],globalId:this.globalIdField&&ge[this.globalIdField]})):[],deletedFeatures:he?he.map(({attributes:ge})=>({objectId:this.objectIdField&&ge[this.objectIdField],globalId:this.globalIdField&&ge[this.globalIdField]})):[],updatedFeatures:pe?pe.map(({current:{attributes:ge}})=>({objectId:this.objectIdField&&ge[this.objectIdField],globalId:this.globalIdField&&ge[this.globalIdField]})):[],editedFeatures:(0,G.d9)(J.editedFeatures)};this.emit("edits",me)}})])},()=>{})}};return de=te,se=(0,D._)([(0,B.j)(X)],se),se}},35126:(nt,Ae,v)=>{"use strict";v.d(Ae,{b:()=>B});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(2319);const W={write:{allowNull:!0}},B=H=>{let X=class extends H{constructor(){super(...arguments),this.featureEffect=null}};return(0,D._)([(0,R.Cb)({type:$.Z,json:{origins:{"web-map":W,"portal-item":W}}})],X.prototype,"featureEffect",void 0),X=(0,D._)([(0,Q.j)("esri.layers.mixins.FeatureEffectLayer")],X),X}},87987:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>_e});var D=v(17626),R=v(46160),G=v(58817),Z=v(63290),Q=v(77712),W=(v(90912),v(68653)),B=v(76898),H=v(99433),X=v(2004),te=v(79334),ae=v(65234),oe=v(38305),le=v(13812),de=v(79608),se=v(86810);v(85931);let j=class extends((0,de.J)(se.wq)){constructor(Ee){super(Ee)}};(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"name",void 0),(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"fields",void 0),(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"isAscending",void 0),(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"indexType",void 0),(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"isUnique",void 0),(0,D._)([(0,Q.Cb)({constructOnly:!0,json:{write:!0}})],j.prototype,"description",void 0),j=(0,D._)([(0,B.j)("esri.layers.support.FeatureIndex")],j);var Y=v(26331),ee=v(16730);let ie=class extends((0,de.J)(se.wq)){constructor(Ee){super(Ee),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};(0,D._)([(0,Q.Cb)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],ie.prototype,"shapeAreaField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],ie.prototype,"shapeLengthField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{read:Ee=>ee.gV.read(Ee)||ee.Jo.read(Ee)}})],ie.prototype,"units",void 0),ie=(0,D._)([(0,B.j)("esri.layers.support.GeometryFieldsInfo")],ie);const J=ie;var ce=v(2430),ue=v(2076);const pe=new ue.X({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),he=new ue.X({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let me=class extends((0,de.J)(se.wq)){constructor(Ee){super(Ee),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,D._)([(0,Q.Cb)({json:{read:pe.read,write:pe.write}})],me.prototype,"cardinality",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"composite",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"id",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"keyField",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"keyFieldInRelationshipTable",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"name",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"relatedTableId",void 0),(0,D._)([(0,Q.Cb)({json:{read:!0,write:!0}})],me.prototype,"relationshipTableId",void 0),(0,D._)([(0,Q.Cb)({json:{read:he.read,write:he.write}})],me.prototype,"role",void 0),me=(0,D._)([(0,B.j)("esri.layers.support.Relationship")],me);const ge=me,_e=Ee=>{let De=class extends Ee{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.spatialReference=ae.Z.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(R.Z.ofType(j)),this.userIsAdmin=!1,this.version=void 0}readCapabilitiesFromService(be,Se){return(0,Y.hu)(be,Se,this.url)}readEditingInfo(be,Se){const{editingInfo:ye}=Se;return ye?{lastEditDate:null!=ye.lastEditDate?new Date(ye.lastEditDate):null}:null}readIsTableFromService(be,Se){return"Table"===Se.type}readMinScale(be,Se){return Se.effectiveMinScale||be||0}readMaxScale(be,Se){return Se.effectiveMaxScale||be||0}readGlobalIdFieldFromService(be,Se){return(0,Y.rk)(Se)}readObjectIdFieldFromService(be,Se){return(0,Y.kZ)(Se)}readServiceDefinitionExpression(be,Se){return Se.definitionQuery||Se.definitionExpression}set url(be){const Se=(0,oe.XG)({layer:this,url:be,nonStandardUrlAllowed:!0,logger:Z.Z.getLogger(this.declaredClass)});this._set("url",Se.url),null!=Se.layerId&&this._set("layerId",Se.layerId)}writeUrl(be,Se,ye,ve){(0,oe.wH)(this,be,null,Se,ve)}readVersion(be,Se){return(0,Y.JY)(Se)}};return(0,D._)([(0,Q.Cb)({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],De.prototype,"capabilities",void 0),(0,D._)([(0,W.r)("service","capabilities")],De.prototype,"readCapabilitiesFromService",null),(0,D._)([(0,Q.Cb)({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],De.prototype,"copyright",void 0),(0,D._)([(0,Q.Cb)({type:Boolean})],De.prototype,"datesInUnknownTimezone",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],De.prototype,"displayField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],De.prototype,"definitionExpression",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],De.prototype,"editFieldsInfo",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],De.prototype,"editingInfo",void 0),(0,D._)([(0,W.r)("editingInfo")],De.prototype,"readEditingInfo",null),(0,D._)([(0,Q.Cb)((()=>{const be=(0,G.d9)(le.PV),Se=be.json.origins;return Se["web-map"]={read:!1,write:!1},Se["portal-item"]={read:!1,write:!1},be})())],De.prototype,"elevationInfo",void 0),(0,D._)([(0,Q.Cb)({type:ce.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],De.prototype,"floorInfo",void 0),(0,D._)([(0,Q.Cb)({type:X.Z,json:{origins:{service:{read:{source:"extent"}}}}})],De.prototype,"fullExtent",void 0),(0,D._)([(0,Q.Cb)()],De.prototype,"gdbVersion",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0,type:J,json:{read:{source:"geometryProperties"}}})],De.prototype,"geometryFieldsInfo",void 0),(0,D._)([(0,Q.Cb)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Y.Fr.read}}}})],De.prototype,"geometryType",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{origins:{service:{read:!0}}}})],De.prototype,"hasM",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{origins:{service:{read:!0}}}})],De.prototype,"hasZ",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0,type:te.Z})],De.prototype,"heightModelInfo",void 0),(0,D._)([(0,Q.Cb)({type:Date})],De.prototype,"historicMoment",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],De.prototype,"isTable",void 0),(0,D._)([(0,W.r)("service","isTable",["type"])],De.prototype,"readIsTableFromService",null),(0,D._)([(0,Q.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],De.prototype,"layerId",void 0),(0,D._)([(0,Q.Cb)(le.rO)],De.prototype,"minScale",void 0),(0,D._)([(0,W.r)("service","minScale",["minScale","effectiveMinScale"])],De.prototype,"readMinScale",null),(0,D._)([(0,Q.Cb)(le.u1)],De.prototype,"maxScale",void 0),(0,D._)([(0,W.r)("service","maxScale",["maxScale","effectiveMaxScale"])],De.prototype,"readMaxScale",null),(0,D._)([(0,Q.Cb)({type:String})],De.prototype,"globalIdField",void 0),(0,D._)([(0,W.r)("service","globalIdField",["globalIdField","fields"])],De.prototype,"readGlobalIdFieldFromService",null),(0,D._)([(0,Q.Cb)({type:String})],De.prototype,"objectIdField",void 0),(0,D._)([(0,W.r)("service","objectIdField",["objectIdField","fields"])],De.prototype,"readObjectIdFieldFromService",null),(0,D._)([(0,Q.Cb)({type:[ge],readOnly:!0})],De.prototype,"relationships",void 0),(0,D._)([(0,Q.Cb)()],De.prototype,"sourceJSON",void 0),(0,D._)([(0,Q.Cb)({type:Boolean})],De.prototype,"returnM",void 0),(0,D._)([(0,Q.Cb)({type:Boolean})],De.prototype,"returnZ",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],De.prototype,"serviceDefinitionExpression",void 0),(0,D._)([(0,W.r)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],De.prototype,"readServiceDefinitionExpression",null),(0,D._)([(0,Q.Cb)({type:ae.Z,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],De.prototype,"spatialReference",void 0),(0,D._)([(0,Q.Cb)({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],De.prototype,"subtypeField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],De.prototype,"trackIdField",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0,json:{write:!1}})],De.prototype,"serverGens",void 0),(0,D._)([(0,Q.Cb)({type:R.Z.ofType(j),readOnly:!0})],De.prototype,"indexes",void 0),(0,D._)([(0,Q.Cb)(le.HQ)],De.prototype,"url",null),(0,D._)([(0,H.c)("url")],De.prototype,"writeUrl",null),(0,D._)([(0,Q.Cb)({readOnly:!0})],De.prototype,"userIsAdmin",void 0),(0,D._)([(0,Q.Cb)({json:{origins:{service:{read:!0}},read:!1}})],De.prototype,"version",void 0),(0,D._)([(0,W.r)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],De.prototype,"readVersion",null),De=(0,D._)([(0,B.j)("esri.layers.mixins.FeatureLayerBase")],De),De}},81380:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>Fr});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(86810),W=v(58817),B=v(79608);let H=class extends((0,B.J)($.wq)){constructor(mr){super(mr),this.expression=null,this.title=null,this.returnType=null}};(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],H.prototype,"expression",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],H.prototype,"title",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],H.prototype,"returnType",void 0),H=(0,D._)([(0,Q.j)("esri.layers.support.ExpressionInfo")],H);const X=H;var te;let ae=te=class extends $.wq{constructor(mr){super(mr),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new te({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,W.d9)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,D._)([(0,R.Cb)({type:Boolean,json:{write:!0}})],ae.prototype,"isAutoGenerated",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],ae.prototype,"name",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],ae.prototype,"alias",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],ae.prototype,"onStatisticField",void 0),(0,D._)([(0,R.Cb)({type:X,json:{write:!0}})],ae.prototype,"onStatisticExpression",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],ae.prototype,"statisticType",void 0),ae=te=(0,D._)([(0,Q.j)("esri.layers.support.AggregateField")],ae);const oe=ae;var ye,le=v(83989),de=v(73281),J=(v(4832),v(49067),v(96794),v(69747),v(40425),v(69357),v(40342)),ce=v(73640),ue=v(33474),pe=v(32088),he=v(20383),me=v(94113),ge=v(55342),_e=v(68653),Ee=v(99433),De=v(383),be=v(13812),Se=v(170);const ve=(0,De.d)({types:he.QT});let ze=ye=class extends le.B{constructor(mr){super(mr),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(mr,wt,or){const sr=mr.filter(rr=>"avg_angle"!==rr.statisticType).map(rr=>rr.toJSON());(0,me.RB)(or,sr,wt)}readRenderer(mr,wt,or){const sr=wt.drawingInfo?.renderer;return sr?(0,ue.a)(sr,wt,or)??void 0:wt.defaultSymbol?wt.types&&wt.types.length?new ce.Z({defaultSymbol:ve(wt.defaultSymbol,wt,or),field:wt.typeIdField,uniqueValueInfos:wt.types.map(rr=>({id:rr.id,symbol:ve(rr.symbol,rr,or)}))}):new J.Z({symbol:ve(wt.defaultSymbol,wt,or)}):null}clone(){return new ye({fields:(0,W.d9)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,W.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:(0,W.d9)(this.popupTemplate),renderer:(0,W.d9)(this.renderer)})}};(0,D._)([(0,ge.J)({binning:"binning"})],ze.prototype,"type",void 0),(0,D._)([(0,ge.J)({geohash:"geohash"})],ze.prototype,"binType",void 0),(0,D._)([(0,R.Cb)({type:Number,range:{min:1,max:9},json:{write:!0}})],ze.prototype,"fixedBinLevel",void 0),(0,D._)([(0,R.Cb)({type:[Se.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ze.prototype,"labelingInfo",void 0),(0,D._)([(0,R.Cb)(be.iR)],ze.prototype,"labelsVisible",void 0),(0,D._)([(0,R.Cb)(be.C_)],ze.prototype,"popupEnabled",void 0),(0,D._)([(0,R.Cb)({type:de.Z,json:{name:"popupInfo",write:!0}})],ze.prototype,"popupTemplate",void 0),(0,D._)([(0,R.Cb)({type:[oe],json:{write:!0}})],ze.prototype,"fields",void 0),(0,D._)([(0,Ee.c)("fields")],ze.prototype,"writeFields",null),(0,D._)([(0,R.Cb)({types:pe.A,json:{write:{target:"drawingInfo.renderer"}}})],ze.prototype,"renderer",void 0),(0,D._)([(0,_e.r)("renderer",["drawingInfo.renderer"])],ze.prototype,"readRenderer",null),ze=ye=(0,D._)([(0,Q.j)("esri.layers.support.FeatureReductionBinning")],ze);const Ke=ze;var Ce,We=v(23841);const Be=(0,De.d)({types:he.QT});function je(mr){return"simple"===mr.type&&!mr.visualVariables?.length}let Re=Ce=class extends $.wq{constructor(mr){super(mr),this.type="cluster",this.clusterRadius=(0,We.t_)("80px"),this.clusterMinSize=(0,We.t_)("12px"),this.clusterMaxSize=(0,We.t_)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(mr,wt,or){const sr=wt.drawingInfo?.renderer;return sr?.authoringInfo?.isAutoGenerated?null:sr?je(sr)?null:(0,ue.a)(sr,wt,or)??void 0:wt.defaultSymbol?wt.types&&wt.types.length?new ce.Z({defaultSymbol:Be(wt.defaultSymbol,wt,or),field:wt.typeIdField,uniqueValueInfos:wt.types.map(rr=>({id:rr.id,symbol:Be(rr.symbol,rr,or)}))}):new J.Z({symbol:Be(wt.defaultSymbol,wt,or)}):null}readSymbol(mr,wt,or){const sr=wt.drawingInfo?.renderer;return sr?.authoringInfo?.isAutoGenerated?null:sr&&je(sr)?(0,ue.a)(sr,wt,or)?.symbol:null}writeSymbol(mr,wt,or,sr){const rr=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||rr){const Et=new J.Z({symbol:mr});wt.drawingInfo={renderer:Et.write({},sr)}}}writeFields(mr,wt,or){const sr=mr.filter(rr=>"avg_angle"!==rr.statisticType).map(rr=>rr.toJSON());(0,me.RB)(or,sr,wt)}readFields(mr,wt,or){return mr.filter(sr=>!sr.isAutoGenerated).map(sr=>oe.fromJSON(sr))}clone(){return new Ce({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,W.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,W.d9)(this.fields),renderer:(0,W.d9)(this.renderer),symbol:(0,W.d9)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,W.d9)(this.popupTemplate)})}};(0,D._)([(0,R.Cb)({type:["cluster"],readOnly:!0,json:{write:!0}})],Re.prototype,"type",void 0),(0,D._)([(0,R.Cb)({type:Number,cast:mr=>"auto"===mr?mr:(0,We.t_)(mr),json:{write:!0}})],Re.prototype,"clusterRadius",void 0),(0,D._)([(0,R.Cb)({type:Number,cast:We.t_,json:{write:!0}})],Re.prototype,"clusterMinSize",void 0),(0,D._)([(0,R.Cb)({type:Number,cast:We.t_,json:{write:!0}})],Re.prototype,"clusterMaxSize",void 0),(0,D._)([(0,R.Cb)(be.C_)],Re.prototype,"popupEnabled",void 0),(0,D._)([(0,R.Cb)({type:de.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Re.prototype,"popupTemplate",void 0),(0,D._)([(0,R.Cb)({types:pe.A,json:{write:{target:"drawingInfo.renderer"}}})],Re.prototype,"renderer",void 0),(0,D._)([(0,_e.r)("renderer",["drawingInfo.renderer"])],Re.prototype,"readRenderer",null),(0,D._)([(0,R.Cb)({types:he.AH})],Re.prototype,"symbol",void 0),(0,D._)([(0,_e.r)("symbol",["drawingInfo.renderer"])],Re.prototype,"readSymbol",null),(0,D._)([(0,Ee.c)("symbol")],Re.prototype,"writeSymbol",null),(0,D._)([(0,R.Cb)({type:[Se.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Re.prototype,"labelingInfo",void 0),(0,D._)([(0,R.Cb)(be.iR)],Re.prototype,"labelsVisible",void 0),(0,D._)([(0,R.Cb)({type:[oe],json:{write:!0}})],Re.prototype,"fields",void 0),(0,D._)([(0,Ee.c)("fields")],Re.prototype,"writeFields",null),(0,D._)([(0,_e.r)("fields")],Re.prototype,"readFields",null),Re=Ce=(0,D._)([(0,Q.j)("esri.layers.support.FeatureReductionCluster")],Re);const He=Re;var Ie=v(47058);const Ge={key:"type",base:le.B,typeMap:{cluster:He,binning:Ke}},Pe={types:{key:"type",base:le.B,typeMap:{selection:Ie.Z,cluster:He,binning:Ke}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Ge},"portal-item":{types:Ge},"web-scene":{types:{key:"type",base:le.B,typeMap:{selection:Ie.Z}}}}}};var qe,Le=v(26584),Me=v(8314),Ne=v(63290),Xe=v(62208),Ye=v(50011),Je=v(15312),rt=v(88115),et=(v(64902),v(86971));let ot=qe=class extends rt.Z{writeLevels(mr,wt,or){for(const sr in mr)return void(wt.stops=this.levels[sr])}clone(){return new qe({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,et.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,et.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(mr=>mr.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:(0,W.d9)(this.levels)})}};(0,D._)([(0,R.Cb)()],ot.prototype,"levels",void 0),(0,D._)([(0,Ee.c)("levels")],ot.prototype,"writeLevels",null),ot=qe=(0,D._)([(0,Q.j)("esri.views.2d.engine.LevelDependentSizeVariable")],ot);const ut=Ne.Z.getLogger("esri.views.2d.layers.support.clusterUtils");Me.Z.add("esri-cluster-arcade-enabled",!0);const _t=(0,Me.Z)("esri-cluster-arcade-enabled");function gr(mr,wt,or,sr){const rr=(0,Ye.F)(wt),Et="mode"===or?`cluster_type_${rr}`:"sum"===or?`cluster_sum_${rr}`:`cluster_avg_${rr}`;return mr.some(St=>St.name===Et)||mr.push(new oe({name:Et,isAutoGenerated:!0,onStatisticExpression:new X({expression:wt,returnType:sr}),statisticType:or})),Et}function ar(mr,wt,or,sr,rr){if("cluster_count"===wt||mr.some(St=>St.name===wt))return wt;const Et=function pr(mr,wt,or){switch(mr){case"sum":return`cluster_sum_${wt}`;case"avg":case"avg_angle":return`cluster_avg_${wt}`;case"mode":return`cluster_type_${wt}`;case"avg_norm":{const sr=or,rr="field",Et=wt.toLowerCase()+",norm:"+rr+","+sr.toLowerCase();return"cluster_avg_"+(0,Ye.F)(Et)}}}(or,wt,rr);return mr.some(St=>St.name===Et)||mr.push(new oe("avg_norm"===or?{name:Et,isAutoGenerated:!0,onStatisticExpression:new X({expression:`$feature.${wt} / $feature.${rr}`,returnType:sr}),statisticType:"avg"}:{name:Et,isAutoGenerated:!0,onStatisticField:wt,statisticType:or})),Et}const Fr=mr=>{let wt=class extends mr{constructor(...or){super(...or),this.own(this.watch("renderer",()=>{if(this.featureReduction){const sr=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",sr)}},!0))}set featureReduction(or){const sr=this._normalizeFeatureReduction(or);this._set("featureReduction",sr)}set renderer(or){}_normalizeFeatureReduction(or){if("cluster"!==or?.type)return or;const sr=or.clone(),rr=[new oe({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],Et=(sr.fields??[]).filter(Ft=>!Ft.isAutoGenerated);if(or.renderer&&!or.renderer.authoringInfo?.isAutoGenerated)return sr.fields=[...rr,...Et],sr;if(or.symbol)return sr.fields=[...rr,...Et],sr.renderer=null,sr;if(!this.renderer)return or;const St=((mr,wt,or,sr,rr)=>{const Et=this.renderer.clone();if(!(mr=>{const wt=or=>ut.error(new Le.Z("Unsupported-renderer",or,{renderer:mr}));switch(mr.type){case"unique-value":if(mr.field2||mr.field3)return wt("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(mr.normalizationField){const or=mr.normalizationType;if("field"!==or)return wt(`FeatureReductionCluster does not support a normalizationType of ${or}`),!1;break}case"simple":case"pie-chart":break;default:return wt(`FeatureReductionCluster does not support renderers of type ${mr.type}`),!1}if(!_t){if("valueExpression"in mr&&mr.valueExpression)return wt("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in mr&&mr.visualVariables||[]).some(or=>!(!("valueExpression"in or)||!or.valueExpression)))return wt("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0})(Et))return Et;if(Et.authoringInfo||(Et.authoringInfo=new Je.Z),Et.authoringInfo.isAutoGenerated=!0,"visualVariables"in Et){const St=(Et.visualVariables||[]).filter(zt=>"$view.scale"!==zt.valueExpression),Ft=(mr=>{for(const wt of mr)if("size"===wt.type)return wt;return null})(St);St.forEach(zt=>{"rotation"===zt.type?zt.field?zt.field=ar(mr,zt.field,"avg_angle","number"):zt.valueExpression&&(zt.field=gr(mr,zt.valueExpression,"avg_angle","number"),zt.valueExpression=null):zt.normalizationField?(zt.field=ar(mr,zt.field,"avg_norm","number",zt.normalizationField),zt.normalizationField=null):zt.field?zt.field=ar(mr,zt.field,"avg","number"):zt.valueExpression&&(zt.field=gr(mr,zt.valueExpression,"avg","number"),zt.valueExpression=null)}),(0,Xe.Wi)(Ft)&&(mr=>{for(const wt of mr)if("cluster_count"===wt.field)return!0})(St),Et.visualVariables=St}switch(Et.type){case"simple":break;case"pie-chart":for(const St of Et.attributes)St.field?St.field=ar(mr,St.field,"sum","number"):St.valueExpression&&(St.field=gr(mr,St.valueExpression,"sum","number"),St.valueExpression=null);break;case"unique-value":Et.field?Et.field=ar(mr,Et.field,"mode","string"):Et.valueExpression&&(Et.field=gr(mr,Et.valueExpression,"mode","string"),Et.valueExpression=null);break;case"class-breaks":Et.normalizationField?(Et.field=ar(mr,Et.field,"avg_norm","number",Et.normalizationField),Et.normalizationField=null):Et.field?Et.field=ar(mr,Et.field,"avg","number"):Et.valueExpression&&(Et.field=gr(mr,Et.valueExpression,"avg","number"),Et.valueExpression=null)}return Et})(rr);return sr.fields=[...rr,...Et],sr.renderer=St,sr}};return(0,D._)([(0,R.Cb)(Pe)],wt.prototype,"featureReduction",null),wt=(0,D._)([(0,Q.j)("esri.layers.mixins.FeatureReductionLayer")],wt),wt}},49286:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>oe});var D=v(17626),R=v(26584),G=v(21726),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(99433),H=v(29338),X=v(36054);const te={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};var ae=v(13812);const oe=de=>{let se=class extends de{constructor(){super(...arguments),this.title=null}writeListMode(re,j,Y,ee){(ee&&"ground"===ee.layerContainerType||re&&(0,X.d)(this,Y,{},ee))&&(j[Y]=re)}writeOperationalLayerType(re,j,Y,ee){!re||ee&&"tables"===ee.layerContainerType||(j.layerType=re)}writeTitle(re,j){j.title=re??"Layer"}read(re,j){j&&(j.layer=this),(0,H.$)(this,re,Y=>super.read(re,Y),j)}write(re,j){if(j?.origin){const ie=`${j.origin}/${j.layerContainerType||"operational-layers"}`,J=te[ie];let ce=J&&J[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===ie&&(ce=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===ie&&(ce=!1),!ce)return j.messages?.push(new R.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${ie}'`,{layer:this})),null}const Y=super.write(re,{...j,layer:this}),ee=!!j&&!!j.messages&&!!j.messages.filter(ie=>ie instanceof R.Z&&"web-document-write:property-required"===ie.name).length;return(0,G.jc)(Y?.url)?(j?.messages?.push(new R.Z("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&ee?null:Y}beforeSave(){}};return(0,D._)([(0,Z.Cb)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],se.prototype,"id",void 0),(0,D._)([(0,Z.Cb)(ae.rT)],se.prototype,"listMode",void 0),(0,D._)([(0,B.c)("listMode")],se.prototype,"writeListMode",null),(0,D._)([(0,Z.Cb)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],se.prototype,"operationalLayerType",void 0),(0,D._)([(0,B.c)("operationalLayerType")],se.prototype,"writeOperationalLayerType",null),(0,D._)([(0,Z.Cb)(ae.Oh)],se.prototype,"opacity",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],se.prototype,"title",void 0),(0,D._)([(0,B.c)("title"),(0,B.c)(["web-scene"],"title")],se.prototype,"writeTitle",null),(0,D._)([(0,Z.Cb)({type:Boolean,json:{name:"visibility"}})],se.prototype,"visible",void 0),se=(0,D._)([(0,W.j)("esri.layers.mixins.OperationalLayer")],se),se}},32629:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>de});var H,D=v(17626),R=v(94113),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(2076),B=v(86810);const X=new W.X({asc:"ascending",desc:"descending"});let te=H=class extends B.wq{constructor(se){super(se),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new H({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],te.prototype,"field",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],te.prototype,"valueExpression",void 0),(0,D._)([(0,G.Cb)({type:X.apiValues,json:{read:X.read,write:X.write}})],te.prototype,"order",void 0),te=H=(0,D._)([(0,$.j)("esri.layers.support.OrderByInfo")],te);const ae=te;function oe(se,re,j){if(!se)return null;const Y=se.find(ie=>!!ie.field);if(!Y)return null;const ee=new ae;return ee.read(Y,j),[ee]}function le(se,re,j,Y){const ee=se.find(ie=>!!ie.field);ee&&(0,R.RB)(j,[ee.toJSON()],re)}const de=se=>{let re=class extends se{constructor(){super(...arguments),this.orderBy=null}};return(0,D._)([(0,G.Cb)({type:[ae],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:oe},write:{target:"layerDefinition.orderBy",writer:le}}})],re.prototype,"orderBy",void 0),re=(0,D._)([(0,$.j)("esri.layers.mixins.OrderedLayer")],re),re}},6647:(nt,Ae,v)=>{"use strict";v.d(Ae,{I:()=>ee});var D=v(15861),R=v(17626),G=v(24263),Z=v(84792),Q=v(59213),$=v(26584),W=v(63290),B=v(62208),H=v(10699),X=v(21726),te=v(77712),le=(v(85931),v(90912),v(68653)),de=v(76898),se=v(99433),re=v(84687),j=v(55463),Y=v(94508);const ee=J=>{let ce=class extends J{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){this.portalItem=(0,B.SC)(this.portalItem)}set portalItem(ue){ue!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",ue))}readPortalItem(ue,pe,he){if(pe.itemId)return new j.default({id:pe.itemId,portal:he&&he.portal})}writePortalItem(ue,pe){ue&&ue.id&&(pe.itemId=ue.id)}loadFromPortal(ue,pe){var he=this;return(0,D.Z)(function*(){if(he.portalItem&&he.portalItem.id)try{const me=yield v.e(3705).then(v.bind(v,83705));return(0,H.k_)(pe),yield me.load({instance:he,supportedTypes:ue.supportedTypes,validateItem:ue.validateItem,supportsData:ue.supportsData,layerModuleTypeMap:ue.layerModuleTypeMap},pe)}catch(me){throw(0,H.D_)(me)||W.Z.getLogger(he.declaredClass).warn(`Failed to load layer (${he.title}, ${he.id}) portal item (${he.portalItem.id})\n  ${me}`),me}})()}finishLoadEditablePortalLayer(ue){var pe=this;return(0,D.Z)(function*(){pe._set("userHasEditingPrivileges",yield pe._fetchUserHasEditingPrivileges(ue).catch(he=>((0,H.r9)(he),!0)))})()}_fetchUserHasEditingPrivileges(ue){var pe=this;return(0,D.Z)(function*(){const he=pe.url?G.id?.findCredential(pe.url):null;if(!he)return!0;const me=ie.credential===he?ie.user:yield pe._fetchEditingUser(ue);return ie.credential=he,ie.user=me,(0,B.Wi)(me)||null==me.privileges||me.privileges.includes("features:user:edit")})()}_fetchEditingUser(ue){var pe=this;return(0,D.Z)(function*(){const he=pe.portalItem?.portal?.user;if(he)return he;const me=G.id.findServerInfo(pe.url??"");if(!me?.owningSystemUrl)return null;const ge=`${me.owningSystemUrl}/sharing/rest`,_e=re.Z.getDefault();if(_e&&_e.loaded&&(0,X.Fv)(_e.restUrl)===(0,X.Fv)(ge))return _e.user;const Ee=`${ge}/community/self`,De=(0,B.pC)(ue)?ue.signal:null,be=yield(0,Q.q6)((0,Z.default)(Ee,{authMode:"no-prompt",query:{f:"json"},signal:De}));return be.ok?Y.default.fromJSON(be.value.data):null})()}read(ue,pe){pe&&(pe.layer=this),super.read(ue,pe)}write(ue,pe){const he=pe&&pe.portal,me=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||re.Z.getDefault());return he&&me&&!(0,X.tm)(me.restUrl,he.restUrl)?(pe.messages&&pe.messages.push(new $.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(ue,{...pe,layer:this})}};return(0,R._)([(0,te.Cb)({type:j.default})],ce.prototype,"portalItem",null),(0,R._)([(0,le.r)("web-document","portalItem",["itemId"])],ce.prototype,"readPortalItem",null),(0,R._)([(0,se.c)("web-document","portalItem",{itemId:{type:String}})],ce.prototype,"writePortalItem",null),(0,R._)([(0,te.Cb)({clonable:!1})],ce.prototype,"resourceReferences",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],ce.prototype,"userHasEditingPrivileges",void 0),ce=(0,R._)([(0,de.j)("esri.layers.mixins.PortalLayer")],ce),ce},ie={credential:null,user:null}},30346:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>pe,d:()=>ue});var D=v(15861),R=v(17626),G=v(63290),Z=v(10699),Q=v(77712),B=(v(85931),v(90912),v(76898)),H=v(46160),oe=(v(8314),v(26584),v(30755),v(21352));const le=new H.Z,de=new WeakMap;function j(he){return null!=he&&"object"==typeof he&&"refreshInterval"in he&&"refresh"in he}function Y(he,me){return Number.isFinite(he)&&Number.isFinite(me)?me<=0?he:Y(me,he%me):0}let ee=0,ie=0;function J(){const he=Date.now();for(const me of le)me.refreshInterval&&he-(de.get(me)??0)+5>=6e4*me.refreshInterval&&(de.set(me,he),me.refresh(he))}function ue(he){return null!=he&&"object"==typeof he&&"refreshTimestamp"in he&&"refresh"in he}(0,oe.EH)(()=>{const he=Date.now();let me=0;for(const ge of le)me=Y(Math.round(6e4*ge.refreshInterval),me),ge.refreshInterval?de.get(ge)||de.set(ge,he):de.delete(ge);if(me!==ie){if(ie=me,clearInterval(ee),0===ie)return void(ee=0);ee=setInterval(J,ie)}});const pe=he=>{let me=class extends he{constructor(...ge){super(...ge),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,Z.Ds)(()=>this.hasDataChanged()),this.when().then(()=>{!function se(he){j(he)&&le.push(he)}(this)},()=>{})}destroy(){!function re(he){j(he)&&le.includes(he)&&le.remove(he)}(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(ge=Date.now()){(0,Z.R8)(this._debounceHasDataChanged()).then(_e=>{_e&&this._set("refreshTimestamp",ge),this.emit("refresh",{dataChanged:_e})},_e=>{G.Z.getLogger(this.declaredClass).error(_e),this.emit("refresh",{dataChanged:!1,error:_e})})}hasDataChanged(){return(0,D.Z)(function*(){return!0})()}};return(0,R._)([(0,Q.Cb)({type:Number,cast:ge=>ge>=.1?ge:ge<=0?0:.1,json:{write:!0}})],me.prototype,"refreshInterval",void 0),(0,R._)([(0,Q.Cb)({readOnly:!0})],me.prototype,"refreshTimestamp",void 0),(0,R._)([(0,Q.Cb)()],me.prototype,"refreshParameters",null),me=(0,R._)([(0,B.j)("esri.layers.mixins.RefreshableLayer")],me),me}},99555:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>$});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898));const $=B=>{let H=class extends B{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const X={minScale:this.minScale,maxScale:this.maxScale},te=this.parent;te&&"effectiveScaleRange"in te&&function W(B,H){B.minScale=B.minScale>0?H.minScale>0?Math.min(B.minScale,H.minScale):B.minScale:H.minScale,B.maxScale=B.maxScale>0?H.maxScale>0?Math.max(B.maxScale,H.maxScale):B.maxScale:H.maxScale}(X,te.effectiveScaleRange);const ae=this._get("effectiveScaleRange");return ae&&ae.minScale===X.minScale&&ae.maxScale===X.maxScale?ae:X}};return(0,D._)([(0,R.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],H.prototype,"minScale",void 0),(0,D._)([(0,R.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],H.prototype,"maxScale",void 0),(0,D._)([(0,R.Cb)({readOnly:!0})],H.prototype,"effectiveScaleRange",null),H=(0,D._)([(0,Q.j)("esri.layers.mixins.ScaleRangeLayer")],H),H}},97941:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>ae});var D=v(17626),R=v(97478),G=v(20849),Z=v(77712),W=(v(85931),v(90912),v(68653)),B=v(76898),H=v(36630),X=v(62708),te=v(58926);const ae=oe=>{let le=class extends oe{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(de,se){const re=se.timeInfo.exportOptions;if(!re)return null;const j=re.timeOffset,Y=te.v.fromJSON(re.timeOffsetUnits);return j&&Y?new G.Z({value:j,unit:Y}):null}set timeInfo(de){(0,H.UF)(de,this.fieldsIndex),this._set("timeInfo",de)}};return(0,D._)([(0,Z.Cb)({type:R.Z,json:{write:!1}})],le.prototype,"timeExtent",void 0),(0,D._)([(0,Z.Cb)({type:G.Z})],le.prototype,"timeOffset",void 0),(0,D._)([(0,W.r)("service","timeOffset",["timeInfo.exportOptions"])],le.prototype,"readOffset",null),(0,D._)([(0,Z.Cb)({value:null,type:X.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],le.prototype,"timeInfo",null),(0,D._)([(0,Z.Cb)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],le.prototype,"useViewTime",void 0),le=(0,D._)([(0,B.j)("esri.layers.mixins.TemporalLayer")],le),le}},86219:(nt,Ae,v)=>{"use strict";v.d(Ae,{u:()=>B});var W,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.wq{constructor(H){super(H),this.name=null,this.code=null}clone(){return new W({name:this.name,code:this.code})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"name",void 0),(0,D._)([(0,G.Cb)({type:[String,Number],json:{write:!0}})],B.prototype,"code",void 0),B=W=(0,D._)([(0,$.j)("esri.layers.support.CodedValue")],B)},26036:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(55342)),$=v(76898),W=v(86219),B=v(50028);let X=H=class extends B.Z{constructor(ae){super(ae),this.codedValues=null,this.type="coded-value"}getName(ae){let oe=null;if(this.codedValues){const le=String(ae);this.codedValues.some(de=>(String(de.code)===le&&(oe=de.name),!!oe))}return oe}clone(){return new H({codedValues:(0,R.d9)(this.codedValues),name:this.name})}};(0,D._)([(0,G.Cb)({type:[W.u],json:{write:!0}})],X.prototype,"codedValues",void 0),(0,D._)([(0,Q.J)({codedValue:"coded-value"})],X.prototype,"type",void 0),X=H=(0,D._)([(0,$.j)("esri.layers.support.CodedValueDomain")],X);const te=X},50028:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var D=v(17626),R=v(2076),G=v(86810),Z=v(77712),W=(v(85931),v(90912),v(55342)),B=v(76898);const H=new R.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let X=class extends G.wq{constructor(ae){super(ae),this.name=null,this.type=null}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],X.prototype,"name",void 0),(0,D._)([(0,W.J)(H)],X.prototype,"type",void 0),X=(0,D._)([(0,B.j)("esri.layers.support.Domain")],X);const te=X},13762:(nt,Ae,v)=>{"use strict";v.d(Ae,{G$:()=>oe,Tl:()=>ae}),v(29132),v(8314);var G=v(63290),Z=v(62208),Q=v(16730),$=v(65401),W=v(46367),B=v(72642);const H=G.Z.getLogger("esri.layers.support.ElevationSampler");class X{queryElevation(ie){return oe(ie.clone(),this)}on(){return Y}projectIfRequired(ie,J){return le(ie,J)}}class te extends X{constructor(ie,J,ce){super(),this.tile=ie,this.noDataValue=ce;const ue=ie.tile.extent;this.extent=(0,$.HH)(ue,J.spatialReference),this.extent.zmin=ie.zmin,this.extent.zmax=ie.zmax,this._aaExtent=ue;const pe=(0,Q.c9)(J.spatialReference),he=J.lodAt(ie.tile.level).resolution*pe;this.demResolution={min:he,max:he}}get spatialReference(){return this.extent.spatialReference}contains(ie){const J=this.projectIfRequired(ie,this.spatialReference);return!(0,Z.Wi)(J)&&this.containsAt(J.x,J.y)}containsAt(ie,J){return(0,$.jE)(this._aaExtent,ie,J)}elevationAt(ie,J){if(!this.containsAt(ie,J)){const ce=this.extent;return H.warn("#elevationAt()",`Point used to sample elevation (${ie}, ${J}) is outside of the sampler extent (${ce.xmin}, ${ce.ymin}, ${ce.xmax}, ${ce.ymax})`),this.noDataValue}return(0,Z.Pt)(this.tile.sample(ie,J),this.noDataValue)}}class ae extends X{constructor(ie,J,ce){let ue;super(),"number"==typeof J?(this.noDataValue=J,ue=null):(ue=J,this.noDataValue=ce),this.samplers=ue?ie.map(he=>new te(he,ue,this.noDataValue)):ie;const pe=this.samplers[0];if(pe){this.extent=pe.extent.clone();const{min:he,max:me}=pe.demResolution;this.demResolution={min:he,max:me};for(let ge=1;ge<this.samplers.length;ge++){const _e=this.samplers[ge];this.extent.union(_e.extent),this.demResolution.min=Math.min(this.demResolution.min,_e.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,_e.demResolution.max)}}else this.extent=(0,$.HH)((0,$.Ue)(),ue.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(ie,J){for(const ce of this.samplers)if(ce.containsAt(ie,J))return ce.elevationAt(ie,J);return H.warn("#elevationAt()",`Point used to sample elevation (${ie}, ${J}) is outside of the sampler`),this.noDataValue}}function oe(ee,ie){const J=le(ee,ie.spatialReference);if(!J)return null;switch(ee.type){case"point":!function de(ee,ie,J){ee.z=J.elevationAt(ie.x,ie.y)}(ee,J,ie);break;case"polyline":!function se(ee,ie,J){j.spatialReference=ie.spatialReference;const ce=ee.hasM&&!ee.hasZ;for(let ue=0;ue<ee.paths.length;ue++){const pe=ee.paths[ue],he=ie.paths[ue];for(let me=0;me<pe.length;me++){const ge=pe[me],_e=he[me];j.x=_e[0],j.y=_e[1],ce&&(ge[3]=ge[2]),ge[2]=J.elevationAt(j.x,j.y)}}ee.hasZ=!0}(ee,J,ie);break;case"multipoint":!function re(ee,ie,J){j.spatialReference=ie.spatialReference;const ce=ee.hasM&&!ee.hasZ;for(let ue=0;ue<ee.points.length;ue++){const pe=ee.points[ue],he=ie.points[ue];j.x=he[0],j.y=he[1],ce&&(pe[3]=pe[2]),pe[2]=J.elevationAt(j.x,j.y)}ee.hasZ=!0}(ee,J,ie)}return ee}function le(ee,ie){if((0,Z.Wi)(ee))return null;const J=ee.spatialReference;if(J.equals(ie))return ee;const ce=(0,W.iV)(ee,ie);return ce||H.error(`Cannot project geometry spatial reference (wkid:${J.wkid}) to elevation sampler spatial reference (wkid:${ie.wkid})`),ce}const j=new B.Z,Y={remove(){}}},80403:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>D});class D{constructor({values:G,width:Z,height:Q,noDataValue:$},W){this.pixelData=G,this.width=Z,this.height=Q,this.safeWidth=.99999999*(Z-1),this.noDataValue=$,this.dx=(Z-1)/(W[2]-W[0]),this.dy=(Z-1)/(W[3]-W[1]),this.x0=W[0],this.y1=W[3]}}},14772:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>le});var D=v(17626),R=v(14517),G=v(80542),Z=v(62208),Q=v(95737),$=v(77712),H=(v(85931),v(90912),v(76898)),X=v(13812),te=v(59990),ae=v(13410);const oe={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let le=class extends((0,G.p)(R.Z)){constructor(de){super(de),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const de=this.visibleSublayers.map(se=>{const re=(0,te.f)(this.floors,se);return se.toExportImageJSON(re)});return de.length?JSON.stringify(de):null}get hasDynamicLayers(){return this.layer&&(0,ae.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(de){this._get("layer")!==de&&(this._set("layer",de),this.handles.remove("layer"),de&&this.handles.add([de.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),de.on("sublayer-update",se=>this.notifyChange(oe[se.propertyName]))],"layer"))}get layers(){const de=this.visibleSublayers;return de?de.length?"show:"+de.map(se=>se.id).join(","):"show:-1":null}get layerDefs(){const de=!!this.floors?.length,se=this.visibleSublayers.filter(re=>null!=re.definitionExpression||de&&null!=re.floorInfo);return se.length?JSON.stringify(se.reduce((re,j)=>{const Y=(0,te.f)(this.floors,j),ee=(0,Q._)(Y,j.definitionExpression);return(0,Z.pC)(ee)&&(re[j.id]=ee),re},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const de=this.layer;return de&&(de.commitProperty("dpi"),de.commitProperty("imageFormat"),de.commitProperty("imageTransparency"),de.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const de=[];if(!this.layer)return de;const se=this.layer.sublayers,re=Y=>{const ee=this.scale;Y.visible&&(0===ee||(0===Y.minScale||ee<=Y.minScale)&&(0===Y.maxScale||ee>=Y.maxScale))&&(Y.sublayers?Y.sublayers.forEach(re):de.unshift(Y))};se&&se.forEach(re);const j=this._get("visibleSublayers");return!j||j.length!==de.length||j.some((Y,ee)=>de[ee]!==Y)?de:j}toJSON(){const de=this.layer;let se={dpi:de.dpi,format:de.imageFormat,transparent:de.imageTransparency,gdbVersion:de.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?se.dynamicLayers=this.dynamicLayers:se={...se,layers:this.layers,layerDefs:this.layerDefs},se}};(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"dynamicLayers",null),(0,D._)([(0,$.Cb)()],le.prototype,"floors",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"hasDynamicLayers",null),(0,D._)([(0,$.Cb)()],le.prototype,"layer",null),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"layers",null),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"layerDefs",null),(0,D._)([(0,$.Cb)({type:Number})],le.prototype,"scale",void 0),(0,D._)([(0,$.Cb)(X.qG)],le.prototype,"timeExtent",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"version",null),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"visibleSublayers",null),le=(0,D._)([(0,H.j)("esri.layers.mixins.ExportImageParameters")],le)},2319:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>re});var ae,D=v(17626),R=v(26584),G=v(86810),Z=v(62208),Q=v(94113),$=v(77712),H=(v(85931),v(90912),v(76898)),X=v(71149),te=v(98624);const oe={read:{reader:X.ij},write:{writer:X.cW,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},le={read:{reader:X.ij},write:{writer:X.cW,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},de={name:"showExcludedLabels",default:!0};let se=ae=class extends G.wq{constructor(j){super(j),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(j,Y){const ee=super.write(j,Y);if(Y?.origin){if(ee.filter){const ie=Object.keys(ee.filter);if(ie.length>1||"where"!==ie[0])return Y.messages?.push(new R.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:Y.layer,effect:this})),null}if("showExcludedLabels"in ee)return Y.messages?.push(new R.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:Y.layer,effect:this})),null}return ee}clone(){return new ae({filter:(0,Z.pC)(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,D._)([(0,$.Cb)({type:te.Z,json:{write:{allowNull:!0,writer(j,Y,ee,ie){const J=j?.write({},ie);J&&0!==Object.keys(J).length?(0,Q.RB)(ee,J,Y):(0,Q.RB)(ee,null,Y)}}}})],se.prototype,"filter",void 0),(0,D._)([(0,$.Cb)({json:{write:!0,origins:{"web-map":oe,"portal-item":oe}}})],se.prototype,"includedEffect",void 0),(0,D._)([(0,$.Cb)({json:{write:!0,origins:{"web-map":le,"portal-item":le}}})],se.prototype,"excludedEffect",void 0),(0,D._)([(0,$.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":de,"portal-item":de}}})],se.prototype,"excludedLabelsVisible",void 0),se=ae=(0,D._)([(0,H.j)("esri.layers.support.FeatureEffect")],se);const re=se},98624:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var ae,D=v(17626),R=v(29132),G=v(97478),Z=v(2076),Q=v(86810),$=v(58817),W=v(62208),B=v(77712),X=(v(90912),v(76898)),te=v(96854);const oe=new Z.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),le=new Z.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let de=ae=class extends Q.wq{constructor(re){super(re),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(re={}){const{where:j,geometry:Y,spatialRelationship:ee,timeExtent:ie,objectIds:J,units:ce,distance:ue}=this;return new te.Z({geometry:(0,$.d9)(Y),objectIds:(0,$.d9)(J),spatialRelationship:ee,timeExtent:(0,$.d9)(ie),where:j,units:ce,distance:ue,...re})}clone(){const{where:re,geometry:j,spatialRelationship:Y,timeExtent:ee,objectIds:ie,units:J,distance:ce}=this;return new ae({geometry:(0,$.d9)(j),objectIds:(0,$.d9)(ie),spatialRelationship:Y,timeExtent:(0,$.d9)(ee),where:re,units:J,distance:ce})}};(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],de.prototype,"where",void 0),(0,D._)([(0,B.Cb)({types:R.qM,json:{write:!0}})],de.prototype,"geometry",void 0),(0,D._)([(0,B.Cb)({type:oe.apiValues,json:{name:"spatialRel",read:{reader:oe.read},write:{allowNull:!1,writer:oe.write,overridePolicy(){return{enabled:(0,W.pC)(this.geometry)}}}}})],de.prototype,"spatialRelationship",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:{overridePolicy(re){return{enabled:null!=re&&null!=this.geometry}}}}})],de.prototype,"distance",void 0),(0,D._)([(0,B.Cb)({type:[Number],json:{write:!0}})],de.prototype,"objectIds",void 0),(0,D._)([(0,B.Cb)({type:le.apiValues,json:{read:le.read,write:{writer:le.write,overridePolicy(re){return{enabled:null!=re&&null!=this.geometry}}}}})],de.prototype,"units",void 0),(0,D._)([(0,B.Cb)({type:G.Z,json:{write:!0}})],de.prototype,"timeExtent",void 0),de=ae=(0,D._)([(0,X.j)("esri.layers.support.FeatureFilter")],de);const se=de},83989:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>W});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(){super(...arguments),this.type=null}};(0,D._)([(0,G.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.layers.support.FeatureReduction")],W)},47058:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(83989);let B=W=class extends $.B{constructor(X){super(X),this.type="selection"}clone(){return new W}};(0,D._)([(0,R.Cb)({type:["selection"]})],B.prototype,"type",void 0),B=W=(0,D._)([(0,Q.j)("esri.layers.support.FeatureReductionSelection")],B);const H=B},32777:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var D=v(17626),R=v(79608),G=v(2076),Z=v(86810),Q=v(77712),B=(v(85931),v(90912),v(76898));const H=new G.X({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let X=class extends((0,R.J)(Z.wq)){constructor(ae){super(ae),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,D._)([(0,Q.Cb)({json:{write:!0}})],X.prototype,"name",void 0),(0,D._)([(0,Q.Cb)({json:{write:!0}})],X.prototype,"description",void 0),(0,D._)([(0,Q.Cb)({json:{read:H.read,write:H.write}})],X.prototype,"drawingTool",void 0),(0,D._)([(0,Q.Cb)({json:{write:!0}})],X.prototype,"prototype",void 0),(0,D._)([(0,Q.Cb)({json:{write:!0}})],X.prototype,"thumbnail",void 0),X=(0,D._)([(0,B.j)("esri.layers.support.FeatureTemplate")],X);const te=X},41638:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var D=v(17626),R=v(79608),G=v(86810),Z=v(77712),W=(v(85931),v(90912),v(68653)),B=v(76898),H=v(99433),X=v(67945),te=v(32777);let ae=class extends((0,R.J)(G.wq)){constructor(le){super(le),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(le){const de={};for(const se of Object.keys(le))de[se]=(0,X.im)(le[se]);return de}writeDomains(le,de){const se={};for(const re of Object.keys(le))le[re]&&(se[re]=le[re]?.toJSON());de.domains=se}};(0,D._)([(0,Z.Cb)({json:{write:!0}})],ae.prototype,"id",void 0),(0,D._)([(0,Z.Cb)({json:{write:!0}})],ae.prototype,"name",void 0),(0,D._)([(0,Z.Cb)({json:{write:!0}})],ae.prototype,"domains",void 0),(0,D._)([(0,W.r)("domains")],ae.prototype,"readDomains",null),(0,D._)([(0,H.c)("domains")],ae.prototype,"writeDomains",null),(0,D._)([(0,Z.Cb)({type:[te.Z],json:{write:!0}})],ae.prototype,"templates",void 0),ae=(0,D._)([(0,B.j)("esri.layers.support.FeatureType")],ae);const oe=ae},36255:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var ae,D=v(17626),R=v(2076),G=v(86810),Z=v(77712),$=(v(85931),v(90912)),W=v(55342),B=v(68653),H=v(76898),X=v(67945),te=v(85);const oe=new R.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let le=ae=class extends G.wq{constructor(se){super(se),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(se,{description:re}){let j=null;try{j=re?JSON.parse(re):null}catch{}return j?.value??null}readValueType(se,{description:re}){let j=null;try{j=re?JSON.parse(re):null}catch{}return j?oe.fromJSON(j.fieldValueType):null}clone(){return new ae({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],le.prototype,"alias",void 0),(0,D._)([(0,Z.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],le.prototype,"defaultValue",void 0),(0,D._)([(0,Z.Cb)()],le.prototype,"description",void 0),(0,D._)([(0,B.r)("description")],le.prototype,"readDescription",null),(0,D._)([(0,Z.Cb)({types:X.V5,json:{read:{reader:X.im},write:!0}})],le.prototype,"domain",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"editable",void 0),(0,D._)([(0,Z.Cb)({type:$.z8,json:{write:!0}})],le.prototype,"length",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],le.prototype,"name",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"nullable",void 0),(0,D._)([(0,W.J)(te.v)],le.prototype,"type",void 0),(0,D._)([(0,Z.Cb)()],le.prototype,"valueType",void 0),(0,D._)([(0,B.r)("valueType",["description"])],le.prototype,"readValueType",null),(0,D._)([(0,Z.Cb)({type:Boolean,json:{read:!1}})],le.prototype,"visible",void 0),le=ae=(0,D._)([(0,H.j)("esri.layers.support.Field")],le);const de=le},60466:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Q});var D=v(36630);function G(B){return"oid"===B.type||"esriFieldTypeOID"===B.type}function Z(B){return"global-id"===B.type||"esriFieldTypeGlobalID"===B.type}class Q{constructor(H=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!H)return;this.fields=H;const X=[];for(const te of H){const ae=te&&te.name;if(ae){const oe=$(ae),le=W(ae);this._fieldsMap.set(ae,te),this._fieldsMap.set(oe,te),this._normalizedFieldsMap.set(le,te),X.push(oe),"date"===(B=te).type||"esriFieldTypeDate"===B.type?(this.dateFields.push(te),this._dateFieldsSet.add(te)):(0,D.H7)(te)&&(this._numericFieldsSet.add(te),this.numericFields.push(te)),G(te)||Z(te)||(te.editable=null==te.editable||!!te.editable,te.nullable=null==te.nullable||!!te.nullable)}}var B;X.sort(),this.uid=X.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const H of this.fields)G(H)||Z(H)||H.nullable||void 0!==(0,D.os)(H)||this._requiredFields.push(H)}return this._requiredFields}has(H){return null!=this.get(H)}get(H){if(!H)return;let X=this._fieldsMap.get(H);return X||(X=this._fieldsMap.get($(H))??this._normalizedFieldsMap.get(W(H)),X&&this._fieldsMap.set(H,X),X)}isDateField(H){return this._dateFieldsSet.has(this.get(H))}isNumericField(H){return this._numericFieldsSet.has(this.get(H))}normalizeFieldName(H){const X=this.get(H);if(X)return X.name??void 0}}function $(B){return B.trim().toLowerCase()}function W(B){return(0,D.q6)(B).toLowerCase()}},90336:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),W=(v(63290),v(90912),v(85931),v(26584),v(8314),v(55342)),B=v(76898),H=v(50028);let te=X=class extends H.Z{constructor(oe){super(oe),this.type="inherited"}clone(){return new X}};(0,D._)([(0,W.J)({inherited:"inherited"})],te.prototype,"type",void 0),te=X=(0,D._)([(0,B.j)("esri.layers.support.InheritedDomain")],te);const ae=te},72258:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(86810),G=v(77712),Q=(v(85931),v(90912)),$=v(76898);let B=W=class extends R.wq{constructor(X){super(X),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new W({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,D._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"cols",void 0),(0,D._)([(0,G.Cb)({type:Q.z8,json:{write:!0}})],B.prototype,"level",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"levelValue",void 0),(0,D._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"origin",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],B.prototype,"resolution",void 0),(0,D._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"rows",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],B.prototype,"scale",void 0),B=W=(0,D._)([(0,$.j)("esri.layers.support.LOD")],B);const H=B},170:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>he});var le,D=v(17626),R=v(20383),G=v(2076),Z=v(86810),Q=v(58817),$=v(23841),W=v(77712),H=(v(90912),v(68653)),X=v(76898),te=v(99433),oe=(v(85931),v(86793));let de=le=class extends Z.wq{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(me,ge){return ge.value?(0,oe.dI)(ge.value):me}writeExpression(me,ge,_e){null!=this.value&&(me=(0,oe.dI)(this.value)),null!=me&&(ge[_e]=me)}clone(){return new le({expression:this.expression,title:this.title,value:this.value})}};(0,D._)([(0,W.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],de.prototype,"expression",void 0),(0,D._)([(0,H.r)("expression",["expression","value"])],de.prototype,"readExpression",null),(0,D._)([(0,te.c)("expression")],de.prototype,"writeExpression",null),(0,D._)([(0,W.Cb)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],de.prototype,"title",void 0),(0,D._)([(0,W.Cb)({json:{read:!1,write:!1}})],de.prototype,"value",void 0),de=le=(0,D._)([(0,X.j)("esri.layers.support.LabelExpressionInfo")],de);const se=de;var Y,re=v(8080),j=v(9461);const ee=new G.X({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function ie(me){return!me||"service"!==me.origin&&"map-image"!==me.layer?.type}function ce(me){return!!function J(me){return"map-image"===me?.type}(me)&&!!me.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let pe=Y=class extends Z.wq{constructor(me){super(me),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=re.Rz,this.useCodedValues=void 0,this.where=null}static evaluateWhere(me,ge){const _e=(Ee,De,be)=>{switch(De){case"=":return Ee==be;case"<>":return Ee!=be;case">":return Ee>be;case">=":return Ee>=be;case"<":return Ee<be;case"<=":return Ee<=be}return!1};try{if(null==me)return!0;const Ee=me.split(" ");if(3===Ee.length)return _e(ge[Ee[0]],Ee[1],Ee[2]);if(7===Ee.length){const De=_e(ge[Ee[0]],Ee[1],Ee[2]),be=Ee[3],Se=_e(ge[Ee[4]],Ee[5],Ee[6]);switch(be){case"AND":return De&&Se;case"OR":return De||Se}}return!1}catch{console.log("Error.: can't parse = "+me)}}readLabelExpression(me,ge){const _e=ge.labelExpressionInfo;if(!_e||!_e.value&&!_e.expression)return me}writeLabelExpression(me,ge,_e){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)me=(0,oe.z7)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const Ee=(0,oe.el)(this.labelExpressionInfo.expression);Ee&&(me="["+Ee+"]")}null!=me&&(ge[_e]=me)}writeLabelExpressionInfo(me,ge,_e,Ee){if(null==me&&null!=this.labelExpression&&ie(Ee))me=new se({expression:this.getLabelExpressionArcade()});else if(!me)return;const De=me.toJSON(Ee);De.expression&&(ge[_e]=De)}writeMaxScale(me,ge){(me||this.minScale)&&(ge.maxScale=me)}writeMinScale(me,ge){(me||this.maxScale)&&(ge.minScale=me)}getLabelExpression(){return(0,oe.hV)(this)}getLabelExpressionArcade(){return(0,oe.YI)(this)}getLabelExpressionSingleField(){return(0,oe.UO)(this)}hash(){return JSON.stringify(this)}clone(){return new Y({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,Q.d9)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,Q.d9)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,D._)([(0,W.Cb)({type:String,json:{write:!0}})],pe.prototype,"name",void 0),(0,D._)([(0,W.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],pe.prototype,"allowOverrun",void 0),(0,D._)([(0,W.Cb)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],pe.prototype,"deconflictionStrategy",void 0),(0,D._)([(0,W.Cb)({type:String,json:{write:{overridePolicy(me,ge,_e){return this.labelExpressionInfo&&"service"===_e?.origin&&ce(_e.layer)?{enabled:!1}:{allowNull:!0}}}}})],pe.prototype,"labelExpression",void 0),(0,D._)([(0,H.r)("labelExpression")],pe.prototype,"readLabelExpression",null),(0,D._)([(0,te.c)("labelExpression")],pe.prototype,"writeLabelExpression",null),(0,D._)([(0,W.Cb)({type:se,json:{write:{overridePolicy:(me,ge,_e)=>function ue(me){return ie(me)||ce(me.layer)}(_e)?{allowNull:!0}:{enabled:!1}}}})],pe.prototype,"labelExpressionInfo",void 0),(0,D._)([(0,te.c)("labelExpressionInfo")],pe.prototype,"writeLabelExpressionInfo",null),(0,D._)([(0,W.Cb)({type:ee.apiValues,json:{type:ee.jsonValues,read:ee.read,write:ee.write}})],pe.prototype,"labelPlacement",void 0),(0,D._)([(0,W.Cb)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],pe.prototype,"labelPosition",void 0),(0,D._)([(0,W.Cb)({type:Number})],pe.prototype,"maxScale",void 0),(0,D._)([(0,te.c)("maxScale")],pe.prototype,"writeMaxScale",null),(0,D._)([(0,W.Cb)({type:Number})],pe.prototype,"minScale",void 0),(0,D._)([(0,te.c)("minScale")],pe.prototype,"writeMinScale",null),(0,D._)([(0,W.Cb)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],pe.prototype,"repeatLabel",void 0),(0,D._)([(0,W.Cb)({type:Number,cast:$.t_,json:{write:!0,origins:{"web-scene":{write:!1}}}})],pe.prototype,"repeatLabelDistance",void 0),(0,D._)([(0,W.Cb)({types:R.yK,json:{origins:{"web-scene":{types:R.S6,write:j.vX,default:null}},write:j.vX,default:null}})],pe.prototype,"symbol",void 0),(0,D._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],pe.prototype,"useCodedValues",void 0),(0,D._)([(0,W.Cb)({type:String,json:{write:!0}})],pe.prototype,"where",void 0),pe=Y=(0,D._)([(0,X.j)("esri.layers.support.LabelClass")],pe);const he=pe},2430:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(46160),G=v(86810),Z=v(77712),W=(v(85931),v(90912),v(76898));let H=B=class extends G.wq{constructor(te){super(te),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new R.Z}clone(){return new B({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],H.prototype,"floorField",void 0),(0,D._)([(0,Z.Cb)({json:{read:!1,write:!1}})],H.prototype,"viewAllMode",void 0),(0,D._)([(0,Z.Cb)({json:{read:!1,write:!1}})],H.prototype,"viewAllLevelIds",void 0),H=B=(0,D._)([(0,W.j)("esri.layers.support.LayerFloorInfo")],H);const X=H},36596:(nt,Ae,v)=>{"use strict";v.d(Ae,{w:()=>Q});var D=v(62208),R=v(42930);class G extends R.q{constructor(W=null){super("LercWorker","_decode",{_decode:B=>[B.buffer]},W,{strategy:"dedicated"}),this.schedule=W,this.ref=0}decode(W,B,H){return W&&0!==W.byteLength?this.invoke({buffer:W,options:B},H):Promise.resolve(null)}release(){--this.ref<=0&&(Z.forEach((W,B)=>{W===this&&Z.delete(B)}),this.destroy())}}const Z=new Map;function Q($=null){let W=Z.get((0,D.Wg)($));return W||((0,D.pC)($)?(W=new G(B=>$.schedule(B)),Z.set($,W)):(W=new G,Z.set(null,W))),++W.ref,W}},41291:(nt,Ae,v)=>{"use strict";v.d(Ae,{b:()=>G});var D=v(10699),R=v(84395);class G{constructor(){this._tasks=new Array,this._running=new R.f(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask($){for(;!$.done&&this._process($);)$.madeProgress()}push($,W,B){return this._running.set(!0),new Promise((H,X)=>this._tasks.push(new Z(H,X,$,W,B)))}unshift($,W,B){return this._running.set(!0),new Promise((H,X)=>this._tasks.unshift(new Z(H,X,$,W,B)))}_process($){if(0===this._tasks.length)return!1;const W=this._tasks.shift();try{const B=(0,D.Hc)(W.signal);if(B&&!W.abortCallback)W.reject((0,D.zE)());else{const H=B?W.abortCallback?.((0,D.zE)()):W.callback($);(0,D.y8)(H)?H.then(W.resolve,W.reject):W.resolve(H)}}catch(B){W.reject(B)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const $=(0,D.zE)();for(const W of this._tasks)if(W.abortCallback){const B=W.abortCallback($);W.resolve(B)}else W.reject($);this._tasks.length=0,this._running.set(!1)}}class Z{constructor($,W,B,H,X){this.resolve=$,this.reject=W,this.callback=B,this.signal=H,this.abortCallback=X}}},68155:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(55342)),$=v(76898),W=v(50028);let H=B=class extends W.Z{constructor(te){super(te),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new B({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,D._)([(0,R.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(te,ae)=>ae.range&&ae.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(te,ae,oe){ae[oe]=[this.minValue||0,te]}}}})],H.prototype,"maxValue",void 0),(0,D._)([(0,R.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(te,ae)=>ae.range&&ae.range[0]},write:{target:"range",writer(te,ae,oe){ae[oe]=[te,this.maxValue||0]}}}})],H.prototype,"minValue",void 0),(0,D._)([(0,Q.J)({range:"range"})],H.prototype,"type",void 0),H=B=(0,D._)([(0,$.j)("esri.layers.support.RangeDomain")],H);const X=H},2584:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>J});var Y,D=v(17626),R=v(2076),G=v(86810),Z=v(62208),Q=v(16730),$=v(77712),B=(v(85931),v(90912)),H=v(68653),X=v(76898),te=v(99433),ae=v(72642),oe=v(65234),le=v(65401),de=v(37053),se=v(46367),re=v(72258),j=v(68511);const ee=new R.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ie=Y=class extends G.wq{constructor(ce){super(ce),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(ce={}){const{resolutionFactor:ue=1,scales:pe,size:he=256,spatialReference:me=oe.Z.WebMercator,numLODs:ge=24}=ce;if(!(0,de.JY)(me)){const ye=[];if(pe)for(let ve=0;ve<pe.length;ve++){const xe=pe[ve];ye.push({level:ve,scale:xe,resolution:xe})}else{let ve=5e-4;for(let xe=ge-1;xe>=0;xe--)ye.unshift({level:xe,scale:ve,resolution:ve}),ve*=2}return new Y({dpi:96,lods:ye,origin:new ae.Z(0,0,me),size:[he,he],spatialReference:me})}const _e=(0,de.C5)(me),Ee=new ae.Z(ce.origin?{x:ce.origin.x,y:ce.origin.y,spatialReference:me}:_e?{x:_e.origin[0],y:_e.origin[1],spatialReference:me}:{x:0,y:0,spatialReference:me}),be=1/(39.37*(0,Q.c9)(me)*96),Se=[];if(pe)for(let ye=0;ye<pe.length;ye++){const ve=pe[ye];Se.push({level:ye,scale:ve,resolution:ve*be})}else{let ye=(0,de.sT)(me)?512/he*591657527.5917094:256/he*591657527.591555;const ve=Math.ceil(ge/ue);Se.push({level:0,scale:ye,resolution:ye*be});for(let xe=1;xe<ve;xe++){const ze=ye/2**ue;Se.push({level:xe,scale:ze,resolution:ze*be}),ye=ze}}return new Y({dpi:96,lods:Se,origin:Ee,size:[he,he],spatialReference:me})}get isWrappable(){const{spatialReference:ce,origin:ue}=this;if(ce&&ue){const pe=(0,de.C5)(ce);return ce.isWrappable&&!!pe&&Math.abs(pe.origin[0]-ue.x)<=pe.dx}return!1}readOrigin(ce,ue){return ae.Z.fromJSON({spatialReference:ue.spatialReference,...ce})}set lods(ce){let ue=0,pe=0;const he=[],me=this._levelToLOD={};ce&&(ue=-1/0,pe=1/0,ce.forEach(ge=>{he.push(ge.scale),ue=ge.scale>ue?ge.scale:ue,pe=ge.scale<pe?ge.scale:pe,me[ge.level]=ge})),this._set("scales",he),this._set("minScale",ue),this._set("maxScale",pe),this._set("lods",ce),this._initializeUpsampleLevels()}readSize(ce,ue){return[ue.cols,ue.rows]}writeSize(ce,ue){ue.cols=ce[0],ue.rows=ce[1]}zoomToScale(ce){const ue=this.scales;if(ce<=0)return ue[0];if(ce>=ue.length-1)return ue[ue.length-1];const pe=Math.floor(ce);return ue[pe]/(ue[pe]/ue[pe+1])**(ce-pe)}scaleToZoom(ce){const ue=this.scales,pe=ue.length-1;let he=0;for(;he<pe;he++){const me=ue[he],ge=ue[he+1];if(me<=ce)return he;if(ge===ce)return he+1;if(me>ce&&ge<ce)return he+Math.log(me/ce)/Math.log(me/ge)}return he}snapScale(ce,ue=.95){const pe=this.scaleToZoom(ce);return pe%Math.floor(pe)>=ue?this.zoomToScale(Math.ceil(pe)):this.zoomToScale(Math.floor(pe))}tileAt(ce,ue,pe,he){const me=this.lodAt(ce);if(!me)return null;let ge,_e;if("number"==typeof ue)ge=ue,_e=pe;else if((0,de.fS)(ue.spatialReference,this.spatialReference))ge=ue.x,_e=ue.y,he=pe;else{const be=(0,se.iV)(ue,this.spatialReference);if((0,Z.Wi)(be))return null;ge=be.x,_e=be.y,he=pe}const Ee=me.resolution*this.size[0],De=me.resolution*this.size[1];return he||(he=new j.f(null,0,0,0,(0,le.Ue)())),he.level=ce,he.row=Math.floor((this.origin.y-_e)/De+.001),he.col=Math.floor((ge-this.origin.x)/Ee+.001),this.updateTileInfo(he),he}updateTileInfo(ce,ue=Y.ExtrapolateOptions.NONE){let pe=this.lodAt(ce.level);if(!pe&&ue===Y.ExtrapolateOptions.POWER_OF_TWO){const _e=this.lods[this.lods.length-1];_e.level<ce.level&&(pe=_e)}if(!pe)return;const he=ce.level-pe.level,me=pe.resolution*this.size[0]/2**he,ge=pe.resolution*this.size[1]/2**he;ce.id=`${ce.level}/${ce.row}/${ce.col}`,ce.extent||(ce.extent=(0,le.Ue)()),ce.extent[0]=this.origin.x+ce.col*me,ce.extent[1]=this.origin.y-(ce.row+1)*ge,ce.extent[2]=ce.extent[0]+me,ce.extent[3]=ce.extent[1]+ge}upsampleTile(ce){const ue=this._upsampleLevels[ce.level];return!(!ue||-1===ue.parentLevel||(ce.level=ue.parentLevel,ce.row=Math.floor(ce.row/ue.factor+.001),ce.col=Math.floor(ce.col/ue.factor+.001),this.updateTileInfo(ce),0))}getTileBounds(ce,ue){const pe=this.lodAt(ue.level);if(null==pe)return null;const{resolution:he}=pe,me=he*this.size[0],ge=he*this.size[1];return ce[0]=this.origin.x+ue.col*me,ce[1]=this.origin.y-(ue.row+1)*ge,ce[2]=ce[0]+me,ce[3]=ce[1]+ge,ce}lodAt(ce){return this._levelToLOD?.[ce]??null}clone(){return Y.fromJSON(this.write({}))}getOrCreateCompatible(ce,ue){if(256===this.size[0]&&256===this.size[1])return 256===ce?this:null;const pe=[],he=this.lods.length;for(let me=0;me<he;me++){const ge=this.lods[me];pe.push(new re.Z({level:ge.level,scale:ge.scale,resolution:ge.resolution*ue}))}return new Y({size:[ce,ce],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:pe})}_initializeUpsampleLevels(){const ce=this.lods;this._upsampleLevels=[];let ue=null;for(let pe=0;pe<ce.length;pe++){const he=ce[pe];this._upsampleLevels[he.level]={parentLevel:ue?ue.level:-1,factor:ue?ue.resolution/he.resolution:0},ue=he}}};var ce,ue;(0,D._)([(0,$.Cb)({type:Number,json:{write:!0}})],ie.prototype,"compressionQuality",void 0),(0,D._)([(0,$.Cb)({type:Number,json:{write:!0}})],ie.prototype,"dpi",void 0),(0,D._)([(0,$.Cb)({type:String,json:{read:ee.read,write:ee.write,origins:{"web-scene":{read:!1,write:!1}}}})],ie.prototype,"format",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],ie.prototype,"isWrappable",null),(0,D._)([(0,$.Cb)({type:ae.Z,json:{write:!0}})],ie.prototype,"origin",void 0),(0,D._)([(0,H.r)("origin")],ie.prototype,"readOrigin",null),(0,D._)([(0,$.Cb)({type:[re.Z],value:null,json:{write:!0}})],ie.prototype,"lods",null),(0,D._)([(0,$.Cb)({readOnly:!0})],ie.prototype,"minScale",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],ie.prototype,"maxScale",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],ie.prototype,"scales",void 0),(0,D._)([(0,$.Cb)({cast:ce=>Array.isArray(ce)?ce:"number"==typeof ce?[ce,ce]:[256,256]})],ie.prototype,"size",void 0),(0,D._)([(0,H.r)("size",["rows","cols"])],ie.prototype,"readSize",null),(0,D._)([(0,te.c)("size",{cols:{type:B.z8},rows:{type:B.z8}})],ie.prototype,"writeSize",null),(0,D._)([(0,$.Cb)({type:oe.Z,json:{write:!0}})],ie.prototype,"spatialReference",void 0),ie=Y=(0,D._)([(0,X.j)("esri.layers.support.TileInfo")],ie),(ue=(ce=ie||(ie={})).ExtrapolateOptions||(ce.ExtrapolateOptions={}))[ue.NONE=0]="NONE",ue[ue.POWER_OF_TWO=1]="POWER_OF_TWO";const J=ie},68511:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>D});class D{constructor(G,Z,Q,$,W){this.id=G,this.level=Z,this.row=Q,this.col=$,this.extent=W}}},62708:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Y});var oe,D=v(17626),R=v(97478),G=v(20849),Z=v(86810),Q=v(58817),$=v(62208),W=v(77712),H=(v(90912),v(68653)),X=v(76898),te=v(99433);v(85931);let le=oe=class extends Z.wq{constructor(ee){super(ee),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(ee,ie){return void 0!==ie.respectsDaylightSaving?ie.respectsDaylightSaving:void 0!==ie.respectDaylightSaving&&ie.respectDaylightSaving}clone(){const{respectsDaylightSaving:ee,timezone:ie}=this;return new oe({respectsDaylightSaving:ee,timezone:ie})}};(0,D._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"respectsDaylightSaving",void 0),(0,D._)([(0,H.r)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],le.prototype,"readRespectsDaylightSaving",null),(0,D._)([(0,W.Cb)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],le.prototype,"timezone",void 0),le=oe=(0,D._)([(0,X.j)("esri.layers.support.TimeReference")],le);const de=le;var re,se=v(58926);let j=re=class extends Z.wq{constructor(ee){super(ee),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(ee,ie){if(!ie.timeExtent||!Array.isArray(ie.timeExtent)||2!==ie.timeExtent.length)return null;const J=new Date(ie.timeExtent[0]),ce=new Date(ie.timeExtent[1]);return new R.Z({start:J,end:ce})}writeFullTimeExtent(ee,ie){ie.timeExtent=ee&&(0,$.pC)(ee.start)&&(0,$.pC)(ee.end)?[ee.start.getTime(),ee.end.getTime()]:null}readInterval(ee,ie){return ie.timeInterval&&ie.timeIntervalUnits?new G.Z({value:ie.timeInterval,unit:se.v.fromJSON(ie.timeIntervalUnits)}):ie.defaultTimeInterval&&ie.defaultTimeIntervalUnits?new G.Z({value:ie.defaultTimeInterval,unit:se.v.fromJSON(ie.defaultTimeIntervalUnits)}):null}writeInterval(ee,ie){if(ee){const J=ee.toJSON();ie.timeInterval=J.value,ie.timeIntervalUnits=J.unit}else ie.timeInterval=null,ie.timeIntervalUnits=null}clone(){const{cumulative:ee,endField:ie,hasLiveData:J,interval:ce,startField:ue,timeReference:pe,fullTimeExtent:he,trackIdField:me,useTime:ge}=this;return new re({cumulative:ee,endField:ie,hasLiveData:J,interval:ce,startField:ue,timeReference:(0,Q.d9)(pe),fullTimeExtent:(0,Q.d9)(he),trackIdField:me,useTime:ge})}};(0,D._)([(0,W.Cb)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],j.prototype,"cumulative",void 0),(0,D._)([(0,W.Cb)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],j.prototype,"endField",void 0),(0,D._)([(0,W.Cb)({type:R.Z,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"fullTimeExtent",void 0),(0,D._)([(0,H.r)("fullTimeExtent",["timeExtent"])],j.prototype,"readFullTimeExtent",null),(0,D._)([(0,te.c)("fullTimeExtent")],j.prototype,"writeFullTimeExtent",null),(0,D._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"hasLiveData",void 0),(0,D._)([(0,W.Cb)({type:G.Z,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"interval",void 0),(0,D._)([(0,H.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],j.prototype,"readInterval",null),(0,D._)([(0,te.c)("interval")],j.prototype,"writeInterval",null),(0,D._)([(0,W.Cb)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],j.prototype,"startField",void 0),(0,D._)([(0,W.Cb)({type:de,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"timeReference",void 0),(0,D._)([(0,W.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"trackIdField",void 0),(0,D._)([(0,W.Cb)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],j.prototype,"useTime",void 0),j=re=(0,D._)([(0,X.j)("esri.layers.support.TimeInfo")],j);const Y=j},38305:(nt,Ae,v)=>{"use strict";v.d(Ae,{B5:()=>H,DR:()=>te,G:()=>Y,M8:()=>le,Nm:()=>se,Qc:()=>X,XG:()=>re,a7:()=>oe,ld:()=>ae,wH:()=>j});var D=v(62208),R=v(21726),G=v(29840);const Z={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Q=Object.values(Z),$=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Q.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),W=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Q.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),B=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function H(J){return!!$.test(J)}function X(J){if((0,D.Wi)(J))return null;const ce=(0,R.mN)(J),ue=ce.path.match($)||ce.path.match(W);if(!ue)return null;const[,pe,he,me,ge]=ue,_e=he.indexOf("/");return{title:ae(-1!==_e?he.slice(_e+1):he),serverType:Z[me.toLowerCase()],sublayer:null!=ge&&""!==ge?parseInt(ge,10):null,url:{path:pe}}}function te(J){const ce=(0,R.mN)(J).path.match(B);return ce?{serviceUrl:ce[1],sublayerId:Number(ce[2])}:null}function ae(J){return(J=J.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+J.slice(1)}function oe(J,ce){const ue=[];if(J){const pe=X(J);(0,D.pC)(pe)&&pe.title&&ue.push(pe.title)}if(ce){const pe=ae(ce);ue.push(pe)}if(2===ue.length){if(ue[0].toLowerCase().includes(ue[1].toLowerCase()))return ue[0];if(ue[1].toLowerCase().includes(ue[0].toLowerCase()))return ue[1]}return ue.join(" - ")}function le(J){if(!J)return!1;const me=(J=J.toLowerCase()).includes(".arcgis.com/"),ge=J.includes("//services")||J.includes("//tiles")||J.includes("//features");return me&&ge}function se(J,ce){return J&&(0,R.Qj)((0,R.Hu)(J,ce))}function re(J){let{url:ce}=J;if(!ce)return{url:ce};ce=(0,R.Hu)(ce,J.logger);const ue=(0,R.mN)(ce),pe=X(ue.path);let he;if((0,D.pC)(pe))null!=pe.sublayer&&null==J.layer.layerId&&(he=pe.sublayer),ce=pe.url.path;else if(J.nonStandardUrlAllowed){const me=te(ue.path);(0,D.pC)(me)&&(ce=me.serviceUrl,he=me.sublayerId)}return{url:(0,R.Qj)(ce),layerId:he}}function j(J,ce,ue,pe,he){(0,G.w)(ce,pe,"url",he),pe.url&&null!=J.layerId&&(pe.url=(0,R.v_)(pe.url,ue,J.layerId.toString()))}function Y(J){if(!J)return!1;const ce=J.toLowerCase(),ue=ce.includes("/services/"),pe=ce.includes("/mapserver/wmsserver"),he=ce.includes("/imageserver/wmsserver"),me=ce.includes("/wmsserver");return ue&&(pe||he||me)}},13812:(nt,Ae,v)=>{"use strict";v.d(Ae,{qG:()=>ue,PV:()=>ee,id:()=>he,iR:()=>re,rn:()=>Y,rT:()=>_e,u1:()=>ge,rO:()=>me,Oh:()=>J,bT:()=>ce,C_:()=>se,Lx:()=>ie,vg:()=>pe,YI:()=>de,HQ:()=>j});var D=v(97478),R=v(2004),G=v(65234),Z=v(29840),Q=v(62208),W=(v(10699),v(28170)),oe=v(82706),le=v(92236);const de={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},se={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(Ee,De)=>!De.disablePopup},write:{enabled:!0,writer(Ee,De,be){De[be]=!Ee}}}},re={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},j={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Z.w}}},Y={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},ee={value:null,type:oe.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function ie(Ee){return{type:Ee,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const J={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},ce={...J,json:{...J.json,origins:{"web-document":{...J.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(Ee,De,be)=>be&&"service"!==be.origin||!De.drawingInfo||void 0===De.drawingInfo.transparency?De.layerDefinition&&De.layerDefinition.drawingInfo&&void 0!==De.layerDefinition.drawingInfo.transparency?(0,le.b)(De.layerDefinition.drawingInfo.transparency):void 0:(0,le.b)(De.drawingInfo.transparency)}}},ue={type:D.Z,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:Ee,timeOffset:De,useViewTime:be}=this.layer,Se=this.view?.timeExtent;let ye=this.layer.timeExtent;Ee&&(ye=function ae(Ee){if(!Ee)return Ee;const{start:De,end:be}=Ee;return new D.Z({start:(0,Q.pC)(De)?(0,W.Nm)(De,De.getTimezoneOffset(),"minutes"):De,end:(0,Q.pC)(be)?(0,W.Nm)(be,be.getTimezoneOffset(),"minutes"):be})}(ye));let ve=be?Se&&ye?Se.intersection(ye):Se||ye:ye;if(!ve||ve.isEmpty||ve.isAllTime)return ve;De&&(ve=ve.offset(-De.value,De.unit)),Ee&&(ve=function te(Ee){if(!Ee)return Ee;const{start:De,end:be}=Ee;return new D.Z({start:(0,Q.pC)(De)?(0,W.Nm)(De,-De.getTimezoneOffset(),"minutes"):De,end:(0,Q.pC)(be)?(0,W.Nm)(be,-be.getTimezoneOffset(),"minutes"):be})}(ve));const xe=this._get("timeExtent");return ve.equals(xe)?xe:ve}},pe={type:R.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(Ee,De)=>{const be=R.Z.fromJSON(Ee);return null!=De.spatialReference&&"object"==typeof De.spatialReference&&(be.spatialReference=G.Z.fromJSON(De.spatialReference)),be}}}},read:!1}},he={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},me={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},ge={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},_e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},67945:(nt,Ae,v)=>{"use strict";v.d(Ae,{V5:()=>$,im:()=>W}),v(8314);var R=v(26036),G=v(50028),Z=v(90336),Q=v(68155);const $={key:"type",base:G.Z,typeMap:{range:Q.Z,"coded-value":R.Z,inherited:Z.Z}};function W(B){if(!B||!B.type)return null;switch(B.type){case"range":return Q.Z.fromJSON(B);case"codedValue":return R.Z.fromJSON(B);case"inherited":return Z.Z.fromJSON(B)}return null}},26331:(nt,Ae,v)=>{"use strict";v.d(Ae,{C9:()=>Pe,Ci:()=>xe,FV:()=>ye,Fr:()=>te,JD:()=>me,JY:()=>rt,Jj:()=>be,KE:()=>Re,SU:()=>Ke,VG:()=>Fe,Y5:()=>Ee,gG:()=>Me,hu:()=>re,kZ:()=>Je,kp:()=>Ie,rP:()=>Xe,rk:()=>Ye,tD:()=>Ce});var D=v(15861),R=v(26584),G=v(8314),Z=v(2076),Q=v(62208),$=v(95737),W=v(38305),B=v(67736),H=v(96854),X=v(67010);const te=new Z.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ae={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function oe(tt,et,qe){return!!(tt&&tt.hasOwnProperty(et)?tt[et]:qe)}function le(tt,et,qe){return tt&&tt.hasOwnProperty(et)?tt[et]:qe}function de(tt){const et=tt?.supportedSpatialAggregationStatistics?.map(qe=>qe.toLowerCase());return{envelope:!!et?.includes("envelopeaggregate"),centroid:!!et?.includes("centroidaggregate"),convexHull:!!et?.includes("convexhullaggregate")}}function se(tt,et){return!!tt?.supportedOperationsWithCacheHint?.map(ot=>ot.toLowerCase())?.includes(et.toLowerCase())}function re(tt,et,qe){return{analytics:j(et),attachment:Y(et),data:ee(et),metadata:ie(et),operations:J(et.capabilities||tt,et,qe),query:ce(et,qe),queryRelated:ue(et),queryTopFeatures:pe(et),editing:he(et)}}function j(tt){return{supportsCacheHint:se(tt.advancedQueryCapabilities,"queryAnalytics")}}function Y(tt){const et=tt.attachmentProperties,qe={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:se(tt.advancedQueryCapabilities,"queryAttachments"),supportsResize:oe(tt,"supportsAttachmentsResizing",!1)};return et&&Array.isArray(et)&&et.forEach(ot=>{const ut=ae[ot.name];ut&&(qe[ut]=!!ot.isEnabled)}),qe}function ee(tt){return{isVersioned:oe(tt,"isDataVersioned",!1),supportsAttachment:oe(tt,"hasAttachments",!1),supportsM:oe(tt,"hasM",!1),supportsZ:oe(tt,"hasZ",!1)}}function ie(tt){return{supportsAdvancedFieldProperties:oe(tt,"supportsFieldDescriptionProperty",!1)}}function J(tt,et,qe){const ot=tt?tt.toLowerCase().split(",").map(pr=>pr.trim()):[],ut=qe?(0,W.Qc)(qe):null,_t=ot.includes((0,Q.pC)(ut)&&"MapServer"===ut.serverType?"data":"query"),Ct=ot.includes("editing")&&!et.datesInUnknownTimezone;let vt=Ct&&ot.includes("create"),Lt=Ct&&ot.includes("delete"),jt=Ct&&ot.includes("update");const $t=ot.includes("changetracking"),Wt=et.advancedQueryCapabilities;return Ct&&!(vt||Lt||jt)&&(vt=Lt=jt=!0),{supportsCalculate:oe(et,"supportsCalculate",!1),supportsTruncate:oe(et,"supportsTruncate",!1),supportsValidateSql:oe(et,"supportsValidateSql",!1),supportsAdd:vt,supportsDelete:Lt,supportsEditing:Ct,supportsChangeTracking:$t,supportsQuery:_t,supportsQueryAnalytics:oe(Wt,"supportsQueryAnalytic",!1),supportsQueryAttachments:oe(Wt,"supportsQueryAttachments",!1),supportsQueryTopFeatures:oe(Wt,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:oe(et,"supportsAttachmentsResizing",!1),supportsSync:ot.includes("sync"),supportsUpdate:jt,supportsExceedsLimitStatistics:oe(et,"supportsExceedsLimitStatistics",!1)}}function ce(tt,et){const qe=tt.advancedQueryCapabilities,ot=tt.ownershipBasedAccessControlForFeatures,ut=tt.archivingInfo,_t=rt(tt),Ct=et?.includes("MapServer"),vt=!(0,G.Z)("mapserver-pbf-enabled")&&Ct&&(_t??0)<10.81,Lt=(0,W.M8)(et),jt=(tt.supportedQueryFormats||"").split(",").reduce(($t,Wt)=>{const pr=Wt.toLowerCase().trim();return pr&&$t.add(pr),$t},new Set);return{supportsStatistics:oe(qe,"supportsStatistics",tt.supportsStatistics),supportsPercentileStatistics:oe(qe,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:oe(qe,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:de(qe),supportsCentroid:oe(qe,"supportsReturningGeometryCentroid",!1),supportsDistance:oe(qe,"supportsQueryWithDistance",!1),supportsDistinct:oe(qe,"supportsDistinct",tt.supportsAdvancedQueries),supportsExtent:oe(qe,"supportsReturningQueryExtent",!1),supportsGeometryProperties:oe(qe,"supportsReturningGeometryProperties",!1),supportsHavingClause:oe(qe,"supportsHavingClause",!1),supportsOrderBy:oe(qe,"supportsOrderBy",tt.supportsAdvancedQueries),supportsPagination:oe(qe,"supportsPagination",!1),supportsQuantization:oe(tt,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:oe(tt,"supportsQuantizationEditMode",!1),supportsQueryGeometry:oe(tt,"supportsReturningQueryGeometry",!1),supportsResultType:oe(qe,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:oe(qe,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:oe(qe,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:oe(tt,"useStandardizedQueries",!1),supportsTopFeaturesQuery:oe(qe,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:oe(ot,"allowOthersToQuery",!0),supportsHistoricMoment:oe(ut,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!vt&&jt.has("pbf"),supportsDisjointSpatialRelationship:oe(qe,"supportsDisjointSpatialRel",!1),supportsCacheHint:oe(qe,"supportsQueryWithCacheHint",!1)||se(qe,"query"),supportsDefaultSpatialReference:oe(qe,"supportsDefaultSR",!1),supportsCompactGeometry:Lt,supportsFullTextSearch:oe(qe,"supportsFullTextSearch",!1),maxRecordCountFactor:le(tt,"maxRecordCountFactor",void 0),maxRecordCount:le(tt,"maxRecordCount",void 0),standardMaxRecordCount:le(tt,"standardMaxRecordCount",void 0),tileMaxRecordCount:le(tt,"tileMaxRecordCount",void 0)}}function ue(tt){const et=tt.advancedQueryCapabilities,qe=oe(et,"supportsAdvancedQueryRelated",!1);return{supportsPagination:oe(et,"supportsQueryRelatedPagination",!1),supportsCount:qe,supportsOrderBy:qe,supportsCacheHint:se(et,"queryRelated")}}function pe(tt){return{supportsCacheHint:se(tt.advancedQueryCapabilities,"queryTopFilter")}}function he(tt){const et=tt.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:oe(tt,"allowGeometryUpdates",!0),supportsGlobalId:oe(tt,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:oe(tt,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:oe(tt,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:oe(tt,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:oe(tt,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:oe(et,"allowAnonymousToDelete",!0),supportsDeleteByOthers:oe(et,"allowOthersToDelete",!0),supportsUpdateByAnonymous:oe(et,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:oe(et,"allowOthersToUpdate",!0)}}function me(tt,et,qe,ot){return ge.apply(this,arguments)}function ge(){return(ge=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(yield _e(tt,et,ot),!ut.addAttachment)throw new R.Z(ot,"Layer source does not support addAttachment capability");return ut.addAttachment(et,qe)})).apply(this,arguments)}function _e(tt,et,qe){const{attributes:ot}=et,{objectIdField:ut}=tt;return tt.get("capabilities.data.supportsAttachment")?et?ot?ut&&ot[ut]?Promise.resolve():Promise.reject(new R.Z(qe,`feature is missing the identifying attribute ${ut}`)):Promise.reject(new R.Z(qe,"'attributes' are required on a feature to query attachments")):Promise.reject(new R.Z(qe,"A feature is required to add/delete/update attachments")):Promise.reject(new R.Z(qe,"this layer doesn't support attachments"))}function Ee(tt,et,qe,ot,ut){return De.apply(this,arguments)}function De(){return(De=(0,D.Z)(function*(tt,et,qe,ot,ut){const{source:_t}=yield tt.load();if(yield _e(tt,et,ut),!_t.updateAttachment)throw new R.Z(ut,"Layer source does not support updateAttachment capability");return _t.updateAttachment(et,qe,ot)})).apply(this,arguments)}function be(tt,et,qe){return Se.apply(this,arguments)}function Se(){return(Se=(0,D.Z)(function*(tt,et,qe){const ot=yield v.e(5362).then(v.bind(v,95362)),ut=yield tt.load();return ot.applyEdits(ut,ut.source,et,qe)})).apply(this,arguments)}function ye(tt,et,qe,ot){return ve.apply(this,arguments)}function ve(){return(ve=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(yield _e(tt,et,ot),!ut.deleteAttachments)throw new R.Z(ot,"Layer source does not support deleteAttachments capability");return ut.deleteAttachments(et,qe)})).apply(this,arguments)}function xe(tt,et,qe){return ze.apply(this,arguments)}function ze(){return(ze=(0,D.Z)(function*(tt,et,qe){const{source:ot}=yield tt.load({signal:et?.signal});if(!ot.fetchRecomputedExtents)throw new R.Z(qe,"Layer source does not support fetchUpdates capability");return ot.fetchRecomputedExtents(et)})).apply(this,arguments)}function Ke(tt,et,qe,ot){return We.apply(this,arguments)}function We(){return(We=(0,D.Z)(function*(tt,et,qe,ot){et=B.Z.from(et);const{source:ut,capabilities:_t}=yield tt.load();if(!_t?.data?.supportsAttachment)throw new R.Z(ot,"this layer doesn't support attachments");const{attachmentTypes:Ct,objectIds:vt,globalIds:Lt,num:jt,size:$t,start:Wt,where:pr}=et;if(!_t?.operations?.supportsQueryAttachments){const ar=Ct&&Ct.length,Fr=Lt&&Lt.length,mr=$t&&$t.length;if(vt&&vt.length>1||ar||Fr||mr||jt||Wt||pr)throw new R.Z(ot,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",et)}if(!vt?.length&&!pr)throw new R.Z(ot,"'objectIds' or 'where' are required to perform attachment query",et);if(!ut.queryAttachments)throw new R.Z(ot,"Layer source does not support queryAttachments capability",et);return ut.queryAttachments(et)})).apply(this,arguments)}function Ce(tt,et,qe,ot){return Be.apply(this,arguments)}function Be(){return(Be=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(!ut.queryObjectIds)throw new R.Z(ot,"Layer source does not support queryObjectIds capability");return ut.queryObjectIds(H.Z.from(et)??tt.createQuery(),qe)})).apply(this,arguments)}function Fe(tt,et,qe,ot){return je.apply(this,arguments)}function je(){return(je=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(!ut.queryFeatureCount)throw new R.Z(ot,"Layer source does not support queryFeatureCount capability");return ut.queryFeatureCount(H.Z.from(et)??tt.createQuery(),qe)})).apply(this,arguments)}function Re(tt,et,qe,ot){return He.apply(this,arguments)}function He(){return(He=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(!ut.queryExtent)throw new R.Z(ot,"Layer source does not support queryExtent capability");return ut.queryExtent(H.Z.from(et)??tt.createQuery(),qe)})).apply(this,arguments)}function Ie(tt,et,qe,ot){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(!ut.queryRelatedFeatures)throw new R.Z(ot,"Layer source does not support queryRelatedFeatures capability");return ut.queryRelatedFeatures(X.Z.from(et),qe)})).apply(this,arguments)}function Pe(tt,et,qe,ot){return Le.apply(this,arguments)}function Le(){return(Le=(0,D.Z)(function*(tt,et,qe,ot){const{source:ut}=yield tt.load();if(!ut.queryRelatedFeaturesCount)throw new R.Z(ot,"Layer source does not support queryRelatedFeaturesCount capability");return ut.queryRelatedFeaturesCount(X.Z.from(et),qe)})).apply(this,arguments)}function Me(tt){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,D.Z)(function*(tt){const et=tt.source;if(et?.refresh)try{const{dataChanged:qe,updates:ot}=yield et.refresh();if((0,Q.pC)(ot)&&(tt.sourceJSON={...tt.sourceJSON,...ot},tt.read(ot,{origin:"service",url:tt.parsedUrl})),qe)return!0}catch{}if(tt.definitionExpression)try{return(yield(0,$.E)(tt.definitionExpression,tt.fieldsIndex)).hasDateFunctions}catch{}return!1})).apply(this,arguments)}function Xe(tt){const et=new H.Z,qe=tt.get("capabilities.data"),ot=tt.get("capabilities.query");et.historicMoment=tt.historicMoment,et.gdbVersion=tt.gdbVersion,et.returnGeometry=!0,ot&&(et.compactGeometryEnabled=ot.supportsCompactGeometry,et.defaultSpatialReferenceEnabled=ot.supportsDefaultSpatialReference),qe&&(qe.supportsZ&&null!=tt.returnZ&&(et.returnZ=tt.returnZ),qe.supportsM&&null!=tt.returnM&&(et.returnM=tt.returnM)),et.outFields=["*"];const{timeOffset:ut,timeExtent:_t}=tt;return et.timeExtent=null!=ut&&null!=_t?_t.offset(-ut.value,ut.unit):_t||null,et.multipatchOption="multipatch"===tt.geometryType?"xyFootprint":null,et}function Ye(tt){const{globalIdField:et,fields:qe}=tt;if(et)return et;if(qe)for(const ot of qe)if("esriFieldTypeGlobalID"===ot.type)return ot.name}function Je(tt){const{objectIdField:et,fields:qe}=tt;if(et)return et;if(qe)for(const ot of qe)if("esriFieldTypeOID"===ot.type)return ot.name}function rt(tt){return tt.currentVersion?tt.currentVersion:tt.hasOwnProperty("capabilities")||tt.hasOwnProperty("drawingInfo")||tt.hasOwnProperty("hasAttachments")||tt.hasOwnProperty("htmlPopupType")||tt.hasOwnProperty("relationships")||tt.hasOwnProperty("timeInfo")||tt.hasOwnProperty("typeIdField")||tt.hasOwnProperty("types")?10:9.3}},55911:(nt,Ae,v)=>{"use strict";v.d(Ae,{v:()=>Q});var D=v(63290),R=v(36255),G=v(60466),Z=v(36630);function Q(){return{fields:{type:[R.Z],value:null},fieldsIndex:{readOnly:!0,get(){return new G.Z(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function($){this._userOutFields=$,this.notifyChange("outFields")},get:function(){const $=this._userOutFields;if(!$||!$.length)return null;if($.includes("*"))return["*"];if(!this.fields)return $;for(const W of $)this.fieldsIndex?.has(W)||D.Z.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${W} found in outFields`,{layer:this,outFields:$});return(0,Z.Q0)(this.fieldsIndex,$)}}}}},85:(nt,Ae,v)=>{"use strict";v.d(Ae,{v:()=>R});const R=new(v(2076).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},36630:(nt,Ae,v)=>{"use strict";v.d(Ae,{io:()=>he,vl:()=>ve,ZV:()=>Ke,AB:()=>ce,gd:()=>J,Ll:()=>Fe,Mu:()=>Je,Qj:()=>Re,R9:()=>Hr,Q0:()=>ie,YN:()=>re,UF:()=>Y,O5:()=>Ee,CH:()=>Me,os:()=>qe,y2:()=>Fr,H7:()=>gr,Ec:()=>Cs,qN:()=>ar,q6:()=>le,Gm:()=>Qr,Pz:()=>sr,Lk:()=>ue,Qc:()=>rr,vP:()=>Lr});var Q,Dt,D=v(15861),R=v(26584),G=v(62208),Z=v(94113);(Dt=Q||(Q={})).VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",Dt.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";var B=v(46679);const H=/^([0-9])/,X=/[^A-Za-z0-9_\u0080-\uffff]/g,te=/_{2,}/g,ae=/^_/,oe=/_$/;function le(Dt){return Dt?Dt.trim().replace(X,"_").replace(te,"_").replace(ae,"").replace(oe,"").replace(H,"F$1"):null}const de=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],se=["field","normalizationField"];function re(Dt,ct){if(null!=Dt&&null!=ct)for(const At of Array.isArray(Dt)?Dt:[Dt])if(j(de,At,ct),"visualVariables"in At&&At.visualVariables)for(const Kt of At.visualVariables)j(se,Kt,ct)}function j(Dt,ct,At){if(Dt)for(const Kt of Dt){const tr=(0,Z.hS)(Kt,ct),_r=tr&&"function"!=typeof tr&&At.get(tr);_r&&(0,Z.RB)(Kt,_r.name,ct)}}function Y(Dt,ct){if(null!=Dt&&ct?.fields?.length)if("startField"in Dt){const At=ct.get(Dt.startField),Kt=ct.get(Dt.endField);Dt.startField=At?.name??null,Dt.endField=Kt?.name??null}else{const At=ct.get(Dt.startTimeField),Kt=ct.get(Dt.endTimeField);Dt.startTimeField=At?.name??null,Dt.endTimeField=Kt?.name??null}}const ee=new Set;function ie(Dt,ct){return Dt&&ct?(ee.clear(),J(ee,Dt,ct),Array.from(ee).sort()):[]}function J(Dt,ct,At){if(At)if(ct?.fields?.length)if(At.includes("*"))for(const{name:Kt}of ct.fields)Dt.add(Kt);else for(const Kt of At)ce(Dt,ct,Kt);else{if(At.includes("*"))return Dt.clear(),void Dt.add("*");for(const Kt of At)null!=Kt&&Dt.add(Kt)}}function ce(Dt,ct,At){if("string"==typeof At)if(ct){const Kt=ct.get(At);Kt&&Dt.add(Kt.name)}else Dt.add(At)}function ue(Dt,ct){return(0,G.Wi)(ct)||(0,G.Wi)(Dt)?[]:ct.includes("*")?(Dt.fields??[]).map(At=>At.name):ct}function he(Dt,ct,At){return me.apply(this,arguments)}function me(){return me=(0,D.Z)(function*(Dt,ct,At){if(!At)return;const{arcadeUtils:Kt}=yield(0,B.LC)(),tr=Kt.extractFieldNames(At,ct?.fields?.map(_r=>_r.name));for(const _r of tr)ce(Dt,ct,_r)}),me.apply(this,arguments)}function ge(Dt,ct,At){return _e.apply(this,arguments)}function _e(){return _e=(0,D.Z)(function*(Dt,ct,At){if(At&&"1=1"!==At){const Kt=(yield v.e(410).then(v.bind(v,10410))).WhereClause.create(At,ct);if(!Kt.isStandardized)throw new R.Z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:At});J(Dt,ct,Kt.fieldNames)}}),_e.apply(this,arguments)}function Ee({displayField:Dt,fields:ct}){return Dt||(ct&&ct.length?be(ct,"name-or-title")||be(ct,"unique-identifier")||be(ct,"type-or-category")||function De(Dt){for(const ct of Dt){if(!ct||!ct.name)continue;const At=ct.name.toLowerCase();if(At.includes("name")||At.includes("title"))return ct.name}return null}(ct):null)}function be(Dt,ct){for(const At of Dt)if(At&&At.valueType&&At.valueType===ct)return At.name;return null}function ve(Dt,ct){return xe.apply(this,arguments)}function xe(){return xe=(0,D.Z)(function*(Dt,ct){if(!ct)return;const At=(0,Z.hS)("elevationInfo.featureExpressionInfo",ct);return At?At.collectRequiredFields(Dt,ct.fieldsIndex):void 0}),xe.apply(this,arguments)}function ze(Dt,ct,At){At.onStatisticExpression?he(Dt,ct,At.onStatisticExpression.expression):Dt.add(At.onStatisticField)}function Ke(Dt,ct,At){return We.apply(this,arguments)}function We(){return We=(0,D.Z)(function*(Dt,ct,At){if(!ct||!At||!("fields"in At))return;const Kt=[];Kt.push(Ce(Dt,ct,At.popupTemplate)),At.fields&&Kt.push(...At.fields.map(function(){var _r=(0,D.Z)(function*(Or){return ze(Dt,ct.fieldsIndex,Or)});return function(Or){return _r.apply(this,arguments)}}())),yield Promise.all(Kt)}),We.apply(this,arguments)}function Ce(Dt,ct,At){return Be.apply(this,arguments)}function Be(){return Be=(0,D.Z)(function*(Dt,ct,At){const Kt=[];At?.expressionInfos&&Kt.push(...At.expressionInfos.map(_r=>he(Dt,ct.fieldsIndex,_r.expression)));const tr=At?.content;if(Array.isArray(tr))for(const _r of tr)"expression"===_r.type&&_r.expressionInfo&&Kt.push(he(Dt,ct.fieldsIndex,_r.expressionInfo.expression));yield Promise.all(Kt)}),Be.apply(this,arguments)}function Fe(Dt,ct,At){return je.apply(this,arguments)}function je(){return je=(0,D.Z)(function*(Dt,ct,At){ct&&(ct.timeInfo&&(0,G.pC)(At)&&At.timeExtent&&J(Dt,ct.fieldsIndex,[ct.timeInfo.startField,ct.timeInfo.endField]),ct.floorInfo&&J(Dt,ct.fieldsIndex,[ct.floorInfo.floorField]),(0,G.pC)(At)&&(0,G.pC)(At.where)&&(yield ge(Dt,ct.fieldsIndex,At.where)))}),je.apply(this,arguments)}function Re(Dt,ct,At){return He.apply(this,arguments)}function He(){return He=(0,D.Z)(function*(Dt,ct,At){ct&&At&&(yield Promise.all(At.map(Kt=>Ie(Dt,ct,Kt))))}),He.apply(this,arguments)}function Ie(Dt,ct,At){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,D.Z)(function*(Dt,ct,At){ct&&At&&(At.valueExpression?yield he(Dt,ct.fieldsIndex,At.valueExpression):At.field&&ce(Dt,ct.fieldsIndex,At.field))}),Ge.apply(this,arguments)}function Me(Dt){if(!Dt)return[];const ct="editFieldsInfo"in Dt&&Dt.editFieldsInfo;return ct?ie(Dt.fieldsIndex,[ct&&ct.creatorField,ct&&ct.creationDateField,ct&&ct.editorField,ct&&ct.editDateField]):[]}function Je(Dt,ct){return rt.apply(this,arguments)}function rt(){return rt=(0,D.Z)(function*(Dt,ct){const{labelingInfo:At,fieldsIndex:Kt}=ct;At&&At.length&&(yield Promise.all(At.map(tr=>tt(Dt,Kt,tr))))}),rt.apply(this,arguments)}function tt(Dt,ct,At){return et.apply(this,arguments)}function et(){return et=(0,D.Z)(function*(Dt,ct,At){if(!At)return;const Kt=At.getLabelExpression(),tr=At.where;if("arcade"===Kt.type)yield he(Dt,ct,Kt.expression);else{const _r=Kt.expression.match(/{[^}]*}/g);_r&&_r.forEach(Or=>{ce(Dt,ct,Or.slice(1,-1))})}yield ge(Dt,ct,tr)}),et.apply(this,arguments)}function qe(Dt){const ct=Dt.defaultValue;return void 0!==ct&&$t(Dt,ct)?ct:Dt.nullable?null:void 0}function ot(Dt){return"number"==typeof Dt&&!isNaN(Dt)&&isFinite(Dt)}function ut(Dt){return null===Dt||ot(Dt)}const _t="isInteger"in Number?Number.isInteger:Dt=>"number"==typeof Dt&&isFinite(Dt)&&Math.floor(Dt)===Dt;function Ct(Dt){return null===Dt||_t(Dt)}function vt(Dt){return null!=Dt&&"string"==typeof Dt}function Lt(Dt){return null===Dt||vt(Dt)}function jt(){return!0}function $t(Dt,ct){let At;switch(Dt.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":At=Dt.nullable?Ct:_t;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":At=Dt.nullable?ut:ot;break;case"string":case"esriFieldTypeString":At=Dt.nullable?Lt:vt;break;default:At=jt}return 1===arguments.length?At:At(ct)}const pr=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function gr(Dt){return null!=Dt&&pr.has(Dt.type)}function ar(Dt){return null!=Dt&&("string"===Dt.type||"esriFieldTypeString"===Dt.type)}function Fr(Dt){return null!=Dt&&("date"===Dt.type||"esriFieldTypeDate"===Dt.type)}var wt,or;function sr(Dt){return null==Dt||"number"==typeof Dt&&isNaN(Dt)?null:Dt}function rr(Dt,ct){return Dt.nullable&&null===ct?null:gr(Dt)&&!function Et(Dt,ct){const At="string"==typeof Dt?Ft(Dt):Dt;if(!At)return!1;const Kt=At.min,tr=At.max;return At.isInteger?_t(ct)&&ct>=Kt&&ct<=tr:ct>=Kt&&ct<=tr}(Dt.type,Number(ct))?wt.OUT_OF_RANGE:$t(Dt,ct)?Dt.domain?function $(Dt,ct){switch(Dt.type){case"range":{const At="range"in Dt?Dt.range[0]:Dt.minValue,Kt="range"in Dt?Dt.range[1]:Dt.maxValue;if(null!=At&&+ct<At||null!=Kt&&+ct>Kt)return Q.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==Dt.codedValues||Dt.codedValues.every(At=>null==At||At.code!==ct))return Q.INVALID_CODED_VALUE}return null}(Dt.domain,ct):null:or.INVALID_TYPE}function Ft(Dt){switch(Dt){case"esriFieldTypeSmallInteger":case"small-integer":return dr;case"esriFieldTypeInteger":case"integer":return hr;case"esriFieldTypeSingle":case"single":return Tr;case"esriFieldTypeDouble":case"double":return Dr}}(function(Dt){Dt.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(wt||(wt={})),function(Dt){Dt.INVALID_TYPE="type-validation-error::invalid-type"}(or||(or={}));const dr={min:-32768,max:32767,isInteger:!0},hr={min:-2147483648,max:2147483647,isInteger:!0},Tr={min:-34e37,max:12e37,isInteger:!1},Dr={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Lr(Dt,ct,At){switch(Dt){case Q.INVALID_CODED_VALUE:return`Value ${At} is not in the coded domain - field: ${ct.name}, domain: ${JSON.stringify(ct.domain)}`;case Q.VALUE_OUT_OF_RANGE:return`Value ${At} is out of the range of valid values - field: ${ct.name}, domain: ${JSON.stringify(ct.domain)}`;case or.INVALID_TYPE:return`Value ${At} is not a valid value for the field type - field: ${ct.name}, type: ${ct.type}, nullable: ${ct.nullable}`;case wt.OUT_OF_RANGE:{const{min:Kt,max:tr}=Ft(ct.type);return`Value ${At} is out of range for the number type - field: ${ct.name}, type: ${ct.type}, value range is ${Kt} to ${tr}`}}}function Hr(Dt,ct){return!Qr(Dt,ct,null)}function Qr(Dt,ct,At){if(!ct||!ct.attributes||!Dt){if((0,G.pC)(At))for(const _r of Dt??[])At.add(_r);return!0}const Kt=ct.attributes;let tr=!1;for(const _r of Dt)if(!(_r in Kt)){if(tr=!0,!(0,G.pC)(At))break;At.add(_r)}return tr}function Cs(Dt){return["raster.itempixelvalue","raster.servicepixelvalue"].some(ct=>Dt.toLowerCase().startsWith(ct))}},59990:(nt,Ae,v)=>{"use strict";function D(Z){const Q=Z.layer;return"floorInfo"in Q&&Q.floorInfo?.floorField&&"floors"in Z.view?G(Z.view.floors,Q.floorInfo.floorField):null}function R(Z,Q){return"floorInfo"in Q&&Q.floorInfo?.floorField?G(Z,Q.floorInfo.floorField):null}function G(Z,Q){if(!Z?.length)return null;const $=Z.filter(W=>""!==W).map(W=>`'${W}'`);return $.push("''"),`${Q} IN (${$.join(",")}) OR ${Q} IS NULL`}v.d(Ae,{c:()=>D,f:()=>R})},22445:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{createLabelFunction:()=>oe,formatField:()=>de});var D=v(15861),R=v(26584),G=v(63290),Z=v(62208),Q=v(88411),$=v(15348),W=v(36630),B=v(86793),H=v(46679);const X=G.Z.getLogger("esri.layers.support.labelFormatUtils"),te={type:"simple",evaluate:()=>null},ae={getAttribute:(se,re)=>se.field(re)};function oe(se,re,j){return le.apply(this,arguments)}function le(){return(le=(0,D.Z)(function*(se,re,j){if(!se||!se.symbol)return te;const Y=se.where,ee=(0,B.hV)(se),ie=Y?yield v.e(410).then(v.bind(v,10410)):null;let J;if("arcade"===ee.type){const ce=yield(0,H.WW)(ee.expression,j,re);if((0,Z.Wi)(ce))return te;J={type:"arcade",evaluate(ue){try{const pe=ce.evaluate({$feature:"attributes"in ue?ce.repurposeFeature(ue):ue});if(null!=pe)return pe.toString()}catch{X.error(new R.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:ue,expression:ee}))}return null},needsHydrationToEvaluate:()=>null==(0,B.el)(ee.expression)}}else J={type:"simple",evaluate:ce=>ee.expression.replace(/{[^}]*}/g,ue=>{const pe=ue.slice(1,-1),he=re.get(pe);if(!he)return ue;let me=null;return"attributes"in ce?ce&&ce.attributes&&(me=ce.attributes[he.name]):me=ce.field(he.name),null==me?"":de(me,he)})};if(Y){let ce;try{ce=ie.WhereClause.create(Y,re)}catch(pe){return X.error(new R.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:Y,error:pe})),te}const ue=J.evaluate;J.evaluate=pe=>{const he="attributes"in pe?void 0:ae;try{if(ce.testFeature(pe,he))return ue(pe)}catch(me){X.error(new R.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:Y,feature:pe,error:me}))}return null}}return J})).apply(this,arguments)}function de(se,re){if(null==se)return"";const j=re.domain;if(j)if("codedValue"===j.type||"coded-value"===j.type){const ee=se;for(const ie of j.codedValues)if(ie.code===ee)return ie.name}else if("range"===j.type){const ee=+se,J="range"in j?j.range[1]:j.maxValue;if(("range"in j?j.range[0]:j.minValue)<=ee&&ee<=J)return j.name}let Y=se;return"date"===re.type||"esriFieldTypeDate"===re.type?Y=(0,Q.p6)(Y,(0,Q.Ze)("short-date")):(0,W.H7)(re)&&(Y=(0,$.uf)(+Y)),Y||""}},86793:(nt,Ae,v)=>{"use strict";v.d(Ae,{UO:()=>de,YI:()=>le,dI:()=>se,el:()=>J,hV:()=>oe,z7:()=>ae});var D=v(77275);const R="__begin__",G="__end__",Z=new RegExp(R,"ig"),Q=new RegExp(G,"ig"),$=new RegExp("^"+R,"i"),W=new RegExp(G+"$","i");function ae(ce){return ce.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function oe(ce){const ue={expression:"",type:"none"};return ce.labelExpressionInfo?ce.labelExpressionInfo.value?(ue.expression=ce.labelExpressionInfo.value,ue.type="conventional"):ce.labelExpressionInfo.expression&&(ue.expression=ce.labelExpressionInfo.expression,ue.type="arcade"):null!=ce.labelExpression&&(ue.expression=function te(ce){return ce.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(ce.labelExpression),ue.type="conventional"),ue}function le(ce){const ue=oe(ce);if(!ue)return null;switch(ue.type){case"conventional":return se(ue.expression);case"arcade":return ue.expression}return null}function de(ce){const ue=oe(ce);if(!ue)return null;switch(ue.type){case"conventional":return function j(ce){const ue=ce.match(re);return ue&&ue[1].trim()||null}(ue.expression);case"arcade":return J(ue.expression)}return null}function se(ce){let ue;return ce?(ue=(0,D.gx)(ce,pe=>R+'$feature["'+pe+'"]'+G),ue=$.test(ue)?ue.replace($,""):'"'+ue,ue=W.test(ue)?ue.replace(W,""):ue+'"',ue=ue.replace(Z,'" + ').replace(Q,' + "')):ue='""',ue}const re=/^\s*\{([^}]+)\}\s*$/i,Y=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,ee=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,ie=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function J(ce){if(!ce)return null;let ue=Y.exec(ce)||ee.exec(ce);return ue?ue[1]||ue[3]:(ue=ie.exec(ce),ue?ue[2]:null)}},62667:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>X,r:()=>W});var D=v(26584),R=v(58817),G=v(63290),Z=v(170);const Q=G.Z.getLogger("esri.layers.support.labelingInfo"),$=/\[([^\[\]]+)\]/gi;function W(ae,oe,le){return ae?ae.map(de=>{const se=new Z.Z;if(se.read(de,le),se.labelExpression){const re=oe.fields||oe.layerDefinition&&oe.layerDefinition.fields||this.fields;se.labelExpression=se.labelExpression.replace($,(j,Y)=>`[${function B(ae,oe){if(!oe)return ae;const le=ae.toLowerCase();for(let de=0;de<oe.length;de++){const se=oe[de].name;if(se.toLowerCase()===le)return se}return ae}(Y,re)}]`)}return se}):null}const H={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function X(ae,oe){const le=(0,R.d9)(ae);return le.some(de=>function te(ae,oe){const le=ae.labelPlacement,de=H[oe];if(!ae.symbol)return Q.warn("No ILabelClass symbol specified."),!0;if(!de)return Q.error(new D.Z("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${oe}' is not supported`)),!0;if(!de.includes(le)){const se=de[0];le&&Q.warn(`Found invalid label placement type ${le} for ${oe}. Defaulting to ${se}`),ae.labelPlacement=se}return!1}(de,oe))?[]:le}},72469:(nt,Ae,v)=>{"use strict";function R(ae){const oe=ae?.type;return"base-tile"===oe||"tile"===oe||"elevation"===oe||"imagery-tile"===oe||"base-elevation"===oe||"open-street-map"===oe||"wcs"===oe||"web-tile"===oe||"wmts"===oe||"vector-tile"===oe}function G(ae){return"voxel"===ae?.type}function Z(ae){return"imagery-tile"===ae?.type}function Q(ae){return"esri.Basemap"===ae.parent?.declaredClass&&ae.parent.baseLayers.includes(ae)}function $(ae){return"feature"===ae?.type&&!ae.url&&"memory"===ae.source?.type}function W(ae){return"feature"===ae?.type&&"feature-layer"===ae.source?.type}function X(ae){return!0===ae.labelsVisible&&null!=ae.labelingInfo&&ae.labelingInfo.length>0}function te(ae){if(ae.activeLayer){const oe=ae.activeLayer.tileMatrixSet;if(oe)return oe;const le=ae.activeLayer.tileMatrixSets;if(le)return le}return null}v.d(Ae,{Am:()=>Z,C6:()=>X,Tv:()=>G,iC:()=>R,mt:()=>te,rQ:()=>$,sy:()=>Q,y2:()=>W})},15283:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>be});var re,D=v(17626),R=v(2076),G=v(86810),Z=v(77712),$=(v(85931),v(66656)),W=v(55342),B=v(68653),H=v(76898),X=v(90912),te=v(383),ae=v(36255),oe=v(48370),de=(v(29132),v(65234)),se=v(71774);let j=re=class extends G.wq{constructor(Se){super(Se),this.type="query-table"}clone(){const{workspaceId:Se,query:ye,oidFields:ve,spatialReference:xe,geometryType:ze}=this,Ke={workspaceId:Se,query:ye,oidFields:ve,spatialReference:xe?.clone()??void 0,geometryType:ze};return new re(Ke)}};var Y;(0,D._)([(0,W.J)({queryTable:"query-table"})],j.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],j.prototype,"workspaceId",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],j.prototype,"query",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],j.prototype,"oidFields",void 0),(0,D._)([(0,Z.Cb)({type:de.Z,json:{write:!0}})],j.prototype,"spatialReference",void 0),(0,D._)([(0,W.J)(se.Mk)],j.prototype,"geometryType",void 0),j=re=(0,D._)([(0,H.j)("esri.layers.support.source.QueryTableDataSource")],j);let ee=Y=class extends G.wq{constructor(Se){super(Se),this.type="raster"}clone(){const{workspaceId:Se,dataSourceName:ye}=this;return new Y({workspaceId:Se,dataSourceName:ye})}};var ie;(0,D._)([(0,W.J)({raster:"raster"})],ee.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ee.prototype,"dataSourceName",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],ee.prototype,"workspaceId",void 0),ee=Y=(0,D._)([(0,H.j)("esri.layers.support.source.RasterDataSource")],ee);let J=ie=class extends G.wq{constructor(Se){super(Se),this.type="table"}clone(){const{workspaceId:Se,gdbVersion:ye,dataSourceName:ve}=this;return new ie({workspaceId:Se,gdbVersion:ye,dataSourceName:ve})}};var ce,ue;(0,D._)([(0,W.J)({table:"table"})],J.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],J.prototype,"workspaceId",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],J.prototype,"gdbVersion",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],J.prototype,"dataSourceName",void 0),J=ie=(0,D._)([(0,H.j)("esri.layers.support.source.TableDataSource")],J);const pe=(0,R.w)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let he=ce=class extends G.wq{constructor(Se){super(Se),this.type="join-table"}readLeftTableSource(Se,ye,ve){return ge()(Se,ye,ve)}castLeftTableSource(Se){return(0,X.N7)(Ee(),Se)}readRightTableSource(Se,ye,ve){return ge()(Se,ye,ve)}castRightTableSource(Se){return(0,X.N7)(Ee(),Se)}clone(){const{leftTableKey:Se,rightTableKey:ye,leftTableSource:ve,rightTableSource:xe,joinType:ze}=this,Ke={leftTableKey:Se,rightTableKey:ye,leftTableSource:ve?.clone()??void 0,rightTableSource:xe?.clone()??void 0,joinType:ze};return new ce(Ke)}};(0,D._)([(0,W.J)({joinTable:"join-table"})],he.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],he.prototype,"leftTableKey",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],he.prototype,"rightTableKey",void 0),(0,D._)([(0,Z.Cb)({json:{write:!0}})],he.prototype,"leftTableSource",void 0),(0,D._)([(0,B.r)("leftTableSource")],he.prototype,"readLeftTableSource",null),(0,D._)([(0,$.p)("leftTableSource")],he.prototype,"castLeftTableSource",null),(0,D._)([(0,Z.Cb)({json:{write:!0}})],he.prototype,"rightTableSource",void 0),(0,D._)([(0,B.r)("rightTableSource")],he.prototype,"readRightTableSource",null),(0,D._)([(0,$.p)("rightTableSource")],he.prototype,"castRightTableSource",null),(0,D._)([(0,W.J)(pe)],he.prototype,"joinType",void 0),he=ce=(0,D._)([(0,H.j)("esri.layers.support.source.JoinTableDataSource")],he);let me=null;function ge(){return me||(me=(0,te.d)({types:Ee()})),me}let _e=null;function Ee(){return _e||(_e={key:"type",base:null,typeMap:{"data-layer":be,"map-layer":oe.R}}),_e}const De={key:"type",base:null,typeMap:{"join-table":he,"query-table":j,raster:ee,table:J}};let be=ue=class extends G.wq{constructor(Se){super(Se),this.type="data-layer"}clone(){const{fields:Se,dataSource:ye}=this;return new ue({fields:Se,dataSource:ye})}};(0,D._)([(0,W.J)({dataLayer:"data-layer"})],be.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:[ae.Z],json:{write:!0}})],be.prototype,"fields",void 0),(0,D._)([(0,Z.Cb)({types:De,json:{write:!0}})],be.prototype,"dataSource",void 0),be=ue=(0,D._)([(0,H.j)("esri.layers.support.source.DataLayerSource")],be),be.from=(0,X.se)(be)},48370:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>H});var B,D=v(17626),R=v(86810),G=v(77712),Q=(v(85931),v(90912)),$=v(55342),W=v(76898);let H=B=class extends R.wq{constructor(X){super(X),this.type="map-layer"}clone(){const{mapLayerId:X,gdbVersion:te}=this;return new B({mapLayerId:X,gdbVersion:te})}};(0,D._)([(0,$.J)({mapLayer:"map-layer"})],H.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:Q.z8,json:{write:!0}})],H.prototype,"mapLayerId",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"gdbVersion",void 0),H=B=(0,D._)([(0,W.j)("esri.layers.support.source.MapLayerSource")],H)},13410:(nt,Ae,v)=>{"use strict";v.d(Ae,{FN:()=>Z,QV:()=>G,ac:()=>$});var D=v(62208),R=v(31283);function G(W,B,H){return B.flatten(({sublayers:te})=>te).length!==W.length||!!W.some(te=>te.originIdOf("minScale")>H||te.originIdOf("maxScale")>H||te.originIdOf("renderer")>H||te.originIdOf("labelingInfo")>H||te.originIdOf("opacity")>H||te.originIdOf("labelsVisible")>H||te.originIdOf("source")>H)||!Q(W,B)}function Z(W,B,H){return!!W.some(X=>{const te=X.source;return!(!te||"map-layer"===te.type&&te.mapLayerId===X.id&&((0,D.Wi)(te.gdbVersion)||te.gdbVersion===H))||X.originIdOf("renderer")>R.s3.SERVICE||X.originIdOf("labelingInfo")>R.s3.SERVICE||X.originIdOf("opacity")>R.s3.SERVICE||X.originIdOf("labelsVisible")>R.s3.SERVICE})||!Q(W,B)}function Q(W,B){if(!W||!W.length||(0,D.Wi)(B))return!0;const H=B.slice().reverse().flatten(({sublayers:ae})=>ae&&ae.toArray().reverse()).map(ae=>ae.id).toArray();if(W.length>H.length)return!1;let X=0;const te=H.length;for(const{id:ae}of W){for(;X<te&&H[X]!==ae;)X++;if(X>=te)return!1}return!0}function $(W){return!!W&&W.some(B=>null!=B.minScale||B.layerDefinition&&null!=B.layerDefinition.minScale)}},5676:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>G});var D=v(38305);const R=[];function G(Z,Q){if((0,D.M8)(Z.url??""))return!0;const{wkid:$}=Q;for(const W of R){if((Z.version??0)>=W[0])return!0;if("function"==typeof W[1]&&(W[1]=W[1]()),W[1].has($))return!1}return!0}R.push([10.91,()=>{const Z=new Set([9709,9716,9741,9761,9766]);for(let Q=9712;Q<=9713;Q++)Z.add(Q);for(let Q=9748;Q<=9749;Q++)Z.add(Q);for(let Q=20904;Q<=20932;Q++)Z.add(Q);for(let Q=21004;Q<=21032;Q++)Z.add(Q);for(let Q=21207;Q<=21264;Q++)Z.add(Q);for(let Q=21307;Q<=21364;Q++)Z.add(Q);for(let Q=102759;Q<=102760;Q++)Z.add(Q);for(let Q=102901;Q<=102955;Q++)Z.add(Q);return Z}]),R.push([10.9,()=>{const Z=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let Q=9356;Q<=9360;Q++)Z.add(Q);for(let Q=9404;Q<=9407;Q++)Z.add(Q);for(let Q=9476;Q<=9482;Q++)Z.add(Q);for(let Q=9487;Q<=9494;Q++)Z.add(Q);for(let Q=9697;Q<=9699;Q++)Z.add(Q);return Z}]),R.push([10.81,()=>{const Z=new Set([9265,9333,103598,103699]);for(let Q=9248;Q<=9254;Q++)Z.add(Q);for(let Q=9271;Q<=9273;Q++)Z.add(Q);for(let Q=9284;Q<=9285;Q++)Z.add(Q);for(let Q=21453;Q<=21463;Q++)Z.add(Q);return Z}]),R.push([10.8,()=>{const Z=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let Q=8035;Q<=8036;Q++)Z.add(Q);for(let Q=8455;Q<=8456;Q++)Z.add(Q);for(let Q=8518;Q<=8529;Q++)Z.add(Q);for(let Q=8533;Q<=8536;Q++)Z.add(Q);for(let Q=8538;Q<=8540;Q++)Z.add(Q);for(let Q=8677;Q<=8679;Q++)Z.add(Q);for(let Q=8902;Q<=8903;Q++)Z.add(Q);for(let Q=8907;Q<=8910;Q++)Z.add(Q);for(let Q=8949;Q<=8951;Q++)Z.add(Q);for(let Q=8972;Q<=8987;Q++)Z.add(Q);for(let Q=9039;Q<=9040;Q++)Z.add(Q);for(let Q=9068;Q<=9069;Q++)Z.add(Q);for(let Q=9140;Q<=9141;Q++)Z.add(Q);for(let Q=9148;Q<=9150;Q++)Z.add(Q);for(let Q=9153;Q<=9159;Q++)Z.add(Q);for(let Q=9205;Q<=9218;Q++)Z.add(Q);for(let Q=9221;Q<=9222;Q++)Z.add(Q);for(let Q=54098;Q<=54101;Q++)Z.add(Q);return Z}]),R.push([10.71,()=>{const Z=new Set([6316]);for(let Q=8351;Q<=8353;Q++)Z.add(Q);for(let Q=9294;Q<=9297;Q++)Z.add(Q);for(let Q=103586;Q<=103594;Q++)Z.add(Q);for(let Q=103696;Q<=103698;Q++)Z.add(Q);return Z}]),R.push([10.7,()=>{const Z=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let Q=8065;Q<=8068;Q++)Z.add(Q);for(let Q=8082;Q<=8083;Q++)Z.add(Q);for(let Q=8379;Q<=8385;Q++)Z.add(Q);for(let Q=8836;Q<=8840;Q++)Z.add(Q);for(let Q=8857;Q<=8860;Q++)Z.add(Q);for(let Q=53035;Q<=53037;Q++)Z.add(Q);for(let Q=54090;Q<=54091;Q++)Z.add(Q);for(let Q=102498;Q<=102499;Q++)Z.add(Q);return Z}]),R.push([10.61,()=>new Set([102497])]),R.push([10.6,()=>{const Z=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let Q=7755;Q<=7787;Q++)Z.add(Q);for(let Q=7791;Q<=7795;Q++)Z.add(Q);for(let Q=7799;Q<=7801;Q++)Z.add(Q);for(let Q=7825;Q<=7831;Q++)Z.add(Q);for(let Q=7877;Q<=7878;Q++)Z.add(Q);for(let Q=7882;Q<=7883;Q++)Z.add(Q);for(let Q=7991;Q<=7992;Q++)Z.add(Q);for(let Q=8042;Q<=8043;Q++)Z.add(Q);for(let Q=8058;Q<=8059;Q++)Z.add(Q);for(let Q=8311;Q<=8348;Q++)Z.add(Q);for(let Q=9060;Q<=9067;Q++)Z.add(Q);for(let Q=102562;Q<=102568;Q++)Z.add(Q);for(let Q=102799;Q<=102900;Q++)Z.add(Q);return Z}]),R.push([10.51,()=>{const Z=new Set([7683,7881,7886,7899,8888,9e3]);for(let Q=8013;Q<=8032;Q++)Z.add(Q);for(let Q=9053;Q<=9057;Q++)Z.add(Q);for(let Q=104017;Q<=104018;Q++)Z.add(Q);for(let Q=104971;Q<=104974;Q++)Z.add(Q);return Z}]),R.push([10.5,()=>{const Z=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let Q=4087;Q<=4088;Q++)Z.add(Q);for(let Q=5896;Q<=5899;Q++)Z.add(Q);for(let Q=7005;Q<=7007;Q++)Z.add(Q);for(let Q=7057;Q<=7070;Q++)Z.add(Q);for(let Q=7073;Q<=7082;Q++)Z.add(Q);for(let Q=7109;Q<=7128;Q++)Z.add(Q);for(let Q=7844;Q<=7859;Q++)Z.add(Q);return Z}])},39605:(nt,Ae,v)=>{"use strict";v.d(Ae,{W:()=>G,v:()=>Z});var D=v(50645);const R={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(Q,$,W)=>{"-"===$.charAt(0)?Q.style.setProperty($,W):Q.style[$]=W}};let G=Q=>(0,D.l7)(R,Q),Z={create:(Q,$)=>($=G($),(0,D.WV)(Q,document.createElement("div"),void 0,$),(0,D.UQ)(Q,$)),append:(Q,$,W)=>(W=G(W),(0,D.WV)($,Q,void 0,W),(0,D.UQ)($,W)),insertBefore:(Q,$,W)=>(W=G(W),(0,D.WV)($,Q.parentNode,Q,W),(0,D.UQ)($,W)),merge:(Q,$,W)=>(W=G(W),$.domNode=Q,(0,D.Yj)(Q,$,W),(0,D.UQ)($,W)),replace:(Q,$,W)=>(W=G(W),(0,D.WV)($,Q.parentNode,Q,W),Q.parentNode.removeChild(Q),(0,D.UQ)($,W))}},50645:(nt,Ae,v)=>{"use strict";v.d(Ae,{UQ:()=>he,WV:()=>J,Yj:()=>ie,l7:()=>W});var D=v(38570);const R="http://www.w3.org/",G=`${R}2000/svg`,Z=`${R}1999/xlink`;let Q,$=[],W=(me,ge)=>{let _e={};return Object.keys(me).forEach(Ee=>{_e[Ee]=me[Ee]}),ge&&Object.keys(ge).forEach(Ee=>{_e[Ee]=ge[Ee]}),_e},B=(me,ge)=>me.vnodeSelector===ge.vnodeSelector&&(me.properties&&ge.properties?me.properties.key===ge.properties.key&&me.properties.bind===ge.properties.bind:!me.properties&&!ge.properties),H=me=>{if("string"!=typeof me)throw new Error("Style values must be strings")},X=(me,ge,_e)=>{if(""!==ge.vnodeSelector)for(let Ee=_e;Ee<me.length;Ee++)if(B(me[Ee],ge))return Ee;return-1},te=(me,ge,_e,Ee)=>{let De=me[ge];if(""===De.vnodeSelector)return;let be=De.properties;if(!be||!(void 0===be.key?be.bind:be.key))for(let Se=0;Se<me.length;Se++)if(Se!==ge&&B(me[Se],De))throw new Error(`${_e.vnodeSelector} had a ${De.vnodeSelector} child ${"added"===Ee?Ee:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)},ae=me=>{if(me.properties){let ge=me.properties.enterAnimation;ge&&ge(me.domNode,me.properties)}},oe=[],le=!1,de=me=>{(me.children||[]).forEach(de),me.properties&&me.properties.afterRemoved&&me.properties.afterRemoved.apply(me.properties.bind||me.properties,[me.domNode])},se=()=>{le=!1,oe.forEach(de),oe.length=0},re=me=>{oe.push(me),le||(le=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(se,{timeout:16}):setTimeout(se,16))},j=me=>{let ge=me.domNode;if(me.properties){let _e=me.properties.exitAnimation;if(_e)return ge.style.pointerEvents="none",void _e(ge,()=>{ge.parentNode&&(ge.parentNode.removeChild(ge),re(me))},me.properties)}ge.parentNode&&(ge.parentNode.removeChild(ge),re(me))},Y=(me,ge,_e)=>{if(!ge)return;let Ee=_e.eventHandlerInterceptor,De=Object.keys(ge),be=De.length;for(let Se=0;Se<be;Se++){let ye=De[Se],ve=ge[ye];if("className"===ye)throw new Error('Property "className" is not supported, use "class".');if("class"===ye)ce(me,ve,!0);else if("classes"===ye){let xe=Object.keys(ve),ze=xe.length;for(let Ke=0;Ke<ze;Ke++){let We=xe[Ke];ve[We]&&me.classList.add(We)}}else if("styles"===ye){let xe=Object.keys(ve),ze=xe.length;for(let Ke=0;Ke<ze;Ke++){let We=xe[Ke],Ce=ve[We];Ce&&(H(Ce),_e.styleApplyer(me,We,Ce))}}else if("key"!==ye&&null!=ve){let xe=typeof ve;"function"===xe?(0===ye.lastIndexOf("on",0)&&(Ee&&(ve=Ee(ye,ve,me,ge)),"oninput"===ye&&function(){let ze=ve;ve=function(Ke){ze.apply(this,[Ke]),Ke.target["oninput-value"]=Ke.target.value}}()),me[ye]=ve):_e.namespace===G?"href"===ye?me.setAttributeNS(Z,ye,ve):me.setAttribute(ye,ve):"string"===xe&&"value"!==ye?"innerHTML"===ye?me[ye]=D.w3.sanitize(ve):me.setAttribute(ye,ve):me[ye]=ve}}},ie=(me,ge,_e)=>{((me,ge,_e)=>{if(ge)for(let Ee of ge)J(Ee,me,void 0,_e)})(me,ge.children,_e),ge.text&&(me.textContent=ge.text),Y(me,ge.properties,_e),ge.properties&&ge.properties.afterCreate&&ge.properties.afterCreate.apply(ge.properties.bind||ge.properties,[me,_e,ge.vnodeSelector,ge.properties,ge.children])},J=(me,ge,_e,Ee)=>{let De,be=0,Se=me.vnodeSelector,ye=ge.ownerDocument;if(""===Se)De=me.domNode=ye.createTextNode(me.text),void 0!==_e?ge.insertBefore(De,_e):ge.appendChild(De);else{for(let ve=0;ve<=Se.length;++ve){let xe=Se.charAt(ve);if(ve===Se.length||"."===xe||"#"===xe){let ze=Se.charAt(be-1),Ke=Se.slice(be,ve);"."===ze?De.classList.add(Ke):"#"===ze?De.id=Ke:("svg"===Ke&&(Ee=W(Ee,{namespace:G})),void 0!==Ee.namespace?De=me.domNode=ye.createElementNS(Ee.namespace,Ke):(De=me.domNode=me.domNode||ye.createElement(Ke),"input"===Ke&&me.properties&&void 0!==me.properties.type&&De.setAttribute("type",me.properties.type)),void 0!==_e?ge.insertBefore(De,_e):De.parentNode!==ge&&ge.appendChild(De)),be=ve+1}}ie(De,me,Ee)}},ce=(me,ge,_e)=>{ge&&ge.split(" ").forEach(Ee=>{Ee&&me.classList.toggle(Ee,_e)})};Q=(me,ge,_e)=>{let Ee=me.domNode,De=!1;if(me===ge)return!1;let be=!1;if(""===ge.vnodeSelector){if(ge.text!==me.text){let Se=Ee.ownerDocument.createTextNode(ge.text);return Ee.parentNode.replaceChild(Se,Ee),ge.domNode=Se,De=!0,De}ge.domNode=Ee}else 0===ge.vnodeSelector.lastIndexOf("svg",0)&&(_e=W(_e,{namespace:G})),me.text!==ge.text&&(be=!0,void 0===ge.text?Ee.removeChild(Ee.firstChild):Ee.textContent=ge.text),ge.domNode=Ee,be=((me,ge,_e,Ee,De)=>{if(_e===Ee)return!1;let be,Se=(_e=_e||$).length,ye=(Ee=Ee||$).length,ve=0,xe=0,ze=!1;for(;xe<ye;){let Ke=ve<Se?_e[ve]:void 0,We=Ee[xe];if(void 0!==Ke&&B(Ke,We))ze=Q(Ke,We,De)||ze,ve++;else{let Ce=X(_e,We,ve+1);if(Ce>=0){for(be=ve;be<Ce;be++)j(_e[be]),te(_e,be,me,"removed");ze=Q(_e[Ce],We,De)||ze,ve=Ce+1}else J(We,ge,ve<Se?_e[ve].domNode:void 0,De),ae(We),te(Ee,xe,me,"added")}xe++}if(Se>ve)for(be=ve;be<Se;be++)j(_e[be]),te(_e,be,me,"removed");return ze})(ge,Ee,me.children,ge.children,_e)||be,be=((me,ge,_e,Ee)=>{if(!_e)return;let De=!1,be=Object.keys(_e),Se=be.length;for(let ye=0;ye<Se;ye++){let ve=be[ye],xe=_e[ve],ze=ge[ve];if("class"===ve)ze!==xe&&(ce(me,ze,!1),ce(me,xe,!0));else if("classes"===ve){let Ke=me.classList,We=Object.keys(xe),Ce=We.length;for(let Be=0;Be<Ce;Be++){let Fe=We[Be],je=!!xe[Fe];je!==!!ze[Fe]&&(De=!0,je?Ke.add(Fe):Ke.remove(Fe))}}else if("styles"===ve){let Ke=Object.keys(xe),We=Ke.length;for(let Ce=0;Ce<We;Ce++){let Be=Ke[Ce],Fe=xe[Be];Fe!==ze[Be]&&(De=!0,Fe?(H(Fe),Ee.styleApplyer(me,Be,Fe)):Ee.styleApplyer(me,Be,""))}}else if(xe||"string"!=typeof ze||(xe=""),"value"===ve){let Ke=me[ve];Ke!==xe&&(me["oninput-value"]?Ke===me["oninput-value"]:xe!==ze)&&(me[ve]=xe,me["oninput-value"]=void 0),xe!==ze&&(De=!0)}else if(xe!==ze){let Ke=typeof xe;"function"===Ke&&Ee.eventHandlerInterceptor||(Ee.namespace===G?"href"===ve?me.setAttributeNS(Z,ve,xe):me.setAttribute(ve,xe):"string"===Ke?"innerHTML"===ve?me[ve]=D.w3.sanitize(xe):"role"===ve&&""===xe?me.removeAttribute(ve):me.setAttribute(ve,xe):me[ve]!==xe&&(me[ve]=xe),De=!0)}}return De})(Ee,me.properties,ge.properties,_e)||be,ge.properties&&ge.properties.afterUpdate&&ge.properties.afterUpdate.apply(ge.properties.bind||ge.properties,[Ee,_e,ge.vnodeSelector,ge.properties,ge.children]);return be&&ge.properties&&ge.properties.updateAnimation&&ge.properties.updateAnimation(Ee,ge.properties,me.properties),De};let he=(me,ge)=>({getLastRender:()=>me,update:_e=>{if(me.vnodeSelector!==_e.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let Ee=me;me=_e,Q(Ee,_e,ge)},domNode:me.domNode})},62996:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>$});var D=v(39605);let R,G=(W,B)=>{let H=[];for(;W&&W!==B;)H.push(W),W=W.parentNode;return H};R=Array.prototype.find?(W,B)=>W.find(B):(W,B)=>W.filter(B)[0];let Z=(W,B)=>{let H=W;return B.forEach(X=>{H=H&&H.children?R(H.children,te=>te.domNode===X):void 0}),H},Q=(W,B,H)=>{let X=function(te){H("domEvent",te);let ae=B(),oe=G(te.currentTarget,ae.domNode);oe.reverse();let le,de=Z(ae.getLastRender(),oe);return W.scheduleRender(),de&&(le=de.properties[`on${te.type}`].apply(de.properties.bind||this,arguments)),H("domEventProcessed",te),le};return(te,ae,oe,le)=>X},$=W=>{let B,H,X=(0,D.W)(W),te=X.performanceLogger,ae=!0,oe=!1,le=[],de=[],se=(j,Y,ee)=>{let ie;X.eventHandlerInterceptor=Q(B,()=>ie,te),ie=j(Y,ee(),X),le.push(ie),de.push(ee)},re=()=>{if(H=void 0,ae){ae=!1,te("renderStart",void 0);for(let j=0;j<le.length;j++){let Y=de[j]();te("rendered",void 0),le[j].update(Y),te("patched",void 0)}te("renderDone",void 0),ae=!0}};return B={renderNow:re,scheduleRender:()=>{H||oe||(H=requestAnimationFrame(re))},stop:()=>{H&&(cancelAnimationFrame(H),H=void 0),oe=!0},resume:()=>{oe=!1,ae=!0,B.scheduleRender()},append:(j,Y)=>{se(D.v.append,j,Y)},insertBefore:(j,Y)=>{se(D.v.insertBefore,j,Y)},merge:(j,Y)=>{se(D.v.merge,j,Y)},replace:(j,Y)=>{se(D.v.replace,j,Y)},detach:j=>{for(let Y=0;Y<de.length;Y++)if(de[Y]===j)return de.splice(Y,1),le.splice(Y,1)[0];throw new Error("renderFunction was not found")}},B}},38159:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.wq{constructor(X){super(X),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new W({title:this.title,expression:this.expression})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"expression",void 0),(0,D._)([(0,G.Cb)({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"returnType",void 0),B=W=(0,D._)([(0,$.j)("esri.popup.ElementExpressionInfo")],B);const H=B},38439:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.wq{constructor(X){super(X),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new W({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"name",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"expression",void 0),(0,D._)([(0,G.Cb)({type:["string","number"],json:{write:!0}})],B.prototype,"returnType",void 0),B=W=(0,D._)([(0,$.j)("esri.popup.ExpressionInfo")],B);const H=B},25621:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),R=v(2076),G=v(86810),Z=v(58817),Q=v(77712),W=(v(90912),v(55342)),B=v(76898),H=v(66845);let te=X=class extends G.wq{constructor(oe){super(oe),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new X({fieldName:this.fieldName,format:this.format?(0,Z.d9)(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"fieldName",void 0),(0,D._)([(0,Q.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"format",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0,default:!1}})],te.prototype,"isEditable",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"label",void 0),(0,D._)([(0,W.J)(new R.X({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],te.prototype,"stringFieldOption",void 0),(0,D._)([(0,Q.Cb)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],te.prototype,"statisticType",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"tooltip",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],te.prototype,"visible",void 0),te=X=(0,D._)([(0,B.j)("esri.popup.FieldInfo")],te);const ae=te},55664:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(55013);let B=W=class extends $.Z{constructor(X){super(X),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new W({description:this.description,displayType:this.displayType,title:this.title})}};(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],B.prototype,"description",void 0),(0,D._)([(0,R.Cb)({type:["auto","preview","list"],json:{write:!0}})],B.prototype,"displayType",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,D._)([(0,R.Cb)({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"type",void 0),B=W=(0,D._)([(0,Q.j)("esri.popup.content.AttachmentsContent")],B);const H=B},89594:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(85812),W=v(82657);let H=B=class extends $.Z{constructor(te){super(te),this.type="bar-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,D._)([(0,R.Cb)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:W.l.write}})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.BarChartMediaInfo")],H);const X=H},81590:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(85812),W=v(82657);let H=B=class extends $.Z{constructor(te){super(te),this.type="column-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,D._)([(0,R.Cb)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:W.l.write}})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.ColumnChartMediaInfo")],H);const X=H},55013:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H),this.type=null}};(0,D._)([(0,G.Cb)({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.popup.content.Content")],W);const B=W},16615:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(76898)),$=v(55013);let B=W=class extends $.Z{constructor(X){super(X),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new W({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?(0,R.d9)(this.outFields):null})}};(0,D._)([(0,G.Cb)()],B.prototype,"creator",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"destroyer",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"outFields",void 0),(0,D._)([(0,G.Cb)({type:["custom"],readOnly:!0})],B.prototype,"type",void 0),B=W=(0,D._)([(0,Q.j)("esri.popup.content.CustomContent")],B);const H=B},82561:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(38159),W=v(55013);let H=B=class extends W.Z{constructor(te){super(te),this.expressionInfo=null,this.type="expression"}clone(){return new B({expressionInfo:this.expressionInfo?.clone()})}};(0,D._)([(0,R.Cb)({type:$.Z,json:{write:!0}})],H.prototype,"expressionInfo",void 0),(0,D._)([(0,R.Cb)({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.ExpressionContent")],H);const X=H},75484:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(76898)),$=v(99433),W=v(25621),B=v(55013);let X=H=class extends B.Z{constructor(ae){super(ae),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(ae,oe){oe.fieldInfos=ae&&ae.map(le=>le.toJSON())}clone(){return new H((0,R.d9)({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};(0,D._)([(0,G.Cb)({type:Object,json:{write:!0}})],X.prototype,"attributes",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],X.prototype,"description",void 0),(0,D._)([(0,G.Cb)({type:[W.Z]})],X.prototype,"fieldInfos",void 0),(0,D._)([(0,$.c)("fieldInfos")],X.prototype,"writeFieldInfos",null),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],X.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],X.prototype,"type",void 0),X=H=(0,D._)([(0,Q.j)("esri.popup.content.FieldsContent")],X);const te=X},49455:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(78297),W=v(86810);let H=B=class extends W.wq{constructor(le){super(le),this.linkURL=null,this.sourceURL=null}clone(){return new B({linkURL:this.linkURL,sourceURL:this.sourceURL})}};(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],H.prototype,"linkURL",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],H.prototype,"sourceURL",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.support.ImageMediaInfoValue")],H);const X=H;var te;let ae=te=class extends $.Z{constructor(le){super(le),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new te({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};(0,D._)([(0,R.Cb)({type:Number,json:{write:!0}})],ae.prototype,"refreshInterval",void 0),(0,D._)([(0,R.Cb)({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],ae.prototype,"type",void 0),(0,D._)([(0,R.Cb)({type:X,json:{write:!0}})],ae.prototype,"value",void 0),ae=te=(0,D._)([(0,Q.j)("esri.popup.content.ImageMediaInfo")],ae);const oe=ae},71981:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(85812),W=v(82657);let H=B=class extends $.Z{constructor(te){super(te),this.type="line-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,D._)([(0,R.Cb)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:W.l.write}})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.LineChartMediaInfo")],H);const X=H},64531:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>re});var de,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(68653)),$=v(76898),W=v(99433),B=v(89594),H=v(81590),X=v(55013),te=v(49455),ae=v(71981),oe=v(52023),le=v(65560);let se=de=class extends X.Z{constructor(j){super(j),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(j){return j&&j.map(Y=>"image"===Y.type?te.Z.fromJSON(Y):"barchart"===Y.type?B.Z.fromJSON(Y):"columnchart"===Y.type?H.Z.fromJSON(Y):"linechart"===Y.type?ae.Z.fromJSON(Y):"piechart"===Y.type?oe.Z.fromJSON(Y):void 0).filter(Boolean)}writeMediaInfos(j,Y){Y.mediaInfos=j&&j.map(ee=>ee.toJSON())}clone(){return new de((0,R.d9)({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};(0,D._)([(0,G.Cb)()],se.prototype,"activeMediaInfoIndex",void 0),(0,D._)([(0,G.Cb)({type:Object,json:{write:!0}})],se.prototype,"attributes",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],se.prototype,"description",void 0),(0,D._)([(0,G.Cb)({types:[le.V]})],se.prototype,"mediaInfos",void 0),(0,D._)([(0,Q.r)("mediaInfos")],se.prototype,"readMediaInfos",null),(0,D._)([(0,W.c)("mediaInfos")],se.prototype,"writeMediaInfos",null),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],se.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],se.prototype,"type",void 0),se=de=(0,D._)([(0,$.j)("esri.popup.content.MediaContent")],se);const re=se},52023:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(85812),W=v(82657);let H=B=class extends $.Z{constructor(te){super(te),this.type="pie-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,D._)([(0,R.Cb)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:W.l.write}})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.popup.content.PieChartMediaInfo")],H);const X=H},6785:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var D=v(17626),R=v(79608),G=v(77712),Q=(v(85931),v(90912)),$=v(76898),W=v(55013),B=v(51686);let H=class extends((0,R.J)(W.Z)){constructor(te){super(te),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"description",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{type:Q.z8,write:!0}})],H.prototype,"displayCount",void 0),(0,D._)([(0,G.Cb)({type:["list"],json:{write:!0}})],H.prototype,"displayType",void 0),(0,D._)([(0,G.Cb)({type:[B.Z],json:{write:!0}})],H.prototype,"orderByFields",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{type:Q.z8,write:!0}})],H.prototype,"relationshipId",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],H.prototype,"type",void 0),H=(0,D._)([(0,$.j)("esri.popup.content.RelationshipContent")],H);const X=H},501:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(55013);let B=W=class extends $.Z{constructor(X){super(X),this.text=null,this.type="text"}clone(){return new W({text:this.text})}};(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],B.prototype,"text",void 0),(0,D._)([(0,R.Cb)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"type",void 0),B=W=(0,D._)([(0,Q.j)("esri.popup.content.TextContent")],B);const H=B},85812:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var X,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(78297),W=v(86810),B=v(58817),H=v(77891);let te=X=class extends W.wq{constructor(de){super(de),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new X({fields:(0,B.d9)(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};(0,D._)([(0,R.Cb)({type:[String],json:{write:!0}})],te.prototype,"fields",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],te.prototype,"normalizeField",void 0),(0,D._)([(0,R.Cb)({type:[H.Z],json:{read:!1}})],te.prototype,"series",void 0),(0,D._)([(0,R.Cb)({type:String,json:{write:!0}})],te.prototype,"tooltipField",void 0),te=X=(0,D._)([(0,Q.j)("esri.popup.content.support.ChartMediaInfoValue")],te);const ae=te;let oe=class extends $.Z{constructor(de){super(de),this.type=null,this.value=null}};(0,D._)([(0,R.Cb)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],oe.prototype,"type",void 0),(0,D._)([(0,R.Cb)({type:ae,json:{write:!0}})],oe.prototype,"value",void 0),oe=(0,D._)([(0,Q.j)("esri.popup.content.mixins.ChartMediaInfo")],oe);const le=oe},78297:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H),this.altText=null,this.caption="",this.title="",this.type=null}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"altText",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"caption",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"title",void 0),(0,D._)([(0,G.Cb)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.popup.content.mixins.MediaInfo")],W);const B=W},77891:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.Z{constructor(X){super(X),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new W({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};(0,D._)([(0,G.Cb)()],B.prototype,"fieldName",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"tooltip",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"value",void 0),B=W=(0,D._)([(0,$.j)("esri.popup.content.support.ChartMediaInfoValueSeries")],B);const H=B},82657:(nt,Ae,v)=>{"use strict";v.d(Ae,{l:()=>R});const R=(0,v(2076).w)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},65560:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>W});var D=v(89594),R=v(81590),G=v(49455),Z=v(71981),Q=v(52023);const W={base:v(78297).Z,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":D.Z,"column-chart":R.Z,"line-chart":Z.Z,"pie-chart":Q.Z,image:G.Z}}},66845:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>j});var D=v(17626);const Z=(0,v(2076).w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});Z.toJSON.bind(Z),Z.fromJSON.bind(Z);var se,B=v(86810),H=v(77712),te=(v(85931),v(90912)),ae=v(55342),oe=v(76898),le=v(88411),de=v(15348);let re=se=class extends B.wq{constructor(Y){super(Y),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new se({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(Y){return this.dateFormat?(0,le.p6)(Y,{...(0,le.Ze)(this.dateFormat),...this.dateTimeFormatOptions}):(0,de.uf)(Y,(0,de.sh)(this))}formatRasterPixelValue(Y){if(Y.includes("-"))return Y;let ee,ie;return Y.trim().includes(",")?(ee=",",ie=ee+" ",this._formatDelimitedString(Y,ee,ie,this)):Y.trim().includes(";")?(ee=";",ie=ee+" ",this._formatDelimitedString(Y,ee,ie,this)):Y.trim().includes(" ")?(ee=ie=" ",this._formatDelimitedString(Y,ee,ie,this)):this.format(Number(Y))}_formatDelimitedString(Y,ee,ie,J){return Y&&ee&&ie&&J?Y.trim().split(ee).map(ce=>this.format(Number(ce))).join(ie):Y}};(0,D._)([(0,ae.J)(Z)],re.prototype,"dateFormat",void 0),(0,D._)([(0,H.Cb)({type:Object,json:{read:!1}})],re.prototype,"dateTimeFormatOptions",void 0),(0,D._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],re.prototype,"digitSeparator",void 0),(0,D._)([(0,H.Cb)({type:te.z8,json:{write:!0}})],re.prototype,"places",void 0),re=se=(0,D._)([(0,oe.j)("esri.popup.support.FieldInfoFormat")],re);const j=re},51686:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.wq{constructor(X){super(X),this.field=null,this.order=null}clone(){return new W({field:this.field,order:this.order})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"field",void 0),(0,D._)([(0,G.Cb)({type:["asc","desc"],json:{write:!0}})],B.prototype,"order",void 0),B=W=(0,D._)([(0,$.j)("esri.popup.support.RelatedRecordsInfoFieldOrder")],B);const H=B},84687:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ge});var D=v(15861),R=v(17626),G=v(59318),Z=v(24263),Q=v(84792),$=v(26584),W=v(86810),B=v(47996),H=v(62208),X=v(10699),te=v(77712),oe=(v(85931),v(90912)),le=v(68653),de=v(76898),se=v(2004),re=v(56683),j=v(6278),Y=v(14517);let ee=class extends Y.Z{constructor(_e){super(_e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};(0,R._)([(0,te.Cb)()],ee.prototype,"nextQueryParams",void 0),(0,R._)([(0,te.Cb)()],ee.prototype,"queryParams",void 0),(0,R._)([(0,te.Cb)()],ee.prototype,"results",void 0),(0,R._)([(0,te.Cb)()],ee.prototype,"total",void 0),ee=(0,R._)([(0,de.j)("esri.portal.PortalQueryResult")],ee);const ie=ee;var ue,J=v(94508),ce=v(12680);let pe;const he={PortalGroup:()=>Promise.resolve().then(v.bind(v,96245)),PortalItem:()=>Promise.resolve().then(v.bind(v,55463)),PortalUser:()=>Promise.resolve().then(v.bind(v,94508))};let me=ue=class extends((0,W.eC)(B.Z)){constructor(_e){super(_e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=G.Z.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(_e){return"string"==typeof _e?{url:_e}:_e}destroy(){this._esriIdCredentialCreateHandle=(0,H.hw)(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(_e){if(_e)for(const Ee of _e)G.Z.request.trustedServers.includes(Ee)||G.Z.request.trustedServers.push(Ee);return _e}readDefaultBasemap(_e){return this._readBasemap(_e)}readDefaultDevBasemap(_e){return this._readBasemap(_e)}readDefaultVectorBasemap(_e){return this._readBasemap(_e)}get extraQuery(){return this.id&&this.user&&this.user.orgId&&!this.canSearchPublic?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let _e=this.url;if(_e){const Ee=_e.indexOf("/sharing");_e=Ee>0?_e.substring(0,Ee):this.url.replace(/\/+$/,""),_e+="/sharing/rest"}return _e}get thumbnailUrl(){const _e=this.restUrl,Ee=this.thumbnail;return _e&&Ee?this._normalizeSSL(_e+"/portals/self/resources/"+Ee):null}readUrlKey(_e){return _e&&_e.toLowerCase()}readUser(_e){let Ee=null;return _e&&(Ee=J.default.fromJSON(_e),Ee.portal=this),Ee}load(_e){const Ee=Promise.resolve().then(v.bind(v,73386)).then(({default:De})=>{(0,X.k_)(_e),pe=De}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,_e)).then(De=>{if(Z.id){const be=Z.id;this.credential=be.findCredential(this.restUrl),this.credential||this.authMode!==ue.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=be.on("credential-create",()=>{be.findCredential(this.restUrl)&&this._signIn().catch(()=>{})}))}this.sourceJSON=De,this.read(De)});return this.addResolvingPromise(Ee),Promise.resolve(this)}createElevationLayers(){var _e=this;return(0,D.Z)(function*(){yield _e.load();const Ee=_e._getHelperService("defaultElevationLayers"),De=(yield Promise.all([v.e(8592),v.e(5810)]).then(v.bind(v,75810))).default;return Ee?Ee.map(be=>new De({id:be.id,url:be.url})):[]})()}fetchBasemaps(_e,Ee){const De=new j.Z;return De.query=_e||(G.Z.apiKey&&(0,ce.r)(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),De.disableExtraQuery=!0,this.queryGroups(De,Ee).then(be=>{if(De.num=100,De.query='type:"Web Map" -type:"Web Application"',be.total){const Se=be.results[0];return De.sortField=Se.sortField||"name",De.sortOrder=Se.sortOrder||"desc",Se.queryItems(De,Ee)}return null}).then(be=>{let Se;return Se=be&&be.total?be.results.filter(ye=>"Web Map"===ye.type).map(ye=>new pe({portalItem:ye})):[],Se})}fetchCategorySchema(_e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",_e).then(Ee=>Ee.categorySchema):(0,X.Hc)(_e)?Promise.reject((0,X.zE)()):Promise.resolve([])}fetchFeaturedGroups(_e){const Ee=this.featuredGroups,De=new j.Z;if(De.num=100,De.sortField="title",Ee&&Ee.length){const be=[];for(const Se of Ee)be.push(`(title:"${Se.title}" AND owner:${Se.owner})`);return De.query=be.join(" OR "),this.queryGroups(De,_e).then(Se=>Se.results)}return(0,X.Hc)(_e)?Promise.reject((0,X.zE)()):Promise.resolve([])}fetchRegions(_e){const Ee=this.user?.culture||this.culture||(0,re.Kd)();return this._request(this.restUrl+"/portals/regions",{..._e,query:{culture:Ee}})}fetchSettings(_e){const Ee=this.user?.culture||this.culture||(0,re.Kd)();return this._request(this.restUrl+"/portals/self/settings",{..._e,query:{culture:Ee}})}static getDefault(){return ue._default&&!ue._default.destroyed||(ue._default=new ue),ue._default}queryGroups(_e,Ee){return this._queryPortal("/community/groups",_e,"PortalGroup",Ee)}queryItems(_e,Ee){return this._queryPortal("/search",_e,"PortalItem",Ee)}queryUsers(_e,Ee){return _e.sortField||(_e.sortField="username"),this._queryPortal("/community/users",_e,"PortalUser",Ee)}toJSON(){throw new $.Z("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(_e){if(!_e)return null;if(_e.declaredClass)throw new Error("JSON object is already hydrated");return new ue({sourceJSON:_e})}_getHelperService(_e){const Ee=this.helperServices&&this.helperServices[_e];if(!Ee)throw new $.Z("portal:service-not-found",`The \`helperServices\` do not include an entry named "${_e}"`);return Ee}_getHelperServiceUrl(_e){const Ee=this._getHelperService(_e);if(!Ee?.url)throw new $.Z("portal:service-url-not-found",`The \`helperServices\` entry "${_e}" does not include a \`url\` value`);return Ee.url}_fetchSelf(_e=this.authMode,Ee=!1,De){const be=this.restUrl+"/portals/self",Se={authMode:_e,query:{culture:(0,re.Kd)().toLowerCase()},...De};return"auto"===Se.authMode&&(Se.authMode="no-prompt"),Ee&&(Se.query.default=!0),this._request(be,Se)}_queryPortal(_e,Ee,De,be){const Se=(0,oe.se)(j.Z,Ee),ye=ve=>this._request(this.restUrl+_e,{...Se.toRequestOptions(this),...be}).then(xe=>{const ze=Se.clone();return ze.start=xe.nextStart,new ie({nextQueryParams:ze,queryParams:Se,total:xe.total,results:ue._resultsToTypedArray(ve,{portal:this},xe,be)})}).then(xe=>Promise.all(xe.results.map(ze=>"function"==typeof ze.when?ze.when():xe)).then(()=>xe,ze=>((0,X.r9)(ze),xe)));return De&&he[De]?he[De]().then(({default:ve})=>((0,X.k_)(be),ye(ve))):ye()}_signIn(){if(this.authMode===ue.AUTH_MODE_ANONYMOUS)return Promise.reject(new $.Z("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const _e=Ee=>Promise.resolve().then(()=>"not-loaded"===this.loadStatus?(Ee||(this.authMode="immediate"),this.load().then(()=>null)):"loading"===this.loadStatus?this.load().then(()=>this.credential?null:(this.credential=Ee,this._fetchSelf("immediate"))):this.user&&this.credential===Ee?null:(this.credential=Ee,this._fetchSelf("immediate"))).then(De=>{De&&(this.sourceJSON=De,this.read(De))});return Z.id?Z.id.getCredential(this.restUrl).then(Ee=>_e(Ee)):_e(this.credential)}_normalizeSSL(_e){return _e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(_e){const Ee=this.credential&&this.credential.token;return this._normalizeSSL(Ee?_e+(_e.includes("?")?"&":"?")+"token="+Ee:_e)}_requestToTypedArray(_e,Ee,De){return this._request(_e,Ee).then(be=>{const Se=ue._resultsToTypedArray(De,{portal:this},be);return Promise.all(Se.map(ye=>"function"==typeof ye.when?ye.when():be)).then(()=>Se,()=>Se)})}_readBasemap(_e){if(_e){const Ee=pe.fromJSON(_e);return Ee.portalItem={portal:this},Ee}return null}_request(_e,Ee={}){const De={f:"json",...Ee.query},{authMode:be=(this.authMode===ue.AUTH_MODE_ANONYMOUS?"anonymous":"auto"),body:Se=null,cacheBust:ye=!1,method:ve="auto",responseType:xe="json",signal:ze}=Ee,Ke={authMode:be,body:Se,cacheBust:ye,method:ve,query:De,responseType:xe,timeout:0,signal:ze};return(0,Q.default)(this._normalizeSSL(_e),Ke).then(We=>We.data)}static _resultsToTypedArray(_e,Ee,De,be){let Se;if(De){const ye=(0,H.pC)(be)?be.signal:null;Se=De.listings||De.notifications||De.userInvitations||De.tags||De.items||De.groups||De.comments||De.provisions||De.results||De.relatedItems||De,(_e||Ee)&&(Se=Se.map(ve=>{const xe=Object.assign(_e?_e.fromJSON(ve):ve,Ee);return"function"==typeof xe.load&&xe.load(ye),xe}))}else Se=[];return Se}};me.AUTH_MODE_ANONYMOUS="anonymous",me.AUTH_MODE_AUTO="auto",me.AUTH_MODE_IMMEDIATE="immediate",(0,R._)([(0,te.Cb)()],me.prototype,"access",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"allSSL",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"authMode",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"authorizedCrossOriginDomains",void 0),(0,R._)([(0,le.r)("authorizedCrossOriginDomains")],me.prototype,"readAuthorizedCrossOriginDomains",null),(0,R._)([(0,te.Cb)()],me.prototype,"basemapGalleryGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"bingKey",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canListApps",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canListData",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canListPreProvisionedItems",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canProvisionDirectPurchase",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canSearchPublic",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canShareBingPublic",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canSharePublic",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canSignInArcGIS",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"canSignInIDP",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"colorSetsGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"commentsEnabled",void 0),(0,R._)([(0,te.Cb)({type:Date})],me.prototype,"created",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"credential",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"culture",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"currentVersion",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"customBaseUrl",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"defaultBasemap",void 0),(0,R._)([(0,le.r)("defaultBasemap")],me.prototype,"readDefaultBasemap",null),(0,R._)([(0,te.Cb)()],me.prototype,"defaultDevBasemap",void 0),(0,R._)([(0,le.r)("defaultDevBasemap")],me.prototype,"readDefaultDevBasemap",null),(0,R._)([(0,te.Cb)({type:se.Z})],me.prototype,"defaultExtent",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"defaultVectorBasemap",void 0),(0,R._)([(0,le.r)("defaultVectorBasemap")],me.prototype,"readDefaultVectorBasemap",null),(0,R._)([(0,te.Cb)()],me.prototype,"description",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"devBasemapGalleryGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"eueiEnabled",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],me.prototype,"extraQuery",null),(0,R._)([(0,te.Cb)()],me.prototype,"featuredGroups",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"featuredItemsGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"galleryTemplatesGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"livingAtlasGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"hasCategorySchema",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"helpBase",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"helperServices",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"helpMap",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"homePageFeaturedContent",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"homePageFeaturedContentCount",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"httpPort",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"httpsPort",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"id",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"ipCntryCode",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],me.prototype,"isOrganization",null),(0,R._)([(0,te.Cb)()],me.prototype,"isPortal",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"isReadOnly",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],me.prototype,"itemPageUrl",null),(0,R._)([(0,te.Cb)()],me.prototype,"layerTemplatesGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"maxTokenExpirationMinutes",void 0),(0,R._)([(0,te.Cb)({type:Date})],me.prototype,"modified",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"name",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"portalHostname",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"portalMode",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"portalProperties",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"region",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],me.prototype,"restUrl",null),(0,R._)([(0,te.Cb)()],me.prototype,"rotatorPanels",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"showHomePageDescription",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"sourceJSON",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"staticImagesUrl",void 0),(0,R._)([(0,te.Cb)({json:{name:"2DStylesGroupQuery"}})],me.prototype,"stylesGroupQuery2d",void 0),(0,R._)([(0,te.Cb)({json:{name:"stylesGroupQuery"}})],me.prototype,"stylesGroupQuery3d",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"supportsHostedServices",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"symbolSetsGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"templatesGroupQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"thumbnail",void 0),(0,R._)([(0,te.Cb)({readOnly:!0})],me.prototype,"thumbnailUrl",null),(0,R._)([(0,te.Cb)()],me.prototype,"units",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"url",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"urlKey",void 0),(0,R._)([(0,le.r)("urlKey")],me.prototype,"readUrlKey",null),(0,R._)([(0,te.Cb)()],me.prototype,"user",void 0),(0,R._)([(0,le.r)("user")],me.prototype,"readUser",null),(0,R._)([(0,te.Cb)()],me.prototype,"useStandardizedQuery",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"useVectorBasemaps",void 0),(0,R._)([(0,te.Cb)()],me.prototype,"vectorBasemapGalleryGroupQuery",void 0),me=ue=(0,R._)([(0,de.j)("esri.portal.Portal")],me);const ge=me},96245:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>te});var D=v(17626),R=v(26584),G=v(86810),Z=v(62208),Q=v(77712),W=(v(85931),v(90912)),B=v(76898),H=v(6278);let X=class extends G.wq{constructor(ae){super(ae),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const ae=this.url,oe=this.thumbnail;return ae&&oe&&this.portal?this.portal?._normalizeUrl(`${ae}/info/${oe}?f=json`):null}get url(){const ae=this.get("portal.restUrl");return ae?ae+"/community/groups/"+this.id:null}fetchCategorySchema(ae){return(0,Z.s3)(this.portal)._request(this.url+"/categorySchema",ae).then(oe=>{const le=oe.categorySchema||[];return le.some(de=>"contentCategorySetsGroupQuery.LivingAtlas"===de.source)?this._fetchCategorySchemaSet("LivingAtlas",ae):le})}fetchMembers(ae){return(0,Z.s3)(this.portal)._request(this.url+"/users",ae)}getThumbnailUrl(ae){let oe=this.thumbnailUrl;return oe&&ae&&(oe+=`&w=${ae}`),oe}toJSON(){throw new R.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(ae,oe){let le=(0,W.se)(H.Z,ae);const de=(0,Z.s3)(this.portal);return parseFloat(de.currentVersion)>5?(le=le||new H.Z,de._queryPortal(`/content/groups/${this.id}/search`,le,"PortalItem",oe)):(le=le?le.clone():new H.Z,le.query="group:"+this.id+(le.query?" "+le.query:""),de.queryItems(le,oe))}_fetchCategorySchemaSet(ae,oe){const le=(0,Z.s3)(this.portal);return le._fetchSelf(le.authMode,!0,oe).then(de=>{const se=de.contentCategorySetsGroupQuery;if(se){const re=new H.Z;return re.disableExtraQuery=!0,re.num=1,re.query=se,le.queryGroups(re,oe)}throw new R.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(de=>{if(de.total){const se=de.results[0],re=new H.Z;return re.num=1,re.query=`typekeywords:"${ae}"`,se.queryItems(re,oe)}throw new R.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(de=>de.total?de.results[0].fetchData("json",oe).then(se=>{const re=se&&se.categorySchema;return re&&re.length?re:[]}):[])}};(0,D._)([(0,Q.Cb)()],X.prototype,"access",void 0),(0,D._)([(0,Q.Cb)({type:Date})],X.prototype,"created",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"description",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"id",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"isInvitationOnly",void 0),(0,D._)([(0,Q.Cb)({type:Date})],X.prototype,"modified",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"owner",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"portal",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"snippet",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"sortField",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"sortOrder",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"tags",void 0),(0,D._)([(0,Q.Cb)()],X.prototype,"thumbnail",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"thumbnailUrl",null),(0,D._)([(0,Q.Cb)()],X.prototype,"title",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],X.prototype,"url",null),X=(0,D._)([(0,B.j)("esri.portal.PortalGroup")],X);const te=X},55463:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>ge});var D=v(15861),R=v(17626),G=v(54346),Z=v(26584),Q=v(86810),$=v(58817),W=v(47996),B=v(62208),H=v(21726),X=v(77712),te=v(90912),ae=v(68653),oe=v(76898),le=v(2004),de=v(84687),se=v(14517),re=v(63290),Y=(v(85931),v(66656));let ee=class extends se.Z{constructor(_e){super(_e),this.portalItem=null}normalizeCtorArgs(_e){return _e&&_e.portalItem&&_e.path?{..._e,path:this._normalizePath(_e.path,_e.portalItem)}:_e}set path(_e){(0,B.pC)(_e)&&(0,H.YP)(_e)?re.Z.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",_e)}_castPath(_e){return this._normalizePath(_e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(_e="json",Ee){const De=this.url;if((0,B.Wi)(De))throw new Z.Z("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(De,{responseType:_e,query:{token:this.portalItem.apiKey},signal:(0,B.U2)(Ee,"signal")})}update(_e,Ee){var De=this;return(0,D.Z)(function*(){return(yield v.e(587).then(v.bind(v,10587))).addOrUpdateResource(De,"update",_e,Ee)})()}hasPath(){return(0,B.pC)(this.path)}_normalizePath(_e,Ee){return(0,B.Wi)(_e)?_e:(_e=_e.replace(/^\/+/,""),(0,B.pC)(Ee)&&(0,H.YP)(_e)&&(_e=(0,H.PF)(_e,Ee.itemUrl)),_e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};(0,R._)([(0,X.Cb)()],ee.prototype,"portalItem",void 0),(0,R._)([(0,X.Cb)({type:String,value:null})],ee.prototype,"path",null),(0,R._)([(0,Y.p)("path")],ee.prototype,"_castPath",null),(0,R._)([(0,X.Cb)({type:String,readOnly:!0})],ee.prototype,"url",null),(0,R._)([(0,X.Cb)({type:String,readOnly:!0})],ee.prototype,"itemRelativeUrl",null),ee=(0,R._)([(0,oe.j)("esri.portal.PortalItemResource")],ee);const ie=ee;let J=class extends se.Z{constructor(_e){super(_e),this.created=null,this.rating=null}};(0,R._)([(0,X.Cb)()],J.prototype,"created",void 0),(0,R._)([(0,X.Cb)()],J.prototype,"rating",void 0),J=(0,R._)([(0,oe.j)("esri.portal.PortalRating")],J);const ce=J;var ue;const pe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),he=new Set(["KML","GeoJson","CSV"]);let me=ue=class extends((0,Q.eC)(W.Z)){constructor(_e){super(_e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(_e){return(0,te.TJ)(ue,_e)}destroy(){this.portal=null}get displayName(){const _e=this.type,Ee=this.typeKeywords||[];let De=_e;return"Feature Service"===_e||"Feature Collection"===_e?De=Ee.includes("Table")?"Table":Ee.includes("Route Layer")?"Route Layer":Ee.includes("Markup")?"Markup":"Feature Layer":"Image Service"===_e?De=Ee.includes("Elevation 3D Layer")?"Elevation Layer":Ee.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===_e?De="Scene Layer":"Video Service"===_e?De="Video Layer":"Scene Package"===_e?De="Scene Layer Package":"Stream Service"===_e?De="Feature Layer":"Geoprocessing Service"===_e&&this.portal&&this.portal.isPortal?De=Ee.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===_e?De="Locator":"Geoenrichment Service"===_e?De="GeoEnrichment Service":"Microsoft Powerpoint"===_e?De="Microsoft PowerPoint":"GeoJson"===_e?De="GeoJSON":"Globe Service"===_e?De="Globe Layer":"Vector Tile Service"===_e?De="Tile Layer":"netCDF"===_e?De="NetCDF":"Map Service"===_e?De=Ee.includes("Spatiotemporal")||!Ee.includes("Hosted Service")&&!Ee.includes("Tiled")||Ee.includes("Relational")?"Map Image Layer":"Tile Layer":_e&&_e.toLowerCase().includes("add in")?De=_e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===_e?De="Big Data File Share":"Compact Tile Package"===_e?De="Tile Package (tpkx)":"OGCFeatureServer"===_e?De="OGC Feature Layer":"web mapping application"===_e&&Ee.includes("configurableApp")&&(De="Instant App"),De}readExtent(_e){return _e&&_e.length?new le.Z(_e[0][0],_e[0][1],_e[1][0],_e[1][1]):null}get iconUrl(){const _e=this.type&&this.type.toLowerCase()||"",Ee=this.typeKeywords||[];let Se,ye=!1,ve=!1,xe=!1,ze=!1,Ke=!1,We=!1;return _e.indexOf("service")>0||"feature collection"===_e||"kml"===_e||"wms"===_e||"wmts"===_e||"wfs"===_e?(ye=Ee.includes("Hosted Service"),"feature service"===_e||"feature collection"===_e||"kml"===_e||"wfs"===_e?(ve=Ee.includes("Table"),xe=Ee.includes("Route Layer"),ze=Ee.includes("Markup"),Ke=Ee.includes("Spatiotemporal"),We=Ee.includes("UtilityNetwork"),Se=Ke&&ve?"spatiotemporaltable":ve?"table":xe?"routelayer":ze?"markup":Ke?"spatiotemporal":ye?"featureshosted":We?"utilitynetwork":"features"):Se="map service"===_e||"wms"===_e||"wmts"===_e?ye||Ee.includes("Tiled")||"wmts"===_e?"maptiles":"mapimages":"scene service"===_e?Ee.includes("Line")?"sceneweblayerline":Ee.includes("3DObject")?"sceneweblayermultipatch":Ee.includes("Point")?"sceneweblayerpoint":Ee.includes("IntegratedMesh")?"sceneweblayermesh":Ee.includes("PointCloud")?"sceneweblayerpointcloud":Ee.includes("Polygon")?"sceneweblayerpolygon":Ee.includes("Building")?"sceneweblayerbuilding":Ee.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===_e?Ee.includes("Elevation 3D Layer")?"elevationlayer":Ee.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===_e?"streamlayer":"video service"===_e?"mediaservice":"vector tile service"===_e?"vectortile":"datastore catalog service"===_e?"datastorecollection":"geocoding service"===_e?"geocodeservice":"geoprocessing service"===_e?Ee.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"geodata service"===_e?"geodataservice":"layers"):Se="web map"===_e||"cityengine web scene"===_e?"maps":"web scene"===_e?Ee.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===_e&&Ee.includes("configurableApp")?"instantapps":"web mapping application"===_e||"mobile application"===_e||"application"===_e||"operation view"===_e||"desktop application"===_e?"apps":"map document"===_e||"map package"===_e||"published map"===_e||"scene document"===_e||"globe document"===_e||"basemap package"===_e||"mobile basemap package"===_e||"mobile map package"===_e||"project package"===_e||"project template"===_e||"pro map"===_e||"layout"===_e||"layer"===_e&&Ee.includes("ArcGIS Pro")||"explorer map"===_e&&Ee.indexOf("Explorer Document")?"mapsgray":"service definition"===_e||"csv"===_e||"shapefile"===_e||"cad drawing"===_e||"geojson"===_e||"360 vr experience"===_e||"netcdf"===_e||"administrative report"===_e?"datafiles":"explorer add in"===_e||"desktop add in"===_e||"windows viewer add in"===_e||"windows viewer configuration"===_e?"appsgray":"arcgis pro add in"===_e||"arcgis pro configuration"===_e?"addindesktop":"rule package"===_e||"file geodatabase"===_e||"sqlite geodatabase"===_e||"csv collection"===_e||"kml collection"===_e||"windows mobile package"===_e||"map template"===_e||"desktop application template"===_e||"gml"===_e||"arcpad package"===_e||"code sample"===_e||"form"===_e||"document link"===_e||"earth configuration"===_e||"operations dashboard add in"===_e||"rules package"===_e||"image"===_e||"workflow manager package"===_e||"explorer map"===_e&&Ee.includes("Explorer Mapping Application")||Ee.includes("Document")?"datafilesgray":"network analysis service"===_e||"geoprocessing service"===_e||"geodata service"===_e||"geometry service"===_e||"geoprocessing package"===_e||"locator package"===_e||"geoprocessing sample"===_e||"workflow manager service"===_e?"toolsgray":"layer"===_e||"layer package"===_e||"explorer layer"===_e?"layersgray":"scene package"===_e?"scenepackage":"mobile scene package"===_e?"mobilescenepackage":"tile package"===_e||"compact tile package"===_e?"tilepackage":"task file"===_e?"taskfile":"report template"===_e?"report-template":"statistical data collection"===_e?"statisticaldatacollection":"insights workbook"===_e?"workbook":"insights model"===_e?"insightsmodel":"insights page"===_e?"insightspage":"insights theme"===_e?"insightstheme":"hub initiative"===_e?"hubinitiative":"hubpage"===_e?"hubpage":"hub event"===_e?"hubevent":"hub site application"===_e?"hubsite":"hub project"===_e?"hubproject":"relational database connection"===_e?"relationaldatabaseconnection":"big data file share"===_e?"datastorecollection":"image collection"===_e?"imagecollection":"style"===_e?"style":"desktop style"===_e?"desktopstyle":"dashboard"===_e?"dashboard":"raster function template"===_e?"rasterprocessingtemplate":"vector tile package"===_e?"vectortilepackage":"ortho mapping project"===_e?"orthomappingproject":"ortho mapping template"===_e?"orthomappingtemplate":"solution"===_e?"solutions":"geopackage"===_e?"geopackage":"deep learning package"===_e?"deeplearningpackage":"real time analytic"===_e?"realtimeanalytics":"big data analytic"===_e?"bigdataanalytics":"feed"===_e?"feed":"excalibur imagery project"===_e?"excaliburimageryproject":"notebook"===_e?"notebook":"storymap"===_e?"storymap":"survey123 add in"===_e?"survey123addin":"mission"===_e?"mission":"mission report"===_e?"missionreport":"quickcapture project"===_e?"quickcaptureproject":"pro report"===_e?"proreport":"pro report template"===_e?"proreporttemplate":"urban model"===_e?"urbanmodel":"web experience"===_e?"experiencebuilder":"web experience template"===_e?"webexperiencetemplate":"experience builder widget"===_e?"experiencebuilderwidget":"experience builder widget package"===_e?"experiencebuilderwidgetpackage":"workflow"===_e?"workflow":"insights script"===_e?"insightsscript":"kernel gateway connection"===_e?"kernelgatewayconnection":"hub initiative template"===_e?"hubinitiativetemplate":"storymap theme"===_e?"storymaptheme":"knowledge graph"===_e?"knowledgegraph":"native application"===_e?"nativeapp":"native application installer"===_e?"nativeappinstaller":"link chart"===_e?"linkchart":"investigation"===_e?"investigation":"ogcfeatureserver"===_e?"features":"pro project"===_e?"proproject":"insights workbook package"===_e?"insightsworkbookpackage":"apache parquet"===_e?"apacheparquet":"notebook code snippets"===_e||"notebook code snippet library"===_e?"notebookcodesnippets":"suitability model"===_e?"suitabilitymodel":"esri classifier definition"===_e?"classifierdefinition":"esri classification schema"===_e?"classificationschema":"insights data engineering workbook"===_e?"dataengineeringworkbook":"insights data engineering model"===_e?"dataengineeringmodel":"deep learning studio project"===_e?"deeplearningproject":"discussion"===_e?"discussion":"maps",Se?(0,G.V)("esri/images/portal/"+Se+"16.png"):null}get isLayer(){return null!=this.type&&pe.has(this.type)}get itemPageUrl(){const _e=this.portal?.itemPageUrl;return _e&&this.id?`${_e}?id=${this.id}`:null}get itemUrl(){const _e=this.portal?.restUrl;return _e&&this.id?`${_e}/content/items/${this.id}`:null}get thumbnailUrl(){const _e=this.itemUrl,Ee=this.thumbnail;return _e&&Ee?this.portal?._normalizeUrl(`${_e}/info/${Ee}?f=json`)??null:null}get userItemUrl(){const _e=this.get("portal.restUrl");if(!_e)return null;const Ee=this.owner||this.get("portal.user.username");return Ee?`${_e}/content/users/${this.ownerFolder?`${Ee}/${this.ownerFolder}`:Ee}/items/${this.id}`:null}load(_e){const Ee=this.portal??(this.portal=de.Z.getDefault()),De=Ee.load(_e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?Ee._request(this.itemUrl,{signal:(0,B.pC)(_e)?_e.signal:null,query:{token:this.apiKey}}):{}).then(be=>{this.sourceJSON=be,this.read(be)});return this.addResolvingPromise(De),Promise.resolve(this)}addRating(_e){var Ee=this;return(0,D.Z)(function*(){const De={method:"post",query:{}};return _e instanceof ce&&(_e=_e.rating),null==_e||isNaN(_e)||"number"!=typeof _e||(De.query.rating=_e),Ee.portal?(yield Ee.portal._request(Ee.itemUrl+"/addRating",De),new ce({rating:_e,created:new Date})):null})()}clone(){const _e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,$.d9)(this.applicationProxies),avgRating:this.avgRating,categories:(0,$.d9)(this.categories),created:(0,$.d9)(this.created),culture:this.culture,description:this.description,extent:(0,$.d9)(this.extent),groupCategories:(0,$.d9)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,$.d9)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,$.d9)(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,$.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,$.d9)(this.typeKeywords),url:this.url};return this.loaded&&(_e.loadStatus="loaded"),new ue({sourceJSON:this.sourceJSON}).set(_e)}createPostQuery(){const _e=this.toJSON();for(const De of["tags","typeKeywords","categories"])_e[De]&&(_e[De]=_e[De].join(", "));const{extent:Ee}=_e;return Ee&&(_e.extent=JSON.stringify(Ee)),_e}deleteRating(){var _e=this;return(0,D.Z)(function*(){yield(0,B.s3)(_e.portal)._request(_e.itemUrl+"/deleteRating",{method:"post"})})()}fetchData(_e="json",Ee){return(0,B.s3)(this.portal)._request(this.itemUrl+"/data",{responseType:_e,...Ee,query:{token:this.apiKey}})}fetchRating(_e){var Ee=this;return(0,D.Z)(function*(){const De=yield(0,B.s3)(Ee.portal)._request(Ee.itemUrl+"/rating",{query:{token:Ee.apiKey},..._e});return null!=De.rating?(De.created=new Date(De.created),new ce(De)):null})()}fetchRelatedItems(_e,Ee){return(0,B.s3)(this.portal)._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{..._e,token:this.apiKey},...Ee},ue)}getThumbnailUrl(_e){let Ee=this.thumbnailUrl;return Ee&&_e&&(Ee+=`&w=${_e}`),Ee}reload(){return(0,B.s3)(this.portal)._request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(_e=>(this.sourceJSON=_e,this.read(_e),this))}update(_e){return this.id?this.load().then(()=>(0,B.s3)(this.portal)._signIn()).then(()=>{const Ee=_e&&_e.data,De={method:"post"};De.query=this.createPostQuery();for(const be in De.query)null===De.query[be]&&(De.query[be]="");return De.query.clearEmptyFields=!0,null!=Ee&&("string"==typeof Ee?De.query.text=Ee:"object"==typeof Ee&&(De.query.text=JSON.stringify(Ee))),this.portal._request(`${this.userItemUrl}/update`,De).then(()=>this.reload())}):Promise.reject(new Z.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(_e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const Ee=_e.thumbnail,De=_e.filename,be={method:"post"};if("string"==typeof Ee)be.query=(0,H.HK)(Ee)?{data:Ee}:{url:(0,H.hF)(Ee)},(0,B.pC)(De)&&(be.query.filename=De);else{const Se=new FormData;(0,B.pC)(De)?Se.append("file",Ee,De):Se.append("file",Ee),be.body=Se}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,be).then(()=>this.reload())}):Promise.reject(new Z.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}fetchResources(_e={},Ee){var De=this;return(0,D.Z)(function*(){return(yield v.e(587).then(v.bind(v,10587))).fetchResources(De,_e,Ee)})()}addResource(_e,Ee,De){var be=this;return(0,D.Z)(function*(){const Se=yield v.e(587).then(v.bind(v,10587));return _e.portalItem=be,Se.addOrUpdateResource(_e,"add",Ee,De)})()}removeResource(_e,Ee){var De=this;return(0,D.Z)(function*(){const be=yield v.e(587).then(v.bind(v,10587));if(_e.portalItem&&_e.portalItem.itemUrl!==De.itemUrl)throw new Z.Z("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return be.removeResource(De,_e,Ee)})()}removeAllResources(_e){var Ee=this;return(0,D.Z)(function*(){return(yield v.e(587).then(v.bind(v,10587))).removeAllResources(Ee,_e)})()}resourceFromPath(_e){return new ie({portalItem:this,path:_e})}toJSON(){const _e=this.extent,Ee={accessInformation:this.accessInformation,categories:(0,$.d9)(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:_e&&[[_e.xmin,_e.ymin],[_e.xmax,_e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,$.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,$.d9)(this.typeKeywords),url:this.url};return(0,$.yd)(Ee)}static fromJSON(_e){if(!_e)return null;if(_e.declaredClass)throw new Error("JSON object is already hydrated");return new ue({sourceJSON:_e})}_getPostQuery(){const _e=this.toJSON();for(const Ee in _e)"tags"===Ee&&null!==_e[Ee]&&(_e[Ee]=_e[Ee].join(", ")),"typeKeywords"===Ee&&null!==_e[Ee]&&(_e[Ee]=_e[Ee].join(", ")),"extent"===Ee&&_e[Ee]&&(_e[Ee]=JSON.stringify(_e[Ee]));return _e}};(0,R._)([(0,X.Cb)({type:["private","shared","org","public"]})],me.prototype,"access",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"accessInformation",void 0),(0,R._)([(0,X.Cb)({type:String})],me.prototype,"apiKey",void 0),(0,R._)([(0,X.Cb)({json:{read:{source:"appProxies"}}})],me.prototype,"applicationProxies",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"avgRating",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"categories",void 0),(0,R._)([(0,X.Cb)({type:Date})],me.prototype,"created",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"culture",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"description",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"displayName",null),(0,R._)([(0,X.Cb)({type:le.Z})],me.prototype,"extent",void 0),(0,R._)([(0,ae.r)("extent")],me.prototype,"readExtent",null),(0,R._)([(0,X.Cb)()],me.prototype,"groupCategories",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"iconUrl",null),(0,R._)([(0,X.Cb)()],me.prototype,"id",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"isLayer",null),(0,R._)([(0,X.Cb)()],me.prototype,"itemControl",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"itemPageUrl",null),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"itemUrl",null),(0,R._)([(0,X.Cb)()],me.prototype,"licenseInfo",void 0),(0,R._)([(0,X.Cb)({type:Date})],me.prototype,"modified",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"name",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"numComments",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"numRatings",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"numViews",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"owner",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"ownerFolder",void 0),(0,R._)([(0,X.Cb)({type:de.Z})],me.prototype,"portal",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"screenshots",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"size",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"snippet",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"sourceJSON",void 0),(0,R._)([(0,X.Cb)({type:String})],me.prototype,"spatialReference",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"tags",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"thumbnail",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"thumbnailUrl",null),(0,R._)([(0,X.Cb)()],me.prototype,"title",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"type",void 0),(0,R._)([(0,X.Cb)()],me.prototype,"typeKeywords",void 0),(0,R._)([(0,X.Cb)({type:String,json:{read(_e,Ee){if(he.has(Ee.type)){const De=this.portal?.restUrl;_e||(_e=De&&this.id?`${De}/content/items/${this.id}/data`:null)}return _e}}})],me.prototype,"url",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],me.prototype,"userItemUrl",null),me=ue=(0,R._)([(0,oe.j)("esri.portal.PortalItem")],me);const ge=me},6278:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var ae,D=v(17626),R=v(14517),G=v(2076),Z=v(58817),Q=v(62208),$=v(77712),B=(v(90912),v(76898)),H=v(2004),X=v(65234),te=v(46367);const oe=new G.X({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let le=ae=class extends R.Z{constructor(se){super(se),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(se){"asc"!==se&&"desc"!==se||this._set("sortOrder",se)}clone(){return new ae({categories:this.categories?(0,Z.d9)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(se,re){let j,Y;if(this.categories&&(j=this.categories.map(J=>Array.isArray(J)?JSON.stringify(J):J)),this.extent){const J=(0,te.iV)(this.extent,X.Z.WGS84);(0,Q.pC)(J)&&(Y=`${J.xmin},${J.ymin},${J.xmax},${J.ymax}`)}let ee=this.query;!this.disableExtraQuery&&se.extraQuery&&(ee="("+ee+")"+se.extraQuery);const ie={categories:j,bbox:Y,q:ee,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(ie.sortField=this.sortField.split(",").map(J=>oe.toJSON(J.trim())).join(","),ie.sortOrder=this.sortOrder),{query:{...re,...ie}}}};(0,D._)([(0,$.Cb)()],le.prototype,"categories",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"disableExtraQuery",void 0),(0,D._)([(0,$.Cb)({type:H.Z})],le.prototype,"extent",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"filter",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"num",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"query",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"sortField",void 0),(0,D._)([(0,$.Cb)()],le.prototype,"sortOrder",null),(0,D._)([(0,$.Cb)()],le.prototype,"start",void 0),le=ae=(0,D._)([(0,B.j)("esri.portal.PortalQueryParams")],le);const de=le},94508:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>oe});var D=v(17626),R=v(26584),G=v(86810),Z=v(77712),W=(v(85931),v(90912),v(76898));let B=class extends G.wq{constructor(le){super(le),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const le=this.get("portal.restUrl");return le?`${le}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new R.Z("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};(0,D._)([(0,Z.Cb)({type:Date})],B.prototype,"created",void 0),(0,D._)([(0,Z.Cb)()],B.prototype,"id",void 0),(0,D._)([(0,Z.Cb)()],B.prototype,"portal",void 0),(0,D._)([(0,Z.Cb)()],B.prototype,"title",void 0),(0,D._)([(0,Z.Cb)({readOnly:!0})],B.prototype,"url",null),(0,D._)([(0,Z.Cb)()],B.prototype,"username",void 0),B=(0,D._)([(0,W.j)("esri.portal.PortalFolder")],B);const H=B;var te,X=v(96245);let ae=te=class extends G.wq{constructor(...le){super(...le),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const le=this.url,de=this.thumbnail;return le&&de?this.portal._normalizeUrl(`${le}/info/${de}?f=json`):null}get userContentUrl(){const le=this.get("portal.restUrl");return le?`${le}/content/users/${this.username}`:null}get url(){const le=this.get("portal.restUrl");return le?`${le}/community/users/${this.username}`:null}addItem(le){const de=le&&le.item,se=le&&le.data,re=le&&le.folder,j={method:"post"};de&&(j.query=de.createPostQuery(),null!=se&&("string"==typeof se?j.query.text=se:"object"==typeof se&&(j.query.text=JSON.stringify(se))));let Y=this.userContentUrl;return re&&(Y+="/"+("string"==typeof re?re:re.id)),this.portal._request(Y+"/addItem",j).then(ee=>(de.id=ee.id,de.portal=this.portal,de.loaded?de.reload():de.load()))}deleteItem(le){let de=this.userContentUrl;return le.ownerFolder&&(de+="/"+le.ownerFolder),this.portal._request(de+`/items/${le.id}/delete`,{method:"post"}).then(()=>{le.id=null,le.portal=null})}deleteItems(le){const de=this.userContentUrl+"/deleteItems",se=le.map(re=>re.id);if(se.length){const re={method:"post",query:{items:se.join(",")}};return this.portal._request(de,re).then(()=>{le.forEach(j=>{j.id=null,j.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl??"",{query:{num:1}}).then(de=>{let se;return se=de&&de.folders?de.folders.map(re=>{const j=H.fromJSON(re);return j.portal=this.portal,j}):[],se})}fetchGroups(){return this.portal._request(this.url??"").then(le=>{let de;return de=le&&le.groups?le.groups.map(se=>{const re=X.default.fromJSON(se);return re.portal=this.portal,re}):[],de})}fetchItems(le){const de=le??{};let se,re=this.userContentUrl??"";return de.folder&&(re+="/"+de.folder.id),Promise.resolve().then(v.bind(v,55463)).then(({default:j})=>(se=j,this.portal._request(re,{query:{folders:!1,num:de.num||10,start:de.start||1,sortField:de.sortField||"created",sortOrder:de.sortOrder||"asc"}}))).then(j=>{let Y;return j&&j.items?(Y=j.items.map(ee=>{const ie=se.fromJSON(ee);return ie.portal=this.portal,ie}),Promise.all(Y.map(ee=>ee.load())).catch(ee=>ee).then(()=>({items:Y,nextStart:j.nextStart,total:j.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(le=>le.tags)}getThumbnailUrl(le){let de=this.thumbnailUrl;return de&&le&&(de+=`&w=${le}`),de}queryFavorites(le){return this.favGroupId?(this._favGroup||(this._favGroup=new X.default({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(le)):Promise.reject(new R.Z("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new R.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(le){if(!le)return null;if(le.declaredClass)throw new Error("JSON object is already hydrated");const de=new te;return de.sourceJSON=le,de.read(le),de}};(0,D._)([(0,Z.Cb)()],ae.prototype,"access",void 0),(0,D._)([(0,Z.Cb)({type:Date})],ae.prototype,"created",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"culture",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"description",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"email",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"favGroupId",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"fullName",void 0),(0,D._)([(0,Z.Cb)({type:Date})],ae.prototype,"modified",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"orgId",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"portal",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"preferredView",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"privileges",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"region",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"role",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"roleId",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"sourceJSON",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"thumbnail",void 0),(0,D._)([(0,Z.Cb)({readOnly:!0})],ae.prototype,"thumbnailUrl",null),(0,D._)([(0,Z.Cb)()],ae.prototype,"units",void 0),(0,D._)([(0,Z.Cb)({readOnly:!0})],ae.prototype,"userContentUrl",null),(0,D._)([(0,Z.Cb)({readOnly:!0})],ae.prototype,"url",null),(0,D._)([(0,Z.Cb)()],ae.prototype,"username",void 0),(0,D._)([(0,Z.Cb)()],ae.prototype,"userType",void 0),ae=te=(0,D._)([(0,W.j)("esri.portal.PortalUser")],ae);const oe=ae},35082:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{getGeometryServiceURL:()=>W,projectGeometry:()=>H});var D=v(15861),R=v(59318),G=v(26584),Z=v(84687),Q=v(39636),$=v(77294);function W(){return B.apply(this,arguments)}function B(){return(B=(0,D.Z)(function*(te=null,ae){if(R.Z.geometryServiceUrl)return R.Z.geometryServiceUrl;if(!te)throw new G.Z("internal:geometry-service-url-not-configured");let oe;oe="portal"in te?te.portal||Z.Z.getDefault():te,yield oe.load({signal:ae});const le=oe.helperServices?.geometry?.url;if(!le)throw new G.Z("internal:geometry-service-url-not-configured");return le})).apply(this,arguments)}function H(te,ae){return X.apply(this,arguments)}function X(){return(X=(0,D.Z)(function*(te,ae,oe=null,le){const de=yield W(oe,le),se=new $.Z;se.geometries=[te],se.outSpatialReference=ae;const re=yield(0,Q.i)(de,se,{signal:le});if(re&&Array.isArray(re)&&1===re.length)return re[0];throw new G.Z("internal:geometry-service-projection-failed")})).apply(this,arguments)}},24433:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>Z,a:()=>G});const D=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,R={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function G(Q){const $=Q?.match(D);if(!$)return null;const[,W,B,H]=$;if(!W)return null;let X=null,te=null,ae=null;const{devext:oe,qaext:le,www:de}=R;if(B)if(X=W,H)switch(H.toLowerCase()){case"devext":({customBaseUrl:te,portalHostname:ae}=oe);break;case"qa":({customBaseUrl:te,portalHostname:ae}=le);break;default:return null}else({customBaseUrl:te,portalHostname:ae}=de);else switch(W.toLowerCase()){case"devext":({customBaseUrl:te,portalHostname:ae}=oe);break;case"qaext":({customBaseUrl:te,portalHostname:ae}=le);break;case"www":({customBaseUrl:te,portalHostname:ae}=de);break;default:return null}return{customBaseUrl:te,isPortal:!1,portalHostname:ae,urlKey:X}}function Z(Q){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(Q)}},58926:(nt,Ae,v)=>{"use strict";v.d(Ae,{v:()=>R});const R=(0,v(2076).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},4832:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>_e});var J,D=v(15861),R=v(17626),G=v(20383),Z=v(2076),Q=v(58817),$=v(63290),W=v(62208),B=v(77712),H=v(66656),X=v(55342),te=v(68653),ae=v(76898),oe=v(99433),le=v(90912),de=v(36630),se=v(69357),re=v(2432),j=v(74400),Y=v(76457),ee=v(10914),ie=v(46679);const ue="percent-of-total",pe="field",he=new Z.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:ue,esriNormalizeByField:pe}),me=(0,le.se)(j.Z);let ge=J=class extends((0,re.W)(se.Z)){constructor(Ee){super(Ee),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(Ee,De,be){if(!Array.isArray(Ee))return;let Se=De.minValue;return Ee.map(ye=>{const ve=new j.Z;return ve.read(ye,be),null==ve.minValue&&(ve.minValue=Se),null==ve.maxValue&&(ve.maxValue=ve.minValue),Se=ve.maxValue,ve})}writeClassBreakInfos(Ee,De,be,Se){const ye=Ee.map(ve=>ve.write({},Se));this._areClassBreaksConsecutive()&&ye.forEach(ve=>delete ve.classMinValue),De[be]=ye}castField(Ee){return null==Ee?Ee:"function"==typeof Ee?($.Z.getLogger(this.declaredClass).error(".field: field must be a string value"),null):(0,le.Zs)(Ee)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let Ee=this._get("normalizationType");const De=!!this.normalizationField,be=null!=this.normalizationTotal;return De||be?(Ee=(De?pe:be&&ue)||null,De&&be&&$.Z.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):Ee!==pe&&Ee!==ue||(Ee=null),Ee}set normalizationType(Ee){this._set("normalizationType",Ee)}addClassBreakInfo(Ee,De,be){let Se=null;Se="number"==typeof Ee?new j.Z({minValue:Ee,maxValue:De,symbol:(0,G.se)(be)}):me((0,Q.d9)(Ee)),this.classBreakInfos.push(Se),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(Ee,De){const be=this.classBreakInfos.length;for(let Se=0;Se<be;Se++){const ye=[this.classBreakInfos[Se].minValue,this.classBreakInfos[Se].maxValue];if(ye[0]===Ee&&ye[1]===De){this.classBreakInfos.splice(Se,1);break}}}getBreakIndex(Ee,De){return this.valueExpression&&((0,W.Wi)(De)||(0,W.Wi)(De.arcade))&&$.Z.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(Ee,De):this._getBreakIndexForField(Ee)}getClassBreakInfo(Ee,De){var be=this;return(0,D.Z)(function*(){let Se=De;be.valueExpression&&((0,W.Wi)(De)||(0,W.Wi)(De.arcade))&&(Se={...Se,arcade:yield(0,ie.LC)()});const ye=be.getBreakIndex(Ee,Se);return-1!==ye?be.classBreakInfos[ye]:null})()}getSymbol(Ee,De){if(this.valueExpression&&((0,W.Wi)(De)||(0,W.Wi)(De.arcade)))return void $.Z.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const be=this.getBreakIndex(Ee,De);return be>-1?this.classBreakInfos[be].symbol:this.defaultSymbol}getSymbolAsync(Ee,De){var be=this;return(0,D.Z)(function*(){let Se=De;if(be.valueExpression&&((0,W.Wi)(De)||(0,W.Wi)(De.arcade))){const ve=yield(0,ie.LC)(),{arcadeUtils:xe}=ve;xe.hasGeometryOperations(be.valueExpression)&&(yield xe.enableGeometryOperations()),Se={...Se,arcade:ve}}const ye=be.getBreakIndex(Ee,Se);return ye>-1?be.classBreakInfos[ye].symbol:be.defaultSymbol})()}getSymbols(){const Ee=[];return this.classBreakInfos.forEach(De=>{De.symbol&&Ee.push(De.symbol)}),this.defaultSymbol&&Ee.push(this.defaultSymbol),Ee}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((Ee,De)=>Ee+De.getAttributeHash(),"")}getMeshHash(){const Ee=JSON.stringify(this.backgroundFillSymbol),De=JSON.stringify(this.defaultSymbol),be=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${Ee}.${De}.${this.classBreakInfos.reduce((Se,ye)=>Se+ye.getMeshHash(),"")}.${be}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new J({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,Q.d9)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,Q.d9)(this.visualVariables),legendOptions:(0,Q.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}collectRequiredFields(Ee,De){var be=this;return(0,D.Z)(function*(){const Se=[be.collectVVRequiredFields(Ee,De),be.collectSymbolFields(Ee,De)];yield Promise.all(Se)})()}collectSymbolFields(Ee,De){var be=this;return(0,D.Z)(function*(){const Se=[...be.getSymbols().map(ye=>ye.collectRequiredFields(Ee,De)),(0,de.io)(Ee,De,be.valueExpression)];(0,de.AB)(Ee,De,be.field),(0,de.AB)(Ee,De,be.normalizationField),yield Promise.all(Se)})()}_getBreakIndexForExpression(Ee,De){const{viewingMode:be,scale:Se,spatialReference:ye,arcade:ve}=(0,W.Pt)(De,{}),{valueExpression:xe}=this;let ze=this._compiledValueExpression.valueExpression===xe?this._compiledValueExpression.compiledFunction:null;const Ke=(0,W.Wg)(ve).arcadeUtils;if(!ze){const Ce=Ke.createSyntaxTree(xe);ze=Ke.createFunction(Ce),this._compiledValueExpression.compiledFunction=ze}this._compiledValueExpression.valueExpression=xe;const We=Ke.executeFunction(ze,Ke.createExecContext(Ee,Ke.getViewInfo({viewingMode:be,scale:Se,spatialReference:ye})));return this._getBreakIndexfromInfos(We)}_getBreakIndexForField(Ee){const be=Ee.attributes,Se=this.normalizationType;let ye=parseFloat(be[this.field]);if(Se){const ve=this.normalizationTotal,xe=parseFloat(this.normalizationField?be[this.normalizationField]:void 0);if("log"===Se)ye=Math.log(ye)*Math.LOG10E;else if(Se!==ue||null==ve||isNaN(ve)){if(Se===pe&&!isNaN(xe)){if(isNaN(ye)||isNaN(xe))return-1;ye/=xe}}else ye=ye/ve*100}return this._getBreakIndexfromInfos(ye)}_getBreakIndexfromInfos(Ee){const De=this.isMaxInclusive;if(null!=Ee&&"number"==typeof Ee&&!isNaN(Ee))for(let be=0;be<this.classBreakInfos.length;be++){const Se=[this.classBreakInfos[be].minValue,this.classBreakInfos[be].maxValue];if(Se[0]<=Ee&&(De?Ee<=Se[1]:Ee<Se[1]))return be}return-1}_areClassBreaksConsecutive(){const Ee=this.classBreakInfos,De=Ee.length;for(let be=1;be<De;be++)if(Ee[be-1].maxValue!==Ee[be].minValue)return!1;return!0}};(0,R._)([(0,B.Cb)(Y.KK)],ge.prototype,"backgroundFillSymbol",void 0),(0,R._)([(0,B.Cb)({type:[j.Z]})],ge.prototype,"classBreakInfos",void 0),(0,R._)([(0,te.r)("classBreakInfos")],ge.prototype,"readClassBreakInfos",null),(0,R._)([(0,oe.c)("classBreakInfos")],ge.prototype,"writeClassBreakInfos",null),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ge.prototype,"defaultLabel",void 0),(0,R._)([(0,B.Cb)(Y.Gn)],ge.prototype,"defaultSymbol",void 0),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ge.prototype,"field",void 0),(0,R._)([(0,H.p)("field")],ge.prototype,"castField",null),(0,R._)([(0,B.Cb)({type:Boolean})],ge.prototype,"isMaxInclusive",void 0),(0,R._)([(0,B.Cb)({type:ee.I,json:{write:!0}})],ge.prototype,"legendOptions",void 0),(0,R._)([(0,B.Cb)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],ge.prototype,"minValue",null),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ge.prototype,"normalizationField",void 0),(0,R._)([(0,B.Cb)({type:Number,cast:Ee=>(0,le.q9)(Ee),json:{write:!0}})],ge.prototype,"normalizationTotal",void 0),(0,R._)([(0,B.Cb)({type:he.apiValues,value:null,json:{type:he.jsonValues,read:he.read,write:he.write}})],ge.prototype,"normalizationType",null),(0,R._)([(0,X.J)({classBreaks:"class-breaks"})],ge.prototype,"type",void 0),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ge.prototype,"valueExpression",void 0),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ge.prototype,"valueExpressionTitle",void 0),ge=J=(0,R._)([(0,ae.j)("esri.renderers.ClassBreaksRenderer")],ge);const _e=ge},49067:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var ae,D=v(15861),R=v(17626),G=v(58817),Z=v(77712),$=(v(90912),v(76898)),W=v(99433),B=v(36630),H=v(69357),X=v(2432),te=v(29996);let oe=ae=class extends((0,X.W)(H.Z)){constructor(de){super(de),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new te.DictionaryLoader(this.url,this.config,this.fieldMap)}writeData(de,se){de&&(se.scalingExpressionInfo={expression:de,returnType:"number"})}writeVisualVariables(de,se,re,j){j?.origin||super.writeVisualVariables(de,se,re,j)}clone(){return new ae({config:(0,G.d9)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,G.d9)(this.fieldMap),url:(0,G.d9)(this.url),visualVariables:(0,G.d9)(this.visualVariables)})}getSymbolAsync(de,se){var re=this;return(0,D.Z)(function*(){return re._loader.getSymbolAsync(de,se)})()}collectRequiredFields(de,se){var re=this;return(0,D.Z)(function*(){yield re.collectVVRequiredFields(de,se),re.scaleExpression&&(yield(0,B.io)(de,se,re.scaleExpression));for(const j in re.fieldMap){const Y=re.fieldMap[j];se.has(Y)&&de.add(Y)}})()}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((de,se)=>de+se.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,R._)([(0,Z.Cb)({type:te.DictionaryLoader})],oe.prototype,"_loader",null),(0,R._)([(0,Z.Cb)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],oe.prototype,"config",void 0),(0,R._)([(0,Z.Cb)({type:Object,json:{write:!0}})],oe.prototype,"fieldMap",void 0),(0,R._)([(0,Z.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],oe.prototype,"scaleExpression",void 0),(0,R._)([(0,W.c)("scaleExpression")],oe.prototype,"writeData",null),(0,R._)([(0,Z.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(de){return{enabled:!!de&&!!this.scaleExpression}}}}})],oe.prototype,"scaleExpressionTitle",void 0),(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],oe.prototype,"url",void 0),(0,R._)([(0,W.c)("visualVariables")],oe.prototype,"writeVisualVariables",null),oe=ae=(0,R._)([(0,$.j)("esri.renderers.DictionaryRenderer")],oe);const le=oe},96794:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>J});var de,D=v(15861),R=v(17626),G=v(91558),Z=v(58817),Q=v(77712),W=(v(90912),v(55342)),B=v(76898),H=v(36630),X=v(69357),te=v(2432),ae=v(41832),oe=v(86810);v(85931);let se=de=class extends oe.wq{constructor(){super(...arguments),this.unit=null}clone(){return new de({unit:this.unit})}};(0,R._)([(0,Q.Cb)({type:String,json:{write:!0}})],se.prototype,"unit",void 0),se=de=(0,R._)([(0,B.j)("esri.renderers.support.DotDensityLegendOptions")],se);const re=se;var ee,j=v(88493),Y=v(52068);let ie=ee=class extends((0,te.W)(X.Z)){constructor(ce){super(ce),this.attributes=null,this.backgroundColor=new G.Z([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Y.Z,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(ce){if(null==this.referenceScale)return this.dotValue;const ue=ce/this.referenceScale*this.dotValue;return ue<1?1:ue}getSymbol(){return new j.Z({outline:this.outline})}getSymbolAsync(){var ce=this;return(0,D.Z)(function*(){return ce.getSymbol()})()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((ce,ue)=>ce+ue.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new ee({attributes:(0,Z.d9)(this.attributes),backgroundColor:(0,Z.d9)(this.backgroundColor),dotBlendingEnabled:(0,Z.d9)(this.dotBlendingEnabled),dotShape:(0,Z.d9)(this.dotShape),dotSize:(0,Z.d9)(this.dotSize),dotValue:(0,Z.d9)(this.dotValue),legendOptions:(0,Z.d9)(this.legendOptions),outline:(0,Z.d9)(this.outline),referenceScale:(0,Z.d9)(this.referenceScale),visualVariables:(0,Z.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(ue=>ue.field||ue.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}collectRequiredFields(ce,ue){var pe=this;return(0,D.Z)(function*(){yield pe.collectVVRequiredFields(ce,ue);for(const he of pe.attributes??[])he.valueExpression&&(yield(0,H.io)(ce,ue,he.valueExpression)),he.field&&ce.add(he.field)})()}};(0,R._)([(0,Q.Cb)({type:[ae.Z],json:{write:!0}})],ie.prototype,"attributes",void 0),(0,R._)([(0,Q.Cb)({type:G.Z,json:{write:!0}})],ie.prototype,"backgroundColor",void 0),(0,R._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],ie.prototype,"dotBlendingEnabled",void 0),(0,R._)([(0,Q.Cb)({type:String,json:{write:!1}})],ie.prototype,"dotShape",void 0),(0,R._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ie.prototype,"dotSize",void 0),(0,R._)([(0,Q.Cb)({type:re,json:{write:!0}})],ie.prototype,"legendOptions",void 0),(0,R._)([(0,Q.Cb)({type:Y.Z,json:{default:null,write:!0}})],ie.prototype,"outline",void 0),(0,R._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ie.prototype,"dotValue",void 0),(0,R._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ie.prototype,"referenceScale",void 0),(0,R._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ie.prototype,"seed",void 0),(0,R._)([(0,W.J)({dotDensity:"dot-density"})],ie.prototype,"type",void 0),ie=ee=(0,R._)([(0,B.j)("esri.renderers.DotDensityRenderer")],ie);const J=ie},69747:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Ee});var D=v(15861),R=v(17626),G=v(91558),Q=(v(20383),v(55538)),$=v(58817),W=v(63290),B=v(50618),H=v(23841),X=v(77712),te=v(52323),oe=(v(90912),v(55342)),le=v(76898),de=v(36630),se=v(69357),re=v(15312),j=v(52372),Y=v(79608),ee=v(86810);v(85931);let J=class extends((0,Y.J)(ee.wq)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],J.prototype,"minLabel",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],J.prototype,"maxLabel",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],J.prototype,"title",void 0),J=(0,R._)([(0,le.j)("esri.renderers.support.HeatmapLegendOptions")],J);var pe,ce=v(36859),ue=v(57213);const he="esri.renderers.HeatmapRenderer",me=W.Z.getLogger(he);function ge(De){if(null!=De){const{maxDensity:be,minDensity:Se,radius:ye}=De;if(null!=be||null!=Se||null!=ye){const{blurRadius:ve,maxPixelIntensity:xe,minPixelIntensity:ze,...Ke}=De;return Ke}}return De}let _e=pe=class extends se.Z{constructor(De){super(De),this.authoringInfo=null,this.colorStops=[new j.Z({ratio:0,color:new G.Z("rgba(255, 140, 0, 0)")}),new j.Z({ratio:.75,color:new G.Z("rgba(255, 140, 0, 1)")}),new j.Z({ratio:.9,color:new G.Z("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(De){return ge(De)}get blurRadius(){return(0,ce.AJ)(this.radius)}set blurRadius(De){const be=this.maxPixelIntensity,Se=this.minPixelIntensity;this._set("radius",(0,ce.k0)(De)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",be*this._pixelIntensityToDensity),this._set("minDensity",Se*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(De){this._set("maxDensity",De*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(De){this._set("minDensity",De*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(ce.nu**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(De,be){this._warnedProps[De]||"user"===(0,te.vw)(this).getDefaultOrigin()&&(this._warnedProps[De]=!0,(0,B.Os)(()=>{(0,Q.Mr)(me,De,{replacement:`${String(be)} (suggested value: ${this._get(be)})`,version:"4.24"})}))}read(De,be){De=ge(De),super.read(De,be)}getSymbol(){return new ue.Z}getSymbolAsync(){var De=this;return(0,D.Z)(function*(){return De.getSymbol()})()}getSymbols(){return[this.getSymbol()]}collectRequiredFields(De,be){var Se=this;return(0,D.Z)(function*(){const ye=Se.field,ve=Se.valueExpression;ye&&"string"==typeof ye&&(yield(0,de.AB)(De,be,ye)),ve&&"string"==typeof ve&&(yield(0,de.io)(De,be,ve))})()}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new pe({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,$.d9)(this.colorStops),field:this.field,legendOptions:(0,$.d9)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,R._)([(0,X.Cb)({type:re.Z,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],_e.prototype,"authoringInfo",void 0),(0,R._)([(0,X.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_e.prototype,"blurRadius",null),(0,R._)([(0,X.Cb)({type:[j.Z],json:{write:!0}})],_e.prototype,"colorStops",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],_e.prototype,"field",void 0),(0,R._)([(0,X.Cb)({type:Number,json:{write:{overridePolicy:(De,be,Se)=>({enabled:null==Se})},origins:{"web-scene":{write:!1}}}})],_e.prototype,"fieldOffset",void 0),(0,R._)([(0,X.Cb)({type:J,json:{write:!0}})],_e.prototype,"legendOptions",void 0),(0,R._)([(0,X.Cb)({type:Number,json:{write:!0}})],_e.prototype,"maxDensity",void 0),(0,R._)([(0,X.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_e.prototype,"maxPixelIntensity",null),(0,R._)([(0,X.Cb)({type:Number,json:{write:!0}})],_e.prototype,"minDensity",void 0),(0,R._)([(0,X.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_e.prototype,"minPixelIntensity",null),(0,R._)([(0,X.Cb)({type:Number,cast:H.t_,json:{write:!0}})],_e.prototype,"radius",void 0),(0,R._)([(0,X.Cb)({type:Number,range:{min:0},json:{default:0,write:!0}})],_e.prototype,"referenceScale",void 0),(0,R._)([(0,oe.J)({heatmap:"heatmap"})],_e.prototype,"type",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],_e.prototype,"valueExpression",void 0),(0,R._)([(0,X.Cb)({type:String})],_e.prototype,"valueExpressionTitle",void 0),(0,R._)([(0,X.Cb)({readOnly:!0})],_e.prototype,"_pixelIntensityToDensity",null),_e=pe=(0,R._)([(0,le.j)(he)],_e);const Ee=_e},40425:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ue});var D=v(15861),R=v(17626),G=v(91558),Q=(v(20383),v(79608)),$=v(62208),W=v(23841),B=v(77712),te=(v(85931),v(90912),v(55342)),ae=v(76898),oe=v(36630),le=v(69357),de=v(2432),se=v(41832),re=v(86810);let j=class extends((0,Q.J)(re.wq)){constructor(){super(...arguments),this.color=new G.Z([0,0,0,0]),this.label=null,this.threshold=0}};(0,R._)([(0,B.Cb)({type:G.Z,json:{write:!0}})],j.prototype,"color",void 0),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],j.prototype,"label",void 0),(0,R._)([(0,B.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],j.prototype,"threshold",void 0),j=(0,R._)([(0,ae.j)("esri.renderers.support.OthersCategory")],j);let Y=class extends((0,Q.J)(re.wq)){constructor(){super(...arguments),this.title=null}};(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],Y.prototype,"title",void 0),Y=(0,R._)([(0,ae.j)("esri.renderers.support.PieChartLegendOptions")],Y);var ee=v(57213),ie=v(88493),J=v(52068);let ce=class extends((0,de.W)((0,Q.J)(le.Z))){constructor(pe){super(pe),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new G.Z([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new j,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new ee.Z({size:this.size?this.size/2+(this.outline?.width||0):0})}getSymbolAsync(){var pe=this;return(0,D.Z)(function*(){return pe.getSymbol()})()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter($.pC)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((pe,he)=>pe+he.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((pe,he)=>pe+JSON.stringify(he),"")}collectRequiredFields(pe,he){var me=this;return(0,D.Z)(function*(){yield me.collectVVRequiredFields(pe,he);for(const ge of me.attributes)ge.valueExpression&&(yield(0,oe.io)(pe,he,ge.valueExpression)),ge.field&&pe.add(ge.field)})()}};(0,R._)([(0,B.Cb)({type:[se.Z],json:{write:!0}})],ce.prototype,"attributes",void 0),(0,R._)([(0,B.Cb)({type:ie.Z,json:{default:null,write:!0}})],ce.prototype,"backgroundFillSymbol",void 0),(0,R._)([(0,B.Cb)({type:G.Z,json:{write:!0}})],ce.prototype,"defaultColor",void 0),(0,R._)([(0,B.Cb)({type:String,json:{write:!0}})],ce.prototype,"defaultLabel",void 0),(0,R._)([(0,B.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],ce.prototype,"holePercentage",void 0),(0,R._)([(0,B.Cb)({type:j,json:{write:!0}})],ce.prototype,"othersCategory",void 0),(0,R._)([(0,B.Cb)({type:Y,json:{write:!0}})],ce.prototype,"legendOptions",void 0),(0,R._)([(0,B.Cb)({type:J.Z,json:{default:null,write:!0}})],ce.prototype,"outline",void 0),(0,R._)([(0,B.Cb)({type:Number,cast:W.t_,json:{write:!0}})],ce.prototype,"size",void 0),(0,R._)([(0,te.J)({pieChart:"pie-chart"})],ce.prototype,"type",void 0),ce=(0,R._)([(0,ae.j)("esri.renderers.PieChartRenderer")],ce);const ue=ce},69357:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var D=v(15861),R=v(17626),G=v(2076),Z=v(86810),Q=v(77712),B=(v(85931),v(90912),v(76898)),H=v(15312);const X=new G.X({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let te=class extends Z.wq{constructor(oe){super(oe),this.authoringInfo=null,this.type=null}getRequiredFields(oe){var le=this;return(0,D.Z)(function*(){if(!le.collectRequiredFields)return[];const de=new Set;return yield le.collectRequiredFields(de,oe),Array.from(de).sort()})()}getSymbol(oe,le){}getSymbolAsync(oe,le){return(0,D.Z)(function*(){})()}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,R._)([(0,Q.Cb)({type:H.Z,json:{write:!0}})],te.prototype,"authoringInfo",void 0),(0,R._)([(0,Q.Cb)({type:X.apiValues,readOnly:!0,json:{type:X.jsonValues,read:!1,write:{writer:X.write,ignoreOrigin:!0}}})],te.prototype,"type",void 0),te=(0,R._)([(0,B.j)("esri.renderers.Renderer")],te);const ae=te},40342:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var te,D=v(15861),R=v(17626),G=v(58817),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(69357),H=v(2432),X=v(76457);let ae=te=class extends((0,H.W)(B.Z)){constructor(le){super(le),this.description=null,this.label=null,this.symbol=null,this.type="simple"}collectRequiredFields(le,de){var se=this;return(0,D.Z)(function*(){yield Promise.all([se.collectSymbolFields(le,de),se.collectVVRequiredFields(le,de)])})()}collectSymbolFields(le,de){var se=this;return(0,D.Z)(function*(){yield Promise.all(se.getSymbols().map(re=>re.collectRequiredFields(le,de)))})()}getSymbol(le,de){return this.symbol}getSymbolAsync(le,de){var se=this;return(0,D.Z)(function*(){return se.symbol})()}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((le,de)=>le+de.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((le,de)=>le+JSON.stringify(de),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new te({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:(0,G.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],ae.prototype,"description",void 0),(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],ae.prototype,"label",void 0),(0,R._)([(0,Z.Cb)(X.Gn)],ae.prototype,"symbol",void 0),(0,R._)([(0,$.J)({simple:"simple"})],ae.prototype,"type",void 0),ae=te=(0,R._)([(0,W.j)("esri.renderers.SimpleRenderer")],ae);const oe=ae},73640:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Ge});var D=v(15861),R=v(17626),G=v(20383),Z=v(26584),Q=v(58817),$=v(63290),W=v(62208),B=v(94113),H=v(32917),X=v(77712),te=v(66656),ae=v(55342),oe=v(68653),le=v(76898),de=v(99433),se=v(84682),re=v(90912),j=v(36630),Y=v(84687),ee=v(69357),ie=v(2432),J=v(76457),ce=v(10914),ue=v(79608),pe=v(86810);v(85931);let me=class extends((0,ue.J)(pe.wq)){constructor(Pe){super(Pe),this.value=null,this.value2=null,this.value3=null}};(0,R._)([(0,X.Cb)(J.GY)],me.prototype,"value",void 0),(0,R._)([(0,X.Cb)(J.GY)],me.prototype,"value2",void 0),(0,R._)([(0,X.Cb)(J.GY)],me.prototype,"value3",void 0),me=(0,R._)([(0,le.j)("esri.renderers.support.UniqueValue")],me);const ge=me;let _e=class extends((0,ue.J)(pe.wq)){constructor(Pe){super(Pe),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(Pe){if(null==Pe)return null;const Le=typeof(Pe=Array.isArray(Pe)?Pe:[Pe])[0];return"string"===Le||"number"===Le?Pe.map(Me=>new ge({value:Me})):"object"===Le?Pe[0]instanceof ge?Pe:Pe.map(Me=>new ge(Me)):null}};(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],_e.prototype,"description",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],_e.prototype,"label",void 0),(0,R._)([(0,X.Cb)(J.Gn)],_e.prototype,"symbol",void 0),(0,R._)([(0,X.Cb)({type:[ge],json:{type:[[String]],read:{reader:Pe=>Pe?Pe.map(Le=>new ge({value:Le[0],value2:Le[1],value3:Le[2]})):null},write:{writer:(Pe,Le)=>{const Me=[];for(const Ne of Pe){const Xe=[Ne.value,Ne.value2,Ne.value3].filter(W.pC).map(Ye=>Ye.toString());Me.push(Xe)}Le.values=Me}}}})],_e.prototype,"values",void 0),(0,R._)([(0,te.p)("values")],_e.prototype,"castValues",null),_e=(0,R._)([(0,le.j)("esri.renderers.support.UniqueValueClass")],_e);const Ee=_e;let De=class extends((0,ue.J)(pe.wq)){constructor(Pe){super(Pe),this.heading=null,this.classes=null}};(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],De.prototype,"heading",void 0),(0,R._)([(0,X.Cb)({type:[Ee],json:{write:!0}})],De.prototype,"classes",void 0),De=(0,R._)([(0,le.j)("esri.renderers.support.UniqueValueGroup")],De);const be=De;var Ke,Se=v(87266),ye=v(46679),ve=v(29840),xe=v(71937),ze=v(12874);const We="esri.renderers.UniqueValueRenderer",Ce=$.Z.getLogger(We),Be="uvInfos-watcher",Fe="uvGroups-watcher",Re=(0,re.se)(Se.Z);let Ie=Ke=class extends((0,ie.W)(ee.Z)){constructor(Pe){super(Pe),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(Le,Me){if(!Le&&!Me)return;if(!Le||!Me)return{type:"complete",oldValue:Le,newValue:Me};let Ne=!1;const Xe={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let Ye=0;Ye<Me.length;Ye++){const Je=Le.find(rt=>rt.value===Me[Ye].value);Je?(0,se.Hg)(Je,Me[Ye])?(Xe.changed.push({type:"complete",oldValue:Je,newValue:Me[Ye]}),Ne=!0):Xe.unchanged.push({oldValue:Je,newValue:Me[Ye]}):(Xe.added.push(Me[Ye]),Ne=!0)}for(let Ye=0;Ye<Le.length;Ye++)Me.find(Je=>Je.value===Le[Ye].value)||(Xe.removed.push(Le[Ye]),Ne=!0);return Ne?Xe:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(Pe){this._set("field",Pe),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(Pe){return null==Pe||"function"==typeof Pe?Pe:(0,re.Zs)(Pe)}writeField(Pe,Le,Me,Ne){"string"==typeof Pe?Le[Me]=Pe:Ne&&Ne.messages?Ne.messages.push(new Z.Z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Ce.error(".field: cannot write field to JSON since it's not a string value")}set field2(Pe){this._set("field2",Pe),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(Pe){this._set("field3",Pe),this._updateUniqueValues()}set valueExpression(Pe){this._set("valueExpression",Pe),this._updateUniqueValues()}set defaultSymbol(Pe){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",Pe)}set fieldDelimiter(Pe){this._set("fieldDelimiter",Pe),this._updateUniqueValues()}readPortal(Pe,Le,Me){return Me.portal||Y.Z.getDefault()}readStyleOrigin(Pe,Le,Me){if(Le.styleName)return Object.freeze({styleName:Le.styleName});if(Le.styleUrl){const Ne=(0,ve.f)(Le.styleUrl,Me);return Object.freeze({styleUrl:Ne})}}writeStyleOrigin(Pe,Le,Me,Ne){Pe.styleName?Le.styleName=Pe.styleName:Pe.styleUrl&&(Le.styleUrl=(0,ve.t)(Pe.styleUrl,Ne))}set uniqueValueGroups(Pe){this.styleOrigin?Ce.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",Pe),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(Pe){this.styleOrigin?Ce.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",Pe),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(Pe,Le){if(this.styleOrigin)return void Ce.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let Me;Me="object"==typeof Pe?Re(Pe):new Se.Z({value:Pe,symbol:(0,G.se)(Le)}),this.uniqueValueInfos?.push(Me),this._valueInfoMap[Me.value]=Me,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(Pe){if(this.styleOrigin)return void Ce.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const Le=this.uniqueValueInfos;if(Le)for(let Me=0;Me<Le.length;Me++)if(Le[Me].value===Pe+""){delete this._valueInfoMap[Pe],Le.splice(Me,1);break}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}getUniqueValueInfo(Pe,Le){var Me=this;return(0,D.Z)(function*(){let Ne=Le;return Me.valueExpression&&((0,W.Wi)(Le)||(0,W.Wi)(Le.arcade))&&(Ne={...Ne,arcade:yield(0,ye.LC)()}),Me._getUniqueValueInfo(Pe,Ne)})()}getSymbol(Pe,Le){if(this.valueExpression&&((0,W.Wi)(Le)||(0,W.Wi)(Le.arcade)))return void Ce.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const Me=this._getUniqueValueInfo(Pe,Le);return Me&&Me.symbol||this.defaultSymbol}getSymbolAsync(Pe,Le){var Me=this;return(0,D.Z)(function*(){let Ne=Le;if(Me.valueExpression&&((0,W.Wi)(Ne)||(0,W.Wi)(Ne.arcade))){const Ye=yield(0,ye.LC)(),{arcadeUtils:Je}=Ye;Je.hasGeometryOperations(Me.valueExpression)&&(yield Je.enableGeometryOperations()),Ne={...Ne,arcade:Ye}}const Xe=Me._getUniqueValueInfo(Pe,Ne);return Xe&&Xe.symbol||Me.defaultSymbol})()}getSymbols(){const Pe=[];for(const Le of this.uniqueValueInfos??[])Le.symbol&&Pe.push(Le.symbol);return this.defaultSymbol&&Pe.push(this.defaultSymbol),Pe}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((Pe,Le)=>Pe+Le.getAttributeHash(),"")}getMeshHash(){const Pe=JSON.stringify(this.backgroundFillSymbol),Le=JSON.stringify(this.defaultSymbol),Me=this.uniqueValueInfos?.reduce((Ne,Xe)=>Ne+Xe.getMeshHash(),"");return`${Pe}.${Le}.${Me}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const Pe=new Ke({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,Q.d9)(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,Q.d9)(this.visualVariables),legendOptions:(0,Q.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:(0,Q.d9)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(Pe._isDefaultSymbolDerived=!0),Pe._set("portal",this.portal);const Le=(0,Q.d9)(this.uniqueValueInfos),Me=(0,Q.d9)(this.uniqueValueGroups);return this.styleOrigin&&(Pe._set("styleOrigin",Object.freeze((0,Q.d9)(this.styleOrigin))),Object.freeze(Le),Object.freeze(Me)),Pe._set("uniqueValueInfos",Le),Pe._updateValueInfoMap(),Pe._set("uniqueValueGroups",Me),Pe._isInfosSource=this._isInfosSource,Pe._watchUniqueValueInfosAndGroups(),Pe}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}collectRequiredFields(Pe,Le){var Me=this;return(0,D.Z)(function*(){const Ne=[Me.collectVVRequiredFields(Pe,Le),Me.collectSymbolFields(Pe,Le)];yield Promise.all(Ne)})()}collectSymbolFields(Pe,Le){var Me=this;return(0,D.Z)(function*(){const Ne=[...Me.getSymbols().map(Xe=>Xe.collectRequiredFields(Pe,Le)),(0,j.io)(Pe,Le,Me.valueExpression)];(0,j.AB)(Pe,Le,Me.field),(0,j.AB)(Pe,Le,Me.field2),(0,j.AB)(Pe,Le,Me.field3),yield Promise.all(Ne)})()}populateFromStyle(){return(0,xe.n2)(this.styleOrigin,{portal:this.portal}).then(Pe=>{const Le=[];return this._valueInfoMap={},Pe&&Pe.data&&Array.isArray(Pe.data.items)&&Pe.data.items.forEach(Me=>{const Ne=new ze.Z({styleUrl:Pe.styleUrl,styleName:Pe.styleName,portal:this.portal,name:Me.name});this.defaultSymbol||Me.name!==Pe.data.defaultItem||(this.defaultSymbol=Ne,this._isDefaultSymbolDerived=!0);const Xe=new Se.Z({value:Me.name,symbol:Ne});Le.push(Xe),this._valueInfoMap[Me.name]=Xe}),this._set("uniqueValueInfos",Object.freeze(Le)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:Pe}=this;if(Pe)for(const Le of Pe)this._valueInfoMap[Le.value+""]=Le}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Be);const{uniqueValueInfos:Pe}=this;if(Pe){const Le=[];for(const Me of Pe)Le.push((0,H.YP)(()=>({symbol:Me.symbol,value:Me.value,label:Me.label,description:Me.description}),(Ne,Xe)=>{Ne!==Xe&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(Le,Be)}}_watchUniqueValueGroups(){this.removeHandles(Fe);const{uniqueValueGroups:Pe}=this;if(Pe){const Le=[];for(const Me of Pe){Le.push((0,H.YP)(()=>({classes:Me.classes}),(Ne,Xe)=>{Ne!==Xe&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const Ne of Me.classes)Le.push((0,H.YP)(()=>({symbol:Ne.symbol,values:Ne.values,label:Ne.label,description:Ne.description}),(Xe,Ye)=>{Xe!==Ye&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(Le,Fe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const Pe=[],{field:Le,field2:Me,field3:Ne,fieldDelimiter:Xe,uniqueValueGroups:Ye,valueExpression:Je}=this;if(!Le&&!Je)return this._set("uniqueValueInfos",Pe),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const rt=!(!Le||!Me);for(const tt of Ye)for(const et of tt.classes??[]){const{symbol:qe,label:ot,values:ut,description:_t}=et;for(const Ct of ut??[]){const{value:vt,value2:Lt,value3:jt}=Ct,$t=[vt];Me&&$t.push(Lt),Ne&&$t.push(jt);const Wt=rt?$t.join(Xe||""):$t[0];Pe.push(new Se.Z({symbol:qe,label:ot,value:Wt,description:_t}))}}this._set("uniqueValueInfos",Pe),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(Pe=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:Le,field2:Me,valueExpression:Ne,fieldDelimiter:Xe,uniqueValueInfos:Ye}=this;if(!Le&&!Ne||!Ye.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const Je=!(!Le||!Me),rt=Ye.map(et=>{const{symbol:qe,label:ot,value:ut,description:_t}=et,[Ct,vt,Lt]=Je?ut?.toString()?.split(Xe||"")||[]:[ut];return new Ee({symbol:qe,label:ot,description:_t,values:[new ge({value:Ct,value2:vt,value3:Lt})]})}),tt=[new be({classes:rt})];Pe&&Object.freeze(tt),this._set("uniqueValueGroups",tt),this._watchUniqueValueGroups()}_getUniqueValueInfo(Pe,Le){return this.valueExpression?this._getUnqiueValueInfoForExpression(Pe,Le):this._getUnqiueValueInfoForFields(Pe)}_getUnqiueValueInfoForExpression(Pe,Le){const{viewingMode:Me,scale:Ne,spatialReference:Xe,arcade:Ye}=(0,W.Pt)(Le,{});let Je=this._cache.compiledFunc;const rt=(0,W.Wg)(Ye).arcadeUtils;if(!Je){const et=rt.createSyntaxTree(this.valueExpression);Je=rt.createFunction(et),this._cache.compiledFunc=Je}const tt=rt.executeFunction(Je,rt.createExecContext(Pe,rt.getViewInfo({viewingMode:Me,scale:Ne,spatialReference:Xe})));return this._valueInfoMap[tt+""]}_getUnqiueValueInfoForFields(Pe){const Le=this.field,Me=Pe.attributes;let Ne;if("function"!=typeof Le&&this.field2){const Xe=this.field2,Ye=this.field3,Je=[];Le&&Je.push(Me[Le]),Xe&&Je.push(Me[Xe]),Ye&&Je.push(Me[Ye]),Ne=Je.join(this.fieldDelimiter||"")}else"function"==typeof Le?Ne=Le(Pe):Le&&(Ne=Me[Le]);return this._valueInfoMap[Ne+""]}static fromPortalStyle(Pe,Le){const Me=new Ke(Le&&Le.properties);Me._set("styleOrigin",Object.freeze({styleName:Pe})),Me._set("portal",Le&&Le.portal||Y.Z.getDefault());const Ne=Me.populateFromStyle();return Ne.catch(Xe=>{Ce.error(`#fromPortalStyle('${Pe}'[, ...])`,"Failed to create unique value renderer from style name",Xe)}),Ne}static fromStyleUrl(Pe,Le){const Me=new Ke(Le&&Le.properties);Me._set("styleOrigin",Object.freeze({styleUrl:Pe}));const Ne=Me.populateFromStyle();return Ne.catch(Xe=>{Ce.error(`#fromStyleUrl('${Pe}'[, ...])`,"Failed to create unique value renderer from style URL",Xe)}),Ne}};(0,R._)([(0,X.Cb)({readOnly:!0})],Ie.prototype,"_cache",null),(0,R._)([(0,ae.J)({uniqueValue:"unique-value"})],Ie.prototype,"type",void 0),(0,R._)([(0,X.Cb)(J.KK)],Ie.prototype,"backgroundFillSymbol",void 0),(0,R._)([(0,X.Cb)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Ie.prototype,"field",null),(0,R._)([(0,te.p)("field")],Ie.prototype,"castField",null),(0,R._)([(0,de.c)("field")],Ie.prototype,"writeField",null),(0,R._)([(0,X.Cb)({type:String,value:null,json:{write:!0}})],Ie.prototype,"field2",null),(0,R._)([(0,X.Cb)({type:String,value:null,json:{write:!0}})],Ie.prototype,"field3",null),(0,R._)([(0,X.Cb)({type:String,value:null,json:{write:!0}})],Ie.prototype,"valueExpression",null),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],Ie.prototype,"valueExpressionTitle",void 0),(0,R._)([(0,X.Cb)({type:ce.I,json:{write:!0}})],Ie.prototype,"legendOptions",void 0),(0,R._)([(0,X.Cb)({type:String,json:{write:!0}})],Ie.prototype,"defaultLabel",void 0),(0,R._)([(0,X.Cb)((0,B.RH)({...J.Gn},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Ie.prototype,"defaultSymbol",null),(0,R._)([(0,X.Cb)({type:String,value:null,json:{write:!0}})],Ie.prototype,"fieldDelimiter",null),(0,R._)([(0,X.Cb)({type:Y.Z,readOnly:!0})],Ie.prototype,"portal",void 0),(0,R._)([(0,oe.r)("portal",["styleName"])],Ie.prototype,"readPortal",null),(0,R._)([(0,X.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Ie.prototype,"styleOrigin",void 0),(0,R._)([(0,oe.r)("styleOrigin",["styleName","styleUrl"])],Ie.prototype,"readStyleOrigin",null),(0,R._)([(0,de.c)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Ie.prototype,"writeStyleOrigin",null),(0,R._)([(0,X.Cb)({type:[be],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(Pe,Le,Me)=>(Le.uniqueValueGroups||function He(Pe){const{field1:Le,field2:Me,field3:Ne,fieldDelimiter:Xe,uniqueValueInfos:Ye,valueExpression:Je}=Pe,rt=!(!Le||!Me);return[{classes:(Ye??[]).map(tt=>{const{symbol:et,label:qe,value:ot,description:ut}=tt,[_t,Ct,vt]=rt?ot?.toString()?.split(Xe||"")||[]:[ot],Lt=[];return(Le||Je)&&Lt.push(_t),Me&&Lt.push(Ct),Ne&&Lt.push(vt),{symbol:et,label:qe,values:[Lt],description:ut}})}]}(Le)).map(Ne=>be.fromJSON(Ne,Me))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Ie.prototype,"uniqueValueGroups",null),(0,R._)([(0,X.Cb)({type:[Se.Z],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Ie.prototype,"uniqueValueInfos",null),Ie=Ke=(0,R._)([(0,le.j)(We)],Ie);const Ge=Ie},2432:(nt,Ae,v)=>{"use strict";v.d(Ae,{W:()=>ze});var le,D=v(15861),R=v(17626),G=v(62208),Z=v(77712),$=(v(85931),v(90912)),W=v(68653),B=v(76898),H=v(99433),X=v(36630),te=v(32028),ae=v(17977),oe=v(8029);let de=le=class extends ae.Z{constructor(We){super(We),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(We){We&&Array.isArray(We)&&(We=We.filter(Ce=>!!Ce)).sort((Ce,Be)=>Ce.value-Be.value),this._set("stops",We)}clone(){return new le({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(We=>We.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(We=>We.value||0)}};(0,R._)([(0,Z.Cb)({readOnly:!0})],de.prototype,"cache",null),(0,R._)([(0,Z.Cb)({type:["color"],json:{type:["colorInfo"]}})],de.prototype,"type",void 0),(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],de.prototype,"normalizationField",void 0),(0,R._)([(0,Z.Cb)({type:[oe.Z],json:{write:!0}})],de.prototype,"stops",null),de=le=(0,R._)([(0,B.j)("esri.renderers.visualVariables.ColorVariable")],de);const se=de;var Y,re=v(86810),j=v(92236);let ee=Y=class extends re.wq{constructor(We){super(We),this.label=null,this.opacity=null,this.value=null}readOpacity(We,Ce){return(0,j.b)(Ce.transparency)}writeOpacity(We,Ce,Be){Ce[Be]=(0,j.a)(We)}clone(){return new Y({label:this.label,opacity:this.opacity,value:this.value})}};(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],ee.prototype,"label",void 0),(0,R._)([(0,Z.Cb)({type:Number,json:{type:$.z8,write:{target:"transparency"}}})],ee.prototype,"opacity",void 0),(0,R._)([(0,W.r)("opacity",["transparency"])],ee.prototype,"readOpacity",null),(0,R._)([(0,H.c)("opacity")],ee.prototype,"writeOpacity",null),(0,R._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ee.prototype,"value",void 0),ee=Y=(0,R._)([(0,B.j)("esri.renderers.visualVariables.support.OpacityStop")],ee);const ie=ee;var J;let ce=J=class extends ae.Z{constructor(We){super(We),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(We){We&&Array.isArray(We)&&(We=We.filter(Ce=>!!Ce)).sort((Ce,Be)=>Ce.value-Be.value),this._set("stops",We)}clone(){return new J({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(We=>We.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(We=>We.value||0)}};(0,R._)([(0,Z.Cb)({readOnly:!0})],ce.prototype,"cache",null),(0,R._)([(0,Z.Cb)({type:["opacity"],json:{type:["transparencyInfo"]}})],ce.prototype,"type",void 0),(0,R._)([(0,Z.Cb)({type:String,json:{write:!0}})],ce.prototype,"normalizationField",void 0),(0,R._)([(0,Z.Cb)({type:[ie],json:{write:!0}})],ce.prototype,"stops",null),ce=J=(0,R._)([(0,B.j)("esri.renderers.visualVariables.OpacityVariable")],ce);const ue=ce;var pe=v(13398),he=v(88115),me=v(14517),ge=v(2076),_e=v(63290),Ee=v(14889);const De={color:se,size:he.Z,opacity:ue,rotation:pe.Z},be=new ge.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Se=/^\[([^\]]+)\]$/i;let ye=class extends me.Z{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(We){if(this._resetVariables(),(We=We&&We.filter(Ce=>!!Ce))&&We.length){for(const Ce of We)switch(Ce.type){case"color":this.colorVariables.push(Ce);break;case"opacity":this.opacityVariables.push(Ce);break;case"rotation":this.rotationVariables.push(Ce);break;case"size":this.sizeVariables.push(Ce)}this.sizeVariables.length&&this.sizeVariables.some(Ce=>!!Ce.target)&&We.sort((Ce,Be)=>{let Fe=null;return Fe=Ce.target===Be.target?0:Ce.target?1:-1,Fe});for(let Ce=0;Ce<We.length;Ce++)We[Ce].index=Ce;this._set("visualVariables",We)}else this._set("visualVariables",We)}readVariables(We,Ce,Be){const{rotationExpression:Fe,rotationType:je}=Ce,Re=Fe&&Fe.match(Se),He=Re&&Re[1];if(He&&(We||(We=[]),We.push({type:"rotationInfo",rotationType:je,field:He})),We)return We.map(Ie=>{const Ge=be.read(Ie.type),Pe=De[Ge];Pe||(_e.Z.getLogger(this.declaredClass).warn(`Unknown variable type: ${Ge}`),Be&&Be.messages&&Be.messages.push(new Ee.Z("visual-variable:unsupported",`visualVariable of type '${Ge}' is not supported`,{definition:Ie,context:Be})));const Le=new Pe;return Le.read(Ie,Be),Le})}writeVariables(We,Ce){const Be=[];for(const Fe of We){const je=Fe.toJSON(Ce);je&&Be.push(je)}return Be}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,R._)([(0,Z.Cb)()],ye.prototype,"visualVariables",null),ye=(0,R._)([(0,B.j)("esri.renderers.visualVariables.VisualVariableFactory")],ye);const ve=ye,xe={base:ae.Z,key:"type",typeMap:{opacity:ue,color:se,rotation:pe.Z,size:he.Z}},ze=We=>{let Ce=class extends We{constructor(){super(...arguments),this._vvFactory=new ve}set visualVariables(Be){this._vvFactory.visualVariables=Be,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(Be,Fe,je){return this._vvFactory.readVariables(Be,Fe,je)}writeVisualVariables(Be,Fe,je,Re){Fe[je]=this._vvFactory.writeVariables(Be,Re)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const Be of this.visualVariables)if(Be.arcadeRequired)return!0;return!1}hasVisualVariables(Be,Fe){return Be?this.getVisualVariablesForType(Be,Fe).length>0:this.getVisualVariablesForType("size",Fe).length>0||this.getVisualVariablesForType("color",Fe).length>0||this.getVisualVariablesForType("opacity",Fe).length>0||this.getVisualVariablesForType("rotation",Fe).length>0}getVisualVariablesForType(Be,Fe){const je=this.visualVariables;return je?je.filter(Re=>Re.type===Be&&("string"==typeof Fe?Re.target===Fe:!1!==Fe||!Re.target)):[]}collectVVRequiredFields(Be,Fe){var je=this;return(0,D.Z)(function*(){let Re=[];je.visualVariables&&(Re=Re.concat(je.visualVariables));for(const He of Re)He&&(He.field&&(0,X.AB)(Be,Fe,He.field),He.normalizationField&&(0,X.AB)(Be,Fe,He.normalizationField),He.valueExpression&&(Ke(He.valueExpression,Be,Fe)||(yield(0,X.io)(Be,Fe,He.valueExpression))))})()}};return(0,R._)([(0,Z.Cb)({types:[xe],value:null,json:{write:!0}})],Ce.prototype,"visualVariables",null),(0,R._)([(0,W.r)("visualVariables",["visualVariables","rotationType","rotationExpression"])],Ce.prototype,"readVisualVariables",null),(0,R._)([(0,H.c)("visualVariables")],Ce.prototype,"writeVisualVariables",null),Ce=(0,R._)([(0,B.j)("esri.renderers.mixins.VisualVariablesMixin")],Ce),Ce};function Ke(We,Ce,Be){const Fe=(0,te.v)(We);return!!(0,G.pC)(Fe)&&((0,X.AB)(Ce,Be,Fe),!0)}},41832:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),R=v(91558),G=v(86810),Z=v(63290),Q=v(77712),W=(v(85931),v(66656)),B=v(76898),H=v(90912);let te=X=class extends G.wq{constructor(oe){super(oe),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(oe){return null==oe?oe:"function"==typeof oe?(Z.Z.getLogger(this.declaredClass).error(".field: field must be a string value"),null):(0,H.Zs)(oe)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new X({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,D._)([(0,Q.Cb)({type:R.Z,json:{type:[Number],write:!0}})],te.prototype,"color",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"field",void 0),(0,D._)([(0,W.p)("field")],te.prototype,"castField",null),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"label",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"valueExpression",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"valueExpressionTitle",void 0),te=X=(0,D._)([(0,B.j)("esri.renderers.support.AttributeColorInfo")],te);const ae=te},15312:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ye});var X,D=v(17626),R=v(2076),G=v(86810),Z=v(58817),Q=v(77712),$=v(90912),W=v(68653),B=v(76898);v(85931);let te=X=class extends G.wq{constructor(ve){super(ve),this.minValue=0,this.maxValue=0}clone(){return new X({minValue:this.minValue,maxValue:this.maxValue})}};var ae;(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],te.prototype,"minValue",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],te.prototype,"maxValue",void 0),te=X=(0,D._)([(0,B.j)("esri.renderer.support.AuthoringInfoClassBreakInfo")],te);let oe=ae=class extends G.wq{constructor(ve){super(ve),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new ae({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,Z.d9)(this.classBreakInfos)})}};(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],oe.prototype,"field",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],oe.prototype,"normalizationField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],oe.prototype,"label",void 0),(0,D._)([(0,Q.Cb)({type:[te],json:{write:!0}})],oe.prototype,"classBreakInfos",void 0),oe=ae=(0,D._)([(0,B.j)("esri.renderers.support.AuthoringInfoFieldInfo")],oe);var de,le=v(66656);const se=new R.X({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),re=new R.X({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),j={key:ve=>"number"==typeof ve?"number":"string",typeMap:{number:Number,string:String},base:null},Y=["high-to-low","above-and-below","centered-on","extremes"],ee=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],ie=["seconds","minutes","hours","days","months","years"];let J=de=class extends G.wq{constructor(ve){super(ve),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(ve){return"string"==typeof ve||"number"==typeof ve?ve:null}castStartTime(ve){return"string"==typeof ve||"number"==typeof ve?ve:null}get style(){return"color"===this.type?this._get("style"):null}set style(ve){this._set("style",ve)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(ve){this._set("theme",ve)}clone(){return new de({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,D._)([(0,Q.Cb)({types:j,json:{write:!0}})],J.prototype,"endTime",void 0),(0,D._)([(0,le.p)("endTime")],J.prototype,"castEndTime",null),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],J.prototype,"field",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],J.prototype,"maxSliderValue",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],J.prototype,"minSliderValue",void 0),(0,D._)([(0,Q.Cb)({types:j,json:{write:!0}})],J.prototype,"startTime",void 0),(0,D._)([(0,le.p)("startTime")],J.prototype,"castStartTime",null),(0,D._)([(0,Q.Cb)({type:se.apiValues,value:null,json:{type:se.jsonValues,read:se.read,write:se.write}})],J.prototype,"style",null),(0,D._)([(0,Q.Cb)({type:ee,value:null,json:{type:ee,origins:{"web-scene":{type:Y,write:{writer:(ve,xe)=>{Y.includes(ve)&&(xe.theme=ve)}}}},write:!0}})],J.prototype,"theme",null),(0,D._)([(0,Q.Cb)({type:re.apiValues,json:{type:re.jsonValues,read:re.read,write:re.write}})],J.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:ie,json:{type:ie,write:!0}})],J.prototype,"units",void 0),J=de=(0,D._)([(0,B.j)("esri.renderers.support.AuthoringInfoVisualVariable")],J);const ce=J;var pe,ue=v(79023);const he=new R.X({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),me=new R.X({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),ge=new R.X({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),_e=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let Se=pe=class extends G.wq{constructor(ve){super(ve),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const ve=this._get("classificationMethod"),xe=this.type;return xe&&"relationship"!==xe?"class-breaks-size"===xe||"class-breaks-color"===xe?ve||"manual":null:ve}set classificationMethod(ve){this._set("classificationMethod",ve)}readColorRamp(ve){return ve?(0,ue.i)(ve):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(ve){this._set("fields",ve)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(ve){this._set("field1",ve)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(ve){this._set("field2",ve)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(ve){this._set("flowTheme",ve)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(ve){this._set("focus",ve)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(ve){this._set("numClasses",ve)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(ve){this._set("statistics",ve)}get standardDeviationInterval(){const ve=this.type;return ve&&"relationship"!==ve&&"class-breaks-size"!==ve&&"class-breaks-color"!==ve||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(ve){this._set("standardDeviationInterval",ve)}get type(){return this._get("type")}set type(ve){let xe=ve;"classed-size"===ve?xe="class-breaks-size":"classed-color"===ve&&(xe="class-breaks-color"),this._set("type",xe)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(ve){this._set("univariateSymbolStyle",ve)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(ve){this._set("univariateTheme",ve)}clone(){return new pe({classificationMethod:this.classificationMethod,colorRamp:(0,Z.d9)(this.colorRamp),fadeRatio:(0,Z.d9)(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:(0,Z.d9)(this.field1),field2:(0,Z.d9)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(ve=>ve.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,D._)([(0,Q.Cb)({type:he.apiValues,value:null,json:{type:he.jsonValues,read:he.read,write:he.write,origins:{"web-document":{default:"manual",type:he.jsonValues,read:he.read,write:he.write}}}})],Se.prototype,"classificationMethod",null),(0,D._)([(0,Q.Cb)({types:ue.V,json:{write:!0}})],Se.prototype,"colorRamp",void 0),(0,D._)([(0,W.r)("colorRamp")],Se.prototype,"readColorRamp",null),(0,D._)([(0,Q.Cb)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Se.prototype,"fadeRatio",void 0),(0,D._)([(0,Q.Cb)({type:[String],value:null,json:{write:!0}})],Se.prototype,"fields",null),(0,D._)([(0,Q.Cb)({type:oe,value:null,json:{write:!0}})],Se.prototype,"field1",null),(0,D._)([(0,Q.Cb)({type:oe,value:null,json:{write:!0}})],Se.prototype,"field2",null),(0,D._)([(0,Q.Cb)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Se.prototype,"flowTheme",null),(0,D._)([(0,Q.Cb)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Se.prototype,"focus",null),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Se.prototype,"isAutoGenerated",void 0),(0,D._)([(0,Q.Cb)({type:Number,value:null,json:{type:$.z8,write:!0}})],Se.prototype,"numClasses",null),(0,D._)([(0,Q.Cb)({type:_e,json:{type:_e,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Se.prototype,"lengthUnit",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Se.prototype,"maxSliderValue",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Se.prototype,"minSliderValue",void 0),(0,D._)([(0,Q.Cb)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Se.prototype,"statistics",null),(0,D._)([(0,Q.Cb)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Se.prototype,"standardDeviationInterval",null),(0,D._)([(0,Q.Cb)({type:me.apiValues,value:null,json:{type:me.jsonValues,read:me.read,write:me.write,origins:{"web-scene":{type:ge.jsonValues,write:{writer:ge.write,overridePolicy:ve=>({enabled:"flow"!==ve})}}}}})],Se.prototype,"type",null),(0,D._)([(0,Q.Cb)({type:[ce],json:{write:!0}})],Se.prototype,"visualVariables",void 0),(0,D._)([(0,Q.Cb)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Se.prototype,"univariateSymbolStyle",null),(0,D._)([(0,Q.Cb)({type:["high-to-low","above-and-below","above","below","90-10"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Se.prototype,"univariateTheme",null),Se=pe=(0,D._)([(0,B.j)("esri.renderers.support.AuthoringInfo")],Se);const ye=Se},74400:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(76457);let H=B=class extends R.wq{constructor(te){super(te),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new B({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const te=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${te}`}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"description",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"label",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],H.prototype,"minValue",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],H.prototype,"maxValue",void 0),(0,D._)([(0,G.Cb)(W.Gn)],H.prototype,"symbol",void 0),H=B=(0,D._)([(0,$.j)("esri.renderers.support.ClassBreakInfo")],H);const X=H},29996:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{DictionaryLoader:()=>le});var D=v(15861),R=v(91558),G=v(84792),Z=v(26584),Q=v(63290),$=v(93961),W=v(62208),B=v(10699),H=v(77275),X=v(46679),te=v(94398);const ae="esri.renderers.support.DictionaryLoader",oe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class le{constructor(j,Y,ee){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new $.Z(100),this._dictionaryPromise=null,this.url=j,this.config=Y,this.fieldMap=ee}getSymbolFields(){return this._symbolFields}getSymbolAsync(j,Y){var ee=this;return(0,D.Z)(function*(){let ie;ee._dictionaryPromise||(ee._dictionaryPromise=ee.fetchResources(Y));try{ie=yield ee._dictionaryPromise}catch(De){if((0,B.D_)(De))return ee._dictionaryPromise=null,null}const J={};if(ee.fieldMap)for(const De of ee._symbolFields){const be=ee.fieldMap[De];J[De]=be&&null!=j.attributes[be]?""+j.attributes[be]:""}const ce=ie?.(J,Y);if(!ce||"string"!=typeof ce)return null;const ue=(0,H.hP)(ce).toString(),pe=ee._symbolCache.get(ue);if(pe)return pe.catch(()=>{ee._symbolCache.pop(ue)}),pe;const he=ce.split(";"),me=[],ge=[];for(const De of he)if(De)if(De.includes("po:")){const be=De.substr(3).split("|");if(3===be.length){const Se=be[0],ye=be[1];let ve=be[2];if("DashTemplate"===ye)ve=ve.split(" ").map(xe=>Number(xe));else if("Color"===ye){const xe=new R.Z(ve).toRgba();ve=[xe[0],xe[1],xe[2],255*xe[3]]}else ve=Number(ve);ge.push({primitiveName:Se,propertyName:ye,value:ve})}}else if(De.includes("|")){for(const be of De.split("|"))if(ee._itemNames.has(be)){me.push(be);break}}else ee._itemNames.has(De)&&me.push(De);const _e=!(0,W.pC)(j.geometry)||!j.geometry.hasZ&&"point"===j.geometry.type,Ee=ee._cimPartsToCIMSymbol(me,ge,_e,Y);return ee._symbolCache.put(ue,Ee,1),Ee})()}fetchResources(j){var Y=this;return(0,D.Z)(function*(){if(Y._dictionaryPromise)return Y._dictionaryPromise;if(!Y.url)return void Q.Z.getLogger(ae).error("no valid URL!");const ee=(0,G.default)(Y.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:(0,W.pC)(j)?j.signal:null}),[{data:ie}]=yield Promise.all([ee,(0,X.LC)()]);if(!ie)throw Y._dictionaryPromise=null,new Z.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const J=ie.expression,ce=ie.authoringInfo;Y._refSymbolUrlTemplate=Y.url+"/"+ie.cimRefTemplateUrl,Y._itemNames=new Set(ie.itemsNames),Y._symbolFields=ce.symbol;const ue={};if(Y.config){const me=Y.config;for(const ge in me)ue[ge]=me[ge]}if(ce.configuration)for(const me of ce.configuration)ue.hasOwnProperty(me.name)||(ue[me.name]=me.value);const pe=[];if((0,W.pC)(j)&&j.fields&&Y.fieldMap)for(const me of Y._symbolFields){const ge=Y.fieldMap[me],_e=j.fields.filter(Ee=>Ee.name===ge);_e.length>0&&pe.push({..._e[0],name:me})}const he=(0,X.pp)(J,(0,W.pC)(j)?j.spatialReference:null,pe,ue).then(me=>{const ge={scale:0};return(_e,Ee)=>{if((0,W.Wi)(me))return null;const De=me.repurposeFeature({geometry:null,attributes:_e});return ge.scale=(0,W.pC)(Ee)?Ee.scale:void 0,me.evaluate({$feature:De,$view:ge})}}).catch(me=>(Q.Z.getLogger(ae).error("Creating dictinoary expression failed:",me),null));return Y._dictionaryPromise=he,he})()}_cimPartsToCIMSymbol(j,Y,ee,ie){var J=this;return(0,D.Z)(function*(){const ce=new Array(j.length);for(let he=0;he<j.length;he++)ce[he]=J._getSymbolPart(j[he],ie);const ue=yield Promise.all(ce),pe=J.fieldMap;if(pe)for(const he of ue)de(he,pe);return new te.Z({data:J._combineSymbolParts(ue,Y,ee)})})()}_getSymbolPart(j,Y){var ee=this;return(0,D.Z)(function*(){if(ee._ongoingRequests.has(j))return ee._ongoingRequests.get(j).then(ce=>ce.data);const ie=ee._refSymbolUrlTemplate.replace(/\{itemName\}/gi,j),J=(0,G.default)(ie,{responseType:"json",query:{f:"json"},...Y});ee._ongoingRequests.set(j,J);try{return(yield J).data}catch(ce){throw ee._ongoingRequests.delete(j),ce}})()}_combineSymbolParts(j,Y,ee){if(!j||0===j.length)return null;const ie={...j[0]};if(j.length>1){ie.symbolLayers=[];for(const J of j)ie.symbolLayers.unshift(...J.symbolLayers)}return ee&&(ie.callout=oe),{type:"CIMSymbolReference",symbol:ie,primitiveOverrides:Y}}}function de(re,j){if(!re)return;const Y=re.symbolLayers;if(!Y)return;let ee=Y.length;for(;ee--;){const ie=Y[ee];ie&&!1!==ie.enable&&"CIMVectorMarker"===ie.type&&se(ie,j)}}function se(re,j){const Y=re.markerGraphics;if(Y)for(const ee of Y){if(!ee)continue;const ie=ee.symbol;if(ie)switch(ie.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":de(ie,j);break;case"CIMTextSymbol":ie.fieldMap=j}}}},52372:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(91558),G=v(86810),Z=v(77712),$=(v(85931),v(90912)),W=v(76898);let H=B=class extends G.wq{constructor(te){super(te),this.color=null,this.ratio=null}clone(){return new B({color:this.color,ratio:this.ratio})}};(0,D._)([(0,Z.Cb)({type:R.Z,json:{type:[$.z8],default:null,write:!0}})],H.prototype,"color",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],H.prototype,"ratio",void 0),H=B=(0,D._)([(0,W.j)("esri.renderers.support.HeatmapColorStop")],H);const X=H},10914:(nt,Ae,v)=>{"use strict";v.d(Ae,{I:()=>B});var W,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.wq{constructor(){super(...arguments),this.title=null}clone(){return new W({title:this.title})}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),B=W=(0,D._)([(0,$.j)("esri.renderers.support.LegendOptions")],B)},87266:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(76457);let H=B=class extends R.wq{constructor(te){super(te),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new B({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const te=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${te}`}};(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"description",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],H.prototype,"label",void 0),(0,D._)([(0,G.Cb)(W.Gn)],H.prototype,"symbol",void 0),(0,D._)([(0,G.Cb)(W.GY)],H.prototype,"value",void 0),H=B=(0,D._)([(0,$.j)("esri.renderers.support.UniqueValueInfo")],H);const X=H},76457:(nt,Ae,v)=>{"use strict";v.d(Ae,{GY:()=>B,Gn:()=>$,KK:()=>W});var D=v(20383),R=v(383),G=v(9461),Z=v(10012),Q=v(89673);const $={types:D.QT,json:{write:{writer:G.cW},origins:{"web-scene":{types:D.f_,write:{writer:G.cW},read:{reader:(0,R.d)({types:D.f_})}}}}},W={types:{base:Z.Z,key:"type",typeMap:{"simple-fill":D.LB.typeMap["simple-fill"],"picture-fill":D.LB.typeMap["picture-fill"],"polygon-3d":D.LB.typeMap["polygon-3d"]}},json:{write:{writer:G.cW},origins:{"web-scene":{type:Q.Z,write:{writer:G.cW}}}}},B={cast:H=>null==H||"string"==typeof H||"number"==typeof H?H:`${H}`,json:{type:String,write:{writer:(H,X)=>{X.value=H?.toString()}}}}},36859:(nt,Ae,v)=>{"use strict";v.d(Ae,{AJ:()=>W,If:()=>oe,QM:()=>X,k0:()=>$,nu:()=>Q,uI:()=>H,wx:()=>le});var D=v(21286),R=v(23841),G=v(993),Z=v(4794);const Q=2.4;function $(se){return(0,R.Wz)(se*Q)}function W(se){return(0,R.F2)(se)/Q}function B(se,re,j,Y){let{color:ee,ratio:ie}=re,{color:J,ratio:ce}=j;ce===ie&&(1===ce?ie-=1e-6:ce+=1e-6);const ue=(0,D.uZ)((Y-ie)/(ce-ie),0,1);(0,G.l)(se,ee.toArray(),J.toArray(),ue)}function H(se){const j=new Uint8ClampedArray(2048);if((se=se.filter(({ratio:ce})=>ce>=0&&ce<=1).sort((ce,ue)=>ce.ratio-ue.ratio).map(({color:ce,ratio:ue})=>({color:ce,ratio:Math.max(ue,.001)}))).length<1)return j;let Y=se[0],ee=se[0],ie=1;const J=(0,Z.c)();for(let ce=0;ce<512;ce++){const ue=(ce+.5)/512;for(;ue>ee.ratio&&ie<se.length;)Y=ee,ee=se[ie++];B(J,Y,ee,ue),j.set(J,4*ce)}return j}function X(se,re,j,Y){const{radius:ee,fieldOffset:ie,field:J}=re,ce=Math.round((0,R.F2)(ee)),ue=new Float64Array(j*Y);let pe,he=Number.NEGATIVE_INFINITY;const me=function de(se,re){return null!=se?"string"==typeof re?j=>-1*+j.readAttribute(se):j=>+j.readAttribute(se)+re:j=>1}(J,ie),ge=new Set;for(const _e of se){const Ee=_e.getCursor();for(;Ee.next();){const De=Ee.getObjectId();if(ge.has(De))continue;ge.add(De);const be=Ee.readLegacyPointGeometry(),Se=128;if(be.x<-Se||be.x>=j+Se||be.y<-Se||be.y>Y+Se)continue;const ye=+me(Ee),ve=Math.max(0,Math.round(be.x)-ce),xe=Math.max(0,Math.round(be.y)-ce),ze=Math.min(Y,Math.round(be.y)+ce),Ke=Math.min(j,Math.round(be.x)+ce);for(let We=xe;We<ze;We++)for(let Ce=ve;Ce<Ke;Ce++){const Be=We*j+Ce,Fe=oe(be.x-Ce,be.y-We,ce);pe=ue[Be]+=Fe*ye,pe>he&&(he=pe)}}}return{matrix:ue.buffer,max:he}}function oe(se,re,j){const Y=Math.sqrt(se**2+re**2)/j;return Y>1?0:3/(Math.PI*j**2)*(1-Y**2)**2}function le(se,re){return"function"==typeof se?se:se?"string"==typeof re?j=>-1*+j[se]:j=>+j[se]+re:()=>1}},33474:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>$,i:()=>Z});var D=v(14889),R=v(383),G=v(32088);function Z(W,B){return $(W,null,B)}const Q=(0,R.d)({types:G.A});function $(W,B,H){return W?W&&(W.styleName||W.styleUrl)&&"uniqueValue"!==W.type?(H&&H.messages&&H.messages.push(new D.Z("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+W.type+"'",{definition:W,context:H})),null):Q(W,B,H):null}},21254:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>G});var D=v(16730),R=v(94425);const G={inches:(0,D.En)(1,"meters","inches"),feet:(0,D.En)(1,"meters","feet"),"us-feet":(0,D.En)(1,"meters","us-feet"),yards:(0,D.En)(1,"meters","yards"),miles:(0,D.En)(1,"meters","miles"),"nautical-miles":(0,D.En)(1,"meters","nautical-miles"),millimeters:(0,D.En)(1,"meters","millimeters"),centimeters:(0,D.En)(1,"meters","centimeters"),decimeters:(0,D.En)(1,"meters","decimeters"),meters:(0,D.En)(1,"meters","meters"),kilometers:(0,D.En)(1,"meters","kilometers"),"decimal-degrees":1/(0,D.ty)(1,"meters",R.sv.radius)}},32028:(nt,Ae,v)=>{"use strict";function D(G){return G.match(R)?.[1]?.replace(/\\'/g,"'")??null}v.d(Ae,{v:()=>D});const R=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/},50134:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>Q,s:()=>$}),v(8314);var R=v(26584),G=v(62208),Z=v(70137);function Q(te){return(0,G.Wi)(te)||"simple"===te.type||"unique-value"===te.type||"class-breaks"===te.type||"dictionary"===te.type||"heatmap"===te.type}function $(te,ae){if((0,G.Wi)(te))return null;if(!Q(te))return new R.Z("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${te.type||te.declaredClass}'`,{renderer:te});switch(te.type){case"simple":return function B(te){return W(te,(0,Z.q)(te.symbol).error)}(te);case"unique-value":return function H(te,ae){const oe={...Z.K,...ae},le=te.uniqueValueInfos?.map(se=>(0,Z.q)(se.symbol,oe).error).filter(G.pC),de=(0,Z.q)(te.defaultSymbol,oe);return de.error&&le?.unshift(de.error),W(te,le)}(te,ae);case"class-breaks":return function X(te){const ae=te.classBreakInfos.map(le=>(0,Z.q)(le.symbol).error).filter(G.pC),oe=(0,Z.q)(te.defaultSymbol);return oe.error&&ae.unshift(oe.error),W(te,ae)}(te);case"dictionary":case"heatmap":return null}return null}function W(te,ae){if(!ae)return null;let oe;if(oe=Array.isArray(ae)?ae:[ae],oe.length>0){const le=oe.map(se=>se.details.symbol.type||se.details.symbol.declaredClass).filter(se=>!!se);le.sort();const de=[];return le.forEach((se,re)=>{0!==re&&se===le[re-1]||de.push(se)}),new R.Z("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${de.join(", ")}) which are not supported in 3D`,{renderer:te,symbolErrors:oe})}return null}},39256:(nt,Ae,v)=>{"use strict";v.d(Ae,{Kb:()=>W,o2:()=>oe,sV:()=>ae,xn:()=>X});var D=v(15861),R=v(91558),G=v(62208),Z=v(81808);function Q(le,de){if(!le||le.symbol)return null;const se=de&&de.renderer;return le&&(0,G.pC)(se)&&se.getObservationRenderer?se.getObservationRenderer(le):se}function W(le,de){const se=Q(le,de),re=function $(le,de){if((0,G.pC)(le.symbol))return le.symbol;const se=Q(le,de);return(0,G.pC)(se)&&"dot-density"!==se.type?se.getSymbol(le,de):null}(le,de);if((0,G.Wi)(re))return null;const j={renderer:se,symbol:re};if((0,G.Wi)(se)||!("visualVariables"in se)||!se.visualVariables)return j;const Y=(0,Z.getVisualVariableValues)(se,le,de)??[],ee=["proportional","proportional","proportional"];for(const{variable:ie,value:J}of Y)switch(ie.type){case"color":j.color=J.toRgba();break;case"size":if("outline"===ie.target)j.outlineSize=J;else{const ue=ie.useSymbolValue?"symbol-value":J;switch(ie.axis){case"width":ee[0]=ue;break;case"depth":ee[1]=ue;break;case"height":ee[2]=ue;break;case"width-and-depth":ee[0]=ee[1]=ue;break;default:ee[0]=ee[1]=ee[2]=ue}}break;case"opacity":j.opacity=J;break;case"rotation":switch(ie.axis){case"tilt":j.tilt=J;break;case"roll":j.roll=J;break;default:j.heading=J}}return"proportional"===ee[0]&&"proportional"===ee[1]&&"proportional"===ee[2]||(j.size=ee),j}function B(le,de){return H.apply(this,arguments)}function H(){return(H=(0,D.Z)(function*(le,de){if((0,G.pC)(le.symbol))return le.symbol;const se=Q(le,de);return(0,G.pC)(se)?se.getSymbolAsync(le,de):null})).apply(this,arguments)}function X(le,de){return te.apply(this,arguments)}function te(){return(te=(0,D.Z)(function*(le,de){const se=Q(le,de),re=yield B(le,de);if(!re)return null;const j={renderer:se,symbol:re};if(!se||!("visualVariables"in se)||!se.visualVariables)return j;const Y=(0,Z.getVisualVariableValues)(se,le,de)??[],ee=["proportional","proportional","proportional"];for(const{variable:ie,value:J}of Y)if("color"===ie.type)j.color=R.Z.toUnitRGBA(J);else if("size"===ie.type)if("outline"===ie.target)j.outlineSize=J;else{const ce=ie.axis,ue=ie.useSymbolValue?"symbol-value":J;"width"===ce?ee[0]=ue:"depth"===ce?ee[1]=ue:"height"===ce?ee[2]=ue:ee[0]=ee[1]="width-and-depth"===ce?ue:ee[2]=ue}else"opacity"===ie.type?j.opacity=J:"rotation"===ie.type&&"tilt"===ie.axis?j.tilt=J:"rotation"===ie.type&&"roll"===ie.axis?j.roll=J:"rotation"===ie.type&&(j.heading=J);return(isFinite(ee[0])||isFinite(ee[1])||isFinite(ee[2]))&&(j.size=ee),j})).apply(this,arguments)}function ae(le,de=0){const se=le[de];return"number"==typeof se&&isFinite(se)?se:null}function oe(le){for(let de=0;de<3;de++){const se=le[de];if("number"==typeof se)return isFinite(se)?se:0}return 0}},39683:(nt,Ae,v)=>{"use strict";v.d(Ae,{y:()=>Q});var D=v(15861),R=v(59213),G=v(10699),Z=v(14889);function Q(W,B,H){return $.apply(this,arguments)}function $(){return($=(0,D.Z)(function*(W,B,H){const X=W&&W.getAtOrigin&&W.getAtOrigin("renderer",B.origin);if(X&&"unique-value"===X.type&&X.styleOrigin){const te=yield(0,R.q6)(X.populateFromStyle());if((0,G.k_)(H),!1===te.ok){const ae=te.error;B&&B.messages&&B.messages.push(new Z.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${ae.message}`,{error:ae,context:B})),W.clear("renderer",B?.origin)}}})).apply(this,arguments)}},32088:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>H,o:()=>X});var D=v(4832),R=v(49067),G=v(96794),Z=v(69747),Q=v(40425),$=v(69357),W=v(40342),B=v(73640);const H={key:"type",base:$.Z,typeMap:{heatmap:Z.Z,simple:W.Z,"unique-value":B.Z,"class-breaks":D.Z,"dot-density":G.Z,dictionary:R.Z,"pie-chart":Q.Z},errorContext:"renderer"},X={key:"type",base:$.Z,typeMap:{simple:W.Z,"unique-value":B.Z,"class-breaks":D.Z,heatmap:Z.Z},errorContext:"renderer"}},13398:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(26584),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(99433),B=v(17977);let X=H=class extends B.Z{constructor(ae){super(ae),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(ae,oe,le,de){de&&de.messages&&de.messages.push(new R.Z("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:`visualVariables[${this.index}].valueExpressionTitle`,context:de}))}clone(){return new H({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};(0,D._)([(0,G.Cb)({readOnly:!0})],X.prototype,"cache",null),(0,D._)([(0,G.Cb)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],X.prototype,"axis",void 0),(0,D._)([(0,G.Cb)({type:["rotation"],json:{type:["rotationInfo"]}})],X.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],X.prototype,"rotationType",void 0),(0,D._)([(0,G.Cb)({type:String,json:{write:!0}})],X.prototype,"valueExpressionTitle",void 0),(0,D._)([(0,W.c)("web-scene","valueExpressionTitle")],X.prototype,"writeValueExpressionTitleWebScene",null),X=H=(0,D._)([(0,$.j)("esri.renderers.visualVariables.RotationVariable")],X);const te=X},88115:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ce});var re,D=v(17626),R=v(26584),G=v(2076),Z=v(63290),Q=v(23841),$=v(77712),B=(v(85931),v(66656)),H=v(68653),X=v(76898),te=v(99433),ae=v(17977),oe=v(64902),le=v(24729),de=v(86971),se=v(81808);const j=new G.X({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Y=new G.X({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function ee(ue){if(null!=ue)return"string"==typeof ue||"number"==typeof ue?(0,Q.t_)(ue):"size"===ue.type?(0,de.iY)(ue)?ue:(delete(ue={...ue}).type,new J(ue)):void 0}function ie(ue,pe,he){if("object"!=typeof ue)return ue;const me=new J;return me.read(ue,he),me}let J=re=class extends ae.Z{constructor(ue){super(ue),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&se.viewScaleRE.test(this.valueExpression)}}set expression(ue){Z.Z.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===ue?(this.valueExpression="$view.scale",this._set("expression",ue)):this._set("expression",null)}set index(ue){(0,de.iY)(this.maxSize)&&(this.maxSize.index=`visualVariables[${ue}].maxSize`),(0,de.iY)(this.minSize)&&(this.minSize.index=`visualVariables[${ue}].minSize`),this._set("index",ue)}get inputValueType(){return(0,de.PS)(this)}set maxDataValue(ue){ue&&this.stops&&(Z.Z.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),ue=null),this._set("maxDataValue",ue)}set maxSize(ue){ue&&this.stops&&(Z.Z.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),ue=null),this._set("maxSize",ue)}castMaxSize(ue){return ee(ue)}readMaxSize(ue,pe,he){return ie(ue,0,he)}set minDataValue(ue){ue&&this.stops&&(Z.Z.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),ue=null),this._set("minDataValue",ue)}set minSize(ue){ue&&this.stops&&(Z.Z.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),ue=null),this._set("minSize",ue)}castMinSize(ue){return ee(ue)}readMinSize(ue,pe,he){return ie(ue,0,he)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(ue){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?ue&&Array.isArray(ue)&&(ue=ue.filter(pe=>!!pe)).sort((pe,he)=>pe.value-he.value):ue&&(Z.Z.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),ue=null),this._set("stops",ue)}get transformationType(){return(0,de.QW)(this,this.inputValueType)}readValueExpression(ue,pe){return ue||pe.expression&&"$view.scale"}writeValueExpressionWebScene(ue,pe,he,me){if("$view.scale"===ue){if(me&&me.messages){const ge=this.index;me.messages.push(new R.Z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:("string"==typeof ge?ge:`visualVariables[${ge}]`)+".valueExpression",context:me}))}}else pe[he]=ue}readValueUnit(ue){return ue?Y.read(ue):null}clone(){return new re({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,de.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,de.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(ue=>ue.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===de.hL.ClampedLinear){const{minSize:ue,maxSize:pe}=this;return this.minSize=pe,this.maxSize=ue,this}if(this.transformationType===de.hL.Stops){const ue=this.stops;if(!ue)return this;const pe=ue.map(me=>me.size).reverse(),he=ue.length;for(let me=0;me<he;me++)ue[me].size=pe[me];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(ue=>ue.value||0)}};(0,D._)([(0,$.Cb)({readOnly:!0})],J.prototype,"cache",null),(0,D._)([(0,$.Cb)({type:j.apiValues,json:{type:j.jsonValues,origins:{"web-map":{read:!1}},read:j.read,write:j.write}})],J.prototype,"axis",void 0),(0,D._)([(0,$.Cb)({type:String,value:null,json:{read:!1}})],J.prototype,"expression",null),(0,D._)([(0,$.Cb)()],J.prototype,"index",null),(0,D._)([(0,$.Cb)({type:String,readOnly:!0})],J.prototype,"inputValueType",null),(0,D._)([(0,$.Cb)({type:le.Z,json:{write:!0}})],J.prototype,"legendOptions",void 0),(0,D._)([(0,$.Cb)({type:Number,value:null,json:{write:!0}})],J.prototype,"maxDataValue",null),(0,D._)([(0,$.Cb)({type:Number,value:null,json:{write:!0}})],J.prototype,"maxSize",null),(0,D._)([(0,B.p)("maxSize")],J.prototype,"castMaxSize",null),(0,D._)([(0,H.r)("maxSize")],J.prototype,"readMaxSize",null),(0,D._)([(0,$.Cb)({type:Number,value:null,json:{write:!0}})],J.prototype,"minDataValue",null),(0,D._)([(0,$.Cb)({type:Number,value:null,json:{write:!0}})],J.prototype,"minSize",null),(0,D._)([(0,B.p)("minSize")],J.prototype,"castMinSize",null),(0,D._)([(0,H.r)("minSize")],J.prototype,"readMinSize",null),(0,D._)([(0,$.Cb)({type:String,json:{write:!0}})],J.prototype,"normalizationField",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],J.prototype,"arcadeRequired",null),(0,D._)([(0,$.Cb)({type:String})],J.prototype,"scaleBy",void 0),(0,D._)([(0,$.Cb)({type:[oe.Z],value:null,json:{write:!0}})],J.prototype,"stops",null),(0,D._)([(0,$.Cb)({type:["outline"],json:{write:!0}})],J.prototype,"target",void 0),(0,D._)([(0,$.Cb)({type:String,readOnly:!0})],J.prototype,"transformationType",null),(0,D._)([(0,$.Cb)({type:["size"],json:{type:["sizeInfo"]}})],J.prototype,"type",void 0),(0,D._)([(0,$.Cb)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],J.prototype,"useSymbolValue",void 0),(0,D._)([(0,$.Cb)({type:String,json:{write:!0}})],J.prototype,"valueExpression",void 0),(0,D._)([(0,H.r)("valueExpression",["valueExpression","expression"])],J.prototype,"readValueExpression",null),(0,D._)([(0,te.c)("web-scene","valueExpression")],J.prototype,"writeValueExpressionWebScene",null),(0,D._)([(0,$.Cb)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],J.prototype,"valueRepresentation",void 0),(0,D._)([(0,$.Cb)({type:Y.apiValues,json:{write:Y.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],J.prototype,"valueUnit",void 0),(0,D._)([(0,H.r)("valueUnit")],J.prototype,"readValueUnit",null),J=re=(0,D._)([(0,X.j)("esri.renderers.visualVariables.SizeVariable")],J);const ce=J},17977:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var D=v(17626),R=v(2076),G=v(86810),Z=v(63290),Q=v(77712),W=(v(85931),v(66656)),B=v(76898),H=v(90912),X=v(11333);const te=new R.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let ae=class extends G.wq{constructor(le){super(le),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(le){return null==le?le:"function"==typeof le?(Z.Z.getLogger(this.declaredClass).error(".field: field must be a string value"),null):(0,H.Zs)(le)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,D._)([(0,Q.Cb)()],ae.prototype,"index",void 0),(0,D._)([(0,Q.Cb)({type:te.apiValues,readOnly:!0,json:{read:te.read,write:te.write}})],ae.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],ae.prototype,"field",void 0),(0,D._)([(0,W.p)("field")],ae.prototype,"castField",null),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],ae.prototype,"valueExpression",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],ae.prototype,"valueExpressionTitle",void 0),(0,D._)([(0,Q.Cb)({readOnly:!0})],ae.prototype,"arcadeRequired",null),(0,D._)([(0,Q.Cb)({type:X.Z,json:{write:!0}})],ae.prototype,"legendOptions",void 0),ae=(0,D._)([(0,B.j)("esri.renderers.visualVariables.VisualVariable")],ae);const oe=ae},8029:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(91558),G=v(86810),Z=v(77712),$=(v(85931),v(90912)),W=v(76898),B=v(99433);let X=H=class extends G.wq{constructor(ae){super(ae),this.color=null,this.label=null,this.value=null}writeValue(ae,oe,le){oe[le]=ae??0}clone(){return new H({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,D._)([(0,Z.Cb)({type:R.Z,json:{type:[$.z8],write:!0}})],X.prototype,"color",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],X.prototype,"label",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],X.prototype,"value",void 0),(0,D._)([(0,B.c)("value")],X.prototype,"writeValue",null),X=H=(0,D._)([(0,W.j)("esri.renderers.visualVariables.support.ColorStop")],X);const te=X},64902:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(86810),G=v(23841),Z=v(77712),W=(v(85931),v(90912),v(76898));let H=B=class extends R.wq{constructor(te){super(te),this.label=null,this.size=null,this.value=null}clone(){return new B({label:this.label,size:this.size,value:this.value})}};(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],H.prototype,"label",void 0),(0,D._)([(0,Z.Cb)({type:Number,cast:G.t_,json:{write:!0}})],H.prototype,"size",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0}})],H.prototype,"value",void 0),H=B=(0,D._)([(0,W.j)("esri.renderers.visualVariables.support.SizeStop")],H);const X=H},24729:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(11333);let B=W=class extends $.Z{constructor(){super(...arguments),this.customValues=null}clone(){return new W({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};(0,D._)([(0,R.Cb)({type:[Number],json:{write:!0}})],B.prototype,"customValues",void 0),B=W=(0,D._)([(0,Q.j)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],B);const H=B},11333:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(10914);let B=W=class extends $.I{constructor(){super(...arguments),this.showLegend=null}clone(){return new W({title:this.title,showLegend:this.showLegend})}};(0,D._)([(0,R.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"showLegend",void 0),B=W=(0,D._)([(0,Q.j)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],B);const H=B},86971:(nt,Ae,v)=>{"use strict";var D,R,W;function G(W){return W&&"esri.renderers.visualVariables.SizeVariable"===W.declaredClass}function Z(W){return null!=W&&!isNaN(W)&&isFinite(W)}function Q(W){return W.valueExpression?D.Expression:W.field&&"string"==typeof W.field?D.Field:D.Unknown}function $(W,B){return(B||Q(W))===D.Unknown?R.Constant:W.stops?R.Stops:null!=W.minSize&&null!=W.maxSize&&null!=W.minDataValue&&null!=W.maxDataValue?R.ClampedLinear:"unknown"===(W.valueUnit||"unknown")?null!=W.minSize&&null!=W.minDataValue?W.minSize&&W.minDataValue?R.Proportional:R.Additive:R.Identity:R.RealWorldSize}v.d(Ae,{PS:()=>Q,QW:()=>$,RY:()=>D,hL:()=>R,iY:()=>G,qh:()=>Z}),(W=D||(D={})).Unknown="unknown",W.Expression="expression",W.Field="field",function(W){W.Unknown="unknown",W.Stops="stops",W.ClampedLinear="clamped-linear",W.Proportional="proportional",W.Additive="additive",W.Constant="constant",W.Identity="identity",W.RealWorldSize="real-world-size"}(R||(R={}))},81808:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{getAllSizes:()=>De,getColor:()=>ae,getOpacity:()=>oe,getRotationAngle:()=>le,getSize:()=>re,getSizeForValue:()=>me,getSizeFromNumberOrVariable:()=>j,getSizeRangeAtScale:()=>ge,getVisualVariableValues:()=>_e,viewScaleRE:()=>te});var D=v(91558),R=v(88879),G=v(94573),Z=v(63290),Q=v(62208),$=v(21254),W=v(86971);const B=Z.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),H=new R.Z,X=Math.PI,te=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function ae(be,Se,ye){const ve="visualVariables"in be&&be.visualVariables?be.visualVariables.find(Ie=>"color"===Ie.type):be;if(!ve)return;if("esri.renderers.visualVariables.ColorVariable"!==ve.declaredClass)return void B.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const xe="number"==typeof Se,ze=xe?null:Se,Ke=ze&&ze.attributes;let We=xe?Se:null;const Ce=ve.field,{ipData:Be,hasExpression:Fe}=ve.cache;let je=ve.cache.compiledFunc;if(!Ce&&!Fe){const Ie=ve.stops;return Ie&&Ie[0]&&Ie[0].color}if("number"!=typeof We)if(Fe){if((0,Q.Wi)(ye)||(0,Q.Wi)(ye.arcade))return void B.error("Use of arcade expressions requires an arcade context");const Ge=ye.arcade.arcadeUtils,Pe=Ge.getViewInfo({viewingMode:ye.viewingMode,scale:ye.scale,spatialReference:ye.spatialReference}),Le=Ge.createExecContext(ze,Pe);if(!je){const Me=Ge.createSyntaxTree(ve.valueExpression);je=Ge.createFunction(Me),ve.cache.compiledFunc=je}We=Ge.executeFunction(je,Le)}else Ke&&(We=Ke[Ce]);const Re=ve.normalizationField,He=null!=Ke&&null!=Re?parseFloat(Ke[Re]):void 0;if(null!=We&&(!Re||xe||!isNaN(He)&&0!==He)){isNaN(He)||xe||(We/=He);const Ie=Ee(We,Be);if(Ie){const Ge=Ie[0],Pe=Ie[1],Le=Ge===Pe?ve.stops[Ge].color:D.Z.blendColors(ve.stops[Ge].color,ve.stops[Pe].color,Ie[2],(0,Q.pC)(ye)?ye.color:void 0);return new D.Z(Le)}}}function oe(be,Se,ye){const ve="visualVariables"in be&&be.visualVariables?be.visualVariables.find(Ie=>"opacity"===Ie.type):be;if(!ve)return;if("esri.renderers.visualVariables.OpacityVariable"!==ve.declaredClass)return void B.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const xe="number"==typeof Se,ze=xe?null:Se,Ke=ze&&ze.attributes;let We=xe?Se:null;const Ce=ve.field,{ipData:Be,hasExpression:Fe}=ve.cache;let je=ve.cache.compiledFunc;if(!Ce&&!Fe){const Ie=ve.stops;return Ie&&Ie[0]&&Ie[0].opacity}if("number"!=typeof We)if(Fe){if((0,Q.Wi)(ye)||(0,Q.Wi)(ye.arcade))return void B.error("Use of arcade expressions requires an arcade context");const Ge=ye.arcade.arcadeUtils,Pe=Ge.getViewInfo({viewingMode:ye.viewingMode,scale:ye.scale,spatialReference:ye.spatialReference}),Le=Ge.createExecContext(ze,Pe);if(!je){const Me=Ge.createSyntaxTree(ve.valueExpression);je=Ge.createFunction(Me),ve.cache.compiledFunc=je}We=Ge.executeFunction(je,Le)}else Ke&&(We=Ke[Ce]);const Re=ve.normalizationField,He=null!=Ke&&null!=Re?parseFloat(Ke[Re]):void 0;if(null!=We&&(!Re||xe||!isNaN(He)&&0!==He)){isNaN(He)||xe||(We/=He);const Ie=Ee(We,Be);if(Ie){const Ge=Ie[0],Pe=Ie[1];if(Ge===Pe)return ve.stops[Ge].opacity;{const Le=ve.stops[Ge].opacity;return Le+(ve.stops[Pe].opacity-Le)*Ie[2]}}}}function le(be,Se,ye){const ve="visualVariables"in be&&be.visualVariables?be.visualVariables.find(He=>"rotation"===He.type):be;if(!ve)return;if("esri.renderers.visualVariables.RotationVariable"!==ve.declaredClass)return void B.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const xe=ve.axis||"heading",ze="heading"===xe&&"arithmetic"===ve.rotationType?90:0,Ke="heading"===xe&&"arithmetic"===ve.rotationType?-1:1,We="number"==typeof Se?null:Se,Ce=We&&We.attributes,Be=ve.field,{hasExpression:Fe}=ve.cache;let je=ve.cache.compiledFunc,Re=0;if(!Be&&!Fe)return Re;if(Fe){if((0,Q.Wi)(ye)||(0,Q.Wi)(ye.arcade))return void B.error("Use of arcade expressions requires an arcade context");const Ie=ye.arcade.arcadeUtils,Ge=Ie.getViewInfo({viewingMode:ye.viewingMode,scale:ye.scale,spatialReference:ye.spatialReference}),Pe=Ie.createExecContext(We,Ge);if(!je){const Le=Ie.createSyntaxTree(ve.valueExpression);je=Ie.createFunction(Le),ve.cache.compiledFunc=je}Re=Ie.executeFunction(je,Pe)}else Ce&&(Re=Ce[Be]||0);return Re="number"!=typeof Re||isNaN(Re)?null:ze+Ke*Re,Re}function re(be,Se,ye){const ve="visualVariables"in be&&be.visualVariables?be.visualVariables.find(ze=>"size"===ze.type):be;if(!ve)return;if("esri.renderers.visualVariables.SizeVariable"!==ve.declaredClass)return void B.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const xe=me(function de(be,Se,ye){const ve="number"==typeof Se,xe=ve?null:Se,ze=xe&&xe.attributes;let Ke=ve?Se:null;const{isScaleDriven:We}=be.cache;let Ce=be.cache.compiledFunc;if(We){const Fe=(0,Q.pC)(ye)?ye.scale:void 0,je=(0,Q.pC)(ye)?ye.view:void 0;Ke=null==Fe||"3d"===je?function se(be){let Se=null,ye=null;const ve=be.stops;return ve?(Se=ve[0].value,ye=ve[ve.length-1].value):(Se=be.minDataValue||0,ye=be.maxDataValue||0),(Se+ye)/2}(be):Fe}else if(!ve)switch(be.inputValueType){case W.RY.Expression:{if((0,Q.Wi)(ye)||(0,Q.Wi)(ye.arcade))return void B.error("Use of arcade expressions requires an arcade context");const je=ye.arcade.arcadeUtils,Re=je.getViewInfo({viewingMode:ye.viewingMode,scale:ye.scale,spatialReference:ye.spatialReference}),He=je.createExecContext(xe,Re);if(!Ce){const Ie=je.createSyntaxTree(be.valueExpression);Ce=je.createFunction(Ie),be.cache.compiledFunc=Ce}Ke=je.executeFunction(Ce,He);break}case W.RY.Field:ze&&(Ke=ze[be.field]);break;case W.RY.Unknown:Ke=null}if(!(0,W.qh)(Ke))return null;if(ve||!be.normalizationField)return Ke;const Be=ze?parseFloat(ze[be.normalizationField]):null;return(0,W.qh)(Be)&&0!==Be?Ke/Be:null}(ve,Se,ye),ve,Se,ye,ve.cache.ipData);return null==xe||isNaN(xe)?0:xe}function j(be,Se,ye){return null==be?null:(0,W.iY)(be)?re(be,Se,ye):(0,W.qh)(be)?be:null}function Y(be,Se,ye){return(0,W.qh)(ye)&&be>ye?ye:(0,W.qh)(Se)&&be<Se?Se:be}function me(be,Se,ye,ve,xe){switch(Se.transformationType){case W.hL.Additive:return function ee(be,Se,ye,ve){return be+((j(Se.minSize,ye,ve)||Se.minDataValue)??0)}(be,Se,ye,ve);case W.hL.Constant:return function ie(be,Se,ye){const ve=be.stops;let xe=ve&&ve.length&&ve[0].size;return null==xe&&(xe=be.minSize),j(xe,Se,ye)}(Se,ye,ve);case W.hL.ClampedLinear:return function J(be,Se,ye,ve){const xe=(be-Se.minDataValue)/(Se.maxDataValue-Se.minDataValue),ze=j(Se.minSize,ye,ve),Ke=j(Se.maxSize,ye,ve),We=(0,Q.pC)(ve)?ve.shape:void 0;if(be<=Se.minDataValue)return ze;if(be>=Se.maxDataValue)return Ke;if(null==ze||null==Ke)return null;if("area"===Se.scaleBy&&We){const Ce="circle"===We,Be=Ce?X*(ze/2)**2:ze*ze,Fe=Be+xe*((Ce?X*(Ke/2)**2:Ke*Ke)-Be);return Ce?2*Math.sqrt(Fe/X):Math.sqrt(Fe)}return ze+xe*(Ke-ze)}(be,Se,ye,ve);case W.hL.Proportional:return function ce(be,Se,ye,ve){const xe=(0,Q.pC)(ve)?ve.shape:void 0,ze=be/Se.minDataValue,Ke=j(Se.minSize,ye,ve),We=j(Se.maxSize,ye,ve);let Ce=null;return Ce="circle"===xe?2*Math.sqrt(ze*(Ke/2)**2):"square"===xe||"diamond"===xe||"image"===xe?Math.sqrt(ze*Ke**2):ze*Ke,Y(Ce,Ke,We)}(be,Se,ye,ve);case W.hL.Stops:return function ue(be,Se,ye,ve,xe){const[ze,Ke,We]=Ee(be,xe);if(ze===Ke)return j(Se.stops?.[ze].size,ye,ve);{const Ce=j(Se.stops?.[ze].size,ye,ve);return Ce+(j(Se.stops?.[Ke].size,ye,ve)-Ce)*We}}(be,Se,ye,ve,xe);case W.hL.RealWorldSize:return function pe(be,Se,ye,ve){const xe=((0,Q.pC)(ve)&&ve.resolution?ve.resolution:1)*$.a[Se.valueUnit],ze=j(Se.minSize,ye,ve),Ke=j(Se.maxSize,ye,ve),{valueRepresentation:We}=Se;let Ce=null;return Ce="area"===We?2*Math.sqrt(be/X)/xe:"radius"===We||"distance"===We?2*be/xe:be/xe,Y(Ce,ze,Ke)}(be,Se,ye,ve);case W.hL.Identity:return be;case W.hL.Unknown:return null}}function ge(be,Se,ye){const{isScaleDriven:ve}=be.cache;if(!(ve&&"3d"===ye||Se))return null;const xe={scale:Se,view:ye};let ze=j(be.minSize,H,xe),Ke=j(be.maxSize,H,xe);if(null!=ze||null!=Ke){if(ze>Ke){const We=Ke;Ke=ze,ze=We}return{minSize:ze,maxSize:Ke}}}function _e(be,Se,ye){if(!be.visualVariables)return;const ve=[],xe=[],ze=[],Ke=[],We=[];for(const Ce of be.visualVariables)switch(Ce.type){case"color":xe.push(Ce);break;case"opacity":ze.push(Ce);break;case"rotation":We.push(Ce);break;case"size":Ke.push(Ce)}return xe.forEach(Ce=>{const Be=ae(Ce,Se,ye);ve.push({variable:Ce,value:Be})}),ze.forEach(Ce=>{const Be=oe(Ce,Se,ye);ve.push({variable:Ce,value:Be})}),We.forEach(Ce=>{const Be=le(Ce,Se,ye);ve.push({variable:Ce,value:Be})}),Ke.forEach(Ce=>{const Be=re(Ce,Se,ye);ve.push({variable:Ce,value:Be})}),ve.filter(Ce=>null!=Ce.value)}function Ee(be,Se){if(!Se)return;let ye=0,ve=Se.length-1;return Se.some((xe,ze)=>be<xe?(ve=ze,!0):(ye=ze,!1)),[ye,ve,(be-Se[ye])/(Se[ve]-Se[ye])]}function De(be,Se,ye){const ve=["proportional","proportional","proportional"];for(const xe of be){const ze=xe.useSymbolValue?"symbol-value":re(xe,Se,ye);switch(xe.axis){case"width":ve[0]=ze;break;case"depth":ve[1]=ze;break;case"height":ve[2]=ze;break;case"width-and-depth":ve[0]=ze,ve[1]=ze;break;case"all":case void 0:case null:ve[0]=ze,ve[1]=ze,ve[2]=ze;break;default:(0,G.Bg)(xe.axis)}}return ve}},84792:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>oe});var D=v(15861),R=v(59318),G=v(24263),Z=v(26584),Q=v(8314),$=v(58817),W=v(62208),B=v(10699),H=v(21726),X=v(24433),te=v(12680),ae=v(33899);function oe(Re,He){return le.apply(this,arguments)}function le(){return(le=(0,D.Z)(function*(Re,He){const Ie=(0,H.HK)(Re),Ge=(0,H.jc)(Re);Ge||Ie||(Re=(0,H.Fv)(Re));const Pe={url:Re,requestOptions:{...(0,W.Wg)(He)}};let Le=(0,H.oh)(Re);if(Le){const Ye=yield ve(Le,Pe);if(null!=Ye)return{data:Ye,getHeader:ie,requestOptions:Pe.requestOptions,url:Pe.url};Le.after||Le.error||(Le=null)}if(Re=Pe.url,"image"===(He=Pe.requestOptions).responseType){if((0,Q.Z)("host-webworker")||(0,Q.Z)("host-node"))throw pe("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),Pe)}else if(Ie)throw pe("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+He.responseType),Pe);if("head"===He.method){if(He.body)throw pe("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),Pe);if(Ie||Ge)throw pe("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),Pe)}if(yield he(),de)return de.execute(Re,He);const Me=new AbortController;(0,B.fu)(He,()=>Me.abort());const Ne={controller:Me,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:Le,params:Pe,redoRequest:!1,useIdentity:se.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},Xe=yield We(Ne);return Le?.after?.(Xe),Xe})).apply(this,arguments)}let de;const se=R.Z.request,re="FormData"in globalThis,j=[499,498,403,401],Y=["COM_0056","COM_0057","SB_0008"],ee=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],ie=()=>null,J=Symbol();function ce(Re){const He=(0,H.P$)(Re);He&&!oe._corsServers.includes(He)&&oe._corsServers.push(He)}function ue(Re){const He=(0,H.P$)(Re);return!He||He.endsWith(".arcgis.com")||oe._corsServers.includes(He)||(0,H.kl)(He)}function pe(Re,He,Ie,Ge){let Pe="Error";const Le={url:Ie.url,requestOptions:Ie.requestOptions,getHeader:ie,ssl:!1};if(He instanceof Z.Z)return He.details?(He.details=(0,$.d9)(He.details),He.details.url=Ie.url,He.details.requestOptions=Ie.requestOptions):He.details=Le,He;if(He){const Me=Ge&&(Ye=>Ge.headers.get(Ye)),Ne=Ge&&Ge.status,Xe=He.message;Xe&&(Pe=Xe),Me&&(Le.getHeader=Me),Le.httpStatus=(null!=He.httpCode?He.httpCode:He.code)||Ne||0,Le.subCode=He.subcode,Le.messageCode=He.messageCode,Le.messages="string"==typeof He.details?[He.details]:He.details,Le.raw=J in He?He[J]:He}return(0,B.D_)(He)?(0,B.zE)():new Z.Z(Re,Pe,Le)}function he(){return me.apply(this,arguments)}function me(){return(me=(0,D.Z)(function*(){(0,Q.Z)("host-webworker")?de||(de=yield v.e(3358).then(v.bind(v,23358))):oe._abortableFetch||(oe._abortableFetch=globalThis.fetch.bind(globalThis))})).apply(this,arguments)}function ge(){return _e.apply(this,arguments)}function _e(){return(_e=(0,D.Z)(function*(){G.id||(yield v.e(9058).then(v.bind(v,59058)))})).apply(this,arguments)}function Ee(Re){return De.apply(this,arguments)}function De(){return(De=(0,D.Z)(function*(Re){const He=Re.params.url,Ie=Re.params.requestOptions,Ge=Re.controller.signal,Pe=Ie.body;let Le=null,Me=null;if(re&&"HTMLFormElement"in globalThis&&(Pe instanceof FormData?Le=Pe:Pe instanceof HTMLFormElement&&(Le=new FormData(Pe))),"string"==typeof Pe&&(Me=Pe),Re.fetchOptions={cache:Ie.cacheBust&&!oe._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:Ie.headers||{},method:"head"===Ie.method?"HEAD":"GET",mode:"cors",priority:se.priority,redirect:"follow",signal:Ge},(Le||Me)&&(Re.fetchOptions.body=Le||Me),"anonymous"===Ie.authMode&&(Re.useIdentity=!1),Re.hasToken=!!(/token=/i.test(He)||Ie.query?.token||Le?.get("token")),!Re.hasToken&&R.Z.apiKey&&(0,te.r)(He)&&(Ie.query||(Ie.query={}),Ie.query.token=R.Z.apiKey,Re.hasToken=!0),Re.useIdentity&&!Re.hasToken&&!Re.credentialToken&&!be(He)&&!(0,B.Hc)(Ge)){let Ne;"immediate"===Ie.authMode?(yield ge(),Ne=yield G.id.getCredential(He,{signal:Ge}),Re.credential=Ne):"no-prompt"===Ie.authMode?(yield ge(),Ne=yield G.id.getCredential(He,{prompt:!1,signal:Ge}).catch(()=>{}),Re.credential=Ne):G.id&&(Ne=G.id.findCredential(He)),Ne&&(Re.credentialToken=Ne.token,Re.useSSL=!!Ne.ssl)}})).apply(this,arguments)}function be(Re){return ee.some(He=>He.test(Re))}function Se(Re){return ye.apply(this,arguments)}function ye(){return(ye=(0,D.Z)(function*(Re){let He=Re.params.url;const Ie=Re.params.requestOptions,Ge=Re.fetchOptions??{},Pe=(0,H.jc)(He)||(0,H.HK)(He),Le=Ie.responseType||"json",Me=Pe?0:null!=Ie.timeout?Ie.timeout:se.timeout;let Ne=!1;if(!Pe){Re.useSSL&&(He=(0,H.hO)(He)),Ie.cacheBust&&"default"===Ge.cache&&(He=(0,H.ZN)(He,"request.preventCache",Date.now()));let tt={...Ie.query};Re.credentialToken&&(tt.token=Re.credentialToken);let et=(0,H.B7)(tt);(0,Q.Z)("esri-url-encodes-apostrophe")&&(et=et.replace(/'/g,"%27"));const qe=He.length+1+et.length;let ot;Ne="delete"===Ie.method||"post"===Ie.method||"put"===Ie.method||!!Ie.body||qe>se.maxUrlLength;const ut=Ie.useProxy||!!(0,H.ed)(He);if(ut){const _t=(0,H.b7)(He);ot=_t.path,!Ne&&ot.length+1+qe>se.maxUrlLength&&(Ne=!0),_t.query&&(tt={..._t.query,...tt})}if("HEAD"===Ge.method&&(Ne||ut)){if(Ne)throw pe("request:invalid-parameters",qe>se.maxUrlLength?new Error("URL exceeds maximum length"):new Error("cannot use POST request when method is 'head'"),Re.params);if(ut)throw pe("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),Re.params)}if(Ne?(Ge.method="delete"===Ie.method?"DELETE":"put"===Ie.method?"PUT":"POST",Ie.body?He=(0,H.fl)(He,tt):(Ge.body=(0,H.B7)(tt),Ge.headers||(Ge.headers={}),Ge.headers["Content-Type"]="application/x-www-form-urlencoded")):He=(0,H.fl)(He,tt),ut&&(Re.useProxy=!0,He=`${ot}?${He}`),tt.token&&re&&Ge.body instanceof FormData&&!(0,X.P)(He)&&Ge.body.set("token",tt.token),Ie.hasOwnProperty("withCredentials"))Re.withCredentials=Ie.withCredentials;else if(!(0,H.D6)(He,(0,H.TI)()))if((0,H.kl)(He))Re.withCredentials=!0;else if(G.id){const _t=G.id.findServerInfo(He);_t&&_t.webTierAuth&&(Re.withCredentials=!0)}Re.withCredentials&&(Ge.credentials="include",(0,ae.jH)(He)&&(yield(0,ae.jz)(Ne?(0,H.fl)(He,tt):He)))}let Xe,Ye,Je=0,rt=!1;Me>0&&(Je=setTimeout(()=>{rt=!0,Re.controller.abort()},Me));try{if("native-request-init"===Ie.responseType)Ye=Ge,Ye.url=He;else if("image"!==Ie.responseType||"default"!==Ge.cache||"GET"!==Ge.method||Ne||ze(Ie.headers)||!Pe&&!Re.useProxy&&se.proxyUrl&&!ue(He)){if(Xe=yield oe._abortableFetch(He,Ge),Re.useProxy||ce(He),"native"===Ie.responseType)Ye=Xe;else if("HEAD"!==Ge.method)if(Xe.ok){switch(Le){case"array-buffer":Ye=yield Xe.arrayBuffer();break;case"blob":case"image":Ye=yield Xe.blob();break;default:Ye=yield Xe.text()}if(Je&&(clearTimeout(Je),Je=0),"json"===Le||"xml"===Le||"document"===Le)if(Ye)switch(Le){case"json":Ye=JSON.parse(Ye);break;case"xml":Ye=Ke(Ye,"application/xml");break;case"document":Ye=Ke(Ye,"text/html")}else Ye=null;if(Ye){if("array-buffer"===Le||"blob"===Le){const tt=Xe.headers.get("Content-Type");if(tt&&/application\/json|text\/plain/i.test(tt)&&Ye["blob"===Le?"size":"byteLength"]<=750)try{const et=yield new Response(Ye).json();et.error&&(Ye=et)}catch{}}"image"===Le&&Ye instanceof Blob&&(Ye=yield je(URL.createObjectURL(Ye),Re,!0))}}else Ye=yield Xe.text()}else Ye=yield je(He,Re)}catch(tt){if("AbortError"===tt.name)throw rt?new Error("Timeout exceeded"):(0,B.zE)("Request canceled");if(!(!Xe&&tt instanceof TypeError&&se.proxyUrl)||Ie.body||"delete"===Ie.method||"head"===Ie.method||"post"===Ie.method||"put"===Ie.method||Re.useProxy||ue(He))throw tt;Re.redoRequest=!0,(0,H.tD)({proxyUrl:se.proxyUrl,urlPrefix:(0,H.P$)(He)??""})}finally{Je&&clearTimeout(Je)}return[Xe,Ye]})).apply(this,arguments)}function ve(Re,He){return xe.apply(this,arguments)}function xe(){return(xe=(0,D.Z)(function*(Re,He){if(null!=Re.responseData)return Re.responseData;if(Re.headers&&(He.requestOptions.headers={...He.requestOptions.headers,...Re.headers}),Re.query&&(He.requestOptions.query={...He.requestOptions.query,...Re.query}),Re.before){let Ie,Ge;try{Ge=yield Re.before(He)}catch(Pe){Ie=pe("request:interceptor",Pe,He)}if((Ge instanceof Error||Ge instanceof Z.Z)&&(Ie=pe("request:interceptor",Ge,He)),Ie)throw Re.error&&Re.error(Ie),Ie;return Ge}})).apply(this,arguments)}function ze(Re){if(Re)for(const He of Object.getOwnPropertyNames(Re))if(Re[He])return!0;return!1}function Ke(Re,He){let Ie;try{Ie=(new DOMParser).parseFromString(Re,He)}catch{}if(!Ie||Ie.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return Ie}function We(Re){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,D.Z)(function*(Re){let He,Ie;yield Ee(Re);try{do{[He,Ie]=yield Se(Re)}while(!(yield Be(Re,He,Ie)))}catch(Le){const Me=pe("request:server",Le,Re.params,He);throw Me.details.ssl=Re.useSSL,Re.interceptor&&Re.interceptor.error&&Re.interceptor.error(Me),Me}const Ge=Re.params.url;if(Ie&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(Ge)){if(!Re.hasToken&&!Re.credentialToken&&Ie.user?.username&&!(0,H.kl)(Ge)){const Le=(0,H.P$)(Ge,!0);Le&&se.trustedServers.push(Le)}Array.isArray(Ie.authorizedCrossOriginNoCorsDomains)&&(0,ae.Hu)(Ie.authorizedCrossOriginNoCorsDomains)}const Pe=Re.credential;if(Pe&&G.id){const Le=G.id.findServerInfo(Pe.server);let Me=Le&&Le.owningSystemUrl;if(Me){Me=Me.replace(/\/?$/,"/sharing");const Ne=G.id.findCredential(Me,Pe.userId);Ne&&-1===G.id._getIdenticalSvcIdx(Me,Ne)&&Ne.resources.unshift(Me)}}return{data:Ie,getHeader:He?Le=>He?.headers.get(Le):ie,requestOptions:Re.params.requestOptions,ssl:Re.useSSL,url:Re.params.url}})).apply(this,arguments)}function Be(Re,He,Ie){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,D.Z)(function*(Re,He,Ie){if(Re.redoRequest)return Re.redoRequest=!1,!1;const Ge=Re.params.requestOptions;if(!He||"native"===Ge.responseType||"native-request-init"===Ge.responseType)return!0;let Pe,Le;if(!He.ok)throw Pe=new Error(`Unable to load ${He.url} status: ${He.status}`),Pe[J]=Ie,Pe;Ie&&(Ie.error?Pe=Ie.error:"error"===Ie.status&&Array.isArray(Ie.messages)&&(Pe={...Ie},Pe[J]=Ie,Pe.details=Ie.messages));let Me,Ne=null;Pe&&(Le=Number(Pe.code),Ne=Pe.hasOwnProperty("subcode")?Number(Pe.subcode):null,Me=Pe.messageCode,Me=Me&&Me.toUpperCase());const Xe=Ge.authMode;if(403===Le&&(4===Ne||Pe.message&&Pe.message.toLowerCase().includes("ssl")&&!Pe.message.toLowerCase().includes("permission"))){if(!Re.useSSL)return Re.useSSL=!0,!1}else if(!Re.hasToken&&Re.useIdentity&&("no-prompt"!==Xe||498===Le)&&void 0!==Le&&j.includes(Le)&&!be(Re.params.url)&&(403!==Le||Me&&!Y.includes(Me)&&(null==Ne||2===Ne&&Re.credentialToken))){yield ge();try{const Ye=yield G.id.getCredential(Re.params.url,{error:pe("request:server",Pe,Re.params),prompt:"no-prompt"!==Xe,signal:Re.controller.signal,token:Re.credentialToken});return Re.credential=Ye,Re.credentialToken=Ye.token,Re.useSSL=Re.useSSL||Ye.ssl,!1}catch(Ye){if("no-prompt"===Xe)return Re.credential=void 0,Re.credentialToken=void 0,!1;Pe=Ye}}if(Pe)throw Pe;return!0})).apply(this,arguments)}function je(Re,He,Ie=!1){const Ge=He.controller.signal,Pe=new Image;return Pe.crossOrigin=He.withCredentials?"use-credentials":"anonymous",Pe.alt="",Pe.fetchPriority=se.priority,Pe.src=Re,(0,ae.fY)(Pe,Re,Ie,Ge)}oe._abortableFetch=null,oe._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"]},39636:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>H});var D=v(15861),R=v(84792),G=v(90912),Z=v(91179),Q=v(2618),$=v(10920),W=v(77294);const B=(0,G.se)(W.Z);function H(te,ae,oe){return X.apply(this,arguments)}function X(){return(X=(0,D.Z)(function*(te,ae,oe){ae=B(ae);const le=(0,Q.en)(te),de={...le.query,f:"json",...ae.toJSON()},se=ae.outSpatialReference,re=(0,Z.Ji)(ae.geometries[0]),j=(0,Q.lA)(de,oe);return(0,R.default)(le.path+"/project",j).then(({data:{geometries:Y}})=>(0,$.o)(Y,re,se))})).apply(this,arguments)}},10920:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>R,o:()=>G});var D=v(91179);function R(Z){return{geometryType:(0,D.Ji)(Z[0]),geometries:Z.map(Q=>Q.toJSON())}}function G(Z,Q,$){const W=(0,D.q9)(Q);return Z.map(B=>{const H=W.fromJSON(B);return H.spatialReference=$,H})}},76391:(nt,Ae,v)=>{"use strict";function D(R){const G={};for(const Z in R){if("declaredClass"===Z)continue;const Q=R[Z];if(null!=Q&&"function"!=typeof Q)if(Array.isArray(Q)){G[Z]=[];for(let $=0;$<Q.length;$++)G[Z][$]=D(Q[$])}else"object"==typeof Q?Q.toJSON&&(G[Z]=JSON.stringify(Q)):G[Z]=Q}return G}v.d(Ae,{A:()=>D})},2865:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>B,e:()=>$});var D=v(15861),R=v(2618),G=v(20477),Z=v(17253),Q=v(96854);function $(X,te,ae){return W.apply(this,arguments)}function W(){return(W=(0,D.Z)(function*(X,te,ae){const oe=yield B(X,te,ae);return Z.default.fromJSON(oe)})).apply(this,arguments)}function B(X,te,ae){return H.apply(this,arguments)}function H(){return(H=(0,D.Z)(function*(X,te,ae){const oe=(0,R.en)(X),le={...ae},de=Q.Z.from(te),{data:se}=yield(0,G.executeQuery)(oe,de,de.sourceSpatialReference,le);return se})).apply(this,arguments)}},20514:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>Q});var D=v(62208),R=v(16730),G=v(37053);function Z(B,H,X){if(null==B.hasM||B.hasZ)for(const te of H)for(const ae of te)ae.length>2&&(ae[2]*=X)}function Q(B,H,X){if(!B&&!H||!X)return;const te=(0,R._R)(X);$(B,X,te),$(H,X,te)}function $(B,H,X){if(B)for(const te of B)W(te.geometry,H,X)}function W(B,H,X){if((0,D.Wi)(B)||!B.spatialReference||(0,G.fS)(B.spatialReference,H))return;const te=(0,R._R)(B.spatialReference)/X;if(1!==te)if("x"in B)null!=B.z&&(B.z*=te);else if("rings"in B)Z(B,B.rings,te);else if("paths"in B)Z(B,B.paths,te);else if("points"in B&&(null==B.hasM||B.hasZ))for(const ae of B.points)ae.length>2&&(ae[2]*=te)}},71260:(nt,Ae,v)=>{"use strict";v.d(Ae,{G$:()=>J,K9:()=>me,O7:()=>H});var D=v(26584),R=v(62208),G=v(24192),Z=v(88071),Q=v(98558);const $=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],W=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],B=["upperLeft","lowerLeft"];function H(ge){return ge>=$.length?null:$[ge]}function X(ge){return ge>=W.length?null:W[ge]}function te(ge){return ge>=B.length?null:B[ge]}function ae(ge,_e){return _e>=ge.geometryTypes.length?null:ge.geometryTypes[_e]}function oe(ge,_e,Ee){const be=ge.asUnsafe(),Se=_e.createPointGeometry(Ee);for(;be.next();)switch(be.tag()){case 3:{const ye=be.getUInt32(),ve=be.pos()+ye;let xe=0;for(;be.pos()<ve;)_e.addCoordinatePoint(Se,be.getSInt64(),xe++);break}default:be.skip()}return Se}function le(ge,_e,Ee){const Se=ge.asUnsafe(),ye=_e.createGeometry(Ee),ve=2+(Ee.hasZ?1:0)+(Ee.hasM?1:0);for(;Se.next();)switch(Se.tag()){case 2:{const xe=Se.getUInt32(),ze=Se.pos()+xe;let Ke=0;for(;Se.pos()<ze;)_e.addLength(ye,Se.getUInt32(),Ke++);break}case 3:{const xe=Se.getUInt32(),ze=Se.pos()+xe;let Ke=0;for(_e.allocateCoordinates(ye);Se.pos()<ze;)_e.addCoordinate(ye,Se.getSInt64(),Ke),Ke++,Ke===ve&&(Ke=0);break}default:Se.skip()}return ye}function de(ge){const be=ge.asUnsafe(),Se=new Z.Z;let ye="esriGeometryPoint";for(;be.next();)switch(be.tag()){case 2:{const ve=be.getUInt32(),xe=be.pos()+ve;for(;be.pos()<xe;)Se.lengths.push(be.getUInt32());break}case 3:{const ve=be.getUInt32(),xe=be.pos()+ve;for(;be.pos()<xe;)Se.coords.push(be.getSInt64());break}case 1:ye=Q.A[be.getEnum()];break;default:be.skip()}return{queryGeometry:Se,queryGeometryType:ye}}function se(ge){const Ke=ge.asUnsafe();for(;Ke.next();)switch(Ke.tag()){case 1:return Ke.getString();case 2:return Ke.getFloat();case 3:return Ke.getDouble();case 4:return Ke.getSInt32();case 5:return Ke.getUInt32();case 6:return Ke.getInt64();case 7:return Ke.getUInt64();case 8:return Ke.getSInt64();case 9:return Ke.getBool();default:return Ke.skip(),null}return null}function re(ge){const ve=ge.asUnsafe(),xe={type:H(0)};for(;ve.next();)switch(ve.tag()){case 1:xe.name=ve.getString();break;case 2:xe.type=H(ve.getEnum());break;case 3:xe.alias=ve.getString();break;case 4:xe.sqlType=X(ve.getEnum());break;case 5:default:ve.skip();break;case 6:xe.defaultValue=ve.getString()}return xe}function j(ge){const De={},be=ge.asUnsafe();for(;be.next();)switch(be.tag()){case 1:De.name=be.getString();break;case 2:De.isSystemMaintained=be.getBool();break;default:be.skip()}return De}function Y(ge,_e,Ee,De){const ve=_e.createFeature(Ee);let xe=0;for(;ge.next();)switch(ge.tag()){case 1:{const ze=De[xe++].name;ve.attributes[ze]=ge.processMessage(se);break}case 2:ve.geometry=ge.processMessageWithArgs(le,_e,Ee);break;case 4:ve.centroid=ge.processMessageWithArgs(oe,_e,Ee);break;default:ge.skip()}return ve}function ee(ge){const Se=[1,1,1,1],ye=ge.asUnsafe();for(;ye.next();)switch(ye.tag()){case 1:Se[0]=ye.getDouble();break;case 2:Se[1]=ye.getDouble();break;case 4:Se[2]=ye.getDouble();break;case 3:Se[3]=ye.getDouble();break;default:ye.skip()}return Se}function ie(ge){const Se=[0,0,0,0],ye=ge.asUnsafe();for(;ye.next();)switch(ye.tag()){case 1:Se[0]=ye.getDouble();break;case 2:Se[1]=ye.getDouble();break;case 4:Se[2]=ye.getDouble();break;case 3:Se[3]=ye.getDouble();break;default:ye.skip()}return Se}function J(ge){const be={originPosition:te(0)},Se=ge.asUnsafe();for(;Se.next();)switch(Se.tag()){case 1:be.originPosition=te(Se.getEnum());break;case 2:be.scale=Se.processMessage(ee);break;case 3:be.translate=Se.processMessage(ie);break;default:Se.skip()}return be}function ce(ge){const be={},Se=ge.asUnsafe();for(;Se.next();)switch(Se.tag()){case 1:be.shapeAreaFieldName=Se.getString();break;case 2:be.shapeLengthFieldName=Se.getString();break;case 3:be.units=Se.getString();break;default:Se.skip()}return be}function ue(ge,_e){const ve=_e.createSpatialReference();for(;ge.next();)switch(ge.tag()){case 1:ve.wkid=ge.getUInt32();break;case 5:ve.wkt=ge.getString();break;case 2:ve.latestWkid=ge.getUInt32();break;case 3:ve.vcsWkid=ge.getUInt32();break;case 4:ve.latestVcsWkid=ge.getUInt32();break;default:ge.skip()}return ve}function pe(ge,_e){const je=_e.createFeatureResult(),Re=ge.asUnsafe();je.geometryType=ae(_e,0);let He=!1;for(;Re.next();)switch(Re.tag()){case 1:je.objectIdFieldName=Re.getString();break;case 3:je.globalIdFieldName=Re.getString();break;case 4:je.geohashFieldName=Re.getString();break;case 5:je.geometryProperties=Re.processMessage(ce);break;case 7:je.geometryType=ae(_e,Re.getEnum());break;case 8:je.spatialReference=Re.processMessageWithArgs(ue,_e);break;case 10:je.hasZ=Re.getBool();break;case 11:je.hasM=Re.getBool();break;case 12:je.transform=Re.processMessage(J);break;case 9:{const Ie=Re.getBool();je.exceededTransferLimit=Ie;break}case 13:_e.addField(je,Re.processMessage(re));break;case 15:He||(_e.prepareFeatures(je),He=!0),_e.addFeature(je,Re.processMessageWithArgs(Y,_e,je,je.fields));break;case 2:je.uniqueIdField=Re.processMessage(j);break;default:Re.skip()}return _e.finishFeatureResult(je),je}function he(ge,_e){const be={};let Se=null;for(;ge.next();)switch(ge.tag()){case 4:Se=ge.processMessageWithArgs(de);break;case 1:be.featureResult=ge.processMessageWithArgs(pe,_e);break;default:ge.skip()}return(0,R.pC)(Se)&&be.featureResult&&_e.addQueryGeometry(be,Se),be}function me(ge,_e){try{const De=new G.Z(new Uint8Array(ge),new DataView(ge)),be={};for(;De.next();)2===De.tag()?be.queryResult=De.processMessageWithArgs(he,_e):De.skip();return be}catch(Ee){throw new D.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:Ee})}}},98558:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>$,J:()=>W});var D=v(16730),R=v(37053),G=v(66385),Z=v(95786),Q=v(88071);const $=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class W{constructor(H){this._options=H,this.geometryTypes=$,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new Z.Z}prepareFeatures(H){this._vertexDimension=2,H.hasZ&&this._vertexDimension++,H.hasM&&this._vertexDimension++}finishFeatureResult(H){if(!H||!H.features||!H.hasZ||!this._options.sourceSpatialReference||!H.spatialReference||(0,R.fS)(H.spatialReference,this._options.sourceSpatialReference)||H.spatialReference.vcsWkid)return;const X=(0,D._R)(this._options.sourceSpatialReference)/(0,D._R)(H.spatialReference);if(1!==X)for(const te of H.features){if(!(0,G.S6)(te))continue;const ae=te.geometry.coords;for(let oe=2;oe<ae.length;oe+=3)ae[oe]*=X}}addFeature(H,X){H.features.push(X)}createFeature(){return new G.u_}createSpatialReference(){return{wkid:0}}createGeometry(){return new Q.Z}addField(H,X){H.fields.push(X)}allocateCoordinates(H){H.coords.length=H.lengths.reduce((X,te)=>X+te,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(H,X){H.coords[this._coordinatePtr++]=X}addCoordinatePoint(H,X){H.coords.push(X)}addLength(H,X){H.lengths.push(X)}addQueryGeometry(H,X){H.queryGeometry=X.queryGeometry,H.queryGeometryType=X.queryGeometryType}createPointGeometry(){return new Q.Z}}},85262:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>R});var D=v(71260);function R(G,Z){const Q=(0,D.K9)(G,Z),$=Q.queryResult.featureResult,W=Q.queryResult.queryGeometry,B=Q.queryResult.queryGeometryType;if($&&$.features&&$.features.length&&$.objectIdFieldName){const H=$.objectIdFieldName;for(const X of $.features)X.attributes&&(X.objectId=X.attributes[H])}return $&&($.queryGeometry=W,$.queryGeometryType=B),$}},20477:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{encodeGeometry:()=>te,executeQuery:()=>oe,executeQueryForCount:()=>Y,executeQueryForExtent:()=>ee,executeQueryForIds:()=>j,executeQueryPBF:()=>de,executeQueryPBFBuffer:()=>re,queryToQueryStringParameters:()=>ae,runQuery:()=>ie});var D=v(15861),R=v(84792),G=v(62208),Z=v(21726),Q=v(91179),$=v(93555),W=v(76391),B=v(85262),H=v(61515);const X="Layer does not support extent calculation.";function te(J,ce){if(ce&&"extent"===J.type)return`${J.xmin},${J.ymin},${J.xmax},${J.ymax}`;if(ce&&"point"===J.type)return`${J.x},${J.y}`;const ue=J.toJSON();return delete ue.spatialReference,JSON.stringify(ue)}function ae(J,ce){const ue=J.geometry,pe=J.toJSON();delete pe.compactGeometryEnabled,delete pe.defaultSpatialReferenceEnabled;const he=pe;let me,ge,_e;if((0,G.pC)(ue)&&(ge=ue.spatialReference,_e=ue.spatialReference.wkid||JSON.stringify(ue.spatialReference),he.geometryType=(0,Q.Ji)(ue),he.geometry=te(ue,J.compactGeometryEnabled),he.inSR=_e),pe.groupByFieldsForStatistics&&(he.groupByFieldsForStatistics=pe.groupByFieldsForStatistics.join(",")),pe.objectIds&&(he.objectIds=pe.objectIds.join(",")),pe.orderByFields&&(he.orderByFields=pe.orderByFields.join(",")),!pe.outFields||!pe.returnDistinctValues&&(ce?.returnCountOnly||ce?.returnExtentOnly||ce?.returnIdsOnly)?delete he.outFields:he.outFields=pe.outFields.includes("*")?"*":pe.outFields.join(","),pe.outSR?(he.outSR=pe.outSR.wkid||JSON.stringify(pe.outSR),me=J.outSpatialReference):ue&&(pe.returnGeometry||pe.returnCentroid)&&(he.outSR=he.inSR,me=ge),pe.returnGeometry&&delete pe.returnGeometry,pe.outStatistics&&(he.outStatistics=JSON.stringify(pe.outStatistics)),pe.fullText&&(he.fullText=JSON.stringify(pe.fullText)),pe.pixelSize&&(he.pixelSize=JSON.stringify(pe.pixelSize)),pe.quantizationParameters&&(J.defaultSpatialReferenceEnabled&&(0,G.pC)(ge)&&(0,G.pC)(J.quantizationParameters)&&(0,G.pC)(J.quantizationParameters.extent)&&ge.equals(J.quantizationParameters.extent.spatialReference)&&delete pe.quantizationParameters.extent.spatialReference,he.quantizationParameters=JSON.stringify(pe.quantizationParameters)),pe.parameterValues&&(he.parameterValues=JSON.stringify(pe.parameterValues)),pe.rangeValues&&(he.rangeValues=JSON.stringify(pe.rangeValues)),pe.dynamicDataSource&&(he.layer=JSON.stringify({source:pe.dynamicDataSource}),delete pe.dynamicDataSource),pe.timeExtent){const Ee=pe.timeExtent,{start:De,end:be}=Ee;null==De&&null==be||(he.time=De===be?De:`${De??"null"},${be??"null"}`),delete pe.timeExtent}return J.defaultSpatialReferenceEnabled&&(0,G.pC)(ge)&&(0,G.pC)(me)&&ge.equals(me)&&(he.defaultSR=he.inSR,delete he.inSR,delete he.outSR),he}function oe(J,ce,ue,pe){return le.apply(this,arguments)}function le(){return(le=(0,D.Z)(function*(J,ce,ue,pe){const he=(0,G.pC)(ce.timeExtent)&&ce.timeExtent.isEmpty?{data:{features:[]}}:yield ie(J,ce,"json",pe);return(0,H.p)(ce,ue,he.data),he})).apply(this,arguments)}function de(J,ce,ue,pe){return se.apply(this,arguments)}function se(){return(se=(0,D.Z)(function*(J,ce,ue,pe){if((0,G.pC)(ce.timeExtent)&&ce.timeExtent.isEmpty)return{data:ue.createFeatureResult()};const he=yield re(J,ce,pe),me=he;return me.data=(0,B.C)(he.data,ue),me})).apply(this,arguments)}function re(J,ce,ue){return ie(J,ce,"pbf",ue)}function j(J,ce,ue){return(0,G.pC)(ce.timeExtent)&&ce.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):ie(J,ce,"json",ue,{returnIdsOnly:!0})}function Y(J,ce,ue){return(0,G.pC)(ce.timeExtent)&&ce.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):ie(J,ce,"json",ue,{returnIdsOnly:!0,returnCountOnly:!0})}function ee(J,ce,ue){return(0,G.pC)(ce.timeExtent)&&ce.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):ie(J,ce,"json",ue,{returnExtentOnly:!0,returnCountOnly:!0}).then(pe=>{const he=pe.data;if(he.hasOwnProperty("extent"))return pe;if(he.features)throw new Error(X);if(he.hasOwnProperty("count"))throw new Error(X);return pe})}function ie(J,ce,ue,pe={},he={}){const me="string"==typeof J?(0,Z.mN)(J):J,ge=ce.geometry?[ce.geometry]:[];return pe.responseType="pbf"===ue?"array-buffer":"json",(0,$.aX)(ge,null,pe).then(_e=>{const Ee=_e&&_e[0];(0,G.pC)(Ee)&&((ce=ce.clone()).geometry=Ee);const De=(0,W.A)({...me.query,f:ue,...he,...ae(ce,he)});return(0,R.default)((0,Z.v_)(me.path,"query"),{...pe,query:{...De,...pe.query}})})}},61515:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>G});var D=v(62208),R=v(33696);function G(Z,Q,$){if(!$||!$.features||!$.hasZ)return;const W=(0,R.k)($.geometryType,Q,Z.outSpatialReference);if(!(0,D.Wi)(W))for(const B of $.features)W(B.geometry)}},87183:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var H,D=v(17626),R=v(86810),G=v(77712),Q=(v(85931),v(90912)),$=v(76898);const X={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let te=H=class extends R.wq{constructor(oe){super(oe),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:oe}=this,le=function W(oe){const{exifInfo:le,exifName:de,tagName:se}=oe;if(!le||!de||!se)return null;const re=le.find(j=>j.name===de);return re?function B(oe){const{tagName:le,tags:de}=oe;if(!de||!le)return null;const se=de.find(re=>re.name===le);return se&&se.value||null}({tagName:se,tags:re.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:oe});return X[le]||null}clone(){return new H({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,D._)([(0,G.Cb)({type:String})],te.prototype,"contentType",void 0),(0,D._)([(0,G.Cb)()],te.prototype,"exifInfo",void 0),(0,D._)([(0,G.Cb)({readOnly:!0})],te.prototype,"orientationInfo",null),(0,D._)([(0,G.Cb)({type:Q.z8})],te.prototype,"id",void 0),(0,D._)([(0,G.Cb)({type:String})],te.prototype,"globalId",void 0),(0,D._)([(0,G.Cb)({type:String})],te.prototype,"keywords",void 0),(0,D._)([(0,G.Cb)({type:String})],te.prototype,"name",void 0),(0,D._)([(0,G.Cb)({json:{read:!1}})],te.prototype,"parentGlobalId",void 0),(0,D._)([(0,G.Cb)({json:{read:!1}})],te.prototype,"parentObjectId",void 0),(0,D._)([(0,G.Cb)({type:Q.z8})],te.prototype,"size",void 0),(0,D._)([(0,G.Cb)({json:{read:!1}})],te.prototype,"url",void 0),te=H=(0,D._)([(0,$.j)("esri.layers.support.AttachmentInfo")],te);const ae=te},40251:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(91558),G=v(58817),Z=v(77712),Q=v(90912),$=v(55342),W=v(76898),B=v(40669);let X=H=class extends B.Z{constructor(ae){super(ae),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new H({fromColor:(0,G.d9)(this.fromColor),toColor:(0,G.d9)(this.toColor),algorithm:this.algorithm})}};(0,D._)([(0,$.J)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],X.prototype,"algorithm",void 0),(0,D._)([(0,Z.Cb)({type:R.Z,json:{type:[Q.z8],write:!0}})],X.prototype,"fromColor",void 0),(0,D._)([(0,Z.Cb)({type:R.Z,json:{type:[Q.z8],write:!0}})],X.prototype,"toColor",void 0),(0,D._)([(0,Z.Cb)({type:["algorithmic"]})],X.prototype,"type",void 0),X=H=(0,D._)([(0,W.j)("esri.rest.support.AlgorithmicColorRamp")],X);const te=X},67736:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(86810),G=v(58817),Z=v(77712),Q=v(90912),$=v(76898),W=v(99433);let H=B=class extends R.wq{constructor(te){super(te),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(te,ae){ae.resultOffset=this.start,ae.resultRecordCount=this.num||10}clone(){return new B((0,G.d9)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,D._)([(0,Z.Cb)({type:[String],json:{write:!0}})],H.prototype,"attachmentTypes",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],H.prototype,"attachmentsWhere",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"cacheHint",void 0),(0,D._)([(0,Z.Cb)({type:[String],json:{write:!0}})],H.prototype,"keywords",void 0),(0,D._)([(0,Z.Cb)({type:[Number],json:{write:!0}})],H.prototype,"globalIds",void 0),(0,D._)([(0,Z.Cb)({json:{write:!0}})],H.prototype,"name",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],H.prototype,"num",void 0),(0,D._)([(0,Z.Cb)({type:[Number],json:{write:!0}})],H.prototype,"objectIds",void 0),(0,D._)([(0,Z.Cb)({type:Boolean,json:{default:!1,write:!0}})],H.prototype,"returnMetadata",void 0),(0,D._)([(0,Z.Cb)({type:[Number],json:{write:!0}})],H.prototype,"size",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],H.prototype,"start",void 0),(0,D._)([(0,W.c)("start"),(0,W.c)("num")],H.prototype,"writeStart",null),(0,D._)([(0,Z.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],H.prototype,"where",void 0),H=B=(0,D._)([(0,$.j)("esri.rest.support.AttachmentQuery")],H),H.from=(0,Q.se)(H);const X=H},40669:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H),this.type=null}};(0,D._)([(0,G.Cb)({readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.rest.support.ColorRamp")],W);const B=W},17253:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{default:()=>Y});var se,D=v(17626),R=v(29132),G=v(88879),Z=v(2076),Q=v(86810),$=v(58817),W=v(62208),B=v(77712),X=(v(90912),v(68653)),te=v(76898),ae=v(99433),oe=v(65234),le=v(91179),de=v(36255);const re=new Z.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let j=se=class extends Q.wq{constructor(ee){super(ee),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(ee,ie){const J=oe.Z.fromJSON(ie.spatialReference),ce=[];for(let ue=0;ue<ee.length;ue++){const pe=ee[ue],he=G.Z.fromJSON(pe),me=pe.geometry&&pe.geometry.spatialReference;(0,W.pC)(he.geometry)&&!me&&(he.geometry.spatialReference=J);const ge=pe.aggregateGeometries,_e=he.aggregateGeometries;if(ge&&(0,W.pC)(_e))for(const Ee in _e){const De=_e[Ee],be=ge[Ee]?.spatialReference;(0,W.pC)(De)&&!be&&(De.spatialReference=J)}ce.push(he)}return ce}writeGeometryType(ee,ie,J,ce){if(ee)return void re.write(ee,ie,J,ce);const{features:ue}=this;if(ue)for(const pe of ue)if(pe&&(0,W.pC)(pe.geometry))return void re.write(pe.geometry.type,ie,J,ce)}readQueryGeometry(ee,ie){if(!ee)return null;const J=!!ee.spatialReference,ce=(0,le.im)(ee);return ce&&!J&&ie.spatialReference&&(ce.spatialReference=oe.Z.fromJSON(ie.spatialReference)),ce}writeSpatialReference(ee,ie){if(ee)return void(ie.spatialReference=ee.toJSON());const{features:J}=this;if(J)for(const ce of J)if(ce&&(0,W.pC)(ce.geometry)&&ce.geometry.spatialReference)return void(ie.spatialReference=ce.geometry.spatialReference.toJSON())}clone(){return new se(this.cloneProperties())}cloneProperties(){return(0,$.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(ee){const ie=this.write();if(ie.features&&Array.isArray(ee)&&ee.length>0)for(let J=0;J<ie.features.length;J++){const ce=ie.features[J];if(ce.geometry){const ue=ee&&ee[J];ce.geometry=ue&&ue.toJSON()||ce.geometry}}return ie}quantize(ee){const{scale:[ie,J],translate:[ce,ue]}=ee,me=this.features,ge=this._getQuantizationFunction(this.geometryType,_e=>Math.round((_e-ce)/ie),_e=>Math.round((ue-_e)/J));for(let _e=0,Ee=me.length;_e<Ee;_e++)ge?.((0,W.Wg)(me[_e].geometry))||(me.splice(_e,1),_e--,Ee--);return this.transform=ee,this}unquantize(){const{geometryType:ee,features:ie,transform:J}=this;if(!J)return this;const{translate:[ce,ue],scale:[pe,he]}=J,_e=this._getHydrationFunction(ee,Ee=>Ee*pe+ce,Ee=>ue-Ee*he);for(const{geometry:Ee}of ie)(0,W.pC)(Ee)&&_e&&_e(Ee);return this.transform=null,this}_quantizePoints(ee,ie,J){let ce,ue;const pe=[];for(let he=0,me=ee.length;he<me;he++){const ge=ee[he];if(he>0){const _e=ie(ge[0]),Ee=J(ge[1]);_e===ce&&Ee===ue||(pe.push([_e-ce,Ee-ue]),ce=_e,ue=Ee)}else ce=ie(ge[0]),ue=J(ge[1]),pe.push([ce,ue])}return pe.length>0?pe:null}_getQuantizationFunction(ee,ie,J){return"point"===ee?ce=>(ce.x=ie(ce.x),ce.y=J(ce.y),ce):"polyline"===ee||"polygon"===ee?ce=>{const ue=(0,le.oU)(ce)?ce.rings:ce.paths,pe=[];for(let he=0,me=ue.length;he<me;he++){const _e=this._quantizePoints(ue[he],ie,J);_e&&pe.push(_e)}return pe.length>0?((0,le.oU)(ce)?ce.rings=pe:ce.paths=pe,ce):null}:"multipoint"===ee?ce=>{const ue=this._quantizePoints(ce.points,ie,J);return ue&&ue.length>0?(ce.points=ue,ce):null}:"extent"===ee?ce=>ce:null}_getHydrationFunction(ee,ie,J){return"point"===ee?ce=>{ce.x=ie(ce.x),ce.y=J(ce.y)}:"polyline"===ee||"polygon"===ee?ce=>{const ue=(0,le.oU)(ce)?ce.rings:ce.paths;let pe,he;for(let me=0,ge=ue.length;me<ge;me++){const _e=ue[me];for(let Ee=0,De=_e.length;Ee<De;Ee++){const be=_e[Ee];Ee>0?(pe+=be[0],he+=be[1]):(pe=be[0],he=be[1]),be[0]=ie(pe),be[1]=J(he)}}}:"extent"===ee?ce=>{ce.xmin=ie(ce.xmin),ce.ymin=J(ce.ymin),ce.xmax=ie(ce.xmax),ce.ymax=J(ce.ymax)}:"multipoint"===ee?ce=>{const ue=ce.points;let pe,he;for(let me=0,ge=ue.length;me<ge;me++){const _e=ue[me];me>0?(pe+=_e[0],he+=_e[1]):(pe=_e[0],he=_e[1]),_e[0]=ie(pe),_e[1]=J(he)}}:null}};(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],j.prototype,"displayFieldName",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],j.prototype,"exceededTransferLimit",void 0),(0,D._)([(0,B.Cb)({type:[G.Z],json:{write:!0}})],j.prototype,"features",void 0),(0,D._)([(0,X.r)("features")],j.prototype,"readFeatures",null),(0,D._)([(0,B.Cb)({type:[de.Z],json:{write:!0}})],j.prototype,"fields",void 0),(0,D._)([(0,B.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:re.read}}})],j.prototype,"geometryType",void 0),(0,D._)([(0,ae.c)("geometryType")],j.prototype,"writeGeometryType",null),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],j.prototype,"hasM",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],j.prototype,"hasZ",void 0),(0,D._)([(0,B.Cb)({types:R.qM,json:{write:!0}})],j.prototype,"queryGeometry",void 0),(0,D._)([(0,X.r)("queryGeometry")],j.prototype,"readQueryGeometry",null),(0,D._)([(0,B.Cb)({type:oe.Z,json:{write:!0}})],j.prototype,"spatialReference",void 0),(0,D._)([(0,ae.c)("spatialReference")],j.prototype,"writeSpatialReference",null),(0,D._)([(0,B.Cb)({json:{write:!0}})],j.prototype,"transform",void 0),j=se=(0,D._)([(0,te.j)("esri.rest.support.FeatureSet")],j),j.prototype.toJSON.isDefaultToJSON=!0;const Y=j},49739:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(58817),G=v(77712),Q=(v(90912),v(76898)),$=v(40251),W=v(40669);let H=B=class extends W.Z{constructor(te){super(te),this.colorRamps=null,this.type="multipart"}clone(){return new B({colorRamps:(0,R.d9)(this.colorRamps)})}};(0,D._)([(0,G.Cb)({type:[$.Z],json:{write:!0}})],H.prototype,"colorRamps",void 0),(0,D._)([(0,G.Cb)({type:["multipart"]})],H.prototype,"type",void 0),H=B=(0,D._)([(0,Q.j)("esri.rest.support.MultipartColorRamp")],H);const X=H},77294:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(91179);let B=class extends R.wq{constructor(X){super(X),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const X=this.geometries.map(oe=>oe.toJSON()),te=this.geometries[0],ae={};return ae.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),ae.inSR=te.spatialReference.wkid||JSON.stringify(te.spatialReference.toJSON()),ae.geometries=JSON.stringify({geometryType:(0,W.Ji)(te),geometries:X}),this.transformation&&(ae.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(ae.transformForward=this.transformForward),ae}};(0,D._)([(0,G.Cb)()],B.prototype,"geometries",void 0),(0,D._)([(0,G.Cb)({json:{read:{source:"outSR"}}})],B.prototype,"outSpatialReference",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"transformation",void 0),(0,D._)([(0,G.Cb)()],B.prototype,"transformForward",void 0),B=(0,D._)([(0,$.j)("esri.rest.support.ProjectParameters")],B);const H=B},89621:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var X,D=v(17626),G=(v(29132),v(2076)),Z=v(86810),Q=v(58817),$=v(77712),B=(v(90912),v(76898)),H=v(2004);const te=new G.X({upperLeft:"upper-left",lowerLeft:"lower-left"});let ae=X=class extends Z.wq{constructor(le){super(le),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new X((0,Q.d9)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,D._)([(0,$.Cb)({type:H.Z,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],ae.prototype,"extent",void 0),(0,D._)([(0,$.Cb)({type:["view","edit"],json:{write:!0}})],ae.prototype,"mode",void 0),(0,D._)([(0,$.Cb)({type:String,json:{read:te.read,write:te.write}})],ae.prototype,"originPosition",void 0),(0,D._)([(0,$.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],ae.prototype,"tolerance",void 0),ae=X=(0,D._)([(0,B.j)("esri.rest.support.QuantizationParameters")],ae);const oe=ae},96854:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ge});var D=v(17626),R=v(29132),G=v(97478),Z=v(2076),Q=v(86810),$=v(58817),W=v(62208),B=v(77712),H=v(66656),X=v(55342),te=v(76898),ae=v(99433),oe=v(90912),le=v(91179),de=v(15283),se=v(79608);v(85931);let j=class extends((0,se.J)(Q.wq)){constructor(_e){super(_e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};(0,D._)([(0,B.Cb)({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:(0,W.pC)(this.onFields)&&this.onFields.length>0}}}}})],j.prototype,"onFields",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],j.prototype,"operator",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],j.prototype,"searchTerm",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],j.prototype,"searchType",void 0),j=(0,D._)([(0,te.j)("esri.rest.support.FullTextSearch")],j);const Y=j;var ue,ee=v(89621),ie=v(60776),J=v(65234),ce=v(72642);const pe=new Z.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),he=new Z.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let me=ue=class extends Q.wq{constructor(_e){super(_e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(_e){return(0,oe.TJ)(ue,_e)}castDatumTransformation(_e){return"number"==typeof _e||"object"==typeof _e?_e:null}writeHistoricMoment(_e,Ee){Ee.historicMoment=_e&&_e.getTime()}writeParameterValues(_e,Ee){if(_e){const De={};for(const be in _e){const Se=_e[be];De[be]=Array.isArray(Se)?Se.map(ye=>ye instanceof Date?ye.getTime():ye):Se instanceof Date?Se.getTime():Se}Ee.parameterValues=De}}writeStart(_e,Ee){Ee.resultOffset=this.start,Ee.resultRecordCount=this.num||10,Ee.where="1=1"}writeWhere(_e,Ee){Ee.where=_e||"1=1"}clone(){return new ue((0,$.d9)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:(0,W.pC)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};me.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,D._)([(0,B.Cb)({json:{write:!0}})],me.prototype,"aggregateIds",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:!0}})],me.prototype,"cacheHint",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"compactGeometryEnabled",void 0),(0,D._)([(0,B.Cb)({json:{write:!0}})],me.prototype,"datumTransformation",void 0),(0,D._)([(0,H.p)("datumTransformation")],me.prototype,"castDatumTransformation",null),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"defaultSpatialReferenceEnabled",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:{overridePolicy:_e=>({enabled:_e>0})}}})],me.prototype,"distance",void 0),(0,D._)([(0,B.Cb)({type:de.n,json:{write:!0}})],me.prototype,"dynamicDataSource",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"formatOf3DObjects",void 0),(0,D._)([(0,B.Cb)({type:[Y],json:{write:{enabled:!0,overridePolicy(){return{enabled:(0,W.pC)(this.fullText)&&this.fullText.length>0}}}}})],me.prototype,"fullText",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"gdbVersion",void 0),(0,D._)([(0,B.Cb)({types:R.qM,json:{read:le.im,write:!0}})],me.prototype,"geometry",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:!0}})],me.prototype,"geometryPrecision",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],me.prototype,"groupByFieldsForStatistics",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"having",void 0),(0,D._)([(0,B.Cb)({type:Date})],me.prototype,"historicMoment",void 0),(0,D._)([(0,ae.c)("historicMoment")],me.prototype,"writeHistoricMoment",null),(0,D._)([(0,B.Cb)({type:Number,json:{write:!0}})],me.prototype,"maxAllowableOffset",void 0),(0,D._)([(0,B.Cb)({type:Number,cast:_e=>_e<1?1:_e>ue.MAX_MAX_RECORD_COUNT_FACTOR?ue.MAX_MAX_RECORD_COUNT_FACTOR:_e,json:{write:{overridePolicy:_e=>({enabled:_e>1})}}})],me.prototype,"maxRecordCountFactor",void 0),(0,D._)([(0,B.Cb)({type:["xyFootprint"],json:{write:!0}})],me.prototype,"multipatchOption",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],me.prototype,"num",void 0),(0,D._)([(0,B.Cb)({json:{write:!0}})],me.prototype,"objectIds",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],me.prototype,"orderByFields",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],me.prototype,"outFields",void 0),(0,D._)([(0,B.Cb)({type:J.Z,json:{name:"outSR",write:!0}})],me.prototype,"outSpatialReference",void 0),(0,D._)([(0,B.Cb)({type:[ie.Z],json:{write:{enabled:!0,overridePolicy(){return{enabled:(0,W.pC)(this.outStatistics)&&this.outStatistics.length>0}}}}})],me.prototype,"outStatistics",void 0),(0,D._)([(0,B.Cb)({json:{write:!0}})],me.prototype,"parameterValues",void 0),(0,D._)([(0,ae.c)("parameterValues")],me.prototype,"writeParameterValues",null),(0,D._)([(0,B.Cb)({type:ce.Z,json:{write:!0}})],me.prototype,"pixelSize",void 0),(0,D._)([(0,B.Cb)({type:ee.Z,json:{write:!0}})],me.prototype,"quantizationParameters",void 0),(0,D._)([(0,B.Cb)({type:[Object],json:{write:!0}})],me.prototype,"rangeValues",void 0),(0,D._)([(0,B.Cb)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],me.prototype,"relationParameter",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"resultType",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"returnCentroid",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"returnDistinctValues",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!0,write:!0}})],me.prototype,"returnExceededLimitFeatures",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:!0}})],me.prototype,"returnGeometry",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"returnQueryGeometry",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"returnM",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:_e=>({enabled:_e})}}})],me.prototype,"returnZ",void 0),(0,D._)([(0,B.Cb)({type:J.Z,json:{write:!0}})],me.prototype,"sourceSpatialReference",void 0),(0,D._)([(0,X.J)(pe,{ignoreUnknown:!1,name:"spatialRel"})],me.prototype,"spatialRelationship",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],me.prototype,"start",void 0),(0,D._)([(0,ae.c)("start"),(0,ae.c)("num")],me.prototype,"writeStart",null),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"sqlFormat",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],me.prototype,"text",void 0),(0,D._)([(0,B.Cb)({type:G.Z,json:{write:!0}})],me.prototype,"timeExtent",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{default:!1,write:!0}})],me.prototype,"timeReferenceUnknownClient",void 0),(0,D._)([(0,X.J)(he,{ignoreUnknown:!1}),(0,B.Cb)({json:{write:{overridePolicy(_e){return{enabled:!!_e&&null!=this.distance&&this.distance>0}}}}})],me.prototype,"units",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:{overridePolicy(_e){return{enabled:null!=_e||null!=this.start&&this.start>0}}}}})],me.prototype,"where",void 0),(0,D._)([(0,ae.c)("where")],me.prototype,"writeWhere",null),me=ue=(0,D._)([(0,te.j)("esri.rest.support.Query")],me);const ge=me},67010:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var te,D=v(17626),G=(v(29132),v(86810)),Z=v(58817),Q=v(77712),$=v(90912),W=v(76898),B=v(99433),H=v(15283),X=v(65234);let ae=te=class extends G.wq{constructor(le){super(le),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(le,de){de.historicMoment=le&&le.getTime()}writeStart(le,de){de.resultOffset=this.start,de.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(de.definitionExpression="1=1")}clone(){return new te((0,Z.d9)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],ae.prototype,"cacheHint",void 0),(0,D._)([(0,Q.Cb)({type:H.n,json:{write:!0}})],ae.prototype,"dynamicDataSource",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],ae.prototype,"gdbVersion",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ae.prototype,"geometryPrecision",void 0),(0,D._)([(0,Q.Cb)({type:Date})],ae.prototype,"historicMoment",void 0),(0,D._)([(0,B.c)("historicMoment")],ae.prototype,"_writeHistoricMoment",null),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ae.prototype,"maxAllowableOffset",void 0),(0,D._)([(0,Q.Cb)({type:[Number],json:{write:!0}})],ae.prototype,"objectIds",void 0),(0,D._)([(0,Q.Cb)({type:[String],json:{write:!0}})],ae.prototype,"orderByFields",void 0),(0,D._)([(0,Q.Cb)({type:[String],json:{write:!0}})],ae.prototype,"outFields",void 0),(0,D._)([(0,Q.Cb)({type:X.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ae.prototype,"outSpatialReference",void 0),(0,D._)([(0,Q.Cb)({json:{write:!0}})],ae.prototype,"relationshipId",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],ae.prototype,"start",void 0),(0,D._)([(0,B.c)("start"),(0,B.c)("num")],ae.prototype,"writeStart",null),(0,D._)([(0,Q.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],ae.prototype,"num",void 0),(0,D._)([(0,Q.Cb)({json:{write:!0}})],ae.prototype,"returnGeometry",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:{overridePolicy:le=>({enabled:le})}}})],ae.prototype,"returnM",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:{overridePolicy:le=>({enabled:le})}}})],ae.prototype,"returnZ",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ae.prototype,"where",void 0),ae=te=(0,D._)([(0,W.j)("esri.rest.support.RelationshipQuery")],ae),ae.from=(0,$.se)(ae);const oe=ae},60776:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var H,D=v(17626),R=v(2076),G=v(86810),Z=v(58817),Q=v(77712),W=(v(90912),v(76898)),B=v(99433);const X=new R.X({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let te=H=class extends G.wq{constructor(oe){super(oe),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(oe,le){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(le.statisticParameters=(0,Z.d9)(oe))}clone(){return new H({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,Z.d9)(this.statisticParameters)})}};(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],te.prototype,"maxPointCount",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],te.prototype,"maxRecordCount",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],te.prototype,"maxVertexCount",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"onStatisticField",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],te.prototype,"outStatisticFieldName",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{read:{source:"statisticType",reader:X.read},write:{target:"statisticType",writer:X.write}}})],te.prototype,"statisticType",void 0),(0,D._)([(0,Q.Cb)({type:Object})],te.prototype,"statisticParameters",void 0),(0,D._)([(0,B.c)("statisticParameters")],te.prototype,"writeStatisticParameters",null),te=H=(0,D._)([(0,W.j)("esri.rest.support.StatisticDefinition")],te);const ae=te},6871:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>J});var le,D=v(17626),R=v(29132),G=v(97478),Z=v(2076),Q=v(86810),$=v(58817),W=v(62208),B=v(77712),H=v(90912),X=v(76898),te=v(99433),ae=v(91179);v(85931);let de=le=class extends Q.wq{constructor(ce){super(ce),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new le({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],de.prototype,"groupByFields",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:!0}})],de.prototype,"topCount",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],de.prototype,"orderByFields",void 0),de=le=(0,D._)([(0,X.j)("esri.rest.support.TopFilter")],de);const se=de;var j,re=v(65234);const Y=new Z.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ee=new Z.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ie=j=class extends Q.wq{constructor(ce){super(ce),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(ce,ue){ue.resultOffset=this.start,ue.resultRecordCount=this.num||10}clone(){return new j((0,$.d9)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};(0,D._)([(0,B.Cb)({type:Boolean,json:{write:!0}})],ie.prototype,"cacheHint",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:{overridePolicy:ce=>({enabled:ce>0})}}})],ie.prototype,"distance",void 0),(0,D._)([(0,B.Cb)({types:R.qM,json:{read:ae.im,write:!0}})],ie.prototype,"geometry",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:!0}})],ie.prototype,"geometryPrecision",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{write:!0}})],ie.prototype,"maxAllowableOffset",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],ie.prototype,"num",void 0),(0,D._)([(0,B.Cb)({json:{write:!0}})],ie.prototype,"objectIds",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],ie.prototype,"orderByFields",void 0),(0,D._)([(0,B.Cb)({type:[String],json:{write:!0}})],ie.prototype,"outFields",void 0),(0,D._)([(0,B.Cb)({type:re.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ie.prototype,"outSpatialReference",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],ie.prototype,"resultType",void 0),(0,D._)([(0,B.Cb)({json:{write:!0}})],ie.prototype,"returnGeometry",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:ce=>({enabled:ce})}}})],ie.prototype,"returnM",void 0),(0,D._)([(0,B.Cb)({type:Boolean,json:{write:{overridePolicy:ce=>({enabled:ce})}}})],ie.prototype,"returnZ",void 0),(0,D._)([(0,B.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],ie.prototype,"start",void 0),(0,D._)([(0,te.c)("start"),(0,te.c)("num")],ie.prototype,"writeStart",null),(0,D._)([(0,B.Cb)({type:String,json:{read:{source:"spatialRel",reader:Y.read},write:{target:"spatialRel",writer:Y.write}}})],ie.prototype,"spatialRelationship",void 0),(0,D._)([(0,B.Cb)({type:G.Z,json:{write:!0}})],ie.prototype,"timeExtent",void 0),(0,D._)([(0,B.Cb)({type:se,json:{write:!0}})],ie.prototype,"topFilter",void 0),(0,D._)([(0,B.Cb)({type:String,json:{read:ee.read,write:{writer:ee.write,overridePolicy(ce){return{enabled:(0,W.pC)(ce)&&(0,W.pC)(this.distance)&&this.distance>0}}}}})],ie.prototype,"units",void 0),(0,D._)([(0,B.Cb)({type:String,json:{write:!0}})],ie.prototype,"where",void 0),ie=j=(0,D._)([(0,X.j)("esri.rest.support.TopFeaturesQuery")],ie),ie.from=(0,H.se)(ie);const J=ie},79023:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>Z,i:()=>Q});var D=v(40251),R=v(40669),G=v(49739);const Z={key:"type",base:R.Z,typeMap:{algorithmic:D.Z,multipart:G.Z}};function Q($){return $&&$.type?"algorithmic"===$.type?D.Z.fromJSON($):"multipart"===$.type?G.Z.fromJSON($):null:null}},2618:(nt,Ae,v)=>{"use strict";v.d(Ae,{cv:()=>B,en:()=>W,lA:()=>$}),v(59318),v(24263);var G=v(58817),Z=v(21726);function $(X,te){return te?{...te,query:{...X,...te.query}}:{query:X}}function W(X){return"string"==typeof X?(0,Z.mN)(X):(0,G.d9)(X)}function B(X,te,ae){const oe={};for(const le in X){if("declaredClass"===le)continue;const de=X[le];if(null!=de&&"function"!=typeof de)if(Array.isArray(de)){oe[le]=[];for(let se=0;se<de.length;se++)oe[le][se]=B(de[se])}else if("object"==typeof de)if(de.toJSON){const se=de.toJSON(ae&&ae[le]);oe[le]=te?se:JSON.stringify(se)}else oe[le]=te?de:JSON.stringify(de);else oe[le]=de}return oe}v(12680)},51815:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>te});var D=v(17626),R=v(88879),Z=(v(63290),v(90912)),B=(v(85931),v(26584),v(8314),v(61039)),H=v(76898),X=v(28705);let te=class extends X.a{_own(ae){ae.layer&&"remove"in ae.layer&&ae.layer!==this.owner&&ae.layer.remove(ae),ae.layer=this.owner}_release(ae){ae.layer===this.owner&&(ae.layer=null)}};(0,D._)([(0,B.c)({Type:R.Z,ensureType:(0,Z.se)(R.Z)})],te.prototype,"itemType",void 0),te=(0,D._)([(0,H.j)("esri.support.GraphicsCollection")],te)},6432:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>ae});var D=v(17626),R=v(46160),G=v(89726),Z=v(63290),Q=v(10699),$=v(77712),H=(v(85931),v(90912),v(76898)),X=v(44917);function te(oe,le,de){let se,re;if(oe)for(let j=0,Y=oe.length;j<Y;j++){if(se=oe.getItemAt(j),se[le]===de)return se;if("group"===se?.type&&(re=te(se.layers,le,de),re))return re}}const ae=oe=>{let le=class extends oe{constructor(...de){super(...de),this.layers=new R.Z;const re=Y=>{Y.parent=this,this.layerAdded(Y),"elevation"!==Y.type&&"base-elevation"!==Y.type||Z.Z.getLogger(this.declaredClass).error(`Layer 'title:${Y.title}, id:${Y.id}' of type '${Y.type}' is not supported as an operational layer and will therefore be ignored.`)},j=Y=>{Y.parent=null,this.layerRemoved(Y)};this.layers.on("before-add",Y=>(Y=>{Y.parent&&"remove"in Y.parent&&Y.parent.remove(Y)})(Y.item)),this.layers.on("after-add",Y=>re(Y.item)),this.layers.on("after-remove",Y=>j(Y.item))}destroy(){const de=this.layers.removeAll();for(const se of de)this.layerRemoved(se),se.destroy();this.layers.destroy()}set layers(de){this._set("layers",(0,G.Z)(de,this._get("layers")))}add(de,se){const re=this.layers;if(se=re.getNextIndex(se),de instanceof X.Z){const j=de;j.parent===this?this.reorder(j,se):re.add(j,se)}else(0,Q.y8)(de)?de.then(j=>{this.destroyed||this.add(j,se)}):Z.Z.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(de,se){const re=this.layers;se=re.getNextIndex(se),de.slice().forEach(j=>{j.parent!==this?(re.add(j,se),se+=1):this.reorder(j,se)})}findLayerById(de){return te(this.layers,"id",de)}findLayerByUid(de){return te(this.layers,"uid",de)}remove(de){return this.layers.remove(de)}removeMany(de){return this.layers.removeMany(de)}removeAll(){return this.layers.removeAll()}reorder(de,se){return this.layers.reorder(de,se)}layerAdded(de){}layerRemoved(de){}};return(0,D._)([(0,$.Cb)()],le.prototype,"layers",null),le=(0,D._)([(0,H.j)("esri.support.LayersMixin")],le),le}},6119:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>X});var D=v(17626),R=v(46160),G=v(89726),Z=v(63290),Q=v(77712),B=(v(85931),v(90912),v(76898));function H(te,ae,oe){if(te)for(let le=0,de=te.length;le<de;le++){const se=te.getItemAt(le);if(se[ae]===oe)return se;if("group"===se?.type){const re=H(se.tables,ae,oe);if(re)return re}}}const X=te=>{let ae=class extends te{constructor(...oe){super(...oe),this.tables=new R.Z,this.tables.on("after-add",le=>{const de=le.item;de.parent&&de.parent!==this&&"tables"in de.parent&&de.parent.tables.remove(de),de.parent=this,"feature"!==de.type&&Z.Z.getLogger(this.declaredClass).error(`Layer 'title:${de.title}, id:${de.id}' of type '${de.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",le=>{le.item.parent=null})}destroy(){const oe=this.tables.removeAll();for(const le of oe)le.destroy();this.tables.destroy()}set tables(oe){this._set("tables",(0,G.Z)(oe,this._get("tables")))}findTableById(oe){return H(this.tables,"id",oe)}findTableByUid(oe){return H(this.tables,"uid",oe)}};return(0,D._)([(0,Q.Cb)()],ae.prototype,"tables",null),ae=(0,D._)([(0,B.j)("esri.support.TablesMixin")],ae),ae}},59397:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(14517),G=v(61996),Z=v(77712),W=(v(85931),v(90912),v(76898));let H=B=class extends((0,G.IG)(R.Z)){constructor(te){super(te),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new B({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};(0,D._)([(0,Z.Cb)()],H.prototype,"active",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"className",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"disabled",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"id",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"indicator",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"title",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"type",void 0),(0,D._)([(0,Z.Cb)()],H.prototype,"visible",void 0),H=B=(0,D._)([(0,W.j)("esri.support.actions.ActionBase")],H);const X=H},48753:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(59397);let B=W=class extends $.Z{constructor(X){super(X),this.image=null,this.type="button"}clone(){return new W({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};(0,D._)([(0,R.Cb)()],B.prototype,"image",void 0),B=W=(0,D._)([(0,Q.j)("esri.support.Action.ActionButton")],B);const H=B},10671:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var W,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(59397);let B=W=class extends $.Z{constructor(X){super(X),this.image=null,this.type="toggle",this.value=!1}clone(){return new W({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};(0,D._)([(0,R.Cb)()],B.prototype,"image",void 0),(0,D._)([(0,R.Cb)()],B.prototype,"value",void 0),B=W=(0,D._)([(0,Q.j)("esri.support.Action.ActionToggle")],B);const H=B},12680:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>Z});var D=v(21726);const R=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Z(Q){const $=(0,D.P$)(Q,!0);return!!$&&$.endsWith(".arcgis.com")&&!R.includes($)&&!Q.endsWith("/sharing/rest/generateToken")}},46679:(nt,Ae,v)=>{"use strict";v.d(Ae,{LC:()=>H,WW:()=>X,Yi:()=>te,mz:()=>le,pp:()=>oe});var D=v(15861),G=(v(29132),v(26584)),Z=v(63290),Q=v(62208),$=v(65234);const W=Z.Z.getLogger("esri.support.arcadeOnDemand");let B;function H(){return B||(B=(0,D.Z)(function*(){const de=yield Promise.all([v.e(8592),v.e(4988)]).then(v.bind(v,4988));return{arcade:de.arcade,arcadeUtils:de,Dictionary:de.Dictionary,Feature:de.arcadeFeature}})()),B}const X=(de,se,re)=>le.create(de,se,re,null,["$feature"]),te=(de,se,re)=>le.create(de,se,re,null,["$feature","$view"]),oe=(de,se,re,j)=>le.create(de,se,re,j,["$feature","$view"]);class le{constructor(se,re,j,Y,ee,ie,J,ce){this.script=se,this.evaluate=ee;const ue=Array.isArray(J)?J:J.fields;this.fields=ue,this._syntaxTree=Y,this._arcade=re,this._arcadeDictionary=j,this._arcadeFeature=ie,this._spatialReference=ce,this._referencesGeometry=re.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static create(se,re,j,Y,ee,ie){return(0,D.Z)(function*(){const{arcade:J,Feature:ce,Dictionary:ue}=yield H(),pe=$.Z.fromJSON(re);let he=null;try{he=J.parseScript(se,ie)}catch(We){return W.error(new G.Z("arcade-bad-expression","Failed to parse arcade script",{script:se,error:We})),null}const me=ee.reduce((We,Ce)=>({...We,[Ce]:null}),{});let ge=null;(0,Q.pC)(Y)&&(ge=new ue(Y),ge.immutable=!0,me.$config=null);const _e=J.scriptUsesGeometryEngine(he),Ee=_e&&J.enableGeometrySupport(),De=J.scriptUsesFeatureSet(he)&&J.enableFeatureSetSupport(),be=J.scriptIsAsync(he),Se=be&&J.enableAsyncSupport(),ye={vars:me,spatialReference:pe,useAsync:!!Se};yield Promise.all([Ee,De,Se]);const ve=new Set;yield J.loadDependentModules(ve,he,null,be,_e);const xe=new ue;xe.immutable=!1,xe.setField("scale",0);const ze=J.compileScript(he,ye);return new le(se,J,ue,he,We=>("$view"in We&&We.$view&&(xe.setField("scale",We.$view.scale),We.$view=xe),ge&&(We.$config=ge),ze({vars:We,spatialReference:pe})),new ce,j,pe)})()}repurposeFeature(se){return se.geometry&&!se.geometry.spatialReference&&(se.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(se.geometry,se.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(se){return this._arcade.referencesMember(this._syntaxTree,se)}referencesFunction(se){return this._arcade.referencesFunction(this._syntaxTree,se)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}},33954:(nt,Ae,v)=>{"use strict";v.d(Ae,{g:()=>Z,s:()=>$});var D=v(15861),R=v(54346),G=v(41840);function Z(W){return Q.apply(this,arguments)}function Q(){return(Q=(0,D.Z)(function*(W){if(!W)return;const B=W.includes("-vector")?W.slice(0,W.indexOf("-vector")):W,H=yield(0,G.ME)("esri/t9n/basemaps");return H[W]||H[B]})).apply(this,arguments)}const $={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,R.V)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},38953:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>R});var D=v(46882);function R(G){return new D.Z({getCollections:()=>[G.tables,G.layers],getChildrenFunction:Z=>{const Q=[];return"tables"in Z&&Q.push(Z.tables),"layers"in Z&&Q.push(Z.layers),Q},itemFilterFunction:Z=>{const Q=Z.parent;return Q&&"tables"in Q&&Q.tables.includes(Z)}})}},35560:(nt,Ae,v)=>{"use strict";v.d(Ae,{K3:()=>R,Rx:()=>Q,hq:()=>G});var D=v(8314);const R=()=>!!(0,D.Z)("enable-feature:force-wosr"),G=()=>!!(0,D.Z)("enable-feature:direct-3d-object-feature-layer-display"),Q=()=>!!(0,D.Z)("enable-feature:SceneLayer-editing")},49430:(nt,Ae,v)=>{"use strict";v.d(Ae,{eZ:()=>de});var D=v(73281),R=v(36630),G=v(55664),W=(v(55013),v(16615),v(82561),v(75484)),te=(v(64531),v(6785),v(501),v(25621)),ae=v(66845);const oe=["oid","global-id"],le=["oid","global-id","guid"];function de({displayField:Se,editFieldsInfo:ye,fields:ve,objectIdField:xe,title:ze},Ke){if(!ve)return null;const We=function ue({editFieldsInfo:Se,fields:ye,objectIdField:ve},xe){return function Y(Se,ye){const ve=Se;return ye&&(Se=Se.filter(xe=>!ye.includes(xe.type))),Se===ve&&(Se=Se.slice()),Se.sort(ee),Se}(ye??[],xe?.ignoreFieldTypes||be).map(ze=>new te.Z({fieldName:ze.name,isEditable:J(ze,Se),label:ze.alias,format:me(ze),visible:j(ze,{editFieldsInfo:Se,objectIdField:ve,visibleFieldNames:xe?.visibleFieldNames})}))}({editFieldsInfo:ye,fields:ve,objectIdField:xe},Ke);if(!We.length)return null;const Ce=function Ee(Se){const ye=(0,R.O5)(Se),{titleBase:ve}=Se;return ye?`${ve}: {${ye.trim()}}`:ve??""}({titleBase:ze,fields:ve,displayField:Se}),Be=function ge(){return[new W.Z,new G.Z]}();return new D.Z({title:Ce,content:Be,fieldInfos:We})}const re=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],j=(Se,{editFieldsInfo:ye,objectIdField:ve,visibleFieldNames:xe})=>xe?xe.has(Se.name):!(ie(Se.name,ye)||ve&&Se.name===ve||oe.includes(Se.type)||re.some(ze=>ze.test(Se.name)));function ee(Se,ye){return"oid"===Se.type?-1:"oid"===ye.type?1:De(Se)?-1:De(ye)?1:(Se.alias||Se.name).toLocaleLowerCase().localeCompare((ye.alias||ye.name).toLocaleLowerCase())}function ie(Se,ye){if(!Se||!ye)return!1;const{creationDateField:ve,creatorField:xe,editDateField:ze,editorField:Ke}=ye;return[ve&&ve.toLowerCase(),xe&&xe.toLowerCase(),ze&&ze.toLowerCase(),Ke&&Ke.toLowerCase()].includes(Se.toLowerCase())}function J(Se,ye){return Se.editable&&!le.includes(Se.type)&&!ie(Se.name,ye)}function me(Se){switch(Se.type){case"small-integer":case"integer":case"single":return new ae.Z({digitSeparator:!0,places:0});case"double":return new ae.Z({digitSeparator:!0,places:2});case"date":return new ae.Z({dateFormat:"long-month-day-year"});default:return"string"===Se.type&&(0,R.Ec)(Se.name)?new ae.Z({digitSeparator:!0,places:0}):null}}function De(Se){return"name"===(Se.name&&Se.name.toLowerCase())||"name"===(Se.alias&&Se.alias.toLowerCase())}const be=["geometry","blob","raster","guid","xml"]},70026:(nt,Ae,v)=>{"use strict";v.d(Ae,{t:()=>G});var D=v(15861),R=v(84792);function G(Q,$){return Z.apply(this,arguments)}function Z(){return(Z=(0,D.Z)(function*(Q,$){const{data:W}=yield(0,R.default)(Q,{responseType:"image",...$});return W})).apply(this,arguments)}},33899:(nt,Ae,v)=>{"use strict";v.d(Ae,{Hu:()=>H,fY:()=>W,jH:()=>X,jz:()=>te});var D=v(15861),R=v(59318),G=v(8314),Z=v(62208),Q=v(10699),$=v(21726);function W(oe,le,de=!1,se){return new Promise((re,j)=>{if((0,Q.Hc)(se))return void j(B());let Y=()=>{J(),j(new Error(`Unable to load ${le}`))},ee=()=>{const ce=oe;J(),re(ce)},ie=()=>{if(!oe)return;const ce=oe;J(),ce.src="",j(B())};const J=()=>{(0,G.Z)("esri-image-decode")||(oe.removeEventListener("error",Y),oe.removeEventListener("load",ee)),Y=null,ee=null,oe=null,(0,Z.pC)(se)&&se.removeEventListener("abort",ie),ie=null,de&&URL.revokeObjectURL(le)};(0,Z.pC)(se)&&se.addEventListener("abort",ie),(0,G.Z)("esri-image-decode")?oe.decode().then(ee,Y):(oe.addEventListener("error",Y),oe.addEventListener("load",ee))})}function B(){try{return new DOMException("Aborted","AbortError")}catch{const oe=new Error;return oe.name="AbortError",oe}}function H(oe){R.Z.request.crossOriginNoCorsDomains||(R.Z.request.crossOriginNoCorsDomains={});const le=R.Z.request.crossOriginNoCorsDomains;for(let de of oe)de=de.toLowerCase(),/^https?:\/\//.test(de)?le[(0,$.P$)(de)??""]=0:(le[(0,$.P$)("http://"+de)??""]=0,le[(0,$.P$)("https://"+de)??""]=0)}function X(oe){const le=R.Z.request.crossOriginNoCorsDomains;if(le){let de=(0,$.P$)(oe);if(de)return de=de.toLowerCase(),!(0,$.D6)(de,(0,$.TI)())&&le[de]<Date.now()-36e5}return!1}function te(oe){return ae.apply(this,arguments)}function ae(){return(ae=(0,D.Z)(function*(oe){const le=R.Z.request.crossOriginNoCorsDomains,de=(0,$.P$)(oe);le&&de&&(le[de.toLowerCase()]=Date.now());const se=(0,$.mN)(oe);oe=se.path,"json"===se.query?.f&&(oe+="?f=json");try{yield fetch(oe,{mode:"no-cors",credentials:"include"})}catch{}})).apply(this,arguments)}},38365:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>R,r:()=>D});const D="20221121",R="f520630575ed53cf8b49e5f1492799065ee366e5"},20383:(nt,Ae,v)=>{"use strict";v.d(Ae,{se:()=>Xe,cT:()=>Fe,dU:()=>je,S9:()=>Ie,LB:()=>Re,AH:()=>He,yK:()=>Pe,S6:()=>Ne,QT:()=>Ge,f_:()=>Me});var ce,D=v(90912),R=v(383),G=v(94398),Q=(v(65499),v(48575)),H=(v(9260),v(11472),v(26531),v(22490)),X=v(9436),oe=(v(21068),v(46735),v(36687)),se=(v(2066),v(69147),v(17626)),re=v(58817),j=v(23841),Y=v(77712),ee=v(55342),ie=v(76898),J=v(69738);let ue=ce=class extends Q.Z{constructor(...Ye){super(...Ye),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(Ye,Je,rt,tt){if(Ye&&"string"!=typeof Ye&&null==Ye.imageData)return Ye;const et={};return Ye&&(et.url=Ye),Je&&(et.outline=Je),null!=rt&&(et.width=(0,j.t_)(rt)),null!=tt&&(et.height=(0,j.t_)(tt)),et}clone(){const Ye=new ce({color:(0,re.d9)(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return Ye._set("source",(0,re.d9)(this.source)),Ye}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};(0,se._)([(0,ee.J)({esriPFS:"picture-fill"},{readOnly:!0})],ue.prototype,"type",void 0),(0,se._)([(0,Y.Cb)(J.KA)],ue.prototype,"url",void 0),(0,se._)([(0,Y.Cb)({type:Number,json:{write:!0}})],ue.prototype,"xscale",void 0),(0,se._)([(0,Y.Cb)({type:Number,json:{write:!0}})],ue.prototype,"yscale",void 0),(0,se._)([(0,Y.Cb)({type:Number,cast:j.t_,json:{write:!0}})],ue.prototype,"width",void 0),(0,se._)([(0,Y.Cb)({type:Number,cast:j.t_,json:{write:!0}})],ue.prototype,"height",void 0),(0,se._)([(0,Y.Cb)({type:Number,cast:j.t_,json:{write:!0}})],ue.prototype,"xoffset",void 0),(0,se._)([(0,Y.Cb)({type:Number,cast:j.t_,json:{write:!0}})],ue.prototype,"yoffset",void 0),(0,se._)([(0,Y.Cb)(J.Ds)],ue.prototype,"source",void 0),ue=ce=(0,se._)([(0,ie.j)("esri.symbols.PictureFillSymbol")],ue);const pe=ue;var he=v(13546),me=v(69852),ge=v(89673),_e=v(88493),Ee=v(52068),De=v(57213),be=v(10012),ve=(v(39368),v(97665),v(35540)),Ke=(v(21716),v(72622),v(12874));function Fe(Ye){if(!Ye)return!1;switch(Ye.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function je(Ye){if(!Ye)return!1;switch(Ye.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}v(17497),v(71530);const Re={base:be.Z,key:"type",typeMap:{"simple-fill":_e.Z,"picture-fill":pe,"picture-marker":he.Z,"simple-line":Ee.Z,"simple-marker":De.Z,text:ve.Z,"label-3d":H.Z,"line-3d":X.Z,"mesh-3d":oe.Z,"point-3d":me.Z,"polygon-3d":ge.Z,"web-style":Ke.Z,cim:G.Z},errorContext:"symbol"},He={base:be.Z,key:"type",typeMap:{"picture-marker":he.Z,"simple-marker":De.Z,text:ve.Z,"web-style":Ke.Z,cim:G.Z},errorContext:"symbol"},Ie=(0,R.d)({types:Re}),Ge={base:be.Z,key:"type",typeMap:{"simple-fill":_e.Z,"picture-fill":pe,"picture-marker":he.Z,"simple-line":Ee.Z,"simple-marker":De.Z,text:ve.Z,"line-3d":X.Z,"mesh-3d":oe.Z,"point-3d":me.Z,"polygon-3d":ge.Z,"web-style":Ke.Z,cim:G.Z},errorContext:"symbol"},Pe={base:be.Z,key:"type",typeMap:{text:ve.Z,"label-3d":H.Z},errorContext:"symbol"},Me={base:be.Z,key:"type",typeMap:{"line-3d":X.Z,"mesh-3d":oe.Z,"point-3d":me.Z,"polygon-3d":ge.Z,"web-style":Ke.Z,cim:G.Z},errorContext:"symbol"},Ne={base:be.Z,key:"type",typeMap:{"label-3d":H.Z},errorContext:"symbol"},Xe=(0,D.N7)(Re)},94398:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var oe,D=v(15861),R=v(17626),G=v(58817),Z=v(77275),Q=v(77712),W=(v(90912),v(55342)),B=v(68653),H=v(76898),X=v(99433),te=v(36630),ae=v(10012);let le=oe=class extends ae.Z{constructor(se){super(se),this.data=null,this.type="cim"}readData(se,re){return re}writeData(se,re){if(se)for(const j in se)re[j]=se[j]}collectRequiredFields(se,re){var j=this;return(0,D.Z)(function*(){if("CIMSymbolReference"===j.data?.type){const Y=j.data.primitiveOverrides;if(Y){const ee=Y.map(ie=>(0,te.io)(se,re,ie.valueExpressionInfo.expression));yield Promise.all(ee)}}})()}clone(){return new oe({data:(0,G.d9)(this.data)})}hash(){return(0,Z.hP)(JSON.stringify(this.data)).toString()}};(0,R._)([(0,Q.Cb)({json:{write:!1}})],le.prototype,"color",void 0),(0,R._)([(0,Q.Cb)({json:{write:!0}})],le.prototype,"data",void 0),(0,R._)([(0,B.r)("data",["symbol"])],le.prototype,"readData",null),(0,R._)([(0,X.c)("data",{})],le.prototype,"writeData",null),(0,R._)([(0,W.J)({CIMSymbolReference:"cim"},{readOnly:!0})],le.prototype,"type",void 0),le=oe=(0,R._)([(0,H.j)("esri.symbols.CIMSymbol")],le);const de=le},65499:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var te,D=v(17626),R=v(62208),G=v(77712),$=(v(85931),v(90912),v(55342)),W=v(76898),B=v(97665),H=v(61261),X=v(64830);let ae=te=class extends B.Z{constructor(le){super(le),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new te({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:(0,R.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};(0,D._)([(0,$.J)({Extrude:"extrude"},{readOnly:!0})],ae.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],ae.prototype,"size",void 0),(0,D._)([(0,G.Cb)({type:X.b,json:{write:!0}})],ae.prototype,"material",void 0),(0,D._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ae.prototype,"castShadows",void 0),(0,D._)([(0,G.Cb)(H.Z)],ae.prototype,"edges",void 0),ae=te=(0,D._)([(0,W.j)("esri.symbols.ExtrudeSymbol3DLayer")],ae);const oe=ae},48575:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(52068),W=v(10012);let B=class extends W.Z{constructor(X){super(X),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};(0,D._)([(0,R.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":$.Z}},json:{default:null,write:!0}})],B.prototype,"outline",void 0),(0,D._)([(0,R.Cb)({type:["simple-fill","picture-fill"],readOnly:!0})],B.prototype,"type",void 0),B=(0,D._)([(0,Q.j)("esri.symbols.FillSymbol")],B);const H=B},9260:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>_e});var j,D=v(17626),R=v(62208),G=v(77712),$=(v(85931),v(90912),v(55342)),W=v(76898),B=v(97665),H=v(61261),X=v(63743),te=v(153),ae=v(99255),oe=v(12948),re=(v(63290),v(26584),v(8314),v(64830));let Y=j=class extends re.b{constructor(Ee){super(Ee),this.colorMixMode=null}clone(){const Ee={color:(0,R.pC)(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new j(Ee)}};(0,D._)([(0,$.J)({multiply:"multiply",replace:"replace",tint:"tint"})],Y.prototype,"colorMixMode",void 0),Y=j=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DFillMaterial")],Y);var pe,ee=v(91558),ie=v(86810),J=v(23841),ce=v(60958),ue=v(43652);let he=pe=class extends ie.wq{constructor(Ee){super(Ee),this.color=new ee.Z([0,0,0,1]),this.size=(0,J.Wz)(1),this.pattern=null,this.patternCap="butt"}clone(){const Ee={color:(0,R.pC)(this.color)?this.color.clone():null,size:this.size,pattern:(0,R.pC)(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new pe(Ee)}};var me;(0,D._)([(0,G.Cb)(ce.a)],he.prototype,"color",void 0),(0,D._)([(0,G.Cb)(ce.y)],he.prototype,"size",void 0),(0,D._)([(0,G.Cb)(ae.D)],he.prototype,"pattern",void 0),(0,D._)([(0,G.Cb)({type:ue.Hc,json:{default:"butt",write:{overridePolicy(){return{enabled:(0,R.pC)(this.pattern)}}}}})],he.prototype,"patternCap",void 0),he=pe=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DOutline")],he);let ge=me=class extends B.Z{constructor(Ee){super(Ee),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const Ee={edges:(0,R.pC)(this.edges)?this.edges.clone():null,enabled:this.enabled,material:(0,R.pC)(this.material)?this.material.clone():null,pattern:(0,R.pC)(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:(0,R.pC)(this.outline)?this.outline.clone():null};return new me(Ee)}static fromSimpleFillSymbol(Ee){const De=Ee.outline&&Ee.outline.style&&"inside-frame"!==Ee.outline.style&&"solid"!==Ee.outline.style?new X.Z({style:Ee.outline.style}):null,be={size:Ee.outline?.width??0,color:(Ee.outline?.color??oe.ix).clone(),pattern:De};return De&&Ee.outline?.cap&&(be.patternCap=Ee.outline.cap),new me({material:new Y({color:(Ee.color??oe.l9).clone()}),pattern:Ee.style&&"solid"!==Ee.style?new te.Z({style:Ee.style}):null,outline:be})}};(0,D._)([(0,$.J)({Fill:"fill"},{readOnly:!0})],ge.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:Y,json:{write:!0}})],ge.prototype,"material",void 0),(0,D._)([(0,G.Cb)(ae.q)],ge.prototype,"pattern",void 0),(0,D._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ge.prototype,"castShadows",void 0),(0,D._)([(0,G.Cb)({type:he,json:{write:!0}})],ge.prototype,"outline",void 0),(0,D._)([(0,G.Cb)(H.Z)],ge.prototype,"edges",void 0),ge=me=(0,D._)([(0,W.j)("esri.symbols.FillSymbol3DLayer")],ge);const _e=ge},11472:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var H,D=v(17626),R=v(86810),G=v(23841),Z=v(77712),$=(v(85931),v(66656)),W=v(76898),B=v(50369);let X=H=class extends R.wq{constructor(ae){super(ae),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(ae){return(0,G.t_)(ae)}clone(){return new H({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};(0,D._)([(0,Z.Cb)({type:B.JT,json:{default:"none",write:!0}})],X.prototype,"decoration",void 0),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],X.prototype,"family",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:{overridePolicy:(ae,oe,le)=>({enabled:!le||!le.textSymbol3D})}}})],X.prototype,"size",void 0),(0,D._)([(0,$.p)("size")],X.prototype,"castSize",null),(0,D._)([(0,Z.Cb)({type:B.g6,json:{default:"normal",write:!0}})],X.prototype,"style",void 0),(0,D._)([(0,Z.Cb)({type:B.vC,json:{default:"normal",write:!0}})],X.prototype,"weight",void 0),X=H=(0,D._)([(0,W.j)("esri.symbols.Font")],X);const te=X},26531:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ge});var j,D=v(17626),R=v(63290),G=v(62208),Z=v(21726),Q=v(77712),B=(v(85931),v(90912),v(55342)),H=v(76898),X=v(97665),te=v(12948),ae=v(33215),oe=v(60958),le=v(37519),de=v(91558),se=v(86810),re=v(23841);let Y=j=class extends se.wq{constructor(_e){super(_e),this.color=new de.Z([0,0,0,1]),this.size=(0,re.Wz)(1)}clone(){const _e={color:(0,G.pC)(this.color)?this.color.clone():null,size:this.size};return new j(_e)}};(0,D._)([(0,Q.Cb)(oe.a)],Y.prototype,"color",void 0),(0,D._)([(0,Q.Cb)(oe.y)],Y.prototype,"size",void 0),Y=j=(0,D._)([(0,H.j)("esri.symbols.support.Symbol3DIconOutline")],Y);var ie,ee=v(64830);const J="esri.symbols.IconSymbol3DLayer";let ce=ie=class extends X.Z{constructor(_e){super(_e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new ie({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:(0,G.pC)(this.material)?this.material.clone():null,outline:(0,G.pC)(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(_e){const Ee=_e.color||te.ix,De=ue(_e),be=_e.outline&&_e.outline.width>0?{size:_e.outline.width,color:(_e.outline.color||te.ix).clone()}:null;return new ie({size:_e.size,resource:{primitive:me(_e.style)},material:{color:Ee},outline:be,anchor:De?"relative":void 0,anchorPosition:De})}static fromPictureMarkerSymbol(_e){const Ee=!_e.color||(0,te.rx)(_e.color)?te.ix:_e.color,De=ue(_e);return new ie({size:_e.width<=_e.height?_e.height:_e.width,resource:{href:_e.url},material:{color:Ee.clone()},anchor:De?"relative":void 0,anchorPosition:De})}static fromCIMSymbol(_e){return new ie({resource:{href:(0,Z._l)({mediaType:"application/json",data:JSON.stringify(_e.data)})}})}};function ue(_e){const Ee="width"in _e?_e.width:_e.size,De="height"in _e?_e.height:_e.size,be=pe(_e.xoffset),Se=pe(_e.yoffset);return(be||Se)&&Ee&&De?{x:-be/Ee,y:Se/De}:null}function pe(_e){return isFinite(_e)?_e:0}(0,D._)([(0,Q.Cb)({type:ee.b,json:{write:!0}})],ce.prototype,"material",void 0),(0,D._)([(0,Q.Cb)({type:ae.b,json:{write:!0}})],ce.prototype,"resource",void 0),(0,D._)([(0,B.J)({Icon:"icon"},{readOnly:!0})],ce.prototype,"type",void 0),(0,D._)([(0,Q.Cb)(oe.y)],ce.prototype,"size",void 0),(0,D._)([(0,B.J)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),(0,Q.Cb)({json:{default:"center"}})],ce.prototype,"anchor",void 0),(0,D._)([(0,Q.Cb)({type:le.e,json:{type:[Number],read:{reader:_e=>new le.e({x:_e[0],y:_e[1]})},write:{writer:(_e,Ee)=>{Ee.anchorPosition=[_e.x,_e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],ce.prototype,"anchorPosition",void 0),(0,D._)([(0,Q.Cb)({type:Y,json:{write:!0}})],ce.prototype,"outline",void 0),ce=ie=(0,D._)([(0,H.j)(J)],ce);const he={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function me(_e){return he[_e]||(R.Z.getLogger(J).warn(`${_e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const ge=ce},22490:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var ae,D=v(17626),R=v(46160),G=v(58817),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(39368),H=v(21716),X=v(9824),te=v(97595);const oe=R.Z.ofType({base:null,key:"type",typeMap:{text:H.Z}});let le=ae=class extends B.Z{constructor(se){super(se),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new oe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return(0,X.gv)(this)}hasVisibleVerticalOffset(){return(0,X.Uy)(this)}clone(){return new ae({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail),callout:(0,G.d9)(this.callout),verticalOffset:(0,G.d9)(this.verticalOffset)})}static fromTextSymbol(se){return new ae({symbolLayers:[H.Z.fromTextSymbol(se)]})}};(0,D._)([(0,Z.Cb)({type:te.Z,json:{write:!0}})],le.prototype,"verticalOffset",void 0),(0,D._)([(0,Z.Cb)(X.Y2)],le.prototype,"callout",void 0),(0,D._)([(0,Z.Cb)({json:{read:!1,write:!1}})],le.prototype,"styleOrigin",void 0),(0,D._)([(0,Z.Cb)({type:oe})],le.prototype,"symbolLayers",void 0),(0,D._)([(0,$.J)({LabelSymbol3D:"label-3d"},{readOnly:!0})],le.prototype,"type",void 0),le=ae=(0,D._)([(0,W.j)("esri.symbols.LabelSymbol3D")],le);const de=le},9436:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var te,D=v(17626),R=v(46160),G=v(58817),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(21068),H=v(69147),X=v(39368);const ae=R.Z.ofType({base:null,key:"type",typeMap:{line:B.Z,path:H.Z}}),oe=R.Z.ofType({base:null,key:"type",typeMap:{line:B.Z,path:H.Z}});let le=te=class extends X.Z{constructor(se){super(se),this.symbolLayers=new ae,this.type="line-3d"}clone(){return new te({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromSimpleLineSymbol(se){return new te({symbolLayers:[B.Z.fromSimpleLineSymbol(se)]})}};(0,D._)([(0,Z.Cb)({type:ae,json:{type:oe}})],le.prototype,"symbolLayers",void 0),(0,D._)([(0,$.J)({LineSymbol3D:"line-3d"},{readOnly:!0})],le.prototype,"type",void 0),le=te=(0,D._)([(0,W.j)("esri.symbols.LineSymbol3D")],le);const de=le},21068:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ue});var D=v(17626),R=v(62208),G=v(23841),Z=v(77712),$=(v(85931),v(90912)),W=v(55342),B=v(76898),H=v(91558),X=v(79608),te=v(86810),ae=v(67866);let oe=class extends((0,X.J)(te.wq)){constructor(pe){super(pe),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(pe){return(0,R.pC)(pe)&&pe.placement===this.placement&&pe.style===this.style&&((0,R.Wi)(this.color)&&(0,R.Wi)(pe.color)||(0,R.pC)(this.color)&&(0,R.pC)(pe.color)&&this.color.toJSON()===pe.color.toJSON())}};(0,D._)([(0,Z.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],oe.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:ae.J,json:{default:"begin-end",write:!0}})],oe.prototype,"placement",void 0),(0,D._)([(0,Z.Cb)({type:ae.k,json:{default:"arrow",write:!0}})],oe.prototype,"style",void 0),(0,D._)([(0,Z.Cb)({type:H.Z,json:{type:[$.z8],default:null,write:!0}})],oe.prototype,"color",void 0),oe=(0,D._)([(0,B.j)("esri.symbols.LineStyleMarker3D")],oe);const le=oe;var J,de=v(97665),se=v(63743),re=v(99255),j=v(12948),Y=v(60958),ee=v(64830),ie=v(43652);let ce=J=class extends de.Z{constructor(pe){super(pe),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=(0,G.Wz)(1),this.pattern=null,this.marker=null}clone(){const pe={enabled:this.enabled,material:(0,R.pC)(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:(0,R.pC)(this.pattern)?this.pattern.clone():null,marker:(0,R.pC)(this.marker)?this.marker.clone():null};return new J(pe)}static fromSimpleLineSymbol(pe){const he={enabled:!0,size:pe.width??(0,G.Wz)(1),cap:pe.cap||"butt",join:pe.join||"miter",pattern:pe.style&&"inside-frame"!==pe.style?new se.Z({style:pe.style}):null,material:new ee.b({color:(pe.color||j.ix).clone()}),marker:pe.marker?new le({placement:pe.marker.placement,style:pe.marker.style,color:pe.marker.color?.clone()??null}):null};return new J(he)}};(0,D._)([(0,Z.Cb)({type:ee.b,json:{write:!0}})],ce.prototype,"material",void 0),(0,D._)([(0,W.J)({Line:"line"},{readOnly:!0})],ce.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:ie.w2,json:{write:!0,default:"miter"}})],ce.prototype,"join",void 0),(0,D._)([(0,Z.Cb)({type:ie.Hc,json:{write:!0,default:"butt"}})],ce.prototype,"cap",void 0),(0,D._)([(0,Z.Cb)(Y.y)],ce.prototype,"size",void 0),(0,D._)([(0,Z.Cb)(re.D)],ce.prototype,"pattern",void 0),(0,D._)([(0,Z.Cb)({types:{key:"type",base:le,typeMap:{style:le}},json:{write:!0}})],ce.prototype,"marker",void 0),ce=J=(0,D._)([(0,B.j)("esri.symbols.LineSymbol3DLayer")],ce);const ue=ce},46735:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var D=v(17626),R=v(23841),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(10012);let B=class extends W.Z{constructor(X){super(X),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};(0,D._)([(0,G.Cb)({type:Number,json:{read:X=>X&&-1*X,write:(X,te)=>te.angle=X&&-1*X}})],B.prototype,"angle",void 0),(0,D._)([(0,G.Cb)({type:["simple-marker","picture-marker"],readOnly:!0})],B.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:Number,cast:R.t_,json:{write:!0}})],B.prototype,"xoffset",void 0),(0,D._)([(0,G.Cb)({type:Number,cast:R.t_,json:{write:!0}})],B.prototype,"yoffset",void 0),(0,D._)([(0,G.Cb)({type:Number,cast:X=>"auto"===X?X:(0,R.t_)(X),json:{write:!0}})],B.prototype,"size",void 0),B=(0,D._)([(0,$.j)("esri.symbols.MarkerSymbol")],B);const H=B},36687:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var X,D=v(17626),R=v(46160),G=v(58817),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(9260),H=v(39368);const te=R.Z.ofType({base:null,key:"type",typeMap:{fill:B.Z}});let ae=X=class extends H.Z{constructor(le){super(le),this.symbolLayers=new te,this.type="mesh-3d"}clone(){return new X({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromSimpleFillSymbol(le){return new X({symbolLayers:[B.Z.fromSimpleFillSymbol(le)]})}};(0,D._)([(0,Z.Cb)({type:te})],ae.prototype,"symbolLayers",void 0),(0,D._)([(0,$.J)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],ae.prototype,"type",void 0),ae=X=(0,D._)([(0,W.j)("esri.symbols.MeshSymbol3D")],ae);const oe=ae},2066:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var te,D=v(17626),R=v(62208),G=v(77712),$=(v(85931),v(90912),v(55342)),W=v(76898),B=v(97665),H=v(48521),X=v(14517);let ae=te=class extends X.Z{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new te({x:this.x,y:this.y,z:this.z})}};(0,D._)([(0,G.Cb)({type:Number})],ae.prototype,"x",void 0),(0,D._)([(0,G.Cb)({type:Number})],ae.prototype,"y",void 0),(0,D._)([(0,G.Cb)({type:Number})],ae.prototype,"z",void 0),ae=te=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DAnchorPosition3D")],ae);var le,oe=v(64830);let de=le=class extends B.Z{constructor(re){super(re),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new le({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:(0,R.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};(0,D._)([(0,G.Cb)({type:oe.b,json:{write:!0}})],de.prototype,"material",void 0),(0,D._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],de.prototype,"castShadows",void 0),(0,D._)([(0,G.Cb)({type:H.k,json:{write:!0}})],de.prototype,"resource",void 0),(0,D._)([(0,$.J)({Object:"object"},{readOnly:!0})],de.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"width",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"height",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"depth",void 0),(0,D._)([(0,$.J)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),(0,G.Cb)({json:{default:"origin"}})],de.prototype,"anchor",void 0),(0,D._)([(0,G.Cb)({type:ae,json:{type:[Number],read:{reader:re=>new ae({x:re[0],y:re[1],z:re[2]})},write:{writer:(re,j)=>{j.anchorPosition=[re.x,re.y,re.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],de.prototype,"anchorPosition",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"heading",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"tilt",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],de.prototype,"roll",void 0),(0,D._)([(0,G.Cb)({readOnly:!0})],de.prototype,"isPrimitive",null),de=le=(0,D._)([(0,W.j)("esri.symbols.ObjectSymbol3DLayer")],de);const se=de},69147:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var ae,D=v(17626),R=v(62208),G=v(77712),$=(v(85931),v(90912),v(55342)),W=v(68653),B=v(76898),H=v(97665),X=v(64830),te=v(43652);let oe=ae=class extends H.Z{constructor(de){super(de),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(de,se){return de??(null==se.height&&null!=se.size?se.size:void 0)}readHeight(de,se){return de??(null==se.width&&null!=se.size?se.size:void 0)}clone(){return new ae({enabled:this.enabled,material:(0,R.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};(0,D._)([(0,G.Cb)({type:X.b,json:{write:!0}})],oe.prototype,"material",void 0),(0,D._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],oe.prototype,"castShadows",void 0),(0,D._)([(0,$.J)({Path:"path"},{readOnly:!0})],oe.prototype,"type",void 0),(0,D._)([(0,G.Cb)({type:["circle","quad"],json:{write:!0,default:"circle"}})],oe.prototype,"profile",void 0),(0,D._)([(0,G.Cb)({type:te.w2,json:{write:!0,default:"miter"}})],oe.prototype,"join",void 0),(0,D._)([(0,G.Cb)({type:te.KW,json:{write:!0,default:"butt"}})],oe.prototype,"cap",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],oe.prototype,"width",void 0),(0,D._)([(0,W.r)("width",["width","size","height"])],oe.prototype,"readWidth",null),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],oe.prototype,"height",void 0),(0,D._)([(0,W.r)("height",["height","size","width"])],oe.prototype,"readHeight",null),(0,D._)([(0,G.Cb)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],oe.prototype,"anchor",void 0),(0,D._)([(0,G.Cb)({type:["heading","all"],json:{write:!0,default:"all"}})],oe.prototype,"profileRotation",void 0),oe=ae=(0,D._)([(0,B.j)("esri.symbols.PathSymbol3DLayer")],oe);const le=oe},13546:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var te,D=v(17626),R=v(58817),G=v(23841),Z=v(77712),$=(v(90912),v(55342)),W=v(68653),B=v(76898),H=v(46735),X=v(69738);let ae=te=class extends H.Z{constructor(...le){super(...le),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(le,de,se){if(le&&"string"!=typeof le&&null==le.imageData)return le;const re={};return le&&(re.url=le),null!=de&&(re.width=(0,G.t_)(de)),null!=se&&(re.height=(0,G.t_)(se)),re}readHeight(le,de){return de.size||le}readWidth(le,de){return de.size||le}clone(){const le=new te({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return le._set("source",(0,R.d9)(this.source)),le}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};(0,D._)([(0,Z.Cb)({json:{write:!1}})],ae.prototype,"color",void 0),(0,D._)([(0,$.J)({esriPMS:"picture-marker"},{readOnly:!0})],ae.prototype,"type",void 0),(0,D._)([(0,Z.Cb)(X.KA)],ae.prototype,"url",void 0),(0,D._)([(0,Z.Cb)(X.Ds)],ae.prototype,"source",void 0),(0,D._)([(0,Z.Cb)({type:Number,cast:G.t_,json:{write:!0}})],ae.prototype,"height",void 0),(0,D._)([(0,W.r)("height",["height","size"])],ae.prototype,"readHeight",null),(0,D._)([(0,Z.Cb)({type:Number,cast:G.t_,json:{write:!0}})],ae.prototype,"width",void 0),(0,D._)([(0,Z.Cb)({json:{write:!1}})],ae.prototype,"size",void 0),ae=te=(0,D._)([(0,B.j)("esri.symbols.PictureMarkerSymbol")],ae);const oe=ae},69852:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>re});var le,D=v(17626),R=v(46160),G=v(58817),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(26531),H=v(2066),X=v(39368),te=v(21716),ae=v(9824),oe=v(97595);const de=R.Z.ofType({base:null,key:"type",typeMap:{icon:B.Z,object:H.Z,text:te.Z}});let se=le=class extends X.Z{constructor(j){super(j),this.verticalOffset=null,this.callout=null,this.symbolLayers=new de,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const j of this.symbolLayers.items)switch(j.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return(0,ae.gv)(this)}hasVisibleVerticalOffset(){return(0,ae.Uy)(this)}clone(){return new le({verticalOffset:(0,G.d9)(this.verticalOffset),callout:(0,G.d9)(this.callout),styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromSimpleMarkerSymbol(j){return new le({symbolLayers:[B.Z.fromSimpleMarkerSymbol(j)]})}static fromPictureMarkerSymbol(j){return new le({symbolLayers:[B.Z.fromPictureMarkerSymbol(j)]})}static fromCIMSymbol(j){return"CIMPointSymbol"!==j.data?.symbol?.type?null:new le(j.data.symbol?.callout?{symbolLayers:[B.Z.fromCIMSymbol(j)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[B.Z.fromCIMSymbol(j)]})}static fromTextSymbol(j){return new le({symbolLayers:[te.Z.fromTextSymbol(j)]})}};(0,D._)([(0,Z.Cb)({type:oe.Z,json:{write:!0}})],se.prototype,"verticalOffset",void 0),(0,D._)([(0,Z.Cb)(ae.Y2)],se.prototype,"callout",void 0),(0,D._)([(0,Z.Cb)({type:de,json:{origins:{"web-scene":{write:!0}}}})],se.prototype,"symbolLayers",void 0),(0,D._)([(0,$.J)({PointSymbol3D:"point-3d"},{readOnly:!0})],se.prototype,"type",void 0),se=le=(0,D._)([(0,W.j)("esri.symbols.PointSymbol3D")],se);const re=se},89673:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ee});var re,D=v(17626),R=v(46160),G=v(58817),Z=v(62208),Q=v(77712),W=(v(90912),v(55342)),B=v(76898),H=v(65499),X=v(9260),te=v(26531),ae=v(21068),oe=v(2066),le=v(39368),de=v(21716),se=v(72622);const j=R.Z.ofType({base:null,key:"type",typeMap:{extrude:H.Z,fill:X.Z,icon:te.Z,line:ae.Z,object:oe.Z,text:de.Z,water:se.Z}});let Y=re=class extends le.Z{constructor(ie){super(ie),this.symbolLayers=new j,this.type="polygon-3d"}clone(){return new re({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromJSON(ie){const J=new re;if(J.read(ie),2===J.symbolLayers.length&&"fill"===J.symbolLayers.getItemAt(0).type&&"line"===J.symbolLayers.getItemAt(1).type){const ce=J.symbolLayers.getItemAt(0),ue=J.symbolLayers.getItemAt(1);!ue.enabled||ie.symbolLayers&&ie.symbolLayers[1]&&!1===ie.symbolLayers[1].enable||(ce.outline={size:ue.size,color:(0,Z.pC)(ue.material)?ue.material.color:null}),J.symbolLayers.removeAt(1)}return J}static fromSimpleFillSymbol(ie){return new re({symbolLayers:[X.Z.fromSimpleFillSymbol(ie)]})}};(0,D._)([(0,Q.Cb)({type:j,json:{write:!0}})],Y.prototype,"symbolLayers",void 0),(0,D._)([(0,W.J)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],Y.prototype,"type",void 0),Y=re=(0,D._)([(0,B.j)("esri.symbols.PolygonSymbol3D")],Y);const ee=Y},88493:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var te,D=v(17626),R=v(91558),G=v(2076),Z=v(58817),Q=v(77712),W=(v(90912),v(55342)),B=v(76898),H=v(48575),X=v(52068);const ae=new G.X({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let oe=te=class extends H.Z{constructor(...de){super(...de),this.color=new R.Z([0,0,0,.25]),this.outline=new X.Z,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(de,se,re){if(de&&"string"!=typeof de)return de;const j={};return de&&(j.style=de),se&&(j.outline=se),re&&(j.color=re),j}clone(){return new te({color:(0,Z.d9)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};(0,D._)([(0,Q.Cb)()],oe.prototype,"color",void 0),(0,D._)([(0,Q.Cb)()],oe.prototype,"outline",void 0),(0,D._)([(0,W.J)({esriSFS:"simple-fill"},{readOnly:!0})],oe.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:ae.apiValues,json:{read:ae.read,write:ae.write}})],oe.prototype,"style",void 0),oe=te=(0,D._)([(0,B.j)("esri.symbols.SimpleFillSymbol")],oe);const le=oe},52068:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ue});var D=v(17626),R=v(2076),G=v(58817),Z=v(23841),Q=v(77712),W=(v(90912),v(55342)),B=v(76898),X=(v(85931),v(10012));let te=class extends X.Z{constructor(pe){super(pe),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};(0,D._)([(0,W.J)({esriSLS:"simple-line"},{readOnly:!0})],te.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:Number,cast:Z.t_,json:{write:!0}})],te.prototype,"width",void 0),te=(0,D._)([(0,B.j)("esri.symbols.LineSymbol")],te);const ae=te;var j,oe=v(91558),le=v(86810),de=v(68653),se=v(99433),re=v(67866);let Y=j=class extends le.wq{constructor(pe){super(pe),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(pe,he,me,ge){he[me]="web-map"===ge?.origin?"arrow":pe}set color(pe){this._set("color",pe)}readColor(pe){return pe&&null!=pe[0]?[pe[0],pe[1],pe[2],pe[3]/255]:pe}writeColor(pe,he,me,ge){"web-map"===ge?.origin||(he[me]=pe)}clone(){return new j({color:(0,G.d9)(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};(0,D._)([(0,Q.Cb)({type:["begin","end","begin-end"],json:{write:!0}})],Y.prototype,"placement",void 0),(0,D._)([(0,W.J)({"line-marker":"line-marker"},{readOnly:!0}),(0,Q.Cb)({json:{origins:{"web-map":{write:!1}}}})],Y.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:re.k})],Y.prototype,"style",void 0),(0,D._)([(0,se.c)("style")],Y.prototype,"writeStyle",null),(0,D._)([(0,Q.Cb)({type:oe.Z,value:null,json:{write:{allowNull:!0}}})],Y.prototype,"color",null),(0,D._)([(0,de.r)("color")],Y.prototype,"readColor",null),(0,D._)([(0,se.c)("color")],Y.prototype,"writeColor",null),Y=j=(0,D._)([(0,B.j)("esri.symbols.LineSymbolMarker")],Y);const ee=Y;var ie;const J=new R.X({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let ce=ie=class extends ae{constructor(...pe){super(...pe),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(pe,he,me,ge,_e,Ee){if(pe&&"string"!=typeof pe)return pe;const De={};return null!=pe&&(De.style=pe),null!=he&&(De.color=he),null!=me&&(De.width=(0,Z.t_)(me)),null!=ge&&(De.cap=ge),null!=_e&&(De.join=_e),null!=Ee&&(De.miterLimit=(0,Z.t_)(Ee)),De}clone(){return new ie({color:(0,G.d9)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};(0,D._)([(0,W.J)({esriSLS:"simple-line"},{readOnly:!0})],ce.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({type:J.apiValues,json:{read:J.read,write:J.write}})],ce.prototype,"style",void 0),(0,D._)([(0,Q.Cb)({type:["butt","round","square"],json:{write:{overridePolicy:(pe,he,me)=>({enabled:"round"!==pe&&(null==me||null==me.origin)})}}})],ce.prototype,"cap",void 0),(0,D._)([(0,Q.Cb)({type:["miter","round","bevel"],json:{write:{overridePolicy:(pe,he,me)=>({enabled:"round"!==pe&&(null==me||null==me.origin)})}}})],ce.prototype,"join",void 0),(0,D._)([(0,Q.Cb)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":ee}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],ce.prototype,"marker",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{read:!1,write:!1}})],ce.prototype,"miterLimit",void 0),ce=ie=(0,D._)([(0,B.j)("esri.symbols.SimpleLineSymbol")],ce);const ue=ce},57213:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>se});var oe,D=v(17626),R=v(91558),G=v(2076),Z=v(58817),Q=v(23841),$=v(77712),B=(v(90912),v(55342)),H=v(76898),X=v(99433),te=v(46735),ae=v(52068);const le=new G.X({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let de=oe=class extends te.Z{constructor(...re){super(...re),this.color=new R.Z([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new ae.Z}normalizeCtorArgs(re,j,Y,ee){if(re&&"string"!=typeof re)return re;const ie={};return re&&(ie.style=re),null!=j&&(ie.size=(0,Q.t_)(j)),Y&&(ie.outline=Y),ee&&(ie.color=ee),ie}writeColor(re,j){re&&"x"!==this.style&&"cross"!==this.style&&(j.color=re.toJSON()),null===re&&(j.color=null)}set path(re){this.style="path",this._set("path",re)}clone(){return new oe({angle:this.angle,color:(0,Z.d9)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};(0,D._)([(0,$.Cb)()],de.prototype,"color",void 0),(0,D._)([(0,X.c)("color")],de.prototype,"writeColor",null),(0,D._)([(0,B.J)({esriSMS:"simple-marker"},{readOnly:!0})],de.prototype,"type",void 0),(0,D._)([(0,$.Cb)()],de.prototype,"size",void 0),(0,D._)([(0,$.Cb)({type:le.apiValues,json:{read:le.read,write:le.write}})],de.prototype,"style",void 0),(0,D._)([(0,$.Cb)({type:String,json:{write:!0}})],de.prototype,"path",null),(0,D._)([(0,$.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ae.Z}},json:{default:null,write:!0}})],de.prototype,"outline",void 0),de=oe=(0,D._)([(0,H.j)("esri.symbols.SimpleMarkerSymbol")],de);const se=de},10012:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var D=v(15861),R=v(17626),G=v(91558),Z=v(2076),Q=v(86810),$=v(77712),H=(v(85931),v(90912),v(68653)),X=v(76898);const te=new Z.X({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let ae=0,oe=class extends Q.wq{constructor(de){super(de),this.id="sym"+ae++,this.type=null,this.color=new G.Z([0,0,0,1])}readColor(de){return de&&null!=de[0]?[de[0],de[1],de[2],de[3]/255]:de}collectRequiredFields(de,se){return(0,D.Z)(function*(){})()}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,R._)([(0,$.Cb)({type:te.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:te.write}}})],oe.prototype,"type",void 0),(0,R._)([(0,$.Cb)({type:G.Z,json:{write:{allowNull:!0}}})],oe.prototype,"color",void 0),(0,R._)([(0,H.r)("color")],oe.prototype,"readColor",null),oe=(0,R._)([(0,X.j)("esri.symbols.Symbol")],oe);const le=oe},39368:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Ee});var D=v(17626),R=v(46160),G=v(89726),Z=v(63290),Q=v(21726),$=v(14889),W=v(77712),H=(v(85931),v(66656)),X=v(68653),te=v(76898),ae=v(99433),oe=v(84687),le=v(29840),de=v(65499),se=v(9260),re=v(26531),j=v(21068),Y=v(2066),ee=v(69147),ie=v(10012),J=v(97665),ce=v(21716),ue=v(72622),pe=v(77345),he=v(96296);const me={icon:re.Z,object:Y.Z,line:j.Z,path:ee.Z,fill:se.Z,extrude:de.Z,text:ce.Z,water:ue.Z},ge=R.Z.ofType({base:J.Z,key:"type",typeMap:me,errorContext:"symbol-layer"});let _e=class extends ie.Z{constructor(De){super(De),this.styleOrigin=null,this.thumbnail=null,this.type=null;const be=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers;this._set("symbolLayers",new(be&&be.type||R.Z))}get color(){return null}set color(De){this.constructed&&Z.Z.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(De){(0,G.Z)(De,this._get("symbolLayers"))}readStyleOrigin(De,be,Se){if(De.styleUrl&&De.name){const ye=(0,le.f)(De.styleUrl,Se);return new pe.Z({styleUrl:ye,name:De.name})}if(De.styleName&&De.name)return new pe.Z({portal:Se&&Se.portal||oe.Z.getDefault(),styleName:De.styleName,name:De.name});Se&&Se.messages&&Se.messages.push(new $.Z("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:Se,definition:De}))}writeStyleOrigin(De,be,Se,ye){if(De.styleUrl&&De.name){let ve=(0,le.t)(De.styleUrl,ye);(0,Q.YP)(ve)&&(ve=(0,Q.Fv)(ve)),be.styleOrigin={styleUrl:ve,name:De.name}}else De.styleName&&De.name&&(De.portal&&ye&&ye.portal&&!(0,Q.tm)(De.portal.restUrl,ye.portal.restUrl)?ye&&ye.messages&&ye.messages.push(new $.Z("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):be.styleOrigin={styleName:De.styleName,name:De.name})}normalizeCtorArgs(De){return De instanceof J.Z||De&&me[De.type]?{symbolLayers:[De]}:Array.isArray(De)?{symbolLayers:De}:De}};(0,D._)([(0,W.Cb)({json:{read:!1,write:!1}})],_e.prototype,"color",null),(0,D._)([(0,W.Cb)({type:ge,nonNullable:!0,json:{write:!0}}),(0,H.p)(G.R)],_e.prototype,"symbolLayers",null),(0,D._)([(0,W.Cb)({type:pe.Z})],_e.prototype,"styleOrigin",void 0),(0,D._)([(0,X.r)("styleOrigin")],_e.prototype,"readStyleOrigin",null),(0,D._)([(0,ae.c)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],_e.prototype,"writeStyleOrigin",null),(0,D._)([(0,W.Cb)({type:he.p,json:{read:!1}})],_e.prototype,"thumbnail",void 0),(0,D._)([(0,W.Cb)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],_e.prototype,"type",void 0),_e=(0,D._)([(0,te.j)("esri.symbols.Symbol3D")],_e);const Ee=_e},97665:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>H});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(99433);let B=class extends R.wq{constructor(X){super(X),this.enabled=!0,this.type=null}writeEnabled(X,te,ae){X||(te[ae]=X)}};(0,D._)([(0,G.Cb)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],B.prototype,"enabled",void 0),(0,D._)([(0,W.c)("enabled")],B.prototype,"writeEnabled",null),(0,D._)([(0,G.Cb)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],B.prototype,"type",void 0),B=(0,D._)([(0,$.j)("esri.symbols.Symbol3DLayer")],B);const H=B},35540:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var oe,D=v(17626),R=v(91558),G=v(58817),Z=v(23841),Q=v(77712),$=v(66656),W=v(55342),B=v(76898),H=v(99433),X=v(11472),te=v(10012),ae=v(50369);let le=oe=class extends te.Z{constructor(...se){super(...se),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new X.Z,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(se,re,j){if(se&&"string"!=typeof se)return se;const Y={};return se&&(Y.text=se),re&&(Y.font=re),j&&(Y.color=j),Y}writeLineWidth(se,re,j,Y){Y&&"string"!=typeof Y||(re[j]=se)}castLineWidth(se){return(0,Z.t_)(se)}writeLineHeight(se,re,j,Y){Y&&"string"!=typeof Y||(re[j]=se)}clone(){return new oe({angle:this.angle,backgroundColor:(0,G.d9)(this.backgroundColor),borderLineColor:(0,G.d9)(this.borderLineColor),borderLineSize:this.borderLineSize,color:(0,G.d9)(this.color),font:this.font&&this.font.clone(),haloColor:(0,G.d9)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};(0,D._)([(0,Q.Cb)({type:R.Z,json:{write:!0}})],le.prototype,"backgroundColor",void 0),(0,D._)([(0,Q.Cb)({type:R.Z,json:{write:!0}})],le.prototype,"borderLineColor",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],le.prototype,"borderLineSize",void 0),(0,D._)([(0,Q.Cb)({type:X.Z,json:{write:!0}})],le.prototype,"font",void 0),(0,D._)([(0,Q.Cb)({...ae.x0,json:{write:!0}})],le.prototype,"horizontalAlignment",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"kerning",void 0),(0,D._)([(0,Q.Cb)({type:R.Z,json:{write:!0}})],le.prototype,"haloColor",void 0),(0,D._)([(0,Q.Cb)({type:Number,cast:Z.t_,json:{write:!0}})],le.prototype,"haloSize",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"rightToLeft",void 0),(0,D._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"rotated",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],le.prototype,"text",void 0),(0,D._)([(0,W.J)({esriTS:"text"},{readOnly:!0})],le.prototype,"type",void 0),(0,D._)([(0,Q.Cb)({...ae.Nj,json:{write:!0}})],le.prototype,"verticalAlignment",void 0),(0,D._)([(0,Q.Cb)({type:Number,cast:Z.t_,json:{write:!0}})],le.prototype,"xoffset",void 0),(0,D._)([(0,Q.Cb)({type:Number,cast:Z.t_,json:{write:!0}})],le.prototype,"yoffset",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{read:se=>se&&-1*se,write:(se,re)=>re.angle=se&&-1*se}})],le.prototype,"angle",void 0),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],le.prototype,"width",void 0),(0,D._)([(0,Q.Cb)({type:Number})],le.prototype,"lineWidth",void 0),(0,D._)([(0,H.c)("lineWidth")],le.prototype,"writeLineWidth",null),(0,D._)([(0,$.p)("lineWidth")],le.prototype,"castLineWidth",null),(0,D._)([(0,Q.Cb)(ae.Ck)],le.prototype,"lineHeight",void 0),(0,D._)([(0,H.c)("lineHeight")],le.prototype,"writeLineHeight",null),le=oe=(0,D._)([(0,B.j)("esri.symbols.TextSymbol")],le);const de=le},21716:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ue});var le,D=v(17626),R=v(58817),G=v(62208),Z=v(77712),$=(v(90912),v(55342)),W=v(76898),B=v(99433),H=v(11472),X=v(97665),te=v(60958),ae=v(91558),oe=v(86810);let de=le=class extends oe.wq{constructor(){super(...arguments),this.color=new ae.Z([0,0,0,1]),this.size=0}clone(){const pe={color:(0,R.d9)(this.color),size:this.size};return new le(pe)}};(0,D._)([(0,Z.Cb)(te.a)],de.prototype,"color",void 0),(0,D._)([(0,Z.Cb)(te.y)],de.prototype,"size",void 0),de=le=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DHalo")],de);var se=v(64830),re=v(79608);v(85931);let Y=class extends((0,re.J)(oe.wq)){constructor(pe){super(pe),this.color=null}};(0,D._)([(0,Z.Cb)(te.a)],Y.prototype,"color",void 0),Y=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DTextBackground")],Y);var ie,ee=v(50369);let J=ie=class extends X.Z{constructor(pe){super(pe),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(pe){(0,G.pC)(pe)&&(0,G.pC)(this._userSize)&&(pe.size=this._userSize),this._set("font",pe)}writeFont(pe,he,me,ge){const _e={...ge,textSymbol3D:!0};he.font=pe.write({},_e),delete he.font.size}get size(){return(0,G.pC)(this._userSize)?this._userSize:(0,G.pC)(this.font)&&null!=this.font.size?this.font.size:9}set size(pe){this._userSize=pe,(0,G.pC)(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const pe=new ie({enabled:this.enabled,font:this.font&&(0,R.d9)(this.font),halo:this.halo&&(0,R.d9)(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:(0,G.pC)(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:(0,R.d9)(this.background)});return pe._userSize=this._userSize,pe}static fromTextSymbol(pe){return new ie({font:(0,G.pC)(pe.font)?pe.font.clone():new H.Z,halo:ce(pe.haloColor,pe.haloSize),horizontalAlignment:pe.horizontalAlignment,lineHeight:pe.lineHeight,material:pe.color?new se.b({color:pe.color.clone()}):null,text:pe.text,verticalAlignment:pe.verticalAlignment,background:pe.backgroundColor?new Y({color:pe.backgroundColor.clone()}):null})}};function ce(pe,he){return pe&&null!=he&&he>0?new de({color:(0,R.d9)(pe),size:he}):null}(0,D._)([(0,Z.Cb)({type:H.Z,json:{write:!0}})],J.prototype,"font",null),(0,D._)([(0,B.c)("font")],J.prototype,"writeFont",null),(0,D._)([(0,Z.Cb)({type:de,json:{write:!0}})],J.prototype,"halo",void 0),(0,D._)([(0,Z.Cb)({...ee.x0,json:{default:"center",write:!0}})],J.prototype,"horizontalAlignment",void 0),(0,D._)([(0,Z.Cb)({...ee.Ck,json:{default:1,write:!0}})],J.prototype,"lineHeight",void 0),(0,D._)([(0,Z.Cb)({type:se.b,json:{write:!0}})],J.prototype,"material",void 0),(0,D._)([(0,Z.Cb)({type:Y,json:{write:!0}})],J.prototype,"background",void 0),(0,D._)([(0,Z.Cb)(te.y)],J.prototype,"size",null),(0,D._)([(0,Z.Cb)({type:String,json:{write:!0}})],J.prototype,"text",void 0),(0,D._)([(0,$.J)({Text:"text"},{readOnly:!0})],J.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({...ee.Nj,json:{default:"baseline",write:!0}})],J.prototype,"verticalAlignment",void 0),J=ie=(0,D._)([(0,W.j)("esri.symbols.TextSymbol3DLayer")],J);const ue=J},72622:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var H,D=v(17626),R=v(91558),G=v(58817),Z=v(77712),Q=v(90912),$=v(55342),W=v(76898),B=v(97665);let X=H=class extends B.Z{constructor(oe){super(oe),this.color=te.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new H({color:(0,G.d9)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};(0,D._)([(0,Z.Cb)({type:R.Z,nonNullable:!0,json:{type:[Q.z8],write:(oe,le,de)=>le[de]=oe.toArray(R.Z.AlphaMode.UNLESS_OPAQUE),default:()=>te.clone(),defaultEquals:oe=>oe.toCss(!0)===te.toCss(!0)}})],X.prototype,"color",void 0),(0,D._)([(0,$.J)({Water:"water"},{readOnly:!0})],X.prototype,"type",void 0),(0,D._)([(0,Z.Cb)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],X.prototype,"waterbodySize",void 0),(0,D._)([(0,Z.Cb)({type:Number,json:{write:!0,default:null}})],X.prototype,"waveDirection",void 0),(0,D._)([(0,Z.Cb)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],X.prototype,"waveStrength",void 0),X=H=(0,D._)([(0,W.j)("esri.symbols.WaterSymbol3DLayer")],X);const te=new R.Z([0,119,190]),ae=X},12874:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>j});var de,D=v(15861),R=v(17626),G=v(63290),Z=v(62208),Q=v(10699),$=v(77712),H=(v(85931),v(90912),v(55342)),X=v(76898),te=v(84687),ae=v(29840),oe=v(10012),le=v(96296);let se=de=class extends oe.Z{constructor(Y){super(Y),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const Y=(0,Z.pC)(this.portal)?this.portal:te.Z.getDefault();return`${this.styleName}:${this.styleUrl}:${this.name}:${Y.user?Y.user.username:null}:${Y.url}`}read(Y,ee){this.portal=ee?ee.portal:void 0,super.read(Y,ee)}clone(){return new de({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(Y){return this._fetchSymbol("webRef",Y)}fetchCIMSymbol(Y){return this._fetchSymbol("cimRef",Y)}_fetchSymbol(Y,ee){var ie=this;return(0,D.Z)(function*(){const J=(0,Z.pC)(ee)?ee.cache:null,ce=J?ie._fetchCacheKey:null;if((0,Z.pC)(J)){const me=ce&&J.get(ce);if(me)return me.clone()}const ue=yield function re(){return Promise.resolve().then(v.bind(v,50998))}();(0,Q.k_)(ee);const pe=ue.resolveWebStyleSymbol(ie,{portal:ie.portal},Y,ee);pe.catch(me=>{G.Z.getLogger(ie.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",me)});const he=yield pe;return"webRef"===Y&&"point-3d"===he.type||"cimRef"===Y&&"cim"===he.type?((0,Z.pC)(J)&&J.set(ce,he.clone()),he):null})()}};(0,R._)([(0,$.Cb)({json:{write:!1}})],se.prototype,"color",void 0),(0,R._)([(0,$.Cb)({type:String,json:{write:!0}})],se.prototype,"styleName",void 0),(0,R._)([(0,$.Cb)({type:te.Z,json:{write:!1}})],se.prototype,"portal",void 0),(0,R._)([(0,$.Cb)({type:String,json:{read:ae.r,write:ae.w}})],se.prototype,"styleUrl",void 0),(0,R._)([(0,$.Cb)({type:le.p,json:{read:!1}})],se.prototype,"thumbnail",void 0),(0,R._)([(0,$.Cb)({type:String,json:{write:!0}})],se.prototype,"name",void 0),(0,R._)([(0,H.J)({styleSymbolReference:"web-style"},{readOnly:!0})],se.prototype,"type",void 0),(0,R._)([(0,$.Cb)()],se.prototype,"_fetchCacheKey",null),se=de=(0,R._)([(0,X.j)("esri.symbols.WebStyleSymbol")],se);const j=se},21779:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H),this.visible=!0}clone(){}};(0,D._)([(0,G.Cb)({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),(0,D._)([(0,G.Cb)({readOnly:!0})],W.prototype,"visible",void 0),W=(0,D._)([(0,$.j)("esri.symbols.callouts.Callout3D")],W);const B=W},17497:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>de});var oe,D=v(17626),R=v(91558),G=v(58817),Z=v(62208),Q=v(23841),$=v(77712),B=(v(90912),v(55342)),H=v(76898),X=v(21779),te=v(71530),ae=v(60958);let le=oe=class extends X.Z{constructor(se){super(se),this.type="line",this.color=new R.Z([0,0,0,1]),this.size=(0,Q.Wz)(1),this.border=null}get visible(){return this.size>0&&(0,Z.pC)(this.color)&&this.color.a>0}clone(){return new oe({color:(0,G.d9)(this.color),size:this.size,border:(0,G.d9)(this.border)})}};(0,D._)([(0,B.J)({line:"line"},{readOnly:!0})],le.prototype,"type",void 0),(0,D._)([(0,$.Cb)(ae.a)],le.prototype,"color",void 0),(0,D._)([(0,$.Cb)(ae.y)],le.prototype,"size",void 0),(0,D._)([(0,$.Cb)({type:te.a,json:{write:!0}})],le.prototype,"border",void 0),(0,D._)([(0,$.Cb)({readOnly:!0})],le.prototype,"visible",null),le=oe=(0,D._)([(0,H.j)("esri.symbols.callouts.LineCallout3D")],le);const de=le},9824:(nt,Ae,v)=>{"use strict";v.d(Ae,{Pd:()=>$,Uy:()=>Z,Y2:()=>B,as:()=>W,gv:()=>Q});var D=v(62208),R=v(21779),G=v(17497);function Z(H){if(!H)return!1;const X=H.verticalOffset;return!!X&&!(X.screenLength<=0||(0,D.pC)(X.maxWorldLength)&&X.maxWorldLength<=0)}function Q(H){if(!H||!H.supportsCallout||!H.supportsCallout())return!1;const X=H.callout;return!!X&&!!X.visible&&!!Z(H)}function $(H){return"point-3d"===H.type||"label-3d"===H.type}function W(H){return"center"===H.horizontalAlignment}const B={types:{key:"type",base:R.Z,typeMap:{line:G.Z}},json:{write:!0}}},80991:(nt,Ae,v)=>{"use strict";function R(be,Se,ye,ve){return function D(be){return"function"==typeof be}(be)?be(Se,ye,ve):be}function G(be){return[be.r,be.g,be.b,be.a]}v.d(Ae,{$Z:()=>pe,BX:()=>ce,Cc:()=>j,E_:()=>W,F:()=>he,FG:()=>ge,H1:()=>$,JW:()=>De,NA:()=>re,NO:()=>te,On:()=>ie,QI:()=>H,Qf:()=>_e,Qs:()=>B,RI:()=>Y,TB:()=>Ee,TT:()=>X,W7:()=>ue,X_:()=>me,be:()=>ae,gJ:()=>se,hf:()=>R,k5:()=>de,nn:()=>G,pJ:()=>ee,wi:()=>J,yL:()=>le,zL:()=>oe});function Q(be){let Se=be.length;for(;Se--;)if(!" /-,\n".includes(be.charAt(Se)))return!1;return!0}function $(be,Se){const ye=[];let ve=0,xe=-1;do{if(xe=be.indexOf("[",ve),xe>=ve){if(xe>ve){const ze=be.substr(ve,xe-ve);ye.push([ze,null,Q(ze)])}if(ve=xe+1,xe=be.indexOf("]",ve),xe>=ve){if(xe>ve){const ze=Se[be.substr(ve,xe-ve)];ze&&ye.push([null,ze,!1])}ve=xe+1}}}while(-1!==xe);if(ve<be.length-1){const ze=be.substr(ve);ye.push([ze,null,Q(ze)])}return ye}function W(be,Se,ye){let ve="",xe=null;for(const ze of Se){const[Ke,We,Ce]=ze;if(Ke)Ce?xe=Ke:(xe&&(ve+=xe,xe=null),ve+=Ke);else{const Be=be.attributes[We];Be&&(xe&&(ve+=xe,xe=null),ve+=Be)}}return H(ve,ye)}function B(be,Se,ye){const ve=$(Se,be);return xe=>W(xe,ve,ye)}function H(be,Se){switch("string"!=typeof be&&(be=String(be)),Se){case"LowerCase":return be.toLowerCase();case"Allcaps":return be.toUpperCase();default:return be}}function X(be,Se,ye,ve,xe,ze,Ke=!0){const We=Se/xe,Ce=ye/ze,Be=Math.ceil(We/2),Fe=Math.ceil(Ce/2);for(let je=0;je<ze;je++)for(let Re=0;Re<xe;Re++){const He=4*(Re+(Ke?ze-je-1:je)*xe);let Ie=0,Ge=0,Pe=0,Le=0,Me=0,Ne=0,Xe=0;const Ye=(je+.5)*Ce;for(let Je=Math.floor(je*Ce);Je<(je+1)*Ce;Je++){const rt=Math.abs(Ye-(Je+.5))/Fe,tt=(Re+.5)*We,et=rt*rt;for(let qe=Math.floor(Re*We);qe<(Re+1)*We;qe++){let ot=Math.abs(tt-(qe+.5))/Be;const ut=Math.sqrt(et+ot*ot);ut>=-1&&ut<=1&&(Ie=2*ut*ut*ut-3*ut*ut+1,Ie>0&&(ot=4*(qe+Je*Se),Xe+=Ie*be[ot+3],Pe+=Ie,be[ot+3]<255&&(Ie=Ie*be[ot+3]/250),Le+=Ie*be[ot],Me+=Ie*be[ot+1],Ne+=Ie*be[ot+2],Ge+=Ie))}}ve[He]=Le/Ge,ve[He+1]=Me/Ge,ve[He+2]=Ne/Ge,ve[He+3]=Xe/Pe}}function te(be){return be?{r:be[0],g:be[1],b:be[2],a:be[3]/255}:{r:0,g:0,b:0,a:0}}function ae(be){return be.data?.symbol??null}function oe(be){return"CIMVectorMarker"===be.type||"CIMPictureMarker"===be.type||"CIMBarChartMarker"===be.type||"CIMCharacterMarker"===be.type||"CIMPieChartMarker"===be.type||"CIMStackedBarChartMarker"===be.type}function le(be){return"CIMGradientStroke"===be.type||"CIMPictureStroke"===be.type||"CIMSolidStroke"===be.type}function de(be){return"CIMGradientFill"===be.type||"CIMHatchFill"===be.type||"CIMPictureFill"===be.type||"CIMSolidFill"===be.type||"CIMWaterFill"===be.type}function se(be){return"CIMMarkerPlacementAlongLineRandomSize"===be.type||"CIMMarkerPlacementAlongLineSameSize"===be.type||"CIMMarkerPlacementAlongLineVariableSize"===be.type||"CIMMarkerPlacementAtExtremities"===be.type||"CIMMarkerPlacementAtMeasuredUnits"===be.type||"CIMMarkerPlacementAtRatioPositions"===be.type||"CIMMarkerPlacementOnLine"===be.type||"CIMMarkerPlacementOnVertices"===be.type}const re=(be,Se=0)=>isNaN(be)||null==be?Se:be,j=be=>{if(!be)return!1;for(const Se of be)switch(Se.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function Y(){return Promise.all([v.e(4918),v.e(8592),v.e(5994)]).then(v.bind(v,32825))}function ee(be){if(!be)return"normal";switch(be.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function ie(be){if(!be)return"normal";switch(be.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function J(be){let Se="",ye="";if(be){const ve=be.toLowerCase();ve.includes("italic")?Se="italic":ve.includes("oblique")&&(Se="oblique"),ve.includes("bold")?ye="bold":ve.includes("light")&&(ye="lighter")}return{style:Se,weight:ye}}function ce(be){return be.underline?"underline":be.strikethrough?"line-through":"none"}function ue(be){if(!be)return null;switch(be.type){case"CIMPolygonSymbol":if(be.symbolLayers)for(const Se of be.symbolLayers){const ye=ue(Se);if(null!=ye)return ye}break;case"CIMTextSymbol":return ue(be.symbol);case"CIMSolidFill":return be.color}}function pe(be){if(be)switch(be.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(be.symbolLayers)for(const Se of be.symbolLayers){const ye=pe(Se);if(void 0!==ye)return ye}break;case"CIMTextSymbol":return pe(be.symbol);case"CIMSolidStroke":case"CIMSolidFill":return be.color}}function he(be){if(be)switch(be.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(be.symbolLayers)for(const Se of be.symbolLayers){const ye=he(Se);if(void 0!==ye)return ye}break;case"CIMTextSymbol":return he(be.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return be.width}}function me(be){switch(be){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function ge(be){switch(be){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function _e(be){return(be?Object.keys(be):[]).map(Se=>({name:Se,alias:Se,type:"string"==typeof be[Se]?"esriFieldTypeString":"esriFieldTypeDouble"}))}const Ee=be=>be.includes("data:image/svg+xml");function De(be){if(!be)return null;switch(be.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}},31184:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>te});var D=v(17626),R=v(91558),G=v(86810),Z=v(58817),Q=v(23841),$=v(77712),B=(v(90912),v(76898)),H=v(60958);let X=class extends G.wq{constructor(ae){super(ae),this.color=new R.Z([0,0,0,1]),this.extensionLength=0,this.size=(0,Q.Wz)(1)}clone(){}cloneProperties(){return{color:(0,Z.d9)(this.color),size:this.size,extensionLength:this.extensionLength}}};(0,D._)([(0,$.Cb)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],X.prototype,"type",void 0),(0,D._)([(0,$.Cb)(H.a)],X.prototype,"color",void 0),(0,D._)([(0,$.Cb)({...H.y,json:{write:{overridePolicy:ae=>({enabled:!!ae})}}})],X.prototype,"extensionLength",void 0),(0,D._)([(0,$.Cb)(H.y)],X.prototype,"size",void 0),X=(0,D._)([(0,B.j)("esri.symbols.edges.Edges3D")],X);const te=X},2252:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ae});var X,D=v(17626),W=(v(63290),v(90912),v(85931),v(26584),v(8314),v(55342)),B=v(76898),H=v(31184);let te=X=class extends H.Z{constructor(oe){super(oe),this.type="solid"}clone(){return new X(this.cloneProperties())}};(0,D._)([(0,W.J)({solid:"solid"},{readOnly:!0})],te.prototype,"type",void 0),te=X=(0,D._)([(0,B.j)("esri.symbols.support.SolidEdges3D")],te);const ae=te},61261:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>le});var X,D=v(31184),R=v(17626),B=(v(63290),v(90912),v(85931),v(26584),v(8314),v(55342)),H=v(76898);let te=X=class extends D.Z{constructor(de){super(de),this.type="sketch"}clone(){return new X(this.cloneProperties())}};(0,R._)([(0,B.J)({sketch:"sketch"},{readOnly:!0})],te.prototype,"type",void 0),te=X=(0,R._)([(0,H.j)("esri.symbols.edges.SketchEdges3D")],te);const ae=te;var oe=v(2252);const le={types:{key:"type",base:D.Z,typeMap:{solid:oe.Z,sketch:ae}},json:{write:!0}}},38861:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H)}clone(){}};(0,D._)([(0,G.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.symbols.patterns.LinePattern3D")],W);const B=W},63743:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>oe});var X,D=v(17626),R=v(2076),G=v(77712),$=(v(85931),v(90912),v(55342)),W=v(76898),B=v(38861);const te=(0,R.w)()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let ae=X=class extends B.Z{constructor(le){super(le),this.type="style",this.style="solid"}clone(){return new X({style:this.style})}};(0,D._)([(0,G.Cb)({type:["style"]})],ae.prototype,"type",void 0),(0,D._)([(0,$.J)(te),(0,G.Cb)({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"]})],ae.prototype,"style",void 0),ae=X=(0,D._)([(0,W.j)("esri.symbols.patterns.LineStylePattern3D")],ae);const oe=ae},40249:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.wq{constructor(H){super(H)}clone(){}};(0,D._)([(0,G.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),W=(0,D._)([(0,$.j)("esri.symbols.patterns.Pattern3D")],W);const B=W},153:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(77712),Q=(v(85931),v(90912),v(76898)),$=v(40249);let H=B=class extends $.Z{constructor(te){super(te),this.type="style",this.style="solid"}clone(){return new B({style:this.style})}};(0,D._)([(0,R.Cb)({type:["style"]})],H.prototype,"type",void 0),(0,D._)([(0,R.Cb)({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],H.prototype,"style",void 0),H=B=(0,D._)([(0,Q.j)("esri.symbols.patterns.StylePattern3D")],H);const X=H},99255:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>$,q:()=>Q});var D=v(38861),R=v(63743),G=v(40249),Z=v(153);const Q={types:{key:"type",base:G.Z,typeMap:{style:Z.Z}},json:{write:!0}},$={types:{key:"type",base:D.Z,typeMap:{style:R.Z}},json:{write:!0}}},82706:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ie});var oe,D=v(17626),R=v(2076),G=v(86810),Z=v(62208),Q=v(77712),B=(v(85931),v(90912),v(68653)),H=v(76898),X=v(99433),te=v(15861),ae=v(36630);let le=oe=class extends G.wq{constructor(J){super(J)}collectRequiredFields(J,ce){var ue=this;return(0,te.Z)(function*(){return(0,ae.io)(J,ce,ue.expression)})()}clone(){return new oe({expression:this.expression,title:this.title})}equals(J){return this.expression===J.expression&&this.title===J.title}};(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],le.prototype,"expression",void 0),(0,D._)([(0,Q.Cb)({type:String,json:{write:!0}})],le.prototype,"title",void 0),le=oe=(0,D._)([(0,H.j)("esri.layers.support.FeatureExpressionInfo")],le);const de=le;var re,se=v(29505);const j=(0,R.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Y=new R.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let ee=re=class extends G.wq{constructor(J){super(J),this.offset=null}readFeatureExpressionInfo(J,ce){return J??(ce.featureExpression&&0===ce.featureExpression.value?{expression:"0"}:void 0)}writeFeatureExpressionInfo(J,ce,ue,pe){ce[ue]=J.write({},pe),"0"===J.expression&&(ce.featureExpression={value:0})}get mode(){const{offset:J,featureExpressionInfo:ce}=this;return this._isOverridden("mode")?this._get("mode"):(0,Z.pC)(J)||ce?"relative-to-ground":"on-the-ground"}set mode(J){this._override("mode",J)}set unit(J){this._set("unit",J)}write(J,ce){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(J,ce):null}clone(){return new re({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(J){return this.mode===J.mode&&this.offset===J.offset&&this.unit===J.unit&&(0,Z._W)(this.featureExpressionInfo,J.featureExpressionInfo)}};(0,D._)([(0,Q.Cb)({type:de,json:{write:!0}})],ee.prototype,"featureExpressionInfo",void 0),(0,D._)([(0,B.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],ee.prototype,"readFeatureExpressionInfo",null),(0,D._)([(0,X.c)("featureExpressionInfo",{featureExpressionInfo:{type:de},"featureExpression.value":{type:[0]}})],ee.prototype,"writeFeatureExpressionInfo",null),(0,D._)([(0,Q.Cb)({type:j.apiValues,nonNullable:!0,json:{type:j.jsonValues,read:j.read,write:{writer:j.write,isRequired:!0}}})],ee.prototype,"mode",null),(0,D._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ee.prototype,"offset",void 0),(0,D._)([(0,Q.Cb)({type:se.f9,json:{type:String,read:Y.read,write:Y.write}})],ee.prototype,"unit",null),ee=re=(0,D._)([(0,H.j)("esri.layers.support.ElevationInfo")],ee);const ie=ee},33215:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>se,b:()=>de});var oe,D=v(17626),R=v(2076),G=v(86810),Z=v(21726),Q=v(77712),B=(v(85931),v(90912),v(55342)),H=v(68653),X=v(76898),te=v(99433),ae=v(29840);const le=(0,R.w)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let de=oe=class extends G.wq{constructor(re){super(re)}readHref(re,j,Y){return re?(0,ae.f)(re,Y):j.dataURI}writeHref(re,j,Y,ee){re&&((0,Z.HK)(re)?j.dataURI=re:(j.href=(0,ae.t)(re,ee),(0,Z.YP)(j.href)&&(j.href=(0,Z.Fv)(j.href))))}clone(){return new oe({href:this.href,primitive:this.primitive})}};(0,D._)([(0,Q.Cb)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],de.prototype,"href",void 0),(0,D._)([(0,H.r)("href")],de.prototype,"readHref",null),(0,D._)([(0,te.c)("href",{href:{type:String},dataURI:{type:String}})],de.prototype,"writeHref",null),(0,D._)([(0,B.J)(le)],de.prototype,"primitive",void 0),de=oe=(0,D._)([(0,X.j)("esri.symbols.support.IconSymbol3DLayerResource")],de);const se="circle"},48521:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>oe,k:()=>ae});var X,D=v(17626),R=v(2076),G=v(86810),Z=v(77712),W=(v(85931),v(90912),v(55342)),B=v(76898),H=v(29840);const te=(0,R.w)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let ae=X=class extends G.wq{clone(){return new X({href:this.href,primitive:this.primitive})}};(0,D._)([(0,Z.Cb)({type:String,json:{read:H.r,write:H.w}})],ae.prototype,"href",void 0),(0,D._)([(0,W.J)(te)],ae.prototype,"primitive",void 0),ae=X=(0,D._)([(0,B.j)("esri.symbols.support.ObjectSymbol3DLayerResource")],ae);const oe="sphere"},77345:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(84687);let H=B=class extends R.Z{constructor(te){super(te),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new B({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};(0,D._)([(0,G.Cb)({type:String})],H.prototype,"name",void 0),(0,D._)([(0,G.Cb)({type:String})],H.prototype,"styleUrl",void 0),(0,D._)([(0,G.Cb)({type:String})],H.prototype,"styleName",void 0),(0,D._)([(0,G.Cb)({type:W.Z})],H.prototype,"portal",void 0),H=B=(0,D._)([(0,$.j)("esri.symbols.support.StyleOrigin")],H);const X=H},37519:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>B});var W,D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.Z{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new W({x:this.x,y:this.y})}};(0,D._)([(0,G.Cb)({type:Number})],B.prototype,"x",void 0),(0,D._)([(0,G.Cb)({type:Number})],B.prototype,"y",void 0),B=W=(0,D._)([(0,$.j)("esri.symbols.support.Symbol3DAnchorPosition2D")],B)},64830:(nt,Ae,v)=>{"use strict";v.d(Ae,{b:()=>X});var H,D=v(17626),R=v(86810),G=v(62208),Z=v(77712),W=(v(85931),v(90912),v(76898)),B=v(60958);let X=H=class extends R.wq{constructor(te){super(te),this.color=null}clone(){const te={color:(0,G.pC)(this.color)?this.color.clone():null};return new H(te)}};(0,D._)([(0,Z.Cb)(B.a)],X.prototype,"color",void 0),X=H=(0,D._)([(0,W.j)("esri.symbols.support.Symbol3DMaterial")],X)},97595:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var B,D=v(17626),R=v(86810),G=v(77712),$=(v(85931),v(90912),v(76898)),W=v(60958);let H=B=class extends R.wq{constructor(te){super(te),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new B({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};(0,D._)([(0,G.Cb)(W.y)],H.prototype,"screenLength",void 0),(0,D._)([(0,G.Cb)({type:Number,nonNullable:!0,json:{write:!0,default:0}})],H.prototype,"minWorldLength",void 0),(0,D._)([(0,G.Cb)({type:Number,json:{write:!0}})],H.prototype,"maxWorldLength",void 0),H=B=(0,D._)([(0,$.j)("esri.symbols.support.Symbol3DVerticalOffset")],H);const X=H},96296:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>B});var W,D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898));let B=W=class extends R.Z{constructor(){super(...arguments),this.url=""}clone(){return new W({url:this.url})}};(0,D._)([(0,G.Cb)({type:String})],B.prototype,"url",void 0),B=W=(0,D._)([(0,$.j)("esri.symbols.support.Thumbnail")],B)},56445:(nt,Ae,v)=>{"use strict";v.d(Ae,{FW:()=>W,ZB:()=>oe,iW:()=>X});var D=v(91558),R=v(80991);function $(j,Y,ee,ie){if(j)if("CIMTextSymbol"!==j.type){if(ee&&j.effects)for(const J of j.effects)H(J,Y);if(j.symbolLayers)for(const J of j.symbolLayers)switch(J.type){case"CIMPictureMarker":case"CIMVectorMarker":W(J,Y,ie);break;case"CIMPictureStroke":case"CIMSolidStroke":!ie?.preserveOutlineWidth&&J.width&&(J.width*=Y);break;case"CIMPictureFill":J.height&&(J.height*=Y),J.offsetX&&(J.offsetX*=Y),J.offsetY&&(J.offsetY*=Y);break;case"CIMHatchFill":$(J.lineSymbol,Y,!0,{...ie,preserveOutlineWidth:!1}),J.offsetX&&(J.offsetX*=Y),J.offsetY&&(J.offsetY*=Y),J.separation&&(J.separation*=Y)}}else null!=j.height&&(j.height*=Y)}function W(j,Y,ee){if(j&&(j.markerPlacement&&function B(j,Y){switch((0,R.gJ)(j)&&j.offset&&(j.offset*=Y),j.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(j.customEndingOffset&&(j.customEndingOffset*=Y),j.offsetAlongLine&&(j.offsetAlongLine*=Y),j.placementTemplate&&j.placementTemplate.length){const ee=j.placementTemplate.map(ie=>ie*Y);j.placementTemplate=ee}break;case"CIMMarkerPlacementAlongLineVariableSize":if(j.maxRandomOffset&&(j.maxRandomOffset*=Y),j.placementTemplate&&j.placementTemplate.length){const ee=j.placementTemplate.map(ie=>ie*Y);j.placementTemplate=ee}break;case"CIMMarkerPlacementOnLine":j.startPointOffset&&(j.startPointOffset*=Y);break;case"CIMMarkerPlacementAtExtremities":j.offsetAlongLine&&(j.offsetAlongLine*=Y);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":j.beginPosition&&(j.beginPosition*=Y),j.endPosition&&(j.endPosition*=Y);break;case"CIMMarkerPlacementPolygonCenter":j.offsetX&&(j.offsetX*=Y),j.offsetY&&(j.offsetY*=Y);break;case"CIMMarkerPlacementInsidePolygon":j.offsetX&&(j.offsetX*=Y),j.offsetY&&(j.offsetY*=Y),j.stepX&&(j.stepX*=Y),j.stepY&&(j.stepY*=Y)}}(j.markerPlacement,Y),j.offsetX&&(j.offsetX*=Y),j.offsetY&&(j.offsetY*=Y),j.anchorPoint&&"Absolute"===j.anchorPointUnits&&(j.anchorPoint={x:j.anchorPoint.x*Y,y:j.anchorPoint.y*Y}),j.size=null!=j.size?j.size*Y:0,"CIMVectorMarker"===j.type&&j.markerGraphics))for(const ie of j.markerGraphics)j.scaleSymbolsProportionally||$(ie.symbol,Y,!0,ee)}function H(j,Y){switch(j.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":j.width&&(j.width*=Y);break;case"CIMGeometricEffectBuffer":j.size&&(j.size*=Y);break;case"CIMGeometricEffectCut":j.beginCut&&(j.beginCut*=Y),j.endCut&&(j.endCut*=Y),j.middleCut&&(j.middleCut*=Y);break;case"CIMGeometricEffectDashes":if(j.customEndingOffset&&(j.customEndingOffset*=Y),j.offsetAlongLine&&(j.offsetAlongLine*=Y),j.dashTemplate&&j.dashTemplate.length){const ee=j.dashTemplate.map(ie=>ie*Y);j.dashTemplate=ee}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":j.length&&(j.length*=Y);break;case"CIMGeometricEffectMove":j.offsetX&&(j.offsetX*=Y),j.offsetY&&(j.offsetY*=Y);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":j.offset&&(j.offset*=Y);break;case"CIMGeometricEffectRegularPolygon":j.radius&&(j.radius*=Y);break;case"CIMGeometricEffectTaperedPolygon":j.fromWidth&&(j.fromWidth*=Y),j.length&&(j.length*=Y),j.toWidth&&(j.toWidth*=Y);break;case"CIMGeometricEffectWave":j.amplitude&&(j.amplitude*=Y),j.period&&(j.period*=Y)}}function X(j){const Y=[];return te((0,R.be)(j),Y),Y.length?new D.Z((0,R.NO)(Y[0])):null}function te(j,Y){if(!j)return;let ee;ee="CIMTextSymbol"===j.type?j.symbol:j;const ie="CIMPolygonSymbol"===j.type;if(ee?.symbolLayers)for(const J of ee.symbolLayers)if(!(J.colorLocked||ie&&((0,R.yL)(J)||(0,R.zL)(J)&&J.markerPlacement&&(0,R.gJ)(J.markerPlacement))))switch(J.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":J.tintColor&&ae(Y,J.tintColor);break;case"CIMVectorMarker":J.markerGraphics?.forEach(ce=>{te(ce.symbol,Y)});break;case"CIMSolidStroke":case"CIMSolidFill":ae(Y,J.color);break;case"CIMHatchFill":te(J.lineSymbol,Y)}}function ae(j,Y){for(const ee of j)if(ee.join(".")===Y.join("."))return;j.push(Y)}function oe(j,Y,ee){Y instanceof D.Z||(Y=new D.Z(Y));const ie=(0,R.be)(j);ie&&le(ie,Y,ee)}function le(j,Y,ee){if(!j)return;let ie;ie="CIMTextSymbol"===j.type?j.symbol:j;const J="CIMPolygonSymbol"===ie?.type;if(ie?.symbolLayers)for(const ce of ie.symbolLayers){if(ce.colorLocked)continue;if(J)if(ee){const{layersToColor:pe}=ee;if(((0,R.yL)(ce)||(0,R.zL)(ce)&&ce.markerPlacement&&(0,R.gJ)(ce.markerPlacement))&&"fill"===pe||(0,R.k5)(ce)&&"outline"===pe)continue}else if((0,R.yL)(ce)||(0,R.zL)(ce)&&ce.markerPlacement&&(0,R.gJ)(ce.markerPlacement))continue;const ue=Y.toArray();switch(ce.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":ce.tintColor=ue;break;case"CIMVectorMarker":ce.markerGraphics?.forEach(pe=>{le(pe.symbol,Y,ee)});break;case"CIMSolidStroke":case"CIMSolidFill":ce.color=ue;break;case"CIMHatchFill":le(ce.lineSymbol,Y,ee)}}}},12948:(nt,Ae,v)=>{"use strict";v.d(Ae,{ix:()=>R,l9:()=>Z,rx:()=>Q});var D=v(91558);const R=new D.Z("white"),Z=(new D.Z("black"),new D.Z([255,255,255,0]));function Q($){return 0===$.r&&0===$.g&&0===$.b}},8080:(nt,Ae,v)=>{"use strict";v.d(Ae,{CJ:()=>B,Rz:()=>X,xA:()=>W,z3:()=>H}),v(8314);var R=v(88493),G=v(52068),Z=v(57213),Q=v(35540),$=v(24837);const W=Z.Z.fromJSON($.I4),B=G.Z.fromJSON($.ET),H=R.Z.fromJSON($.lF),X=Q.Z.fromJSON($.qP);Z.Z.fromJSON($.eG),G.Z.fromJSON($.wW),R.Z.fromJSON($.lj)},24837:(nt,Ae,v)=>{"use strict";v.d(Ae,{ET:()=>Z,I4:()=>G,SQ:()=>D,X1:()=>R,eG:()=>W,lF:()=>Q,lj:()=>H,qP:()=>$,wW:()=>B});const D=[252,146,31,255],R=[153,153,153,255],G={type:"esriSMS",style:"esriSMSCircle",size:6,color:D,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Z={type:"esriSLS",style:"esriSLSSolid",width:.75,color:D},Q={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},$={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},W={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},B={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},H={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},74741:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ne:()=>j,Od:()=>de,Sp:()=>re,_M:()=>le,mx:()=>se});var D=v(54346),R=v(91558),G=v(84792),Z=v(78498),Q=v(23841),$=v(56445);const W="picture-fill",B="simple-fill",X="simple-marker",oe=new Z.Z(1e3);function le(Y){const ee=Y.style;let ie=null;if(Y)switch(Y.type){case X:"cross"!==ee&&"x"!==ee&&(ie=Y.color);break;case B:"solid"===ee?ie=Y.color:"none"!==ee&&(ie={type:"pattern",x:0,y:0,src:(0,D.V)(`esri/symbols/patterns/${ee}.png`),width:5,height:5});break;case W:ie={type:"pattern",src:Y.url,width:(0,Q.F2)(Y.width)*Y.xscale,height:(0,Q.F2)(Y.height)*Y.yscale,x:(0,Q.F2)(Y.xoffset),y:(0,Q.F2)(Y.yoffset)};break;case"text":ie=Y.color;break;case"cim":ie=(0,$.iW)(Y)}return ie}function de(Y,ee){const ie=Y+"-"+ee;return void 0!==oe.get(ie)?Promise.resolve(oe.get(ie)):(0,G.default)(Y,{responseType:"image"}).then(J=>{const ce=J.data,ue=ce.naturalWidth,pe=ce.naturalHeight,he=document.createElement("canvas");he.width=ue,he.height=pe;const me=he.getContext("2d");me.fillStyle=ee,me.fillRect(0,0,ue,pe),me.globalCompositeOperation="destination-in",me.drawImage(ce,0,0);const ge=he.toDataURL();return oe.put(ie,ge),ge})}function se(Y){if(!Y)return null;let ee=null;switch(Y.type){case B:case W:case X:ee=se(Y.outline);break;case"simple-line":{const ie=(0,Q.F2)(Y.width);null!=Y.style&&"none"!==Y.style&&0!==ie&&(ee={color:Y.color,style:re(Y.style),width:ie,cap:Y.cap,join:"miter"===Y.join?(0,Q.F2)(Y.miterLimit):Y.join});break}default:ee=null}return ee}const re=(()=>{const Y={};return ee=>{if(Y[ee])return Y[ee];const ie=ee.replace(/-/g,"");return Y[ee]=ie,ie}})(),j=new R.Z([128,128,128])},9461:(nt,Ae,v)=>{"use strict";v.d(Ae,{cW:()=>B,im:()=>ae,vX:()=>H});var D=v(20383),R=v(26584),G=v(62208),Z=v(39368),Q=v(70137),$=v(12874);const W=["building-scene","integrated-mesh","point-cloud","scene"];function B(oe,le,de,se){const re=te(oe,{},{context:se,isLabelSymbol:!1});(0,G.pC)(re)&&(le[de]=re)}function H(oe,le,de,se){const re=te(oe,{},{context:se,isLabelSymbol:!0});(0,G.pC)(re)&&(le[de]=re)}function X(oe){return oe instanceof Z.Z||oe instanceof $.Z}function te(oe,le,de){if((0,G.Wi)(oe))return null;const{context:se,isLabelSymbol:re}=de,j=se?.origin,Y=se?.messages;if("web-scene"===j&&!X(oe)){const ie=(0,Q.q)(oe,{retainCIM:!0,hasLabelingContext:re});return(0,G.pC)(ie.symbol)?ie.symbol.write(le,se):(Y?.push(new R.Z("symbol:unsupported",`Symbols of type '${oe.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:oe,context:se,error:ie.error})),null)}const ee=se?.layer?.type;return"web-map"!==j&&("portal-item"!==j||ee&&W.includes(ee))||!X(oe)?oe.write(le,se):(Y?.push(new R.Z("symbol:unsupported",`Symbols of type '${oe.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:oe,context:se})),null)}function ae(oe,le){return(0,D.S9)(oe,null,le)}},67866:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>D,k:()=>R});const D=["begin","end","begin-end"],R=["arrow","circle","square","diamond","cross","x"]},60958:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>W,y:()=>B});var D=v(91558),R=v(23841),G=v(90912),Z=v(92236);const W={type:D.Z,json:{type:[G.z8],default:null,read:{source:["color","transparency"],reader:function Q(H,X){const te=null!=X.transparency?(0,Z.b)(X.transparency):1,ae=X.color;return ae&&Array.isArray(ae)?new D.Z([ae[0]||0,ae[1]||0,ae[2]||0,te]):null}},write:{target:{color:{type:[G.z8]},transparency:{type:G.z8}},writer:function $(H,X){X.color=H.toJSON().slice(0,3);const te=(0,Z.a)(H.a);0!==te&&(X.transparency=te)}}}},B={type:Number,cast:R.t_,json:{write:!0}}},66960:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{getPatternDescriptor:()=>me,getSizeFromOptions:()=>ve,getSymbolLayerFill:()=>he,previewSymbol3D:()=>Be});var D=v(15861),R=v(54346),G=v(78260),Q=(v(8314),v(26584)),$=v(63290),W=v(62208),B=v(10699),H=v(23841),X=v(74741),te=v(33215),ae=v(48521),oe=v(71131),le=v(34057),de=v(86606),se=v(50998);const re=oe.b_.size,j=oe.b_.maxSize,Y=oe.b_.maxOutlineSize,ee=oe.b_.lineWidth,ie=oe.b_.tallSymbolWidth;function J(Fe){const je=Fe.outline,Re=(0,W.pC)(Fe.material)?Fe.material.color:null,He=(0,W.pC)(Re)?Re.toHex():null;if((0,W.Wi)(je)||"pattern"in je&&(0,W.pC)(je.pattern)&&"style"===je.pattern.type&&"none"===je.pattern.style)return"fill"===Fe.type&&"#ffffff"===He?{color:"#bdc3c7",width:.75}:null;const Ie=(0,H.F2)(je.size)||0;return{color:"rgba("+((0,W.pC)(je.color)?je.color.toRgba():"255,255,255,1")+")",width:Math.min(Ie,Y),style:"pattern"in je&&(0,W.pC)(je.pattern)&&"style"===je.pattern.type?(0,X.Sp)(je.pattern.style):null,join:"butt",cap:"patternCap"in je?je.patternCap:"butt"}}function ue(Fe,je=1){const Re=Fe.a,He=(0,G._Y)(Fe),Ie=He.h,Ge=He.s/je,Pe=100-(100-He.v)/je,{r:Le,g:Me,b:Ne}=(0,G.xr)({h:Ie,s:Ge,v:Pe});return[Le,Me,Ne,Re]}function pe(Fe){return"water"===Fe.type?(0,W.Wi)(Fe.color)?null:Fe.color:(0,W.Wi)(Fe.material)||(0,W.Wi)(Fe.material.color)?null:Fe.material.color}function he(Fe,je=0){const Re=pe(Fe);if(!Re){if("fill"===Fe.type)return null;const Ge=(0,oe.uH)(X.Ne.r,je);return[Ge,Ge,Ge,100]}const He=Re.toRgba();for(let Ie=0;Ie<3;Ie++)He[Ie]=(0,oe.uH)(He[Ie],je);return He}function me(Fe,je){return ge.apply(this,arguments)}function ge(){return(ge=(0,D.Z)(function*(Fe,je){const Re=Fe.style;return"none"===Re?null:{type:"pattern",x:0,y:0,src:yield(0,X.Od)((0,R.V)(`esri/symbols/patterns/${Re}.png`),je.toCss(!0)),width:5,height:5}})).apply(this,arguments)}function _e(Fe){return Fe.outline?J(Fe):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Ee(Fe,je){const Re=pe(Fe);if(!Re)return null;let He="rgba(";return He+=(0,oe.uH)(Re.r,je)+",",He+=(0,oe.uH)(Re.g,je)+",",He+=(0,oe.uH)(Re.b,je)+",",He+Re.a+");"}function De(Fe,je){const Re=Ee(Fe,je);return Re?"pattern"in Fe&&(0,W.pC)(Fe.pattern)&&"style"===Fe.pattern.type&&"none"===Fe.pattern.style?null:{color:Re,width:Math.min(Fe.size?(0,H.F2)(Fe.size):.75,Y),style:"pattern"in Fe&&(0,W.pC)(Fe.pattern)&&"style"===Fe.pattern.type?(0,X.Sp)(Fe.pattern.style):null,cap:"cap"in Fe?Fe.cap:null,join:"join"in Fe?"miter"===Fe.join?(0,H.F2)(2):Fe.join:null}:{}}function be(Fe,je,Re){const He=null!=Re?.75*Re:0;return{type:"linear",x1:He?.25*He:0,y1:He?.5*He:0,x2:He||4,y2:He?.5*He:4,colors:[{color:Fe,offset:0},{color:je,offset:1}]}}function ve(Fe){const je="number"==typeof Fe?.size?Fe?.size:null;return je?(0,H.F2)(je):null}function Ce(){return(Ce=(0,D.Z)(function*(Fe,je){const Re="mesh-3d"===Fe.type,He=Fe.symbolLayers,Ie=ve(je),Ge=je&&je.maxSize?(0,H.F2)(je.maxSize):null,Pe=Ie||re,Le=[];let Me=0,Ne=0,Xe=!1;for(let Ye=0;Ye<He.length;Ye++){const Je=He.getItemAt(Ye),rt=[];if(Re&&"fill"!==Je.type)continue;const tt=oe.JZ.fill[0];switch(Je.type){case"fill":{const et=J(Je),qe=Math.min(Pe,Ge||j);Me=Math.max(Me,qe),Ne=Math.max(Ne,qe),Xe=!0;let ot=he(Je,0);const ut="pattern"in Je?Je.pattern:null,_t=pe(Je);!Re&&(0,W.pC)(ut)&&"style"===ut.type&&"solid"!==ut.style&&_t&&(ot=yield me(ut,_t)),rt.push({shape:tt,fill:ot,stroke:et});break}case"line":{const et=De(Je,0);if((0,W.Wi)(et))break;const qe={stroke:et,shape:tt};Me=Math.max(Me,re),Ne=Math.max(Ne,re),rt.push(qe);break}case"extrude":{const et={join:"round",width:1,...De(Je,-.4)},qe=he(Je,0),ot=he(Je,-.2),ut=Math.min(Pe,Ge||j),_t=(0,oe.EV)(ut);et.width=1,rt.push({shape:_t[0],fill:ot,stroke:et}),rt.push({shape:_t[1],fill:ot,stroke:et}),rt.push({shape:_t[2],fill:qe,stroke:et});const vt=.7*re+.5*ut;Me=Math.max(Me,re),Ne=Math.max(Ne,vt);break}case"water":{const et=(0,W.s3)(pe(Je)),qe=ue(et),ot=ue(et,2),ut=ue(et,3),_t=(0,oe.ht)();Xe=!0,rt.push({shape:_t[0],fill:qe}),rt.push({shape:_t[1],fill:ot}),rt.push({shape:_t[2],fill:ut});const Ct=Math.min(Pe,Ge||j);Me=Math.max(Me,Ct),Ne=Math.max(Ne,Ct);break}}Le.push(rt)}return(0,le.w)(Le,[Me,Ne],{node:je&&je.node,scale:Xe,opacity:je&&je.opacity})})).apply(this,arguments)}function Be(Fe,je){if(0===Fe.symbolLayers.length)return Promise.reject(new Q.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(Fe.type){case"point-3d":return function ze(Fe,je){const Re=ve(je),He=je?.maxSize?(0,H.F2)(je.maxSize):null,Ie=je?.disableUpsampling??!1,Ge=Fe.symbolLayers,Pe=[];let Le=0,Me=0;const Ne=Ge.getItemAt(Ge.length-1);let Xe;return Ne&&"icon"===Ne.type&&(Xe=Ne.size&&(0,H.F2)(Ne.size)),Ge.forEach(Ye=>{if("icon"!==Ye.type&&"object"!==Ye.type)return;const Je="icon"===Ye.type?Ye.size&&(0,H.F2)(Ye.size):0,rt=Re||Je?Math.ceil(Math.min(Re||Je,He||j)):re;if(Ye&&Ye.resource&&Ye.resource.href){const tt=function ce(Fe,je){const Re=je&&je.resource,He=Re&&Re.href;if(Fe.thumbnail&&Fe.thumbnail.url)return Promise.resolve(Fe.thumbnail.url);if(He&&"object"!==je.type)return Promise.resolve((0,de.nf)(Fe,je));const Ie=(0,R.V)("esri/images/Legend/legend3dsymboldefault.png");return Fe.styleOrigin&&(Fe.styleOrigin.styleName||Fe.styleOrigin.styleUrl)?(0,se.resolveWebStyleSymbol)(Fe.styleOrigin,{portal:Fe.styleOrigin.portal},"webRef").catch(Ge=>Ge).then(Ge=>Ge?.thumbnail?.url||Ie):Promise.resolve(Ie)}(Fe,Ye).then(et=>{const qe=Ye.get("material.color"),ot=function xe(Fe){return"icon"===Fe.type?"multiply":"tint"}(Ye);return(0,le.r)(et,rt,qe,ot,Ie)}).then(et=>{const qe=et.width,ot=et.height;return Le=Math.max(Le,qe),Me=Math.max(Me,ot),[{shape:{type:"image",x:0,y:0,width:qe,height:ot,src:et.url},fill:null,stroke:null}]});Pe.push(tt)}else{let tt=rt;"icon"===Ye.type&&Xe&&Re&&(tt=rt*(Je/Xe));const et="tall"===je?.symbolConfig||je?.symbolConfig?.isTall||"object"===Ye.type&&function Se(Fe){const je=Fe.depth,Re=Fe.height,He=Fe.width;return 0!==He&&0!==je&&0!==Re&&He===je&&null!=He&&null!=Re&&He<Re}(Ye);Le=Math.max(Le,et?ie:tt),Me=Math.max(Me,tt),Pe.push(Promise.resolve(function ye(Fe,je,Re){const He=[];if(!Fe)return He;switch(Fe.type){case"icon":{const Pe=je,Le=je;switch(Fe.resource&&Fe.resource.primitive||te.S){case"circle":He.push({shape:{type:"circle",cx:0,cy:0,r:.5*je},fill:he(Fe,0),stroke:J(Fe)});break;case"square":He.push({shape:{type:"path",path:[{command:"M",values:[0,Le]},{command:"L",values:[0,0]},{command:"L",values:[Pe,0]},{command:"L",values:[Pe,Le]},{command:"Z",values:[]}]},fill:he(Fe,0),stroke:J(Fe)});break;case"triangle":He.push({shape:{type:"path",path:[{command:"M",values:[0,Le]},{command:"L",values:[.5*Pe,0]},{command:"L",values:[Pe,Le]},{command:"Z",values:[]}]},fill:he(Fe,0),stroke:J(Fe)});break;case"cross":He.push({shape:{type:"path",path:[{command:"M",values:[.5*Pe,0]},{command:"L",values:[.5*Pe,Le]},{command:"M",values:[0,.5*Le]},{command:"L",values:[Pe,.5*Le]}]},stroke:_e(Fe)});break;case"x":He.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[Pe,Le]},{command:"M",values:[Pe,0]},{command:"L",values:[0,Le]}]},stroke:_e(Fe)});break;case"kite":He.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Le]},{command:"L",values:[.5*Pe,0]},{command:"L",values:[Pe,.5*Le]},{command:"L",values:[.5*Pe,Le]},{command:"Z",values:[]}]},fill:he(Fe,0),stroke:J(Fe)})}break}case"object":switch(Fe.resource&&Fe.resource.primitive||ae.S){case"cone":{const Ie=be(he(Fe,0),he(Fe,-.6),Re?ie:je),Ge=(0,oe.TE)(je,Re);He.push({shape:Ge[0],fill:Ie}),He.push({shape:Ge[1],fill:Ie});break}case"inverted-cone":{const Ie=he(Fe,0),Ge=be(Ie,he(Fe,-.6),je),Pe=(0,oe.DY)(je);He.push({shape:Pe[0],fill:Ge}),He.push({shape:Pe[1],fill:Ie});break}case"cube":{const Ie=(0,oe.Pc)(je,Re);He.push({shape:Ie[0],fill:he(Fe,0)}),He.push({shape:Ie[1],fill:he(Fe,-.3)}),He.push({shape:Ie[2],fill:he(Fe,-.5)});break}case"cylinder":{const Ie=be(he(Fe,0),he(Fe,-.6),Re?ie:je),Ge=(0,oe.EB)(je,Re);He.push({shape:Ge[0],fill:Ie}),He.push({shape:Ge[1],fill:Ie}),He.push({shape:Ge[2],fill:he(Fe,0)});break}case"diamond":{const Ie=(0,oe.XX)(je);He.push({shape:Ie[0],fill:he(Fe,-.3)}),He.push({shape:Ie[1],fill:he(Fe,0)}),He.push({shape:Ie[2],fill:he(Fe,-.3)}),He.push({shape:Ie[3],fill:he(Fe,-.7)});break}case"sphere":{const Ie=be(he(Fe,0),he(Fe,-.6));Ie.x1=0,Ie.y1=0,Ie.x2=.25*je,Ie.y2=.25*je,He.push({shape:{type:"circle",cx:0,cy:0,r:.5*je},fill:Ie});break}case"tetrahedron":{const Ie=(0,oe.tp)(je);He.push({shape:Ie[0],fill:he(Fe,-.3)}),He.push({shape:Ie[1],fill:he(Fe,0)}),He.push({shape:Ie[2],fill:he(Fe,-.6)});break}}}return He}(Ye,tt,et)))}}),(0,B.as)(Pe).then(Ye=>{const Je=[];return Ye.forEach(rt=>{rt.value?Je.push(rt.value):rt.error&&$.Z.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",rt.error)}),(0,le.w)(Je,[Le,Me],{node:je&&je.node,scale:!1,opacity:je&&je.opacity})})}(Fe,je);case"line-3d":return function Ke(Fe,je){const Re=Fe.symbolLayers,He=[],Ie=(0,de.YW)(Fe),Ge=ve(je),Pe=(je&&je.maxSize?(0,H.F2)(je.maxSize):null)||Y;let Le,Me=0,Ne=0;return Re.forEach((Xe,Ye)=>{if(!Xe||"line"!==Xe.type&&"path"!==Xe.type)return;const Je=[];switch(Xe.type){case"line":{const rt=De(Xe,0);if((0,W.Wi)(rt))break;const tt=rt&&rt.width||0;0===Ye&&(Le=tt);const et=Math.min(Ge||tt,Pe),qe=0===Ye?et:Ge?et*(tt/Le):et,ot=qe>ee/2?2*qe:ee;Ne=Math.max(Ne,qe),Me=Math.max(Me,ot),rt.width=qe,Je.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Ne]},{command:"L",values:[Me,.5*Ne]}]},stroke:rt});break}case"path":{const rt=Math.min(Ge||re,Pe),tt=he(Xe,0),et=he(Xe,-.2),qe=Ee(Xe,-.4),ot=qe?{color:qe,width:1}:{};if("quad"===Xe.profile){const ut=Xe.width,_t=Xe.height,Ct=(0,oe.eb)(ut&&_t?ut/_t:1,0===_t,0===ut),vt={...ot,join:"bevel"};Je.push({shape:Ct[0],fill:et,stroke:vt}),Je.push({shape:Ct[1],fill:et,stroke:vt}),Je.push({shape:Ct[2],fill:tt,stroke:vt})}else Je.push({shape:oe.JZ.pathSymbol3DLayer[0],fill:et,stroke:ot}),Je.push({shape:oe.JZ.pathSymbol3DLayer[1],fill:tt,stroke:ot});Ne=Math.max(Ne,rt),Me=Ne}}He.push(Je)}),Promise.resolve((0,le.w)(He,[Me,Ne],{node:je&&je.node,scale:Ie,opacity:je&&je.opacity}))}(Fe,je);case"polygon-3d":case"mesh-3d":return function We(Fe,je){return Ce.apply(this,arguments)}(Fe,je)}return Promise.reject(new Q.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},71131:(nt,Ae,v)=>{"use strict";v.d(Ae,{DY:()=>X,EB:()=>B,EV:()=>Q,JZ:()=>G,Pc:()=>W,TE:()=>H,XX:()=>te,b_:()=>R,dc:()=>le,eb:()=>Z,ht:()=>$,tp:()=>ae,uH:()=>oe});var R,de,D=v(91558);(de=R||(R={}))[de.size=22]="size",de[de.lineWidth=50]="lineWidth",de[de.maxSize=120]="maxSize",de[de.maxOutlineSize=80]="maxOutlineSize",de[de.tallSymbolWidth=20]="tallSymbolWidth";const G={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Z(de,se,re){const j=R.size;let Y=j,ee=j;de<1?Y*=.75:de>1&&(ee*=1.25);let ce=j,ue=j;return se&&re&&(Y=ee=ce=ue=0),[{type:"path",path:[{command:"M",values:[ce,0]},{command:"L",values:[re?ce:.875*ce,0]},{command:"L",values:[re?Y-.5*ce:0,ee-.5*ue]},{command:"L",values:[Y-.5*ce,ee-.5*ue]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[ce,0]},{command:"L",values:[ce,se?0:.125*ue]},{command:"L",values:[Y-.5*ce,se?ee-.5*ue:ue]},{command:"L",values:[Y-.5*ce,ee-.5*ue]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[Y-.5*ce,ee-.5*ue]},{command:"L",values:[re?Y-.5*ce:0,ee-.5*ue]},{command:"L",values:[re?Y-.5*ce:0,se?ee-.5*ue:ue]},{command:"L",values:[Y-.5*ce,se?ee-.5*ue:ue]},{command:"Z",values:[]}]}]}function Q(de){const se=R.size,re=.5*de;return[{type:"path",path:[{command:"M",values:[0,.7*se*.5]},{command:"L",values:[.3*se,.7*se]},{command:"L",values:[.3*se,.7*se+re]},{command:"L",values:[0,.7*se+re-.7*se*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*se,.7*se]},{command:"L",values:[.3*se,.7*se+re]},{command:"L",values:[se,re]},{command:"L",values:[se,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*se,0]},{command:"L",values:[se,0]},{command:"L",values:[.3*se,.7*se]},{command:"L",values:[0,.7*se*.5]},{command:"Z",values:[]}]}]}function $(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function W(de,se){let re=se?R.tallSymbolWidth:de;const Y=se?4:6;re-=re<=R.size?.5*Y:Y;const J=se?.35*re:.5*re;return[{type:"path",path:[{command:"M",values:[.5*re,0]},{command:"L",values:[re,.5*J]},{command:"L",values:[.5*re,J]},{command:"L",values:[0,.5*J]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*J]},{command:"L",values:[.5*re,J]},{command:"L",values:[.5*re,de]},{command:"L",values:[0,de-.5*J]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*re,J]},{command:"L",values:[.5*re,de]},{command:"L",values:[re,de-.5*J]},{command:"L",values:[re,.5*J]},{command:"Z",values:[]}]}]}function B(de,se){let re=se?R.tallSymbolWidth:de;const Y=se?4:6;re-=re<=R.size?.5*Y:Y;const ee=.5*re,ie=.15*re,ce=de-ie;return[{type:"ellipse",cx:.5*re,cy:ce,rx:ee,ry:ie},{type:"path",path:[{command:"M",values:[0,ie]},{command:"L",values:[0,ce]},{command:"L",values:[re,ce]},{command:"L",values:[re,ie]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*re,cy:ie,rx:ee,ry:ie}]}function H(de,se){let re=se?R.tallSymbolWidth:de;const Y=se?4:6;re-=re<=R.size?.5*Y:Y;const ee=.15*re,ie=de-ee;return[{type:"ellipse",cx:.5*re,cy:ie,rx:.5*re,ry:ee},{type:"path",path:[{command:"M",values:[.5*re,0]},{command:"L",values:[re,ie]},{command:"L",values:[0,ie]},{command:"Z",values:[]}]}]}function X(de){let se=de;se-=se<R.size?3:6;const Y=.15*se;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[se,0]},{command:"L",values:[.5*se,de-Y]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*se,cy:0,rx:.5*se,ry:Y}]}function te(de){let se=de;const re=de;se-=se<R.size?2:4;const ie=se,J=re,ce=Math.floor(de/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*ie,0]},{command:"L",values:[ie,.5*J-ce]},{command:"L",values:[.45*ie-ce,.5*J+ce]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*ie,0]},{command:"L",values:[.45*ie-ce,.5*J+ce]},{command:"L",values:[0,.5*J-ce]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*J-ce]},{command:"L",values:[.45*ie-ce,.5*J+ce]},{command:"L",values:[.45*ie,re]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*ie,re]},{command:"L",values:[ie,.5*J-ce]},{command:"L",values:[.45*ie-ce,.5*J+ce]},{command:"Z",values:[]}]}]}function ae(de){let j=de;return j-=j<R.size?1:2,[{type:"path",path:[{command:"M",values:[.45*de,0]},{command:"L",values:[de,j]},{command:"L",values:[.45*de,.6*j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*de,0]},{command:"L",values:[.45*de,.6*j]},{command:"L",values:[0,j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,j]},{command:"L",values:[.45*de,.6*j]},{command:"L",values:[de,j]},{command:"Z",values:[]}]}]}function oe(de,se){return Math.round(Math.min(Math.max(de+255*se*.75,0),255))}function le(de,se){if(null==de)return new D.Z;if("type"in de&&("linear"===de.type||"pattern"===de.type))return de;const re=new D.Z(de);return new D.Z([oe(re.r,se),oe(re.g,se),oe(re.b,se),re.a])}},34057:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>se,w:()=>te});var D=v(24263),R=v(84792),G=v(78260),Z=v(26584),Q=v(8314),W=(v(50645),v(62996)),B=v(30695),H=v(86606);const X=(0,W.E)();function te(re,j,Y){const ee=Math.ceil(j[0]),ie=Math.ceil(j[1]);if(!re.some(ce=>!!ce.length))return null;const J=Y&&Y.node||document.createElement("div");return null!=Y.opacity&&(J.style.opacity=Y.opacity.toString()),null!=Y.effectView&&(J.style.filter=(0,H.wJ)(Y.effectView)),X.append(J,B.KB.bind(null,re,ee,ie,Y)),J}function de(re,j,Y,ee,ie){switch(ie){case"multiply":re[j+0]*=Y[0],re[j+1]*=Y[1],re[j+2]*=Y[2],re[j+3]*=Y[3];break;default:{const J=(0,G._Y)({r:re[j+0],g:re[j+1],b:re[j+2]});J.h=ee.h,J.s=ee.s,J.v=J.v/100*ee.v;const ce=(0,G.xr)(J);re[j+0]=ce.r,re[j+1]=ce.g,re[j+2]=ce.b,re[j+3]*=Y[3];break}}}function se(re,j,Y,ee,ie){return function oe(re,j,Y){return re?(0,R.default)(re,{responseType:"image"}).then(ee=>{const ie=ee.data,J=ie.width,ce=ie.height,ue=J/ce;let pe=j;if(Y){const he=Math.max(J,ce);pe=Math.min(pe,he)}return{image:ie,width:ue<=1?Math.ceil(pe*ue):pe,height:ue<=1?pe:Math.ceil(pe/ue)}}):Promise.reject(new Z.Z("renderUtils: imageDataSize","href not provided."))}(re,j,ie).then(J=>{const ce=J.width?J.width:j,ue=J.height?J.height:j;if(J.image&&function le(re,j){return!(!re||"ignore"===j||"multiply"===j&&255===re.r&&255===re.g&&255===re.b&&1===re.a)}(Y,ee)){let pe=J.image.width,he=J.image.height;(0,Q.Z)("edge")&&/\.svg$/i.test(re)&&(pe-=1,he-=1);const me=function ae(re,j){re=Math.ceil(re),j=Math.ceil(j);const Y=document.createElement("canvas");Y.width=re,Y.height=j,Y.style.width=re+"px",Y.style.height=j+"px";const ee=Y.getContext("2d");return ee.clearRect(0,0,re,j),ee}(ce,ue);me.drawImage(J.image,0,0,pe,he,0,0,ce,ue);const ge=me.getImageData(0,0,ce,ue),_e=[Y.r/255,Y.g/255,Y.b/255,Y.a],Ee=(0,G._Y)(Y);for(let De=0;De<ge.data.length;De+=4)de(ge.data,De,_e,Ee,ee);me.putImageData(ge,0,0),re=me.canvas.toDataURL("image/png")}else{const pe=D.id&&D.id.findCredential(re);if(pe&&pe.token){const he=re.includes("?")?"&":"?";re=`${re}${he}token=${pe.token}`}}return{url:re,width:ce,height:ue}}).catch(()=>({url:re,width:j,height:j}))}},71937:(nt,Ae,v)=>{"use strict";v.d(Ae,{EJ:()=>j,KV:()=>se,n2:()=>de,v9:()=>re,wm:()=>ie});var D=v(15861),R=v(84792),G=v(26584),Z=v(62208),Q=v(10699),$=v(21726),W=v(84687),B=v(6278),H=v(35560);const X={};function ae(){return(ae=(0,D.Z)(function*(J,ce){try{return{data:(yield j(J,ce)).data,baseUrl:(0,$.Yd)(J),styleUrl:J}}catch(ue){return(0,Q.r9)(ue),null}})).apply(this,arguments)}function de(J,ce,ue){return J&&(0,Z.pC)(J.styleUrl)?function te(J,ce){return ae.apply(this,arguments)}(J.styleUrl,ue):J&&(0,Z.pC)(J.styleName)?function oe(J,ce,ue){const pe=(0,Z.pC)(ce.portal)?ce.portal:W.Z.getDefault();let he;const me=`${pe.url} - ${pe.user&&pe.user.username} - ${J}`;return X[me]||(X[me]=function le(J,ce,ue){return ce.load(ue).then(()=>{const pe=new B.Z({disableExtraQuery:!0,query:`owner:${Y} AND type:${ee} AND typekeywords:"${J}"`});return ce.queryItems(pe,ue)}).then(({results:pe})=>{let he=null;const me=J.toLowerCase();if(pe&&Array.isArray(pe))for(const ge of pe)if(ge.typeKeywords?.some(Ee=>Ee.toLowerCase()===me)&&ge.type===ee&&ge.owner===Y){he=ge;break}if(!he)throw new G.Z("symbolstyleutils:style-not-found",`The style '${J}' could not be found`,{styleName:J});return he.load(ue)})}(J,pe,ue).then(ge=>(he=ge,ge.fetchData())).then(ge=>({data:ge,baseUrl:he.itemUrl??"",styleName:J}))),X[me]}(J.styleName,ce,ue):Promise.reject(new G.Z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function se(J){return null===J||"CIMSymbolReference"===J.type?J:{type:"CIMSymbolReference",symbol:J}}function re(J,ce){if("cimRef"===ce)return J.cimRef;if(J.formatInfos&&!(0,H.K3)())for(const ue of J.formatInfos)if("gltf"===ue.type)return ue.href;return J.webRef}function j(J,ce){const ue={responseType:"json",query:{f:"json"},...ce};return(0,R.default)((0,$.Fv)(J),ue)}const Y="esri_en",ee="Style",ie="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},30695:(nt,Ae,v)=>{"use strict";v.d(Ae,{A5:()=>ve,KB:()=>We,al:()=>xe,ch:()=>he,iL:()=>ze,jA:()=>ce,kQ:()=>ue,vq:()=>J});var D=v(91558),R=v(8314),G=v(62208),Z=v(12225),Q=v(31478),W=(v(38570),v(94450));let H=0,X=0;const te=(0,R.Z)("android"),ae=(0,R.Z)("chrome")||te&&te>=4?"auto":"optimizeLegibility",oe={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},le=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let de={},se={};const re={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},j=Math.PI;let Y=1;function ee(Ce,Be){const Fe=Ce*(j/180);return Math.abs(Be*Math.sin(Fe))+Math.abs(Be*Math.cos(Fe))}function ie(Ce){return Ce.map(Be=>`${Be.command} ${Be.values.join(" ")}`).join(" ").trim()}function J(Ce,Be,Fe,je){if(Ce){if("circle"===Ce.type)return(0,W.u)("circle",{fill:Be,"fill-rule":"evenodd",stroke:Fe.color,"stroke-width":Fe.width,"stroke-linecap":Fe.cap,"stroke-linejoin":Fe.join,"stroke-dasharray":Fe.dashArray,"stroke-dashoffset":Fe.dashOffset,"stroke-miterlimit":"4",cx:Ce.cx,cy:Ce.cy,r:Ce.r});if("ellipse"===Ce.type)return(0,W.u)("ellipse",{fill:Be,"fill-rule":"evenodd",stroke:Fe.color,"stroke-width":Fe.width,"stroke-linecap":Fe.cap,"stroke-linejoin":Fe.join,"stroke-dasharray":Fe.dashArray,"stroke-miterlimit":"4",cx:Ce.cx,cy:Ce.cy,rx:Ce.rx,ry:Ce.ry});if("rect"===Ce.type)return(0,W.u)("rect",{fill:Be,"fill-rule":"evenodd",stroke:Fe.color,"stroke-width":Fe.width,"stroke-linecap":Fe.cap,"stroke-linejoin":Fe.join,"stroke-dasharray":Fe.dashArray,"stroke-miterlimit":"4",x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height});if("image"===Ce.type)return(0,W.u)("image",{href:Ce.src,x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,preserveAspectRatio:"none"});if("path"===Ce.type){const Re="string"!=typeof Ce.path?ie(Ce.path):Ce.path;return(0,W.u)("path",{fill:Be,"fill-rule":"evenodd",stroke:Fe.color,"stroke-width":Fe.width,"stroke-linecap":Fe.cap,"stroke-linejoin":Fe.join,"stroke-dasharray":Fe.dashArray,"stroke-miterlimit":"4",d:Re})}if("text"===Ce.type)return(0,G.O3)(je),(0,W.u)("text",{"dominant-baseline":je.dominantBaseline,fill:Be,"fill-rule":"evenodd",stroke:Fe.color,"stroke-width":Fe.width,"stroke-linecap":Fe.cap,"stroke-linejoin":Fe.join,"stroke-dasharray":Fe.dashArray,"stroke-miterlimit":"4","text-anchor":je.align,"text-decoration":je.decoration,kerning:je.kerning,rotate:je.rotate,"text-rendering":ae,"font-style":je.font.style,"font-variant":je.font.variant,"font-weight":je.font.weight,"font-size":je.font.size,"font-family":je.font.family,x:Ce.x,y:Ce.y},Ce.text)}return null}function ce(Ce){const Be={fill:"none",pattern:null,linearGradient:null};if(Ce)if("type"in Ce&&"pattern"===Ce.type){const Fe="patternId-"+ ++H;Be.fill=`url(#${Fe})`,Be.pattern={id:Fe,x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,image:{x:0,y:0,width:Ce.width,height:Ce.height,href:Ce.src}}}else if("type"in Ce&&"linear"===Ce.type){const Fe="linearGradientId-"+ ++X;Be.fill=`url(#${Fe})`,Be.linearGradient={id:Fe,x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,stops:Ce.colors.map(je=>({offset:je.offset,color:je.color&&new D.Z(je.color).toString()}))}}else if(Ce){const Fe=new D.Z(Ce);Be.fill=Fe.toString()}return Be}function ue(Ce){const Be={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(Ce&&(null!=Ce.width&&(Be.width=Ce.width),Ce.cap&&(Be.cap=Ce.cap),Ce.join&&(Be.join=Ce.join.toString()),Ce.color&&(Be.color=new D.Z(Ce.color).toString()),Ce.dashArray&&(Be.dashArray=Ce.dashArray),Ce.dashArray&&(Be.dashOffset=Ce.dashoffset),Ce.style)){let Fe=null;if(Ce.style in re&&(Fe=re[Ce.style]),Array.isArray(Fe)){Fe=Fe.slice(0);const je=Ce.width??0;for(let Re=0;Re<Fe.length;++Re)Fe[Re]*=je;if("butt"!==Ce.cap){for(let Re=0;Re<Fe.length;Re+=2)Fe[Re]-=je,Fe[Re]<1&&(Fe[Re]=1);for(let Re=1;Re<Fe.length;Re+=2)Fe[Re]+=je}Fe=Fe.join(",")}Be.dashArray=Fe}return Be}function pe(Ce,Be){const Fe={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(Ce){const je=Ce.alignBaseline,Re="baseline"===je?"auto":"top"===je?"text-top":"bottom"===je?"hanging":je;Fe.align=Ce.align,Fe.dominantBaseline=Re,Fe.decoration=Ce.decoration,Fe.kerning=Ce.kerning?"auto":"0",Fe.rotate=Ce.rotated?"90":"0",(0,G.O3)(Be),Fe.font.style=Be.style||"normal",Fe.font.variant=Be.variant||"normal",Fe.font.weight=Be.weight||"normal",Fe.font.size=Be.size&&Be.size.toString()||"10pt",Fe.font.family=Be.family||"serif"}return Fe}function he(Ce){const{pattern:Be,linearGradient:Fe}=Ce;if(Be)return(0,W.u)("pattern",{id:Be.id,patternUnits:"userSpaceOnUse",x:Be.x,y:Be.y,width:Be.width,height:Be.height},(0,W.u)("image",{x:Be.image.x,y:Be.image.y,width:Be.image.width,height:Be.image.height,href:Be.image.href}));if(Fe){const je=Fe.stops.map((Re,He)=>(0,W.u)("stop",{key:`${He}-stop`,offset:Re.offset,"stop-color":Re.color}));return(0,W.u)("linearGradient",{id:Fe.id,gradientUnits:"userSpaceOnUse",x1:Fe.x1,y1:Fe.y1,x2:Fe.x2,y2:Fe.y2},je)}return null}function me(Ce,Be){if(!Ce)return null;const Fe=[];for(const je of Ce){const{shape:Re,fill:He,stroke:Ie,font:Ge}=je,Pe=ce(He),Le=ue(Ie),Me="text"===Re.type?pe(Re,Ge):null,Ne=J(Re,Pe.fill,Le,Me);Ne&&Fe.push(Ne)}return(0,W.u)("mask",{id:Be,maskUnits:"userSpaceOnUse"},(0,W.u)("g",null,Fe))}function ge(Ce,Be,Fe){return(0,Q.t)(Ce,(0,Q.i)(Ce),[Be,Fe])}function _e(Ce,Be,Fe,je,Re){return(0,Q.s)(Ce,(0,Q.i)(Ce),[Be,Fe]),Ce[4]=Ce[4]*Be-je*Be+je,Ce[5]=Ce[5]*Fe-Re*Fe+Re,Ce}function De(Ce,Be){de&&"left"in de?(null!=de.left&&de.left>Ce&&(de.left=Ce),(null==de.right||de.right<Ce)&&(de.right=Ce),(null==de.top||de.top>Be)&&(de.top=Be),(null==de.bottom||de.bottom<Be)&&(de.bottom=Be)):de={left:Ce,bottom:Be,right:Ce,top:Be}}function be(Ce){const Be=Ce.args,Fe=Be.length;let je;switch(Ce.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(je=0;je<Fe;je+=2)De(Be[je],Be[je+1]);se.x=Be[Fe-2],se.y=Be[Fe-1];break;case"H":for(je=0;je<Fe;++je)De(Be[je],se.y);se.x=Be[Fe-1];break;case"V":for(je=0;je<Fe;++je)De(se.x,Be[je]);se.y=Be[Fe-1];break;case"m":{let Re=0;for(("x"in se||(De(se.x=Be[0],se.y=Be[1]),Re=2),je=Re);je<Fe;je+=2)De(se.x+=Be[je],se.y+=Be[je+1]);break}case"l":case"t":for(je=0;je<Fe;je+=2)De(se.x+=Be[je],se.y+=Be[je+1]);break;case"h":for(je=0;je<Fe;++je)De(se.x+=Be[je],se.y);break;case"v":for(je=0;je<Fe;++je)De(se.x,se.y+=Be[je]);break;case"c":for(je=0;je<Fe;je+=6)De(se.x+Be[je],se.y+Be[je+1]),De(se.x+Be[je+2],se.y+Be[je+3]),De(se.x+=Be[je+4],se.y+=Be[je+5]);break;case"s":case"q":for(je=0;je<Fe;je+=4)De(se.x+Be[je],se.y+Be[je+1]),De(se.x+=Be[je+2],se.y+=Be[je+3]);break;case"A":for(je=0;je<Fe;je+=7)De(Be[je+5],Be[je+6]);se.x=Be[Fe-2],se.y=Be[Fe-1];break;case"a":for(je=0;je<Fe;je+=7)De(se.x+=Be[je+5],se.y+=Be[je+6])}}function Se(Ce,Be,Fe){const je=oe[Ce.toLowerCase()];let Re;"number"==typeof je&&(je?Be.length>=je&&(Re={action:Ce,args:Be.slice(0,Be.length-Be.length%je)},Fe.push(Re),be(Re)):(Re={action:Ce,args:[]},Fe.push(Re),be(Re)))}function ve(Ce){const Be={x:0,y:0,width:0,height:0};if("circle"===Ce.type)Be.x=Ce.cx-Ce.r,Be.y=Ce.cy-Ce.r,Be.width=2*Ce.r,Be.height=2*Ce.r;else if("ellipse"===Ce.type)Be.x=Ce.cx-Ce.rx,Be.y=Ce.cy-Ce.ry,Be.width=2*Ce.rx,Be.height=2*Ce.ry;else if("image"===Ce.type||"rect"===Ce.type)Be.x=Ce.x,Be.y=Ce.y,Be.width=Ce.width,Be.height=Ce.height;else if("path"===Ce.type){const Fe=(0,G.s3)(function ye(Ce){const Be=("string"!=typeof Ce.path?ie(Ce.path):Ce.path).match(le),Fe=[];if(de={},se={},!Be)return null;let je="",Re=[];const He=Be.length;for(let Ge=0;Ge<He;++Ge){const Pe=Be[Ge],Le=parseFloat(Pe);isNaN(Le)?(je&&Se(je,Re,Fe),Re=[],je=Pe):Re.push(Le)}Se(je,Re,Fe);const Ie={x:0,y:0,width:0,height:0};return de&&"left"in de&&(Ie.x=de.left,Ie.y=de.top,Ie.width=de.right-de.left,Ie.height=de.bottom-de.top),Ie}(Ce));Be.x=Fe.x,Be.y=Fe.y,Be.width=Fe.width,Be.height=Fe.height}return Be}function xe(Ce){const Be={x:0,y:0,width:0,height:0};let Fe=null,je=Number.NEGATIVE_INFINITY,Re=Number.NEGATIVE_INFINITY;for(const He of Ce)Fe?(Fe.x=Math.min(Fe.x,He.x),Fe.y=Math.min(Fe.y,He.y),je=Math.max(je,He.x+He.width),Re=Math.max(Re,He.y+He.height)):(Fe=Be,Fe.x=He.x,Fe.y=He.y,je=He.x+He.width,Re=He.y+He.height);return Fe&&(Fe.width=je-Fe.x,Fe.height=Re-Fe.y),Fe}function ze(Ce,Be,Fe,je,Re,He,Ie,Ge,Pe){let Le=(Ie&&He?ee(He,Be):Be)/2,Me=(Ie&&He?ee(He,Fe):Fe)/2;if(Pe){const qe=Pe[0],ot=Pe[1];Le=(Ie&&He?ee(He,qe):qe)/2,Me=(Ie&&He?ee(He,ot):ot)/2}const Ne=Ce.width+je,Xe=Ce.height+je,Ye=(0,Z.c)(),Je=(0,Z.c)();let rt=!1;if(Re&&0!==Ne&&0!==Xe){const qe=Be!==Fe?Be/Fe:Ne/Xe,ot=Be>Fe?Be:Fe;let ut=1,_t=1;isNaN(ot)||(qe>1?(ut=ot/Ne,_t=ot/qe/Xe):(_t=ot/Xe,ut=ot*qe/Ne)),(0,Q.m)(Je,Je,_e(Ye,ut,_t,Le,Me)),rt=!0}const tt=Ce.x+(Ne-je)/2,et=Ce.y+(Xe-je)/2;if((0,Q.m)(Je,Je,ge(Ye,Le-tt,Me-et)),!rt&&(Ne>Be||Xe>Fe)){const qe=Ne/Be>Xe/Fe,ot=(qe?Be:Fe)/(qe?Ne:Xe);(0,Q.m)(Je,Je,_e(Ye,ot,ot,tt,et))}return He&&(0,Q.m)(Je,Je,function Ee(Ce,Be,Fe,je){const Re=Be%360*Math.PI/180;(0,Q.r)(Ce,(0,Q.i)(Ce),Re);const He=Math.cos(Re),Ie=Math.sin(Re),Ge=Ce[4],Pe=Ce[5];return Ce[4]=Ge*He-Pe*Ie+je*Ie-Fe*He+Fe,Ce[5]=Pe*He+Ge*Ie-Fe*Ie-je*He+je,Ce}(Ye,He,tt,et)),Ge&&(0,Q.m)(Je,Je,ge(Ye,Ge[0],Ge[1])),`matrix(${Je[0]},${Je[1]},${Je[2]},${Je[3]},${Je[4]},${Je[5]})`}function We(Ce,Be,Fe,je={}){const Re=[],He=[],Ie=++Y,Ge=function Ke(Ce,Be,Fe){const je=Ce?.effects.find(Le=>"bloom"===Le.type);if(!je)return null;const{strength:Re,radius:He}=je,Ie=Re>0?He:0,Ge=(Re+Ie)*Be,Pe=4*Re+1;return(0,W.u)("filter",{id:`bloom${Fe}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},(0,W.u)("feMorphology",{operator:"dilate",radius:(Re+.5*Ie)*(5**(Be/100)*(.4+Be/100)),in:"SourceGraphic",result:"dilate"}),(0,W.u)("feGaussianBlur",{in:"dilate",stdDeviation:Ge/25,result:"blur"}),(0,W.u)("feGaussianBlur",{in:"blur",stdDeviation:Ge/50,result:"intensityBlur"}),(0,W.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,W.u)("feFuncR",{type:"linear",slope:Pe}),(0,W.u)("feFuncG",{type:"linear",slope:Pe}),(0,W.u)("feFuncB",{type:"linear",slope:Pe})),(0,W.u)("feMerge",null,(0,W.u)("feMergeNode",{in:"intensityBlur"}),(0,W.u)("feMergeNode",{in:"intensityBrightness"}),(0,W.u)("feGaussianBlur",{stdDeviation:Re/10})))}(je.effectView,Be,Ie);let Pe=null;if(Ge){const Le=je.effectView?.effects.find(Ye=>"bloom"===Ye.type),Me=(Le.strength?Le.strength+Le.radius/2:0)/3,Xe=Fe+Fe*Me;Pe=[Math.max(Be+Be*Me,10),Math.max(Xe,10)]}for(let Le=0;Le<Ce.length;Le++){const Me=Ce[Le],Ne=[],Xe=[];let Ye=0,Je=0,rt=0;for(const qe of Me){const{shape:ot,fill:ut,stroke:_t,font:Ct,offset:vt}=qe;je.ignoreStrokeWidth||(Ye+=_t&&_t.width||0);const Lt=ce(ut),jt=ue(_t),$t="text"===ot.type?pe(ot,Ct):null;Re.push(he(Lt)),Ne.push(J(ot,Lt.fill,jt,$t)),Xe.push(ve(ot)),vt&&(Je+=vt[0],rt+=vt[1])}const tt=ze((0,G.s3)(xe(Xe)),Be,Fe,Ye,je.scale??!1,je.rotation,je.useRotationSize??!1,[Je,rt],Pe);let et=null;if(je.masking){const qe=`mask-${Le}`;Re.push(me(je.masking[Le],qe)),et=`url(#${qe})`}He.push(et?(0,W.u)("g",{mask:et},(0,W.u)("g",{transform:tt},Ne)):(0,W.u)("g",{transform:tt},Ne))}return je.useRotationSize&&je.rotation&&(Be=ee(je.rotation,Be),Fe=ee(je.rotation,Fe)),Ge&&((0,G.O3)(Pe),Be=Pe[0],Fe=Pe[1]),(0,W.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Be,height:Fe,style:"display: block;"},Ge,(0,W.u)("defs",null,Re),Ge?(0,W.u)("g",{filter:`url(#bloom${Ie})`},He):He)}},70137:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>le,q:()=>de});var D=v(20383),R=v(26584),G=v(12874),Z=v(69852),Q=v(52068),$=v(9436),W=v(57213),B=v(13546),H=v(88493),X=v(36687),te=v(89673),ae=v(35540),oe=v(22490);const le={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function de(se,re=le){if(!se)return{symbol:null};const{retainId:j=le.retainId,ignoreDrivers:Y=le.ignoreDrivers,hasLabelingContext:ee=le.hasLabelingContext,retainCIM:ie=le.retainCIM}=re;let J=null;if((0,D.dU)(se)||se instanceof G.Z)J=se.clone();else if("cim"===se.type){const ce=se.data?.symbol?.type;if("CIMPointSymbol"!==ce)return{error:new R.Z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${ce||"unknown"}' is unsupported in 3D`,{symbol:se})};J=ie?se.clone():Z.Z.fromCIMSymbol(se)}else if(se instanceof Q.Z)J=$.Z.fromSimpleLineSymbol(se);else if(se instanceof W.Z)J=Z.Z.fromSimpleMarkerSymbol(se);else if(se instanceof B.Z)J=Z.Z.fromPictureMarkerSymbol(se);else if(se instanceof H.Z)J=re.geometryType&&"mesh"===re.geometryType?X.Z.fromSimpleFillSymbol(se):te.Z.fromSimpleFillSymbol(se);else{if(!(se instanceof ae.Z))return{error:new R.Z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${se.type||se.declaredClass}' is unsupported in 3D`,{symbol:se})};J=ee?oe.Z.fromTextSymbol(se):Z.Z.fromTextSymbol(se)}if(j&&J&&"cim"!==J.type&&(J.id=se.id),Y&&(0,D.dU)(J))for(let ce=0;ce<J.symbolLayers.length;++ce)J.symbolLayers.getItemAt(ce)._ignoreDrivers=!0;return{symbol:J}}},43652:(nt,Ae,v)=>{"use strict";v.d(Ae,{$K:()=>Z,Hc:()=>H,KW:()=>X,Uz:()=>B,w2:()=>te}),v(8314);var R=v(28093),G=v(5548);function Z(ae,{isPrimitive:oe,width:le,depth:de,height:se}){const re=oe?10:1;if(null==le&&null==se&&null==de)return[re*ae[0],re*ae[1],re*ae[2]];const j=(0,R.f)(le,de,se);let Y;for(let ee=0;ee<3;ee++){const ie=j[ee];if(null!=ie){Y=ie/ae[ee];break}}for(let ee=0;ee<3;ee++)null==j[ee]&&(j[ee]=ae[ee]*Y);return j}const Q=(0,G.al)(-.5,-.5,-.5,.5,.5,.5),$=(0,G.al)(-.5,-.5,0,.5,.5,1),W=(0,G.al)(-.5,-.5,0,.5,.5,.5);function B(ae){switch(ae){case"sphere":case"cube":case"diamond":return Q;case"cylinder":case"cone":case"inverted-cone":return $;case"tetrahedron":return W;default:return}}const H=["butt","square","round"],X=[...H,"none"],te=["miter","bevel","round"]},50369:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ck:()=>$,JT:()=>G,Nj:()=>X,g6:()=>Z,vC:()=>Q,x0:()=>H});var D=v(21286),R=v(90912);const G=["none","underline","line-through"],Z=["normal","italic","oblique"],Q=["normal","lighter","bold","bolder"],$={type:Number,cast:te=>{const ae=(0,R.q9)(te);return 0===ae?1:(0,D.uZ)(ae,.1,4)},nonNullable:!0},H={type:["left","right","center"],nonNullable:!0},X={type:["baseline","top","middle","bottom"],nonNullable:!0}},29505:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z7:()=>G,f9:()=>Q,lt:()=>R});var D=v(21254);function R($){return null!=D.a[$]}function G($){return 1/(D.a[$]||1)}const Q=function Z(){const $=Object.keys(D.a);return $.sort(),$}()},69738:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ds:()=>W,KA:()=>$});var D=v(21726),R=v(29840);function Z(H,X){return function B(H){return!(null==H||"service"!==H.origin&&"portal-item"!==H.origin||"feature"!==H.layer?.type&&"stream"!==H.layer?.type)}(X)&&!(0,D.YP)(H)&&X?.layer?.parsedUrl?(0,D.v_)(X.layer.parsedUrl.path,"images",H):(0,R.f)(H,X)}const $={json:{read:{source:["imageData","url"],reader:function G(H,X,te){return X.imageData?(0,D._l)({mediaType:X.contentType||"image/png",isBase64:!0,data:X.imageData}):Z(X.url,te)}},write:{writer(H,X,te,ae){!function Q(H,X,te,ae){if((0,D.HK)(H)){const oe=(0,D.sJ)(H);if(!oe)return;X.contentType=oe.mediaType,X.imageData=oe.data,te&&te.imageData===X.imageData&&te.url&&(0,R.w)(te.url,X,"url",ae)}else(0,R.w)(H,X,"url",ae)}(H,X,this.source,ae)}}}},W={readOnly:!0,json:{read:{source:["imageData","url"],reader(H,X,te){const ae={};return X.imageData&&(ae.imageData=X.imageData),X.contentType&&(ae.contentType=X.contentType),X.url&&(ae.url=Z(X.url,te)),ae}}}}},86606:(nt,Ae,v)=>{"use strict";v.d(Ae,{BR:()=>Be,QL:()=>je,Y6:()=>de,YW:()=>se,_h:()=>j,e3:()=>We,nf:()=>re,tb:()=>ce,wJ:()=>Fe});var D=v(15861),R=v(91558),G=v(20383),Z=v(59213),Q=v(8314),$=v(62208),W=v(23841),B=v(28093),H=v(71149),X=v(74741),te=v(64830);const ae=/\/resource\/(.*?)\.svg$/,oe=new R.Z("white");function de(Re){if(!Re)return 0;if((0,G.dU)(Re)){const He=function le(Re){const He=Re.symbolLayers&&Re.symbolLayers.length;if(!He)return;const Ie=Re.symbolLayers.getItemAt(He-1);return"outline"in Ie?(0,$.U2)(Ie,"outline","size"):void 0}(Re);return(0,$.pC)(He)?He:0}return(0,W.Wz)((0,X.mx)(Re)?.width)}function se(Re){if((0,$.Wi)(Re)||!("symbolLayers"in Re)||(0,$.Wi)(Re.symbolLayers))return!1;switch(Re.type){case"point-3d":return Re.symbolLayers.some(He=>"object"===He.type);case"line-3d":return Re.symbolLayers.some(He=>"path"===He.type);case"polygon-3d":return Re.symbolLayers.some(He=>"object"===He.type||"extrude"===He.type);default:return!1}}function re(Re,He){const Ie=(0,$.s3)(He.resource).href;return!(0,Q.Z)("esri-canvas-svg-support")&&Re.styleOrigin&&ae.test(Ie)?Ie.replace(ae,"/resource/png/$1.png"):Ie}function j(Re,He){if(!Re)return null;let Ie=null;return(0,G.dU)(Re)?Ie=function Y(Re){const He=Re.symbolLayers;if(!He)return null;let Ie=null;return He.forEach(Ge=>{"object"===Ge.type&&null!=Ge.resource?.href||(Ie="water"===Ge.type?(0,$.Wg)(Ge.color):(0,$.pC)(Ge.material)?(0,$.Wg)(Ge.material.color):null)}),Ie?new R.Z(Ie):null}(Re):(0,G.cT)(Re)&&(Ie=Re.color?new R.Z(Re.color):null),Ie?ee(Ie,He):null}function ee(Re,He){if(null==He||null==Re)return Re;const Ie=Re.toRgba();return Ie[3]=Ie[3]*He,new R.Z(Ie)}function ce(Re,He,Ie){Re&&(He||null!=Ie)&&(He&&(He=new R.Z(He)),(0,G.dU)(Re)?function ie(Re,He,Ie){const Ge=Re.symbolLayers;if(!Ge)return;const Pe=Le=>{const Me=(0,$.pC)(Le)?Le:null;return ee(He=He??Me??(null!=Ie?oe:null),Ie)};Ge.forEach(Le=>{if("object"!==Le.type||null==Le.resource?.href||He)if("water"===Le.type)Le.color=Pe(Le.color);else{const Me=(0,$.pC)(Le.material)?Le.material.color:null,Ne=Pe(Me);(0,$.Wi)(Le.material)?Le.material=new te.b({color:Ne}):Le.material.color=Ne,null!=Ie&&"outline"in Le&&(0,$.pC)(Le.outline)&&(0,$.pC)(Le.outline.color)&&(Le.outline.color=ee(Le.outline.color,Ie))}})}(Re,He,Ie):(0,G.cT)(Re)&&function J(Re,He,Ie){(He=He??Re.color)&&(Re.color=ee(He,Ie)),null!=Ie&&"outline"in Re&&Re.outline&&Re.outline.color&&(Re.outline.color=ee(Re.outline.color,Ie))}(Re,He,Ie))}function ue(Re,He){return pe.apply(this,arguments)}function pe(){return pe=(0,D.Z)(function*(Re,He){const Ie=Re.symbolLayers;Ie&&(yield(0,Z.Ed)(Ie,function(){var Ge=(0,D.Z)(function*(Pe){return he(Pe,He)});return function(Pe){return Ge.apply(this,arguments)}}()))}),pe.apply(this,arguments)}function he(Re,He){return me.apply(this,arguments)}function me(){return(me=(0,D.Z)(function*(Re,He){switch(Re.type){case"extrude":Ee(Re,He);break;case"icon":case"line":case"text":ge(Re,He);break;case"path":Se(Re,He);break;case"object":yield De(Re,He)}})).apply(this,arguments)}function ge(Re,He){const Ie=_e(He);(0,$.pC)(Ie)&&(Re.size=Ie)}function _e(Re){for(const He of Re)if("number"==typeof He)return He;return null}function Ee(Re,He){Re.size="number"==typeof He[2]?He[2]:0}function De(Re,He){return be.apply(this,arguments)}function be(){return(be=(0,D.Z)(function*(Re,He){const{resourceSize:Ie,symbolSize:Ge}=yield ve(Re),Pe=ye(He,Ie,Ge);Re.width=ze(He[0],Ge[0],Ie[0],Pe),Re.depth=ze(He[1],Ge[1],Ie[1],Pe),Re.height=ze(He[2],Ge[2],Ie[2],Pe)})).apply(this,arguments)}function Se(Re,He){const Ie=ye(He,B.O,[Re.width,void 0,Re.height]);Re.width=ze(He[0],Re.width,1,Ie),Re.height=ze(He[2],Re.height,1,Ie)}function ye(Re,He,Ie){for(let Ge=0;Ge<3;Ge++){const Pe=Re[Ge];switch(Pe){case"symbol-value":{const Le=Ie[Ge];return null!=Le?Le/He[Ge]:1}case"proportional":break;default:if(Pe&&He[Ge])return Pe/He[Ge]}}return 1}function ve(Re){return xe.apply(this,arguments)}function xe(){return(xe=(0,D.Z)(function*(Re){const He=yield v.e(1831).then(v.bind(v,91831)),Ie=yield He.computeObjectLayerResourceSize(Re,10),{width:Ge,height:Pe,depth:Le}=Re,Me=[Ge,Le,Pe];let Ne=1;for(let Xe=0;Xe<3;Xe++){const Ye=Me[Xe];if(null!=Ye){Ne=Ye/Ie[Xe];break}}for(let Xe=0;Xe<3;Xe++)null==Me[Xe]&&(Me[Xe]=Ie[Xe]*Ne);return{resourceSize:Ie,symbolSize:Me}})).apply(this,arguments)}function ze(Re,He,Ie,Ge){switch(Re){case"proportional":return Ie*Ge;case"symbol-value":return He??Ie;default:return Re}}function Ke(Re,He){const Ie=_e(He);if(!(0,$.Wi)(Ie))switch(Re.type){case"simple-marker":Re.size=Ie;break;case"picture-marker":{const Ge=Re.width/Re.height;Ge>1?(Re.width=Ie,Re.height=Ie*Ge):(Re.width=Ie*Ge,Re.height=Ie);break}case"simple-line":Re.width=Ie;break;case"text":Re.font.size=Ie}}function We(Re,He){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,D.Z)(function*(Re,He){if(Re&&He)return(0,G.dU)(Re)?ue(Re,He):void((0,G.cT)(Re)&&Ke(Re,He))})).apply(this,arguments)}function Be(Re,He,Ie){if(Re&&null!=He)if((0,G.dU)(Re)){const Ge=Re.symbolLayers;Ge&&Ge.forEach(Pe=>{if(Pe&&"object"===Pe.type)switch(Ie){case"tilt":Pe.tilt=He;break;case"roll":Pe.roll=He;break;default:Pe.heading=He}})}else(0,G.cT)(Re)&&("simple-marker"!==Re.type&&"picture-marker"!==Re.type&&"text"!==Re.type||(Re.angle=He))}function Fe(Re){if(!Re)return null;const He=Re.effects.filter(Ie=>"bloom"!==Ie.type).map(Ie=>Ie.toJSON());return(0,H.rM)(He)}function je(Re){return(0,$.pC)(Re)&&"polygon-3d"===Re.type&&Re.symbolLayers.some(He=>"extrude"===He.type)}},50998:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{fetchSymbolFromStyle:()=>oe,resolveWebStyleSymbol:()=>ae});var D=v(20383),R=v(83100),G=v(26584),Z=v(62208),Q=v(21726),$=v(84687),W=v(29840),B=v(9461),H=v(77345),X=v(71937),te=v(96296);function ae(de,se,re,j){return de.name?de.styleName&&"Esri2DPointSymbolsStyle"===de.styleName?function le(de,se,re){const j=X.wm.replace(/\{SymbolName\}/gi,de.name),Y=(0,Z.pC)(se.portal)?se.portal:$.Z.getDefault();return(0,X.EJ)(j,re).then(ee=>{const ie=(0,X.KV)(ee.data);return(0,B.im)(ie,{portal:Y,url:(0,Q.mN)((0,Q.Yd)(j)),origin:"portal-item"})})}(de,se,j):(0,X.n2)(de,se,j).then(Y=>oe((0,Z.s3)(Y),de.name,se,re,j)):Promise.reject(new G.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function oe(de,se,re,j,Y){const ee=de.data,ie=re&&(0,Z.pC)(re.portal)?re.portal:$.Z.getDefault(),J={portal:ie,url:(0,Q.mN)(de.baseUrl),origin:"portal-item"},ce=ee.items.find(ge=>ge.name===se);if(!ce)return Promise.reject(new G.Z("symbolstyleutils:symbol-name-not-found",`The symbol name '${se}' could not be found`,{symbolName:se}));let ue=(0,W.f)((0,X.v9)(ce,j),J),pe=ce.thumbnail?.href??null;const he=ce.thumbnail&&ce.thumbnail.imageData;(0,R.XO)()&&(ue=(0,R.pJ)(ue)??"",pe=(0,R.pJ)(pe));const me={portal:ie,url:(0,Q.mN)((0,Q.Yd)(ue)),origin:"portal-item"};return(0,X.EJ)(ue,Y).then(ge=>{const _e="cimRef"===j?(0,X.KV)(ge.data):ge.data,Ee=(0,B.im)(_e,me);if(Ee&&(0,D.dU)(Ee)){if(pe){const De=(0,W.f)(pe,J);Ee.thumbnail=new te.p({url:De})}else he&&(Ee.thumbnail=new te.p({url:`data:image/png;base64,${he}`}));de.styleUrl?Ee.styleOrigin=new H.Z({portal:re.portal,styleUrl:de.styleUrl,name:se}):de.styleName&&(Ee.styleOrigin=new H.Z({portal:re.portal,styleName:de.styleName,name:se}))}return Ee})}},39236:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Q});var D=v(26584),R=v(63290),G=v(62208),Z=v(7848);function Q(H,X,te,ae,oe){if((0,G.Wi)(H))return null;const le=H.referencesGeometry()&&oe?function W(H,X,te){const{transform:ae,hasZ:oe,hasM:le}=te;$.has(X)||$.set(X,function B(H){const X={};switch(H){case"esriGeometryPoint":return(te,ae,oe,le)=>(0,Z.U1)(ae,X,te,oe,le);case"esriGeometryPolygon":return(te,ae,oe,le)=>(0,Z.Ie)(ae,X,te,oe,le);case"esriGeometryPolyline":return(te,ae,oe,le)=>(0,Z.G6)(ae,X,te,oe,le);case"esriGeometryMultipoint":return(te,ae,oe,le)=>(0,Z.J9)(ae,X,te,oe,le);default:return R.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new D.Z("mapview-arcade",`Unable to handle geometryType: ${H}`)),te=>te}}(X));const de=$.get(X)(H.geometry,ae,oe,le);return{...H,geometry:de}}(X,ae,oe):X,de=H.repurposeFeature(le);try{return H.evaluate({...te,$feature:de})}catch(se){return R.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",se),null}}const $=new Map},62449:(nt,Ae,v)=>{"use strict";var D,R,G;v.d(Ae,{H:()=>R,U:()=>D}),(G=D||(D={}))[G.Stretch=0]="Stretch",G[G.Lut=1]="Lut",G[G.Hillshade=2]="Hillshade",G[G.COUNT=3]="COUNT",function(G){G[G.Noop=0]="Noop",G[G.PerBand=1]="PerBand",G[G.COUNT=2]="COUNT"}(R||(R={}))},54540:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>J,K:()=>ue});var D=v(62208),R=v(30217),G=v(49966),Z=v(919),Q=v(76763),$=v(83994),W=v(67969),B=v(49353);class H{constructor(he,me){this.layerUIDs=[],this.isDestroyed=!1,this._data=he,this.memoryUsed=he.byteLength;let ge=1;const _e=new Uint32Array(he);this.layerUIDs=[];const Ee=_e[ge++];for(let De=0;De<Ee;De++)this.layerUIDs[De]=_e[ge++];this.bufferDataOffset=ge,me&&(this.layer=me.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return(0,D.Wi)(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(he){(0,D.Wi)(this._data)||(this.doPrepareForRendering(he,this._data,this.bufferDataOffset),this._data=null)}}class X extends H{constructor(he,me){super(he,me),this.type=Z.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const ge=new Uint32Array(he);let _e=this.bufferDataOffset;this.lineIndexStart=ge[_e++],this.lineIndexCount=ge[_e++];const Ee=ge[_e++];if(Ee>0){const De=new Map;for(let be=0;be<Ee;be++){const Se=ge[_e++],ye=ge[_e++],ve=ge[_e++];De.set(Se,[ye,ve])}this.patternMap=De}this.bufferDataOffset=_e}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){(0,D.pC)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,D.pC)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,D.pC)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(he,me,ge){const _e=new Uint32Array(me),Ee=new Int32Array(_e.buffer),De=_e[ge++];this.lineVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,De)),ge+=De;const be=_e[ge++];this.lineIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,be)),ge+=be;const Se=this.layer.lineMaterial;this.lineVertexArrayObject=new B.U(he,Se.getAttributeLocations(),Se.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class te extends H{constructor(he,me){super(he,me),this.type=Z.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const ge=new Uint32Array(he);let _e=this.bufferDataOffset;this.fillIndexStart=ge[_e++],this.fillIndexCount=ge[_e++],this.outlineIndexStart=ge[_e++],this.outlineIndexCount=ge[_e++];const Ee=ge[_e++];if(Ee>0){const De=new Map;for(let be=0;be<Ee;be++){const Se=ge[_e++],ye=ge[_e++],ve=ge[_e++];De.set(Se,[ye,ve])}this.patternMap=De}this.bufferDataOffset=_e}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){(0,D.pC)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,D.pC)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,D.pC)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,D.pC)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,D.pC)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,D.pC)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(he,me,ge){const _e=new Uint32Array(me),Ee=new Int32Array(_e.buffer),De=_e[ge++];this.fillVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,De)),ge+=De;const be=_e[ge++];this.fillIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,be)),ge+=be;const Se=_e[ge++];this.outlineVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,Se)),ge+=Se;const ye=_e[ge++];this.outlineIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,ye)),ge+=ye;const ve=this.layer,xe=ve.fillMaterial,ze=ve.outlineMaterial;this.fillVertexArrayObject=new B.U(he,xe.getAttributeLocations(),xe.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new B.U(he,ze.getAttributeLocations(),ze.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class ae extends H{constructor(he,me,ge){super(he,me),this.type=Z.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const _e=new Uint32Array(he),Ee=new Int32Array(he),De=new Float32Array(he);let be=this.bufferDataOffset;this.isIconSDF=!!_e[be++];const Se=_e[be++];for(let ze=0;ze<Se;ze++){const Ke=_e[be++],We=_e[be++],Ce=_e[be++];this.iconPerPageElementsMap.set(Ke,[We,Ce])}const ye=_e[be++];for(let ze=0;ze<ye;ze++){const Ke=_e[be++],We=_e[be++],Ce=_e[be++];this.glyphPerPageElementsMap.set(Ke,[We,Ce])}const ve=_e[be++],xe=_e[be++];this.iconOpacity=new Int32Array(ve),this.textOpacity=new Int32Array(xe),be=(0,Q.wB)(_e,Ee,De,be,this.symbols,ge),this.bufferDataOffset=be}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let he=0;for(const[me,ge]of this.iconPerPageElementsMap)he+=ge[1];for(const[me,ge]of this.glyphPerPageElementsMap)he+=ge[1];return he/3}doDestroy(){(0,D.pC)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,D.pC)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,D.pC)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,D.pC)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,D.pC)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,D.pC)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,D.pC)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,D.pC)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const he=(0,D.Wg)(this.iconOpacity),me=(0,D.Wg)(this.iconOpacityBuffer);he.length>0&&he.byteLength===me.size&&me.setSubData(he,0,0,he.length);const ge=(0,D.Wg)(this.textOpacity),_e=(0,D.Wg)(this.textOpacityBuffer);ge.length>0&&ge.byteLength===_e.size&&_e.setSubData(ge,0,0,ge.length)}doPrepareForRendering(he,me,ge){const _e=new Uint32Array(me),Ee=new Int32Array(_e.buffer),De=_e[ge++];this.iconVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,De)),ge+=De;const be=_e[ge++];this.iconIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,be)),ge+=be;const Se=_e[ge++];this.textVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,Se)),ge+=Se;const ye=_e[ge++];this.textIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,ye)),ge+=ye,this.iconOpacityBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,(0,D.Wg)(this.iconOpacity).buffer),this.textOpacityBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,(0,D.Wg)(this.textOpacity).buffer);const ve=this.layer,xe=ve.iconMaterial,ze=ve.textMaterial;this.iconVertexArrayObject=new B.U(he,xe.getAttributeLocations(),xe.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new B.U(he,ze.getAttributeLocations(),ze.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class oe extends H{constructor(he,me){super(he,me),this.type=Z.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const ge=new Uint32Array(he);let _e=this.bufferDataOffset;this.circleIndexStart=ge[_e++],this.circleIndexCount=ge[_e++],this.bufferDataOffset=_e}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){(0,D.pC)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,D.pC)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,D.pC)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(he,me,ge){const _e=new Uint32Array(me),Ee=new Int32Array(_e.buffer),De=_e[ge++];this.circleVertexBuffer=$.f.createVertex(he,W.l1.STATIC_DRAW,new Int32Array(Ee.buffer,4*ge,De)),ge+=De;const be=_e[ge++];this.circleIndexBuffer=$.f.createIndex(he,W.l1.STATIC_DRAW,new Uint32Array(_e.buffer,4*ge,be)),ge+=be;const Se=this.layer.circleMaterial;this.circleVertexArrayObject=new B.U(he,Se.getAttributeLocations(),Se.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var le=v(47132),de=v(61885),se=v(8314),re=v(10699);const j=1/(0,se.Z)("mapview-transitions-duration");class Y extends de.Z{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(he){this._clips=he,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(he){this._opacity!==he&&(this._opacity=Math.min(1,Math.max(he,0)),this.requestRender())}get stage(){return this._stage}set stage(he){if(this._stage===he)return;const me=this._stage;this._stage=he,he?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):me.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return(0,D.Wi)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(he){this._visible!==he&&(this._visible=he,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,re.hh)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,re.hh)(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(he){this.updateTransitionProperties(he.deltaTime,he.state.scale)}afterRender(he){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(he){}processRender(he){this.stage&&this.computedVisible&&this.doRender(he)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(he,me){if(this.fadeTransitionEnabled){const ge=this._fadeOutResolver||!this.visible?0:this.opacity,_e=this.computedOpacity;if(_e===ge)this.computedVisible=this.visible;else{const Ee=he*j;this.computedOpacity=_e>ge?Math.max(ge,_e-Ee):Math.min(ge,_e+Ee),this.computedVisible=this.computedOpacity>0;const De=ge===this.computedOpacity;this.inFadeTransition=!De,De||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(he){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}var ee=v(58098);class ie extends Y{constructor(he,me,ge,_e,Ee,De,be=Ee,Se=De){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new ee.Z(he),this.resolution=me,this.x=ge,this.y=_e,this.width=Ee,this.height=De,this.rangeX=be,this.rangeY=Se}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(he){const me=this.resolution/(he.resolution*he.pixelRatio),ge=this.transforms.tileMat3,[_e,Ee]=he.toScreenNoRotation([0,0],[this.x,this.y]);(0,R.s)(ge,this.width/this.rangeX*me,0,0,0,this.height/this.rangeY*me,0,_e,Ee,1),(0,R.m)(this.transforms.dvs,he.displayViewMat3,ge)}}class J extends ie{constructor(he,me,ge,_e,Ee,De,be,Se=null){super(he,me,ge,_e,Ee,De,4096,4096),this._memCache=Se,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=be,this.id=he.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<le.nN}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<le.nN)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(he){this.changeDataImpl(he),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(he){let me=!1;for(const ge of he)if(this.layerData.has(ge)){const _e=this.layerData.get(ge);this._memoryUsedByLayerData-=_e.memoryUsed,_e.type===Z.al.SYMBOL&&this.symbols.has(ge)&&(this.symbols.delete(ge),me=!0),_e.destroy(),this.layerData.delete(ge),this.layerCount--}(0,D.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),me&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(ce.delete(this),J._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(he){let me=!1;if(he){const{bucketsWithData:ge,emptyBuckets:_e}=he,Ee=this._createRenderBuckets(ge);if(_e&&_e.byteLength>0){const De=new Uint32Array(_e);for(const be of De)this._deleteLayerData(be)}for(const[De,be]of Ee)this._deleteLayerData(De),be.type===Z.al.SYMBOL&&(this.symbols.set(De,be.symbols),me=!0),this._memoryUsedByLayerData+=be.memoryUsed,this.layerData.set(De,be),this.layerCount++;(0,D.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[ge,_e]of this.layerData)_e.type===Z.al.SYMBOL&&(this._hasSymbolBuckets=!0);me&&this.emit("symbols-changed")}attachWithContext(he){this.stage={context:he,trashDisplayObject(me){me.processDetach()},untrashDisplayObject:()=>!1}}setTransform(he){super.setTransform(he);const me=this.resolution/(he.resolution*he.pixelRatio),ge=this.width/this.rangeX*me,_e=this.height/this.rangeY*me,Ee=[0,0];he.toScreen(Ee,[this.x,this.y]);const De=this.transforms.tileUnitsToPixels;(0,R.g)(De),(0,R.h)(De,De,Ee),(0,R.r)(De,De,Math.PI*he.rotation/180),(0,R.d)(De,De,[ge,_e,1])}_createTransforms(){return{dvs:(0,G.c)(),tileMat3:(0,G.c)(),tileUnitsToPixels:(0,G.c)()}}static _destroyRenderBuckets(he){if(!he)return;const me=new Set;he.forEach(ge=>{me.has(ge)||(ge.destroy(),me.add(ge))}),he.clear()}_createRenderBuckets(he){const me=new Map,ge=new Map;for(const _e of he){const Ee=this._deserializeBucket(_e,ge);for(const De of Ee.layerUIDs)me.set(De,Ee)}return me}_deserializeBucket(he,me){let ge=me.get(he);if(ge)return ge;switch(new Uint32Array(he)[0]){case Z.al.FILL:ge=new te(he,this.styleRepository);break;case Z.al.LINE:ge=new X(he,this.styleRepository);break;case Z.al.SYMBOL:ge=new ae(he,this.styleRepository,this);break;case Z.al.CIRCLE:ge=new oe(he,this.styleRepository)}return me.set(he,ge),ge}_deleteLayerData(he){if(!this.layerData.has(he))return;const me=this.layerData.get(he);this._memoryUsedByLayerData-=me.memoryUsed,me.destroy(),this.layerData.delete(he),this.layerCount--}}const ce=new Map;function ue(){ce.forEach((pe,he)=>{console.log(`\n${he.key}:`),pe[0].forEach(me=>console.log(me)),console.log("========"),pe[1].forEach(me=>console.log(me))})}},47132:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bf:()=>D,PF:()=>R,nN:()=>Z});const D=!0,R=32,Z=200},51200:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>R,a:()=>D});class D{constructor(Z){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=Z}}class R{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},76763:(nt,Ae,v)=>{"use strict";v.d(Ae,{C$:()=>B,HX:()=>$,co:()=>Q,wB:()=>W});var D=v(919),R=v(51200);function Q(X,te,ae,oe,le,de){const se=ae-le;if(se>=0)return(te>>se)+(oe-(de<<se))*(X>>se);const re=-se;return te-(de-(oe<<re))*(X>>re)<<re}class ${constructor(te,ae,oe){this._rows=Math.ceil(ae/oe),this._columns=Math.ceil(te/oe),this._cellSize=oe,this.cells=new Array(this._rows);for(let le=0;le<this._rows;le++){this.cells[le]=new Array(this._columns);for(let de=0;de<this._columns;de++)this.cells[le][de]=[]}}getCell(te,ae){const oe=Math.min(Math.max(Math.floor(ae/this._cellSize),0),this._rows-1),le=Math.min(Math.max(Math.floor(te/this._cellSize),0),this._columns-1);return this.cells[oe]&&this.cells[oe][le]||null}getCellSpan(te,ae,oe,le){return[Math.min(Math.max(Math.floor(te/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(ae/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(oe/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(le/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function W(X,te,ae,oe,le,de){const se=te[oe++];for(let re=0;re<se;re++){const j=new R.a(de);j.xTile=te[oe++],j.yTile=te[oe++],j.hash=te[oe++],j.priority=te[oe++];const Y=te[oe++];for(let J=0;J<Y;J++){const ce=te[oe++],ue=te[oe++],pe=te[oe++],he=te[oe++],me=!!te[oe++],ge=te[oe++],_e=ae[oe++],Ee=ae[oe++],De=te[oe++],be=te[oe++];j.colliders.push({xTile:ce,yTile:ue,dxPixels:pe,dyPixels:he,hard:me,partIndex:ge,width:De,height:be,minLod:_e,maxLod:Ee})}const ee=X[oe++];for(let J=0;J<ee;J++)j.textVertexRanges.push([X[oe++],X[oe++]]);const ie=X[oe++];for(let J=0;J<ie;J++)j.iconVertexRanges.push([X[oe++],X[oe++]]);le.push(j)}return oe}function B(X,te,ae){for(const[oe,le]of X.symbols)H(X,te,ae,le,oe)}function H(X,te,ae,oe,le){const de=X.layerData.get(le);if(de.type===D.al.SYMBOL){for(const se of oe){const re=se.unique;let j;if(se.selectedForRendering){const Y=re.parts[0],ee=Y.startOpacity,ie=Y.targetOpacity;X.allSymbolsFadingOut=X.allSymbolsFadingOut&&0===ie;const J=ae?Math.floor(127*ee)|ie<<7:ie?255:0;j=J<<24|J<<16|J<<8|J}else j=0;for(const[Y,ee]of se.iconVertexRanges)for(let ie=Y;ie<Y+ee;ie+=4)de.iconOpacity[ie/4]=j;if(se.selectedForRendering){const Y=re.parts[1],ee=Y.startOpacity,ie=Y.targetOpacity;X.allSymbolsFadingOut=X.allSymbolsFadingOut&&0===ie;const J=ae?Math.floor(127*ee)|ie<<7:ie?255:0;j=J<<24|J<<16|J<<8|J}else j=0;for(const[Y,ee]of se.textVertexRanges)for(let ie=Y;ie<Y+ee;ie+=4)de.textOpacity[ie/4]=j}de.lastOpacityUpdate=te,de.opacityChanged=!0}}},919:(nt,Ae,v)=>{"use strict";var D,R,G,Z,Q,$;v.d(Ae,{Fr:()=>Q,_K:()=>Z,al:()=>R}),($=D||(D={}))[$.UNKNOWN=0]="UNKNOWN",$[$.FILL_VERTEX=1]="FILL_VERTEX",$[$.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",$[$.FILL_INDEX=3]="FILL_INDEX",$[$.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",$[$.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",$[$.OUTLINE_INDEX=6]="OUTLINE_INDEX",$[$.LINE_VERTEX=7]="LINE_VERTEX",$[$.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",$[$.LINE_INDEX=9]="LINE_INDEX",$[$.ICON_VERTEX=10]="ICON_VERTEX",$[$.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",$[$.ICON_INDEX=12]="ICON_INDEX",$[$.TEXT_VERTEX=13]="TEXT_VERTEX",$[$.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",$[$.TEXT_INDEX=15]="TEXT_INDEX",$[$.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",$[$.CIRCLE_INDEX=17]="CIRCLE_INDEX",function($){$[$.FILL=1]="FILL",$[$.LINE=2]="LINE",$[$.SYMBOL=3]="SYMBOL",$[$.CIRCLE=4]="CIRCLE"}(R||(R={})),function($){$[$.BACKGROUND=0]="BACKGROUND",$[$.OPAQUE=1]="OPAQUE",$[$.TRANSLUCENT=2]="TRANSLUCENT",$[$.SYMBOLS=3]="SYMBOLS",$[$.HITTEST=4]="HITTEST"}(G||(G={})),function($){$[$.BACKGROUND=0]="BACKGROUND",$[$.FILL=1]="FILL",$[$.OUTLINE=2]="OUTLINE",$[$.LINE=3]="LINE",$[$.ICON=4]="ICON",$[$.CIRCLE=5]="CIRCLE",$[$.TEXT=6]="TEXT",$[$.TILEINFO=7]="TILEINFO"}(Z||(Z={})),function($){$[$.PAINTER_CHANGED=0]="PAINTER_CHANGED",$[$.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",$[$.LAYER_CHANGED=2]="LAYER_CHANGED",$[$.LAYER_REMOVED=3]="LAYER_REMOVED",$[$.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Q||(Q={}))},58098:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(27899);class R{constructor(Z,Q,$,W){this.set(Z,Q,$,W)}static getId(Z,Q,$,W){return"object"==typeof Z?`${Z.level}/${Z.row}/${Z.col}/${Z.world}`:`${Z}/${Q}/${$}/${W}`}get key(){return this}get id(){return this.toString()}set id(Z){this.set(Z)}get hash(){return(3&this.world)<<30|(4095&this.col)<<22|(4095&this.row)<<8|63&this.level}acquire(Z,Q,$,W){this.set(Z,Q,$,W)}contains(Z){const Q=Z.level-this.level;return Q>=0&&this.row===Z.row>>Q&&this.col===Z.col>>Q&&this.world===Z.world}equals(Z){return this.level===Z.level&&this.row===Z.row&&this.col===Z.col&&this.world===Z.world}clone(){return new R(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(Z,Q,$,W){if(null==Z)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof Z)this.level=Z.level||0,this.row=Z.row||0,this.col=Z.col||0,this.world=Z.world||0;else if("string"==typeof Z){const[B,H,X,te]=Z.split("/");this.level=parseFloat(B),this.row=parseFloat(H),this.col=parseFloat(X),this.world=parseFloat(te)}else this.level=+Z,this.row=+Q,this.col=+$,this.world=+W||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new R(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const Z=this.level+1,Q=this.row<<1,$=this.col<<1,W=this.world;return[new R(Z,Q,$,W),new R(Z,Q,$+1,W),new R(Z,Q+1,$,W),new R(Z,Q+1,$+1,W)]}compareRowMajor(Z){return this.row<Z.row?-1:this.row>Z.row?1:this.col<Z.col?-1:this.col>Z.col?1:0}}R.pool=new D.Z(R,null,null,25,50)},12015:(nt,Ae,v)=>{"use strict";v.d(Ae,{YF:()=>Q,co:()=>$,hZ:()=>W,ii:()=>Z});var Q,$,W,H,D=v(43703),R=v(28093),G=v(75583);class Z{constructor(){this.readChannels=G.uz.RG,this.renderingStage=G.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,R.c)(),this.isCameraPositionFinal=!0,this.parallax=new B,this.parallaxNew=new B,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:$.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Q.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:W.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===$.FADE_OUT||this.fadeInOut.stage===$.FADE_IN||this.fadeIn.stage===Q.FADE_IN||this.fadeInOutHeight.stage!==W.FINISHED||this.renderingStage===G.jL.FADING_TEXTURE_CHANNELS}}(H=Q||(Q={}))[H.FINISHED=0]="FINISHED",H[H.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",H[H.FADE_IN=2]="FADE_IN",function(H){H[H.FINISHED=0]="FINISHED",H[H.FADE_OUT=1]="FADE_OUT",H[H.SWITCH=2]="SWITCH",H[H.FADE_IN=3]="FADE_IN"}($||($={})),function(H){H[H.FINISHED=0]="FINISHED",H[H.HEIGHT_FADE=1]="HEIGHT_FADE"}(W||(W={}));class B{constructor(){this.anchorPointClouds=(0,R.c)(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=(0,D.c)()}}},75583:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ck:()=>Z,WU:()=>Q,jL:()=>R,uz:()=>G});var R,G,$,D=v(62208);function Z($){return(0,D.pC)($)&&(0,D.pC)($.cubeMap)}function Q($){return(0,D.pC)($)&&!$.running}($=R||(R={}))[$.RENDERING=0]="RENDERING",$[$.FINISHED_RENDERING=1]="FINISHED_RENDERING",$[$.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",$[$.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",$[$.FINISHED=4]="FINISHED",function($){$[$.RG=0]="RG",$[$.BA=1]="BA"}(G||(G={}))},85073:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>Z});var D=v(32849);class R{constructor($,W,B,H,X,te,ae,oe,le=.5){this.coverage=$,this.density=W,this.absorption=B,this.cloudSize=H,this.detailSize=X,this.smoothness=te,this.cloudHeight=ae,this.raymarchingSteps=oe,this.median=le}}const G=new R([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],D.p.SIXTEEN),Z={sunny:G,cloudy:new R([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],D.p.TWOHUNDRED,.6),rainy:new R([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],D.p.TWOHUNDRED,.4),snowy:new R([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],D.p.HUNDRED,.65),foggy:new R([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],D.p.SIXTEEN),default:G}},32849:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>Q,t:()=>$});var Q,W,D=v(17626),R=v(8314),G=v(75583),Z=v(87601);(W=Q||(Q={}))[W.SIXTEEN=0]="SIXTEEN",W[W.HUNDRED=1]="HUNDRED",W[W.TWOHUNDRED=2]="TWOHUNDRED",W[W.COUNT=3]="COUNT";class $ extends Z.m{constructor(){super(...arguments),this.steps=Q.SIXTEEN,this.writeTextureChannels=G.uz.RG}}(0,D._)([(0,Z.o)({count:Q.COUNT})],$.prototype,"steps",void 0),(0,D._)([(0,Z.o)({constValue:(0,R.Z)("esri-mobile")?1024:2048})],$.prototype,"cubeMapSize",void 0),(0,D._)([(0,Z.o)()],$.prototype,"writeTextureChannels",void 0)},64312:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>Z,u:()=>G});var G,Q,D=v(17626),R=v(87601);(Q=G||(G={}))[Q.Full=0]="Full",Q[Q.WeatherMap=1]="WeatherMap",Q[Q.COUNT=2]="COUNT";class Z extends R.m{constructor(){super(...arguments),this.mode=G.Full}}(0,D._)([(0,R.o)({count:G.COUNT})],Z.prototype,"mode",void 0)},85755:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>W,IQ:()=>Q,I_:()=>R,QZ:()=>B,iZ:()=>$,jy:()=>Z,kR:()=>G});const R=(0,v(8314).Z)("esri-mobile")?64:128,G=R/128,Z=Math.ceil(Math.sqrt(R)),Q=(R+2)*Z,$=1e5,W=128,B=Q/1560},6067:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>G,Y:()=>Z});var G,Q,D=v(17626),R=v(87601);(Q=G||(G={}))[Q.Rain=0]="Rain",Q[Q.Snow=1]="Snow",Q[Q.COUNT=2]="COUNT";class Z extends R.m{constructor(){super(...arguments),this.type=G.Rain}}(0,D._)([(0,R.o)({count:G.COUNT})],Z.prototype,"type",void 0)},49115:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>Q,n:()=>Z});var Z,$,D=v(17626),R=v(87601),G=v(41528);($=Z||(Z={}))[$.Cone=0]="Cone",$[$.Cylinder=1]="Cylinder",$[$.Underground=2]="Underground",$[$.COUNT=3]="COUNT";class Q extends G.W{constructor(){super(...arguments),this.geometry=Z.Cone}}(0,D._)([(0,R.o)({count:Z.COUNT})],Q.prototype,"geometry",void 0)},61343:(nt,Ae,v)=>{"use strict";function D(Q){return Math.min(1,Math.max(0,(Q-1e5)/9e5))}v.d(Ae,{TR:()=>G,Tk:()=>R,k8:()=>Z,yx:()=>D});const R=1e4,G=.085,Z=1e5},9160:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>B});var D=v(15861),R=v(84792),G=v(59213),Z=v(26584),Q=v(62208),$=v(10699),W=v(21726);class B{constructor(te){this._streamDataRequester=te}loadJSON(te,ae){var oe=this;return(0,D.Z)(function*(){return oe._load("json",te,ae)})()}loadBinary(te,ae){var oe=this;return(0,D.Z)(function*(){return(0,W.HK)(te)?((0,$.k_)(ae),(0,W.AH)(te)):oe._load("binary",te,ae)})()}loadImage(te,ae){var oe=this;return(0,D.Z)(function*(){return oe._load("image",te,ae)})()}_load(te,ae,oe){var le=this;return(0,D.Z)(function*(){if((0,Q.Wi)(le._streamDataRequester))return(yield(0,R.default)(ae,{responseType:H[te]})).data;const de=yield(0,G.q6)(le._streamDataRequester.request(ae,te,oe));if(!0===de.ok)return de.value;throw(0,$.r9)(de.error),new Z.Z("",`Request for resource failed: ${de.error}`)})()}}const H={image:"image",binary:"array-buffer",json:"json"}},98496:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>Q});var D=v(62208),R=v(49966),G=v(9545),Z=v(30217);function Q($){if((0,D.Wi)($))return null;const W=(0,D.pC)($.offset)?$.offset:G.Z,B=(0,D.pC)($.rotation)?$.rotation:0,H=(0,D.pC)($.scale)?$.scale:G.O,X=(0,R.f)(1,0,0,0,1,0,W[0],W[1],1),te=(0,R.f)(Math.cos(B),-Math.sin(B),0,Math.sin(B),Math.cos(B),0,0,0,1),ae=(0,R.f)(H[0],0,0,0,H[1],0,0,0,1),oe=(0,R.c)();return(0,Z.m)(oe,te,ae),(0,Z.m)(oe,X,oe),oe}},96170:(nt,Ae,v)=>{"use strict";v.d(Ae,{DA:()=>Z,jX:()=>Q,nh:()=>G});var D=v(55713),R=v(37187);function G($,W=R.p){return"number"==typeof $?W($):(0,D.Uc)($)||(0,D.lq)($)?new Uint32Array($):$}function Z($){const W="number"==typeof $?$:$.length;if(W<3)return[];const B=W-2,H=(0,R.$z)(B);if("number"==typeof $){let X=0;for(let te=0;te<B;te+=1)te%2==0?(H[X++]=te,H[X++]=te+1,H[X++]=te+2):(H[X++]=te+1,H[X++]=te,H[X++]=te+2)}else{let X=0;for(let te=0;te<B;te+=1)if(te%2==0){const oe=$[te+1],le=$[te+2];H[X++]=$[te],H[X++]=oe,H[X++]=le}else{const oe=$[te],le=$[te+2];H[X++]=$[te+1],H[X++]=oe,H[X++]=le}}return H}function Q($){const W="number"==typeof $?$:$.length;if(W<3)return new Uint16Array(0);const B=W-2,H=B<=65536?new Uint16Array(3*B):new Uint32Array(3*B);if("number"==typeof $){let X=0;for(let te=0;te<B;++te)H[X++]=0,H[X++]=te+1,H[X++]=te+2;return H}{const X=$[0];let te=$[1],ae=0;for(let oe=0;oe<B;++oe){const le=$[oe+2];H[ae++]=X,H[ae++]=te,H[ae++]=le,te=le}return H}}},93831:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>Re});var ee,ie,Ye,D=v(15861),R=v(62208),G=v(43703),Z=v(26584),Q=v(63290),W=v(67969),X=v(88159),te=v(10699),ae=v(21726),oe=v(10349),le=v(28347),de=v(48977),se=v(78451),re=v(60479),j=v(98148);class Y{constructor(Je){this._data=Je,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const Je=this._offset4;return this._offset4+=1,this._dataUint32[Je]}readUint8Array(Je){const rt=4*this._offset4;return this._offset4+=Je/4,new Uint8Array(this._data,rt,Je)}remainingBytes(){return this._data.byteLength-4*this._offset4}}(Ye=ee||(ee={})).SCALAR="SCALAR",Ye.VEC2="VEC2",Ye.VEC3="VEC3",Ye.VEC4="VEC4",Ye.MAT2="MAT2",Ye.MAT3="MAT3",Ye.MAT4="MAT4",function(Ye){Ye[Ye.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Ye[Ye.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ie||(ie={}));var J=v(94573);const ce={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},ue={pbrMetallicRoughness:ce,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},pe={ESRI_externalColorMixMode:"tint"},he=(Ye={})=>{const Je={...ce,...Ye.pbrMetallicRoughness},rt=function me(Ye){switch(Ye.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,J.Bg)(Ye.ESRI_externalColorMixMode),Ye.ESRI_externalColorMixMode="tint"}return Ye}({...pe,...Ye.extras});return{...ue,...Ye,pbrMetallicRoughness:Je,extras:rt}},ge={magFilter:W.cw.LINEAR,minFilter:W.cw.LINEAR_MIPMAP_LINEAR,wrapS:W.e8.REPEAT,wrapT:W.e8.REPEAT};class be{constructor(Je,rt,tt,et,qe){this._context=Je,this._errorContext=rt,this.uri=tt,this.json=et,this._glbBuffer=qe,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._baseUri=function Ee(Ye){let Je,rt;return Ye.replace(/^(.*\/)?([^/]*)$/,(tt,et,qe)=>(Je=et||"",rt=qe||"","")),{dirPart:Je,filePart:rt}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),rt.errorUnsupportedIf(null==et.scenes,"Scenes must be defined."),rt.errorUnsupportedIf(null==et.meshes,"Meshes must be defined"),rt.errorUnsupportedIf(null==et.nodes,"Nodes must be defined."),this._computeNodeParents()}static load(Je,rt,tt,et){var qe=this;return(0,D.Z)(function*(){if((0,ae.HK)(tt)){const _t=(0,ae.sJ)(tt);if(_t&&"model/gltf-binary"!==_t.mediaType)try{const vt=JSON.parse(_t.isBase64?atob(_t.data):_t.data);return new be(Je,rt,tt,vt)}catch{}const Ct=(0,ae.AH)(tt);if(be._isGLBData(Ct))return qe._fromGLBData(Je,rt,tt,Ct)}if(tt.endsWith(".gltf")){const _t=yield Je.loadJSON(tt,et);return new be(Je,rt,tt,_t)}const ot=yield Je.loadBinary(tt,et);if(be._isGLBData(ot))return qe._fromGLBData(Je,rt,tt,ot);const ut=yield Je.loadJSON(tt,et);return new be(Je,rt,tt,ut)})()}static _isGLBData(Je){if(null==Je)return!1;const rt=new Y(Je);return rt.remainingBytes()>=4&&1179937895===rt.readUint32()}static _fromGLBData(Je,rt,tt,et){return(0,D.Z)(function*(){const qe=yield be._parseGLBData(rt,et);return new be(Je,rt,tt,qe.json,qe.binaryData)})()}static _parseGLBData(Je,rt){return(0,D.Z)(function*(){const tt=new Y(rt);Je.assert(tt.remainingBytes()>=12,"GLB binary data is insufficiently large.");const et=tt.readUint32(),qe=tt.readUint32(),ot=tt.readUint32();Je.assert(1179937895===et,"Magic first 4 bytes do not fit to expected GLB value."),Je.assert(rt.byteLength>=ot,"GLB binary data is smaller than header specifies."),Je.errorUnsupportedIf(2!==qe,"An unsupported GLB container version was detected. Only version 2 is supported.");let ut,_t,Ct=0;for(;tt.remainingBytes()>=8;){const vt=tt.readUint32(),Lt=tt.readUint32();0===Ct?(Je.assert(1313821514===Lt,"First GLB chunk must be JSON."),Je.assert(vt>=0,"No JSON data found."),ut=yield We(tt.readUint8Array(vt))):1===Ct?(Je.errorUnsupportedIf(5130562!==Lt,"Second GLB chunk expected to be BIN."),_t=tt.readUint8Array(vt)):Je.warnUnsupported("More than 2 GLB chunks detected. Skipping."),Ct+=1}return ut||Je.error("No GLB JSON chunk detected."),{json:ut,binaryData:_t}})()}getBuffer(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt.json.buffers[Je],qe=tt._errorContext;if(null==et.uri)return qe.assert(null!=tt._glbBuffer,"GLB buffer not present"),tt._glbBuffer;const ot=yield tt._getBufferLoader(Je,rt);return qe.assert(ot.byteLength===et.byteLength,"Buffer byte lengths should match."),ot})()}_getBufferLoader(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._bufferLoaders.get(Je);if(et)return et;const ot=tt._context.loadBinary(tt._resolveUri(tt.json.buffers[Je].uri),rt).then(ut=>new Uint8Array(ut));return tt._bufferLoaders.set(Je,ot),ot})()}getAccessor(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.errorUnsupportedIf(!tt.json.accessors,"Accessors missing.");const qe=tt.json.accessors[Je];et.errorUnsupportedIf(null==qe?.bufferView,"Some accessor does not specify a bufferView."),et.errorUnsupportedIf(qe.type in[ee.MAT2,ee.MAT3,ee.MAT4],`AttributeType ${qe.type} is not supported`);const ot=tt.json.bufferViews[qe.bufferView],ut=yield tt.getBuffer(ot.buffer,rt),_t=xe[qe.type],Ct=ze[qe.componentType],vt=_t*Ct,Lt=ot.byteStride||vt;return{raw:ut.buffer,byteStride:Lt,byteOffset:ut.byteOffset+(ot.byteOffset||0)+(qe.byteOffset||0),entryCount:qe.count,isDenselyPacked:Lt===vt,componentCount:_t,componentByteSize:Ct,componentType:qe.componentType,min:qe.min,max:qe.max,normalized:!!qe.normalized}})()}getIndexData(Je,rt){var tt=this;return(0,D.Z)(function*(){if(null==Je.indices)return;const et=yield tt.getAccessor(Je.indices,rt);if(et.isDenselyPacked)switch(et.componentType){case W.g.UNSIGNED_BYTE:return new Uint8Array(et.raw,et.byteOffset,et.entryCount);case W.g.UNSIGNED_SHORT:return new Uint16Array(et.raw,et.byteOffset,et.entryCount);case W.g.UNSIGNED_INT:return new Uint32Array(et.raw,et.byteOffset,et.entryCount)}else switch(et.componentType){case W.g.UNSIGNED_BYTE:return(0,j.m)(tt._wrapAccessor(re.D_,et));case W.g.UNSIGNED_SHORT:return(0,j.m)(tt._wrapAccessor(re.av,et));case W.g.UNSIGNED_INT:return(0,j.m)(tt._wrapAccessor(re.Nu,et))}})()}getPositionData(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.errorUnsupportedIf(null==Je.attributes.POSITION,"No POSITION vertex data found.");const qe=yield tt.getAccessor(Je.attributes.POSITION,rt);return et.errorUnsupportedIf(qe.componentType!==W.g.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+W.g[qe.componentType]),et.errorUnsupportedIf(3!==qe.componentCount,"POSITION vertex attribute must have 3 components, but found "+qe.componentCount.toFixed()),tt._wrapAccessor(re.ct,qe)})()}getNormalData(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.assert(null!=Je.attributes.NORMAL,"No NORMAL vertex data found.");const qe=yield tt.getAccessor(Je.attributes.NORMAL,rt);return et.errorUnsupportedIf(qe.componentType!==W.g.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+W.g[qe.componentType]),et.errorUnsupportedIf(3!==qe.componentCount,"NORMAL vertex attribute must have 3 components, but found "+qe.componentCount.toFixed()),tt._wrapAccessor(re.ct,qe)})()}getTangentData(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.assert(null!=Je.attributes.TANGENT,"No TANGENT vertex data found.");const qe=yield tt.getAccessor(Je.attributes.TANGENT,rt);return et.errorUnsupportedIf(qe.componentType!==W.g.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+W.g[qe.componentType]),et.errorUnsupportedIf(4!==qe.componentCount,"TANGENT vertex attribute must have 4 components, but found "+qe.componentCount.toFixed()),new re.ek(qe.raw,qe.byteOffset,qe.byteStride,qe.byteOffset+qe.byteStride*qe.entryCount)})()}getTextureCoordinates(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.assert(null!=Je.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const qe=yield tt.getAccessor(Je.attributes.TEXCOORD_0,rt);return et.errorUnsupportedIf(2!==qe.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+qe.componentCount.toFixed()),qe.componentType===W.g.FLOAT?tt._wrapAccessor(re.Eu,qe):(et.errorUnsupportedIf(!qe.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function Ke(Ye){switch(Ye.componentType){case W.g.BYTE:return new re.Vs(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_BYTE:return new re.xA(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.SHORT:return new re.or(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_SHORT:return new re.TS(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_INT:return new re.qt(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.FLOAT:return new re.Eu(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount)}}(qe))})()}getVertexColors(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt._errorContext;et.assert(null!=Je.attributes.COLOR_0,"No COLOR_0 vertex data found.");const qe=yield tt.getAccessor(Je.attributes.COLOR_0,rt);if(et.errorUnsupportedIf(4!==qe.componentCount&&3!==qe.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+qe.componentCount.toFixed()),4===qe.componentCount){if(qe.componentType===W.g.FLOAT)return tt._wrapAccessor(re.ek,qe);if(qe.componentType===W.g.UNSIGNED_BYTE)return tt._wrapAccessor(re.mc,qe);if(qe.componentType===W.g.UNSIGNED_SHORT)return tt._wrapAccessor(re.v6,qe)}else if(3===qe.componentCount){if(qe.componentType===W.g.FLOAT)return tt._wrapAccessor(re.ct,qe);if(qe.componentType===W.g.UNSIGNED_BYTE)return tt._wrapAccessor(re.ne,qe);if(qe.componentType===W.g.UNSIGNED_SHORT)return tt._wrapAccessor(re.mw,qe)}et.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+W.g[qe.componentType])})()}hasPositions(Je){return void 0!==Je.attributes.POSITION}hasNormals(Je){return void 0!==Je.attributes.NORMAL}hasVertexColors(Je){return void 0!==Je.attributes.COLOR_0}hasTextureCoordinates(Je){return void 0!==Je.attributes.TEXCOORD_0}hasTangents(Je){return void 0!==Je.attributes.TANGENT}getMaterial(Je,rt,tt){var et=this;return(0,D.Z)(function*(){let qe=Je.material?et._materialCache.get(Je.material):void 0;if(!qe){const ot=null!=Je.material?he(et.json.materials[Je.material]):he(),ut=ot.pbrMetallicRoughness,_t=et.hasVertexColors(Je),Ct=et.getTexture(ut.baseColorTexture,rt),vt=et.getTexture(ot.normalTexture,rt),Lt=tt?et.getTexture(ot.occlusionTexture,rt):void 0,jt=tt?et.getTexture(ot.emissiveTexture,rt):void 0,$t=tt?et.getTexture(ut.metallicRoughnessTexture,rt):void 0,Wt=null!=Je.material?Je.material:-1;qe={alphaMode:ot.alphaMode,alphaCutoff:ot.alphaCutoff,color:ut.baseColorFactor,doubleSided:!!ot.doubleSided,colorTexture:yield Ct,normalTexture:yield vt,name:ot.name,id:Wt,occlusionTexture:yield Lt,emissiveTexture:yield jt,emissiveFactor:ot.emissiveFactor,metallicFactor:ut.metallicFactor,roughnessFactor:ut.roughnessFactor,metallicRoughnessTexture:yield $t,hasVertexColors:_t,ESRI_externalColorMixMode:ot.extras.ESRI_externalColorMixMode,colorTextureTransform:ut?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:ot.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:ot.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:ot.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:ut?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return qe})()}getTexture(Je,rt){var tt=this;return(0,D.Z)(function*(){if(!Je)return;tt._errorContext.errorUnsupportedIf(0!==(Je.texCoord||0),"Only TEXCOORD with index 0 is supported.");const et=Je.index,qe=tt._errorContext,ot=tt.json.textures[et],ut=(Ye=>({...ge,...Ye}))(null!=ot.sampler?tt.json.samplers[ot.sampler]:{});qe.errorUnsupportedIf(null==ot.source,"Source is expected to be defined for a texture.");const _t=tt.json.images[ot.source],Ct=yield tt._loadTextureImageData(et,ot,rt);return(0,X.s1)(tt._textureCache,et,()=>{const vt=jt=>33071===jt||33648===jt||10497===jt,Lt=jt=>(qe.error(`Unexpected TextureSampler WrapMode: ${jt}. Using default REPEAT(10497).`),10497);return{data:Ct,wrapS:vt(ut.wrapS)?ut.wrapS:Lt(ut.wrapS),wrapT:vt(ut.wrapT)?ut.wrapT:Lt(ut.wrapT),minFilter:ut.minFilter,name:_t.name,id:et}})})()}getNodeTransform(Je){if(void 0===Je)return ye;let rt=this._nodeTransformCache.get(Je);if(!rt){const tt=this.getNodeTransform(this._getNodeParent(Je)),et=this.json.nodes[Je];et.matrix?rt=(0,le.m)((0,G.c)(),tt,et.matrix):et.translation||et.rotation||et.scale?(rt=(0,G.b)(tt),et.translation&&(0,le.v)(rt,rt,et.translation),et.rotation&&(ve[3]=(0,de.g)(ve,et.rotation),(0,le.e)(rt,rt,ve[3],ve)),et.scale&&(0,le.k)(rt,rt,et.scale)):rt=tt,this._nodeTransformCache.set(Je,rt)}return rt}_wrapAccessor(Je,rt){return new Je(rt.raw,rt.byteOffset,rt.byteStride,rt.byteOffset+rt.byteStride*(rt.entryCount-1)+rt.componentByteSize*rt.componentCount)}_resolveUri(Je){return(0,ae.hF)(Je,this._baseUri)}_getNodeParent(Je){return this._nodeParentMap.get(Je)}_checkVersionSupported(){const Je=oe.G.parse(this.json.asset.version,"glTF");Se.validate(Je)}_checkRequiredExtensionsSupported(){const Je=this.json;Je.extensionsRequired&&0!==Je.extensionsRequired.length&&this._errorContext.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+Je.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((Je,rt)=>{Je.children&&Je.children.forEach(tt=>{this._nodeParentMap.set(tt,rt)})})}_loadTextureImageData(Je,rt,tt){var et=this;return(0,D.Z)(function*(){const qe=et._textureLoaders.get(Je);if(qe)return qe;const ot=et._createTextureLoader(rt,tt);return et._textureLoaders.set(Je,ot),ot})()}_createTextureLoader(Je,rt){var tt=this;return(0,D.Z)(function*(){const et=tt.json.images[Je.source];if(et.uri)return tt._context.loadImage(tt._resolveUri(et.uri),rt);const qe=tt._errorContext;qe.errorUnsupportedIf(null==et.bufferView,"Image bufferView must be defined."),qe.errorUnsupportedIf(null==et.mimeType,"Image mimeType must be defined.");const ot=tt.json.bufferViews[et.bufferView],ut=yield tt.getBuffer(ot.buffer,rt);return qe.errorUnsupportedIf(null!=ot.byteStride,"byteStride not supported for image buffer"),function Be(Ye,Je){return Fe.apply(this,arguments)}(new Uint8Array(ut.buffer,ut.byteOffset+(ot.byteOffset||0),ot.byteLength),et.mimeType)})()}getLoadedBuffersSize(){var Je=this;return(0,D.Z)(function*(){if(Je._glbBuffer)return Je._glbBuffer.byteLength;const rt=yield(0,te.WW)(Array.from(Je._bufferLoaders.values())),tt=yield(0,te.WW)(Array.from(Je._textureLoaders.values()));return rt.reduce((et,qe)=>et+(qe?.byteLength??0),0)+tt.reduce((et,qe)=>et+(qe?qe.width*qe.height*4:0),0)})()}}const Se=new oe.G(2,0,"glTF"),ye=(0,le.y)((0,G.c)(),Math.PI/2),ve=(0,se.a)(),xe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},ze={[W.g.BYTE]:1,[W.g.UNSIGNED_BYTE]:1,[W.g.SHORT]:2,[W.g.UNSIGNED_SHORT]:2,[W.g.FLOAT]:4,[W.g.UNSIGNED_INT]:4};function We(Ye){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,D.Z)(function*(Ye){return new Promise((Je,rt)=>{const tt=new Blob([Ye]),et=new FileReader;et.onload=()=>{Je(JSON.parse(et.result))},et.onerror=qe=>{rt(qe)},et.readAsText(tt)})}),Ce.apply(this,arguments)}function Fe(){return Fe=(0,D.Z)(function*(Ye,Je){return new Promise((rt,tt)=>{const et=new Blob([Ye],{type:Je}),qe=URL.createObjectURL(et),ot=new Image,ut=()=>{URL.revokeObjectURL(qe),"decode"in ot?ot.decode().then(()=>rt(ot),()=>rt(ot)).then(Ct):(rt(ot),Ct())},_t=vt=>{URL.revokeObjectURL(qe),tt(vt),Ct()},Ct=()=>{ot.removeEventListener("load",ut),ot.removeEventListener("error",_t)};ot.addEventListener("load",ut),ot.addEventListener("error",_t),ot.src=qe})}),Fe.apply(this,arguments)}let je=0;function Re(Ye,Je){return He.apply(this,arguments)}function He(){return He=(0,D.Z)(function*(Ye,Je,rt={},tt=!0){const et=yield be.load(Ye,Ne,Je,rt),qe="gltf_"+je++,ot={lods:[],materials:new Map,textures:new Map,meta:Ie(et)},ut=!(!et.json.asset.extras||"symbolResource"!==et.json.asset.extras.ESRI_type),_t=new Map;yield Ge(et,function(){var vt=(0,D.Z)(function*(Lt,jt,$t,Wt){const pr=_t.get($t)??0;_t.set($t,pr+1);const gr=void 0!==Lt.mode?Lt.mode:W.MX.TRIANGLES,ar=gr===W.MX.TRIANGLES||gr===W.MX.TRIANGLE_STRIP||gr===W.MX.TRIANGLE_FAN?gr:null;if((0,R.Wi)(ar))return void Ne.warnUnsupported("Unsupported primitive mode ("+W.MX[gr]+"). Skipping primitive.");if(!et.hasPositions(Lt))return void Ne.warn("Skipping primitive without POSITION vertex attribute.");const Fr=et.getPositionData(Lt,rt),mr=et.getMaterial(Lt,rt,tt),wt=et.hasNormals(Lt)?et.getNormalData(Lt,rt):null,or=et.hasTangents(Lt)?et.getTangentData(Lt,rt):null,sr=et.hasTextureCoordinates(Lt)?et.getTextureCoordinates(Lt,rt):null,rr=et.hasVertexColors(Lt)?et.getVertexColors(Lt,rt):null,Et=et.getIndexData(Lt,rt),St={transform:(0,G.b)(jt),attributes:{position:yield Fr,normal:wt?yield wt:null,texCoord0:sr?yield sr:null,color:rr?yield rr:null,tangent:or?yield or:null},indices:yield Et,primitiveType:ar,material:Me(ot,yield mr,qe)};let Ft=null;(0,R.pC)(ot.meta)&&(0,R.pC)(ot.meta.ESRI_lod)&&"screenSpaceRadius"===ot.meta.ESRI_lod.metric&&(Ft=ot.meta.ESRI_lod.thresholds[$t]),ot.lods[$t]=ot.lods[$t]||{parts:[],name:Wt,lodThreshold:Ft},ot.lods[$t].parts[pr]=St});return function(Lt,jt,$t,Wt){return vt.apply(this,arguments)}}());for(const vt of ot.lods)vt.parts=vt.parts.filter(Lt=>!!Lt);const Ct=yield et.getLoadedBuffersSize();return{model:ot,meta:{isEsriSymbolResource:ut,uri:et.uri},customMeta:{},size:Ct}}),He.apply(this,arguments)}function Ie(Ye){let rt=null;return Ye.json.nodes.forEach(tt=>{const et=tt.extras;(0,R.pC)(et)&&(et.ESRI_proxyEllipsoid||et.ESRI_lod)&&(rt=et)}),rt}function Ge(Ye,Je){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,D.Z)(function*(Ye,Je){const rt=Ye.json,tt=rt.scenes[rt.scene||0].nodes,et=tt.length>1,qe=[];for(const _t of tt){const Ct=rt.nodes[_t];qe.push(ot(_t,0)),Le(Ct)&&!et&&Ct.extensions.MSFT_lod.ids.forEach((vt,Lt)=>ot(vt,Lt+1))}function ot(_t,Ct){return ut.apply(this,arguments)}function ut(){return(ut=(0,D.Z)(function*(_t,Ct){const vt=rt.nodes[_t],Lt=Ye.getNodeTransform(_t);if(Ne.warnUnsupportedIf(null!=vt.weights,"Morph targets are not supported."),null!=vt.mesh){const jt=rt.meshes[vt.mesh];for(const $t of jt.primitives)qe.push(Je($t,Lt,Ct,jt.name))}for(const jt of vt.children||[])qe.push(ot(jt,Ct))})).apply(this,arguments)}yield Promise.all(qe)}),Pe.apply(this,arguments)}function Le(Ye){return Ye.extensions&&Ye.extensions.MSFT_lod&&Array.isArray(Ye.extensions.MSFT_lod.ids)}function Me(Ye,Je,rt){const tt=qe=>{const ot=`${rt}_tex_${qe&&qe.id}${qe&&qe.name?"_"+qe.name:""}`;if(qe&&!Ye.textures.has(ot)){const ut=function H(Ye,Je={}){return{data:Ye,parameters:{wrap:{s:W.e8.REPEAT,t:W.e8.REPEAT,...Je.wrap},noUnpackFlip:!0,mipmap:!1,...Je}}}(qe.data,{wrap:{s:qe.wrapS,t:qe.wrapT},mipmap:Xe.includes(qe.minFilter),noUnpackFlip:!0});Ye.textures.set(ot,ut)}return ot},et=`${rt}_mat_${Je.id}_${Je.name}`;if(!Ye.materials.has(et)){const qe=function B(Ye={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...Ye}}({color:[Je.color[0],Je.color[1],Je.color[2]],opacity:Je.color[3],alphaMode:Je.alphaMode,alphaCutoff:Je.alphaCutoff,doubleSided:Je.doubleSided,colorMixMode:Je.ESRI_externalColorMixMode,textureColor:Je.colorTexture?tt(Je.colorTexture):void 0,textureNormal:Je.normalTexture?tt(Je.normalTexture):void 0,textureOcclusion:Je.occlusionTexture?tt(Je.occlusionTexture):void 0,textureEmissive:Je.emissiveTexture?tt(Je.emissiveTexture):void 0,textureMetallicRoughness:Je.metallicRoughnessTexture?tt(Je.metallicRoughnessTexture):void 0,emissiveFactor:[Je.emissiveFactor[0],Je.emissiveFactor[1],Je.emissiveFactor[2]],colorTextureTransform:Je.colorTextureTransform,normalTextureTransform:Je.normalTextureTransform,occlusionTextureTransform:Je.occlusionTextureTransform,emissiveTextureTransform:Je.emissiveTextureTransform,metallicRoughnessTextureTransform:Je.metallicRoughnessTextureTransform,metallicFactor:Je.metallicFactor,roughnessFactor:Je.roughnessFactor});Ye.materials.set(et,qe)}return et}const Ne=new class ${error(Je){throw new Z.Z("gltf-loader-error",Je)}errorUnsupported(Je){throw new Z.Z("gltf-loader-unsupported-feature",Je)}errorUnsupportedIf(Je,rt){Je&&this.errorUnsupported(rt)}assert(Je,rt){Je||this.error(rt)}warn(Je){Q.Z.getLogger("esri.views.3d.glTF").warn(Je)}warnUnsupported(Je){this.warn("[Unsupported Feature] "+Je)}warnUnsupportedIf(Je,rt){Je&&this.warnUnsupported(rt)}},Xe=[W.cw.LINEAR_MIPMAP_LINEAR,W.cw.LINEAR_MIPMAP_NEAREST]},46807:(nt,Ae,v)=>{"use strict";v.d(Ae,{Lz:()=>se,RX:()=>de,Wf:()=>ae,j3:()=>oe});var D=v(62208),R=v(28347),G=v(43703),Z=v(84161),Q=v(28093),$=v(55915),W=v(81468),B=v(67225),H=v(93605),X=v(53929),te=v(16396);function ae(pe,he,me,ge){const _e=pe.stageObject,Ee=_e.geometryRecords;let De=0;for(const be of Ee){const{update:Se,averageGeometrySampledElevation:ye}=ue(be,he,me,ge);De+=ye,Se&&_e.geometryVertexAttrsUpdated(be)}return De/Ee.length}function oe(pe,he,me,ge){const _e=pe.stageObject,Ee=he.centerPointInElevationSR;let De=0;_e.metadata.usesVerticalDistanceToGround?((0,W.qZ)(Ee,me,he,ge,ce),(0,B.CV)(_e,ce.verticalDistanceToGround),De=ce.sampledElevation):((0,W.qZ)(Ee,me,he,ge,ce),"absolute-height"!==he.mode&&(De=ce.sampledElevation));const be=(0,R.c)(le,_e.transformation),Se=(0,Z.s)(J,be[12],be[13],be[14]);H.Z.TESTS_DISABLE_OPTIMIZATIONS?(j[0]=Ee.x,j[1]=Ee.y,j[2]=ce.z,(0,$.Bm)(Ee.spatialReference,j,be,ge.spatialReference)&&(_e.transformation=be)):ge.setAltitudeOfTransformation(ce.z,be);const ye=re/ge.unitInMeters;return(Math.abs(be[12]-Se[0])>=ye||Math.abs(be[13]-Se[1])>=ye||Math.abs(be[14]-Se[2])>=ye)&&(_e.transformation=be),De}const le=(0,G.c)();function de(pe,he,me,ge){const _e=pe.graphics3DSymbolLayer.lodRenderer;if((0,D.Wi)(_e))return 0;const Ee=he.centerPointInElevationSR;(0,W.qZ)(Ee,me,he,ge,ce);const De="absolute-height"!==he.mode?ce.sampledElevation:0,be=_e.instanceData,Se=pe.instanceIndex,ye=ie;be.getGlobalTransform(Se,ye);const ve=(0,Z.s)(J,ye[12],ye[13],ye[14]);H.Z.TESTS_DISABLE_OPTIMIZATIONS?(j[0]=Ee.x,j[1]=Ee.y,j[2]=ce.z,(0,$.Bm)(Ee.spatialReference,j,ye,ge.spatialReference)&&be.setGlobalTransform(Se,ye)):ge.setAltitudeOfTransformation(ce.z,ye);const xe=re/ge.unitInMeters;return(H.Z.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(ye[12]-ve[0])>=xe||Math.abs(ye[13]-ve[1])>=xe||Math.abs(ye[14]-ve[2])>=xe)&&be.setGlobalTransform(Se,ye),De}function se(pe,he,me,ge){const _e=pe.stageObject,Ee=_e.geometryRecords;if(0===Ee.length)return 0;let De=0,be=null,Se=0,ye=!1;for(const ve of Ee){const xe=ve.geometry.vertexAttributes.get(te.T.POSITION);if(xe!==be){const{update:ze,averageGeometrySampledElevation:Ke}=ue(ve,he,me,ge);Se=Ke,be=xe,ye=ze}ye&&_e.geometryVertexAttrsUpdated(ve),De+=Se}return De/Ee.length}const re=.01,j=(0,Q.c)(),Y=(0,Q.c)(),ee=(0,Q.c)(),ie=(0,G.c)(),J=(0,Q.c)(),ce=new W.Lm;function ue(pe,he,me,ge){let _e=!1;const Ee=me.spatialReference,De=pe.geometry,be=pe.getShaderTransformation(),Se=he.requiresSampledElevationInfo;Y[0]=be[12],Y[1]=be[13],Y[2]=be[14],De.invalidateBoundingInfo();const ye=De.getMutableAttribute(te.T.POSITION),ve=ye.data,xe=De.vertexAttributes.get(te.T.MAPPOS).data,ze=ye.size,Ke=ve.length/ze,We=new X.sb(xe,Ee);let Ce=0,Be=0;for(let Fe=0;Fe<Ke;Fe++){if(ee[0]=ve[Ce],ee[1]=ve[Ce+1],ee[2]=ve[Ce+2],(0,W.qZ)(We,me,he,ge,ce),Se&&(Be+=ce.sampledElevation),H.Z.TESTS_DISABLE_OPTIMIZATIONS)ve[Ce]=We.array[We.offset],ve[Ce+1]=We.array[We.offset+1],ve[Ce+2]=ce.z,(0,$.CM)(ve,Ee,Ce,ve,ge.spatialReference,Ce,1),ve[Ce]-=Y[0],ve[Ce+1]-=Y[1],ve[Ce+2]-=Y[2],_e=!0;else{j[0]=ve[Ce]+Y[0],j[1]=ve[Ce+1]+Y[1],j[2]=ve[Ce+2]+Y[2],ge.setAltitude(j,ce.z),ve[Ce]=j[0]-Y[0],ve[Ce+1]=j[1]-Y[1],ve[Ce+2]=j[2]-Y[2];const je=re/ge.unitInMeters;(Math.abs(ee[0]-ve[Ce])>=je||Math.abs(ee[1]-ve[Ce+1])>=je||Math.abs(ee[2]-ve[Ce+2])>=je)&&(_e=!0)}Ce+=ze,We.offset+=3}return Be/=Ke,{update:_e,averageGeometrySampledElevation:Be}}},79112:(nt,Ae,v)=>{"use strict";v.d(Ae,{o:()=>Z});var D=v(62208),R=v(29505),G=v(74746);class Z{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit($){this._unit=$,this._metersPerElevationInfoUnit=(0,R.Z7)($)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters($){this._meterUnitOffset=$,this._renderUnitOffset=0}set offsetElevationInfoUnits($){this._meterUnitOffset=$*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits($){this._renderUnitOffset+=$}geometryZWithOffset($,W){const B=this.calculateOffsetRenderUnits(W);return null!=this.featureExpressionInfoContext?B:$+B}calculateOffsetRenderUnits($){let W=this._meterUnitOffset;const B=this.featureExpressionInfoContext;return null!=B&&(W+=(0,G.ht)(B)*this._metersPerElevationInfoUnit),W/$.unitInMeters+this._renderUnitOffset}setFromElevationInfo($){this.mode=$.mode,this.unit=(0,R.lt)($.unit)?$.unit:"meters",this.offsetElevationInfoUnits=(0,D.Pt)($.offset,0)}updateFeatureExpressionInfoContext($,W,B){if((0,D.Wi)($))return void(this._featureExpressionInfoContext=null);const H=$&&$.arcade;H&&(0,D.pC)(W)&&(0,D.pC)(B)?(this._featureExpressionInfoContext=(0,G.d9)($),(0,G.aO)(this._featureExpressionInfoContext,(0,G.Tz)(H.modules,W,B))):this._featureExpressionInfoContext=$}static fromElevationInfo($){const W=new Z;return(0,D.pC)($)&&W.setFromElevationInfo($),W}}},39912:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>H,Y:()=>B});var D=v(15861),G=(v(29132),v(85931)),Z=v(62208),Q=v(10699),$=v(87091),W=v(72854);class B{constructor(te,ae){this.spatialReference=te,this._view=ae}getElevation(te,ae,oe){return this._view.elevationProvider.getElevation(te,ae,0,this.spatialReference,oe)}queryElevation(te,ae,oe,le,de){var se=this;return(0,D.Z)(function*(){return se._view.elevationProvider.queryElevation(te,ae,0,se.spatialReference,de,oe,le)})()}}class H{constructor(te,ae,oe,le){this.spatialReference=ae,this._getElevationQueryProvider=oe,this._queries=new Array,this._queryOptions={...le,ignoreInvisibleLayers:!0},this._frameTask=te.registerTask($.T8.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(te,ae,oe,le=0){return new Promise((de,se)=>{const re={x:te,y:ae,minDemResolution:le,result:{resolve:de,reject:se},signal:oe};this._queries.push(re),(0,Q.fu)(oe,()=>{(0,G.Od)(this._queries,re),se((0,Q.zE)())})})}get running(){return this._queries.length>0}runTask(){const te=this._queries;this._queries=[];const ae=this._getElevationQueryProvider();if(!ae)return void te.forEach(Y=>Y.result.reject());const oe=te.map(Y=>[Y.x,Y.y]),le=te.reduce((Y,ee)=>Math.min(Y,ee.minDemResolution),1/0),de=new W.Z({points:oe,spatialReference:this.spatialReference}),se=te.length>1&&te.some(Y=>!!Y.signal)?new AbortController:null,re=(0,Z.pC)(se)?se.signal:te[0].signal;if((0,Z.pC)(se)){let Y=0;te.forEach(ee=>(0,Q.fu)(ee.signal,()=>{Y++,ee.result.reject((0,Q.zE)()),Y===te.length&&se.abort()}))}const j={...this._queryOptions,minDemResolution:le,signal:re};ae.queryElevation(de,j).then(Y=>{te.forEach((ee,ie)=>{(0,Z.pC)(ee.signal)&&ee.signal.aborted?ee.result.reject((0,Q.zE)()):ee.result.resolve(Y.geometry.points[ie][2])})}).catch(Y=>{te.forEach(ee=>ee.result.reject(Y))})}get test(){const te=this;return{update:()=>te._queries.length>0&&te.runTask()}}}},18170:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>Xe});var D=v(63290),R=v(9824),G=v(15861),Z=v(91558),Q=v(62208),$=v(23841),W=v(99770),B=v(46807),H=v(81468),X=v(79112),te=v(93927),ae=v(18422),oe=v(67225),le=v(92690),de=v(97161),se=v(42743),re=v(52107),j=v(40723),Y=v(16396),ee=v(9545),ie=v(19625),J=v(13934),ce=v(97347),ue=v(60881),pe=v(5894),he=v(42037),me=v(59617),ge=v(651),_e=v(91056),Ee=v(39114),De=v(12407),be=v(76269),Se=v(67969),ye=v(2078);class ve extends _e.A{initializeConfiguration(rt,tt){tt.spherical=rt.viewingMode===me.JY.Global}initializeProgram(rt){return new De.$(rt.rctx,ve.shader.get().build(this.configuration),Ee.i)}setPipelineState(rt){const tt=rt?Se.wb.ALWAYS:Se.wb.LESS;return(0,ye.sm)(this.configuration.depthHudEnabled?{depthTest:{func:tt},depthWrite:ye.LZ}:{blending:(0,ye.wK)(Se.zi.ONE,Se.zi.SRC_ALPHA,Se.zi.ONE_MINUS_SRC_ALPHA,Se.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:tt},colorWrite:ye.BK})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}ve.shader=new ge.J(be.L,()=>v.e(3807).then(v.bind(v,43807)));var xe=v(17626),ze=v(87601),Ke=v(41528);class We extends Ke.W{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=ce.d.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}(0,xe._)([(0,ze.o)({count:ce.d.COUNT})],We.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"spherical",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"occlusionTestEnabled",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"hasVerticalOffset",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"hasScreenSizePerspective",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"depthHudEnabled",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"depthHudAlignStartEnabled",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"hasSlicePlane",void 0),(0,xe._)([(0,ze.o)()],We.prototype,"hasMultipassGeometry",void 0),(0,xe._)([(0,ze.o)({constValue:!0})],We.prototype,"hasSliceInVertexProgram",void 0),(0,xe._)([(0,ze.o)({constValue:!1})],We.prototype,"isDraped",void 0);class Ce extends j.F5{constructor(rt){super(rt,new Fe),this._configuration=new We,this._uniqueMaterialIdentifier=Ce.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(rt,tt){const et=tt?.slot!==pe.r.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=(0,Q.pC)(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=(0,Q.pC)(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=et,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?ce.d.Screen:ce.d.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=tt.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(rt,tt){if(tt===J.H.Color)switch(rt){case pe.r.LINE_CALLOUTS:case pe.r.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(rt){return new Be(rt)}createBufferWriter(){return new He}validateParameters(rt){const tt=Ce.uniqueMaterialIdentifier(rt);tt!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=tt)}static uniqueMaterialIdentifier(rt){return JSON.stringify({screenOffset:rt.screenOffset||[0,0],centerOffsetUnits:rt.centerOffsetUnits||"world"})}}class Be extends ue.Z{beginSlot(rt){return this.ensureTechnique(ve,rt)}}class Fe extends j.Mt{constructor(){super(...arguments),this.screenOffset=W.Z,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const je=(0,ie.U$)().vec3f(Y.T.POSITION).vec3f(Y.T.NORMAL).vec2f(Y.T.UV0).vec4f(Y.T.AUXPOS1),Re=[(0,ee.f)(0,0),(0,ee.f)(1,0),(0,ee.f)(0,1),(0,ee.f)(1,0),(0,ee.f)(1,1),(0,ee.f)(0,1)];class He{constructor(){this.vertexBufferLayout=je}allocate(rt){return this.vertexBufferLayout.createBuffer(rt)}elementCount(rt){return 6*rt.indices.get(Y.T.POSITION).length}write(rt,tt,et,qe,ot){(0,he.ho)(et.indices.get(Y.T.POSITION),et.vertexAttributes.get(Y.T.POSITION).data,rt,qe.position,ot,6),(0,he.s5)(et.indices.get(Y.T.NORMAL),et.vertexAttributes.get(Y.T.NORMAL).data,tt,qe.normal,ot,6),(0,he.SW)(et.indices.get(Y.T.AUXPOS1),et.vertexAttributes.get(Y.T.AUXPOS1).data,qe.auxpos1,ot,6);for(let ut=0;ut<Re.length;++ut)qe.uv0.setVec(ot+ut,Re[ut])}}class Ie extends ae.k{constructor(rt,tt){super(rt,null,tt,Me),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){var rt=this;return(0,G.Z)(function*(){rt._material=new Ce(rt._materialParameters),rt._context.stage.add(rt._material)})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(rt){const tt=this._materialParameters;return tt.screenOffset=rt.screenOffset||W.Z,tt.centerOffsetUnits=rt.centerOffsetUnits||"world",tt}get _materialParameters(){const rt=this.symbol,tt=rt.callout,et=(0,Q.pC)(tt.color)?Z.Z.toUnitRGBA(tt.color):[0,0,0,0];et[3]*=this._getLayerOpacity();const qe=(0,$.F2)(tt.size||0);let ot=null;if(rt.verticalOffset){const{screenLength:jt,minWorldLength:$t,maxWorldLength:Wt}=rt.verticalOffset;ot={screenLength:(0,$.F2)(jt),minWorldLength:$t||0,maxWorldLength:(0,Q.pC)(Wt)?Wt:1/0}}const ut=(0,Q.pC)(tt.border)&&(0,Q.pC)(tt.border.color)?Z.Z.toUnitRGBA(tt.border.color):null,_t="object"===rt.symbolLayers.getItemAt(0).type;return{color:et,size:qe,verticalOffset:ot,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:ut,occlusionTest:!_t,shaderPolygonOffset:_t?0:void 0,depthHUDAlignStart:"label-3d"===rt.type,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:j.yD.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return Le}createGraphics3DGraphic(rt){const tt=rt.renderingInfo,et=rt.graphic,qe=this.setGraphicElevationContext(et,new X.o,tt.elevationOffset||0),ot=tt.symbol,ut="on-the-ground"===this._elevationContext.mode&&("cim"===ot.type||!ot.symbolLayers.some(Ct=>"object"===Ct.type||"text"===Ct.type));if("label-3d"!==ot.type&&ut||"point-3d"===ot.type&&ot.symbolLayers.every(Ct=>"text"===Ct.type&&!(0,R.as)(Ct)))return null;const _t=(0,oe.zE)(et.geometry);return(0,Q.Wi)(_t)?null:this._createAs3DShape(_t,qe,tt,et.uid)}layerOpacityChanged(){(0,Q.pC)(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(rt,tt,et){const ot=(0,H.GC)(Ie.elevationModeChangeTypes,et,this._elevationContext.mode);return ot!==H.lO.UPDATE||rt.forEach(ut=>{const _t=tt(ut);(0,Q.pC)(_t)&&this.updateGraphicElevationContext(ut.graphic,_t)}),ot}slicePlaneEnabledChanged(){return(0,Q.Wi)(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(rt,tt,et=0){const qe=super.setGraphicElevationContext(rt,tt);return qe.addOffsetRenderUnits(et),qe}updateGraphicElevationContext(rt,tt){this.setGraphicElevationContext(rt,tt.elevationContext,tt.metadata.elevationOffset),tt.needsElevationUpdates=(0,H.Xf)(tt.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:de.WU.memory}}_createVertexData(rt){const{translation:tt,centerOffset:et}=rt;return[[Y.T.POSITION,tt?{size:3,data:[tt[0],tt[1],tt[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[Y.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[Y.T.AUXPOS1,et?{size:4,data:[et[0],et[1],et[2],et[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(rt){const tt=this._perInstanceMaterialParameters(rt),et=Ce.uniqueMaterialIdentifier(tt);if((0,Q.pC)(this._material)&&et===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(rt.materialCollection){let qe=rt.materialCollection.get(et);return(0,Q.Wi)(qe)&&(qe=new Ce(tt),rt.materialCollection.add(et,qe)),{material:qe,isUnique:!1}}return{material:new Ce(tt),isUnique:!0}}_createAs3DShape(rt,tt,et,qe){const ot=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:qe,layerUid:this._context.layer.uid}),ut=[new re.Z(this._createVertexData(et),Pe,se.MX.Point,ot)],_t=this._getOrCreateMaterial(et),Ct=(0,le.km)(this._context,rt,ut,[_t.material],tt,this._context.layer.uid,qe);if(null===Ct)return null;const vt=new te.z(this,Ct.object,ut,_t.isUnique?[_t.material]:null,null,B.j3,tt);return vt.metadata={elevationOffset:et.elevationOffset||0},vt.alignedSampledElevation=Ct.sampledElevation,vt.needsElevationUpdates=(0,H.Xf)(tt.mode),(0,le.dO)(vt,rt,this._context.elevationProvider),vt}}Ie.elevationModeChangeTypes={definedChanged:H.lO.UPDATE,staysOnTheGround:H.lO.UPDATE,onTheGroundChanged:H.lO.RECREATE};const Ge=[0],Pe=[[Y.T.POSITION,Ge],[Y.T.NORMAL,Ge],[Y.T.AUXPOS1,Ge]],Le={mode:"relative-to-ground",offset:0},Me={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Ne=D.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Xe(Je,rt){if(!(0,R.Pd)(Je))return Ne.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${Je.type}' does not support callouts`),null;if(!Je.callout)return null;const tt=Ye[Je.callout.type];return tt?new tt(Je,rt):(Ne.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${Je.callout.type}`),null)}const Ye={line:Ie}},23641:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>D});class D{constructor(G,Z,Q){this.graphic=G,this.renderingInfo=Z,this.layer=Q}}},93927:(nt,Ae,v)=>{"use strict";v.d(Ae,{z:()=>te});var D=v(15861),R=v(62208),G=v(84161),Z=v(28093),Q=v(5548),$=v(97126),W=v(74746),B=v(67225),H=v(42743),X=v(17803);class te{constructor(j,Y,ee,ie,J,ce,ue,pe=null){this.graphics3DSymbolLayer=j,this.stageObject=Y,this._uniqueGeometries=ee,this._uniqueMaterials=ie,this._sharedResource=J,this.elevationAligner=ce,this.elevationContext=ue,this._edgeState=pe,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=j,this.stageObject=Y}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(j,Y){this._stageLayer=Y,this._stage=j,j.addMany(this._uniqueMaterials),j.addMany(this._uniqueGeometries),j.add(this.stageObject)}destroy(){const j=this._stage;this._stageLayer&&(j.removeMany(this._uniqueMaterials),j.removeMany(this._uniqueGeometries)),j.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const Y=this._stage.renderView.ensureEdgeView();Y.hasObject(this.stageObject)&&Y.removeObject(this.stageObject),this.stageObject.dispose(),(0,R.pC)(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(j,Y){if((0,R.Wi)(this._edgeState))return;const ee=ae(this._edgeState.baseMaterial);let ie=!1;for(const J of this._edgeState.edgeMaterials)J.objectTransparency!==ee&&(J.objectTransparency=ee,ie=!0);ie&&this._resetEdgeObject(Y),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[j])}slicePlaneEnabledChanged(j,Y){(0,R.Wi)(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:j},!Y),this._edgeState.properties.hasSlicePlane=j)}setVisibility(j){if(null!=this._stage&&this._visible!==j&&(this._visible=j,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),(0,R.pC)(this._edgeState))){const Y=this._stage.renderView.ensureEdgeView();Y.hasObject(this.stageObject)?Y.updateObjectVisibility(this.stageObject,j):j&&this._addOrUpdateEdgeObject(Y,!1)}}get visible(){return this._visible}alignWithElevation(j,Y,ee,ie){null!=this.elevationAligner&&((0,R.pC)(ee)&&(0,W.aO)(this.elevationContext.featureExpressionInfoContext,ee),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,j,Y),this._resetEdgeObject(ie))}getCenterObjectSpace(j=(0,Z.c)()){return(0,G.c)(j,(0,$.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(j=(0,Q.Ue)()){const Y=this.stageObject.boundingVolumeObjectSpace;return(0,Q.op)(j,Y.min),(0,Q.Tn)(j,Y.max),j}computeAttachmentOrigin(j){if(this.useObjectOriginAsAttachmentOrigin){const Y=this.stageObject.transformation;j.render.origin[0]+=Y[12],j.render.origin[1]+=Y[13],j.render.origin[2]+=Y[14],j.render.num++}else for(const Y of this.stageObject.geometryRecords)Y.computeAttachmentOrigin(de)&&((0,G.m)(de,de,this.stageObject.transformation),(0,G.a)(j.render.origin,j.render.origin,de),j.render.num++)}getProjectedBoundingBox(j,Y,ee,ie,J){var ce=this;return(0,D.Z)(function*(){const ue=ce.getBoundingBoxObjectSpace(J),pe=se,he=(0,Q.wp)(ue)?1:pe.length;for(let ge=0;ge<he;ge++){const _e=pe[ge];le[0]=ue[_e[0]],le[1]=ue[_e[1]],le[2]=ue[_e[2]],(0,G.m)(le,le,ce.stageObject.transformation),oe[3*ge+0]=le[0],oe[3*ge+1]=le[1],oe[3*ge+2]=le[2]}if(!j(oe,0,he))return null;(0,Q.cS)(ue);let me=null;ce.calculateRelativeScreenBounds&&(me=ce.calculateRelativeScreenBounds());for(let ge=0;ge<3*he;ge+=3){for(let _e=0;_e<3;_e++)ue[_e]=Math.min(ue[_e],oe[ge+_e]),ue[_e+3]=Math.max(ue[_e+3],oe[ge+_e]);me&&ee.push({location:oe.slice(ge,ge+3),screenSpaceBoundingRect:me})}if(Y&&Y.service&&"absolute-height"!==ce.elevationContext.mode){(0,Q.be)(ue,de);const ge="relative-to-scene"===ce.elevationContext.mode?"scene":"ground";let _e=0;if(Y.useViewElevation)_e=(0,R.Pt)(Y.service.getElevation(de[0],de[1],ge),0);else try{const Ee=(0,B.Si)(ue,Y.service.spatialReference,Y);_e=(0,R.Pt)(yield Y.service.queryElevation(de[0],de[1],ie,Ee,ge),0)}catch{}(0,Q.cv)(ue,0,0,-ce.alignedSampledElevation+_e)}return ue})()}addObjectState(j,Y){j===H.V_.Highlight&&Y.addObject(this.stageObject,this.stageObject.highlight()),j===H.V_.MaskOccludee&&Y.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(j){j.removeObject(this.stageObject)}_resetEdgeObject(j){if((0,R.Wi)(this._edgeState))return;const Y=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(Y,j):Y.removeObject(this.stageObject)}_addOrUpdateEdgeObject(j,Y){const ee=this._edgeState;if((0,R.Wi)(ee))return;const ie=ae(ee.baseMaterial);for(const J of ee.edgeMaterials)J.objectTransparency=ie;j.addOrUpdateObject3D(this.stageObject,ee.edgeMaterials,ee.properties,!Y).then(()=>this._stageLayer?.sync())}}function ae(re){return re.isVisible?re.parameters.transparent?X.i.TRANSPARENT:X.i.OPAQUE:X.i.INVISIBLE}const oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],le=(0,Z.c)(),de=(0,Z.c)(),se=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},21439:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>vT});var D=v(15861),R=v(59213),G=v(62208),Z=v(10699),Q=v(27306),$=v(27899),W=v(67831),B=v(99770),H=v(84161),X=v(28093),te=v(37118),ae=v(55915),oe=v(5548),le=v(65401),de=v(37053),se=v(38114),re=v(82054),j=v(79721),Y=v(74746);const ee=new $.Z(Array,ft=>(0,oe.t8)(ft,oe.xE),null,10,5),ie=(0,le.Ue)();class J{constructor(Te,Ue,$e,st,ht){this.graphic=Te,this.graphics3DSymbol=Ue,this.graphics=$e,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function ce(ft,Te){const Ue=new Array(ft);for(let $e=0;$e<Ue.length;$e++)Ue[$e]=new Array(Te);return Ue}(j.E._COUNT,j.P._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++Ue.referenced,this._featureExpressionFeature=ht?(0,Y.Tz)(ht,Te,st):null;for(const yt of $e)(0,G.pC)(yt)&&(this.isElevationSource=this.isElevationSource||yt.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(Te,Ue){this._layer=Ue,this._stage=Te,this._forEachSymbolLayerGraphic($e=>{$e.initialize(Te,Ue),$e.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(Te=>Te.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this._forEachLabelGraphic(Te=>Te.destroy()),this._labelGraphics.length=0}addLabelGraphic(Te,Ue,$e){this._labelGraphics.push(Te),Te.initialize(Ue,$e),Te.setVisibility(this.isVisible(j.E.LABEL))}addAuxiliaryGraphic(Te){this._auxiliaryGraphics.push(Te),this._layer&&(Te.initialize(this._stage,this._layer),Te.setVisibility(this.isVisible()))}get isDraped(){let Te=!1;return this._forEachSymbolLayerGraphic(Ue=>{"draped"===Ue.type&&(Te=!0)}),Te}isVisible(Te=j.E.GRAPHIC,Ue){for(let $e=0;$e<=Te;$e++){const st=this._visibilityFlags[$e];for(let ht=0;ht<st.length;++ht)if(!1===st[ht]&&ht!==Ue)return!1}return!0}hasVisibilityFlag(Te,Ue){return null!=this._visibilityFlags[Ue][Te]}setVisibilityFlag(Te,Ue,$e){const st=this.isVisible($e);this._visibilityFlags[$e][Te]=Ue;const ht=this.isVisible($e);if(st===ht)return!1;if($e===j.E.LABEL)this._forEachLabelGraphic(yt=>yt.setVisibility(ht));else{this._forEachSymbolLayerGraphic(Rt=>Rt.setVisibility(ht));const yt=this.isVisible(j.E.LABEL);this._forEachLabelGraphic(Rt=>Rt.setVisibility(yt))}return!0}clearVisibilityFlag(Te,Ue=j.E.GRAPHIC){return this.setVisibilityFlag(Te,void 0,Ue)}computeExtent(Te){if(!this._extent){const Ue=this.graphic.geometry;if((0,G.Wi)(Ue))return!1;this._extent=(0,le.Ue)(),(0,se.TF)(Ue,this._extent);const $e=Ue.spatialReference;if(!(0,de.fS)($e,Te)&&!(0,ae.dH)(this._extent,$e,this._extent,Te))return this._extent=null,!1}return!0}getAsOptimizedGeometry(Te,Ue){return(0,G.pC)(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===Te&&this._optimizedGeometry.hasM===Ue||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,Te,Ue),this._optimizedGeometry.hasZ=Te,this._optimizedGeometry.hasM=Ue),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(Te,Ue,$e){let st=Te.geometry;return"mesh"!==st.type&&"extent"!==st.type||(st=te.Z.fromExtent("mesh"===st.type?st.extent:st)),(0,re.GH)(st,Ue,$e)}get usedMemory(){let Te=(0,Q.f2)(this.graphic.attributes);return this._forEachSymbolLayerGraphic(Ue=>{const $e=Ue.graphics3DSymbolLayer.complexity;if((0,G.Wi)($e))return;const st="draped"===Ue.type?$e.memory.draped:$e.memory;Te+=st.bytesPerFeature,st.bytesPerCoordinate&&(Te+=(0,se.R3)(this.graphic.geometry)*st.bytesPerCoordinate)}),Te}computeAttachmentOrigin(){const Te={render:{origin:(0,X.c)(),num:0},draped:{origin:(0,B.a)(),num:0}};for(const Ue of this.graphics)(0,G.Wi)(Ue)||Ue.computeAttachmentOrigin(Te);return Te.render.num&&(0,H.g)(Te.render.origin,Te.render.origin,1/Te.render.num),Te.draped.num&&(0,W.b)(Te.draped.origin,Te.draped.origin,1/Te.draped.num),Te}getProjectedBoundingBox(Te,Ue,$e,st,ht){var yt=this;return(0,D.Z)(function*(){return ht||(ht={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),ht.boundingBox?(0,oe.cS)(ht.boundingBox):ht.boundingBox=(0,oe.cS)(),ht.requiresDrapedElevation=!1,yield(0,R.Ed)(yt.graphics,function(){var Rt=(0,D.Z)(function*(Ut){if((0,G.Wi)(Ut))return;const er="draped"===Ut.type?Ue:Te,vr=ee.acquire(),Pr=yield Ut.getProjectedBoundingBox(er,$e,ht.screenSpaceObjects,st,vr);isFinite(Pr[2])&&isFinite(Pr[5])||(ht.requiresDrapedElevation=!0),Pr&&(0,oe.TC)(ht.boundingBox,vr),ee.release(vr)});return function(Ut){return Rt.apply(this,arguments)}}()),(0,oe.sU)(ht.boundingBox)||(0,le.sU)((0,oe.y8)(ht.boundingBox,ie))?ht:null})()}needsElevationUpdates(){for(const Te of this.graphics)if((0,G.pC)(Te)&&("object3d"===Te.type||"lod-instance"===Te.type)&&Te.needsElevationUpdates)return!0;for(const Te of this._labelGraphics)if(Te&&Te.needsElevationUpdates)return!0;return!1}alignWithElevation(Te,Ue,$e){this._forEachRenderedGraphic(st=>{"object3d"!==st.type&&"lod-instance"!==st.type||st.alignWithElevation(Te,Ue,this._featureExpressionFeature,$e)})}addObjectStateSet(Te,Ue){this._forEachSymbolLayerGraphic($e=>$e.addObjectState(Te,Ue))}removeObjectState(Te){this._forEachSymbolLayerGraphic(Ue=>Ue.removeObjectState(Te))}_forEachGraphicList(Te,Ue){Te.forEach($e=>$e&&Ue($e))}_forEachSymbolLayerGraphic(Te){this._forEachGraphicList(this.graphics,Te),this._forEachGraphicList(this._auxiliaryGraphics,Te)}_forEachLabelGraphic(Te){this._forEachGraphicList(this._labelGraphics,Te)}_forEachRenderedGraphic(Te){this._forEachSymbolLayerGraphic(Te),this._forEachLabelGraphic(Te)}}var ue=v(93927),pe=v(63290),he=v(8314),me=v(26584),ge=v(58817),_e=v(16730),Ee=v(11915),De=v(30217),be=v(550),Se=v(28347),ye=v(43703),ve=v(60479),xe=v(79800),ze=v(82141),Ke=v(39256),We=v(59617),Ce=v(81468),Be=v(79112),Fe=v(18422),je=v(67225),Re=v(64538),Ie=(v(29132),v(42743)),Ge=v(52107),Pe=v(16396),Le=v(2004);function Me(ft){const Te=[[Pe.T.POSITION,ft.indices]],Ue=[[Pe.T.POSITION,{size:3,data:ft.attributeData.position,exclusive:!0}]];return(0,G.pC)(ft.attributeData.color)&&(Ue.push([Pe.T.COLOR,{size:4,data:ft.attributeData.color,exclusive:!0}]),Te.push([Pe.T.COLOR,new Array(ft.indices.length).fill(0)])),(0,G.pC)(ft.attributeData.uvMapSpace)&&(Ue.push([Pe.T.UVMAPSPACE,{size:4,data:ft.attributeData.uvMapSpace,exclusive:!0}]),Te.push([Pe.T.UVMAPSPACE,ft.indices])),(0,G.pC)(ft.attributeData.boundingRect)&&(Ue.push([Pe.T.BOUNDINGRECT,{size:9,data:ft.attributeData.boundingRect,exclusive:!0}]),Te.push([Pe.T.BOUNDINGRECT,ft.indices])),(0,G.pC)(ft.attributeData.mapPosition)&&(Ue.push([Pe.T.MAPPOS,{size:3,data:ft.attributeData.mapPosition,exclusive:!0}]),Te.push([Pe.T.MAPPOS,ft.indices])),new Ge.Z(Ue,Te,Ie.MX.Triangle,ft.attributeData.objectAndLayerIdColor)}function Ne(ft){const Te=[[Pe.T.POSITION,ft.indices],[Pe.T.UV0,ft.indices]],Ue=[[Pe.T.POSITION,{size:3,data:ft.attributeData.position,exclusive:!0}],[Pe.T.UV0,{size:2,data:ft.attributeData.uv0,exclusive:!0}]];return(0,G.pC)(ft.attributeData.mapPosition)&&(Ue.push([Pe.T.MAPPOS,{size:3,data:ft.attributeData.mapPosition,exclusive:!0}]),Te.push([Pe.T.MAPPOS,ft.indices])),new Ge.Z(Ue,Te)}function Xe(ft){switch(ft.type){case"extent":if(ft instanceof Le.Z)return te.Z.fromExtent(ft);break;case"polygon":return ft}return null}class Ye{constructor(Te,Ue,$e){this.renderData=Te,this.layerUid=Ue,this.graphicsUid=$e,this.outGeometries=new Array,this.outMaterials=new Array,this.outTransforms=new Array}}var Je=v(2180),rt=v(93605),tt=v(53929),et=v(85334),qe=v(64835);function ot(ft,Te,Ue,$e){const st=(0,et.Mk)(ft.rings,ft.hasZ,et.ZI.CCW_IS_HOLE),ht=new Float64Array(st.position.length),yt=(0,Ce.rR)(st.position,ft.spatialReference,0,ht,0,st.position,0,st.position.length/3,Te,Ue,$e),Rt=null!=yt;return new jt(st.position,ht,Ct(st.polygons,st.position,ht),_t(st.outlines,st.position,ht),Rt,yt)}function ut(ft,Te){const Ue=(0,et.Mk)(ft.rings,!1,et.ZI.CCW_IS_HOLE),$e=(0,ae.CM)(Ue.position,ft.spatialReference,0,Ue.position,Te,0,Ue.position.length/3);for(let st=2;st<Ue.position.length;st+=3)Ue.position[st]=qe.Rn;return{position:Ue.position,polygons:Ct(Ue.polygons,Ue.position),outlines:_t(Ue.outlines,Ue.position),projectionSuccess:$e}}function _t(ft,Te,Ue){return ft.filter(({count:$e})=>$e>1).map(({index:$e,count:st})=>{const ht=3*$e,yt=ht+3*st;return Ue?new Lt($e,st,Te.subarray(ht,yt),Ue.subarray(ht,yt)):new vt($e,st,Te.subarray(ht,yt))})}function Ct(ft,Te,Ue){const $e=new Array;for(const{index:st,count:ht,holeIndices:yt,pathLengths:Rt}of ft){if(ht<=1)continue;const Ut=3*st,er=Ut+3*ht,vr=yt.map(Pr=>Pr-st);$e.push({index:st,count:ht,holeIndices:vr,pathLengths:Rt,position:Te.subarray(Ut,er),mapPosition:Ue?Ue.subarray(Ut,er):void 0})}return $e}class vt{constructor(Te,Ue,$e){this.index=Te,this.count=Ue,this.position=$e}}class Lt extends vt{constructor(Te,Ue,$e,st){super(Te,Ue,$e),this.mapPosition=st}}class jt{constructor(Te,Ue,$e,st,ht,yt){this.position=Te,this.mapPosition=Ue,this.polygons=$e,this.outlines=st,this.projectionSuccess=ht,this.sampledElevation=yt}}var $t=v(96867),Wt=v(28523);const pr=["polygon","extent"];function ar(ft,Te,Ue,$e,st){const ht=new Array(ft.length).fill(0),yt=[[Pe.T.POSITION,{size:3,data:Ue.positions,exclusive:!0}],[Pe.T.NORMAL,{size:3,data:Ue.normals,exclusive:!0}],[Pe.T.COLOR,{size:4,data:$e,exclusive:!0}],[Pe.T.SIZE,{size:1,data:Ue.heights,exclusive:!0}]],Rt=[[Pe.T.POSITION,ft],[Pe.T.NORMAL,ft],[Pe.T.COLOR,ht]];return Ue.elevation&&(yt.push([Pe.T.MAPPOS,{size:3,data:Ue.elevation}]),Rt.push([Pe.T.MAPPOS,ft])),new Ge.Z(yt,Rt,Ie.MX.Triangle,st,Te)}function Fr(ft,Te,Ue,$e,st,ht,yt,Rt,Ut,er,vr,Pr,Ur){let Zr=0,Es=2*$e.count;!function mr(ft,Te,Ue,$e,st,ht,yt,Rt,Ut,er,vr,Pr,Ur,qr,Zr,Es,si){(0,H.c)(Lr,Es);const ei=Zr>0?1:-1;let Rs=3*Ue,fi=0,Pi=3*fi,mn=$e,Di=3*mn;for(let Li=0;Li<$e;++Li)si&&(Lr[0]=ft[Rs+0],Lr[1]=ft[Rs+1],Lr[2]=ft[Rs+2],(0,H.n)(Lr,Lr)),Rt[Pi+0]=ft[Rs+0],Rt[Pi+1]=ft[Rs+1],Rt[Pi+2]=ft[Rs+2],Ut[Pi+0]=Te[Rs+0],Ut[Pi+1]=Te[Rs+1],Ut[Pi+2]=Te[Rs+2],er[Pi+0]=-ei*Lr[0],er[Pi+1]=-ei*Lr[1],er[Pi+2]=-ei*Lr[2],vr[fi]=0,Rt[Di+0]=ft[Rs+0]+Zr*Lr[0],Rt[Di+1]=ft[Rs+1]+Zr*Lr[1],Rt[Di+2]=ft[Rs+2]+Zr*Lr[2],Ut[Di+0]=Te[Rs+0],Ut[Di+1]=Te[Rs+1],Ut[Di+2]=Te[Rs+2],er[Di+0]=ei*Lr[0],er[Di+1]=ei*Lr[1],er[Di+2]=ei*Lr[2],vr[mn]=Zr,Pi+=3,Di+=3,Rs+=3,fi+=1,mn+=1;Rs=3*ht,Pi=0,Di=3*qr;const qn=Zr<0?Jr:Qr,xa=Zr<0?Qr:Jr;for(let Li=0;Li<yt;++Li)Ur[Pi+0]=st[Rs+qn[0]],Ur[Pi+1]=st[Rs+qn[1]],Ur[Pi+2]=st[Rs+qn[2]],Pr[Di+0]=st[Rs+xa[0]]+$e,Pr[Di+1]=st[Rs+xa[1]]+$e,Pr[Di+2]=st[Rs+xa[2]]+$e,Pi+=3,Di+=3,Rs+=3}(ft,Te,$e.index,$e.count,Ue,0,Ue.length/3,st,ht,yt,Rt,Ut,er,Es,vr,Pr,Ur);let si=2*$e.count;Es=0,sr(st,ht,Rt,yt,Zr,$e.pathLengths[0],$e.count,si,Ut,Es,vr),si+=4*$e.pathLengths[0],Es+=2*$e.pathLengths[0],Zr+=$e.pathLengths[0];for(let ei=1;ei<$e.pathLengths.length;++ei)sr(st,ht,Rt,yt,Zr,$e.pathLengths[ei],$e.count,si,Ut,Es,vr),si+=4*$e.pathLengths[ei],Es+=2*$e.pathLengths[ei],Zr+=$e.pathLengths[ei]}function wt(ft,Te,Ue,$e,st,ht,yt){$e[ht]=$e[yt],ft[0+(ht*=3)]=ft[0+(yt*=3)],ft[ht+1]=ft[yt+1],ft[ht+2]=ft[yt+2],Te[ht+0]=Te[yt+0],Te[ht+1]=Te[yt+1],Te[ht+2]=Te[yt+2],Ue[ht+0]=st[0],Ue[ht+1]=st[1],Ue[ht+2]=st[2]}const or=(0,X.c)();function sr(ft,Te,Ue,$e,st,ht,yt,Rt,Ut,er,vr){let Pr=st,Ur=st+1,qr=st+yt,Zr=st+yt+1,Es=Rt,si=Rt+1,ei=Rt+2*ht,Rs=Rt+2*ht+1;vr<0&&(Pr=st+yt+1,Zr=st),er*=3;for(let fi=0;fi<ht;++fi)fi===ht-1&&(vr>0?(Ur=st,Zr=st+yt):(Ur=st,Pr=st+yt)),dr(ft,Pr,Ur,qr,or),wt(ft,Te,$e,Ue,or,Es,Pr),wt(ft,Te,$e,Ue,or,si,Ur),wt(ft,Te,$e,Ue,or,ei,qr),wt(ft,Te,$e,Ue,or,Rs,Zr),Ut[er++]=Es,Ut[er++]=ei,Ut[er++]=Rs,Ut[er++]=Es,Ut[er++]=Rs,Ut[er++]=si,Pr++,Ur++,qr++,Zr++,Es+=2,si+=2,ei+=2,Rs+=2}const rr=(0,X.c)(),Et=(0,X.c)(),St=(0,X.c)(),Ft=(0,X.c)(),zt=(0,X.c)();function dr(ft,Te,Ue,$e,st){Te*=3,Ue*=3,$e*=3,(0,H.s)(rr,ft[Te++],ft[Te++],ft[Te++]),(0,H.s)(Et,ft[Ue++],ft[Ue++],ft[Ue++]),(0,H.s)(St,ft[$e++],ft[$e++],ft[$e++]),(0,H.b)(Ft,Et,rr),(0,H.b)(zt,St,rr),(0,H.f)(st,zt,Ft),(0,H.n)(st,st)}const hr=(0,X.c)();function Tr(ft,Te,Ue,$e){const st=ft.stageObject,ht=st.geometryRecords,yt=ht.length,Rt="absolute-height"!==Te.mode;let Ut=0;const er=st.transformation,vr=(0,Se.a)((0,ye.c)(),er);for(let Pr=0;Pr<yt;Pr+=2){const Ur=ht[Pr].geometry,qr=Ur.getMutableAttribute(Pe.T.POSITION).data,Zr=Ur.vertexAttributes.get(Pe.T.SIZE).data,Es=Ur.vertexAttributes.get(Pe.T.MAPPOS).data,si=new tt.sb(Es),ei=qr.length/3;let Rs=0,fi=!1,Pi=0;const mn=Ue.spatialReference;for(let Di=0;Di<ei;Di++){hr[0]=qr[Rs],hr[1]=qr[Rs+1],hr[2]=qr[Rs+2],(0,Ce.qZ)(si,Ue,Te,$e,Hr),Rt&&(Pi+=Hr.sampledElevation),rt.Z.TESTS_DISABLE_OPTIMIZATIONS?((0,H.s)(Dr,si.array[si.offset+0],si.array[si.offset+1],Hr.z+Zr[Rs/3]),(0,G.pC)(mn)&&$e.toRenderCoords(Dr,mn,Dr),(0,H.m)(Dr,Dr,vr)):((0,H.s)(Dr,qr[Rs+0],qr[Rs+1],qr[Rs+2]),(0,H.m)(Dr,Dr,er),$e.setAltitude(Dr,Hr.z+Zr[Rs/3]),(0,H.m)(Dr,Dr,vr)),qr[Rs]=Dr[0],qr[Rs+1]=Dr[1],qr[Rs+2]=Dr[2];const qn=Ss/$e.unitInMeters;(Math.abs(hr[0]-qr[Rs])>=qn||Math.abs(hr[1]-qr[Rs+1])>=qn||Math.abs(hr[2]-qr[Rs+2])>=qn)&&(fi=!0),si.offset+=3,Rs+=3}fi&&(Ur.invalidateBoundingInfo(),st.geometryVertexAttrsUpdated(ht[Pr]),ht[Pr+1].geometry.invalidateBoundingInfo(),st.geometryVertexAttrsUpdated(ht[Pr+1])),Ut+=Pi/ei}return Ut/yt}const Dr=(0,X.c)(),Lr=(0,X.c)(),Hr=new Ce.Lm,Qr=[0,2,1],Jr=[0,1,2],Ss=.01;var Cs=v(91558),ct=(v(20383),v(23841)),At=v(21726),Kt=v(993),tr=v(4794),_r=v(46679),Or=v(33215),gs=v(86606),Kr=v(39236),qt=v(80960),Ir=v(46807),Sr=v(54840);class fs{constructor(Te,Ue,$e,st){this.graphics3DSymbolLayer=Te,this.renderGeometries=Ue,this.boundingBox=$e,this._drapeSourceRenderer=st,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(Te){this.stage=Te}setVisibility(Te){if(null!=this.stage&&this._visible!==Te){if(this._visible=Te,Te&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Sr.T.ADD);if(Te||this._addedToStage){for(const Ue of this.renderGeometries)Ue.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sr.$.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Sr.T.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(Te=(0,X.c)()){return(0,H.s)(Te,0,0,0)}getBoundingBoxObjectSpace(Te=(0,oe.Ue)()){return(0,oe.cS)(Te)}addObjectState(Te,Ue){Te===Ie.V_.Highlight&&(this.renderGeometries.forEach($e=>{const st=$e.addHighlight();Ue.addRenderGeometry($e,st,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sr.$.HIGHLIGHTS))}removeObjectState(Te){this.renderGeometries.forEach(Ue=>{Te.removeRenderGeometry(Ue)})}removeRenderGeometryObjectState(Te,Ue){Te.removeHighlight(Ue),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sr.$.HIGHLIGHTS)}computeAttachmentOrigin(Te){for(const Ue of this.renderGeometries)Ue.computeAttachmentOrigin(gt)&&(Te.draped.origin[0]+=gt[0],Te.draped.origin[1]+=gt[1],Te.draped.num++)}getProjectedBoundingBox(Te,Ue,$e,st,ht){var yt=this;return(0,D.Z)(function*(){(0,oe.cS)(ht);for(let Rt=0;Rt<yt.renderGeometries.length;Rt++)yt._getRenderGeometryProjectedBoundingRect(yt.renderGeometries[Rt],Te,at,$e),(0,oe.VK)(ht,at);if(Ue){let Rt;(0,oe.be)(ht,gt);const Ut=(0,je.Si)(ht,Ue.service.spatialReference,Ue);try{Rt=yield Ue.service.queryElevation(gt[0],gt[1],st,Ut,"ground")}catch{}(0,G.pC)(Rt)&&(ht[2]=Math.min(ht[2],Rt),ht[5]=Math.max(ht[5],Rt))}return ht})()}_getRenderGeometryProjectedBoundingRect(Te,Ue,$e,st){if(this.boundingBox)(0,oe.t8)(bt,this.boundingBox);else{const ht=Te.boundingSphere,yt=ht[3];bt[0]=ht[0]-yt,bt[1]=ht[1]-yt,bt[2]=ht[2]-yt,bt[3]=ht[0]+yt,bt[4]=ht[1]+yt,bt[5]=ht[2]+yt}return Ue(bt,0,2),this.calculateRelativeScreenBounds&&st.push({location:(0,oe.be)(bt),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,oe.y8)(bt,$e)}}const at=(0,le.Ue)(),bt=(0,oe.Ue)(),gt=(0,X.c)();var as,Ps,Fs,ft,Gt=v(75688),fr=v(92690),Ar=v(21286),us=v(21254);function xs(ft){return null!=ft}function Ws(ft){return"number"==typeof ft}function yi(ft){return"string"==typeof ft}function oi(ft,Te){ft&&ft.push(Te)}function pn(ft,Te,Ue,$e,st){const ht=ft.minSize,yt=ft.maxSize;if(ft.expression)return oi(st,"Could not convert size info: expression not supported"),!1;if(ft.useSymbolValue){const Rt=$e.symbolSize[Ue];return Te.minSize[Ue]=Rt,Te.maxSize[Ue]=Rt,Te.offset[Ue]=Te.minSize[Ue],Te.factor[Ue]=0,Te.type[Ue]=as.DefinedSize,!0}if(xs(ft.field))return xs(ft.stops)?2===ft.stops.length&&Ws(ft.stops[0].size)&&Ws(ft.stops[1].size)?(Bl(ft.stops[0].size,ft.stops[1].size,ft.stops[0].value,ft.stops[1].value,Te,Ue),Te.type[Ue]=as.DefinedSize,!0):(oi(st,"Could not convert size info: stops only supported with 2 elements"),!1):Ws(ht)&&Ws(yt)&&xs(ft.minDataValue)&&xs(ft.maxDataValue)?(Bl(ht,yt,ft.minDataValue,ft.maxDataValue,Te,Ue),Te.type[Ue]=as.DefinedSize,!0):null!=us.a[ft.valueUnit]?(Te.minSize[Ue]=-1/0,Te.maxSize[Ue]=1/0,Te.offset[Ue]=0,Te.factor[Ue]=1/us.a[ft.valueUnit],Te.type[Ue]=as.DefinedSize,!0):"unknown"===ft.valueUnit?(oi(st,"Could not convert size info: proportional size not supported"),!1):(oi(st,"Could not convert size info: scale-dependent size not supported"),!1);if(!xs(ft.field)){if(ft.stops&&ft.stops[0]&&Ws(ft.stops[0].size))return Te.minSize[Ue]=ft.stops[0].size,Te.maxSize[Ue]=ft.stops[0].size,Te.offset[Ue]=Te.minSize[Ue],Te.factor[Ue]=0,Te.type[Ue]=as.DefinedSize,!0;if(Ws(ht))return Te.minSize[Ue]=ht,Te.maxSize[Ue]=ht,Te.offset[Ue]=ht,Te.factor[Ue]=0,Te.type[Ue]=as.DefinedSize,!0}return oi(st,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Bl(ft,Te,Ue,$e,st,ht){const yt=Math.abs($e-Ue)>0?(Te-ft)/($e-Ue):0;st.minSize[ht]=yt>0?ft:Te,st.maxSize[ht]=yt>0?Te:ft,st.offset[ht]=ft-Ue*yt,st.factor[ht]=yt}function qi(ft,Te,Ue){ft[4*Te+0]=Ue.r/255,ft[4*Te+1]=Ue.g/255,ft[4*Te+2]=Ue.b/255,ft[4*Te+3]=Ue.a}function ui(ft,Te,Ue){const $e=2===Ue&&"arithmetic"===ft.rotationType;Te.offset[Ue]=$e?90:0,Te.factor[Ue]=$e?-1:1,Te.type[Ue]=1}function kt(ft,Te,Ue){if(!ft)return null;const $e=!Te.supportedTypes||!!Te.supportedTypes.size,st=!Te.supportedTypes||!!Te.supportedTypes.color,ht=!Te.supportedTypes||!!Te.supportedTypes.rotation,yt=!!Te.supportedTypes&&!!Te.supportedTypes.opacity,Rt=ft.reduce((Ut,er)=>{if(!Ut)return Ut;if(er.valueExpression)return oi(Ue,"Could not convert visual variables: arcade expressions not supported"),null;switch(er.type){case"size":return $e?function yo(ft,Te,Ue,$e){if(ft.normalizationField||ft.valueRepresentation)return oi($e,"Could not convert size info: unsupported property"),null;if(!function hn(ft){return null==ft||yi(ft)}(ft.field))return oi($e,"Could not convert size info: field is not a string"),null;if(Te.size){if(ft.field)if(Te.size.field){if(ft.field!==Te.size.field)return oi($e,"Could not convert size info: multiple fields in use"),null}else Te.size.field=ft.field}else Te.size={field:ft.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[as.Undefined,as.Undefined,as.Undefined]};let st;switch(ft.axis){case"width":return st=pn(ft,Te.size,0,Ue,$e),st?Te:null;case"height":return st=pn(ft,Te.size,2,Ue,$e),st?Te:null;case"depth":return st=pn(ft,Te.size,1,Ue,$e),st?Te:null;case"width-and-depth":return st=pn(ft,Te.size,0,Ue,$e),st&&pn(ft,Te.size,1,Ue,$e),st?Te:null;case null:case void 0:case"all":return st=pn(ft,Te.size,0,Ue,$e),st=st&&pn(ft,Te.size,1,Ue,$e),st=st&&pn(ft,Te.size,2,Ue,$e),st?Te:null;default:return oi($e,`Could not convert size info: unknown axis "${ft.axis}""`),null}}(er,Ut,Te,Ue):Ut;case"color":return st?function jr(ft,Te,Ue){if(ft.normalizationField)return oi(Ue,"Could not convert color info: unsupported property"),null;if(yi(ft.field)){if(!ft.stops)return oi(Ue,"Could not convert color info: missing stops or colors"),null;{if(ft.stops.length>8)return oi(Ue,"Could not convert color info: too many color stops"),null;Te.color={field:ft.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const $e=ft.stops;for(let st=0;st<8;++st){const ht=$e[Math.min(st,$e.length-1)];Te.color.values[st]=ht.value,qi(Te.color.colors,st,ht.color)}}}else{if(!(ft.stops&&ft.stops.length>=0))return oi(Ue,"Could not convert color info: no field and no colors/stops"),null;{const $e=ft.stops&&ft.stops.length>=0&&ft.stops[0].color;Te.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let st=0;st<8;st++)Te.color.values[st]=1/0,qi(Te.color.colors,st,$e)}}return Te}(er,Ut,Ue):Ut;case"opacity":return yt?function Gi(ft,Te,Ue){if(ft.normalizationField)return oi(Ue,"Could not convert opacity info: unsupported property"),null;if(yi(ft.field)){if(!ft.stops)return oi(Ue,"Could not convert opacity info: missing stops or opacities"),null;{if(ft.stops.length>8)return oi(Ue,"Could not convert opacity info: too many opacity stops"),null;Te.opacity={field:ft.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const $e=ft.stops;for(let st=0;st<8;++st){const ht=$e[Math.min(st,$e.length-1)];Te.opacity.values[st]=ht.value,Te.opacity.opacityValues[st]=ht.opacity}}}else{if(!(ft.stops&&ft.stops.length>=0))return oi(Ue,"Could not convert opacity info: no field and no opacities/stops"),null;{const $e=ft.stops&&ft.stops.length>=0&&ft.stops[0].opacity;Te.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let st=0;st<8;st++)Te.opacity.values[st]=1/0,Te.opacity.opacityValues[st]=$e}}return Te}(er,Ut,Ue):null;case"rotation":return ht?function zn(ft,Te,Ue){if(!yi(ft.field))return oi(Ue,"Could not convert rotation info: field is not a string"),null;if(Te.rotation){if(ft.field)if(Te.rotation.field){if(ft.field!==Te.rotation.field)return oi(Ue,"Could not convert rotation info: multiple fields in use"),null}else Te.rotation.field=ft.field}else Te.rotation={field:ft.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(ft.axis){case"tilt":return ui(ft,Te.rotation,0),Te;case"roll":return ui(ft,Te.rotation,1),Te;case null:case void 0:case"heading":return ui(ft,Te.rotation,2),Te;default:return oi(Ue,`Could not convert rotation info: unknown axis "${ft.axis}""`),null}}(er,Ut,Ue):Ut;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(ft.length>0&&Rt)||Rt.size||Rt.color||Rt.opacity||Rt.rotation?Rt&&Rt.size&&!function Yo(ft,Te,Ue){for(let st=0;st<3;++st){let ht=Te.unitInMeters;ft.type[st]===as.DefinedSize&&(ht*=Te.modelSize[st],ft.type[st]=as.DefinedScale),ft.minSize[st]=ft.minSize[st]/ht,ft.maxSize[st]=ft.maxSize[st]/ht,ft.offset[st]=ft.offset[st]/ht,ft.factor[st]=ft.factor[st]/ht}let $e;if(ft.type[0]!==as.Undefined)$e=0;else if(ft.type[1]!==as.Undefined)$e=1;else{if(ft.type[2]===as.Undefined)return oi(Ue,"No size axis contains a valid size or scale"),!1;$e=2}for(let st=0;st<3;++st)ft.type[st]===as.Undefined&&(ft.minSize[st]=ft.minSize[$e],ft.maxSize[st]=ft.maxSize[$e],ft.offset[st]=ft.offset[$e],ft.factor[st]=ft.factor[$e],ft.type[st]=ft.type[$e]);return!0}(Rt.size,Te,Ue)?null:Rt:null}function Qt(ft){return ft&&null!=ft.size}function Vt(ft,Te){if(!ft)return{enabled:!1};if(rt.Z.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const Ue=kt(ft.visualVariables,Te);return Ue?{enabled:!0,visualVariables:Ue,materialParameters:js(Ue,Te),requiresShaderTransformation:Qt(Ue)}:{enabled:!1}}function yr(ft,Te,Ue){if(!Te||!ft.enabled)return!1;const $e=ft.visualVariables,st=kt(Te.visualVariables,Ue);return!!st&&!!(ys($e.size,st.size,"size")&&ys($e.color,st.color,"color")&&ys($e.rotation,st.rotation,"rotation")&&ys($e.opacity,st.opacity,"opacity"))&&(ft.visualVariables=st,ft.materialParameters=js(st,Ue),ft.requiresShaderTransformation=Qt(st),!0)}function ys(ft,Te,Ue){if(!!ft!=!!Te||ft&&ft.field!==Te.field)return!1;if(ft&&"rotation"===Ue){const $e=ft,st=Te;for(let ht=0;ht<3;ht++)if($e.type[ht]!==st.type[ht]||$e.offset[ht]!==st.offset[ht]||$e.factor[ht]!==st.factor[ht])return!1}return!0}function js(ft,Te){const Ue={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},$e=Qt(ft);return ft&&ft.size?(Ue.vvSizeEnabled=!0,Ue.vvSizeMinSize=ft.size.minSize,Ue.vvSizeMaxSize=ft.size.maxSize,Ue.vvSizeOffset=ft.size.offset,Ue.vvSizeFactor=ft.size.factor):ft&&$e&&(Ue.vvSizeValue=Te.transformation.scale),ft&&$e&&(Ue.vvSymbolAnchor=Te.transformation.anchor,Ue.vvSymbolRotationMatrix=(0,be.c)(),(0,Se.i)(Ls),function kn(ft,Te,Ue,$e=(0,ye.c)()){const st=ft||0,ht=Te||0,yt=Ue||0;0!==st&&(0,Se.o)($e,$e,-st/180*Math.PI),0!==ht&&(0,Se.r)($e,$e,ht/180*Math.PI),0!==yt&&(0,Se.n)($e,$e,yt/180*Math.PI)}(Te.transformation.rotation[2],Te.transformation.rotation[0],Te.transformation.rotation[1],Ls),(0,De.f)(Ue.vvSymbolRotationMatrix,Ls)),ft&&ft.color&&(Ue.vvColorEnabled=!0,Ue.vvColorValues=ft.color.values,Ue.vvColorColors=ft.color.colors),ft&&ft.opacity&&(Ue.vvOpacityEnabled=!0,Ue.vvOpacityValues=ft.opacity.values,Ue.vvOpacityOpacities=ft.opacity.opacityValues),Ue}(ft=as||(as={}))[ft.Undefined=0]="Undefined",ft[ft.DefinedSize=1]="DefinedSize",ft[ft.DefinedScale=2]="DefinedScale",function(ft){ft[ft.Undefined=0]="Undefined",ft[ft.DefinedAngle=1]="DefinedAngle"}(Ps||(Ps={})),function(ft){const Te=(0,ye.c)(),Ue=(0,X.c)();ft.evaluateModelTransform=function $e(ht,yt,Rt){if(!ht.vvSizeEnabled)return Rt;(0,Se.c)(Te,Rt);const Ut=ht.vvSymbolRotationMatrix;(0,Se.s)(Ls,Ut[0],Ut[1],Ut[2],0,Ut[3],Ut[4],Ut[5],0,Ut[6],Ut[7],Ut[8],0,0,0,0,1),(0,Se.m)(Te,Te,Ls);for(let er=0;er<3;++er)Ue[er]=(0,Ar.uZ)(ht.vvSizeOffset[er]+yt[0]*ht.vvSizeFactor[er],ht.vvSizeMinSize[er],ht.vvSizeMaxSize[er]);return(0,Se.k)(Te,Te,Ue),(0,Se.v)(Te,Te,ht.vvSymbolAnchor),Te},ft.evaluateModelTransformScale=function st(ht,yt,Rt){if(!yt.vvSizeEnabled)return(0,H.s)(ht,1,1,1);for(let Ut=0;Ut<3;++Ut)ht[Ut]=(0,Ar.uZ)(yt.vvSizeOffset[Ut]+Rt[0]*yt.vvSizeFactor[Ut],yt.vvSizeMinSize[Ut],yt.vvSizeMaxSize[Ut]);return ht}}(Fs||(Fs={}));const Ls=(0,ye.c)(),Os=Fs.evaluateModelTransform,$s=Fs.evaluateModelTransformScale;var As=v(8782),xi=v(57521),en=v(53855),Mo=v(81695),na=v(80805),Po=v(94398);const ja=(0,ye.c)(),An=(0,X.f)(0,0,1),Ma=As.Ns,Ei=[Ma/2,Ma/2,1-Ma/2,1-Ma/2],nc=[As.Ph*Ma,As.Ph*Ma];class Jn extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}doLoad(Te){var Ue=this;return(0,D.Z)(function*(){Ue._validateOrThrow();const $e=Ue._prepareMaterialParameters(),st=Ue._getPrimitive();if((0,G.pC)(st))Ue._prepareResourcesPrimitive($e,st);else{const ht=(0,gs.nf)(Ue.symbol,Ue.symbolLayer),yt=(0,At.sJ)(ht);yt&&"application/json"===yt.mediaType?yield Ue._prepareResourcesCIM($e,JSON.parse(yt.data),Te):yield Ue._prepareResourcesHref($e,ht,Te)}})()}_validateOrThrow(){if(this._drivenProperties.size)return;const Te=(0,je.bh)(this._getIconSize());if(Te)throw new me.Z("graphics3diconsymbollayer:invalid-size",Te)}_getIconSize(){const Te=this.symbolLayer,Ue=Math.round(null!=Te.size?(0,ct.F2)(Te.size):16);return this._drivenProperties.size?Math.max(Ue,64):Ue}_generateTextureCIM(Te){const Ue=this._getGraphicHash(Te);let $e=""===Ue?null:this._cimSymbolTextures.get(Ue);if(!$e){const ht=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,Te,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ht.anchorPosition),$e=new Mo.x(ht.imageData,{width:ht.imageData.width,height:ht.imageData.height,powerOfTwoResizeMode:Ie.CE.PAD}),this._cimSymbolTextures.set(Ue,$e),this._context.stage.add($e)}return $e}_computeSize(Te,Ue){const $e=Te.width/Te.height;return $e>1?[Ue,Math.round(Ue/$e)]:[Math.round(Ue*$e),Ue]}_prepareMaterialParameters(){const Te={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},Ue=this.symbol;if(function jl(ft){return ft&&"point-3d"===ft.type&&ft.hasVisibleVerticalOffset()}(Ue)){const{screenLength:$e,minWorldLength:st,maxWorldLength:ht}=Ue.verticalOffset;Te.verticalOffset={screenLength:(0,ct.F2)($e),minWorldLength:st||0,maxWorldLength:(0,G.pC)(ht)?ht:1/0}}return this._context.screenSizePerspectiveEnabled&&(Te.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),Te.occlusionTest=!0,Te.hasSlicePlane=this._context.slicePlaneEnabled,Te}_prepareResourcesPrimitive(Te,Ue){const $e=this._getOutlineSize();if(oc(Ue)&&0===$e)throw new Error("Nothing to render");if(this._outlineSize=$e,Te.color=this._getFillColor(),Te.outlineColor=this._getOutlineColor(),Te.outlineSize=this._outlineSize,(0,G.pC)(this._context.sharedResources.textures)){const ht=this._context.sharedResources.textures.fromData(`${Ue}-icon`,()=>(0,As.cU)(Ue));this._texture=ht.texture,this._releaseTexture=ht,Te.textureId=this._texture.id}Te.textureIsSignedDistanceField=!0,Te.distanceFieldBoundingBox=Ei;const st=this._getIconSize();this._size=[st,st],this._symbolTextureRatio=1/Ma,this._createMaterialAndAddToStage(Te,this._context.stage)}_prepareResourcesHref(Te,Ue,$e){var st=this;return(0,D.Z)(function*(){if(!(0,he.Z)("esri-canvas-svg-support")&&(0,At.zd)(Ue))throw new me.Z("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");st._outlineSize=st._getOutlineSize(),Te.color=st._getFillColor(),Te.outlineColor=st._getOutlineColor(),Te.outlineSize=st._outlineSize,Te.textureIsSignedDistanceField=!1;const ht=st._getIconSize(),yt=ht*st._context.graphicsCoreOwner.view.state.pixelRatio;if((0,G.pC)(st._context.sharedResources.textures)){const Rt=yield(0,R.q6)(st._context.sharedResources.textures.fromUrl(Ue,yt,{signal:$e}));if(!1===Rt.ok)throw(0,Z.r9)(Rt.error),new me.Z("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${Ue})`);st._releaseTexture=Rt.value;const Ut=Rt.value.texture;st._size=st._computeSize(Ut.params,ht),Te.textureId=Ut.id}st._createMaterialAndAddToStage(Te,st._context.stage)})()}_prepareResourcesCIM(Te,Ue,$e){var st=this;return(0,D.Z)(function*(){const ht=new Po.Z({data:Ue});if(!st._context.sharedResources.cimSymbolRasterizer){const Pr=(yield Promise.all([v.e(3751),v.e(3678),v.e(8899)]).then(v.bind(v,52351))).CIMSymbolRasterizer;(0,Z.k_)($e),st._context.sharedResources.cimSymbolRasterizer||(st._context.sharedResources.cimSymbolRasterizer=new Pr(st._context.renderCoordsHelper.spatialReference,!0))}const yt=st._context.layer.fields?st._context.layer.fields.map(Pr=>Pr.toJSON()):null;let Rt,Ut;if(st._cimLayers=yield st._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(ht,yt,st._context.renderer&&"dictionary"===st._context.renderer.type?st._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:$e}),st._context.renderer&&"dictionary"===st._context.renderer.type&&st._context.renderer.scaleExpression){const Pr=st._context.renderer;if(isNaN(Pr.scaleExpression)){const Ur=Pr.scaleExpression,qr=yield(0,_r.Yi)(Ur,st._context.layer.spatialReference,yt);Ut=(Zr,Es,si)=>{const ei=(0,Kr.Z)(qr,Zr,{$view:si},"esriGeometryPoint",Es);return null!==ei?ei:1}}else Rt=Number(Pr.scaleExpression)}st._cimScaleFactorOrFunction=Rt||Ut||1;const er=st._context.renderer?yield st._context.renderer.getRequiredFields(st._context.layer.fieldsIndex):[];(0,Z.k_)($e);const vr=st._context.layer.fieldsIndex;st._cimRequiredFields=er.map(Pr=>vr.get(Pr).name),st._cimMaterialParametersInfo=Te,st._cimMaterialParametersInfo.color=st._getFillColor(),st._cimMaterialParametersInfo.outlineColor=[0,0,0,0],st._cimMaterialParametersInfo.outlineSize=0,st._cimMaterialParametersInfo.textureIsSignedDistanceField=!1})()}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Or.S}_getOutlineSize(){let Te=0;const Ue=this.symbolLayer;return(0,G.pC)(Ue.outline)&&null!=Ue.outline.size?Math.max((0,ct.F2)(Ue.outline.size),0):(Te=oc(this._getPrimitive())?1.5:0,Math.max(Te,0))}_getOutlineColor(){const Te=this._getLayerOpacity(),$e=(0,G.U2)(this.symbolLayer,"outline","color");if((0,G.pC)($e)){const st=Cs.Z.toUnitRGB($e);return[st[0],st[1],st[2],$e.a*Te]}return[0,0,0,0]}_getFillColor(){if(oc(this._getPrimitive()))return qt.r;const Te=(0,G.Wi)(this._getPrimitive()),Ue=(0,G.U2)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(Ue,{hasIntrinsicColor:Te})}_getAnchorPos(Te,Ue){return"relative"===Te?(0,B.f)((Ue.x||0)+.5,.5-(Ue.y||0)):Te in Gt.yY?Gt.yY[Te]:Gt.yY.center}_createMaterialAndAddToStage(Te,Ue){if(this._fastUpdates=this._cimLayers?{enabled:!1}:Vt(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(Te,this._fastUpdates.materialParameters),this._cimLayers){let $e=(0,G.pC)(Te.textureId)?this._cimSymbolMaterials.get(Te.textureId):null;return $e||($e=new na.A(Te),this._cimSymbolMaterials.set((0,G.Pt)(Te.textureId,0),$e),Ue.add($e)),$e}return this._material=new na.A(Te),Ue.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(Te=>{Te.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(Te=>this._context.stage.remove(Te)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(Te=>this._context.stage.remove(Te)),this._cimSymbolTextures.clear(),this._releaseTexture=(0,G.RY)(this._releaseTexture)}_getScaleFactor(Te,Ue){if(this._drivenProperties.size&&Te.size){for(let $e=0;$e<3;$e++){const st=Te.size[$e];st&&"symbol-value"!==st&&"proportional"!==st&&(Te.size[$e]=(0,ct.F2)(st))}if("symbol-value"===Te.size[0])return 1;if(isFinite(+Te.size[0]))return+Te.size[0]/Ue;if(isFinite(+Te.size[2]))return+Te.size[2]/Ue}return 1}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry))return null;let $e,st;if(this._cimLayers){if(!this._cimLayers.length)return null;const Pr=this._generateTextureCIM(Ue),Ur={textureId:Pr.id,...this._cimMaterialParametersInfo};st=this._createMaterialAndAddToStage(Ur,this._context.stage),$e=[Pr.params.width,Pr.params.height]}else $e=this._size,st=(0,G.Wg)(this._material);const ht=(0,fr.S_)(Ue.geometry);if((0,G.Wi)(ht))return this.logger.warn(`unsupported geometry type for icon symbol: ${Ue.geometry.type}`),null;const yt=Te.renderingInfo,Rt=this._getVertexOpacityAndColor(yt);let Ut=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(Ut=this._getScaleFactor(yt,$e[0]>$e[1]?$e[0]:$e[1])),Ut*=this._symbolTextureRatio;const er=[$e[0]*Ut,$e[1]*Ut],vr=this.setGraphicElevationContext(Ue,new Be.o);return this.ensureDrapedStatus("on-the-ground"===vr.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(Ue,ht,st,Rt,er,Te.layer.uid):this._createAs3DShape(Ue,ht,st,Rt,er,vr,Ue.uid)}layerOpacityChanged(){const Te=this._getFillColor(),Ue=this._getOutlineColor();this._forEachMaterial($e=>{$e.setParameters({color:Te}),$e.setParameters({outlineColor:Ue})})}layerElevationInfoChanged(Te,Ue,$e){const st=this._elevationContext.mode,ht=(0,Ce.GC)(Jn.elevationModeChangeTypes,$e,st);if(ht!==Ce.lO.UPDATE)return ht;const yt=(0,Ce.Xf)(st)||"absolute-height"===st;return this.updateGraphics3DGraphicElevationInfo(Te,Ue,()=>yt)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(Te=>{Te.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(Te,Ue){for(const $e in Te.diff){if("visualVariables"!==$e||!yr(this._fastUpdates,Ue,this._fastVisualVariableConvertOptions()))return Re.W.Recreate_Symbol;(0,G.pC)(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Re.W.Fast_Update}_defaultElevationInfoNoZ(){return Lo}_createAs3DShape(Te,Ue,$e,st,ht,yt,Rt){const Ut=this.getFastUpdateAttrValues(Te),er=Ut?Zr=>Os(this._fastUpdates.materialParameters,Ut,Zr):null,vr=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:Rt,layerUid:this._context.layer.uid}),Pr=[(0,xi.dV)(An,null,st,ht,Fa,null,Ut,vr)],Ur=(0,fr.km)(this._context,Ue,Pr,[$e],yt,this._context.layer.uid,Rt,er);if(null===Ur)return null;const qr=new ue.z(this,Ur.object,Pr,null,null,Ir.j3,yt);return qr.alignedSampledElevation=Ur.sampledElevation,qr.needsElevationUpdates=(0,Ce.Xf)(yt.mode)||"absolute-height"===yt.mode,qr.getScreenSize=this._createScreenSizeGetter(ht,er),qr.calculateRelativeScreenBounds=Zr=>$e.calculateRelativeScreenBounds(qr.getScreenSize(),1,Zr),(0,fr.dO)(qr,Ue,this._context.elevationProvider),qr}_createAsOverlay(Te,Ue,$e,st,ht,yt){$e.renderPriority=this._renderPriority;const Rt=(0,tr.c)();(0,ae.KC)(Ue,Rt,this._context.overlaySR),Rt[2]=qe.Rn;const Ut=this._context.clippingExtent;if((0,G.pC)(Ut)&&!(0,oe.BD)(Ut,Rt))return null;const er=this.getFastUpdateAttrValues(Te),vr=er?Es=>Os(this._fastUpdates.materialParameters,er,Es):null,Pr=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:Te.uid,layerUid:this._context.layer.uid}),Ur=(0,xi.dV)(An,Rt,st,ht,null,null,er,Pr),qr=new en.z(Ur,$e,{layerUid:yt,graphicUid:Te.uid,calculateShaderTransformation:vr});Rt[3]=0,(0,Kt.c)(qr.boundingSphere,Rt);const Zr=new fs(this,[qr],null,this._context.drapeSourceRenderer);return Zr.getScreenSize=this._createScreenSizeGetter(ht,vr),Zr.calculateRelativeScreenBounds=Es=>$e.calculateRelativeScreenBounds(Zr.getScreenSize(),1,Es),Zr}_createScreenSizeGetter(Te,Ue){const $e=this._outlineSize+2;if(this._fastUpdates.enabled){const st=Te[0]/this._symbolTextureRatio,ht=Te[1]/this._symbolTextureRatio;return(yt=(0,B.a)())=>{const Rt=Ue(ja);return yt[0]=Rt[0]*st+$e,yt[1]=Rt[5]*ht+$e,yt}}{const st=Te[0]/this._symbolTextureRatio+$e,ht=Te[1]/this._symbolTextureRatio+$e;return(yt=(0,B.a)())=>(yt[0]=st,yt[1]=ht,yt)}}_fastVisualVariableConvertOptions(){const Te=this._size[0]>this._size[1]?this._size[0]:this._size[1],Ue=(0,X.f)(Te,Te,Te),$e=(0,ct.Wz)(1),st=Te*$e;return{modelSize:Ue,symbolSize:(0,X.f)(st,st,st),unitInMeters:$e,transformation:{anchor:X.Z,scale:X.O,rotation:X.Z}}}_getGraphicHash(Te){let Ue="";for(const $e of this._cimRequiredFields)Ue+=$e+Te.attributes[$e];return Ue}_forEachMaterial(Te){(0,G.pC)(this._material)&&Te(this._material),this._cimSymbolMaterials.forEach(Te)}test(){return{...super.test(),material:this._material}}}function oc(ft){return!(0,G.Wi)(ft)&&("cross"===ft||"x"===ft)}Jn.PRIMITIVE_SIZE=nc,Jn.elevationModeChangeTypes={definedChanged:Ce.lO.UPDATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const Lo={mode:"relative-to-ground",offset:0},Fa=(0,tr.f)(0,0,0,1);var Pa=v(39401);function cr(ft){switch(ft){case"butt":return Pa.R.BUTT;case"square":return Pa.R.SQUARE;case"round":return Pa.R.ROUND;default:return null}}var vs=v(79020),Ri=v(81805);function Uo(ft,Te,Ue){const $e=new Array;for(const{index:st,count:ht}of ft){if(ht<=1)continue;const yt=3*st,Rt=yt+3*ht;$e.push({position:Te.subarray(yt,Rt),mapPosition:Ue?Ue.subarray(yt,Rt):void 0})}return $e}var Na=v(70591),Ot=v(54889),It=v(92222);const Xt=["polyline","polygon","extent"];class ur extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st)}doLoad(){var Te=this;return(0,D.Z)(function*(){if(Te._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},Te._fastUpdates=Te._context.renderer&&Te._context.renderer.visualVariables&&Te._context.renderer.visualVariables.length>0?Vt(Te._context.renderer,Te._vvConvertOptions):{enabled:!1},!Te._drivenProperties.size&&(null!=Te.symbolLayer.size?Te.symbolLayer.size:(0,ct.Wz)(1))<0)throw new me.Z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");Te._markerTexture=(0,G.pC)(Te.symbolLayer.marker)&&(0,G.pC)(Te._context.sharedResources.textures)?(0,Ri.uM)(Te._context.sharedResources.textures,function ns(ft){return"diamond"===ft?"kite":ft}(Te.symbolLayer.marker.style)):null})()}_getMaterialParameters(Te,Ue=!1){const $e=this._getCombinedOpacityAndColor(Ue&&this._markerColor||this._materialColor);this._patternHidesLine&&!Ue&&($e[3]=0);const st={width:this._computeMaterialWidth(this.symbolLayer?.size),color:$e,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:cr(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:Te,stipplePattern:(0,Ot.Dp)(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...st,...this._fastUpdates.materialParameters}:st}get _materialColor(){return(0,G.yw)(this.symbolLayer.material,Te=>Te.color)}get _markerColor(){return(0,G.yw)(this.symbolLayer.marker,Te=>Te.color)}get _lineMaterial(){return(0,G.Wi)(this._lineMaterialCached)&&(this._lineMaterialCached=new It.U(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return(0,G.Wi)(this._ringMaterialCached)&&(this._ringMaterialCached=new It.U(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return(0,G.Wi)(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new It.U({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return(0,G.Wi)(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new It.U({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return(0,G.Wi)(this._markerMaterialCached)&&(0,G.pC)(this.symbolLayer.marker)&&(0,G.pC)(this._markerTexture)&&(this._markerMaterialCached=new Na.X({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(Te=>this._context.stage.remove(Te)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=(0,G.RY)(this._markerTexture)}_getDrivenSize(Te){return this._drivenProperties.size&&Te.size?(0,ct.F2)((0,Ke.o2)(Te.size)):1}_getSizeFeatureAttributeData(Te){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,Fe.d)(this._fastUpdates.visualVariables.size.field,Te):null}_getDrivenColor(Te){const Ue=(0,tr.f)(1,1,1,1);return this._drivenProperties.color&&Te.color&&(Ue[0]=Te.color[0],Ue[1]=Te.color[1],Ue[2]=Te.color[2],Te.color.length>0&&(Ue[3]=Te.color[3])),this._drivenProperties.opacity&&Te.opacity&&(Ue[3]=Te.opacity),Ue}_getColorFeatureAttributeData(Te){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(0,Fe.d)(this._fastUpdates.visualVariables.color.field,Te):null}_getOpacityFeatureAttributeData(Te){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?(0,Fe.d)(this._fastUpdates.visualVariables.opacity.field,Te):null}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,Xt,this.symbolLayer.type))return null;const $e=this.setGraphicElevationContext(Ue,new Be.o);return this.ensureDrapedStatus("on-the-ground"===$e.mode),this.draped?this._createAsOverlay(Te,this._context.layer.uid):this._createAs3DShape(Te,$e,Ue.uid)}applyRendererDiff(Te,Ue){for(const $e in Te.diff){if("visualVariables"!==$e||!yr(this._fastUpdates,Ue,this._vvConvertOptions))return Re.W.Recreate_Symbol;this._forEachMaterial(st=>st.setParameters(this._fastUpdates.materialParameters))}return Re.W.Fast_Update}prepareSymbolLayerPatch(Te){if("partial"!==Te.diff.type)return;const Ue=Te.diff.diff,$e={};"complete"===Ue.size?.type&&($e.width=this._computeMaterialWidth(Ue.size.newValue),delete Ue.size),"complete"===Ue.cap?.type&&($e.cap=cr((0,G.Pt)(Ue.cap.newValue,"butt")),delete Ue.cap);const st=this._prepareMarkerPatch(Te,Ue);this._prepareMaterialPatch(Te,Ue,st),Te.symbolLayerStatePatches.push(()=>this._forEachMaterial(ht=>ht.setParameters($e)))}layerOpacityChanged(){this._forEachMaterial((Te,Ue)=>this._updateMaterialLayerOpacity(Te,Ue))}_forEachMaterial(Te){(0,G.pC)(this._lineMaterialCached)&&Te(this._lineMaterialCached),(0,G.pC)(this._ringMaterialCached)&&Te(this._ringMaterialCached),(0,G.pC)(this._wireframeLineMaterialCached)&&Te(this._wireframeLineMaterialCached),(0,G.pC)(this._wireframeRingMaterialCached)&&Te(this._wireframeRingMaterialCached),(0,G.pC)(this._markerMaterialCached)&&Te(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(Te,Ue=!1){const $e=Te.parameters.color,st=(0,G.U2)(this.symbolLayer,"material","color"),ht=this._patternHidesLine&&!Ue?0:this._getCombinedOpacity(st),yt=(0,tr.f)($e[0],$e[1],$e[2],ht);Te.setParameters({color:yt})}layerElevationInfoChanged(Te,Ue,$e){const st=this._elevationContext.mode,ht=(0,Ce.GC)(ur.elevationModeChangeTypes,$e,st);if(ht!==Ce.lO.UPDATE)return ht;const yt=(0,Ce.Xf)(st);return this.updateGraphics3DGraphicElevationInfo(Te,Ue,()=>yt)}slicePlaneEnabledChanged(){const Te={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(Ue=>Ue.setParameters(Te)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(Te){switch(Te.type){case"extent":if(Te instanceof Le.Z)return te.Z.fromExtent(Te);break;case"polygon":case"polyline":return Te}return null}_createAs3DShape(Te,Ue,$e){const ht=this._getGeometryAsPolygonOrPolyline(Te.graphic.geometry),yt="polygon"===ht.type?ht.rings:ht.paths,Rt=new Array,Ut=new Array,er=new Array,vr=(0,oe.Ue)(),Pr=function Bn(ft,Te,Ue,$e){const st="polygon"===ft.type?et.ZI.CCW_IS_HOLE:et.ZI.NONE,ht="polygon"===ft.type?ft.rings:ft.paths,{position:yt,outlines:Rt}=(0,et.Mk)(ht,ft.hasZ,st),Ut=new Float64Array(yt.length),er=(0,Ce.rR)(yt,ft.spatialReference,0,Ut,0,yt,0,yt.length/3,Te,Ue,$e),vr=null!=er;return{lines:vr?Uo(Rt,yt,Ut):[],projectionSuccess:vr,sampledElevation:er}}(ht,this._context.elevationProvider,this._context.renderCoordsHelper,Ue);this._logGeometryCreationWarnings(Pr,yt,"polygon"===ht.type?"rings":"paths","LineSymbol3DLayer");for(let Es=0;Es<Pr.lines.length;Es++){const{position:si,mapPosition:ei}=Pr.lines[Es];if((0,G.pC)(this._context.clippingExtent)&&((0,oe.cS)(vr),(0,oe.G1)(vr,ei),!(0,oe.Zp)(vr,this._context.clippingExtent)))continue;const Rs=this._createGeometry(Te,si,ei,ht.type,Er.ELEVATED,$e);Rt.push(Rs),Ut.push("polygon"===ht.type?this._ringMaterial:this._lineMaterial),er.push(ye.I),rt.Z.LINE_WIREFRAMES&&(Rt.push(Rs.cloneShallow()),Ut.push("polygon"===ht.type?this._wireframeRingMaterial:this._wireframeLineMaterial),er.push(ye.I));const fi=this._markerMaterial;(0,G.pC)(fi)&&(Rt.push(Rs.cloneShallow()),Ut.push(fi),er.push(ye.I))}if(0===Rt.length)return null;const qr=new $t.T({geometries:Rt,materials:Ut,transformations:er,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:$e}}),Zr=new ue.z(this,qr,Rt,null,null,Ir.Lz,Ue);return Zr.alignedSampledElevation=Pr.sampledElevation,Zr.needsElevationUpdates=(0,Ce.Xf)(Ue.mode),Zr}_createGeometry(Te,Ue,$e,st,ht,yt){const Rt="polygon"===st,Ut=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,er=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,vr=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:yt,layerUid:this._context.layer.uid});return(0,vs.YU)({overlayInfo:ht===Er.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:Rt,attributeData:{position:Ue,mapPosition:$e,size:er?null:this._getDrivenSize(Te.renderingInfo),color:Ut?null:this._getDrivenColor(Te.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(Te.graphic),colorFeature:this._getColorFeatureAttributeData(Te.graphic),opacityFeature:this._getOpacityFeatureAttributeData(Te.graphic)}},vr)}_createAsOverlay(Te,Ue){const $e=Te.graphic,st=this._getGeometryAsPolygonOrPolyline($e.geometry),ht="polygon"===st.type?st.rings:st.paths,yt="polygon"===st.type?this._ringMaterial:this._lineMaterial;yt.renderPriority=this._renderPriority;const Rt=rt.Z.LINE_WIREFRAMES?"polygon"===st.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,Ut=this._markerMaterial;(0,G.pC)(Rt)&&(Rt.renderPriority=this._renderPriority-.001),(0,G.pC)(Ut)&&(Ut.renderPriority=this._renderPriority-.002);const er=new Array,vr=(0,oe.Ue)(),Pr=(0,oe.cS)(),Ur=function cn(ft,Te){const Ue="polygon"===ft.type?et.ZI.CCW_IS_HOLE:et.ZI.NONE,$e="polygon"===ft.type?ft.rings:ft.paths,{position:st,outlines:ht}=(0,et.Mk)($e,!1,Ue),yt=(0,ae.CM)(st,ft.spatialReference,0,st,Te,0,st.length/3);for(let Rt=2;Rt<st.length;Rt+=3)st[Rt]=qe.Rn;return{lines:yt?Uo(ht,st):[],projectionSuccess:yt}}(st,this._context.overlaySR);this._logGeometryCreationWarnings(Ur,ht,"polygon"===st.type?"rings":"paths","LineSymbol3DLayer");for(const Zr of Ur.lines){if((0,oe.cS)(vr),(0,oe.G1)(vr,Zr.position),!(0,oe.Zp)(vr,this._context.clippingExtent))continue;(0,oe.TC)(Pr,vr);const Es=this._createGeometry(Te,Zr.position,null,st.type,Er.DRAPED,$e.uid),si=Rs=>{const fi=new en.z(Es,Rs,{layerUid:Ue,graphicUid:$e.uid});return er.push(fi),fi};if((0,G.pC)(Ut)){const Rs=si(Ut),fi=(0,G.Wg)(this.symbolLayer.marker).placement;"begin"!==fi&&"begin-end"!==fi||(0,oe.G1)(vr,Zr.position,0,1),"end"!==fi&&"begin-end"!==fi||(0,oe.G1)(vr,Zr.position,Zr.position.length-3,1),this._updateBoundingSphere(Rs,vr)}const ei=si(yt);if(this._updateBoundingSphere(ei,vr),rt.Z.LINE_WIREFRAMES){const Rs=si(Rt);this._updateBoundingSphere(Rs,vr)}}return new fs(this,er,Pr,this._context.drapeSourceRenderer)}_updateBoundingSphere(Te,Ue){(0,Kt.s)(Te.boundingSphere,.5*(Ue[0]+Ue[3]),.5*(Ue[1]+Ue[4]),0,.5*Math.sqrt((Ue[3]-Ue[0])*(Ue[3]-Ue[0])+(Ue[4]-Ue[1])*(Ue[4]-Ue[1])))}get _patternHidesLine(){const Te=this.symbolLayer.pattern;return(0,G.pC)(Te)&&"style"===Te.type&&"none"===Te.style}_computeMaterialWidth(Te){return Te=(0,G.Pt)(Te,(0,ct.Wz)(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,ct.F2)(1):1:(0,ct.F2)(Te)}_prepareMaterialPatch(Te,Ue,$e){const st=Ue.material;if((0,G.Wi)(st))return void($e.changed&&$e.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,Te));if("collection"===st.type)return;const ht="complete"===st.type?(0,G.yw)(st.newValue,Rt=>Rt.color):"complete"===st.diff.color.type?st.diff.color.newValue:null,yt=this._getCombinedOpacityAndColor(ht);$e.useMaterialColor&&this._patchMaterialColor((0,tr.d)(yt),this._markerMaterialCached,Te),this._patternHidesLine&&(yt[3]=0),this._patchMaterialColor(yt,this._lineMaterialCached,Te),delete Ue.material}_prepareMarkerPatch(Te,Ue){const $e=Ue.marker;if((0,G.Wi)($e)||"partial"!==$e.type||(0,G.pC)($e.diff.style)||(0,G.pC)($e.diff.placement)||(0,G.pC)($e.diff.color)&&"complete"!==$e.diff.color.type)return{changed:!1,useMaterialColor:(0,G.Wi)(this._markerColor)};const st=$e.diff.color;if((0,G.Wi)(st))return delete Ue.marker,{changed:!1,useMaterialColor:(0,G.Wi)(this._markerColor)};const ht=(0,G.Wg)(st.newValue);return(0,G.Wi)(ht)?(delete Ue.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(ht),this._markerMaterialCached,Te),delete Ue.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(Te,Ue,$e){(0,G.Wi)(Ue)||$e.symbolLayerStatePatches.push(()=>Ue.setParameters({color:Te}))}}var Er;ur.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE},function(ft){ft[ft.DRAPED=0]="DRAPED",ft[ft.ELEVATED=1]="ELEVATED"}(Er||(Er={}));var Mr=v(61751),Nr=v(27530),ts=v(65231),es=v(98496),hs=v(9044),Ks=v(37187),ri=v(49580),Ci=v(67969);const Qn=["mesh"],oa=(0,X.c)(),on=(0,X.c)(),pl=(0,X.c)(),Wa=(0,X.c)(),Vo=(0,X.c)(),w0=(0,ye.c)(),Cu=(0,be.c)(),eh=(0,oe.Ue)(),Jf=[new Mr.Z];var vo;!function(ft){ft[ft.NONE=0]="NONE",ft[ft.ECEF=1]="ECEF"}(vo||(vo={}));var ac=v(48521),I0=v(43652),Qb=v(7167);class qb{constructor(Te,Ue,$e,st){this.graphics3DSymbolLayer=Te,this.instanceIndex=Ue,this.elevationAligner=$e,this.elevationContext=st,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(Te){const Ue=this._lodRenderer.instanceData;Te!==Ue.getVisible(this.instanceIndex)&&Ue.setVisible(this.instanceIndex,Te)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(Te,Ue,$e){if(this.elevationAligner){(0,Y.aO)(this.elevationContext.featureExpressionInfoContext,$e);const st=this.elevationAligner(this,this.elevationContext,Te,Ue);(0,G.pC)(st)&&(this.alignedSampledElevation=st)}}getCenterObjectSpace(Te=(0,X.c)()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,fl),(0,H.m)(Te,this._lodRenderer.baseBoundingSphere.center,fl)}getBoundingBoxObjectSpace(Te=(0,oe.Ue)()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,fl);const Ue=this._lodRenderer.baseBoundingBox;(0,oe.cS)(Te);for(let $e=0;$e<8;++$e)(0,H.s)(_l,0==(1&$e)?Ue[0]:Ue[3],0==(2&$e)?Ue[1]:Ue[4],0==(4&$e)?Ue[2]:Ue[5]),(0,H.m)(_l,_l,fl),(0,oe.pp)(Te,_l);return Te}computeAttachmentOrigin(Te){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,fl),Te.render.origin[0]+=fl[12],Te.render.origin[1]+=fl[13],Te.render.origin[2]+=fl[14],Te.render.num++}getProjectedBoundingBox(Te,Ue,$e,st,ht){var yt=this;return(0,D.Z)(function*(){const Rt=yt.getBoundingBoxObjectSpace(ht),Ut=Ny,er=(0,oe.wp)(Rt)?1:Ut.length;yt._lodRenderer.instanceData.getGlobalTransform(yt.instanceIndex,fl);for(let Pr=0;Pr<er;Pr++){const Ur=Ut[Pr];_l[0]=Rt[Ur[0]],_l[1]=Rt[Ur[1]],_l[2]=Rt[Ur[2]],(0,H.m)(_l,_l,fl),aa[3*Pr+0]=_l[0],aa[3*Pr+1]=_l[1],aa[3*Pr+2]=_l[2]}if(!Te(aa,0,er))return null;(0,oe.cS)(Rt);let vr=null;yt.calculateRelativeScreenBounds&&(vr=yt.calculateRelativeScreenBounds());for(let Pr=0;Pr<3*er;Pr+=3){for(let Ur=0;Ur<3;Ur++)Rt[Ur]=Math.min(Rt[Ur],aa[Pr+Ur]),Rt[Ur+3]=Math.max(Rt[Ur+3],aa[Pr+Ur]);vr&&$e.push({location:aa.slice(Pr,Pr+3),screenSpaceBoundingRect:vr})}if(Ue&&((0,oe.be)(Rt,up),"absolute-height"!==yt.elevationContext.mode)){let Pr;const Ur=(0,je.Si)(Rt,Ue.service.spatialReference,Ue);try{Pr=yield Ue.service.queryElevation(up[0],up[1],st,Ur,"ground")}catch{}(0,G.pC)(Pr)&&(0,oe.cv)(Rt,0,0,-yt.alignedSampledElevation+Pr)}return Rt})()}addObjectState(Te,Ue){if(Te===Ie.V_.Highlight){const $e=new Qb.O(Te);this._addHighlightId($e),Ue.addExternal(st=>{this._removeHighlightId(st)},$e)}}removeObjectState(Te){this._highlights.forEach(Ue=>Te.remove(Ue))}_addHighlightId(Te){this._highlights.add(Te),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(Te){this._highlights.delete(Te),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const aa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_l=(0,X.c)(),up=(0,X.c)(),Ny=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],fl=(0,ye.c)();var dp=v(87930),wc=v(47526);const sC=.05;var Cn,iC=v(34062),L0=v(56244),U0=v(97161),Qf=v(4511),Hi=v(13934),th=v(59856),rh=v(39114),lc=v(67857),rd=v(82274),zo=v(5894),Bo=v(2282),nC=v(61885),Vy=v(98943),qf=v(19625);!function(ft){ft[ft.ALLOCATED=1]="ALLOCATED",ft[ft.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",ft[ft.VISIBLE=4]="VISIBLE",ft[ft.HIGHLIGHT=8]="HIGHLIGHT",ft[ft.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",ft[ft.REMOVE=32]="REMOVE",ft[ft.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",ft[ft.ACTIVE=18]="ACTIVE"}(Cn||(Cn={}));class aC{constructor(Te){this.localTransform=Te.getField(Pe.T.LOCALTRANSFORM,ve.O1),this.globalTransform=Te.getField(Pe.T.GLOBALTRANSFORM,ve.O1),this.modelOrigin=Te.getField(Pe.T.MODELORIGIN,ve.fP),this.model=Te.getField(Pe.T.MODEL,ve.gK),this.modelNormal=Te.getField(Pe.T.MODELNORMAL,ve.gK),this.modelScaleFactors=Te.getField(Pe.T.MODELSCALEFACTORS,ve.Eu),this.boundingSphere=Te.getField(Pe.T.BOUNDINGSPHERE,ve.Cd),this.color=Te.getField(Pe.T.COLOR,ve.ek),this.featureAttribute=Te.getField(Pe.T.FEATUREATTRIBUTE,ve.ek),this.state=Te.getField(Pe.T.STATE,ve.D_),this.lodLevel=Te.getField(Pe.T.LODLEVEL,ve.D_),this.objectAndLayerIdColor=Te.getField(Pe.T.OBJECTANDLAYERIDCOLOR,ve.mc)}}class zy extends nC.Z{constructor(Te,Ue){super(),this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=function oC(ft){let Te=(0,qf.U$)().mat4f64(Pe.T.LOCALTRANSFORM).mat4f64(Pe.T.GLOBALTRANSFORM).vec4f64(Pe.T.BOUNDINGSPHERE).vec3f64(Pe.T.MODELORIGIN).mat3f(Pe.T.MODEL).mat3f(Pe.T.MODELNORMAL).vec2f(Pe.T.MODELSCALEFACTORS);return ft.includes("color")&&(Te=Te.vec4f(Pe.T.COLOR)),ft.includes("featureAttribute")&&(Te=Te.vec4f(Pe.T.FEATUREATTRIBUTE)),Te=Te.u8(Pe.T.STATE).u8(Pe.T.LODLEVEL),ft.includes(Pe.T.OBJECTANDLAYERIDCOLOR)&&(Te=Te.vec4u8(Pe.T.OBJECTANDLAYERIDCOLOR)),Te.alignTo(8),Te}(Te),this._shaderTransformation=Ue}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const Te=this._findSlot();return this._view.state.set(Te,Cn.ALLOCATED),this._size++,this.emit("instance-added",{index:Te}),Te}removeInstance(Te){(0,Bo.hu)(Te>=0&&Te<this._capacity&&this._view.state.get(Te)&Cn.ALLOCATED,"invalid instance handle"),this._getStateFlag(Te,Cn.ACTIVE)?this._setStateFlags(Te,Cn.REMOVE):this.freeInstance(Te),this.emit("instance-removed",{index:Te})}freeInstance(Te){const Ue=this._view.state;(0,Bo.hu)(Te>=0&&Te<this._capacity&&Ue.get(Te)&Cn.ALLOCATED,"invalid instance handle"),Ue.set(Te,0),this._size--}setLocalTransform(Te,Ue,$e=!0){this._view.localTransform.setMat(Te,Ue),$e&&this.updateModelTransform(Te)}getLocalTransform(Te,Ue){this._view.localTransform.getMat(Te,Ue)}setGlobalTransform(Te,Ue,$e=!0){this._view.globalTransform.setMat(Te,Ue),$e&&this.updateModelTransform(Te)}getGlobalTransform(Te,Ue){this._view.globalTransform.getMat(Te,Ue)}updateModelTransform(Te){const Ue=this._view,$e=Jc,st=la;Ue.localTransform.getMat(Te,em),Ue.globalTransform.getMat(Te,sh);const ht=(0,Se.m)(sh,sh,em);(0,H.s)($e,ht[12],ht[13],ht[14]),Ue.modelOrigin.setVec(Te,$e),(0,De.f)(st,ht),Ue.model.setMat(Te,st);const yt=(0,Vy.mw)(Jc,ht);yt.sort(),Ue.modelScaleFactors.set(Te,0,yt[1]),Ue.modelScaleFactors.set(Te,1,yt[2]),(0,De.e)(st,st),(0,De.t)(st,st),Ue.modelNormal.setMat(Te,st),this._setStateFlags(Te,Cn.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:Te})}getModelTransform(Te,Ue){const $e=this._view;$e.model.getMat(Te,la),$e.modelOrigin.getVec(Te,Jc),Ue[0]=la[0],Ue[1]=la[1],Ue[2]=la[2],Ue[3]=0,Ue[4]=la[3],Ue[5]=la[4],Ue[6]=la[5],Ue[7]=0,Ue[8]=la[6],Ue[9]=la[7],Ue[10]=la[8],Ue[11]=0,Ue[12]=Jc[0],Ue[13]=Jc[1],Ue[14]=Jc[2],Ue[15]=1}applyShaderTransformation(Te,Ue){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Te,Ue)}getCombinedModelTransform(Te,Ue){return this.getModelTransform(Te,Ue),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Te,Ue),Ue}getCombinedLocalTransform(Te,Ue){return this._view.localTransform.getMat(Te,Ue),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Te,Ue),Ue}getCombinedMaxScaleFactor(Te){let Ue=this._view.modelScaleFactors.get(Te,1);if(this._shaderTransformation){const $e=this._shaderTransformation.scaleFactor(Jc,this,Te);Ue*=Math.max($e[0],$e[1],$e[2])}return Ue}getCombinedMedianScaleFactor(Te){let Ue=this._view.modelScaleFactors.get(Te,0);if(this._shaderTransformation){const $e=this._shaderTransformation.scaleFactor(Jc,this,Te);Ue*=function Hy(ft,Te,Ue){return Math.max(Math.min(ft,Te),Math.min(Math.max(ft,Te),Ue))}($e[0],$e[1],$e[2])}return Ue}getModel(Te,Ue){this._view.model.getMat(Te,Ue)}setFeatureAttribute(Te,Ue){this._view.featureAttribute.setVec(Te,Ue)}getFeatureAttribute(Te,Ue){this._view.featureAttribute.getVec(Te,Ue)}setColor(Te,Ue){this._view.color.setVec(Te,Ue)}setObjectAndLayerIdColor(Te,Ue){this._view.objectAndLayerIdColor.setVec(Te,Ue)}getColor(Te,Ue){this._view.color.getVec(Te,Ue)}setVisible(Te,Ue){Ue!==this.getVisible(Te)&&(this._setStateFlag(Te,Cn.VISIBLE,Ue),this.emit("instance-visibility-changed",{index:Te}))}getVisible(Te){return this._getStateFlag(Te,Cn.VISIBLE)}setHighlight(Te,Ue){Ue!==this.getHighlight(Te)&&(this._setStateFlag(Te,Cn.HIGHLIGHT,Ue),this.emit("instance-highlight-changed",{index:Te}))}getHighlight(Te){return this._getStateFlag(Te,Cn.HIGHLIGHT)}getState(Te){return this._view.state.get(Te)}getLodLevel(Te){return this._view.lodLevel.get(Te)}countFlags(Te){let Ue=0;for(let $e=0;$e<this._capacity;++$e)this.getState($e)&Te&&++Ue;return Ue}_setStateFlags(Te,Ue){const $e=this._view.state;Ue=$e.get(Te)|Ue,$e.set(Te,Ue)}_clearStateFlags(Te,Ue){const $e=this._view.state;Ue=$e.get(Te)&~Ue,$e.set(Te,Ue)}_setStateFlag(Te,Ue,$e){$e?this._setStateFlags(Te,Ue):this._clearStateFlags(Te,Ue)}_getStateFlag(Te,Ue){return!!(this._view.state.get(Te)&Ue)}_grow(){const Te=Math.max(lC,Math.floor(this._capacity*cC)),Ue=this._layout.createBuffer(Te);if(this._buffer){const $e=new Uint8Array(this._buffer.buffer);new Uint8Array(Ue.buffer).set($e)}this._capacity=Te,this._buffer=Ue,this._view=new aC(this._buffer)}_findSlot(){const Te=this._view.state;let Ue=this._next;for(;Te.get(Ue)&Cn.ALLOCATED;)Ue=Ue+1===this._capacity?0:Ue+1;return this._next=Ue+1===this._capacity?0:Ue+1,Ue}}const lC=1024,cC=2,Jc=(0,X.c)(),la=(0,be.c)(),em=(0,ye.c)(),sh=(0,ye.c)();var Gy=v(97126);class B0 extends rd.Z{constructor(Te,Ue){super($e=>(0,Gy.w)(this._instanceData.view.boundingSphere.getVec($e,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=(0,Gy.c)(),this._tmpMat4=(0,ye.c)(),this._instanceData=Te,this._boundingSphere=Ue}addInstance(Te){const Ue=this._instanceData.view.boundingSphere,$e=this._instanceData.getCombinedModelTransform(Te,this._tmpMat4);(0,H.m)(this._tmpSphere,this._boundingSphere.center,$e),this._tmpSphere[3]=this._boundingSphere.radius*(0,Vy.u1)($e),Ue.setVec(Te,this._tmpSphere),this.add([Te])}removeInstance(Te){this.remove([Te])}}class Qa{constructor(Te,Ue){this.thresholdScale=1,this._camera=new th.V,this._worldSpaceRadius=Te,this._thresholds=Ue.map($e=>$e)}updateCamera(Te){this._camera.copyFrom(Te)}selectLevel(Te,Ue){const $e=this._camera.computeScreenPixelSizeAt(Te),st=this._worldSpaceRadius*Ue/$e,ht=this._thresholds;let yt=-1;for(let Rt=0;Rt<ht.length;++Rt)st>=ht[Rt]*this.thresholdScale&&(yt=Rt);return yt}}var Ky=v(32393),uC=v(62483),Zy=v(15197),hp=v(83994);class sd{constructor(Te,Ue){const $e=Te.renderContext.rctx,{geometry:st,material:ht}=Ue;this._materialRepository=Te.materialRep,ht.setParameters({instancedDoublePrecision:!0});const yt=ht.createBufferWriter(),Rt=yt.vertexBufferLayout,Ut=yt.elementCount(st),er=yt.allocate(Ut);yt.write(null,null,st,er,0),this.geometry=st,this.material=ht,this.glMaterials=new Ky.p(ht,this._materialRepository),this.vertexBufferLayout=Rt,this.vbo=hp.f.createVertex($e,Ci.l1.STATIC_DRAW,er.buffer),this.vao=new Zy.U($e,rh.i,{geometry:(0,Qf.K)(Rt)},{geometry:this.vbo}),this.vertexCount=Ut}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(Te,Ue,$e,st,ht,yt,Rt,Ut){const er=this.geometry.id;this.material.intersect(this.geometry,null,Te.transform.transform,Te,$e,st,(vr,Pr,Ur,qr,Zr)=>{if(vr>=0){if(null!=Ue&&!Ue(Te.rayBegin,Te.rayEnd,vr))return;const Es={layerUid:yt.layerUid,graphicUid:yt.graphicUid(ht),geometryId:er,triangleNr:Ur,baseBoundingSphere:Rt,numLodLevels:Ut};if((null==Te.results.min.drapedLayerOrder||Zr>=Te.results.min.drapedLayerOrder)&&(null==Te.results.min.dist||vr<Te.results.min.dist)&&Te.results.min.set(lc.q7.LOD,Es,vr,Pr,Te.transform.transform,Zr),Te.options.store!==lc.eC.MIN&&(null==Te.results.max.drapedLayerOrder||Zr>=Te.results.max.drapedLayerOrder)&&(null==Te.results.max.dist||vr>Te.results.max.dist)&&Te.results.max.set(lc.q7.LOD,Es,vr,Pr,Te.transform.transform,Zr),Te.options.store===lc.eC.ALL){const si=(0,uC.LP)(Te.results.min.ray);si.set(lc.q7.LOD,Es,vr,Pr,Te.transform.transform,Zr),Te.results.all.push(si)}}})}}class Qc{constructor(Te,Ue){this.minScreenSpaceRadius=Te,this.components=Ue}static create(Te,Ue,$e){return(0,D.Z)(function*(){const st=yield Promise.allSettled(Ue.components.map(yt=>Te.schedule(()=>new sd(Te,yt),$e))),ht=st.map(yt=>"fulfilled"===yt.status?yt.value:null).filter(yt=>yt);if((0,Z.Hc)($e)||ht.length!==st.length){ht.forEach(yt=>yt.destroy()),(0,Z.k_)($e);for(const yt of st)if("rejected"===yt.status)throw yt.reason}return new Qc(Ue.minScreenSpaceRadius,ht)})()}destroy(){this.components.forEach(Te=>Te.destroy())}intersect(Te,Ue,$e,st,ht,yt,Rt){this.components.forEach(Ut=>Ut.intersect(Te,Ue,$e,st,ht,yt,this.boundingSphere,Rt))}get boundingBox(){if((0,G.Wi)(this._boundingBox)){const Te=(0,oe.cS)();this.components.forEach(Ue=>{(0,G.pC)(Ue.boundingInfo)&&((0,oe.pp)(Te,Ue.boundingInfo.bbMin),(0,oe.pp)(Te,Ue.boundingInfo.bbMax))}),this._boundingBox=Te}return this._boundingBox}get boundingSphere(){if((0,G.Wi)(this._boundingSphere)){const Te=this.boundingBox,Ue=(0,X.c)();(0,oe.be)(Te,Ue),this._boundingSphere={center:Ue,radius:.5*(0,oe.wz)(Te)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((Te,Ue)=>Te+Ue.triangleCount,0)}}class $y{constructor(Te,Ue,$e){this._elementSize=Ue,this._buffer=hp.f.createVertex(Te,Ci.l1.STATIC_DRAW),this.resize($e)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(Te,Ue,$e,st=0){const ht=new Uint8Array(this.array,Te*this.elementSize,(Ue-Te)*this.elementSize);new Uint8Array($e.array,st*this.elementSize).set(ht)}transferAll(){this._buffer.setData(this._array)}transferRange(Te,Ue){const $e=Te*this._elementSize,st=Ue*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),$e,$e,st)}resize(Te){const Ue=Te*this._elementSize,$e=new ArrayBuffer(Ue);this._array&&(Te>=this._capacity?new Uint8Array($e).set(new Uint8Array(this._array)):new Uint8Array($e).set(new Uint8Array(this._array).subarray(0,Te*this._elementSize))),this._array=$e,this._buffer.setSize(Ue),this._capacity=Te}}class Yy{constructor(Te){this.modelOriginHi=Te.getField(Pe.T.MODELORIGINHI,ve.ct),this.modelOriginLo=Te.getField(Pe.T.MODELORIGINLO,ve.ct),this.model=Te.getField(Pe.T.MODEL,ve.gK),this.modelNormal=Te.getField(Pe.T.MODELNORMAL,ve.gK),this.color=Te.getField(Pe.T.INSTANCECOLOR,ve.ek),this.featureAttribute=Te.getField(Pe.T.INSTANCEFEATUREATTRIBUTE,ve.ek),this.objectAndLayerIdColor=Te.getField(Pe.T.OBJECTANDLAYERIDCOLOR_INSTANCED,ve.mc)}}class Xy{constructor(Te,Ue){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=Te,this._instanceBufferLayout=Ue,this._elementSize=Ue.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const Te=this._headIndex,Ue=this._tailIndex;return Te>=Ue?Te-Ue:Te+this._capacity-Ue}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){(0,Bo.hu)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,Bo.hu)(this._updating,"not updating"),this.size<j0*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,Bo.hu)(this._updating,"not updating"),this.isFull&&this._grow();const Te=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=Te,this._captureFirstIndex=!1),this._incrementHead(),(0,Bo.hu)(this._headIndex!==this._tailIndex,"invalid pointers"),Te}freeTail(){(0,Bo.hu)(this._updating,"not updating"),(0,Bo.hu)(this.size>0,"invalid size");const Te=this._tailIndex===this._firstIndex;this._incrementTail(),Te&&(this._firstIndex=this._tailIndex)}_grow(){const Te=Math.max(Fl,Math.floor(this._capacity*ky));this._resize(Te)}_shrink(){const Te=Math.max(Fl,Math.floor(this._capacity*tm));this._resize(Te)}_resize(Te){if((0,Bo.hu)(this._updating,"not updating"),Te===this._capacity)return;const Ue=new $y(this._rctx,this._elementSize,Te);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const $e=this.size,st=this._compactInstances(Ue);(0,Bo.hu)(st===$e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=st,this._prevHeadIndex=0}this._resized=!0,this._capacity=Te,this._buffer=Ue,this._view=new Yy(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(Te){const Ue=this._headIndex,$e=this._tailIndex;return $e<Ue?(this._buffer.copyRange($e,Ue,Te),Ue-$e):$e>Ue?(this._buffer.copyRange($e,this._capacity,Te),Ue>0&&this._buffer.copyRange(0,Ue,Te,this._capacity-$e),Ue+(this._capacity-$e)):0}_incrementHead(Te=1){this._headIndex=(this._headIndex+Te)%this._capacity}_incrementTail(Te=1){this._tailIndex=(this._tailIndex+Te)%this._capacity}_transferRange(Te,Ue){Te<Ue?this._buffer.transferRange(Te,Ue):Te>Ue&&(Ue>0&&this._buffer.transferRange(0,Ue),this._buffer.transferRange(Te,this._capacity))}}const Fl=1024,ky=2,j0=.3,tm=.5;var pp=v(57623),dC=v(65073),hC=v(39711),F0=v(26906);class pC{constructor(Te,Ue,$e,st){this.type=lc.q7.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._lastCamera=new th.V,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[zo.r.OPAQUE_MATERIAL,zo.r.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=Te,this._optionalFields=Ue,this._metadata=$e,this._instanceBufferLayout=(0,Wt.RL)({instancedDoublePrecision:!0,instanced:Ue}),this._glInstanceBufferLayout=(0,Qf.K)(this._instanceBufferLayout,1),this._instanceData=new zy(this._optionalFields,st),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",ht=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(ht.index)}),this._instanceData.on("instance-visibility-changed",ht=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(ht.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(Te){this._slicePlane=Te}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const Te={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(Ue=>{const $e=Ue.memoryUsage;Te.cpu+=$e.cpu,Te.gpu+=$e.gpu}),this._highlightRenderInstanceData.forEach(Ue=>{const $e=Ue.memoryUsage;Te.cpu+=$e.cpu,Te.gpu+=$e.gpu}),Te}get renderStats(){const Te=this._instanceData.size,Ue=[];return this._levels.forEach(($e,st)=>{const Rt=this._defaultRenderInstanceData[st].size+this._highlightRenderInstanceData[st].size,Ut=$e.triangleCount;Ue.push({renderedInstances:Rt,renderedTriangles:Rt*Ut,trianglesPerInstance:Ut})}),{totalInstances:Te,renderedInstances:Ue.reduce(($e,st)=>$e+st.renderedInstances,0),renderedTriangles:Ue.reduce(($e,st)=>$e+st.renderedTriangles,0),levels:Ue}}initializeRenderContext(Te,Ue){var $e=this;return(0,D.Z)(function*(){$e._context=Te;const st=Te.renderContext.rctx,ht=yield Promise.allSettled($e._symbol.levels.map(Rt=>($e._defaultRenderInstanceData.push(new Xy(st,$e._instanceBufferLayout)),$e._highlightRenderInstanceData.push(new Xy(st,$e._instanceBufferLayout)),Qc.create(Te,Rt,Ue)))),yt=ht.map(Rt=>"fulfilled"===Rt.status?Rt.value:null).filter(Rt=>Rt);if((0,Z.Hc)(Ue)||yt.length!==ht.length){yt.forEach(Rt=>Rt.destroy()),(0,Z.k_)(Ue);for(const Rt of ht)if("rejected"===Rt.status)throw Rt.reason}$e._levels=yt,$e._levelSelector=(ft=>{const Te=ft.baseBoundingSphere.radius,Ue=ft.levels.map($e=>$e.minScreenSpaceRadius);return new Qa(Te,Ue)})($e)})()}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(Te=>Te.destroy()),this._defaultRenderInstanceData.forEach(Te=>Te.destroy()),this._highlightRenderInstanceData.forEach(Te=>Te.destroy())}get needsTransparentPass(){return this._levels.some(Te=>Te.components.some(Ue=>Ue.material.requiresSlot(zo.r.TRANSPARENT_MATERIAL,Hi.H.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(Te=>Te.size>0)}prepareRender(Te){if(rt.Z.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const $e=Te.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(Te.bindParameters.contentCamera),$e||this._requestUpdateCycle()}const Ue=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(Te.bindParameters.contentCamera,Ue),this._needsUpdates&&this._context.requestRender()}render(Te){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(Te.output)||(Te.rctx.bindVAO(),Te.output!==Hi.H.Highlight&&Te.output!==Hi.H.ShadowHighlight&&this._renderComponents(Te,this._defaultRenderInstanceData),Te.output!==Hi.H.ShadowExludeHighlight&&this._renderComponents(Te,this._highlightRenderInstanceData))}intersect(Te,Ue,$e,st){if(!this.baseMaterial.isVisible())return;const ht=(0,X.c)();(0,H.b)(ht,st,$e);const yt=Rt=>{this._instanceData.getCombinedModelTransform(Rt,sm),Te.transform.set(sm),(0,H.m)(mC,$e,Te.transform.inverse),(0,H.m)(gC,st,Te.transform.inverse);const Ut=this._instanceData.getState(Rt),er=this._instanceData.getLodLevel(Rt),vr=this._levels.length;(0,Bo.hu)(Ut&Cn.ACTIVE,"invalid instance state"),(0,Bo.hu)(er>=0&&er<vr,"invaid lod level"),this._levels[er].intersect(Te,Ue,mC,gC,Rt,this._metadata,vr)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(yt):this._octree.forEachAlongRay($e,ht,yt)}queryDepthRange(Te){return this._queryDepthRangeOctree(Te)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(Te=!1){this._updateCyclesWithStaticCamera=-1,Te&&(this._needFullCycle=!0),this._needsUpdates&&this._context.requestRender()}get _needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get _octree(){return(0,G.Wi)(this._octreeCached)&&(this._octreeCached=this._buildOctree()),this._octreeCached}_invalidateOctree(){this._octreeCached=(0,G.SC)(this._octreeCached)}_buildOctree(){const Te=new B0(this._instanceData,this.baseBoundingSphere),Ue=this._instanceData,$e=Ue.view?Ue.view.state:null;for(let st=0;st<this._instanceData.capacity;++st)$e.get(st)&Cn.ACTIVE&&Te.addInstance(st);return Te}_queryDepthRangeOctree(Te){const Ue=Te.eye,$e=Te.viewForward,st=this._octree.findClosest($e,rd.Z.DepthOrder.FRONT_TO_BACK,Te.frustum),ht=this._octree.findClosest($e,rd.Z.DepthOrder.BACK_TO_FRONT,Te.frustum);if(null!=st&&null!=ht){this._instanceData.view.boundingSphere.getVec(st,ml),(0,H.b)(ml,ml,Ue);const yt=(0,H.e)(ml,$e)-ml[3];this._instanceData.view.boundingSphere.getVec(ht,ml),(0,H.b)(ml,ml,Ue);const Rt=(0,H.e)(ml,$e)+ml[3];return{near:Math.max(Te.near,yt),far:Math.min(Te.far,Rt)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(Te=>{Te.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(Te=>{Te.startUpdateCylce()}),this._needsUpdates&&this._context.requestRender()}_updateInstances(Te,Ue){const $e=this._enableLevelSelection,st=this._levelSelector;st.updateCamera(Te),this._defaultRenderInstanceData.forEach(vr=>vr.beginUpdate()),this._highlightRenderInstanceData.forEach(vr=>vr.beginUpdate());const ht=this._instanceData,yt=this._instanceData.view,Ut=ht.capacity;let er=this._instanceIndex;Ue=Math.min(ht.size,Ue);for(let vr=0;vr<Ue;++vr){0===er&&this._startUpdateCycle();const Pr=yt.state.get(er);let Ur=0;if(!(Pr&Cn.ALLOCATED)){er=er+1===Ut?0:er+1,Ue++;continue}const qr=yt.lodLevel.get(er);if(Pr&Cn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[qr].freeTail(),Pr&Cn.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[qr].freeTail(),Pr&Cn.REMOVE)ht.freeInstance(er);else if(Pr&Cn.VISIBLE){let Zr=0;$e&&(yt.modelOrigin.getVec(er,rm),Zr=st.selectLevel(rm,ht.getCombinedMedianScaleFactor(er))),Ur=Pr&~(Cn.ACTIVE|Cn.TRANSFORM_CHANGED),Zr>=0&&(Pr&Cn.HIGHLIGHT?(_C(this._highlightRenderInstanceData[Zr],yt,er),Ur|=Cn.HIGHLIGHT_ACTIVE):(_C(this._defaultRenderInstanceData[Zr],yt,er),Ur|=Cn.DEFAULT_ACTIVE)),yt.state.set(er,Ur),yt.lodLevel.set(er,Zr)}else Ur=Pr&~(Cn.ACTIVE|Cn.TRANSFORM_CHANGED),yt.state.set(er,Ur);if((0,G.pC)(this._octreeCached)){const Zr=!!(Pr&Cn.ACTIVE),Es=!!(Ur&Cn.ACTIVE);!Zr&&Es?this._octreeCached.addInstance(er):Zr&&!Es?this._octreeCached.removeInstance(er):Zr&&Es&&Pr&Cn.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(er),this._octreeCached.addInstance(er))}er=er+1===Ut?0:er+1}this._instanceIndex=er,this._defaultRenderInstanceData.forEach(vr=>vr.endUpdate()),this._highlightRenderInstanceData.forEach(vr=>vr.endUpdate())}_renderComponents(Te,Ue){this.levels.forEach(($e,st)=>{$e.components.forEach(ht=>{this._renderComponent(Te,Ue[st],ht,st)})})}_renderComponent(Te,Ue,$e,st){const{bindParameters:ht,rctx:yt,output:Rt}=Te;if(0===Ue.size||!$e.material.requiresSlot(ht.slot,Te.output))return;const Ut=$e.glMaterials.load(yt,ht.slot,Rt);if((0,G.Wi)(Ut))return;const er=Ut.beginSlot(ht),vr=yt.bindTechnique(er,$e.material.parameters,ht);yt.bindVAO($e.vao),er.ensureAttributeLocations($e.vao),vr.bindDraw(im,ht,$e.material.parameters),rt.Z.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&Te.output===Hi.H.Color&&(vr.setUniform4fv("externalColor",N0[Math.min(st,N0.length-1)]),vr.setUniform1i("colorMixMode",pp.FZ.replace));const Pr=yt.capabilities.instancing,Ur=Ue.capacity,qr=Ue.headIndex,Zr=Ue.tailIndex,Es=Ue.firstIndex,si=this._glInstanceBufferLayout,ei=(Rs,fi)=>{(0,F0.XP)(yt,rh.i,Ue.buffer,si,Rs),Pr.drawArraysInstanced(er.primitiveType,0,$e.vertexCount,fi-Rs),(0,F0.UF)(yt,rh.i,Ue.buffer,si)};$e.material.parameters.transparent&&null!=Es?qr>Zr?((0,Bo.hu)(Es>=Zr&&Es<=qr,"invalid firstIndex"),ei(Es,qr),ei(Zr,Es)):qr<Zr&&(Es<=qr?((0,Bo.hu)(Es>=0&&Es<=qr,"invalid firstIndex"),ei(Es,qr),ei(Zr,Ur),ei(0,Es)):((0,Bo.hu)(Es>=Zr&&Es<=Ur,"invalid firstIndex"),ei(Es,Ur),ei(0,qr),ei(Zr,Es))):qr>Zr?ei(Zr,qr):qr<Zr&&(ei(0,qr),ei(Zr,Ur)),yt.bindVAO(null)}}function _C(ft,Te,Ue){const $e=ft.allocateHead();!function fC(ft,Te,Ue,$e){(0,dC.EE)(ft.modelOrigin,Te,Ue.modelOriginHi,Ue.modelOriginLo,$e),Ue.model.copyFrom($e,ft.model,Te),Ue.modelNormal.copyFrom($e,ft.modelNormal,Te),ft.color&&Ue.color&&Ue.color.copyFrom($e,ft.color,Te),ft.objectAndLayerIdColor&&Ue.objectAndLayerIdColor&&Ue.objectAndLayerIdColor.copyFrom($e,ft.objectAndLayerIdColor,Te),ft.featureAttribute&&Ue.featureAttribute&&Ue.featureAttribute.copyFrom($e,ft.featureAttribute,Te)}(Te,Ue,ft.view,$e)}const rm=(0,X.c)(),ml=(0,tr.c)(),sm=(0,ye.c)(),mC=(0,X.c)(),gC=(0,X.c)(),N0=[(0,tr.f)(1,0,1,1),(0,tr.f)(0,0,1,1),(0,tr.f)(0,1,0,1),(0,tr.f)(1,1,0,1),(0,tr.f)(1,0,0,1)],im=new hC.Qm,ih=(0,X.c)(),nm=(0,ye.c)(),W0=(0,ye.c)(),V0=(0,tr.c)(),z0=new Ce.Lm;var Qy=v(39863);function om(ft,Te,Ue,$e,st){return ft[0]=Te,ft[1]=Ue,ft[2]=$e,ft[3]=st,ft}function qy(ft,Te,Ue){const $e=Te[0],st=Te[1],ht=Te[2],yt=Te[3],Rt=Ue[0],Ut=Ue[1],er=Ue[2],vr=Ue[3];return ft[0]=$e*Rt+ht*Ut,ft[1]=st*Rt+yt*Ut,ft[2]=$e*er+ht*vr,ft[3]=st*er+yt*vr,ft}function ev(ft,Te,Ue){return ft[0]=Te[0]-Ue[0],ft[1]=Te[1]-Ue[1],ft[2]=Te[2]-Ue[2],ft[3]=Te[3]-Ue[3],ft}Object.freeze(Object.defineProperty({__proto__:null,copy:function vC(ft,Te){return ft[0]=Te[0],ft[1]=Te[1],ft[2]=Te[2],ft[3]=Te[3],ft},identity:function EC(ft){return ft[0]=1,ft[1]=0,ft[2]=0,ft[3]=1,ft},set:om,transpose:function bC(ft,Te){if(ft===Te){const Ue=Te[1];ft[1]=Te[2],ft[2]=Ue}else ft[0]=Te[0],ft[1]=Te[2],ft[2]=Te[1],ft[3]=Te[3];return ft},invert:function CC(ft,Te){const Ue=Te[0],$e=Te[1],st=Te[2],ht=Te[3];let yt=Ue*ht-st*$e;return yt?(yt=1/yt,ft[0]=ht*yt,ft[1]=-$e*yt,ft[2]=-st*yt,ft[3]=Ue*yt,ft):null},adjoint:function TC(ft,Te){const Ue=Te[0];return ft[0]=Te[3],ft[1]=-Te[1],ft[2]=-Te[2],ft[3]=Ue,ft},determinant:function MC(ft){return ft[0]*ft[3]-ft[2]*ft[1]},multiply:qy,rotate:function PC(ft,Te,Ue){const $e=Te[0],st=Te[1],ht=Te[2],yt=Te[3],Rt=Math.sin(Ue),Ut=Math.cos(Ue);return ft[0]=$e*Ut+ht*Rt,ft[1]=st*Ut+yt*Rt,ft[2]=$e*-Rt+ht*Ut,ft[3]=st*-Rt+yt*Ut,ft},scale:function OC(ft,Te,Ue){const st=Te[1],ht=Te[2],yt=Te[3],Rt=Ue[0],Ut=Ue[1];return ft[0]=Te[0]*Rt,ft[1]=st*Rt,ft[2]=ht*Ut,ft[3]=yt*Ut,ft},fromRotation:function xC(ft,Te){const Ue=Math.sin(Te),$e=Math.cos(Te);return ft[0]=$e,ft[1]=Ue,ft[2]=-Ue,ft[3]=$e,ft},fromScaling:function DC(ft,Te){return ft[0]=Te[0],ft[1]=0,ft[2]=0,ft[3]=Te[1],ft},str:function SC(ft){return"mat2("+ft[0]+", "+ft[1]+", "+ft[2]+", "+ft[3]+")"},frob:function AC(ft){return Math.sqrt(ft[0]**2+ft[1]**2+ft[2]**2+ft[3]**2)},LDU:function RC(ft,Te,Ue,$e){return ft[2]=$e[2]/$e[0],Ue[0]=$e[0],Ue[1]=$e[1],Ue[3]=$e[3]-ft[2]*Ue[1],[ft,Te,Ue]},add:function wC(ft,Te,Ue){return ft[0]=Te[0]+Ue[0],ft[1]=Te[1]+Ue[1],ft[2]=Te[2]+Ue[2],ft[3]=Te[3]+Ue[3],ft},subtract:ev,exactEquals:function IC(ft,Te){return ft[0]===Te[0]&&ft[1]===Te[1]&&ft[2]===Te[2]&&ft[3]===Te[3]},equals:function LC(ft,Te){const Ue=ft[0],$e=ft[1],st=ft[2],ht=ft[3],yt=Te[0],Rt=Te[1],Ut=Te[2],er=Te[3],vr=(0,Qy.g)();return Math.abs(Ue-yt)<=vr*Math.max(1,Math.abs(Ue),Math.abs(yt))&&Math.abs($e-Rt)<=vr*Math.max(1,Math.abs($e),Math.abs(Rt))&&Math.abs(st-Ut)<=vr*Math.max(1,Math.abs(st),Math.abs(Ut))&&Math.abs(ht-er)<=vr*Math.max(1,Math.abs(ht),Math.abs(er))},multiplyScalar:function UC(ft,Te,Ue){return ft[0]=Te[0]*Ue,ft[1]=Te[1]*Ue,ft[2]=Te[2]*Ue,ft[3]=Te[3]*Ue,ft},multiplyScalarAndAdd:function BC(ft,Te,Ue,$e){return ft[0]=Te[0]+Ue[0]*$e,ft[1]=Te[1]+Ue[1]*$e,ft[2]=Te[2]+Ue[2]*$e,ft[3]=Te[3]+Ue[3]*$e,ft},mul:qy,sub:ev},Symbol.toStringTag,{value:"Module"}));var tv=v(14658);class NC extends Ge.Z{constructor(Te,Ue,$e,st,ht,yt,Rt){super(Te,Ue,Ie.MX.Triangle,Rt),this.path=$e,this.geometrySR=st,this.upVectorAlignment=ht,this.stencilWidth=yt}}function rv(ft){return"upVectorAlignment"in ft}Object.freeze(Object.defineProperty({__proto__:null,create:function sv(){return[1,0,0,1]},clone:function WC(ft){return[ft[0],ft[1],ft[2],ft[3]]},fromValues:function VC(ft,Te,Ue,$e){return[ft,Te,Ue,$e]},createView:function zC(ft,Te){return new Float64Array(ft,Te,4)}},Symbol.toStringTag,{value:"Module"}));var nh=v(90014),GC=v(70562);function am(){return{up:(0,X.c)(),right:(0,X.c)()}}function KC(ft,Te,Ue){(0,H.m)(ft.up,Te.up,Ue),(0,H.m)(ft.right,Te.right,Ue)}function ZC(ft,Te,Ue){(0,W.s)(ft,(0,H.e)(Ue,Te.right),(0,H.e)(Ue,Te.up))}class $C{constructor(){this.pos=(0,X.c)(),this.posES=(0,X.c)(),this.posGS=(0,X.c)(),this.vRight=(0,X.c)(),this.vLeft=(0,X.c)(),this.frame=am(),this.rotationFrame=am(),this.rotationRight=(0,B.a)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1]}setFrameFromUpVector(Te){(0,H.c)(this.frame.up,Te),(0,H.a)(qa,this.vLeft,this.vRight),(0,H.n)(qa,qa),(0,H.g)(Wl,this.frame.up,(0,H.e)(qa,this.frame.up)),(0,H.b)(fp,qa,Wl),(0,H.n)(fp,fp),(0,H.f)(this.frame.right,fp,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){(0,H.c)(this.rotationFrame.up,this.frame.up),(0,H.c)(this.rotationFrame.right,this.frame.right),(0,W.s)(this.rotationRight,1,0),(0,H.g)(Wl,this.frame.up,(0,H.e)(this.frame.up,this.vLeft)),(0,H.b)(Wl,this.vLeft,Wl),(0,H.o)(Wl,Wl),(0,H.n)(Wl,Wl),(0,H.g)(qa,this.frame.up,(0,H.e)(this.frame.up,this.vRight)),(0,H.b)(qa,this.vRight,qa),(0,H.n)(qa,qa),(0,H.f)(Tu,this.rotationFrame.up,this.vLeft);const Te=Math.sign((0,H.e)(Tu,this.vRight));if(this.rotationAngle=Te*(Math.PI-(0,Ar.ZF)((0,H.e)(Wl,qa))),Math.abs(this.rotationAngle)>0){const $e=(0,Ar.b_)(Math.cos(.5*this.rotationAngle));om(this.miterStretch,$e-1+1,0,0,1)}const Ue=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*Ue))}}class _p{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(Te,Ue){return this.vertices.push((0,B.d)(Te)),this.vertexNormals.push((0,B.d)(Ue)),this.vertices.length-1}addUV(Te){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(Te),this.uvs.length-1}addPole(Te,Ue=null){return this.poles.push({position:(0,B.d)(Te),normal:Ue?(0,B.d)(Ue):null}),this.poles.length-1}addSegment(Te,Ue=null,$e=null){this.vertexIndices.push(Te.v0),this.vertexIndices.push(Te.v1),Ue&&(this.uvIndices.push(Ue.v0),this.uvIndices.push(Ue.v1)),$e&&(this.poleIndices.push($e.v0),this.poleIndices.push($e.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(Te,Ue){for(const $e of this.vertices)$e[0]+=Te,$e[1]+=Ue;for(const $e of this.poles)$e.position[0]+=Te,$e.position[1]+=Ue}static circle(Te=20){const $e=new _p,st={v0:0,v1:0};$e.addPole((0,B.f)(0,0));for(let Rt=0;Rt<Te;++Rt){const Ut=2*Rt*Math.PI/Te,er=Math.cos(Ut),vr=Math.sin(Ut),Pr=(0,B.f)(.5*er,.5*vr),Ur=(0,B.f)(er,vr);$e.addVertex(Pr,Ur),$e.addUV(Rt/Te)}$e.addUV(1);for(let Rt=0;Rt<Te-1;++Rt){const Ut={v0:Rt,v1:Rt+1};$e.addSegment(Ut,Ut,st)}return $e.addSegment({v0:Te-1,v1:0},{v0:Te-1,v1:Te},st),$e}static rect(){const $e=new _p,st=(0,B.f)(-.5,-.5),ht=(0,B.f)(.5,-.5),yt=(0,B.f)(.5,.5),Rt=(0,B.f)(-.5,.5),Ut=(0,B.f)(0,-1),er=(0,B.f)(1,0),vr=(0,B.f)(0,1),Pr=(0,B.f)(-1,0);$e.addUV(0),$e.addUV(1),$e.addPole((0,B.f)(0,.5),vr),$e.addPole((0,B.f)(0,.5)),$e.addPole((0,B.f)(0,-.5)),$e.addPole((0,B.f)(0,-.5),Ut);const Ur={v0:0,v1:1};return $e.addVertex(st,Ut),$e.addVertex(ht,Ut),$e.addSegment({v0:0,v1:1},Ur,{v0:3,v1:3}),$e.addVertex(ht,er),$e.addVertex(yt,er),$e.addSegment({v0:2,v1:3},Ur,{v0:2,v1:1}),$e.addVertex(yt,vr),$e.addVertex(Rt,vr),$e.addSegment({v0:4,v1:5},Ur,{v0:0,v1:0}),$e.addVertex(Rt,Pr),$e.addVertex(st,Pr),$e.addSegment({v0:6,v1:7},Ur,{v0:1,v1:2}),$e}}class YC{constructor(Te){this.vertices=[],this.offset=(0,X.c)(),this.xform=(0,ye.c)(),this.vertices=Te;const Ue=Math.floor((Te.length-1)/2);(0,H.c)(this.offset,this.vertices[Ue].pos);for(const $e of this.vertices)(0,H.b)($e.pos,$e.pos,this.offset);(0,Se.v)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const Te=this.vertices.length;let Ue=this.vertices[0];Ue.index=0,(0,H.s)(Ue.vLeft,0,0,0),Ue.vLeftLength=0,(0,H.b)(Ue.vRight,this.vertices[1].pos,Ue.pos),Ue.vRightLength=(0,H.l)(Ue.vRight),(0,H.n)(Ue.vRight,Ue.vRight);let $e=Ue;for(let st=1;st<Te;++st)Ue=this.vertices[st],Ue.index=st,(0,H.c)(Ue.vLeft,$e.vRight),Ue.vLeftLength=$e.vRightLength,st<Te-1?((0,H.b)(Ue.vRight,this.vertices[st+1].pos,Ue.pos),Ue.vRightLength=(0,H.l)(Ue.vRight),(0,H.n)(Ue.vRight,Ue.vRight)):((0,H.c)(Ue.vRight,Ue.vLeft),Ue.vRightLength=Ue.vLeftLength),$e=Ue}}class kC{numProfilesPerJoin(){return 1}extrude(Te,Ue,$e){for(let st=0;st<Ue.vertices.length;++st)$e(Te.index,Te.frame,Ue.vertices[st],Ue.vertexNormals[st],!1)}}class lm{constructor(Te=.8*Math.PI,Ue=1){this.cutoffAngle=Te,this.numBendSubdivisions=Ue}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(Te,Ue,$e){const st=Oa;if(Math.abs(Te.rotationAngle)>=this.cutoffAngle)for(let ht=0;ht<this.numBendSubdivisions+1;++ht){(0,Se.d)(ca,.5*-Te.rotationAngle+ht*Te.rotationAngle/this.numBendSubdivisions,Te.rotationFrame.up),KC(st,Te.frame,ca);for(let yt=0;yt<Ue.vertices.length;++yt)(0,W.h)(Ue.vertices[yt],Te.rotationRight)*Te.rotationAngle>=0?$e(Te.index,st,Ue.vertices[yt],Ue.vertexNormals[yt],!1):((0,W.q)(id,Ue.vertices[yt],Te.miterStretch),$e(Te.index,Te.frame,id,Ue.vertexNormals[yt],!0))}else for(let ht=0;ht<this.numBendSubdivisions+1;++ht)for(let yt=0;yt<Ue.vertices.length;++yt){const Rt=(0,W.h)(Ue.vertices[yt],Te.rotationRight)*Te.rotationAngle>=0;(0,W.q)(id,Ue.vertices[yt],Te.miterStretch),$e(Te.index,Te.frame,id,Ue.vertexNormals[yt],!Rt)}}}const JC={generateUV:!1};class cm{rebuildConnectingProfileGeometry(Te,Ue,$e){for(let st=0;st<Ue.vertices.length;++st)$e(Te.index,Te.frame,Ue.vertices[st],Ue.vertexNormals[st],0,0)}}class iv extends cm{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class Nl extends cm{constructor(Te,Ue=0,$e=!1){super(),this.profile=Te,this.profilePlaneOffset=Ue,this.flip=$e}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(Te,Ue,$e){for(let st=0;st<Ue.vertices.length;++st)$e(Te.index,Te.frame,Ue.vertices[st],Ue.vertexNormals[st],this.profilePlaneOffset,0)}rebuildCapGeometry(Te,Ue){const $e=um;(0,W.s)($e,0,0);const st=this.flip?1:-1;for(let ht=0;ht<this.profile.vertices.length;++ht)Ue(Te.index,Te.frame,this.profile.vertices[ht],$e,this.profilePlaneOffset,st)}buildTopology(Te,Ue){const $e=this.vertexBufferStart+this.profile.vertexIndices[0];for(let st=1;st<this.profile.numSegments;++st){const Rt=this.vertexBufferStart+this.profile.vertexIndices[2*st+0],Ut=this.vertexBufferStart+this.profile.vertexIndices[2*st+1];this.flip?Ue(Ut,Rt,$e):Ue($e,Rt,Ut)}}}class nv extends cm{constructor(Te){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=Te.profile,this.flip=Te.flip,this.sign=this.flip?1:-1,this.breakNormals=Te.breakNormals,this.numSegments=Te.subdivisions}getNumVertices(){let Te=0;return Te=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(Te+=this.profile.vertices.length),Te+=this.profile.poles.length,Te}getNumIndices(){let Te=0;Te+=2*this.profile.numSegments*(this.numSegments-1);for(let Ue=0;Ue<this.profile.numSegments;++Ue)Te+=this.profile.poleIndices[this.profile.vertexIndices[2*Ue+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*Ue+1]]?1:2;return 3*Te}rebuildCapGeometry(Te,Ue){const $e=Te.frame,st=.5*this.sign,ht=id,yt=um;(0,W.s)(yt,0,0);for(let Rt=0;Rt<this.profile.poles.length;++Rt){const Ut=this.profile.poles[Rt];Ut.normal?Ue(Te.index,$e,Ut.position,Ut.normal,st,0):Ue(Te.index,$e,Ut.position,yt,st,this.sign)}if(this.breakNormals)for(let Rt=0;Rt<this.profile.vertices.length;++Rt)Ue(Te.index,$e,this.profile.vertices[Rt],this.profile.vertexNormals[Rt],0,0);for(let Rt=0;Rt<this.numSegments-1;++Rt){const Ut=(1-(Rt+1)/this.numSegments)*Math.PI*.5,er=Math.sin(Ut),vr=Math.cos(Ut);for(let Pr=0;Pr<this.profile.vertices.length;++Pr){const Ur=this.profile.poles[this.profile.poleIndices[Pr]];(0,W.a)(ht,this.profile.vertices[Pr],Ur.position),(0,W.b)(ht,ht,er),Ur.normal?((0,W.j)(ht,ht,Ur.position),Ue(Te.index,$e,ht,Ur.normal,st*vr,0)):((0,W.f)(yt,ht),(0,W.b)(yt,yt,er),(0,W.j)(ht,ht,Ur.position),Ue(Te.index,$e,ht,yt,st*vr,this.sign*vr))}}}buildTopology(Te,Ue){const $e=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,st=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ht=0;ht<this.profile.numSegments;++ht){const yt=this.profile.vertexIndices[2*ht+0],Rt=this.profile.vertexIndices[2*ht+1],Ut=this.vertexBufferStart+this.profile.poleIndices[yt],er=this.vertexBufferStart+this.profile.poleIndices[Rt];let vr=$e+yt,Pr=$e+Rt;for(let Ur=0;Ur<this.numSegments-1;++Ur){const qr=st+Ur*this.profile.vertices.length+yt,Zr=st+Ur*this.profile.vertices.length+Rt;this.flip?(Ue(qr,Pr,vr),Ue(Pr,qr,Zr)):(Ue(vr,Pr,qr),Ue(Zr,qr,Pr)),vr=qr,Pr=Zr}this.flip?(Ue(Ut,Pr,vr),Ut!==er&&Ue(Ut,er,Pr)):(Ue(vr,Pr,Ut),Ut!==er&&Ue(Pr,er,Ut))}}}class ov{constructor(Te,Ue,$e,st,ht,yt=JC){this.options=yt,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=Ue,this.path=Te,this.extruder=$e,this.startCap=st,this.endCap=ht;const Rt=this.path.vertices.length-2;this.numExtrusionProfiles=$e.numProfilesPerJoin()*Rt+2,this.numVerticesTotal=Ue.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const Ut=this.startCap.getNumVertices();this.numVerticesTotal+=Ut,this.numNormalsTotal+=Ut,this.endCap.vertexBufferStart=this.numVerticesTotal;const er=this.endCap.getNumVertices();this.numVerticesTotal+=er,this.numNormalsTotal+=er,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(Te,Ue,$e,st,ht){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=Ue.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=Ue.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=Ue.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=Ue.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=Ue.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=Ue.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=$e[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=$e[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=st[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=st[1],this.pathVertexData[this._extrusionVertexCount]=Te,ht){const yt=this.path.vertices[Te];this.profileRightAxisData[4*this._extrusionVertexCount+3]=yt.rotationRight[0]*yt.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=yt.rotationRight[1]*yt.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(Te,Ue,$e,st,ht,yt){this.profileRightAxisData[4*this._extrusionVertexCount+0]=Ue.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=Ue.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=Ue.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=Ue.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=Ue.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=Ue.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=$e[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=$e[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=st[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=st[1],this.pathVertexData[this._extrusionVertexCount]=Te,this.profileRightAxisData[4*this._extrusionVertexCount+3]=ht,this.profileUpAxisData[4*this._extrusionVertexCount+3]=yt,++this._extrusionVertexCount}emitTriangle(Te,Ue,$e){this.vertexIndices.push(Te),this.vertexIndices.push(Ue),this.vertexIndices.push($e),this.pathVertexIndices.push(this.pathVertexData[Te]),this.pathVertexIndices.push(this.pathVertexData[Ue]),this.pathVertexIndices.push(this.pathVertexData[$e]),this.normalIndices.push(Te),this.normalIndices.push(Ue),this.normalIndices.push($e)}_rebuildGeometry(){const Te=($e,st,ht,yt,Rt)=>this.emitVertex($e,st,ht,yt,Rt),Ue=($e,st,ht,yt,Rt,Ut)=>this.emitCapVertex($e,st,ht,yt,Rt,Ut);this._extrusionVertexCount=0;for(const $e of this.path.vertices)this.originData[3*$e.index+0]=$e.pos[0],this.originData[3*$e.index+1]=$e.pos[1],this.originData[3*$e.index+2]=$e.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,Ue);for(let $e=1;$e<this.path.vertices.length-1;++$e)this.extruder.extrude(this.path.vertices[$e],this.profile,Te);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,Ue),this.startCap.rebuildCapGeometry(this.path.vertices[0],Ue),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],Ue),this.profile.hasUV()&&this.options.generateUV)for(let $e=0;$e<this.profile.uvs.length;++$e)this.uvData[2*$e+0]=this.profile.uvs[$e],this.uvData[2*$e+1]=0}buildTopology(){const Te=this.profile.vertices.length,Ue=this.profile.numSegments,$e=this.numExtrusionProfiles-1;let st=Ue*$e*2*3;this.startCap.indexBufferStart=st,this.startCap.firstProfileVertexIndex=0,st+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=st,this.endCap.firstProfileVertexIndex=Te*(this.numExtrusionProfiles-1),this.vertexIndices=new Array,this.normalIndices=new Array,this.pathVertexIndices=new Array,this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Array);for(let yt=0;yt<Ue;++yt){const Rt=this.profile.vertexIndices[2*yt],Ut=this.profile.vertexIndices[2*yt+1];for(let er=0;er<$e;++er){const vr=er*Te+Rt,Ur=(er+1)*Te+Ut,qr=er*Te+Ut;this.emitTriangle(vr,(er+1)*Te+Rt,Ur),this.emitTriangle(vr,Ur,qr)}}const ht=(yt,Rt,Ut)=>this.emitTriangle(yt,Rt,Ut);this.startCap.buildTopology(this.path.vertices[0],ht),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],ht)}onPathChanged(){this._rebuildGeometry()}}class Ic{constructor(Te){this.builder=Te}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class QC extends Ic{constructor(Te){super(Te),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(Te){this.vertexAttributeColor[0]=255*Te[0],this.vertexAttributeColor[1]=255*Te[1],this.vertexAttributeColor[2]=255*Te[2],this.vertexAttributeColor[3]=255*(Te.length>3?Te[3]:1)}bake(Te){this.size=Te;for(let Ue=0;Ue<this.builder.numVerticesTotal;++Ue){let $e=this.builder.pathVertexData[Ue];const st=0===$e||$e===this.builder.path.vertices.length-1;$e*=3;const ht=qC;(0,H.s)(ht,this.builder.originData[$e++],this.builder.originData[$e++],this.builder.originData[$e]);const yt=4*Ue,Rt=Wl,Ut=id,er=qa,vr=Tu,Pr=oh;let Ur=0,qr=0;if((0,H.s)(vr,this.builder.profileRightAxisData[yt],this.builder.profileRightAxisData[yt+1],this.builder.profileRightAxisData[yt+2]),(0,H.s)(Pr,this.builder.profileUpAxisData[yt],this.builder.profileUpAxisData[yt+1],this.builder.profileUpAxisData[yt+2]),(0,W.s)(Ut,this.builder.profileVertexAndNormalData[yt]*Te[0],this.builder.profileVertexAndNormalData[yt+1]*Te[1]),st)(0,H.f)(er,Pr,vr),Ur=this.builder.profileRightAxisData[yt+3]*Te[0],qr=this.builder.profileUpAxisData[yt+3];else{const Es=um,si=eT;(0,W.s)(Es,this.builder.profileRightAxisData[yt+3],this.builder.profileUpAxisData[yt+3]);const ei=(0,W.i)(Es);(0,W.f)(Es,Es);const Rs=(0,W.h)(Ut,Es);if(Math.abs(Rs)>ei){(0,W.s)(si,-Es[1],Es[0]);const fi=(0,W.h)(Ut,si);(0,W.b)(Es,Es,ei*Math.sign(Rs)),(0,W.b)(si,si,fi),(0,W.j)(Ut,Es,si)}(0,H.s)(er,0,0,0)}(0,H.s)(Rt,vr[0]*Ut[0]+Pr[0]*Ut[1],vr[1]*Ut[0]+Pr[1]*Ut[1],vr[2]*Ut[0]+Pr[2]*Ut[1]),this.vertexAttributePosition[3*Ue+0]=ht[0]+Rt[0]+er[0]*Ur,this.vertexAttributePosition[3*Ue+1]=ht[1]+Rt[1]+er[1]*Ur,this.vertexAttributePosition[3*Ue+2]=ht[2]+Rt[2]+er[2]*Ur;const Zr=id;(0,W.s)(Zr,this.builder.profileVertexAndNormalData[yt+2],this.builder.profileVertexAndNormalData[yt+3]),this.vertexAttributeNormal[3*Ue+0]=vr[0]*Zr[0]+Pr[0]*Zr[1]+er[0]*qr,this.vertexAttributeNormal[3*Ue+1]=vr[1]*Zr[0]+Pr[1]*Zr[1]+er[1]*qr,this.vertexAttributeNormal[3*Ue+2]=vr[2]*Zr[0]+Pr[2]*Zr[1]+er[2]*qr}}createGeometryData(){const Te=[[Pe.T.POSITION,this.builder.vertexIndices],[Pe.T.NORMAL,this.builder.normalIndices]],Ue=[[Pe.T.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[Pe.T.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];return this.vertexAttributeColor&&(Te.push([Pe.T.COLOR,new Array(this.builder.vertexIndices.length).fill(0)]),Ue.push([Pe.T.COLOR,{size:4,data:this.vertexAttributeColor}])),{vertexAttributes:Ue,indices:Te}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(Te,Ue,$e){const st=this.builder.vertexIndices;(0,pp.CN)(Te,Ue,0,st.length/3,st,{size:3,data:this.vertexAttributePosition},void 0,void 0,$e)}}class Bx extends Ic{constructor(Te,Ue,$e,st){super(Te),this.sizeAttributeValue=Ue,this.colorAttributeValue=$e,this.opacityAttributeValue=st,this.vvData=null,this.baked=new QC(Te),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let ht=0;ht<this.builder.path.vertices.length;++ht)this.vvData[4*ht+0]=Ue,this.vvData[4*ht+1]=$e,this.vvData[4*ht+2]=st,this.vvData[4*ht+3]=0===ht||ht===this.builder.path.vertices.length-1?1:0}createGeometryData(){return{vertexAttributes:[[Pe.T.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[Pe.T.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[Pe.T.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[Pe.T.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[Pe.T.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[Pe.T.POSITION,this.builder.pathVertexIndices],[Pe.T.PROFILERIGHT,this.builder.vertexIndices],[Pe.T.PROFILEUP,this.builder.vertexIndices],[Pe.T.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[Pe.T.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const qC=(0,X.c)(),id=(0,B.a)(),um=(0,B.a)(),eT=(0,B.a)(),Wl=(0,X.c)(),qa=(0,X.c)(),Tu=(0,X.c)(),oh=(0,X.c)(),fp=(0,X.c)(),Oa=am(),ca=(0,ye.c)();var nd=v(96395),dm=v(36848),mp=v(60881),ah=v(40723),fn=v(17626),qc=v(68565),av=v(92724),lv=v(7228),cv=v(651),uv=v(91056),ki=v(87601),Lc=v(88569),dv=v(12407),gp=v(64127),Uc=v(44835),hv=v(41528),jx=v(24079),tT=v(57596),od=v(2078);const rT=new Map([[Pe.T.POSITION,0],[Pe.T.PROFILERIGHT,1],[Pe.T.PROFILEUP,2],[Pe.T.PROFILEVERTEXANDNORMAL,3],[Pe.T.FEATUREVALUE,4]]);class hm extends qc.C{constructor(){super(...arguments),this.ambient=(0,X.f)(.2,.2,.2),this.diffuse=(0,X.f)(.8,.8,.8),this.specular=(0,X.f)(0,0,0),this.opacity=1}}class ad extends uv.A{initializeConfiguration(Te,Ue){Ue.hasWebGL2Context=Te.rctx.type===tT.zO.WEBGL2,Ue.spherical=Te.viewingMode===We.JY.Global,Ue.doublePrecisionRequiresObfuscation=(0,lv.I)(Te.rctx)}initializeProgram(Te){return new dv.$(Te.rctx,ad.shader.get().build(this.configuration),rT)}initializePipeline(){const Te=this.configuration.transparencyPassType,Ue=this.configuration,$e=Te===Uc.A.NONE,st=Te===Uc.A.FrontFace;return(0,od.sm)({blending:Ue.output!==Hi.H.Color&&Ue.output!==Hi.H.Alpha||!Ue.transparent?null:$e?Lc.wu:(0,Lc.j7)(Te),culling:Ue.hasSlicePlane&&!Ue.transparent&&Ue.doubleSidedMode!==nd.q.None&&od.sg,depthTest:{func:(0,Lc.Bh)(Te)},depthWrite:$e||st?od.LZ:null,colorWrite:od.BK,stencilWrite:Ue.hasOccludees?gp.s3:null,stencilTest:Ue.hasOccludees?gp.RY:null,polygonOffset:$e||st?null:Lc.E0})}}ad.shader=new cv.J(jx.P,()=>v.e(3478).then(v.bind(v,93478)));class jo extends hv.W{constructor(){super(...arguments),this.output=Hi.H.Color,this.doubleSidedMode=nd.q.None,this.transparencyPassType=Uc.A.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}(0,fn._)([(0,ki.o)({count:Hi.H.COUNT})],jo.prototype,"output",void 0),(0,fn._)([(0,ki.o)({count:nd.q.COUNT})],jo.prototype,"doubleSidedMode",void 0),(0,fn._)([(0,ki.o)({count:Uc.A.COUNT})],jo.prototype,"transparencyPassType",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"spherical",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"receiveShadows",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"receiveAmbientOcclusion",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"vvSize",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"vvColor",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"vvOpacity",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"hasSlicePlane",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"transparent",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"hasOccludees",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"hasMultipassTerrain",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"cullAboveGround",void 0),(0,fn._)([(0,ki.o)()],jo.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,fn._)([(0,ki.o)({constValue:av.f7.Disabled})],jo.prototype,"pbrMode",void 0),(0,fn._)([(0,ki.o)({constValue:!0})],jo.prototype,"hasVvInstancing",void 0),(0,fn._)([(0,ki.o)({constValue:!1})],jo.prototype,"useCustomDTRExponentForWater",void 0),(0,fn._)([(0,ki.o)({constValue:!1})],jo.prototype,"useFillLights",void 0);var ld=v(42037);class pm extends ah.F5{constructor(Te){super(Te,new fm),this.supportsEdges=!0,this._vertexAttributeLocations=rT,this._configuration=new jo,this._vertexBufferLayout=pm.getVertexBufferLayout(this.parameters)}getConfiguration(Te,Ue){return this._configuration.output=Te,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,Te!==Hi.H.Color&&Te!==Hi.H.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?nd.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?nd.q.WindingOrder:nd.q.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!Ue.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=Ue.transparencyPassType,this._configuration.hasMultipassTerrain=Ue.multipassTerrain.enabled,this._configuration.cullAboveGround=Ue.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(Te){return Te!==Hi.H.Shadow&&Te!==Hi.H.ShadowExludeHighlight&&Te!==Hi.H.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(Te,Ue,$e,st,ht,yt,Rt){const Ut=Te;if(!rv(Ut))return;const er=Ut.path,vr=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const ei=this.parameters.vvSizeOffset,Rs=this.parameters.vvSizeFactor,fi=this.parameters.vvSizeMinSize,Pi=this.parameters.vvSizeMaxSize,mn=er.sizeAttributeValue;vr[0]*=(0,Ar.uZ)(ei[0]+mn*Rs[0],fi[0],Pi[0]),vr[1]*=(0,Ar.uZ)(ei[2]+mn*Rs[2],fi[2],Pi[2])}const Pr=Math.max(vr[0],vr[1]),Ur=Te.boundingInfo;if((0,G.Wi)(Ur))return void this._intersectTriangles(er,vr,ht,yt,Rt);const qr=(0,oe.al)(Ur.bbMin[0]-Pr,Ur.bbMin[1]-Pr,Ur.bbMin[2]-Pr,Ur.bbMax[0]+Pr,Ur.bbMax[1]+Pr,Ur.bbMax[2]+Pr),Zr=[yt[0]-ht[0],yt[1]-ht[1],yt[2]-ht[2]],Es=Math.sqrt(Zr[0]*Zr[0]+Zr[1]*Zr[1]+Zr[2]*Zr[2]);(0,pp.Tw)(qr,ht,[Es/Zr[0],Es/Zr[1],Es/Zr[2]],st.tolerance)&&this._intersectTriangles(er,vr,ht,yt,Rt)}_intersectTriangles(Te,Ue,$e,st,ht){Te.baked.size&&Te.baked.size[0]===Ue[0]&&Te.baked.size[1]===Ue[1]||Te.baked.bake(Ue),Te.baked.intersect($e,st,ht)}computeAttachmentOrigin(Te,Ue){const $e=Te.vertexAttributes;if(!$e)return null;const st=$e.get(Pe.T.POSITION);return(0,dm.qZ)(st,null,!1,Ue)}createBufferWriter(){return new mm(this._vertexBufferLayout)}requiresSlot(Te,Ue){switch(Ue){case Hi.H.Shadow:case Hi.H.ShadowHighlight:case Hi.H.ShadowExludeHighlight:if(!this.parameters.castShadows)return!1;case Hi.H.Color:case Hi.H.Alpha:case Hi.H.Depth:case Hi.H.Normal:case Hi.H.Highlight:case Hi.H.ObjectAndLayerIdColor:return Te===(this.parameters.transparent?zo.r.TRANSPARENT_MATERIAL:zo.r.OPAQUE_MATERIAL)||Te===zo.r.DRAPED_MATERIAL;default:return!1}}createGLMaterial(Te){return new _m(Te)}static getVertexBufferLayout(Te){const Ue=(0,qf.U$)().vec3f(Pe.T.POSITION).vec4f(Pe.T.PROFILERIGHT).vec4f(Pe.T.PROFILEUP).vec4f(Pe.T.PROFILEVERTEXANDNORMAL);return(Te.vvColorEnabled||Te.vvSizeEnabled||Te.vvOpacityEnabled)&&Ue.vec4f(Pe.T.FEATUREVALUE),Ue}}class _m extends mp.Z{_updateOccludeeState(Te){Te.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Te.hasOccludees})}_updateShadowState(Te){((0,G.Wi)(this.technique)||Te.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:Te.shadowMap.enabled})}beginSlot(Te){return this._output!==Hi.H.Color&&this._output!==Hi.H.Alpha||(this._updateShadowState(Te),this._updateOccludeeState(Te)),this.ensureTechnique(ad,Te)}}class fm extends hm{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class mm{constructor(Te){this.vertexBufferLayout=Te}allocate(Te){return this.vertexBufferLayout.createBuffer(Te)}elementCount(Te){return Te.indices.get(Pe.T.POSITION).length}write(Te,Ue,$e,st,ht){gm(Pe.T.PROFILERIGHT,$e,st,ht),gm(Pe.T.PROFILEUP,$e,st,ht),gm(Pe.T.PROFILEVERTEXANDNORMAL,$e,st,ht),this.vertexBufferLayout.hasField(Pe.T.FEATUREVALUE)&&gm(Pe.T.FEATUREVALUE,$e,st,ht),(0,ld.NK)($e,this.vertexBufferLayout,Te,Ue,st,ht)}}function gm(ft,Te,Ue,$e){if(Te.vertexAttributes.has(ft)){const st=Te.vertexAttributes.get(ft),ht=Te.indices.get(ft);(0,Bo.hu)(4===st.size);const yt=Ue.getField(ft,ve.ek);if(!yt)throw new Error("unable to acquire view for "+ft);(0,ld.SW)(ht,st.data,yt,$e)}}const sT=["polyline"];function Bc(ft,Te,Ue){switch(Te){case"world":for(const $e of ft.vertices)(0,H.a)(Vl,$e.pos,ft.offset),Ue.worldUpAtPosition(Vl,el),$e.setFrameFromUpVector(el),$e.computeRotationAxisAndAngleFromUpVector();break;case"path":(0,H.a)(Vl,ft.vertices[0].pos,ft.offset),Ue.worldUpAtPosition(Vl,el),function XC(ft,Te){let Ue=null;const $e=ft.vertices.length,st=.99619469809,ht=(0,X.c)(),yt=(0,X.c)(),Rt=(0,X.c)(),Ut=(0,X.c)(),er=(0,X.c)(),vr=(0,X.c)(),Pr=(0,nh.Ue)();let Ur=ft.vertices[0];(0,H.c)(yt,Te),(0,H.s)(ht,0,1,0),(0,xi.Ay)(Ur.vRight,yt,ht,ht,Rt,yt,st),(0,H.c)(Ur.frame.up,yt),(0,H.c)(Ur.frame.right,Rt),Ue=Ur;for(let qr=1;qr<$e;++qr){Ur=ft.vertices[qr],(0,H.a)(er,Ur.vLeft,Ur.vRight);let Zr=(0,H.l)(er);Zr>0?(Zr=1/Math.sqrt(Zr),er[0]=er[0]*Zr,er[1]=er[1]*Zr,er[2]=er[2]*Zr):(er[0]=Ur.vRight[0],er[1]=Ur.vRight[1],er[2]=Ur.vRight[2]),(0,H.a)(vr,Ue.pos,Ue.frame.up),(0,nh.Yq)(Ur.pos,er,Pr),(0,nh.BR)(Pr,(0,GC.re)(vr,Ur.vLeft),Ut)?((0,H.b)(Ut,Ut,Ur.pos),(0,H.n)(yt,Ut),(0,H.f)(Rt,er,yt),(0,H.n)(Rt,Rt)):(0,xi.Ay)(er,Ue.frame.up,Ue.frame.right,ht,Rt,yt,st),(0,H.c)(Ur.frame.up,yt),(0,H.c)(Ur.frame.right,Rt),Ue=Ur}}(ft,el);for(const $e of ft.vertices){const st=Math.sign((0,H.e)($e.frame.right,$e.vRight));(0,H.f)($e.rotationFrame.up,$e.vRight,$e.vLeft),(0,H.g)($e.rotationFrame.up,$e.rotationFrame.up,st),(0,H.n)($e.rotationFrame.up,$e.rotationFrame.up);const ht=(0,H.e)($e.rotationFrame.up,$e.frame.up),yt=(0,H.e)($e.rotationFrame.up,$e.frame.right);if((0,H.g)(Vl,$e.frame.up,-yt),(0,H.g)(H0,$e.frame.right,ht),(0,H.a)(Vl,Vl,H0),(0,H.n)($e.rotationFrame.right,Vl),ZC($e.rotationRight,$e.frame,$e.rotationFrame.right),(0,H.o)(Vl,$e.vLeft),$e.rotationAngle=-st*(Math.PI-(0,Ar.ZF)((0,H.e)(Vl,$e.vRight))),Math.abs($e.rotationAngle)>0){const Ut=(0,Ar.b_)(Math.cos(.5*$e.rotationAngle));om($e.miterStretch,1+(Ut-1)*$e.rotationRight[0]*$e.rotationRight[0],(Ut-1)*$e.rotationRight[0]*$e.rotationRight[1],(Ut-1)*$e.rotationRight[0]*$e.rotationRight[1],1+(Ut-1)*$e.rotationRight[1]*$e.rotationRight[1])}const Rt=Math.PI-$e.rotationAngle;$e.maxStretchDistance=Math.abs(Math.min($e.vLeftLength,$e.vRightLength)*(0,Ar.b_)(Math.cos(.5*Rt)))}}}function gl(ft,Te,Ue){switch(ft){case"symbol-value":return Ue;case"proportional":return Te;default:return ft}}function eu(ft,Te,Ue,$e){let st=0;for(const ht of ft.vertices)(0,Ce.qZ)(ht.posES,Ue,Te,$e,Oo),st+=Oo.sampledElevation,(0,H.a)(el,ht.pos,ft.offset),$e.setAltitude(el,Oo.z),(0,H.b)(ht.pos,el,ft.offset);return ft.updatePathVertexInformation(),st/ft.vertices.length}function tu(ft,Te,Ue,$e){const st=ft.stageObject,ht=st.geometryRecords;let yt=0;ym.spatialReference=$e.spatialReference;for(const Rt of ht){const Ut=Rt.geometry;if(!rv(Ut))continue;const er=Ut.path,vr=er.builder.path;vm.spatialReference=Ut.geometrySR,yt+=eu(vr,Te,Ue,$e),"world"!==Ut.upVectorAlignment&&Bc(vr,Ut.upVectorAlignment,$e),er.onPathChanged(),Ut.invalidateBoundingInfo(),st.geometryVertexAttrsUpdated(Rt)}return yt/ht.length}const ym=(0,se.Tx)(0,0,0,null),vm=(0,se.Tx)(0,0,0,null),el=(0,X.c)(),Vl=(0,tv.c)(),H0=(0,tv.c)(),Oo=new Ce.Lm;var Fx=v(12080);function nT(ft,Te,Ue,$e,st=1){(0,H.s)(ch,1,0,0),(0,H.s)(Mu,0,1,0),(0,H.s)(yp,0,0,1),function oT(ft,Te){(0,H.s)(k0,0,0,0);for(let Ue=0;Ue<Te.count-1;Ue++)Te.getVec(Ue,yl),(0,H.a)(k0,k0,yl);(0,H.g)(ft,k0,1/(Te.count-1))}(K0,Te),function ud(ft,Te){const Ue=ft.count-1;return(0,nh.$I)(ft,Te,0,Math.floor(Ue/3),Math.floor(Ue*(2/3)))}(Te,Z0)&&function $0(ft,Te,Ue,$e,st,ht){(0,G.pC)(st)?(st.basisMatrixAtPosition(ht,vl),(0,H.s)(Y0,vl[0],vl[1],vl[2]),(0,H.s)(X0,vl[4],vl[5],vl[6]),(0,H.s)(Ou,vl[8],vl[9],vl[10])):((0,H.s)(Y0,1,0,0),(0,H.s)(X0,0,1,0),(0,H.s)(Ou,0,0,1));const yt=(0,nh.mJ)(ft);(0,H.e)(yt,Ou)<0&&(0,H.g)(yt,yt,-1),(0,H.c)($e,yt);const Rt=(0,H.e)(yt,X0),Ut=(0,H.e)(yt,Y0);Math.abs(Rt)<Math.abs(Ut)?((0,H.z)(Te,Y0,yt,-Ut),(0,H.n)(Te,Te),(0,H.f)(Ue,Te,yt),(0,H.n)(Ue,Ue),(0,H.g)(Ue,Ue,-1)):((0,H.z)(Ue,X0,yt,-Rt),(0,H.n)(Ue,Ue),(0,H.f)(Te,Ue,yt),(0,H.n)(Te,Te))}(Z0,ch,Mu,yp,Ue,K0),(0,W.s)(Hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,W.s)(uh,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let Ut=0;Ut<Te.count;Ut++){Te.getVec(Ut,yl);const er=(0,H.e)(ch,yl),vr=(0,H.e)(Mu,yl);Hn[0]=Math.min(Hn[0],er),Hn[1]=Math.min(Hn[1],vr),uh[0]=Math.max(uh[0],er),uh[1]=Math.max(uh[1],vr)}const ht=(0,H.e)(yp,K0);_v(cd,Hn[0],Hn[1],ht,ch,Mu,yp),_v(Pu,uh[0],Hn[1],ht,ch,Mu,yp),_v(dh,Hn[0],uh[1],ht,ch,Mu,yp),(0,H.b)(Pu,Pu,cd),(0,H.g)(Pu,Pu,.5),(0,H.b)(dh,dh,cd),(0,H.g)(dh,dh,.5),(0,H.a)(cd,cd,Pu),(0,H.a)(cd,cd,dh);const Rt=Hn[1]%st;tl[0]=Hn[0]-Hn[0]%st,tl[1]=Hn[1]-Rt;for(let Ut=0;Ut<Te.count;Ut++){Te.getVec(Ut,yl),ft.setValues(Ut,((0,H.e)(ch,yl)-tl[0])/st,((0,H.e)(Mu,yl)-tl[1])/st,tl[0]/st,tl[1]/st);for(let er=0;er<3;er++)$e.set(Ut,er,cd[er]),$e.set(Ut,er+3,Pu[er]),$e.set(Ut,er+6,dh[er])}}const K0=(0,X.c)(),yl=(0,X.c)(),Z0=(0,nh.Ue)(),ch=(0,X.c)(),Mu=(0,X.c)(),yp=(0,X.c)(),Hn=(0,B.a)(),uh=(0,B.a)(),tl=(0,B.a)(),cd=(0,X.c)(),Pu=(0,X.c)(),dh=(0,X.c)(),vl=(0,ye.c)(),Y0=(0,X.c)(),X0=(0,X.c)(),Ou=(0,X.c)(),k0=(0,X.c)();function _v(ft,Te,Ue,$e,st,ht,yt){(0,H.s)(ft,Te*st[0]+Ue*ht[0]+$e*yt[0],Te*st[1]+Ue*ht[1]+$e*yt[1],Te*st[2]+Ue*ht[2]+$e*yt[2])}var aT=v(92972),dd=v(95402),Nx=v(60909),Wx=v(66401);class bm extends uv.A{initializeConfiguration(Te,Ue){Ue.hasWebGL2Context=Te.rctx.type===tT.zO.WEBGL2}initializeProgram(Te){return new dv.$(Te.rctx,bm.shader.get().build(this.configuration),J0)}_setPipelineState(Te,Ue){const $e=this.configuration,st=Te===Uc.A.NONE,ht=Te===Uc.A.FrontFace;return(0,od.sm)({blending:$e.output===Hi.H.Color||$e.output===Hi.H.Alpha?st?Lc.wu:(0,Lc.j7)(Te):null,culling:(0,od.zp)($e.cullFace),depthTest:{func:(0,Lc.Bh)(Te)},depthWrite:st?$e.writeDepth&&od.LZ:(0,Lc.K5)(Te),colorWrite:od.BK,stencilWrite:$e.hasOccludees?gp.s3:null,stencilTest:$e.hasOccludees?Ue?gp.eD:gp.RY:null,polygonOffset:st||ht?$e.polygonOffset&&Vx:(0,Lc.je)($e.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(Te,Ue){return Ue?this._occludeePipelineState:super.getPipelineState(Te,Ue)}}bm.shader=new cv.J(Wx.P,()=>v.e(5655).then(v.bind(v,35655)));const Vx={factor:1,units:1};class Eo extends hv.W{constructor(){super(...arguments),this.output=Hi.H.Color,this.cullFace=Ie.Vr.None,this.transparencyPassType=Uc.A.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,fn._)([(0,ki.o)({count:Hi.H.COUNT})],Eo.prototype,"output",void 0),(0,fn._)([(0,ki.o)({count:Ie.Vr.COUNT})],Eo.prototype,"cullFace",void 0),(0,fn._)([(0,ki.o)({count:dd.b.COUNT})],Eo.prototype,"style",void 0),(0,fn._)([(0,ki.o)({count:Uc.A.COUNT})],Eo.prototype,"transparencyPassType",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"hasSlicePlane",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"hasVertexColors",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"polygonOffset",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"writeDepth",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"hasOccludees",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"patternSpacing",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"lineWidth",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"enableOffset",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"draped",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"hasMultipassTerrain",void 0),(0,fn._)([(0,ki.o)()],Eo.prototype,"cullAboveGround",void 0);const J0=new Map([[Pe.T.POSITION,0],[Pe.T.COLOR,3],[Pe.T.UVMAPSPACE,4],[Pe.T.BOUNDINGRECT,5]]);class hh extends ah.F5{constructor(Te){super(Te,new ph),this.supportsEdges=!0,this._vertexAttributeLocations=J0,this._configuration=new Eo}getConfiguration(Te,Ue){return this._configuration.output=Te,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=Ue.transparencyPassType,this._configuration.enableOffset=Ue.camera.relativeElevation<Lc.ve,this._configuration.hasMultipassTerrain=Ue.multipassTerrain.enabled,this._configuration.cullAboveGround=Ue.multipassTerrain.cullAboveGround,this._configuration}intersect(Te,Ue,$e,st,ht,yt,Rt){(0,pp.Bw)(Te,Ue,st,ht,yt,void 0,Rt)}requiresSlot(Te,Ue){return!!(Ue===Hi.H.Color||Ue===Hi.H.Alpha||Ue===Hi.H.Highlight||Ue===Hi.H.Depth&&this.parameters.writeLinearDepth)&&(Te===zo.r.DRAPED_MATERIAL||(Ue===Hi.H.Highlight?Te===zo.r.OPAQUE_MATERIAL:Te===(this.parameters.writeDepth?zo.r.TRANSPARENT_MATERIAL:zo.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)))}createGLMaterial(Te){return new lT(Te)}createBufferWriter(){const Te=(0,qf.U$)().vec3f(Pe.T.POSITION).vec4u8(Pe.T.COLOR).vec4f(Pe.T.UVMAPSPACE);return this.parameters.draped||Te.mat3f(Pe.T.BOUNDINGRECT),new cT(Te)}}class lT extends mp.Z{_updateParameters(Te){return this.ensureTechnique(bm,Te)}_updateOccludeeState(Te){Te.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Te.hasOccludees})}beginSlot(Te){return this._output!==Hi.H.Color&&this._output!==Hi.H.Alpha||this._updateOccludeeState(Te),this._updateParameters(Te)}}class cT extends Nx.G_{write(Te,Ue,$e,st,ht){for(const yt of this.vertexBufferLayout.fieldNames){const Rt=$e.vertexAttributes.get(yt),Ut=$e.indices.get(yt);if(Rt&&Ut)switch(yt){case Pe.T.POSITION:{(0,Bo.hu)(3===Rt.size);const er=st.getField(yt,ve.ct);er&&(0,ld.ho)(Ut,Rt.data,Te,er,ht);break}case Pe.T.COLOR:{(0,Bo.hu)(3===Rt.size||4===Rt.size);const er=st.getField(yt,ve.mc);er&&(0,ld.Vs)(Ut,Rt.data,Rt.size,er,ht);break}case Pe.T.UVMAPSPACE:{(0,Bo.hu)(4===Rt.size);const er=st.getField(yt,ve.ek);er&&(0,ld.SW)(Ut,Rt.data,er,ht);break}case Pe.T.BOUNDINGRECT:{(0,Bo.hu)(9===Rt.size);const er=st.getField(yt,ve.gK);er&&this.writeBoundingRect(Ut,Rt.data,Te,er,ht);break}}}}writeBoundingRect(Te,Ue,$e,st,ht){const yt=$e,Rt=st.typedBuffer,Ut=st.typedBufferStride,er=Te.length;ht*=Ut;for(let vr=0;vr<er;++vr){const Pr=9*Te[vr],Ur=Ue[Pr],qr=Ue[Pr+1],Zr=Ue[Pr+2];Rt[ht]=yt[0]*Ur+yt[4]*qr+yt[8]*Zr+yt[12],Rt[ht+1]=yt[1]*Ur+yt[5]*qr+yt[9]*Zr+yt[13],Rt[ht+2]=yt[2]*Ur+yt[6]*qr+yt[10]*Zr+yt[14];for(let Es=3;Es<9;++Es)Rt[ht+Es]=Ue[Pr+Es];ht+=Ut}}}class ph extends ah.Mt{constructor(){super(...arguments),this.color=(0,tr.f)(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ie.Vr.None,this.hasOccludees=!1,this.style=dd.b.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Kx(ft,Te){if(function Gx(ft){return ft.material instanceof hh&&!ft.material.parameters.draped}(ft)){const Ue=ft.geometry.vertexAttributes,$e=Ue.get(Pe.T.POSITION).data,st=Ue.get(Pe.T.UVMAPSPACE).data,ht=Ue.get(Pe.T.BOUNDINGRECT).data;nT(ve.ek.fromTypedArray(st),ve.fP.fromTypedArray($e),Te,ve.ey.fromTypedArray(ht))}}function Zx(ft,Te,Ue,$e){const st=(0,Ir.Wf)(ft,Te,Ue,$e),ht=ft.stageObject.geometryRecords;for(let yt=0;yt<ht.length;yt++)Kx(ht[yt],$e);return st}const $x=["polyline","polygon","extent"];class Cm extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._needsUV=!1,this._hasOutline=!1}doLoad(){return(0,D.Z)(function*(){})()}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if((0,G.pC)(this._material))return;const Te=(0,G.U2)(this.symbolLayer,"material","color"),Ue=this._getCombinedOpacityAndColor(Te);this._material=function uT(ft,Te,Ue){return function zx(ft,Te,Ue){return(0,G.pC)(ft)?"none"===ft.style||"solid"===ft.style?("none"===ft.style&&(Te.color=(0,tr.f)(0,0,0,0),Te.transparent=!0),new aT.E(Te)):(Te.style=function Hx(ft){switch(ft){case"horizontal":return dd.b.Horizontal;case"vertical":return dd.b.Vertical;case"cross":return dd.b.Cross;case"forward-diagonal":return dd.b.ForwardDiagonal;case"backward-diagonal":return dd.b.BackwardDiagonal;case"diagonal-cross":return dd.b.DiagonalCross;default:return}}(ft.style),Te.draped=Ue.isDraped,new hh(Te)):new aT.E(Te)}(function dT(ft){return ft&&ft.pattern||null}(ft),Te,Ue)}(this.symbolLayer,{color:Ue,transparent:Ue[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof hh,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const Te=this.symbolLayer.outline;!(0,G.pC)(this._outlineMaterial)&&this._isValidOutline(Te)&&(this._hasOutline=!0,this._outlineMaterial=($e=>{const st=(0,Ot.Dp)(Te.pattern);return new It.U({width:$e,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:st,stippleScaleWithLineWidth:!0,cap:cr(Te.patternCap||"butt")})})((0,ct.F2)(Te.size)),this._context.stage.add(this._outlineMaterial))}_isValidOutline(Te){return(0,G.pC)(Te)&&Te.size&&Te.size>0&&(0,G.pC)(Te.color)&&((0,G.Wi)(Te.pattern)||"style"!==Te.pattern.type||"none"!==Te.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,$x,this.symbolLayer.type))return null;const $e=this._getVertexOpacityAndColor(Te.renderingInfo,255),st=this.setGraphicElevationContext(Ue,new Be.o);return this.ensureDrapedStatus("on-the-ground"===st.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(Ue,$e):this._createAs3DShape(Ue,$e,st)}layerOpacityChanged(){if((0,G.pC)(this._material)){const Te=this._material.parameters.color,Ue=(0,G.U2)(this.symbolLayer,"material","color"),$e=this._getCombinedOpacity(Ue);this._material.setParameters({color:[Te[0],Te[1],Te[2],$e],transparent:$e<1||this.needsDrivenTransparentPass})}if((0,G.pC)(this._outlineMaterial)){const Te=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[Te[0],Te[1],Te[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(Te,Ue,$e){const st=this._elevationContext.mode,ht=(0,Ce.GC)(Cm.elevationModeChangeTypes,$e,st);if(ht!==Ce.lO.UPDATE)return ht;const yt=(0,Ce.Xf)(st);return this.updateGraphics3DGraphicElevationInfo(Te,Ue,()=>yt)}slicePlaneEnabledChanged(){return(0,G.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(0,G.pC)(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(Te,Ue,$e){const st=Xe(Te.geometry);if((0,G.Wi)(st))return null;const ht=ot(st,this._context.elevationProvider,this._context.renderCoordsHelper,$e),yt=new Yx(ht,Ue,this._context.layer.uid,Te.uid),Rt=yt.renderData.position.length/3;if(this._needsUV&&(yt.uvMapSpace=new Float32Array(4*Rt),yt.boundingRect=new Float64Array(9*Rt)),yt.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:yt.graphicsUid,layerUid:yt.layerUid}),this._createAs3DShapeFill(yt),this._hasOutline&&this._createAs3DShapeOutline(yt),this._logGeometryCreationWarnings(yt.renderData,st.rings,"rings","FillSymbol3DLayer"),0===yt.outGeometries.length)return null;this._needsUV&&nT(ve.ek.fromTypedArray(yt.uvMapSpace),ve.fP.fromTypedArray(yt.renderData.position),this._context.renderCoordsHelper,ve.ey.fromTypedArray(yt.boundingRect));const Ut=new $t.T({geometries:yt.outGeometries,materials:yt.outMaterials,transformations:yt.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:Te.uid}}),er=new ue.z(this,Ut,yt.outGeometries,null,null,Zx,$e);return er.alignedSampledElevation=yt.renderData.sampledElevation,er.needsElevationUpdates=(0,Ce.Xf)($e.mode),er}_createAs3DShapeFill(Te){const Ue=Te.renderData.polygons;for(const{position:$e,mapPosition:st,holeIndices:ht,index:yt,count:Rt}of Ue){if((0,G.pC)(this._context.clippingExtent)&&((0,oe.cS)(Xo),(0,oe.G1)(Xo,st),!(0,oe.Zp)(Xo,this._context.clippingExtent)))continue;const Ut=(0,Ee.e)(st,ht,3);if(0===Ut.length)continue;const er=Me({indices:Ut,attributeData:{position:$e,color:Te.color,mapPosition:st,uvMapSpace:this._needsUV?new Float32Array(Te.uvMapSpace.buffer,4*yt*Te.uvMapSpace.BYTES_PER_ELEMENT,4*Rt):null,boundingRect:this._needsUV?new Float64Array(Te.boundingRect.buffer,9*yt*Te.boundingRect.BYTES_PER_ELEMENT,9*Rt):null,objectAndLayerIdColor:Te.objectAndLayerIdColor}});Te.outGeometries.push(er),Te.outMaterials.push((0,G.Wg)(this._material)),Te.outTransforms.push(ye.I)}}_createAs3DShapeOutline(Te){if(!this._hasOutline)return;const Ue=Te.renderData.outlines;for(let $e=0;$e<Ue.length;++$e){const{mapPosition:st,position:ht}=Ue[$e];if((0,G.pC)(this._context.clippingExtent)&&((0,oe.cS)(Xo),(0,oe.G1)(Xo,st),!(0,oe.Zp)(Xo,this._context.clippingExtent)))continue;const yt=(0,vs.YU)({overlayInfo:null,removeDuplicateStartEnd:!0,attributeData:{position:ht,mapPosition:st}},Te.objectAndLayerIdColor),Rt=yt.vertexAttributes.get(Pe.T.POSITION);Rt.data===ht&&(Rt.data=new Float64Array(ht)),Te.outGeometries.push(yt),Te.outMaterials.push((0,G.Wg)(this._outlineMaterial)),Te.outTransforms.push(ye.I)}}_createAsOverlay(Te,Ue){const $e=Xe(Te.geometry);if((0,G.Wi)($e))return null;(0,G.Wg)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,(0,G.pC)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const st=ut($e,this._context.overlaySR),ht=new fv(st,Ue,this._context.layer.uid,Te.uid);return this._needsUV&&(ht.uvMapSpace=new Float32Array(ht.renderData.position.length/3*4)),ht.outBoundingBox=(0,oe.cS)(),ht.objectAndLayerIdColor=this._context.stage.renderView?._getObjectAndLayerIdColor({graphicUid:ht.graphicsUid,layerUid:ht.layerUid}),this._createAsOverlayFill(ht),this._hasOutline&&this._createAsOverlayOutline(ht),this._logGeometryCreationWarnings(ht.renderData,$e.rings,"rings","FillSymbol3DLayer"),0===ht.outGeometries.length?null:(this._needsUV&&function Em(ft,Te,Ue,$e,st=1){if(Ue.isGeographic&&$e===We.JY.Global){const Rt=new Float64Array(Te.typedBuffer.length),Ut=3*Te.count,er=(0,Fx.Iu)(Ue);for(let vr=0;vr<Ut;vr+=3)(0,ae.gH)(Te.typedBuffer,vr,Rt,vr,er);Te=ve.fP.fromTypedArray(Rt)}(0,W.s)(Hn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let Rt=0;Rt<Te.count;Rt++)Te.getVec(Rt,yl),Hn[0]=Math.min(Hn[0],yl[0]),Hn[1]=Math.min(Hn[1],yl[1]);const yt=Hn[1]%st;tl[0]=Hn[0]-Hn[0]%st,tl[1]=Hn[1]-yt;for(let Rt=0;Rt<Te.count;Rt++)Te.getVec(Rt,yl),ft.setValues(Rt,(yl[0]-tl[0])/st,(yl[1]-tl[1])/st,tl[0]/st,tl[1]/st)}(ve.ek.fromTypedArray(ht.uvMapSpace),ve.fP.fromTypedArray(ht.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),new fs(this,ht.outGeometries,ht.outBoundingBox,this._context.drapeSourceRenderer))}_createAsOverlayFill(Te){const Ue=Te.renderData.polygons;for(const{position:$e,holeIndices:st,index:ht,count:yt}of Ue){if((0,oe.cS)(Xo),(0,oe.G1)(Xo,$e),!(0,oe.Zp)(Xo,this._context.clippingExtent))continue;const Rt=(0,Ee.e)($e,st,3);if(0===Rt.length)continue;(0,oe.TC)(Te.outBoundingBox,Xo);const Ut=Me({indices:Rt,attributeData:{position:$e,color:Te.color,uvMapSpace:this._needsUV?new Float32Array(Te.uvMapSpace.buffer,4*ht*Te.uvMapSpace.BYTES_PER_ELEMENT,4*yt):null,objectAndLayerIdColor:Te.objectAndLayerIdColor}}),er=new en.z(Ut,(0,G.Wg)(this._material),{layerUid:Te.layerUid,graphicUid:Te.graphicsUid});(0,Kt.s)(er.boundingSphere,.5*(Xo[0]+Xo[3]),.5*(Xo[1]+Xo[4]),0,.5*Math.sqrt((Xo[3]-Xo[0])*(Xo[3]-Xo[0])+(Xo[4]-Xo[1])*(Xo[4]-Xo[1]))),Te.outGeometries.push(er)}}_createAsOverlayOutline(Te){if(!this._hasOutline)return;const Ue=Te.renderData.outlines;for(let $e=0;$e<Ue.length;++$e){const{position:st}=Ue[$e];if((0,oe.cS)(Xo),(0,oe.G1)(Xo,st),!(0,oe.Zp)(Xo,this._context.clippingExtent))continue;(0,oe.TC)(Te.outBoundingBox,Xo);const ht=(0,vs.YU)({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:st}},Te.objectAndLayerIdColor),yt=new en.z(ht,(0,G.Wg)(this._outlineMaterial),{layerUid:Te.layerUid,graphicUid:Te.graphicsUid});(0,Kt.s)(yt.boundingSphere,.5*(Xo[0]+Xo[3]),.5*(Xo[1]+Xo[4]),0,.5*Math.sqrt((Xo[3]-Xo[0])*(Xo[3]-Xo[0])+(Xo[4]-Xo[1])*(Xo[4]-Xo[1]))),Te.outGeometries.push(yt)}}_getOutlineOpacity(){const Te=(0,G.U2)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*((0,G.pC)(Te)?Te.a:0)}_getOutlineColor(){const Te=(0,G.U2)(this.symbolLayer,"outline","color"),Ue=this._getOutlineOpacity();return(0,je.Uu)((0,G.pC)(Te)?Cs.Z.toUnitRGB(Te):null,Ue)}test(){return{...super.test(),createAsOverlay:(Te,Ue)=>this._createAsOverlay(Te,Ue),createAs3DShape:(Te,Ue,$e)=>this._createAs3DShape(Te,Ue,$e)}}}Cm.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const Xo=(0,oe.Ue)();class Yx extends Ye{constructor(Te,Ue,$e,st){super(Te,$e,st),this.color=Ue}}class fv extends Ye{constructor(Te,Ue,$e,st){super(Te,$e,st),this.color=Ue}}var hT=v(9824),ru=v(65542),pT=v(6169);class xu{constructor(Te,Ue,$e){this._renderer=new pT.tV(Te,Ue,$e)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const Te=(0,pT.GZ)(Xx,this._renderer.renderedWidth,this._renderer.renderedHeight),Ue=Te.getContext("2d");return Ue.save(),this._renderer.render(Ue,0,0),Ue.restore(),new Mo.x(Te,{wrap:{s:Ci.e8.CLAMP_TO_EDGE,t:Ci.e8.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Ie.CE.PAD})}}const Xx={canvas:null},mv=[0,0,1];function _T(ft,Te,Ue){ft&&ft.forEach($e=>{const st=Te($e);(0,G.pC)(st)&&Ue(st,$e.graphic)})}const mT={mode:"relative-to-ground",offset:0},Tm={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};var Q0=v(44989);const vp={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},gT=["polyline","polygon","extent"];class cc extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st)}doLoad(){return(0,D.Z)(function*(){})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,gT,this.symbolLayer.type))return null;const $e=this.setGraphicElevationContext(Ue,new Be.o);return this.ensureDrapedStatus("on-the-ground"===$e.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(Ue):this._createAs3DShape(Ue,$e,Ue.uid)}ensureMaterial(){if((0,G.pC)(this._material))return;const Te=new Q0.m,Ue=this.symbolLayer.color;(0,G.pC)(Ue)&&(Te.color=Cs.Z.toUnitRGBA(Ue));const $e=this._getCombinedOpacity(Ue,{hasIntrinsicColor:!0});Te.color=[Te.color[0],Te.color[1],Te.color[2],$e],Te.transparent=$e<1||this.needsDrivenTransparentPass,Te.waveDirection=(0,G.pC)(this.symbolLayer.waveDirection)?cc.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,B.f)(0,0);const ht=vp[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];Te.waveStrength=ht.waveStrength,Te.waveTextureRepeat=ht.textureRepeat,Te.waveVelocity=ht.waveVelocity,Te.flowStrength=ht.perturbationStrength,Te.hasSlicePlane=this._context.slicePlaneEnabled,Te.isDraped=this.draped,this._material=new Q0.H(Te),this._context.stage.add(this._material)}layerOpacityChanged(){if((0,G.Wi)(this._material))return;const Te=this._material.parameters.color,Ue=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[Te[0],Te[1],Te[2],Ue],transparent:Ue<1||this.needsDrivenTransparentPass})}layerElevationInfoChanged(Te,Ue,$e){const st=this._elevationContext.mode,ht=(0,Ce.GC)(cc.elevationModeChangeTypes,$e,st);if(ht!==Ce.lO.UPDATE)return ht;const yt=(0,Ce.Xf)(st);return this.updateGraphics3DGraphicElevationInfo(Te,Ue,()=>yt)}slicePlaneEnabledChanged(){return(0,G.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(Te,Ue,$e){const st=Xe(Te.geometry);if((0,G.Wi)(st))return null;const ht=ot(st,this._context.elevationProvider,this._context.renderCoordsHelper,Ue),yt=ht.position.length/3,Rt=new Float64Array(2*yt),Ut=new yT(ht,Rt);if(this._create3DShapeGeometries(Ut),this._logGeometryCreationWarnings(Ut.renderData,st.rings,"rings","WaterSymbol3DLayer"),0===Ut.outGeometries.length)return null;this._createUVCoordsFromVertices(Ut.uvCoords,Ut.renderData.mapPosition,yt,this._context.elevationProvider.spatialReference);const er=new $t.T({geometries:Ut.outGeometries,materials:Ut.outMaterials,transformations:Ut.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:$e}}),vr=new ue.z(this,er,Ut.outGeometries,null,null,Ir.Wf,Ue);return vr.alignedSampledElevation=Ut.renderData.sampledElevation,vr.needsElevationUpdates=(0,Ce.Xf)(Ue.mode),vr}_createUVCoordsFromVertices(Te,Ue,$e,st){const ht=(0,_e.c9)(st);(0,le.cS)(Du);for(let Ut=0;Ut<$e;Ut++)(0,W.s)(gv,Ue[3*Ut+0],Ue[3*Ut+1]),(0,le.Ho)(Du,gv);(0,Kt.b)(Du,Du,ht);const Rt=Du[1]%cc.unitSizeOfTexture;xo[0]=Du[0]-Du[0]%cc.unitSizeOfTexture,xo[1]=Du[1]-Rt;for(let Ut=0;Ut<$e;Ut++)Te[2*Ut+0]=(Ue[3*Ut+0]*ht-xo[0])/cc.unitSizeOfTexture,Te[2*Ut+1]=(Ue[3*Ut+1]*ht-xo[1])/cc.unitSizeOfTexture}_create3DShapeGeometries(Te){const Ue=Te.renderData.polygons,$e=Te.uvCoords;for(const{count:st,index:ht,position:yt,mapPosition:Rt,holeIndices:Ut}of Ue){if((0,G.pC)(this._context.clippingExtent)&&((0,oe.cS)(Zi),(0,oe.G1)(Zi,Rt),!(0,oe.Zp)(Zi,this._context.clippingExtent)))continue;const er=(0,Ee.e)(Rt,Ut,3);if(0===er.length)continue;const Pr=Ne({indices:er,attributeData:{position:yt,uv0:new Float64Array($e.buffer,2*ht*$e.BYTES_PER_ELEMENT,2*st),mapPosition:Rt}});Te.outGeometries.push(Pr),Te.outMaterials.push((0,G.Wg)(this._material)),Te.outTransforms.push(ye.I)}}_createAsOverlay(Te){const Ue=Xe(Te.geometry);if((0,G.Wi)(Ue))return null;(0,G.Wg)(this._material).renderPriority=this._renderPriority;const $e=ut(Ue,this._context.overlaySR),st=$e.position.length/3,ht=new Float64Array(2*st),yt=new Ep($e,ht,this._context.layer.uid,Te.uid);return yt.outBoundingBox=(0,oe.cS)(),this._createAsOverlayWater(yt),this._logGeometryCreationWarnings(yt.renderData,Ue.rings,"rings","WaterSymbol3DLayer"),0===yt.outGeometries.length?null:(this._createUVCoordsFromVertices(yt.uvCoords,yt.renderData.position,st,this._context.overlaySR),new fs(this,yt.outGeometries,yt.outBoundingBox,this._context.drapeSourceRenderer))}_createAsOverlayWater(Te){const Ue=Te.uvCoords,$e=Te.renderData.polygons;for(const{position:st,holeIndices:ht,index:yt,count:Rt}of $e){if((0,oe.cS)(Zi),(0,oe.G1)(Zi,st),!(0,oe.Zp)(Zi,this._context.clippingExtent))continue;(0,oe.TC)(Te.outBoundingBox,Zi);const Ut=(0,Ee.e)(st,ht,3);if(0===Ut.length)continue;const vr=Ne({indices:Ut,attributeData:{position:st,uv0:new Float64Array(Ue.buffer,2*yt*Ue.BYTES_PER_ELEMENT,2*Rt)}}),Pr=new en.z(vr,(0,G.Wg)(this._material),{layerUid:Te.layerUid,graphicUid:Te.graphicsUid});(0,Kt.s)(Pr.boundingSphere,.5*(Zi[0]+Zi[3]),.5*(Zi[1]+Zi[4]),0,.5*Math.sqrt((Zi[3]-Zi[0])*(Zi[3]-Zi[0])+(Zi[4]-Zi[1])*(Zi[4]-Zi[1]))),Te.outGeometries.push(Pr)}}static headingVectorFromAngle(Te){const Ue=(0,B.a)(),$e=(0,Qy.t)(Te);return Ue[0]=Math.sin($e),Ue[1]=Math.cos($e),Ue}test(){return{...super.test(),create3DShape:Te=>this._createAs3DShape(Te.graphic,Te.elevationContext,Te.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}cc.unitSizeOfTexture=100,cc.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const xo=(0,B.a)(),Du=(0,le.Ue)(),gv=(0,B.a)(),Zi=(0,oe.Ue)();class yT extends Ye{constructor(Te,Ue){super(Te,null,null),this.uvCoords=Ue}}class Ep extends Ye{constructor(Te,Ue,$e,st){super(Te,$e,st),this.uvCoords=Ue}}function bp(ft,Te,Ue,$e){const st=vv[ft.type]&&vv[ft.type][Te.type]||yv[Te.type];return st?new st(ft,Te,Ue,$e):(pe.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${Te.type}`),null)}const yv={icon:Jn,object:class yC extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=$e.physicalBasedRenderingEnabled}getCachedSize(){const[Te,Ue,$e]=(0,G.pC)(this._resources)?this._resources.symbolSize:[1,1,1];return{width:Te,depth:Ue,height:$e}}doLoad(Te){var Ue=this;return(0,D.Z)(function*(){if(!Ue._drivenProperties.size&&(0,je.bh)(Ue.symbolLayer))throw new Error;const $e=Ue.symbolLayer;if(Ue._isPrimitive){const st=$e.resource?$e.resource.primitive:ac.S;Ue._resources=yield Ue._createResourcesForPrimitive(st,Te)}else Ue._resources=yield Ue._createResourcesForUrl($e.resource.href,Te);Ue.layerOpacityChanged(),Ue.slicePlaneEnabledChanged(),Ue.physicalBasedRenderingChanged(),Ue.complexity=Ue.computeComplexity()})()}get extentPadding(){return(0,G.pC)(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return(0,G.U2)(this._resources,"lodRenderer")}_setMaterialTransparencyParams(Te,Ue=(0,G.U2)(this.symbolLayer,"material","color")){const $e=this._getCombinedOpacity(Ue),st=$e<1||this.needsDrivenTransparentPass;return Te.transparent=st,Te.opacity=$e,Te.cullFace=st?Ie.Vr.None:Ie.Vr.Back,Te}_createResourcesForPrimitive(Te,Ue){var $e=this;return(0,D.Z)(function*(){if(!(0,L0.F)(Te))throw new Error(`Unknown object symbol primitive: ${Te}`);const st=$e.symbolLayer,ht=(0,oe.Ue)((0,I0.Uz)(Te)),yt=(0,X.d)((0,oe.dp)(ht)),Rt=(0,X.d)((0,I0.$K)(yt,st)),Ut=(0,H.l)(Rt),Pr={usePBR:$e._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:X.O,diffuse:X.O,hasSlicePlane:$e._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:$e.symbolLayer.castShadows,offsetTransparentBackfaces:!$e.symbolLayer.isPrimitive},Ur=Pr.usePBR;$e._setMaterialTransparencyParams(Pr);const qr=$e.symbol;if("point-3d"===qr.type&&qr.verticalOffset){const{screenLength:Rs,minWorldLength:fi,maxWorldLength:Pi}=qr.verticalOffset;Pr.verticalOffset={screenLength:(0,ct.F2)(Rs),minWorldLength:fi||0,maxWorldLength:(0,G.pC)(Pi)?Pi:1/0},Pr.castShadows=!1}if($e._context.screenSizePerspectiveEnabled&&(Pr.screenSizePerspective=$e._context.sharedResources.screenSizePerspectiveSettings),$e._drivenProperties.color)Pr.externalColor=tr.O;else{const Rs=(0,G.pC)(st.material)&&st.material.color,fi=(0,G.pC)(Rs)?Cs.Z.toUnitRGBA(Rs):tr.O;Pr.externalColor=fi}$e._fastUpdates=Vt($e._context.renderer,$e._fastVisualVariableConvertOptions(ht,Rt,yt,G.YP)),Pr.instanced=["transformation"],$e._fastUpdates.enabled?(Object.assign(Pr,$e._fastUpdates.materialParameters),Pr.instanced.push("featureAttribute"),$e._optionalFields.push("featureAttribute")):$e._hasPerInstanceColor()&&(Pr.instanced.push("color"),$e._optionalFields.push("color")),(0,he.Z)("enable-feature:objectAndLayerId-rendering")&&(Pr.instanced.push("objectAndLayerIdColor"),$e._optionalFields.push("objectAndLayerIdColor"));const Zr=new Wt.Gp(Pr),Es=(0,L0.t)(Te,Zr);if(!Es)throw new Error(`Unknown object symbol primitive: ${Te}`);const si=(0,wc.aH)(Es).map(Rs=>({opacity:1,transparent:Rs.parameters.transparent})),ei=yield $e._createStageResources(Es,Ur);return{lodResources:Es,lodRenderer:yield $e._createLodRenderer(Es,Ue),stageResources:ei,symbolSize:Rt,extentPadding:Ut,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:si,physicalBasedRenderingEnabled:Ur,resourceBoundingBox:ht,resourceSize:yt,pivotOffset:G.YP}})()}_createResourcesForUrl(Te,Ue){var $e=this;return(0,D.Z)(function*(){const st=["transformation"],ht={materialParamsMixin:{instanced:st,hasSlicePlane:$e._context.slicePlaneEnabled,castShadows:$e.symbolLayer.castShadows},streamDataRequester:$e._context.streamDataRequester,cache:$e._context.sharedResources.objectResourceCache};$e._fastUpdates=Vt($e._context.renderer,$e._fastVisualVariableConvertOptions(G.YP,G.YP,G.YP,G.YP)),$e._fastUpdates.enabled?(Object.assign(ht.materialParamsMixin,$e._fastUpdates.materialParameters),st.push("featureAttribute"),$e._optionalFields.push("featureAttribute")):$e._hasPerInstanceColor()&&(st.push("color"),$e._optionalFields.push("color")),(0,he.Z)("enable-feature:objectAndLayerId-rendering")&&(st.push("objectAndLayerIdColor"),$e._optionalFields.push("objectAndLayerIdColor"));const yt=$e.symbol;if("point-3d"===yt.type&&yt.verticalOffset){const{screenLength:Oi,minWorldLength:jn,maxWorldLength:Do}=yt.verticalOffset;ht.materialParamsMixin.verticalOffset={screenLength:(0,ct.F2)(Oi),minWorldLength:jn||0,maxWorldLength:(0,G.pC)(Do)?Do:1/0},ht.materialParamsMixin.castShadows=!1}ht.signal=Ue,ht.usePBR=$e._context.physicalBasedRenderingEnabled,ht.skipHighLods=$e._context.skipHighSymbolLods;const Rt=ht.usePBR,Ut=yield(0,iC.fetch)(Te,ht),er=Ut.isEsriSymbolResource,vr=Ut.isWosr,Pr=function eC(ft){return{levels:ft.map(Te=>function Wy(ft){const Te=[];return ft.stageResources.geometries.forEach((Ue,$e)=>{Te.push({material:ft.stageResources.materials[$e],geometry:Ue,textures:ft.stageResources.textures})}),{components:Te,minScreenSpaceRadius:(0,G.pC)(ft.lodThreshold)?ft.lodThreshold:0,pivotOffset:ft.pivotOffset}}(Te))}}(Ut.lods);(function rC(ft){ft.levels.forEach(Te=>{Te.minScreenSpaceRadius||(Te.minScreenSpaceRadius=function tC(ft,Te=sC){const Ue=(0,wc.HI)(ft);return Math.sqrt(Ue/(Te*Math.PI))}(Te))})})(Pr),Pr.levels.sort((Oi,jn)=>Oi.minScreenSpaceRadius-jn.minScreenSpaceRadius),Pr.levels[0].minScreenSpaceRadius=Math.min(2,Pr.levels[0].minScreenSpaceRadius);const Ur=$e._context,Zr=$e._getExternalColorParameters($e.symbolLayer.material),Es=(0,G.U2)($e.symbolLayer,"material","color"),si=$e._getCombinedOpacity(Es,{hasIntrinsicColor:!0}),ei=$e.needsDrivenTransparentPass,Rs=(0,wc.aH)(Pr),fi=(0,wc.aH)(Pr).map(Oi=>({opacity:Oi.parameters.opacity||1,transparent:Oi.parameters.transparent}));Rs.forEach(Oi=>{const jn=Oi.parameters;Oi.setParameters(Zr);const Do=jn.opacity*si;Oi.setParameters({opacity:Do,transparent:Do<1||ei||jn.transparent}),Ur.screenSizePerspectiveEnabled&&Oi.setParameters({screenSizePerspective:Ur.sharedResources.screenSizePerspectiveSettings})});const Pi=Ut.referenceBoundingBox,mn=(0,X.d)((0,oe.dp)(Pi)),Di=(0,X.d)(Pr.levels[0].pivotOffset),qn=(0,X.d)((0,I0.$K)(mn,$e.symbolLayer)),xa=(0,H.l)(qn);yr($e._fastUpdates,$e._context.renderer,$e._fastVisualVariableConvertOptions(Pi,qn,mn,Di))&&Rs.forEach(Oi=>Oi.setParameters($e._fastUpdates.materialParameters));const Li=yield $e._createStageResources(Pr,Rt);return{lodResources:Pr,lodRenderer:yield $e._createLodRenderer(Pr,Ue),stageResources:Li,symbolSize:qn,extentPadding:xa,isEsriSymbolResource:er,isWosr:vr,originalMaterialParameters:fi,physicalBasedRenderingEnabled:Rt,resourceBoundingBox:Pi,resourceSize:mn,pivotOffset:Di}})()}_addDisposeResource(Te){this._disposeResourceHandles.push(Te)}_createStageResources(Te,Ue){var $e=this;return(0,D.Z)(function*(){const st=$e._context.stage,ht=(0,wc.aH)(Te);Ue!==$e._context.physicalBasedRenderingEnabled&&$e.physicalBasedRenderingChanged(),st.addMany(ht),$e._addDisposeResource(()=>st.removeMany(ht));const yt=(0,wc.VQ)(Te);st.addMany(yt),$e._addDisposeResource(()=>st.removeMany(yt)),yield st.load(yt);const Rt=(0,wc.ci)(Te);return st.addMany(Rt),$e._addDisposeResource(()=>st.removeMany(Rt)),{materials:ht,textures:yt,geometries:Rt}})()}_createLodRenderer(Te,Ue){var $e=this;return(0,D.Z)(function*(){const st=$e._context.stage,ht={layerUid:$e._context.layer.uid,graphicUid:Ut=>$e._instanceIndexToGraphicUid.get(Ut),notifyGraphicGeometryChanged:Ut=>$e._context.notifyGraphicGeometryChanged($e._instanceIndexToGraphicUid.get(Ut)),notifyGraphicVisibilityChanged:Ut=>$e._context.notifyGraphicVisibilityChanged($e._instanceIndexToGraphicUid.get(Ut))},Rt=new pC(Te,$e._optionalFields,ht,$e._fastUpdates.enabled?{applyTransform:(Ut,er,vr)=>{Ut.getFeatureAttribute(er,V0),(0,Se.c)(vr,Os($e._fastUpdates.materialParameters,V0,vr))},scaleFactor:(Ut,er,vr)=>(er.getFeatureAttribute(vr,V0),$s(Ut,$e._fastUpdates.materialParameters,V0))}:null);return Rt.slicePlaneEnabled=$e._context.slicePlaneEnabled,$e._addDisposeResource(()=>{st.removeRenderPlugin(Rt)}),yield st.addRenderPlugin(Rt.slots,Rt,Ue),Rt})()}_getExternalColorParameters(Te){const Ue={};return this._drivenProperties.color?Ue.externalColor=tr.O:(0,G.pC)(Te)&&(0,G.pC)(Te.color)?Ue.externalColor=Cs.Z.toUnitRGBA(Te.color):(Ue.externalColor=tr.O,Ue.colorMixMode="ignore"),Ue}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(Te=>Te()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry))return null;const $e=(0,fr.S_)(Ue.geometry);if((0,G.Wi)($e))return this.logger.warn(`unsupported geometry type for icon symbol: ${Ue.geometry.type}`),null;const st=this.setGraphicElevationContext(Ue,new Be.o);return this._createAs3DShape(Ue,$e,Te.renderingInfo,st,Ue.uid,Te.layer.uid)}notifyDestroyGraphicLayer(Te){this._instanceIndexToGraphicUid.delete(Te.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if((0,G.Wi)(this._resources))return;const Te=this._drivenProperties.opacity,Ue=!this._isPrimitive,$e=this._resources.stageResources.materials,st=this._resources.originalMaterialParameters;for(let ht=0;ht<$e.length;ht++){const yt=$e[ht],Rt=(0,G.U2)(this.symbolLayer,"material","color"),Ut=st[ht],er=this._getCombinedOpacity(Rt,{hasIntrinsicColor:Ue})*Ut.opacity,vr=er<1||Te||Ut.transparent;yt.setParameters({opacity:er,transparent:vr}),this._isPrimitive&&yt.setParameters({cullFace:vr?Ie.Vr.None:Ie.Vr.Back})}}layerElevationInfoChanged(Te,Ue){return this.updateGraphics3DGraphicElevationInfo(Te,Ue,Ce.B5)}slicePlaneEnabledChanged(){if((0,G.Wi)(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Te of this._resources.stageResources.materials)Te.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if((0,G.Wi)(this._resources))return!0;const{stageResources:Te,isWosr:Ue}=this._resources;for(const $e of Te.materials)this._isPrimitive?$e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):Ue||$e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(Te,Ue){if((0,G.Wi)(this._resources))return Re.W.Recreate_Symbol;const{stageResources:{materials:$e},lodRenderer:st,resourceBoundingBox:ht,symbolSize:yt,resourceSize:Rt,pivotOffset:Ut}=this._resources;for(const er in Te.diff){if("visualVariables"!==er||!yr(this._fastUpdates,Ue,this._fastVisualVariableConvertOptions(ht,yt,Rt,Ut)))return Re.W.Recreate_Symbol;for(const vr of $e)vr.setParameters(this._fastUpdates.materialParameters);st.notifyShaderTransformationChanged()}return Re.W.Fast_Update}computeComplexity(){if((0,G.Wi)(this._resources))return super.computeComplexity();const Te=this._resources.lodResources,Ue=(0,wc.VV)(Te.levels[0]).reduce((ht,yt)=>ht+yt.indices.get(Pe.T.POSITION).length,0)/3,st=(0,wc.VQ)(Te).reduce((ht,yt)=>ht+yt.estimatedTexMemRequired,0)/4+(0,wc.ci)(Te).reduce((ht,yt)=>ht+(ht=>Array.from(ht.vertexAttributes.values()).reduce((yt,Rt)=>yt+(Rt.data.buffer?.byteLength??0),0)+Array.from(ht.indices.values()).reduce((yt,Rt)=>yt+(Array.isArray(Rt)?12*Rt.length:Rt.buffer.byteLength),0))(yt),0);return{primitivesPerFeature:Ue,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...(0,U0.BN)(this.symbol,this.symbolLayer),resourceBytes:st}}}_hasLodRenderer(){return(0,G.pC)(this._resources)}_createAs3DShape(Te,Ue,$e,st,ht,yt){if(!this._hasLodRenderer()||(0,G.Wi)(this._resources))return null;const Rt=this.getFastUpdateAttrValues(Te),Ut=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?(0,je.Uu)($e.color,$e.opacity):null,er=this._context.clippingExtent;if((0,ae.KC)(Ue,ih,this._context.elevationProvider.spatialReference),(0,G.pC)(er)&&!(0,oe.BD)(er,ih))return null;const vr=this._requiresTerrainElevation(st),Pr=this._computeGlobalTransform(Ue,st,W0,z0),Ur=this._computeLocalTransform(this._resources,this.symbolLayer,$e,nm),qr=this._resources.lodRenderer.instanceData,Zr=qr.addInstance();this._instanceIndexToGraphicUid.set(Zr,ht),qr.setLocalTransform(Zr,Ur,!1),qr.setGlobalTransform(Zr,Pr),Rt&&qr.setFeatureAttribute(Zr,Rt),Ut&&qr.setColor(Zr,Ut),(0,he.Z)("enable-feature:objectAndLayerId-rendering")&&qr.setObjectAndLayerIdColor(Zr,this._context.stage.renderView._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ht,layerUid:yt}));const Es=new qb(this,Zr,Ir.RX,st);return vr&&(Es.alignedSampledElevation=z0.sampledElevation),Es.needsElevationUpdates=(0,Ce.B5)(st.mode),(0,fr.dO)(Es,Ue,this._context.elevationProvider),Es}_computeGlobalTransform(Te,Ue,$e,st){return(0,Ce.qZ)(Te,this._context.elevationProvider,Ue,this._context.renderCoordsHelper,st),ih[0]=Te.x,ih[1]=Te.y,ih[2]=st.z,(0,ae.Bm)(Te.spatialReference,ih,$e,this._context.renderCoordsHelper.spatialReference),$e}_computeLocalTransform(Te,Ue,$e,st){return(0,Se.i)(st),this._applyObjectRotation($e,!1,st),this._applyObjectRotation(Ue,!0,st),this._applyObjectScale(Te,$e,st),this._applyAnchor(Te,Ue,st),st}_applyObjectScale(Te,Ue,$e){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const ht=(0,je.bD)(this._drivenProperties.size&&Ue.size?Ue.size:Te.symbolSize,Te.symbolSize,Te.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===ht[0]&&1===ht[1]&&1===ht[2]||(0,Se.k)($e,$e,ht)}prepareSymbolLayerPatch(Te){if("partial"!==Te.diff.type)return;const Ue=Te.diff.diff;this._preparePatchTransform(Te,Ue),this._preparePatchColor(Te,Ue)}updateGeometry(Te,Ue){if((0,G.Wi)(this._resources))return!0;const $e=Ue&&(0,fr.S_)(Ue);if((0,G.Wi)($e))return!1;const st=this.getGeometryElevationMode(Ue);return Te.elevationContext.mode===st&&(this._computeGlobalTransform($e,Te.elevationContext,W0,z0),this._requiresTerrainElevation(Te.elevationContext)&&(Te.alignedSampledElevation=z0.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(Te.instanceIndex,W0,!0),(0,fr.dO)(Te,$e,this._context.elevationProvider),!0)}_preparePatchTransform(Te,Ue){if(!(Ue.heading||Ue.tilt||Ue.roll||Ue.width||Ue.height||Ue.depth||Ue.anchor||Ue.anchorPosition)||(0,G.Wi)(this._resources))return;const $e=(Zr,Es,si)=>(0,G.Pt)(null!=Zr&&"complete"===Zr.type?Zr.newValue:Es,si),st=$e(Ue.heading,this.symbolLayer.heading,0),ht=$e(Ue.tilt,this.symbolLayer.tilt,0),yt=$e(Ue.roll,this.symbolLayer.roll,0),Rt=$e(Ue.width,this.symbolLayer.width,void 0),Ut=$e(Ue.height,this.symbolLayer.height,void 0),er=$e(Ue.depth,this.symbolLayer.depth,void 0),vr=$e(Ue.anchor,this.symbolLayer.anchor,void 0),Pr=$e(Ue.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete Ue.heading,delete Ue.tilt,delete Ue.roll,delete Ue.width,delete Ue.height,delete Ue.depth,delete Ue.anchor,delete Ue.anchorPosition;const Ur={heading:st,tilt:ht,roll:yt,anchor:vr,anchorPosition:Pr},qr=this._resources;this.loadStatus===dp.P.LOADED&&Te.symbolLayerStatePatches.push(()=>{qr.symbolSize=(0,X.d)((0,I0.$K)(qr.resourceSize,{width:Rt,height:Ut,depth:er,isPrimitive:this.symbolLayer.isPrimitive}))}),Te.graphics3DGraphicPatches.push((Zr,Es)=>{const si=this._computeLocalTransform(qr,Ur,Es,nm);qr.lodRenderer.instanceData.setLocalTransform(Zr.instanceIndex,si,!0)})}_preparePatchColor(Te,Ue){if(!Ue.material||"partial"!==Ue.material.type)return;const $e=Ue.material.diff;if(!$e.color||"complete"!==$e.color.type||null==$e.color.newValue||null==$e.color.oldValue)return;const st=$e.color.newValue,ht=(0,G.pC)(st)?Cs.Z.toUnitRGBA(st):tr.O;delete $e.color;const yt=this._resources;(0,G.Wi)(yt)||Te.graphics3DGraphicPatches.push(Rt=>{let Ut;this._hasPerInstanceColor()?(yt.lodRenderer.instanceData.setColor(Rt.instanceIndex,ht),Ut=this._setMaterialTransparencyParams({},st)):Ut=this._setMaterialTransparencyParams({externalColor:ht},st);for(const er of yt.stageResources.materials)er.setParameters(Ut)})}_requiresTerrainElevation(Te){return"absolute-height"!==Te.mode}_applyObjectRotation(Te,Ue,$e){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&Ue))return(0,je._Z)(Te.heading,Te.tilt,Te.roll,$e)}_computeAnchor(Te,Ue,$e){const st=(0,X.c)();switch($e.anchor){case"center":(0,H.c)(st,(0,oe.be)(Te)),(0,H.o)(st,st);break;case"top":{const ht=(0,oe.be)(Te);(0,H.s)(st,-ht[0],-ht[1],-Te[5]);break}case"bottom":{const ht=(0,oe.be)(Te);(0,H.s)(st,-ht[0],-ht[1],-Te[2]);break}case"relative":{const ht=(0,oe.be)(Te),yt=(0,oe.dp)(Te),Rt=$e.anchorPosition,Ut=Rt?(0,X.f)(Rt.x,Rt.y,Rt.z):X.Z;(0,H.B)(st,yt,Ut),(0,H.a)(st,st,ht),(0,H.o)(st,st);break}default:(0,G.pC)(Ue)?(0,H.o)(st,Ue):(0,H.c)(st,X.Z)}return st}_applyAnchor(Te,Ue,$e){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const st=this._computeAnchor(Te.resourceBoundingBox,Te.pivotOffset,Ue);st&&(0,Se.v)($e,$e,st)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(Te,Ue,$e,st){const ht=(0,G.pC)(Te)?(0,X.d)((0,oe.dp)(Te)):X.O,yt=(0,G.pC)(Te)?this._computeAnchor(Te,st,this.symbolLayer):X.Z,Rt=this._context.renderCoordsHelper.unitInMeters,Ut=(0,je.bD)((0,G.pC)(Ue)?Ue:void 0,Ue,$e,Rt),er=(0,X.f)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:ht,symbolSize:(0,G.pC)(Ue)?Ue:X.O,unitInMeters:Rt,transformation:{anchor:yt,scale:Ut,rotation:er}}}},line:ur,path:class pv extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._intrinsicSize=(0,B.f)(1,1),this._upVectorAlignment="path",this._stencilWidth=.1,this.ensureDrapedStatus(!1)}doLoad(){var Te=this;return(0,D.Z)(function*(){const Ue=(0,G.pC)(Te.symbolLayer.width)?Te.symbolLayer.width:Te.symbolLayer.height,$e=(0,G.pC)(Te.symbolLayer.height)?Te.symbolLayer.height:Ue;Te._vvConvertOptions={modelSize:[1,1,1],symbolSize:[Ue,1,$e],unitInMeters:Te._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},Te._fastUpdates=Te._context.renderer&&Te._context.renderer.visualVariables&&Te._context.renderer.visualVariables.length>0?Vt(Te._context.renderer,Te._vvConvertOptions):{enabled:!1};const st=Te.symbolLayer.anchor||"center";Te._upVectorAlignment="path","heading"===Te.symbolLayer.profileRotation&&(Te._upVectorAlignment="world");const ht=Te.symbolLayer.profile||"circle";switch(ht){case"circle":default:Te._profile=_p.circle(10);break;case"quad":Te._profile=_p.rect()}let yt=[0,0];switch("center"!==st&&(yt={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[st],Te._profile.translate(yt[0],yt[1])),Te.symbolLayer.join||"simple"){case"round":Te._extruder=new lm(0,3);break;case"bevel":Te._extruder=new lm(0,1);break;case"miter":Te._extruder=new lm(.8*Math.PI,1);break;default:Te._extruder=new kC}const Rt=Te.symbolLayer.cap||"butt";switch(Rt){case"none":Te._startCap=new iv,Te._endCap=new iv;break;case"butt":default:Te._startCap=new Nl(Te._profile,0),Te._endCap=new Nl(Te._profile,0,!0);break;case"square":Te._startCap=new Nl(Te._profile,-.5),Te._endCap=new Nl(Te._profile,.5,!0);break;case"round":{const Zr="quad"===ht;Te._startCap=new nv({profile:Te._profile,flip:!1,breakNormals:Zr,subdivisions:3}),Te._endCap=new nv({profile:Te._profile,flip:!0,breakNormals:Zr,subdivisions:3});break}}const Ut=(0,G.U2)(Te.symbolLayer,"material","color"),er=Te._getCombinedOpacityAndColor(Ut),vr=(0,X.d)(er),Pr=er[3],Ur=Pr<1||Te.needsDrivenTransparentPass,qr={diffuse:vr,ambient:vr,opacity:Pr,transparent:Ur,hasVertexColors:!1,hasSlicePlane:Te._context.slicePlaneEnabled,castShadows:Te.symbolLayer.castShadows,cullFace:Ur||"none"===Rt?Ie.Vr.None:Ie.Vr.Back,offsetTransparentBackfaces:!0};if(!Te._drivenProperties.size&&((0,W.s)(Te._intrinsicSize,Ue,$e),!(0,je.ZL)(Te._intrinsicSize[0])||!(0,je.ZL)(Te._intrinsicSize[1])))throw new me.Z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(Te._fastUpdates.enabled&&Te._fastUpdates.visualVariables.size||(0,W.b)(Te._intrinsicSize,Te._intrinsicSize,1/Te._context.renderCoordsHelper.unitInMeters),Te._fastUpdates.enabled){const Zr={...qr,...Te._fastUpdates.materialParameters,size:(0,B.b)(Te._intrinsicSize)};Te._material=new pm(Zr)}else qr.hasVertexColors=Te._drivenProperties.color||Te._drivenProperties.opacity,Te._material=new Wt.Gp(qr);Te._material.setParameters({usePBR:Te._context.physicalBasedRenderingEnabled,isSchematic:!0}),Te._context.stage.add(Te._material)})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,sT,this.symbolLayer.type))return null;const $e=this.setGraphicElevationContext(Ue,new Be.o);return this._createAs3DShape(Ue,Te.renderingInfo,$e,Ue.uid)}layerOpacityChanged(){const Te=(0,G.U2)(this.symbolLayer,"material","color"),Ue=this._getCombinedOpacity(Te);this._material.setParameters({opacity:Ue,transparent:Ue<1||this.needsDrivenTransparentPass})}layerElevationInfoChanged(Te,Ue){return this.updateGraphics3DGraphicElevationInfo(Te,Ue,Ce.B5)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(Te,Ue){for(const $e in Te.diff){if("visualVariables"!==$e||!yr(this._fastUpdates,Ue,this._vvConvertOptions))return Re.W.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Re.W.Fast_Update}getVertexData(Te){let Ue=0;const $e=Te.paths,st=[],ht=Te.spatialReference,yt=this._context.elevationProvider.spatialReference,Rt=this._context.renderCoordsHelper.spatialReference;for(const qr of $e)Ue+=qr.length;const Ut=new Float64Array(3*Ue),er=new Float64Array(3*Ue),vr=new Float64Array(3*Ue);let Pr=0;for(const qr of $e){st.push({index:Pr,numVertices:qr.length});for(const Zr of qr)Ut[Pr++]=Zr[0],Ut[Pr++]=Zr[1],Ut[Pr++]=Te.hasZ?Zr[2]:0}let Ur=!0;return(0,G.pC)(yt)&&!ht.equals(yt)?Ur=(0,ae.CM)(Ut,ht,0,er,yt,0,Ue):this._copyVertices(Ut,0,er,0,Ue),(0,G.pC)(yt)&&!yt.equals(Rt)?(0,ae.CM)(er,yt,0,vr,Rt,0,Ue):this._copyVertices(er,0,vr,0,Ue),{pathVertexDataInfos:st,vertexDataGS:Ut,vertexDataES:er,vertexDataRS:vr,projectionSuccess:Ur,terrainElevation:0}}_copyVertices(Te,Ue,$e,st,ht){Ue*=3,st*=3;for(let yt=0;yt<ht;++yt)$e[st++]=Te[Ue++],$e[st++]=Te[Ue++],$e[st++]=Te[Ue++]}_createAs3DShape(Te,Ue,$e,st){const ht=Te.geometry,yt=new Array,Rt=new Array,Ut=new Array,er=ht.spatialReference,vr=(0,oe.Ue)(),Pr=this._context.renderCoordsHelper;vm.spatialReference=er;const Ur=this.getVertexData(ht);if(!Ur.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(Ur.pathVertexDataInfos.length>0){for(let qr=0;qr<Ur.pathVertexDataInfos.length;++qr){const Zr=Ur.pathVertexDataInfos[qr],Es=Zr.index,si=Zr.numVertices;if(si<2||(0,G.pC)(this._context.clippingExtent)&&((0,oe.cS)(vr),(0,oe.G1)(vr,Ur.vertexDataES,3*Es,si),!(0,oe.Zp)(vr,this._context.clippingExtent)))continue;const ei=[];for(let Li=Es;Li<Es+3*si;){const Oi=Li++,jn=Li++,Do=Li++,su=new $C;(0,H.s)(su.posGS,Ur.vertexDataGS[Oi],Ur.vertexDataGS[jn],Ur.vertexDataGS[Do]),(0,H.s)(su.posES,Ur.vertexDataES[Oi],Ur.vertexDataES[jn],Ur.vertexDataES[Do]);const Cp=(0,Ce.w7)(su.posES,this._context.elevationProvider,$e,Pr);(0,H.s)(el,Ur.vertexDataRS[Oi],Ur.vertexDataRS[jn],Ur.vertexDataRS[Do]),Pr.setAltitude(el,Cp),(0,H.s)(su.pos,el[0],el[1],el[2]),ei.push(su)}const Rs=new YC(ei);Bc(Rs,this._upVectorAlignment,this._context.renderCoordsHelper);const fi=new ov(Rs,this._profile,this._extruder,this._startCap,this._endCap);let Pi=null;if(this._fastUpdates.enabled){const Li=this._fastUpdates.visualVariables,Oi=Li.size?(0,Fe.d)(Li.size.field,Te):0,jn=Li.color?(0,Fe.d)(Li.color.field,Te):0,Do=Li.opacity?(0,Fe.d)(Li.opacity.field,Te):0;Pi=new Bx(fi,Oi,jn,Do)}else{const Li=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(Li[0]*=gl(Ue.size[0],"symbol-value"===Ue.size[2]?this.symbolLayer.height||0:Ue.size[2],this.symbolLayer.width||0),Li[1]*=gl(Ue.size[2],"symbol-value"===Ue.size[0]?this.symbolLayer.width||0:Ue.size[0],this.symbolLayer.height||0));let Oi=null;this._drivenProperties.color&&(Oi=Ue.color),this._drivenProperties.opacity&&null!=Ue.opacity&&(Oi=Oi?[Oi[0],Oi[1],Oi[2],Ue.opacity]:[1,1,1,Ue.opacity]);const jn=new QC(fi);jn.bake(Li),Oi&&jn.bakeVertexColors(Oi),Pi=jn}const{vertexAttributes:mn,indices:Di}=Pi.createGeometryData(),qn=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:st,layerUid:this._context.layer.uid}),xa=new NC(mn,Di,Pi,er,this._upVectorAlignment,this._stencilWidth,qn);yt.push(xa),Rt.push(this._material),Ut.push(Pi.xform)}if(yt.length>0){const Zr=new $t.T({geometries:yt,materials:Rt,transformations:Ut,metadata:{layerUid:this._context.layer.uid,graphicUid:st}}),Es=new ue.z(this,Zr,yt,null,null,tu,$e);return Es.alignedSampledElevation=Ur.terrainElevation,Es.needsElevationUpdates=(0,Ce.B5)($e.mode),Es}}else 0!==ht.paths.length&&ht.paths.some(qr=>qr.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}},fill:Cm,extrude:class gr extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this.ensureDrapedStatus(!1)}doLoad(){var Te=this;return(0,D.Z)(function*(){if(!Te._drivenProperties.size){const Ut=(0,je.bh)(Te._getSymbolSize());if(Ut)throw new me.Z("graphics3dextrudesymbollayer:invalid-size",Ut)}const Ue=(0,G.U2)(Te.symbolLayer,"material","color"),$e=Te._getCombinedOpacityAndColor(Ue),st=(0,X.d)($e),ht=$e[3],yt=ht<1||Te.needsDrivenTransparentPass,Rt={usePBR:Te._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:st,ambient:st,opacity:ht,transparent:yt,cullFace:yt?Ie.Vr.None:Ie.Vr.Back,hasVertexColors:!0,hasSlicePlane:Te._context.slicePlaneEnabled,castShadows:Te.symbolLayer.castShadows,offsetTransparentBackfaces:!0};Te._material=new Wt.Gp(Rt),Te._bottomMaterial=new Wt.Gp({...Rt,cullFace:Ie.Vr.Back}),Te._context.stage.add(Te._material),Te._context.stage.add(Te._bottomMaterial)})()}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,pr,this.symbolLayer.type))return null;const $e=this._getVertexOpacityAndColor(Te.renderingInfo,255),st=this.setGraphicElevationContext(Ue,new Be.o);return this._createAs3DShape(Ue,Te.renderingInfo,$e,st,Ue.uid)}layerOpacityChanged(Te,Ue){const $e=(0,G.U2)(this.symbolLayer,"material","color"),st=this._getCombinedOpacity($e),ht=st<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:st,transparent:ht}),this._bottomMaterial.setParameters({opacity:st,transparent:ht});const yt=this._getLayerOpacity();Te.forEach(Rt=>{const Ut=Ue(Rt);(0,G.pC)(Ut)&&Ut.layerOpacityChanged(yt,this._context.isAsync)})}layerElevationInfoChanged(Te,Ue){return this.updateGraphics3DGraphicElevationInfo(Te,Ue,Ce.B5)}slicePlaneEnabledChanged(Te,Ue){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),Te.forEach($e=>{const st=Ue($e);(0,G.pC)(st)&&st.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(Te){let Ue;return Ue=Te.size&&this._drivenProperties.size?(0,Ke.sV)(Te.size,2)??0:this._getSymbolSize(),Ue/=this._context.renderCoordsHelper.unitInMeters,Ue}applyRendererDiff(Te,Ue){return this._drivenPropertiesChanged(Ue)?Re.W.Recreate_Symbol:Re.W.Recreate_Graphics}queryForSnapping(Te,Ue,$e,st){var ht=this;return(0,D.Z)(function*(){const yt=ht._getExtrusionSize($e)*ht._context.renderCoordsHelper.unitInMeters/(0,_e._R)(Ue),{objectId:Rt,target:Ut}=Te,er=(0,ge.d9)(Ut);switch(er.z=(er.z??0)+yt,Te.type){case"edge":{const{start:vr,end:Pr}=Te,Ur=(0,ge.d9)(vr),qr=(0,ge.d9)(Pr);return Ur.z=(Ur.z??0)+yt,qr.z=(qr.z??0)+yt,[(0,ze.p)(Rt,er,1/0,Ur,qr)]}case"vertex":return[(0,ze.u)(Rt,er,1/0),(0,ze.p)(Rt,Ut,1/0,Ut,er)];default:return[]}})()}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(Te,Ue,$e,st,ht){const yt=Xe(Te.geometry);if((0,G.Wi)(yt))return null;if(0===yt.rings.length||!yt.rings.some(Tp=>Tp.length>0))return this._logGeometryValidationWarnings(yt.rings,"rings","ExtrudeSymbol3DLayer"),null;const Rt=ot(yt,this._context.elevationProvider,this._context.renderCoordsHelper,st);this._logGeometryCreationWarnings(Rt,yt.rings,"rings","ExtrudeSymbol3DLayer");const Ut=(0,je.zE)(yt);if((0,G.Wi)(Ut))return null;const er=new Array,vr=new Array,Pr=new Array,Ur=(0,oe.Ue)(),qr=(0,ye.c)(),Zr=(0,X.c)(),Es=this._context.renderCoordsHelper.viewingMode===We.JY.Global;Es||this._context.renderCoordsHelper.worldUpAtPosition(null,Zr),(0,ae.Bm)(yt.spatialReference,[Ut.x,Ut.y,0],qr,this._context.renderCoordsHelper.spatialReference);const si=(0,ye.c)();(0,Se.a)(si,qr);const ei=(0,be.c)();(0,De.b)(ei,si);const{polygons:Rs,mapPosition:fi,position:Pi}=Rt,mn=Pi.length/3,Di=new Float64Array(3*mn*6),qn=new Float64Array(3*mn*6),xa=new Float64Array(3*mn*6),Li=new Float64Array(1*mn*6);let Oi=0;for(let Tp=0;Tp<Rs.length;++Tp){const Mp=Rs[Tp],Mm=Mp.count;if(this._context.clippingExtent&&((0,oe.cS)(Ur),(0,oe.G1)(Ur,Mp.mapPosition),!(0,oe.Zp)(Ur,this._context.clippingExtent)))continue;const e_=(0,Ee.e)(Mp.mapPosition,Mp.holeIndices,3);if(0===e_.length)continue;const Pm=new Array(3*Mm*2+e_.length),Om=new Array(e_.length),t_=6*Mm,r_=3*Di.BYTES_PER_ELEMENT,Pp=new ve.fP(Di.buffer,Oi*r_,r_,(Oi+t_)*r_),xm=3*qn.BYTES_PER_ELEMENT,Op=new ve.fP(qn.buffer,Oi*xm,xm,(Oi+t_)*xm),Dm=new Float64Array(xa.buffer,3*Oi*xa.BYTES_PER_ELEMENT,3*t_),Sm=new Float64Array(Li.buffer,1*Oi*Li.BYTES_PER_ELEMENT,1*t_),ET=this._getExtrusionSize(Ue);Fr(Pi,fi,e_,Mp,Pp.typedBuffer,Dm,Op.typedBuffer,Sm,Pm,Om,ET,Zr,Es),(0,xe.t)(Pp,Pp,si),(0,xe.a)(Op,Op,ei),Oi+=6*Mm;const Am=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:ht,layerUid:this._context.layer.uid}),bT=ar(Pm,Pm.length-Om.length,{positions:Pp.typedBuffer,elevation:Dm,normals:Op.typedBuffer,heights:Sm},$e,Am);er.push(bT),vr.push(this._material),Pr.push(ye.I);const CT=ar(Om,0,{positions:Pp.typedBuffer,elevation:Dm,normals:Op.typedBuffer,heights:Sm},$e,Am);er.push(CT),vr.push(this._bottomMaterial),Pr.push(ye.I)}if(0===er.length)return null;const jn=new $t.T({geometries:er,materials:vr,transformations:Pr,metadata:{layerUid:this._context.layer.uid,graphicUid:ht,isElevationSource:!0}});jn.transformation=qr;const Do=(0,Je.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),su=(0,G.pC)(Do)?{baseMaterial:this._material,edgeMaterials:[Do],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Cp=new ue.z(this,jn,er,null,null,Tr,st,su);return Cp.alignedSampledElevation=Rt.sampledElevation,Cp.needsElevationUpdates=(0,Ce.B5)(st.mode),Cp}},text:class kx extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){var Te=this;return(0,D.Z)(function*(){if(!Te._drivenProperties.size){const Ue=(0,je.bh)(Te.symbolLayer.size);if(Ue)throw new me.Z("graphics3dtextsymbollayer:invalid-size",Ue)}yield Te._createTextRenderParameters()})()}_createTextRenderParameters(){var Te=this;return(0,D.Z)(function*(){const Ue=Te._context.graphicsCoreOwner.view.state.pixelRatio;Te._textRenderParameters=yield ru.V.fromSymbol(Te.symbolLayer,Ue)})()}destroy(){super.destroy()}createGraphics3DGraphic(Te){const Ue=Te.graphic,$e=(0,fr.S_)(Ue.geometry);if((0,G.Wi)($e))return this.logger.warn(`unsupported geometry type for text symbol: ${Ue.geometry.type}`),null;const st=this.symbolLayer.text;if((0,G.Wi)(st)||""===st)return null;const ht=(0,hT.Pd)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if((0,G.pC)(ht)&&!(0,hT.as)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const yt={...Tm,verticalOffset:ht,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:(0,Gt.j1)(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(Ue,$e,st,yt)}createLabel(Te,Ue,$e,st){const ht=Te.graphic,yt=(0,fr.S_)(ht.geometry);if((0,G.Wi)(yt))return this.logger.warn(`unsupported geometry type for label: ${ht.geometry.type}`),null;const Rt=Ue.text;return!Rt||/^\s+$/.test(Rt)?null:this._createAs3DShape(ht,yt,Rt,Ue,$e,st)}setGraphicElevationContext(Te,Ue,$e=0){const st=super.setGraphicElevationContext(Te,Ue);return st.addOffsetRenderUnits($e),st}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(Te,Ue){return _T(Te,Ue,($e,st)=>{this.updateGraphicElevationContext(st,$e)}),Ce.lO.UPDATE}slicePlaneEnabledChanged(Te,Ue){return _T(Te,Ue,$e=>{for(const st of $e.stageObject.geometryRecords)st.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(Te,Ue){this.setGraphicElevationContext(Te,Ue.elevationContext,Ue.metadata.elevationOffset),Ue.needsElevationUpdates=(0,Ce.Xf)(Ue.elevationContext.mode)||"absolute-height"===Ue.elevationContext.mode}_defaultElevationInfoNoZ(){return mT}_createAs3DShape(Te,Ue,$e,st,ht,yt){const Rt=this.setGraphicElevationContext(Te,new Be.o,st.elevationOffset),Ut="polyline"===(0,G.U2)(Te.geometry,"type"),er=Te.uid;let vr=null,Pr=null;if((0,G.Wi)(yt)){const Oi=(0,Gt.mq)(st.horizontalPlacement);vr=new xu($e,Oi,this._textRenderParameters);let jn=null;if((0,G.pC)(this._context.sharedResources.textures)){Pr=this._context.sharedResources.textures.fromData(vr.key,()=>(0,G.Wg)(vr).create(),()=>{(0,G.pC)(jn)&&jn.release()});const Do=this._context.stage.renderView.textureRepository.acquire(Pr.texture.id);if((0,G.Wi)(Do)||(0,Z.y8)(Do))return Pr.release(),null;jn=Do}}const Ur=function fT(ft,Te){if("baseline"===Te.verticalPlacement){const $e=Gt.$A[Te.horizontalPlacement],st=(0,G.pC)(ft)?ft.baselineAnchorY:0;return(0,B.f)($e,st)}const Ue=(0,Gt.QW)(Te.horizontalPlacement,Te.verticalPlacement);return Gt.yY[Ue]}(vr,st),qr={occlusionTest:!0,screenOffset:st.screenOffset,anchorPosition:Ur,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:st.centerOffsetUnits,debugDrawLabelBorder:st.debugDrawLabelBorder,drawInSecondSlot:!0};if((0,G.pC)(Pr)&&(qr.textureId=Pr.texture.id),(0,G.pC)(yt)&&(qr.textureId=yt.id),(0,G.pC)(st.verticalOffset)){const{screenLength:Oi,minWorldLength:jn,maxWorldLength:Do}=st.verticalOffset;qr.verticalOffset={screenLength:(0,ct.F2)(Oi),minWorldLength:jn||0,maxWorldLength:(0,G.pC)(Do)?Do:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:Oi,screenSizePerspectiveSettingsLabels:jn}=this._context.sharedResources;qr.screenSizePerspective=jn.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),qr.screenSizePerspectiveAlignment=Oi}let Zr;if(Ut&&(qr.shaderPolygonOffset=1e-4),qr.hasSlicePlane=this._context.slicePlaneEnabled,(0,G.pC)(ht)){const Oi=JSON.stringify(qr);Zr=ht.get(Oi),(0,G.Wi)(Zr)&&(Zr=new na.A(qr),ht.add(Oi,Zr))}else Zr=new na.A(qr);const Es=[Zr],si=st.translation,ei=(0,G.pC)(vr)?[vr.displayWidth,vr.displayHeight]:[0,0],fi=[(0,xi.dV)(mv,si,null,ei,st.centerOffset,[0,0],null)],mn=(0,fr.km)(this._context,Ue,fi,Es,Rt,this._context.layer.uid,er);if(null===mn)return null;const Di=new ue.z(this,mn.object,fi,(0,G.Wi)(ht)?Es:null,Pr,Ir.j3,Rt);Di.alignedSampledElevation=mn.sampledElevation,Di.needsElevationUpdates=(0,Ce.Xf)(Rt.mode)||"absolute-height"===Rt.mode;const{displayWidth:qn,displayHeight:xa}=(0,G.pC)(vr)?vr:st;return Di.getScreenSize=(Oi=(0,B.a)())=>(Oi[0]=qn,Oi[1]=xa,Oi),Di.metadata={labelText:$e,elevationOffset:st.elevationOffset},(0,fr.dO)(Di,Ue,this._context.elevationProvider),Di}},water:cc},vv={"mesh-3d":{fill:class hl extends Fe.k{constructor(Te,Ue,$e,st){super(Te,Ue,$e,st),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}doLoad(){var Te=this;return(0,D.Z)(function*(){rt.Z.DRAW_MESH_GEOMETRY_NORMALS&&(Te._debugVertexNormalMaterial=new ri.Y({color:[1,0,1,1]}),Te._debugFaceNormalMaterial=new ri.Y({color:[0,1,1,1]}))})()}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),Te=>Te.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(Te){const Ue=Te.graphic;if(!this._validateGeometry(Ue.geometry,Qn,"fill on mesh-3d"))return null;const $e=this.setGraphicElevationContext(Ue,new Be.o);return this._createAs3DShape(Ue,Te.renderingInfo,$e,Ue.uid)}layerOpacityChanged(Te,Ue){const $e=this._getLayerOpacity();this._materials.forEach(st=>{st.material.setParameters({layerOpacity:$e});const ht=st.material.parameters;this._setMaterialTransparentParameter(ht,st),st.material.setParameters({transparent:ht.transparent})}),Te.forEach(st=>{const ht=Ue(st);(0,G.pC)(ht)&&ht.layerOpacityChanged($e,this._context.isAsync)})}layerElevationInfoChanged(Te,Ue){return this.updateGraphics3DGraphicElevationInfo(Te,Ue,Ce.B5)}slicePlaneEnabledChanged(Te,Ue){return this._materials.forEach($e=>{$e.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),Te.forEach($e=>{const st=Ue($e);(0,G.pC)(st)&&st.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const Te=this._usePBR();return this._materials.forEach(Ue=>Ue.material.setParameters({usePBR:Te})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(Te){return(0,G.Wi)(Te)?"-":Te instanceof Cs.Z?Te.toHex():Te.contentHash}_materialPropertiesDefault(Te,Ue){const $e=this._requiresSymbolVertexColors(),st=!!Te.vertexAttributes.color,ht=!!Te.vertexAttributes.tangent;return{hasSymbolVertexColors:$e,hasVertexColors:st,hasVertexTangents:ht,uid:`vc:${st},vt:${ht},vct${Ue},svc:${$e}`}}_materialProperties(Te,Ue,$e){const st=this._materialPropertiesDefault(Te,$e);if(!Ue.material)return st;const{color:ht,colorTexture:yt,normalTexture:Rt,doubleSided:Ut,alphaCutoff:er,alphaMode:vr}=Ue.material,Pr=this._colorOrTextureUid(ht),Ur=this._colorOrTextureUid(yt),qr=this._colorOrTextureUid(Rt);if(st.color=ht,st.colorTexture=yt,st.normalTexture=Rt,st.uid=`${st.uid},cmuid:${Pr},ctmuid:${Ur},ntmuid:${qr},ds:${Ut},ac:${er},am:${vr}`,Ue.material instanceof Nr.Z){const{metallic:Zr,roughness:Es,metallicRoughnessTexture:si,emissiveColor:ei,emissiveTexture:Rs,occlusionTexture:fi}=Ue.material,Pi=this._colorOrTextureUid(si),mn=this._colorOrTextureUid(ei),Di=this._colorOrTextureUid(Rs),qn=this._colorOrTextureUid(fi);st.metallic=Zr,st.roughness=Es,st.metallicRoughnessTexture=si,st.emissiveColor=ei,st.emissiveTexture=Rs,st.occlusionTexture=fi,st.colorTextureTransform=Ue.material.colorTextureTransform,st.normalTextureTransform=Ue.material.normalTextureTransform,st.emissiveTextureTransform=Ue.material.emissiveTextureTransform,st.occlusionTextureTransform=Ue.material.occlusionTextureTransform,st.metallicRoughnessTextureTransform=Ue.material.metallicRoughnessTextureTransform,st.uid=`${st.uid},mrm:${Zr},mrr:${Es},mrt:${Pi},emuid:${mn},etmuid:${Di},otmuid:${qn}`}return st}_setInternalColorValueParameters(Te,Ue){Ue.diffuse=Cs.Z.toUnitRGB(Te),Ue.opacity=Te.a}_getLoadableTextureResource(Te){return Te.data?Te.data:Te.url}_getInternalTextureId(Te){const Ue=this._getInternalTexture(Te,Ie.JJ.Opaque);return(0,G.pC)(Ue)?Ue.id:null}_getInternalTexture(Te,Ue){const $e=this._getLoadableTextureResource(Te);if(!$e)return null;const st=`${Te.contentHash}/${Ue}`;let ht=this._textures.get(st);return ht||(ht=new Mo.x($e,{mipmap:!0,wrap:this._castTextureWrap(Te.wrap),noUnpackFlip:!0,preMultiplyAlpha:Ue!==Ie.JJ.Opaque}),this._textures.set(st,ht),this._context.stage.add(ht),this._context.stage.loadImmediate(ht)),ht}_castTextureWrap(Te="repeat"){if("string"==typeof Te){const Ue=this._castTextureWrapIndividual(Te);return{s:Ue,t:Ue}}return{s:this._castTextureWrapIndividual(Te.horizontal),t:this._castTextureWrapIndividual(Te.vertical)}}_castTextureWrapIndividual(Te){switch(Te){case"clamp":return Ci.e8.CLAMP_TO_EDGE;case"mirror":return Ci.e8.MIRRORED_REPEAT;default:return Ci.e8.REPEAT}}_setInternalMaterialParameters(Te,Ue){if((0,G.pC)(Te.color)&&this._setInternalColorValueParameters(Te.color,Ue),(0,G.pC)(Te.colorTexture)){const $e=this._getInternalTexture(Te.colorTexture,Ue.textureAlphaMode);(0,G.pC)($e)?(Ue.textureId=$e.id,Ue.textureAlphaPremultiplied=!!$e.params.preMultiplyAlpha):Ue.textureId=void 0}(0,G.pC)(Te.normalTexture)&&(Ue.normalTextureId=this._getInternalTextureId(Te.normalTexture)),(0,G.pC)(Te.emissiveColor)&&(Ue.emissiveFactor=Cs.Z.toUnitRGB(Te.emissiveColor)),(0,G.pC)(Te.emissiveTexture)&&(Ue.emissiveTextureId=this._getInternalTextureId(Te.emissiveTexture)),(0,G.pC)(Te.occlusionTexture)&&(Ue.occlusionTextureId=this._getInternalTextureId(Te.occlusionTexture)),(0,G.pC)(Te.metallicRoughnessTexture)&&(Ue.metallicRoughnessTextureId=this._getInternalTextureId(Te.metallicRoughnessTexture)),Ue.colorTextureTransformMatrix=(0,es.i)(Te.colorTextureTransform),Ue.normalTextureTransformMatrix=(0,es.i)(Te.normalTextureTransform),Ue.occlusionTextureTransformMatrix=(0,es.i)(Te.occlusionTextureTransform),Ue.emissiveTextureTransformMatrix=(0,es.i)(Te.emissiveTextureTransform),Ue.metallicRoughnessTextureTransformMatrix=(0,es.i)(Te.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(Te){const Ue=this._drivenProperties.color;let $e=(0,G.pC)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(Ue)Te.externalColor=tr.O;else{const st=(0,G.pC)(this.symbolLayer.material)?this.symbolLayer.material.color:null;(0,G.pC)(st)?Te.externalColor=Cs.Z.toUnitRGBA(st):($e=null,Te.externalColor=tr.O)}$e&&(Te.colorMixMode=$e),Te.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(Te){const Ue=Te.vertexAttributes.color;if((0,G.Wi)(Ue))return!1;for(let $e=3;$e<Ue.length;$e+=4)if(255!==Ue[$e])return!0;return!1}_getOrCreateMaterial(Te,Ue){const $e=Ue.material?.color,st=Ue.material?.colorTexture,ht=Ue.material?.alphaMode,yt="blend"===ht,Rt="opaque"!==ht&&(this._hasTransparentVertexColors(Te)||(0,G.pC)($e)&&$e.a<1||(0,G.pC)(st)&&st.transparent||yt),Ut=this._materialProperties(Te,Ue,Rt),er=this._materials.get(Ut.uid);if(er)return er.material;const vr={material:null,isComponentTransparent:Rt,alphaMode:Ue.material?Ue.material.alphaMode:"opaque"},Pr=null==Ut.metallicRoughnessTexture&&null==Ut.metallic&&null==Ut.roughness,Ur={usePBR:this._usePBR(),isSchematic:Pr,hasVertexColors:Ut.hasVertexColors,hasSymbolColors:Ut.hasSymbolVertexColors,hasVertexTangents:Ut.hasVertexTangents,ambient:X.Z,diffuse:X.O,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Ie.Vr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Pr||(Ur.mrrFactors=[null!=Ut.metallic?Ut.metallic:1,null!=Ut.roughness?Ut.roughness:1,.5]),Ue.material&&(Ur.doubleSided=Ue.material.doubleSided,Ur.cullFace=Ue.material.doubleSided?Ie.Vr.None:Ie.Vr.Back,Ur.textureAlphaCutoff=Ue.material.alphaCutoff),this._setExternalMaterialParameters(Ur),this._setMaterialTransparentParameter(Ur,vr),this._setInternalMaterialParameters(Ut,Ur);const qr=new Wt.Gp(Ur);return vr.material=qr,this._materials.set(Ut.uid,vr),this._context.stage.add(qr),qr}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(Te,Ue){Te.transparent=this.needsDrivenTransparentPass||Ue.isComponentTransparent||Te.layerOpacity<1||Te.opacity<1||Te.externalColor&&Te.externalColor[3]<1,Te.textureAlphaMode="auto"===Ue.alphaMode?Te.transparent?Ie.JJ.MaskBlend:Ie.JJ.Opaque:"opaque"===Ue.alphaMode?Ie.JJ.Opaque:"mask"===Ue.alphaMode?Ie.JJ.Mask:Ie.JJ.Blend}_addDebugNormals(Te,Ue,$e,st){const ht=Ue.length,yt=Te.spatialReference.isGeographic?20015077/180:1,Rt=.1*Math.max(Te.extent.width*yt,Te.extent.height*yt,Te.extent.zmax-Te.extent.zmin),Ut=[],er=[],vr=[],Pr=[];for(let Zr=0;Zr<ht;Zr++){const Es=Ue[Zr],si=Es.vertexAttributes.get(Pe.T.POSITION),ei=Es.vertexAttributes.get(Pe.T.NORMAL),Rs=Es.indices.get(Pe.T.POSITION),fi=Es.indices.get(Pe.T.NORMAL),Pi=si.data,mn=ei.data;for(let Di=0;Di<Rs.length;Di++){const qn=3*Rs[Di],xa=3*fi[Di];for(let Li=0;Li<3;Li++)Ut.push(Pi[qn+Li]);for(let Li=0;Li<3;Li++)Ut.push(Pi[qn+Li]+mn[xa+Li]*Rt);if(er.push(er.length),er.push(er.length),Di%3==0){this._calculateFaceNormal(Pi,Rs,Di,Vo),this._getFaceVertices(Pi,Rs,Di,on,pl,Wa),(0,H.a)(on,on,pl),(0,H.a)(on,on,Wa),(0,H.g)(on,on,1/3);for(let Li=0;Li<3;Li++)vr.push(on[Li]);for(let Li=0;Li<3;Li++)vr.push(on[Li]+Vo[Li]*Rt);Pr.push(Pr.length),Pr.push(Pr.length)}}}const Ur=new Ge.Z([[Pe.T.POSITION,{data:Ut,size:3,exclusive:!0}]],[[Pe.T.POSITION,er]],Ie.MX.Line);Ue.push(Ur),$e.push(this._debugVertexNormalMaterial),st.push((0,ye.b)(st[0]));const qr=new Ge.Z([[Pe.T.POSITION,{data:vr,size:3,exclusive:!0}]],[[Pe.T.POSITION,Pr]],Ie.MX.Line);Ue.push(qr),$e.push(this._debugFaceNormalMaterial),st.push((0,ye.b)(st[0]))}_createAs3DShape(Te,Ue,$e,st){const ht=Te.geometry;if("mesh"!==ht.type)return null;const yt=this._createGeometryInfo(ht,Ue,st);if(!yt)return null;const{geometries:Rt,materials:Ut,transformations:er,objectTransformation:vr}=yt;rt.Z.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ht,Rt,Ut,er);const Pr=new $t.T({geometries:Rt,materials:Ut,transformations:er,metadata:{layerUid:this._context.layer.uid,graphicUid:st}});Pr.transformation=vr;const Ur=this._createEdgeMaterial(),qr=(0,G.pC)(Ur)?{baseMaterial:Ut[0],edgeMaterials:[Ur],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Zr=new ue.z(this,Pr,Rt,null,null,Ir.j3,$e,qr);return Zr.needsElevationUpdates=(0,Ce.B5)($e.mode),Zr.useObjectOriginAsAttachmentOrigin=!0,Zr.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(Pr),Zr.alignedSampledElevation=(0,Ir.j3)(Zr,Zr.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),Zr}_getCenterPointInElevationSR(Te){const Ue=(0,se.Tx)(0,0,0,(0,G.pC)(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return(0,ae.MT)([Te.transformation[12],Te.transformation[13],Te.transformation[14]],this._context.renderCoordsHelper.spatialReference,Ue),Ue}_createComponentNormals(Te,Ue,$e,st){switch($e.shading||"flat"){case"source":return this._createComponentNormalsSource(Te,Ue,$e,st);case"flat":return this._createComponentNormalsFlat(Te,st);case"smooth":return this._createComponentNormalsSmooth(Te,st);default:return}}_createComponentNormalsSource(Te,Ue,$e,st){if((0,G.Wi)(Ue))return this._createComponentNormalsFlat(Te,st);let ht=!1;if(!$e.trustSourceNormals)for(let yt=0;yt<st.length;yt+=3){this._calculateFaceNormal(Te,st,yt,Vo);for(let Rt=0;Rt<3;Rt++){const Ut=3*st[yt+Rt];on[0]=Ue[Ut+0],on[1]=Ue[Ut+1],on[2]=Ue[Ut+2],(0,H.e)(Vo,on)<0&&(Ue[Ut+0]=-Ue[Ut+0],Ue[Ut+1]=-Ue[Ut+1],Ue[Ut+2]=-Ue[Ut+2],ht=!0)}}return{normals:Ue,indices:st,didFlipNormals:ht}}_createComponentNormalsFlat(Te,Ue){const $e=new Float32Array(Ue.length),st=new Array(3*Ue.length);for(let ht=0;ht<Ue.length;ht+=3){const yt=this._calculateFaceNormal(Te,Ue,ht,Vo);for(let Rt=0;Rt<3;Rt++)$e[ht+Rt]=yt[Rt],st[ht+Rt]=ht/3}return{normals:$e,indices:st,didFlipNormals:!1}}_createComponentNormalsSmooth(Te,Ue){const $e={};for(let yt=0;yt<Ue.length;yt+=3){const Rt=this._calculateFaceNormal(Te,Ue,yt,Vo);for(let Ut=0;Ut<3;Ut++){const er=Ue[yt+Ut];let vr=$e[er];vr||(vr={normal:(0,X.c)(),count:0},$e[er]=vr),(0,H.a)(vr.normal,vr.normal,Rt),vr.count++}}const st=new Float32Array(3*Ue.length),ht=new Array(3*Ue.length);for(let yt=0;yt<Ue.length;yt++){const Rt=$e[Ue[yt]];1!==Rt.count&&((0,H.n)(Rt.normal,Rt.normal),Rt.count=1);for(let Ut=0;Ut<3;Ut++)st[3*yt+Ut]=Rt.normal[Ut];ht[yt]=yt}return{normals:st,indices:ht,didFlipNormals:!1}}_getFaceVertices(Te,Ue,$e,st,ht,yt){const Rt=3*Ue[$e+0],Ut=3*Ue[$e+1],er=3*Ue[$e+2];st[0]=Te[Rt+0],st[1]=Te[Rt+1],st[2]=Te[Rt+2],ht[0]=Te[Ut+0],ht[1]=Te[Ut+1],ht[2]=Te[Ut+2],yt[0]=Te[er+0],yt[1]=Te[er+1],yt[2]=Te[er+2]}_calculateFaceNormal(Te,Ue,$e,st){return this._getFaceVertices(Te,Ue,$e,on,pl,Wa),(0,H.b)(pl,pl,on),(0,H.b)(Wa,Wa,on),(0,H.f)(on,pl,Wa),(0,H.n)(st,on),st}_getOrCreateComponents(Te){return(0,G.Pt)(Te.components,Jf)}_createPositionBuffer(Te,Ue){let $e=Te.vertexAttributes.position;const st=Ue.reprojection===vo.ECEF?Ue.transformBeforeProject:null;if((0,G.pC)(st)&&($e=(0,ts.zZ)($e,new Float64Array($e.length),st)),Ue.reprojection===vo.NONE)return Ue.needsBufferCopy?new Float64Array($e):$e;const ht=(0,G.pC)(st)?$e:new Float64Array($e.length);return(0,ae.CM)($e,Te.spatialReference,0,ht,this._context.renderCoordsHelper.spatialReference,0,$e.length/3),ht}_createNormalBuffer(Te,Ue,$e){let st=Te.vertexAttributes.normal;if((0,G.Wi)(st))return null;const ht=$e.reprojection===vo.ECEF?$e.transformBeforeProject:null;if((0,G.pC)(ht)&&(st=(0,ts.w9)(st,new Float32Array(st.length),ht)),"local"===this._context.graphicsCoreOwner.view.viewingMode||$e.reprojection===vo.NONE)return $e.needsBufferCopy&&Te.vertexAttributes.normal===st?new Float32Array(st):st;const yt=Te.vertexAttributes.position,Rt=(0,G.pC)(ht)?st:new Float32Array(st.length);return(0,ts.Iz)(st,yt,Ue,Te.spatialReference,Rt)}_createTangentBuffer(Te,Ue,$e){let st=Te.vertexAttributes.tangent;if((0,G.Wi)(st))return null;const ht=$e.reprojection===vo.ECEF?$e.transformBeforeProject:null;if((0,G.pC)(ht)&&(st=(0,ts.VS)(st,new Float32Array(st.length),ht)),"local"===this._context.graphicsCoreOwner.view.viewingMode||$e.reprojection===vo.NONE)return $e.needsBufferCopy&&Te.vertexAttributes.normal===st?new Float32Array(st):st;const yt=Te.vertexAttributes.position,Rt=(0,G.pC)(ht)?st:new Float32Array(st.length);return(0,ts.wi)(st,yt,Ue,Te.spatialReference,Rt)}_createColorBuffer(Te){return Te.vertexAttributes.color}_createSymbolColorBuffer(Te){if(this._requiresSymbolVertexColors()){const Ue=this._getVertexOpacityAndColor(Te),$e=(0,hs.F5)((0,G.U2)(this.symbolLayer,"material","colorMixMode")),st=new Uint8Array(4);return(0,hs.HB)(Ue,$e,st),st}return null}_createBuffers(Te,Ue){const $e=Te.vertexAttributes&&Te.vertexAttributes.position;if(!$e)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const st=Te.vertexAttributes.normal,ht=Te.vertexAttributes.uv,yt=Te.vertexAttributes.tangent;if((0,G.pC)(st)&&st.length!==$e.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if((0,G.pC)(yt)&&yt.length/4!=$e.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if((0,G.pC)(ht)&&ht.length/2!=$e.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const Rt=this._computeReprojectionInfo(Te),Ut=this._createPositionBuffer(Te,Rt),er=this._createColorBuffer(Te),vr=this._createSymbolColorBuffer(Ue),Pr=this._createNormalBuffer(Te,Ut,Rt),Ur=this._createTangentBuffer(Te,Ut,Rt);return{positionBuffer:Ut,normalBuffer:Pr,tangentBuffer:Ur,uvBuffer:ht,colorBuffer:er,symbolColorBuffer:vr,objectTransformation:Rt.reprojection===vo.NONE&&(0,G.pC)(Rt.objectTransformation)?Rt.objectTransformation:this._transformOriginLocal(Te,Ut,Pr,Ur),geometryTransformation:Rt.reprojection===vo.NONE&&(0,G.pC)(Rt.geometryTransformation)?Rt.geometryTransformation:(0,ye.c)()}}_computeReprojectionInfo(Te){const Ue=(0,G.pC)(Te.transform),$e=Ue&&Te.transform.geographic||this._context.renderCoordsHelper.viewingMode===We.JY.Local?vo.NONE:vo.ECEF;if(Ue){if($e===vo.NONE){const ht=(0,ye.c)();return(0,ae.Bm)(Te.spatialReference,Te.transform.origin,ht,this._context.renderCoordsHelper.spatialReference),{reprojection:$e,objectTransformation:ht,geometryTransformation:(0,ye.b)(Te.transform.localMatrix),needsBufferCopy:!1}}const st=(0,Se.f)((0,ye.c)(),Te.transform.origin);return(0,Se.m)(st,st,Te.transform.localMatrix),{reprojection:$e,transformBeforeProject:st,needsBufferCopy:!0}}return{reprojection:$e,needsBufferCopy:!0}}_transformOriginLocal(Te,Ue,$e,st){const ht=this._context.renderCoordsHelper.spatialReference,yt=Te.anchor;oa[0]=yt.x,oa[1]=yt.y,oa[2]=yt.z;const Rt=(0,ye.c)();(0,ae.Bm)(Te.spatialReference,oa,Rt,ht);const Ut=ve.fP.fromTypedArray(Ue);if((0,Se.a)(w0,Rt),(0,xe.t)(Ut,Ut,w0),(0,G.pC)($e)||(0,G.pC)(st)){if((0,De.f)(Cu,Rt),(0,De.t)(Cu,Cu),(0,G.pC)($e)){const er=ve.ct.fromTypedArray($e);(0,xe.a)(er,er,Cu)}if((0,G.pC)(st)){const er=ve.ct.fromTypedArray(st,4*st.BYTES_PER_ELEMENT);(0,xe.a)(er,er,Cu)}}return Rt}_validateFaces(Te,Ue){const $e=Te.vertexAttributes.position.length/3,st=Ue.faces;if(st){let ht=-1;for(let yt=0;yt<st.length;yt++){const Rt=st[yt];Rt>ht&&(ht=Rt)}if($e<=ht)return this.logger.warn(`Vertex index ${ht} is out of bounds of the mesh position buffer`),!1}else if($e%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(Te,Ue){return Ue.faces?Ue.faces:(0,Ks.p)(Te.vertexAttributes.position.length/3)}_isOutsideClippingArea(Te){if(!this._context.clippingExtent)return!1;const Ue=Te.vertexAttributes&&Te.vertexAttributes.position;if(!Ue)return!1;const $e=this._context.elevationProvider.spatialReference;let st;const ht=Ue.length/3;return(0,G.pC)($e)&&!Te.spatialReference.equals($e)?(st=new Float64Array(Ue.length),(0,ae.CM)(Te.vertexAttributes.position,Te.spatialReference,0,st,$e,0,ht)):st=Ue,(0,oe.cS)(eh),(0,oe.G1)(eh,st,0,ht),!(0,oe.Zp)(eh,this._context.clippingExtent)}_createGeometryInfo(Te,Ue,$e){if(!(0,ae.Up)(Te.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(Te))return null;const st=this._createBuffers(Te,Ue);if((0,G.Wi)(st))return null;const{positionBuffer:ht,uvBuffer:yt,colorBuffer:Rt,symbolColorBuffer:Ut,normalBuffer:er,tangentBuffer:vr,objectTransformation:Pr,geometryTransformation:Ur}=st,qr=this._getOrCreateComponents(Te),Zr=[],Es=[],si=[];let ei=!1;for(const Rs of qr){if(!this._validateFaces(Te,Rs))return null;const fi=this._getOrCreateFaces(Te,Rs);if(0===fi.length)continue;const Pi=this._createComponentNormals(ht,er,Rs,fi);Pi.didFlipNormals&&(ei=!0);const mn=[[Pe.T.POSITION,{size:3,data:ht,exclusive:!0}],[Pe.T.NORMAL,{size:3,data:Pi.normals,exclusive:!0}]],Di=[[Pe.T.POSITION,fi],[Pe.T.NORMAL,Pi.indices]];(0,G.pC)(Rt)&&(mn.push([Pe.T.COLOR,{size:4,data:Rt,exclusive:!0}]),Di.push([Pe.T.COLOR,fi])),(0,G.pC)(Ut)&&(mn.push([Pe.T.SYMBOLCOLOR,{size:4,data:Ut,exclusive:!0}]),Di.push([Pe.T.SYMBOLCOLOR,new Array(fi.length).fill(0)])),(0,G.pC)(yt)&&(mn.push([Pe.T.UV0,{size:2,data:yt,exclusive:!0}]),Di.push([Pe.T.UV0,fi])),(0,G.pC)(vr)&&(mn.push([Pe.T.TANGENT,{size:4,data:vr,exclusive:!0}]),Di.push([Pe.T.TANGENT,fi]));const qn=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:$e,layerUid:this._context.layer.uid}),xa=new Ge.Z(mn,Di,Ie.MX.Triangle,qn);Zr.push(xa),Es.push(Ur),si.push(this._getOrCreateMaterial(Te,Rs))}return ei&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:Zr,transformations:Es,materials:si,objectTransformation:Pr}}_createEdgeMaterial(){const Te={opacity:this._getLayerOpacity()};return(0,Je.hM)(this.symbolLayer,Te)}}}};class vT extends dp.w{constructor(Te,Ue,$e){super(Ue.schedule),this._symbol=Te,this._context=Ue,this._backgroundLayers=$e,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(Te){this._symbol=Te;for(let Ue=0;Ue<Te.symbolLayers.length;Ue++){const $e=this.symbolLayers[Ue];(0,G.Wi)($e)||($e.symbol=Te,$e.symbolLayer=Te.symbolLayers.items[Ue])}}get symbol(){return this._symbol}doLoad(Te){var Ue=this;return(0,D.Z)(function*(){let $e=Ue._symbol.symbolLayers;Ue._extentPadding=0,Ue._backgroundLayers&&($e=Ue._backgroundLayers.concat($e));const st=$e.length;for(;Ue.symbolLayers.length<$e.length;)Ue.symbolLayers.push(null);Ue.symbolLayers.length=$e.length;const ht=[];for(let yt=0;yt<st;yt++){const Rt=$e.getItemAt(yt);if(!1===Rt.enabled)continue;q0.renderPriority=1-(1+yt)/st,q0.renderPriorityStep=1/st,q0.ignoreDrivers=Rt._ignoreDrivers;const Ut=bp(Ue.symbol,Rt,Ue._context,q0);ht.push((0,Z.$F)(Te,()=>{Ue.symbolLayers[yt]=null,Ut.destroy()})),Ue.symbolLayers[yt]=Ut}yield(0,R.Ed)(Ue.symbolLayers,function(){var yt=(0,D.Z)(function*(Rt,Ut){if((0,G.pC)(Rt))try{yield Rt.load(),Ue._extentPadding+=Math.max(Ue._extentPadding,Rt.extentPadding)}catch{Ue.symbolLayers[Ut]=null}});return function(Rt,Ut){return yt.apply(this,arguments)}}());for(const yt of ht)yt?.remove();if(ht.length=0,(0,Z.k_)(Te),Ue.symbolLayers.length&&!Ue.symbolLayers.some(yt=>!!yt))throw new Error})()}getSymbolLayerSize(Te){const Ue=this.symbolLayers[Te];return(0,G.pC)(Ue)?Ue.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(Te=>(0,G.pC)(Te)&&Te.queryForSnapping)}createGraphics3DGraphic(Te,Ue){const $e=Te.graphic,st=new Array(this.symbolLayers.length);for(let yt=0;yt<this.symbolLayers.length;yt++){const Rt=this.symbolLayers[yt];st[yt]=(0,G.pC)(Rt)?Rt.createGraphics3DGraphic(Te):null}return new J($e,Ue||this,st,Te.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)}get complexity(){return(0,U0.IQ)(this.symbolLayers.map(Te=>(0,G.U2)(Te,"complexity")))}globalPropertyChanged(Te,Ue){const $e=this.symbolLayers.length;for(let st=0;st<$e;st++){const ht=this.symbolLayers[st],yt=Rt=>{const Ut=Rt.graphics[st];return Ut instanceof ue.z?Ut:null};if((0,G.pC)(ht)&&!ht.globalPropertyChanged(Te,Ue,yt))return!1}return!0}applyRendererDiff(Te,Ue){return this.loadStatus!==dp.P.LOADED?Re.W.Recreate_Symbol:this.symbolLayers.reduce(($e,st)=>$e!==Re.W.Recreate_Symbol&&(0,G.pC)(st)?Math.min($e,st.applyRendererDiff(Te,Ue)):$e,Re.W.Fast_Update)}prepareSymbolPatch(Te){if(this.loadStatus===dp.P.FAILED||"partial"!==Te.diff.type)return;const Ue=Te.diff.diff;if(!Ue.symbolLayers||"partial"!==Ue.symbolLayers.type)return;const $e=Ue.symbolLayers.diff;this.symbolLayers.forEach((st,ht)=>{if((0,G.Wi)(st))return;const yt=$e[ht];if(yt){const Rt={diff:yt,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};st.prepareSymbolLayerPatch(Rt),Te.symbolStatePatches.push(...Rt.symbolLayerStatePatches),Rt.graphics3DGraphicPatches.length&&Te.graphics3DGraphicPatches.push((Ut,er)=>{const vr=Ut.graphics[ht];(0,G.pC)(vr)&&Rt.graphics3DGraphicPatches.forEach(Pr=>Pr(vr,er))})}})}updateGeometry(Te,Ue){for(let $e=0;$e<this.symbolLayers.length;$e++){const st=this.symbolLayers[$e];if((0,G.Wi)(st))continue;const ht=Te.graphics[$e];if((0,G.Wi)(ht)||!st.updateGeometry(ht,Ue))return!1}return!0}onRemoveGraphic(Te){for(let Ue=0;Ue<this.symbolLayers.length;Ue++){const $e=this.symbolLayers[Ue];if((0,G.Wi)($e))continue;const st=Te.graphics[Ue];(0,G.pC)(st)&&$e.onRemoveGraphic(st)}}getFastUpdateStatus(){let Te=0,Ue=0,$e=0;return this.symbolLayers.forEach(st=>{(0,G.Wi)(st)||(st.loadStatus===dp.P.LOADING?Te++:st.isFastUpdatesEnabled()?$e++:Ue++)}),{loading:Te,slow:Ue,fast:$e}}queryForSnapping(Te,Ue,$e,st){var ht=this;return(0,D.Z)(function*(){const yt=ht.symbolLayers.filter(G.pC).filter(Ut=>(0,G.pC)(Ut.queryForSnapping)).map(Ut=>Ut.queryForSnapping(Te,Ue,$e,st)),Rt=yield Promise.all(yt);return(0,Z.k_)(st),Rt.flat()})()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const Te of this.symbolLayers)(0,G.pC)(Te)&&Te.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const q0={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},18422:(nt,Ae,v)=>{"use strict";v.d(Ae,{d:()=>se,k:()=>de});var D=v(91558),G=(v(8314),v(63290)),Z=v(62208),Q=v(28093),$=v(4794),W=v(81468),B=v(79112),H=v(74746),X=v(67225),te=v(64538),ae=v(87930),oe=v(97161);const le=G.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class de extends ae.w{constructor(J,ce,ue,pe){super(ue.schedule),this._context=ue,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=le,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=J,this.symbolLayer=ce,this._renderPriority=pe.renderPriority,this._renderPriorityStep=pe.renderPriorityStep,this._elevationContext=new B.o,this.complexity=this.computeComplexity(),this._ignoreDrivers=pe.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=re(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(J){if(this._ignoreDrivers)return!1;const ce=this._drivenProperties,ue=re(J);return ue.color!==ce.color||ue.opacity!==ce.opacity||ue.opacityAlwaysOpaque!==ce.opacityAlwaysOpaque||ue.size!==ce.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(J,ce,ue,pe){const me="polygons"in J?J.polygons:null,ge=`${pe} geometry failed to be created`;let _e=null;J.projectionSuccess?!this._logGeometryValidationWarnings(ce,ue,pe)&&me&&0===me.length&&"rings"===ue&&ce.length>0&&ce[0].length>2&&(_e=`${ge} (filled rings should use clockwise winding - try reversing the order of vertices)`):_e=`${ge} (failed to project geometry to view spatial reference)`,_e&&le.warnOncePerTick(_e)}_logGeometryValidationWarnings(J,ce,ue){const pe=`${ue} geometry failed to be created`;return!J.length||1===J.length&&!J[0].length?(le.warnOncePerTick(`${pe} (no ${ce} were defined)`),!0):!(Array.isArray(J)&&Array.isArray(J[0])||(le.warnOncePerTick(`${pe} (${ce} should be defined as a 2D array)`),0))}_validateGeometry(J,ce=null,ue=null){if((0,Z.pC)(ce)&&!ce.includes(J.type))return this.logger.warn("unsupported geometry type for "+ue+` symbol: ${J.type}`),!1;if("point"===J.type){const pe=J;if(!isFinite(pe.x)||!isFinite(pe.y))return le.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return j}_defaultElevationInfoZ(){return Y}_updateElevationContext(){(0,Z.pC)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(J){return J.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(J,ce=this.getDefaultElevationInfo(J)){return this._elevationContext.mode||ce.mode}setElevationInfoOverride(J){this._elevationInfoOverride=J,this._updateElevationContext()}setGraphicElevationContext(J,ce){const ue=(0,Z.Wg)(J.geometry),pe=this.getDefaultElevationInfo(ue);ce.unit=null!=this._elevationContext.unit?this._elevationContext.unit:pe.unit,ce.mode=this.getGeometryElevationMode(ue,pe),ce.offsetMeters=(0,Z.Pt)(this._elevationContext.meterUnitOffset,(0,Z.Pt)(pe.offset,0));const he=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===ce.mode;return he&&(ce.mode="relative-to-ground",ce.offsetMeters=0),ce.updateFeatureExpressionInfoContext(he?H.O$:this._elevationContext.featureExpressionInfoContext,J,this._context.layer),ce}prepareSymbolLayerPatch(J){}updateGeometry(J,ce){return!1}onRemoveGraphic(J){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity:this._context.layer.opacity??1}_getCombinedOpacity(J,ce=ee){let ue=1;return this.draped||(ue*=this._getLayerOpacity()),this._drivenProperties.opacity||((0,Z.pC)(J)?ue*=J.a:ce.hasIntrinsicColor||(ue=0)),ue}_getCombinedOpacityAndColor(J,ce=ee){const ue=this._getCombinedOpacity(J,ce);if(this._drivenProperties.color)return(0,X.Uu)(null,ue);const pe=(0,Z.pC)(J)?D.Z.toUnitRGB(J):Q.O;return(0,X.Uu)(pe,ue)}_getVertexOpacityAndColor(J,ce=null){const he=(0,X.Uu)(this._drivenProperties.color?J.color:null,this._drivenProperties.opacity?J.opacity:null);return(0,Z.pC)(ce)&&(he[0]*=ce,he[1]*=ce,he[2]*=ce,he[3]*=ce),he}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return(0,oe.u)(this.symbol,this.symbolLayer)}globalPropertyChanged(J,ce,ue){switch(J){case"opacity":return this.layerOpacityChanged(ce,ue),!0;case"elevationInfo":{const pe=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(ce,ue,pe)!==W.lO.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(ce,ue);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(J,ce,ue){let pe=W.lO.UPDATE;return J.forEach(he=>{const me=ce(he);(0,Z.pC)(me)?(this.setGraphicElevationContext(he.graphic,me.elevationContext),me.needsElevationUpdates=ue(me.elevationContext.mode)):pe=W.lO.RECREATE}),pe}applyRendererDiff(J,ce){return te.W.Recreate_Symbol}getFastUpdateAttrValues(J){if(!this._fastUpdates.enabled)return null;const ce=this._fastUpdates.visualVariables,ue=ce.size?se(ce.size.field,J):0,pe=ce.color?se(ce.color.field,J):0,he=ce.opacity?se(ce.opacity.field,J):0;return(0,$.f)(ue,pe,he,0)}get draped(){return this._draped}ensureDrapedStatus(J){return null==this._draped?(this._draped=J,!0):(J!==this.draped&&le.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables?.size?.field??null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null})}}}function se(ie,J){const ce=null!=ie?J.attributes[ie]:0;return null!=ce&&isFinite(ce)?ce:0}function re(ie){const J={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return ie&&"visualVariables"in ie&&ie.visualVariables&&ie.visualVariables.forEach(ce=>{switch(ce.type){case"color":if(J.color=!0,ce.stops)for(let ue=0;ue<ce.stops.length;ue++){const pe=ce.stops[ue].color;pe&&(J.opacity=!0,pe.a<1&&(J.opacityAlwaysOpaque=!1))}break;case"opacity":J.opacity=!0,J.opacityAlwaysOpaque=!1;break;case"size":J.size=!0}}),J}const j={mode:"on-the-ground",offset:0,unit:"meters"},Y={mode:"absolute-height",offset:0,unit:"meters"},ee={hasIntrinsicColor:!1}},13939:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>$});var D=v(15861),R=v(62208),G=v(64538),Z=v(87930),Q=v(97161);class $ extends Z.w{constructor(B,H,X){super(H),this.symbol=B,this._convert=X,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(B){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(B):null}get symbolLayers(){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}doLoad(B){var H=this;return(0,D.Z)(function*(){const X=yield H.symbol.fetchSymbol({signal:B});X.id=H.symbol.id,H.graphics3DSymbol=H._convert(X),(0,R.pC)(H.graphics3DSymbol)&&(yield H.graphics3DSymbol.load())})()}createGraphics3DGraphic(B){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(B,this):null}get complexity(){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Q.WU}globalPropertyChanged(B,H){return!!(0,R.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(B,H)}applyRendererDiff(B,H){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(B,H):G.W.Recreate_Symbol}prepareSymbolPatch(B){(0,R.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(B)}updateGeometry(B,H){return!!(0,R.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(B,H)}onRemoveGraphic(){}getFastUpdateStatus(){return(0,R.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){(0,R.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},87930:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>Z,w:()=>G});var Z,Q,D=v(62208),R=v(10699);class G{constructor($){this.schedule=$,this._abortController=null,this._loadStatus=Z.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load($,W){return this._loadStatus===Z.LOADED?($&&$(),(0,D.Pt)(this._loader,Promise.resolve())):this._loadStatus===Z.FAILED?(W&&W(this._loadError),(0,D.Pt)(this._loader,Promise.resolve())):((0,D.Wi)(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Z.LOADED},B=>{throw this._loadError=B,this._abortController=null,this._loadStatus=Z.FAILED,!(0,R.D_)(B)&&this.logger&&B.message&&this.logger.warn(B.message),B})),this._loader.then($,W).catch(()=>{}),this._loader)}abortLoad(){(0,D.pC)(this._abortController)?this._abortController=(0,D.IM)(this._abortController):this._loadStatus===Z.LOADING&&(this._loadStatus=Z.FAILED),this._loader=null}}(Q=Z||(Z={}))[Q.LOADING=0]="LOADING",Q[Q.LOADED=1]="LOADED",Q[Q.FAILED=2]="FAILED"},80960:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R,r:()=>G});var D=v(4794);const R=1.2,G=D.Z},81468:(nt,Ae,v)=>{"use strict";v.d(Ae,{B5:()=>de,GC:()=>oe,Lm:()=>J,Xf:()=>le,bD:()=>se,lO:()=>ce,qZ:()=>te,rR:()=>X,w7:()=>ae});var ce,ge,D=v(94573),R=v(62208),G=v(28347),Z=v(43703),Q=v(28093),$=v(55915),W=v(88530),B=v(67225),H=v(53929);function X(ge,_e,Ee,De,be,Se,ye,ve,xe,ze,Ke){const We=ue[Ke.mode];let Ce,Be,Fe=0;if((0,$.CM)(ge,_e,Ee,De,xe.spatialReference,be,ve))return We.requiresAlignment(Ke)?(Fe=We.applyElevationAlignmentBuffer(De,be,Se,ye,ve,xe,ze,Ke),Ce=Se,Be=ye):(Ce=De,Be=be),(0,$.CM)(Ce,xe.spatialReference,Be,Se,ze.spatialReference,ye,ve)?Fe:void 0}function te(ge,_e,Ee,De,be){const Se=((0,W.f)(ge)?ge.z:(0,H.Fb)(ge)?ge.array[ge.offset+2]:ge[2])||0;switch(Ee.mode){case"on-the-ground":{const ye=(0,R.Pt)((0,H.KO)(_e,ge,"ground"),0);return be.verticalDistanceToGround=0,be.sampledElevation=ye,void(be.z=ye)}case"relative-to-ground":{const ye=(0,R.Pt)((0,H.KO)(_e,ge,"ground"),0),ve=Ee.geometryZWithOffset(Se,De);return be.verticalDistanceToGround=ve,be.sampledElevation=ye,void(be.z=ve+ye)}case"relative-to-scene":{const ye=(0,R.Pt)((0,H.KO)(_e,ge,"scene"),0),ve=Ee.geometryZWithOffset(Se,De);return be.verticalDistanceToGround=ve,be.sampledElevation=ye,void(be.z=ve+ye)}case"absolute-height":{const ye=Ee.geometryZWithOffset(Se,De),ve=(0,R.Pt)((0,H.KO)(_e,ge,"ground"),0);return be.verticalDistanceToGround=ye-ve,be.sampledElevation=ve,void(be.z=ye)}default:return(0,D.Bg)(Ee.mode),void(be.z=0)}}function ae(ge,_e,Ee,De){return te(ge,_e,Ee,De,he),he.z}function oe(ge,_e,Ee){return null==_e||null==Ee?ge.definedChanged:"on-the-ground"===_e&&"on-the-ground"===Ee?ge.staysOnTheGround:_e===Ee||"on-the-ground"!==_e&&"on-the-ground"!==Ee?ce.UPDATE:ge.onTheGroundChanged}function le(ge){return"relative-to-ground"===ge||"relative-to-scene"===ge}function de(ge){return"absolute-height"!==ge}function se(ge,_e,Ee,De,be){te(_e,Ee,be,De,he),(0,B.CV)(ge,he.verticalDistanceToGround);const Se=he.sampledElevation,ye=(0,G.c)(pe,ge.transformation);return me[0]=_e.x,me[1]=_e.y,me[2]=he.z,(0,$.Bm)(_e.spatialReference,me,ye,De.spatialReference)?ge.transformation=ye:console.warn("Could not locate symbol object properly, it might be misplaced"),Se}class J{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(ge=ce||(ce={}))[ge.NONE=0]="NONE",ge[ge.UPDATE=1]="UPDATE",ge[ge.RECREATE=2]="RECREATE";const ue={"absolute-height":{applyElevationAlignmentBuffer:function ie(ge,_e,Ee,De,be,Se,ye,ve){const xe=ve.calculateOffsetRenderUnits(ye),ze=ve.featureExpressionInfoContext;_e*=3,De*=3;for(let Ke=0;Ke<be;++Ke){const Ce=ge[_e+1],Be=ge[_e+2];Ee[De+0]=ge[_e+0],Ee[De+1]=Ce,Ee[De+2]=null==ze?Be+xe:xe,_e+=3,De+=3}return 0},requiresAlignment:function ee(ge){return 0!==ge.meterUnitOffset||null!=ge.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function re(ge,_e,Ee,De,be,Se){let ye=0;const ve=Se.spatialReference;_e*=3,De*=3;for(let xe=0;xe<be;++xe){const ze=ge[_e+0],Ke=ge[_e+1],Ce=(0,R.Pt)(Se.getElevation(ze,Ke,ge[_e+2],ve,"ground"),0);ye+=Ce,Ee[De+0]=ze,Ee[De+1]=Ke,Ee[De+2]=Ce,_e+=3,De+=3}return ye/be},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function j(ge,_e,Ee,De,be,Se,ye,ve){let xe=0;const ze=ve.calculateOffsetRenderUnits(ye),Ke=ve.featureExpressionInfoContext,We=Se.spatialReference;_e*=3,De*=3;for(let Ce=0;Ce<be;++Ce){const Be=ge[_e+0],Fe=ge[_e+1],je=ge[_e+2],Re=(0,R.Pt)(Se.getElevation(Be,Fe,je,We,"ground"),0);xe+=Re,Ee[De+0]=Be,Ee[De+1]=Fe,Ee[De+2]=null==Ke?je+Re+ze:Re+ze,_e+=3,De+=3}return xe/be},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function Y(ge,_e,Ee,De,be,Se,ye,ve){let xe=0;const ze=ve.calculateOffsetRenderUnits(ye),Ke=ve.featureExpressionInfoContext,We=Se.spatialReference;_e*=3,De*=3;for(let Ce=0;Ce<be;++Ce){const Be=ge[_e+0],Fe=ge[_e+1],je=ge[_e+2],Re=(0,R.Pt)(Se.getElevation(Be,Fe,je,We,"scene"),0);xe+=Re,Ee[De+0]=Be,Ee[De+1]=Fe,Ee[De+2]=null==Ke?je+Re+ze:Re+ze,_e+=3,De+=3}return xe/be},requiresAlignment:()=>!0}},pe=(0,Z.c)(),he=new J,me=(0,Q.c)()},79721:(nt,Ae,v)=>{"use strict";var D,R,G;v.d(Ae,{E:()=>D,P:()=>R}),(G=D||(D={}))[G.GRAPHIC=0]="GRAPHIC",G[G.LABEL=1]="LABEL",G[G._COUNT=2]="_COUNT",function(G){G[G.USER_SETTING=0]="USER_SETTING",G[G.SCALE_RANGE=1]="SCALE_RANGE",G[G.FILTER=2]="FILTER",G[G.DECONFLICTION=3]="DECONFLICTION",G[G._COUNT=4]="_COUNT"}(R||(R={}))},74746:(nt,Ae,v)=>{"use strict";v.d(Ae,{O$:()=>de,Tz:()=>te,WI:()=>le,aO:()=>ae,bw:()=>B,d9:()=>W,ht:()=>oe,kr:()=>H});var D=v(15861),R=v(63290),G=v(10699),Z=v(84786),Q=v(46679);const $=R.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function W(j){return{cachedResult:j.cachedResult,arcade:j.arcade?{func:j.arcade.func,context:j.arcade.modules.arcadeUtils.createExecContext(null,{sr:j.arcade.context.spatialReference}),modules:j.arcade.modules}:null}}function B(j){const Y=j&&j.expression;if("string"==typeof Y){const ee=re(Y);if(null!=ee)return{cachedResult:ee}}return null}function H(j,Y,ee,ie){return X.apply(this,arguments)}function X(){return(X=(0,D.Z)(function*(j,Y,ee,ie){const J=j&&j.expression;if("string"!=typeof J)return null;const ce=re(J);if(null!=ce)return{cachedResult:ce};const ue=yield(0,Q.LC)();(0,G.k_)(ee);const pe=ue.arcadeUtils,he=pe.createSyntaxTree(J);return pe.dependsOnView(he)?(ie?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:pe.createFunction(he),context:pe.createExecContext(null,{sr:Y}),modules:ue}}})).apply(this,arguments)}function te(j,Y,ee){return j.arcadeUtils.createFeature(Y.attributes,Y.geometry,ee)}function ae(j,Y){if(null!=j&&!se(j)){if(!Y||!j.arcade)return void $.errorOncePerTick("Arcade support required but not provided");const ee=Y;ee._geometry&&(ee._geometry=(0,Z.kB)(ee._geometry)),j.arcade.modules.arcadeUtils.updateExecContext(j.arcade.context,Y)}}function oe(j){if(null!=j){if(se(j))return j.cachedResult;const Y=j.arcade;let ee=j.arcade.modules.arcadeUtils.executeFunction(Y.func,Y.context);return"number"!=typeof ee&&(j.cachedResult=0,ee=0),ee}return 0}function le(j,Y=!1){let ee=j&&j.featureExpressionInfo;return Y||"0"===(ee&&ee.expression)||(ee=null),ee}const de={cachedResult:0};function se(j){return null!=j.cachedResult}function re(j){return"0"===j?0:null}},67225:(nt,Ae,v)=>{"use strict";v.d(Ae,{$o:()=>ue,CV:()=>J,Go:()=>ie,Si:()=>Ee,Uu:()=>ce,ZL:()=>ge,_Z:()=>_e,bD:()=>pe,bh:()=>me,zE:()=>se});var D=v(62208),R=v(16730),G=v(28347),Z=v(43703),Q=v(28093),$=v(993),W=v(4794),B=v(55915),H=v(5548),X=v(65401),te=v(27105),ae=v(25748),oe=v(38114),le=v(84786),de=v(16396);function se(De,be){if("point"===De.type)return ee(De,be,!1);if((0,le.Ou)(De))switch(De.type){case"extent":return ee(De.center,be,!1);case"polygon":return ee(De.centroid,be,!1);case"polyline":return ee(re(De),be,!0);case"mesh":return ee(De.origin,be,!1)}else switch(De.type){case"extent":return ee(function j(De){const be=isFinite(De.zmin);return(0,oe.Tx)(.5*(De.xmax+De.xmin),.5*(De.ymax+De.ymin),be?.5*(De.zmax+De.zmin):void 0,De.spatialReference)}(De),be,!0);case"polygon":return ee(function Y(De){const be=De.rings[0];if(!be||0===be.length)return null;const Se=(0,te.a)(De.rings,De.hasZ);return(0,oe.Tx)(Se[0],Se[1],Se[2],De.spatialReference)}(De),be,!0);case"polyline":return ee(re(De),be,!0)}}function re(De){const be=De.paths[0];if(!be||0===be.length)return null;const Se=(0,ae.n8)(be,(0,ae.ok)(be)/2);return(0,oe.Tx)(Se[0],Se[1],Se[2],De.spatialReference)}function ee(De,be,Se){const ye=Se?De:(0,le.WG)(De);return be&&De?(0,B.nF)(De,ye,be)?ye:null:ye}function ie(De,be,Se,ye=0){if(De){be||(be=(0,X.Ue)());const ve=De;let xe=.5*ve.width*(Se-1),ze=.5*ve.height*(Se-1);return ve.width<1e-7*ve.height?xe+=ze/20:ve.height<1e-7*ve.width&&(ze+=xe/20),(0,$.s)(be,ve.xmin-xe-ye,ve.ymin-ze-ye,ve.xmax+xe+ye,ve.ymax+ze+ye),be}return null}function J(De,be){for(let Se=0;Se<De.geometries.length;++Se){const ye=De.geometries[Se].getMutableAttribute(de.T.AUXPOS1);ye&&ye.data[3]!==be&&(ye.data[3]=be,De.geometryVertexAttrsUpdated(De.geometryRecords[Se]))}}function ce(De,be){const Se=(0,W.d)(W.O);return(0,D.pC)(De)&&(Se[0]=De[0],Se[1]=De[1],Se[2]=De[2]),(0,D.pC)(be)?Se[3]=be:(0,D.pC)(De)&&De.length>3&&(Se[3]=De[3]),Se}function ue(De,be,Se,ye,ve,xe=[0,0,0,0]){for(let ze=0;ze<3;++ze)xe[ze]=(0,D.pC)(De)&&null!=De[ze]?De[ze]:(0,D.pC)(Se)&&null!=Se[ze]?Se[ze]:ve[ze];return xe[3]=(0,D.pC)(be)?be:(0,D.pC)(ye)?ye:ve[3],xe}function pe(De=Q.O,be,Se,ye=1){const ve=new Array(3);if((0,D.Wi)(be)||(0,D.Wi)(Se))ve[0]=1,ve[1]=1,ve[2]=1;else{let xe,ze=0;for(let Ke=2;Ke>=0;Ke--){const We=De[Ke];let Ce;const Be=null!=We,Fe=0===Ke&&!xe&&!Be,je=Se[Ke];"symbol-value"===We||Fe?Ce=0!==je?be[Ke]/je:1:Be&&"proportional"!==We&&isFinite(We)&&(Ce=0!==je?We/je:1),null!=Ce&&(ve[Ke]=Ce,xe=Ce,ze=Math.max(ze,Math.abs(Ce)))}for(let Ke=2;Ke>=0;Ke--)null==ve[Ke]?ve[Ke]=xe:0===ve[Ke]&&(ve[Ke]=.001*ze)}for(let xe=2;xe>=0;xe--)ve[xe]/=ye;return(0,Q.d)(ve)}function me(De){return function he(De){return null!=De.isPrimitive}(De)&&(De=[De.width,De.depth,De.height]),ge(De)?null:"Symbol sizes may not be negative values"}function ge(De){if(Array.isArray(De)){for(const be of De)if(!ge(be))return!1;return!0}return null==De||De>=0}function _e(De,be,Se,ye=(0,Z.c)()){const ve=De||0,xe=be||0,ze=Se||0;return 0!==ve&&(0,G.o)(ye,ye,-ve/180*Math.PI),0!==xe&&(0,G.r)(ye,ye,xe/180*Math.PI),0!==ze&&(0,G.n)(ye,ye,ze/180*Math.PI),ye}function Ee(De,be,Se){if(null!=Se.minDemResolution)return Se.minDemResolution;const ye=(0,R.c9)(be),ve=(0,H.bf)(De)*ye,xe=(0,H.Ye)(De)*ye,ze=(0,H.Cb)(De)*(be.isGeographic?1:ye);return 0===ve&&0===xe&&0===ze?Se.minDemResolutionForPoints:.01*Math.max(ve,xe,ze)}},64538:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{W:()=>D}),(R=D||(D={}))[R.Recreate_Symbol=0]="Recreate_Symbol",R[R.Recreate_Graphics=1]="Recreate_Graphics",R[R.Fast_Update=2]="Fast_Update"},34062:(nt,Ae,v)=>{"use strict";v.r(Ae),v.d(Ae,{fetch:()=>De,gltfToEngineResources:()=>ye,parseUrl:()=>Se});var D=v(15861),R=v(83100),G=v(62208),Z=v(30217),Q=v(550),$=v(28347),W=v(43703),B=v(84161),H=v(28093),X=v(5548),te=v(60479),ae=v(79800),oe=v(63657),le=v(60490),de=v(9160),se=v(93831),re=v(96170),j=v(98496);class Y{constructor(Be,Fe,je,Re,He){this.name=Be,this.stageResources=Fe,this.lodThreshold=je,this.pivotOffset=Re,this.numberOfVertices=He}}var ee=v(98973),ie=v(42743),J=v(52107),ce=v(81695),ue=v(16396),pe=v(28523),he=v(79331),me=v(67969),ge=v(35995),_e=v(63470),Ee=v(9554);function De(Ce,Be){return be.apply(this,arguments)}function be(){return(be=(0,D.Z)(function*(Ce,Be){const Fe=Se((0,R.pJ)(Ce));if("wosr"===Fe.fileType){const Me=yield Be.cache?Be.cache.loadWOSR(Fe.url,Be):(0,ee.zD)(Fe.url,Be),{engineResources:Ne,referenceBoundingBox:Xe}=(0,ee.p2)(Me,Be);return{lods:Ne,referenceBoundingBox:Xe,isEsriSymbolResource:!1,isWosr:!0}}const je=yield Be.cache?Be.cache.loadGLTF(Fe.url,Be,Be.usePBR):(0,se.Q)(new de.C(Be.streamDataRequester),Fe.url,Be,Be.usePBR),Re=(0,G.U2)(je.model.meta,"ESRI_proxyEllipsoid"),He=je.meta.isEsriSymbolResource&&(0,G.pC)(Re)&&je.meta.uri.includes("/RealisticTrees/");He&&!je.customMeta.esriTreeRendering&&(je.customMeta.esriTreeRendering=!0,We(je,Re));const Ie=je.meta.isEsriSymbolResource?{usePBR:Be.usePBR,isSchematic:!1,treeRendering:He,mrrFactors:[0,1,.2]}:{usePBR:Be.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},Ge={...Be.materialParamsMixin,treeRendering:He},{engineResources:Pe,referenceBoundingBox:Le}=ye(je,Ie,Ge,Be.skipHighLods&&null==Fe.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:Fe.specifiedLodIndex});return{lods:Pe,referenceBoundingBox:Le,isEsriSymbolResource:je.meta.isEsriSymbolResource,isWosr:!1}})).apply(this,arguments)}function Se(Ce){const Be=Ce.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return Be?{fileType:"gltf",url:Be[1],specifiedLodIndex:null!=Be[4]?Number(Be[4]):null}:Ce.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:Ce,specifiedLodIndex:null}:{fileType:"unknown",url:Ce,specifiedLodIndex:null}}function ye(Ce,Be,Fe,je){const Re=Ce.model,He=new Array,Ie=new Map,Ge=new Map,Pe=Re.lods.length,Le=(0,X.cS)();return Re.lods.forEach((Me,Ne)=>{const Xe=!0===je.skipHighLods&&(Pe>1&&0===Ne||Pe>3&&1===Ne)||!1===je.skipHighLods&&null!=je.singleLodIndex&&Ne!==je.singleLodIndex;if(Xe&&0!==Ne)return;const Ye=new Array;let Je=0;if(Me.parts.forEach(tt=>{const{geometry:et,vertexCount:qe}=function ve(Ce){const Be=function Ke(Ce,Be){switch(Be){case me.MX.TRIANGLES:return(0,re.nh)(Ce);case me.MX.TRIANGLE_STRIP:return(0,re.DA)(Ce);case me.MX.TRIANGLE_FAN:return(0,re.jX)(Ce)}}(Ce.indices||Ce.attributes.position.count,Ce.primitiveType),Fe=Ce.attributes.position.count,je=(0,le.gS)(te.ct,Fe);(0,ae.t)(je,Ce.attributes.position,Ce.transform);const Re=[[ue.T.POSITION,{data:je.typedBuffer,size:je.elementCount,exclusive:!0}]],He=[[ue.T.POSITION,Be]];if((0,G.pC)(Ce.attributes.normal)){const Ie=(0,le.gS)(te.ct,Fe);(0,Z.b)(xe,Ce.transform),(0,ae.a)(Ie,Ce.attributes.normal,xe),Re.push([ue.T.NORMAL,{data:Ie.typedBuffer,size:Ie.elementCount,exclusive:!0}]),He.push([ue.T.NORMAL,Be])}if((0,G.pC)(Ce.attributes.tangent)){const Ie=(0,le.gS)(te.ek,Fe);(0,Z.b)(xe,Ce.transform),(0,oe.t)(Ie,Ce.attributes.tangent,xe),Re.push([ue.T.TANGENT,{data:Ie.typedBuffer,size:Ie.elementCount,exclusive:!0}]),He.push([ue.T.TANGENT,Be])}if((0,G.pC)(Ce.attributes.texCoord0)){const Ie=(0,le.gS)(te.Eu,Fe);(0,ge.n)(Ie,Ce.attributes.texCoord0),Re.push([ue.T.UV0,{data:Ie.typedBuffer,size:Ie.elementCount,exclusive:!0}]),He.push([ue.T.UV0,Be])}if((0,G.pC)(Ce.attributes.color)){const Ie=(0,le.gS)(te.mc,Fe);if(4===Ce.attributes.color.elementCount)Ce.attributes.color instanceof te.ek?(0,oe.s)(Ie,Ce.attributes.color,255):Ce.attributes.color instanceof te.mc?(0,_e.c)(Ie,Ce.attributes.color):Ce.attributes.color instanceof te.v6&&(0,oe.s)(Ie,Ce.attributes.color,1/256);else{(0,_e.f)(Ie,255,255,255,255);const Ge=new te.ne(Ie.buffer,0,4);Ce.attributes.color instanceof te.ct?(0,ae.s)(Ge,Ce.attributes.color,255):Ce.attributes.color instanceof te.ne?(0,Ee.c)(Ge,Ce.attributes.color):Ce.attributes.color instanceof te.mw&&(0,ae.s)(Ge,Ce.attributes.color,1/256)}Re.push([ue.T.COLOR,{data:Ie.typedBuffer,size:Ie.elementCount,exclusive:!0}]),He.push([ue.T.COLOR,Be])}return{geometry:new J.Z(Re,He),vertexCount:Fe}}(tt);Ye.push(et),Je+=qe;const ot=et.boundingInfo;(0,G.pC)(ot)&&0===Ne&&((0,X.pp)(Le,ot.getBBMin()),(0,X.pp)(Le,ot.getBBMax()))}),Xe)return;const rt=new Y(Me.name,{textures:new Array,materials:new Array,geometries:Ye},Me.lodThreshold,[0,0,0],Je);He.push(rt),Me.parts.forEach(tt=>{const et=tt.material+(tt.attributes.normal?"_normal":"")+(tt.attributes.color?"_color":"")+(tt.attributes.texCoord0?"_texCoord0":"")+(tt.attributes.tangent?"_tangent":""),qe=Re.materials.get(tt.material),ot=(0,G.pC)(tt.attributes.texCoord0),ut=(0,G.pC)(tt.attributes.normal);if((0,G.Wi)(qe))return;const _t=function ze(Ce){switch(Ce){case"BLEND":return ie.JJ.Blend;case"MASK":return ie.JJ.Mask;case"OPAQUE":case null:case void 0:return ie.JJ.Opaque}}(qe.alphaMode);if(!Ie.has(et)){if(ot){const gr=(ar,Fr=!1)=>{if((0,G.pC)(ar)&&!Ge.has(ar)){const mr=Re.textures.get(ar);(0,G.pC)(mr)&&Ge.set(ar,new ce.x(mr.data,Fr?{...mr.parameters,preMultiplyAlpha:Fr}:mr.parameters))}};gr(qe.textureColor,_t!==ie.JJ.Opaque),gr(qe.textureNormal),gr(qe.textureOcclusion),gr(qe.textureEmissive),gr(qe.textureMetallicRoughness)}const Ct=qe.color[0]**(1/he.K),vt=qe.color[1]**(1/he.K),Lt=qe.color[2]**(1/he.K),jt=qe.emissiveFactor[0]**(1/he.K),$t=qe.emissiveFactor[1]**(1/he.K),Wt=qe.emissiveFactor[2]**(1/he.K),pr=(0,G.pC)(qe.textureColor)&&ot?Ge.get(qe.textureColor):null;Ie.set(et,new pe.Gp({...Be,transparent:_t===ie.JJ.Blend,customDepthTest:ie.Gv.Lequal,textureAlphaMode:_t,textureAlphaCutoff:qe.alphaCutoff,diffuse:[Ct,vt,Lt],ambient:[Ct,vt,Lt],opacity:qe.opacity,doubleSided:qe.doubleSided,doubleSidedType:"winding-order",cullFace:qe.doubleSided?ie.Vr.None:ie.Vr.Back,hasVertexColors:!!tt.attributes.color,hasVertexTangents:!!tt.attributes.tangent,normals:ut?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:(0,G.pC)(pr)?pr.id:void 0,colorMixMode:qe.colorMixMode,normalTextureId:(0,G.pC)(qe.textureNormal)&&ot?Ge.get(qe.textureNormal).id:void 0,textureAlphaPremultiplied:(0,G.pC)(pr)&&!!pr.params.preMultiplyAlpha,occlusionTextureId:(0,G.pC)(qe.textureOcclusion)&&ot?Ge.get(qe.textureOcclusion).id:void 0,emissiveTextureId:(0,G.pC)(qe.textureEmissive)&&ot?Ge.get(qe.textureEmissive).id:void 0,metallicRoughnessTextureId:(0,G.pC)(qe.textureMetallicRoughness)&&ot?Ge.get(qe.textureMetallicRoughness).id:void 0,emissiveFactor:[jt,$t,Wt],mrrFactors:[qe.metallicFactor,qe.roughnessFactor,Be.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:(0,j.i)(qe.colorTextureTransform),normalTextureTransformMatrix:(0,j.i)(qe.normalTextureTransform),occlusionTextureTransformMatrix:(0,j.i)(qe.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,j.i)(qe.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,j.i)(qe.metallicRoughnessTextureTransform),...Fe}))}if(rt.stageResources.materials.push(Ie.get(et)),ot){const Ct=vt=>{(0,G.pC)(vt)&&rt.stageResources.textures.push(Ge.get(vt))};Ct(qe.textureColor),Ct(qe.textureNormal),Ct(qe.textureOcclusion),Ct(qe.textureEmissive),Ct(qe.textureMetallicRoughness)}})}),{engineResources:He,referenceBoundingBox:Le}}const xe=(0,Q.c)();function We(Ce,Be){for(let Fe=0;Fe<Ce.model.lods.length;++Fe){const je=Ce.model.lods[Fe];for(const Re of je.parts){const He=Re.attributes.normal;if((0,G.Wi)(He))return;const Ie=Re.attributes.position,Ge=Ie.count,Pe=(0,H.c)(),Le=(0,H.c)(),Me=(0,H.c)(),Ne=(0,le.gS)(te.mc,Ge),Xe=(0,le.gS)(te.ct,Ge),Ye=(0,$.a)((0,W.c)(),Re.transform);for(let Je=0;Je<Ge;Je++){Ie.getVec(Je,Le),He.getVec(Je,Pe),(0,B.m)(Le,Le,Re.transform),(0,B.b)(Me,Le,Be.center),(0,B.C)(Me,Me,Be.radius);const rt=Me[2],tt=(0,B.l)(Me),et=Math.min(.45+.55*tt*tt,1);(0,B.C)(Me,Me,Be.radius),null!==Ye&&(0,B.m)(Me,Me,Ye),(0,B.n)(Me,Me),Fe+1!==Ce.model.lods.length&&Ce.model.lods.length>1&&(0,B.h)(Me,Me,Pe,rt>-1?.2:Math.min(-4*rt-3.8,1)),Xe.setVec(Je,Me),Ne.set(Je,0,255*et),Ne.set(Je,1,255*et),Ne.set(Je,2,255*et),Ne.set(Je,3,255)}Re.attributes.normal=Xe,Re.attributes.color=Ne}}}},75688:(nt,Ae,v)=>{"use strict";v.d(Ae,{$A:()=>G,EP:()=>W,QW:()=>B,j1:()=>H,mq:()=>Q,yY:()=>Z,zi:()=>$});var D=v(99770),R=v(6169);const G=Object.freeze({left:0,center:.5,right:1}),Z=Object.freeze({"bottom-left":(0,D.f)(0,0),bottom:(0,D.f)(.5,0),"bottom-right":(0,D.f)(1,0),left:(0,D.f)(0,.5),center:(0,D.f)(.5,.5),right:(0,D.f)(1,.5),"top-left":(0,D.f)(0,1),top:(0,D.f)(.5,1),"top-right":(0,D.f)(1,1)});function Q(X){switch(X){case"left":return R.vU.Left;case"right":return R.vU.Right;default:return R.vU.Center}}function $(X){switch(X){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function W(X){switch(X){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function B(X,te){switch(te){case"bottom":return"left"===X?"bottom-left":"right"===X?"bottom-right":"bottom";case"center":return X;case"top":return"left"===X?"top-left":"right"===X?"top-right":"top"}}function H(X){return"middle"===X?"center":X}},92690:(nt,Ae,v)=>{"use strict";v.d(Ae,{S_:()=>le,dO:()=>oe,km:()=>ae});var D=v(62208),R=v(43703),G=v(28093),Z=v(55915),Q=v(5548),$=v(25748),W=v(38114),B=v(81468),H=v(67225),X=v(96867);const te=(0,G.c)();function ae(de,se,re,j,Y,ee,ie,J){const ce=re?re.length:0,ue=de.clippingExtent;if((0,Z.KC)(se,te,de.elevationProvider.spatialReference),(0,D.pC)(ue)&&!(0,Q.BD)(ue,te))return null;(0,Z.KC)(se,te,de.renderCoordsHelper.spatialReference);const pe=de.localOriginFactory.getOrigin(te),he=new X.T({castShadow:!1,metadata:{layerUid:ee,graphicUid:ie,usesVerticalDistanceToGround:!0}});for(let me=0;me<ce;me++)he.addGeometry(re[me],j[me],R.I,pe,J);return{object:he,sampledElevation:(0,B.bD)(he,se,de.elevationProvider,de.renderCoordsHelper,Y)}}function oe(de,se,re){const j=de.elevationContext,Y=re.spatialReference;(0,Z.KC)(se,te,Y),j.centerPointInElevationSR=(0,W.Tx)(te[0],te[1],se.hasZ?te[2]:0,(0,D.pC)(Y)?Y:null)}function le(de){switch(de.type){case"point":return de;case"polygon":case"extent":return(0,H.zE)(de);case"polyline":{const se=de.paths[0];if(!se||0===se.length)return null;const re=(0,$.n8)(se,(0,$.ok)(se)/2);return(0,W.Tx)(re[0],re[1],re[2],de.spatialReference)}case"mesh":return de.origin}return null}},56244:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>G,t:()=>Z}),v(8314);var R=v(57521);function G($){switch($){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Z($,W){const B=(H,X,te=!1)=>({levels:H.map(ae=>{const oe=X(ae.tesselation);return te&&(0,R.Cr)(oe),{components:[{geometry:oe,material:W}],faceCount:oe.indexCount/3,minScreenSpaceRadius:ae.minScreenSpaceRadius}})});switch($){case"sphere":return B([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],H=>(0,R.mj)(.5,H,!0));case"cube":return B([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,R.IG)(1));case"cone":return B(Q,H=>(0,R.QL)(1,.5,H,!1),!0);case"inverted-cone":return B(Q,H=>(0,R.QL)(1,.5,H,!0),!0);case"cylinder":return B(Q,H=>(0,R.nb)(1,.5,H,[0,0,1],[0,0,.5]));case"tetrahedron":return B([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,R.AW)(1),!0);case"diamond":return B([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,R.B2)(1),!0);default:return}}const Q=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},97161:(nt,Ae,v)=>{"use strict";v.d(Ae,{BN:()=>le,IQ:()=>X,V9:()=>H,WU:()=>B,bz:()=>te,u:()=>oe});var D=v(94573),R=v(62208),G=v(48521),Z=v(56244),Q=v(2180),$=v(16396),W=v(47526);const B={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function H(re){return"web-style"===re.type?B:X(re.symbolLayers.toArray().map(j=>oe(re,j)))}function X(re){let j=0,Y=0,ee=0,ie=!1,J=0;const ce={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const ue of re)(0,R.Wi)(ue)||(j+=ue.primitivesPerFeature,Y+=ue.primitivesPerCoordinate,ee+=ue.drawCallsPerFeature,ce.bytesPerFeature+=ue.memory.bytesPerFeature,ce.bytesPerFeatureLabel+=ue.memory.bytesPerFeatureLabel,ce.bytesPerCoordinate+=ue.memory.bytesPerCoordinate,ce.resourceBytes+=ue.memory.resourceBytes,ce.draped.bytesPerFeature+=ue.memory.bytesPerFeature,ce.draped.bytesPerFeatureLabel+=ue.memory.bytesPerFeatureLabel,ce.draped.bytesPerCoordinate+=ue.memory.bytesPerCoordinate,ie=ie||ue.estimated,++J);return{primitivesPerFeature:j,primitivesPerCoordinate:Y,drawCallsPerFeature:ee,estimated:ie,memory:ce,numComplexities:J}}function te(re){const j=X(re);return j.numComplexities>0&&(j.primitivesPerFeature/=j.numComplexities,j.primitivesPerCoordinate/=j.numComplexities,j.drawCallsPerFeature/=j.numComplexities,j.memory.bytesPerFeature/=j.numComplexities,j.memory.bytesPerFeatureLabel/=j.numComplexities,j.memory.bytesPerCoordinate/=j.numComplexities,j.memory.resourceBytes/=j.numComplexities,j.memory.draped.bytesPerFeature/=j.numComplexities,j.memory.draped.bytesPerFeatureLabel/=j.numComplexities,j.memory.draped.bytesPerCoordinate/=j.numComplexities),j}const ae={};function oe(re,j){const Y=le(re,j),ee=(0,Q.eU)(j)?2:0;switch(j.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:ee,estimated:!1,memory:Y};case"fill":return"mesh-3d"===re.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:ee,estimated:!1,memory:Y}:(0,R.pC)(j.outline)&&j.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:Y}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:Y};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:Y};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:Y};case"object":return j.resource&&j.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:Y}:{...de(j.resource&&j.resource.primitive||G.S),memory:Y};case"path":{let ue=0,pe=0;switch(j.profile){case"circle":ue=10;break;case"quad":ue=4;break;default:return void(0,D.Bg)(j.profile)}switch(j.join){case"round":pe=3;break;case"miter":case"bevel":pe=1;break;default:return void(0,D.Bg)(j.join)}const he=2*ue,me=ue*pe*2;let ge=-2*me-he;switch(j.cap){case"none":break;case"butt":case"square":ge+=2*(ue-1);break;case"round":ge+=2*(2*ue*2+ue);break;default:return}return{primitivesPerFeature:ge,primitivesPerCoordinate:me+he,drawCallsPerFeature:0,estimated:!1,memory:Y}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Y};default:return}}function le(re,j){const Y="point-3d"===re.type;switch(j.type){case"extrude":return j.edges&&j.edges.size>0?se.EXTRUDE_EDGES:se.EXTRUDE;case"fill":return(0,R.pC)(j.outline)&&j.outline.size>0?se.FILL_OUTLINE:se.FILL;case"water":return se.FILL;case"line":return"round"===j.join?se.LINE_ROUND:se.LINE_MITER;case"path":switch(j.join){case"round":switch(j.profile){case"circle":return se.PATH_ROUND_CIRCLE;case"quad":return se.PATH_ROUND_QUAD;default:return void(0,D.Bg)(j.profile)}case"miter":case"bevel":switch(j.profile){case"circle":return se.PATH_MITER_CIRCLE;case"quad":return se.PATH_MITER_QUAD;default:return void(0,D.Bg)(j.profile)}default:return void(0,D.Bg)(j.join)}case"object":return Y?se.OBJECT_POINT:se.OBJECT_POLYGON;case"icon":case"text":return Y?se.ICON_POINT:se.ICON_POLYGON;default:return}}function de(re){let j=ae[re];if(j)return j;const Y=(0,Z.t)(re,null);return j={primitivesPerFeature:(0,W.VV)(Y.levels[0]).reduce((ee,ie)=>ee+ie.indices.get($.T.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},ae[re]=j,j}const se={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,resourceBytes:0,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,resourceBytes:0,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,resourceBytes:0,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,resourceBytes:0,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,resourceBytes:0,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,resourceBytes:0,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,resourceBytes:0,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,resourceBytes:0,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,resourceBytes:0,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,resourceBytes:0,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,resourceBytes:0,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,resourceBytes:0,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},98973:(nt,Ae,v)=>{"use strict";v.d(Ae,{p2:()=>me,zD:()=>Y});var D=v(15861),R=v(84792),G=v(59213),Z=v(27306),Q=v(26584),$=v(63290),W=v(62208),B=v(10699),H=v(10349),X=v(28093),te=v(5548),ae=v(70026),oe=v(42743),le=v(52107),de=v(81695),se=v(28523),re=v(67969);const j=$.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function Y(ye,ve){return ee.apply(this,arguments)}function ee(){return(ee=(0,D.Z)(function*(ye,ve){const xe=yield ie(ye,ve),ze=yield _e(xe.textureDefinitions,ve);let Ke=0;for(const We in ze)if(ze.hasOwnProperty(We)){const Ce=ze[We];Ke+=Ce?.image?Ce.image.width*Ce.image.height*4:0}return{resource:xe,textures:ze,size:Ke+(0,Z.Ul)(xe)}})).apply(this,arguments)}function ie(ye,ve){return J.apply(this,arguments)}function J(){return(J=(0,D.Z)(function*(ye,ve){const xe=(0,W.pC)(ve)&&ve.streamDataRequester;if(xe)return ce(ye,xe,ve);const ze=yield(0,G.q6)((0,R.default)(ye,(0,W.Wg)(ve)));if(!0===ze.ok)return ze.value.data;(0,B.r9)(ze.error),pe(ze.error)})).apply(this,arguments)}function ce(ye,ve,xe){return ue.apply(this,arguments)}function ue(){return(ue=(0,D.Z)(function*(ye,ve,xe){const ze=yield(0,G.q6)(ve.request(ye,"json",xe));if(!0===ze.ok)return ze.value;(0,B.r9)(ze.error),pe(ze.error.details.url)})).apply(this,arguments)}function pe(ye){throw new Q.Z("",`Request for object resource failed: ${ye}`)}function he(ye){const ve=ye.params,xe=ve.topology;let ze=!0;switch(ve.vertexAttributes||(j.warn("Geometry must specify vertex attributes"),ze=!1),ve.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const We=ve.faces;if(We){if(ve.vertexAttributes)for(const Ce in ve.vertexAttributes){const Be=We[Ce];Be&&Be.values?(null!=Be.valueType&&"UInt32"!==Be.valueType&&(j.warn(`Unsupported indexed geometry indices type '${Be.valueType}', only UInt32 is currently supported`),ze=!1),null!=Be.valuesPerElement&&1!==Be.valuesPerElement&&(j.warn(`Unsupported indexed geometry values per element '${Be.valuesPerElement}', only 1 is currently supported`),ze=!1)):(j.warn(`Indexed geometry does not specify face indices for '${Ce}' attribute`),ze=!1)}}else j.warn("Indexed geometries must specify faces"),ze=!1;break}default:j.warn(`Unsupported topology '${xe}'`),ze=!1}ye.params.material||(j.warn("Geometry requires material"),ze=!1);const Ke=ye.params.vertexAttributes;for(const We in Ke)Ke[We].values||(j.warn("Geometries with externally defined attributes are not yet supported"),ze=!1);return ze}function me(ye,ve){const xe=[],ze=[],Ke=[],We=[],Ce=ye.resource,Be=H.G.parse(Ce.version||"1.0","wosr");Se.validate(Be);const Fe=Ce.model.name,je=Ce.model.geometries,Re=Ce.materialDefinitions,He=ye.textures;let Ie=0;const Ge=new Map;for(let Pe=0;Pe<je.length;Pe++){const Le=je[Pe];if(!he(Le))continue;const Me=be(Le),Ne=Le.params.vertexAttributes,Xe=[];for(const ot in Ne){const ut=Ne[ot];Xe.push([ot,{data:ut.values,size:ut.valuesPerElement,exclusive:!0}])}const Ye=[];if("PerAttributeArray"!==Le.params.topology){const ot=Le.params.faces;for(const ut in ot)Ye.push([ut,ot[ut].values])}const Je=He&&He[Me.texture];if(Je&&!Ge.has(Me.texture)){const{image:ot,params:ut}=Je,_t=new de.x(ot,ut);We.push(_t),Ge.set(Me.texture,_t)}const rt=Ge.get(Me.texture),tt=rt?rt.id:void 0;let et=Ke[Me.material]?Ke[Me.material][Me.texture]:null;if(!et){const ot=Re[Me.material.substring(Me.material.lastIndexOf("/")+1)].params;1===ot.transparency&&(ot.transparency=0);const ut=Je&&Je.alphaChannelUsage,_t=ot.transparency>0||"transparency"===ut||"maskAndTransparency"===ut,Ct=Je?De(Je.alphaChannelUsage):void 0,vt={ambient:(0,X.d)(ot.diffuse),diffuse:(0,X.d)(ot.diffuse),opacity:1-(ot.transparency||0),transparent:_t,textureAlphaMode:Ct,textureAlphaCutoff:.33,textureId:tt,initTextureTransparent:!0,doubleSided:!0,cullFace:oe.Vr.None,colorMixMode:ot.externalColorMixMode||"tint",textureAlphaPremultiplied:!!Je&&!!Je.params.preMultiplyAlpha};(0,W.pC)(ve)&&ve.materialParamsMixin&&Object.assign(vt,ve.materialParamsMixin),et=new se.Gp(vt),Ke[Me.material]||(Ke[Me.material]={}),Ke[Me.material][Me.texture]=et}ze.push(et);const qe=new le.Z(Xe,Ye);Ie+=Ye.position?Ye.position.length:0,xe.push(qe)}return{engineResources:[{name:Fe,stageResources:{textures:We,materials:ze,geometries:xe},pivotOffset:Ce.model.pivotOffset,numberOfVertices:Ie,lodThreshold:null}],referenceBoundingBox:ge(xe)}}function ge(ye){const ve=(0,te.cS)();return ye.forEach(xe=>{const ze=xe.boundingInfo;(0,W.pC)(ze)&&((0,te.pp)(ve,ze.getBBMin()),(0,te.pp)(ve,ze.getBBMax()))}),ve}function _e(ye,ve){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,D.Z)(function*(ye,ve){const xe=[];for(const We in ye){const Ce=ye[We],Be=Ce.images[0].data;if(!Be){j.warn("Externally referenced texture data is not yet supported");continue}const Fe=Ce.encoding+";base64,"+Be,je="/textureDefinitions/"+We,Re="rgba"===Ce.channels?Ce.alphaChannelUsage||"transparency":"none",He={noUnpackFlip:!0,wrap:{s:re.e8.REPEAT,t:re.e8.REPEAT},preMultiplyAlpha:De(Re)!==oe.JJ.Opaque},Ie=(0,W.pC)(ve)&&ve.disableTextures?Promise.resolve(null):(0,ae.t)(Fe,ve);xe.push(Ie.then(Ge=>({refId:je,image:Ge,params:He,alphaChannelUsage:Re})))}const ze=yield Promise.all(xe),Ke={};for(const We of ze)Ke[We.refId]=We;return Ke})).apply(this,arguments)}function De(ye){switch(ye){case"mask":return oe.JJ.Mask;case"maskAndTransparency":return oe.JJ.MaskBlend;case"none":return oe.JJ.Opaque;default:return oe.JJ.Blend}}function be(ye){const ve=ye.params;return{id:1,material:ve.material,texture:ve.texture,region:ve.texture}}const Se=new H.G(1,2,"wosr")},92852:(nt,Ae,v)=>{"use strict";v.d(Ae,{Es:()=>se,I_:()=>X,W7:()=>de,qM:()=>ee});var D=v(26584),R=v(58817),G=v(63290),Z=v(61566),Q=v(16396);const $=G.Z.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function W(pe,he,me){let ge="",_e=0;for(;_e<me;){const Ee=pe[he+_e];if(Ee<128)ge+=String.fromCharCode(Ee),_e++;else if(Ee>=192&&Ee<224){if(_e+1>=me)throw new D.Z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");ge+=String.fromCharCode((31&Ee)<<6|63&pe[he+_e+1]),_e+=2}else if(Ee>=224&&Ee<240){if(_e+2>=me)throw new D.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");ge+=String.fromCharCode((15&Ee)<<12|(63&pe[he+_e+1])<<6|63&pe[he+_e+2]),_e+=3}else{if(!(Ee>=240&&Ee<248))throw new D.Z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(_e+3>=me)throw new D.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const De=(7&Ee)<<18|(63&pe[he+_e+1])<<12|(63&pe[he+_e+2])<<6|63&pe[he+_e+3];ge+=De>=65536?String.fromCharCode(55296+(De-65536>>10),56320+(1023&De)):String.fromCharCode(De),_e+=4}}}return ge}function B(pe,he){const me={byteOffset:0,byteCount:0,fields:Object.create(null)};let ge=0;for(let _e=0;_e<he.length;_e++){const Ee=he[_e],De=Ee.valueType||Ee.type;me.fields[Ee.property]=(0,J[De])(pe,ge),ge+=ie[De].BYTES_PER_ELEMENT}return me.byteCount=ge,me}function X(pe,he){return new ie[he.valueType](pe,he.byteOffset,he.count*he.valuesPerElement)}function oe(pe,he,me){if(he!==pe&&$.error(`Invalid ${me} buffer size\n expected: ${pe}, actual: ${he})`),he<pe)throw new D.Z("buffer-too-small","Binary buffer is too small",{expectedSize:pe,actualSize:he})}function de(pe,he){const me=B(pe,he&&he.header);let ge=me.byteCount;const _e={isDraco:!1,header:me,byteOffset:me.byteCount,byteCount:0,vertexAttributes:{}},Ee=me.fields,De=null!=Ee.vertexCount?Ee.vertexCount:Ee.count;for(const ye of he.ordering){if(!he.vertexAttributes[ye])continue;const ve={...he.vertexAttributes[ye],byteOffset:ge,count:De};_e.vertexAttributes[Y[ye]?Y[ye]:"_"+ye]=ve,ge+=ue(ve.valueType)*ve.valuesPerElement*De}const be=Ee.faceCount;if(he.faces&&be){_e.faces={};for(const ye of he.ordering){if(!he.faces[ye])continue;const ve={...he.faces[ye],byteOffset:ge,count:be};_e.faces[ye]=ve,ge+=ue(ve.valueType)*ve.valuesPerElement*be}}const Se=Ee.featureCount;if(he.featureAttributes&&he.featureAttributeOrder&&Se){_e.featureAttributes={};for(const ye of he.featureAttributeOrder){if(!he.featureAttributes[ye])continue;const ve={...he.featureAttributes[ye],byteOffset:ge,count:Se};_e.featureAttributes[ye]=ve,ge+=("UInt64"===ve.valueType?8:ue(ve.valueType))*ve.valuesPerElement*Se}}return oe(ge,pe.byteLength,"geometry"),_e.byteCount=ge-_e.byteOffset,_e}function se(pe,he){return pe&&pe.compressedAttributes&&"draco"===pe.compressedAttributes.encoding?function j(pe){const he={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const me of pe)switch(me){case"position":break;case"normal":he.normal=!0;break;case"uv0":he.uv0=!0;break;case"color":he.color=!0;break;case"uv-region":he.uvRegion=!0;break;case"feature-index":he.featureIndex=!0}return he}(pe.compressedAttributes.attributes):pe?function le(pe){return{isDraco:!1,isLegacy:!1,color:null!=pe.color,normal:null!=pe.normal,uv0:null!=pe.uv0,uvRegion:null!=pe.uvRegion,featureIndex:null!=pe.faceRange&&null!=pe.featureId}}(pe):function re(pe){const he={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const me of pe.ordering)if(pe.vertexAttributes[me])switch(me){case"position":break;case"normal":he.normal=!0;break;case"color":he.color=!0;break;case"uv0":he.uv0=!0;break;case"region":he.uvRegion=!0}return pe.featureAttributes&&pe.featureAttributeOrder&&(he.featureIndex=!0),he}(he)}const Y={position:Q.T.POSITION,normal:Q.T.NORMAL,color:Q.T.COLOR,uv0:Q.T.UV0,region:Q.T.UVREGION};function ee(pe,he,me){if("lepcc-rgb"===pe.encoding)return(0,Z.IT)(he);if("lepcc-intensity"===pe.encoding)return(0,Z.ti)(he);if(null!=pe.encoding&&""!==pe.encoding)throw new D.Z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");pe["attributeByteCounts "]&&!pe.attributeByteCounts&&($.warn("Warning: Trailing space in 'attributeByteCounts '."),pe.attributeByteCounts=pe["attributeByteCounts "]),"ObjectIds"===pe.ordering[0]&&pe.hasOwnProperty("objectIds")&&($.warn("Warning: Case error in objectIds"),pe.ordering[0]="objectIds");const ge=function ae(pe,he,me){const ge=null!=he.header?B(pe,he.header):{byteOffset:0,byteCount:0,fields:{count:me}},_e={header:ge,byteOffset:ge.byteCount,byteCount:0,entries:Object.create(null)};let Ee=ge.byteCount;for(let De=0;De<he.ordering.length;De++){const be=he.ordering[De],Se=(0,R.d9)(he[be]);if(Se.count=ge.fields.count,"String"===Se.valueType){if(Se.byteOffset=Ee,Se.byteCount=ge.fields[be+"ByteCount"],"UTF-8"!==Se.encoding)throw new D.Z("unsupported-encoding","Unsupported String encoding.",{encoding:Se.encoding})}else{if(!ce(Se.valueType))throw new D.Z("unsupported-value-type","Unsupported binary valueType",{valueType:Se.valueType});{const ye=ue(Se.valueType);Ee+=Ee%ye!=0?ye-Ee%ye:0,Se.byteOffset=Ee,Se.byteCount=ye*Se.valuesPerElement*Se.count}}Ee+=Se.byteCount,_e.entries[be]=Se}return _e.byteCount=Ee-_e.byteOffset,_e}(he,pe,me);oe(ge.byteOffset+ge.byteCount,he.byteLength,"attribute");const _e=ge.entries.attributeValues||ge.entries.objectIds;if(_e){if("String"===_e.valueType){const Ee=ge.entries.attributeByteCounts,De=X(he,Ee),be=function te(pe,he){return new Uint8Array(pe,he.byteOffset,he.byteCount)}(he,_e);return function H(pe,he,me){const ge=[];let _e,Ee,De=0;for(Ee=0;Ee<pe;Ee+=1){if(_e=he[Ee],_e>0){if(ge.push(W(me,De,_e-1)),0!==me[De+_e-1])throw new D.Z("string-array-error","Invalid string array: missing null termination.")}else ge.push(null);De+=_e}return ge}(Ee.count,De,be)}return X(he,_e)}throw new D.Z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const ie={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},J={Float32:(pe,he)=>new DataView(pe,0).getFloat32(he,!0),Float64:(pe,he)=>new DataView(pe,0).getFloat64(he,!0),UInt8:(pe,he)=>new DataView(pe,0).getUint8(he),Int8:(pe,he)=>new DataView(pe,0).getInt8(he),UInt16:(pe,he)=>new DataView(pe,0).getUint16(he,!0),Int16:(pe,he)=>new DataView(pe,0).getInt16(he,!0),UInt32:(pe,he)=>new DataView(pe,0).getUint32(he,!0),Int32:(pe,he)=>new DataView(pe,0).getInt32(he,!0)};function ce(pe){return ie.hasOwnProperty(pe)}function ue(pe){return ce(pe)?ie[pe].BYTES_PER_ELEMENT:0}},5590:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>Q,n:()=>B});var D=v(43703),R=v(28093),G=v(55915),Z=v(12080);function Q(H,X,te,ae){const oe=B(H,X,te),le=(0,D.c)();return(0,G.Bm)(te,oe,le,ae),le}function B(H,X,te){const ae=(0,R.c)(),le=2**(4*Math.ceil(Math.log(H[3])*Math.LOG2E/4)+1);if(te.isGeographic){const re=le/(0,Z.Iu)(te).radius*180/Math.PI,j=Math.round(H[1]/re),Y=Math.max(-90,Math.min(90,j*re)),ee=re/Math.cos((Math.abs(Y)-re/2)/180*Math.PI),ie=Math.round(H[0]/ee)*ee;ae[0]=ie,ae[1]=Y}else{const re=Math.round(H[0]/le),j=Math.round(H[1]/le);ae[0]=re*le,ae[1]=j*le}const se=Math.round((H[2]+X)/le);return ae[2]=se*le,ae}},42964:(nt,Ae,v)=>{"use strict";v.d(Ae,{Cx:()=>Hr,HV:()=>gr,Jf:()=>Je,Jx:()=>Me,OJ:()=>tt,T2:()=>Xe,VL:()=>Ss,WD:()=>Cs,X5:()=>De,Yb:()=>ye,a7:()=>jt,bf:()=>Ce,c$:()=>Jr,cr:()=>Ke,e8:()=>We,ei:()=>Ye,gI:()=>Fr,gn:()=>ot,hv:()=>Se,ix:()=>pr,jv:()=>ar,ns:()=>xe,p8:()=>qe,pD:()=>ze,tS:()=>be,tp:()=>Ne,uC:()=>$t,vH:()=>Qr,xe:()=>Ge,yS:()=>Ct,zW:()=>_t});var D=v(15861),R=v(84792),G=v(85931),Z=v(26584),Q=v(8314),$=v(62208),W=v(10699),B=v(55713),H=v(30217),X=v(550),te=v(28347),ae=v(43703),oe=v(48977),le=v(56729),de=v(78451),se=v(84161),re=v(28093),j=v(55915),Y=v(12080),ee=v(65234),ie=v(65401),J=v(37053),ce=v(96854),ue=v(59617),pe=v(92852),he=v(5590),me=v(2180),ge=v(9044),_e=v(93394);function Ee(qt){return qt&&parseInt(qt.substring(qt.lastIndexOf("/")+1,qt.length),10)}function De(qt){if((0,Q.Z)("disable-feature:i3s-draco")||!qt)return!1;for(const Ir of qt)for(const Sr of Ir.geometryBuffers)if("draco"===Sr.compressedAttributes?.encoding)return!0;return!1}function be(qt,Ir,Sr,fs){Sr.traverse(Ir,at=>Ke(qt,at.mbs)!==ze.OUTSIDE&&(fs(at),!0))}function Se(qt,Ir,Sr){let fs=0,at=0;for(let bt=0;bt<Ir.length&&fs<qt.length;bt++)qt[fs]===Ir[bt]&&(Sr(bt)&&(qt[at]=qt[fs],at++),fs++);qt.length=at}function ye(qt,Ir,Sr){let fs=0,at=0;for(;fs<Sr.length;)(0,G.$A)(qt,Sr[fs])>=0===Ir&&(Sr[at]=Sr[fs],at++),fs++;Sr.length=at}const ve=(0,ie.Ue)();function xe(qt,Ir){if(0===Ir.rotationScale[1]&&0===Ir.rotationScale[2]&&0===Ir.rotationScale[3]&&0===Ir.rotationScale[5]&&0===Ir.rotationScale[6]&&0===Ir.rotationScale[7])return ve[0]=(qt[0]-Ir.position[0])/Ir.rotationScale[0],ve[1]=(qt[1]-Ir.position[1])/Ir.rotationScale[4],ve[2]=(qt[2]-Ir.position[0])/Ir.rotationScale[0],ve[3]=(qt[3]-Ir.position[1])/Ir.rotationScale[4],ve}var ze,qt;function Ke(qt,Ir){const Sr=Ir[0],fs=Ir[1],at=Ir[3],bt=qt[0]-Sr,gt=Sr-qt[2],Gt=qt[1]-fs,fr=fs-qt[3],Ar=Math.max(bt,gt,0),us=Math.max(Gt,fr,0),as=Ar*Ar+us*us;return as>at*at?ze.OUTSIDE:as>0?ze.INTERSECTS_CENTER_OUTSIDE:-Math.max(bt,gt,Gt,fr)>at?ze.INSIDE:ze.INTERSECTS_CENTER_INSIDE}function We(qt,Ir,Sr){const fs=[],at=Sr&&Sr.missingFields,bt=Sr&&Sr.originalFields;for(const gt of qt){const Gt=gt.toLowerCase();let fr=!1;for(const Ar of Ir)if(Gt===Ar.name.toLowerCase()){fs.push(Ar.name),fr=!0,bt&&bt.push(gt);break}!fr&&at&&at.push(gt)}return fs}function Ce(qt,Ir,Sr,fs,at){return Be.apply(this,arguments)}function Be(){return(Be=(0,D.Z)(function*(qt,Ir,Sr,fs,at){if(0===Ir.length)return[];const bt=qt.attributeStorageInfo;if((0,$.pC)(qt.associatedLayer))try{return yield je(qt.associatedLayer,Ir,Sr,fs)}catch(gt){if(qt.associatedLayer.loaded)throw gt}if(bt){const gt=Fe(Ir,Sr,at);if((0,$.Wi)(gt))throw new Z.Z("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Gt=qt.parsedUrl.path;return(yield Promise.all(gt.map(fr=>Ie(Gt,bt,fr.node,fr.indices,fs).then(Ar=>{for(let us=0;us<fr.graphics.length;us++){const as=fr.graphics[us],Ps=Ar[us];if(as.attributes)for(const Fs in as.attributes)Fs in Ps||(Ps[Fs]=as.attributes[Fs]);as.attributes=Ps}return fr.graphics})))).flat()}throw new Z.Z("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")})).apply(this,arguments)}function Fe(qt,Ir,Sr){const fs=new Map,at=[],bt=Sr();for(const gt of qt){const Gt=gt.attributes[Ir];for(let fr=0;fr<bt.length;fr++){const Ar=bt[fr],us=Ar.featureIds.indexOf(Gt);if(us>=0){let as=fs.get(Ar.node);as||(as={node:Ar.node,indices:[],graphics:[]},at.push(as),fs.set(Ar.node,as)),as.indices.push(us),as.graphics.push(gt);for(let Ps=fr;Ps>0;Ps--)bt[Ps]=bt[Ps-1];bt[0]=Ar;break}}}return at}function je(qt,Ir,Sr,fs){return Re.apply(this,arguments)}function Re(){return(Re=(0,D.Z)(function*(qt,Ir,Sr,fs){Ir.sort((fr,Ar)=>fr.attributes[Sr]-Ar.attributes[Sr]);const at=Ir.map(fr=>fr.attributes[Sr]),bt=[],gt=We(fs,qt.fields,{originalFields:bt}),Gt=yield He(qt,at,gt);for(let fr=0;fr<Ir.length;fr++){const Ar=Ir[fr],us=Gt[fr],as={};if(Ar.attributes)for(const Ps in Ar.attributes)as[Ps]=Ar.attributes[Ps];for(let Ps=0;Ps<bt.length;Ps++)as[bt[Ps]]=us[gt[Ps]];Ar.attributes=as}return Ir})).apply(this,arguments)}function He(qt,Ir,Sr){const fs=qt.capabilities.query.maxRecordCount;if(null!=fs&&Ir.length>fs){const bt=(0,G.vr)(Ir,fs);return Promise.all(bt.map(gt=>He(qt,gt,Sr))).then(gt=>gt.flat())}const at=new ce.Z({objectIds:Ir,outFields:Sr,orderByFields:[qt.objectIdField]});return qt.queryFeatures(at).then(bt=>{if(bt&&bt.features&&bt.features.length===Ir.length)return bt.features.map(gt=>gt.attributes);throw new Z.Z("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Ie(qt,Ir,Sr,fs,at){return Ge(qt,Ir,Sr.resources.attributes,fs,at)}function Ge(qt,Ir,Sr,fs,at){const bt=[];for(const gt of Ir)gt&&at.includes(gt.name)&&bt.push({url:`${qt}/nodes/${Sr}/attributes/${gt.key}/0`,storageInfo:gt});return(0,W.as)(bt.map(gt=>(0,R.default)(gt.url,{responseType:"array-buffer"}).then(Gt=>(0,pe.qM)(gt.storageInfo,Gt.data)))).then(gt=>{const Gt=[];for(const fr of fs){const Ar={};for(let us=0;us<gt.length;us++)null!=gt[us].value&&(Ar[bt[us].storageInfo.name]=Me(gt[us].value,fr));Gt.push(Ar)}return Gt})}function Me(qt,Ir){if(!qt)return null;const Sr=qt[Ir];return(0,B.z3)(qt)?-32768===Sr?null:Sr:(0,B.Hx)(qt)?-2147483648===Sr?null:Sr:Sr!=Sr?null:Sr}function Ne(qt){const Ir=qt.store.indexCRS||qt.store.geographicCRS,Sr=void 0===Ir?qt.store.indexWKT:void 0;if(Sr){if(!qt.spatialReference)throw new Z.Z("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(Sr!==qt.spatialReference.wkt)throw new Z.Z("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const fs=Ir?new ee.Z(Ee(Ir)):qt.spatialReference;return fs.equals(qt.spatialReference)?qt.spatialReference:fs}function Xe(qt){const Ir=qt.store.vertexCRS||qt.store.projectedCRS,Sr=void 0===Ir?qt.store.vertexWKT:void 0;if(Sr){if(!qt.spatialReference)throw new Z.Z("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(Sr!==qt.spatialReference.wkt)throw new Z.Z("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const fs=Ir?new ee.Z(Ee(Ir)):qt.spatialReference;return fs.equals(qt.spatialReference)?qt.spatialReference:fs}function Ye(qt,Ir){return(0,$.Wi)(Ir)?"@null":Ir===(0,Y.rS)(Ir)?"@ECEF":qt.equals(Ir)?"":null!=Ir.wkid?"@"+Ir.wkid:null}function Je(qt,Ir,Sr){if(!(0,j.Up)(qt,Ir))throw new Z.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===Sr&&!function rt(qt,Ir){return qt.equals(Ir)||qt.isWGS84&&Ir.isWebMercator||qt.isWebMercator&&Ir.isWGS84}(qt,Ir))throw new Z.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function tt(qt,Ir,Sr){const fs=Ne(qt),at=Xe(qt);Je(fs,Ir,Sr),Je(at,Ir,Sr)}function qe(qt){if(null==qt.store||null==qt.store.defaultGeometrySchema||!function et(qt){return!(null!=qt.geometryType&&"triangles"!==qt.geometryType||null!=qt.topology&&"PerAttributeArray"!==qt.topology||null==qt.vertexAttributes||null==qt.vertexAttributes.position)}(qt.store.defaultGeometrySchema))throw new Z.Z("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:qt.parsedUrl.path})}function ot(qt,Ir){tt(qt,Ir.spatialReference,Ir.viewingMode)}function _t(qt){if(null==qt.store||null==qt.store.defaultGeometrySchema||!function ut(qt){return!(null==qt.geometryType||"points"!==qt.geometryType||null!=qt.topology&&"PerAttributeArray"!==qt.topology||null!=qt.encoding&&""!==qt.encoding&&"lepcc-xyz"!==qt.encoding||null==qt.vertexAttributes||null==qt.vertexAttributes.position)}(qt.store.defaultGeometrySchema))throw new Z.Z("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Ct(qt,Ir){Je(qt.spatialReference,Ir.spatialReference,Ir.viewingMode)}function Lt(qt){return"mesh-3d"===qt.type}function jt(qt){if(null==qt||!function vt(qt){return"simple"===qt.type||"class-breaks"===qt.type||"unique-value"===qt.type}(qt)||("unique-value"===qt.type||"class-breaks"===qt.type)&&null==qt.defaultSymbol)return!0;const Ir=qt.getSymbols();if(0===Ir.length)return!0;for(const Sr of Ir){if(!Lt(Sr)||0===Sr.symbolLayers.length)return!0;for(const fs of Sr.symbolLayers.items)if("fill"!==fs.type||(0,$.Wi)(fs.material)||(0,$.Wi)(fs.material.color)||"replace"!==fs.material.colorMixMode)return!0}return!1}(qt=ze||(ze={}))[qt.OUTSIDE=0]="OUTSIDE",qt[qt.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",qt[qt.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",qt[qt.INSIDE=3]="INSIDE";const $t=(0,me.$s)({color:[0,0,0,0],opacity:0});class Wt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function pr(qt){const Ir=new Wt;let Sr=!1,fs=!1;for(const at of qt.symbolLayers.items)if("fill"===at.type&&at.enabled){const bt=at.material,gt=at.edges;if((0,$.pC)(bt)&&!Sr){const Gt=bt.color,fr=(0,ge.F5)(bt.colorMixMode);Ir.material=(0,$.pC)(Gt)?{color:[Gt.r/255,Gt.g/255,Gt.b/255],alpha:Gt.a,colorMixMode:fr}:{color:[1,1,1],alpha:1,colorMixMode:ge.a9.Multiply},Ir.castShadows=at.castShadows,Sr=!0}(0,$.pC)(gt)&&!fs&&(Ir.edgeMaterial=(0,me.C8)(gt,{}),fs=!0)}return Ir.material||(Ir.material={color:[1,1,1],alpha:1,colorMixMode:ge.a9.Multiply}),Ir}function gr(qt,Ir){return(0|qt)+(0|Ir)|0}function ar(qt,Ir,Sr,fs,at=0){fs===(0,Y.rS)(fs)?Ir.isGeographic?function Lr(qt,Ir,Sr,fs){const at=(0,Y.Iu)(Sr),bt=1+Math.max(0,fs)/(at.radius+qt.center[2]);(0,se.s)(Ir.center,qt.center[0],qt.center[1],qt.center[2]+fs),(0,j.CM)(Ir.center,Sr,0,Ir.center,(0,Y.rS)(Sr),0,1),(0,oe.a)(Ir.quaternion,qt.quaternion),(0,oe.c)(ct,qt.quaternion),(0,se.s)(Or,0,0,1),(0,se.q)(Or,Or,ct),(0,se.s)(Or,qt.halfSize[0]*Math.abs(Or[0]),qt.halfSize[1]*Math.abs(Or[1]),qt.halfSize[2]*Math.abs(Or[2])),(0,se.g)(Or,Or,at.inverseFlattening),(0,se.a)(Ir.halfSize,qt.halfSize,Or),(0,se.g)(Ir.halfSize,Ir.halfSize,bt)}(qt,Sr,Ir,at):function Dr(qt,Ir,Sr,fs){(0,_e.$e)(qt,At),(0,se.s)(Ir.center,qt.center[0],qt.center[1],qt.center[2]+fs),(0,j.Bm)(Sr,Ir.center,Dt,(0,Y.rS)(Sr)),(0,se.s)(Ir.center,Dt[12],Dt[13],Dt[14]);const at=2*Math.sqrt(1+Dt[0]+Dt[5]+Dt[10]);ct[0]=(Dt[6]-Dt[9])/at,ct[1]=(Dt[8]-Dt[2])/at,ct[2]=(Dt[1]-Dt[4])/at,ct[3]=.25*at,(0,oe.m)(Ir.quaternion,ct,qt.quaternion),(0,oe.c)(ct,Ir.quaternion);let bt=0,gt=0,Gt=0;for(const fr of At)fr[2]+=fs,(0,j.CM)(fr,Sr,0,fr,(0,Y.rS)(Sr),0,1),(0,se.y)(Or,fr,Ir.center),(0,se.q)(Or,Or,ct),bt=Math.max(bt,Math.abs(Or[0])),gt=Math.max(gt,Math.abs(Or[1])),Gt=Math.max(Gt,Math.abs(Or[2]));(0,se.s)(Ir.halfSize,bt,gt,Gt)}(qt,Sr,Ir,at):Ir.isWGS84&&(fs.isWebMercator||(0,J.QM)(fs))?function rr(qt,Ir,Sr,fs,at){(0,se.c)(zt,Ir.center),zt[2]+=at;const bt=(0,Y.rS)(Sr);(0,j.CM)(zt,qt,0,zt,bt,0,1),Tr(bt,Ir,zt,Sr,fs)}(Ir,qt,fs,Sr,at):Ir.isWebMercator&&(0,J.QM)(fs)?function hr(qt,Ir,Sr,fs,at){(0,se.c)(zt,Ir.center),zt[2]+=at,Tr(qt,Ir,zt,Sr,fs)}(Ir,qt,fs,Sr,at):qt===Sr?(Sr.center[2]+=at,(0,j.CM)(Sr.center,Ir,0,Sr.center,fs,0,1)):((0,se.s)(Sr.center,qt.center[0],qt.center[1],qt.center[2]+at),(0,j.CM)(Sr.center,Ir,0,Sr.center,fs,0,1),(0,oe.a)(Sr.quaternion,qt.quaternion),(0,se.c)(Sr.halfSize,qt.halfSize))}function Fr(qt,Ir,Sr,fs,at){if((0,oe.a)(at.quaternion,qt.quaternion),fs===ue.JY.Global){(0,oe.c)(sr,qt.quaternion),(0,se.q)(mr,qt.center,sr),(0,se.w)(wt,mr),(0,se.x)(or,wt,qt.halfSize),(0,se.y)(or,wt,or);const bt=(0,se.l)(or);(0,se.a)(or,wt,qt.halfSize);const gt=(0,se.l)(or);if(bt<Sr)(0,se.c)(at.center,qt.center),(0,se.s)(mr,Sr,Sr,Sr),(0,se.a)(at.halfSize,qt.halfSize,mr);else{const Gt=gt>0?1+Ir/gt:1,fr=bt>0?1+Sr/bt:1,Ar=(fr+Gt)/2,us=(fr-Gt)/2;(0,se.g)(at.halfSize,wt,us),(0,se.z)(at.halfSize,at.halfSize,qt.halfSize,Ar),(0,se.g)(at.center,wt,Ar),(0,se.z)(at.center,at.center,qt.halfSize,us),(0,se.A)(mr,mr),(0,se.B)(at.center,at.center,mr),(0,se.q)(at.center,at.center,at.quaternion)}}else{const bt=(0,se.s)(mr,0,0,1);(0,se.z)(at.center,qt.center,bt,(Sr+Ir)/2),(0,oe.c)(sr,qt.quaternion),(0,se.q)(bt,bt,sr),(0,se.w)(bt,bt),(0,se.z)(at.halfSize,qt.halfSize,bt,(Sr-Ir)/2)}return at}const mr=(0,re.c)(),wt=(0,re.c)(),or=(0,re.c)(),sr=(0,de.a)(),Et=new Float64Array(24),St={data:Et,size:3},Ft=(0,re.c)(),zt=(0,re.c)(),dr=(0,X.c)();function Tr(qt,Ir,Sr,fs,at){const bt=(0,H.c)(dr,Ir.quaternion);for(let gt=0;gt<8;++gt){for(let Gt=0;Gt<3;++Gt)Ft[Gt]=Ir.halfSize[Gt]*(0!=(gt&1<<Gt)?-1:1);for(let Gt=0;Gt<3;++Gt){let fr=Sr[Gt];for(let Ar=0;Ar<3;++Ar)fr+=Ft[Ar]*bt[3*Ar+Gt];Et[3*gt+Gt]=fr}}(0,j.CM)(Et,qt,0,Et,fs,0,8),(0,_e.Qb)(St,at)}function Hr(qt,Ir,Sr,fs,at,bt){if(!bt||0===bt.length||(0,$.Wi)(Ir))return null;const gt=(0,he.c)(qt.mbs,at,Sr,Ir);let Gt;(0,te.a)(Kr,gt);let Ar=1/0,us=-1/0;if(bt.forEach(Fs=>(Fs=>{if("replace"!==Fs.type)return;const xs=Fs.geometry;if(!xs.hasZ)return;(0,ie.cS)(Kt);const Ws=xs.spatialReference||fs,yi=xs.rings.reduce((hn,oi)=>oi.reduce((kn,pn)=>((0,j.SH)(pn,Ws,Or,Ir),(0,se.m)(Or,Or,Kr),(0,ie.Ho)(Kt,Or),Math.min(Or[2],kn)),hn),1/0);(()=>{if(!Gt)if(Gt=At,(0,ie.cS)(tr),(0,$.pC)(qt.serviceObb)){ar(qt.serviceObb,Sr,_r,Ir,at),(0,_e.$e)(_r,Gt);for(const Fs of Gt)(0,se.m)(Fs,Fs,Kr),(0,ie.Ho)(tr,Fs)}else{const Fs=qt.mbs,xs=Fs[3];(0,j.SH)(Fs,Sr,Or,Ir),(0,se.m)(Or,Or,Kr),Or[2]+=at;for(let Ws=0;Ws<8;++Ws){const kn=Gt[Ws];(0,se.c)(kn,[Or[0]+(1&Ws?xs:-xs),Or[1]+(2&Ws?xs:-xs),Or[2]+(4&Ws?xs:-xs)]),(0,ie.Ho)(tr,kn)}}})(),(0,ie.kK)(tr,Kt)&&(Ar=Math.min(Ar,yi),us=Math.max(us,yi))})(Fs)),Ar===1/0)return null;const Ps=(Fs,xs,Ws)=>{(0,se.m)(Or,Ws,gt),Fs[xs+0]=Or[0],Fs[xs+1]=Or[1],Fs[xs+2]=Or[2],xs+=24,Ws[2]=Ar,(0,se.m)(Or,Ws,gt),Fs[xs+0]=Or[0],Fs[xs+1]=Or[1],Fs[xs+2]=Or[2],xs+=24,Ws[2]=us,(0,se.m)(Or,Ws,gt),Fs[xs+0]=Or[0],Fs[xs+1]=Or[1],Fs[xs+2]=Or[2]};for(let Fs=0;Fs<8;++Fs)Ps(gs.data,3*Fs,Gt[Fs]);return(0,_e.Qb)(gs)}function Qr(qt){return(0,$.pC)(qt)&&qt.halfSize[0]>=0}function Jr(qt){return qt[3]>=0}function Ss(qt){(0,$.pC)(qt)&&(qt.halfSize[0]=-1)}function Cs(qt){(0,$.pC)(qt)&&(qt[3]=-1)}const Dt=(0,ae.c)(),ct=(0,le.c)(),At=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Kt=(0,ie.Ue)(),tr=(0,ie.Ue)(),_r=(0,_e.Ue)(),Or=[0,0,0],gs={data:new Array(72),size:3},Kr=(0,ae.c)()},77926:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>Z,a:()=>G});var D=v(67857),R=v(91480);function G(Q){return(0,R.nn)(Q)&&Q.intersector===D.q7.PCL&&!!Q.target}function Z(Q){return(0,R.nn)(Q)&&Q.intersector===D.q7.I3S&&!!Q.target}},61566:(nt,Ae,v)=>{"use strict";v.d(Ae,{Gi:()=>W,IT:()=>ae,ti:()=>de});var D=v(26584);const R=!0;function Z(se,re,j){return{identifier:String.fromCharCode.apply(null,new Uint8Array(se,j+0,10)),version:re.getUint16(j+10,R),checksum:re.getUint32(j+12,R)}}function W(se){const re=new DataView(se,0);let j=0;const{identifier:Y,version:ee}=Z(se,re,j);if(j+=16,"LEPCC     "!==Y)throw new D.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new D.Z("lepcc-decode-error","Unknown version");const ie=function $(se,re){return{sizeLo:se.getUint32(re+0,R),sizeHi:se.getUint32(re+4,R),minX:se.getFloat64(re+8,R),minY:se.getFloat64(re+16,R),minZ:se.getFloat64(re+24,R),maxX:se.getFloat64(re+32,R),maxY:se.getFloat64(re+40,R),maxZ:se.getFloat64(re+48,R),errorX:se.getFloat64(re+56,R),errorY:se.getFloat64(re+64,R),errorZ:se.getFloat64(re+72,R),count:se.getUint32(re+80,R),reserved:se.getUint32(re+84,R)}}(re,j);if(j+=88,ie.sizeHi*2**32+ie.sizeLo!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");const J=new Float64Array(3*ie.count),ce=[],ue=[],pe=[],he=[];if(j=B(se,j,ce),j=B(se,j,ue),j=B(se,j,pe),j=B(se,j,he),j!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad length");let me=0,ge=0;for(let _e=0;_e<ce.length;_e++){ge+=ce[_e];let Ee=0;for(let De=0;De<ue[_e];De++){Ee+=pe[me];const be=he[me];J[3*me]=Math.min(ie.maxX,ie.minX+2*ie.errorX*Ee),J[3*me+1]=Math.min(ie.maxY,ie.minY+2*ie.errorY*ge),J[3*me+2]=Math.min(ie.maxZ,ie.minZ+2*ie.errorZ*be),me++}}return{errorX:ie.errorX,errorY:ie.errorY,errorZ:ie.errorZ,result:J}}function B(se,re,j){const Y=[];re=H(se,re,Y);const ee=[];for(let ie=0;ie<Y.length;ie++){ee.length=0,re=H(se,re,ee);for(let J=0;J<ee.length;J++)j.push(ee[J]+Y[ie])}return re}function H(se,re,j){const Y=new DataView(se,re),ee=Y.getUint8(0),ie=31&ee,J=!!(32&ee),ce=(192&ee)>>6;let ue=0;if(0===ce)ue=Y.getUint32(1,R),re+=5;else if(1===ce)ue=Y.getUint16(1,R),re+=3;else{if(2!==ce)throw new D.Z("lepcc-decode-error","Bad count type");ue=Y.getUint8(1),re+=2}if(J)throw new D.Z("lepcc-decode-error","LUT not implemented");const pe=Math.ceil(ue*ie/8),he=new Uint8Array(se,re,pe);let me=0,ge=0,_e=0;const Ee=-1>>>32-ie;for(let De=0;De<ue;De++){for(;ge<ie;)me|=he[_e]<<ge,ge+=8,_e+=1;j[De]=me&Ee,me>>>=ie,ge-=ie,ge+ie>32&&(me|=he[_e-1]>>8-ge)}return re+_e}function ae(se){const re=new DataView(se,0);let j=0;const{identifier:Y,version:ee}=Z(se,re,j);if(j+=16,"ClusterRGB"!==Y)throw new D.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new D.Z("lepcc-decode-error","Unknown version");const ie=function te(se,re){return{sizeLo:se.getUint32(re+0,R),sizeHi:se.getUint32(re+4,R),count:se.getUint32(re+8,R),colorMapCount:se.getUint16(re+12,R),lookupMethod:se.getUint8(re+14),compressionMethod:se.getUint8(re+15)}}(re,j);if(j+=16,ie.sizeHi*2**32+ie.sizeLo!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");if((2===ie.lookupMethod||1===ie.lookupMethod)&&0===ie.compressionMethod){if(3*ie.colorMapCount+ie.count+j!==se.byteLength||ie.colorMapCount>256)throw new D.Z("lepcc-decode-error","Bad count");const J=new Uint8Array(se,j,3*ie.colorMapCount),ce=new Uint8Array(se,j+3*ie.colorMapCount,ie.count),ue=new Uint8Array(3*ie.count);for(let pe=0;pe<ie.count;pe++){const he=ce[pe];ue[3*pe]=J[3*he],ue[3*pe+1]=J[3*he+1],ue[3*pe+2]=J[3*he+2]}return ue}if(0===ie.lookupMethod&&0===ie.compressionMethod){if(3*ie.count+j!==se.byteLength||0!==ie.colorMapCount)throw new D.Z("lepcc-decode-error","Bad count");return new Uint8Array(se,j).slice()}if(ie.lookupMethod<=2&&1===ie.compressionMethod){if(j+3!==se.byteLength||1!==ie.colorMapCount)throw new D.Z("lepcc-decode-error","Bad count");const J=re.getUint8(j),ce=re.getUint8(j+1),ue=re.getUint8(j+2),pe=new Uint8Array(3*ie.count);for(let he=0;he<ie.count;he++)pe[3*he]=J,pe[3*he+1]=ce,pe[3*he+2]=ue;return pe}throw new D.Z("lepcc-decode-error","Bad method "+ie.lookupMethod+","+ie.compressionMethod)}function de(se){const re=new DataView(se,0);let j=0;const{identifier:Y,version:ee}=Z(se,re,j);if(j+=16,"Intensity "!==Y)throw new D.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new D.Z("lepcc-decode-error","Unknown version");const ie=function le(se,re){return{sizeLo:se.getUint32(re+0,R),sizeHi:se.getUint32(re+4,R),count:se.getUint32(re+8,R),scaleFactor:se.getUint16(re+12,R),bitsPerPoint:se.getUint8(re+14),reserved:se.getUint8(re+15)}}(re,j);if(j+=16,ie.sizeHi*2**32+ie.sizeLo!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");const J=new Uint16Array(ie.count);if(8===ie.bitsPerPoint){if(ie.count+j!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");const ce=new Uint8Array(se,j,ie.count);for(let ue=0;ue<ie.count;ue++)J[ue]=ce[ue]*ie.scaleFactor}else if(16===ie.bitsPerPoint){if(2*ie.count+j!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");const ce=new Uint16Array(se,j,ie.count);for(let ue=0;ue<ie.count;ue++)J[ue]=ce[ue]*ie.scaleFactor}else{const ce=[];if(H(se,j,ce)!==se.byteLength)throw new D.Z("lepcc-decode-error","Bad size");for(let ue=0;ue<ie.count;ue++)J[ue]=ce[ue]*ie.scaleFactor}return J}},62600:(nt,Ae,v)=>{"use strict";var D,R,G;v.d(Ae,{L:()=>D,a:()=>R}),(G=D||(D={}))[G.RasterImage=0]="RasterImage",G[G.Features=1]="Features",function(G){G[G.WithRasterImage=0]="WithRasterImage",G[G.WithoutRasterImage=1]="WithoutRasterImage"}(R||(R={}))},27351:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>R,E:()=>G});var G,Z,D=v(65401);class R{constructor(Q,$,W,B=null){this.lij=[0,0,0],this.extent=(0,D.Ue)(),this.resolution=0,this.loadPriority=0,this.measures={visibility:G.VISIBLE_ON_SURFACE,screenRect:(0,D.Ue)(),distance:0,shouldSplit:!1},this.used=!1,B&&this.acquire(Q,$,W,B)}acquire(Q,$,W,B){this.tilingScheme=B,this.id=R.id(Q,$,W),this.lij[0]=Q,this.lij[1]=$,this.lij[2]=W,B.getExtent(Q,$,W,this.extent),this.resolution=B.resolutionAtLevel(Q)}release(){this.tilingScheme=null}getChildren(Q){const $=this.lij[0]+1,W=2*this.lij[1],B=2*this.lij[2];return Q?(Q[0].acquire($,W,B,this.tilingScheme),Q[1].acquire($,W+1,B,this.tilingScheme),Q[2].acquire($,W,B+1,this.tilingScheme),Q[3].acquire($,W+1,B+1,this.tilingScheme),Q):[new R($,W,B,this.tilingScheme),new R($,W+1,B,this.tilingScheme),new R($,W,B+1,this.tilingScheme),new R($,W+1,B+1,this.tilingScheme)]}copyMeasurementsFrom(Q){this.measures.visibility=Q.measures.visibility,this.measures.shouldSplit=Q.measures.shouldSplit,this.measures.distance=Q.measures.distance,(0,D.JG)(Q.measures.screenRect,this.measures.screenRect)}static id(Q,$,W){return`${Q}/${$}/${W}`}}(Z=G||(G={}))[Z.INVISIBLE=0]="INVISIBLE",Z[Z.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",Z[Z.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"},2180:(nt,Ae,v)=>{"use strict";v.d(Ae,{hM:()=>te,C8:()=>ae,$s:()=>oe,eU:()=>H});var D=v(91558),G=(v(8314),v(62208)),Z=v(23841),Q=v(4794),B=v(17803);function H(re){return re&&re.enabled&&(function W(re){return"extrude"===re.type}(re)||function $(re){return"fill"===re.type}(re))&&(0,G.pC)(re.edges)}function te(re,j){return ae(function X(re){return re&&re.enabled&&re.edges||null}(re),j)}function ae(re,j){if((0,G.Wi)(re))return null;const Y=(0,G.pC)(re.color)?(0,Q.b)(D.Z.toUnitRGBA(re.color)):(0,Q.f)(0,0,0,0),ee=(0,Z.F2)(re.size),ie=(0,Z.F2)(re.extensionLength);switch(re.type){case"solid":return oe({color:Y,size:ee,extensionLength:ie,...j});case"sketch":return function le(re){return{...se,...re,type:"sketch"}}({color:Y,size:ee,extensionLength:ie,...j});default:return}}function oe(re){return{...de,...re,type:"solid"}}const de={color:(0,Q.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:B.i.OPAQUE,hasSlicePlane:!1},se={color:(0,Q.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:B.i.OPAQUE,hasSlicePlane:!1}},9044:(nt,Ae,v)=>{"use strict";v.d(Ae,{F5:()=>Z,HB:()=>Q,a9:()=>G});var G,X,D=v(21286),R=v(62208);function Z(X){switch(X){case"multiply":default:return G.Multiply;case"ignore":return G.Ignore;case"replace":return G.Replace;case"tint":return G.Tint}}function Q(X,te,ae){if((0,R.Wi)(X)||te===G.Ignore)return ae[0]=255,ae[1]=255,ae[2]=255,void(ae[3]=255);const oe=(0,D.uZ)(Math.round(X[3]*W),0,W),le=0===oe||te===G.Tint?0:te===G.Replace?B:H;ae[0]=(0,D.uZ)(Math.round(X[0]*$),0,$),ae[1]=(0,D.uZ)(Math.round(X[1]*$),0,$),ae[2]=(0,D.uZ)(Math.round(X[2]*$),0,$),ae[3]=oe+le}(X=G||(G={}))[X.Multiply=1]="Multiply",X[X.Ignore=2]="Ignore",X[X.Replace=3]="Replace",X[X.Tint=4]="Tint";const $=255,W=85,B=W,H=2*W},24805:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>Z});var D=v(84161),R=v(28093),G=v(8834);class Z{constructor(W){this.renderCoordsHelper=W,this.frustum=(0,G.Ue)(),this._points=(0,G.Hf)(),this.lines=new Array(12),this._origin=(0,R.c)(),this._direction=(0,R.c)(),this._altitude=null;for(let B=0;B<12;B++)this.lines[B]={origin:null,direction:(0,R.c)(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(W){(0,G.q_)(W.viewMatrix,W.projectionMatrix,this.frustum,this._points),(0,D.c)(this._origin,W.eye),(0,D.c)(this._direction,W.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(W){for(let B=0;B<this._points.length;B++)(0,D.c)(this._points[B],W[B]);(0,G.Jp)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(W){return(0,G.hr)(this.frustum,W)}intersectsRay(W){return(0,G.Zr)(this.frustum,W)}intersectsLineSegment(W,B){return(0,G.rN)(this.frustum,W,B)}intersectsPoint(W){return(0,G.g8)(this.frustum,W)}_updateLines(){const W=this._points;for(let B=0;B<4;B++){const H=B+4;Q(this.lines[B],W[B],W[H]),Q(this.lines[B+4],W[B],3===B?W[0]:W[B+1]),Q(this.lines[B+8],W[H],3===B?W[4]:W[H+1])}}}function Q($,W,B){$.origin=W,$.endpoint=B,(0,D.r)($.direction,W,B)}Z.planePointIndices=G.xu,Z.nearFarLineIndices=[[G.NQ.NEAR_BOTTOM_LEFT,G.NQ.FAR_BOTTOM_LEFT],[G.NQ.NEAR_BOTTOM_RIGHT,G.NQ.FAR_BOTTOM_RIGHT],[G.NQ.NEAR_TOP_RIGHT,G.NQ.FAR_TOP_RIGHT],[G.NQ.NEAR_TOP_LEFT,G.NQ.FAR_TOP_LEFT]]},53929:(nt,Ae,v)=>{"use strict";v.d(Ae,{Fb:()=>Z,KO:()=>Q,sb:()=>G});var D=v(62208),R=v(88530);class G{constructor(W,B=null,H=0){this.array=W,this.spatialReference=B,this.offset=H}}function Z($){return"array"in $}function Q($,W,B="ground"){if((0,R.f)(W))return $.getElevation(W.x,W.y,W.z||0,W.spatialReference,B);if(Z(W)){let H=W.offset;return $.getElevation(W.array[H++],W.array[H++],W.array[H]||0,(0,D.Pt)(W.spatialReference,$.spatialReference),B)}return $.getElevation(W[0],W[1],W[2]||0,$.spatialReference,B)}},37810:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>Y});var D=v(94573),R=v(21286),G=v(28347),Z=v(43703),Q=v(84161),$=v(28093),W=v(55915),B=v(12080),H=v(5548),X=v(65401),te=v(8834),ae=v(13777),oe=v(90014),le=v(70562),de=v(59617),se=v(24229);const re=.5*Math.PI,j=re/Math.PI*180;class Y{constructor(ge){this._renderCoordsHelper=ge.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,$.c)(),direction:(0,$.c)()};for(let _e=0;_e<4;_e++)this._extent[_e]={origin:(0,$.c)(),direction:(0,$.c)(),cap:{next:null,direction:(0,$.c)()}},this._planes[_e]=(0,oe.Ue)();this._planes[te.Nu.NEAR]=(0,oe.Ue)(),this._planes[te.Nu.FAR]=(0,oe.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}update(ge,_e,Ee,De=!0){const be=this._extent;this._toRenderBoundingExtent(ge,_e,Ee),(0,Q.a)(this._center.origin,be[0].origin,be[2].origin),(0,Q.g)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),De||(0,Q.g)(this._center.direction,this._center.direction,-1);for(let Se=0;Se<4;Se++){const ye=be[Se];this._renderCoordsHelper.worldUpAtPosition(ye.origin,ye.direction);const ve=be[3===Se?0:Se+1];ye.cap.next=ve.origin,(0,Q.r)(ye.cap.direction,ye.origin,ve.origin),(0,oe.my)(ye.direction,ye.cap.direction,ye.origin,this._planes[Se]),De||(0,Q.g)(ye.direction,ye.direction,-1)}(0,oe.my)(be[0].cap.direction,be[1].cap.direction,be[0].origin,this._planes[te.Nu.NEAR]),De?(0,oe.tk)(this._planes[te.Nu.NEAR],this._planes[te.Nu.FAR]):((0,oe.JG)(this._planes[te.Nu.FAR],this._planes[te.Nu.NEAR]),(0,oe.tk)(this._planes[te.Nu.NEAR],this._planes[te.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(ge[0]-ge[2]),Math.abs(ge[1]-ge[3])),this._maxSpanSpatialReference=_e,this._minGlobalAltitude=.9*(0,B.Iu)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(ge,_e,Ee=!1){if(null==ge)return!1;if(this._renderCoordsHelper.viewingMode===de.JY.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?j:re*_e))return!0;if(null!=ge.altitude&&ge.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(ge)}if(0===this._maxSpan){const be=this._extent[0];return!(Ee||!ge.intersectsRay((0,le.re)(be.origin,be.direction)))}for(let be=0;be<this._extent.length;be++){const Se=this._extent[be];if(!Ee&&ge.intersectsRay((0,le.re)(Se.origin,Se.direction))||ge.intersectsLineSegment((0,ae.zk)(Se.origin,Se.cap.next,he),Se.cap.direction))return!0}const De=Ee?this._planes:this._planesWithoutFar;for(let be=0;be<ge.lines.length;be++){const Se=ge.lines[be];if((0,se.kD)(De,Se.origin,Se.endpoint,Se.direction))return!0}return!1}_toRenderBoundingExtentGlobal(ge,_e,Ee){(0,X.be)(ge,ie),ie[2]=Ee,(0,W.Bm)(_e,ie,J,this._renderCoordsHelper.spatialReference),(0,G.a)(ce,J),(0,H.cS)(ue);for(const{x0:be,x1:Se,y0:ye,y1:ve}of ee)for(let xe=0;xe<5;xe++){const ze=xe/4;ie[0]=(0,R.t7)(ge[be],ge[Se],ze),ie[1]=(0,R.t7)(ge[ye],ge[ve],ze),ie[2]=Ee,(0,W.SH)(ie,_e,ie,this._renderCoordsHelper.spatialReference),(0,Q.m)(ie,ie,ce),(0,H.pp)(ue,ie)}(0,Q.s)(this._extent[0].origin,ue[0],ue[1],ue[2]),(0,Q.s)(this._extent[1].origin,ue[3],ue[1],ue[2]),(0,Q.s)(this._extent[2].origin,ue[3],ue[4],ue[2]),(0,Q.s)(this._extent[3].origin,ue[0],ue[4],ue[2]);for(let be=0;be<4;++be)(0,Q.m)(this._extent[be].origin,this._extent[be].origin,J)}_toRenderBoundingExtentLocal(ge,_e,Ee){(0,W.dH)(ge,_e,pe,this._renderCoordsHelper.spatialReference),(0,Q.s)(this._extent[0].origin,pe[0],pe[1],Ee),(0,Q.s)(this._extent[1].origin,pe[2],pe[1],Ee),(0,Q.s)(this._extent[2].origin,pe[2],pe[3],Ee),(0,Q.s)(this._extent[3].origin,pe[0],pe[3],Ee)}_toRenderBoundingExtent(ge,_e,Ee){switch(this._renderCoordsHelper.viewingMode){case de.JY.Global:this._toRenderBoundingExtentGlobal(ge,_e,Ee);break;case de.JY.Local:this._toRenderBoundingExtentLocal(ge,_e,Ee);break;default:(0,D.Bg)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(ge){if((0,oe.jH)(ge.planes[te.Nu.NEAR],this._center.origin)<0&&(0,Q.e)(this._center.direction,ge.direction)<0)return!0;for(let _e=0;_e<4;_e++){const Ee=this._extent[_e];if((0,oe.jH)(ge.planes[te.Nu.NEAR],Ee.origin)<0&&(0,Q.e)(Ee.direction,ge.direction)<0)return!0}return!1}}const ee=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],ie=(0,$.c)(),J=(0,Z.c)(),ce=(0,Z.c)(),ue=(0,H.Ue)(),pe=(0,X.Ue)(),he=(0,ae.Ue)()},63416:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>G});var D=v(94530),R=v(30755);class G{constructor(Q,$){this._owner=$,this._properties={},this._afterDispatchHandle=null;for(const W in Q){const H=new D.e(Q[W],void 0,void 0,2,2);this._properties[W]={pool:H,acquired:[]}}this._afterDispatchHandle=(0,R.Fs)(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const Q in this._properties){const $=this._properties[Q];for(const W of $.acquired)(0,R.NC)(W)||$.pool.release(W);$.pool.destroy(),$.pool=null,$.acquired=null}this._properties=null,this._owner=null}get(Q){const $=this._owner._get(Q),W=this._properties[Q];let B=W.pool.acquire();for(W.acquired.push(B);B===$;)W.acquired.push(B),B=W.pool.acquire();return B}_release(){for(const Q in this._properties){const $=this._properties[Q];let W=0;for(const B of $.acquired)(0,R.NC)(B)?$.acquired[W++]=B:$.pool.release(B);$.acquired.length=W}}}},13986:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Y});var D=v(21286),R=v(62208),G=v(16730),Z=v(28347),Q=v(84161),$=v(55713);var X=v(55915),te=v(78172),ae=v(93088),oe=v(90014),le=v(34054),de=v(26242),se=v(88530),re=v(59617),j=v(86080);class Y{constructor(J,ce,ue,pe){this.viewingMode=J,this.spatialReference=ce,this.unitInMeters=ue,this._coordinateSystem=pe,this._tmpCoordinateSystem=(0,ae.Ue)(pe)}set extent(J){J&&(0,ae.qf)(this._coordinateSystem,J,this._coordinateSystem)}getAltitude(J){return(0,ae.id)(this._coordinateSystem,J)}setAltitude(J,ce,ue=J){return(0,ae.Is)(this._coordinateSystem,ue,ce,J)}setAltitudeOfTransformation(J,ce){(0,ae.rF)(this._coordinateSystem,ce,J,ce)}worldUpAtPosition(J,ce){return(0,ae.P0)(this._coordinateSystem,J,ce)}worldBasisAtPosition(J,ce,ue){return(0,ae.Kf)(this._coordinateSystem,J,ce,ue)}basisMatrixAtPosition(J,ce){const ue=this.worldBasisAtPosition(J,te.R.X,de.WM.get()),pe=this.worldBasisAtPosition(J,te.R.Y,de.WM.get()),he=this.worldBasisAtPosition(J,te.R.Z,de.WM.get());return(0,Z.s)(ce,ue[0],ue[1],ue[2],0,pe[0],pe[1],pe[2],0,he[0],he[1],he[2],0,0,0,0,1),ce}headingAtPosition(J,ce){const ue=this.worldUpAtPosition(J,de.WM.get()),pe=this.worldBasisAtPosition(J,te.R.Y,de.WM.get()),he=(0,le.cp)(ce,pe,ue);return(0,D.BV)(he)}intersectManifoldClosestSilhouette(J,ce,ue){return(0,ae.NE)(this._coordinateSystem,ce,this._tmpCoordinateSystem),(0,ae.ej)(this._tmpCoordinateSystem,J,ue),ue}intersectManifold(J,ce,ue){(0,ae.NE)(this._coordinateSystem,ce,this._tmpCoordinateSystem);const pe=de.WM.get();return(0,ae.BR)(this._tmpCoordinateSystem,J,pe)?(0,Q.c)(ue,pe):null}intersectInfiniteManifold(J,ce,ue){if(this.viewingMode===re.JY.Global)return this.intersectManifold(J,ce,ue);(0,ae.NE)(this._coordinateSystem,ce,this._tmpCoordinateSystem);const pe=this._tmpCoordinateSystem.value,he=de.WM.get();return(0,oe.BR)(pe.plane,J,he)?(0,Q.c)(ue,he):null}toRenderCoords(J,ce,ue){return(0,se.f)(J)?(0,X.KC)(J,ce,this.spatialReference):(0,X.SH)(J,ce,ue,this.spatialReference)}fromRenderCoords(J,ce,ue=null){return(0,se.f)(ce)?((0,R.pC)(ue)&&(ce.spatialReference=ue),(0,X.MT)(J,this.spatialReference,ce)):function H(ie){return function W(ie){return(0,$.xZ)(ie)&&ie.length>=3}(ie)||function B(ie){return((0,$.fS)(ie)||Array.isArray(ie))&&ie.length>=3}(ie)}(ce)?(0,X.SH)(J,this.spatialReference,ce,ue)?ce:null:(0,X.fA)(J,this.spatialReference,ce)}static create(J,ce){switch(J){case re.JY.Local:return new Y(re.JY.Local,ce,(0,G.c9)(ce),(0,ae.pb)());case re.JY.Global:return new Y(re.JY.Global,ce,1,(0,ae.pt)(ce))}}static renderUnitScaleFactor(J,ce){return ee(J)/ee(ce)}}function ee(ie){if((0,j.D)(ie,re.JY.Global))return 1;const J=(0,ae.E2)(!1,ie);return(0,G.c9)(J)}},91540:(nt,Ae,v)=>{"use strict";v.d(Ae,{nN:()=>ie,wu:()=>j});var D=v(17626),R=v(84792),G=v(14517),Z=v(85931),Q=v(26584),$=v(58817),W=v(62208),B=v(10699),H=v(77712),te=(v(90912),v(76898)),ae=v(2282);class oe{constructor(he){this.client=he,this._cancelled=!1,this.size=0,this.duration=0}}class le{constructor(he){this.typeWorkerQuota=he,this.tasks=new Array,this.numWorkers=0,this.statistics=new de}}class de{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class se{constructor(he,me,ge,_e){this._workerFunc=he,this._callbackFunc=me,this._maxTotalNumWorkers=ge,this._totalNumWorkers=0,this._clients=_e.map(Ee=>new le(Ee))}destroy(){this._clients.length=0}hasQuota(he){const me=this._clients[he];return!!me&&(this._totalNumWorkers<this._maxTotalNumWorkers||me.numWorkers+me.tasks.length<me.typeWorkerQuota)}push(he){const me=this._clients[he.client];me&&(this._totalNumWorkers<this._maxTotalNumWorkers?(me.numWorkers++,this._totalNumWorkers++,this._workerFunc(he,(ge,_e)=>this._taskCallback(ge,_e))):me.tasks.push(he))}cancel(he){this._taskFinished(he),he._cancelled=!0}_taskFinished(he){const me=this._clients[he.client];this._totalNumWorkers--,me.numWorkers--,me.statistics.requests++,me.statistics.size+=he.size||0,me.statistics.duration+=he.duration||0,me.statistics.speed=me.statistics.duration>0?me.statistics.size/me.statistics.duration:0,(0,ae.hu)(me.numWorkers>=0),this._next()}_next(){for(const he of this._clients)if(he&&he.numWorkers<he.typeWorkerQuota&&this._processQueue(he))return;for(const he of this._clients)if(he&&this._processQueue(he))return}_processQueue(he){for(;he.tasks.length>0;)if(this._workerFunc(he.tasks.shift(),(me,ge)=>this._taskCallback(me,ge)))return he.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(he,me){he._cancelled||(this._callbackFunc(he,me),this._taskFinished(he))}getStatsForType(he){const me=this._clients[he];return me?{quota:me.typeWorkerQuota,workers:me.numWorkers,queueSize:me.tasks.length,requestStats:me.statistics}:null}get test(){const he=this;return{set workerFunc(me){he._workerFunc=me}}}}var re=v(87091);let j=class extends G.Z{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(pe,he,me){this._loadQueue=new se((ge,_e)=>this._startLoading(ge,_e),(ge,_e)=>this._doneLoadingCB(ge,_e),pe,he),me&&(this._frameTask=me.registerTask(re.T8.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,W.hw)(this._frameTask),this._tasks.forEach(pe=>(0,W.IM)(pe.abortController)),this._loadQueue=(0,W.SC)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(pe){return this._loadQueue.hasQuota(pe)}request(pe,he,me,ge={}){const _e=(0,B.hh)();_e.__signal=(0,W.pC)(ge)?ge.signal:null;const Ee=this._createOrUpdateTask(pe,he,me,ge,_e);return(0,B.fu)(ge,()=>this._cancelRequest(Ee,_e)),_e.promise}_createTask(pe,he,me,ge,_e,Ee){const De=new J(pe,he,me,ge,_e);return this._updateTask(De,Ee),this._tasks.set(_e,De),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(De),De}_cancelRequest(pe,he){(0,Z.e$)(pe.resolvers,he),he.reject((0,B.zE)()),0===pe.resolvers.length&&(pe.status===ue.DOWNLOADING&&(pe.status=ue.CANCELLED,this._loadQueue.cancel(pe),pe.abortController?.abort(),pe.request=null,pe.abortController=null),pe.status=ue.CANCELLED,this._tasks.delete(pe.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(pe,he){pe.resolvers.push(he)}_createOrUpdateTask(pe,he,me,ge,_e){const Ee=function ce(pe,he,me){return`${pe}:${he}:${me}`}((0,W.pC)(ge)&&ge.uid||pe,he,me),De=this._tasks.get(Ee);return De?(this._updateTask(De,_e),De):this._createTask(pe,ge,he,me,Ee,_e)}_doneLoadingCB(pe,he){this._loadQueue&&((0,ae.hu)(pe.status===ue.DOWNLOADING),pe.status=ue.DOWNLOADED,this._frameTask?this._doneQueue.push({task:pe,err:he}):this._doneLoading(pe,he))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(pe){for(;!pe.done&&this._onLoadQueue.length>0;){const he=this._onLoadQueue.shift();(0,B.k_)(he.task.abortController),he.task.abortController=null,he.callback(he.task),pe.madeProgress()}for(;!pe.done&&this._doneQueue.length>0;){const he=this._doneQueue.shift();he.task.status!==ue.DOWNLOADED&&(he.err=he.err||(0,B.zE)()),this._doneLoading(he.task,he.err),pe.madeProgress()}}_doneLoading(pe,he){if(he&&!(0,B.D_)(he)&&pe.numRetries>0)return--pe.numRetries,void this._loadQueue.push(pe);let me=pe.result instanceof HTMLImageElement?0:pe.resolvers.length;for(const ge of pe.resolvers)if(he)(0,B.D_)(he)?ge.reject(he):ge.reject(new Q.Z("stream-data-loader:request-error",`Failed to request resource at '${pe.url}'. ${he}`,{url:pe.url,error:he}));else{--me;const _e=me<=0?pe.result:(0,$.d9)(pe.result);ge.resolve(_e)}this._tasks.delete(pe.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(pe,he){if(pe.status===ue.CANCELLED)return!1;let me,ge;switch(pe.startTime=performance.now(),pe.status=ue.DOWNLOADING,pe.docType){case"binary":ge="array-buffer",me=0;break;case"image":ge="image";break;case"image+type":ge="array-buffer";break;default:ge="json"}pe.abortController=new AbortController;const _e=pe.abortController.signal;pe.request=(0,R.default)(pe.url,{...pe.options,responseType:ge,timeout:me,signal:_e});let Ee=()=>{};const De=Se=>{pe.duration=performance.now()-pe.startTime,pe.size=Se instanceof ArrayBuffer?Se.byteLength:pe.size||0,pe.result=Se,this._frameTask?this._onLoadQueue.push({callback:he,task:pe}):(pe.abortController=null,he(pe))},be=Se=>{pe.status===ue.DOWNLOADING&&he(pe,Se),Ee()};return"image+type"!==pe.docType?(pe.request.then(Se=>De(Se.data),be),!0):(pe.request.then(Se=>{const ye=Se.data,ve=function ee(pe){if(pe.byteLength<2)return"unknown";const he=new Uint8Array(pe,0,pe.byteLength);return 137===he[0]&&80===he[1]?"image/png":71===he[0]&&73===he[1]?"image/gif":66===he[0]&&77===he[1]?"image/bmp":255===he[0]&&216===he[1]?"image/jpeg":"unknown"}(ye);if(ge="image",pe.size=ye.byteLength,"unknown"===ve)return pe.request=(0,R.default)(pe.url,{responseType:ge,timeout:me,signal:_e}),void pe.request.then(Ke=>De(Ke.data),be);const xe=new Blob([ye],{type:ve}),ze=window.URL.createObjectURL(xe);Ee=()=>window.URL.revokeObjectURL(ze),pe.request=(0,R.default)(ze,{responseType:ge,timeout:me,signal:_e}),pe.request.then(Ke=>De(new ie(Ke.data,ve,Ee)),be)},be),!0)}get test(){return{loadQueue:this._loadQueue}}};(0,D._)([(0,H.Cb)({readOnly:!0})],j.prototype,"updating",void 0),j=(0,D._)([(0,te.j)("esri.views.3d.support.StreamDataLoader")],j);class ie{constructor(he,me,ge){this.image=he,this.type=me,this.release=ge}get isOpaque(){return"image/jpeg"===this.type}}class J extends oe{constructor(he,me,ge,_e,Ee){super(_e),this.url=he,this.options=me,this.docType=ge,this.key=Ee,this.result=null,this.status=ue.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=0}}var ue,pe;(pe=ue||(ue={}))[pe.QUEUED=1]="QUEUED",pe[pe.DOWNLOADING=2]="DOWNLOADING",pe[pe.DOWNLOADED=3]="DOWNLOADED",pe[pe.CANCELLED=4]="CANCELLED"},19625:(nt,Ae,v)=>{"use strict";v.d(Ae,{U$:()=>Q});var D=v(60479),R=v(81096);class G{constructor(W,B){this.layout=W,this.buffer="number"==typeof B?new ArrayBuffer(B*W.stride):B;for(const H of W.fieldNames){const X=W.fields.get(H);this[H]=new X.constructor(this.buffer,X.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(W,B){const H=this[W];return H&&H.elementCount===B.ElementCount&&H.elementType===B.ElementType?H:null}slice(W,B){return new G(this.layout,this.buffer.slice(W*this.stride,B*this.stride))}copyFrom(W,B,H,X){const te=this.stride;if(te%4==0){const ae=new Uint32Array(W.buffer,B*te,X*te/4);new Uint32Array(this.buffer,H*te,X*te/4).set(ae)}else{const ae=new Uint8Array(W.buffer,B*te,X*te);new Uint8Array(this.buffer,H*te,X*te).set(ae)}}}class Z{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(W,B){return this._appendField(W,D.Eu,B),this}vec2f64(W,B){return this._appendField(W,D.q6,B),this}vec3f(W,B){return this._appendField(W,D.ct,B),this}vec3f64(W,B){return this._appendField(W,D.fP,B),this}vec4f(W,B){return this._appendField(W,D.ek,B),this}vec4f64(W,B){return this._appendField(W,D.Cd,B),this}mat3f(W,B){return this._appendField(W,D.gK,B),this}mat3f64(W,B){return this._appendField(W,D.ey,B),this}mat4f(W,B){return this._appendField(W,D.bj,B),this}mat4f64(W,B){return this._appendField(W,D.O1,B),this}vec4u8(W,B){return this._appendField(W,D.mc,B),this}f32(W,B){return this._appendField(W,D.ly,B),this}f64(W,B){return this._appendField(W,D.oS,B),this}u8(W,B){return this._appendField(W,D.D_,B),this}u16(W,B){return this._appendField(W,D.av,B),this}i8(W,B){return this._appendField(W,D.Hz,B),this}vec2i8(W,B){return this._appendField(W,D.Vs,B),this}vec2i16(W,B){return this._appendField(W,D.or,B),this}vec2u8(W,B){return this._appendField(W,D.xA,B),this}vec4u16(W,B){return this._appendField(W,D.v6,B),this}u32(W,B){return this._appendField(W,D.Nu,B),this}_appendField(W,B,H){const X=B.ElementCount*(0,R.n1)(B.ElementType);this.fields.set(W,{size:X,constructor:B,offset:this.stride,optional:H}),this.stride+=X,this.fieldNames.push(W)}alignTo(W){return this.stride=Math.floor((this.stride+W-1)/W)*W,this}hasField(W){return this.fieldNames.includes(W)}createBuffer(W){return new G(this,W)}createView(W){return new G(this,W)}clone(){const W=new Z;return W.stride=this.stride,W.fields=new Map,this.fields.forEach((B,H)=>W.fields.set(H,B)),W.fieldNames=this.fieldNames.slice(),W.BufferType=this.BufferType,W}}function Q(){return new Z}},4511:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>G});var D=v(67969),R=v(40852);function G($,W=0){const B=$.stride;return $.fieldNames.filter(H=>{const X=$.fields.get(H).optional;return!(X&&X.glPadding)}).map(H=>{const X=$.fields.get(H),te=X.constructor.ElementCount,ae=function Z($){const W=Q[$];if(W)return W;throw new Error("BufferType not supported in WebGL")}(X.constructor.ElementType);return new R.G(H,te,ae,X.offset,B,!(!X.optional||!X.optional.glNormalized),W)})}const Q={u8:D.g.UNSIGNED_BYTE,u16:D.g.UNSIGNED_SHORT,u32:D.g.UNSIGNED_INT,i8:D.g.BYTE,i16:D.g.SHORT,i32:D.g.INT,f32:D.g.FLOAT}},2975:(nt,Ae,v)=>{"use strict";v.d(Ae,{HL:()=>G,aj:()=>Z});var D=v(60479),R=v(19625);function G(te,ae){return ae.push(te.buffer),{buffer:te.buffer,layout:Q(te.layout)}}function Z(te){return function $(te){const ae=(0,R.U$)();return ae.stride=te.stride,ae.fieldNames=te.fieldNames,te.fields.forEach(oe=>ae.fields.set(oe[0],{...oe[1],constructor:H(oe[1].constructor)})),ae}(te.layout).createView(te.buffer)}function Q(te){const ae=new Array;return te.fields.forEach((oe,le)=>{const de={...oe,constructor:B(oe.constructor)};ae.push([le,de])}),{stride:te.stride,fields:ae,fieldNames:te.fieldNames}}const W=[D.ly,D.Eu,D.ct,D.ek,D.gK,D.bj,D.oS,D.q6,D.fP,D.Cd,D.ey,D.O1,D.D_,D.xA,D.ne,D.mc,D.av,D.TS,D.mw,D.v6,D.Nu,D.qt,D.G5,D.hu,D.Hz,D.Vs,D.P_,D.ir,D.o7,D.or,D.n1,D.zO,D.Jj,D.wA,D.PP,D.TN];function B(te){return`${te.ElementType}_${te.ElementCount}`}function H(te){return X.get(te)}const X=new Map;W.forEach(te=>X.set(B(te),te))},93605:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.Z{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};(0,D._)([(0,G.Cb)()],W.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"LABELS_SHOW_BORDER",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TEXT_SHOW_BASELINE",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TEXT_SHOW_BORDER",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"SHOW_POI",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"LINE_WIREFRAMES",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),W=(0,D._)([(0,$.j)("esri.views.3d.support.DebugFlags")],W);const B=new W},79020:(nt,Ae,v)=>{"use strict";v.d(Ae,{YU:()=>oe,c0:()=>me});var ue,ge,D=v(62208),R=v(55713),G=v(67831),Z=v(84161),Q=v(28093),$=v(4794),W=v(55915),B=v(12080),H=v(59617),X=v(42743),te=v(52107),ae=v(16396);function oe(ge,_e=null){const Ee=[],De=[];!function le(ge,_e,Ee){const{attributeData:{position:De},removeDuplicateStartEnd:be}=ge,Se=function ce(ge){const _e=ge.length;return ge[0]===ge[_e-3]&&ge[1]===ge[_e-2]&&ge[2]===ge[_e-1]}(De)&&be,ye=De.length/3-(Se?1:0),ve=new Array(2*(ye-1)),xe=Se?(0,R.tP)(De,0,De.length-3):De;let ze=0;for(let Ke=0;Ke<ye-1;Ke++)ve[ze++]=Ke,ve[ze++]=Ke+1;_e.push([ae.T.POSITION,{size:3,data:xe,exclusive:Se}]),Ee.push([ae.T.POSITION,ve])}(ge,De,Ee);const be=De[0][1].data,ye=new Array(Ee[0][1].length).fill(0);return function de(ge,_e,Ee){const De=ge.attributeData.mapPosition;(0,D.Wi)(De)||(Ee.push([ae.T.MAPPOS,Ee[0][1]]),_e.push([ae.T.MAPPOS,{size:3,data:De}]))}(ge,De,Ee),function se(ge,_e,Ee,De){(0,D.pC)(ge.attributeData.colorFeature)||(_e.push([ae.T.COLOR,{size:4,data:(0,D.Pt)(ge.attributeData.color,$.O)}]),Ee.push([ae.T.COLOR,De]))}(ge,De,Ee,ye),function Y(ge,_e,Ee,De){(0,D.pC)(ge.attributeData.sizeFeature)||(_e.push([ae.T.SIZE,{size:1,data:[(0,D.Pt)(ge.attributeData.size,1)]}]),Ee.push([ae.T.SIZE,De]))}(ge,De,Ee,ye),function re(ge,_e,Ee,De){(0,D.pC)(ge.attributeData.normal)&&(_e.push([ae.T.NORMAL,{size:3,data:ge.attributeData.normal}]),Ee.push([ae.T.NORMAL,De]))}(ge,De,Ee,ye),function j(ge,_e,Ee,De){const be=ge.attributeData.colorFeature;(0,D.Wi)(be)||(_e.push([ae.T.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([be])}]),Ee.push([ae.T.COLOR,De]))}(ge,De,Ee,ye),function ee(ge,_e,Ee,De){const be=ge.attributeData.sizeFeature;(0,D.Wi)(be)||(_e.push([ae.T.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([be])}]),Ee.push([ae.T.SIZEFEATUREATTRIBUTE,De]))}(ge,De,Ee,ye),function ie(ge,_e,Ee,De){const be=ge.attributeData.opacityFeature;(0,D.Wi)(be)||(_e.push([ae.T.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([be])}]),Ee.push([ae.T.OPACITYFEATUREATTRIBUTE,De]))}(ge,De,Ee,ye),function J(ge,_e,Ee,De){if((0,D.Wi)(ge.overlayInfo)||ge.overlayInfo.renderCoordsHelper.viewingMode!==H.JY.Global||!ge.overlayInfo.spatialReference.isGeographic)return;const be=new Float64Array(De.length),Se=(0,B.Iu)(ge.overlayInfo.spatialReference);for(let Ce=0;Ce<be.length;Ce+=3)(0,W.gH)(De,Ce,be,Ce,Se);const ye=De.length/3,ve=new Float32Array(ye+1);let xe=pe,ze=he,Ke=0,We=0;(0,Z.s)(xe,be[We++],be[We++],be[We++]),ve[0]=0;for(let Ce=1;Ce<ye+1;++Ce)Ce===ye&&(We=0),(0,Z.s)(ze,be[We++],be[We++],be[We++]),Ke+=(0,G.p)(xe,ze),ve[Ce]=Ke,[xe,ze]=[ze,xe];_e.push([ae.T.DISTANCETOSTART,{size:1,data:ve}]),Ee.push([ae.T.DISTANCETOSTART,Ee[0][1]])}(ge,De,Ee,be),new te.Z(De,Ee,X.MX.Line,_e)}(ge=ue||(ue={}))[ge.KEEP=0]="KEEP",ge[ge.REMOVE=1]="REMOVE";const pe=(0,Q.c)(),he=(0,Q.c)();function me(ge,_e){if((0,D.Wi)(ge)||0===ge.length)return[];const Ee=[];return ge.forEach(De=>{const Se=new Float64Array(3*De.length);De.forEach((ve,xe)=>{Se[3*xe+0]=ve[0],Se[3*xe+1]=ve[1],Se[3*xe+2]=ve[2]}),Ee.push({attributeData:{position:Se,normal:_e},removeDuplicateStartEnd:!1})}),Ee}},81805:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ch:()=>G,Hl:()=>$,_Z:()=>Q,uM:()=>W,vT:()=>R});var D=v(8782);const R=64,G=R/2,Z=G/5,Q=R/Z,$=.25;function W(B,H){return B.fromData(`${H}-marker`,()=>(0,D.cU)(H,R,G,Z))}},8782:(nt,Ae,v)=>{"use strict";v.d(Ae,{Ns:()=>$,Ph:()=>Q,cU:()=>W}),v(8314);var R=v(36161),G=v(81695),Z=v(67969);const Q=128,$=.5;function W(ie,J=Q,ce=J*$,ue=0){const pe=function B(ie,J=Q,ce=J*$,ue=0){switch(ie){case"circle":default:return function H(ie,J){const ce=ie/2-.5;return ee(ie,j(ce,ce,J/2))}(J,ce);case"square":return function X(ie,J){return se(ie,J,!1)}(J,ce);case"cross":return function ae(ie,J,ce=0){return re(ie,J,!1,ce)}(J,ce,ue);case"x":return function oe(ie,J,ce=0){return re(ie,J,!0,ce)}(J,ce,ue);case"kite":return function te(ie,J){return se(ie,J,!0)}(J,ce);case"triangle":return function le(ie,J){return ee(ie,Y(ie/2,J,J/2))}(J,ce);case"arrow":return function de(ie,J){const ce=J,ue=J/2,pe=ie/2,he=.8*ce,me=j(pe,(ie-J)/2-he,Math.sqrt(he*he+ue*ue)),ge=Y(pe,ce,ue);return ee(ie,(_e,Ee)=>Math.max(ge(_e,Ee),-me(_e,Ee)))}(J,ce)}}(ie,J,ce,ue);return new G.x(pe,{mipmap:!1,wrap:{s:Z.e8.CLAMP_TO_EDGE,t:Z.e8.CLAMP_TO_EDGE},width:J,height:J,components:4,noUnpackFlip:!0})}function se(ie,J,ce){return ce&&(J/=Math.SQRT2),ee(ie,(ue,pe)=>{let he=ue-.5*ie+.25,me=.5*ie-pe-.75;if(ce){const ge=(he+me)/Math.SQRT2;me=(me-he)/Math.SQRT2,he=ge}return Math.max(Math.abs(he),Math.abs(me))-.5*J})}function re(ie,J,ce,ue=0){J-=ue,ce&&(J*=Math.SQRT2);const pe=.5*J;return ee(ie,(he,me)=>{let ge,_e=he-.5*ie,Ee=.5*ie-me-1;if(ce){const De=(_e+Ee)/Math.SQRT2;Ee=(Ee-_e)/Math.SQRT2,_e=De}return _e=Math.abs(_e),Ee=Math.abs(Ee),ge=_e>Ee?_e>pe?Math.sqrt((_e-pe)*(_e-pe)+Ee*Ee):Ee:Ee>pe?Math.sqrt(_e*_e+(Ee-pe)*(Ee-pe)):_e,ge-=ue/2,ge})}function j(ie,J,ce){return(ue,pe)=>{const he=ue-ie,me=pe-J;return Math.sqrt(he*he+me*me)-ce}}function Y(ie,J,ce){const ue=Math.sqrt(J*J+ce*ce);return(pe,he)=>{const me=Math.abs(pe-ie)-ce,ge=he-ie+J/2+.75;return Math.max((J*me+ce*ge)/ue,-ge)}}function ee(ie,J){const ce=new Uint8Array(4*ie*ie);for(let ue=0;ue<ie;ue++)for(let pe=0;pe<ie;pe++){const he=pe+ie*ue;let me=J(pe,ue);me=me/ie+.5,(0,R.I)(me,ce,4*he)}return ce}},55745:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>Q,O:()=>Z});var D=v(62208),R=v(28093),G=v(55915);function Z(W,B,H){if((0,D.Wi)(W)||(0,D.Wi)(H))return!1;let X=!0;return $[0]=null!=W.xmin?W.xmin:0,$[1]=null!=W.ymin?W.ymin:0,$[2]=null!=W.zmin?W.zmin:0,X=X&&(0,G.CM)($,W.spatialReference,0,B,H,0,1),$[0]=null!=W.xmax?W.xmax:0,$[1]=null!=W.ymax?W.ymax:0,$[2]=null!=W.zmax?W.zmax:0,X=X&&(0,G.CM)($,W.spatialReference,0,B,H,3,1),null==W.xmin&&(B[0]=-1/0),null==W.ymin&&(B[1]=-1/0),null==W.zmin&&(B[2]=-1/0),null==W.xmax&&(B[3]=1/0),null==W.ymax&&(B[4]=1/0),null==W.zmax&&(B[5]=1/0),X}function Q(W,B,H){if((0,D.Wi)(W)||(0,D.Wi)(H))return!1;let X=!0;return $[0]=null!=W.xmin?W.xmin:0,$[1]=null!=W.ymin?W.ymin:0,$[2]=null!=W.zmin?W.zmin:0,X=X&&(0,G.CM)($,W.spatialReference,0,$,H,0,1),B[0]=$[0],B[1]=$[1],$[0]=null!=W.xmax?W.xmax:0,$[1]=null!=W.ymax?W.ymax:0,$[2]=null!=W.zmax?W.zmax:0,X=X&&(0,G.CM)($,W.spatialReference,0,$,H,0,1),B[2]=$[0],B[3]=$[1],null==W.xmin&&(B[0]=-1/0),null==W.ymin&&(B[1]=-1/0),null==W.xmax&&(B[2]=1/0),null==W.ymax&&(B[3]=1/0),X}const $=(0,R.c)()},26046:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bh:()=>W,eW:()=>H,iE:()=>B,u4:()=>$});var D=v(62208),R=v(23841),G=v(67831),Z=v(84161),Q=v(26242);function $(X,te,ae){return W(X,X.screenToRender(te,(0,R.Wv)(Q.WM.get())),ae)}function W(X,te,ae){const oe=(0,R.Wv)((0,G.c)(Q.WM.get(),te));if(oe[2]=0,!X.unprojectFromRenderScreen(oe,ae.origin))return null;const le=(0,R.Wv)((0,G.c)(Q.WM.get(),te));le[2]=1;const de=X.unprojectFromRenderScreen(le,Q.WM.get());return(0,D.Wi)(de)?null:((0,Z.b)(ae.direction,de,ae.origin),ae)}function B(X,te,ae){return H(X,X.screenToRender(te,(0,R.Wv)(Q.WM.get())),ae)}function H(X,te,ae){(0,Z.c)(ae.origin,X.eye);const oe=(0,Z.s)(Q.WM.get(),te[0],te[1],1),le=X.unprojectFromRenderScreen(oe,Q.WM.get());return(0,D.Wi)(le)?null:((0,Z.b)(ae.direction,le,ae.origin),ae)}},39135:(nt,Ae,v)=>{"use strict";var D,Z;v.d(Ae,{Bh:()=>D,NT:()=>G,Ty:()=>R}),(Z=D||(D={}))[Z.ELEVATION=0]="ELEVATION",Z[Z.BASEMAP=1]="BASEMAP",Z[Z.I3S_INDEX=2]="I3S_INDEX",Z[Z.I3S_DATA=3]="I3S_DATA",Z[Z.SYMBOLOGY=4]="SYMBOLOGY";const R=(()=>{const Z=new Array;return Z[D.ELEVATION]=10,Z[D.BASEMAP]=10,Z[D.I3S_INDEX]=10,Z[D.I3S_DATA]=10,Z[D.SYMBOLOGY]=5,Z})(),G=30},24229:(nt,Ae,v)=>{"use strict";v.d(Ae,{W8:()=>X,kD:()=>H});var D=v(99770),R=v(84161),G=v(28093),Z=v(90014);function H(de,se,re,j){return function le(de,se,re,j){j.clip[0]=0,j.clip[1]=re?j.len:Number.MAX_VALUE;for(let Y=0;Y<de.length;Y++)if(!oe(de[Y],se,j))return!1;return!0}(de,se,re,function ae(de,se,re,j){const Y=te;return de?(re&&j&&(Y.len=(0,R.i)(se,re)),(0,R.c)(Y.dir,de)):j?(Y.len=(0,R.i)(se,re),(0,R.b)(Y.dir,re,se),(0,R.g)(Y.dir,Y.dir,1/Y.len)):((0,R.b)(Y.dir,re,se),(0,R.n)(Y.dir,Y.dir)),Y}(j,se,re,!0))}function X(de,se,re,j){const Y=(0,R.e)(re,(0,R.b)(de,j,se));return(0,R.a)(de,se,(0,R.g)(de,re,Y))}const te={dir:(0,G.c)(),len:0,clip:(0,D.a)()};function oe(de,se,re){const j=(0,R.e)((0,Z.mJ)(de),re.dir),Y=-(0,Z.jH)(de,se);if(Y<0&&j>=0)return!1;if(j>-1e-6&&j<1e-6)return Y>0;if((Y<0||j<0)&&!(Y<0&&j<0))return!0;const ee=Y/j;return j>0?ee<re.clip[1]&&(re.clip[1]=ee):ee>re.clip[0]&&(re.clip[0]=ee),re.clip[0]<=re.clip[1]}},98943:(nt,Ae,v)=>{"use strict";v.d(Ae,{EU:()=>de,T:()=>H,ZA:()=>oe,_F:()=>X,bX:()=>ae,ek:()=>le,mw:()=>B,pG:()=>re,u1:()=>W,uV:()=>se});var D=v(21286),R=v(84161),G=v(28093);function W(ce){return Math.sqrt(Math.max(ce[0]*ce[0]+ce[4]*ce[4]+ce[8]*ce[8],ce[1]*ce[1]+ce[5]*ce[5]+ce[9]*ce[9],ce[2]*ce[2]+ce[6]*ce[6]+ce[10]*ce[10]))}function B(ce,ue){const pe=Math.sqrt(ue[0]*ue[0]+ue[4]*ue[4]+ue[8]*ue[8]),he=Math.sqrt(ue[1]*ue[1]+ue[5]*ue[5]+ue[9]*ue[9]),me=Math.sqrt(ue[2]*ue[2]+ue[6]*ue[6]+ue[10]*ue[10]);return(0,R.s)(ce,pe,he,me),ce}function H(ce,ue,pe){pe=pe||ce;const he=(0,R.e)(ce,ue);(0,R.s)(pe,ce[0]-he*ue[0],ce[1]-he*ue[1],ce[2]-he*ue[2]),(0,R.n)(pe,pe)}function X(ce,ue,pe){Math.abs(ce[0])>Math.abs(ce[1])?(0,R.s)(ue,0,1,0):(0,R.s)(ue,1,0,0),(0,R.f)(pe,ce,ue),(0,R.n)(ue,ue),(0,R.f)(ue,pe,ce),(0,R.n)(pe,pe)}function ae(ce,ue,pe,he,me,ge){const _e=ce+(ue-ce)*me;return _e+(pe+(he-pe)*me-_e)*ge}function oe(ce,ue,pe,he=(0,G.c)()){const me=(0,R.l)(ce),ge=(0,R.l)(ue),_e=(0,R.e)(ce,ue)/(me*ge);if(_e<.9999999999999999){const Ee=Math.acos(_e),De=((1-pe)*me+pe*ge)/Math.sin(Ee),be=De/me*Math.sin((1-pe)*Ee),Se=De/ge*Math.sin(pe*Ee);return(0,R.g)(ie,ce,be),(0,R.g)(J,ue,Se),(0,R.a)(he,ie,J)}return(0,R.h)(he,ce,ue,pe)}function le(ce,ue,pe,he=(0,G.c)(),me=(0,G.c)()){const ge=(0,R.l)(ce),_e=(0,R.l)(ue),Ee=(0,R.e)(ce,ue)/(ge*_e);if(Ee<.9999999999999999){const De=Math.acos(Ee),be=Math.sin(De),Se=Math.sin(pe*De),ye=Math.sin((1-pe)*De),ve=(1-pe)*ge+pe*_e;{const xe=ve/be,ze=xe/_e*Se;(0,R.g)(ie,ce,xe/ge*ye),(0,R.g)(J,ue,ze),(0,R.a)(he,ie,J)}{const xe=1/ge*(-Math.cos((1-pe)*De)*De*ve+ye*(-ge+_e));(0,R.g)(ie,ce,xe);const ze=1/_e*(Math.cos(pe*De)*De*ve+Se*(-ge+_e));(0,R.g)(J,ue,ze),(0,R.a)(me,ie,J),(0,R.g)(me,me,1/be)}return me}return(0,R.h)(he,ce,ue,pe),(0,R.b)(me,ue,ce),(0,R.n)(me,me),me}function de(ce,ue,pe){ce=(0,R.n)(ie,ce),ue=(0,R.n)(J,ue);const he=(0,D.ZF)((0,R.e)(ce,ue));if(pe){const me=(0,R.f)(ee,ce,ue);if((0,R.e)(me,pe)<0)return-he}return he}function se(ce){const ue=ce.length;return pe=>{if(pe<=ce[0][0])return ce[0][1];if(pe>=ce[ue-1][0])return ce[ue-1][1];let he=1;for(;pe>ce[he][0];)he++;const ge=ce[he][0],_e=(ge-pe)/(ge-ce[he-1][0]);return _e*ce[he-1][1]+(1-_e)*ce[he][1]}}function re(ce,ue,pe,he){(0,R.b)(j,ue,ce),(0,R.b)(Y,pe,ce),(0,R.f)(he,j,Y),(0,R.n)(he,he),he[3]=-(0,R.e)(ce,he)}const j=(0,G.c)(),Y=(0,G.c)(),ee=(0,G.c)(),ie=(0,G.c)(),J=(0,G.c)()},93394:(nt,Ae,v)=>{"use strict";v.d(Ae,{JF:()=>or,d9:()=>rr,Qb:()=>St,$e:()=>Ss,Ue:()=>sr,fn:()=>Dr,hZ:()=>Ft,pn:()=>Tr,n3:()=>hr,JH:()=>dr,xz:()=>Jr,q0:()=>Cs,t8:()=>Et,mr:()=>zt});var D=v(30217),R=v(550),G=v(48977),Z=v(56729),Q=v(78451),$=v(84161),W=v(14658),B=v(28093),X=(v(993),v(4794)),te=v(5548),ae=v(90014);const oe=1e-6,le=[0,0,0],de=[0,0,0];const j=[0,0,0],Y=[0,0,0],ee=[0,0,0],ie=[0,0,0],J=[0,0,0],ce=[0,0,0],ue=[0,0,0],pe=[0,0,0],ge=[0,0,0],Ee=[0,0],be=[0,0,0],Se=[0,0,0],ye=[0,0,0],ve=[0,0,0],xe=[0,0,0],ze=[0,0,0];function Ke(Dt,ct,At,Kt,tr,_r){if(jt(ct)<oe)return;vt(be,At,ct),vt(Se,Kt,ct),vt(ye,tr,ct),Ce(Dt,ct,Ee),xe[1]=Ee[0],ve[1]=Ee[1],ze[1]=ve[1]-xe[1];const Or=[At,Kt,tr],gs=[be,Se,ye];for(let Kr=0;Kr<3;++Kr){Ce(Dt,Or[Kr],Ee),xe[0]=Ee[0],ve[0]=Ee[1],Ce(Dt,gs[Kr],Ee),xe[2]=Ee[0],ve[2]=Ee[1],ze[0]=ve[0]-xe[0],ze[2]=ve[2]-xe[2];const qt=qe(ze);qt<_r.quality&&(Ct(_r.b0,Or[Kr]),Ct(_r.b1,ct),Ct(_r.b2,gs[Kr]),_r.quality=qt)}}const We=[0,0,0];function Ce(Dt,ct,At){const{data:Kt,size:tr}=Dt;At[0]=Number.POSITIVE_INFINITY,At[1]=Number.NEGATIVE_INFINITY;for(let _r=0;_r<Kt.length;_r+=tr){const Or=Kt[_r]*ct[0]+Kt[_r+1]*ct[1]+Kt[_r+2]*ct[2];At[0]=Math.min(At[0],Or),At[1]=Math.max(At[1],Or)}}function Fe(Dt,ct,At){Ct(At.center,Dt),_t(At.halfSize,ct,.5),At.quaternion[0]=0,At.quaternion[1]=0,At.quaternion[2]=0,At.quaternion[3]=1}const je=[0,0,0],Re=[0,0,0],He=[0,0,0],Ie=[0,0,0],Ge=[0,0,0],Pe=[0,0,0];function Me(Dt,ct,At,Kt,tr,_r){Ce(Dt,ct,Ee),tr[0]=Ee[0],_r[0]=Ee[1],Ce(Dt,At,Ee),tr[1]=Ee[0],_r[1]=Ee[1],Ce(Dt,Kt,Ee),tr[2]=Ee[0],_r[2]=Ee[1]}const Ne=[0,0,0],Xe=[1,0,0,0,1,0,0,0,1],Ye=[0,0,0];function Je(Dt,ct,At,Kt,tr,_r,Or){Xe[0]=Dt[0],Xe[1]=Dt[1],Xe[2]=Dt[2],Xe[3]=ct[0],Xe[4]=ct[1],Xe[5]=ct[2],Xe[6]=At[0],Xe[7]=At[1],Xe[8]=At[2],function pr(Dt,ct){const At=ct[0]+ct[4]+ct[8];if(At>0){let Kt=Math.sqrt(At+1);Dt[3]=.5*Kt,Kt=.5/Kt,Dt[0]=(ct[5]-ct[7])*Kt,Dt[1]=(ct[6]-ct[2])*Kt,Dt[2]=(ct[1]-ct[3])*Kt}else{let Kt=0;ct[4]>ct[0]&&(Kt=1),ct[8]>ct[3*Kt+Kt]&&(Kt=2);const tr=(Kt+1)%3,_r=(Kt+2)%3;let Or=Math.sqrt(ct[3*Kt+Kt]-ct[3*tr+tr]-ct[3*_r+_r]+1);Dt[Kt]=.5*Or,Or=.5/Or,Dt[3]=(ct[3*tr+_r]-ct[3*_r+tr])*Or,Dt[tr]=(ct[3*tr+Kt]+ct[3*Kt+tr])*Or,Dt[_r]=(ct[3*_r+Kt]+ct[3*Kt+_r])*Or}}(Or.quaternion,Xe),ot(Ye,Kt,tr),_t(Ye,Ye,.5),_t(Or.center,Dt,Ye[0]),_t(Ne,ct,Ye[1]),ot(Or.center,Or.center,Ne),_t(Ne,At,Ye[2]),ot(Or.center,Or.center,Ne),_t(Or.halfSize,_r,.5)}class tt{constructor(ct){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let Kt=0;this.minProj=new Float64Array(this.buffer,Kt,7),Kt+=56,this.maxProj=new Float64Array(this.buffer,Kt,7),Kt+=56;for(let Kr=0;Kr<7;++Kr)this.minVert[Kr]=new Float64Array(this.buffer,Kt,3),Kt+=24;for(let Kr=0;Kr<7;++Kr)this.maxVert[Kr]=new Float64Array(this.buffer,Kt,3),Kt+=24;for(let Kr=0;Kr<7;++Kr)this.minProj[Kr]=Number.POSITIVE_INFINITY,this.maxProj[Kr]=Number.NEGATIVE_INFINITY;const tr=new Array(7),_r=new Array(7),{data:Or,size:gs}=ct;for(let Kr=0;Kr<Or.length;Kr+=gs){let qt=Or[Kr];qt<this.minProj[0]&&(this.minProj[0]=qt,tr[0]=Kr),qt>this.maxProj[0]&&(this.maxProj[0]=qt,_r[0]=Kr),qt=Or[Kr+1],qt<this.minProj[1]&&(this.minProj[1]=qt,tr[1]=Kr),qt>this.maxProj[1]&&(this.maxProj[1]=qt,_r[1]=Kr),qt=Or[Kr+2],qt<this.minProj[2]&&(this.minProj[2]=qt,tr[2]=Kr),qt>this.maxProj[2]&&(this.maxProj[2]=qt,_r[2]=Kr),qt=Or[Kr]+Or[Kr+1]+Or[Kr+2],qt<this.minProj[3]&&(this.minProj[3]=qt,tr[3]=Kr),qt>this.maxProj[3]&&(this.maxProj[3]=qt,_r[3]=Kr),qt=Or[Kr]+Or[Kr+1]-Or[Kr+2],qt<this.minProj[4]&&(this.minProj[4]=qt,tr[4]=Kr),qt>this.maxProj[4]&&(this.maxProj[4]=qt,_r[4]=Kr),qt=Or[Kr]-Or[Kr+1]+Or[Kr+2],qt<this.minProj[5]&&(this.minProj[5]=qt,tr[5]=Kr),qt>this.maxProj[5]&&(this.maxProj[5]=qt,_r[5]=Kr),qt=Or[Kr]-Or[Kr+1]-Or[Kr+2],qt<this.minProj[6]&&(this.minProj[6]=qt,tr[6]=Kr),qt>this.maxProj[6]&&(this.maxProj[6]=qt,_r[6]=Kr)}for(let Kr=0;Kr<7;++Kr){let qt=tr[Kr];Ct(this.minVert[Kr],Or,qt),qt=_r[Kr],Ct(this.maxVert[Kr],Or,qt)}}}class et{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function qe(Dt){return Dt[0]*Dt[1]+Dt[0]*Dt[2]+Dt[1]*Dt[2]}function ot(Dt,ct,At){Dt[0]=ct[0]+At[0],Dt[1]=ct[1]+At[1],Dt[2]=ct[2]+At[2]}function ut(Dt,ct,At){Dt[0]=ct[0]-At[0],Dt[1]=ct[1]-At[1],Dt[2]=ct[2]-At[2]}function _t(Dt,ct,At){Dt[0]=ct[0]*At,Dt[1]=ct[1]*At,Dt[2]=ct[2]*At}function Ct(Dt,ct,At=0){Dt[0]=ct[At+0],Dt[1]=ct[At+1],Dt[2]=ct[At+2]}function vt(Dt,ct,At){const Kt=ct[0],tr=ct[1],_r=ct[2],Or=At[0],gs=At[1],Kr=At[2];Dt[0]=tr*Kr-_r*gs,Dt[1]=_r*Or-Kt*Kr,Dt[2]=Kt*gs-tr*Or}function Lt(Dt,ct){const At=ct[0]*ct[0]+ct[1]*ct[1]+ct[2]*ct[2];if(At>0){const Kt=1/Math.sqrt(At);Dt[0]=ct[0]*Kt,Dt[1]=ct[1]*Kt,Dt[2]=ct[2]*Kt}}function jt(Dt){return Dt[0]*Dt[0]+Dt[1]*Dt[1]+Dt[2]*Dt[2]}function $t(Dt,ct){const At=ct[0]-Dt[0],Kt=ct[1]-Dt[1],tr=ct[2]-Dt[2];return At*At+Kt*Kt+tr*tr}function Wt(Dt,ct){return Dt[0]*ct[0]+Dt[1]*ct[1]+Dt[2]*ct[2]}const gr=(0,Q.a)(),ar=(0,B.c)(),Fr=(0,B.c)(),wt=((0,X.c)(),(0,R.c)());class or{constructor(ct){this.buffer=new ArrayBuffer(56*ct),this.obbs=new Array(ct);for(let gs=0;gs<ct;gs++)this.obbs[gs]={center:(0,B.b)(this.buffer,56*gs+0),halfSize:(0,W.a)(this.buffer,56*gs+24),quaternion:(0,Z.a)(this.buffer,56*gs+36)}}}function sr(Dt=[0,0,0],ct=[-1,-1,-1],At=[0,0,0,1]){return{center:(0,B.a)(Dt),halfSize:(0,W.b)(ct),quaternion:(0,Z.b)(At)}}function rr(Dt){return sr(Dt.center,Dt.halfSize,Dt.quaternion)}function Et(Dt,ct){(0,$.c)(ct.center,Dt.center),(0,$.c)(ct.halfSize,Dt.halfSize),(0,G.a)(ct.quaternion,Dt.quaternion)}function St(Dt,ct){return function se(Dt,ct){const{data:At,size:Kt}=Dt,tr=At.length/Kt;if(tr<=0)return;const _r=new tt(Dt);ot(le,_r.minProj,_r.maxProj),_t(le,le,.5),ut(de,_r.maxProj,_r.minProj);const Or=qe(de),gs=new et;gs.quality=Or,tr<14&&(Dt={data:new Float64Array(_r.buffer,112,42),size:3});const Kr=[0,0,0],qt=[0,0,0],Ir=[0,0,0],Sr=[0,0,0],fs=[0,0,0],at=[0,0,0],bt=[0,0,0];switch(function re(Dt,ct,At,Kt,tr,_r,Or,gs,Kr,qt){return function me(Dt,ct,At){let Kt=$t(Dt.maxVert[0],Dt.minVert[0]),tr=0;for(let _r=1;_r<7;++_r){const Or=$t(Dt.maxVert[_r],Dt.minVert[_r]);Or>Kt&&(Kt=Or,tr=_r)}Ct(ct,Dt.minVert[tr]),Ct(At,Dt.maxVert[tr])}(Dt,Kt,tr),$t(Kt,tr)<oe?1:(ut(Or,Kt,tr),Lt(Or,Or),function _e(Dt,ct,At,Kt){const{data:tr,size:_r}=Dt;let Or=Number.NEGATIVE_INFINITY,gs=0;for(let Kr=0;Kr<tr.length;Kr+=_r){ge[0]=tr[Kr]-ct[0],ge[1]=tr[Kr+1]-ct[1],ge[2]=tr[Kr+2]-ct[2];const qt=At[0]*ge[0]+At[1]*ge[1]+At[2]*ge[2],Sr=ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2]-qt*qt/(At[0]*At[0]+At[1]*At[1]+At[2]*At[2]);Sr>Or&&(Or=Sr,gs=Kr)}return Ct(Kt,tr,gs),Or}(ct,Kt,Or,_r)<oe?2:(ut(gs,tr,_r),Lt(gs,gs),ut(Kr,_r,Kt),Lt(Kr,Kr),vt(At,gs,Or),Lt(At,At),Ke(ct,At,Or,gs,Kr,qt),0))}(_r,Dt,bt,Kr,qt,Ir,Sr,fs,at,gs)){case 1:return void Fe(le,de,ct);case 2:return void function Le(Dt,ct,At){Ct(je,ct),Math.abs(ct[0])>Math.abs(ct[1])&&Math.abs(ct[0])>Math.abs(ct[2])?je[0]=0:Math.abs(ct[1])>Math.abs(ct[2])?je[1]=0:je[2]=0,jt(je)<oe&&(je[0]=je[1]=je[2]=1),vt(Re,ct,je),Lt(Re,Re),vt(He,ct,Re),Lt(He,He),Me(Dt,ct,Re,He,Ie,Ge),ut(Pe,Ge,Ie),Je(ct,Re,He,Ie,Ge,Pe,At)}(Dt,Sr,ct)}(function he(Dt,ct,At,Kt,tr,_r,Or,gs,Kr){(function De(Dt,ct,At,Kt,tr){!function Be(Dt,ct,At,Kt,tr){const{data:_r,size:Or}=Dt;Ct(Kt,_r),Ct(tr,Kt),At[0]=Wt(We,ct),At[1]=At[0];for(let gs=Or;gs<_r.length;gs+=Or){const Kr=_r[gs]*ct[0]+_r[gs+1]*ct[1]+_r[gs+2]*ct[2];Kr<At[0]&&(At[0]=Kr,Ct(Kt,_r,gs)),Kr>At[1]&&(At[1]=Kr,Ct(tr,_r,gs))}}(Dt,ct,Ee,tr,Kt);const _r=Wt(At,ct);Ee[1]-oe<=_r&&(Kt[0]=void 0),Ee[0]+oe>=_r&&(tr[0]=void 0)})(Dt,ct,At,j,Y),void 0!==j[0]&&(ut(ee,j,At),Lt(ee,ee),ut(ie,j,Kt),Lt(ie,ie),ut(J,j,tr),Lt(J,J),vt(ce,ie,_r),Lt(ce,ce),vt(ue,J,Or),Lt(ue,ue),vt(pe,ee,gs),Lt(pe,pe),Ke(Dt,ce,_r,ie,ee,Kr),Ke(Dt,ue,Or,J,ie,Kr),Ke(Dt,pe,gs,ee,J,Kr)),void 0!==Y[0]&&(ut(ee,Y,At),Lt(ee,ee),ut(ie,Y,Kt),Lt(ie,ie),ut(J,Y,tr),Lt(J,J),vt(ce,ie,_r),Lt(ce,ce),vt(ue,J,Or),Lt(ue,ue),vt(pe,ee,gs),Lt(pe,pe),Ke(Dt,ce,_r,ie,ee,Kr),Ke(Dt,ue,Or,J,ie,Kr),Ke(Dt,pe,gs,ee,J,Kr))})(Dt,bt,Kr,qt,Ir,Sr,fs,at,gs),Me(Dt,gs.b0,gs.b1,gs.b2,Ie,Ge);const gt=[0,0,0];ut(gt,Ge,Ie),gs.quality=qe(gt),gs.quality<Or?Je(gs.b0,gs.b1,gs.b2,Ie,Ge,gt,ct):Fe(le,de,ct)}(Dt,ct=ct||sr()),ct}function Ft(Dt,ct){const At=(0,ae.jH)(ct,Dt.center),Kt=Jr(Dt,(0,ae.mJ)(ct));return At>Kt?1:At<-Kt?-1:0}function zt(Dt,ct){ct||(ct=(0,te.Ue)());const At=(0,D.c)(wt,Dt.quaternion),Kt=Dt.halfSize[0]*Math.abs(At[0])+Dt.halfSize[1]*Math.abs(At[3])+Dt.halfSize[2]*Math.abs(At[6]),tr=Dt.halfSize[0]*Math.abs(At[1])+Dt.halfSize[1]*Math.abs(At[4])+Dt.halfSize[2]*Math.abs(At[7]),_r=Dt.halfSize[0]*Math.abs(At[2])+Dt.halfSize[1]*Math.abs(At[5])+Dt.halfSize[2]*Math.abs(At[8]);return ct[0]=Dt.center[0]-Kt,ct[1]=Dt.center[1]-tr,ct[2]=Dt.center[2]-_r,ct[3]=Dt.center[0]+Kt,ct[4]=Dt.center[1]+tr,ct[5]=Dt.center[2]+_r,ct}function dr(Dt,ct){return(0,ae.jH)(ct,Dt.center)-Jr(Dt,(0,ae.mJ)(ct))}function hr(Dt,ct){return(0,ae.jH)(ct,Dt.center)+Jr(Dt,(0,ae.mJ)(ct))}function Tr(Dt,ct){return Ft(Dt,ct[0])<=0&&Ft(Dt,ct[1])<=0&&Ft(Dt,ct[2])<=0&&Ft(Dt,ct[3])<=0&&Ft(Dt,ct[4])<=0&&Ft(Dt,ct[5])<=0}function Dr(Dt,ct,At,Kt=0){(0,G.c)(gr,Dt.quaternion),(0,$.b)(ar,ct,Dt.center);const tr=(0,$.q)(ar,ar,gr),_r=(0,$.q)(Fr,At,gr);let Or=-1/0,gs=1/0;for(let Kr=0;Kr<3;Kr++)if(Math.abs(_r[Kr])>1e-6){const qt=(Kt+Dt.halfSize[Kr]-tr[Kr])/_r[Kr],Ir=(-Kt-Dt.halfSize[Kr]-tr[Kr])/_r[Kr];Or=Math.max(Or,Math.min(qt,Ir)),gs=Math.min(gs,Math.max(qt,Ir))}else if(tr[Kr]>Dt.halfSize[Kr]+Kt||tr[Kr]<-Dt.halfSize[Kr]-Kt)return!1;return Or<=gs}function Jr(Dt,ct){(0,G.c)(gr,Dt.quaternion),(0,$.q)(ar,ct,gr);const At=Dt.halfSize;return Math.abs(ar[0]*At[0])+Math.abs(ar[1]*At[1])+Math.abs(ar[2]*At[2])}function Ss(Dt,ct){for(let At=0;At<8;++At){const Kt=ct[At];Kt[0]=1&At?-Dt.halfSize[0]:Dt.halfSize[0],Kt[1]=2&At?-Dt.halfSize[1]:Dt.halfSize[1],Kt[2]=4&At?-Dt.halfSize[2]:Dt.halfSize[2],(0,$.q)(Kt,Kt,Dt.quaternion),(0,$.a)(Kt,Kt,Dt.center)}}function Cs(Dt){return(0,$.u)(Dt.halfSize)}(()=>{const Dt=new Int8Array(162);let ct=0;const At=Kt=>{for(let tr=0;tr<Kt.length;tr++)Dt[ct+tr]=Kt[tr];ct+=6};At([6,2,3,1,5,4]),At([0,2,3,1,5,4]),At([0,2,3,7,5,4]),At([0,1,3,2,6,4]),At([0,1,3,2,0,0]),At([0,1,5,7,3,2]),At([0,1,3,7,6,4]),At([0,1,3,7,6,2]),At([0,1,5,7,6,2]),At([0,1,5,4,6,2]),At([0,1,5,4,0,0]),At([0,1,3,7,5,4]),At([0,2,6,4,0,0]),At([0,0,0,0,0,0]),At([1,3,7,5,0,0]),At([2,3,7,6,4,0]),At([2,3,7,6,0,0]),At([2,3,1,5,7,6]),At([0,1,5,7,6,2]),At([0,1,5,7,6,4]),At([0,1,3,7,6,4]),At([4,5,7,6,2,0]),At([4,5,7,6,0,0]),At([4,5,1,3,7,6]),At([0,2,3,7,5,4]),At([6,2,3,7,5,4]),At([6,2,3,1,5,4])})()},41632:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>D,q:()=>R});const D={value:.5,readOnly:!0},R={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},90793:(nt,Ae,v)=>{"use strict";v.d(Ae,{T:()=>G,j:()=>Z});var D=v(67857),R=v(91480);function G(Q){return(0,R.nn)(Q)&&Q.intersector===D.q7.TERRAIN&&!!Q.target}function Z(Q){return(0,R.nn)(Q)&&Q.intersector===D.q7.OVERLAY&&!!Q.target}},61034:(nt,Ae,v)=>{"use strict";v.d(Ae,{$e:()=>$,Jk:()=>B,aV:()=>W});var $,X,D=v(21286),R=v(65401),G=v(75224),Z=v(42743),Q=v(30993);(X=$||($={}))[X.None=0]="None",X[X.ColorAndWater=1]="ColorAndWater",X[X.Highlight=2]="Highlight",X[X.Occluded=3]="Occluded",X[X.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor";class W{constructor(te,ae){this.index=te,this.renderTargets=ae,this._extent=(0,R.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,Q.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new H,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=te,this.validTargets=new Array(ae.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(te){return this.validTargets[te]?this.renderTargets.getTarget(te).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(te){const ae=this.renderTargets.getTarget(te===$.ColorAndWater?G.NH.Color:te===$.Highlight?G.NH.Highlight:te===$.ObjectAndLayerIdColor?G.NH.ObjectAndLayerIdColor:G.NH.Occluded);return ae?ae.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(G.NH.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(G.NH.Color):null}getNormalTexture(te){const ae=te===$.ColorAndWater?this.renderTargets.getTarget(G.NH.Water):null;return ae?ae.getTexture():null}draw(te,ae){const oe=this.computeRenderTargetValidityBitfield();for(const le of this.renderTargets.renderTargets)this.validTargets[le.type]=!(le.type===G.NH.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)&&te.drawTarget(this,le,ae);return oe^this.computeRenderTargetValidityBitfield()?Z.Yg.CHANGED:Z.Yg.UNCHANGED}computeRenderTargetValidityBitfield(){const te=this.validTargets;return+te[G.NH.Color]|+te[G.NH.ColorNoRasterImage]<<1|+te[G.NH.Highlight]<<2|+te[G.NH.Water]<<3|+te[G.NH.Occluded]<<4}setupGeometryViewsCyclical(te){this.setupGeometryViewsDirect();const ae=.001*te.range;if(this._extent[0]-ae<=te.min){const oe=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,R.cv)(this._extent,te.range,0,oe)}if(this._extent[2]+ae>=te.max){const oe=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,R.cv)(this._extent,-te.range,0,oe)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,R.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let te=0;te<this.canvasGeometries.numViews;te++){const ae=this.canvasGeometries.extents[te];if(ae[0]!==ae[2]&&ae[1]!==ae[3])return!0}return!1}applyViewport(te){te.setViewport(this.index===G.fu.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function B(X,te,ae){return Math.min((0,D.Sf)(Math.max(X,te)+256),ae)}class H{constructor(){this.extents=[(0,R.Ue)(),(0,R.Ue)(),(0,R.Ue)()],this.numViews=0}}},64835:(nt,Ae,v)=>{"use strict";v.d(Ae,{Rn:()=>ot,CB:()=>Je,Qi:()=>ut});var D=v(15861),R=v(17626),G=v(14517),Z=v(61885),Q=v(72392),$=v(88159),W=v(62208),B=v(77029),H=v(32917),X=v(28862),te=v(77712),le=(v(85931),v(90912),v(76898)),de=v(28347),se=v(84161),re=v(28093),j=v(59617),Y=v(62600),ee=v(93605),ie=v(75224),J=v(61034),ce=v(9545),ue=v(67969),pe=v(85775);class he{constructor(Ct,vt){this._size=(0,ce.c)(),this._fbo=null,this._fbo=new pe.X(Ct,{colorTarget:ue.Lm.TEXTURE,depthStencilTarget:ue.OU.NONE},{target:ue.No.TEXTURE_2D,pixelFormat:ue.VI.RGBA,dataType:ue.Br.UNSIGNED_BYTE,wrapMode:ue.e8.CLAMP_TO_EDGE,samplingMode:ue.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:vt,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=(0,W.M2)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(Ct,vt){this._size[0]=Ct,this._size[1]=vt,this._fbo.resize(this._size[0],this._size[1])}bind(Ct){Ct.bindFramebuffer(this._fbo)}generateMipMap(){const Ct=this._fbo.colorTexture;Ct.descriptor.hasMipmap&&Ct.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}var me=v(8314),ge=v(13934);class _e{constructor(Ct,vt,Lt,jt=!0){this.output=vt,this.type=Lt,this.valid=!1,this.lastUsed=1/0,this.fbo=new he(Ct,jt)}}class Ee{constructor(Ct){this.renderTargets=[new _e(Ct,ge.H.Color,ie.NH.Color),new _e(Ct,ge.H.Color,ie.NH.ColorNoRasterImage),new _e(Ct,ge.H.Highlight,ie.NH.Highlight,!1),new _e(Ct,ge.H.Normal,ie.NH.Water),new _e(Ct,ge.H.Color,ie.NH.Occluded)],(0,me.Z)("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new _e(Ct,ge.H.ObjectAndLayerIdColor,ie.NH.ObjectAndLayerIdColor))}getTarget(Ct){return this.renderTargets[Ct].fbo}dispose(){for(const Ct of this.renderTargets)Ct.fbo.dispose()}disposeRenderTargetMemory(){for(const Ct of this.renderTargets)Ct.fbo.disposeRenderTargetMemory()}validateUsageForTarget(Ct,vt,Lt){if(Ct)vt.lastUsed=Lt;else if(Lt-vt.lastUsed>De)vt.fbo.disposeRenderTargetMemory(),vt.lastUsed=1/0;else if(vt.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((Ct,vt)=>Ct+vt.fbo.gpuMemoryUsage,0)}}const De=1e3;var be=v(98361),Se=v(45323),ye=v(2286),ve=v(42743),xe=v(59856),ze=v(50907),Ke=v(19597),We=v(57851),Ce=v(40723),Be=v(64624),Fe=v(5894),je=v(53319),Re=v(14411),He=v(95808),Ie=v(80855),Ge=v(97825),Pe=v(44835),Le=v(82244),Me=v(51899),Ne=v(87091),Xe=v(55086),Ye=v(26906);let Je=class extends((0,ye.TF)(G.Z)){constructor(_t){super(_t),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Q.Z,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new B.Z,this._passParameters=new be.T,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new Z.Z,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const _t=this.view._stage.renderView;this._rctx=_t.renderingContext;const Ct=_t.waterTextureRepository;this._stippleTextureRepository=new Me.h0(_t.renderingContext),this._shaderTechniqueRepository=new Se.M({rctx:this._rctx,viewingMode:j.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:Ct}),this._renderContext=new Be.Y(this._rctx,new je.l(this._rctx,this.view.state.viewingMode),new He.L(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([(0,H.YP)(()=>Ct.updating,()=>this.events.emit("content-changed"),H.tX),(0,H.YP)(()=>this.spatialReference,vt=>this._localOriginFactory=new We.C(vt),H.tX),(0,H.on)(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new ze.h(_t.textureRepository,this._shaderTechniqueRepository,vt=>{(vt.renderOccluded&ut)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Fe.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,Ke.hf)(this._rctx),this._bindParameters.camera=qe,this._bindParameters.transparencyPassType=Pe.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Le.Mi((0,re.f)(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Ne.T8.STAGE,this))}dispose(){this._handles.destroy(),this._renderers.forEach(_t=>_t.destroy()),this._renderers.clear(),this._debugTextureTechnique=(0,W.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,W.M2)(this._passParameters.texture),this._bindParameters.highlightDepthTexture=(0,W.M2)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,W.M2)(this._shaderTechniqueRepository),this._temporaryFBO=(0,W.M2)(this._temporaryFBO),this._quadVAO=(0,W.M2)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,$.oE)(this._renderers,_t=>_t.updating)}get hasOverlays(){return(0,W.pC)(this._overlays)&&(0,W.pC)(this._overlayRenderTarget)}get gpuMemoryUsage(){return(0,W.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(_t){return this.createDrapeSourceRenderer(_t,Re.S)}createDrapeSourceRenderer(_t,Ct,vt){const Lt=this._renderers.get(_t);(0,W.pC)(Lt)&&Lt.destroy();const jt=new Ct({...vt,rendererContext:this,drapeSource:_t});return this._renderers.set(_t,jt),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in _t&&this._handles.add((0,H.YP)(()=>_t.fullOpacity,()=>this.events.emit("content-changed")),_t),jt}removeDrapeSourceRenderer(_t){if((0,W.Wi)(_t))return;const Ct=this._renderers.get(_t);(0,W.Wi)(Ct)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(_t),this._handles.remove(_t),Ct.destroy())}collectUnusedRenderTargetMemory(_t){let Ct=!1;if((0,W.pC)(this._overlayRenderTarget))for(const vt of this._overlayRenderTarget.renderTargets)Ct=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[vt.type]||!this.overlays[1].validTargets[vt.type],vt,_t)||Ct;return Ct}get overlays(){return(0,W.Pt)(this._overlays,[])}ensureDrapeTargets(_t){(0,W.pC)(this._overlays)&&this._overlays.forEach(Ct=>Ct.hasTargetWithoutRasterImage=(0,X.f)(_t,vt=>vt.drapeTargetType===Y.a.WithoutRasterImage))}ensureDrapeSources(_t){(0,W.pC)(this._overlays)&&this._overlays.forEach(Ct=>{Ct.hasDrapedFeatureSource=(0,X.f)(_t,vt=>vt.drapeSourceType===Y.L.Features),Ct.hasDrapedRasterSource=(0,X.f)(_t,vt=>vt.drapeSourceType===Y.L.RasterImage)})}ensureOverlays(_t,Ct){(0,W.Wi)(this._overlays)&&(this._overlayRenderTarget=new Ee(this._rctx),this._overlays=[new J.aV(ie.fu.INNER,this._overlayRenderTarget),new J.aV(ie.fu.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(_t),this.ensureDrapeSources(Ct)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=(0,W.M2)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(_t){this._processDrapeSources(_t,()=>!0)}_processDrapeSources(_t,Ct){let vt=!1;for(const[Lt,jt]of this._renderers){if(_t.done)break;(Lt.destroyed||Ct(Lt))&&jt.commitChanges()&&(vt=!0,_t.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,vt=!0,this._updateSortedDrapeSourceRenderers()),vt&&((0,W.pC)(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Ne.G5,_t=>_t.updatePolicy===ve.jq.SYNC)}isEmpty(){if(ee.Z.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const _t of this._renderers.values())if(!_t.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(_t){let Ct=!1;return this._renderers.forEach(vt=>Ct=vt.updateAnimation(_t)||Ct),Ct}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(_t,Ct,vt){const Lt=_t.canvasGeometries;if(0===Lt.numViews)return!1;this._screenToWorldRatio=vt*_t.mapUnitsPerPixel;const jt=Ct.output;if(this.isEmpty()||jt===ge.H.Highlight&&!this.hasHighlights||jt===ge.H.Normal&&!this.hasWater||!_t.hasSomeSizedView())return!1;const $t=Ct.fbo;if(!$t.isValid())return!1;const Wt=2*_t.resolution,pr=_t.resolution;$t.resize(Wt,pr);const gr=this._rctx;qe.pixelRatio=_t.pixelRatio*vt,this._renderContext.output=jt,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=jt===ge.H.Normal?Fe.r.DRAPED_WATER:Fe.r.DRAPED_MATERIAL,_t.applyViewport(this._rctx),$t.bind(gr),_t.index===ie.fu.INNER&&(gr.setClearColor(0,0,0,0),gr.clearSafe(ue.lk.COLOR_BUFFER_BIT));const ar=Ct.type===ie.NH.ColorNoRasterImage?rt.ExcludeRasterImage:Ct.type===ie.NH.Occluded?rt.OccludedOnly:rt.Normal;if(ar===rt.OccludedOnly&&(this._renderContext.renderOccludedMask=ut),ee.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&ar!==rt.OccludedOnly)for(let Fr=0;Fr<Lt.numViews;Fr++)this._setViewParameters(Lt.extents[Fr],_t,qe),this._drawDebugTexture(_t.resolution,et[_t.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:Fr,renderer:mr})=>{if(ar===rt.ExcludeRasterImage&&Fr.drapeSourceType===Y.L.RasterImage)return;const{fullOpacity:wt}=Fr,or=(0,W.pC)(wt)&&wt<1&&jt===ge.H.Color;or&&(this.bindTemporaryFramebuffer(this._rctx,Wt,pr),gr.clearSafe(ue.lk.COLOR_BUFFER_BIT));for(let sr=0;sr<Lt.numViews;sr++)this._setViewParameters(Lt.extents[sr],_t,qe),mr.render(this._renderContext,this._bindParameters);or&&(0,W.pC)(this._temporaryFBO)&&($t.bind(gr),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),wt,_t.index))}),gr.bindFramebuffer(null),$t.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(_t,Ct,vt){(0,W.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new he(_t,!1)),this._temporaryFBO.resize(Ct,vt),this._temporaryFBO.bind(_t)}reloadShaders(){var _t=this;return(0,D.Z)(function*(){yield _t._shaderTechniqueRepository.reloadAll()})()}notifyContentChanged(){this.events.emit("content-changed")}intersect(_t,Ct,vt,Lt){let jt=0;for(const $t of this._renderers.values())jt=$t.intersect?.(_t,Ct,vt,Lt,jt)??jt}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const _t=this.view.map.allLayers;this._renderers.forEach((Ct,vt)=>{const Lt=_t.indexOf(vt.layer);this._sortedRenderers.push(new tt(vt,Ct,Lt<0?1/0:Lt))}),this._sortedRenderers.sort((Ct,vt)=>Ct.index-vt.index)}_setViewParameters(_t,Ct,vt){vt.viewport[0]=vt.viewport[1]=0,vt.viewport[2]=vt.viewport[3]=Ct.resolution,(0,de.w)(vt.projectionMatrix,0,_t[2]-_t[0],0,_t[3]-_t[1],vt.near,vt.far),(0,de.f)(vt.viewMatrix,[-_t[0],-_t[1],0]),this._bindParameters.camera=vt}_updateHasWater(){const _t=(0,$.oE)(this._renderers,Ct=>Ct.hasWater);_t!==this._hasWater&&(this._hasWater=_t,this.events.emit("has-water",_t))}_updateHasHighlights(){const _t=(0,$.oE)(this._renderers,Ct=>Ct.hasHighlights);_t!==this._hasHighlights&&(this._hasHighlights=_t,this.events.emit("has-highlights",_t))}_updateRendersOccluded(){const _t=(0,$.oE)(this._renderers,Ct=>Ct.rendersOccluded);_t!==this._rendersOccluded&&(this._rendersOccluded=_t,this.events.emit("renders-occluded",_t))}_drawDebugTexture(_t,Ct){this._ensureDebugPatternResources(_t,_t,Ct);const vt=this._rctx;vt.bindTechnique(this._debugTextureTechnique,this._passParameters,null),vt.bindVAO(this._quadVAO),vt.drawArrays(ue.MX.TRIANGLE_STRIP,0,(0,Ye._V)(this._quadVAO,"geometry"))}_ensureDebugPatternResources(_t,Ct,vt){if((0,se.s)(this._passParameters.color,vt[0],vt[1],vt[2]),this._passParameters.texture)return;const Lt=new Uint8Array(_t*Ct*4);let jt=0;for(let Wt=0;Wt<Ct;Wt++)for(let pr=0;pr<_t;pr++){const gr=Math.floor(pr/10),ar=Math.floor(Wt/10);gr<2||ar<2||10*gr>_t-20||10*ar>Ct-20?(Lt[jt++]=255,Lt[jt++]=255,Lt[jt++]=255,Lt[jt++]=255):(Lt[jt++]=255,Lt[jt++]=255,Lt[jt++]=255,Lt[jt++]=1&gr&&1&ar?1&pr^1&Wt?0:255:1&gr^1&ar?0:128)}this._passParameters.texture=new Xe.x(this._rctx,{target:ue.No.TEXTURE_2D,pixelFormat:ue.VI.RGBA,dataType:ue.Br.UNSIGNED_BYTE,samplingMode:ue.cw.NEAREST,width:_t,height:Ct},Lt);const $t=new Ge.V;$t.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Ie.K,$t),this._quadVAO=(0,Ke.ow)(this._rctx)}get test(){return{drapeSourceRenderers:this._renderers,getDrapeSourceRenderer:_t=>this._renderers.get(_t)}}};var rt,_t;(0,R._)([(0,te.Cb)()],Je.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,R._)([(0,ye.gT)()],Je.prototype,"_shaderTechniqueRepository",void 0),(0,R._)([(0,ye.gT)()],Je.prototype,"_stippleTextureRepository",void 0),(0,R._)([(0,te.Cb)({constructOnly:!0})],Je.prototype,"view",void 0),(0,R._)([(0,te.Cb)()],Je.prototype,"worldToPCSRatio",void 0),(0,R._)([(0,te.Cb)()],Je.prototype,"spatialReference",void 0),(0,R._)([(0,te.Cb)({type:Boolean,readOnly:!0})],Je.prototype,"updating",null),Je=(0,R._)([(0,le.j)("esri.views.3d.terrain.OverlayRenderer")],Je),(_t=rt||(rt={}))[_t.Normal=0]="Normal",_t[_t.OccludedOnly=1]="OccludedOnly",_t[_t.ExcludeRasterImage=2]="ExcludeRasterImage";class tt{constructor(Ct,vt,Lt){this.drapeSource=Ct,this.renderer=vt,this.index=Lt}}const et=[[1,.5,.5],[.5,.5,1]],qe=new xe.V;qe.near=1,qe.far=1e4,qe.relativeElevation=null;const ot=-2,ut=Ce.yD.OccludeAndTransparent},80382:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>ee});var D=v(62208),R=v(44796),G=v(67969),Z=v(99770),Q=v(57596),$=v(55086);function H(ie,J){return new $.x(ie,{width:J.length/4,height:1,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:G.VI.RGBA,dataType:G.Br.UNSIGNED_BYTE,samplingMode:G.cw.NEAREST,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},J)}const Y={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class ee{constructor(J,ce,ue=null,pe=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=J,this.source=ce,this.width=ue||ce.width,this.height=pe||ce.height}get source(){return this._source}set source(J){this._source=J,this._rasterTexture=(0,D.M2)(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Y,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Y}set symbolizerParameters(J){this._symbolizerParameters=J}get bandIds(){return this._bandIds}set bandIds(J){(0,D.pC)(J)&&J.length>0?this._bandIds&&J.every((ce,ue)=>!!this._bandIds[ue]&&ce===this._bandIds[ue])||(this._bandIds=J,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(J){if(this._interpolation=J,(0,D.pC)(this._rasterTexture)){const ce=this._getRasterTextureInterpolation(J);this._rasterTexture.setSamplingMode("bilinear"===ce?G.cw.LINEAR:G.cw.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(J){this._transformGrid=J,this._transformGridTexture=(0,D.M2)(this._transformGridTexture),this._memoryUsed=null}bind(J){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(((0,D.Wi)(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(J,this.bandIds),(0,D.pC)(this._rasterTexture)&&(this._updateColormapTexture(J),this.transformGrid&&(0,D.Wi)(this._transformGridTexture)&&(this._transformGridTexture=function B(ie,J){const{spacing:ce,offsets:ue,coefficients:pe,size:[he,me]}=J,ge=ce[0]>1,_e={width:ge?4*he:he,height:me,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:ie.type===Q.zO.WEBGL2?G.lP.RGBA32F:G.VI.RGBA,dataType:G.Br.FLOAT,samplingMode:G.cw.NEAREST,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},Ee=new Float32Array(ge?he*me*16:2*ue.length);if(ge)for(let De=0,be=0;De<pe.length;De++)Ee[be++]=pe[De],De%3==2&&(Ee[be++]=1);else for(let De=0;De<me;De++)for(let be=0;be<he;be++){const Se=4*(De*he+be),ye=2*(be*me+De);Ee[Se]=ue[ye],Ee[Se+1]=ue[ye+1],Ee[Se+3]=-1===ue[ye]?0:1}return new $.x(ie,_e,Ee)}(J,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:J,transformGrid:ce,width:ue,height:pe,opacity:he}=this,me=function X(ie,J,ce,ue=1,pe=!0){return{u_flipY:pe,u_applyTransform:!!ie,u_opacity:ue,u_transformSpacing:ie?ie.spacing:Z.Z,u_transformGridSize:ie?ie.size:Z.Z,u_targetImageSize:J,u_srcImageSize:ce}}(ce,[ue,pe],[this.source.width,this.source.height],he),ge=function te(ie,J){return{u_colormapOffset:J||0,u_colormapMaxIndex:ie?ie.length/4-1:0}}(J.colormap,J.colormapOffset),_e="stretch"===this.symbolizerParameters.type?function oe(ie){return{u_bandCount:ie.bandCount,u_minOutput:ie.outMin,u_maxOutput:ie.outMax,u_minCutOff:ie.minCutOff,u_maxCutOff:ie.maxCutOff,u_factor:ie.factor,u_useGamma:ie.useGamma,u_gamma:ie.gamma,u_gammaCorrection:ie.gammaCorrection}}(this.symbolizerParameters):null,Ee="hillshade"===this.symbolizerParameters.type?function le(ie){return{u_hillshadeType:ie.hillshadeType,u_sinZcosAs:ie.sinZcosAs,u_sinZsinAs:ie.sinZsinAs,u_cosZs:ie.cosZs,u_weights:ie.weights,u_factor:ie.factor,u_minValue:ie.minValue,u_maxValue:ie.maxValue}}(this.symbolizerParameters):null;return new R.C(me,ge,_e||Ee,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){return(0,D.Wi)(this._memoryUsed)&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(ce=>(0,D.pC)(ce)?ce.descriptor.width*ce.descriptor.height*4:0).reduce((ce,ue)=>ce+ue,0)),this._memoryUsed}release(){return this._rasterTexture=(0,D.M2)(this._rasterTexture),this._transformGridTexture=(0,D.M2)(this._transformGridTexture),this._colormapTexture=(0,D.M2)(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(J,ce){const ue=this.source?this.source.extractBands(ce):null;if(!(ue&&ue.pixels&&ue.pixels.length>0))return void(this._rasterTexture=(0,D.M2)(this._rasterTexture));const pe=(0,D.Wi)(ce)&&(0,D.Wi)(this.bandIds)||(0,D.pC)(ce)&&(0,D.pC)(this.bandIds)&&ce.join("")===this.bandIds.join("");if((0,D.pC)(this._rasterTexture)&&pe)return;this._rasterTexture=(0,D.M2)(this._rasterTexture);const he=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=function W(ie,J,ce="nearest",ue=!1){const pe=!(ue&&"u8"===J.pixelType),he=pe?G.Br.FLOAT:G.Br.UNSIGNED_BYTE,me=null==J.pixels||0===J.pixels.length?null:pe?J.getAsRGBAFloat():J.getAsRGBA(),ge=ie.capabilities.textureFloat?.textureFloatLinear;return new $.x(ie,{width:J.width,height:J.height,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:ie.type===Q.zO.WEBGL2&&pe?G.lP.RGBA32F:G.VI.RGBA,samplingMode:!ge||"bilinear"!==ce&&"cubic"!==ce?G.cw.NEAREST:G.cw.LINEAR,dataType:he,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},me)}(J,ue,he,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(J){return"lut"===this.symbolizerParameters.type||"nearest"===J||"majority"===J?"nearest":"bilinear"}_updateColormapTexture(J){const ce=this._colormap,ue=this.symbolizerParameters.colormap;return ue?ce?ue.length!==ce.length||ue.some((pe,he)=>pe!==ce[he])?(this._colormapTexture=(0,D.M2)(this._colormapTexture),this._colormapTexture=H(J,ue),void(this._colormap=ue)):void 0:(this._colormapTexture=H(J,ue),void(this._colormap=ue)):(this._colormapTexture=(0,D.M2)(this._colormapTexture),void(this._colormap=null))}}},10558:(nt,Ae,v)=>{"use strict";v.d(Ae,{$7:()=>B,$r:()=>Q,DR:()=>W,HB:()=>$,L:()=>de,Lz:()=>te,Sx:()=>H,Tg:()=>ae,cy:()=>X,iU:()=>oe});var D=v(21286),R=v(65401),G=v(23461);const Q=64,$=512,W=2.5,B=(0,D.oK)(D._3/10),H=4,X=(0,R.Ue)();G.t.WebMercatorAuxiliarySphere.getExtent(0,0,0,X);const te=(0,R.Ue)([-180,-90,180,90]),ae="Cannot extend surface to encompass all layers because it would result in too many root tiles.",oe="Surface extent is too large for tile resolution at level 0.";const de=re=>re<4?3:4},23461:(nt,Ae,v)=>{"use strict";v.d(Ae,{_:()=>le,t:()=>oe});var D=v(26584),R=v(21286),G=v(62208),Z=v(16730),Q=v(2004),$=v(55915),W=v(65234),B=v(65401),H=v(37053),X=v(46367),te=v(2584);class oe{constructor(re){const j=oe.checkUnsupported(re);if((0,G.pC)(j))throw j;const Y=(0,G.Wg)(re);this.spatialReference=Y.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,$.jF)(this.spatialReference)||(0,H.BZ)(this.spatialReference)||(0,H.V2)(this.spatialReference),this.origin=[Y.origin.x,Y.origin.y],this.pixelSize=Y.size[0],this.dpi=Y.dpi;const ee=Y.lods.reduce((pe,he,me)=>(he.level<pe.min&&(pe.min=he.level,pe.minIndex=me),pe.max=Math.max(pe.max,he.level),pe),{min:1/0,minIndex:0,max:-1/0}),ie=Y.lods[ee.minIndex],J=2**ie.level;let ce=ie.resolution*J,ue=ie.scale*J;this.levels=new Array(ee.max+1);for(let pe=0;pe<this.levels.length;pe++)this.levels[pe]={resolution:ce,scale:ue,tileSize:[ce*Y.size[0],ce*Y.size[1]]},ce/=2,ue/=2}clone(){return new oe(this.toTileInfo())}toTileInfo(){return new te.Z({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((re,j)=>({level:j,scale:re.scale,resolution:re.resolution}))})}getExtent(re,j,Y,ee){const ie=this.levels[re],J=ie.tileSize[0],ce=ie.tileSize[1];ee[0]=this.origin[0]+Y*J,ee[2]=this.origin[0]+(Y+1)*J,ee[3]=this.origin[1]-j*ce,ee[1]=this.origin[1]-(j+1)*ce}convertExtentToRadians(re,j){this._isWebMercator?(j[0]=(0,X.tp)(re[0]),j[1]=(0,X.mZ)(re[1]),j[2]=(0,X.tp)(re[2]),j[3]=(0,X.mZ)(re[3])):this._isGCS&&(j[0]=(0,R.Vl)(re[0]),j[1]=(0,R.Vl)(re[1]),j[2]=(0,R.Vl)(re[2]),j[3]=(0,R.Vl)(re[3]))}getExtentGeometry(re,j,Y,ee=new Q.Z){return this.getExtent(re,j,Y,de),ee.spatialReference=this.spatialReference,ee.xmin=de[0],ee.ymin=de[1],ee.xmax=de[2],ee.ymax=de[3],ee.zmin=void 0,ee.zmax=void 0,ee}ensureMaxLod(re){if(null==re)return!1;let j=!1;for(;this.levels.length<=re;){const Y=this.levels[this.levels.length-1],ee=Y.resolution/2;this.levels.push({resolution:ee,scale:Y.scale/2,tileSize:[ee*this.pixelSize,ee*this.pixelSize]}),j=!0}return j}capMaxLod(re){this.levels.length>re+1&&(this.levels.length=re+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(re){return this.levels[0].scale/2**re}levelAtScale(re){const j=this.levels[0].scale;return re>=j?0:Math.log(j/re)*Math.LOG2E}resolutionAtLevel(re){return this.levels[0].resolution/2**re}compatibleWith(re){if(!(re instanceof oe)){if(oe.checkUnsupported(re))return!1;re=new oe(re)}if(!re.spatialReference.equals(this.spatialReference)||re.pixelSize!==this.pixelSize)return!1;const j=Math.min(this.levels.length,re.levels.length)-1,Y=this.levels[j].resolution;let ee=.5*Y;return!(!(0,R.W8)(re.origin[0],this.origin[0],ee)||!(0,R.W8)(re.origin[1],this.origin[1],ee))&&(ee=.5*Y/2**j/this.pixelSize*12,(0,R.W8)(Y,re.levels[j].resolution,ee))}rootTilesInExtent(re,j=null,Y=1/0){const ee=new Array,ie=this.levels[0].tileSize;if((0,G.Wi)(re)||0===ie[0]||0===ie[1])return ee;oe.computeRowColExtent(re,ie,this.origin,de);let J=de[1],ce=de[3],ue=de[0],pe=de[2];const he=pe-ue,me=ce-J;if(he*me>Y){const ge=Math.floor(Math.sqrt(Y));me>ge&&(J=J+Math.floor(.5*me)-Math.floor(.5*ge),ce=J+ge),he>ge&&(ue=ue+Math.floor(.5*he)-Math.floor(.5*ge),pe=ue+ge)}for(let ge=J;ge<ce;ge++)for(let _e=ue;_e<pe;_e++)ee.push([0,ge,_e]);return(0,G.pC)(j)&&(j[0]=this.origin[0]+ue*ie[0],j[1]=this.origin[1]-ce*ie[1],j[2]=this.origin[0]+pe*ie[0],j[3]=this.origin[1]-J*ie[1]),ee}static computeRowColExtent(re,j,Y,ee){const ie=.001*(re[2]-re[0]+(re[3]-re[1]));ee[0]=Math.max(0,Math.floor((re[0]+ie-Y[0])/j[0])),ee[2]=Math.max(0,Math.ceil((re[2]-ie-Y[0])/j[0])),ee[1]=Math.max(0,Math.floor((Y[1]-re[3]+ie)/j[1])),ee[3]=Math.max(0,Math.ceil((Y[1]-re[1]-ie)/j[1]))}static isPowerOfTwo(re){const j=re.lods,Y=j[0].resolution*2**j[0].level;return!j.some(ee=>!(0,R.Y8)(ee.resolution,Y/2**ee.level))}static hasGapInLevels(re){const j=re.lods.map(Y=>Y.level);j.sort((Y,ee)=>Y-ee);for(let Y=1;Y<j.length;Y++)if(j[Y]!==j[0]+Y)return!0;return!1}static tileSizeSupported(re){const j=re.size[1];return j===re.size[0]&&0==(j&j-1)&&j>=128&&j<=512}static hasOriginPerLODs(re){const j=re.origin;return re.lods.some(Y=>null!=Y.origin&&(Y.origin[0]!==j.x||Y.origin[1]!==j.y))}static getMissingTileInfoError(){return new D.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(re){return(0,G.Wi)(re)?le():re.lods.length<1?new D.Z("tilingscheme:generic","Tiling scheme must have at least one level"):oe.isPowerOfTwo(re)?oe.hasGapInLevels(re)?new D.Z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):oe.tileSizeSupported(re)?oe.hasOriginPerLODs(re)?new D.Z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new D.Z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new D.Z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(re,j){const Y=re[2]-re[0],ee=re[3]-re[1],ie=(0,Z.c9)(j),J=1.2*Math.max(Y,ee),he=new oe(new te.Z({size:[256,256],origin:{x:re[0]-.5*(J-Y),y:re[3]+.5*(J-ee)},lods:[{level:0,resolution:J/256,scale:1/(256/96*.0254/(J*ie))}],spatialReference:j}));return he.ensureMaxLod(20),he}static makeWebMercatorAuxiliarySphere(re){const j=new oe(oe.WebMercatorAuxiliarySphereTileInfo);return j.ensureMaxLod(re),j}static makeGCSWithTileSize(re,j=256,Y=16){const ee=256/j,ie=new oe(new te.Z({size:[j,j],origin:{x:-180,y:90,spatialReference:re},spatialReference:re,lods:[{level:0,resolution:.703125*ee,scale:295497598.570834*ee}]}));return ie.ensureMaxLod(Y),ie}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function le(){return new D.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}oe.WebMercatorAuxiliarySphereTileInfo=new te.Z({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:W.Z.WebMercator},spatialReference:W.Z.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),oe.WebMercatorAuxiliarySphere=oe.makeWebMercatorAuxiliarySphere(19);const de=(0,B.Ue)()},75224:(nt,Ae,v)=>{"use strict";var D,R,G,Z,Q,$,W,B;v.d(Ae,{NH:()=>Q,Ns:()=>$,VB:()=>Z,Xo:()=>G,fu:()=>D,ir:()=>W,tk:()=>R}),(B=D||(D={}))[B.INNER=0]="INNER",B[B.OUTER=1]="OUTER",function(B){B[B.REGULAR=0]="REGULAR",B[B.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",B[B.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",B[B.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(R||(R={})),function(B){B[B.NORTH=0]="NORTH",B[B.NORTH_EAST=1]="NORTH_EAST",B[B.EAST=2]="EAST",B[B.SOUTH_EAST=3]="SOUTH_EAST",B[B.SOUTH=4]="SOUTH",B[B.SOUTH_WEST=5]="SOUTH_WEST",B[B.WEST=6]="WEST",B[B.NORTH_WEST=7]="NORTH_WEST"}(G||(G={})),function(B){B[B.OFF=0]="OFF",B[B.ON=1]="ON"}(Z||(Z={})),function(B){B[B.Color=0]="Color",B[B.ColorNoRasterImage=1]="ColorNoRasterImage",B[B.Highlight=2]="Highlight",B[B.Water=3]="Water",B[B.Occluded=4]="Occluded",B[B.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Q||(Q={})),function(B){B[B.FADING=0]="FADING",B[B.IMMEDIATE=1]="IMMEDIATE",B[B.UNFADED=2]="UNFADED"}($||($={})),function(B){B[B.INSIDE=0]="INSIDE",B[B.INTERSECTS=1]="INTERSECTS",B[B.OUTSIDE=2]="OUTSIDE"}(W||(W={}))},61779:(nt,Ae,v)=>{"use strict";v.d(Ae,{jt:()=>De,XJ:()=>be,Wq:()=>_t,er:()=>Je,T9:()=>ye,b5:()=>Se,RB:()=>xe,E_:()=>rt,Fp:()=>ve,TK:()=>He,Eu:()=>Wt,_1:()=>Fe,CY:()=>Re,a_:()=>je,sR:()=>Ke,Ay:()=>Pe,GL:()=>Ie,Mw:()=>gr,wt:()=>jt,x4:()=>ze,L4:()=>Ne,uv:()=>pr,wP:()=>Ge,z7:()=>Me,FH:()=>We,Q:()=>Ce,Ke:()=>Le,OD:()=>$t,_0:()=>Lt,sP:()=>ot,cA:()=>Fr,OC:()=>ar,$v:()=>Ct,_F:()=>vt,z4:()=>Xe,Bu:()=>qe,FZ:()=>Ye,zT:()=>ut,jO:()=>et,wu:()=>Ee});var D=v(46160),R=v(62208),G=v(37053),Z=v(72469),Q=v(59617),$=v(91540),W=v(75224),B=v(26584),H=v(84161),X=v(28093),te=v(55915),ae=v(65401),oe=v(10558),le=v(23461);const de=(0,X.c)(),se=(0,X.c)(),re=(0,X.c)(),j=(0,X.c)();function ee(wt,or,sr,rr){(0,H.c)(de,sr),de[rr]=or[rr];const Et=(0,H.b)(de,de,or),St=(0,H.b)(se,wt,or),Ft=(0,H.e)(St,Et),zt=(0,H.e)(Et,Et);let dr;dr=Ft<=0?or:zt<=Ft?sr:(0,H.a)(de,or,(0,H.g)(Et,Et,Ft/zt));const hr=(0,H.b)(de,wt,dr);return Math.PI/2-Math.atan(hr[2]/Math.sqrt(hr[0]*hr[0]+hr[1]*hr[1]))}const ue=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function Y(wt,or,sr=0){const rr=wt.extent;if((0,R.Wi)(rr))return!1;if(0===sr)return(0,ae.BD)(rr,or);const Et=Math.min(rr[2]-rr[0],rr[3]-rr[1]);return(0,ae.Zm)(rr,or,sr*Et)},tiltToExtentEdge:function ie(wt,or,sr){const rr=wt.extent;if((0,R.Wi)(rr))return 0;re[0]=rr[0],re[1]=rr[1],re[2]=sr,j[0]=rr[2],j[1]=rr[3],j[2]=sr;let Et=1/0,St=1/0;return or[0]<re[0]?Et=ee(or,re,j,0):or[0]>j[0]&&(Et=ee(or,j,re,0)),or[1]<re[1]?St=ee(or,re,j,1):or[1]>j[1]&&(St=ee(or,j,re,1)),Math.min(Et,St)},checkIfTileInfoSupportedForViewSR:function J(wt,or,sr){if((0,R.Wi)(wt))return(0,le._)();if(wt.spatialReference.isGeographic&&!(0,te.jF)(wt.spatialReference))return new B.Z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const rr=le.t.checkUnsupported(wt);if((0,R.pC)(rr))return rr;if((0,R.Wi)(sr))return new B.Z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const Et=function ce(wt,or){const sr=wt.lods,rr=sr[0].resolution*2**sr[0].level,Et=[rr*wt.size[0],rr*wt.size[1]],St=[wt.origin.x,wt.origin.y],Ft=(0,ae.oJ)(or),zt=(0,ae.Ue)();le.t.computeRowColExtent(Ft,Et,St,zt);const dr=(zt[2]-zt[0])*(zt[3]-zt[1]);if(dr>oe.$r){const hr=sr[0].scale*2**sr[0].level;let Tr=Math.max((Ft[3]-Ft[1])/wt.size[1],(Ft[2]-Ft[0])/wt.size[0])*hr/rr;const Dr=Math.floor(Math.log(Tr)/Math.log(10));return Tr=Math.ceil(Tr/10**Dr)*10**Dr,new B.Z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(hr).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+Tr.toLocaleString()+".",{level0Scale:hr,suggestedLevel0Scale:Tr,requiredNumRootTiles:dr,allowedNumRootTiles:oe.$r})}return null}(wt,sr);if(Et)return Et;const St=wt.spatialReference;return(0,R.pC)(or)&&!(St.equals(or)||or.isWGS84&&St.isWebMercator)?new B.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}},Symbol.toStringTag,{value:"Module"})),ge=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function pe(){return!0},tiltToExtentEdge:function he(){return 0},checkIfTileInfoSupportedForViewSR:function me(wt,or){if((0,R.Wi)(wt))return(0,le._)();const sr=wt.lods.length-1,rr=wt.spatialReference,Et=(0,te.jF)(rr)||(0,G.BZ)(rr)||(0,G.V2)(rr);if(rr.isWebMercator){if(!le.t.makeWebMercatorAuxiliarySphere(sr).compatibleWith(wt))return new B.Z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Et)return new B.Z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!le.t.makeGCSWithTileSize(wt.spatialReference,wt.size[0],sr).compatibleWith(wt))return wt.spatialReference.isWGS84?new B.Z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new B.Z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return(0,R.pC)(or)&&!wt.spatialReference.equals(or)?new B.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}},Symbol.toStringTag,{value:"Module"})),_e={[Q.JY.Global]:ge,[Q.JY.Local]:ue};function Ee(wt,or){wt||console.warn("Terrain: "+or)}let De=!1,be=!1;function Se(wt){be=wt,De=De||wt}function ye(wt){De=wt}function ve(wt,or){if(De&&!wt){const sr=(new Error).stack.slice(5);throw console.warn("Terrain internal: "+(or||"")+" at "+sr),new Error("Assertion failed"+(or?": "+or:""))}}function xe(wt){return Ke(wt)?{fullExtent:wt.fullExtent,minScale:wt.layer.minScale,maxScale:wt.layer.maxScale,tilemapCache:null}:wt.layer}function ze(wt){return"imagery-tile"===wt?.type||"wcs"===wt?.type}function Ke(wt){return"imagery-tile-3d"===wt?.type}function We(wt){return"tile-3d"===wt?.type}function Ce(wt){return"vector-tile-3d"===wt?.type}function Be(wt){return"wmts-3d"===wt?.type}function Fe(wt){return"elevation-3d"===wt?.type}function je(wt){return"group"===wt?.type}function Re(wt){return"group"===wt?.type}function He(wt){return wt&&(We(wt)||Be(wt)||Ke(wt)||Ce(wt))}function Ie(wt){return wt&&(We(wt)||Ke(wt)||Ce(wt)||Be(wt))}function Ge(wt){return Ie(wt)||Fe(wt)}function Pe(wt){const or=wt?.sourceLayerInfo?.data;return(0,R.pC)(or)&&"type"in or&&"raster-tile"===or.type}function Le(wt){const or=wt?.sourceLayerInfo?.data;return(0,R.pC)(or)&&"type"in or&&"vector-tile"===or.type}function Me(wt){const or=wt?.sourceLayerInfo?.data;return(0,R.pC)(or)&&"type"in or&&"tile-texture"===or.type}function Ne(wt){const or=wt?.sourceLayerInfo?.data;return or instanceof HTMLImageElement||or instanceof $.nN||or instanceof HTMLCanvasElement||or instanceof ImageData}function Xe(wt){return(0,R.pC)(wt)&&"release"in wt&&wt.release(),null}function Ye(wt){return wt.fetchTile&&!1!==wt.hasOverriddenFetchTile}function Je(wt,or,sr,rr){return _e[rr].checkIfTileInfoSupportedForViewSR(wt,sr,or)}function rt(wt,or,sr){let rr=null,Et=null;if("wmts"===wt?.type){const St=function tt(wt,or,sr){const rr=(0,Z.mt)(wt);if((0,R.pC)(rr)){if(!D.Z.isCollection(rr))return{tileInfo:rr.tileInfo,fullExtent:rr.fullExtent};{const Et=rr.find(St=>null==Je(St.tileInfo,St.fullExtent,or,sr));if(Et)return{tileInfo:Et.tileInfo,fullExtent:Et.fullExtent}}}return{tileInfo:null,fullExtent:null}}(wt,or,sr);rr=St.tileInfo,Et=St.fullExtent}else{Et=ze(wt)?wt.getCompatibleFullExtent(or):wt.fullExtent;const St=sr===Q.JY.Local;if(ze(wt))rr=wt.getCompatibleTileInfo(or,Et,St);else if("vector-tile"===wt?.type){const Ft=St&&!et(or)||qe.force512VTL,zt=wt.tileInfo.spatialReference.isGeographic;rr=Ft?wt.tileInfo:wt.tileInfo.getOrCreateCompatible(256,zt?1:2)}else rr=wt.tileInfo}return(0,R.pC)(rr)&&(0,R.pC)(Et)&&null==Je(rr,Et,or,sr)?{tileInfo:rr,fullExtent:Et}:null}function et(wt){return wt.isWGS84||wt.isWebMercator||(0,G.yW)(wt)||!(0,G.N$)(wt)}const qe={force512VTL:!1};function ot(wt){return"["+wt[0]+","+wt[1]+","+wt[2]+"]"}function ut(wt){return"("+wt[0]+","+wt[1]+","+wt[2]+")"}function _t(wt,or,sr=mr){return Math.abs(wt-or)<sr}function Ct(wt){return wt===W.Xo.NORTH_EAST?W.Xo.SOUTH_WEST:wt===W.Xo.NORTH_WEST?W.Xo.SOUTH_EAST:wt===W.Xo.SOUTH_WEST?W.Xo.NORTH_EAST:W.Xo.NORTH_WEST}function vt(wt){return wt===W.Xo.NORTH?W.Xo.SOUTH:wt===W.Xo.EAST?W.Xo.WEST:wt===W.Xo.SOUTH?W.Xo.NORTH:W.Xo.EAST}function Lt(wt){return wt===W.Xo.NORTH_WEST||wt===W.Xo.SOUTH_WEST}function jt(wt){return wt===W.Xo.NORTH_WEST||wt===W.Xo.NORTH_EAST}function $t(wt){return wt===W.Xo.NORTH_WEST||wt===W.Xo.WEST||wt===W.Xo.SOUTH_WEST}function Wt(wt){return wt===W.Xo.NORTH_EAST||wt===W.Xo.EAST||wt===W.Xo.SOUTH_EAST}function pr(wt){return wt===W.Xo.SOUTH_EAST||wt===W.Xo.SOUTH||wt===W.Xo.SOUTH_WEST}function gr(wt){return wt===W.Xo.NORTH_EAST||wt===W.Xo.NORTH||wt===W.Xo.NORTH_WEST}const ar=[W.Xo.NORTH,W.Xo.EAST,W.Xo.SOUTH,W.Xo.WEST],Fr=[W.Xo.NORTH_EAST,W.Xo.SOUTH_EAST,W.Xo.SOUTH_WEST,W.Xo.NORTH_WEST],mr=1e-5},15076:(nt,Ae,v)=>{"use strict";v.d(Ae,{AA:()=>G,E9:()=>se,QT:()=>le,b:()=>oe,dF:()=>X,gl:()=>B,rv:()=>Z,t8:()=>de,yf:()=>W,zW:()=>H});var D=v(62208),R=v(77029);class G{constructor(){this._queue=new R.Z,this._last=null,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(j){this._queue.clear(),this._queue.push(j),this._last=null}reset(j=null){this._queue.clear(),(0,D.pC)(j)&&this._queue.pushArray(j),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class Z{constructor(){this._q=new R.Z}get done(){return 0===this._q.length}reset(j){if(this._q.clear(),!(0,D.Wi)(j)){this._q.pushArray(j);for(let Y=0;Y<this._q.length;++Y){const ee=this._q.data[Y];ee.isLeaf||this._q.pushArray(ee.children)}}}next(){return this._q.pop()}}function W(re,j,Y){if((0,D.Wi)(j)||(0,D.Wi)(j.fullExtent))return!1;const ee=j.fullExtent,ie=re.extent;if(Y){if(ie[0]<ee.xmin||ie[1]<ee.ymin||ie[2]>ee.xmax||ie[3]>ee.ymax)return!1}else if(ee.xmin>ie[2]||ee.ymin>ie[3]||ee.xmax<ie[0]||ee.ymax<ie[1])return!1;const J=re.surface.tilingScheme.levels[re.level].scale;return!(j.minScale>0&&J>1.00000001*j.minScale||j.maxScale>0&&J<.99999999*j.maxScale)}function B(re,j){return re.lij[0]-j.lij[0]||re.lij[1]-j.lij[1]||re.lij[2]-j.lij[2]}function H(re,j,Y=null){(0,D.Wi)(Y)||0===Y.length?j.sort((ee,ie)=>X(ee,ie,re)):j.sort((ee,ie)=>function te(re,j,Y,ee){return ae(re,ee)===ae(j,ee)?X(re,j,Y):re?Y:-Y}(ee,ie,re,Y))}function X(re,j,Y){const ee=re.screenDepth,ie=j.screenDepth;return ee<ie?-Y:ee>ie?Y:B(re,j)}function ae(re,j){for(const Y of j)if(re.intersectsExtent(Y))return!0;return!1}function oe(re,j){const Y=new Map;re.forAll(ee=>Y.set(ee.lij,ee.distanceToSquared(j))),re.sort((ee,ie)=>Y.get(ee.lij)-Y.get(ie.lij)||B(ee,ie))}function le(re,j,Y){let ee=1,ie=0,J=0;for(;re!==j;)if(ee*=.5,ie*=.5,J*=.5,1&re.lij[2]&&(ie+=.5),0==(1&re.lij[1])&&(J+=.5),null==(re=re.parent))throw new Error("tile was not a descendant of upsampleTile");Y.init(j,ie,J,ee)}function de(re){for(let j=0;j<re.length;j++){const Y=re[j],ee=Y.parent;if(ee)for(let ie=0;ie<4;ie++){const J=ee.children[ie];if(J&&J!==Y)return!0}}return!1}function se(re,j){if(!re||!j||re[0]===j[0])return!1;const Y=re[0]<j[0],ee=Y?re:j,ie=Y?j:re,J=1<<ie[0]-ee[0];return Math.floor(ie[1]/J)===ee[1]&&Math.floor(ie[2]/J)===ee[2]}},24225:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Z,c:()=>G});var Z,Q,D=v(17626),R=v(2286);class G extends R.Xn{constructor(){super(...arguments),this.visible=Z.Hidden}}(0,D._)([(0,R.gT)()],G.prototype,"renderable",void 0),(0,D._)([(0,R.gT)()],G.prototype,"components",void 0),(Q=Z||(Z={}))[Q.Hidden=0]="Hidden",Q[Q.Visible=1]="Visible"},75550:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>le,_:()=>de});var le,se,D=v(17626),R=v(35357),G=v(50574),Z=v(13934),Q=v(26859),$=v(36603),W=v(96395),B=v(92724),H=v(22799),X=v(37847),te=v(87601),ae=v(42743),oe=v(44835);(se=le||(le={}))[se.None=0]="None",se[se.NoOverlay=1]="NoOverlay",se[se.ColorOverlay=2]="ColorOverlay",se[se.ColorOverlayWithWater=3]="ColorOverlayWithWater",se[se.COUNT=4]="COUNT";class de extends te.m{constructor(){super(...arguments),this.output=Z.H.Color,this.textureCoordinateType=$.N.None,this.componentData=R._N.Uniform,this.cullFace=ae.Vr.Back,this.vertexDiscardMode=G.a.None,this.doubleSidedMode=W.q.WindingOrder,this.alphaDiscardMode=ae.JJ.Opaque,this.integratedMeshMode=le.None,this.transparencyPassType=oe.A.NONE,this.ellipsoidMode=H.U.Earth,this.pbrMode=B.f7.Disabled,this.normalType=Q.h.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}}(0,D._)([(0,te.o)({count:Z.H.COUNT})],de.prototype,"output",void 0),(0,D._)([(0,te.o)({count:$.N.COUNT})],de.prototype,"textureCoordinateType",void 0),(0,D._)([(0,te.o)({count:R._N.COUNT})],de.prototype,"componentData",void 0),(0,D._)([(0,te.o)({count:ae.Vr.COUNT})],de.prototype,"cullFace",void 0),(0,D._)([(0,te.o)({count:G.a.COUNT})],de.prototype,"vertexDiscardMode",void 0),(0,D._)([(0,te.o)({count:W.q.COUNT})],de.prototype,"doubleSidedMode",void 0),(0,D._)([(0,te.o)({count:ae.JJ.COUNT})],de.prototype,"alphaDiscardMode",void 0),(0,D._)([(0,te.o)({count:le.COUNT})],de.prototype,"integratedMeshMode",void 0),(0,D._)([(0,te.o)({count:oe.A.COUNT})],de.prototype,"transparencyPassType",void 0),(0,D._)([(0,te.o)({count:H.U.COUNT})],de.prototype,"ellipsoidMode",void 0),(0,D._)([(0,te.o)({count:B.f7.COUNT})],de.prototype,"pbrMode",void 0),(0,D._)([(0,te.o)({count:Q.h.COUNT})],de.prototype,"normalType",void 0),(0,D._)([(0,te.o)()],de.prototype,"spherical",void 0),(0,D._)([(0,te.o)()],de.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasVertexColors",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasNormals",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasSlicePlane",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasBaseColorTexture",void 0),(0,D._)([(0,te.o)()],de.prototype,"receiveAmbientOcclusion",void 0),(0,D._)([(0,te.o)()],de.prototype,"receiveShadows",void 0),(0,D._)([(0,te.o)()],de.prototype,"blendingEnabled",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasScreenSpaceReflections",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasPolygonOffset",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasMetallicRoughnessTexture",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasEmissionTexture",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasOcclusionTexture",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasNormalTexture",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasOccludees",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasMultipassTerrain",void 0),(0,D._)([(0,te.o)()],de.prototype,"cullAboveGround",void 0),(0,D._)([(0,te.o)()],de.prototype,"useLegacyTerrainShading",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasCloudsReflections",void 0),(0,D._)([(0,te.o)()],de.prototype,"snowCover",void 0),(0,D._)([(0,te.o)()],de.prototype,"objectAndLayerIdColor",void 0),(0,D._)([(0,te.o)()],de.prototype,"hasWebGL2Context",void 0),(0,D._)([(0,te.o)({constValue:X.P.Draw})],de.prototype,"pbrTextureBindType",void 0),(0,D._)([(0,te.o)({constValue:!0})],de.prototype,"hasSliceHighlight",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"hasSliceInVertexProgram",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"useCustomDTRExponentForWater",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"hasVertexTangents",void 0),(0,D._)([(0,te.o)({constValue:!0})],de.prototype,"supportsTextureAtlas",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"highStepCount",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"instancedDoublePrecision",void 0),(0,D._)([(0,te.o)({constValue:!0})],de.prototype,"useFillLights",void 0),(0,D._)([(0,te.o)({constValue:!1})],de.prototype,"objectAndLayerIdColorInstanced",void 0)},35357:(nt,Ae,v)=>{"use strict";v.d(Ae,{AD:()=>Y,_N:()=>se,E_:()=>re,nO:()=>j});var D=v(94573),R=v(36161),G=v(8314),Z=v(60785),Q=v(13934),$=v(19278),W=v(43177),B=v(90637),H=v(85930),X=v(37847);class te extends H.x{constructor(ce,ue){super(ce,"int",X.P.Draw,(pe,he,me)=>pe.setUniform1i(ce,ue(he,me)))}}var se,J,ae=v(17625),oe=v(5864),le=v(19755),de=v(16396);(J=se||(se={}))[J.Uniform=0]="Uniform",J[J.Varying=1]="Varying",J[J.COUNT=2]="COUNT";const re=429496.7296;function j(J,ce){(0,R.I)(J/re*.5+.5,ce)}function Y(J,ce){switch(ce.componentData){case se.Varying:return function ee(J,ce){const{vertex:ue,fragment:pe}=J;ue.include($.n),ue.uniforms.add((0,oe.F)("componentColorTex",me=>me.componentParameters.texture.texture,ce.hasWebGL2Context?le.D.None:le.D.Size)),J.attributes.add(de.T.COMPONENTINDEX,"float"),J.varyings.add("vExternalColorMixMode","mediump float"),J.varyings.add("vExternalColor","vec4");const he=ce.output===Q.H.ObjectAndLayerIdColor;he&&J.varyings.add("vObjectAndLayerIdColor","vec4"),J.include(Z.A),ue.constants.add("elevationScale","float",2*re),ue.constants.add("stride","float",(0,G.Z)("enable-feature:objectAndLayerId-rendering")?3:2),ue.code.add(ae.H`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${(0,W.w_)(ce,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),ue.code.add(ae.H`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${(0,W.b6)(ce,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${(0,W.b6)(ce,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${he?ae.H`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${(0,W.b6)(ce,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:ae.H`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),pe.code.add(ae.H`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${he?ae.H`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(J,ce);case se.Uniform:return function ie(J){const{vertex:ce,fragment:ue}=J;ce.uniforms.add(new B.$("externalColor",pe=>pe.componentParameters.externalColor)),ue.uniforms.add(new te("externalColorMixMode",pe=>pe.componentParameters.externalColorMixMode)),J.varyings.add("vExternalColor","vec4"),ce.code.add(ae.H`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),ue.code.add(ae.H`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}(J);case se.COUNT:return;default:(0,D.Bg)(ce.componentData)}}},60785:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>G});var D=v(9044),R=v(17625);function G(Z){Z.vertex.code.add(R.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${R.H.int(D.a9.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${R.H.int(D.a9.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${R.H.int(D.a9.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${R.H.int(D.a9.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},50574:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>R,z:()=>G});var R,Z,D=v(17625);function G(Z,Q){const $=Z.vertex;switch($.code.add(D.H`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),Q.vertexDiscardMode){case R.None:$.code.add(D.H`#define vertexDiscardByOpacity(_opacity_) {}`);break;case R.Opaque:$.code.add(D.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case R.Transparent:$.code.add(D.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(Z=R||(R={}))[Z.None=0]="None",Z[Z.Transparent=1]="Transparent",Z[Z.Opaque=2]="Opaque",Z[Z.COUNT=3]="COUNT"},27355:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>Z});var D=v(19625),R=v(36603),G=v(16396);function Z(Q){const $=(0,D.U$)().vec3f(G.T.POSITION);return Q.normals&&$.vec2i16(G.T.NORMALCOMPRESSED,{glNormalized:!0}),Q.textureCoordinates===R.N.Default?$.vec2f(G.T.UV0):Q.textureCoordinates===R.N.Atlas&&($.vec2f(G.T.UV0),$.vec4u16(G.T.UVREGION,{glNormalized:!0})),Q.colors&&$.vec4u8(G.T.COLOR,{glNormalized:!0}),$.alignTo(4)}},43553:(nt,Ae,v)=>{"use strict";v.d(Ae,{SP:()=>W,T5:()=>H,kF:()=>B,o9:()=>Q,zp:()=>$});var Q,$,X,D=v(28093),R=v(21799);class G extends R.d4{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,D.c)(),this.origin=this.slicePlaneLocalOrigin}}(X=Q||(Q={}))[X.Material=0]="Material",X[X.ShadowMap=1]="ShadowMap",X[X.Highlight=2]="Highlight",function(X){X[X.Color=0]="Color",X[X.Alpha=1]="Alpha",X[X.Depth=2]="Depth",X[X.Normal=3]="Normal",X[X.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"}($||($={}));class W extends G{constructor(){super(...arguments),this.identifier=Q.Material,this.transparent=!1,this.integratedMesh=!1}}class B extends G{constructor(){super(...arguments),this.identifier=Q.ShadowMap}}class H extends G{constructor(){super(...arguments),this.identifier=Q.Highlight}}},52382:(nt,Ae,v)=>{"use strict";v.d(Ae,{Lm:()=>Q,Zu:()=>$,bA:()=>W,qj:()=>B});var D=v(13934),R=v(51040),G=v(95285),Z=v(17625);function Q(H){H.varyings.add("linearDepth","float")}function $(H){H.vertex.uniforms.add(new G.A("nearFar",(X,te)=>te.camera.nearFar))}function W(H){H.vertex.code.add(Z.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function B(H,X){const{vertex:te}=H;switch(X.output){case D.H.Color:if(X.receiveShadows)return Q(H),void te.code.add(Z.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case D.H.Depth:case D.H.Shadow:case D.H.ShadowHighlight:case D.H.ShadowExludeHighlight:return H.include(R.up,X),Q(H),$(H),W(H),void te.code.add(Z.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}te.code.add(Z.H`void forwardLinearDepth() {}`)}},73132:(nt,Ae,v)=>{"use strict";v.d(Ae,{w:()=>R});var D=v(17625);function R(G){G.vertex.code.add(D.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},98071:(nt,Ae,v)=>{"use strict";v.d(Ae,{k:()=>G});var D=v(17625),R=v(16396);function G(Z,Q=!0){Z.attributes.add(R.T.POSITION,"vec2"),Q&&Z.varyings.add("uv","vec2"),Z.vertex.code.add(D.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${Q?D.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},13934:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{H:()=>D}),(R=D||(D={}))[R.Color=0]="Color",R[R.Depth=1]="Depth",R[R.Normal=2]="Normal",R[R.Shadow=3]="Shadow",R[R.ShadowHighlight=4]="ShadowHighlight",R[R.ShadowExludeHighlight=5]="ShadowExludeHighlight",R[R.Highlight=6]="Highlight",R[R.Alpha=7]="Alpha",R[R.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",R[R.COUNT=9]="COUNT"},78925:(nt,Ae,v)=>{"use strict";v.d(Ae,{P_:()=>X,UT:()=>H,f5:()=>te});var D=v(62208),R=v(28347),G=v(43703),Z=v(84161),Q=v(28093),$=v(77739),W=v(97139),B=v(17625);class H extends B.K{constructor(ce){super(),this.slicePlaneLocalOrigin=ce}}function X(J,ce){ae(J,ce,[new W.J("slicePlaneOrigin",(ue,pe)=>se(ce,ue,pe)),new W.J("slicePlaneBasis1",(ue,pe)=>re(ce,ue,pe,(0,D.Wg)(pe.slicePlane)?.basis1)),new W.J("slicePlaneBasis2",(ue,pe)=>re(ce,ue,pe,(0,D.Wg)(pe.slicePlane)?.basis2))])}function te(J,ce){ae(J,ce,[new $.B("slicePlaneOrigin",(ue,pe)=>se(ce,ue,pe)),new $.B("slicePlaneBasis1",(ue,pe)=>re(ce,ue,pe,(0,D.Wg)(pe.slicePlane)?.basis1)),new $.B("slicePlaneBasis2",(ue,pe)=>re(ce,ue,pe,(0,D.Wg)(pe.slicePlane)?.basis2))])}function ae(J,ce,ue){if(!ce.hasSlicePlane){const ge=B.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return ce.hasSliceInVertexProgram&&J.vertex.code.add(ge),void J.fragment.code.add(ge)}J.extensions.add("GL_OES_standard_derivatives"),ce.hasSliceInVertexProgram&&J.vertex.uniforms.add(ue),J.fragment.uniforms.add(ue);const pe=B.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,he=B.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,me=ce.hasSliceHighlight?B.H`
        ${he}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:B.H`#define highlightSlice(_color_, _pos_) (_color_)`;ce.hasSliceInVertexProgram&&J.vertex.code.add(pe),J.fragment.code.add(pe),J.fragment.code.add(me)}function oe(J,ce,ue){return J.instancedDoublePrecision?(0,Z.s)(j,ue.camera.viewInverseTransposeMatrix[3],ue.camera.viewInverseTransposeMatrix[7],ue.camera.viewInverseTransposeMatrix[11]):ce.slicePlaneLocalOrigin}function le(J,ce){return(0,D.pC)(J)?(0,Z.b)(Y,ce.origin,J):ce.origin}function de(J,ce,ue){return J.hasSliceTranslatedView?(0,D.pC)(ce)?(0,R.v)(ie,ue.camera.viewMatrix,ce):ue.camera.viewMatrix:null}function se(J,ce,ue){if((0,D.Wi)(ue.slicePlane))return Q.Z;const pe=oe(J,ce,ue),he=le(pe,ue.slicePlane),me=de(J,pe,ue);return(0,D.pC)(me)?(0,Z.m)(Y,he,me):he}function re(J,ce,ue,pe){if((0,D.Wi)(pe)||(0,D.Wi)(ue.slicePlane))return Q.Z;const he=oe(J,ce,ue),me=le(he,ue.slicePlane),ge=de(J,he,ue);return(0,D.pC)(ge)?((0,Z.a)(ee,pe,me),(0,Z.m)(Y,me,ge),(0,Z.m)(ee,ee,ge),(0,Z.b)(ee,ee,Y)):pe}const j=(0,Q.c)(),Y=(0,Q.c)(),ee=(0,Q.c)(),ie=(0,G.c)()},24255:(nt,Ae,v)=>{"use strict";v.d(Ae,{w:()=>G});var D=v(52382),R=v(17625);function G(Z,Q){if((0,D.bA)(Z),Q.hasModelTransformation)return Z.vertex.code.add(R.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void Z.vertex.code.add(R.H`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);Z.vertex.code.add(R.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),Z.vertex.code.add(R.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},60355:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>oe});var D=v(17626),R=v(84161),G=v(28093),Z=v(13934),Q=v(7228),$=v(2166),W=v(77739),B=v(17625),H=v(87601),X=v(16396),te=v(2757);function oe(de,se){se.instanced&&se.instancedDoublePrecision&&(de.attributes.add(X.T.MODELORIGINHI,"vec3"),de.attributes.add(X.T.MODELORIGINLO,"vec3"),de.attributes.add(X.T.MODEL,"mat3"),de.attributes.add(X.T.MODELNORMAL,"mat3"));const re=de.vertex;se.instancedDoublePrecision&&(re.include(Q.$,se),re.uniforms.add(new W.B("viewOriginHi",(j,Y)=>(0,te.U8)((0,R.s)(le,Y.camera.viewInverseTransposeMatrix[3],Y.camera.viewInverseTransposeMatrix[7],Y.camera.viewInverseTransposeMatrix[11]),le))),re.uniforms.add(new W.B("viewOriginLo",(j,Y)=>(0,te.GB)((0,R.s)(le,Y.camera.viewInverseTransposeMatrix[3],Y.camera.viewInverseTransposeMatrix[7],Y.camera.viewInverseTransposeMatrix[11]),le)))),re.code.add(B.H`
    vec3 calculateVPos() {
      ${se.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),re.code.add(B.H`
    vec3 subtractOrigin(vec3 _pos) {
      ${se.instancedDoublePrecision?B.H`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),re.code.add(B.H`
    vec3 dpNormal(vec4 _normal) {
      ${se.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),se.output===Z.H.Normal&&((0,$._8)(re),re.code.add(B.H`
    vec3 dpNormalView(vec4 _normal) {
      ${se.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),se.hasVertexTangents&&re.code.add(B.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${se.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}(0,D._)([(0,H.o)()],class ae extends H.m{constructor(){super(...arguments),this.instancedDoublePrecision=!1}}.prototype,"instancedDoublePrecision",void 0);const le=(0,G.c)()},26859:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>Z,h:()=>Q});var D=v(17625);function R($){const W=D.H`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;$.vertex.code.add(W)}var Q,$,G=v(16396);function Z($,W){W.normalType===Q.Attribute&&($.attributes.add(G.T.NORMAL,"vec3"),$.vertex.code.add(D.H`vec3 normalModel() {
return normal;
}`)),W.normalType===Q.CompressedAttribute&&($.include(R),$.attributes.add(G.T.NORMALCOMPRESSED,"vec2"),$.vertex.code.add(D.H`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),W.normalType===Q.ScreenDerivative&&($.extensions.add("GL_OES_standard_derivatives"),$.fragment.code.add(D.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}($=Q||(Q={}))[$.Attribute=0]="Attribute",$[$.CompressedAttribute=1]="CompressedAttribute",$[$.Ground=2]="Ground",$[$.ScreenDerivative=3]="ScreenDerivative",$[$.COUNT=4]="COUNT"},23164:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>Z});var D=v(13934),R=v(17625),G=v(16396);function Z(Q,$){const W=$.output===D.H.ObjectAndLayerIdColor,B=$.objectAndLayerIdColorInstanced;W&&(Q.varyings.add("objectAndLayerIdColorVarying","vec4"),Q.attributes.add(B?G.T.OBJECTANDLAYERIDCOLOR_INSTANCED:G.T.OBJECTANDLAYERIDCOLOR,"vec4")),Q.vertex.code.add(R.H`
     void forwardObjectAndLayerIdColor() {
      ${W?B?R.H`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:R.H`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:R.H``} }`),Q.fragment.code.add(R.H`
      void outputObjectAndLayerIdColor() {
        ${W?R.H`gl_FragColor = objectAndLayerIdColorVarying;`:R.H``} }`)}},68565:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>ae,W:()=>te});var D=v(99770),R=v(84833),G=v(95285),Z=v(97139),Q=v(48565),$=v(7090),W=v(17625),B=v(16396),H=v(41857);function te(oe,le){oe.attributes.add(B.T.FEATUREVALUE,"vec4");const de=oe.vertex;de.code.add(W.H`bool isCapVertex() {
return featureValue.w == 1.0;
}`),de.uniforms.add(new G.A("size",se=>se.size)),le.vvSize?(de.uniforms.add(new Z.J("vvSizeMinSize",se=>se.vvSizeMinSize)),de.uniforms.add(new Z.J("vvSizeMaxSize",se=>se.vvSizeMaxSize)),de.uniforms.add(new Z.J("vvSizeOffset",se=>se.vvSizeOffset)),de.uniforms.add(new Z.J("vvSizeFactor",se=>se.vvSizeFactor)),de.code.add(W.H`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):de.code.add(W.H`vec2 getSize(){
return size;
}`),le.vvOpacity?(de.constants.add("vvOpacityNumber","int",8),de.uniforms.add([new $.O("vvOpacityValues",se=>se.vvOpacityValues,8),new $.O("vvOpacityOpacities",se=>se.vvOpacityOpacities,8)]),de.code.add(W.H`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):de.code.add(W.H`vec4 applyOpacity(vec4 color){
return color;
}`),le.vvColor?(de.constants.add("vvColorNumber","int",H.x),de.uniforms.add([new $.O("vvColorValues",se=>se.vvColorValues,H.x),new Q.b("vvColorColors",se=>se.vvColorColors,H.x)]),de.code.add(W.H`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):de.code.add(W.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),oe.include(R.f),oe.attributes.add(B.T.PROFILERIGHT,"vec4"),oe.attributes.add(B.T.PROFILEUP,"vec4"),oe.attributes.add(B.T.PROFILEVERTEXANDNORMAL,"vec4"),de.code.add(W.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),de.code.add(W.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),de.code.add(W.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),de.code.add(W.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class ae extends H.n{constructor(){super(...arguments),this.size=(0,D.f)(1,1)}}},84833:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>G});var D=v(17625),R=v(16396);function G(Z){Z.attributes.add(R.T.POSITION,"vec3"),Z.vertex.code.add(D.H`vec3 positionModel() { return position; }`)}},39645:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>H});var D=v(97139),R=v(48565),G=v(65787),Z=v(7090),Q=v(17625),$=v(16396),W=v(41857);function H(X,te){const ae=X.vertex;ae.uniforms.add(new G.p("intrinsicWidth",oe=>oe.width)),te.vvSize?(X.attributes.add($.T.SIZEFEATUREATTRIBUTE,"float"),ae.uniforms.add(new D.J("vvSizeMinSize",oe=>oe.vvSizeMinSize)),ae.uniforms.add(new D.J("vvSizeMaxSize",oe=>oe.vvSizeMaxSize)),ae.uniforms.add(new D.J("vvSizeOffset",oe=>oe.vvSizeOffset)),ae.uniforms.add(new D.J("vvSizeFactor",oe=>oe.vvSizeFactor)),ae.code.add(Q.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(X.attributes.add($.T.SIZE,"float"),ae.code.add(Q.H`float getSize(){
return intrinsicWidth * size;
}`)),te.vvOpacity?(X.attributes.add($.T.OPACITYFEATUREATTRIBUTE,"float"),ae.constants.add("vvOpacityNumber","int",8),ae.uniforms.add([new Z.O("vvOpacityValues",oe=>oe.vvOpacityValues,8),new Z.O("vvOpacityOpacities",oe=>oe.vvOpacityOpacities,8)]),ae.code.add(Q.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):ae.code.add(Q.H`vec4 applyOpacity( vec4 color ){
return color;
}`),te.vvColor?(X.attributes.add($.T.COLORFEATUREATTRIBUTE,"float"),ae.constants.add("vvColorNumber","int",W.x),ae.uniforms.add(new Z.O("vvColorValues",oe=>oe.vvColorValues,W.x)),ae.uniforms.add(new R.b("vvColorColors",oe=>oe.vvColorColors,W.x)),ae.code.add(Q.H`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(X.attributes.add($.T.COLOR,"vec4"),ae.code.add(Q.H`vec4 getColor(){
return applyOpacity(color);
}`))}},99579:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>$});var D=v(60785),R=v(18952),G=v(17625),Z=v(16396),Q=v(57623);function $(W,B){B.hasSymbolColors?(W.include(D.A),W.attributes.add(Z.T.SYMBOLCOLOR,"vec4"),W.varyings.add("colorMixMode","mediump float"),W.vertex.code.add(G.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(W.fragment.uniforms.add(new R._("colorMixMode",H=>Q.FZ[H.colorMixMode])),W.vertex.code.add(G.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},36603:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>Q,N:()=>Z});var Z,$,D=v(94573),R=v(17625),G=v(16396);function Q($,W){switch(W.textureCoordinateType){case Z.Default:return $.attributes.add(G.T.UV0,"vec2"),$.varyings.add("vuv0","vec2"),void $.vertex.code.add(R.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Z.Compressed:return $.attributes.add(G.T.UV0,"vec2"),$.varyings.add("vuv0","vec2"),void $.vertex.code.add(R.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Z.Atlas:return $.attributes.add(G.T.UV0,"vec2"),$.varyings.add("vuv0","vec2"),$.attributes.add(G.T.UVREGION,"vec4"),$.varyings.add("vuvRegion","vec4"),void $.vertex.code.add(R.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,D.Bg)(W.textureCoordinateType);case Z.None:return void $.vertex.code.add(R.H`void forwardTextureCoordinates() {}`);case Z.COUNT:return}}($=Z||(Z={}))[$.None=0]="None",$[$.Default=1]="Default",$[$.Atlas=2]="Atlas",$[$.Compressed=3]="Compressed",$[$.COUNT=4]="COUNT"},58173:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>G});var D=v(17625),R=v(16396);function G(Z,Q){Q.hasVertexColors?(Z.attributes.add(R.T.COLOR,"vec4"),Z.varyings.add("vColor","vec4"),Z.vertex.code.add(D.H`void forwardVertexColor() { vColor = color; }`),Z.vertex.code.add(D.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):Z.vertex.code.add(D.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},21799:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bb:()=>B,Pf:()=>X,d4:()=>H});var D=v(550),R=v(4794),G=v(26859),Z=v(51040),Q=v(17625),$=v(9546),W=v(91574);function B(te,ae){ae.normalType===G.h.Attribute||ae.normalType===G.h.CompressedAttribute?(te.include(G.O,ae),te.varyings.add("vNormalWorld","vec3"),te.varyings.add("vNormalView","vec3"),te.vertex.uniforms.add([new $.j("transformNormalGlobalFromModel",oe=>oe.transformNormalGlobalFromModel),new W.c("transformNormalViewFromGlobal",oe=>oe.transformNormalViewFromGlobal)]),te.vertex.code.add(Q.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):ae.normalType===G.h.Ground?(te.include(Z.up,ae),te.varyings.add("vNormalWorld","vec3"),te.vertex.code.add(Q.H`
    void forwardNormal() {
      vNormalWorld = ${ae.spherical?Q.H`normalize(vPositionWorldCameraRelative);`:Q.H`vec3(0.0, 0.0, 1.0);`}
    }
    `)):te.vertex.code.add(Q.H`void forwardNormal() {}`)}class H extends Z.su{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,D.c)()}}class X extends Z.OU{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,D.c)(),this.toMapSpace=(0,R.c)()}}},51040:(nt,Ae,v)=>{"use strict";v.d(Ae,{OU:()=>de,su:()=>le,up:()=>oe});var D=v(550),R=v(43703),G=v(14658),Z=v(28093),Q=v(84833),$=v(7228),W=v(77739),B=v(97139),H=v(17625),X=v(9546),te=v(91574),ae=v(63123);function oe(se,re){se.include(Q.f);const j=se.vertex;j.include($.$,re),se.varyings.add("vPositionWorldCameraRelative","vec3"),se.varyings.add("vPosition_view","vec3"),j.uniforms.add([new B.J("transformWorldFromViewTH",Y=>Y.transformWorldFromViewTH),new B.J("transformWorldFromViewTL",Y=>Y.transformWorldFromViewTL),new te.c("transformViewFromCameraRelativeRS",Y=>Y.transformViewFromCameraRelativeRS),new ae.g("transformProjFromView",Y=>Y.transformProjFromView),new X.j("transformWorldFromModelRS",Y=>Y.transformWorldFromModelRS),new W.B("transformWorldFromModelTH",Y=>Y.transformWorldFromModelTH),new W.B("transformWorldFromModelTL",Y=>Y.transformWorldFromModelTL)]),j.code.add(H.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),j.code.add(H.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${re.spherical?H.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:H.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),se.fragment.uniforms.add(new B.J("transformWorldFromViewTL",Y=>Y.transformWorldFromViewTL)),j.code.add(H.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),se.fragment.code.add(H.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class le extends H.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,Z.c)(),this.transformWorldFromViewTL=(0,Z.c)(),this.transformViewFromCameraRelativeRS=(0,D.c)(),this.transformProjFromView=(0,R.c)()}}class de extends H.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,D.c)(),this.transformWorldFromModelTH=(0,G.c)(),this.transformWorldFromModelTL=(0,G.c)()}}},43880:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>R});var D=v(17625);function R(G,Z){G.varyings.add("tbnTangent","vec3"),G.varyings.add("tbnBiTangent","vec3"),G.vertex.code.add(Z.spherical?D.H`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`:D.H`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),G.fragment.code.add(D.H`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},95284:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>Q});var D=v(94573),R=v(36603),G=v(95267),Z=v(17625);function Q($,W){switch($.include(R.D,W),$.fragment.code.add(Z.H`
  struct TextureLookupParameter {
    vec2 uv;
    ${W.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),W.textureCoordinateType){case R.N.Default:case R.N.Compressed:return void $.fragment.code.add(Z.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case R.N.Atlas:return $.include(G.r),void $.fragment.code.add(Z.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:(0,D.Bg)(W.textureCoordinateType);case R.N.None:case R.N.COUNT:return}}},66085:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>W,V:()=>H});var D=v(993),R=v(4794),G=v(71850),Z=v(2166),Q=v(69960),$=v(17625);function W(X,te){const ae=X.vertex;te.hasVerticalOffset?(H(ae),te.hasScreenSizePerspective&&(X.include(G.cK),(0,G.m8)(ae),(0,Z.hY)(X.vertex,te)),ae.code.add($.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${te.spherical?$.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:$.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${te.hasScreenSizePerspective?$.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:$.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):ae.code.add($.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const B=(0,R.c)();function H(X){X.uniforms.add(new Q.N("verticalOffset",(te,ae)=>{const{minWorldLength:oe,maxWorldLength:le,screenLength:de}=te.verticalOffset,se=Math.tan(.5*ae.camera.fovY)/(.5*ae.camera.fullViewport[3]);return(0,D.s)(B,de*(ae.camera.pixelRatio||1),se,oe,le)}))}},58208:(nt,Ae,v)=>{"use strict";v.d(Ae,{s:()=>ee});var D=v(62208),R=v(43703),G=v(52382),Z=v(13934),Q=v(78925),$=v(24255),W=v(26859),B=v(23164),H=v(36603),X=v(21799),te=v(54120),ae=v(62952),oe=v(92836),le=v(93609),de=v(2166),se=v(17625),re=v(63123),j=v(35387),Y=v(42743);function ee(ie,J){const{vertex:ce,fragment:ue}=ie,pe=J.hasModelTransformation;pe&&ce.uniforms.add(new re.g("model",me=>(0,D.pC)(me.modelTransformation)?me.modelTransformation:R.I));const he=J.hasColorTexture&&J.alphaDiscardMode!==Y.JJ.Opaque;switch(J.output){case Z.H.Depth:case Z.H.Shadow:case Z.H.ShadowHighlight:case Z.H.ShadowExludeHighlight:case Z.H.ObjectAndLayerIdColor:(0,de.Sv)(ce,J),ie.include($.w,J),ie.include(H.D,J),ie.include(oe.k,J),ie.include(te.F,J),ie.include(Q.f5,J),ie.include(B.R,J),(0,G.Zu)(ie),ie.varyings.add("depth","float"),he&&ue.uniforms.add(new j.A("tex",me=>me.texture)),ce.code.add(se.H`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${pe?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),ie.include(le.z,J),ue.code.add(se.H`
          void main(void) {
            discardBySlice(vpos);
            ${he?se.H`
                    vec4 texColor = texture2D(tex, ${J.hasColorTextureTransform?se.H`colorUV`:se.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${J.output===Z.H.ObjectAndLayerIdColor?se.H`outputObjectAndLayerIdColor();`:se.H`outputDepth(depth);`}
          }
        `);break;case Z.H.Normal:(0,de.Sv)(ce,J),ie.include($.w,J),ie.include(W.O,J),ie.include(X.Bb,J),ie.include(H.D,J),ie.include(oe.k,J),he&&ue.uniforms.add(new j.A("tex",me=>me.texture)),ie.varyings.add("vPositionView","vec3"),ce.code.add(se.H`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${J.normalType===W.h.Attribute?se.H`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${pe?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),ie.include(Q.f5,J),ie.include(le.z,J),ue.code.add(se.H`
          void main() {
            discardBySlice(vpos);
            ${he?se.H`
                    vec4 texColor = texture2D(tex, ${J.hasColorTextureTransform?se.H`colorUV`:se.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${J.normalType===W.h.ScreenDerivative?se.H`
                vec3 normal = screenDerivativeNormal(vPositionView);`:se.H`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case Z.H.Highlight:(0,de.Sv)(ce,J),ie.include($.w,J),ie.include(H.D,J),ie.include(oe.k,J),he&&ue.uniforms.add(new j.A("tex",me=>me.texture)),ce.code.add(se.H`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${pe?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),ie.include(Q.f5,J),ie.include(le.z,J),ie.include(ae.bA,J),ue.code.add(se.H`
          void main() {
            discardBySlice(vpos);
            ${he?se.H`
                    vec4 texColor = texture2D(tex, ${J.hasColorTextureTransform?se.H`colorUV`:se.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}},35283:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>R});var D=v(17625);function R(G){const Z=D.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,Q=D.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;G.vertex.code.add(Z),G.vertex.code.add(Q),G.fragment.code.add(Z),G.fragment.code.add(Q)}},97347:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>te,d:()=>X});var X,ae,D=v(66085),R=v(42309),G=v(71850),Z=v(2166),Q=v(69960),$=v(65787),W=v(17625),B=v(35387),H=v(16396);function te(ae,oe){ae.include(G.cK),ae.attributes.add(H.T.POSITION,"vec3"),ae.attributes.add(H.T.NORMAL,"vec3"),ae.attributes.add(H.T.AUXPOS1,"vec4");const le=ae.vertex;(0,Z.Sv)(le,oe),(0,Z.hY)(le,oe),le.uniforms.add([new Q.N("viewport",(de,se)=>se.camera.fullViewport),new $.p("polygonOffset",de=>de.shaderPolygonOffset),new $.p("cameraGroundRelative",(de,se)=>se.camera.aboveGround?1:-1),new $.p("renderTransparentlyOccludedHUD",(de,se)=>se.renderTransparentlyOccludedHUD===R.v.Occluded?1:se.renderTransparentlyOccludedHUD===R.v.NotOccluded?0:.75),new B.A("hudVisibilityTexture",(de,se)=>se.hudVisibilityTexture)]),oe.hasVerticalOffset&&(0,D.V)(le),le.constants.add("smallOffsetAngle","float",.984807753012208),le.code.add(W.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),le.code.add(W.H`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),oe.isDraped&&!oe.hasVerticalOffset||(0,Z._8)(le),oe.isDraped||(le.uniforms.add(new $.p("perDistancePixelRatio",(de,se)=>Math.tan(se.camera.fovY/2)/(se.camera.fullViewport[2]/2))),le.code.add(W.H`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),oe.screenCenterOffsetUnitsEnabled===X.Screen&&le.uniforms.add(new $.p("pixelRatio",(de,se)=>se.camera.pixelRatio)),oe.hasScreenSizePerspective&&(0,G.m8)(le),le.code.add(W.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${oe.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${oe.hasScreenSizePerspective&&(oe.hasVerticalOffset||oe.screenCenterOffsetUnitsEnabled===X.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${oe.hasVerticalOffset?oe.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${oe.hasVerticalOffset?W.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${oe.screenCenterOffsetUnitsEnabled!==X.Screen?W.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${oe.screenCenterOffsetUnitsEnabled===X.Screen?oe.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${oe.screenCenterOffsetUnitsEnabled===X.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),le.code.add(W.H`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(ae=X||(X={}))[ae.World=0]="World",ae[ae.Screen=1]="Screen",ae[ae.COUNT=2]="COUNT"},27776:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>H});var D=v(47923),R=v(82793),G=v(19278),Z=v(43177),Q=v(95285),$=v(17625),W=v(35387),B=v(19755);function H(X,te){const{vertex:ae,fragment:oe}=X;te.hasMultipassGeometry&&ae.include(R.S),te.hasMultipassTerrain&&X.varyings.add("depth","float"),ae.code.add($.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${te.hasMultipassGeometry?$.H`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${te.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),te.hasMultipassTerrain&&oe.include(D.S),te.hasMultipassTerrain&&oe.uniforms.add([...(0,W.J)("terrainDepthTexture",(le,de)=>de.multipassTerrain.linearDepthTexture,te.hasWebGL2Context?B.D.None:B.D.InvSize),new Q.A("nearFar",(le,de)=>de.camera.nearFar)]),oe.include(G.n),oe.code.add($.H`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${te.hasMultipassTerrain?$.H`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${(0,Z.b6)(te,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},42309:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{v:()=>D}),(R=D||(D={}))[R.Occluded=0]="Occluded",R[R.NotOccluded=1]="NotOccluded",R[R.Both=2]="Both",R[R.COUNT=3]="COUNT"},7699:(nt,Ae,v)=>{"use strict";var D,Z;v.d(Ae,{MV:()=>G,iM:()=>D,pU:()=>R}),(Z=D||(D={}))[Z.Normal=0]="Normal",Z[Z.Average=1]="Average",Z[Z.Lighten=2]="Lighten",Z[Z.Lighter=3]="Lighter",Z[Z.Plus=4]="Plus",Z[Z.Screen=5]="Screen",Z[Z.ColorDodge=6]="ColorDodge",Z[Z.Darken=7]="Darken",Z[Z.Multiply=8]="Multiply",Z[Z.ColorBurn=9]="ColorBurn",Z[Z.Overlay=10]="Overlay",Z[Z.SoftLight=11]="SoftLight",Z[Z.HardLight=12]="HardLight",Z[Z.VividLight=13]="VividLight",Z[Z.Hue=14]="Hue",Z[Z.Saturation=15]="Saturation",Z[Z.Luminosity=16]="Luminosity",Z[Z.Color=17]="Color",Z[Z.DestinationOver=18]="DestinationOver",Z[Z.DestinationAtop=19]="DestinationAtop",Z[Z.DestinationIn=20]="DestinationIn",Z[Z.DestinationOut=21]="DestinationOut",Z[Z.SourceAtop=22]="SourceAtop",Z[Z.SourceIn=23]="SourceIn",Z[Z.SourceOut=24]="SourceOut",Z[Z.Xor=25]="Xor",Z[Z.Difference=26]="Difference",Z[Z.Exclusion=27]="Exclusion",Z[Z.Minus=28]="Minus",Z[Z.Invert=29]="Invert",Z[Z.Reflect=30]="Reflect",Z[Z.COUNT=31]="COUNT";const R={normal:D.Normal,average:D.Average,lighten:D.Lighten,lighter:D.Lighter,screen:D.Screen,plus:D.Plus,"color-dodge":D.ColorDodge,darken:D.Darken,multiply:D.Multiply,"color-burn":D.ColorBurn,overlay:D.Overlay,"soft-light":D.SoftLight,"hard-light":D.HardLight,"vivid-light":D.VividLight,hue:D.Hue,saturation:D.Saturation,luminosity:D.Luminosity,color:D.Color,difference:D.Difference,exclusion:D.Exclusion,minus:D.Minus,invert:D.Invert,reflect:D.Reflect,"destination-over":D.DestinationOver,"destination-atop":D.DestinationAtop,"destination-in":D.DestinationIn,"destination-out":D.DestinationOut,"source-atop":D.SourceAtop,"source-in":D.SourceIn,"source-out":D.SourceOut,xor:D.Xor};function G(Z){return Z===D.DestinationOver||Z===D.DestinationAtop||Z===D.DestinationIn||Z===D.DestinationOut||Z===D.SourceAtop||Z===D.SourceIn||Z===D.SourceOut||Z===D.Xor}},54120:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>Z});var D=v(13934),R=v(19278),G=v(17625);function Z(Q,$){switch(Q.fragment.include(R.n),$.output){case D.H.Shadow:case D.H.ShadowHighlight:case D.H.ShadowExludeHighlight:Q.extensions.add("GL_OES_standard_derivatives"),Q.fragment.code.add(G.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case D.H.Depth:Q.fragment.code.add(G.H`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}},62952:(nt,Ae,v)=>{"use strict";v.d(Ae,{bA:()=>B,ck:()=>W});var D=v(4794),R=v(43177),G=v(17625),Z=v(35387),Q=v(19755);const $=(0,D.f)(1,1,0,1),W=(0,D.f)(1,0,1,1);function B(H,X){H.fragment.uniforms.add((0,Z.J)("depthTex",(te,ae)=>ae.highlightDepthTexture,X.hasWebGL2Context?Q.D.None:Q.D.InvSize)),H.fragment.constants.add("occludedHighlightFlag","vec4",$).add("unoccludedHighlightFlag","vec4",W),H.fragment.code.add(G.H`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${(0,R.b6)(X,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}},47923:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>G});var D=v(19278),R=v(17625);function G(Z){Z.include(D.n),Z.code.add(R.H`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},3802:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>Q});var D=v(43177),R=v(65787),G=v(17625),Z=v(35387);function Q($,W){$.fragment.uniforms.add([new Z.A("u_colormap",B=>B.u_colormap),new R.p("u_colormapOffset",B=>B.colormap.u_colormapOffset),new R.p("u_colormapMaxIndex",B=>B.colormap.u_colormapMaxIndex),new R.p("u_opacity",B=>B.common.u_opacity)]),$.fragment.code.add(G.H`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${(0,D.b6)(W,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}},76301:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>X,J:()=>H});var D=v(43177),R=v(95285),G=v(17625),Z=v(35387),Q=v(19755);function $(te,ae){te.fragment.uniforms.add((0,Z.J)("u_transformGrid",oe=>oe.u_transformGrid,ae.hasWebGL2Context?Q.D.None:Q.D.InvSize)),te.fragment.uniforms.add(new R.A("u_transformSpacing",oe=>oe.common.u_transformSpacing)),te.fragment.uniforms.add(new R.A("u_targetImageSize",oe=>oe.common.u_targetImageSize)),te.fragment.code.add(G.H`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${(0,D.b6)(ae,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${(0,D.b6)(ae,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${(0,D.b6)(ae,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${(0,D.b6)(ae,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}var W=v(14273),B=v(78038);class H extends W.R{constructor(ae,oe,le){super(),this.common=ae,this.u_image=oe,this.u_transformGrid=le}}function X(te,ae){te.include($,ae),te.fragment.uniforms.add([new Z.A("u_image",oe=>oe.u_image),new B.U("u_flipY",oe=>oe.common.u_flipY),new B.U("u_applyTransform",oe=>oe.common.u_applyTransform)]),te.fragment.code.add(G.H`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}},2122:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>$});var D=v(58173),R=v(28137),G=v(90637),Z=v(2163),Q=v(17625);function $(W,B){W.include(D.c,B),W.fragment.include(R.y);const H=W.fragment;H.uniforms.add(new G.$("baseColor",X=>X.baseColor)),H.uniforms.add(new Z.p("objectOpacity",X=>X.objectOpacity)),H.code.add(B.hasVertexColors?Q.H`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`:Q.H`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),H.code.add(Q.H`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},29052:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>te});var D=v(36603),R=v(95284),G=v(96395),Z=v(43177),Q=v(17625),$=v(5864),W=v(35387),B=v(19755),H=v(37847),X=v(16396);function te(ae,oe){const le=ae.fragment;if(oe.hasVertexTangents?(ae.attributes.add(X.T.TANGENT,"vec4"),ae.varyings.add("vTangent","vec4"),le.code.add(oe.doubleSidedMode===G.q.WindingOrder?Q.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`:Q.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(ae.extensions.add("GL_OES_standard_derivatives"),le.code.add(Q.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),oe.textureCoordinateType!==D.N.None){ae.include(R.i,oe);const de=oe.supportsTextureAtlas?oe.hasWebGL2Context?B.D.None:B.D.Size:B.D.None;le.uniforms.add(oe.pbrTextureBindType===H.P.Pass?(0,W.J)("normalTexture",se=>se.textureNormal,de):(0,$.F)("normalTexture",se=>se.textureNormal,de)),le.code.add(Q.H`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${oe.supportsTextureAtlas?Q.H`vtc.size = ${(0,Z.w_)(oe,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}},75819:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>W});var D=v(94573),R=v(26859),G=v(21799),Z=v(51040),Q=v(96395),$=v(17625);function W(B,H){const X=B.fragment;switch(H.doubleSidedMode){case Q.q.None:X.code.add($.H`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Q.q.View:B.include(Z.up,H),X.code.add($.H`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Q.q.WindingOrder:X.code.add($.H`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:(0,D.Bg)(H.doubleSidedMode);case Q.q.COUNT:}switch(H.normalType){case R.h.Attribute:case R.h.CompressedAttribute:B.include(G.Bb,H),X.code.add($.H`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case R.h.ScreenDerivative:B.extensions.add("GL_OES_standard_derivatives"),B.include(Z.up,H),X.code.add($.H`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case R.h.Ground:H.spherical?(B.include(Z.up,H),X.code.add($.H`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):X.code.add($.H`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),B.extensions.add("GL_OES_standard_derivatives"),X.code.add($.H`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:(0,D.Bg)(H.normalType);case R.h.COUNT:}}},44965:(nt,Ae,v)=>{"use strict";v.d(Ae,{_:()=>H});var D=v(84161),R=v(28093),G=v(993),Z=v(4794),Q=v(92724),$=v(97139),W=v(69960),B=v(17625);function H(ae,oe){const le=ae.fragment,de=void 0!==oe.lightingSphericalHarmonicsOrder?oe.lightingSphericalHarmonicsOrder:2;0===de?(le.uniforms.add(new $.J("lightingAmbientSH0",(se,re)=>(0,D.s)(X,re.lighting.sh.r[0],re.lighting.sh.g[0],re.lighting.sh.b[0]))),le.code.add(B.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===de?(le.uniforms.add([new W.N("lightingAmbientSH_R",(se,re)=>(0,G.s)(te,re.lighting.sh.r[0],re.lighting.sh.r[1],re.lighting.sh.r[2],re.lighting.sh.r[3])),new W.N("lightingAmbientSH_G",(se,re)=>(0,G.s)(te,re.lighting.sh.g[0],re.lighting.sh.g[1],re.lighting.sh.g[2],re.lighting.sh.g[3])),new W.N("lightingAmbientSH_B",(se,re)=>(0,G.s)(te,re.lighting.sh.b[0],re.lighting.sh.b[1],re.lighting.sh.b[2],re.lighting.sh.b[3]))]),le.code.add(B.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===de&&(le.uniforms.add([new $.J("lightingAmbientSH0",(se,re)=>(0,D.s)(X,re.lighting.sh.r[0],re.lighting.sh.g[0],re.lighting.sh.b[0])),new W.N("lightingAmbientSH_R1",(se,re)=>(0,G.s)(te,re.lighting.sh.r[1],re.lighting.sh.r[2],re.lighting.sh.r[3],re.lighting.sh.r[4])),new W.N("lightingAmbientSH_G1",(se,re)=>(0,G.s)(te,re.lighting.sh.g[1],re.lighting.sh.g[2],re.lighting.sh.g[3],re.lighting.sh.g[4])),new W.N("lightingAmbientSH_B1",(se,re)=>(0,G.s)(te,re.lighting.sh.b[1],re.lighting.sh.b[2],re.lighting.sh.b[3],re.lighting.sh.b[4])),new W.N("lightingAmbientSH_R2",(se,re)=>(0,G.s)(te,re.lighting.sh.r[5],re.lighting.sh.r[6],re.lighting.sh.r[7],re.lighting.sh.r[8])),new W.N("lightingAmbientSH_G2",(se,re)=>(0,G.s)(te,re.lighting.sh.g[5],re.lighting.sh.g[6],re.lighting.sh.g[7],re.lighting.sh.g[8])),new W.N("lightingAmbientSH_B2",(se,re)=>(0,G.s)(te,re.lighting.sh.b[5],re.lighting.sh.b[6],re.lighting.sh.b[7],re.lighting.sh.b[8]))]),le.code.add(B.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),oe.pbrMode!==Q.f7.Normal&&oe.pbrMode!==Q.f7.Schematic||le.code.add(B.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const X=(0,R.c)(),te=(0,Z.c)()},54662:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>$});var D=v(43177),R=v(17625),G=v(35387),Z=v(19755),Q=v(95808);function $(W,B){const H=W.fragment;B.receiveAmbientOcclusion?(H.uniforms.add((0,G.J)("ssaoTex",(X,te)=>te.ssaoHelper.colorTexture,B.hasWebGL2Context?Z.D.None:Z.D.InvSize)),H.constants.add("blurSizePixelsInverse","float",1/Q.s),H.code.add(R.H`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${(0,D.w_)(B,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):H.code.add(R.H`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}},13146:(nt,Ae,v)=>{"use strict";v.d(Ae,{PN:()=>ae,XP:()=>le,sC:()=>oe});var D=v(94573),R=v(44965),G=v(54662),Z=v(31166),Q=v(98898),$=v(92724),W=v(39337),B=v(78038),H=v(65787),X=v(17625),te=v(95279);function ae(de){de.constants.add("ambientBoostFactor","float",te.V)}function oe(de){de.uniforms.add(new H.p("lightingGlobalFactor",(se,re)=>re.lighting.globalFactor))}function le(de,se){const re=de.fragment;switch(de.include(G.K,se),se.pbrMode!==$.f7.Disabled&&de.include(Q.T,se),de.include(R._,se),de.include(W.e),re.code.add(X.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${se.pbrMode===$.f7.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),ae(re),oe(re),(0,Z.Pe)(re),re.code.add(X.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${se.spherical?X.H`normalize(vPosWorld)`:X.H`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),(0,Z.F1)(re),re.code.add(X.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),se.pbrMode){case $.f7.Disabled:case $.f7.WaterOnIntegratedMesh:case $.f7.Water:de.include(Z.kR,se),re.code.add(X.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case $.f7.Normal:case $.f7.Schematic:re.code.add(X.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = mainLightDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),re.code.add(X.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),se.useFillLights?re.uniforms.add(new B.U("hasFillLights",(j,Y)=>Y.enableFillLights)):re.constants.add("hasFillLights","bool",!1),re.code.add(X.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),re.uniforms.add([new H.p("lightingSpecularStrength",(j,Y)=>Y.lighting.mainLight.specularStrength),new H.p("lightingEnvironmentStrength",(j,Y)=>Y.lighting.mainLight.environmentStrength)]),re.code.add(X.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),re.code.add(X.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${se.pbrMode===$.f7.Schematic?X.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:X.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;default:(0,D.Bg)(se.pbrMode);case $.f7.COUNT:}}},45027:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>G,K:()=>R});var D=v(17625);function R(Z){Z.fragment.code.add(D.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function G(Z){Z.fragment.code.add(D.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},96896:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>R});var D=v(17625);function R(G){G.fragment.code.add(D.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},92484:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>de,C:()=>Y});var D=v(62208),R=v(19278),G=v(2166),Z=v(43177),Q=v(69960),$=v(65787),W=v(17625),B=v(35387),H=v(19755),X=v(51899),te=v(993),ae=v(4794);const le=(0,ae.c)();function de(ie,J){ie.constants.add("stippleAlphaColorDiscard","float",.001),ie.constants.add("stippleAlphaHighlightDiscard","float",.5),J.stippleEnabled?function se(ie,J){const ce=!(J.draped&&J.stipplePreferContinuous),{vertex:ue,fragment:pe}=ie;pe.include(R.n),J.draped||((0,G.hY)(ue,J),ue.uniforms.add(new $.p("worldToScreenPerDistanceRatio",(me,ge)=>1/ge.camera.perScreenPixelRatio)),ue.code.add(W.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),ie.varyings.add("vStippleDistance","float"),J.stippleRequiresClamp&&ie.varyings.add("vStippleDistanceLimits","vec2"),J.stippleRequiresStretchMeasure&&ie.varyings.add("vStipplePatternStretch","float"),ue.code.add(W.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${ee};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),ue.code.add(W.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),ue.code.add(W.H`
    if (segmentLengthPseudoScreen >= ${ce?"patternLength":"1e4"}) {
  `),ue.uniforms.add(new $.p("pixelRatio",(me,ge)=>ge.camera.pixelRatio)),ue.code.add(W.H`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${J.stippleRequiresStretchMeasure?W.H`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),pe.constants.add("stippleTexturePadding","float",X.it),pe.uniforms.add((0,B.J)("stipplePatternTexture",me=>me.stippleTexture,J.hasWebGL2Context?H.D.None:H.D.Size)),pe.uniforms.add([new $.p("stipplePatternSDFNormalizer",me=>function j(ie){return(0,D.pC)(ie)?(Math.floor(.5*((0,X.kj)(ie)-1))+.5)/ie.pixelRatio:1}(me.stipplePattern)),new $.p("stipplePatternPixelSizeInv",me=>1/Y(me))]),pe.code.add(W.H`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${(0,Z.w_)(J,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),pe.code.add(W.H`
    float getStippleSDF(out bool isClamped) {
      ${J.stippleRequiresClamp?W.H`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:W.H`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${J.stippleScaleWithLineWidth?W.H`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${J.stippleRequiresStretchMeasure?W.H`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:W.H`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${J.stippleScaleWithLineWidth?W.H`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:W.H`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),J.stippleOffColorEnabled?(pe.uniforms.add(new Q.N("stippleOffColor",me=>function oe(ie){return(0,D.Wi)(ie)?ae.Z:4===ie.length?ie:(0,te.s)(le,ie[0],ie[1],ie[2],1)}(me.stippleOffColor))),pe.code.add(W.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):pe.code.add(W.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(ie,J):function re(ie){ie.fragment.code.add(W.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(ie)}function Y(ie){const J=ie.stipplePattern;return(0,D.pC)(J)?(0,X.$A)(ie.stipplePattern)/J.pixelRatio:1}const ee=W.H.float(.4)},31166:(nt,Ae,v)=>{"use strict";v.d(Ae,{F1:()=>Q,Pe:()=>Z,kR:()=>W});var D=v(97139),R=v(65787),G=v(17625);function Z(B){B.uniforms.add(new D.J("mainLightDirection",(H,X)=>X.lighting.mainLight.direction))}function Q(B){B.uniforms.add(new D.J("mainLightIntensity",(H,X)=>X.lighting.mainLight.intensity))}function W(B,H){const X=B.fragment;Z(X),Q(X),function $(B,H){H.useLegacyTerrainShading?B.uniforms.add(new R.p("lightingFixedFactor",(X,te)=>te.lighting.noonFactor*(1-te.lighting.globalFactor))):B.constants.add("lightingFixedFactor","float",0)}(X,H),X.code.add(G.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}},50823:(nt,Ae,v)=>{"use strict";v.d(Ae,{Q:()=>$});var D=v(62208),R=v(81805),G=v(65787),Z=v(17625),Q=v(46359);function $(W,B){const H=W.vertex;W.constants.add("markerSizePerLineWidth","float",R._Z),H.uniforms.add(new G.p("pixelRatio",(X,te)=>te.camera.pixelRatio)),(0,D.Wi)(H.uniforms.get("markerScale"))&&H.constants.add("markerScale","float",1),H.code.add(Z.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),B.space===Q.I9.World&&(H.constants.add("maxSegmentLengthFraction","float",.45),H.uniforms.add(new G.p("perRenderPixelRatio",(X,te)=>te.camera.perRenderPixelRatio)),H.code.add(Z.H`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}},82793:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>Q,_:()=>$});var D=v(47923),R=v(95285),G=v(17625),Z=v(35387);function Q(W){W.include(D.S),W.uniforms.add([new Z.A("geometryDepthTexture",(B,H)=>H.multipassGeometry.linearDepthTexture),new R.A("nearFar",(B,H)=>H.camera.nearFar)]),W.code.add(G.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class ${constructor(){this.enabled=!1}}},10109:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>$,l:()=>Q});var D=v(47923),R=v(95285),G=v(17625),Z=v(35387);function Q(W,B){B.hasMultipassTerrain&&(W.fragment.include(D.S),W.fragment.uniforms.add(new Z.A("terrainDepthTexture",(H,X)=>X.multipassTerrain.linearDepthTexture)),W.fragment.uniforms.add(new R.A("nearFar",(H,X)=>X.camera.nearFar)),W.fragment.uniforms.add(new R.A("inverseViewport",(H,X)=>X.inverseViewport)),W.fragment.code.add(G.H`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${B.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class ${constructor(){this.enabled=!1,this.cullAboveGround=!1}}},7025:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>R});var D=v(17625);function R(G,Z){G.vertex.code.add(Z.spherical?D.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`:D.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),G.vertex.code.add(Z.spherical?D.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`:D.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},96395:(nt,Ae,v)=>{"use strict";v.d(Ae,{k:()=>G,q:()=>Z});var Z,Q,D=v(94573),R=v(17625);function G(Q,$){const W=Q.fragment;switch(W.code.add(R.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),$.doubleSidedMode){case Z.None:W.code.add(R.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Z.View:W.code.add(R.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Z.WindingOrder:W.code.add(R.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,D.Bg)($.doubleSidedMode);case Z.COUNT:}}(Q=Z||(Z={}))[Q.None=0]="None",Q[Q.View=1]="View",Q[Q.WindingOrder=2]="WindingOrder",Q[Q.COUNT=3]="COUNT"},98898:(nt,Ae,v)=>{"use strict";v.d(Ae,{T:()=>Q});var D=v(17625);function R($){const W=$.fragment.code;W.add(D.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),W.add(D.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),W.add(D.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var G=v(92724),Z=v(39337);function Q($,W){const B=$.fragment.code;$.include(Z.e),W.pbrMode===G.f7.Water||W.pbrMode===G.f7.WaterOnIntegratedMesh?(B.add(D.H`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${W.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),B.add(D.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),B.add(D.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),B.add(D.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),B.add(D.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):W.pbrMode!==G.f7.Normal&&W.pbrMode!==G.f7.Schematic||($.include(R),B.add(D.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),B.add(D.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),B.add(D.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),B.add(D.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),B.add(D.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),B.add(D.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},92724:(nt,Ae,v)=>{"use strict";v.d(Ae,{Fw:()=>ae,f7:()=>oe,jV:()=>de});var D=v(14658),R=v(95284),G=v(43177),Z=v(77739),Q=v(97139),$=v(17625),W=v(5864),B=v(35387),H=v(19755),X=v(37847);v(33470);const ae=(0,D.f)(0,.6,.2);var oe,se;function de(se,re){const j=se.fragment,Y=re.hasMetallicRoughnessTexture||re.hasEmissionTexture||re.hasOcclusionTexture;if(re.pbrMode===oe.Normal&&Y&&se.include(R.i,re),re.pbrMode!==oe.Schematic)if(re.pbrMode!==oe.Disabled){if(re.pbrMode===oe.Normal){j.code.add($.H`vec3 mrr;
vec3 emission;
float occlusion;`);const ee=re.supportsTextureAtlas?re.hasWebGL2Context?H.D.None:H.D.Size:H.D.None,ie=re.pbrTextureBindType;re.hasMetallicRoughnessTexture&&(j.uniforms.add(ie===X.P.Pass?(0,B.J)("texMetallicRoughness",J=>J.textureMetallicRoughness,ee):(0,W.F)("texMetallicRoughness",J=>J.textureMetallicRoughness,ee)),j.code.add($.H`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),re.hasEmissionTexture&&(j.uniforms.add(ie===X.P.Pass?(0,B.J)("texEmission",J=>J.textureEmissive,ee):(0,W.F)("texEmission",J=>J.textureEmissive,ee)),j.code.add($.H`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),re.hasOcclusionTexture?(j.uniforms.add(ie===X.P.Pass?(0,B.J)("texOcclusion",J=>J.textureOcclusion,ee):(0,W.F)("texOcclusion",J=>J.textureOcclusion,ee)),j.code.add($.H`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):j.code.add($.H`float getBakedOcclusion() { return 1.0; }`),j.uniforms.add(ie===X.P.Pass?[new Q.J("emissionFactor",J=>J.emissiveFactor),new Q.J("mrrFactors",J=>J.mrrFactors)]:[new Z.B("emissionFactor",J=>J.emissiveFactor),new Z.B("mrrFactors",J=>J.mrrFactors)]),j.code.add($.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${Y?$.H`vtc.uv = vuv0;`:""}
      ${re.hasMetallicRoughnessTextureTransform?$.H`vtc.uv = metallicRoughnessUV;`:""}
      ${re.hasMetallicRoughnessTexture?re.supportsTextureAtlas?$.H`
                vtc.size = ${(0,G.w_)(re,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:$.H`applyMetallnessAndRoughness(vtc);`:""}
      ${re.hasEmissiveTextureTransform?$.H`vtc.uv = emissiveUV;`:""}
      ${re.hasEmissionTexture?re.supportsTextureAtlas?$.H`
                vtc.size = ${(0,G.w_)(re,"texEmission")};
                applyEmission(vtc);`:$.H`applyEmission(vtc);`:""}
      ${re.hasOcclusionTextureTransform?$.H`vtc.uv = occlusionUV;`:""}
      ${re.hasOcclusionTexture?re.supportsTextureAtlas?$.H`
                vtc.size = ${(0,G.w_)(re,"texOcclusion")};
                applyOcclusion(vtc);`:$.H`applyOcclusion(vtc);`:""}
    }
  `)}}else j.code.add($.H`float getBakedOcclusion() { return 1.0; }`);else j.code.add($.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}(se=oe||(oe={}))[se.Disabled=0]="Disabled",se[se.Normal=1]="Normal",se[se.Schematic=2]="Schematic",se[se.Water=3]="Water",se[se.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",se[se.COUNT=5]="COUNT"},39337:(nt,Ae,v)=>{"use strict";v.d(Ae,{e:()=>R});var D=v(17625);function R(G){G.vertex.code.add(D.H`const float PI = 3.141592653589793;`),G.fragment.code.add(D.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},37926:(nt,Ae,v)=>{"use strict";v.d(Ae,{s:()=>X});var D=v(13934),R=v(36603),G=v(95284),Z=v(95267),Q=v(43177),$=v(17625),W=v(5864),B=v(19755),H=v(42743);function X(te,ae){const oe=te.fragment;if(!ae.hasBaseColorTexture||ae.output!==D.H.Color&&ae.alphaDiscardMode===H.JJ.Opaque)oe.code.add($.H`vec4 readBaseColorTexture() { return vec4(1.0); }`);else{te.include(G.i,ae);const le=ae.textureCoordinateType===R.N.Atlas;oe.uniforms.add((0,W.F)("baseColorTexture",de=>de.texture,le?ae.hasWebGL2Context?B.D.None:B.D.Size:B.D.None)),le?(te.include(Z.r),oe.code.add($.H`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${(0,Q.w_)(ae,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):oe.code.add($.H`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}}},72968:(nt,Ae,v)=>{"use strict";v.d(Ae,{ry:()=>oe,XE:()=>de,hb:()=>le});var D=v(28093),R=v(19278),G=v(43177),Z=v(69960),Q=v(18952),$=v(17625),W=v(85930),B=v(37847);class H extends W.x{constructor(j,Y,ee){super(j,"mat4",B.P.Draw,(ie,J,ce)=>ie.setUniformMatrix4fv(j,Y(J,ce)),ee)}}class X extends W.x{constructor(j,Y,ee){super(j,"mat4",B.P.Pass,(ie,J,ce)=>ie.setUniformMatrix4fv(j,Y(J,ce)),ee)}}var te=v(35387),ae=v(19755);class oe extends $.K{constructor(){super(...arguments),this.origin=(0,D.c)()}}function le(re,j){j.receiveShadows&&(re.fragment.uniforms.add(new X("shadowMapMatrix",(Y,ee)=>ee.shadowMap.getShadowMapMatrices(Y.origin),4)),se(re,j))}function de(re,j){j.receiveShadows&&(re.fragment.uniforms.add(new H("shadowMapMatrix",(Y,ee)=>ee.shadowMap.getShadowMapMatrices(Y.origin),4)),se(re,j))}function se(re,j){const Y=re.fragment;Y.include(R.n),Y.uniforms.add([...(0,te.J)("shadowMapTex",(ee,ie)=>ie.shadowMap.depthTexture,j.hasWebGL2Context?ae.D.None:ae.D.Size),new Q._("numCascades",(ee,ie)=>ie.shadowMap.numCascades),new Z.N("cascadeDistances",(ee,ie)=>ie.shadowMap.cascadeDistances)]),Y.code.add($.H`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${(0,G.w_)(j,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}},45867:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>H,P:()=>B});var D=v(43703),R=v(47923),G=v(95285),Z=v(65787),Q=v(17625),$=v(63123),W=v(35387);function B(X,te){const ae=X.fragment;ae.include(R.S),ae.uniforms.add(new G.A("nearFar",(oe,le)=>le.camera.nearFar)),ae.uniforms.add(new W.A("depthMap",(oe,le)=>le.linearDepthTexture)),ae.uniforms.add(new $.g("proj",(oe,le)=>le.ssr.camera.projectionMatrix)),ae.uniforms.add(new Z.p("invResolutionHeight",(oe,le)=>1/le.ssr.camera.height)),ae.uniforms.add(new $.g("reprojectionMatrix",(oe,le)=>le.ssr.reprojectionMatrix)),ae.code.add(Q.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${te.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class H{constructor(){this.reprojectionMatrix=(0,D.c)()}}},70489:(nt,Ae,v)=>{"use strict";v.d(Ae,{DT:()=>H,NI:()=>$,R5:()=>W,av:()=>Q,jF:()=>B});var D=v(62208),R=v(49966),G=v(17625),Z=v(91574);function Q(X){X.vertex.uniforms.add(new Z.c("colorTextureTransformMatrix",te=>(0,D.pC)(te.colorTextureTransformMatrix)?te.colorTextureTransformMatrix:(0,R.c)())),X.varyings.add("colorUV","vec2"),X.vertex.code.add(G.H`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function $(X){X.vertex.uniforms.add(new Z.c("normalTextureTransformMatrix",te=>(0,D.pC)(te.normalTextureTransformMatrix)?te.normalTextureTransformMatrix:(0,R.c)())),X.varyings.add("normalUV","vec2"),X.vertex.code.add(G.H`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function W(X){X.vertex.uniforms.add(new Z.c("emissiveTextureTransformMatrix",te=>(0,D.pC)(te.emissiveTextureTransformMatrix)?te.emissiveTextureTransformMatrix:(0,R.c)())),X.varyings.add("emissiveUV","vec2"),X.vertex.code.add(G.H`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function B(X){X.vertex.uniforms.add(new Z.c("occlusionTextureTransformMatrix",te=>(0,D.pC)(te.occlusionTextureTransformMatrix)?te.occlusionTextureTransformMatrix:(0,R.c)())),X.varyings.add("occlusionUV","vec2"),X.vertex.code.add(G.H`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function H(X){X.vertex.uniforms.add(new Z.c("metallicRoughnessTextureTransformMatrix",te=>(0,D.pC)(te.metallicRoughnessTextureTransformMatrix)?te.metallicRoughnessTextureTransformMatrix:(0,R.c)())),X.varyings.add("metallicRoughnessUV","vec2"),X.vertex.code.add(G.H`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}},92836:(nt,Ae,v)=>{"use strict";v.d(Ae,{k:()=>B});var D=v(97139),R=v(48565),G=v(7090),Z=v(17625),Q=v(91574),$=v(16396),W=v(41857);function B(H,X){X.hasVvInstancing&&(X.vvSize||X.vvColor)&&H.attributes.add($.T.INSTANCEFEATUREATTRIBUTE,"vec4");const te=H.vertex;X.vvSize?(te.uniforms.add(new D.J("vvSizeMinSize",ae=>ae.vvSizeMinSize)),te.uniforms.add(new D.J("vvSizeMaxSize",ae=>ae.vvSizeMaxSize)),te.uniforms.add(new D.J("vvSizeOffset",ae=>ae.vvSizeOffset)),te.uniforms.add(new D.J("vvSizeFactor",ae=>ae.vvSizeFactor)),te.uniforms.add(new Q.c("vvSymbolRotationMatrix",ae=>ae.vvSymbolRotationMatrix)),te.uniforms.add(new D.J("vvSymbolAnchor",ae=>ae.vvSymbolAnchor)),te.code.add(Z.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),te.code.add(Z.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${X.hasVvInstancing?Z.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):te.code.add(Z.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),X.vvColor?(te.constants.add("vvColorNumber","int",W.x),X.hasVvInstancing&&te.uniforms.add([new G.O("vvColorValues",ae=>ae.vvColorValues,W.x),new R.b("vvColorColors",ae=>ae.vvColorColors,W.x)]),te.code.add(Z.H`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${X.hasVvInstancing?Z.H`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):te.code.add(Z.H`vec4 vvColor() { return vec4(1.0); }`)}},69117:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>X});var D=v(45027),R=v(96896),G=v(98898),Z=v(45867),Q=v(69602),$=v(65787),W=v(17625),B=v(63123),H=v(35387);function X(te,ae){te.include(G.T,ae),te.include(R.D),te.include(D.E),ae.hasCloudsReflections&&te.include(Q.j,ae),ae.hasScreenSpaceReflections&&te.include(Z.P,ae);const oe=te.fragment;oe.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),oe.code.add(W.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),oe.uniforms.add([new $.p("lightingSpecularStrength",(le,de)=>de.lighting.mainLight.specularStrength),new $.p("lightingEnvironmentStrength",(le,de)=>de.lighting.mainLight.environmentStrength)]),oe.code.add(W.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),ae.hasCloudsReflections&&oe.code.add(W.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),ae.hasScreenSpaceReflections?(oe.uniforms.add(new B.g("view",(le,de)=>de.ssr.camera.viewMatrix)),oe.uniforms.add(new H.A("lastFrameColorMap",(le,de)=>de.ssr.lastFrameColorTexture)),oe.code.add(W.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`)):oe.code.add(W.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),oe.code.add(ae.hasCloudsReflections?ae.hasScreenSpaceReflections?W.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`:W.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`:W.H`return waterRenderedColor;
}`)}},45780:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>X});var D=v(67831),R=v(99770),G=v(993),Z=v(4794),Q=v(45027),$=v(95285),W=v(69960),B=v(17625),H=v(35387);function X(le){le.fragment.uniforms.add(new H.A("texWaveNormal",de=>de.waveNormal)),le.fragment.uniforms.add(new H.A("texWavePerturbation",de=>de.wavePertubation)),le.fragment.uniforms.add([new W.N("waveParams",de=>(0,G.s)(ae,de.waveStrength,de.waveTextureRepeat,de.flowStrength,de.flowOffset)),new $.A("waveDirection",de=>(0,D.s)(oe,de.waveDirection[0]*de.waveVelocity,de.waveDirection[1]*de.waveVelocity))]),le.include(Q.K),le.fragment.code.add(B.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const ae=(0,Z.c)(),oe=(0,R.a)()},89798:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>R});var D=v(17625);function R(G){G.code.add(D.H`
    float lineFactorAtPosition(float value) {
      float pos = value * ${D.H.float(257)};
      if(pos < 0.5 || pos > ${D.H.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}},30249:(nt,Ae,v)=>{"use strict";v.d(Ae,{IJ:()=>oe,Tw:()=>le,WB:()=>ae,gT:()=>te});var te,j,D=v(4794),R=v(65401),G=v(75224),Z=v(43553),Q=v(31166),$=v(92724),W=v(69117),B=v(90637),H=v(17625),X=v(35387);function ae(j,Y){const{vertex:ee,fragment:ie}=j;ee.uniforms.add([new B.$("overlayTexOffset",(J,ce)=>function de(j,Y){for(const ee of Y.overlays){const{index:ie,extent:J}=ee;(0,R.SO)(J)>0&&(re[2*ie]=j.toMapSpace[0]/(0,R.bf)(J)-J[0]/(0,R.bf)(J),re[2*ie+1]=j.toMapSpace[1]/(0,R.Cb)(J)-J[1]/(0,R.Cb)(J))}return re}(J,ce)),new B.$("overlayTexScale",(J,ce)=>function se(j,Y){for(const ee of Y.overlays){const{index:ie,extent:J}=ee;(0,R.SO)(J)>0&&(re[2*ie]=j.toMapSpace[2]/(0,R.bf)(J),re[2*ie+1]=j.toMapSpace[3]/(0,R.Cb)(J))}return re}(J,ce))]),ie.constants.add("overlayOpacity","float",1),ie.uniforms.add(new X.A("ovColorTex",(J,ce)=>le(J,ce))),oe(j,Y)}function oe(j,Y){j.extensions.add("GL_OES_standard_derivatives"),Y.pbrMode!==$.f7.Water&&Y.pbrMode!==$.f7.WaterOnIntegratedMesh||j.include(W.B,Y);const{vertex:ee,fragment:ie}=j;j.varyings.add("vtcOverlay","vec4"),ee.code.add(H.H`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),ie.code.add(H.H`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),ie.code.add(H.H`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),Y.pbrMode!==$.f7.Water&&Y.pbrMode!==$.f7.WaterOnIntegratedMesh||((0,Q.Pe)(ie),(0,Q.F1)(ie),ie.code.add(H.H`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function le(j,Y){return 0===Y.overlays.length?null:j.identifier===Z.o9.Material&&j.subPass===Z.zp.Color?Y.overlays[G.fu.INNER].getColorTextureNoRasterImage():j.identifier===Z.o9.Highlight?Y.overlays[G.fu.INNER].getValidTexture(G.NH.Highlight):null}(j=te||(te={}))[j.Disabled=0]="Disabled",j[j.Enabled=1]="Enabled",j[j.EnabledWithWater=2]="EnabledWithWater",j[j.COUNT=3]="COUNT";const re=(0,D.c)()},91528:(nt,Ae,v)=>{"use strict";v.d(Ae,{EK:()=>te,uS:()=>H,yl:()=>X});var D=v(75224),R=v(89798),G=v(30249),Z=v(87633),Q=v(65787),$=v(17625),W=v(35387),B=v(85930);class H extends $.K{constructor(){super(...arguments),this.overlayOpacity=1}}function X(se,re){se.vertex.uniforms.add([new le("overlayTexOffset"),new le("overlayTexScale")]),se.fragment.uniforms.add([new Q.p("overlayOpacity",j=>j.overlayOpacity),new W.A("ovColorTex",(j,Y)=>0===Y.overlays.length?null:Y.overlays[D.fu.INNER].getColorTexture(j.overlaySource))]),(0,G.IJ)(se,re)}function te(se,re){const{vertex:j,fragment:Y,varyings:ee}=se;ee.add("vtc","vec2"),j.uniforms.add(new le("texOffsetAndScale")),Y.uniforms.add(new de("tex")),Y.uniforms.add(new oe("textureOpacities"));const ie=re.textureFadingEnabled&&!re.renderOccluded;ie&&(j.uniforms.add(new le("nextTexOffsetAndScale")),ee.add("nvtc","vec2"),Y.uniforms.add(new de("texNext")),Y.uniforms.add(new oe("nextTexOpacities")),Y.uniforms.add(new ae("fadeFactor")));const J=re.tileBlendInput===Z.R.ColorComposite,ce=re.tileBlendInput===Z.R.GridComposite;ce&&Y.include(R.H),J&&Y.uniforms.add(new oe("backgroundColor")),j.code.add($.H`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${ie?$.H`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:$.H``}
  }`),Y.code.add($.H`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${ce||J?$.H`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${J?$.H`vec4(backgroundColor, 1.0)`:$.H`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:$.H`return color;`}
    }`),Y.code.add(ie?$.H`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`:$.H`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class ae extends B.x{constructor(re){super(re,"float")}}class oe extends B.x{constructor(re){super(re,"vec3")}}class le extends B.x{constructor(re){super(re,"vec4")}}class de extends B.x{constructor(re){super(re,"sampler2D")}}},87191:(nt,Ae,v)=>{"use strict";v.d(Ae,{Iu:()=>ae,lG:()=>te,m9:()=>oe,JT:()=>de}),v(28093);var R=v(7699),G=v(89798),Z=v(17625);function Q(se,re){const j=re.blendMode;j!==R.iM.Normal&&(j===R.iM.Reflect&&se.code.add(Z.H`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),j!==R.iM.ColorDodge&&j!==R.iM.VividLight||se.code.add(Z.H`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),j!==R.iM.ColorBurn&&j!==R.iM.VividLight||se.code.add(Z.H`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),j===R.iM.Overlay&&se.code.add(Z.H`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),j===R.iM.HardLight&&se.code.add(Z.H`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),j===R.iM.SoftLight&&se.code.add(Z.H`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),j===R.iM.VividLight&&se.code.add(Z.H`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),j!==R.iM.Hue&&j!==R.iM.Saturation&&j!==R.iM.Color&&j!==R.iM.Luminosity||(se.code.add(Z.H`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),j!==R.iM.Hue&&j!==R.iM.Saturation||se.code.add(Z.H`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),se.code.add(Z.H`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${j===R.iM.Multiply?Z.H`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Average?Z.H`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Lighten?Z.H`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Darken?Z.H`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Lighter?Z.H`return vec4(cl * ol + cb * ob, ol + ob);`:j===R.iM.Plus?Z.H`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:j===R.iM.Minus?Z.H`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:j===R.iM.Screen?Z.H`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Difference?Z.H`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Invert?Z.H`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:j===R.iM.DestinationOver?Z.H`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:j===R.iM.DestinationAtop?Z.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:j===R.iM.DestinationOut?Z.H`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:j===R.iM.SourceAtop?Z.H`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:j===R.iM.SourceOut?Z.H`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:j===R.iM.Xor?Z.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:j===R.iM.DestinationIn?Z.H`return vec4(cb * ob * ol, ol * ob);`:j===R.iM.SourceIn?Z.H`return vec4(cl * ol * ob, ol * ob);`:j===R.iM.Hue?Z.H`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Saturation?Z.H`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Color?Z.H`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Luminosity?Z.H`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Exclusion?Z.H`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Reflect?Z.H`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.ColorDodge?Z.H`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.ColorBurn?Z.H`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.Overlay?Z.H`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.SoftLight?Z.H`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.HardLight?Z.H`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:j===R.iM.VividLight?Z.H`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:Z.H``}
    }
  `))}var te,ae,oe,se,$=v(43177),W=v(97139),B=v(65787),H=v(35387),X=v(19755);function de(se,re){const j=re.output===te.GridComposite,Y=re.output===te.ColorComposite,ee=re.output===te.GroupBackgroundComposite,ie=re.output===te.Composite;j&&(se.extensions.add("GL_OES_standard_derivatives"),se.fragment.include(G.H)),Y&&se.fragment.uniforms.add(new W.J("backgroundColor",pe=>pe.backgroundColor));const J=re.baseOpacityMode===ae.Required;J&&se.fragment.uniforms.add(new B.p("baseOpacity",pe=>pe.baseOpacity)),ie&&se.fragment.uniforms.add((0,H.J)("fboColor",he=>he.fboTexture,re.hasWebGL2Context?X.D.None:X.D.InvSize));const ce=re.blendMode!==R.iM.Normal,ue=re.premultipliedSource===oe.On;se.fragment.include(Q,re),se.fragment.code.add(Z.H`
    vec4 getBackground(vec2 uv) {
      return ${J?Z.H`baseOpacity *`:""} ${ee?Z.H`vec4(0.0, 0.0, 0.0, 0.0)`:Y?Z.H`vec4(backgroundColor, 1.0)`:j?Z.H`gridColor(uv)`:Z.H`${(0,$.b6)(re,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${ce?Z.H`
          vec3 Cb = bgColor.a == 0.0 ? bgColor.rgb : vec3(bgColor.rgb * bgColor.a);
          return applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, bgColor.a);`:Z.H`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          return ${ue?Z.H`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:ie&&!J||ee?Z.H`pmColorLayer * composeAlpha;`:Z.H`mix(bgColor, pmColorLayer, composeAlpha);`}`}
    }`)}(se=te||(te={}))[se.Composite=0]="Composite",se[se.ColorComposite=1]="ColorComposite",se[se.GridComposite=2]="GridComposite",se[se.GroupBackgroundComposite=3]="GroupBackgroundComposite",se[se.COUNT=4]="COUNT",function(se){se[se.NotRequired=0]="NotRequired",se[se.Required=1]="Required",se[se.COUNT=2]="COUNT"}(ae||(ae={})),function(se){se[se.Off=0]="Off",se[se.On=1]="On",se[se.COUNT=2]="COUNT"}(oe||(oe={}))},87633:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{R:()=>D}),(R=D||(D={}))[R.LayerOnly=0]="LayerOnly",R[R.ColorComposite=1]="ColorComposite",R[R.GridComposite=2]="GridComposite",R[R.COUNT=3]="COUNT"},14273:(nt,Ae,v)=>{"use strict";v.d(Ae,{R:()=>$,T:()=>W});var D=v(99770),R=v(95285),G=v(65787),Z=v(17625),Q=v(16396);class $ extends Z.K{constructor(){super(...arguments),this.scale=1,this.offset=D.Z}}function W(B){B.attributes.add(Q.T.POSITION,"vec2"),B.attributes.add(Q.T.UV0,"vec2"),B.vertex.uniforms.add(new G.p("scale",H=>H.scale)),B.vertex.uniforms.add(new R.A("offset",H=>H.offset)),B.varyings.add("uv","vec2"),B.varyings.add("vuv","vec2"),B.vertex.code.add(Z.H`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}},67022:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>D,b:()=>R});const D=.1,R=.001},93609:(nt,Ae,v)=>{"use strict";v.d(Ae,{o:()=>W,z:()=>$});var D=v(49480),R=v(2163),G=v(65787),Z=v(17625),Q=v(42743);function $(H,X){B(H,X,new G.p("textureAlphaCutoff",te=>te.textureAlphaCutoff))}function W(H,X){B(H,X,new R.p("textureAlphaCutoff",te=>te.textureAlphaCutoff))}function B(H,X,te){const ae=H.fragment;switch(X.alphaDiscardMode!==Q.JJ.Mask&&X.alphaDiscardMode!==Q.JJ.MaskBlend||ae.uniforms.add(te),X.alphaDiscardMode){case Q.JJ.Blend:return H.include(D.f);case Q.JJ.Opaque:ae.code.add(Z.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Q.JJ.Mask:ae.code.add(Z.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Q.JJ.MaskBlend:H.fragment.code.add(Z.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},39832:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>B,R:()=>te});var D=v(67831),R=v(99770),G=v(993),Z=v(4794),Q=v(95285),$=v(69960),W=v(17625);function B(oe){oe.fragment.uniforms.add(new $.N("projInfo",(le,de)=>function H(oe){const le=oe.camera.projectionMatrix;return 0===le[11]?(0,G.s)(X,2/(oe.camera.fullWidth*le[0]),2/(oe.camera.fullHeight*le[5]),(1+le[12])/le[0],(1+le[13])/le[5]):(0,G.s)(X,-2/(oe.camera.fullWidth*le[0]),-2/(oe.camera.fullHeight*le[5]),(1-le[8])/le[0],(1-le[9])/le[5])}(de))),oe.fragment.uniforms.add(new Q.A("zScale",(le,de)=>te(de))),oe.fragment.code.add(W.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const X=(0,Z.c)();function te(oe){return 0===oe.camera.projectionMatrix[11]?(0,D.s)(ae,0,1):(0,D.s)(ae,1,0)}const ae=(0,R.a)()},69602:(nt,Ae,v)=>{"use strict";v.d(Ae,{j:()=>de});var D=v(21286),R=v(62208),G=v(94425),Z=v(12015),Q=v(75583),$=v(31166),W=v(78038),B=v(97139),H=v(65787),X=v(17625),te=v(63123),ae=v(85930),oe=v(37847);class le extends ae.x{constructor(re,j){super(re,"samplerCube",oe.P.Pass,(Y,ee,ie)=>Y.bindTexture(re,j(ee,ie)))}}function de(se){const re=se.fragment;re.uniforms.add([new te.g("rotationMatrixClouds",(j,Y)=>Y.cloudsFade.parallax.transform),new te.g("rotationMatrixCloudsCrossFade",(j,Y)=>Y.cloudsFade.parallaxNew.transform),new B.J("anchorPosition",(j,Y)=>Y.cloudsFade.parallax.anchorPointClouds),new B.J("anchorPositionCrossFade",(j,Y)=>Y.cloudsFade.parallaxNew.anchorPointClouds),new H.p("cloudsHeight",(j,Y)=>Y.cloudsFade.parallax.cloudsHeight),new H.p("radiusCurvatureCorrectionFactor",(j,Y)=>Y.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new H.p("totalFadeInOut",(j,Y)=>Y.cloudsFade.fadeInOut.stage===Z.co.FINISHED?Y.cloudsFade.fadeInOutHeight.factor+1-Y.cloudsFade.fadeIn.factor:Y.cloudsFade.fadeInOutHeight.factor+1-Y.cloudsFade.fadeInOut.factor),new H.p("crossFadeAnchorFactor",(j,Y)=>(0,D.uZ)(Y.cloudsFade.crossFade.factor,0,1)),new le("cubeMap",(j,Y)=>(0,R.pC)(Y.cloudsFade.data)&&(0,R.pC)(Y.cloudsFade.data.cubeMap)?Y.cloudsFade.data.cubeMap.colorTexture:null),new W.U("crossFade",(j,Y)=>Y.cloudsFade.crossFade.enabled),new W.U("readChannelsRG",(j,Y)=>Y.cloudsFade.readChannels===Q.uz.RG),new W.U("fadeTextureChannels",(j,Y)=>Y.cloudsFade.renderingStage===Q.jL.FADING_TEXTURE_CHANNELS)]),re.constants.add("planetRadius","float",G.sv.radius),re.code.add(X.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),re.code.add(X.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),re.code.add(X.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,$.Pe)(re),(0,$.F1)(re),re.code.add(X.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),re.code.add(X.H`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),re.code.add(X.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),re.code.add(X.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),re.code.add(X.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}},33726:(nt,Ae,v)=>{"use strict";v.d(Ae,{Y:()=>R});var D=v(17625);function R(G){G.code.add(D.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},49480:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>G});var D=v(67022),R=v(17625);function G(Z){Z.fragment.code.add(R.H`
    #define discardOrAdjustAlpha(color) { if (color.a < ${R.H.float(D.b)}) { discard; } }
  `)}},7228:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>G,I:()=>Z});var D=v(8314),R=v(17625);function G({code:Q},$){Q.add($.doublePrecisionRequiresObfuscation?R.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`:R.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function Z(Q){return!!(0,D.Z)("force-double-precision-obfuscation")||Q.driverTest.doublePrecisionRequiresObfuscation}},22799:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>R,j:()=>G});var R,Z,D=v(37053);function G(Z){return Z&&(0,D.BZ)(Z)?R.Mars:Z&&(0,D.V2)(Z)?R.Moon:R.Earth}(Z=R||(R={}))[Z.Earth=1]="Earth",Z[Z.Mars=2]="Mars",Z[Z.Moon=3]="Moon",Z[Z.COUNT=4]="COUNT"},28137:(nt,Ae,v)=>{"use strict";v.d(Ae,{y:()=>Z});var D=v(9044),R=v(33726),G=v(17625);function Z(Q){Q.include(R.Y),Q.code.add(G.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${G.H.int(D.a9.Multiply)}) {
        return allMixed;
      }
      if (mode == ${G.H.int(D.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${G.H.int(D.a9.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${G.H.int(D.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${G.H.int(D.a9.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},19278:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>R});var D=v(17625);function R(G){G.code.add(D.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},71850:(nt,Ae,v)=>{"use strict";v.d(Ae,{cK:()=>Q,m8:()=>W,ww:()=>$});var D=v(993),R=v(4794),G=v(69960),Z=v(17625);function Q(X){X.vertex.code.add(Z.H`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),X.vertex.code.add(Z.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),X.vertex.code.add(Z.H`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),X.vertex.code.add(Z.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),X.vertex.code.add(Z.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),X.vertex.code.add(Z.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),X.vertex.code.add(Z.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function $(X){X.uniforms.add(new G.N("screenSizePerspective",te=>B(te.screenSizePerspective)))}function W(X){X.uniforms.add(new G.N("screenSizePerspectiveAlignment",te=>B(te.screenSizePerspectiveAlignment||te.screenSizePerspective)))}function B(X){return(0,D.s)(H,X.parameters.divisor,X.parameters.offset,X.parameters.minPixelSize,X.paddingPixelsOverride)}const H=(0,R.c)()},95267:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>R});var D=v(17625);function R(G){G.extensions.add("GL_EXT_shader_texture_lod"),G.extensions.add("GL_OES_standard_derivatives"),G.fragment.code.add(D.H`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},2166:(nt,Ae,v)=>{"use strict";v.d(Ae,{Sv:()=>X,_8:()=>oe,hY:()=>H});var D=v(28347),R=v(55494),G=v(84161),Z=v(28093),Q=v(77739),$=v(97139),W=v(47205),B=v(63123);function H(le,de){de.instancedDoublePrecision?le.constants.add("cameraPosition","vec3",Z.Z):le.uniforms.add(new Q.B("cameraPosition",(se,re)=>(0,G.s)(ae,re.camera.viewInverseTransposeMatrix[3]-se.origin[0],re.camera.viewInverseTransposeMatrix[7]-se.origin[1],re.camera.viewInverseTransposeMatrix[11]-se.origin[2])))}function X(le,de){if(!de.instancedDoublePrecision)return void le.uniforms.add([new B.g("proj",(re,j)=>j.camera.projectionMatrix),new W.K("view",(re,j)=>(0,D.v)(te,j.camera.viewMatrix,re.origin)),new Q.B("localOrigin",re=>re.origin)]);const se=re=>(0,G.s)(ae,re.camera.viewInverseTransposeMatrix[3],re.camera.viewInverseTransposeMatrix[7],re.camera.viewInverseTransposeMatrix[11]);le.uniforms.add([new B.g("proj",(re,j)=>j.camera.projectionMatrix),new B.g("view",(re,j)=>(0,D.v)(te,j.camera.viewMatrix,se(j))),new $.J("localOrigin",(re,j)=>se(j))])}const te=(0,R.c)(),ae=(0,Z.c)();function oe(le){le.uniforms.add(new B.g("viewNormal",(de,se)=>se.camera.viewInverseTransposeMatrix))}},43177:(nt,Ae,v)=>{"use strict";v.d(Ae,{aU:()=>G,b6:()=>Q,o_:()=>R,w_:()=>Z});var D=v(17625);const R="Size",G="InvSize";function Z($,W,B=!1,H=0){if($.hasWebGL2Context){const X=D.H`vec2(textureSize(${W}, ${D.H.int(H)}))`;return B?"(1.0 / "+X+")":X}return B?W+G:W+R}function Q($,W,B,H=null,X=0){if($.hasWebGL2Context)return D.H`texelFetch(${W}, ivec2(${B}), ${D.H.int(X)})`;let te=D.H`texture2D(${W}, ${B} * `;return te+=H?D.H`(${H}))`:D.H`${W+G})`,te}},78038:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"bool",R.P.Pass,(W,B,H)=>W.setUniform1b(Q,$(B,H)))}}},32181:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec2",R.P.Draw,(W,B,H,X)=>W.setUniform2fv(Q,$(B,H,X)))}}},95285:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec2",R.P.Pass,(W,B,H)=>W.setUniform2fv(Q,$(B,H)))}}},77739:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec3",R.P.Draw,(W,B,H,X)=>W.setUniform3fv(Q,$(B,H,X)))}}},97139:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec3",R.P.Pass,(W,B,H)=>W.setUniform3fv(Q,$(B,H)))}}},90637:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec4",R.P.Draw,(W,B,H)=>W.setUniform4fv(Q,$(B,H)))}}},69960:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"vec4",R.P.Pass,(W,B,H)=>W.setUniform4fv(Q,$(B,H)))}}},48565:(nt,Ae,v)=>{"use strict";v.d(Ae,{b:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$,W){super(Q,"vec4",R.P.Pass,(B,H,X)=>B.setUniform4fv(Q,$(H,X)),W)}}},2163:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"float",R.P.Draw,(W,B,H)=>W.setUniform1f(Q,$(B,H)))}}},65787:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"float",R.P.Pass,(W,B,H)=>W.setUniform1f(Q,$(B,H)))}}},7090:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$,W){super(Q,"float",R.P.Pass,(B,H,X)=>B.setUniform1fv(Q,$(H,X)),W)}}},18952:(nt,Ae,v)=>{"use strict";v.d(Ae,{_:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"int",R.P.Pass,(W,B,H)=>W.setUniform1i(Q,$(B,H)))}}},9546:(nt,Ae,v)=>{"use strict";v.d(Ae,{j:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"mat3",R.P.Draw,(W,B,H)=>W.setUniformMatrix3fv(Q,$(B,H)))}}},91574:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"mat3",R.P.Pass,(W,B,H)=>W.setUniformMatrix3fv(Q,$(B,H)))}}},47205:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"mat4",R.P.Draw,(W,B,H)=>W.setUniformMatrix4fv(Q,$(B,H)))}}},63123:(nt,Ae,v)=>{"use strict";v.d(Ae,{g:()=>G});var D=v(85930),R=v(37847);class G extends D.x{constructor(Q,$){super(Q,"mat4",R.P.Pass,(W,B,H)=>W.setUniformMatrix4fv(Q,$(B,H)))}}},22355:(nt,Ae,v)=>{"use strict";v.d(Ae,{kG:()=>$});var D=v(26584),R=v(63290),G=v(62208);const Z=R.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Q{constructor(){this._includedModules=new Map}include(re,j){if(this._includedModules.has(re)){const Y=this._includedModules.get(re);if(Y!==j){Z.error("Trying to include shader module multiple times with different sets of options.");const ee=new Set;for(const ie of Object.keys(Y))Y[ie]!==re[ie]&&ee.add(ie);for(const ie of Object.keys(re))Y[ie]!==re[ie]&&ee.add(ie);ee.forEach(ie=>console.error(`  ${ie}: current ${Y[ie]} new ${re[ie]}`))}}else this._includedModules.set(re,j),re(this.builder,j)}}class $ extends Q{constructor(){super(...arguments),this.vertex=new H,this.fragment=new H,this.attributes=new X,this.varyings=new te,this.extensions=new ae,this.constants=new oe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(re){const j=this.extensions.generateSource(re),Y=this.attributes.generateSource(re),ee=this.varyings.generateSource(),ie="vertex"===re?this.vertex:this.fragment,J=ie.uniforms.generateSource(),ce=ie.code.generateSource(),ue="vertex"===re?de:le,pe=this.constants.generateSource().concat(ie.constants.generateSource());return`\n${j.join("\n")}\n\n${ue}\n\n${pe.join("\n")}\n\n${J.join("\n")}\n\n${Y.join("\n")}\n\n${ee.join("\n")}\n\n${ce.join("\n")}`}generateBind(re,j){const Y=new Map;this.vertex.uniforms.entries.forEach(J=>{const ce=J.bind[re];(0,G.pC)(ce)&&Y.set(J.name,ce)}),this.fragment.uniforms.entries.forEach(J=>{const ce=J.bind[re];(0,G.pC)(ce)&&Y.set(J.name,ce)});const ee=Array.from(Y.values()),ie=ee.length;return(J,ce,ue)=>{for(let pe=0;pe<ie;++pe)ee[pe](j,J,ce,ue)}}}class W{constructor(){this._entries=new Map}add(re){if(!Array.isArray(re))return this._add(re);for(const j of re)this._add(j)}get(re){return this._entries.get(re)}_add(re){if((0,G.Wi)(re))Z.error(`Trying to add null Uniform from ${(new Error).stack}.`);else{if(this._entries.has(re.name)&&!this._entries.get(re.name).equals(re))throw new D.Z(`Duplicate uniform name ${re.name} for different uniform type`);this._entries.set(re.name,re)}}generateSource(){return Array.from(this._entries.values()).map(re=>(0,G.pC)(re.arraySize)?`uniform ${re.type} ${re.name}[${re.arraySize}];`:`uniform ${re.type} ${re.name};`)}get entries(){return Array.from(this._entries.values())}}class B{constructor(){this._entries=new Array}add(re){this._entries.push(re)}generateSource(){return this._entries}}class H extends Q{constructor(){super(...arguments),this.uniforms=new W,this.code=new B,this.constants=new oe}get builder(){return this}}class X{constructor(){this._entries=new Array}add(re,j){this._entries.push([re,j])}generateSource(re){return"fragment"===re?[]:this._entries.map(j=>`attribute ${j[1]} ${j[0]};`)}}class te{constructor(){this._entries=new Array}add(re,j){this._entries.push([re,j])}generateSource(){return this._entries.map(re=>`varying ${re[1]} ${re[0]};`)}}class ae{constructor(){this._entries=new Set}add(re){this._entries.add(re)}generateSource(re){const j="vertex"===re?ae.ALLOWLIST_VERTEX:ae.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(Y=>j.includes(Y)).map(Y=>`#extension ${Y} : enable`)}}ae.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],ae.ALLOWLIST_VERTEX=[];class oe{constructor(){this._entries=new Set}add(re,j,Y){let ee="ERROR_CONSTRUCTOR_STRING";switch(j){case"float":ee=oe._numberToFloatStr(Y);break;case"int":ee=oe._numberToIntStr(Y);break;case"bool":ee=Y.toString();break;case"vec2":ee=`vec2(${oe._numberToFloatStr(Y[0])},                            ${oe._numberToFloatStr(Y[1])})`;break;case"vec3":ee=`vec3(${oe._numberToFloatStr(Y[0])},                            ${oe._numberToFloatStr(Y[1])},                            ${oe._numberToFloatStr(Y[2])})`;break;case"vec4":ee=`vec4(${oe._numberToFloatStr(Y[0])},                            ${oe._numberToFloatStr(Y[1])},                            ${oe._numberToFloatStr(Y[2])},                            ${oe._numberToFloatStr(Y[3])})`;break;case"ivec2":ee=`ivec2(${oe._numberToIntStr(Y[0])},                             ${oe._numberToIntStr(Y[1])})`;break;case"ivec3":ee=`ivec3(${oe._numberToIntStr(Y[0])},                             ${oe._numberToIntStr(Y[1])},                             ${oe._numberToIntStr(Y[2])})`;break;case"ivec4":ee=`ivec4(${oe._numberToIntStr(Y[0])},                             ${oe._numberToIntStr(Y[1])},                             ${oe._numberToIntStr(Y[2])},                             ${oe._numberToIntStr(Y[3])})`;break;case"mat2":case"mat3":case"mat4":ee=`${j}(${Array.prototype.map.call(Y,ie=>oe._numberToFloatStr(ie)).join(", ")})`}return this._entries.add(`const ${j} ${re} = ${ee};`),this}static _numberToIntStr(re){return re.toFixed(0)}static _numberToFloatStr(re){return Number.isInteger(re)?re.toFixed(1):re.toString()}generateSource(){return Array.from(this._entries)}}const le="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",de="precision highp float;\nprecision highp sampler2D;"},5864:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>X,R:()=>H});var D=v(62208),R=v(67831),G=v(99770),Z=v(43177),Q=v(32181),$=v(19755),W=v(85930),B=v(37847);class H extends W.x{constructor(oe,le){super(oe,"sampler2D",B.P.Draw,(de,se,re)=>de.bindTexture(oe,le(se,re)))}}function X(ae,oe,le=$.D.None){const de=[new H(ae,oe)];return le&$.D.Size&&de.push(new Q.q(ae+Z.o_,(re,j)=>{const Y=oe(re,j);return(0,D.pC)(Y)?(0,R.s)(te,Y.descriptor.width,Y.descriptor.height):G.Z})),le&$.D.InvSize&&de.push(new Q.q(ae+Z.aU,(re,j)=>{const Y=oe(re,j);return(0,D.pC)(Y)?(0,R.s)(te,1/Y.descriptor.width,1/Y.descriptor.height):G.Z})),de}const te=(0,G.a)()},35387:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>H,J:()=>X});var D=v(62208),R=v(67831),G=v(99770),Z=v(43177),Q=v(95285),$=v(19755),W=v(85930),B=v(37847);class H extends W.x{constructor(oe,le){super(oe,"sampler2D",B.P.Pass,(de,se,re)=>de.bindTexture(oe,le(se,re)))}}function X(ae,oe,le=$.D.None){const de=[new H(ae,oe)];return le&$.D.Size&&de.push(new Q.A(ae+Z.o_,(re,j)=>{const Y=oe(re,j);return(0,D.pC)(Y)?(0,R.s)(te,Y.descriptor.width,Y.descriptor.height):G.Z})),le&$.D.InvSize&&de.push(new Q.A(ae+Z.aU,(re,j)=>{const Y=oe(re,j);return(0,D.pC)(Y)?(0,R.s)(te,1/Y.descriptor.width,1/Y.descriptor.height):G.Z})),de}const te=(0,G.a)()},19755:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{D:()=>D}),(R=D||(D={}))[R.None=0]="None",R[R.Size=1]="Size",R[R.InvSize=2]="InvSize"},85930:(nt,Ae,v)=>{"use strict";v.d(Ae,{x:()=>G});var D=v(62208),R=v(37847);class G{constructor(Q,$,W,B,H=null){this.name=Q,this.type=$,this.arraySize=H,this.bind={[R.P.Pass]:null,[R.P.Draw]:null},(0,D.pC)(W)&&(0,D.pC)(B)&&(this.bind[W]=B)}equals(Q){return this.type===Q.type&&this.name===Q.name&&this.arraySize===Q.arraySize}}},17625:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>R,K:()=>D});class D{}function R(G,...Z){let Q="";for(let $=0;$<Z.length;$++)Q+=G[$]+Z[$];return Q+=G[G.length-1],Q}var G;(G=R||(R={})).int=function Z($){return Math.round($).toString()},G.float=function Q($){return $.toPrecision(8)}},37847:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{P:()=>D}),(R=D||(D={}))[R.Pass=0]="Pass",R[R.Draw=1]="Draw"},651:(nt,Ae,v)=>{"use strict";v.d(Ae,{J:()=>R});var D=v(15861);class R{constructor(Z,Q){this._module=Z,this._loadModule=Q}get(){return this._module}reload(){var Z=this;return(0,D.Z)(function*(){return Z._module=yield Z._loadModule(),Z._module})()}}},91056:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>G});var D=v(62208),R=v(67969);class G{constructor(Q,$,W){this.release=W,this.initializeConfiguration(Q,$),this._configuration=$.snapshot(),this._program=this.initializeProgram(Q),this._pipeline=this.initializePipeline(Q.rctx.capabilities)}destroy(){this._program=(0,D.M2)(this._program),this._pipeline=this._configuration=null}reload(Q){(0,D.M2)(this._program),this._program=this.initializeProgram(Q),this._pipeline=this.initializePipeline(Q.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(Q,$=null,W){Q.setPipelineState(this.getPipelineState($,W))}ensureAttributeLocations(Q){this.program.assertCompatibleVertexAttributeLocations(Q)}get primitiveType(){return R.MX.TRIANGLES}getPipelineState(Q,$){return this._pipeline}initializeConfiguration(Q,$){}}},87601:(nt,Ae,v)=>{"use strict";v.d(Ae,{m:()=>D,o:()=>R});class D{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const Z=this._parameterNames,Q={key:this.key};for(const $ of Z)Q[$]=this[$];return Q}}function R(G={}){return(Z,Q)=>{if(Z._parameterNames=Z._parameterNames??[],Z._parameterNames.push(Q),null!=G.constValue)Object.defineProperty(Z,Q,{get:()=>G.constValue});else{const $=Z._parameterNames.length-1,B=Math.ceil(Math.log2(G.count||2)),H=Z._parameterBits??[0];let X=0;for(;H[X]+B>16;)X++,X>=H.length&&H.push(0);Z._parameterBits=H;const te=H[X],ae=(1<<B)-1<<te;H[X]+=B,Object.defineProperty(Z,Q,{get(){return this[$]},set(oe){if(this[$]!==oe&&(this[$]=oe,this._keyDirty=!0,this._parameterBits[X]=this._parameterBits[X]&~ae|+oe<<te&ae,"number"!=typeof oe&&"boolean"!=typeof oe))throw"Configuration value for "+Q+" must be boolean or number, got "+typeof oe}})}}}},45323:(nt,Ae,v)=>{"use strict";v.d(Ae,{M:()=>Q});var D=v(15861),R=v(62208),G=v(1101),Z=v(87601);class Q{constructor(X){this._context=X,this._perConstructorInstances=new G.r,this._frameCounter=0,this._keepAliveFrameCount=W}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(X=>X.forEach(te=>te.technique.destroy())),this._perConstructorInstances.clear()}acquire(X,te=B){const ae=te.key;let oe=this._perConstructorInstances.get(X,ae);if((0,R.Wi)(oe)){const le=new X(this._context,te,()=>this.release(le));oe=new $(le),this._perConstructorInstances.set(X,ae,oe)}return++oe.refCount,oe.technique}releaseAndAcquire(X,te,ae){if((0,R.pC)(ae)){if(te.key===ae.key)return ae;this.release(ae)}return this.acquire(X,te)}release(X){if((0,R.Wi)(X)||this._perConstructorInstances.empty)return;const te=this._perConstructorInstances.get(X.constructor,X.key);(0,R.Wi)(te)||(--te.refCount,0===te.refCount&&(te.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==W&&this._perConstructorInstances.forEach((X,te)=>{X.forEach((ae,oe)=>{0===ae.refCount&&ae.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(ae.technique.destroy(),this._perConstructorInstances.delete(te,oe))})})}reloadAll(){var X=this;return(0,D.Z)(function*(){const te=new Array;X._perConstructorInstances.forEach((ae,oe)=>{const le=function(){var de=(0,D.Z)(function*(se,re){const j=re.shader;j&&(yield j.reload(),se.forEach(Y=>Y.technique.reload(X._context)))});return function(re,j){return de.apply(this,arguments)}}();te.push(le(ae,oe))}),yield Promise.all(te)})()}}class ${constructor(X){this.technique=X,this.refCount=0,this.refZeroFrame=0}}const W=-1,B=new Z.m},42836:(nt,Ae,v)=>{"use strict";v.d(Ae,{d:()=>R});var D=v(27422);class R{constructor(){this.enabled=!0,this._time=(0,D.HA)(0)}get time(){return this._time}advance(Z){return this._time!==Z.time&&(this._time=Z.time,!0)}}},2286:(nt,Ae,v)=>{"use strict";v.d(Ae,{TF:()=>D,Xn:()=>R,gT:()=>G});const D=Z=>class Q extends Z{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const W of this._managedDisposables??[]){const B=this[W];this[W]=null,B&&"function"==typeof B.dispose&&B.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class R extends(D(class{})){}function G(){return(Z,Q)=>{Z.hasOwnProperty("_managedDisposables")||(Z._managedDisposables=Z._managedDisposables?.slice()??[]),Z._managedDisposables?.unshift(Q)}}},13756:(nt,Ae,v)=>{"use strict";v.d(Ae,{fX:()=>Y,pk:()=>ie,$u:()=>le,_h:()=>de,$8:()=>ae});var D=v(15861),R=v(62208),G=v(54346);function Z(){if((0,R.Wi)(Q)){const ue=pe=>(0,G.V)(`esri/libs/basisu/${pe}`);Q=v.e(2405).then(v.bind(v,52405)).then(pe=>pe.b).then(({default:pe})=>pe({locateFile:ue}).then(he=>(he.initializeBasis(),delete he.then,he)))}return Q}let Q;var $,ue;(ue=$||($={}))[ue.ETC1_RGB=0]="ETC1_RGB",ue[ue.ETC2_RGBA=1]="ETC2_RGBA",ue[ue.BC1_RGB=2]="BC1_RGB",ue[ue.BC3_RGBA=3]="BC3_RGBA",ue[ue.BC4_R=4]="BC4_R",ue[ue.BC5_RG=5]="BC5_RG",ue[ue.BC7_M6_RGB=6]="BC7_M6_RGB",ue[ue.BC7_M5_RGBA=7]="BC7_M5_RGBA",ue[ue.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",ue[ue.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",ue[ue.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",ue[ue.ATC_RGB=11]="ATC_RGB",ue[ue.ATC_RGBA=12]="ATC_RGBA",ue[ue.FXT1_RGB=17]="FXT1_RGB",ue[ue.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",ue[ue.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",ue[ue.ETC2_EAC_R11=20]="ETC2_EAC_R11",ue[ue.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",ue[ue.RGBA32=13]="RGBA32",ue[ue.RGB565=14]="RGB565",ue[ue.BGR565=15]="BGR565",ue[ue.RGBA4444=16]="RGBA4444";var W=v(67969),B=v(55086),H=v(26906);let X=null,te=null;function ae(){return oe.apply(this,arguments)}function oe(){return(oe=(0,D.Z)(function*(){return(0,R.Wi)(te)&&(te=Z(),X=yield te),te})).apply(this,arguments)}function le(ue,pe){if((0,R.Wi)(X))return ue.byteLength;const he=new X.BasisFile(new Uint8Array(ue)),me=re(he)?se(he.getNumLevels(0),he.getHasAlpha(),he.getImageWidth(0,0),he.getImageHeight(0,0),pe):0;return he.close(),he.delete(),me}function de(ue,pe){if((0,R.Wi)(X))return ue.byteLength;const he=new X.KTX2File(new Uint8Array(ue)),me=j(he)?se(he.getLevels(),he.getHasAlpha(),he.getWidth(),he.getHeight(),pe):0;return he.close(),he.delete(),me}function se(ue,pe,he,me,ge){const _e=(0,H.RG)(pe?W.q_.COMPRESSED_RGBA8_ETC2_EAC:W.q_.COMPRESSED_RGB8_ETC2);return Math.ceil(he*me*_e*(ge&&ue>1?(4**ue-1)/(3*4**(ue-1)):1))}function re(ue){return ue.getNumImages()>=1&&!ue.isUASTC()}function j(ue){return ue.getFaces()>=1&&ue.isETC1S()}function Y(ue,pe,he){return ee.apply(this,arguments)}function ee(){return ee=(0,D.Z)(function*(ue,pe,he){(0,R.Wi)(X)&&(X=yield ae());const me=new X.BasisFile(new Uint8Array(he));if(!re(me))return null;me.startTranscoding();const ge=ce(ue,pe,me.getNumLevels(0),me.getHasAlpha(),me.getImageWidth(0,0),me.getImageHeight(0,0),(_e,Ee)=>me.getImageTranscodedSizeInBytes(0,_e,Ee),(_e,Ee,De)=>me.transcodeImage(De,0,_e,Ee,0,0));return me.close(),me.delete(),ge}),ee.apply(this,arguments)}function ie(ue,pe,he){return J.apply(this,arguments)}function J(){return J=(0,D.Z)(function*(ue,pe,he){(0,R.Wi)(X)&&(X=yield ae());const me=new X.KTX2File(new Uint8Array(he));if(!j(me))return null;me.startTranscoding();const ge=ce(ue,pe,me.getLevels(),me.getHasAlpha(),me.getWidth(),me.getHeight(),(_e,Ee)=>me.getImageTranscodedSizeInBytes(_e,0,0,Ee),(_e,Ee,De)=>me.transcodeImage(De,_e,0,0,Ee,0,-1,-1));return me.close(),me.delete(),ge}),J.apply(this,arguments)}function ce(ue,pe,he,me,ge,_e,Ee,De){const{compressedTextureETC:be,compressedTextureS3TC:Se}=ue.capabilities,[ye,ve]=be?me?[$.ETC2_RGBA,W.q_.COMPRESSED_RGBA8_ETC2_EAC]:[$.ETC1_RGB,W.q_.COMPRESSED_RGB8_ETC2]:Se?me?[$.BC3_RGBA,W.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[$.BC1_RGB,W.q_.COMPRESSED_RGB_S3TC_DXT1_EXT]:[$.RGBA32,W.VI.RGBA],xe=pe.hasMipmap?he:Math.min(1,he),ze=[];for(let Be=0;Be<xe;Be++)ze.push(new Uint8Array(Ee(Be,ye))),De(Be,ye,ze[Be]);const Ke=ze.length>1,We=Ke?W.cw.LINEAR_MIPMAP_LINEAR:W.cw.LINEAR,Ce={...pe,samplingMode:We,hasMipmap:Ke,internalFormat:ve,width:ge,height:_e};return new B.x(ue,Ce,{type:"compressed",levels:ze})}},74202:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>B});var D=v(99770),R=v(12015),G=v(82793),Z=v(10109),Q=v(45867),$=v(5894),W=v(95279);class B{constructor(X,te,ae){this.shadowMap=X,this.ssaoHelper=te,this.slicePlane=ae,this.slot=$.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=(0,D.a)(),this.oldLighting=new W.c,this.newLighting=new W.c,this._fadedLighting=new W.c,this._lighting=this.newLighting,this.ssr=new Q.O,this.multipassTerrain=new Z.a,this.multipassGeometry=new G._,this.overlays=[],this.cloudsFade=new R.ii}get camera(){return this._camera}set camera(X){this._camera=this.ssr.camera=X,this._inverseViewport[0]=1/X.fullViewport[2],this._inverseViewport[1]=1/X.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(X){const{oldLighting:te,newLighting:ae}=this;X>=1?this._lighting=ae:(this._fadedLighting.lerpLighting(te,ae,X),this._lighting=this._fadedLighting)}}},98565:(nt,Ae,v)=>{"use strict";v.d(Ae,{j:()=>Q});var D=v(77029),R=v(84161),G=v(28093),Z=v(2282);class Q{constructor(B,H,X,te){this.primitiveIndices=B,this._numIndexPerPrimitive=H,this.indices=X,this.position=te,this.center=(0,G.c)(),this._children=void 0,(0,Z.hu)(B.length>=1),(0,Z.hu)(X.length%this._numIndexPerPrimitive==0),(0,Z.hu)(X.length>=B.length*this._numIndexPerPrimitive),(0,Z.hu)(3===te.size||4===te.size);const{data:ae,size:oe}=te,le=B.length;let de=oe*X[this._numIndexPerPrimitive*B[0]];$.clear(),$.push(de),this.bbMin=(0,G.f)(ae[de],ae[de+1],ae[de+2]),this.bbMax=(0,G.a)(this.bbMin);for(let re=0;re<le;++re){const j=this._numIndexPerPrimitive*B[re];for(let Y=0;Y<this._numIndexPerPrimitive;++Y){de=oe*X[j+Y],$.push(de);let ee=ae[de];this.bbMin[0]=Math.min(ee,this.bbMin[0]),this.bbMax[0]=Math.max(ee,this.bbMax[0]),ee=ae[de+1],this.bbMin[1]=Math.min(ee,this.bbMin[1]),this.bbMax[1]=Math.max(ee,this.bbMax[1]),ee=ae[de+2],this.bbMin[2]=Math.min(ee,this.bbMin[2]),this.bbMax[2]=Math.max(ee,this.bbMax[2])}}(0,R.h)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let se=this.radius*this.radius;for(let re=0;re<$.length;++re){de=$.getItemAt(re);const j=ae[de]-this.center[0],Y=ae[de+1]-this.center[1],ee=ae[de+2]-this.center[2],ie=j*j+Y*Y+ee*ee;if(ie<=se)continue;const J=Math.sqrt(ie),ce=.5*(J-this.radius);this.radius=this.radius+ce,se=this.radius*this.radius;const ue=ce/J;this.center[0]+=j*ue,this.center[1]+=Y*ue,this.center[2]+=ee*ue}$.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if((0,R.d)(this.bbMin,this.bbMax)>1){const B=(0,R.h)((0,G.c)(),this.bbMin,this.bbMax,.5),H=this.primitiveIndices.length,X=new Uint8Array(H),te=new Array(8);for(let se=0;se<8;++se)te[se]=0;const{data:ae,size:oe}=this.position;for(let se=0;se<H;++se){let re=0;const j=this._numIndexPerPrimitive*this.primitiveIndices[se];let Y=oe*this.indices[j],ee=ae[Y],ie=ae[Y+1],J=ae[Y+2];for(let ce=1;ce<this._numIndexPerPrimitive;++ce){Y=oe*this.indices[j+ce];const ue=ae[Y],pe=ae[Y+1],he=ae[Y+2];ue<ee&&(ee=ue),pe<ie&&(ie=pe),he<J&&(J=he)}ee<B[0]&&(re|=1),ie<B[1]&&(re|=2),J<B[2]&&(re|=4),X[se]=re,++te[re]}let le=0;for(let se=0;se<8;++se)te[se]>0&&++le;if(le<2)return;const de=new Array(8);for(let se=0;se<8;++se)de[se]=te[se]>0?new Uint32Array(te[se]):void 0;for(let se=0;se<8;++se)te[se]=0;for(let se=0;se<H;++se){const re=X[se];de[re][te[re]++]=this.primitiveIndices[se]}this._children=new Array(8);for(let se=0;se<8;++se)void 0!==de[se]&&(this._children[se]=new Q(de[se],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){$.prune()}}const $=new D.Z({deallocator:null})},59856:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>ue,V:()=>j});var D=v(63290),R=v(21286),G=v(62208),Z=v(23841),Q=v(28347),$=v(43703),W=v(67831),B=v(99770),H=v(84161),X=v(28093),te=v(993),ae=v(4794),oe=v(8834),le=v(70562),de=v(34054),se=v(59617),re=v(2282);class j{constructor(he=null,me=null,ge=null){this._viewUp=(0,X.c)(),this._viewForward=(0,X.c)(),this._viewRight=(0,X.c)(),this._ray=(0,le.Ue)(),this._viewport=(0,ae.f)(0,0,1,1),this._padding=(0,ae.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,B.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,$.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,$.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,$.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,$.c)(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=(0,oe.Ue)(),this._fullViewport=(0,ae.c)(),this._pixelRatio=1,this.relativeElevation=0,(0,G.pC)(he)&&(0,H.c)(this._ray.origin,he),this._center=(0,G.pC)(me)?(0,X.a)(me):(0,X.c)(),this._up=(0,G.pC)(ge)?(0,X.a)(ge):(0,X.f)(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(he){this._pixelRatio=he>0?he:1}get eye(){return this._ray.origin}set eye(he){this._compareAndSetView(he,this._ray.origin)}get center(){return this._center}set center(he){this._compareAndSetView(he,this._center)}get ray(){return(0,H.b)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(he){this._compareAndSetView(he,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(he){(0,Q.c)(this._viewMatrix,he),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(he){this._nearFar[0]!==he&&(this._nearFar[0]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(he){this._nearFar[1]!==he&&(this._nearFar[1]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(he){this.x=he[0],this.y=he[1],this.width=he[2],this.height=he[3]}get x(){return this._viewport[0]}set x(he){this._viewport[0]!==(he+=this._padding[ue.LEFT])&&(this._viewport[0]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(he){this._viewport[1]!==(he+=this._padding[ue.BOTTOM])&&(this._viewport[1]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(he){this._viewport[2]!==he&&(this._viewport[2]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(he){this._viewport[3]!==he&&(this._viewport[3]=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[ue.RIGHT]+this._padding[ue.LEFT]}set fullWidth(he){this.width=he-(this._padding[ue.RIGHT]+this._padding[ue.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ue.TOP]+this._padding[ue.BOTTOM]}set fullHeight(he){this.height=he-(this._padding[ue.TOP]+this._padding[ue.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ue.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ue.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(he){this._padding[ue.TOP]===he[ue.TOP]&&this._padding[ue.RIGHT]===he[ue.RIGHT]&&this._padding[ue.BOTTOM]===he[ue.BOTTOM]&&this._padding[ue.LEFT]===he[ue.LEFT]||(this._viewport[0]+=he[ue.LEFT]-this._padding[ue.LEFT],this._viewport[1]+=he[ue.BOTTOM]-this._padding[ue.BOTTOM],this._viewport[2]-=he[ue.RIGHT]+he[ue.LEFT]-(this._padding[ue.RIGHT]+this._padding[ue.LEFT]),this._viewport[3]-=he[ue.TOP]+he[ue.BOTTOM]-(this._padding[ue.TOP]+this._padding[ue.BOTTOM]),(0,te.c)(this._padding,he),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,Q.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const he=this.width,me=this.height,ge=this.near*Math.tan(this.fovY/2),_e=ge*this.aspect;(0,Q.p)(this._projectionMatrix,-_e*(1+2*this._padding[ue.LEFT]/he),_e*(1+2*this._padding[ue.RIGHT]/he),-ge*(1+2*this._padding[ue.BOTTOM]/me),ge*(1+2*this._padding[ue.TOP]/me),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return(0,G.Wi)(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=(0,$.c)()),this._inverseProjectionDirty&&(0,Q.a)(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(he){(0,Q.c)(this._projectionMatrix,he),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(he){this._fov=he,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,re.tM)(this._fov,this.width,this.height)}set fovX(he){this._fov=(0,re.Kj)(he,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,re.RQ)(this._fov,this.width,this.height)}set fovY(he){this._fov=(0,re.zF)(he,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,H.i)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,Q.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,Q.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(he){return 2*this.near*this.far/(this.far+this.near-(2*he-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}copyFrom(he){(0,H.c)(this._ray.origin,he.eye),(0,H.c)(this._center,he.center),(0,H.c)(this._up,he.up),(0,te.c)(this._viewport,he.viewport),(0,te.c)(this._padding,he.padding),(0,W.c)(this._nearFar,he.nearFar),this._fov=he.fov,this.relativeElevation=he.relativeElevation;const me=he;return this._viewDirty=me._viewDirty,this._viewDirty||((0,Q.c)(this._viewMatrix,he.viewMatrix),(0,H.c)(this._viewRight,he.viewRight),(0,H.c)(this._viewUp,he.viewUp),(0,H.c)(this._viewForward,he.viewForward)),me._projectionDirty?this._projectionDirty=!0:((0,Q.c)(this._projectionMatrix,he.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=me._frustumDirty,this._frustumDirty||((0,oe.JG)(this._frustum,he.frustum),this._frustumDirty=!1),me._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,Q.c)(this._viewInverseTransposeMatrix,he.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,te.c)(this._fullViewport,he.fullViewport),this._pixelRatio=he.pixelRatio,this}copyViewFrom(he){this.eye=he.eye,this.center=he.center,this.up=he.up}clone(){return(new j).copyFrom(this)}equals(he){return(0,H.k)(this.eye,he.eye)&&(0,H.k)(this._center,he.center)&&(0,H.k)(this._up,he.up)&&(0,te.g)(this._viewport,he.viewport)&&(0,te.g)(this._padding,he.padding)&&(0,W.m)(this._nearFar,he.nearFar)&&this._fov===he.fov&&this._pixelRatio===he.pixelRatio&&this.relativeElevation===he.relativeElevation}almostEquals(he){if(this._pixelRatio!==he.pixelRatio||Math.abs(he.fov-this._fov)>=.001)return!1;(0,H.y)(ie,he.eye,he.center),(0,H.y)(J,this.eye,this._center);const _e=(0,H.e)(ie,J),Ee=(0,H.D)(ie),De=(0,H.D)(J);return _e*_e>=(1-1e-10)*Ee*De&&(0,H.E)(he.eye,this.eye)<5e-4*Math.max(Ee,De)*5e-4&&(0,te.i)(he.padding,this._padding)<.5&&(0,te.i)(he.viewport,this._viewport)<.5}computeRenderPixelSizeAt(he){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(he))}computeRenderPixelSizeAtDist(he){return he*this.perRenderPixelRatio}computeScreenPixelSizeAt(he){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(he))}_viewDirectionDistance(he){return Math.abs((0,de.SR)(this.viewForward,(0,H.b)(ie,he,this.eye)))}computeScreenPixelSizeAtDist(he){return he*this.perScreenPixelRatio}computeDistanceFromRadius(he,me){return he/Math.tan(Math.min(this.fovX,this.fovY)/(2*(me||1)))}getScreenCenter(he=(0,Z.s1)()){return he[0]=(this.padding[ue.LEFT]+this.width/2)/this._pixelRatio,he[1]=(this.padding[ue.TOP]+this.height/2)/this._pixelRatio,he}getRenderCenter(he,me=.5,ge=.5){return he[0]=this.padding[ue.LEFT]+this.width*me,he[1]=this.padding[ue.BOTTOM]+this.height*ge,he[2]=.5,he}setGLViewport(he){const me=this.viewport,ge=this.padding;he.setViewport(me[0]-ge[3],me[1]-ge[2],me[2]+ge[1]+ge[3],me[3]+ge[0]+ge[2])}applyProjection(he,me){he!==Y&&(0,H.c)(Y,he),Y[3]=1,(0,te.t)(Y,Y,this.projectionMatrix);const ge=Math.abs(Y[3]);(0,H.g)(Y,Y,1/ge);const _e=this.fullViewport;me[0]=(0,R.t7)(0,_e[0]+_e[2],.5+.5*Y[0]),me[1]=(0,R.t7)(0,_e[1]+_e[3],.5+.5*Y[1]),me[2]=.5*(Y[2]+1),me[3]=ge}unapplyProjection(he,me){const ge=this.fullViewport;Y[0]=(he[0]/(ge[0]+ge[2])*2-1)*he[3],Y[1]=(he[1]/(ge[1]+ge[3])*2-1)*he[3],Y[2]=(2*he[2]-1)*he[3],Y[3]=he[3],(0,te.t)(Y,Y,this.inverseProjectionMatrix),me[0]=Y[0],me[1]=Y[1],me[2]=Y[2]}projectToScreen(he,me){return this.projectToRenderScreen(he,ce),this.renderToScreen(ce,me),me}projectToRenderScreen(he,me){if(Y[0]=he[0],Y[1]=he[1],Y[2]=he[2],Y[3]=1,(0,te.t)(Y,Y,this.viewProjectionMatrix),0===Y[3])return null;(0,H.g)(Y,Y,1/Math.abs(Y[3]));const ge=this.fullViewport;return"x"in me?(me.x=(0,R.t7)(0,ge[0]+ge[2],.5+.5*Y[0]),me.y=(0,R.t7)(0,ge[1]+ge[3],.5+.5*Y[1])):(me[0]=(0,R.t7)(0,ge[0]+ge[2],.5+.5*Y[0]),me[1]=(0,R.t7)(0,ge[1]+ge[3],.5+.5*Y[1]),me.length>2&&(me[2]=.5*(Y[2]+1))),me}unprojectFromScreen(he,me){return this.unprojectFromRenderScreen(this.screenToRender(he,ce),me)}unprojectFromRenderScreen(he,me){if((0,Q.m)(ee,this.projectionMatrix,this.viewMatrix),!(0,Q.a)(ee,ee))return null;const ge=this.fullViewport;return Y[0]=2*(he[0]-ge[0])/ge[2]-1,Y[1]=2*(he[1]-ge[1])/ge[3]-1,Y[2]=2*he[2]-1,Y[3]=1,(0,te.t)(Y,Y,ee),0===Y[3]?null:(me[0]=Y[0]/Y[3],me[1]=Y[1]/Y[3],me[2]=Y[2]/Y[3],me)}constrainWindowSize(he,me,ge,_e=ge){const Ee=he*this._pixelRatio,De=me*this._pixelRatio,be=Math.max(Ee-ge/2,0),Se=Math.max(this.fullHeight-De-_e/2,0),ye=-Math.min(Ee-ge/2,0),ve=-Math.min(this.fullHeight-De-_e/2,0);return[be,Se,ge-ye- -Math.min(this.fullWidth-Ee-ge/2,0),_e-ve- -Math.min(De-_e/2,0)]}computeUp(he){he===se.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(he,me){const _e=this.fullHeight-he[1]*this._pixelRatio;return me[0]=he[0]*this._pixelRatio,me[1]=_e,me}renderToScreen(he,me){const _e=(this.fullHeight-he[1])/this._pixelRatio;me[0]=he[0]/this._pixelRatio,me[1]=_e}_computeUpGlobal(){(0,H.b)(ie,this.center,this.eye);const he=(0,H.l)(this.center);he<1?((0,H.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,H.e)(ie,this.center))>.9999*(0,H.l)(ie)*he||((0,H.f)(this._up,ie,this.center),(0,H.f)(this._up,this._up,ie),(0,H.n)(this._up,this._up),this._markViewDirty())}_computeUpLocal(){(0,H.r)(ie,this.eye,this.center),Math.abs(ie[2])<=.9999&&((0,H.g)(ie,ie,ie[2]),(0,H.s)(this._up,-ie[0],-ie[1],1-ie[2]),(0,H.n)(this._up,this._up),this._markViewDirty())}_compareAndSetView(he,me){"number"==typeof he[0]&&isFinite(he[0])&&"number"==typeof he[1]&&isFinite(he[1])&&"number"==typeof he[2]&&isFinite(he[2])?(0,H.k)(he,me)||((0,H.c)(me,he),this._markViewDirty()):D.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,oe.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,Q.q)(this._viewMatrix,this.eye,this._center,this._up),(0,H.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,H.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,H.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Y=(0,ae.c)(),ee=(0,$.c)(),ie=(0,X.c)(),J=(0,X.c)(),ce=(0,Z.J$)();var ue,pe;(pe=ue||(ue={}))[pe.TOP=0]="TOP",pe[pe.RIGHT=1]="RIGHT",pe[pe.BOTTOM=2]="BOTTOM",pe[pe.LEFT=3]="LEFT"},26594:(nt,Ae,v)=>{"use strict";v.d(Ae,{as:()=>R,t9:()=>Z});var D=v(77029);class R{constructor(){this.adds=new D.Z,this.removes=new D.Z,this.updates=new D.Z({allocator:$=>$||new G,deallocator:$=>($.renderGeometry=null,$)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class G{}class Z{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},12699:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>R});var D=v(86236);class R{constructor(){this.id=(0,D.D)()}unload(){}}},24425:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{U:()=>D}),(R=D||(D={}))[R.Layer=0]="Layer",R[R.Object=1]="Object",R[R.Geometry=2]="Geometry",R[R.Material=3]="Material",R[R.Texture=4]="Texture",R[R.COUNT=5]="COUNT"},39114:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>R});var D=v(16396);const R=new Map([[D.T.POSITION,0],[D.T.NORMAL,1],[D.T.UV0,2],[D.T.COLOR,3],[D.T.SIZE,4],[D.T.TANGENT,4],[D.T.AUXPOS1,5],[D.T.SYMBOLCOLOR,5],[D.T.AUXPOS2,6],[D.T.FEATUREATTRIBUTE,6],[D.T.INSTANCEFEATUREATTRIBUTE,6],[D.T.INSTANCECOLOR,7],[D.T.OBJECTANDLAYERIDCOLOR,7],[D.T.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[D.T.MODEL,8],[D.T.MODELNORMAL,12],[D.T.MODELORIGINHI,11],[D.T.MODELORIGINLO,15]])},59631:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bn:()=>H,QI:()=>B});var D=v(16396),R=v(67969),G=v(40852);new G.G(D.T.POSITION,3,R.g.FLOAT,0,12),new G.G(D.T.POSITION,3,R.g.FLOAT,0,20),new G.G(D.T.UV0,2,R.g.FLOAT,12,20),new G.G(D.T.POSITION,3,R.g.FLOAT,0,32),new G.G(D.T.NORMAL,3,R.g.FLOAT,12,32),new G.G(D.T.UV0,2,R.g.FLOAT,24,32),new G.G(D.T.POSITION,3,R.g.FLOAT,0,16),new G.G(D.T.COLOR,4,R.g.UNSIGNED_BYTE,12,16);const B=[new G.G(D.T.POSITION,2,R.g.FLOAT,0,8)],H=[new G.G(D.T.POSITION,2,R.g.FLOAT,0,16),new G.G(D.T.UV0,2,R.g.FLOAT,8,16)]},60881:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>R});var D=v(42743);class R{constructor(Z){this._material=Z.material,this._techniqueRepository=Z.techniqueRep,this._output=Z.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(Z,Q,$=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(Z,this._material.getConfiguration($,Q),this._technique),this._technique}ensureResources(Z){return D.Rw.LOADED}}},50907:(nt,Ae,v)=>{"use strict";v.d(Ae,{h:()=>Q});var D=v(63290),R=v(62208),G=v(1101),Z=v(2282);class Q{constructor(B,H,X,te){this._textureRepository=B,this._techniqueRepository=H,this.materialChanged=X,this.requestRender=te,this._id2glMaterialRef=new G.r}dispose(){this._textureRepository.dispose()}acquire(B,H,X){if(this._ownMaterial(B),!B.requiresSlot(H,X))return null;let te=this._id2glMaterialRef.get(X,B.id);if((0,R.Wi)(te)){const ae=B.createGLMaterial({material:B,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:X});te=new $(ae),this._id2glMaterialRef.set(X,B.id,te)}return te.ref(),te.glMaterial}release(B,H){const X=this._id2glMaterialRef.get(H,B.id);(0,R.pC)(X)&&(X.unref(),X.referenced||((0,R.M2)(X.glMaterial),this._id2glMaterialRef.delete(H,B.id)))}_ownMaterial(B){(0,R.pC)(B.repository)&&B.repository!==this&&D.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),B.repository=this}}class ${constructor(B){this.glMaterial=B,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,Z.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}},32393:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>G});var D=v(62208),R=v(42743);class G{constructor(Q,$){this._material=Q,this._repository=$,this._map=new Map}destroy(){this._map.forEach((Q,$)=>{(0,D.pC)(Q)&&this._repository.release(this._material,$)})}load(Q,$,W){if(!this._material.requiresSlot($,W))return null;this._map.has(W)||this._map.set(W,this._repository.acquire(this._material,$,W));const B=this._map.get(W);if((0,D.pC)(B)){if(B.ensureResources(Q)===R.Rw.LOADED)return B;this._repository.requestRender()}return null}}},33470:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>W,F:()=>$});var D=v(62208),R=v(10699),G=v(17625),Z=v(42743),Q=v(60881);class $ extends Q.Z{constructor(H){super(H),this._numLoading=0,this._disposed=!1,this._textureRepository=H.textureRep,this._textureId=H.textureId,this._acquire(H.textureId,X=>this._texture=X),this._acquire(H.normalTextureId,X=>this._textureNormal=X),this._acquire(H.emissiveTextureId,X=>this._textureEmissive=X),this._acquire(H.occlusionTextureId,X=>this._textureOcclusion=X),this._acquire(H.metallicRoughnessTextureId,X=>this._textureMetallicRoughness=X)}dispose(){this._texture=(0,D.RY)(this._texture),this._textureNormal=(0,D.RY)(this._textureNormal),this._textureEmissive=(0,D.RY)(this._textureEmissive),this._textureOcclusion=(0,D.RY)(this._textureOcclusion),this._textureMetallicRoughness=(0,D.RY)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(H){return 0===this._numLoading?Z.Rw.LOADED:Z.Rw.LOADING}get textureBindParameters(){return new W((0,D.pC)(this._texture)?this._texture.glTexture:null,(0,D.pC)(this._textureNormal)?this._textureNormal.glTexture:null,(0,D.pC)(this._textureEmissive)?this._textureEmissive.glTexture:null,(0,D.pC)(this._textureOcclusion)?this._textureOcclusion.glTexture:null,(0,D.pC)(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(H){((0,D.Wi)(this._texture)||H!==this._texture.id)&&(this._texture=(0,D.RY)(this._texture),this._textureId=H,this._acquire(this._textureId,X=>this._texture=X))}_acquire(H,X){if((0,D.Wi)(H))return void X(null);const te=this._textureRepository.acquire(H);if((0,R.y8)(te))return++this._numLoading,void te.then(ae=>{if(this._disposed)return(0,D.RY)(ae),void X(null);X(ae)}).finally(()=>--this._numLoading);X(te)}}class W extends G.K{constructor(H=null,X=null,te=null,ae=null,oe=null){super(),this.texture=H,this.textureNormal=X,this.textureEmissive=te,this.textureOcclusion=ae,this.textureMetallicRoughness=oe}}},52107:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>X});var D=v(62208),R=v(42743),G=v(98565),Z=v(12699),Q=v(24425),$=v(36848),W=v(37187),B=v(2282),H=v(16396);class X extends Z.c{constructor(oe,le=[],de=R.MX.Triangle,se=null,re=-1){super(),this._primitiveType=de,this.objectAndLayerIdColor=se,this.edgeIndicesLength=re,this.type=Q.U.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[j,Y]of oe)Y&&this._vertexAttributes.set(j,{...Y});if(null==le||0===le.length){const j=function te(ae){const oe=ae.values().next().value;return null==oe?0:oe.data.length/oe.size}(this._vertexAttributes),Y=(0,W.p)(j);this.edgeIndicesLength=this.edgeIndicesLength<0?j:this.edgeIndicesLength;for(const ee of this._vertexAttributes.keys())this._indices.set(ee,Y)}else for(const[j,Y]of le)Y&&(this._indices.set(j,(0,W.mi)(Y)),j===H.T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(j).length:this.edgeIndicesLength))}cloneShallow(){const oe=new X([],void 0,this._primitiveType,this.objectAndLayerIdColor,void 0),{_vertexAttributes:le,_indices:de}=oe;return this._vertexAttributes.forEach((se,re)=>le.set(re,se)),this._indices.forEach((se,re)=>de.set(re,se)),oe.screenToWorldRatio=this.screenToWorldRatio,oe._boundingInfo=this._boundingInfo,oe}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(oe){const le=this._vertexAttributes.get(oe);return le&&!le.exclusive&&(le.data=Array.from(le.data),le.exclusive=!0),le}get indices(){return this._indices}get indexCount(){const oe=this._indices.values().next().value;return oe?oe.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return(0,D.Wi)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(oe){return this.primitiveType===R.MX.Triangle?this._computeAttachmentOriginTriangles(oe):this._computeAttachmentOriginPoints(oe)}_computeAttachmentOriginTriangles(oe){const le=this.indices.get(H.T.POSITION),de=this.vertexAttributes.get(H.T.POSITION);return(0,$.cM)(de,le,oe)}_computeAttachmentOriginPoints(oe){const le=this.indices.get(H.T.POSITION),de=this.vertexAttributes.get(H.T.POSITION);return(0,$.NO)(de,le,oe)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const oe=this.indices.get(H.T.POSITION);if(!oe||0===oe.length)return null;const le=this.primitiveType===R.MX.Triangle?3:1;(0,B.hu)(oe.length%le==0,"Indexing error: "+oe.length+" not divisible by "+le);const de=(0,W.p)(oe.length/le),se=this.vertexAttributes.get(H.T.POSITION);return se?new G.j(de,le,oe,se):null}}},24260:(nt,Ae,v)=>{"use strict";v.d(Ae,{k:()=>Q});var D=v(62208),R=v(27899),G=v(86236),Z=v(84161);class Q{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(W,B,H,X,te,ae){this.id=(0,G.D)(),this.geometry=W,this.material=B,this.transformation=H,this.instanceParameters=X,this.origin=te,this._shaderTransformation=ae,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return(0,D.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(W){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,W):this.geometry.computeAttachmentOrigin(W))&&((0,Z.m)(W,W,this.getStaticTransformation()),!0)}}Q.pool=new R.Z(Q)},57521:(nt,Ae,v)=>{"use strict";v.d(Ae,{Cr:()=>ye,IG:()=>se,QL:()=>me,nb:()=>ge,B2:()=>re,DA:()=>be,x2:()=>Ee,dV:()=>ie,mj:()=>ee,rh:()=>De,PI:()=>Y,g7:()=>he,AW:()=>j,Ay:()=>xe});var W,We,D=v(84161),R=v(14658),G=v(28093),Z=v(90014),Q=v(70562),$=v(42743);(We=W||(W={})).length=function Ce(He,Ie){const Ge=He[Ie],Pe=He[Ie+1],Le=He[Ie+2];return Math.sqrt(Ge*Ge+Pe*Pe+Le*Le)},We.normalize=function Be(He,Ie){const Ge=He[Ie],Pe=He[Ie+1],Le=He[Ie+2],Me=1/Math.sqrt(Ge*Ge+Pe*Pe+Le*Le);He[Ie]*=Me,He[Ie+1]*=Me,He[Ie+2]*=Me},We.scale=function Fe(He,Ie,Ge){He[Ie]*=Ge,He[Ie+1]*=Ge,He[Ie+2]*=Ge},We.add=function je(He,Ie,Ge,Pe,Le,Me=Ie){(Le=Le||He)[Me]=He[Ie]+Ge[Pe],Le[Me+1]=He[Ie+1]+Ge[Pe+1],Le[Me+2]=He[Ie+2]+Ge[Pe+2]},We.subtract=function Re(He,Ie,Ge,Pe,Le,Me=Ie){(Le=Le||He)[Me]=He[Ie]-Ge[Pe],Le[Me+1]=He[Ie+1]-Ge[Pe+1],Le[Me+2]=He[Ie+2]-Ge[Pe+2]};var B=v(52107),H=v(37187),X=v(2282),te=v(16396);const ae=W;var oe,le,de;(function(We){const Be=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Fe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],je=[0,0,1,0,1,1,0,1],Re=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],He=new Array(36);for(let Pe=0;Pe<6;Pe++)for(let Le=0;Le<6;Le++)He[6*Pe+Le]=Pe;const Ie=new Array(36);for(let Pe=0;Pe<6;Pe++)Ie[6*Pe+0]=0,Ie[6*Pe+1]=1,Ie[6*Pe+2]=2,Ie[6*Pe+3]=2,Ie[6*Pe+4]=3,Ie[6*Pe+5]=0;We.createGeometry=function Ge(Pe){Array.isArray(Pe)||(Pe=[Pe,Pe,Pe]);const Le=new Array(24);for(let Me=0;Me<8;Me++)Le[3*Me]=Be[Me][0]*Pe[0],Le[3*Me+1]=Be[Me][1]*Pe[1],Le[3*Me+2]=Be[Me][2]*Pe[2];return new B.Z([[te.T.POSITION,{size:3,data:Le,exclusive:!0}],[te.T.NORMAL,{size:3,data:Fe}],[te.T.UV0,{size:2,data:je}]],[[te.T.POSITION,Re],[te.T.NORMAL,He],[te.T.UV0,Ie]])}})(oe||(oe={})),function(We){const Be=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Fe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],je=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Re=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];We.createGeometry=function He(Ie){Array.isArray(Ie)||(Ie=[Ie,Ie,Ie]);const Ge=new Array(18);for(let Pe=0;Pe<6;Pe++)Ge[3*Pe]=Be[Pe][0]*Ie[0],Ge[3*Pe+1]=Be[Pe][1]*Ie[1],Ge[3*Pe+2]=Be[Pe][2]*Ie[2];return new B.Z([[te.T.POSITION,{size:3,data:Ge,exclusive:!0}],[te.T.NORMAL,{size:3,data:Fe}]],[[te.T.POSITION,je],[te.T.NORMAL,Re]])}}(le||(le={})),function(We){const Fe=(0,R.f)(-.5,0,-.5),je=(0,R.f)(.5,0,-.5),Re=(0,R.f)(0,0,.5),He=(0,R.f)(0,.5,0),Ie=(0,R.c)(),Ge=(0,R.c)(),Pe=(0,R.c)(),Le=(0,R.c)(),Me=(0,R.c)();(0,D.b)(Ie,Fe,He),(0,D.b)(Ge,Fe,je),(0,D.f)(Pe,Ie,Ge),(0,D.n)(Pe,Pe),(0,D.b)(Ie,je,He),(0,D.b)(Ge,je,Re),(0,D.f)(Le,Ie,Ge),(0,D.n)(Le,Le),(0,D.b)(Ie,Re,He),(0,D.b)(Ge,Re,Fe),(0,D.f)(Me,Ie,Ge),(0,D.n)(Me,Me);const Ne=[Fe,je,Re,He],Xe=[0,-1,0,Pe[0],Pe[1],Pe[2],Le[0],Le[1],Le[2],Me[0],Me[1],Me[2]],Ye=[0,1,2,3,1,0,3,2,1,3,0,2],Je=[0,0,0,1,1,1,2,2,2,3,3,3];We.createGeometry=function rt(tt){Array.isArray(tt)||(tt=[tt,tt,tt]);const et=new Array(12);for(let qe=0;qe<4;qe++)et[3*qe]=Ne[qe][0]*tt[0],et[3*qe+1]=Ne[qe][1]*tt[1],et[3*qe+2]=Ne[qe][2]*tt[2];return new B.Z([[te.T.POSITION,{size:3,data:et,exclusive:!0}],[te.T.NORMAL,{size:3,data:Xe}]],[[te.T.POSITION,Ye],[te.T.NORMAL,Je]])}}(de||(de={}));const se=oe.createGeometry,re=le.createGeometry,j=de.createGeometry;function Y(We,Ce,Be,Fe={uv:!0}){const je=-Math.PI,Re=2*Math.PI,He=-Math.PI/2,Ie=Math.PI,Ge=Math.max(3,Math.floor(Ce)),Pe=Math.max(2,Math.floor(Be)),Le=(Ge+1)*(Pe+1),Me=new Float32Array(3*Le),Ne=new Float32Array(3*Le),Xe=new Float32Array(2*Le),Ye=[];let Je=0;for(let qe=0;qe<=Pe;qe++){const ot=[],ut=qe/Pe,_t=He+ut*Ie,Ct=Math.cos(_t);for(let vt=0;vt<=Ge;vt++){const Lt=vt/Ge,jt=je+Lt*Re,$t=Math.cos(jt)*Ct,Wt=Math.sin(_t),pr=-Math.sin(jt)*Ct;Me[3*Je]=$t*We,Me[3*Je+1]=Wt*We,Me[3*Je+2]=pr*We,Ne[3*Je]=$t,Ne[3*Je+1]=Wt,Ne[3*Je+2]=pr,Xe[2*Je]=Lt,Xe[2*Je+1]=ut,ot.push(Je),++Je}Ye.push(ot)}const rt=new Array;for(let qe=0;qe<Pe;qe++)for(let ot=0;ot<Ge;ot++){const ut=Ye[qe][ot],_t=Ye[qe][ot+1],Ct=Ye[qe+1][ot+1],vt=Ye[qe+1][ot];0===qe?(rt.push(ut),rt.push(Ct),rt.push(vt)):qe===Pe-1?(rt.push(ut),rt.push(_t),rt.push(Ct)):(rt.push(ut),rt.push(_t),rt.push(Ct),rt.push(Ct),rt.push(vt),rt.push(ut))}const tt=[[te.T.POSITION,rt],[te.T.NORMAL,rt]],et=[[te.T.POSITION,{size:3,data:Me,exclusive:!0}],[te.T.NORMAL,{size:3,data:Ne,exclusive:!0}]];return Fe.uv&&(et.push([te.T.UV0,{size:2,data:Xe,exclusive:!0}]),tt.push([te.T.UV0,rt])),Fe.offset&&(tt[0][0]=te.T.OFFSET,et[0][0]=te.T.OFFSET,tt.push([te.T.POSITION,new Array(rt.length).fill(0)]),et.push([te.T.POSITION,{size:3,data:Float64Array.from(Fe.offset),exclusive:!0}])),new B.Z(et,tt)}function ee(We,Ce,Be){const Fe=We;let je,Re;if(Be)je=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Re=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const Me=Fe*(1+Math.sqrt(5))/2;je=[-Fe,Me,0,Fe,Me,0,-Fe,-Me,0,Fe,-Me,0,0,-Fe,Me,0,Fe,Me,0,-Fe,-Me,0,Fe,-Me,Me,0,-Fe,Me,0,Fe,-Me,0,-Fe,-Me,0,Fe],Re=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let Me=0;Me<je.length;Me+=3)ae.scale(je,Me,We/ae.length(je,Me));let He={};function Ie(Me,Ne){Me>Ne&&([Me,Ne]=[Ne,Me]);const Xe=Me.toString()+"."+Ne.toString();if(He[Xe])return He[Xe];let Ye=je.length;return je.length+=3,ae.add(je,3*Me,je,3*Ne,je,Ye),ae.scale(je,Ye,We/ae.length(je,Ye)),Ye/=3,He[Xe]=Ye,Ye}for(let Me=0;Me<Ce;Me++){const Ne=Re.length,Xe=new Array(4*Ne);for(let Ye=0;Ye<Ne;Ye+=3){const Je=Re[Ye],rt=Re[Ye+1],tt=Re[Ye+2],et=Ie(Je,rt),qe=Ie(rt,tt),ot=Ie(tt,Je),ut=4*Ye;Xe[ut]=Je,Xe[ut+1]=et,Xe[ut+2]=ot,Xe[ut+3]=rt,Xe[ut+4]=qe,Xe[ut+5]=et,Xe[ut+6]=tt,Xe[ut+7]=ot,Xe[ut+8]=qe,Xe[ut+9]=et,Xe[ut+10]=qe,Xe[ut+11]=ot}Re=Xe,He={}}const Ge=new Float32Array(je);for(let Me=0;Me<Ge.length;Me+=3)ae.normalize(Ge,Me);const Pe=[[te.T.POSITION,Re],[te.T.NORMAL,Re]],Le=[[te.T.POSITION,{size:3,data:new Float32Array(je),exclusive:!0}],[te.T.NORMAL,{size:3,data:Ge,exclusive:!0}]];return new B.Z(Le,Pe)}function ie(We,Ce,Be,Fe,je,Re,He,Ie){const Ne=[[te.T.POSITION,{size:3,data:Ce?[Ce[0],Ce[1],Ce[2]]:[0,0,0],exclusive:!0}],[te.T.NORMAL,{size:3,data:We?[We[0],We[1],We[2]]:[0,0,1],exclusive:!0}],[te.T.UV0,{size:(Re=Re||[0,0]).length,data:Re}],[te.T.COLOR,{size:4,data:Be?[255*Be[0],255*Be[1],255*Be[2],Be.length>3?255*Be[3]:255]:[255,255,255,255],exclusive:!0}],[te.T.SIZE,{size:2,data:null!=Fe&&2===Fe.length?Fe:[1,1]}]];if(null!=je){const Xe=new Float32Array([je[0],je[1],je[2],je[3]]);Ne.push([te.T.AUXPOS1,{size:4,data:Xe}])}if(null!=He){const Xe=new Float32Array([He[0],He[1],He[2],He[3]]);Ne.push([te.T.AUXPOS2,{size:4,data:Xe}])}return new B.Z(Ne,null,$.MX.Point,Ie)}const pe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function he(We=pe){const Ce=new Array(12);for(let Pe=0;Pe<4;Pe++)for(let Le=0;Le<3;Le++)Ce[3*Pe+Le]=We[Pe][Le];const Be=[0,1,2,2,3,0],je=[0,0,0,0,0,0];return new B.Z([[te.T.POSITION,{size:3,data:Ce,exclusive:!0}],[te.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[te.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[te.T.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[te.T.POSITION,Be],[te.T.NORMAL,je],[te.T.UV0,Be],[te.T.COLOR,je]])}function me(We,Ce,Be,Fe,je=!0,Re=!0){let He=0;const Ie=Ce,Ge=We;let Pe=(0,R.f)(0,He,0),Le=(0,R.f)(0,He+Ge,0),Me=(0,R.f)(0,-1,0),Ne=(0,R.f)(0,1,0);Fe&&(He=Ge,Le=(0,R.f)(0,0,0),Pe=(0,R.f)(0,He,0),Me=(0,R.f)(0,1,0),Ne=(0,R.f)(0,-1,0));const Xe=[Le,Pe],Ye=[Me,Ne],Je=Be+2,rt=Math.sqrt(Ge*Ge+Ie*Ie);if(Fe)for(let Ct=Be-1;Ct>=0;Ct--){const vt=Ct*(2*Math.PI/Be),Lt=(0,R.f)(Math.cos(vt)*Ie,He,Math.sin(vt)*Ie);Xe.push(Lt);const jt=(0,R.f)(Ge*Math.cos(vt)/rt,-Ie/rt,Ge*Math.sin(vt)/rt);Ye.push(jt)}else for(let Ct=0;Ct<Be;Ct++){const vt=Ct*(2*Math.PI/Be),Lt=(0,R.f)(Math.cos(vt)*Ie,He,Math.sin(vt)*Ie);Xe.push(Lt);const jt=(0,R.f)(Ge*Math.cos(vt)/rt,Ie/rt,Ge*Math.sin(vt)/rt);Ye.push(jt)}const tt=new Array,et=new Array;if(je){for(let Ct=3;Ct<Xe.length;Ct++)tt.push(1),tt.push(Ct-1),tt.push(Ct),et.push(0),et.push(0),et.push(0);tt.push(Xe.length-1),tt.push(2),tt.push(1),et.push(0),et.push(0),et.push(0)}if(Re){for(let Ct=3;Ct<Xe.length;Ct++)tt.push(Ct),tt.push(Ct-1),tt.push(0),et.push(Ct),et.push(Ct-1),et.push(1);tt.push(0),tt.push(2),tt.push(Xe.length-1),et.push(1),et.push(2),et.push(Ye.length-1)}const qe=new Float32Array(3*Je);for(let Ct=0;Ct<Je;Ct++)qe[3*Ct]=Xe[Ct][0],qe[3*Ct+1]=Xe[Ct][1],qe[3*Ct+2]=Xe[Ct][2];const ot=new Float32Array(3*Je);for(let Ct=0;Ct<Je;Ct++)ot[3*Ct]=Ye[Ct][0],ot[3*Ct+1]=Ye[Ct][1],ot[3*Ct+2]=Ye[Ct][2];return new B.Z([[te.T.POSITION,{size:3,data:qe,exclusive:!0}],[te.T.NORMAL,{size:3,data:ot,exclusive:!0}]],[[te.T.POSITION,tt],[te.T.NORMAL,et]])}function ge(We,Ce,Be,Fe,je,Re){const He=Fe?(0,R.b)(Fe):(0,R.f)(1,0,0),Ie=je?(0,R.b)(je):(0,R.f)(0,0,0);Re=Re??!0;const Ge=(0,R.c)();(0,D.n)(Ge,He);const Pe=(0,R.c)();(0,D.g)(Pe,Ge,Math.abs(We));const Le=(0,R.c)();(0,D.g)(Le,Pe,-.5),(0,D.a)(Le,Le,Ie);const Me=(0,R.f)(0,1,0);Math.abs(1-(0,D.e)(Ge,Me))<.2&&(0,D.s)(Me,0,0,1);const Ne=(0,R.c)();(0,D.f)(Ne,Ge,Me),(0,D.n)(Ne,Ne),(0,D.f)(Me,Ne,Ge);const Xe=2*Be+(Re?2:0),Ye=Be+(Re?2:0),Je=new Float32Array(3*Xe),rt=new Float32Array(3*Ye),tt=new Float32Array(2*Xe),et=new Array(3*Be*(Re?4:2)),qe=new Array(3*Be*(Re?4:2));Re&&(Je[3*(Xe-2)+0]=Le[0],Je[3*(Xe-2)+1]=Le[1],Je[3*(Xe-2)+2]=Le[2],tt[2*(Xe-2)]=0,tt[2*(Xe-2)+1]=0,Je[3*(Xe-1)+0]=Je[3*(Xe-2)+0]+Pe[0],Je[3*(Xe-1)+1]=Je[3*(Xe-2)+1]+Pe[1],Je[3*(Xe-1)+2]=Je[3*(Xe-2)+2]+Pe[2],tt[2*(Xe-1)]=1,tt[2*(Xe-1)+1]=1,rt[3*(Ye-2)+0]=-Ge[0],rt[3*(Ye-2)+1]=-Ge[1],rt[3*(Ye-2)+2]=-Ge[2],rt[3*(Ye-1)+0]=Ge[0],rt[3*(Ye-1)+1]=Ge[1],rt[3*(Ye-1)+2]=Ge[2]);const ot=(jt,$t,Wt)=>{et[jt]=$t,qe[jt]=Wt};let ut=0;const _t=(0,R.c)(),Ct=(0,R.c)();for(let jt=0;jt<Be;jt++){const $t=jt*(2*Math.PI/Be);(0,D.g)(_t,Me,Math.sin($t)),(0,D.g)(Ct,Ne,Math.cos($t)),(0,D.a)(_t,_t,Ct),rt[3*jt+0]=_t[0],rt[3*jt+1]=_t[1],rt[3*jt+2]=_t[2],(0,D.g)(_t,_t,Ce),(0,D.a)(_t,_t,Le),Je[3*jt+0]=_t[0],Je[3*jt+1]=_t[1],Je[3*jt+2]=_t[2],tt[2*jt+0]=jt/Be,tt[2*jt+1]=0,Je[3*(jt+Be)+0]=Je[3*jt+0]+Pe[0],Je[3*(jt+Be)+1]=Je[3*jt+1]+Pe[1],Je[3*(jt+Be)+2]=Je[3*jt+2]+Pe[2],tt[2*(jt+Be)+0]=jt/Be,tt[2*jt+1]=1;const Wt=(jt+1)%Be;ot(ut++,jt,jt),ot(ut++,jt+Be,jt),ot(ut++,Wt,Wt),ot(ut++,Wt,Wt),ot(ut++,jt+Be,jt),ot(ut++,Wt+Be,Wt)}if(Re){for(let jt=0;jt<Be;jt++){const $t=(jt+1)%Be;ot(ut++,Xe-2,Ye-2),ot(ut++,jt,Ye-2),ot(ut++,$t,Ye-2)}for(let jt=0;jt<Be;jt++){const $t=(jt+1)%Be;ot(ut++,jt+Be,Ye-1),ot(ut++,Xe-1,Ye-1),ot(ut++,$t+Be,Ye-1)}}return new B.Z([[te.T.POSITION,{size:3,data:Je,exclusive:!0}],[te.T.NORMAL,{size:3,data:rt,exclusive:!0}],[te.T.UV0,{size:2,data:tt,exclusive:!0}]],[[te.T.POSITION,et],[te.T.NORMAL,qe],[te.T.UV0,et]])}function Ee(We,Ce,Be,Fe,je,Re=(0,R.f)(0,0,0)){const He=We.length,Ie=new Float32Array(Ce.length*He*3+(6*Be.length||0)),Ge=new Float32Array(Ce.length*He*3+(Be?6:0)),Pe=new Array,Le=new Array;let Me=0,Ne=0;const Xe=(0,R.c)(),Ye=(0,R.c)(),Je=(0,R.c)(),rt=(0,R.c)(),tt=(0,R.c)(),et=(0,R.c)(),qe=(0,R.c)(),ot=(0,G.c)(),ut=(0,R.c)(),_t=(0,R.c)(),Ct=(0,R.c)(),vt=(0,R.c)(),Lt=(0,R.c)(),jt=(0,Z.Ue)();(0,D.s)(ut,0,1,0),(0,D.b)(Ye,Ce[1],Ce[0]),(0,D.n)(Ye,Ye),je?((0,D.a)(ot,Ce[0],Re),(0,D.n)(Je,ot)):(0,D.s)(Je,0,0,1),xe(Ye,Je,ut,ut,tt,Je,ze),(0,D.c)(rt,Je),(0,D.c)(vt,tt);for(let wt=0;wt<Be.length;wt++)(0,D.g)(et,tt,Be[wt][0]),(0,D.g)(ot,Je,Be[wt][2]),(0,D.a)(et,et,ot),(0,D.a)(et,et,Ce[0]),Ie[Me++]=et[0],Ie[Me++]=et[1],Ie[Me++]=et[2];Ge[Ne++]=-Ye[0],Ge[Ne++]=-Ye[1],Ge[Ne++]=-Ye[2];for(let wt=0;wt<Fe.length;wt++)Pe.push(Fe[wt][0]>0?Fe[wt][0]:-Fe[wt][0]-1+Be.length),Pe.push(Fe[wt][1]>0?Fe[wt][1]:-Fe[wt][1]-1+Be.length),Pe.push(Fe[wt][2]>0?Fe[wt][2]:-Fe[wt][2]-1+Be.length),Le.push(0),Le.push(0),Le.push(0);let $t=Be.length;const Wt=Be.length-1;for(let wt=0;wt<Ce.length;wt++){let or=!1;wt>0&&((0,D.c)(Xe,Ye),wt<Ce.length-1?((0,D.b)(Ye,Ce[wt+1],Ce[wt]),(0,D.n)(Ye,Ye)):or=!0,(0,D.a)(_t,Xe,Ye),(0,D.n)(_t,_t),(0,D.a)(Ct,Ce[wt-1],rt),(0,Z.Yq)(Ce[wt],_t,jt),(0,Z.BR)(jt,(0,Q.re)(Ct,Xe),ot)?((0,D.b)(ot,ot,Ce[wt]),(0,D.n)(Je,ot),(0,D.f)(tt,_t,Je),(0,D.n)(tt,tt)):xe(_t,rt,vt,ut,tt,Je,ze),(0,D.c)(rt,Je),(0,D.c)(vt,tt)),je&&((0,D.a)(ot,Ce[wt],Re),(0,D.n)(Lt,ot));for(let sr=0;sr<He;sr++)if((0,D.g)(et,tt,We[sr][0]),(0,D.g)(ot,Je,We[sr][1]),(0,D.a)(et,et,ot),(0,D.n)(qe,et),Ge[Ne++]=qe[0],Ge[Ne++]=qe[1],Ge[Ne++]=qe[2],(0,D.a)(et,et,Ce[wt]),Ie[Me++]=et[0],Ie[Me++]=et[1],Ie[Me++]=et[2],!or){const rr=(sr+1)%He;Pe.push($t+sr),Pe.push($t+He+sr),Pe.push($t+rr),Pe.push($t+rr),Pe.push($t+He+sr),Pe.push($t+He+rr);for(let Et=0;Et<6;Et++)Le.push(Pe[Pe.length-6+Et]-Wt)}$t+=He}const pr=Ce[Ce.length-1];for(let wt=0;wt<Be.length;wt++)(0,D.g)(et,tt,Be[wt][0]),(0,D.g)(ot,Je,Be[wt][1]),(0,D.a)(et,et,ot),(0,D.a)(et,et,pr),Ie[Me++]=et[0],Ie[Me++]=et[1],Ie[Me++]=et[2];const gr=Ne/3;Ge[Ne++]=Ye[0],Ge[Ne++]=Ye[1],Ge[Ne++]=Ye[2];const ar=$t-He;for(let wt=0;wt<Fe.length;wt++)Pe.push(Fe[wt][0]>=0?$t+Fe[wt][0]:-Fe[wt][0]-1+ar),Pe.push(Fe[wt][2]>=0?$t+Fe[wt][2]:-Fe[wt][2]-1+ar),Pe.push(Fe[wt][1]>=0?$t+Fe[wt][1]:-Fe[wt][1]-1+ar),Le.push(gr),Le.push(gr),Le.push(gr);return new B.Z([[te.T.POSITION,{size:3,data:Ie,exclusive:!0}],[te.T.NORMAL,{size:3,data:Ge,exclusive:!0}]],[[te.T.POSITION,Pe],[te.T.NORMAL,Le]])}function De(We,Ce,Be){(0,X.hu)(We.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,X.hu)(3===We[0].length,"createPolylineGeometry(): malformed vertex"),(0,X.hu)(null==Ce||Ce.length===We.length,"createPolylineGeometry: need same number of points and normals"),(0,X.hu)(null==Ce||3===Ce[0].length,"createPolylineGeometry(): malformed normal");const Fe=new Float64Array(3*We.length),je=new Array(2*(We.length-1));let Re=0,He=0;for(let Pe=0;Pe<We.length;Pe++){for(let Le=0;Le<3;Le++)Fe[Re++]=We[Pe][Le];Pe>0&&(je[He++]=Pe-1,je[He++]=Pe)}const Ie=[],Ge=[];if(Ie.push([te.T.POSITION,je]),Ge.push([te.T.POSITION,{size:3,data:Fe,exclusive:!0}]),Ce){const Pe=new Float32Array(3*Ce.length);let Le=0;for(let Me=0;Me<We.length;Me++)for(let Ne=0;Ne<3;Ne++)Pe[Le++]=Ce[Me][Ne];Ie.push([te.T.NORMAL,je]),Ge.push([te.T.NORMAL,{size:3,data:Pe,exclusive:!0}])}return Be&&(Ge.push([te.T.COLOR,{size:4,data:Be}]),Ie.push([te.T.COLOR,(0,H.p)(Be.length/4)])),new B.Z(Ge,Ie,$.MX.Line)}function be(We,Ce,Be,Fe,je=0){const Re=new Array(18),He=[[-Ce,je,Fe/2],[Be,je,Fe/2],[0,We+je,Fe/2],[-Ce,je,-Fe/2],[Be,je,-Fe/2],[0,We+je,-Fe/2]];for(let Ge=0;Ge<6;Ge++)Re[3*Ge]=He[Ge][0],Re[3*Ge+1]=He[Ge][1],Re[3*Ge+2]=He[Ge][2];return new B.Z([[te.T.POSITION,{size:3,data:Re,exclusive:!0}]],[[te.T.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])}function ye(We,Ce=We){const Be=We.vertexAttributes,Fe=Be.get(te.T.POSITION).data,je=Be.get(te.T.NORMAL).data;if(je){const Re=Ce.getMutableAttribute(te.T.NORMAL).data;for(let He=0;He<je.length;He+=3){const Ie=je[He+1];Re[He+1]=-je[He+2],Re[He+2]=Ie}}if(Fe){const Re=Ce.getMutableAttribute(te.T.POSITION).data;for(let He=0;He<Fe.length;He+=3){const Ie=Fe[He+1];Re[He+1]=-Fe[He+2],Re[He+2]=Ie}}return Ce}function ve(We,Ce,Be,Fe,je){return!(Math.abs((0,D.e)(Ce,We))>je||((0,D.f)(Be,We,Ce),(0,D.n)(Be,Be),(0,D.f)(Fe,Be,We),(0,D.n)(Fe,Fe),0))}function xe(We,Ce,Be,Fe,je,Re,He){return ve(We,Ce,je,Re,He)||ve(We,Be,je,Re,He)||ve(We,Fe,je,Re,He)}const ze=.99619469809;(0,R.c)()},57851:(nt,Ae,v)=>{"use strict";v.d(Ae,{C:()=>se});var D=v(62208),R=v(86236),G=v(43703),Z=v(84161),Q=v(28093),$=v(4794),W=v(55915),B=v(42743),H=v(52107),X=v(30993),te=v(96867),ae=v(39782),oe=v(16396),le=v(34103),de=v(92222);class se{constructor(Y){this._originSR=Y,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+(0,R.D)()}getOrigin(Y){const ee=this._origins.get(this._rootOriginId);if(null==ee){const ge=ae.p.rootOrigin;if((0,D.pC)(ge))return this._origins.set(this._rootOriginId,(0,X.a)(ge[0],ge[1],ge[2],this._rootOriginId)),this.getOrigin(Y);const _e=(0,X.a)(Y[0]+Math.random()-.5,Y[1]+Math.random()-.5,Y[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,_e),_e}const ie=this._gridSize,J=Math.round(Y[0]/ie),ce=Math.round(Y[1]/ie),ue=Math.round(Y[2]/ie),pe=`${J}/${ce}/${ue}`;let he=this._origins.get(pe);const me=.5*ie;if((0,Z.b)(re,Y,ee.vec3),re[0]=Math.abs(re[0]),re[1]=Math.abs(re[1]),re[2]=Math.abs(re[2]),re[0]<me&&re[1]<me&&re[2]<me){if(he){const ge=Math.max(...re);if((0,Z.b)(re,Y,he.vec3),re[0]=Math.abs(re[0]),re[1]=Math.abs(re[1]),re[2]=Math.abs(re[2]),Math.max(...re)<ge)return he}return ee}return he||(he=(0,X.a)(J*ie,ce*ie,ue*ie,pe),this._origins.set(pe,he)),he}_drawOriginBox(Y,ee=(0,$.f)(1,1,0,1)){const ie=window.view,J=ie._stage,ce=ee.toString();if(!this._objects.has(ce)){this._material=new de.U({width:2,color:ee}),J.add(this._material);const De=new le.F({isPickable:!1}),be=new te.T({castShadow:!1});J.add(be),De.add(be),J.add(De),this._objects.set(ce,be)}const ue=this._objects.get(ce),pe=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],he=pe.length,me=new Array(3*he),ge=new Array,_e=.5*this._gridSize;for(let De=0;De<he;De++)me[3*De+0]=Y[0]+(1&pe[De]?_e:-_e),me[3*De+1]=Y[1]+(2&pe[De]?_e:-_e),me[3*De+2]=Y[2]+(4&pe[De]?_e:-_e),De>0&&ge.push(De-1,De);(0,W.CM)(me,this._originSR,0,me,ie.renderSpatialReference,0,he);const Ee=new H.Z([[oe.T.POSITION,{size:3,data:me,exclusive:!0}]],[[oe.T.POSITION,ge]],B.MX.Line);J.add(Ee),ue.addGeometry(Ee,this._material,G.I)}get test(){const Y=this;return{set gridSize(ee){Y._gridSize=ee}}}}const re=(0,Q.c)()},37187:(nt,Ae,v)=>{"use strict";v.d(Ae,{$z:()=>G,DX:()=>B,mi:()=>R,p:()=>W});const D=1024;function R(H){if(Array.isArray(H)){if(H.length<D)return H;for(const X of H)if(X>=65536)return new Uint32Array(H);return new Uint16Array(H)}if(H.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return H;for(const X of H)if(X>=65536)return H;return new Uint16Array(H)}function G(H){const X=3*H;return X<=D?new Array(X):X<=65536?new Uint16Array(X):new Uint32Array(X)}let Z=(()=>{const H=new Uint32Array(131072);for(let X=0;X<H.length;++X)H[X]=X;return H})();const Q=[0],$=(()=>{const H=new Uint16Array(65536);for(let X=0;X<H.length;++X)H[X]=X;return H})();function W(H){if(1===H)return Q;if(H<D)return Array.from(new Uint16Array($.buffer,0,H));if(H<$.length)return new Uint16Array($.buffer,0,H);if(H>Z.length){const X=Math.max(2*Z.length,H);Z=new Uint32Array(X);for(let te=0;te<Z.length;te++)Z[te]=te}return new Uint32Array(Z.buffer,0,H)}function B(H){if(1===H)return Q;if(H<D)return Array.from(new Uint16Array($.buffer,0,H));if(H<$.length)return new Uint16Array($.slice(0,H));if(H>Z.length){const X=new Uint32Array(H);for(let te=0;te<X.length;te++)X[te]=te;return X}return new Uint32Array(Z.slice(0,H))}},62483:(nt,Ae,v)=>{"use strict";v.d(Ae,{LP:()=>ee,Z8:()=>se,vh:()=>le});var D=v(62208),R=v(28347),G=v(43703),Z=v(84161),Q=v(28093),$=v(993),W=v(4794),B=v(70562),H=v(59617),X=v(67857),te=v(91480),ae=v(40841),oe=v(65073);const le=1e-5;class de{constructor(ue){this.options=new X.om,this._results=new re,this.transform=new ae.yn,this.tolerance=le,this.verticalOffset=null,this._ray=(0,B.Ue)(),this._rayEnd=(0,Q.c)(),this._rayBeginTransformed=(0,Q.c)(),this._rayEndTransformed=(0,Q.c)(),this.viewingMode=ue??H.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(ue,pe,he){this.resetWithRay((0,B.zk)(ue,pe,this._ray),he)}resetWithRay(ue,pe){this.camera=pe,ue!==this._ray&&(0,B.JG)(ue,this._ray),0!==this.options.verticalOffset?this.viewingMode===H.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,Z.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(ue=null,pe,he,me,ge){this.point=pe,this.filterPredicate=me,this.tolerance=he??le;const _e=(0,ae.W9)(this.verticalOffset);if((0,D.pC)(ue)&&ue.length>0){const Ee=ge?De=>{ge(De)&&this.intersectObject(De)}:De=>{this.intersectObject(De)};for(const De of ue){const be=De.getSpatialQueryAccelerator&&De.getSpatialQueryAccelerator();(0,D.pC)(be)?((0,D.pC)(_e)?be.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,Ee,_e):be.forEachAlongRay(this._ray.origin,this._ray.direction,Ee),this.options.selectionMode&&this.options.hud&&be.forEachDegenerateObject(Ee)):De.objects.forAll(Se=>Ee(Se))}}this.sortResults()}intersectObject(ue){const pe=ue.geometryRecords;if(!pe)return;const he=ue.transformation,me=(0,ae.W9)(this.verticalOffset);for(const ge of pe){const{geometry:_e,material:Ee,instanceParameters:De}=ge;if((0,oe.PD)(De))continue;const be=_e.id;this.transform.setAndInvalidateLazyTransforms(he,ge.getShaderTransformation()),(0,Z.m)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,Z.m)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const Se=this.transform.transform;(0,D.pC)(me)&&(me.objectTransform=this.transform),Ee.intersect(_e,De,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(ye,ve,xe,ze,Ke,We)=>{if(ye>=0){if((0,D.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,ye))return;const Ce=ze?this._results.hud:this._results,Be=ze?Fe=>{const je={object:ue,geometryId:be,triangleNr:xe,center:(0,D.pC)(We)?[We[0],We[1],We[2]]:null};Fe.set(X.q7.HUD,je,ye,ve,G.I,Ke)}:Fe=>Fe.set(X.q7.OBJECT,{object:ue,geometryId:be,triangleNr:xe},ye,ve,Se,Ke);if((null==Ce.min.drapedLayerOrder||Ke>=Ce.min.drapedLayerOrder)&&(null==Ce.min.dist||ye<Ce.min.dist)&&Be(Ce.min),this.options.store!==X.eC.MIN&&(null==Ce.max.drapedLayerOrder||Ke<Ce.max.drapedLayerOrder)&&(null==Ce.max.dist||ye>Ce.max.dist)&&Be(Ce.max),this.options.store===X.eC.ALL)if(ze){const Fe=new Y(this._ray);Be(Fe),this._results.hud.all.push(Fe)}else{const Fe=new j(this._ray);Be(Fe),this._results.all.push(Fe)}}},ge.shaderTransformation)}}sortResults(ue=this._results.all){ue.sort((pe,he)=>pe.dist!==he.dist?(0,D.Pt)(pe.dist,0)-(0,D.Pt)(he.dist,0):pe.drapedLayerOrder!==he.drapedLayerOrder?(0,D.Pt)(pe.drapedLayerOrder,Number.MAX_VALUE)-(0,D.Pt)(he.drapedLayerOrder,Number.MAX_VALUE):(0,D.Pt)(he.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,D.Pt)(pe.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function se(ce){return new de(ce)}class re{constructor(){this.min=new j((0,B.Ue)()),this.max=new j((0,B.Ue)()),this.hud={min:new Y((0,B.Ue)()),max:new Y((0,B.Ue)()),all:new Array},this.ground=new j((0,B.Ue)()),this.all=[]}init(ue){this.min.init(ue),this.max.init(ue),this.ground.init(ue),this.all.length=0,this.hud.min.init(ue),this.hud.max.init(ue),this.hud.all.length=0}}class j{constructor(ue){this.intersector=X.q7.OBJECT,this.normal=(0,Q.c)(),this.transformation=(0,G.c)(),this._ray=(0,B.Ue)(),this.init(ue)}get ray(){return this._ray}get distanceInRenderSpace(){return(0,D.pC)(this.dist)?((0,Z.g)(ie,this.ray.direction,this.dist),(0,Z.l)(ie)):null}getIntersectionPoint(ue){return!!(0,te.nn)(this)&&((0,Z.g)(ie,this.ray.direction,this.dist),(0,Z.a)(ue,this.ray.origin,ie),!0)}getTransformedNormal(ue){return(0,Z.c)(J,this.normal),J[3]=0,(0,$.t)(J,J,this.transformation),(0,Z.c)(ue,J),(0,Z.n)(ue,ue)}init(ue){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=X.q7.OBJECT,(0,B.JG)(ue,this._ray)}set(ue,pe,he,me,ge,_e,Ee){this.intersector=ue,this.dist=he,(0,Z.c)(this.normal,(0,D.Pt)(me,Q.U)),(0,R.c)(this.transformation,(0,D.Pt)(ge,G.I)),this.target=pe,this.drapedLayerOrder=_e,this.drapedLayerGraphicOrder=Ee}copy(ue){(0,B.JG)(ue.ray,this._ray),this.intersector=ue.intersector,this.dist=ue.dist,this.target=ue.target,this.drapedLayerOrder=ue.drapedLayerOrder,this.drapedLayerGraphicOrder=ue.drapedLayerGraphicOrder,(0,Z.c)(this.normal,ue.normal),(0,R.c)(this.transformation,ue.transformation)}}class Y extends j{constructor(){super(...arguments),this.intersector=X.q7.HUD}}function ee(ce){return new j(ce)}const ie=(0,Q.c)(),J=(0,W.c)()},67857:(nt,Ae,v)=>{"use strict";var D,R,Z;v.d(Ae,{eC:()=>R,om:()=>G,q7:()=>D}),(Z=D||(D={}))[Z.OBJECT=0]="OBJECT",Z[Z.HUD=1]="HUD",Z[Z.TERRAIN=2]="TERRAIN",Z[Z.OVERLAY=3]="OVERLAY",Z[Z.I3S=4]="I3S",Z[Z.PCL=5]="PCL",Z[Z.LOD=6]="LOD",Z[Z.VOXEL=7]="VOXEL";class G{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=R.ALL}}!function(Z){Z[Z.MIN=0]="MIN",Z[Z.MINMAX=1]="MINMAX",Z[Z.ALL=2]="ALL"}(R||(R={}))},30993:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>G});var D=v(28093);class R{constructor(Q,$){this.vec3=Q,this.id=$}}function G(Z,Q,$,W){return new R((0,D.f)(Z,Q,$),W)}},40723:(nt,Ae,v)=>{"use strict";v.d(Ae,{F5:()=>W,Mt:()=>H,yD:()=>B});var B,X,D=v(62208),R=v(17625),G=v(12699),Z=v(24425),Q=v(39114),$=v(57623);class W extends G.c{constructor(te,ae){super(),this.type=Z.U.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Q.i,this._parameters=(0,$.Uf)(te,ae),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(te){return!1}setParameters(te,ae=!0){(0,$.LO)(this._parameters,te)&&(this.validateParameters(this._parameters),ae&&this.parametersChanged())}validateParameters(te){}get visible(){return this._visible}set visible(te){te!==this._visible&&(this._visible=te,this.parametersChanged())}shouldRender(te){return this.isVisible()&&this.isVisibleForOutput(te.output)&&0!=(this.renderOccluded&te.renderOccludedMask)}isVisibleForOutput(te){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(te){te!==this._renderPriority&&(this._renderPriority=te,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(te){te!==this._insertOrder&&(this._insertOrder=te,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){(0,D.pC)(this.repository)&&this.repository.materialChanged(this)}}(X=B||(B={}))[X.Occlude=1]="Occlude",X[X.Transparent=2]="Transparent",X[X.OccludeAndTransparent=4]="OccludeAndTransparent",X[X.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",X[X.Opaque=16]="Opaque";class H extends R.K{constructor(){super(...arguments),this.renderOccluded=B.Occlude}}},54840:(nt,Ae,v)=>{"use strict";var D,R,G;v.d(Ae,{$:()=>R,T:()=>D}),(G=D||(D={}))[G.ADD=0]="ADD",G[G.UPDATE=1]="UPDATE",G[G.REMOVE=2]="REMOVE",function(G){G[G.NONE=0]="NONE",G[G.VISIBILITIES=1]="VISIBILITIES",G[G.VERTEXATTRS=2]="VERTEXATTRS",G[G.TRANSFORMATION=4]="TRANSFORMATION",G[G.HIGHLIGHTS=8]="HIGHLIGHTS",G[G.OCCLUDEES=16]="OCCLUDEES"}(R||(R={}))},96867:(nt,Ae,v)=>{"use strict";v.d(Ae,{T:()=>de});var D=v(62208),R=v(28347),G=v(43703),Z=v(84161),Q=v(28093),$=v(97126),W=v(98943),B=v(42743),H=v(12699),X=v(24425),te=v(24260),ae=v(7167),oe=v(2282),le=v(65073);class de extends H.c{constructor(Y={}){super(),this.type=X.U.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=(0,G.c)(),this._bvObjectSpace=new re,this._bvWorldSpace=new re,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==Y.castShadow||Y.castShadow,this.metadata=Y.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new se);const{geometries:ee,materials:ie,transformations:J,origins:ce}=Y;if(Array.isArray(ee)){(0,oe.hu)(ie.length===ee.length,"Object3D: materials don't match geometries"),(0,oe.hu)(J.length===ee.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=ee.length,this._geometries.length=ee.length;for(let ue=0;ue<ee.length;ue++)this._geometries[ue]=ee[ue],this._geometryRecords[ue]=te.k.pool.acquire(ee[ue],ie[ue],(0,G.b)(J[ue]),{highlights:null,occludees:null,visible:this._visible},ce&&ce[ue])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(Y){(0,R.c)(this._objectTransformation,Y),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(Y){(0,oe.hu)(null==this._parentLayer||null==Y,"Object3D can only be added to a single Layer"),this._parentLayer=Y}addGeometry(Y,ee,ie,J,ce){ie=ie||G.I,this._geometries.push(Y);const ue=te.k.pool.acquire(Y,ee,ie,{highlights:null,occludees:null,visible:this._visible},J,ce);return this._geometryRecords.push(ue),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,D.pC)(ue.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:ue}),this._invalidateBoundingVolume(),ue}removeGeometry(Y){const ee=this._geometryRecords.splice(Y,1)[0];return this._hasVolatileTransformation=(0,D.pC)(ee.shaderTransformation)?this._geometryRecords.some(ie=>(0,D.pC)(ie.shaderTransformation)):this._hasVolatileTransformation,ee.dispose(),this._geometries.splice(Y,1),this._emit("objectGeometryRemoved",{object:this,record:ee}),this._invalidateBoundingVolume(),ee}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(Y){this._emit("vertexAttrsUpdated",{object:this,record:Y}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(Y){if(this._visible!==Y){this._visible=Y;for(const ee of this._geometryRecords)ee.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const Y=new ae.O(B.V_.MaskOccludee);for(const ee of this._geometryRecords)ee.instanceParameters.occludees=(0,le.lr)(ee.instanceParameters.occludees,Y);return this._emit("occlusionChanged",this),Y}removeOcclude(Y){for(const ee of this._geometryRecords)ee.instanceParameters.occludees=(0,le.U_)(ee.instanceParameters.occludees,Y);this._emit("occlusionChanged",this)}highlight(){const Y=new ae.O(B.V_.Highlight);for(const ee of this._geometryRecords)ee.instanceParameters.highlights=(0,le.lr)(ee.instanceParameters.highlights,Y);return this._emit("highlightChanged",this),Y}removeHighlight(Y){for(const ee of this._geometryRecords)ee.instanceParameters.highlights=(0,le.U_)(ee.instanceParameters.highlights,Y);this._emit("highlightChanged",this)}getCombinedStaticTransformation(Y,ee){return(0,R.m)(ee,this.transformation,Y.getStaticTransformation())}_getCombinedShaderTransformation(Y){return(0,R.m)((0,G.c)(),this.transformation,Y.getShaderTransformation())}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let J=0;J<this._geometryRecords.length;++J){const ue=this._geometryRecords[J],pe=this._geometries[J].boundingInfo;(0,D.pC)(pe)&&(this._calculateTransformedBoundingVolume(pe,this._bvObjectSpace,ue.getShaderTransformation()),this._calculateTransformedBoundingVolume(pe,this._bvWorldSpace,this._getCombinedShaderTransformation(ue)))}(0,Z.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,Z.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const Y=(0,Q.c)(),ee=(0,Q.c)(),ie=(0,W.u1)(this.transformation);for(let J=0;J<this._geometryRecords.length;++J){const ce=this._geometries[J].boundingInfo;if((0,D.Wi)(ce))continue;const ue=this._geometryRecords[J].getShaderTransformation(),pe=(0,W.u1)(ue);(0,Z.m)(Y,ce.getCenter(),ue);const he=(0,Z.i)(Y,this._bvObjectSpace.bounds),me=ce.getBSRadius()*pe;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],he+me),(0,Z.m)(ee,Y,this.transformation);const ge=(0,Z.i)(ee,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],ge+me*ie)}this._bvDirty=!1}_calculateTransformedBoundingVolume(Y,ee,ie){const J=Y.getBBMin(),ce=Y.getBBMax(),ue=(0,Q.a)(J),pe=(0,Q.a)(ce);(0,Z.m)(ue,ue,ie),(0,Z.m)(pe,pe,ie);for(let he=0;he<3;++he)ee.min[he]=Math.min(ee.min[he],ue[he],pe[he]),ee.max[he]=Math.max(ee.max[he],ue[he],pe[he]);for(let he=0;he<3;++he){(0,Z.c)(ue,J),(0,Z.c)(pe,ce),ue[he]=ce[he],pe[he]=J[he],(0,Z.m)(ue,ue,ie),(0,Z.m)(pe,pe,ie);for(let me=0;me<3;++me)ee.min[me]=Math.min(ee.min[me],ue[me],pe[me]),ee.max[me]=Math.max(ee.max[me],ue[me],pe[me])}}_invalidateBoundingVolume(){this._bvDirty=!0,(0,D.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(Y,ee){(0,D.pC)(this._parentLayer)&&this._parentLayer.events.emit(Y,ee)}get test(){const Y=this;return{hasGeometry:ee=>Y._geometries.includes(ee),getGeometryIndex:ee=>Y._geometries.indexOf(ee)}}}class se{constructor(){this.min=(0,Q.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,Q.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class re extends se{constructor(){super(...arguments),this.bounds=(0,$.c)()}init(){(0,Z.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,Z.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,$.l)(this.bounds)}}},7167:(nt,Ae,v)=>{"use strict";v.d(Ae,{O:()=>R});var D=v(86236);class R{constructor(Z){this.channel=Z,this.id=(0,D.D)()}}},82274:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>ze});var Ke,We,D=v(62208),R=v(27899),G=v(77029),Z=v(84161),Q=v(28093),$=v(8834),W=v(70562),B=v(97126),H=v(2282);class X{constructor(We,Ce){this._objectToBoundingSphere=We,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new te,this._objectCount=0,Ce&&(void 0!==Ce.maximumObjectsPerNode&&(this._maximumObjectsPerNode=Ce.maximumObjectsPerNode),void 0!==Ce.maximumDepth&&(this._maximumDepth=Ce.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),te.clearPool(),ce[0]=null,_e.prune(),ve.prune()}add(We,Ce=We.length){this._objectCount+=Ce,this._grow(We,Ce);const Be=te.acquire();for(let Fe=0;Fe<Ce;Fe++){const je=We[Fe];this._isDegenerate(je)?this._degenerateObjects.add(je):(Be.init(this._root),this._add(je,Be))}te.release(Be)}remove(We,Ce=null){this._objectCount-=We.length;const Be=te.acquire();for(const Fe of We){const je=(0,D.pC)(Ce)?Ce:(0,B.h)(this._objectToBoundingSphere(Fe),Ee);Y(je[3])?(Be.init(this._root),this._remove(Fe,je,Be)):this._degenerateObjects.delete(Fe)}te.release(Be),this._shrink()}update(We,Ce){if(!Y(Ce[3])&&this._isDegenerate(We))return;const Be=function ue(Ke){return ce[0]=Ke,ce}(We);this.remove(Be,Ce),this.add(Be)}forEachAlongRay(We,Ce,Be){const Fe=(0,W.re)(We,Ce);this._forEachNode(this._root,je=>{if(!this._intersectsNode(Fe,je))return!1;const Re=je.node;return Re.terminals.forAll(He=>{this._intersectsObject(Fe,He)&&Be(He)}),null!==Re.residents&&Re.residents.forAll(He=>{this._intersectsObject(Fe,He)&&Be(He)}),!0})}forEachAlongRayWithVerticalOffset(We,Ce,Be,Fe){const je=(0,W.re)(We,Ce);this._forEachNode(this._root,Re=>{if(!this._intersectsNodeWithOffset(je,Re,Fe))return!1;const He=Re.node;return He.terminals.forAll(Ie=>{this._intersectsObjectWithOffset(je,Ie,Fe)&&Be(Ie)}),null!==He.residents&&He.residents.forAll(Ie=>{this._intersectsObjectWithOffset(je,Ie,Fe)&&Be(Ie)}),!0})}forEach(We){this._forEachNode(this._root,Ce=>{const Be=Ce.node;return Be.terminals.forAll(We),null!==Be.residents&&Be.residents.forAll(We),!0}),this._degenerateObjects.forEach(We)}forEachDegenerateObject(We){this._degenerateObjects.forEach(We)}findClosest(We,Ce,Be,Fe=(()=>!0),je=1/0){let Re=1/0,He=1/0,Ie=null;const Ge=re(We,Ce),Pe=Le=>{if(--je,!Fe(Le))return;const Me=this._objectToBoundingSphere(Le);if(!(0,$.hr)(Be,Me))return;const Ne=j(We,Ce,(0,B.g)(Me)),Xe=Ne-Me[3];Xe<Re&&(Re=Xe,He=Ne+Me[3],Ie=Le)};return this._forEachNodeDepthOrdered(this._root,Le=>{if(je<=0||!(0,$.hr)(Be,Le.bounds)||((0,Z.g)(he,Ge,Le.halfSize),(0,Z.a)(he,he,Le.bounds),j(We,Ce,he)>He))return!1;const Me=Le.node;return Me.terminals.forAll(Ne=>Pe(Ne)),null!==Me.residents&&Me.residents.forAll(Ne=>Pe(Ne)),!0},We,Ce),Ie}forEachInDepthRange(We,Ce,Be,Fe,je,Re,He){let Ie=-1/0,Ge=1/0;const Pe={setRange:Ye=>{Be===X.DepthOrder.FRONT_TO_BACK?(Ie=Math.max(Ie,Ye.near),Ge=Math.min(Ge,Ye.far)):(Ie=Math.max(Ie,-Ye.far),Ge=Math.min(Ge,-Ye.near))}};Pe.setRange(Fe);const Le=j(Ce,Be,We),Me=re(Ce,Be),Ne=re(Ce,-Be),Xe=Ye=>{if(!He(Ye))return;const Je=this._objectToBoundingSphere(Ye),rt=(0,B.g)(Je),tt=j(Ce,Be,rt)-Le;tt-Je[3]>Ge||tt+Je[3]<Ie||!(0,$.hr)(Re,Je)||je(Ye,Pe)};this._forEachNodeDepthOrdered(this._root,Ye=>{if(!(0,$.hr)(Re,Ye.bounds)||((0,Z.g)(he,Me,Ye.halfSize),(0,Z.a)(he,he,Ye.bounds),j(Ce,Be,he)-Le>Ge)||((0,Z.g)(he,Ne,Ye.halfSize),(0,Z.a)(he,he,Ye.bounds),j(Ce,Be,he)-Le<Ie))return!1;const Je=Ye.node;return Je.terminals.forAll(rt=>Xe(rt)),null!==Je.residents&&Je.residents.forAll(rt=>Xe(rt)),!0},Ce,Be)}forEachNode(We){this._forEachNode(this._root,Ce=>We(Ce.node,Ce.bounds,Ce.halfSize))}forEachNeighbor(We,Ce){const Be=(0,B.a)(Ce),Fe=(0,B.g)(Ce),je=Ie=>{const Ge=this._objectToBoundingSphere(Ie),Pe=(0,B.a)(Ge),Le=Be+Pe;return!((0,Z.d)((0,B.g)(Ge),Fe)-Le*Le<=0)||We(Ie)};let Re=!0;const He=Ie=>{Re&&(Re=je(Ie))};this._forEachNode(this._root,Ie=>{const Ge=(0,B.a)(Ie.bounds),Pe=Be+Ge;if((0,Z.d)((0,B.g)(Ie.bounds),Fe)-Pe*Pe>0)return!1;const Le=Ie.node;return Le.terminals.forAll(He),Re&&null!==Le.residents&&Le.residents.forAll(He),Re}),Re&&this.forEachDegenerateObject(He)}_intersectsNode(We,Ce){return le(Ce.bounds,2*-Ce.halfSize,me),le(Ce.bounds,2*Ce.halfSize,ge),(0,H.yK)(We.origin,We.direction,me,ge)}_intersectsNodeWithOffset(We,Ce,Be){return le(Ce.bounds,2*-Ce.halfSize,me),le(Ce.bounds,2*Ce.halfSize,ge),Be.applyToMinMax(me,ge),(0,H.yK)(We.origin,We.direction,me,ge)}_intersectsObject(We,Ce){const Be=this._objectToBoundingSphere(Ce);return!(Be[3]>0)||(0,B.j)(Be,We)}_intersectsObjectWithOffset(We,Ce,Be){const Fe=this._objectToBoundingSphere(Ce);return!(Fe[3]>0)||(0,B.j)(Be.applyToBoundingSphere(Fe),We)}_forEachNode(We,Ce){let Be=te.acquire().init(We);const Fe=[Be];for(;0!==Fe.length;){if(Be=Fe.pop(),Ce(Be)&&!Be.isLeaf())for(let je=0;je<Be.node.children.length;je++)Be.node.children[je]&&Fe.push(te.acquire().init(Be).advance(je));te.release(Be)}}_forEachNodeDepthOrdered(We,Ce,Be,Fe=X.DepthOrder.FRONT_TO_BACK){let je=te.acquire().init(We);const Re=[je];for(function se(Ke,We,Ce){if(!ve.length)for(let Be=0;Be<8;++Be)ve.push({index:0,distance:0});for(let Be=0;Be<8;++Be){const Fe=ee[Be];ve.data[Be].index=Be,ve.data[Be].distance=j(Ke,We,Fe)}ve.sort((Be,Fe)=>Be.distance-Fe.distance);for(let Be=0;Be<8;++Be)Ce[Be]=ve.data[Be].index}(Be,Fe,xe);0!==Re.length;){if(je=Re.pop(),Ce(je)&&!je.isLeaf())for(let He=7;He>=0;--He){const Ie=xe[He];je.node.children[Ie]&&Re.push(te.acquire().init(je).advance(Ie))}te.release(je)}}_remove(We,Ce,Be){_e.clear();const Fe=Be.advanceTo(Ce,(je,Re)=>{_e.push(je.node),_e.push(Re)})?Be.node.terminals:Be.node.residents;if(Fe.removeUnordered(We),0===Fe.length)for(let je=_e.length-2;je>=0&&this._purge(_e.data[je],_e.data[je+1]);je-=2);}_nodeIsEmpty(We){if(0!==We.terminals.length)return!1;if(null!==We.residents)return 0===We.residents.length;for(let Ce=0;Ce<We.children.length;Ce++)if(We.children[Ce])return!1;return!0}_purge(We,Ce){return Ce>=0&&(We.children[Ce]=null),!!this._nodeIsEmpty(We)&&(null===We.residents&&(We.residents=new G.Z({shrink:!0})),!0)}_add(We,Ce){Ce.advanceTo(this._objectToBoundingSphere(We))?Ce.node.terminals.push(We):(Ce.node.residents.push(We),Ce.node.residents.length>this._maximumObjectsPerNode&&Ce.depth<this._maximumDepth&&this._split(Ce))}_split(We){const Ce=We.node.residents;We.node.residents=null;for(let Be=0;Be<Ce.length;Be++){const Fe=te.acquire().init(We);this._add(Ce.getItemAt(Be),Fe),te.release(Fe)}}_grow(We,Ce){if(0!==Ce&&(de(We,Ce,Be=>this._objectToBoundingSphere(Be),De),Y(De[3])&&!this._fitsInsideTree(De)))if(this._nodeIsEmpty(this._root.node))(0,B.h)(De,this._root.bounds),this._root.halfSize=1.25*De[3];else{const Be=this._rootBoundsForRootAsSubNode(De);this._placingRootViolatesMaxDepth(Be)?this._rebuildTree(De,Be):this._growRootAsSubNode(Be),te.release(Be)}}_rebuildTree(We,Ce){(0,Z.c)(be,Ce.bounds),be[3]=Ce.halfSize,de([We,be],2,Fe=>Fe,Se);const Be=te.acquire().init(this._root);this._root.initFrom(null,Se,1.25*Se[3]),this._forEachNode(Be,Fe=>(this.add(Fe.node.terminals.data,Fe.node.terminals.length),null!==Fe.node.residents&&this.add(Fe.node.residents.data,Fe.node.residents.length),!0)),te.release(Be)}_placingRootViolatesMaxDepth(We){const Ce=Math.log(We.halfSize/this._root.halfSize)*Math.LOG2E;let Be=0;return this._forEachNode(this._root,Fe=>(Be=Math.max(Be,Fe.depth),Be+Ce<=this._maximumDepth)),Be+Ce>this._maximumDepth}_rootBoundsForRootAsSubNode(We){const Ce=We[3],Be=We;let Fe=-1/0;const je=this._root.bounds,Re=this._root.halfSize;for(let He=0;He<3;He++){const Ge=Be[He]+Ce-(je[He]+Re),Pe=Math.max(0,Math.ceil((je[He]-Re-(Be[He]-Ce))/(2*Re))),Le=Math.max(0,Math.ceil(Ge/(2*Re)))+1,Me=2**Math.ceil(Math.log(Pe+Le)*Math.LOG2E);Fe=Math.max(Fe,Me),ye[He].min=Pe,ye[He].max=Le}for(let He=0;He<3;He++){let Ie=ye[He].min,Ge=ye[He].max;const Pe=(Fe-(Ie+Ge))/2;Ie+=Math.ceil(Pe),Ge+=Math.floor(Pe),pe[He]=je[He]-Re-Ie*Re*2+(Ge+Ie)*Re}return pe[3]=Fe*Re*J,te.acquire().initFrom(null,pe,Fe*Re,0)}_growRootAsSubNode(We){const Ce=this._root.node;(0,Z.c)(De,this._root.bounds),De[3]=this._root.halfSize,this._root.init(We),We.advanceTo(De,null,!0),We.node.children=Ce.children,We.node.residents=Ce.residents,We.node.terminals=Ce.terminals}_shrink(){for(;;){const We=this._findShrinkIndex();if(-1===We)break;this._root.advance(We),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let We=null;const Ce=this._root.node.children;let Be=0,Fe=0;for(;Fe<Ce.length&&null==We;)Be=Fe++,We=Ce[Be];for(;Fe<Ce.length;)if(Ce[Fe++])return-1;return Be}_isDegenerate(We){return!Y(this._objectToBoundingSphere(We)[3])}_fitsInsideTree(We){const Ce=this._root.bounds,Be=this._root.halfSize;return We[3]<=Be&&We[0]>=Ce[0]-Be&&We[0]<=Ce[0]+Be&&We[1]>=Ce[1]-Be&&We[1]<=Ce[1]+Be&&We[2]>=Ce[2]-Be&&We[2]<=Ce[2]+Be}}class te{constructor(){this.bounds=(0,B.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(We){return this.initFrom(We.node,We.bounds,We.halfSize,We.depth)}initFrom(We,Ce,Be,Fe=this.depth){return this.node=(0,D.pC)(We)?We:te.createEmptyNode(),(0,D.pC)(Ce)&&(0,B.h)(Ce,this.bounds),this.halfSize=Be,this.depth=Fe,this}advance(We){let Ce=this.node.children[We];Ce||(Ce=te.createEmptyNode(),this.node.children[We]=Ce),this.node=Ce,this.halfSize/=2,this.depth++;const Be=ee[We];return this.bounds[0]+=Be[0]*this.halfSize,this.bounds[1]+=Be[1]*this.halfSize,this.bounds[2]+=Be[2]*this.halfSize,this.bounds[3]=this.halfSize*J,this}advanceTo(We,Ce,Be=!1){for(;;){if(this.isTerminalFor(We))return Ce&&Ce(this,-1),!0;if(this.isLeaf()){if(!Be)return Ce&&Ce(this,-1),!1;this.node.residents=null}const Fe=this._childIndex(We);Ce&&Ce(this,Fe),this.advance(Fe)}}isLeaf(){return null!=this.node.residents}isTerminalFor(We){return We[3]>this.halfSize/2}_childIndex(We){const Ce=this.bounds;return(Ce[0]<We[0]?1:0)+(Ce[1]<We[1]?2:0)+(Ce[2]<We[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new G.Z({shrink:!0}),residents:new G.Z({shrink:!0})}}static acquire(){return te._pool.acquire()}static release(We){te._pool.release(We)}static clearPool(){te._pool.prune()}}function ae(Ke,We){Ke[0]=Math.min(Ke[0],We[0]-We[3]),Ke[1]=Math.min(Ke[1],We[1]-We[3]),Ke[2]=Math.min(Ke[2],We[2]-We[3])}function oe(Ke,We){Ke[0]=Math.max(Ke[0],We[0]+We[3]),Ke[1]=Math.max(Ke[1],We[1]+We[3]),Ke[2]=Math.max(Ke[2],We[2]+We[3])}function le(Ke,We,Ce){Ce[0]=Ke[0]+We,Ce[1]=Ke[1]+We,Ce[2]=Ke[2]+We}function de(Ke,We,Ce,Be){if(1===We){const Fe=Ce(Ke[0]);(0,B.h)(Fe,Be)}else{me[0]=1/0,me[1]=1/0,me[2]=1/0,ge[0]=-1/0,ge[1]=-1/0,ge[2]=-1/0;for(let Fe=0;Fe<We;Fe++){const je=Ce(Ke[Fe]);Y(je[3])&&(ae(me,je),oe(ge,je))}(0,Z.h)(Be,me,ge,.5),Be[3]=Math.max(ge[0]-me[0],ge[1]-me[1],ge[2]-me[2])/2}}function re(Ke,We){let Ce,Be=1/0;for(let Fe=0;Fe<8;++Fe){const je=j(Ke,We,ie[Fe]);je<Be&&(Be=je,Ce=ie[Fe])}return Ce}function j(Ke,We,Ce){return We*(Ke[0]*Ce[0]+Ke[1]*Ce[1]+Ke[2]*Ce[2])}function Y(Ke){return!isNaN(Ke)&&Ke!==-1/0&&Ke!==1/0&&Ke>0}te._pool=new R.Z(te),(We=(Ke=X||(X={})).DepthOrder||(Ke.DepthOrder={}))[We.FRONT_TO_BACK=1]="FRONT_TO_BACK",We[We.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const ee=[(0,Q.f)(-1,-1,-1),(0,Q.f)(1,-1,-1),(0,Q.f)(-1,1,-1),(0,Q.f)(1,1,-1),(0,Q.f)(-1,-1,1),(0,Q.f)(1,-1,1),(0,Q.f)(-1,1,1),(0,Q.f)(1,1,1)],ie=[(0,Q.f)(-1,-1,-1),(0,Q.f)(-1,-1,1),(0,Q.f)(-1,1,-1),(0,Q.f)(-1,1,1),(0,Q.f)(1,-1,-1),(0,Q.f)(1,-1,1),(0,Q.f)(1,1,-1),(0,Q.f)(1,1,1)],J=Math.sqrt(3),ce=[null],pe=(0,B.c)(),he=(0,Q.c)(),me=(0,Q.c)(),ge=(0,Q.c)(),_e=new G.Z,Ee=(0,B.c)(),De=(0,B.c)(),be=(0,B.c)(),Se=(0,B.c)(),ye=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ve=new G.Z,xe=[0,0,0,0,0,0,0,0],ze=X},88569:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bh:()=>ae,E0:()=>X,IB:()=>$,K5:()=>B,j7:()=>W,je:()=>te,ve:()=>H,wu:()=>Z});var D=v(44835),R=v(67969),G=v(2078);const Z=(0,G.wK)(R.zi.SRC_ALPHA,R.zi.ONE,R.zi.ONE_MINUS_SRC_ALPHA,R.zi.ONE_MINUS_SRC_ALPHA),Q=(0,G.if)(R.zi.ONE,R.zi.ONE),$=(0,G.if)(R.zi.ZERO,R.zi.ONE_MINUS_SRC_ALPHA);function W(oe){return oe===D.A.FrontFace?null:oe===D.A.Alpha?$:Q}function B(oe){return oe===D.A.FrontFace?G.LZ:null}const H=5e5,X={factor:-1,units:-2};function te(oe){return oe?X:null}function ae(oe,le=R.wb.LESS){return oe===D.A.NONE||oe===D.A.FrontFace?le:R.wb.LEQUAL}},12407:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>Q});var D=v(62208),R=v(77029),G=v(37847),Z=v(68598);class Q{constructor(W,B,H){this._context=W,this._locations=H,this._textures=new Map,this._freeTextureUnits=new R.Z({deallocator:null}),this._glProgram=W.programCache.acquire(B.generate("vertex"),B.generate("fragment"),H),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=B.generateBind(G.P.Pass,this),this.bindDraw=B.generateBind(G.P.Draw,this),this._fragmentUniforms=(0,Z.hZ)()?B.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(W,B){this._glProgram.setUniform1i(W,B?1:0)}setUniform1i(W,B){this._glProgram.setUniform1i(W,B)}setUniform1f(W,B){this._glProgram.setUniform1f(W,B)}setUniform2fv(W,B){this._glProgram.setUniform2fv(W,B)}setUniform3fv(W,B){this._glProgram.setUniform3fv(W,B)}setUniform4fv(W,B){this._glProgram.setUniform4fv(W,B)}setUniformMatrix3fv(W,B){this._glProgram.setUniformMatrix3fv(W,B)}setUniformMatrix4fv(W,B){this._glProgram.setUniformMatrix4fv(W,B)}setUniform1fv(W,B){this._glProgram.setUniform1fv(W,B)}setUniform1iv(W,B){this._glProgram.setUniform1iv(W,B)}setUniform2iv(W,B){this._glProgram.setUniform3iv(W,B)}setUniform3iv(W,B){this._glProgram.setUniform3iv(W,B)}setUniform4iv(W,B){this._glProgram.setUniform4iv(W,B)}assertCompatibleVertexAttributeLocations(W){W.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(W,B){if((0,D.Wi)(B)||null==B.glName){const X=this._textures.get(W);return X&&(this._context.bindTexture(null,X.unit),this._freeTextureUnit(X),this._textures.delete(W)),null}let H=this._textures.get(W);return null==H?(H=this._allocTextureUnit(B),this._textures.set(W,H)):H.texture=B,this._context.useProgram(this),this.setUniform1i(W,H.unit),this._context.bindTexture(B,H.unit),H.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((W,B)=>{this._context.bindTexture(W.texture,W.unit),this.setUniform1i(B,W.unit)}),(0,D.pC)(this._fragmentUniforms)&&this._fragmentUniforms.forEach(W=>{"sampler2D"!==W.type&&"samplerCube"!==W.type||this._textures.has(W.name)||console.error(`Texture sampler ${W.name} has no bound texture`)})}_allocTextureUnit(W){return{texture:W,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(W){this._freeTextureUnits.push(W.unit)}}},64624:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>W,Y:()=>$});var D=v(62208),R=v(13934),G=v(74202),Z=v(59856),Q=v(40723);class ${constructor(X,te,ae,oe=null){this.rctx=X,this.sliceHelper=oe,this.lastFrameCamera=new Z.V,this.output=R.H.Color,this.renderOccludedMask=B,this.bindParameters=new G.p(te,ae,(0,D.pC)(oe)?oe.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=B}}class W extends ${constructor(X,te,ae,oe,le){super(X,ae,oe,le),this.offscreenRenderingHelper=te,this.sliceHelper=le}}const B=Q.yD.Occlude|Q.yD.OccludeAndTransparent|Q.yD.OccludeAndTransparentStencil},53855:(nt,Ae,v)=>{"use strict";v.d(Ae,{z:()=>le});var D=v(62208),R=v(86236),G=v(28347),Z=v(43703),Q=v(84161),$=v(4794),W=v(98943),B=v(42743),H=v(36848);class X{constructor(){this.visible=!0}}var te=v(7167),ae=v(16396),oe=v(65073);class le{constructor(re,j,Y={}){this.data=re,this.material=j,this.boundingSphere=(0,$.c)(),this.instanceParameters=new X,this._transformation=(0,Z.c)(),this._shaderTransformationDirty=!0,this.layerUid=(0,D.Pt)(Y.layerUid,null),this.graphicUid=(0,D.Pt)(Y.graphicUid,null),this.id=Y.id?Y.id:(0,R.D)(),this.boundingInfo=(0,D.Pt)(Y.boundingInfo,null),this.calculateShaderTransformation=(0,D.Pt)(Y.calculateShaderTransformation,null),this.castShadow=!!Y.castShadow&&Y.castShadow}get transformation(){return this._transformation}updateTransformation(re){re(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(re,j,Y=(0,W.u1)(re)){(0,D.Wi)(this.boundingInfo)||((0,Q.m)(j,this.boundingInfo.getCenter(),re),j[3]=this.boundingInfo.getBSRadius()*Y)}get hasShaderTransformation(){return(0,D.pC)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return(0,D.Wi)(this.calculateShaderTransformation)?(0,D.Pt)(this.transformation,Z.I):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,Z.c)()),(0,G.c)(this._shaderTransformation,this.calculateShaderTransformation((0,D.Pt)(this.transformation,Z.I))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(re){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,re)&&((0,D.pC)(this._transformation)&&(0,Q.m)(re,re,this._transformation),!0);const j=this.indices.get(ae.T.POSITION),Y=this.vertexAttributes.get(ae.T.POSITION);return!!(0,H.cM)(Y,j,re)&&((0,D.pC)(this._transformation)&&(0,Q.m)(re,re,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const re=new te.O(B.V_.Highlight),j=this.instanceParameters;return j.highlights=(0,oe.lr)(j.highlights,re),re}removeHighlight(re){const j=this.instanceParameters;j.highlights=(0,oe.U_)(j.highlights,re)}}},5894:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{r:()=>D}),(R=D||(D={}))[R.INTEGRATED_MESH=0]="INTEGRATED_MESH",R[R.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",R[R.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",R[R.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",R[R.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",R[R.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",R[R.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",R[R.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",R[R.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",R[R.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",R[R.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",R[R.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",R[R.LASERLINES=12]="LASERLINES",R[R.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",R[R.HUD_MATERIAL=14]="HUD_MATERIAL",R[R.LABEL_MATERIAL=15]="LABEL_MATERIAL",R[R.LINE_CALLOUTS=16]="LINE_CALLOUTS",R[R.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",R[R.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",R[R.DRAPED_WATER=19]="DRAPED_WATER",R[R.VOXEL=20]="VOXEL",R[R.MAX_SLOTS=21]="MAX_SLOTS"},95808:(nt,Ae,v)=>{"use strict";v.d(Ae,{L:()=>pe,s:()=>ue});var D=v(62208),R=v(67831),G=v(70026),Z=v(19597),Q=v(651),$=v(91056),W=v(39114),B=v(12407),H=v(86962),X=v(2078);class te extends $.A{initializeProgram(me){return new B.$(me.rctx,te.shader.get().build(),W.i)}initializePipeline(){return(0,X.sm)({colorWrite:X.BK})}}te.shader=new Q.J(H.S,()=>v.e(857).then(v.bind(v,90857)));var ae=v(52376);class oe extends $.A{initializeProgram(me){return new B.$(me.rctx,oe.shader.get().build(),W.i)}initializePipeline(){return(0,X.sm)({colorWrite:X.BK})}}oe.shader=new Q.J(ae.S,()=>v.e(3999).then(v.bind(v,73999)));var le=v(99770),de=v(17625);class se extends de.K{constructor(){super(...arguments),this.projScale=1}}class re extends se{}class j extends de.K{}class Y extends j{constructor(){super(...arguments),this.blurSize=(0,le.a)()}}var ee=v(67969),ie=v(85775),J=v(55086),ce=v(26906);const ue=2;class pe{constructor(me,ge,_e){this._techniqueRepository=me,this._rctx=ge,this._requestRender=_e,this._enabled=!1,this._quadVAO=null,this._passParameters=new re,this._drawParameters=new Y}dispose(){this._quadVAO=(0,D.M2)(this._quadVAO)}disposeOffscreenBuffers(){(0,D.yw)(this._ssaoFBO,me=>me.resize(0,0)),(0,D.yw)(this._blur0FBO,me=>me.resize(0,0)),(0,D.yw)(this._blur1FBO,me=>me.resize(0,0))}set enabled(me){me?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&(0,D.pC)(this._passParameters.noiseTexture)&&(0,D.pC)(this._ssaoFBO)&&(0,D.pC)(this._blur0FBO)&&(0,D.pC)(this._blur1FBO)}get loading(){return this.enabled&&!this.ready}get colorTexture(){return(0,D.pC)(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return(0,D.pC)(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return(0,D.pC)(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(me,ge,_e){if(!this.enabled||(0,D.Wi)(ge)||(0,D.Wi)(_e)||(0,D.Wi)(this._passParameters.noiseTexture)||(0,D.Wi)(this._ssaoFBO)||(0,D.Wi)(this._blur0FBO)||(0,D.Wi)(this._blur1FBO))return;const Ee=this._rctx,De=me.camera;this._passParameters.normalTexture=_e,this._passParameters.depthTexture=ge,this._passParameters.projScale=1/De.computeRenderPixelSizeAtDist(1);const be=De.fullViewport,Se=be[2],ye=be[3],ve=Se/ue,xe=ye/ue;this._ssaoFBO.resize(Se,ye),this._blur0FBO.resize(ve,xe),this._blur1FBO.resize(ve,xe),(0,D.Wi)(this._quadVAO)&&(this._quadVAO=(0,Z.ow)(this._rctx)),Ee.bindFramebuffer(this._ssaoFBO),Ee.setViewport(0,0,Se,ye),Ee.bindTechnique(this._ssaoTechnique,this._passParameters,me).bindDraw(this._drawParameters,me,this._passParameters),Ee.bindVAO(this._quadVAO),Ee.drawArrays(ee.MX.TRIANGLE_STRIP,0,(0,ce._V)(this._quadVAO,"geometry"));const ze=Ee.bindTechnique(this._blurTechnique,this._passParameters,me);Ee.setViewport(0,0,ve,xe),Ee.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,(0,R.s)(this._drawParameters.blurSize,0,ue/ye),ze.bindDraw(this._drawParameters,me,this._passParameters),Ee.setViewport(0,0,ve,xe),Ee.drawArrays(ee.MX.TRIANGLE_STRIP,0,(0,ce._V)(this._quadVAO,"geometry")),Ee.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,(0,R.s)(this._drawParameters.blurSize,ue/Se,0),ze.bindDraw(this._drawParameters,me,this._passParameters),Ee.drawArrays(ee.MX.TRIANGLE_STRIP,0,(0,ce._V)(this._quadVAO,"geometry")),Ee.setViewport(be[0],be[1],be[2],be[3])}_selectPrograms(){(0,D.Wi)(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(oe)),(0,D.Wi)(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(te))}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(me){this._data?me():v.e(181).then(v.bind(v,10181)).then(ge=>{this._data=ge,me()})}_initialize(){const me={target:ee.No.TEXTURE_2D,pixelFormat:ee.VI.RGBA,dataType:ee.Br.UNSIGNED_BYTE,samplingMode:ee.cw.LINEAR,wrapMode:ee.e8.CLAMP_TO_EDGE,width:0,height:0},ge={colorTarget:ee.Lm.TEXTURE,depthStencilTarget:ee.OU.NONE};(0,G.t)(this._data.noiseTexture).then(_e=>{this._enabled&&(this._ssaoFBO=new ie.X(this._rctx,ge,me),this._blur0FBO=new ie.X(this._rctx,ge,me),this._blur1FBO=new ie.X(this._rctx,ge,me),this._passParameters.noiseTexture=new J.x(this._rctx,{target:ee.No.TEXTURE_2D,pixelFormat:ee.VI.RGBA,dataType:ee.Br.UNSIGNED_BYTE,hasMipmap:!0,width:_e.width,height:_e.height},_e),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._passParameters.noiseTexture=(0,D.M2)(this._passParameters.noiseTexture),this._blur1FBO=(0,D.M2)(this._blur1FBO),this._blur0FBO=(0,D.M2)(this._blur0FBO),this._ssaoFBO=(0,D.M2)(this._ssaoFBO)}get gpuMemoryUsage(){return((0,D.pC)(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+((0,D.pC)(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+((0,D.pC)(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}},53319:(nt,Ae,v)=>{"use strict";v.d(Ae,{i:()=>ee,l:()=>J});var ee,et,D=v(8314),R=v(21286),G=v(62208),Z=v(550),Q=v(28347),$=v(43703),W=v(67831),B=v(99770),H=v(84161),X=v(28093),te=v(993),ae=v(4794),oe=v(59617),le=v(59856),de=v(2282),se=v(67969),re=v(85775),j=v(55086),Y=v(26906);(et=ee||(ee={}))[et.Highlight=0]="Highlight",et[et.Default=1]="Default";class ie{constructor(){this.camera=new le.V,this.lightMat=(0,$.c)()}}class J{constructor(qe,ot){this._rctx=qe,this._viewingMode=ot,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._splitSchemeLambda=0,this._warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,ae.c)(),this._cascades=[new ie,new ie,new ie,new ie],this._maxTextureSize=Math.min((0,D.Z)("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,te.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(qe){this._maxNumCascades=(0,R.uZ)(Math.floor(qe),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(qe){this._enabled=qe,qe||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&(0,G.pC)(this._depthTexture)}getSnapshot(qe){return this.enabled?this._snapshots[qe]:null}getCascades(){for(let qe=0;qe<this._numCascades;++qe)ze[qe]=this._cascades[qe];return ze.length=this._numCascades,ze}start(qe,ot,ut){(0,de.hu)(this.enabled),this._textureSize=this._computeTextureSize(qe.fullWidth,qe.fullHeight),this._ensureDepthTexture();const{near:_t,far:Ct}=this._clampNearFar(ut);this._computeCascadeDistances(Ct,_t),this._setupMatrices(qe,ot);const vt=qe.viewMatrix,Lt=qe.projectionMatrix;for(let jt=0;jt<this._numCascades;++jt)this._constructCascade(jt,Lt,vt,ot);this._lastOrigin=null,this.clear()}finish(qe){(0,de.hu)(this.enabled),this._rctx.bindFramebuffer(qe)}getShadowMapMatrices(qe){if(!this._lastOrigin||!(0,H.k)(qe,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,X.c)(),(0,H.c)(this._lastOrigin,qe);for(let ot=0;ot<this._numCascades;++ot){(0,Q.v)(Ke,this._cascades[ot].lightMat,qe);for(let ut=0;ut<16;++ut)We[16*ot+ut]=Ke[ut]}}return We}takeCascadeSnapshotTo(qe,ot){(0,de.hu)(this.enabled);const ut=this._ensureSnapshot(ot);this._bindFbo();const _t=this._rctx,Ct=_t.bindTexture(ut,j.x.TEXTURE_UNIT_FOR_UPDATES);_t.gl.copyTexSubImage2D(se.No.TEXTURE_2D,0,qe.camera.viewport[0],qe.camera.viewport[1],qe.camera.viewport[0],qe.camera.viewport[1],qe.camera.viewport[2],qe.camera.viewport[3]),_t.bindTexture(Ct,j.x.TEXTURE_UNIT_FOR_UPDATES)}clear(){const qe=this._rctx;this._bindFbo(),qe.setClearColor(1,1,1,1),qe.clearSafe(se.lk.COLOR_BUFFER_BIT|se.lk.DEPTH_BUFFER_BIT)}_computeTextureSize(qe,ot){const ut=.5*Math.log(qe*qe+ot*ot)*Math.LOG2E,Ct=2**Math.round(ut+.35);return Math.min(this._maxTextureSize,2*Ct)}_ensureDepthTexture(){(0,G.pC)(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new j.x(this._rctx,{target:se.No.TEXTURE_2D,pixelFormat:se.VI.RGBA,dataType:se.Br.UNSIGNED_BYTE,wrapMode:se.e8.CLAMP_TO_EDGE,samplingMode:se.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new re.X(this._rctx,{colorTarget:se.Lm.TEXTURE,depthStencilTarget:se.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture))}_ensureSnapshot(qe){let ot=this._snapshots[qe];return(0,G.pC)(ot)&&ot.descriptor.width===this._textureSize||(this._discardSnapshot(qe),ot=new j.x(this._rctx,{target:se.No.TEXTURE_2D,pixelFormat:se.VI.RGBA,dataType:se.Br.UNSIGNED_BYTE,wrapMode:se.e8.CLAMP_TO_EDGE,samplingMode:se.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._snapshots[qe]=ot),ot}_discardDepthTexture(){this._fbo=(0,G.M2)(this._fbo),this._depthTexture=(0,G.M2)(this._depthTexture)}_discardSnapshot(qe){this._snapshots[qe]=(0,G.M2)(this._snapshots[qe])}_discardAllSnapshots(){for(let qe=0;qe<this._snapshots.length;++qe)this._discardSnapshot(qe);this._snapshots.length=0}_bindFbo(){const qe=this._rctx;qe.unbindTexture(this._depthTexture),qe.bindFramebuffer(this._fbo)}_constructCascade(qe,ot,ut,_t){const Ct=this._cascades[qe],vt=-this._cascadeDistances[qe],Lt=-this._cascadeDistances[qe+1],jt=(ot[10]*vt+ot[14])/Math.abs(ot[11]*vt+ot[15]),$t=(ot[10]*Lt+ot[14])/Math.abs(ot[11]*Lt+ot[15]);(0,de.hu)(jt<$t);for(let pr=0;pr<8;++pr){(0,te.s)(he,pr%4==0||pr%4==3?-1:1,pr%4==0||pr%4==1?-1:1,pr<4?jt:$t,1),(0,te.t)(me[pr],he,pe);for(let gr=0;gr<3;++gr)me[pr][gr]/=me[pr][3]}(0,H.o)(xe,me[0]),(0,Q.v)(ce,ve,xe),Ct.camera.viewMatrix=ce;for(let pr=0;pr<8;++pr)(0,H.m)(me[pr],me[pr],Ct.camera.viewMatrix);(0,H.c)(ge,me[0]),(0,H.c)(_e,me[0]);for(let pr=1;pr<8;++pr)for(let gr=0;gr<3;++gr)ge[gr]=Math.min(ge[gr],me[pr][gr]),_e[gr]=Math.max(_e[gr],me[pr][gr]);ge[2]-=200,_e[2]+=200,Ct.camera.near=-_e[2],Ct.camera.far=-ge[2],this._warp?this._constructTrapezoidalProjection(ut,_t,Ct):this._constructOrthogonalProjection(Ct),(0,Q.m)(Ct.lightMat,Ct.camera.projectionMatrix,Ct.camera.viewMatrix);const Wt=this._textureSize/2;Ct.camera.viewport[0]=qe%2==0?0:Wt,Ct.camera.viewport[1]=0===Math.floor(qe/2)?0:Wt,Ct.camera.viewport[2]=Wt,Ct.camera.viewport[3]=Wt}_constructOrthogonalProjection(qe){(0,Q.w)(qe.camera.projectionMatrix,ge[0],_e[0],ge[1],_e[1],qe.camera.near,qe.camera.far)}_constructTrapezoidalProjection(qe,ot,ut){const _t=1/me[0][3],Ct=1/me[4][3];(0,de.hu)(_t<Ct);let vt=_t+Math.sqrt(_t*Ct);const Lt=Math.sin((0,R.ZF)(qe[2]*ot[0]+qe[6]*ot[1]+qe[10]*ot[2]));vt/=Lt,function Me(et,qe,ot,ut,_t,Ct,vt,Lt){(0,W.s)(Ce,0,0);for(let St=0;St<4;++St)(0,W.j)(Ce,Ce,et[St]);(0,W.b)(Ce,Ce,.25),(0,W.s)(Be,0,0);for(let St=4;St<8;++St)(0,W.j)(Be,Be,et[St]);(0,W.b)(Be,Be,.25),(0,W.l)(Fe[0],et[4],et[5],.5),(0,W.l)(Fe[1],et[5],et[6],.5),(0,W.l)(Fe[2],et[6],et[7],.5),(0,W.l)(Fe[3],et[7],et[4],.5);let jt=0,$t=(0,W.k)(Fe[0],Ce);for(let St=1;St<4;++St){const Ft=(0,W.k)(Fe[St],Ce);Ft<$t&&($t=Ft,jt=St)}(0,W.a)(je,Fe[jt],et[jt+4]);const Wt=je[0];let pr,gr;je[0]=-je[1],je[1]=Wt,(0,W.a)(Re,Be,Ce),(0,W.h)(Re,je)<0&&(0,W.n)(je,je),(0,W.l)(je,je,Re,ot),(0,W.f)(je,je),pr=gr=(0,W.h)((0,W.a)(He,et[0],Ce),je);for(let St=1;St<8;++St){const Ft=(0,W.h)((0,W.a)(He,et[St],Ce),je);Ft<pr?pr=Ft:Ft>gr&&(gr=Ft)}(0,W.c)(ut,Ce),(0,W.b)(He,je,pr-qe),(0,W.j)(ut,ut,He);let ar=-1,Fr=1,mr=0,wt=0;for(let St=0;St<8;++St){(0,W.a)(Ie,et[St],ut),(0,W.f)(Ie,Ie);const Ft=je[0]*Ie[1]-je[1]*Ie[0];Ft>0?Ft>ar&&(ar=Ft,mr=St):Ft<Fr&&(Fr=Ft,wt=St)}(0,de.T)(ar>0,"leftArea"),(0,de.T)(Fr<0,"rightArea"),(0,W.b)(Ge,je,pr),(0,W.j)(Ge,Ge,Ce),(0,W.b)(Pe,je,gr),(0,W.j)(Pe,Pe,Ce),Le[0]=-je[1],Le[1]=je[0];const or=(0,de.ep)(ut,et[wt],Pe,(0,W.j)(He,Pe,Le),1,_t),sr=(0,de.ep)(ut,et[mr],Pe,He,1,Ct),rr=(0,de.ep)(ut,et[mr],Ge,(0,W.j)(He,Ge,Le),1,vt),Et=(0,de.ep)(ut,et[wt],Ge,He,1,Lt);(0,de.T)(or,"rayRay"),(0,de.T)(sr,"rayRay"),(0,de.T)(rr,"rayRay"),(0,de.T)(Et,"rayRay")}(me,vt,Lt,Ee,De,be,Se,ye),function tt(et,qe,ot,ut,_t){(0,W.a)(Je,ot,ut),(0,W.b)(Je,Je,.5),rt[0]=Je[0],rt[1]=Je[1],rt[2]=0,rt[3]=Je[1],rt[4]=-Je[0],rt[5]=0,rt[6]=Je[0]*Je[0]+Je[1]*Je[1],rt[7]=Je[0]*Je[1]-Je[1]*Je[0],rt[8]=1,rt[Ne(0,2)]=-(0,W.h)(Ye(rt,0),et),rt[Ne(1,2)]=-(0,W.h)(Ye(rt,1),et);let Ct=(0,W.h)(Ye(rt,0),ot)+rt[Ne(0,2)],vt=(0,W.h)(Ye(rt,1),ot)+rt[Ne(1,2)],Lt=(0,W.h)(Ye(rt,0),ut)+rt[Ne(0,2)],jt=(0,W.h)(Ye(rt,1),ut)+rt[Ne(1,2)];Ct=-(Ct+Lt)/(vt+jt),rt[Ne(0,0)]+=rt[Ne(1,0)]*Ct,rt[Ne(0,1)]+=rt[Ne(1,1)]*Ct,rt[Ne(0,2)]+=rt[Ne(1,2)]*Ct,Ct=1/((0,W.h)(Ye(rt,0),ot)+rt[Ne(0,2)]),vt=1/((0,W.h)(Ye(rt,1),ot)+rt[Ne(1,2)]),rt[Ne(0,0)]*=Ct,rt[Ne(0,1)]*=Ct,rt[Ne(0,2)]*=Ct,rt[Ne(1,0)]*=vt,rt[Ne(1,1)]*=vt,rt[Ne(1,2)]*=vt,rt[Ne(2,0)]=rt[Ne(1,0)],rt[Ne(2,1)]=rt[Ne(1,1)],rt[Ne(2,2)]=rt[Ne(1,2)],rt[Ne(1,2)]+=1,Ct=(0,W.h)(Ye(rt,1),qe)+rt[Ne(1,2)],vt=(0,W.h)(Ye(rt,2),qe)+rt[Ne(2,2)],Lt=(0,W.h)(Ye(rt,1),ot)+rt[Ne(1,2)],jt=(0,W.h)(Ye(rt,2),ot)+rt[Ne(2,2)],Ct=-.5*(Ct/vt+Lt/jt),rt[Ne(1,0)]+=rt[Ne(2,0)]*Ct,rt[Ne(1,1)]+=rt[Ne(2,1)]*Ct,rt[Ne(1,2)]+=rt[Ne(2,2)]*Ct,Ct=(0,W.h)(Ye(rt,1),qe)+rt[Ne(1,2)],vt=(0,W.h)(Ye(rt,2),qe)+rt[Ne(2,2)],Lt=-vt/Ct,rt[Ne(1,0)]*=Lt,rt[Ne(1,1)]*=Lt,rt[Ne(1,2)]*=Lt,_t[0]=rt[0],_t[1]=rt[1],_t[2]=0,_t[3]=rt[2],_t[4]=rt[3],_t[5]=rt[4],_t[6]=0,_t[7]=rt[5],_t[8]=0,_t[9]=0,_t[10]=1,_t[11]=0,_t[12]=rt[6],_t[13]=rt[7],_t[14]=0,_t[15]=rt[8]}(Ee,De,Se,ye,ut.camera.projectionMatrix),ut.camera.projectionMatrix[10]=2/(ge[2]-_e[2]),ut.camera.projectionMatrix[14]=-(ge[2]+_e[2])/(ge[2]-_e[2])}_setupMatrices(qe,ot){(0,Q.m)(ue,qe.projectionMatrix,qe.viewMatrix),(0,Q.a)(pe,ue);const ut=this._viewingMode===oe.JY.Global?qe.eye:(0,H.s)(xe,0,0,1);(0,Q.q)(ve,[0,0,0],[-ot[0],-ot[1],-ot[2]],ut)}_clampNearFar(qe){let{near:ot,far:ut}=qe;return ot<2&&(ot=2),ut<2&&(ut=2),ot>=ut&&(ot=2,ut=4),{near:ot,far:ut}}_computeCascadeDistances(qe,ot){this._numCascades=Math.min(1+Math.floor((0,de.E6)(qe/ot,4)),this._maxNumCascades);const ut=(qe-ot)/this._numCascades,_t=(qe/ot)**(1/this._numCascades);let Ct=ot,vt=ot;for(let Lt=0;Lt<this._numCascades+1;++Lt)this._cascadeDistances[Lt]=(0,R.t7)(Ct,vt,this._splitSchemeLambda),Ct*=_t,vt+=ut}get gpuMemoryUsage(){return this._snapshots.reduce((qe,ot)=>qe+(0,Y.un)(ot),this._fbo?.gpuMemoryUsage??0)}get test(){const qe=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(ot){qe._splitSchemeLambda=ot},get splitSchemeLambda(){return qe._splitSchemeLambda},set warp(ot){qe._warp=ot},get warp(){return qe._warp}}}}const ce=(0,$.c)(),ue=(0,$.c)(),pe=(0,$.c)(),he=(0,ae.c)(),me=[];for(let et=0;et<8;++et)me.push((0,ae.c)());const ge=(0,X.c)(),_e=(0,X.c)(),Ee=(0,B.a)(),De=(0,B.a)(),be=(0,B.a)(),Se=(0,B.a)(),ye=(0,B.a)(),ve=(0,$.c)(),xe=(0,X.c)(),ze=[],Ke=(0,$.c)(),We=new Float32Array(64),Ce=(0,B.a)(),Be=(0,B.a)(),Fe=[(0,B.a)(),(0,B.a)(),(0,B.a)(),(0,B.a)()],je=(0,B.a)(),Re=(0,B.a)(),He=(0,B.a)(),Ie=(0,B.a)(),Ge=(0,B.a)(),Pe=(0,B.a)(),Le=(0,B.a)();function Ne(et,qe){return 3*qe+et}const Xe=(0,B.a)();function Ye(et,qe){return(0,W.s)(Xe,et[qe],et[qe+3]),Xe}const Je=(0,B.a)(),rt=(0,Z.c)()},14411:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>re});var D=v(17626),R=v(14517),G=v(88159),Z=v(62208),Q=v(77029),$=v(77712),H=(v(85931),v(90912),v(76898)),X=v(28093),te=v(26594),ae=v(62483),oe=v(67857),le=v(54840),de=v(83196),se=v(38516);let re=class extends R.Z{constructor(J){super(J),this._pending=new j,this._changes=new te.as,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Q.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(J=>J.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return(0,G.oE)(this._materialRenderers,J=>J.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const J=(0,de.q)(this._changes);let ce=!1,ue=!1,pe=!1;return J.forEach((he,me)=>{let ge=this._materialRenderers.get(me);if(!ge&&he.adds.length>0&&(ge=new se.A(this.rctx,this._materialRepository,me),this._materialRenderers.set(me,ge),ce=!0,ue=!0,pe=!0),!ge)return;const _e=ue||ge.hasHighlights,Ee=pe||ge.hasWater;ge.modify(he),ue=ue||_e!==ge.hasHighlights,pe=pe||Ee!==ge.hasWater,ge.isEmpty&&(this._materialRenderers.delete(me),ge.dispose(),ce=!0)}),this._changes.clear(),ce&&this._updateSortedMaterialRenderers(),ue&&(this._hasHighlights=(0,G.oE)(this._materialRenderers,he=>he.hasHighlights)),pe&&(this._hasWater=(0,G.oE)(this._materialRenderers,he=>he.hasWater)),this.notifyChange("updating"),!0}addGeometries(J,ce){if(0===J.length)return;const ue=this._validateRenderGeometries(J);for(const he of ue)this._geometries.set(he.id,he);const pe=this._pending.empty;for(const he of ue)this._pending.adds.add(he);pe&&this.notifyChange("updating"),ce===le.T.UPDATE&&this._notifyGraphicGeometryChanged(J)}removeGeometries(J,ce){const ue=this._pending.empty,pe=this._pending.adds;for(const he of J)pe.has(he)?(this._pending.removed.add(he),pe.delete(he)):this._pending.removed.has(he)||this._pending.removes.add(he),this._geometries.delete((0,Z.Wg)(he.id));ue&&!this._pending.empty&&this.notifyChange("updating"),ce===le.T.UPDATE&&this._notifyGraphicGeometryChanged(J)}modifyGeometries(J,ce){const ue=0===this._changes.updates.length;for(const pe of J){const he=this._changes.updates.pushNew();he.renderGeometry=this._validateRenderGeometry(pe),he.updateType=ce}switch(ue&&this._changes.updates.length>0&&this.notifyChange("updating"),ce){case le.$.TRANSFORMATION:case le.$.VERTEXATTRS:return this._notifyGraphicGeometryChanged(J);case le.$.VISIBILITIES:return this._notifyGraphicVisibilityChanged(J)}}updateAnimation(J){let ce=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:ue})=>ce=ue.updateAnimation(J)||ce),ce}render(J,ce){for(let ue=0;ue<this._sortedMaterialRenderers.length;ue++){const pe=this._sortedMaterialRenderers.data[ue];pe.material.shouldRender(J)&&pe.materialRenderer.render(J.output,ce)}}intersect(J,ce,ue,pe,he){return this._geometries.forEach(me=>{if(pe&&!pe(me))return;this._intersectRenderGeometry(me,ue,ce,0,J,he);const ge=this.rendererContext.longitudeCyclical;ge&&(me.boundingSphere[0]-me.boundingSphere[3]<ge.min&&this._intersectRenderGeometry(me,ue,ce,ge.range,J,he),me.boundingSphere[0]+me.boundingSphere[3]>ge.max&&this._intersectRenderGeometry(me,ue,ce,-ge.range,J,he)),he++}),he}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let J=0;this._materialRenderers.forEach((ce,ue)=>{ue.insertOrder=J++,this._sortedMaterialRenderers.push({material:ue,materialRenderer:ce})}),this._sortedMaterialRenderers.sort((ce,ue)=>{const pe=ue.material.renderPriority-ce.material.renderPriority;return 0!==pe?pe:ce.material.insertOrder-ue.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let J=0;J<this._changes.updates.length;)this._pending.has(this._changes.updates.data[J].renderGeometry)?this._changes.updates.removeUnorderedIndex(J):J++;this._pending.clear()}_intersectRenderGeometry(J,ce,ue,pe,he,me){if(!J.instanceParameters.visible)return;let ge=0;(0,Z.pC)(J.transformation)&&(pe+=J.transformation[12],ge=J.transformation[13]),ee[0]=ue[0]-pe,ee[1]=ue[1]-ge,ee[2]=1,ie[0]=ue[0]-pe,ie[1]=ue[1]-ge,ie[2]=0,J.screenToWorldRatio=this.rendererContext.screenToWorldRatio,J.material.intersect(J,null,J.getShaderTransformation(),he,ee,ie,(_e,Ee,De)=>{!function Y(J,ce,ue,pe,he,me,ge){const _e={layerUid:me,graphicUid:ge,triangleNr:ce},Ee=De=>{De.set(oe.q7.OVERLAY,_e,J.dist,J.normal,J.transformation,ue,pe)};if((null==he.results.min.drapedLayerOrder||ue>=he.results.min.drapedLayerOrder)&&(null==he.results.min.dist||he.results.ground.dist<=he.results.min.dist)&&Ee(he.results.min),he.options.store!==oe.eC.MIN&&(null==he.results.max.drapedLayerOrder||ue<he.results.max.drapedLayerOrder)&&(null==he.results.max.dist||he.results.ground.dist>he.results.max.dist)&&Ee(he.results.max),he.options.store===oe.eC.ALL){const De=(0,ae.LP)(he.ray);Ee(De),he.results.all.push(De)}}(ce,De,J.material.renderPriority,me,he,J.layerUid,J.graphicUid)},J.calculateShaderTransformation,ce)}_notifyGraphicGeometryChanged(J){if((0,Z.Wi)(this.drapeSource.notifyGraphicGeometryChanged))return;let ce;for(const ue of J){const pe=ue.graphicUid;(0,Z.pC)(pe)&&pe!==ce&&(this.drapeSource.notifyGraphicGeometryChanged(pe),ce=pe)}}_notifyGraphicVisibilityChanged(J){if((0,Z.Wi)(this.drapeSource.notifyGraphicVisibilityChanged))return;let ce;for(const ue of J){const pe=ue.graphicUid;(0,Z.pC)(pe)&&pe!==ce&&(this.drapeSource.notifyGraphicVisibilityChanged(pe),ce=pe)}}_validateRenderGeometries(J){for(const ce of J)this._validateRenderGeometry(ce);return J}_validateRenderGeometry(J){return(0,Z.Wi)(J.origin)&&(J.origin=this._localOriginFactory.getOrigin(J.boundingSphere)),J}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,D._)([(0,$.Cb)()],re.prototype,"drapeSource",void 0),(0,D._)([(0,$.Cb)()],re.prototype,"updating",null),(0,D._)([(0,$.Cb)()],re.prototype,"rctx",null),(0,D._)([(0,$.Cb)()],re.prototype,"rendererContext",void 0),(0,D._)([(0,$.Cb)()],re.prototype,"_materialRepository",null),(0,D._)([(0,$.Cb)()],re.prototype,"_localOriginFactory",null),re=(0,D._)([(0,H.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],re);class j{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(ce){return this.adds.has(ce)||this.removes.has(ce)||this.removed.has(ce)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const ee=(0,X.c)(),ie=(0,X.c)()},64127:(nt,Ae,v)=>{"use strict";v.d(Ae,{JN:()=>G,P7:()=>$,RY:()=>H,YD:()=>ae,eD:()=>X,ec:()=>B,iV:()=>W,ii:()=>te,s3:()=>Q,zV:()=>Z});var D=v(42743),R=v(67969);const G={func:R.wb.LESS},Z={func:R.wb.ALWAYS},Q={mask:255},$={mask:0},W=oe=>({function:{func:R.wb.NOTEQUAL,ref:oe,mask:oe},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.KEEP}}),B=oe=>({function:{func:R.wb.ALWAYS,ref:oe,mask:oe},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.REPLACE}}),H={function:{func:R.wb.ALWAYS,ref:D.hU.OutlineVisualElementMask,mask:D.hU.OutlineVisualElementMask},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.ZERO}},X={function:{func:R.wb.ALWAYS,ref:D.hU.OutlineVisualElementMask,mask:D.hU.OutlineVisualElementMask},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.REPLACE}},te={function:{func:R.wb.EQUAL,ref:D.hU.OutlineVisualElementMask,mask:D.hU.OutlineVisualElementMask},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.KEEP}},ae={function:{func:R.wb.NOTEQUAL,ref:D.hU.OutlineVisualElementMask,mask:D.hU.OutlineVisualElementMask},operation:{fail:R.xS.KEEP,zFail:R.xS.KEEP,zPass:R.xS.KEEP}}},65542:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>W});var D=v(15861),R=v(91558),G=v(63290),Z=v(62208),Q=v(23841),$=v(4794);class W{constructor(H){this.definition=H,this.key=JSON.stringify(H),this.haloSize=Math.round(H.halo.size),this.textStyle=this._colorToRGBA(H.color),this.haloStyle=this._colorToRGB(H.halo.color),this.backgroundStyle=0!==H.background.color[3]?this._colorToRGBA(H.background.color):null}fontString(H){const X=this.definition.font;return`${X.style} ${X.weight} ${H}px ${X.family}, sans-serif`}_colorToRGB(H){return`rgb(${H.slice(0,3).map(X=>Math.floor(255*X)).toString()})`}_colorToRGBA(H){return`rgba(${H.slice(0,3).map(X=>Math.floor(255*X)).toString()},${H[3]})`}static fromSymbol(H,X=1){return(0,D.Z)(function*(){const te=(0,Z.U2)(H,"material","color"),ae=(0,Z.R2)(te,$.Z,R.Z.toUnitRGBA),oe=(0,Z.R2)(H.size,12,Q.F2),le=H.lineHeight,de=(0,Z.pC)(H.background)?R.Z.toUnitRGBA(H.background.color):$.Z,se={family:(0,Z.R2)(H.font,"sans-serif",ie=>ie.family),decoration:(0,Z.R2)(H.font,"none",ie=>ie.decoration),weight:(0,Z.R2)(H.font,"normal",ie=>ie.weight),style:(0,Z.R2)(H.font,"normal",ie=>ie.style)},re=H.halo,j=(0,Z.pC)(re)&&(0,Z.pC)(re.color)&&re.size>0?{size:(0,Q.F2)(re.size),color:R.Z.toUnitRGBA(re.color)}:{size:0,color:$.Z},Y=new W({color:ae,size:oe,background:{color:de,padding:(0,Z.pC)(H.background)?[.65*oe,.5*oe]:[0,0],borderRadius:(0,Z.pC)(H.background)?oe*(6/16):0},lineSpacingFactor:le,font:se,halo:j,pixelRatio:X}),ee=Y.fontString(oe);try{yield document.fonts.load(ee)}catch{G.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${ee}'. Some text symbology may be rendered using the default browser font.`)}return Y})()}}},6169:(nt,Ae,v)=>{"use strict";v.d(Ae,{GZ:()=>W,tV:()=>Z,vU:()=>$});var D=v(21286),R=v(62208),G=v(93605);class Z{constructor(le,de,se,re=2048){this.text=le,this._alignment=de,this._parameters=se,this._maxSize=re,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${le}`,this._lines=le.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this._backgroundHorizontalPadding)}get displayHeight(){return Math.ceil(this._lineSpacing*(this._lines.length-1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _heightMetrics(){return this._ensureHeightMetrics()}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._heightMetrics.lineHeight}get _linePadding(){return this._lineHeight*H}get _baselinePosition(){return this._heightMetrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if((0,R.Wi)(this._renderPixelRatio)){const le=this._parameters.definition.pixelRatio;this._renderPixelRatio=this._maxSize>0?Math.min(le,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):le}return this._renderPixelRatio}_getLineXOffset(le){switch(this._alignment){case $.Left:return this._backgroundHorizontalPadding;case $.Center:return(this.displayWidth-this._lineWidths[le])/2;case $.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[le]}}render(le,de=0,se=0){le.save();const re=de/=this.renderPixelRatio,j=se/=this.renderPixelRatio,Y=this._haloSize,ee=this._firstLineYOffset;de+=Y,se+=ee+this._baselinePosition;const ie=this._haloSize>0;ie&&this._renderHalo(le,re,j,Y,ee),this._setFontProperties(le,this._renderedFontSize);for(let J=0;J<this._lines.length;++J){const ce=this._lines[J],ue=this._getLineXOffset(J);ie&&(le.globalCompositeOperation="destination-out",le.fillStyle="rgb(0, 0, 0)",this._fillText(le,ce,de+ue,se),this._renderLineDecoration(le,de+ue,se,this._textWidths[J])),le.globalCompositeOperation="source-over",le.fillStyle=this._parameters.textStyle,this._fillText(le,ce,de+this._getLineXOffset(J),se),this._renderLineDecoration(le,de+ue,se,this._textWidths[J]),se+=this._lineSpacing}if(G.Z.TEXT_SHOW_BASELINE){le.strokeStyle=te,le.setLineDash([2,2]),le.lineWidth=1;let J=j+ee;for(let ce=0;ce<this._lines.length;++ce){const ue=J+this._baselinePosition;this._drawLine(le,[re,ue],[re+this.displayWidth,ue]),J+=this._lineSpacing}}G.Z.TEXT_SHOW_BORDER&&(le.strokeStyle=te,le.setLineDash([]),le.lineWidth=1,this._drawBox(le,[re,j],[this.displayWidth,this.displayHeight])),this._hasBackground&&(this._roundedRect(le,re,j,this._parameters.definition.background.borderRadius*this.renderPixelRatio),le.globalCompositeOperation="destination-over",le.fillStyle=this._parameters.backgroundStyle,le.fill()),le.restore()}_renderLineDecoration(le,de,se,re,j=!1){if("none"===this._parameters.definition.font.decoration||0===re)return;const ee=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":se+=2*ee;break;case"line-through":se-=.33*this._baselinePosition}const ie=j?this._haloSize:0;le.strokeStyle=j?this._parameters.haloStyle:this._parameters.textStyle,le.lineWidth=this._toRenderUnit(ee+2*ie),le.beginPath(),le.moveTo(this._toRenderUnit(de-ie),this._toRenderUnit(se)),le.lineTo(this._toRenderUnit(de+re+ie),this._toRenderUnit(se)),le.stroke()}_roundedRect(le,de,se,re){de=this._toRenderUnit(de),se=this._toRenderUnit(se);const j=this.renderedWidth,Y=this.renderedHeight;0!==re?(re=(0,D.uZ)(re,0,Math.floor(Y/2)),le.beginPath(),le.moveTo(de,se+re),le.arcTo(de,se,de+re,se,re),le.lineTo(de+j-re,se),le.arcTo(de+j,se,de+j,se+re,re),le.lineTo(de+j,se+Y-re),le.arcTo(de+j,se+Y,de+j-re,se+Y,re),le.lineTo(de+re,se+Y),le.arcTo(de,se+Y,de,se+Y-re,re),le.closePath()):le.rect(de,se,j,Y)}_renderHalo(le,de,se,re,j){const Y=this.renderedWidth,ee=this.renderedHeight,ie=W(B,Math.max(Y,X),Math.max(ee,X)),J=ie.getContext("2d");J.clearRect(0,0,Y,ee),this._setFontProperties(J,this._renderedFontSize),J.fillStyle=this._parameters.haloStyle,J.strokeStyle=this._parameters.haloStyle;const ce=this._renderedHaloSize<3;J.lineJoin=ce?"miter":"round",ce?this._renderHaloEmulated(J,re,j):this._renderHaloNative(J,re,j);let ue=j+this._baselinePosition;for(let pe=0;pe<this._lines.length;++pe){const he=this._getLineXOffset(pe);this._renderLineDecoration(J,re+he,ue,this._textWidths[pe],!0),ue+=this._lineSpacing}le.globalAlpha=this._parameters.definition.halo.color[3],le.drawImage(ie,0,0,Y,ee,this._toRenderUnit(de),this._toRenderUnit(se),Y,ee),le.globalAlpha=1}_renderHaloEmulated(le,de,se){se+=this._baselinePosition;for(let re=0;re<this._lines.length;++re){const j=this._lines[re],Y=this._getLineXOffset(re);for(const[ee,ie]of Q)this._fillText(le,j,de+Y+this._haloSize*ee,se+this._haloSize*ie);se+=this._lineSpacing}}_renderHaloNative(le,de,se){const re=2*this._haloSize;se+=this._baselinePosition;for(let j=0;j<this._lines.length;++j){const Y=this._lines[j],ee=this._getLineXOffset(j),ie=5,J=.1;for(let ce=0;ce<ie;ce++)le.lineWidth=this._toRenderUnit((1-(ie-1)*J+ce*J)*re),this._strokeText(le,Y,de+ee,se);se+=this._lineSpacing}}_setFontProperties(le,de){le.font=this._parameters.fontString(de),le.textAlign="left",le.textBaseline="alphabetic"}_ensureTextWidth(){if((0,R.pC)(this._displayWidth))return this._displayWidth;const le=W(B,X,X).getContext("2d");this._setFontProperties(le,this._fontSize);let de=2*this._haloSize;const se=this._parameters.definition.font;"italic"!==se.style&&"oblique"!==se.style&&"bold"!==se.weight&&"bolder"!==se.weight||(de+=.3*le.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let re=0;for(const j of this._lines){const Y=le.measureText(j).width,ee=Y+de;this._textWidths.push(Y),this._lineWidths.push(ee),re=Math.max(re,ee)}return this._displayWidth=re,this._displayWidth}_ensureHeightMetrics(){if((0,R.Wi)(this._heightMetricsCached)){const le=W(B,X,X).getContext("2d");this._setFontProperties(le,this._fontSize);const de=le.measureText(this.text+ae),se=this._hasBackground?le.measureText(this._lines[0]):de,re=1===this._lines.length?se:this._hasBackground?le.measureText(this._lines[this._lines.length-1]):de;this._heightMetricsCached={paddingTop:de.actualBoundingBoxAscent-se.actualBoundingBoxAscent,paddingBottom:de.actualBoundingBoxDescent-re.actualBoundingBoxDescent,lineHeight:de.actualBoundingBoxAscent+de.actualBoundingBoxDescent,baselinePosition:de.actualBoundingBoxAscent}}return this._heightMetricsCached}_toRenderUnit(le){return le*this.renderPixelRatio}_toRoundedRenderUnit(le){return Math.round(le*this.renderPixelRatio)}_fillText(le,de,se,re){le.fillText(de,this._toRenderUnit(se),this._toRenderUnit(re))}_strokeText(le,de,se,re){le.strokeText(de,this._toRenderUnit(se),this._toRenderUnit(re))}_drawLine(le,de,se){le.beginPath(),le.moveTo(this._toRoundedRenderUnit(de[0])+.5,this._toRoundedRenderUnit(de[1])+.5),le.lineTo(this._toRoundedRenderUnit(se[0])+.5,this._toRoundedRenderUnit(se[1])+.5),le.stroke()}_drawBox(le,de,se){const re=this._toRenderUnit(de[0]),j=this._toRenderUnit(de[1]),Y=this._toRenderUnit(se[0]),ee=this._toRenderUnit(se[1]),ie=Math.floor(re)+.5,J=Math.ceil(re+Y)-.5,ce=Math.floor(j)+.5,ue=Math.ceil(j+ee)-.5;le.beginPath(),le.moveTo(ie,ce),le.lineTo(J,ce),le.lineTo(J,ue),le.lineTo(ie,ue),le.lineTo(ie,ce),le.stroke()}}const Q=[];for(let le=0;le<360;le+=22.5)Q.push([Math.cos(Math.PI*le/180),Math.sin(Math.PI*le/180)]);var $,oe;function W(oe,le,de){return oe.canvas||(oe.canvas=document.createElement("canvas")),oe.canvas.width=le,oe.canvas.height=de,oe.canvas}(oe=$||($={}))[oe.Left=0]="Left",oe[oe.Center=1]="Center",oe[oe.Right=2]="Right";const B={canvas:null},H=.2,X=512,te="rgb(255, 0, 255, 0.5)",ae=(()=>{let oe="";for(let le=32;le<127;le++)oe+=String.fromCharCode(le);return oe})()},81695:(nt,Ae,v)=>{"use strict";v.d(Ae,{x:()=>He});var D=v(15861),R=v(94573),G=v(26584),Z=v(61885),Q=v(21286),$=v(62208),W=v(10699),B=v(55713),H=v(21726),X=v(70026),te=v(33899),ae=v(98361),oe=v(42743),le=v(13756),de=v(12699),se=v(24425),re=v(63290),j=v(67969),Y=v(55086);const ee=re.Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function ue(Ge){return Ge.charCodeAt(0)+(Ge.charCodeAt(1)<<8)+(Ge.charCodeAt(2)<<16)+(Ge.charCodeAt(3)<<24)}const he=ue("DXT1"),me=ue("DXT3"),ge=ue("DXT5");var Ie,Ge,Ce=v(19597),Be=v(2282),Fe=v(85775),je=v(26906),Re=v(38210);class He extends de.c{constructor(Pe,Le){super(),this._data=Pe,this.type=se.U.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Z.Z,this._passParameters=new ae.T,this.params=Le||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:j.e8.REPEAT,t:j.e8.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||oe.CE.STRETCH,this.estimatedTexMemRequired=He._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const Pe=this._data;(0,$.Wi)(Pe)||(Pe instanceof HTMLVideoElement?this._startPreloadVideoElement(Pe):Pe instanceof HTMLImageElement&&this._startPreloadImageElement(Pe))}_startPreloadVideoElement(Pe){if(!((0,H.jc)(Pe.src)||"auto"===Pe.preload&&Pe.crossOrigin)){Pe.preload="auto",Pe.crossOrigin="anonymous";const Le=!Pe.paused;if(Pe.src=Pe.src,Le&&Pe.autoplay){const Me=()=>{Pe.removeEventListener("canplay",Me),Pe.play()};Pe.addEventListener("canplay",Me)}}}_startPreloadImageElement(Pe){(0,H.HK)(Pe.src)||(0,H.jc)(Pe.src)||Pe.crossOrigin||(Pe.crossOrigin="anonymous",Pe.src=Pe.src)}static _getDataDimensions(Pe){return Pe instanceof HTMLVideoElement?{width:Pe.videoWidth,height:Pe.videoHeight}:Pe}static _estimateTexMemRequired(Pe,Le){if((0,$.Wi)(Pe))return 0;if((0,B.eP)(Pe)||(0,B.lq)(Pe))return Le.encoding===He.KTX2_ENCODING?(0,le._h)(Pe,Le.mipmap):Le.encoding===He.BASIS_ENCODING?(0,le.$u)(Pe,Le.mipmap):Pe.byteLength;const{width:Me,height:Ne}=Pe instanceof Image||Pe instanceof ImageData||Pe instanceof HTMLCanvasElement||Pe instanceof HTMLVideoElement?He._getDataDimensions(Pe):Le;return(Le.mipmap?4/3:1)*Me*Ne*(Le.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(Pe){return{target:j.No.TEXTURE_2D,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?j.cw.LINEAR_MIPMAP_LINEAR:j.cw.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?Pe.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(Pe,Le){if((0,$.pC)(this._glTexture))return this._glTexture;if((0,$.pC)(this._loadingPromise))return this._loadingPromise;const Me=this._data;return(0,$.Wi)(Me)?(this._glTexture=new Y.x(Pe,this._createDescriptor(Pe),null),this._glTexture):"string"==typeof Me?this._loadFromURL(Pe,Le,Me):Me instanceof Image?this._loadFromImageElement(Pe,Le,Me):Me instanceof HTMLVideoElement?this._loadFromVideoElement(Pe,Le,Me):Me instanceof ImageData||Me instanceof HTMLCanvasElement?this._loadFromImage(Pe,Me,Le):((0,B.eP)(Me)||(0,B.lq)(Me))&&this.params.encoding===He.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(Pe,Me)):((0,B.eP)(Me)||(0,B.lq)(Me))&&this.params.encoding===He.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(Pe,Me)):((0,B.eP)(Me)||(0,B.lq)(Me))&&this.params.encoding===He.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(Pe,Me)):(0,B.lq)(Me)?this._loadFromPixelData(Pe,Me):(0,B.eP)(Me)?this._loadFromPixelData(Pe,new Uint8Array(Me)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(Pe,Le,Me){if(!(this._data instanceof HTMLVideoElement)||(0,$.Wi)(this._glTexture)||this._data.readyState<Ie.HAVE_CURRENT_DATA||Me===this._data.currentTime)return Me;if((0,$.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:Ne,vao:Xe,sourceTexture:Ye}=this._powerOfTwoStretchInfo;Ye.setData(this._data),this._drawStretchedTexture(Pe,Le,Ne,Xe,Ye,this._glTexture)}else{const{videoWidth:Ne,videoHeight:Xe}=this._data,{width:Ye,height:Je}=this._glTexture.descriptor;Ne!==Ye||Xe!==Je?this._glTexture.updateData(0,0,0,Math.min(Ne,Ye),Math.min(Xe,Je),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(Pe,Le){return this._glTexture=function Ke(Ge,Pe,Le){const{textureData:Me,internalFormat:Ne,width:Xe,height:Ye}=(0,$.s3)(function We(Ge,Pe){const Le=new Int32Array(Ge,0,31);if(542327876!==Le[0])return ee.error("Invalid magic number in DDS header"),null;if(!(4&Le[20]))return ee.error("Unsupported format, must contain a FourCC code"),null;const Me=Le[21];let Ne,Xe;switch(Me){case he:Ne=8,Xe=j.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case me:Ne=16,Xe=j.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ge:Ne=16,Xe=j.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return ee.error("Unsupported FourCC code:",function pe(Ge){return String.fromCharCode(255&Ge,Ge>>8&255,Ge>>16&255,Ge>>24&255)}(Me)),null}let Ye=1,Je=Le[4],rt=Le[3];0==(3&Je)&&0==(3&rt)||(ee.warn("Rounding up compressed texture size to nearest multiple of 4."),Je=Je+3&-4,rt=rt+3&-4);const tt=Je,et=rt;let qe,ot;131072&Le[2]&&!1!==Pe&&(Ye=Math.max(1,Le[7])),1===Ye||(0,Q.wt)(Je)&&(0,Q.wt)(rt)||(ee.warn("Ignoring mipmaps of non power of two sized compressed texture."),Ye=1);let ut=Le[1]+4;const _t=[];for(let Ct=0;Ct<Ye;++Ct)ot=(Je+3>>2)*(rt+3>>2)*Ne,qe=new Uint8Array(Ge,ut,ot),_t.push(qe),ut+=ot,Je=Math.max(1,Je>>1),rt=Math.max(1,rt>>1);return{textureData:{type:"compressed",levels:_t},internalFormat:Xe,width:tt,height:et}}(Le,Pe.hasMipmap??!1));return Pe.samplingMode=Me.levels.length>1?j.cw.LINEAR_MIPMAP_LINEAR:j.cw.LINEAR,Pe.hasMipmap=Me.levels.length>1,Pe.internalFormat=Ne,Pe.width=Xe,Pe.height=Ye,new Y.x(Ge,Pe,Me)}(Pe,this._createDescriptor(Pe),Le),this._glTexture}_loadFromKTX2(Pe,Le){return this._loadAsync(()=>(0,le.pk)(Pe,this._createDescriptor(Pe),Le).then(Me=>(this._glTexture=Me,Me)))}_loadFromBasis(Pe,Le){return this._loadAsync(()=>(0,le.fX)(Pe,this._createDescriptor(Pe),Le).then(Me=>(this._glTexture=Me,Me)))}_loadFromPixelData(Pe,Le){(0,Be.hu)(this.params.width>0&&this.params.height>0);const Me=this._createDescriptor(Pe);return Me.pixelFormat=1===this.params.components?j.VI.LUMINANCE:3===this.params.components?j.VI.RGB:j.VI.RGBA,Me.width=this.params.width,Me.height=this.params.height,this._glTexture=new Y.x(Pe,Me,Le),this._glTexture}_loadFromURL(Pe,Le,Me){var Ne=this;return this._loadAsync(function(){var Xe=(0,D.Z)(function*(Ye){const Je=yield(0,X.t)(Me,{signal:Ye});return(0,W.k_)(Ye),Ne._loadFromImage(Pe,Je,Le)});return function(Ye){return Xe.apply(this,arguments)}}())}_loadFromImageElement(Pe,Le,Me){var Ne=this;return Me.complete?this._loadFromImage(Pe,Me,Le):this._loadAsync(function(){var Xe=(0,D.Z)(function*(Ye){const Je=yield(0,te.fY)(Me,Me.src,!1,Ye);return(0,W.k_)(Ye),Ne._loadFromImage(Pe,Je,Le)});return function(Ye){return Xe.apply(this,arguments)}}())}_loadFromVideoElement(Pe,Le,Me){return Me.readyState>=Ie.HAVE_CURRENT_DATA?this._loadFromImage(Pe,Me,Le):this._loadFromVideoElementAsync(Pe,Le,Me)}_loadFromVideoElementAsync(Pe,Le,Me){return this._loadAsync(Ne=>new Promise((Xe,Ye)=>{const Je=()=>{Me.removeEventListener("loadeddata",rt),Me.removeEventListener("error",tt),(0,$.hw)(et)},rt=()=>{Me.readyState>=Ie.HAVE_CURRENT_DATA&&(Je(),Xe(this._loadFromImage(Pe,Me,Le)))},tt=qe=>{Je(),Ye(qe||new G.Z("Failed to load video"))};Me.addEventListener("loadeddata",rt),Me.addEventListener("error",tt);const et=(0,W.fu)(Ne,()=>tt((0,W.zE)()))}))}_loadFromImage(Pe,Le,Me){const Ne=He._getDataDimensions(Le);this.params.width=Ne.width,this.params.height=Ne.height;const Xe=this._createDescriptor(Pe);return Xe.pixelFormat=3===this.params.components?j.VI.RGB:j.VI.RGBA,!this._requiresPowerOfTwo(Pe,Xe)||(0,Q.wt)(Ne.width)&&(0,Q.wt)(Ne.height)?(Xe.width=Ne.width,Xe.height=Ne.height,this._glTexture=new Y.x(Pe,Xe,Le),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(Pe,Le,Ne,Xe,Me),this._glTexture)}_loadAsync(Pe){const Le=new AbortController;this._loadingController=Le;const Me=Pe(Le.signal);this._loadingPromise=Me;const Ne=()=>{this._loadingController===Le&&(this._loadingController=null),this._loadingPromise===Me&&(this._loadingPromise=null)};return Me.then(Ne,Ne),Me}_requiresPowerOfTwo(Pe,Le){const Me=j.e8.CLAMP_TO_EDGE,Ne="number"==typeof Le.wrapMode?Le.wrapMode===Me:Le.wrapMode.s===Me&&Le.wrapMode.t===Me;return!(0,Re.Z)(Pe.gl)&&(Le.hasMipmap||!Ne)}_makePowerOfTwoTexture(Pe,Le,Me,Ne,Xe){const{width:Ye,height:Je}=Me,rt=(0,Q.Sf)(Ye),tt=(0,Q.Sf)(Je);let et;switch(Ne.width=rt,Ne.height=tt,this.params.powerOfTwoResizeMode){case oe.CE.PAD:Ne.textureCoordinateScaleFactor=[Ye/rt,Je/tt],et=new Y.x(Pe,Ne),et.updateData(0,0,0,Ye,Je,Le);break;case oe.CE.STRETCH:case null:case void 0:et=this._stretchToPowerOfTwo(Pe,Le,Ne,Xe());break;default:(0,R.Bg)(this.params.powerOfTwoResizeMode)}return Ne.hasMipmap&&et.generateMipmap(),et}_stretchToPowerOfTwo(Pe,Le,Me,Ne){const Xe=new Y.x(Pe,Me),Ye=new Fe.X(Pe,{colorTarget:j.Lm.TEXTURE,depthStencilTarget:j.OU.NONE},Xe),Je=new Y.x(Pe,{target:j.No.TEXTURE_2D,pixelFormat:Me.pixelFormat,dataType:j.Br.UNSIGNED_BYTE,wrapMode:j.e8.CLAMP_TO_EDGE,samplingMode:j.cw.LINEAR,flipped:!!Me.flipped,maxAnisotropy:8,preMultiplyAlpha:Me.preMultiplyAlpha},Le),rt=(0,Ce.ow)(Pe),tt=Pe.getBoundFramebufferObject();return this._drawStretchedTexture(Pe,Ne,Ye,rt,Je,Xe),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:rt,sourceTexture:Je,framebuffer:Ye}:(rt.dispose(!0),Je.dispose(),Ye.detachColorTexture(),Ye.dispose()),Pe.bindFramebuffer(tt),Xe}_drawStretchedTexture(Pe,Le,Me,Ne,Xe,Ye){this._passParameters.texture=Xe,Pe.bindFramebuffer(Me);const Je=Pe.getViewport();Pe.setViewport(0,0,Ye.descriptor.width,Ye.descriptor.height),Pe.bindTechnique(Le,this._passParameters,null),Pe.bindVAO(Ne),Pe.drawArrays(j.MX.TRIANGLE_STRIP,0,(0,je._V)(Ne,"geometry")),Pe.bindFramebuffer(null),Pe.setViewport(Je.x,Je.y,Je.width,Je.height),this._passParameters.texture=null}unload(){if((0,$.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:Pe,vao:Le,sourceTexture:Me}=this._powerOfTwoStretchInfo;Le.dispose(!0),Me.dispose(),Pe.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if((0,$.pC)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),(0,$.pC)(this._loadingController)){const Pe=this._loadingController;this._loadingController=null,this._loadingPromise=null,Pe.abort()}this.events.emit("unloaded")}}He.DDS_ENCODING="image/vnd-ms.dds",He.KTX2_ENCODING="image/ktx2",He.BASIS_ENCODING="image/x.basis",(Ge=Ie||(Ie={}))[Ge.HAVE_NOTHING=0]="HAVE_NOTHING",Ge[Ge.HAVE_METADATA=1]="HAVE_METADATA",Ge[Ge.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",Ge[Ge.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",Ge[Ge.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"},80855:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>B});var D=v(98361),R=v(651),G=v(91056),Z=v(39114),Q=v(12407),$=v(67969),W=v(2078);class B extends G.A{initializeProgram(X){return new Q.$(X.rctx,B.shader.get().build(),Z.i)}initializePipeline(){return(0,W.sm)(this.configuration.hasAlpha?{blending:(0,W.wK)($.zi.SRC_ALPHA,$.zi.ONE,$.zi.ONE_MINUS_SRC_ALPHA,$.zi.ONE_MINUS_SRC_ALPHA),colorWrite:W.BK}:{colorWrite:W.BK})}}B.shader=new R.J(D.a,()=>v.e(6859).then(v.bind(v,98101)))},97825:(nt,Ae,v)=>{"use strict";v.d(Ae,{V:()=>G});var D=v(17626),R=v(87601);class G extends R.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,D._)([(0,R.o)()],G.prototype,"hasAlpha",void 0)},44835:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{A:()=>D}),(R=D||(D={}))[R.Color=0]="Color",R[R.Alpha=1]="Alpha",R[R.FrontFace=2]="FrontFace",R[R.NONE=3]="NONE",R[R.COUNT=4]="COUNT"},2282:(nt,Ae,v)=>{"use strict";v.d(Ae,{E6:()=>te,Kj:()=>le,RQ:()=>re,T:()=>W,ep:()=>H,hu:()=>$,iV:()=>X,kG:()=>oe,tM:()=>se,u_:()=>ae,yK:()=>B,zF:()=>de});var D=v(99770),R=v(993);const Z=(0,v(4794).c)();class Q{constructor(Y){this.message=Y}toString(){return`AssertException: ${this.message}`}}function $(j,Y){if(!j)throw Y=Y||"assert",console.log(new Error(Y).stack),new Q(Y)}function W(j,Y){j||(Y=Y||"",console.warn("Verify failed: "+Y+"\n"+new Error("verify").stack))}function B(j,Y,ee,ie){let J,ce=(ee[0]-j[0])/Y[0],ue=(ie[0]-j[0])/Y[0];ce>ue&&(J=ce,ce=ue,ue=J);let pe=(ee[1]-j[1])/Y[1],he=(ie[1]-j[1])/Y[1];if(pe>he&&(J=pe,pe=he,he=J),ce>he||pe>ue)return!1;pe>ce&&(ce=pe),he<ue&&(ue=he);let me=(ee[2]-j[2])/Y[2],ge=(ie[2]-j[2])/Y[2];return me>ge&&(J=me,me=ge,ge=J),!(ce>ge||me>ue||(ge<ue&&(ue=ge),ue<0))}function H(j,Y,ee,ie,J,ce=(0,D.a)()){const ue=(ie[J]-ee[J])*(Y[0]-j[0])-(ie[0]-ee[0])*(Y[J]-j[J]);if(0===ue)return!1;const he=((ie[0]-ee[0])*(j[J]-ee[J])-(ie[J]-ee[J])*(j[0]-ee[0]))/ue;return ce[0]=j[0]+he*(Y[0]-j[0]),ce[1]=j[J]+he*(Y[J]-j[J]),!0}function X(j,Y,ee,ie,J){J||(J=j),Z[0]=j[0],Z[1]=j[1],Z[2]=j[2],Z[3]=1,(0,R.t)(Z,Z,Y),J.length>2&&(J[2]=-Z[2]),(0,R.t)(Z,Z,ee),$(0!==Z[3]),J[0]=Z[0]/Z[3],J[1]=Z[1]/Z[3],J[2]=Z[2]/Z[3],J[0]=(.5*J[0]+.5)*ie[2]+ie[0],J[1]=(.5*J[1]+.5)*ie[3]+ie[1]}function te(j,Y){return Math.log(j)/Math.log(Y)}function ae(j,Y,ee,ie){j[12]=Y,j[13]=ee,j[14]=ie}function oe(j){return 1===j[0]&&0===j[1]&&0===j[2]&&0===j[3]&&0===j[4]&&1===j[5]&&0===j[6]&&0===j[7]&&0===j[8]&&0===j[9]&&1===j[10]&&0===j[11]&&1===j[15]}function le(j,Y,ee){return 2*Math.atan(Math.sqrt(Y*Y+ee*ee)*Math.tan(.5*j)/Y)}function de(j,Y,ee){return 2*Math.atan(Math.sqrt(Y*Y+ee*ee)*Math.tan(.5*j)/ee)}function se(j,Y,ee){return 2*Math.atan(Y*Math.tan(.5*j)/Math.sqrt(Y*Y+ee*ee))}function re(j,Y,ee){return 2*Math.atan(ee*Math.tan(.5*j)/Math.sqrt(Y*Y+ee*ee))}},15197:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>R});var D=v(49353);class R extends D.U{}},16396:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{T:()=>D}),(R=D||(D={})).POSITION="position",R.NORMAL="normal",R.UV0="uv0",R.AUXPOS1="auxpos1",R.AUXPOS2="auxpos2",R.MAPPOS="mapPos",R.COLOR="color",R.SYMBOLCOLOR="symbolColor",R.SIZE="size",R.TANGENT="tangent",R.OFFSET="offset",R.SUBDIVISIONFACTOR="subdivisionFactor",R.COLORFEATUREATTRIBUTE="colorFeatureAttribute",R.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",R.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",R.DISTANCETOSTART="distanceToStart",R.UVMAPSPACE="uvMapSpace",R.BOUNDINGRECT="boundingRect",R.UVREGION="uvRegion",R.NORMALCOMPRESSED="normalCompressed",R.PROFILERIGHT="profileRight",R.PROFILEUP="profileUp",R.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",R.FEATUREVALUE="featureValue",R.MODELORIGINHI="modelOriginHi",R.MODELORIGINLO="modelOriginLo",R.MODEL="model",R.MODELNORMAL="modelNormal",R.INSTANCECOLOR="instanceColor",R.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",R.LOCALTRANSFORM="localTransform",R.GLOBALTRANSFORM="globalTransform",R.BOUNDINGSPHERE="boundingSphere",R.MODELORIGIN="modelOrigin",R.MODELSCALEFACTORS="modelScaleFactors",R.FEATUREATTRIBUTE="featureAttribute",R.STATE="state",R.LODLEVEL="lodLevel",R.POSITION0="position0",R.POSITION1="position1",R.NORMALA="normalA",R.NORMALB="normalB",R.COMPONENTINDEX="componentIndex",R.VARIANTOFFSET="variantOffset",R.VARIANTSTROKE="variantStroke",R.VARIANTEXTENSION="variantExtension",R.U8PADDING="u8padding",R.U16PADDING="u16padding",R.SIDENESS="sideness",R.START="start",R.END="end",R.UP="up",R.EXTRUDE="extrude",R.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",R.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"},34103:(nt,Ae,v)=>{"use strict";v.d(Ae,{F:()=>X,e:()=>te});var D=v(61885),R=v(72392),G=v(62208),Z=v(77029),Q=v(42743),$=v(12699),W=v(24425);const B=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var H=v(82274);class X extends $.c{constructor(oe,le=""){super(),this.apiLayerUid=le,this.type=W.U.Layer,this.events=new D.Z,this.isSliceable=!1,this._objects=new Z.Z,this._stageHandles=new R.Z,this.apiLayerUid=le,this.isVisible=oe?.isVisible??!0,this.isPickable=oe?.isPickable??!0,this.updatePolicy=oe?.updatePolicy??Q.jq.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(oe){this.detachStage(),this._stage=oe;for(const le of B)this._stageHandles.add(this.events.on(le,de=>oe.handleEvent(le,de)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(oe){this._objects.push(oe),oe.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:oe}),(0,G.pC)(this._octree)&&this._octree.add([oe])}remove(oe){this._objects.removeUnordered(oe)&&(oe.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:oe}),(0,G.pC)(this._octree)&&this._octree.remove([oe]))}addMany(oe){this._objects.pushArray(oe);for(const le of oe)le.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:oe}),(0,G.pC)(this._octree)&&this._octree.add(oe)}removeMany(oe){const le=new Array;if(this._objects.removeUnorderedMany(oe,oe.length,le),0!==le.length){for(const de of le)de.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:le}),(0,G.pC)(this._octree)&&this._octree.remove(le)}}sync(){(0,G.pC)(this._stage)&&this.updatePolicy!==Q.jq.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(oe,le){(0,G.pC)(this._octree)&&this._octree.update(oe,le)}getSpatialQueryAccelerator(){return(0,G.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,G.SC)(this._octree)}_createOctree(){this._octree=new H.Z(oe=>oe.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function te(ae){return(0,G.pC)(ae)&&ae.type===W.U.Layer}},42743:(nt,Ae,v)=>{"use strict";var D,R,G,Z,Q,$,W,B,H,X,te,ae,oe;v.d(Ae,{CE:()=>H,Gv:()=>R,Iq:()=>ae,JJ:()=>te,MX:()=>B,Rw:()=>Z,V_:()=>W,Vr:()=>D,Xx:()=>G,Yg:()=>X,hU:()=>Q,jq:()=>$}),(oe=D||(D={}))[oe.None=0]="None",oe[oe.Front=1]="Front",oe[oe.Back=2]="Back",oe[oe.COUNT=3]="COUNT",function(oe){oe[oe.Less=0]="Less",oe[oe.Lequal=1]="Lequal",oe[oe.COUNT=2]="COUNT"}(R||(R={})),function(oe){oe[oe.BACKGROUND=0]="BACKGROUND",oe[oe.UPDATE=1]="UPDATE"}(G||(G={})),function(oe){oe[oe.NOT_LOADED=0]="NOT_LOADED",oe[oe.LOADING=1]="LOADING",oe[oe.LOADED=2]="LOADED"}(Z||(Z={})),function(oe){oe[oe.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",oe[oe.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Q||(Q={})),function(oe){oe[oe.ASYNC=0]="ASYNC",oe[oe.SYNC=1]="SYNC"}($||($={})),function(oe){oe[oe.Highlight=0]="Highlight",oe[oe.MaskOccludee=1]="MaskOccludee",oe[oe.COUNT=2]="COUNT"}(W||(W={})),function(oe){oe[oe.Triangle=0]="Triangle",oe[oe.Point=1]="Point",oe[oe.Line=2]="Line"}(B||(B={})),function(oe){oe[oe.STRETCH=1]="STRETCH",oe[oe.PAD=2]="PAD"}(H||(H={})),function(oe){oe[oe.CHANGED=0]="CHANGED",oe[oe.UNCHANGED=1]="UNCHANGED"}(X||(X={})),function(oe){oe[oe.Blend=0]="Blend",oe[oe.Opaque=1]="Opaque",oe[oe.Mask=2]="Mask",oe[oe.MaskBlend=3]="MaskBlend",oe[oe.COUNT=4]="COUNT"}(te||(te={})),function(oe){oe[oe.OFF=0]="OFF",oe[oe.ON=1]="ON"}(ae||(ae={}))},14171:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>$});var D=v(15861),R=v(55713),G=v(42930),Z=v(2975),Q=v(17827);class $ extends G.q{constructor(H){super("EdgeProcessingWorker","extract",{extract:X=>[X.dataBuffer],extractComponentsEdgeLocations:X=>[X.dataBuffer],extractEdgeLocations:X=>[X.dataBuffer]},H)}process(H,X,te){var ae=this;return(0,D.Z)(function*(){if(te)return(0,Q.Kl)(H);const oe=yield ae.invoke(new W(H),X);return ae._unpackOutput(oe)})()}extractEdgeLocations(H,X){var te=this;return(0,D.Z)(function*(){const ae=yield te.invokeMethod("extractEdgeLocations",new W(H),X);return(0,Z.aj)(ae)})()}extractComponentsEdgeLocations(H,X){var te=this;return(0,D.Z)(function*(){const ae=yield te.invokeMethod("extractComponentsEdgeLocations",new W(H),X);return(0,Z.aj)(ae)})()}_unpackOutput(H){return{regular:{instancesData:(0,Z.aj)(H.regular.instancesData),lodInfo:{lengths:new Float32Array(H.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,Z.aj)(H.silhouette.instancesData),lodInfo:{lengths:new Float32Array(H.silhouette.lodInfo.lengths)}},averageEdgeLength:H.averageEdgeLength}}}class W{constructor(H){this.dataBuffer=H.data.buffer,this.writerSettings=H.writerSettings,this.skipDeduplicate=H.skipDeduplicate,this.indices=Array.isArray(H.indices)?H.indices:H.indices.buffer,this.indicesType=Array.isArray(H.indices)?"Array":(0,R.ZY)(H.indices)?"Uint32Array":"Uint16Array",this.indicesLength=H.indicesLength}}},7184:(nt,Ae,v)=>{"use strict";v.d(Ae,{Hr:()=>H,dG:()=>B,dx:()=>$,rD:()=>Q,so:()=>X,tf:()=>Z});var D=v(4511),R=v(19625),G=v(16396);const Z=(0,R.U$)().vec3f(G.T.POSITION).u16(G.T.COMPONENTINDEX).u16(G.T.U16PADDING),Q=(0,R.U$)().vec2u8(G.T.SIDENESS),$=(0,D.K)(Q),W=(0,R.U$)().vec3f(G.T.POSITION0).vec3f(G.T.POSITION1).u16(G.T.COMPONENTINDEX).u8(G.T.VARIANTOFFSET,{glNormalized:!0}).u8(G.T.VARIANTSTROKE).u8(G.T.VARIANTEXTENSION,{glNormalized:!0}).u8(G.T.U8PADDING,{glPadding:!0}).u16(G.T.U16PADDING,{glPadding:!0}),B=W.clone().vec3f(G.T.NORMAL),H=W.clone().vec3f(G.T.NORMALA).vec3f(G.T.NORMALB),X=new Map([[G.T.POSITION0,0],[G.T.POSITION1,1],[G.T.COMPONENTINDEX,2],[G.T.VARIANTOFFSET,3],[G.T.VARIANTSTROKE,4],[G.T.VARIANTEXTENSION,5],[G.T.NORMAL,6],[G.T.NORMALA,6],[G.T.NORMALB,7],[G.T.SIDENESS,8]])},89917:(nt,Ae,v)=>{"use strict";v.d(Ae,{D9:()=>de,qE:()=>se});var D=v(4619),R=v(84161),G=v(28093),Z=v(4511),Q=v(7184);class ${updateSettings(ee){this.settings=ee,this._edgeHashFunction=ee.reducedPrecision?te:X}write(ee,ie,J){const ce=this._edgeHashFunction(J);j.seed=ce;const ue=j.getIntRange(0,255),pe=j.getIntRange(0,this.settings.variants-1),me=j.getFloat(),ge=255*(.5*function le(Y,ee){const ie=Y<0?-1:1;return Math.abs(Y)**ee*ie}(-(1-Math.min(me/.7,1))+Math.max(0,me-.7)/(1-.7),1.2)+.5);ee.position0.setVec(ie,J.position0),ee.position1.setVec(ie,J.position1),ee.componentIndex.set(ie,J.componentIndex),ee.variantOffset.set(ie,ue),ee.variantStroke.set(ie,pe),ee.variantExtension.set(ie,ge)}trim(ee,ie){return ee.slice(0,ie)}}const W=new Float32Array(6),B=new Uint32Array(W.buffer),H=new Uint32Array(1);function X(Y){const ee=W;ee[0]=Y.position0[0],ee[1]=Y.position0[1],ee[2]=Y.position0[2],ee[3]=Y.position1[0],ee[4]=Y.position1[1],ee[5]=Y.position1[2],H[0]=5381;for(let ie=0;ie<B.length;ie++)H[0]=31*H[0]+B[ie];return H[0]}function te(Y){const ee=W;ee[0]=oe(Y.position0[0]),ee[1]=oe(Y.position0[1]),ee[2]=oe(Y.position0[2]),ee[3]=oe(Y.position1[0]),ee[4]=oe(Y.position1[1]),ee[5]=oe(Y.position1[2]),H[0]=5381;for(let ie=0;ie<B.length;ie++)H[0]=31*H[0]+B[ie];return H[0]}function oe(Y){return Math.round(1e4*Y)/1e4}class de{constructor(){this._commonWriter=new $}updateSettings(ee){this._commonWriter.updateSettings(ee)}allocate(ee){return Q.dG.createBuffer(ee)}write(ee,ie,J){this._commonWriter.write(ee,ie,J),(0,R.a)(re,J.faceNormal0,J.faceNormal1),(0,R.n)(re,re),ee.normal.setVec(ie,re)}trim(ee,ie){return this._commonWriter.trim(ee,ie)}}de.Layout=Q.dG,de.glLayout=(0,Z.K)(Q.dG,1);class se{constructor(){this._commonWriter=new $}updateSettings(ee){this._commonWriter.updateSettings(ee)}allocate(ee){return Q.Hr.createBuffer(ee)}write(ee,ie,J){this._commonWriter.write(ee,ie,J),ee.normalA.setVec(ie,J.faceNormal0),ee.normalB.setVec(ie,J.faceNormal1)}trim(ee,ie){return this._commonWriter.trim(ee,ie)}}se.Layout=Q.Hr,se.glLayout=(0,Z.K)(Q.Hr,1);const re=(0,G.c)(),j=new D.Z},25558:(nt,Ae,v)=>{"use strict";v.d(Ae,{P:()=>W,n:()=>B});var D=v(85931),R=v(21286),G=v(55713),Z=v(84161),Q=v(28093);const $=-1;var W,re;function B(re,j,Y,ee=se){const ie=re.vertices.position,J=re.vertices.componentIndex,ce=(0,R.Vl)(ee.anglePlanar),ue=(0,R.Vl)(ee.angleSignificantEdge),pe=Math.cos(ue),he=Math.cos(ce),me=le.edge,ge=me.position0,_e=me.position1,Ee=me.faceNormal0,De=me.faceNormal1,be=function oe(re){const j=re.faces.length/3,Y=re.vertices.position,ee=re.faces,ie=de.v0,J=de.v1,ce=de.v2,ue=new Float32Array(3*j);for(let pe=0;pe<j;pe++){const me=ee[3*pe+1],ge=ee[3*pe+2];Y.getVec(ee[3*pe+0],ie),Y.getVec(me,J),Y.getVec(ge,ce),(0,Z.b)(J,J,ie),(0,Z.b)(ce,ce,ie),(0,Z.f)(ie,J,ce),(0,Z.n)(ie,ie),ue[3*pe+0]=ie[0],ue[3*pe+1]=ie[1],ue[3*pe+2]=ie[2]}return ue}(re),Se=function ae(re){const j=re.faces.length/3,Y=re.faces,ee=re.neighbors;let ie=0;for(let ue=0;ue<j;ue++){const ge=Y[3*ue+0],_e=Y[3*ue+1],Ee=Y[3*ue+2];ie+=ee[3*ue+0]===$||ge<_e?1:0,ie+=ee[3*ue+1]===$||_e<Ee?1:0,ie+=ee[3*ue+2]===$||Ee<ge?1:0}const J=new Int32Array(4*ie);let ce=0;for(let ue=0;ue<j;ue++){const pe=ee[3*ue+0],he=ee[3*ue+1],me=ee[3*ue+2],ge=Y[3*ue+0],_e=Y[3*ue+1],Ee=Y[3*ue+2];(pe===$||ge<_e)&&(J[ce++]=ge,J[ce++]=_e,J[ce++]=ue,J[ce++]=pe),(he===$||_e<Ee)&&(J[ce++]=_e,J[ce++]=Ee,J[ce++]=ue,J[ce++]=he),(me===$||Ee<ge)&&(J[ce++]=Ee,J[ce++]=ge,J[ce++]=ue,J[ce++]=me)}return J}(re),ye=Se.length/4,ve=j.allocate(ye);let xe=0;const Ke=Y.allocate(ye);let We=0,Ce=0,Be=0;const Fe=(0,D.w6)(0,ye),je=new Float32Array(ye);(0,G.Ed)(je,(Pe,Le,Me)=>{ie.getVec(Se[4*Le+0],ge),ie.getVec(Se[4*Le+1],_e),Me[Le]=(0,Z.i)(ge,_e)}),Fe.sort((Pe,Le)=>je[Le]-je[Pe]);const Re=new Array,He=new Array;for(let Pe=0;Pe<ye;Pe++){const Le=Fe[Pe],Me=je[Le],Ne=Se[4*Le+0],Xe=Se[4*Le+1],Ye=Se[4*Le+2],Je=Se[4*Le+3],rt=Je===$;if(ie.getVec(Ne,ge),ie.getVec(Xe,_e),rt)(0,Z.s)(Ee,be[3*Ye+0],be[3*Ye+1],be[3*Ye+2]),(0,Z.c)(De,Ee),me.componentIndex=J.get(Ne),me.cosAngle=(0,Z.e)(Ee,De);else{if((0,Z.s)(Ee,be[3*Ye+0],be[3*Ye+1],be[3*Ye+2]),(0,Z.s)(De,be[3*Je+0],be[3*Je+1],be[3*Je+2]),me.componentIndex=J.get(Ne),me.cosAngle=(0,Z.e)(Ee,De),X(me,he))continue;me.cosAngle<-.9999&&(0,Z.c)(De,Ee)}Ce+=Me,Be++,rt||H(me,pe)?(j.write(ve,xe++,me),Re.push(Me)):te(me,ce)&&(Y.write(Ke,We++,me),He.push(Me))}const Ie=new Float32Array(Re.reverse()),Ge=new Float32Array(He.reverse());return{regular:{instancesData:j.trim(ve,xe),lodInfo:{lengths:Ie}},silhouette:{instancesData:Y.trim(Ke,We),lodInfo:{lengths:Ge}},averageEdgeLength:Ce/Be}}function H(re,j){return re.cosAngle<j}function X(re,j){return re.cosAngle>j}function te(re,j){const Y=(0,R.ZF)(re.cosAngle),ee=le.fwd,ie=le.ortho;return(0,Z.r)(ee,re.position1,re.position0),Y*((0,Z.e)((0,Z.f)(ie,re.faceNormal0,re.faceNormal1),ee)>0?-1:1)>j}(re=W||(W={}))[re.SOLID=0]="SOLID",re[re.SKETCH=1]="SKETCH";const le={edge:{position0:(0,Q.c)(),position1:(0,Q.c)(),faceNormal0:(0,Q.c)(),faceNormal1:(0,Q.c)(),componentIndex:0,cosAngle:0},ortho:(0,Q.c)(),fwd:(0,Q.c)()},de={v0:(0,Q.c)(),v1:(0,Q.c)(),v2:(0,Q.c)()},se={anglePlanar:4,angleSignificantEdge:35}},17827:(nt,Ae,v)=>{"use strict";v.d(Ae,{Kl:()=>B,n_:()=>le,kY:()=>H,Yr:()=>oe});var D=v(13757);function R(de,se,re){const j=se/3,Y=new Uint32Array(re+1),ee=new Uint32Array(re+1),ie=(be,Se)=>{be<Se?Y[be+1]++:ee[Se+1]++};for(let be=0;be<j;be++){const Se=de[3*be],ye=de[3*be+1],ve=de[3*be+2];ie(Se,ye),ie(ye,ve),ie(ve,Se)}let J=0,ce=0;for(let be=0;be<re;be++){const Se=Y[be+1],ye=ee[be+1];Y[be+1]=J,ee[be+1]=ce,J+=Se,ce+=ye}const ue=new Uint32Array(6*j),pe=Y[re],he=(be,Se,ye)=>{if(be<Se){const ve=Y[be+1]++;ue[2*ve]=Se,ue[2*ve+1]=ye}else{const ve=ee[Se+1]++;ue[2*pe+2*ve]=be,ue[2*pe+2*ve+1]=ye}};for(let be=0;be<j;be++){const Se=de[3*be],ye=de[3*be+1],ve=de[3*be+2];he(Se,ye,be),he(ye,ve,be),he(ve,Se,be)}const me=(be,Se)=>{const ye=2*be,ve=Se-be;for(let xe=1;xe<ve;xe++){const ze=ue[ye+2*xe],Ke=ue[ye+2*xe+1];let We=xe-1;for(;We>=0&&ue[ye+2*We]>ze;We--)ue[ye+2*We+2]=ue[ye+2*We],ue[ye+2*We+3]=ue[ye+2*We+1];ue[ye+2*We+2]=ze,ue[ye+2*We+3]=Ke}};for(let be=0;be<re;be++)me(Y[be],Y[be+1]),me(pe+ee[be],pe+ee[be+1]);const ge=new Int32Array(3*j),_e=(be,Se)=>be===de[3*Se]?0:be===de[3*Se+1]?1:be===de[3*Se+2]?2:-1,Ee=(be,Se)=>{const ye=_e(be,Se);ge[3*Se+ye]=-1},De=(be,Se,ye,ve)=>{const xe=_e(be,Se);ge[3*Se+xe]=ve;const ze=_e(ye,ve);ge[3*ve+ze]=Se};for(let be=0;be<re;be++){let Se=Y[be];const ye=Y[be+1];let ve=ee[be];const xe=ee[be+1];for(;Se<ye&&ve<xe;){const ze=ue[2*Se],Ke=ue[2*pe+2*ve];ze===Ke?(De(be,ue[2*Se+1],Ke,ue[2*pe+2*ve+1]),Se++,ve++):ze<Ke?(Ee(be,ue[2*Se+1]),Se++):(Ee(Ke,ue[2*pe+2*ve+1]),ve++)}for(;Se<ye;)Ee(be,ue[2*Se+1]),Se++;for(;ve<xe;)Ee(ue[2*pe+2*ve],ue[2*pe+2*ve+1]),ve++}return ge}var G=v(19625),Z=v(16396),Q=v(7184),$=v(89917),W=v(25558);function B(de){const se=H(de.data,de.skipDeduplicate,de.indices,de.indicesLength);return te.updateSettings(de.writerSettings),ae.updateSettings(de.writerSettings),(0,W.n)(se,te,ae)}function H(de,se,re,j){if(se){const ie=R(re,j,de.count);return new X(re,j,ie,de)}const Y=(0,D.d)(de.buffer,de.stride/4,{originalIndices:re,originalIndicesLength:j}),ee=R(Y.indices,j,Y.uniqueCount);return{faces:Y.indices,facesLength:Y.indices.length,neighbors:ee,vertices:Q.tf.createView(Y.buffer)}}class X{constructor(se,re,j,Y){this.faces=se,this.facesLength=re,this.neighbors=j,this.vertices=Y}}const te=new $.D9,ae=new $.qE,oe=(0,G.U$)().vec3f(Z.T.POSITION0).vec3f(Z.T.POSITION1),le=(0,G.U$)().vec3f(Z.T.POSITION0).vec3f(Z.T.POSITION1).u16(Z.T.COMPONENTINDEX).u16(Z.T.U16PADDING,{glPadding:!0})},17803:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{i:()=>D}),(R=D||(D={}))[R.INVISIBLE=0]="INVISIBLE",R[R.TRANSPARENT=1]="TRANSPARENT",R[R.OPAQUE=2]="OPAQUE"},36848:(nt,Ae,v)=>{"use strict";v.d(Ae,{NO:()=>Q,cM:()=>Z,qZ:()=>$});var D=v(84161),R=v(28093),G=v(11544);function Z(te,ae,oe){if(!te||!ae)return!1;const{size:le,data:de}=te;(0,D.s)(oe,0,0,0),(0,D.s)(X,0,0,0);let se=0,re=0;for(let j=0;j<ae.length-2;j+=3){const Y=ae[j+0]*le,ee=ae[j+1]*le,ie=ae[j+2]*le;(0,D.s)(W,de[Y+0],de[Y+1],de[Y+2]),(0,D.s)(B,de[ee+0],de[ee+1],de[ee+2]),(0,D.s)(H,de[ie+0],de[ie+1],de[ie+2]);const J=(0,G.bE)(W,B,H);J?((0,D.a)(W,W,B),(0,D.a)(W,W,H),(0,D.g)(W,W,1/3*J),(0,D.a)(oe,oe,W),se+=J):((0,D.a)(X,X,W),(0,D.a)(X,X,B),(0,D.a)(X,X,H),re+=3)}return!(0===re&&0===se||(0!==se?((0,D.g)(oe,oe,1/se),0):0===re||((0,D.g)(oe,X,1/re),0)))}function Q(te,ae,oe){if(!te||!ae)return!1;const{size:le,data:de}=te;(0,D.s)(oe,0,0,0);let se=-1,re=0;for(let j=0;j<ae.length;j++){const Y=ae[j]*le;se!==Y&&(oe[0]+=de[Y+0],oe[1]+=de[Y+1],oe[2]+=de[Y+2],re++),se=Y}return re>1&&(0,D.g)(oe,oe,1/re),re>0}function $(te,ae,oe,le){if(!te)return!1;const{size:de,data:se}=te;(0,D.s)(le,0,0,0),(0,D.s)(X,0,0,0);let re=0,j=0;const Y=ae?ae.length-1:se.length/de-1,ee=Y+(oe?2:0);for(let ie=0;ie<ee;ie+=2){const J=ie<Y?ie:Y,ce=ie<Y?ie+1:0,ue=(ae?ae[J]:J)*de,pe=(ae?ae[ce]:ce)*de;W[0]=se[ue+0],W[1]=se[ue+1],W[2]=se[ue+2],B[0]=se[pe+0],B[1]=se[pe+1],B[2]=se[pe+2],(0,D.g)(W,(0,D.a)(W,W,B),.5);const he=(0,D.j)(W,B);he>0?((0,D.a)(le,le,(0,D.g)(W,W,he)),re+=he):((0,D.a)(X,X,W),j++)}return 0!==re?((0,D.g)(le,le,1/re),!0):0!==j&&((0,D.g)(le,X,1/j),!0)}const W=(0,R.c)(),B=(0,R.c)(),H=(0,R.c)(),X=(0,R.c)()},19597:(nt,Ae,v)=>{"use strict";v.d(Ae,{E9:()=>B,YO:()=>te,hf:()=>ae,l_:()=>X,ow:()=>W});var D=v(39114),R=v(59631),G=v(15197),Z=v(83994),Q=v(67969),$=v(55086);function W(oe,le=R.QI,de=D.i,se=-1,re=1){let j=null;return j=le===R.Bn?new Float32Array([se,se,0,0,re,se,1,0,se,re,0,1,re,re,1,1]):new Float32Array([se,se,re,se,se,re,re,re]),new G.U(oe,de,{geometry:le},{geometry:Z.f.createVertex(oe,Q.l1.STATIC_DRAW,j)})}function B(oe,le=R.QI,de=D.i){const se=new Float32Array([-1,-1,3,-1,-1,3]);return new G.U(oe,de,{geometry:le},{geometry:Z.f.createVertex(oe,Q.l1.STATIC_DRAW,se)})}function X(oe,le=4){return new $.x(oe,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:le,height:le})}function te(oe,le,de=4){const se=new Uint8Array(de*de*4);for(let re=0;re<se.length;re+=4)se[re+0]=255*le[0],se[re+1]=255*le[1],se[re+2]=255*le[2],se[re+3]=255*le[3];return new $.x(oe,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:de,height:de},se)}function ae(oe){return new $.x(oe,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},91480:(nt,Ae,v)=>{"use strict";v.d(Ae,{G1:()=>H,e4:()=>W,es:()=>B,nn:()=>$});var D=v(62208),R=v(84161),G=v(28093),Z=v(41743),Q=v(67857);function $(te){return(0,D.pC)(te)&&(0,D.pC)(te.dist)}function W(te){return(ae,oe,le)=>((0,R.h)(X,ae,oe,le),!(0,Z.e)(te,X))}function B(te){return $(te)&&te.intersector===Q.q7.OBJECT&&!!te.target}function H(te){return $(te)&&te.intersector===Q.q7.HUD&&!!te.target&&(0,D.pC)(te.target.center)}const X=(0,G.c)()},55314:(nt,Ae,v)=>{"use strict";v.d(Ae,{VB:()=>Y,_s:()=>ee,tB:()=>ae,bK:()=>oe,J4:()=>te});var D=v(62208),R=v(28347),G=v(28093),Z=v(5548),Q=v(97126),$=v(77926),W=v(90793),B=v(91480),H=v(67857);function X(J){return(0,B.nn)(J)&&J.intersector===H.q7.LOD&&!!J.target}function te(J,ce){return(0,B.es)(J)||(0,B.G1)(J)?j(J.target.object.metadata,ce):(0,W.T)(J)?ce.map?.ground:(0,$.a)(J)||(0,$.G)(J)||(0,W.j)(J)?j(J.target,ce):null}function ae(J,ce){const ue=oe(J,ce);return(0,D.pC)(ue)&&"graphic"===ue.type?ue.graphic:null}function oe(J,ce){if((0,D.Wi)(J))return null;if((0,B.es)(J)||(0,B.G1)(J))return le(J.target.object.metadata,ce);if((0,$.a)(J)){const ue=J.target.createGraphic();return{type:"graphic",graphic:ue,layer:ue.layer}}return(0,W.j)(J)||X(J)?le(J.target,ce):(0,$.G)(J)?function de(J,ce){const ue=j(J,ce);if((0,D.Wi)(ue))return null;const pe=ce.allLayerViews.find(he=>he.layer===ue);return pe&&!pe.suspended&&"getGraphicFromIntersectorTarget"in pe?function re(J){return(0,D.pC)(J)?{type:"graphic",graphic:J,layer:J.layer}:null}(pe.getGraphicFromIntersectorTarget(J)):null}(J.target,ce):null}function le(J,ce){if((0,D.Wi)(J)||(0,D.Wi)(J.graphicUid))return null;const ue=j(J,ce);if((0,D.Wi)(ue))return null;if(ue===ce.graphics)return(0,D.Wi)(ce.graphicsView)||"number"!=typeof J.graphicUid?null:ce.graphicsView.getHit(J.graphicUid);const pe=ce.allLayerViews.find(he=>he.layer===ue);return!pe||pe.suspended||(0,D.Wi)(J.graphicUid)?null:"getHit"in pe?pe.getHit(J.graphicUid):null}function j(J,ce){return(0,D.Wi)(J.layerUid)?null:(0,D.pC)(ce.graphicsView)&&J.layerUid===ce.graphicsView.processor.layer.id?ce.graphics:ce.map.findLayerByUid(J.layerUid)}function Y(J,ce){if((0,B.es)(J)||(0,B.G1)(J))return(0,Q.a)(J.target.object.boundingVolumeWorldSpace.bounds);if(X(J)){(0,R.l)(ie,J.transformation);const ue=Math.max(ie[0],ie[1],ie[2]);return J.target.baseBoundingSphere.radius*ue}return(0,$.G)(J)?(0,D.yw)(function se(J,ce){const ue=j(J,ce);if((0,D.Wi)(ue))return null;const pe=ce.allLayerViews.find(he=>he.layer===ue);return pe&&!pe.suspended&&"getAABBFromIntersectorTarget"in pe?pe.getAABBFromIntersectorTarget(J):null}(J.target,ce),ue=>.5*(0,Z.wz)(ue)):null}function ee(J){return!(0,B.es)(J)&&!(0,B.G1)(J)&&(X(J)?J.target.numLodLevels>1:!!(0,$.G)(J))}const ie=(0,G.c)()},47526:(nt,Ae,v)=>{"use strict";v.d(Ae,{HI:()=>$,VQ:()=>G,VV:()=>Z,aH:()=>R,ci:()=>Q});var D=v(85931);function R(W){const B=[];return W.levels.forEach(H=>{H.components.forEach(X=>{B.push(X.material)})}),(0,D.Tw)(B)}function G(W){const B=new Array;return W.levels.forEach(H=>{H.components.forEach(X=>{X.textures&&B.push(...X.textures)})}),(0,D.Tw)(B)}function Z(W){const B=[];return W.components.forEach(H=>{B.push(H.geometry)}),(0,D.Tw)(B)}function Q(W){const B=[];return W.levels.forEach(H=>{H.components.forEach(X=>{B.push(X.geometry)})}),(0,D.Tw)(B)}function $(W){return Z(W).reduce((B,H)=>B+H.indexCount/3,0)}},83196:(nt,Ae,v)=>{"use strict";v.d(Ae,{q:()=>R});var D=v(26594);function R(Z){const Q=new Map,$=W=>{let B=Q.get(W);return B||(B=new D.t9,Q.set(W,B)),B};return Z.removes.forAll(W=>{G(W)&&$(W.material).removes.push(W)}),Z.adds.forAll(W=>{G(W)&&$(W.material).adds.push(W)}),Z.updates.forAll(W=>{G(W.renderGeometry)&&$(W.renderGeometry.material).updates.push(W)}),Q}function G(Z){return Z.data.indexCount>=1}},17962:(nt,Ae,v)=>{"use strict";v.d(Ae,{Gw:()=>G,PV:()=>X,TU:()=>te,bA:()=>ae,n9:()=>Z,sX:()=>B});var D=v(21286),R=v(59617);function G(Y,ee){return new oe(Y,le,ee)}function Z(Y,ee){const{curvatureDependent:ie,scaleStart:J,scaleFallOffRange:ce}=le;return new oe(Y,{curvatureDependent:{min:{curvature:ie.min.curvature,tiltAngle:ie.min.tiltAngle,scaleFallOffFactor:de.curvatureDependent.min.scaleFallOffFactor},max:{curvature:ie.max.curvature,tiltAngle:ie.max.tiltAngle,scaleFallOffFactor:de.curvatureDependent.max.scaleFallOffFactor}},scaleStart:J,scaleFallOffRange:ce,minPixelSize:de.minPixelSize},ee)}function $(Y,ee,ie){const J=ie.parameters,ce=ie.paddingPixelsOverride;return re.scale=Math.min(J.divisor/(ee-J.offset),1),re.factor=function Q(Y){return Math.abs(Y*Y*Y)}(Y),re.minPixelSize=J.minPixelSize,re.paddingPixels=ce,re}function W(Y,ee){return 0===Y?ee.minPixelSize:ee.minPixelSize*(1+2*ee.paddingPixels/Y)}function B(Y,ee){return Math.max((0,D.t7)(Y*ee.scale,Y,ee.factor),W(Y,ee))}function X(Y,ee,ie,J){J.scale=function H(Y,ee,ie){const J=$(Y,ee,ie);return J.minPixelSize=0,J.paddingPixels=0,B(1,J)}(Y,ee,ie),J.factor=0,J.minPixelSize=ie.parameters.minPixelSize,J.paddingPixels=ie.paddingPixelsOverride}function te(Y,ee,ie=[0,0]){const J=Math.min(Math.max(ee.scale,W(Y[1],ee)/Math.max(1e-5,Y[1])),1);return ie[0]=Y[0]*J,ie[1]=Y[1]*J,ie}function ae(Y,ee,ie,J){return B(Y,$(ee,ie,J))}class oe{constructor(ee,ie,J,ce={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},ue){this._viewingMode=ee,this._description=ie,this._ellipsoidRadius=J,this.parameters=ce,this._paddingPixelsOverride=ue,this._viewingMode===R.JY.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(ee){return!(this.parameters&&this.parameters.camera.fovY===ee.fovY&&this.parameters.camera.distance===ee.distance||(this._calculateParameters(ee,this._ellipsoidRadius,this.parameters),0))}overridePadding(ee){return ee!==this.paddingPixelsOverride?new oe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,ee):this}_calculateParameters(ee,ie,J){const{scaleStart:ce,scaleFallOffRange:ue,minPixelSize:pe}=this._description,{fovY:he,distance:me}=ee,ge=this._calculateCurvatureDependentParameters(ee,ie),_e=this._coverageCompensation(ee,ie,ge),{tiltAngle:Ee,scaleFallOffFactor:De}=ge,be=Math.sin(Ee)*me,Se=.5*Math.PI-Ee-he*(.5-ce*_e),ye=be/Math.cos(Se),xe=(ye-De*(be/Math.cos(Se+he*ue*_e)))/(1-De);return J.camera.fovY=ee.fovY,J.camera.distance=ee.distance,J.offset=xe,J.divisor=ye-xe,J.minPixelSize=pe,J}_calculateCurvatureDependentParametersLocal(ee,ie,J=j){return J.tiltAngle=this._description.curvatureDependent.min.tiltAngle,J.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,J}_calculateCurvatureDependentParametersGlobal(ee,ie,J=j){const ce=this._description.curvatureDependent,ue=1+ee.distance/ie,pe=Math.sqrt(ue*ue-1),[he,me]=[ce.min.curvature,ce.max.curvature],ge=(0,D.uZ)((pe-he)/(me-he),0,1),[_e,Ee]=[ce.min,ce.max];return J.tiltAngle=(0,D.t7)(_e.tiltAngle,Ee.tiltAngle,ge),J.scaleFallOffFactor=(0,D.t7)(_e.scaleFallOffFactor,Ee.scaleFallOffFactor,ge),J}_surfaceCoverageCompensationLocal(ee,ie,J){return(ee.fovY-J.tiltAngle)/ee.fovY}_surfaceCoverageCompensationGlobal(ee,ie,J){const ce=ie*ie,ue=J.tiltAngle+.5*Math.PI,{fovY:pe,distance:he}=ee,me=he*he+ce-2*Math.cos(ue)*he*ie,ge=Math.sqrt(me),_e=Math.sqrt(me-ce);return(Math.acos(_e/ge)-Math.asin(ie/(ge/Math.sin(ue)))+.5*pe)/pe}}const le={curvatureDependent:{min:{curvature:(0,D.Vl)(10),tiltAngle:(0,D.Vl)(12),scaleFallOffFactor:.5},max:{curvature:(0,D.Vl)(70),tiltAngle:(0,D.Vl)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},de={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},re={scale:0,factor:0,minPixelSize:0,paddingPixels:0},j={tiltAngle:0,scaleFallOffFactor:0}},39782:(nt,Ae,v)=>{"use strict";v.d(Ae,{p:()=>R,y:()=>D});const D={orderedRepackingEnabled:!1},R={rootOrigin:null}},40841:(nt,Ae,v)=>{"use strict";v.d(Ae,{W9:()=>ie,cy:()=>he,iO:()=>ce,lV:()=>pe,yn:()=>ae});var D=v(62208),R=v(30217),G=v(550),Z=v(28347),Q=v(43703),$=v(48977),W=v(78451),B=v(84161),H=v(14658),X=v(28093),te=v(97126);class ae{constructor(){this._transform=(0,Q.c)(),this._transformInverse=new oe({value:this._transform},Z.a,Q.c),this._transformInverseTranspose=new oe(this._transformInverse,Z.t,Q.c),this._transformTranspose=new oe({value:this._transform},Z.t,Q.c),this._transformInverseRotation=new oe({value:this._transform},R.n,G.c)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(_e){(0,Z.c)(this._transform,_e)}multiplyTransform(_e){(0,Z.m)(this._transform,this._transform,_e)}set(_e){(0,Z.c)(this._transform,_e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(_e,Ee){this.setTransformMatrix(_e),this.multiplyTransform(Ee),this._invalidateLazyTransforms()}}class oe{constructor(_e,Ee,De){this._original=_e,this._update=Ee,this._dirty=!0,this._transform=De()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const de=(0,X.c)(),se=(0,X.c)(),re=(0,X.c)(),ee=new class Y{constructor(_e=0){this.offset=_e,this.sphere=(0,te.c)(),this.tmpVertex=(0,X.c)()}applyToVertex(_e,Ee,De){const be=this.objectTransform.transform;let Se=be[0]*_e+be[4]*Ee+be[8]*De+be[12],ye=be[1]*_e+be[5]*Ee+be[9]*De+be[13],ve=be[2]*_e+be[6]*Ee+be[10]*De+be[14];const xe=this.offset/Math.sqrt(Se*Se+ye*ye+ve*ve);Se+=Se*xe,ye+=ye*xe,ve+=ve*xe;const ze=this.objectTransform.inverse;return this.tmpVertex[0]=ze[0]*Se+ze[4]*ye+ze[8]*ve+ze[12],this.tmpVertex[1]=ze[1]*Se+ze[5]*ye+ze[9]*ve+ze[13],this.tmpVertex[2]=ze[2]*Se+ze[6]*ye+ze[10]*ve+ze[14],this.tmpVertex}applyToMinMax(_e,Ee){const De=this.offset/Math.sqrt(_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2]);_e[0]+=_e[0]*De,_e[1]+=_e[1]*De,_e[2]+=_e[2]*De;const be=this.offset/Math.sqrt(Ee[0]*Ee[0]+Ee[1]*Ee[1]+Ee[2]*Ee[2]);Ee[0]+=Ee[0]*be,Ee[1]+=Ee[1]*be,Ee[2]+=Ee[2]*be}applyToAabb(_e){const Ee=this.offset/Math.sqrt(_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2]);_e[0]+=_e[0]*Ee,_e[1]+=_e[1]*Ee,_e[2]+=_e[2]*Ee;const De=this.offset/Math.sqrt(_e[3]*_e[3]+_e[4]*_e[4]+_e[5]*_e[5]);return _e[3]+=_e[3]*De,_e[4]+=_e[4]*De,_e[5]+=_e[5]*De,_e}applyToBoundingSphere(_e){const Ee=Math.sqrt(_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2]),De=this.offset/Ee;return this.sphere[0]=_e[0]+_e[0]*De,this.sphere[1]=_e[1]+_e[1]*De,this.sphere[2]=_e[2]+_e[2]*De,this.sphere[3]=_e[3]+_e[3]*this.offset/Ee,this.sphere}};function ie(ge){return(0,D.pC)(ge)?(ee.offset=ge,ee):null}const J=new class j{constructor(_e=0){this.componentLocalOriginLength=0,this._tmpVertex=(0,X.c)(),this._mbs=(0,te.c)(),this._obb={center:(0,X.c)(),halfSize:(0,H.c)(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(_e)}_resetOffset(_e){this._offset=_e,this._totalOffset=_e}set offset(_e){this._resetOffset(_e)}get offset(){return this._offset}set componentOffset(_e){this._totalOffset=this._offset+_e}set localOrigin(_e){this.componentLocalOriginLength=Math.sqrt(_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2])}applyToVertex(_e,Ee,De){const be=_e,Se=Ee,ye=De+this.componentLocalOriginLength,ve=this._totalOffset/Math.sqrt(be*be+Se*Se+ye*ye);return this._tmpVertex[0]=_e+be*ve,this._tmpVertex[1]=Ee+Se*ve,this._tmpVertex[2]=De+ye*ve,this._tmpVertex}applyToAabb(_e){const Ee=_e[0],De=_e[1],be=_e[2]+this.componentLocalOriginLength,Se=_e[3],ye=_e[4],ve=_e[5]+this.componentLocalOriginLength,xe=Ee*Se<0?0:Math.min(Math.abs(Ee),Math.abs(Se)),ze=De*ye<0?0:Math.min(Math.abs(De),Math.abs(ye)),Ke=be*ve<0?0:Math.min(Math.abs(be),Math.abs(ve)),We=Math.sqrt(xe*xe+ze*ze+Ke*Ke);if(We<this._totalOffset)return _e[0]-=Ee<0?this._totalOffset:0,_e[1]-=De<0?this._totalOffset:0,_e[2]-=be<0?this._totalOffset:0,_e[3]+=Se>0?this._totalOffset:0,_e[4]+=ye>0?this._totalOffset:0,_e[5]+=ve>0?this._totalOffset:0,_e;const Ce=Math.max(Math.abs(Ee),Math.abs(Se)),Be=Math.max(Math.abs(De),Math.abs(ye)),Fe=Math.max(Math.abs(be),Math.abs(ve)),je=Math.sqrt(Ce*Ce+Be*Be+Fe*Fe),Re=this._totalOffset/je,He=this._totalOffset/We;return _e[0]+=Ee*(Ee>0?Re:He),_e[1]+=De*(De>0?Re:He),_e[2]+=be*(be>0?Re:He),_e[3]+=Se*(Se<0?Re:He),_e[4]+=ye*(ye<0?Re:He),_e[5]+=ve*(ve<0?Re:He),_e}applyToMbs(_e){const Ee=Math.sqrt(_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2]),De=this._totalOffset/Ee;return this._mbs[0]=_e[0]+_e[0]*De,this._mbs[1]=_e[1]+_e[1]*De,this._mbs[2]=_e[2]+_e[2]*De,this._mbs[3]=_e[3]+_e[3]*this._totalOffset/Ee,this._mbs}applyToObb(_e){const Ee=_e.center,De=this._totalOffset/Math.sqrt(Ee[0]*Ee[0]+Ee[1]*Ee[1]+Ee[2]*Ee[2]);this._obb.center[0]=Ee[0]+Ee[0]*De,this._obb.center[1]=Ee[1]+Ee[1]*De,this._obb.center[2]=Ee[2]+Ee[2]*De,(0,B.q)(this._obb.halfSize,_e.halfSize,_e.quaternion),(0,B.a)(this._obb.halfSize,this._obb.halfSize,_e.center);const be=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*be,this._obb.halfSize[1]+=this._obb.halfSize[1]*be,this._obb.halfSize[2]+=this._obb.halfSize[2]*be,(0,B.b)(this._obb.halfSize,this._obb.halfSize,_e.center),(0,$.c)(me,_e.quaternion),(0,B.q)(this._obb.halfSize,this._obb.halfSize,me),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=_e.quaternion,this._obb}};function ce(ge){return(0,D.pC)(ge)?(J.offset=ge,J):null}const ue=new class le{constructor(_e=0){this.offset=_e,this.tmpVertex=(0,X.c)()}applyToVertex(_e,Ee,De){const be=_e+this.localOrigin[0],Se=Ee+this.localOrigin[1],ye=De+this.localOrigin[2],ve=this.offset/Math.sqrt(be*be+Se*Se+ye*ye);return this.tmpVertex[0]=_e+be*ve,this.tmpVertex[1]=Ee+Se*ve,this.tmpVertex[2]=De+ye*ve,this.tmpVertex}applyToAabb(_e){for(let Se=0;Se<3;++Se)de[Se]=_e[0+Se]+this.localOrigin[Se],se[Se]=_e[3+Se]+this.localOrigin[Se],re[Se]=de[Se];const Ee=this.applyToVertex(de[0],de[1],de[2]);for(let Se=0;Se<3;++Se)_e[Se]=Ee[Se],_e[Se+3]=Ee[Se];const De=Se=>{const ye=this.applyToVertex(Se[0],Se[1],Se[2]);for(let ve=0;ve<3;++ve)_e[ve+0]=Math.min(_e[ve+0],ye[ve]),_e[ve+3]=Math.max(_e[ve+3],ye[ve])};for(let Se=1;Se<8;++Se){for(let ye=0;ye<3;++ye)re[ye]=0==(Se&1<<ye)?de[ye]:se[ye];De(re)}let be=0;for(let Se=0;Se<3;++Se)de[Se]*se[Se]<0&&(be|=1<<Se);if(0!==be&&7!==be)for(let Se=0;Se<8;++Se)if(0==(be&Se)){for(let ye=0;ye<3;++ye)re[ye]=be[ye]?0:0!=(Se&1<<ye)?de[ye]:se[ye];De(re)}for(let Se=0;Se<3;++Se)_e[Se+0]-=this.localOrigin[Se],_e[Se+3]-=this.localOrigin[Se];return _e}};function pe(ge){return(0,D.pC)(ge)?(ue.offset=ge,ue):null}const he="terrain",me=(0,W.a)()},82244:(nt,Ae,v)=>{"use strict";v.d(Ae,{AM:()=>G,Eg:()=>Z,Mi:()=>R,Ur:()=>Q});var D=v(28093);class R{constructor(W=(0,D.c)()){this.intensity=W}}class G{constructor(W=(0,D.c)(),B=(0,D.f)(.57735,.57735,.57735)){this.intensity=W,this.direction=B}}class Z{constructor(W=(0,D.c)(),B=(0,D.f)(.57735,.57735,.57735),H=!0,X=1,te=1){this.intensity=W,this.direction=B,this.castShadows=H,this.specularStrength=X,this.environmentStrength=te}}class Q{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95279:(nt,Ae,v)=>{"use strict";v.d(Ae,{c:()=>he,V:()=>pe});var D=v(21286),R=v(84161),G=v(28093),Z=v(82244);function $(ge,_e,Ee){(Ee=Ee||ge).length=ge.length;for(let De=0;De<ge.length;De++)Ee[De]=ge[De]*_e[De];return Ee}function W(ge,_e,Ee){(Ee=Ee||ge).length=ge.length;for(let De=0;De<ge.length;De++)Ee[De]=ge[De]*_e;return Ee}function B(ge,_e,Ee){(Ee=Ee||ge).length=ge.length;for(let De=0;De<ge.length;De++)Ee[De]=ge[De]+_e[De];return Ee}function H(ge){return(ge+1)*(ge+1)}function te(ge,_e,Ee){const De=ge[0],be=ge[1],Se=ge[2],ye=Ee||[];return ye.length=H(_e),_e>=0&&(ye[0]=.28209479177),_e>=1&&(ye[1]=.4886025119*De,ye[2]=.4886025119*Se,ye[3]=.4886025119*be),_e>=2&&(ye[4]=1.09254843059*De*be,ye[5]=1.09254843059*be*Se,ye[6]=.31539156525*(3*Se*Se-1),ye[7]=1.09254843059*De*Se,ye[8]=.54627421529*(De*De-be*be)),ye}function de(ge,_e,Ee,De){(function ae(ge,_e){const Ee=H(ge),De=_e||{r:[],g:[],b:[]};De.r.length=De.g.length=De.b.length=Ee;for(let be=0;be<Ee;be++)De.r[be]=De.g[be]=De.b[be]=0})(_e,De),(0,R.s)(Ee.intensity,0,0,0);let be=!1;const Se=se,ye=re,ve=j;Se.length=0,ye.length=0,ve.length=0;for(const xe of ge)xe instanceof Z.Eg&&!be?((0,R.c)(Ee.direction,xe.direction),(0,R.c)(Ee.intensity,xe.intensity),Ee.specularStrength=xe.specularStrength,Ee.environmentStrength=xe.environmentStrength,Ee.castShadows=xe.castShadows,be=!0):xe instanceof Z.Eg||xe instanceof Z.AM?Se.push(xe):xe instanceof Z.Mi?ye.push(xe):xe instanceof Z.Ur&&ve.push(xe);(function oe(ge,_e){const Ee=function X(ge){return(0,D.uZ)(Math.floor(Math.sqrt(ge)-1),0,2)}(_e.r.length);for(const De of ge)(0,R.o)(ie,De.direction),te(ie,Ee,Y),$(Y,J),W(Y,De.intensity[0],ee),B(_e.r,ee),W(Y,De.intensity[1],ee),B(_e.g,ee),W(Y,De.intensity[2],ee),B(_e.b,ee);return _e})(Se,De),function le(ge,_e){te(ie,0,Y);for(const Ee of ge)_e.r[0]+=Y[0]*J[0]*Ee.intensity[0]*4*Math.PI,_e.g[0]+=Y[0]*J[0]*Ee.intensity[1]*4*Math.PI,_e.b[0]+=Y[0]*J[0]*Ee.intensity[2]*4*Math.PI}(ye,De);for(const xe of ve)B(De.r,xe.r),B(De.g,xe.g),B(De.b,xe.b)}const se=[],re=[],j=[],Y=[0],ee=[0],ie=(0,G.c)(),J=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class ce{constructor(){this.color=(0,G.c)(),this.intensity=1}}class ue{constructor(){this.direction=(0,G.c)(),this.ambient=new ce,this.diffuse=new ce}}const pe=.4;class he{constructor(){this._shOrder=2,this._legacy=new ue,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Z.Ur,this._mainLight=new Z.Eg((0,G.c)(),(0,G.f)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(_e){de(_e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,R.c)(this._legacy.direction,this._mainLight.direction);const Ee=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*Ee,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*Ee,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*Ee,(0,R.g)(this._legacy.diffuse.color,this._mainLight.intensity,Ee),(0,R.c)(me,this._legacy.diffuse.color),(0,R.g)(me,me,pe*this.globalFactor),(0,R.a)(this._legacy.ambient.color,this._legacy.ambient.color,me)}copyFrom(_e){this._sphericalHarmonics.r=Array.from(_e.sh.r),this._sphericalHarmonics.g=Array.from(_e.sh.g),this._sphericalHarmonics.b=Array.from(_e.sh.b),this._mainLight.direction=(0,G.a)(_e.mainLight.direction),this._mainLight.intensity=(0,G.a)(_e.mainLight.intensity),this._mainLight.castShadows=_e.mainLight.castShadows,this._mainLight.specularStrength=_e.mainLight.specularStrength,this._mainLight.environmentStrength=_e.mainLight.environmentStrength,this.globalFactor=_e.globalFactor,this.noonFactor=_e.noonFactor}lerpLighting(_e,Ee,De){if((0,R.h)(this._mainLight.intensity,_e.mainLight.intensity,Ee.mainLight.intensity,De),this._mainLight.environmentStrength=(0,D.t7)(_e.mainLight.environmentStrength,Ee.mainLight.environmentStrength,De),this._mainLight.specularStrength=(0,D.t7)(_e.mainLight.specularStrength,Ee.mainLight.specularStrength,De),(0,R.c)(this._mainLight.direction,Ee.mainLight.direction),this._mainLight.castShadows=Ee.mainLight.castShadows,this.globalFactor=(0,D.t7)(_e.globalFactor,Ee.globalFactor,De),this.noonFactor=(0,D.t7)(_e.noonFactor,Ee.noonFactor,De),_e.sh.r.length===Ee.sh.r.length)for(let be=0;be<Ee.sh.r.length;be++)this._sphericalHarmonics.r[be]=(0,D.t7)(_e.sh.r[be],Ee.sh.r[be],De),this._sphericalHarmonics.g[be]=(0,D.t7)(_e.sh.g[be],Ee.sh.g[be],De),this._sphericalHarmonics.b[be]=(0,D.t7)(_e.sh.b[be],Ee.sh.b[be],De);else for(let be=0;be<Ee.sh.r.length;be++)this._sphericalHarmonics.r[be]=Ee.sh.r[be],this._sphericalHarmonics.g[be]=Ee.sh.g[be],this._sphericalHarmonics.b[be]=Ee.sh.b[be]}}const me=(0,G.c)()},92972:(nt,Ae,v)=>{"use strict";v.d(Ae,{E:()=>he});var D=v(8314),R=v(4794),G=v(13934),Z=v(42743),Q=v(60881),$=v(40723),W=v(88569),B=v(5894),H=v(60909),X=v(57623),te=v(651),ae=v(91056),oe=v(39114),le=v(12407),de=v(64127),se=v(44835),re=v(89652),j=v(57596),Y=v(2078);class ee extends ae.A{initializeConfiguration(Ee,De){De.hasWebGL2Context=Ee.rctx.type===j.zO.WEBGL2}initializeProgram(Ee){return new le.$(Ee.rctx,ee.shader.get().build(this.configuration),oe.i)}_createPipeline(Ee,De){const be=this.configuration,Se=Ee===se.A.NONE,ye=Ee===se.A.FrontFace;return(0,Y.sm)({blending:be.output!==G.H.Color&&be.output!==G.H.Alpha||!be.transparent?null:Se?W.wu:(0,W.j7)(Ee),culling:(0,Y.zp)(be.cullFace),depthTest:{func:(0,W.Bh)(Ee)},depthWrite:Se||ye?be.writeDepth&&Y.LZ:null,colorWrite:Y.BK,stencilWrite:be.hasOccludees?de.s3:null,stencilTest:be.hasOccludees?De?de.eD:de.RY:null,polygonOffset:Se||ye?be.polygonOffset&&ie:(0,W.je)(be.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(Ee,De){return De?this._occludeePipelineState:super.getPipelineState(Ee,De)}}ee.shader=new te.J(re.C,()=>v.e(1362).then(v.bind(v,11362)));const ie={factor:1,units:1};var J=v(17626),ce=v(87601),ue=v(41528);class pe extends ue.W{constructor(){super(...arguments),this.output=G.H.Color,this.cullFace=Z.Vr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=se.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}}(0,J._)([(0,ce.o)({count:G.H.COUNT})],pe.prototype,"output",void 0),(0,J._)([(0,ce.o)({count:Z.Vr.COUNT})],pe.prototype,"cullFace",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"hasSlicePlane",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"hasVertexColors",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"transparent",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"polygonOffset",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"enableOffset",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"writeDepth",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"hasOccludees",void 0),(0,J._)([(0,ce.o)({count:se.A.COUNT})],pe.prototype,"transparencyPassType",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"hasMultipassTerrain",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"cullAboveGround",void 0),(0,J._)([(0,ce.o)()],pe.prototype,"objectAndLayerIdColorInstanced",void 0);class he extends $.F5{constructor(Ee){super(Ee,new ge),this.supportsEdges=!0,this._configuration=new pe}getConfiguration(Ee,De){return this._configuration.output=Ee,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=De.transparencyPassType,this._configuration.enableOffset=De.camera.relativeElevation<W.ve,this._configuration.hasMultipassTerrain=De.multipassTerrain.enabled,this._configuration.cullAboveGround=De.multipassTerrain.cullAboveGround,this._configuration}intersect(Ee,De,be,Se,ye,ve,xe){(0,X.Bw)(Ee,De,Se,ye,ve,void 0,xe)}requiresSlot(Ee,De){return!!(De===G.H.Color||De===G.H.Alpha||De===G.H.Highlight||De===G.H.Depth&&this.parameters.writeLinearDepth||De===G.H.ObjectAndLayerIdColor)&&(Ee===B.r.DRAPED_MATERIAL||(De===G.H.Highlight?Ee===B.r.OPAQUE_MATERIAL:Ee===(this.parameters.transparent?this.parameters.writeDepth?B.r.TRANSPARENT_MATERIAL:B.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:B.r.OPAQUE_MATERIAL)))}createGLMaterial(Ee){return new me(Ee)}createBufferWriter(){return new H.G_((0,D.Z)("enable-feature:objectAndLayerId-rendering")?H.ck:H.IM)}}class me extends Q.Z{_updateOccludeeState(Ee){Ee.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Ee.hasOccludees})}beginSlot(Ee){return this._output!==G.H.Color&&this._output!==G.H.Alpha||this._updateOccludeeState(Ee),this.ensureTechnique(ee,Ee)}}class ge extends $.Mt{constructor(){super(...arguments),this.color=R.Z,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Z.Vr.None,this.hasOccludees=!1}}},28523:(nt,Ae,v)=>{"use strict";v.d(Ae,{Gp:()=>Ee,RL:()=>xe});var D=v(8314),R=v(62208),G=v(84161),Z=v(28093),Q=v(59617),$=v(19625),W=v(13934),B=v(26859),H=v(96395),X=v(92724),te=v(42743),ae=v(33470),oe=v(40723),le=v(88569),de=v(5894),se=v(16396),re=v(40841),j=v(42037),Y=v(57623),ee=v(39711),ie=v(17626),J=v(36603),ce=v(87601),ue=v(44835),pe=v(41528);class he extends pe.W{constructor(){super(...arguments),this.output=W.H.Color,this.alphaDiscardMode=te.JJ.Opaque,this.doubleSidedMode=H.q.None,this.pbrMode=X.f7.Disabled,this.cullFace=te.Vr.None,this.transparencyPassType=ue.A.NONE,this.normalType=B.h.Attribute,this.textureCoordinateType=J.N.None,this.customDepthTest=te.Gv.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}(0,ie._)([(0,ce.o)({count:W.H.COUNT})],he.prototype,"output",void 0),(0,ie._)([(0,ce.o)({count:te.JJ.COUNT})],he.prototype,"alphaDiscardMode",void 0),(0,ie._)([(0,ce.o)({count:H.q.COUNT})],he.prototype,"doubleSidedMode",void 0),(0,ie._)([(0,ce.o)({count:X.f7.COUNT})],he.prototype,"pbrMode",void 0),(0,ie._)([(0,ce.o)({count:te.Vr.COUNT})],he.prototype,"cullFace",void 0),(0,ie._)([(0,ce.o)({count:ue.A.COUNT})],he.prototype,"transparencyPassType",void 0),(0,ie._)([(0,ce.o)({count:B.h.COUNT})],he.prototype,"normalType",void 0),(0,ie._)([(0,ce.o)({count:J.N.COUNT})],he.prototype,"textureCoordinateType",void 0),(0,ie._)([(0,ce.o)({count:te.Gv.COUNT})],he.prototype,"customDepthTest",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"spherical",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasVertexColors",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasSymbolColors",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasVerticalOffset",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasSlicePlane",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasSliceHighlight",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasColorTexture",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasMetallicRoughnessTexture",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasEmissionTexture",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasOcclusionTexture",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasNormalTexture",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasScreenSizePerspective",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasVertexTangents",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasOccludees",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasMultipassTerrain",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasModelTransformation",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"offsetBackfaces",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"vvSize",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"vvColor",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"receiveShadows",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"receiveAmbientOcclusion",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"textureAlphaPremultiplied",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"instanced",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"instancedColor",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"objectAndLayerIdColorInstanced",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"instancedDoublePrecision",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"writeDepth",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"transparent",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"enableOffset",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"cullAboveGround",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"snowCover",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasColorTextureTransform",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasEmissionTextureTransform",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasNormalTextureTransform",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasOcclusionTextureTransform",void 0),(0,ie._)([(0,ce.o)()],he.prototype,"hasMetallicRoughnessTextureTransform",void 0),(0,ie._)([(0,ce.o)({constValue:!0})],he.prototype,"hasVvInstancing",void 0),(0,ie._)([(0,ce.o)({constValue:!1})],he.prototype,"useCustomDTRExponentForWater",void 0),(0,ie._)([(0,ce.o)({constValue:!1})],he.prototype,"supportsTextureAtlas",void 0),(0,ie._)([(0,ce.o)({constValue:!0})],he.prototype,"useFillLights",void 0);var me=v(651),ge=v(77133);class _e extends ee.tT{initializeConfiguration(He,Ie){super.initializeConfiguration(He,Ie),Ie.hasMetallicRoughnessTexture=!1,Ie.hasEmissionTexture=!1,Ie.hasOcclusionTexture=!1,Ie.hasNormalTexture=!1,Ie.hasModelTransformation=!1,Ie.normalType=B.h.Attribute,Ie.doubleSidedMode=H.q.WindingOrder,Ie.hasVertexTangents=!1}initializeProgram(He){return this._initializeProgram(He,_e.shader)}}_e.shader=new me.J(ge.R,()=>v.e(3959).then(v.bind(v,93959)));class Ee extends oe.F5{constructor(He){super(He,Se),this.supportsEdges=!0,this._configuration=new he,this._vertexBufferLayout=function ve(Re){const He=Re.textureId||Re.normalTextureId||Re.metallicRoughnessTextureId||Re.emissiveTextureId||Re.occlusionTextureId,Ie=(0,$.U$)().vec3f(se.T.POSITION).vec3f(se.T.NORMAL);return Re.hasVertexTangents&&Ie.vec4f(se.T.TANGENT),He&&Ie.vec2f(se.T.UV0),Re.hasVertexColors&&Ie.vec4u8(se.T.COLOR),Re.hasSymbolColors&&Ie.vec4u8(se.T.SYMBOLCOLOR),(0,D.Z)("enable-feature:objectAndLayerId-rendering")&&Ie.vec4u8(se.T.OBJECTANDLAYERIDCOLOR),Ie}(this.parameters),this._instanceBufferLayout=He.instanced?xe(this.parameters):null}isVisibleForOutput(He){return He!==W.H.Shadow&&He!==W.H.ShadowExludeHighlight&&He!==W.H.ShadowHighlight||this.parameters.castShadows}isVisible(){const He=this.parameters;if(!super.isVisible()||0===He.layerOpacity)return!1;const{instanced:Ie,hasVertexColors:Ge,hasSymbolColors:Pe,vvColorEnabled:Le}=He,Me=(0,R.pC)(Ie)&&Ie.includes("color"),Ne="replace"===He.colorMixMode,Xe=He.opacity>0,Ye=He.externalColor&&He.externalColor[3]>0;return Ge&&(Me||Le||Pe)?!!Ne||Xe:Ge?Ne?Ye:Xe:Me||Le||Pe?!!Ne||Xe:Ne?Ye:Xe}getConfiguration(He,Ie){return this._configuration.output=He,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=(0,R.pC)(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=(0,R.pC)(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType="screenDerivative"===this.parameters.normals?B.h.ScreenDerivative:B.h.Attribute,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,(0,R.pC)(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?te.Vr.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=Ie.multipassTerrain.enabled,this._configuration.cullAboveGround=Ie.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=(0,R.pC)(this.parameters.modelTransformation),He!==W.H.Color&&He!==W.H.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?H.q.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?H.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?H.q.WindingOrder:H.q.None,this._configuration.instancedColor=(0,R.pC)(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!Ie.ssaoHelper.ready&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?X.f7.Schematic:X.f7.Normal:X.f7.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=Ie.transparencyPassType,this._configuration.enableOffset=Ie.camera.relativeElevation<le.ve,this._configuration.snowCover=this.hasSnowCover(Ie),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(He){return(0,R.pC)(He.weather)&&He.weatherVisible&&"snowy"===He.weather.type&&"enabled"===He.weather.snowCover}intersect(He,Ie,Ge,Pe,Le,Me,Ne){if((0,R.pC)(this.parameters.verticalOffset)){const Xe=Pe.camera;(0,G.s)(Fe,Ge[12],Ge[13],Ge[14]);let Ye=null;switch(Pe.viewingMode){case Q.JY.Global:Ye=(0,G.n)(Ce,Fe);break;case Q.JY.Local:Ye=(0,G.c)(Ce,We)}let Je=0;const rt=(0,G.b)(je,Fe,Xe.eye),tt=(0,G.l)(rt),et=(0,G.g)(rt,rt,1/tt);let qe=null;this.parameters.screenSizePerspective&&(qe=(0,G.e)(Ye,et)),Je+=(0,Y.Hx)(Xe,tt,this.parameters.verticalOffset,qe,this.parameters.screenSizePerspective),(0,G.g)(Ye,Ye,Je),(0,G.t)(Be,Ye,Pe.transform.inverseRotation),Le=(0,G.b)(ze,Le,Be),Me=(0,G.b)(Ke,Me,Be)}(0,Y.Bw)(He,Ie,Pe,Le,Me,(0,re.W9)(Pe.verticalOffset),Ne)}requiresSlot(He,Ie){return!(Ie!==W.H.Color&&Ie!==W.H.Alpha&&Ie!==W.H.Depth&&Ie!==W.H.Normal&&Ie!==W.H.Shadow&&Ie!==W.H.ShadowHighlight&&Ie!==W.H.ShadowExludeHighlight&&Ie!==W.H.Highlight&&Ie!==W.H.ObjectAndLayerIdColor||He!==(this.parameters.transparent?this.parameters.writeDepth?de.r.TRANSPARENT_MATERIAL:de.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:de.r.OPAQUE_MATERIAL)&&He!==de.r.DRAPED_MATERIAL&&Ie!==W.H.ObjectAndLayerIdColor)}createGLMaterial(He){return new De(He)}createBufferWriter(){return new ye(this._vertexBufferLayout,this._instanceBufferLayout)}}class De extends ae.F{constructor(He){super({...He,...He.material.parameters})}_updateParameters(He){const Ie=this._material.parameters;this.updateTexture(Ie.textureId);const Ge=He.camera.viewInverseTransposeMatrix;return(0,G.s)(Ie.origin,Ge[3],Ge[7],Ge[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Ie.treeRendering?_e:ee.tT,He)}_updateShadowState(He){He.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:He.shadowMap.enabled})}_updateOccludeeState(He){He.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:He.hasOccludees})}beginSlot(He){return this._output!==W.H.Color&&this._output!==W.H.Alpha||(this._updateShadowState(He),this._updateOccludeeState(He)),this._updateParameters(He)}}const Se=new class be extends ee.em{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};class ye{constructor(He,Ie){this.vertexBufferLayout=He,this.instanceBufferLayout=Ie}allocate(He){return this.vertexBufferLayout.createBuffer(He)}elementCount(He){return He.indices.get(se.T.POSITION).length}write(He,Ie,Ge,Pe,Le){(0,j.NK)(Ge,this.vertexBufferLayout,He,Ie,Pe,Le)}}function xe(Re){let He=(0,$.U$)();return He=Re.instancedDoublePrecision?He.vec3f(se.T.MODELORIGINHI).vec3f(se.T.MODELORIGINLO).mat3f(se.T.MODEL).mat3f(se.T.MODELNORMAL):He.mat4f(se.T.MODEL).mat4f(se.T.MODELNORMAL),(0,R.pC)(Re.instanced)&&Re.instanced.includes("color")&&(He=He.vec4f(se.T.INSTANCECOLOR)),(0,R.pC)(Re.instanced)&&Re.instanced.includes("featureAttribute")&&(He=He.vec4f(se.T.INSTANCEFEATUREATTRIBUTE)),(0,R.pC)(Re.instanced)&&Re.instanced.includes("objectAndLayerIdColor")&&(He=He.vec4u8(se.T.OBJECTANDLAYERIDCOLOR_INSTANCED)),He}const ze=(0,Z.c)(),Ke=(0,Z.c)(),We=(0,Z.f)(0,0,1),Ce=(0,Z.c)(),Be=(0,Z.c)(),Fe=(0,Z.c)(),je=(0,Z.c)()},79331:(nt,Ae,v)=>{"use strict";v.d(Ae,{K:()=>D});const D=2.1},41528:(nt,Ae,v)=>{"use strict";v.d(Ae,{W:()=>Z});var D=v(17626),R=v(37847),G=v(87601);class Z extends G.m{constructor(){super(...arguments),this.hasWebGL2Context=!1}}(0,D._)([(0,G.o)({constValue:!0})],Z.prototype,"hasSliceHighlight",void 0),(0,D._)([(0,G.o)({constValue:!1})],Z.prototype,"hasSliceInVertexProgram",void 0),(0,D._)([(0,G.o)({constValue:!1})],Z.prototype,"instancedDoublePrecision",void 0),(0,D._)([(0,G.o)({constValue:!1})],Z.prototype,"useLegacyTerrainShading",void 0),(0,D._)([(0,G.o)({constValue:!1})],Z.prototype,"hasModelTransformation",void 0),(0,D._)([(0,G.o)({constValue:R.P.Pass})],Z.prototype,"pbrTextureBindType",void 0),(0,D._)([(0,G.o)()],Z.prototype,"hasWebGL2Context",void 0)},7949:(nt,Ae,v)=>{"use strict";v.d(Ae,{w:()=>G});var D=v(28093),R=v(21799);class G extends R.Pf{constructor(Q=(0,D.c)()){super(),this.origin=Q,this.slicePlaneLocalOrigin=this.origin}}},80805:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>Le});var D=v(8314),R=v(21286),G=v(62208),Z=v(30217),Q=v(550),$=v(28347),W=v(43703),B=v(67831),H=v(99770),X=v(84161),te=v(28093),ae=v(4794);var se=v(65401),re=v(60479),j=v(19625),Y=v(13934),ee=v(97347),ie=v(36848),J=v(33470),ce=v(40723),ue=v(5894),pe=v(17962),he=v(2282),me=v(16396),ge=v(42037),_e=v(57623),Ee=v(65073),De=v(6467),be=v(59617),Se=v(651),ye=v(91056),ve=v(39114),xe=v(88569),ze=v(12407),Ke=v(44835),We=v(57596),Ce=v(67969),Be=v(2078);class Fe extends ye.A{initializeConfiguration(rr,Et){Et.hasWebGL2Context=rr.rctx.type===We.zO.WEBGL2,Et.spherical=rr.viewingMode===be.JY.Global}initializeProgram(rr){return new ze.$(rr.rctx,Fe.shader.get().build(this.configuration),ve.i)}_setPipelineState(rr){const Et=this.configuration,St=rr===Ke.A.NONE,zt=this.configuration.hasPolygonOffset&&je,dr=!St&&rr!==Ke.A.FrontFace||Et.output===Y.H.Highlight?null:(Et.depthEnabled||Et.occlusionPass)&&Be.LZ;return(0,Be.sm)({blending:Et.output===Y.H.Color||Et.output===Y.H.Alpha||Et.output===Y.H.Highlight?St?Re:(0,xe.j7)(rr):null,depthTest:{func:Ce.wb.LEQUAL},depthWrite:dr,colorWrite:Be.BK,polygonOffset:zt})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ce.MX.POINTS:Ce.MX.TRIANGLES}}Fe.shader=new Se.J(De.H,()=>v.e(6771).then(v.bind(v,46771)));const je={factor:0,units:-4},Re=(0,Be.if)(Ce.zi.ONE,Ce.zi.ONE_MINUS_SRC_ALPHA);var He=v(17626),Ie=v(87601),Ge=v(41528);class Pe extends Ge.W{constructor(){super(...arguments),this.output=Y.H.Color,this.screenCenterOffsetUnitsEnabled=ee.d.World,this.transparencyPassType=Ke.A.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,He._)([(0,Ie.o)({count:Y.H.COUNT})],Pe.prototype,"output",void 0),(0,He._)([(0,Ie.o)({count:ee.d.COUNT})],Pe.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,He._)([(0,Ie.o)({count:Ke.A.COUNT})],Pe.prototype,"transparencyPassType",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"spherical",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"occlusionTestEnabled",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"signedDistanceFieldEnabled",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"vvSize",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"vvColor",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasVerticalOffset",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasScreenSizePerspective",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"debugDrawLabelBorder",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasSlicePlane",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasPolygonOffset",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"depthEnabled",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"pixelSnappingEnabled",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"isDraped",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasMultipassGeometry",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"hasMultipassTerrain",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"cullAboveGround",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"occlusionPass",void 0),(0,He._)([(0,Ie.o)()],Pe.prototype,"objectAndLayerIdColorInstanced",void 0),(0,He._)([(0,Ie.o)({constValue:!0})],Pe.prototype,"hasSliceInVertexProgram",void 0),(0,He._)([(0,Ie.o)({constValue:!1})],Pe.prototype,"hasVvInstancing",void 0);class Le extends ce.F5{constructor(rr){super(rr,new Fr),this._configuration=new Pe}getConfiguration(rr,Et){return this._configuration.output=rr,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?ee.d.Screen:ee.d.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=Et.slot===ue.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(rr===Y.H.Color||rr===Y.H.Alpha),rr===Y.H.Color&&(this._configuration.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),rr===Y.H.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=Et.transparencyPassType,this._configuration.hasMultipassGeometry=Et.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=Et.multipassTerrain.enabled,this._configuration.cullAboveGround=Et.multipassTerrain.cullAboveGround,this._configuration}intersect(rr,Et,St,Ft,zt,dr,hr,Tr,Dr){(0,G.pC)(Dr)?this._intersectDrapedHudGeometry(rr,dr,hr,Tr,Dr):this._intersectHudGeometry(rr,Et,St,Ft,hr,Tr)}_intersectDrapedHudGeometry(rr,Et,St,Ft,zt){const dr=rr.vertexAttributes.get(me.T.POSITION),hr=rr.vertexAttributes.get(me.T.SIZE),Tr=this.parameters,Dr=(0,De.c)(Tr);let Lr=1,Hr=1;if((0,G.pC)(Ft)){const Jr=Ft($t);Lr=Jr[0],Hr=Jr[5]}Lr*=rr.screenToWorldRatio,Hr*=rr.screenToWorldRatio;const Qr=pr*rr.screenToWorldRatio;for(let Jr=0;Jr<dr.data.length/dr.size;Jr++){const Ss=Jr*dr.size,Cs=dr.data[Ss],Dt=dr.data[Ss+1],ct=Jr*hr.size;let At;gr[0]=hr.data[ct]*Lr,gr[1]=hr.data[ct+1]*Hr,Tr.textureIsSignedDistanceField&&(At=Tr.outlineSize*rr.screenToWorldRatio/2),Ye(Et,Cs,Dt,gr,Qr,At,Tr,Dr)&&St(zt.dist,zt.normal,-1,!1)}}_intersectHudGeometry(rr,Et,St,Ft,zt,dr){if(!Ft.options.selectionMode||!Ft.options.hud||(0,Ee.PD)(Et))return;const hr=this.parameters;let Tr=1,Dr=1;if((0,Z.f)(_t,St),(0,G.pC)(dr)){const At=dr($t);Tr=At[0],Dr=At[5],function Xe(sr){const rr=sr[0],Et=sr[1],St=sr[2],Ft=sr[3],zt=sr[4],dr=sr[5],hr=sr[6],Tr=sr[7],Dr=sr[8],Lr=1/Math.sqrt(rr*rr+Et*Et+St*St),Hr=1/Math.sqrt(Ft*Ft+zt*zt+dr*dr),Qr=1/Math.sqrt(hr*hr+Tr*Tr+Dr*Dr);sr[0]=rr*Lr,sr[1]=Et*Lr,sr[2]=St*Lr,sr[3]=Ft*Hr,sr[4]=zt*Hr,sr[5]=dr*Hr,sr[6]=hr*Qr,sr[7]=Tr*Qr,sr[8]=Dr*Qr}(_t)}const Lr=rr.vertexAttributes.get(me.T.POSITION),Hr=rr.vertexAttributes.get(me.T.SIZE),Qr=rr.vertexAttributes.get(me.T.NORMAL),Jr=rr.vertexAttributes.get(me.T.AUXPOS1);(0,he.hu)(Lr.size>=3);const Ss=Ft.point,Cs=Ft.camera,Dt=(0,De.c)(hr);Tr*=Cs.pixelRatio,Dr*=Cs.pixelRatio;const ct="screen"===this.parameters.centerOffsetUnits;for(let At=0;At<Lr.data.length/Lr.size;At++){const Kt=At*Lr.size;(0,X.s)(tt,Lr.data[Kt],Lr.data[Kt+1],Lr.data[Kt+2]),(0,X.m)(tt,tt,St);const tr=At*Hr.size;gr[0]=Hr.data[tr]*Tr,gr[1]=Hr.data[tr+1]*Dr,(0,X.m)(tt,tt,Cs.viewMatrix);const _r=At*Jr.size;if((0,X.s)(Lt,Jr.data[_r+0],Jr.data[_r+1],Jr.data[_r+2]),!ct&&(tt[0]+=Lt[0],tt[1]+=Lt[1],0!==Lt[2])){const gs=Lt[2];(0,X.n)(Lt,tt),(0,X.b)(tt,tt,(0,X.g)(Lt,Lt,gs))}const Or=At*Qr.size;if((0,X.s)(et,Qr.data[Or],Qr.data[Or+1],Qr.data[Or+2]),this._normalAndViewAngle(et,_t,Cs,jt),this._applyVerticalOffsetTransformationView(tt,jt,Cs,Je),Cs.applyProjection(tt,qe),qe[0]>-1){let Kr;if(qe[0]=Math.floor(qe[0]),qe[1]=Math.floor(qe[1]),ct&&(Lt[0]||Lt[1])&&(qe[0]+=Lt[0],0!==Lt[1]&&(qe[1]+=(0,pe.sX)(Lt[1],Je.factorAlignment)),Cs.unapplyProjection(qe,tt)),qe[0]+=this.parameters.screenOffset[0],qe[1]+=this.parameters.screenOffset[1],(0,pe.TU)(gr,Je.factor,gr),hr.textureIsSignedDistanceField&&(Kr=hr.outlineSize*Cs.pixelRatio/2),Ye(Ss,qe[0],qe[1],gr,Wt*Cs.pixelRatio,Kr,hr,Dt)){const qt=Ft.ray;if((0,X.m)(ut,tt,(0,$.a)(vt,Cs.viewMatrix)),qe[0]=Ss[0],qe[1]=Ss[1],Cs.unprojectFromRenderScreen(qe,tt)){const Ir=(0,te.c)();(0,X.c)(Ir,qt.direction);const Sr=1/(0,X.l)(Ir);(0,X.g)(Ir,Ir,Sr),zt((0,X.i)(qt.origin,tt)*Sr,Ir,-1,!0,1,ut)}}}}}computeAttachmentOrigin(rr,Et){const St=rr.vertexAttributes;if(!St)return!1;const Ft=St.get(me.T.POSITION),zt=rr.indices.get(me.T.POSITION);return(0,ie.NO)(Ft,zt,Et)}createBufferWriter(){return new or(this)}_normalAndViewAngle(rr,Et,St,Ft){return function de(sr){return function oe(sr){return sr instanceof Float32Array&&sr.length>=16}(sr)||function le(sr){return Array.isArray(sr)&&sr.length>=16}(sr)}(Et)&&(Et=(0,Z.f)(Ct,Et)),(0,X.t)(Ft.normal,rr,Et),(0,X.m)(Ft.normal,Ft.normal,St.viewInverseTransposeMatrix),Ft.cosAngle=(0,X.e)(ot,ar),Ft}_updateScaleInfo(rr,Et,St){const Ft=this.parameters;(0,G.pC)(Ft.screenSizePerspective)?(0,pe.PV)(St,Et,Ft.screenSizePerspective,rr.factor):(rr.factor.scale=1,rr.factor.factor=0,rr.factor.minPixelSize=0,rr.factor.paddingPixels=0),(0,G.pC)(Ft.screenSizePerspectiveAlignment)?(0,pe.PV)(St,Et,Ft.screenSizePerspectiveAlignment,rr.factorAlignment):(rr.factorAlignment.factor=rr.factor.factor,rr.factorAlignment.scale=rr.factor.scale,rr.factorAlignment.minPixelSize=rr.factor.minPixelSize,rr.factorAlignment.paddingPixels=rr.factor.paddingPixels)}applyShaderOffsetsView(rr,Et,St,Ft,zt,dr,hr){const Tr=this._normalAndViewAngle(Et,St,zt,jt);return this._applyVerticalGroundOffsetView(rr,Tr,zt,hr),this._applyVerticalOffsetTransformationView(hr,Tr,zt,dr),this._applyPolygonOffsetView(hr,Tr,Ft[3],zt,hr),this._applyCenterOffsetView(hr,Ft,hr),hr}applyShaderOffsetsNDC(rr,Et,St,Ft,zt){return this._applyCenterOffsetNDC(rr,Et,St,Ft),(0,G.pC)(zt)&&(0,X.c)(zt,Ft),this._applyPolygonOffsetNDC(Ft,Et,St,Ft),Ft}_applyPolygonOffsetView(rr,Et,St,Ft,zt){const dr=Ft.aboveGround?1:-1;let hr=Math.sign(St);0===hr&&(hr=dr);const Tr=dr*hr;if(this.parameters.shaderPolygonOffset<=0)return(0,X.c)(zt,rr);const Dr=(0,R.uZ)(Math.abs(Et.cosAngle),.01,1),Lr=1-Math.sqrt(1-Dr*Dr)/Dr/Ft.viewport[2];return(0,X.g)(zt,rr,Tr>0?Lr:1/Lr),zt}_applyVerticalGroundOffsetView(rr,Et,St,Ft){const zt=(0,X.l)(rr),dr=St.aboveGround?1:-1,hr=.5*St.computeRenderPixelSizeAtDist(zt),Tr=(0,X.g)(tt,Et.normal,dr*hr);return(0,X.a)(Ft,rr,Tr),Ft}_applyVerticalOffsetTransformationView(rr,Et,St,Ft){const zt=this.parameters;if(!zt.verticalOffset||!zt.verticalOffset.screenLength){if(zt.screenSizePerspective||zt.screenSizePerspectiveAlignment){const Dr=(0,X.l)(rr);this._updateScaleInfo(Ft,Dr,Et.cosAngle)}else Ft.factor.scale=1,Ft.factorAlignment.scale=1;return rr}const dr=(0,X.l)(rr),hr=(0,G.Pt)(zt.screenSizePerspectiveAlignment,zt.screenSizePerspective),Tr=(0,_e.Hx)(St,dr,zt.verticalOffset,Et.cosAngle,hr);return this._updateScaleInfo(Ft,dr,Et.cosAngle),(0,X.g)(Et.normal,Et.normal,Tr),(0,X.a)(rr,rr,Et.normal)}_applyCenterOffsetView(rr,Et,St){const Ft="screen"!==this.parameters.centerOffsetUnits;return St!==rr&&(0,X.c)(St,rr),Ft&&(St[0]+=Et[0],St[1]+=Et[1],Et[2]&&((0,X.n)(et,St),(0,X.a)(St,St,(0,X.g)(et,et,Et[2])))),St}_applyCenterOffsetNDC(rr,Et,St,Ft){const zt="screen"!==this.parameters.centerOffsetUnits;return Ft!==rr&&(0,X.c)(Ft,rr),zt||(Ft[0]+=Et[0]/St.fullWidth*2,Ft[1]+=Et[1]/St.fullHeight*2),Ft}_applyPolygonOffsetNDC(rr,Et,St,Ft){const zt=this.parameters.shaderPolygonOffset;if(rr!==Ft&&(0,X.c)(Ft,rr),zt){const dr=St.aboveGround?1:-1,hr=dr*Math.sign(Et[3]);Ft[2]-=(hr||dr)*zt}return Ft}requiresSlot(rr,Et){if(Et===Y.H.Color||Et===Y.H.Alpha||Et===Y.H.Highlight||Et===Y.H.ObjectAndLayerIdColor){if(rr===ue.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:St,occlusionTest:Ft}=this.parameters;return rr===(St?ue.r.LABEL_MATERIAL:ue.r.HUD_MATERIAL)||Ft&&rr===ue.r.OCCLUSION_PIXELS}return!1}createGLMaterial(rr){return new Me(rr)}calculateRelativeScreenBounds(rr,Et,St=(0,se.Ue)()){return function Ne(sr,rr,Et,St=rt){(0,B.c)(St,sr.anchorPosition),St[0]*=-rr[0],St[1]*=-rr[1],St[0]+=sr.screenOffset[0]*Et,St[1]+=sr.screenOffset[1]*Et}(this.parameters,rr,Et,St),St[2]=St[0]+rr[0],St[3]=St[1]+rr[1],St}}class Me extends J.F{constructor(rr){super({...rr,...rr.material.parameters})}selectProgram(rr){return this.ensureTechnique(Fe,rr)}beginSlot(rr){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(rr)}}function Ye(sr,rr,Et,St,Ft,zt,dr,hr){let Tr=rr-Ft-(hr[0]>0?St[0]*hr[0]:0),Dr=Tr+St[0]+2*Ft,Lr=Et-Ft-(hr[1]>0?St[1]*hr[1]:0),Hr=Lr+St[1]+2*Ft;const Qr=dr.distanceFieldBoundingBox;return dr.textureIsSignedDistanceField&&(0,G.pC)(Qr)&&(Tr+=St[0]*Qr[0],Lr+=St[1]*Qr[1],Dr-=St[0]*(1-Qr[2]),Hr-=St[1]*(1-Qr[3]),Tr-=zt,Dr+=zt,Lr-=zt,Hr+=zt),sr[0]>Tr&&sr[0]<Dr&&sr[1]>Lr&&sr[1]<Hr}const Je={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},rt=(0,H.a)(),tt=(0,te.c)(),et=(0,te.c)(),qe=(0,ae.c)(),ot=(0,te.c)(),ut=(0,te.c)(),_t=(0,Q.c)(),Ct=(0,Q.c)(),vt=(0,W.c)(),Lt=(0,te.c)(),jt={normal:ot,cosAngle:0},$t=(0,W.c)(),Wt=1,pr=2,gr=[0,0],ar=(0,te.f)(0,0,1);class Fr extends J.E{constructor(){super(...arguments),this.renderOccluded=ce.yD.Occlude,this.color=(0,ae.f)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,H.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=(0,ae.f)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const mr=(0,j.U$)().vec3f(me.T.POSITION).vec3f(me.T.NORMAL).vec2f(me.T.UV0).vec4u8(me.T.COLOR).vec2f(me.T.SIZE).vec4f(me.T.AUXPOS1).vec4f(me.T.AUXPOS2),wt=mr.clone().vec4u8(me.T.OBJECTANDLAYERIDCOLOR);class or{constructor(rr){this._material=rr,this.vertexBufferLayout=(0,D.Z)("enable-feature:objectAndLayerId-rendering")?wt:mr}allocate(rr){return this.vertexBufferLayout.createBuffer(rr)}elementCount(rr){return 6*rr.indices.get(me.T.POSITION).length}write(rr,Et,St,Ft,zt){(0,ge.ho)(St.indices.get(me.T.POSITION),St.vertexAttributes.get(me.T.POSITION).data,rr,Ft.position,zt,6),(0,ge.s5)(St.indices.get(me.T.NORMAL),St.vertexAttributes.get(me.T.NORMAL).data,Et,Ft.normal,zt,6);{const dr=St.vertexAttributes.get(me.T.UV0).data;let hr,Tr,Dr,Lr;if(null==dr||dr.length<4){const Ss=this._material.parameters;hr=0,Tr=0,Dr=Ss.texCoordScale[0],Lr=Ss.texCoordScale[1]}else hr=dr[0],Tr=dr[1],Dr=dr[2],Lr=dr[3];Dr=Math.min(1.99999,Dr+1),Lr=Math.min(1.99999,Lr+1);const Hr=St.indices.get(me.T.POSITION).length,Qr=Ft.uv0;let Jr=zt;for(let Ss=0;Ss<Hr;++Ss)Qr.set(Jr,0,hr),Qr.set(Jr,1,Tr),Jr+=1,Qr.set(Jr,0,Dr),Qr.set(Jr,1,Tr),Jr+=1,Qr.set(Jr,0,Dr),Qr.set(Jr,1,Lr),Jr+=1,Qr.set(Jr,0,Dr),Qr.set(Jr,1,Lr),Jr+=1,Qr.set(Jr,0,hr),Qr.set(Jr,1,Lr),Jr+=1,Qr.set(Jr,0,hr),Qr.set(Jr,1,Tr),Jr+=1}(0,ge.Vs)(St.indices.get(me.T.COLOR),St.vertexAttributes.get(me.T.COLOR).data,4,Ft.color,zt,6);{const dr=St.indices.get(me.T.SIZE),hr=St.vertexAttributes.get(me.T.SIZE).data,Tr=dr.length,Dr=Ft.size;let Lr=zt;for(let Hr=0;Hr<Tr;++Hr){const Qr=hr[2*dr[Hr]],Jr=hr[2*dr[Hr]+1];for(let Ss=0;Ss<6;++Ss)Dr.set(Lr,0,Qr),Dr.set(Lr,1,Jr),Lr+=1}}if(St.indices.get(me.T.AUXPOS1)&&St.vertexAttributes.get(me.T.AUXPOS1)&&(0,ge.SW)(St.indices.get(me.T.AUXPOS1),St.vertexAttributes.get(me.T.AUXPOS1).data,Ft.auxpos1,zt,6),St.indices.get(me.T.AUXPOS2)&&St.vertexAttributes.get(me.T.AUXPOS2)&&(0,ge.SW)(St.indices.get(me.T.AUXPOS2),St.vertexAttributes.get(me.T.AUXPOS2).data,Ft.auxpos2,zt,6),(0,G.pC)(St.objectAndLayerIdColor)&&4===St.objectAndLayerIdColor.length&&St.indices.get(me.T.POSITION)){const dr=St.indices.get(me.T.POSITION).length,hr=Ft.getField(me.T.OBJECTANDLAYERIDCOLOR,re.mc);(0,ge.xP)(St.objectAndLayerIdColor,hr,dr,zt,6)}}}},70591:(nt,Ae,v)=>{"use strict";v.d(Ae,{X:()=>ce});var D=v(62208),R=v(84161),G=v(28093),Z=v(19625),Q=v(13934),$=v(33470),W=v(40723),B=v(5894),H=v(16396),X=v(41857),te=v(651),ae=v(91056),oe=v(88569),le=v(12407),de=v(64127),se=v(44835),re=v(62718),j=v(2078);const Y=new Map([[H.T.POSITION,0],[H.T.UV0,2],[H.T.AUXPOS1,3],[H.T.NORMAL,4],[H.T.COLOR,5],[H.T.COLORFEATUREATTRIBUTE,5],[H.T.SIZE,6],[H.T.SIZEFEATUREATTRIBUTE,6],[H.T.OPACITYFEATUREATTRIBUTE,7]]);class ee extends ae.A{initializeProgram(Ee){return new le.$(Ee.rctx,ee.shader.get().build(this.configuration),Y)}_makePipelineState(Ee,De){const be=this.configuration,Se=Ee===se.A.NONE;return(0,j.sm)({blending:be.output===Q.H.Color||be.output===Q.H.Alpha?Se?oe.wu:(0,oe.j7)(Ee):null,depthTest:{func:(0,oe.Bh)(Ee)},depthWrite:Se?be.writeDepth&&j.LZ:(0,oe.K5)(Ee),colorWrite:j.BK,stencilWrite:be.hasOccludees?de.s3:null,stencilTest:be.hasOccludees?De?de.eD:de.RY:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,j.sm)({blending:oe.wu,depthTest:de.zV,depthWrite:null,colorWrite:j.BK,stencilWrite:null,stencilTest:de.YD}),this._occluderPipelineOpaque=(0,j.sm)({blending:oe.wu,depthTest:de.zV,depthWrite:null,colorWrite:j.BK,stencilWrite:de.P7,stencilTest:de.ii}),this._occluderPipelineMaskWrite=(0,j.sm)({blending:null,depthTest:de.JN,depthWrite:null,colorWrite:null,stencilWrite:de.s3,stencilTest:de.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(Ee,De){return De?this._occludeePipelineState:this.configuration.occluder?Ee===B.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:Ee===B.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(Ee,De)}}ee.shader=new te.J(re.L,()=>v.e(2958).then(v.bind(v,62958)));var ie=v(46359),J=v(39401);class ce extends W.F5{constructor(Ee){super(Ee,new pe),this._vertexAttributeLocations=Y,this._configuration=new ie.PI,this._layout=this.createLayout()}dispose(){}getConfiguration(Ee,De){return this._configuration.output=Ee,this._configuration.space=De.slot===B.r.DRAPED_MATERIAL?ie.I9.Draped:this.parameters.worldSpace?ie.I9.World:ie.I9.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==J.R.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===W.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=De.transparencyPassType,this._configuration.hasMultipassTerrain=De.multipassTerrain.enabled,this._configuration.cullAboveGround=De.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const Ee=(0,Z.U$)().vec3f(H.T.POSITION).vec2f(H.T.UV0).vec3f(H.T.AUXPOS1);return this.parameters.worldSpace&&Ee.vec3f(H.T.NORMAL),Ee.f32(this.parameters.vvSizeEnabled?H.T.SIZEFEATUREATTRIBUTE:H.T.SIZE),this.parameters.vvColorEnabled?Ee.f32(H.T.COLORFEATUREATTRIBUTE):Ee.vec4f(H.T.COLOR),this.parameters.vvOpacityEnabled&&Ee.f32(H.T.OPACITYFEATUREATTRIBUTE),Ee}createBufferWriter(){return new he(this._layout,this.parameters)}requiresSlot(Ee,De){return!(De!==Q.H.Color&&De!==Q.H.Alpha&&De!==Q.H.Highlight&&De!==Q.H.Depth||Ee!==B.r.DRAPED_MATERIAL&&(this.parameters.renderOccluded===W.yD.OccludeAndTransparentStencil?Ee!==B.r.OPAQUE_MATERIAL&&Ee!==B.r.OCCLUDER_MATERIAL&&Ee!==B.r.TRANSPARENT_OCCLUDER_MATERIAL:De===Q.H.Color||De===Q.H.Alpha?Ee!==(this.parameters.writeDepth?B.r.TRANSPARENT_MATERIAL:B.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):Ee!==B.r.OPAQUE_MATERIAL))}createGLMaterial(Ee){return new ue(Ee)}}class ue extends $.F{_updateParameters(Ee){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ee,Ee)}_updateOccludeeState(Ee){Ee.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Ee.hasOccludees})}beginSlot(Ee){return this._output!==Q.H.Color&&this._output!==Q.H.Alpha||this._updateOccludeeState(Ee),this._updateParameters(Ee)}}class pe extends X.n{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=J.R.BUTT,this.anchor=ie.i5.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class he{constructor(Ee,De){this.vertexBufferLayout=Ee,this._parameters=De}allocate(Ee){return this.vertexBufferLayout.createBuffer(Ee)}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(Ee,De,be,Se,ye){const ve=be.vertexAttributes.get(H.T.POSITION).data,xe=ve.length/3;let ze=[1,0,0];const Ke=be.vertexAttributes.get(H.T.NORMAL);this._parameters.worldSpace&&(0,D.pC)(Ke)&&(ze=Ke.data);let We=1,Ce=0;this._parameters.vvSizeEnabled?Ce=be.vertexAttributes.get(H.T.SIZEFEATUREATTRIBUTE).data[0]:be.vertexAttributes.has(H.T.SIZE)&&(We=be.vertexAttributes.get(H.T.SIZE).data[0]);let Be=[1,1,1,1],Fe=0;this._parameters.vvColorEnabled?Fe=be.vertexAttributes.get(H.T.COLORFEATUREATTRIBUTE).data[0]:be.vertexAttributes.has(H.T.COLOR)&&(Be=be.vertexAttributes.get(H.T.COLOR).data);let je=0;this._parameters.vvOpacityEnabled&&(je=be.vertexAttributes.get(H.T.OPACITYFEATUREATTRIBUTE).data[0]);const Re=new Float32Array(Se.buffer);let He=ye*(this.vertexBufferLayout.stride/4);const Ie=(Me,Ne,Xe,Ye)=>{if(Re[He++]=Me[0],Re[He++]=Me[1],Re[He++]=Me[2],Re[He++]=Xe[0],Re[He++]=Xe[1],Re[He++]=Ne[0],Re[He++]=Ne[1],Re[He++]=Ne[2],this._parameters.worldSpace&&(Re[He++]=ze[0],Re[He++]=ze[1],Re[He++]=ze[2]),Re[He++]=this._parameters.vvSizeEnabled?Ce:We,this._parameters.vvColorEnabled)Re[He++]=Fe;else{const Je=Math.min(4*Ye,Be.length-4);Re[He++]=Be[Je+0],Re[He++]=Be[Je+1],Re[He++]=Be[Je+2],Re[He++]=Be[Je+3]}this._parameters.vvOpacityEnabled&&(Re[He++]=je)};let Ge;var Me;(Me=Ge||(Ge={}))[Me.ASCENDING=1]="ASCENDING",Me[Me.DESCENDING=-1]="DESCENDING";const Pe=(Me,Ne)=>{const Xe=(0,R.s)(me,ve[3*Me],ve[3*Me+1],ve[3*Me+2]),Ye=ge;let Je=Me+Ne;do{(0,R.s)(Ye,ve[3*Je],ve[3*Je+1],ve[3*Je+2]),Je+=Ne}while((0,R.F)(Xe,Ye)&&Je>=0&&Je<xe);Ee&&((0,R.m)(Xe,Xe,Ee),(0,R.m)(Ye,Ye,Ee)),Ie(Xe,Ye,[-1,-1],Me),Ie(Xe,Ye,[1,-1],Me),Ie(Xe,Ye,[1,1],Me),Ie(Xe,Ye,[-1,-1],Me),Ie(Xe,Ye,[1,1],Me),Ie(Xe,Ye,[-1,1],Me)},Le=this._parameters.placement;"begin"!==Le&&"begin-end"!==Le||Pe(0,Ge.ASCENDING),"end"!==Le&&"begin-end"!==Le||Pe(xe-1,Ge.DESCENDING)}}const me=(0,G.c)(),ge=(0,G.c)()},49580:(nt,Ae,v)=>{"use strict";v.d(Ae,{Y:()=>Ke});var D=v(63290),R=v(62208),G=v(23841),Z=v(67831),Q=v(84161),$=v(28093),W=v(4794),B=v(8834),H=v(13777),X=v(90014),te=v(60479),ae=v(13934),oe=v(36848),le=v(60881),de=v(40723),se=v(5894),re=v(2282),j=v(16396),Y=v(42037),ee=v(60909),ie=v(57623),J=v(65073),ce=v(651),ue=v(91056),pe=v(39114),he=v(12407),me=v(64127),ge=v(32616),_e=v(57596),Ee=v(67969),De=v(2078);class be extends ue.A{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==ae.H.Highlight}initializeConfiguration(ut,_t){_t.hasWebGL2Context=ut.rctx.type===_e.zO.WEBGL2}initializeProgram(ut){return new he.$(ut.rctx,be.shader.get().build(this.configuration),pe.i)}initializePipeline(){const ut=this.configuration,_t=(0,De.wK)(Ee.zi.SRC_ALPHA,Ee.zi.ONE,Ee.zi.ONE_MINUS_SRC_ALPHA,Ee.zi.ONE_MINUS_SRC_ALPHA),Ct=(vt,Lt=null,jt=null)=>(0,De.sm)({blending:Lt,depthTest:me.JN,depthWrite:jt,colorWrite:De.BK,stencilWrite:ut.hasOccludees?me.s3:null,stencilTest:ut.hasOccludees?vt?me.eD:me.RY:null});return ut.output===ae.H.Color?(this._occludeePipelineState=Ct(!0,ut.transparent||this._stippleEnabled?_t:null,De.LZ),Ct(!1,ut.transparent||this._stippleEnabled?_t:null,De.LZ)):Ct(!1)}get primitiveType(){return Ee.MX.LINES}getPipelineState(ut,_t){return _t?this._occludeePipelineState:super.getPipelineState(ut,_t)}}be.shader=new ce.J(ge.N,()=>v.e(310).then(v.bind(v,20310)));var ze,ot,Se=v(17626),ye=v(87601),ve=v(41528);class xe extends ve.W{constructor(){super(...arguments),this.output=ae.H.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}(0,Se._)([(0,ye.o)({count:ae.H.COUNT})],xe.prototype,"output",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"hasSlicePlane",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"hasVertexColors",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"transparent",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"draped",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"stippleEnabled",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"stippleOffColorEnabled",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"stipplePreferContinuous",void 0),(0,Se._)([(0,ye.o)()],xe.prototype,"hasOccludees",void 0),(0,Se._)([(0,ye.o)({constValue:!1})],xe.prototype,"stippleRequiresClamp",void 0),(0,Se._)([(0,ye.o)({constValue:!1})],xe.prototype,"stippleScaleWithLineWidth",void 0),(0,Se._)([(0,ye.o)({constValue:!1})],xe.prototype,"stippleRequiresStretchMeasure",void 0),(ot=ze||(ze={}))[ot.START=0]="START",ot[ot.END=1]="END";class Ke extends de.F5{constructor(ut){super(ut,new Be),this._configuration=new xe}getConfiguration(ut,_t){this._configuration.output=ut,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=_t.slot===se.r.DRAPED_MATERIAL;const Ct=(0,R.pC)(this.parameters.stipplePattern);return this._configuration.stippleEnabled=Ct,this._configuration.stippleOffColorEnabled=Ct&&(0,R.pC)(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(ut,_t,Ct,vt,Lt,jt,$t,Wt,pr){(0,R.pC)(pr)?(0,ie.TT)(ut,vt,pr,jt,1,$t):this._intersectLineGeometry(ut,_t,Ct,vt,$t)}_intersectLineGeometry(ut,_t,Ct,vt,Lt){if(!vt.options.selectionMode||(0,J.PD)(_t))return;if(!(0,re.kG)(Ct))return void D.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const jt=ut.vertexAttributes.get(j.T.POSITION).data,$t=vt.camera,Wt=Xe;(0,Z.c)(Wt,vt.point),(0,Q.s)(Ye[0],Wt[0]-2,Wt[1]+2,0),(0,Q.s)(Ye[1],Wt[0]+2,Wt[1]+2,0),(0,Q.s)(Ye[2],Wt[0]+2,Wt[1]-2,0),(0,Q.s)(Ye[3],Wt[0]-2,Wt[1]-2,0);for(let wt=0;wt<4;wt++)if(!$t.unprojectFromRenderScreen(Ye[wt],Je[wt]))return;(0,X.zk)($t.eye,Je[0],Je[1],rt),(0,X.zk)($t.eye,Je[1],Je[2],tt),(0,X.zk)($t.eye,Je[2],Je[3],et),(0,X.zk)($t.eye,Je[3],Je[0],qe);let gr=Number.MAX_VALUE,ar=0;for(let wt=0;wt<jt.length-5;wt+=3){if(Fe[0]=jt[wt]+Ct[12],Fe[1]=jt[wt+1]+Ct[13],Fe[2]=jt[wt+2]+Ct[14],je[0]=jt[wt+3]+Ct[12],je[1]=jt[wt+4]+Ct[13],je[2]=jt[wt+5]+Ct[14],(0,X.jH)(rt,Fe)<0&&(0,X.jH)(rt,je)<0||(0,X.jH)(tt,Fe)<0&&(0,X.jH)(tt,je)<0||(0,X.jH)(et,Fe)<0&&(0,X.jH)(et,je)<0||(0,X.jH)(qe,Fe)<0&&(0,X.jH)(qe,je)<0)continue;if($t.projectToRenderScreen(Fe,Ie),$t.projectToRenderScreen(je,Ge),Ie[2]<0&&Ge[2]>0){(0,Q.b)(Re,Fe,je);const sr=$t.frustum,rr=-(0,X.jH)(sr[B.Nu.NEAR],Fe)/(0,Q.e)(Re,(0,X.mJ)(sr[B.Nu.NEAR]));(0,Q.g)(Re,Re,rr),(0,Q.a)(Fe,Fe,Re),$t.projectToRenderScreen(Fe,Ie)}else if(Ie[2]>0&&Ge[2]<0){(0,Q.b)(Re,je,Fe);const sr=$t.frustum,rr=-(0,X.jH)(sr[B.Nu.NEAR],je)/(0,Q.e)(Re,(0,X.mJ)(sr[B.Nu.NEAR]));(0,Q.g)(Re,Re,rr),(0,Q.a)(je,je,Re),$t.projectToRenderScreen(je,Ge)}else if(Ie[2]<0&&Ge[2]<0)continue;Ie[2]=0,Ge[2]=0;const or=(0,H.Jk)((0,H.zk)(Ie,Ge,Me),Wt);or<gr&&(gr=or,(0,Q.c)(Pe,Fe),(0,Q.c)(Le,je),ar=wt/3)}const Fr=vt.rayBegin,mr=vt.rayEnd;if(gr<4){let wt=Number.MAX_VALUE;if((0,H.AR)((0,H.zk)(Pe,Le,Me),(0,H.zk)(Fr,mr,Ne),He)){(0,Q.b)(He,He,Fr);const or=(0,Q.l)(He);(0,Q.g)(He,He,1/or),wt=or/(0,Q.i)(Fr,mr)}Lt(wt,He,ar,!1)}}computeAttachmentOrigin(ut,_t){const Ct=ut.vertexAttributes;if(!Ct)return!1;const vt=Ct.get(j.T.POSITION);return(0,oe.qZ)(vt,null,!1,_t)}requiresSlot(ut,_t){return!(_t!==ae.H.Color&&_t!==ae.H.Highlight&&_t!==ae.H.ObjectAndLayerIdColor||ut!==se.r.OPAQUE_MATERIAL&&ut!==se.r.DRAPED_MATERIAL)}createGLMaterial(ut){return new We(ut)}createBufferWriter(){const ut=this.parameters.hasVertexColors?ee.IM:ee.wp;return(0,R.Wi)(this.parameters.stipplePattern)?new ee.G_(ut):new Ce(ut.clone().vec3f(j.T.AUXPOS1).vec2f(j.T.UV0))}}class We extends le.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(ut){ut.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ut.hasOccludees})}beginSlot(ut){this._output===ae.H.Color&&this._updateOccludeeState(ut);const _t=this._material.parameters.stipplePattern;return this._stipplePattern!==_t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,_t)),this._stipplePattern=_t),this.ensureTechnique(be,ut)}}class Ce{constructor(ut){this.vertexBufferLayout=ut}allocate(ut){return this.vertexBufferLayout.createBuffer(ut)}elementCount(ut){return ut.indices.get(j.T.POSITION).length}write(ut,_t,Ct,vt,Lt){(0,Y.NK)(Ct,this.vertexBufferLayout,ut,_t,vt,Lt),this._writeAuxpos1(ut,Ct,vt,Lt),this._writeUV0(ut,Ct,vt,Lt)}_writeAuxpos1(ut,_t,Ct,vt){const Lt=Ct.getField(j.T.AUXPOS1,te.ct),jt=_t.indices.get(j.T.POSITION),$t=_t.vertexAttributes.get(j.T.POSITION).data,Wt=ut,pr=Lt.typedBufferStride,gr=Lt.typedBuffer;vt*=pr;for(let ar=0;ar<jt.length-1;ar+=2)for(const Fr of[1,0]){const mr=3*jt[ar+Fr],wt=$t[mr],or=$t[mr+1],sr=$t[mr+2],Et=Wt[1]*wt+Wt[5]*or+Wt[9]*sr+Wt[13],St=Wt[2]*wt+Wt[6]*or+Wt[10]*sr+Wt[14];gr[vt]=Wt[0]*wt+Wt[4]*or+Wt[8]*sr+Wt[12],gr[vt+1]=Et,gr[vt+2]=St,vt+=pr}}_writeUV0(ut,_t,Ct,vt){const Lt=Ct.getField(j.T.UV0,te.Eu),jt=_t.indices.get(j.T.POSITION),$t=_t.vertexAttributes.get(j.T.POSITION).data,Wt=_t.vertexAttributes.get(j.T.DISTANCETOSTART)?.data,pr=Lt.typedBufferStride,gr=Lt.typedBuffer;let ar=0;gr[vt*=pr]=ze.START,gr[vt+1]=ar,vt+=pr;const Fr=3*jt[0],mr=(0,Q.s)(Fe,$t[Fr],$t[Fr+1],$t[Fr+2]);ut&&(0,Q.m)(mr,mr,ut);const wt=je,or=jt.length-1;let sr=1;const rr=Wt?(St,Ft,zt)=>ar=Wt[zt]:(St,Ft,zt)=>ar+=(0,Q.i)(St,Ft);for(let St=1;St<or;St+=2){const Ft=3*jt[St];(0,Q.s)(wt,$t[Ft],$t[Ft+1],$t[Ft+2]),ut&&(0,Q.m)(wt,wt,ut),rr(mr,wt,sr++);for(let zt=0;zt<2;++zt)gr[vt]=1-zt,gr[vt+1]=ar,vt+=pr;(0,Q.c)(mr,wt)}const Et=3*jt[or];(0,Q.s)(wt,$t[Et],$t[Et+1],$t[Et+2]),ut&&(0,Q.m)(wt,wt,ut),rr(mr,wt,sr),gr[vt]=ze.END,gr[vt+1]=ar}}class Be extends de.Mt{constructor(){super(...arguments),this.color=W.O,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const Fe=(0,$.c)(),je=(0,$.c)(),Re=(0,$.c)(),He=(0,$.c)(),Ie=(0,G.J$)(),Ge=(0,G.J$)(),Pe=(0,$.c)(),Le=(0,$.c)(),Me=(0,H.Ue)(),Ne=(0,H.Ue)(),Xe=(0,$.c)(),Ye=[(0,G.J$)(),(0,G.J$)(),(0,G.J$)(),(0,G.J$)()],Je=[(0,$.c)(),(0,$.c)(),(0,$.c)(),(0,$.c)()],rt=(0,X.Ue)(),tt=(0,X.Ue)(),et=(0,X.Ue)(),qe=(0,X.Ue)()},95402:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{b:()=>D}),(R=D||(D={}))[R.Horizontal=0]="Horizontal",R[R.Vertical=1]="Vertical",R[R.Cross=2]="Cross",R[R.ForwardDiagonal=3]="ForwardDiagonal",R[R.BackwardDiagonal=4]="BackwardDiagonal",R[R.DiagonalCross=5]="DiagonalCross",R[R.COUNT=6]="COUNT"},92222:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>Ke});var D=v(8314),R=v(63290),G=v(21286),Z=v(62208),Q=v(23841),$=v(67831),W=v(84161),B=v(28093),H=v(4794),X=v(8834),te=v(13777),ae=v(90014),oe=v(19625),le=v(13934),de=v(36848),se=v(60881),re=v(40723),j=v(5894),Y=v(2282),ee=v(16396),ie=v(41857),J=v(65073),ce=v(46359),ue=v(3393),pe=v(651),he=v(91056),me=v(88569),ge=v(12407),_e=v(64127),Ee=v(44835),De=v(67969),be=v(2078);const Se=new Map([[ee.T.POSITION,0],[ee.T.SUBDIVISIONFACTOR,1],[ee.T.UV0,2],[ee.T.AUXPOS1,3],[ee.T.AUXPOS2,4],[ee.T.COLOR,5],[ee.T.COLORFEATUREATTRIBUTE,5],[ee.T.SIZE,6],[ee.T.SIZEFEATUREATTRIBUTE,6],[ee.T.OPACITYFEATUREATTRIBUTE,7],[ee.T.OBJECTANDLAYERIDCOLOR,8]]);class ye extends he.A{initializeProgram(Wt){return new ge.$(Wt.rctx,ye.shader.get().build(this.configuration),Se)}_makePipelineState(Wt,pr){const gr=this.configuration,ar=Wt===Ee.A.NONE,Fr=Wt===Ee.A.FrontFace;return(0,be.sm)({blending:gr.output===le.H.Color||gr.output===le.H.Alpha?ar?me.wu:(0,me.j7)(Wt):null,depthTest:{func:(0,me.Bh)(Wt)},depthWrite:ar?gr.writeDepth&&be.LZ:(0,me.K5)(Wt),colorWrite:be.BK,stencilWrite:gr.hasOccludees?_e.s3:null,stencilTest:gr.hasOccludees?pr?_e.eD:_e.RY:null,polygonOffset:ar||Fr?gr.hasPolygonOffset&&ve:me.E0})}initializePipeline(){const Wt=this.configuration;if(Wt.occluder){const pr=Wt.hasPolygonOffset&&ve;this._occluderPipelineTransparent=(0,be.sm)({blending:me.wu,polygonOffset:pr,depthTest:_e.zV,depthWrite:null,colorWrite:be.BK,stencilWrite:null,stencilTest:_e.YD}),this._occluderPipelineOpaque=(0,be.sm)({blending:me.wu,polygonOffset:pr,depthTest:_e.zV,depthWrite:null,colorWrite:be.BK,stencilWrite:_e.P7,stencilTest:_e.ii}),this._occluderPipelineMaskWrite=(0,be.sm)({blending:null,polygonOffset:pr,depthTest:_e.JN,depthWrite:null,colorWrite:null,stencilWrite:_e.s3,stencilTest:_e.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?De.MX.LINES:De.MX.TRIANGLE_STRIP}getPipelineState(Wt,pr){return pr?this._occludeePipelineState:this.configuration.occluder?Wt===j.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:Wt===j.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(Wt,pr)}}ye.shader=new pe.J(ue.R,()=>v.e(4346).then(v.bind(v,84346)));const ve={factor:0,units:-4};var ze,$t,xe=v(39401);($t=ze||(ze={}))[$t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",$t[$t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",$t[$t.LEFT_CAP_START=-4]="LEFT_CAP_START",$t[$t.LEFT_CAP_END=-5]="LEFT_CAP_END",$t[$t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",$t[$t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",$t[$t.RIGHT_CAP_START=4]="RIGHT_CAP_START",$t[$t.RIGHT_CAP_END=5]="RIGHT_CAP_END";class Ke extends re.F5{constructor(Wt){super(Wt,new Ce),this._configuration=new xe.G,this._vertexAttributeLocations=Se,this._layout=this.createLayout()}isClosed(Wt,pr){return Re(this.parameters,Wt,pr)}getConfiguration(Wt,pr){this._configuration.output=Wt,this._configuration.draped=pr.slot===j.r.DRAPED_MATERIAL;const gr=(0,Z.pC)(this.parameters.stipplePattern)&&Wt!==le.H.Highlight;return this._configuration.stippleEnabled=gr,this._configuration.stippleOffColorEnabled=gr&&(0,Z.pC)(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=gr&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=gr&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!(0,Z.pC)(this.parameters.markerParameters)&&function He($t){return $t.anchor===ce.i5.Tip&&$t.hideOnShortSegments&&"begin-end"===$t.placement&&$t.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&(0,Z.pC)(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===re.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=pr.transparencyPassType,this._configuration.hasMultipassTerrain=pr.multipassTerrain.enabled,this._configuration.cullAboveGround=pr.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersect(Wt,pr,gr,ar,Fr,mr,wt,or,sr){(0,Z.pC)(sr)?this._intersectDrapedLineGeometry(Wt,ar,sr,mr,wt):this._intersectLineGeometry(Wt,pr,gr,ar,wt)}_intersectDrapedLineGeometry(Wt,pr,gr,ar,Fr){if(!pr.options.selectionMode)return;const mr=Wt.vertexAttributes.get(ee.T.POSITION).data,wt=Wt.vertexAttributes.get(ee.T.SIZE);let or=this.parameters.width;if(this.parameters.vvSizeEnabled){const zt=Wt.vertexAttributes.get(ee.T.SIZEFEATUREATTRIBUTE).data[0];or*=(0,G.uZ)(this.parameters.vvSizeOffset[0]+zt*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else wt&&(or*=wt.data[0]);const sr=ar[0],rr=ar[1],Et=(or/2+4)*Wt.screenToWorldRatio;let St=Number.MAX_VALUE,Ft=0;for(let zt=0;zt<mr.length-5;zt+=3){const dr=mr[zt],hr=mr[zt+1],Tr=sr-dr,Dr=rr-hr,Lr=mr[zt+3]-dr,Hr=mr[zt+4]-hr,Qr=(0,G.uZ)((Lr*Tr+Hr*Dr)/(Lr*Lr+Hr*Hr),0,1),Jr=Lr*Qr-Tr,Ss=Hr*Qr-Dr,Cs=Jr*Jr+Ss*Ss;Cs<St&&(St=Cs,Ft=zt/3)}St<Et*Et&&Fr(gr.dist,gr.normal,Ft,!1)}_intersectLineGeometry(Wt,pr,gr,ar,Fr){if(!ar.options.selectionMode||(0,J.PD)(pr))return;if(!(0,Y.kG)(gr))return void R.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const mr=Wt.vertexAttributes,wt=mr.get(ee.T.POSITION).data;let or=this.parameters.width;if(this.parameters.vvSizeEnabled){const Tr=mr.get(ee.T.SIZEFEATUREATTRIBUTE).data[0];or*=(0,G.uZ)(this.parameters.vvSizeOffset[0]+Tr*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else mr.has(ee.T.SIZE)&&(or*=mr.get(ee.T.SIZE).data[0]);const sr=ar.camera,rr=Me;(0,$.c)(rr,ar.point);const Et=or*sr.pixelRatio/2+4*sr.pixelRatio;(0,W.s)(ut[0],rr[0]-Et,rr[1]+Et,0),(0,W.s)(ut[1],rr[0]+Et,rr[1]+Et,0),(0,W.s)(ut[2],rr[0]+Et,rr[1]-Et,0),(0,W.s)(ut[3],rr[0]-Et,rr[1]-Et,0);for(let Tr=0;Tr<4;Tr++)if(!sr.unprojectFromRenderScreen(ut[Tr],_t[Tr]))return;(0,ae.zk)(sr.eye,_t[0],_t[1],Ct),(0,ae.zk)(sr.eye,_t[1],_t[2],vt),(0,ae.zk)(sr.eye,_t[2],_t[3],Lt),(0,ae.zk)(sr.eye,_t[3],_t[0],jt);let St=Number.MAX_VALUE,Ft=0;const zt=je(this.parameters,mr,Wt.indices)?wt.length-2:wt.length-5;for(let Tr=0;Tr<zt;Tr+=3){Ie[0]=wt[Tr]+gr[12],Ie[1]=wt[Tr+1]+gr[13],Ie[2]=wt[Tr+2]+gr[14];const Dr=(Tr+3)%wt.length;if(Ge[0]=wt[Dr]+gr[12],Ge[1]=wt[Dr+1]+gr[13],Ge[2]=wt[Dr+2]+gr[14],(0,ae.jH)(Ct,Ie)<0&&(0,ae.jH)(Ct,Ge)<0||(0,ae.jH)(vt,Ie)<0&&(0,ae.jH)(vt,Ge)<0||(0,ae.jH)(Lt,Ie)<0&&(0,ae.jH)(Lt,Ge)<0||(0,ae.jH)(jt,Ie)<0&&(0,ae.jH)(jt,Ge)<0)continue;if(sr.projectToRenderScreen(Ie,Ne),sr.projectToRenderScreen(Ge,Xe),Ne[2]<0&&Xe[2]>0){(0,W.b)(Pe,Ie,Ge);const Hr=sr.frustum,Qr=-(0,ae.jH)(Hr[X.Nu.NEAR],Ie)/(0,W.e)(Pe,(0,ae.mJ)(Hr[X.Nu.NEAR]));(0,W.g)(Pe,Pe,Qr),(0,W.a)(Ie,Ie,Pe),sr.projectToRenderScreen(Ie,Ne)}else if(Ne[2]>0&&Xe[2]<0){(0,W.b)(Pe,Ge,Ie);const Hr=sr.frustum,Qr=-(0,ae.jH)(Hr[X.Nu.NEAR],Ge)/(0,W.e)(Pe,(0,ae.mJ)(Hr[X.Nu.NEAR]));(0,W.g)(Pe,Pe,Qr),(0,W.a)(Ge,Ge,Pe),sr.projectToRenderScreen(Ge,Xe)}else if(Ne[2]<0&&Xe[2]<0)continue;Ne[2]=0,Xe[2]=0;const Lr=(0,te.Jk)((0,te.zk)(Ne,Xe,rt),rr);Lr<St&&(St=Lr,(0,W.c)(Ye,Ie),(0,W.c)(Je,Ge),Ft=Tr/3)}const dr=ar.rayBegin,hr=ar.rayEnd;if(St<Et*Et){let Tr=Number.MAX_VALUE;if((0,te.AR)((0,te.zk)(Ye,Je,rt),(0,te.zk)(dr,hr,tt),Le)){(0,W.b)(Le,Le,dr);const Dr=(0,W.l)(Le);(0,W.g)(Le,Le,1/Dr),Tr=Dr/(0,W.i)(dr,hr)}Fr(Tr,Le,Ft,!1)}}computeAttachmentOrigin(Wt,pr){const gr=Wt.vertexAttributes;if(!gr)return!1;const ar=Wt.indices,Fr=gr.get(ee.T.POSITION);return(0,de.qZ)(Fr,ar?ar.get(ee.T.POSITION):null,ar&&je(this.parameters,gr,ar),pr)}createLayout(){const Wt=(0,oe.U$)().vec3f(ee.T.POSITION).f32(ee.T.SUBDIVISIONFACTOR).vec2f(ee.T.UV0).vec3f(ee.T.AUXPOS1).vec3f(ee.T.AUXPOS2);return Wt.f32(this.parameters.vvSizeEnabled?ee.T.SIZEFEATUREATTRIBUTE:ee.T.SIZE),this.parameters.vvColorEnabled?Wt.f32(ee.T.COLORFEATUREATTRIBUTE):Wt.vec4f(ee.T.COLOR),this.parameters.vvOpacityEnabled&&Wt.f32(ee.T.OPACITYFEATUREATTRIBUTE),(0,D.Z)("enable-feature:objectAndLayerId-rendering")&&Wt.vec4u8(ee.T.OBJECTANDLAYERIDCOLOR),Wt}createBufferWriter(){return new Be(this._layout,this.parameters)}requiresSlot(Wt,pr){return!(pr!==le.H.Color&&pr!==le.H.Alpha&&pr!==le.H.Highlight&&pr!==le.H.Depth&&pr!==le.H.ObjectAndLayerIdColor||Wt!==j.r.DRAPED_MATERIAL&&(this.parameters.renderOccluded===re.yD.OccludeAndTransparentStencil?Wt!==j.r.OPAQUE_MATERIAL&&Wt!==j.r.OCCLUDER_MATERIAL&&Wt!==j.r.TRANSPARENT_OCCLUDER_MATERIAL:pr===le.H.Color||pr===le.H.Alpha?Wt!==(this.parameters.writeDepth?j.r.TRANSPARENT_MATERIAL:j.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):Wt!==j.r.OPAQUE_MATERIAL))}createGLMaterial(Wt){return new We(Wt)}validateParameters(Wt){"miter"!==Wt.join&&(Wt.miterLimit=0),(0,Z.pC)(Wt.markerParameters)&&(Wt.markerScale=Wt.markerParameters.width/Wt.width)}}class We extends se.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(Wt){Wt.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Wt.hasOccludees})}beginSlot(Wt){this._output!==le.H.Color&&this._output!==le.H.Alpha||this._updateOccludeeState(Wt);const pr=this._material.parameters.stipplePattern;return this._stipplePattern!==pr&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,pr)),this._stipplePattern=pr),this.ensureTechnique(ye,Wt)}}class Ce extends ie.n{constructor(){super(...arguments),this.width=0,this.color=H.O,this.join="miter",this.cap=xe.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Be{constructor(Wt,pr){this._parameters=pr,this.numJoinSubdivisions=0,this.vertexBufferLayout=Wt;const gr=pr.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=gr;break;case"round":this.numJoinSubdivisions=ue.N+gr}}_isClosed(Wt){return je(this._parameters,Wt.vertexAttributes,Wt.indices)}allocate(Wt){return this.vertexBufferLayout.createBuffer(Wt)}elementCount(Wt){const gr=Wt.indices.get(ee.T.POSITION).length/2+1,ar=this._isClosed(Wt);let Fr=ar?2:4;return Fr+=((ar?gr:gr-1)-(ar?0:1))*(2*this.numJoinSubdivisions+4),Fr+=2,this._parameters.wireframe&&(Fr=2+4*(Fr-2)),Fr}write(Wt,pr,gr,ar,Fr){const mr=et,wt=qe,or=ot,sr=gr.vertexAttributes.get(ee.T.POSITION).data,rr=gr.indices&&gr.indices.get(ee.T.POSITION),Et=gr.vertexAttributes.get(ee.T.DISTANCETOSTART)?.data;rr&&rr.length!==2*(sr.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let St=1,Ft=0;this._parameters.vvSizeEnabled?Ft=gr.vertexAttributes.get(ee.T.SIZEFEATUREATTRIBUTE).data[0]:gr.vertexAttributes.has(ee.T.SIZE)&&(St=gr.vertexAttributes.get(ee.T.SIZE).data[0]);let zt=[1,1,1,1],dr=0;this._parameters.vvColorEnabled?dr=gr.vertexAttributes.get(ee.T.COLORFEATUREATTRIBUTE).data[0]:gr.vertexAttributes.has(ee.T.COLOR)&&(zt=gr.vertexAttributes.get(ee.T.COLOR).data);let hr=null;(0,D.Z)("enable-feature:objectAndLayerId-rendering")&&(hr=gr.objectAndLayerIdColor);let Tr=0;this._parameters.vvOpacityEnabled&&(Tr=gr.vertexAttributes.get(ee.T.OPACITYFEATUREATTRIBUTE).data[0]);const Dr=sr.length/3,Lr=new Float32Array(ar.buffer),Hr=(0,D.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ar.buffer):null,Qr=this.vertexBufferLayout.stride/4;let Jr=Fr*Qr;const Ss=Jr;let Cs=0;const Dt=Et?(_r,Or,gs)=>Cs=Et[gs]:(_r,Or,gs)=>Cs+=(0,W.i)(_r,Or),ct=(_r,Or,gs,Kr,qt,Ir,Sr)=>{if(Lr[Jr++]=Or[0],Lr[Jr++]=Or[1],Lr[Jr++]=Or[2],Lr[Jr++]=Kr,Lr[Jr++]=Sr,Lr[Jr++]=qt,Lr[Jr++]=_r[0],Lr[Jr++]=_r[1],Lr[Jr++]=_r[2],Lr[Jr++]=gs[0],Lr[Jr++]=gs[1],Lr[Jr++]=gs[2],Lr[Jr++]=this._parameters.vvSizeEnabled?Ft:St,this._parameters.vvColorEnabled)Lr[Jr++]=dr;else{const fs=Math.min(4*Ir,zt.length-4);Lr[Jr++]=zt[fs+0],Lr[Jr++]=zt[fs+1],Lr[Jr++]=zt[fs+2],Lr[Jr++]=zt[fs+3]}this._parameters.vvOpacityEnabled&&(Lr[Jr++]=Tr),(0,D.Z)("enable-feature:objectAndLayerId-rendering")&&((0,Z.pC)(hr)&&(Hr[4*Jr+0]=hr[0],Hr[4*Jr+1]=hr[1],Hr[4*Jr+2]=hr[2],Hr[4*Jr+3]=hr[3]),Jr++)};Jr+=Qr,(0,W.s)(wt,sr[0],sr[1],sr[2]),Wt&&(0,W.m)(wt,wt,Wt);const At=this._isClosed(gr);if(At){const _r=sr.length-3;(0,W.s)(mr,sr[_r],sr[_r+1],sr[_r+2]),Wt&&(0,W.m)(mr,mr,Wt)}else(0,W.s)(or,sr[3],sr[4],sr[5]),Wt&&(0,W.m)(or,or,Wt),ct(wt,wt,or,1,ze.LEFT_CAP_START,0,0),ct(wt,wt,or,1,ze.RIGHT_CAP_START,0,0),(0,W.c)(mr,wt),(0,W.c)(wt,or);const Kt=At?0:1,tr=At?Dr:Dr-1;for(let _r=Kt;_r<tr;_r++){const Or=(_r+1)%Dr*3;(0,W.s)(or,sr[Or+0],sr[Or+1],sr[Or+2]),Wt&&(0,W.m)(or,or,Wt),Dt(mr,wt,_r),ct(mr,wt,or,0,ze.LEFT_JOIN_END,_r,Cs),ct(mr,wt,or,0,ze.RIGHT_JOIN_END,_r,Cs);const gs=this.numJoinSubdivisions;for(let Kr=0;Kr<gs;++Kr){const qt=(Kr+1)/(gs+1);ct(mr,wt,or,qt,ze.LEFT_JOIN_END,_r,Cs),ct(mr,wt,or,qt,ze.RIGHT_JOIN_END,_r,Cs)}ct(mr,wt,or,1,ze.LEFT_JOIN_START,_r,Cs),ct(mr,wt,or,1,ze.RIGHT_JOIN_START,_r,Cs),(0,W.c)(mr,wt),(0,W.c)(wt,or)}At?((0,W.s)(or,sr[3],sr[4],sr[5]),Wt&&(0,W.m)(or,or,Wt),Cs=Dt(mr,wt,tr),ct(mr,wt,or,0,ze.LEFT_JOIN_END,Kt,Cs),ct(mr,wt,or,0,ze.RIGHT_JOIN_END,Kt,Cs)):(Cs=Dt(mr,wt,tr),ct(mr,wt,wt,0,ze.LEFT_CAP_END,tr,Cs),ct(mr,wt,wt,0,ze.RIGHT_CAP_END,tr,Cs)),Fe(Lr,Ss+Qr,Lr,Ss,Qr),Jr=Fe(Lr,Jr-Qr,Lr,Jr,Qr),this._parameters.wireframe&&this._addWireframeVertices(ar,Ss,Jr,Qr)}_addWireframeVertices(Wt,pr,gr,ar){const Fr=new Float32Array(Wt.buffer,gr*Float32Array.BYTES_PER_ELEMENT),mr=new Float32Array(Wt.buffer,pr*Float32Array.BYTES_PER_ELEMENT,gr-pr);let wt=0;const or=sr=>wt=Fe(mr,sr,Fr,wt,ar);for(let sr=0;sr<mr.length-1;sr+=2*ar)or(sr),or(sr+2*ar),or(sr+1*ar),or(sr+2*ar),or(sr+1*ar),or(sr+3*ar)}}function Fe($t,Wt,pr,gr,ar){for(let Fr=0;Fr<ar;Fr++)pr[gr++]=$t[Wt++];return gr}function je($t,Wt,pr){return Re($t,Wt.get(ee.T.POSITION).data,pr?pr.get(ee.T.POSITION):null)}function Re($t,Wt,pr){return!!$t.isClosed&&(pr?pr.length>2:Wt.length>6)}const Ie=(0,B.c)(),Ge=(0,B.c)(),Pe=(0,B.c)(),Le=(0,B.c)(),Me=(0,B.c)(),Ne=(0,Q.J$)(),Xe=(0,Q.J$)(),Ye=(0,B.c)(),Je=(0,B.c)(),rt=(0,te.Ue)(),tt=(0,te.Ue)(),et=(0,B.c)(),qe=(0,B.c)(),ot=(0,B.c)(),ut=[(0,Q.J$)(),(0,Q.J$)(),(0,Q.J$)(),(0,Q.J$)()],_t=[(0,B.c)(),(0,B.c)(),(0,B.c)(),(0,B.c)()],Ct=(0,ae.Ue)(),vt=(0,ae.Ue)(),Lt=(0,ae.Ue)(),jt=(0,ae.Ue)()},51899:(nt,Ae,v)=>{"use strict";v.d(Ae,{$A:()=>X,h0:()=>$,it:()=>ae,kj:()=>te});var D=v(36161),R=v(62208),G=v(17625),Z=v(67969),Q=v(55086);class ${constructor(le){this._rctx=le,this._cache=new Map}dispose(){this._cache.forEach(le=>(0,R.M2)(le.stippleTexture)),this._cache.clear()}_acquire(le){if((0,R.Wi)(le))return null;const de=this._patternId(le),se=this._cache.get(de);if(se)return se.refCount++,se;const{encodedData:re,paddedPixels:j}=function B(oe){const le=H(oe),de=1/oe.pixelRatio,se=X(oe),re=te(oe),j=(Math.floor(.5*(re-1))+.5)*de,Y=[];let ee=1;for(const he of le){for(let me=0;me<he;me++){const ge=ee*(Math.min(me,he-1-me)+.5)*de/j*.5+.5;Y.push(ge)}ee=-ee}const ie=Math.round(le[0]/2),J=[...Y.slice(ie),...Y.slice(0,ie)],ce=se+ae,ue=new Uint8Array(4*ce);let pe=4;for(const he of J)(0,D.I)(he,ue,pe),pe+=4;return ue.copyWithin(0,pe-4,pe),ue.copyWithin(pe,4,8),{encodedData:ue,paddedPixels:ce}}(le),Y=new W(new Q.x(this._rctx,{width:j,height:1,internalFormat:Z.VI.RGBA,pixelFormat:Z.VI.RGBA,dataType:Z.Br.UNSIGNED_BYTE,wrapMode:Z.e8.CLAMP_TO_EDGE},re));return this._cache.set(de,Y),Y}release(le){if((0,R.Wi)(le))return;const de=this._patternId(le),se=this._cache.get(de);se&&(se.refCount--,0===se.refCount&&((0,R.pC)(se.stippleTexture)&&se.stippleTexture.dispose(),this._cache.delete(de)))}swap(le,de){const se=this._acquire(de);return this.release(le),se}_patternId(le){return`${le.pattern.join(",")}-r${le.pixelRatio}`}}class W extends G.K{constructor(le){super(),this.stippleTexture=le,this.refCount=1}}function H(oe){return oe.pattern.map(le=>Math.round(le*oe.pixelRatio))}function X(oe){if((0,R.Wi)(oe))return 1;const le=H(oe);return Math.floor(le.reduce((de,se)=>de+se))}function te(oe){return H(oe).reduce((le,de)=>Math.max(le,de))}const ae=2},41857:(nt,Ae,v)=>{"use strict";v.d(Ae,{n:()=>Z,x:()=>Q});var D=v(550),R=v(28093),G=v(40723);class Z extends G.Mt{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=(0,R.f)(1,1,1),this.vvSizeMaxSize=(0,R.f)(100,100,100),this.vvSizeOffset=(0,R.f)(0,0,0),this.vvSizeFactor=(0,R.f)(1,1,1),this.vvSizeValue=(0,R.f)(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,D.c)()}}const Q=8},44989:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>be,m:()=>Se});var D=v(27422),R=v(99770),G=v(4794),Z=v(13934),Q=v(42836),$=v(40723),W=v(88569),B=v(5894),H=v(62208),X=v(60881),te=v(17626),ae=v(59617),oe=v(92724),de=(v(45780),v(7228)),se=v(651),re=v(91056),j=v(87601),Y=v(39114),ee=v(12407),ie=v(44835),J=v(41528),ce=v(61584),ue=v(57596),pe=v(2078);class me extends re.A{initializeConfiguration(xe,ze){ze.hasWebGL2Context=xe.rctx.type===ue.zO.WEBGL2,ze.spherical=xe.viewingMode===ae.JY.Global,ze.doublePrecisionRequiresObfuscation=(0,de.I)(xe.rctx)}initializeProgram(xe){return new ee.$(xe.rctx,me.shader.get().build(this.configuration),Y.i)}_setPipelineState(xe){const ze=this.configuration,Ke=xe===ie.A.NONE,We=xe===ie.A.FrontFace;return(0,pe.sm)({blending:ze.output!==Z.H.Normal&&ze.output!==Z.H.Highlight&&ze.transparent?Ke?W.wu:(0,W.j7)(xe):null,depthTest:{func:(0,W.Bh)(xe)},depthWrite:Ke?ze.writeDepth&&pe.LZ:(0,W.K5)(xe),colorWrite:pe.BK,polygonOffset:Ke||We?null:(0,W.je)(ze.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}me.shader=new se.J(ce.W,()=>v.e(4095).then(v.bind(v,74095)));class ge extends J.W{constructor(){super(...arguments),this.output=Z.H.Color,this.transparencyPassType=ie.A.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,te._)([(0,j.o)({count:Z.H.COUNT})],ge.prototype,"output",void 0),(0,te._)([(0,j.o)({count:ie.A.COUNT})],ge.prototype,"transparencyPassType",void 0),(0,te._)([(0,j.o)()],ge.prototype,"spherical",void 0),(0,te._)([(0,j.o)()],ge.prototype,"receiveShadows",void 0),(0,te._)([(0,j.o)()],ge.prototype,"hasSlicePlane",void 0),(0,te._)([(0,j.o)()],ge.prototype,"transparent",void 0),(0,te._)([(0,j.o)()],ge.prototype,"enableOffset",void 0),(0,te._)([(0,j.o)()],ge.prototype,"writeDepth",void 0),(0,te._)([(0,j.o)()],ge.prototype,"hasScreenSpaceReflections",void 0),(0,te._)([(0,j.o)()],ge.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,te._)([(0,j.o)()],ge.prototype,"hasCloudsReflections",void 0),(0,te._)([(0,j.o)()],ge.prototype,"isDraped",void 0),(0,te._)([(0,j.o)()],ge.prototype,"hasMultipassTerrain",void 0),(0,te._)([(0,j.o)()],ge.prototype,"cullAboveGround",void 0),(0,te._)([(0,j.o)({constValue:oe.f7.Water})],ge.prototype,"pbrMode",void 0),(0,te._)([(0,j.o)({constValue:!0})],ge.prototype,"useCustomDTRExponentForWater",void 0),(0,te._)([(0,j.o)({constValue:!0})],ge.prototype,"highStepCount",void 0),(0,te._)([(0,j.o)({constValue:!1})],ge.prototype,"useFillLights",void 0);class _e extends X.Z{_updateShadowState(xe){xe.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:xe.shadowMap.enabled})}_updateSSRState(xe){xe.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:xe.ssr.enabled})}_updateCloudsReflectionState(xe){const ze=(0,H.pC)(xe.cloudsFade.data);ze!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:ze})}ensureResources(xe){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(xe)}beginSlot(xe){return this._output===Z.H.Color&&(this._updateShadowState(xe),this._updateSSRState(xe),this._updateCloudsReflectionState(xe)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(me,xe)}}var Ee=v(60909),De=v(57623);class be extends $.F5{constructor(xe){super(xe,new Se),this._configuration=new ge,this.animation=new Q.d}getConfiguration(xe,ze){return this._configuration.output=xe,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=ze.transparencyPassType,this._configuration.enableOffset=ze.camera.relativeElevation<W.ve,this._configuration.hasMultipassTerrain=ze.multipassTerrain.enabled,this._configuration.cullAboveGround=ze.multipassTerrain.cullAboveGround,this._configuration}update(xe){const ze=Math.min(xe.camera.relativeElevation,xe.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*ze<ye;const Ke=this.animation.advance(xe);return this.setParameters({timeElapsed:(0,D.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&Ke}intersect(xe,ze,Ke,We,Ce,Be,Fe){(0,De.Bw)(xe,ze,We,Ce,Be,void 0,Fe)}requiresSlot(xe,ze){switch(ze){case Z.H.Normal:return xe===B.r.DRAPED_WATER;case Z.H.Color:if(this.parameters.isDraped)return xe===B.r.DRAPED_MATERIAL;break;case Z.H.Alpha:break;case Z.H.Highlight:return xe===B.r.OPAQUE_MATERIAL||xe===B.r.DRAPED_MATERIAL;default:return!1}let Ke=B.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(Ke=this.parameters.writeDepth?B.r.TRANSPARENT_MATERIAL:B.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),xe===Ke}createGLMaterial(xe){return new _e(xe)}createBufferWriter(){return new Ee.G_(Ee.W1)}}class Se extends $.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,R.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,G.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const ye=35e3},60909:(nt,Ae,v)=>{"use strict";v.d(Ae,{G_:()=>X,IM:()=>$,W1:()=>Q,ck:()=>H,wp:()=>Z});var D=v(19625),R=v(16396),G=v(42037);const Z=(0,D.U$)().vec3f(R.T.POSITION),Q=(0,D.U$)().vec3f(R.T.POSITION).vec2f(R.T.UV0),$=(0,D.U$)().vec3f(R.T.POSITION).vec4u8(R.T.COLOR),H=((0,D.U$)().vec3f(R.T.POSITION).vec4u8(R.T.OBJECTANDLAYERIDCOLOR),(0,D.U$)().vec3f(R.T.POSITION).vec2f(R.T.UV0).vec4u8(R.T.OBJECTANDLAYERIDCOLOR),(0,D.U$)().vec3f(R.T.POSITION).vec4u8(R.T.COLOR).vec4u8(R.T.OBJECTANDLAYERIDCOLOR));class X{constructor(ae){this.vertexBufferLayout=ae}allocate(ae){return this.vertexBufferLayout.createBuffer(ae)}elementCount(ae){return ae.indices.get(R.T.POSITION).length}write(ae,oe,le,de,se){(0,G.NK)(le,this.vertexBufferLayout,ae,oe,de,se)}}},57623:(nt,Ae,v)=>{"use strict";v.d(Ae,{Bw:()=>oe,CN:()=>re,FZ:()=>Ee,Fw:()=>ue,Hx:()=>pe,LO:()=>me,Mw:()=>ie,TT:()=>ge,Tw:()=>ce,Ue:()=>J,Uf:()=>he});var D=v(85931),R=v(21286),G=v(62208),Z=v(84161),Q=v(28093),$=v(5548),W=v(42743),B=v(17962),H=v(2282),X=v(16396),te=v(65073);const ae=(0,$.Ue)();function oe(be,Se,ye,ve,xe,ze,Ke){if(!(0,te.PD)(Se))if(be.boundingInfo)(0,H.hu)(be.primitiveType===W.MX.Triangle),de(be.boundingInfo,ve,xe,ye.tolerance,ze,Ke);else{const We=be.indices.get(X.T.POSITION),Ce=be.vertexAttributes.get(X.T.POSITION);re(ve,xe,0,We.length/3,We,Ce,void 0,ze,Ke)}}const le=(0,Q.c)();function de(be,Se,ye,ve,xe,ze){if((0,G.Wi)(be))return;const Ke=J(Se,ye,le);if((0,$.op)(ae,be.getBBMin()),(0,$.Tn)(ae,be.getBBMax()),(0,G.pC)(xe)&&xe.applyToAabb(ae),ce(ae,Se,Ke,ve)){const{primitiveIndices:We,indices:Ce,position:Be}=be,Fe=We?We.length:Ce.length/3;if(Fe>De){const je=be.getChildren();if(void 0!==je){for(let Re=0;Re<8;++Re)void 0!==je[Re]&&de(je[Re],Se,ye,ve,xe,ze);return}}re(Se,ye,0,Fe,Ce,Be,We,xe,ze)}}const se=(0,Q.c)();function re(be,Se,ye,ve,xe,ze,Ke,We,Ce){if(Ke)return function j(be,Se,ye,ve,xe,ze,Ke,We,Ce){const Be=ze.data,Fe=ze.stride||ze.size,je=be[0],Re=be[1],He=be[2],Ie=Se[0]-je,Ge=Se[1]-Re,Pe=Se[2]-He;for(let Le=ye;Le<ve;++Le){const Me=Ke[Le];let Ne=3*Me,Xe=Fe*xe[Ne++],Ye=Be[Xe++],Je=Be[Xe++],rt=Be[Xe];Xe=Fe*xe[Ne++];let tt=Be[Xe++],et=Be[Xe++],qe=Be[Xe];Xe=Fe*xe[Ne];let ot=Be[Xe++],ut=Be[Xe++],_t=Be[Xe];(0,G.pC)(We)&&([Ye,Je,rt]=We.applyToVertex(Ye,Je,rt,Le),[tt,et,qe]=We.applyToVertex(tt,et,qe,Le),[ot,ut,_t]=We.applyToVertex(ot,ut,_t,Le));const Ct=tt-Ye,vt=et-Je,Lt=qe-rt,jt=ot-Ye,$t=ut-Je,Wt=_t-rt,pr=Ge*Wt-$t*Pe,gr=Pe*jt-Wt*Ie,ar=Ie*$t-jt*Ge,Fr=Ct*pr+vt*gr+Lt*ar;if(Math.abs(Fr)<=Number.EPSILON)continue;const mr=je-Ye,wt=Re-Je,or=He-rt,sr=mr*pr+wt*gr+or*ar;if(Fr>0){if(sr<0||sr>Fr)continue}else if(sr>0||sr<Fr)continue;const rr=wt*Lt-vt*or,Et=or*Ct-Lt*mr,St=mr*vt-Ct*wt,Ft=Ie*rr+Ge*Et+Pe*St;if(Fr>0){if(Ft<0||sr+Ft>Fr)continue}else if(Ft>0||sr+Ft<Fr)continue;const zt=(jt*rr+$t*Et+Wt*St)/Fr;zt>=0&&Ce(zt,ie(Ct,vt,Lt,jt,$t,Wt,se),Me,!1)}}(be,Se,ye,ve,xe,ze,Ke,We,Ce);const Be=ze.data,Fe=ze.stride||ze.size,je=be[0],Re=be[1],He=be[2],Ie=Se[0]-je,Ge=Se[1]-Re,Pe=Se[2]-He;for(let Le=ye,Me=3*ye;Le<ve;++Le){let Ne=Fe*xe[Me++],Xe=Be[Ne++],Ye=Be[Ne++],Je=Be[Ne];Ne=Fe*xe[Me++];let rt=Be[Ne++],tt=Be[Ne++],et=Be[Ne];Ne=Fe*xe[Me++];let qe=Be[Ne++],ot=Be[Ne++],ut=Be[Ne];(0,G.pC)(We)&&([Xe,Ye,Je]=We.applyToVertex(Xe,Ye,Je,Le),[rt,tt,et]=We.applyToVertex(rt,tt,et,Le),[qe,ot,ut]=We.applyToVertex(qe,ot,ut,Le));const _t=rt-Xe,Ct=tt-Ye,vt=et-Je,Lt=qe-Xe,jt=ot-Ye,$t=ut-Je,Wt=Ge*$t-jt*Pe,pr=Pe*Lt-$t*Ie,gr=Ie*jt-Lt*Ge,ar=_t*Wt+Ct*pr+vt*gr;if(Math.abs(ar)<=Number.EPSILON)continue;const Fr=je-Xe,mr=Re-Ye,wt=He-Je,or=Fr*Wt+mr*pr+wt*gr;if(ar>0){if(or<0||or>ar)continue}else if(or>0||or<ar)continue;const sr=mr*vt-Ct*wt,rr=wt*_t-vt*Fr,Et=Fr*Ct-_t*mr,St=Ie*sr+Ge*rr+Pe*Et;if(ar>0){if(St<0||or+St>ar)continue}else if(St>0||or+St<ar)continue;const Ft=(Lt*sr+jt*rr+$t*Et)/ar;Ft>=0&&Ce(Ft,ie(_t,Ct,vt,Lt,jt,$t,se),Le,!1)}}const Y=(0,Q.c)(),ee=(0,Q.c)();function ie(be,Se,ye,ve,xe,ze,Ke){return(0,Z.s)(Y,be,Se,ye),(0,Z.s)(ee,ve,xe,ze),(0,Z.f)(Ke,Y,ee),(0,Z.n)(Ke,Ke),Ke}function J(be,Se,ye){return(0,Z.s)(ye,1/(Se[0]-be[0]),1/(Se[1]-be[1]),1/(Se[2]-be[2]))}function ce(be,Se,ye,ve){return ue(be,Se,ye,ve,1/0)}function ue(be,Se,ye,ve,xe){const ze=(be[0]-ve-Se[0])*ye[0],Ke=(be[3]+ve-Se[0])*ye[0];let We=Math.min(ze,Ke),Ce=Math.max(ze,Ke);const Be=(be[1]-ve-Se[1])*ye[1],Fe=(be[4]+ve-Se[1])*ye[1];if(Ce=Math.min(Ce,Math.max(Be,Fe)),Ce<0||(We=Math.max(We,Math.min(Be,Fe)),We>Ce))return!1;const je=(be[2]-ve-Se[2])*ye[2],Re=(be[5]+ve-Se[2])*ye[2];return Ce=Math.min(Ce,Math.max(je,Re)),!(Ce<0)&&(We=Math.max(We,Math.min(je,Re)),!(We>Ce)&&We<xe)}function pe(be,Se,ye,ve,xe){let ze=(ye.screenLength||0)*be.pixelRatio;(0,G.pC)(xe)&&(ze=(0,B.bA)(ze,ve,Se,xe));const Ke=ze*Math.tan(.5*be.fovY)/(.5*be.fullHeight);return(0,R.uZ)(Ke*Se,ye.minWorldLength||0,null!=ye.maxWorldLength?ye.maxWorldLength:1/0)}function he(be,Se){const ye=Se?he(Se):{};for(const ve in be){let xe=be[ve];xe&&xe.forEach&&(xe=_e(xe)),null==xe&&ve in ye||(ye[ve]=xe)}return ye}function me(be,Se){let ye=!1;for(const ve in Se){const xe=Se[ve];void 0!==xe&&(Array.isArray(xe)?null===be[ve]?(be[ve]=xe.slice(),ye=!0):(0,D.Vx)(be[ve],xe)&&(ye=!0):be[ve]!==xe&&(ye=!0,be[ve]=xe))}return ye}function ge(be,Se,ye,ve,xe,ze){if(!Se.options.selectionMode)return;const Ke=be.vertexAttributes.get(X.T.POSITION).data,We=be.vertexAttributes.get(X.T.SIZE),Be=ve[0],Fe=ve[1],je=(((We&&We.data[0])+xe)/2+4)*be.screenToWorldRatio;let Re=Number.MAX_VALUE,He=0;for(let Ie=0;Ie<Ke.length-5;Ie+=3){const Ge=Ke[Ie],Pe=Ke[Ie+1],Le=Be-Ge,Me=Fe-Pe,Ne=Ke[Ie+3]-Ge,Xe=Ke[Ie+4]-Pe,Ye=(0,R.uZ)((Ne*Le+Xe*Me)/(Ne*Ne+Xe*Xe),0,1),Je=Ne*Ye-Le,rt=Xe*Ye-Me,tt=Je*Je+rt*rt;tt<Re&&(Re=tt,He=Ie/3)}Re<je*je&&ze(ye.dist,ye.normal,He,!1)}function _e(be){const Se=[];return be.forEach(ye=>Se.push(ye)),Se}const Ee={multiply:1,ignore:2,replace:3,tint:4},De=1e3},42037:(nt,Ae,v)=>{"use strict";v.d(Ae,{NK:()=>re,SW:()=>H,Vs:()=>de,XW:()=>$,ho:()=>ae,s5:()=>oe,xP:()=>se});var D=v(62208),R=v(28347),G=v(60479),Z=v(2282),Q=v(16396);function $(Y,ee,ie,J,ce=1){const ue=ie.typedBuffer,pe=ie.typedBufferStride,he=Y.length;if(J*=pe,1===ce)for(let me=0;me<he;++me)ue[J]=ee[Y[me]],J+=pe;else for(let me=0;me<he;++me){const ge=ee[Y[me]];for(let _e=0;_e<ce;_e++)ue[J]=ge,J+=pe}}function W(Y,ee,ie,J){const ce=ie.typedBuffer,ue=ie.typedBufferStride,pe=Y.length;J*=ue;for(let he=0;he<pe;++he){const me=2*Y[he];ce[J]=ee[me],ce[J+1]=ee[me+1],J+=ue}}function B(Y,ee,ie,J,ce){const ue=ie.typedBuffer,pe=ie.typedBufferStride,he=Y.length;if(J*=pe,null==ce||1===ce)for(let me=0;me<he;++me){const ge=3*Y[me];ue[J]=ee[ge],ue[J+1]=ee[ge+1],ue[J+2]=ee[ge+2],J+=pe}else for(let me=0;me<he;++me){const ge=3*Y[me];for(let _e=0;_e<ce;++_e)ue[J]=ee[ge],ue[J+1]=ee[ge+1],ue[J+2]=ee[ge+2],J+=pe}}function H(Y,ee,ie,J,ce=1){const ue=ie.typedBuffer,pe=ie.typedBufferStride,he=Y.length;if(J*=pe,1===ce)for(let me=0;me<he;++me){const ge=4*Y[me];ue[J]=ee[ge],ue[J+1]=ee[ge+1],ue[J+2]=ee[ge+2],ue[J+3]=ee[ge+3],J+=pe}else for(let me=0;me<he;++me){const ge=4*Y[me];for(let _e=0;_e<ce;++_e)ue[J]=ee[ge],ue[J+1]=ee[ge+1],ue[J+2]=ee[ge+2],ue[J+3]=ee[ge+3],J+=pe}}function ae(Y,ee,ie,J,ce,ue=1){if(!ie)return void B(Y,ee,J,ce,ue);const pe=J.typedBuffer,he=J.typedBufferStride,me=Y.length,ge=ie[0],_e=ie[1],Ee=ie[2],De=ie[4],be=ie[5],Se=ie[6],ye=ie[8],ve=ie[9],xe=ie[10],ze=ie[12],Ke=ie[13],We=ie[14];ce*=he;let Ce=0,Be=0,Fe=0;const je=j(ie)?Re=>{Ce=ee[Re]+ze,Be=ee[Re+1]+Ke,Fe=ee[Re+2]+We}:Re=>{const He=ee[Re],Ie=ee[Re+1],Ge=ee[Re+2];Ce=ge*He+De*Ie+ye*Ge+ze,Be=_e*He+be*Ie+ve*Ge+Ke,Fe=Ee*He+Se*Ie+xe*Ge+We};if(1===ue)for(let Re=0;Re<me;++Re)je(3*Y[Re]),pe[ce]=Ce,pe[ce+1]=Be,pe[ce+2]=Fe,ce+=he;else for(let Re=0;Re<me;++Re){je(3*Y[Re]);for(let He=0;He<ue;++He)pe[ce]=Ce,pe[ce+1]=Be,pe[ce+2]=Fe,ce+=he}}function oe(Y,ee,ie,J,ce,ue=1){if(!ie)return void B(Y,ee,J,ce,ue);const pe=ie,he=J.typedBuffer,me=J.typedBufferStride,ge=Y.length,_e=pe[0],Ee=pe[1],De=pe[2],be=pe[4],Se=pe[5],ye=pe[6],ve=pe[8],xe=pe[9],ze=pe[10],Ke=!(0,R.x)(pe);ce*=me;let Be=0,Fe=0,je=0;const Re=j(pe)?He=>{Be=ee[He],Fe=ee[He+1],je=ee[He+2]}:He=>{const Ie=ee[He],Ge=ee[He+1],Pe=ee[He+2];Be=_e*Ie+be*Ge+ve*Pe,Fe=Ee*Ie+Se*Ge+xe*Pe,je=De*Ie+ye*Ge+ze*Pe};if(1===ue)if(Ke)for(let He=0;He<ge;++He){Re(3*Y[He]);const Ie=Be*Be+Fe*Fe+je*je;if(Ie<.999999&&Ie>1e-6){const Ge=1/Math.sqrt(Ie);he[ce]=Be*Ge,he[ce+1]=Fe*Ge,he[ce+2]=je*Ge}else he[ce]=Be,he[ce+1]=Fe,he[ce+2]=je;ce+=me}else for(let He=0;He<ge;++He)Re(3*Y[He]),he[ce]=Be,he[ce+1]=Fe,he[ce+2]=je,ce+=me;else for(let He=0;He<ge;++He){if(Re(3*Y[He]),Ke){const Ie=Be*Be+Fe*Fe+je*je;if(Ie<.999999&&Ie>1e-6){const Ge=1/Math.sqrt(Ie);Be*=Ge,Fe*=Ge,je*=Ge}}for(let Ie=0;Ie<ue;++Ie)he[ce]=Be,he[ce+1]=Fe,he[ce+2]=je,ce+=me}}function le(Y,ee,ie,J,ce,ue=1){if(!ie)return void H(Y,ee,J,ce,ue);const he=J.typedBuffer,me=J.typedBufferStride,ge=Y.length,_e=ie[0],Ee=ie[1],De=ie[2],be=ie[4],Se=ie[5],ye=ie[6],ve=ie[8],xe=ie[9],ze=ie[10],Ke=!(0,R.x)(ie);if(ce*=me,1===ue)for(let Be=0;Be<ge;++Be){const Fe=4*Y[Be],je=ee[Fe],Re=ee[Fe+1],He=ee[Fe+2],Ie=ee[Fe+3];let Ge=_e*je+be*Re+ve*He,Pe=Ee*je+Se*Re+xe*He,Le=De*je+ye*Re+ze*He;if(Ke){const Me=Ge*Ge+Pe*Pe+Le*Le;if(Me<.999999&&Me>1e-6){const Ne=1/Math.sqrt(Me);Ge*=Ne,Pe*=Ne,Le*=Ne}}he[ce]=Ge,he[ce+1]=Pe,he[ce+2]=Le,he[ce+3]=Ie,ce+=me}else for(let Be=0;Be<ge;++Be){const Fe=4*Y[Be],je=ee[Fe],Re=ee[Fe+1],He=ee[Fe+2],Ie=ee[Fe+3];let Ge=_e*je+be*Re+ve*He,Pe=Ee*je+Se*Re+xe*He,Le=De*je+ye*Re+ze*He;if(Ke){const Me=Ge*Ge+Pe*Pe+Le*Le;if(Me<.999999&&Me>1e-6){const Ne=1/Math.sqrt(Me);Ge*=Ne,Pe*=Ne,Le*=Ne}}for(let Me=0;Me<ue;++Me)he[ce]=Ge,he[ce+1]=Pe,he[ce+2]=Le,he[ce+3]=Ie,ce+=me}}function de(Y,ee,ie,J,ce,ue=1){const pe=J.typedBuffer,he=J.typedBufferStride,me=Y.length;if(ce*=he,ie!==ee.length||4!==ie)if(1!==ue)if(4!==ie)for(let ge=0;ge<me;++ge){const _e=3*Y[ge];for(let Ee=0;Ee<ue;++Ee)pe[ce]=ee[_e],pe[ce+1]=ee[_e+1],pe[ce+2]=ee[_e+2],pe[ce+3]=255,ce+=he}else for(let ge=0;ge<me;++ge){const _e=4*Y[ge];for(let Ee=0;Ee<ue;++Ee)pe[ce]=ee[_e],pe[ce+1]=ee[_e+1],pe[ce+2]=ee[_e+2],pe[ce+3]=ee[_e+3],ce+=he}else{if(4===ie){for(let ge=0;ge<me;++ge){const _e=4*Y[ge];pe[ce]=ee[_e],pe[ce+1]=ee[_e+1],pe[ce+2]=ee[_e+2],pe[ce+3]=ee[_e+3],ce+=he}return}for(let ge=0;ge<me;++ge){const _e=3*Y[ge];pe[ce]=ee[_e],pe[ce+1]=ee[_e+1],pe[ce+2]=ee[_e+2],pe[ce+3]=255,ce+=he}}else{pe[ce]=ee[0],pe[ce+1]=ee[1],pe[ce+2]=ee[2],pe[ce+3]=ee[3];const ge=new Uint32Array(J.typedBuffer.buffer,J.start),_e=he/4,Ee=ge[ce/=4];ce+=_e;const De=me*ue;for(let be=1;be<De;++be)ge[ce]=Ee,ce+=_e}}function se(Y,ee,ie,J,ce=1){const ue=ee.typedBuffer,pe=ee.typedBufferStride;if(J*=pe,1===ce)for(let he=0;he<ie;++he)ue[J]=Y[0],ue[J+1]=Y[1],ue[J+2]=Y[2],ue[J+3]=Y[3],J+=pe;else for(let he=0;he<ie;++he)for(let me=0;me<ce;++me)ue[J]=Y[0],ue[J+1]=Y[1],ue[J+2]=Y[2],ue[J+3]=Y[3],J+=pe}function re(Y,ee,ie,J,ce,ue){for(const pe of ee.fieldNames){const he=Y.vertexAttributes.get(pe),me=Y.indices.get(pe);if(he&&me)switch(pe){case Q.T.POSITION:{(0,Z.hu)(3===he.size);const ge=ce.getField(pe,G.ct);ge&&ae(me,he.data,ie,ge,ue);break}case Q.T.NORMAL:{(0,Z.hu)(3===he.size);const ge=ce.getField(pe,G.ct);ge&&oe(me,he.data,J,ge,ue);break}case Q.T.UV0:{(0,Z.hu)(2===he.size);const ge=ce.getField(pe,G.Eu);ge&&W(me,he.data,ge,ue);break}case Q.T.COLOR:{(0,Z.hu)(3===he.size||4===he.size);const ge=ce.getField(pe,G.mc);ge&&de(me,he.data,he.size,ge,ue);break}case Q.T.SYMBOLCOLOR:{(0,Z.hu)(3===he.size||4===he.size);const ge=ce.getField(pe,G.mc);ge&&de(me,he.data,he.size,ge,ue);break}case Q.T.TANGENT:{(0,Z.hu)(4===he.size);const ge=ce.getField(pe,G.ek);ge&&le(me,he.data,J,ge,ue);break}}else if(pe===Q.T.OBJECTANDLAYERIDCOLOR&&(0,D.pC)(Y.objectAndLayerIdColor)&&4===Y.objectAndLayerIdColor.length){const ge=Y.indices.get(Q.T.POSITION);if(ge){const _e=ge.length,Ee=ce.getField(pe,G.mc);se(Y.objectAndLayerIdColor,Ee,_e,ue)}}}}function j(Y){return 1===Y[0]&&0===Y[1]&&0===Y[2]&&0===Y[4]&&1===Y[5]&&0===Y[6]&&0===Y[8]&&0===Y[9]&&1===Y[10]}},54889:(nt,Ae,v)=>{"use strict";v.d(Ae,{Dp:()=>W,z5:()=>$});var D=v(62208);const R={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},G={dash:R.dash,"dash-dot":[...R.dash,...R.dot],dot:R.dot,"long-dash":R["long-dash"],"long-dash-dot":[...R["long-dash"],...R.dot],"long-dash-dot-dot":[...R["long-dash"],...R.dot,...R.dot],none:null,"short-dash":R["short-dash"],"short-dash-dot":[...R["short-dash"],...R["short-dot"]],"short-dash-dot-dot":[...R["short-dash"],...R["short-dot"],...R["short-dot"]],"short-dot":R["short-dot"],solid:null};function $(H,X=2){return{pattern:[H,H],pixelRatio:X}}function W(H){return(0,D.pC)(H)&&"style"===H.type?function B(H){return(0,D.pC)(H)?function Q(H,X=2){return(0,D.Wi)(H)?H:{pattern:H.slice(),pixelRatio:X}}(G[H],8):null}(H.style):null}},38516:(nt,Ae,v)=>{"use strict";v.d(Ae,{A:()=>ve});var D=v(88159),R=v(62208),G=v(77029),Z=v(28347),Q=v(43703),$=v(4511),W=v(13934),B=v(32393),H=v(40723),X=v(54840),te=v(2282),ae=v(7949),oe=v(44989);class le{constructor(){this.first=0,this.count=0}}class de{constructor(Le=0,Me=0){this.from=Le,this.to=Me}}class se extends de{constructor(Le,Me,Ne,Xe,Ye,Je){super(Me,Ne),this.id=Le,this.isVisible=Xe,this.hasHighlights=Ye,this.hasOccludees=Je}}function re(Pe){return Array.from(Pe.values()).sort(j)}function j(Pe,Le){return Pe.from===Le.from?Pe.to-Le.to:Pe.from-Le.from}function Y(Pe,Le){const Me=Pe.back();if(null==Me){const Ne=Pe.pushNew();return Ne.first=Le.from,void(Ne.count=Le.to-Le.from)}if(function ee(Pe,Le){return Pe.first+Pe.count>=Le.from}(Me,Le))Me.count=Le.from-Me.first+Le.to-Le.from;else{const Ne=Pe.pushNew();Ne.first=Le.from,Ne.count=Le.to-Le.from}}class ie{constructor(Le,Me){this._pool=Le,this._size=0,this._buffer=Le.newBuffer(ce(Me))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get buffer(){return this._buffer}get size(){return this._size}grow(Le){this._resize(this._size+Le,!0).dispose()}allocate(Le){return this._resize(Le,!1)}_resize(Le,Me){let Ne;const Xe=function ue(Pe,Le,Me){return Le<=Me?Pe>=Me?Pe:ce(Math.max(2*Pe,Me)):Pe<=2*Me?Pe:ce(Me)}(this._buffer.length,this._size,Le);if(this._buffer.length!==Xe){const Je=this._pool.newBuffer(Xe);Me&&(Je.array.set(this._buffer.array.subarray(0,Math.min(this._size,Xe))),Je.vao.vertexBuffers.geometry.setSubData(Je.array,0,0,Je.array.length)),Ne=this._buffer,this._buffer=Je}const Ye=this._size;return this._size=Le,Ne?{dispose:()=>{Ne.array.fill(0,0,Ye),this._pool.deleteBuffer(Ne)},copy:(Je,rt,tt)=>this._buffer.array.set(Ne.array.subarray(rt,tt),Je),hasNewBuffer:!0}:{dispose:()=>{},copy:(Je,rt,tt)=>{Je!==rt&&this._buffer.array.copyWithin(Je,rt,tt)},hasNewBuffer:!1}}erase(Le,Me){this._buffer.array.fill(0,Le,Me)}}const J=65536;function ce(Pe){return Math.ceil(Pe/J)*J}var pe=v(1036),he=v(86236),me=v(15197),ge=v(83994),_e=v(67969);class Ee{constructor(Le,Me,Ne,Xe){this.vao=new me.U(Le,Me,{geometry:Ne},{geometry:ge.f.createVertex(Le,_e.l1.STATIC_DRAW)}),this.array=new Float32Array(Xe),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const De=pe.an+1;class be{constructor(Le,Me,Ne){this._rctx=Le,this._locations=Me,this._layout=Ne,this._cache=Le.newCache(`MergedRenderer pool ${(0,he.D)()}`,Se)}dispose(){this._cache.destroy()}newBuffer(Le){const Me=Le.toString(),Ne=this._cache.pop(Me);if((0,R.pC)(Ne)){const Xe=Ne.pop();return Ne.length>0&&this._cache.put(Me,Ne,Xe.array.byteLength*Ne.length,De),Xe}return new Ee(this._rctx,this._locations,this._layout,Le)}deleteBuffer(Le){const Me=Le.array.byteLength,Ne=Le.array.length.toString(),Xe=this._cache.pop(Ne);return(0,R.pC)(Xe)?(Xe.push(Le),this._cache.put(Ne,Xe,Me*Xe.length,-1)):this._cache.put(Ne,[Le],Me,-1),null}}function Se(Pe,Le){if(Le===pe.lN.ALL)return void Pe.forEach(Xe=>Xe.dispose());const Me=Pe.pop(),Ne=Pe.length*Me.array.byteLength;return Me.dispose(),Ne}var ye=v(65073);class ve{constructor(Le,Me,Ne){this._rctx=Le,this._materialRepository=Me,this._material=Ne,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new G.Z,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new B.p(this._material,this._materialRepository),this._bufferWriter=Ne.createBufferWriter(),this._bufferPool=new be(Le,Ne.vertexAttributeLocations,(0,$.K)(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(Le=>Le.geometry.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof oe.H}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==H.yD.Occlude}modify(Le){this._updateGeometries(Le.updates),this._addAndRemoveGeometries(Le.adds,Le.removes),this._updateDrawCommands()}_addAndRemoveGeometries(Le,Me){const Ne=this._bufferWriter,Xe=Ne.vertexBufferLayout.stride/4,Ye=this._dataByOrigin,Je=function ze(Pe,Le){const Me=new Map;for(const Ne of Pe)Ke(Me,Ne,!0);for(const Ne of Le)Ke(Me,Ne,!1);return Me}(Le,Me);Je.forEach((rt,tt)=>{Je.delete(tt);const et=rt.add.reduce((jt,$t)=>jt+Ne.elementCount($t.data),0);let qe=Ye.get(tt);if(null==qe)(0,te.hu)(0===rt.remove.length),qe=new Fe(rt.origin,new ie(this._bufferPool,et*Xe)),Ye.set(tt,qe);else if(0===rt.add.length&&qe.instances.size===rt.remove.length)return qe.geometry.dispose(),void Ye.delete(tt);let ot=0;qe.instances.forEach(jt=>ot+=jt.to-jt.from);const ut=rt.remove.reduce((jt,$t)=>jt+Ne.elementCount($t.data),0),_t=qe.geometry.size,Ct=(ot+et-ut)*Xe,vt=Re;if(Ct>J&&(Ct<_t/2||_t-Ct>1048576)?this._removeAndRebuild(qe,rt.remove,Xe,Ct,vt):rt.remove.length>0&&this._remove(qe,rt.remove,Xe,vt),rt.add.length>0){const jt=He;(0,te.u_)(jt,-rt.origin[0],-rt.origin[1],-rt.origin[2]),this._add(qe,rt.add,Xe,jt,vt)}const Lt=qe.geometry.buffer.vao.vertexBuffers.geometry;Be(vt),vt.forAll(({from:jt,to:$t})=>{jt<$t&&Lt.setSubData(qe.geometry.buffer.array,jt,jt,$t)}),vt.clear(),qe.drawCommandsDirty=!0})}_updateGeometries(Le){const Me=this._bufferWriter,Ne=Me.vertexBufferLayout.stride/4;for(const Xe of Le){const Ye=Xe.renderGeometry,Je=this._dataByOrigin.get(Ye.origin.id),rt=Je&&Je.instances.get(Ye.id);if(!rt)return;const tt=Xe.updateType;if(tt&X.$.VISIBILITIES&&(rt.isVisible=Ye.instanceParameters.visible),tt&(X.$.HIGHLIGHTS|X.$.VISIBILITIES)){const et=Ye.instanceParameters.visible;rt.hasHighlights=!!Ye.instanceParameters.highlights&&et}if(tt&X.$.OCCLUDEES&&(rt.hasOccludees=!!Ye.instanceParameters.occludees),tt&(X.$.VERTEXATTRS|X.$.TRANSFORMATION)){const{array:et,vao:qe}=Je.geometry.buffer;(0,ye.bZ)(Ye,Ie,Ge),Me.write(Ie,Ge,Ye.data,Me.vertexBufferLayout.createView(et.buffer),rt.from),(0,te.hu)(rt.from+Me.elementCount(Ye.data)===rt.to,"material VBO layout has changed"),qe.vertexBuffers.geometry.setSubData(et,rt.from*Ne,rt.from*Ne,rt.to*Ne)}Je.drawCommandsDirty=!0}}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(Me=>{Me.hasHiddenInstances=!1,Me.hasHighlights=!1,Me.hasOccludees=!1,(0,D.oE)(Me.instances,Ne=>(Ne.isVisible?(Ne.hasHighlights&&(this._hasHighlights=!0,Me.hasHighlights=!0),Ne.hasOccludees&&(this._hasOccludees=!0,Me.hasOccludees=!0)):Me.hasHiddenInstances=!0,Me.hasHiddenInstances&&Me.hasHighlights&&Me.hasOccludees))}),this._dataByOrigin.forEach(Me=>{Me.drawCommandsDirty&&((Me=>{if(Me.drawCommandsDefault.clear(),Me.drawCommandsHighlight.clear(),Me.drawCommandsOccludees.clear(),Me.drawCommandsShadowHighlightRest.clear(),0===Me.instances.size)return;if(!We(Me)){const Xe=Me.drawCommandsDefault.pushNew();return Xe.first=1/0,Xe.count=0,Me.instances.forEach(Ye=>{Xe.first=Math.min(Xe.first,Ye.from),Xe.count=Math.max(Xe.count,Ye.to)}),void(Xe.count-=Xe.first)}const Ne=re(Me.instances);for(const Xe of Ne)Xe.isVisible&&(Y(Xe.hasOccludees?Me.drawCommandsOccludees:Me.drawCommandsDefault,Xe),Y(Xe.hasHighlights?Me.drawCommandsHighlight:Me.drawCommandsShadowHighlightRest,Xe))})(Me),Me.drawCommandsDirty=!1)})}updateAnimation(Le){return this._material.update(Le)}requiresSlot(Le,Me){return this._material.requiresSlot(Le,Me)}render(Le,Me){if(!this.requiresSlot(Me.slot,Le))return!1;const Ne=Le===W.H.Highlight||Le===W.H.ShadowHighlight;if(Ne&&!this._hasHighlights)return!1;const Xe=Le===W.H.ShadowExludeHighlight,Ye=!(Ne||Xe);if(this._dataByOrigin.forEach(qe=>{if(Ne&&!qe.hasHighlights)return;const ot=(Ne?qe.drawCommandsHighlight:Xe&&We(qe)?qe.drawCommandsShadowHighlightRest:qe.drawCommandsDefault)||null,ut=Ye&&qe.drawCommandsOccludees||null;(ot?.length||ut?.length)&&this._renderCommandData.push(new je(qe.origin,qe.geometry,ot,ut))}),0===this._renderCommandData.length)return!1;const Je=this._rctx,rt=this._glMaterials.load(Je,Me.slot,Le);if((0,R.Wi)(rt))return this._renderCommandData.clear(),!1;const tt=rt.beginSlot(Me),et=Je.bindTechnique(tt,this._material.parameters,Me);return this._renderCommandData.forAll(qe=>{et.bindDraw(qe,Me,this._material.parameters);const{geometry:ot,renderCommands:ut,occludeeCommands:_t}=qe;tt.ensureAttributeLocations(ot.buffer.vao),Je.bindVAO(ot.buffer.vao);const Ct=tt.primitiveType;(0,R.pC)(ut)&&ut.length>0&&(tt.bindPipelineState(Je,Me.slot,!1),ut.forAll(vt=>Je.drawArrays(Ct,vt.first,vt.count))),(0,R.pC)(_t)&&_t.length>0&&(tt.bindPipelineState(Je,Me.slot,!0),_t.forAll(vt=>Je.drawArrays(Ct,vt.first,vt.count)))}),this._renderCommandData.clear(),!0}_removeAndRebuild(Le,Me,Ne,Xe,Ye){for(const qe of Me)Le.instances.delete(qe.id);const Je=re(Le.instances);Le.instances.clear();const rt=Le.geometry.size,tt=Le.geometry.allocate(Xe);let et=0;for(const qe of Je){const ot=qe.from*Ne,ut=qe.to*Ne;tt.copy(et,ot,ut),qe.from=et/Ne,et+=ut-ot,qe.to=et/Ne,Le.instances.set(qe.id,qe)}Ye.push(new de(0,tt.hasNewBuffer?Le.geometry.buffer.array.length:rt)),tt.dispose(),Le.geometry.erase(et,Ye.back().to),Le.holes.clear()}_remove(Le,Me,Ne,Xe){for(const Ye of Me){const Je=Ye.id,rt=Le.instances.get(Je),tt=rt.from*Ne,et=rt.to*Ne;Le.geometry.erase(tt,et),Le.holes.push(new de(rt.from,rt.to)),Le.instances.delete(Je),Xe.push(new de(tt,et))}Be(Le.holes)}_add(Le,Me,Ne,Xe,Ye){if(0===Me.length)return;const Je=this._bufferWriter;let rt=Je.vertexBufferLayout.createView(Le.geometry.buffer.array.buffer);const tt=Le.holes.length>0;let et=Number.MAX_SAFE_INTEGER,qe=Number.MIN_SAFE_INTEGER;for(const ot of Me){const ut=(0,R.pC)(ot.transformation)?(0,Z.m)(Ie,Xe,ot.transformation):Xe;(0,Z.a)(Ge,ut);const _t=(0,Z.t)(Ge,Ge),Ct=Je.elementCount(ot.data),vt=Ct*Ne;let Lt=Ce(Le.holes,Ct);(0,R.Wi)(Lt)&&(Lt=Le.geometry.size/Ne,Le.geometry.grow(vt),rt=Je.vertexBufferLayout.createView(Le.geometry.buffer.array.buffer)),Je.write(ut,_t,ot.data,rt,Lt);const jt=ot.instanceParameters.visible,pr=new se(ot.id,Lt,Lt+Ct,jt,!!ot.instanceParameters.highlights&&jt,!!ot.instanceParameters.occludees);(0,te.hu)(null==Le.instances.get(ot.id)),Le.instances.set(ot.id,pr),tt?Ye.push(new de(pr.from*Ne,pr.to*Ne)):(et=Math.min(pr.from,et),qe=Math.max(pr.to,qe))}tt||Ye.push(new de(et*Ne,qe*Ne))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class xe{constructor(Le){this.origin=Le,this.add=new Array,this.remove=new Array}}function Ke(Pe,Le,Me){const Ne=Le.origin;if((0,R.Wi)(Ne))return;let Xe=Pe.get(Ne.id);null==Xe&&(Xe=new xe(Ne.vec3),Pe.set(Ne.id,Xe)),Me?Xe.add.push(Le):Xe.remove.push(Le)}function We(Pe){return Pe.hasOccludees||Pe.hasHighlights||Pe.hasHiddenInstances}function Ce(Pe,Le){let Me;if(!Pe.some(Xe=>!(Xe.to-Xe.from<Le||(Me=Xe,0))))return null;const Ne=Me.from;return Me.from+=Le,Me.from>=Me.to&&Pe.removeUnordered(Me),Ne}function Be(Pe){const Le=new Map;Pe.forAll(Ne=>Le.set(Ne.from,Ne));let Me=!0;for(;Me;)Me=!1,Pe.forEach(Ne=>{const Xe=Le.get(Ne.to);Xe&&(Ne.to=Xe.to,Le.delete(Xe.from),Pe.removeUnordered(Xe),Me=!0)})}class Fe{constructor(Le,Me){this.origin=Le,this.geometry=Me,this.instances=new Map,this.holes=new G.Z({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1,this.drawCommandsDefault=new G.Z({allocator:Ne=>Ne||new le,deallocator:Ne=>Ne}),this.drawCommandsHighlight=new G.Z({allocator:Ne=>Ne||new le,deallocator:Ne=>Ne}),this.drawCommandsOccludees=new G.Z({allocator:Ne=>Ne||new le,deallocator:Ne=>Ne}),this.drawCommandsShadowHighlightRest=new G.Z({allocator:Ne=>Ne||new le,deallocator:Ne=>Ne})}}class je extends ae.w{constructor(Le,Me,Ne,Xe){super(Le),this.geometry=Me,this.renderCommands=Ne,this.occludeeCommands=Xe}}const Re=new G.Z({deallocator:null}),He=(0,Q.c)(),Ie=(0,Q.c)(),Ge=(0,Q.c)()},65073:(nt,Ae,v)=>{"use strict";v.d(Ae,{EE:()=>X,PD:()=>B,U_:()=>W,bZ:()=>H,lr:()=>$});var D=v(62208),R=v(28347),G=v(43703),Z=v(2282),Q=v(2757);function $(le,de){return(0,D.Wi)(le)&&(le=[]),le.push(de),le}function W(le,de){if((0,D.Wi)(le))return null;const se=le.filter(re=>re!==de);return 0===se.length?null:se}function B(le){return!!(0,D.pC)(le)&&!le.visible}function H(le,de,se){const re=le.origin.vec3;(0,Z.u_)(oe,-re[0],-re[1],-re[2]),(0,D.pC)(le.transformation)?(0,R.m)(de,oe,le.transformation):(0,R.c)(de,oe),(0,R.a)(se,de),(0,R.t)(se,se)}function X(le,de,se,re,j){te[0]=le.get(de,0),te[1]=le.get(de,1),te[2]=le.get(de,2),(0,Q.LF)(te,ae,3),se.set(j,0,ae[0]),re.set(j,0,ae[1]),se.set(j,1,ae[2]),re.set(j,1,ae[3]),se.set(j,2,ae[4]),re.set(j,2,ae[5])}const te=new Float64Array(3),ae=new Float32Array(6),oe=(0,G.c)()},39711:(nt,Ae,v)=>{"use strict";v.d(Ae,{Qm:()=>ue,em:()=>ce,tT:()=>pe});var D=v(550),R=v(28093),G=v(4794),Z=v(59617),Q=v(13934),$=v(36603),W=v(21799),B=v(67022),H=v(7228),X=v(651),te=v(91056),ae=v(42743),oe=v(39114),le=v(40723),de=v(88569),se=v(12407),re=v(64127),j=v(44835),Y=v(96160),ee=v(57596),ie=v(67969),J=v(2078);class ce extends W.d4{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=(0,R.f)(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ae.Vr.Back,this.emissiveFactor=(0,R.f)(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=(0,R.f)(.2,.2,.2),this.diffuse=(0,R.f)(.8,.8,.8),this.externalColor=(0,G.f)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,R.c)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,D.c)(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ae.Gv.Less,this.textureAlphaMode=ae.JJ.Blend,this.textureAlphaCutoff=B.F,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=le.yD.Occlude}}class ue extends W.Pf{constructor(){super(...arguments),this.origin=(0,R.c)(),this.slicePlaneLocalOrigin=this.origin}}class pe extends te.A{initializeConfiguration(ge,_e){_e.hasWebGL2Context=ge.rctx.type===ee.zO.WEBGL2,_e.spherical=ge.viewingMode===Z.JY.Global,_e.doublePrecisionRequiresObfuscation=(0,H.I)(ge.rctx),_e.textureCoordinateType=_e.hasColorTexture||_e.hasMetallicRoughnessTexture||_e.hasEmissionTexture||_e.hasOcclusionTexture||_e.hasNormalTexture?$.N.Default:$.N.None,_e.objectAndLayerIdColorInstanced=_e.instanced}initializeProgram(ge){return this._initializeProgram(ge,pe.shader)}_initializeProgram(ge,_e){return new se.$(ge.rctx,_e.get().build(this.configuration),oe.i)}_convertDepthTestFunction(ge){return ge===ae.Gv.Lequal?ie.wb.LEQUAL:ie.wb.LESS}_makePipeline(ge,_e){const Ee=this.configuration,De=ge===j.A.NONE,be=ge===j.A.FrontFace;return(0,J.sm)({blending:Ee.output!==Q.H.Color&&Ee.output!==Q.H.Alpha||!Ee.transparent?null:De?de.wu:(0,de.j7)(ge),culling:(me=Ee,(me.cullFace!==ae.Vr.None||!me.hasSlicePlane&&!me.transparent&&!me.doubleSidedMode)&&(0,J.zp)(Ee.cullFace)),depthTest:{func:(0,de.Bh)(ge,this._convertDepthTestFunction(Ee.customDepthTest))},depthWrite:De||be?Ee.writeDepth&&J.LZ:null,colorWrite:J.BK,stencilWrite:Ee.hasOccludees?re.s3:null,stencilTest:Ee.hasOccludees?_e?re.eD:re.RY:null,polygonOffset:De||be?null:(0,de.je)(Ee.enableOffset)});var me}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(ge,_e){return _e?this._occludeePipelineState:super.getPipelineState(ge,_e)}}pe.shader=new X.J(Y.D,()=>v.e(3907).then(v.bind(v,83907)))},46359:(nt,Ae,v)=>{"use strict";v.d(Ae,{I9:()=>$,PI:()=>B,i5:()=>W});var $,W,H,D=v(17626),R=v(13934),G=v(87601),Z=v(44835),Q=v(41528);(H=$||($={}))[H.Draped=0]="Draped",H[H.Screen=1]="Screen",H[H.World=2]="World",H[H.COUNT=3]="COUNT",function(H){H[H.Center=0]="Center",H[H.Tip=1]="Tip",H[H.COUNT=2]="COUNT"}(W||(W={}));class B extends Q.W{constructor(){super(...arguments),this.output=R.H.Color,this.transparencyPassType=Z.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=$.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=W.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,D._)([(0,G.o)({count:R.H.COUNT})],B.prototype,"output",void 0),(0,D._)([(0,G.o)({count:Z.A.COUNT})],B.prototype,"transparencyPassType",void 0),(0,D._)([(0,G.o)()],B.prototype,"occluder",void 0),(0,D._)([(0,G.o)()],B.prototype,"hasSlicePlane",void 0),(0,D._)([(0,G.o)()],B.prototype,"writeDepth",void 0),(0,D._)([(0,G.o)({count:$.COUNT})],B.prototype,"space",void 0),(0,D._)([(0,G.o)()],B.prototype,"hideOnShortSegments",void 0),(0,D._)([(0,G.o)()],B.prototype,"hasCap",void 0),(0,D._)([(0,G.o)({count:W.COUNT})],B.prototype,"anchor",void 0),(0,D._)([(0,G.o)()],B.prototype,"hasTip",void 0),(0,D._)([(0,G.o)()],B.prototype,"vvSize",void 0),(0,D._)([(0,G.o)()],B.prototype,"vvColor",void 0),(0,D._)([(0,G.o)()],B.prototype,"vvOpacity",void 0),(0,D._)([(0,G.o)()],B.prototype,"hasOccludees",void 0),(0,D._)([(0,G.o)()],B.prototype,"hasMultipassTerrain",void 0),(0,D._)([(0,G.o)()],B.prototype,"cullAboveGround",void 0),(0,D._)([(0,G.o)({constValue:!0})],B.prototype,"hasVvInstancing",void 0),(0,D._)([(0,G.o)({constValue:!0})],B.prototype,"hasSliceTranslatedView",void 0)},39401:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>W,R:()=>$});var $,B,D=v(17626),R=v(13934),G=v(87601),Z=v(44835),Q=v(41528);(B=$||($={}))[B.BUTT=0]="BUTT",B[B.SQUARE=1]="SQUARE",B[B.ROUND=2]="ROUND",B[B.COUNT=3]="COUNT";class W extends Q.W{constructor(){super(...arguments),this.output=R.H.Color,this.capType=$.BUTT,this.transparencyPassType=Z.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,D._)([(0,G.o)({count:R.H.COUNT})],W.prototype,"output",void 0),(0,D._)([(0,G.o)({count:$.COUNT})],W.prototype,"capType",void 0),(0,D._)([(0,G.o)({count:Z.A.COUNT})],W.prototype,"transparencyPassType",void 0),(0,D._)([(0,G.o)()],W.prototype,"occluder",void 0),(0,D._)([(0,G.o)()],W.prototype,"hasSlicePlane",void 0),(0,D._)([(0,G.o)()],W.prototype,"hasPolygonOffset",void 0),(0,D._)([(0,G.o)()],W.prototype,"writeDepth",void 0),(0,D._)([(0,G.o)()],W.prototype,"draped",void 0),(0,D._)([(0,G.o)()],W.prototype,"stippleEnabled",void 0),(0,D._)([(0,G.o)()],W.prototype,"stippleOffColorEnabled",void 0),(0,D._)([(0,G.o)()],W.prototype,"stippleScaleWithLineWidth",void 0),(0,D._)([(0,G.o)()],W.prototype,"stipplePreferContinuous",void 0),(0,D._)([(0,G.o)()],W.prototype,"roundJoins",void 0),(0,D._)([(0,G.o)()],W.prototype,"applyMarkerOffset",void 0),(0,D._)([(0,G.o)()],W.prototype,"vvSize",void 0),(0,D._)([(0,G.o)()],W.prototype,"vvColor",void 0),(0,D._)([(0,G.o)()],W.prototype,"vvOpacity",void 0),(0,D._)([(0,G.o)()],W.prototype,"falloffEnabled",void 0),(0,D._)([(0,G.o)()],W.prototype,"innerColorEnabled",void 0),(0,D._)([(0,G.o)()],W.prototype,"hasOccludees",void 0),(0,D._)([(0,G.o)()],W.prototype,"hasMultipassTerrain",void 0),(0,D._)([(0,G.o)()],W.prototype,"cullAboveGround",void 0),(0,D._)([(0,G.o)()],W.prototype,"wireframe",void 0),(0,D._)([(0,G.o)({constValue:!0})],W.prototype,"stippleRequiresClamp",void 0),(0,D._)([(0,G.o)({constValue:!0})],W.prototype,"stippleRequiresStretchMeasure",void 0),(0,D._)([(0,G.o)({constValue:!0})],W.prototype,"hasVvInstancing",void 0),(0,D._)([(0,G.o)({constValue:!0})],W.prototype,"hasSliceTranslatedView",void 0),(0,D._)([(0,G.o)()],W.prototype,"objectAndLayerIdColorInstanced",void 0)},67093:(nt,Ae,v)=>{"use strict";v.d(Ae,{PR:()=>Q,dz:()=>W});var D=v(993),R=v(4794),G=v(69960),Z=v(17625);class Q extends Z.K{}function W(H){H.uniforms.add(new G.N("resolution",X=>(0,D.s)(B,1/X.colorTexture.descriptor.width,1/X.colorTexture.descriptor.height,X.colorTexture.descriptor.width,X.colorTexture.descriptor.height)))}const B=(0,R.c)()},69828:(nt,Ae,v)=>{"use strict";v.d(Ae,{l:()=>Z,w:()=>G});var G,Q,D=v(17626),R=v(87601);(Q=G||(G={}))[Q.Gradient=0]="Gradient",Q[Q.Threshold=1]="Threshold",Q[Q.COUNT=2]="COUNT";class Z extends R.m{constructor(){super(...arguments),this.visualization=G.Gradient,this.bandsEnabled=!1}}(0,D._)([(0,R.o)({count:G.COUNT})],Z.prototype,"visualization",void 0),(0,D._)([(0,R.o)()],Z.prototype,"bandsEnabled",void 0)},57008:(nt,Ae,v)=>{"use strict";v.d(Ae,{g:()=>B});var D=v(99770),R=v(17625);function G(H){const X=R.H`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;H.code.add(X)}var Z=v(95285),Q=v(91574),$=v(63123);const W=(0,D.f)(.5,-4e-4);function B(H,X){const te=H.vertex;te.include(G),te.constants.add("depthBias","vec2",W),te.uniforms.add(new Z.A("inverseViewport",(ae,oe)=>oe.inverseViewport)),X.legacy?(te.uniforms.add(new $.g("proj",(ae,oe)=>oe.camera.projectionMatrix)),te.code.add(R.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(te.uniforms.add(new Q.c("transformNormalViewFromGlobal",ae=>ae.transformNormalViewFromGlobal)),te.uniforms.add(new $.g("transformProjFromView",ae=>ae.transformProjFromView)),te.code.add(R.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),te.code.add(R.H`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}},98828:(nt,Ae,v)=>{"use strict";v.d(Ae,{S:()=>R});var D=v(17625);function R(G,Z){const Q=G.fragment;Q.constants.add("coverageTestThreshold","float",.01),Q.code.add(Z.antialiasing?D.H`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`:D.H`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}},72175:(nt,Ae,v)=>{"use strict";v.d(Ae,{o:()=>R});var D=v(17625);function R(G,Z){const Q=G.vertex;Z.silhouette?(Q.code.add(D.H`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),Q.code.add(Z.legacy?D.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`:D.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):Q.code.add(D.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}},98412:(nt,Ae,v)=>{"use strict";v.d(Ae,{l:()=>G});var D=v(17625),R=v(73105);function G(Z,Q){const $=Z.vertex;switch(Q.mode){case R.Jb.SKETCH:$.code.add(D.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case R.Jb.MIXED:$.code.add(D.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case R.Jb.SOLID:$.code.add(D.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}},73105:(nt,Ae,v)=>{"use strict";v.d(Ae,{Jb:()=>j,UR:()=>de,lV:()=>se});var j,Y,D=v(35357),R=v(7228),G=v(19278),Z=v(43177),Q=v(77739),$=v(97139),W=v(65787),B=v(17625),H=v(9546),X=v(91574),te=v(63123),ae=v(5864),oe=v(19755),le=v(16396);function de(Y,ee){const ie=Y.vertex;ie.include(G.n),ie.uniforms.add(new W.p("distanceFalloffFactor",J=>J.distanceFalloffFactor)),ie.code.add(B.H`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),ie.uniforms.add((0,ae.F)("componentDataTex",J=>J.componentDataTexture,ee.hasWebGL2Context?oe.D.None:oe.D.InvSize)),Y.attributes.add(le.T.COMPONENTINDEX,"float"),ie.constants.add("componentColorFieldOffset","float",0),ie.constants.add("componentOtherFieldOffset","float",1),ie.constants.add("componentVerticalOffsetFieldOffset","float",2),ie.constants.add("componentFieldCount","float",3),ie.constants.add("lineWidthFractionFactor","float",8),ie.constants.add("extensionLengthOffset","float",128),ie.constants.add("verticalOffsetScale","float",2*D.E_),ie.code.add(B.H`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${(0,Z.w_)(ee,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      vec2 textureCoordinates = vec2(colIndex, rowIndex) + 0.5;

      return textureCoordinates;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${(0,Z.b6)(ee,"componentDataTex","colorIndex")};
      vec4 otherValue = ${(0,Z.b6)(ee,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${(0,Z.b6)(ee,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),ee.legacy?ie.code.add(B.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(ie.uniforms.add(new H.j("transformNormalGlobalFromModel",J=>J.transformNormalGlobalFromModel)),ie.code.add(B.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),ee.silhouette?(Y.attributes.add(le.T.NORMALA,"vec3"),Y.attributes.add(le.T.NORMALB,"vec3"),ie.code.add(B.H`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(Y.attributes.add(le.T.NORMAL,"vec3"),ie.code.add(B.H`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),ee.legacy?ie.code.add(B.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(ie.include(R.$,ee),ie.include(R.$,ee),ie.uniforms.add([new X.c("transformViewFromCameraRelativeRS",J=>J.transformViewFromCameraRelativeRS),new H.j("transformWorldFromModelRS",J=>J.transformWorldFromModelRS),new Q.B("transformWorldFromModelTL",J=>J.transformWorldFromModelTL),new Q.B("transformWorldFromModelTH",J=>J.transformWorldFromModelTH),new $.J("transformWorldFromViewTL",J=>J.transformWorldFromViewTL),new $.J("transformWorldFromViewTH",J=>J.transformWorldFromViewTH)]),ie.code.add(B.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${ee.spherical?B.H`normalize(transformWorldFromModelTL + rotatedModelPosition);`:B.H`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),ie.uniforms.add(new te.g("transformProjFromView",(J,ce)=>ce.camera.projectionMatrix)),ie.code.add(B.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),ie.code.add(B.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function se(Y){return Y.mode===j.SKETCH||Y.mode===j.MIXED}(Y=j||(j={}))[Y.SOLID=0]="SOLID",Y[Y.SKETCH=1]="SKETCH",Y[Y.MIXED=2]="MIXED",Y[Y.COUNT=3]="COUNT"},10967:(nt,Ae,v)=>{"use strict";v.d(Ae,{B:()=>Q});var D=v(2163),R=v(17625),G=v(73105),Z=v(69276);function Q($,W){const B=$.vertex;switch($.include(Z.H,W),W.mode){case G.Jb.SOLID:B.code.add(R.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case G.Jb.SKETCH:B.uniforms.add(new D.p("strokesAmplitude",H=>H.strokesTexture.amplitude)),B.code.add(R.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case G.Jb.MIXED:B.uniforms.add(new D.p("strokesAmplitude",H=>H.strokesTexture.amplitude)),B.code.add(R.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}},82716:(nt,Ae,v)=>{"use strict";v.d(Ae,{N:()=>X});var D=v(19278),R=v(43177),G=v(2163),Z=v(17625),Q=v(5864),$=v(19755),W=v(73105),B=v(69276);function X(te,ae){te.include(B.H,ae);const{vertex:oe,fragment:le}=te;switch((0,W.lV)(ae)&&(oe.uniforms.add((0,Q.F)("strokesTexture",de=>de.strokesTexture.texture,ae.hasWebGL2Context?$.D.None:$.D.InvSize)),oe.uniforms.add([new G.p("strokesLog2Resolution",de=>Math.log2(de.strokesTexture.resolution)),new G.p("strokeVariants",de=>de.strokesTexture.variants)]),te.varyings.add("vStrokeUV","vec2"),le.uniforms.add([new Q.R("strokesTexture",de=>de.strokesTexture.texture),new G.p("strokesNormalizationScale",de=>de.strokesTexture.normalizationScale)]),oe.code.add(Z.H`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${(0,R.w_)(ae,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),te.fragment.include(D.n),le.code.add(Z.H`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),ae.mode){case W.Jb.SOLID:oe.code.add(Z.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),le.code.add(Z.H`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case W.Jb.SKETCH:oe.code.add(Z.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),le.code.add(Z.H`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case W.Jb.MIXED:te.varyings.add("vType","float"),oe.code.add(Z.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),le.code.add(Z.H`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}},69276:(nt,Ae,v)=>{"use strict";v.d(Ae,{H:()=>Q});var D=v(94573),R=v(17625),G=v(16396),Z=v(73105);function Q($,W){const B=$.vertex;switch($.attributes.add(G.T.SIDENESS,"vec2"),B.code.add(W.mode===Z.Jb.MIXED?R.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`:R.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),W.mode){case Z.Jb.MIXED:B.code.add(R.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Z.Jb.SKETCH:B.code.add(R.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Z.Jb.SOLID:B.code.add(R.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Z.Jb.COUNT:break;default:(0,D.Bg)(W.mode)}}},59617:(nt,Ae,v)=>{"use strict";var D,Z;function R(Z){return"global"===Z?D.Global:D.Local}function G(Z){return Z===D.Global?"global":"local"}v.d(Ae,{JY:()=>D,M7:()=>G,wg:()=>R}),(Z=D||(D={}))[Z.Global=1]="Global",Z[Z.Local=2]="Local"},85112:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{t:()=>D}),(R=D||(D={}))[R.Left=0]="Left",R[R.Middle=1]="Middle",R[R.Right=2]="Right"},35216:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>Z});var D=v(63290);class R{constructor(B,H=[]){this.eventType=B,this.keyModifiers=H}matches(B){if(B.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const H=B.modifiers;for(const X of this.keyModifiers)if(!H.has(X))return!1;return!0}}const G=D.Z.getLogger("esri.views.input.InputHandler");class Z{constructor(B){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=B}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const B in this._incoming){const H=this._incoming[B];for(const X of H)this._incomingEventMatches.push(X.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(B=>B.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(B){this._manager?G.error("This InputHandler has already been registered with an InputManager"):(B.setEventCallback(H=>this._handleEvent(H)),B.setUninstallCallback(()=>this._onUninstall()),this._manager=B)}onUninstall(){}registerIncoming(B,H,X){let te;"function"==typeof H?(X=H,te=[]):te=H||[];const ae="string"==typeof B?new R(B,te):B,oe=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},le=re=>{const j=this._incoming[re.match.eventType];if(j){const Y=j.indexOf(re);j.splice(Y,1),oe(),this._manager&&this._manager.updateDependencies()}},de=new Q(ae,X,{onPause:le,onRemove:le,onResume:re=>{const j=this._incoming[re.match.eventType];j&&!j.includes(re)&&(j.push(re),oe(),this._manager&&this._manager.updateDependencies())}});let se=this._incoming[ae.eventType];return se||(se=[],this._incoming[ae.eventType]=se),se.push(de),oe(),this._manager&&this._manager.updateDependencies(),de}registerOutgoing(B){if(this._outgoing[B])throw new Error("There is already a callback registered for this outgoing InputEvent: "+B);const H=new $(B,{onEmit:(X,te,ae,oe)=>{this._manager?.emit(X.eventType,te,ae,oe)},onRemove:X=>{delete this._outgoing[X.eventType],this._manager?.updateDependencies()}});return this._outgoing[B]=H,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),H}startCapturingPointer(B){this._manager?.setPointerCapture(B,!0)}stopCapturingPointer(B){this._manager?.setPointerCapture(B,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):G.error("This InputHandler is not registered with an InputManager")}_handleEvent(B){const H=this._incoming[B.type];if(H)for(const X of H)if(X.match.matches(B)&&(X.callback?.(B),B.shouldStopPropagation()))break}}class Q{constructor(B,H,X){this.match=B,this._callback=H,this._handler=X}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class ${constructor(B,H){this.eventType=B,this._removed=!1,this._handler=H}emit(B,H,X){this._removed||this._handler.onEmit(this,B,H,X)}remove(){this._removed=!0,this._handler.onRemove(this)}}},18547:(nt,Ae,v)=>{"use strict";v.d(Ae,{$:()=>se,f:()=>Y});var D=v(17626),R=v(14517),G=v(63290),Z=v(62208),Q=v(35133),$=v(77712),H=(v(85931),v(90912),v(76898)),X=v(63416),te=v(25441),ae=v(35216);class oe extends ae.a{constructor(J){super(!0),this._onChange=J,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",ce=>{this._update(ce.data)})}_update(J){const ce="touch"===J.native.pointerType?"touch":"mouse",{x:ue,y:pe}=J;ce===this._value&&this._x===ue&&this._y===pe||(this._value=ce,this._x=ue,this._y=pe,this._onChange(ce,ue,pe))}}var le=v(84395);class de extends ae.a{constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new le.f(!1),this._onPointerAdd=({data:J})=>{"touch"===J.pointerType&&(this._activeTouchPointerIds.add(J.native.pointerId),this._update())},this._onPointerRemove=({data:J})=>{"touch"===J.pointerType&&(this._activeTouchPointerIds.delete(J.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}get multiTouchActive(){return this._multiTouchActive.get()}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}}let se=class extends R.Z{constructor(ie){super(ie),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=te.CK,this._latestPointerType="mouse",this._propertiesPool=new X.L({latestPointerLocation:ee},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const ie=Object.keys(this._nameToGroup);for(const J of ie)this.uninstallHandlers(J);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(ie=>ie.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(ie,J,ce=Y.INTERNAL){if(this._nameToGroup[ie])return void G.Z.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+ie+"`");if(0===J.length)return void G.Z.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const ue={name:ie,handlers:J.map(pe=>({handler:pe,active:!0,removed:!1,priorityIndex:0,groupPriority:ce,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[ie]=ue;for(let pe=ue.handlers.length-1;pe>=0;pe--){const he=ue.handlers[pe];this._handlers.push(he),he.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(me,ge,_e,Ee,De)=>{this._emitInputEvent(he.priorityIndex+1,me,ge,_e,De,Ee)},setPointerCapture:(me,ge)=>{this._setPointerCapture(ue,he,me,ge)},setEventCallback:me=>{he.eventCallback=me},setUninstallCallback:me=>{he.uninstallCallback=me},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(ie){const J=this._nameToGroup[ie];J?(J.handlers.forEach(ce=>{ce.removed=!0,ce.uninstallCallback?.()}),delete this._nameToGroup[ie],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):G.Z.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+ie+"`")}hasHandlers(ie){return void 0!==this._nameToGroup[ie]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const ie=new Set,J=new Set;this._handlersPriority=[];for(let ce=this._handlers.length-1;ce>=0;ce--){const ue=this._handlers[ce];ue.priorityIndex=ce,this._handlersPriority.push(ue)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let ce=this._handlersPriority.length-1;ce>=0;ce--){const ue=this._handlersPriority[ce];ue.priorityIndex=ce;let pe=ue.handler.hasSideEffects;if(!pe)for(const he of ue.handler.outgoingEventTypes)if(ie.has(he)){pe=!0;break}if(pe)for(const he of ue.handler.incomingEventMatches){ie.add(he.eventType);for(const me of he.keyModifiers)(0,te.wj)(me)||J.add(me)}ue.active=pe}this._sourceEvents=ie,this._keyModifiers=J,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(ie,J,ce){this._latestPointerType=ie;const ue=this._get("latestPointerLocation");if((0,Z.Wi)(ue)||ue.x!==J||ue.y!==ce){const pe=this._propertiesPool.get("latestPointerLocation");pe.x=J,pe.y=ce,this._set("latestPointerLocation",pe)}}_onEventReceived(ie,J){"pointer-capture-lost"===ie&&this._pointerCaptures.delete(J.native.pointerId),this._updateKeyModifiers(ie,J),this._emitInputEventFromSource(ie,J,null!=this.test.timestamp?this.test.timestamp:J.native?J.native.timestamp:void 0,J.native?J.native.cancelable:void 0)}_updateKeyModifiers(ie,J){if(!J)return;let ce=!1;const ue=()=>{if(!ce){const me=new Set;this._activeKeyModifiers.forEach(ge=>{me.add(ge)}),this._activeKeyModifiers=me,ce=!0}},pe=(me,ge)=>{ge&&!this._activeKeyModifiers.has(me)?(ue(),this._activeKeyModifiers.add(me)):!ge&&this._activeKeyModifiers.has(me)&&(ue(),this._activeKeyModifiers.delete(me))};if("key-down"===ie||"key-up"===ie){const me=J.key;this._keyModifiers.has(me)&&pe(me,"key-down"===ie)}const he=J.native;pe("Alt",!(!he||!he.altKey)),pe("Ctrl",!(!he||!he.ctrlKey)),pe("Shift",!(!he||!he.shiftKey)),pe("Meta",!(!he||!he.metaKey)),pe("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new oe((ie,J,ce)=>this._setLatestPointer(ie,J,ce)),this._multiTouchHandler=new de,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Y.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Y.INTERNAL)}_setPointerCapture(ie,J,ce,ue){const pe=ie.name+"-"+J.priorityIndex,he=this._pointerCaptures.get(ce.pointerId)||new Set;this._pointerCaptures.set(ce.pointerId,he),ue?(he.add(pe),1===he.size&&this.eventSource&&this.eventSource.setPointerCapture(ce,!0)):he.has(pe)&&(he.delete(pe),0===he.size&&(this._pointerCaptures.delete(ce.pointerId),this.eventSource&&this.eventSource.setPointerCapture(ce,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(ie=>!ie.removed),this.updateDependencies()}_emitInputEventFromSource(ie,J,ce,ue){this._emitInputEvent(0,ie,J,ce,ue)}_emitInputEvent(ie,J,ce,ue,pe,he){const me=void 0!==ue?ue:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),_e={event:new re(J,ce,me,he||this._activeKeyModifiers,void 0!==pe&&pe),priorityIndex:ie};this._currentPropagation?this._currentPropagation.events.push(_e):this._doNewPropagation(_e)}_doNewPropagation(ie){this._currentPropagation={events:new Q.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:ie.event.timestamp},this._currentPropagation.events.push(ie),this._continuePropagation()}_continuePropagation(){const ie=(0,Z.s3)(this._currentPropagation);for(;ie.events.length>0;){const{event:J,priorityIndex:ce}=ie.events.pop(),ue=J.data&&J.data.eventId;if(null==ue||!this._stoppedPropagationEventIds.has(ue))for(ie.currentHandler=this._handlersPriority[ce];ie.currentHandler;){if(ie.currentHandler.removed)ie.needsHandlerGarbageCollect=!0;else{if(ie.currentHandler.active&&!J.shouldStopPropagation()&&ie.currentHandler.eventCallback?.(J),J.shouldStopPropagation()){null!=ue&&this._stoppedPropagationEventIds.add(ue);break}if(J.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:J,priorityIndex:ie.currentHandler.priorityIndex+1})}ie.currentHandler=this._handlersPriority[ie.currentHandler.priorityIndex+1]}}ie.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(ie){const J=new Q.Z;J.push(ie);const ce=this._currentPropagation;if(ce){for(;ce.events.length;)J.push(ce.events.pop());ce.events=J,ce.currentHandler=null}}_compareHandlerPriority(ie,J){if(ie.handler.hasSideEffects!==J.handler.hasSideEffects)return ie.handler.hasSideEffects?1:-1;if(ie.groupPriority!==J.groupPriority)return ie.groupPriority>J.groupPriority?-1:1;for(const ce of ie.handler.incomingEventMatches)for(const ue of J.handler.incomingEventMatches){if(ce.eventType!==ue.eventType)continue;const pe=ce.keyModifiers.filter(he=>ue.keyModifiers.includes(he));if(pe.length===ce.keyModifiers.length!=(pe.length===ue.keyModifiers.length))return ce.keyModifiers.length>ue.keyModifiers.length?-1:1}return ie.priorityIndex>J.priorityIndex?-1:1}_sortHandlersPriority(ie){const J=[];for(const ce of ie){let ue=0;for(;ue<J.length&&this._compareHandlerPriority(ce,J[ue])>=0;)ue++;J.splice(ue,0,ce)}return J}get debug(){const ie=J=>{const ce=this._setPointerCapture;this._setPointerCapture=()=>{},J(),this._setPointerCapture=ce};return{injectEvent:(J,ce)=>{ie(()=>{this._onEventReceived(J,ce)})},disablePointerCapture:ie}}};(0,D._)([(0,$.Cb)({readOnly:!0})],se.prototype,"hasPendingInputs",null),(0,D._)([(0,$.Cb)({constructOnly:!0})],se.prototype,"eventSource",void 0),(0,D._)([(0,$.Cb)({constructOnly:!0})],se.prototype,"recognizers",void 0),(0,D._)([(0,$.Cb)()],se.prototype,"_latestPointerType",void 0),(0,D._)([(0,$.Cb)()],se.prototype,"latestPointerType",null),(0,D._)([(0,$.Cb)()],se.prototype,"multiTouchActive",null),(0,D._)([(0,$.Cb)({readOnly:!0})],se.prototype,"latestPointerLocation",void 0),se=(0,D._)([(0,H.j)("esri.views.input.InputManager")],se);class re{constructor(J,ce,ue,pe,he){this.type=J,this.data=ce,this.timestamp=ue,this.modifiers=pe,this.cancelable=he,this._propagationState=j.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=j.STOPPED}shouldStopPropagation(){return 0!=(this._propagationState&j.STOPPED)}async(J){this._propagationState|=j.PAUSED;const ce=(ue,pe)=>{this._propagationState&=~j.PAUSED;const he=this._resumeCallback;if(this._resumeCallback=null,he&&he(),pe)throw ue;return ue};return("function"==typeof J?J():J).then(ue=>ce(ue,!1),ue=>ce(ue,!0))}shouldPausePropagation(J){return!!(this._propagationState&j.PAUSED)&&(this._resumeCallback=J,!0)}preventDefault(){this.data.native.preventDefault()}}var j,ie;(ie=j||(j={}))[ie.NONE=0]="NONE",ie[ie.STOPPED=1]="STOPPED",ie[ie.PAUSED=2]="PAUSED";const Y={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class ee{}},45458:(nt,Ae,v)=>{"use strict";v.d(Ae,{CE:()=>te,uS:()=>W}),v(8314);var R=v(21286),G=v(23841),Z=v(35216),Q=v(18547);v(85112);const W=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],B={};function H(oe){return!!B[oe]}W.forEach(oe=>{B[oe]=!0});class te{constructor(le){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=le,this.inputManager=null}connect(le){le&&this.disconnect(),this.inputManager=le,this._handlers.forEach(({handler:de,priority:se},re)=>this.inputManager.installHandlers(re,[de],se))}disconnect(){this.inputManager&&this._handlers.forEach((le,de)=>this.inputManager.uninstallHandlers(de)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(le,de,se,re){const j=Array.isArray(le)?le:le.split(",");if(!function X(oe){for(const le of oe)if(!H(le))return!1;return!0}(j))return j.some(H)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let Y,ee;Array.isArray(de)?ee=de:(Y=de,ee=[]),"function"==typeof se?Y=se:re=se,re=re??Q.f.DEFAULT;const ie=this._createUniqueGroupName(),J=new ae(this.view,j,ee,Y);this._handlers.set(ie,{handler:J,priority:re});for(const ce of j){const ue=this._handlerCounts.get(ce)||0;this._handlerCounts.set(ce,ue+1)}return this.inputManager&&this.inputManager.installHandlers(ie,[J],re),{remove:()=>this._removeHandler(ie,j)}}hasHandler(le){return!!this._handlerCounts.get(le)}_removeHandler(le,de){if(this._handlers.has(le)){this._handlers.delete(le);for(const se of de){const re=this._handlerCounts.get(se);void 0===re?console.error("Trying to remove handler for event that has no handlers registered: ",se):1===re?this._handlerCounts.delete(se):this._handlerCounts.set(se,re-1)}}this.inputManager&&this.inputManager.uninstallHandlers(le)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class ae extends Z.a{constructor(le,de,se,re){super(!0),this.view=le;for(const j of de)switch(j){case"click":this.registerIncoming("click",se,Y=>re(this._wrapClick(Y)));break;case"double-click":this.registerIncoming("double-click",se,Y=>re(this._wrapDoubleClick(Y)));break;case"immediate-click":this.registerIncoming("immediate-click",se,Y=>re(this._wrapImmediateClick(Y)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",se,Y=>re(this._wrapImmediateDoubleClick(Y)));break;case"hold":this.registerIncoming("hold",se,Y=>re(this._wrapHold(Y)));break;case"drag":this.registerIncoming("drag",se,Y=>{const ee=this._wrapDrag(Y);ee&&re(ee)});break;case"key-down":this.registerIncoming("key-down",se,Y=>re(this._wrapKeyDown(Y)));break;case"key-up":this.registerIncoming("key-up",se,Y=>re(this._wrapKeyUp(Y)));break;case"pointer-down":this.registerIncoming("pointer-down",se,Y=>re(this._wrapPointer(Y,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",se,Y=>re(this._wrapPointer(Y,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",se,Y=>re(this._wrapPointer(Y,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",se,Y=>re(this._wrapPointerDrag(Y)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",se,Y=>re(this._wrapMouseWheel(Y)));break;case"pointer-enter":this.registerIncoming("pointer-enter",se,Y=>re(this._wrapPointer(Y,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",se,Y=>re(this._wrapPointer(Y,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",se,Y=>{re(this._wrapGamepad(Y))});break;case"focus":this.registerIncoming("focus",se,Y=>{re(this._wrapFocus(Y))});break;case"blur":this.registerIncoming("blur",se,Y=>{re(this._wrapBlur(Y))})}}_wrapFocus(le){return{type:"focus",timestamp:le.timestamp,native:le.data.native,cancelable:le.cancelable,stopPropagation:()=>le.stopPropagation(),async:de=>le.async(de),preventDefault:()=>le.preventDefault()}}_wrapBlur(le){return{type:"blur",timestamp:le.timestamp,native:le.data.native,cancelable:le.cancelable,stopPropagation:()=>le.stopPropagation(),async:de=>le.async(de),preventDefault:()=>le.preventDefault()}}_wrapClick(le){const{pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,eventId:ie}=le.data,{cancelable:J,timestamp:ce}=le;return{type:"click",pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,timestamp:ce,screenPoint:(0,G.vW)(j,Y),mapPoint:this._getMapPoint(j,Y),eventId:ie,cancelable:J,stopPropagation:()=>le.stopPropagation(),async:ue=>le.async(ue),preventDefault:()=>le.preventDefault()}}_wrapDoubleClick(le){const{pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,eventId:ie}=le.data,{cancelable:J,timestamp:ce}=le;return{type:"double-click",pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,timestamp:ce,mapPoint:this._getMapPoint(j,Y),eventId:ie,cancelable:J,stopPropagation:()=>le.stopPropagation(),async:ue=>le.async(ue),preventDefault:()=>le.preventDefault()}}_wrapImmediateClick(le){const{pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,eventId:ie}=le.data,J=ee.pointerId,{cancelable:ce,timestamp:ue}=le;return{type:"immediate-click",pointerId:J,pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,timestamp:ue,mapPoint:this._getMapPoint(j,Y),eventId:ie,cancelable:ce,stopPropagation:()=>le.stopPropagation(),async:pe=>le.async(pe),preventDefault:()=>le.preventDefault()}}_wrapImmediateDoubleClick(le){const{pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,eventId:ie}=le.data,J=ee.pointerId,{cancelable:ce,timestamp:ue}=le;return{type:"immediate-double-click",pointerId:J,pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,timestamp:ue,mapPoint:this._getMapPoint(j,Y),eventId:ie,cancelable:ce,stopPropagation:()=>le.stopPropagation(),async:pe=>le.async(pe),preventDefault:()=>le.preventDefault()}}_wrapHold(le){const{pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee}=le.data,{cancelable:ie,timestamp:J}=le;return{type:"hold",pointerType:de,button:se,buttons:re,x:j,y:Y,native:ee,timestamp:J,mapPoint:this._getMapPoint(j,Y),cancelable:ie,stopPropagation:()=>le.stopPropagation(),async:ce=>le.async(ce),preventDefault:()=>le.preventDefault()}}_getMapPoint(le,de){return this.view.toMap((0,G.vW)(le,de),{exclude:[]})}_wrapDrag(le){const de=le.data,{x:se,y:re}=de.center,{action:j,pointerType:Y,button:ee}=de;if("start"===j&&(this._latestDragStart=de),!this._latestDragStart)return;const ie=de.pointer.native,J=de.buttons,{cancelable:ce,timestamp:ue}=le,pe={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return"end"===j&&(this._latestDragStart=void 0),{type:"drag",action:j,x:se,y:re,origin:pe,pointerType:Y,button:ee,buttons:J,radius:de.radius,angle:(0,R.BV)(de.angle),native:ie,timestamp:ue,cancelable:ce,stopPropagation:()=>le.stopPropagation(),async:he=>le.async(he),preventDefault:()=>le.preventDefault()}}_wrapKeyDown(le){const{key:de,repeat:se,native:re}=le.data,{cancelable:j,timestamp:Y}=le;return{type:"key-down",key:de,repeat:se,native:re,timestamp:Y,cancelable:j,stopPropagation:()=>le.stopPropagation(),async:ee=>le.async(ee),preventDefault:()=>le.preventDefault()}}_wrapKeyUp(le){const{key:de,native:se}=le.data,{cancelable:re,timestamp:j}=le;return{type:"key-up",key:de,native:se,timestamp:j,cancelable:re,stopPropagation:()=>le.stopPropagation(),async:Y=>le.async(Y),preventDefault:()=>le.preventDefault()}}_wrapPointer(le,de){const{x:se,y:re,button:j,buttons:Y,native:ee,eventId:ie}=le.data,J=ee.pointerId,ce=ee.pointerType,{cancelable:ue,timestamp:pe}=le;return{type:de,x:se,y:re,pointerId:J,pointerType:ce,button:j,buttons:Y,native:ee,timestamp:pe,eventId:ie,cancelable:ue,stopPropagation:()=>le.stopPropagation(),async:he=>le.async(he),preventDefault:()=>le.preventDefault()}}_wrapPointerDrag(le){const{x:de,y:se,buttons:re,native:j,eventId:Y}=le.data.currentEvent,{button:ee}=le.data.startEvent,ie=le.data.startEvent.native.pointerId,J=le.data.startEvent.native.pointerType,ce=le.data.action,ue={x:le.data.startEvent.x,y:le.data.startEvent.y},{cancelable:pe,timestamp:he}=le;return{type:"pointer-drag",x:de,y:se,pointerId:ie,pointerType:J,button:ee,buttons:re,action:ce,origin:ue,native:j,timestamp:he,eventId:Y,cancelable:pe,stopPropagation:()=>le.stopPropagation(),async:me=>le.async(me),preventDefault:()=>le.preventDefault()}}_wrapMouseWheel(le){const{cancelable:de,data:se,timestamp:re}=le,{x:j,y:Y,deltaY:ee,native:ie}=se;return{type:"mouse-wheel",x:j,y:Y,deltaY:ee,native:ie,timestamp:re,cancelable:de,stopPropagation:()=>le.stopPropagation(),async:J=>le.async(J),preventDefault:()=>le.preventDefault()}}_wrapGamepad(le){const{action:de,state:se,device:re}=le.data,{cancelable:j,timestamp:Y}=le,{buttons:ee,axes:ie}=se;return{type:"gamepad",device:re,timestamp:Y,action:de,buttons:ee,axes:ie,cancelable:j,stopPropagation:()=>le.stopPropagation(),async:J=>le.async(J),preventDefault:()=>le.preventDefault()}}}},25441:(nt,Ae,v)=>{"use strict";v.d(Ae,{CK:()=>G,kK:()=>Q,wj:()=>$});var D=v(17770);const G=(0,v(8314).Z)("mac")?"Meta":"Ctrl",Z={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let W=48;W<58;W++)Z[W]=String.fromCharCode(W);for(let W=1;W<25;W++)Z[111+W]=`F${W}`;for(let W=65;W<91;W++)Z[W]=[String.fromCharCode(W+32),String.fromCharCode(W)];function Q(W){if(void 0!==W.key)return(0,D.kK)(W);const B=Z[W.keyCode];return Array.isArray(B)?W.shiftKey?B[1]:B[0]:B}function $(W){switch(W){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},33786:(nt,Ae,v)=>{"use strict";var D,R,G,Z;v.d(Ae,{Q9:()=>R,bH:()=>D,jg:()=>G}),(Z=D||(D={}))[Z.USER=0]="USER",Z[Z.MANAGER=1]="MANAGER",function(Z){Z[Z.None=0]="None",Z[Z.Unfocused=1]="Unfocused",Z[Z.Focused=2]="Focused",Z[Z.Unselected=4]="Unselected",Z[Z.Selected=8]="Selected",Z[Z.All=15]="All"}(R||(R={})),function(Z){Z[Z.None=0]="None",Z[Z.Custom1=16]="Custom1",Z[Z.Custom2=32]="Custom2",Z[Z.Custom3=64]="Custom3",Z[Z.Custom4=128]="Custom4",Z[Z.Custom5=256]="Custom5",Z[Z.Custom6=512]="Custom6",Z[Z.Custom7=1024]="Custom7",Z[Z.Custom8=2048]="Custom8",Z[Z.Custom9=4096]="Custom9",Z[Z.Custom10=8192]="Custom10",Z[Z.Custom11=16384]="Custom11",Z[Z.Custom12=32768]="Custom12",Z[Z.All=65520]="All"}(G||(G={}))},90478:(nt,Ae,v)=>{"use strict";var D,R;v.d(Ae,{n:()=>D}),(R=D||(D={}))[R.ANIMATING=0]="ANIMATING",R[R.INTERACTING=1]="INTERACTING",R[R.IDLE=2]="IDLE"},87091:(nt,Ae,v)=>{"use strict";v.d(Ae,{G5:()=>me,T8:()=>le,sq:()=>_e,z4:()=>oe});var le,Ee,D=v(72392),R=v(63290),G=v(62208),Z=v(73362),Q=v(77029),$=v(10699),W=v(32917),B=v(27422),H=v(84395),X=v(41291),te=v(66463),ae=v(90478);function oe(){return new pe.Scheduler}(Ee=le||(le={})).RESOURCE_CONTROLLER="schedule",Ee.SLIDE="slide",Ee.STREAM_DATA_LOADER="stream loader",Ee.ELEVATION_QUERY="elevation query",Ee.TERRAIN_SURFACE="terrain",Ee.SURFACE_GEOMETRY_UPDATES="surface geometry updates",Ee.GRAPHICS_CORE="Graphics3D",Ee.I3S_CONTROLLER="I3S",Ee.POINT_CLOUD_LAYER="point cloud",Ee.FEATURE_TILE_FETCHER="feature fetcher",Ee.OVERLAY="overlay",Ee.STAGE="stage",Ee.GRAPHICS_DECONFLICTOR="graphics deconflictor",Ee.FILTER_VISIBILITY="Graphics3D filter visibility",Ee.SCALE_VISIBILITY="Graphics3D scale visibility",Ee.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",Ee.POINT_OF_INTEREST_FREQUENT="POI frequent",Ee.POINT_OF_INTEREST_INFREQUENT="POI infrequent",Ee.LABELER="labeler",Ee.FEATURE_QUERY_ENGINE="feature query",Ee.FEATURE_TILE_TREE="feature tile tree",Ee.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",Ee.ELEVATION_ALIGNMENT="elevation alignment",Ee.TEXT_TEXTURE_ATLAS="text texture atlas",Ee.TEXTURE_UNLOAD="texture unload",Ee.LINE_OF_SIGHT_TOOL="line of sight tool",Ee.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",Ee.ELEVATION_PROFILE="elevation profile",Ee.SNAPPING="snapping",Ee.SHADOW_ACCUMULATOR="shadow accumulator",Ee.CLOUDS_GENERATOR="cloud generator",Ee[Ee.TEST_PRIO=1]="TEST_PRIO";const se=new Map([[le.RESOURCE_CONTROLLER,0],[le.SLIDE,0],[le.STREAM_DATA_LOADER,0],[le.ELEVATION_QUERY,0],[le.TERRAIN_SURFACE,1],[le.SURFACE_GEOMETRY_UPDATES,1],[le.GRAPHICS_CORE,2],[le.I3S_CONTROLLER,2],[le.POINT_CLOUD_LAYER,2],[le.FEATURE_TILE_FETCHER,2],[le.OVERLAY,4],[le.STAGE,4],[le.GRAPHICS_DECONFLICTOR,4],[le.FILTER_VISIBILITY,4],[le.SCALE_VISIBILITY,4],[le.FRUSTUM_VISIBILITY,4],[le.CLOUDS_GENERATOR,4],[le.POINT_OF_INTEREST_FREQUENT,6],[le.POINT_OF_INTEREST_INFREQUENT,30],[le.LABELER,8],[le.FEATURE_QUERY_ENGINE,8],[le.FEATURE_TILE_TREE,16],[le.FEATURE_TILE_TREE_ACTIVE,0],[le.ELEVATION_ALIGNMENT,12],[le.TEXT_TEXTURE_ATLAS,12],[le.TEXTURE_UNLOAD,12],[le.LINE_OF_SIGHT_TOOL,16],[le.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[le.SNAPPING,0],[le.SHADOW_ACCUMULATOR,30]]);function j(Ee){return se.has(Ee)?se.get(Ee):"number"==typeof Ee?Ee:1}const Y=(0,B.HA)(6.5),ee=(0,B.HA)(1),ie=(0,B.HA)(30),J=(0,B.HA)(1e3/30),ce=(0,B.HA)(100);var pe,he;(function(Ee){Ee.Scheduler=class De{constructor(){this._updating=new H.f(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Z.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new Se,this._state=ae.n.INTERACTING,this._tasks=new Q.Z,this._runQueue=new Q.Z,this._load=0,this._idleStateCallbacks=new Q.Z,this._idleUpdatesStartFired=!1,this._maxReschedule=32,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,W.YP)(()=>te.Z.SCHEDULER_LOG_SLOW_TASKS,xe=>this._debug=xe,W.nn);for(const xe of Object.keys(le))this.performanceInfo.tasks.set(le[xe],new Z.Z(le[xe]));const ve=this;this._test={FRAME_SAFETY_BUDGET:Y,INTERACTING_BUDGET:J,IDLE_BUDGET:ce,get availableBudget(){return ve._budget.budget},usedBudget:0,getBudget:()=>ve._budget,setBudget:xe=>ve._budget=xe,updateTask:xe=>this._updateTask(xe),getState:xe=>this._getState(xe),getRuntime:xe=>this._getRuntime(xe),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}get updating(){return this._updating.get()}set updating(ve){this._updating.set(ve)}destroy(){this._tasks.toArray().forEach(ve=>ve.remove()),this._tasks.clear(),(0,G.hw)(this._debugHandle),this._microTaskQueued=!1,this._updating.set(!1)}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=32,this._schedule(),this.frame()))}))}registerTask(ve,xe){const ze=j(ve),Ke=new be(this,ve,xe,ze);return this._tasks.push(Ke),this.performanceInfo.tasks.has(ve)||this.performanceInfo.tasks.set(ve,new Z.Z(ve)),Ke}registerIdleStateCallbacks(ve,xe){const ze={idleBegin:ve,idleEnd:xe};this._idleStateCallbacks.push(ze),this.state===ae.n.IDLE&&this._idleUpdatesStartFired&&ze.idleBegin();const Ke=this;return{remove:()=>this._removeIdleStateCallbacks(ze),set idleBegin(We){Ke._idleUpdatesStartFired&&(ze.idleEnd(),Ke._state===ae.n.IDLE&&We()),ze.idleBegin=We},set idleEnd(We){ze.idleEnd=We}}}get load(){return this._load}set state(ve){this._state!==ve&&(this._state=ve,this.state!==ae.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(xe=>xe.idleEnd())))}get state(){return this._state}updateBudget(ve){this._test.usedBudget=0,++this._frameNumber;let xe=Y,ze=ve.frameDuration,Ke=ee;switch(this.state){case ae.n.IDLE:xe=(0,B.HA)(0),ze=(0,B.HA)(Math.max(ce,ve.frameDuration)),Ke=ie;break;case ae.n.INTERACTING:ze=(0,B.HA)(Math.max(J,ve.frameDuration))}return ze=(0,B.HA)(ze-ve.elapsedFrameTime-xe),this.state!==ae.n.IDLE&&ze<ee&&!this._forceTask?(this._forceTask=!0,!1):(ze=(0,B.HA)(Math.max(ze,Ke)),this._budget.reset(ze,this.state),this._maxReschedule=32,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ae.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(ve=>ve.idleBegin())),this._runIdle();break;case ae.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,B.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(ve){this._idleUpdatesStartFired&&ve.idleEnd(),this._idleStateCallbacks.removeUnordered(ve)}removeTask(ve){this._tasks.removeUnordered(ve),this._runQueue.removeUnordered(ve)}_updateTask(ve){this._tasks.forAll(xe=>{xe.name===ve&&xe.setPriority(ve)})}_getState(ve){if(this._runQueue.some(ze=>ze.name===ve))return he.SCHEDULED;let xe=he.IDLE;return this._tasks.forAll(ze=>{ze.name===ve&&ze.needsUpdate&&(ze.schedulePriority<=1?xe=he.READY:xe!==he.READY&&(xe=he.WAITING))}),xe}_getRuntime(ve){let xe=0;return this._tasks.forAll(ze=>{ze.name===ve&&(xe+=ze.runtime)}),xe}_resetRuntimes(){this._tasks.forAll(ve=>ve.runtime=0)}_getRunning(){const ve=new Map;if(this._tasks.forAll(ze=>{ze.needsUpdate&&ve.set(ze.name,(ve.get(ze.name)||0)+1)}),0===ve.size)return null;let xe="";return ve.forEach((ze,Ke)=>{xe+=ze>1?` ${ze}x ${Ke}`:` ${Ke}`}),xe}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const ve=this._tasks.reduce((xe,ze)=>ze.needsUpdate?++xe:xe,0);this._load=.9*this._load+ve*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(ve=>!!ve.needsUpdate||(ve.schedulePriority=ve.basePriority,!1)),this._tasks.forAll(ve=>{0===ve.basePriority&&ve.needsUpdate&&!this._runQueue.includes(ve)&&this._runQueue.unshift(ve)});0===this._runQueue.length;){let ve=!1,xe=0;if(this._tasks.forAll(ze=>{ze.needsUpdate&&0!==ze.schedulePriority&&0!==ze.basePriority&&(!ze.task.runOncePerFrame||ze.lastFrameRun!==this._frameNumber)&&(ve=!0,xe=Math.max(xe,ze.basePriority),1===ze.schedulePriority?(ze.schedulePriority=0,this._runQueue.push(ze)):--ze.schedulePriority)}),!ve)return this._updating.set(!1),!1;--this._maxReschedule}return this._updating.set(!0),!0}_run(){const ve=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const xe=this._budget.now(),ze=this._runQueue.pop();this._budget.resetProgress();try{ze.task.runTask(this._budget)}catch(We){R.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${ze.name}"`,We)}ze.schedulePriority=ze.basePriority,ze.lastFrameRun=this._frameNumber;const Ke=this._budget.now()-xe;if(ze.runtime+=Ke,this._frameTaskTimes.set(ze.priority,this._frameTaskTimes.get(ze.priority)+Ke),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",ze.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updating.set(this._tasks.some(We=>We.needsUpdate)),void this._recordFrameTaskTimes(this._budget.now()-ve)}}while(this._schedule());this._updating.set(this._tasks.some(xe=>xe.needsUpdate)),this._recordFrameTaskTimes(this._budget.now()-ve)}_startFrameTaskTimes(){for(const ve of Object.keys(le))this._frameTaskTimes.set(le[ve],0)}_recordFrameTaskTimes(ve){this._frameTaskTimes.forEach((xe,ze)=>this.performanceInfo.tasks.get(ze).record(xe)),this.performanceInfo.total.record(ve)}get test(){return this._test}};class be{constructor(ve,xe,ze,Ke){this._scheduler=ve,this.name=xe,this._basePriority=Ke,this.lastFrameRun=0,this.runtime=0,this._queue=new X.b,this._handles=new D.Z,this.schedulePriority=this._basePriority,this._task=new H.f((0,G.pC)(ze)?ze:this._queue),this._handles.add((0,W.gx)(()=>this.task.running,()=>ve.activate()))}get task(){return this._task.get()}get updating(){return this._queue.running}remove(){this.processQueue(me),this._scheduler.removeTask(this),this.schedule=_e.schedule,this.reschedule=_e.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(ve){this.name=ve;const xe=j(ve);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=xe),this._basePriority=xe}get priority(){return this.name}set priority(ve){this.setPriority(ve)}get needsUpdate(){return this.updating||this.task.running}schedule(ve,xe,ze){return this._queue.push(ve,xe,ze)}reschedule(ve,xe,ze){return this._queue.unshift(ve,xe,ze)}processQueue(ve){this._queue.runTask(ve)}}class Se{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=ae.n.IDLE,this._done=!1,this._enabled=!0}run(ve){return!this.done&&(!0===ve()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(ve){this._enabled=ve}reset(ve,xe){this._begin=this.now(),this._budget=ve,this._state=xe,this._done=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=!1}get hasProgressed(){return this._done}}Ee.Budget=Se})(pe||(pe={})),function(Ee){Ee.SCHEDULED="s",Ee.READY="r",Ee.WAITING="w",Ee.IDLE="i"}(he||(he={}));const me=(()=>{const Ee=new pe.Budget;return Ee.enabled=!1,Ee})(),_e=new class ge{remove(){}processQueue(){}schedule(De,be,Se){try{if((0,$.Hc)(be)){const ye=(0,$.zE)();return Se?Promise.resolve(Se(ye)):Promise.reject(ye)}return(0,$.gx)(De(me))}catch(ye){return Promise.reject(ye)}}reschedule(De,be,Se){return this.schedule(De,be,Se)}}},66463:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>B});var D=v(17626),R=v(14517),G=v(77712),$=(v(85931),v(90912),v(76898));let W=class extends R.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,D._)([(0,G.Cb)()],W.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,D._)([(0,G.Cb)()],W.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),W=(0,D._)([(0,$.j)("esri.views.support.DebugFlags")],W);const B=new W},93579:(nt,Ae,v)=>{"use strict";v.d(Ae,{Av:()=>Q,_1:()=>G,lu:()=>$,rs:()=>Z,tl:()=>R});var D=v(62208);function R(W){return W&&"function"==typeof W.highlight}function G(W){return W&&"function"==typeof W.maskOccludee}function Z(W,B,H){return(0,D.Wi)(W)||W>H&&(0===B||W<B)}function Q(W,B){return W>0||B>0}function $(W){const B=W.effectiveScaleRange;return{minScale:B?.minScale??0,maxScale:B?.maxScale??0}}},41900:(nt,Ae,v)=>{"use strict";v.d(Ae,{Eu:()=>Q,Rw:()=>W,Sj:()=>Z,s6:()=>$,vT:()=>G}),v(8314);var R=v(23841);function G(B){return(0,R.vW)(B.x,B.y)}function Z(B){return(0,R.s1)(B.x,B.y)}function Q(B,H){const X=(B instanceof HTMLElement?B:B.surface).getBoundingClientRect();return(0,R.vW)(H.clientX-X.left,H.clientY-X.top)}function $(B,H){return H instanceof Event?Q(B,H):G(H)}function W(B){if(B instanceof Event)return!0;if("object"==typeof B&&"type"in B)switch(B.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},86080:(nt,Ae,v)=>{"use strict";v.d(Ae,{D:()=>G});var D=v(6178),R=v(59617);function G(Z,Q){return null!=Z&&(null==Q||(Q===R.JY.Local?!Z.isGeographic||Z.isWGS84||Z.wkid===D.W.CGCS2000:Z.isWebMercator||Z.isWGS84||Z.wkid===D.W.CGCS2000||Z.wkid===D.W.GCSMARS2000||Z.wkid===D.W.GCSMARS2000_SPHERE||Z.wkid===D.W.GCSMOON2000))}},83994:(nt,Ae,v)=>{"use strict";v.d(Ae,{f:()=>te});var D=v(15861),R=v(85931),G=v(63290),Z=v(62208),Q=v(55713),$=v(68598),W=v(57596),B=v(67969);const H=G.Z.getLogger("esri.views.webgl.BufferObject");class te{constructor(oe,le,de,se){this._context=oe,this.bufferType=le,this.usage=de,this._glName=null,this._size=-1,this._indexType=void 0,oe.instanceCounter.increment(B._g.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,$.zu)(this._context.gl),se&&this.setData(se)}static createIndex(oe,le,de){return new te(oe,B.w0.ELEMENT_ARRAY_BUFFER,le,de)}static createVertex(oe,le,de){return new te(oe,B.w0.ARRAY_BUFFER,le,de)}static createUniform(oe,le,de){if(oe.type!==W.zO.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new te(oe,B.w0.UNIFORM_BUFFER,le,de)}static createPixelPack(oe,le=B.l1.STREAM_READ,de){if(oe.type!==W.zO.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const se=new te(oe,B.w0.PIXEL_PACK_BUFFER,le);return de&&se.setSize(de),se}static createPixelUnpack(oe,le=B.l1.STREAM_DRAW,de){if(oe.type!==W.zO.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new te(oe,B.w0.PIXEL_UNPACK_BUFFER,le,de)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===B.w0.ELEMENT_ARRAY_BUFFER?this._indexType===B.g.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===B.w0.ELEMENT_ARRAY_BUFFER||this.bufferType===B.w0.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(B._g.BufferObject,this),this._context=(0,Z.wN)(this._context)):this._glName&&H.warn("Leaked WebGL buffer object")}setSize(oe,le=null){if(oe<=0&&H.error("Buffer size needs to be positive!"),this.bufferType===B.w0.ELEMENT_ARRAY_BUFFER&&(0,Z.pC)(le))switch(this._indexType=le,le){case B.g.UNSIGNED_SHORT:oe*=2;break;case B.g.UNSIGNED_INT:oe*=4}this._setBufferData(oe)}setData(oe){if(!oe)return;let le=oe.byteLength;this.bufferType===B.w0.ELEMENT_ARRAY_BUFFER&&((0,Q.Uc)(oe)&&(le/=2,this._indexType=B.g.UNSIGNED_SHORT),(0,Q.ZY)(oe)&&(le/=4,this._indexType=B.g.UNSIGNED_INT)),this._setBufferData(le,oe)}_setBufferData(oe,le=null){this._size=oe;const de=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const se=this._context.gl;(0,Z.pC)(le)?se.bufferData(this.bufferType,le,this.usage):se.bufferData(this.bufferType,oe,this.usage),(0,$.zu)(se),this._isVAOAware&&this._context.bindVAO(de)}setSubData(oe,le,de,se){if(!oe)return;(le<0||le>=this._size)&&H.error("offset is out of range!"),de>=se&&H.error("end must be bigger than start!"),le+(se-de)>this._size&&H.error("An attempt to write beyond the end of the buffer!");const re=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const j=this._context.gl;if(this._context.type===W.zO.WEBGL2)j.bufferSubData(this.bufferType,le*oe.BYTES_PER_ELEMENT,oe,de,se-de);else{const Y=0===de&&se===oe.length?oe:oe.subarray(de,se);j.bufferSubData(this.bufferType,le*oe.BYTES_PER_ELEMENT,Y)}(0,$.zu)(j),this._isVAOAware&&this._context.bindVAO(re)}getSubData(oe,le=0,de,se){if(this._context.type!==W.zO.WEBGL2)return void H.error("Get buffer subdata is supported in WebGL2 only!");if(de<0||se<0)return void H.error("Problem getting subdata: offset and length were less than zero!");const re=function X(ae){return(0,R.zG)(ae)}(oe)?oe.BYTES_PER_ELEMENT:1;if(re*((de??0)+(se??0))>oe.byteLength)return void H.error("Problem getting subdata: offset and length exceeded destination size!");le+re*(se??0)>this.byteSize&&H.warn("Potential problem getting subdata: requested data exceeds buffer size!");const j=this._context.gl;this._context.bindBuffer(this,B.w0.COPY_READ_BUFFER),j.getBufferSubData(B.w0.COPY_READ_BUFFER,le,oe,de,se),this._context.unbindBuffer(B.w0.COPY_READ_BUFFER)}getSubDataAsync(oe,le=0,de,se){var re=this;return(0,D.Z)(function*(){re._context.type===W.zO.WEBGL2?(yield re._context.clientWaitAsync(),re.getSubData(oe,le,de,se)):H.error("Get buffer subdata is supported in WebGL2 only!")})()}}},85775:(nt,Ae,v)=>{"use strict";v.d(Ae,{X:()=>te});var D=v(15861),R=v(63290),G=v(62208),Z=v(83994),Q=v(68598),$=v(57596),W=v(67969),B=v(49266),H=v(55086),X=v(26906);class te{constructor(ee,ie,J=null,ce=null){if(this._context=ee,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...ie},ee.instanceCounter.increment(W._g.FramebufferObject,this),(0,G.pC)(J)){Array.isArray(J)||(J=[J]);for(let ue=0;ue<J.length;++ue){const pe=J[ue],he=W.VY.COLOR_ATTACHMENT0+ue;let me;le(pe)?(ae(pe)?(me=pe.descriptor,this._colorAttachments.set(he,pe)):(me=pe,this._colorAttachments.set(he,new H.x(this._context,me))),se(me,this._desc)):(oe(pe)?(me=pe.descriptor,this._colorAttachments.set(he,pe)):(me=pe,this._colorAttachments.set(he,new B.r(this._context,me))),re(me,this._desc)),this._validateColorAttachmentPoint(he)}}if((0,G.pC)(ce)){let ue,pe;if(le(ce))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),ae(ce)?(pe=ce.descriptor,this._depthStencilTexture=ce):(pe=ce,this._depthStencilTexture=new H.x(this._context,pe)),se(pe,this._desc);else{oe(ce)?(pe=ce.descriptor,ue=ce):(pe=ce,ue=new B.r(this._context,pe));const he=this._desc.depthStencilTarget??W.OU.DEPTH_STENCIL_RENDER_BUFFER;he===W.OU.STENCIL_RENDER_BUFFER?this._stencilAttachment=ue:he===W.OU.DEPTH_RENDER_BUFFER||he===W.OU.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=ue:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=he,re(pe,this._desc)}}}dispose(){if(!this._desc)return;const ee=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(ee),this._context.instanceCounter.decrement(W._g.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const ee=this._colorAttachments.get(W.VY.COLOR_ATTACHMENT0);return ee&&ae(ee)?ee:null}get colorAttachment(){return this._colorAttachments.get(W.VY.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((ee,[ie,J])=>ee+(0,X.un)(J),0)+(0,X.un)(this.depthStencilAttachment)}getColorTexture(ee){const ie=this._colorAttachments.get(ee);return ie&&ae(ie)?ie:null}attachColorTexture(ee,ie=W.VY.COLOR_ATTACHMENT0){!ee||(this._validateColorAttachmentPoint(ie),se(ee.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(ee.glName,ie)),this._colorAttachments.set(ie,ee))}detachColorTexture(ee=W.VY.COLOR_ATTACHMENT0){const ie=this._colorAttachments.get(ee);if(ae(ie)){const J=ie;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ee)),this._colorAttachments.delete(ee),J}}setColorTextureTarget(ee,ie=W.VY.COLOR_ATTACHMENT0){const J=this._colorAttachments.get(ie);ae(J)&&this._framebufferTexture2D(J.glName,ie,ee)}attachDepthStencilTexture(ee){if((0,G.Wi)(ee))return;const ie=ee.descriptor;ie.pixelFormat!==W.VI.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),ie.dataType!==W.Br.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),se(ie,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==W.OU.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=W.OU.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(ee.glName,W.Lu)),this._depthStencilTexture=ee}detachDepthStencilTexture(){const ee=this._depthStencilTexture;return ee&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,W.Lu)),this._depthStencilTexture=null,ee}attachDepthStencilBuffer(ee){if((0,G.Wi)(ee))return;const ie=ee.descriptor;if(ie.internalFormat!==W.Tg.DEPTH_STENCIL&&ie.internalFormat!==W.Tg.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),re(ie,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=ie.internalFormat===W.Tg.DEPTH_STENCIL?W.OU.DEPTH_STENCIL_RENDER_BUFFER:W.OU.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const J=this._context.gl;J.framebufferRenderbuffer(W.qi.FRAMEBUFFER,this._desc.depthStencilTarget===W.OU.DEPTH_RENDER_BUFFER?J.DEPTH_ATTACHMENT:J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,ee.glName)}this._depthAttachment=ee}detachDepthStencilBuffer(){const ee=this._context.gl,ie=this._depthAttachment;return ie&&this._initialized&&(this._context.bindFramebuffer(this),ee.framebufferRenderbuffer(W.qi.FRAMEBUFFER,this._desc.depthStencilTarget===W.OU.DEPTH_RENDER_BUFFER?ee.DEPTH_ATTACHMENT:ee.DEPTH_STENCIL_ATTACHMENT,ee.RENDERBUFFER,null)),this._depthAttachment=null,ie}detachAll(){this._colorAttachments.forEach((ee,ie)=>this._detachColorAttachment(ie)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(ee,ie,J,ce,ue,pe,he){(ee<0||ie<0||ue<0||pe<0)&&console.error("Offsets cannot be negative!"),(J<=0||ce<=0)&&console.error("Copy width and height must be greater than zero!");const me=this._desc,ge=he.descriptor;he.descriptor.target!==W.No.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==me?.width||null==me?.height||null==ge?.width||null==ge?.height||ee+J>me.width||ie+ce>me.height||ue+J>ge.width||pe+ce>ge.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const _e=this._context,Ee=_e.bindTexture(he,H.x.TEXTURE_UNIT_FOR_UPDATES);_e.setActiveTexture(H.x.TEXTURE_UNIT_FOR_UPDATES),_e.bindFramebuffer(this),_e.gl.copyTexSubImage2D(W.No.TEXTURE_2D,0,ue,pe,ee,ie,J,ce),_e.bindTexture(Ee,H.x.TEXTURE_UNIT_FOR_UPDATES)}readPixels(ee,ie,J,ce,ue,pe,he){(J<=0||ce<=0)&&console.error("Copy width and height must be greater than zero!"),he||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(ee,ie,J,ce,ue,pe,he)}readPixelsAsync(ee,ie,J,ce,ue,pe,he){var me=this;return(0,D.Z)(function*(){if(me._context.type!==$.zO.WEBGL2)return(0,Q.hZ)()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void me.readPixels(ee,ie,J,ce,ue,pe,he);const ge=me._context.gl,_e=Z.f.createPixelPack(me._context,W.l1.STREAM_READ,he.byteLength);me._context.bindBuffer(_e),me._context.bindFramebuffer(me),ge.readPixels(ee,ie,J,ce,ue,pe,0),me._context.unbindBuffer(W.w0.PIXEL_PACK_BUFFER),yield _e.getSubDataAsync(he),_e.dispose()})()}resize(ee,ie){const J=this._desc;if(J.width!==ee||J.height!==ie){if(!this._initialized)return J.width=ee,J.height=ie,this._colorAttachments.forEach(ce=>{ce&&ce.resize(ee,ie)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(ee,ie));J.width=ee,J.height=ie,this._colorAttachments.forEach(ce=>{ce&&ce.resize(ee,ie)}),null!=this._depthStencilTexture?this._depthStencilTexture.resize(ee,ie):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(ee,ie),this._stencilAttachment&&this._stencilAttachment.resize(ee,ie)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(ee=W.qi.FRAMEBUFFER){const ie=this._context.gl;if(this._initialized)return void ie.bindFramebuffer(ee,this.glName);this._glName&&ie.deleteFramebuffer(this._glName);const J=this._context,ce=ie.createFramebuffer(),ue=this._desc,pe=ue.colorTarget??W.Lm.RENDER_BUFFER,he=ue.width??1,me=ue.height??1;if(ie.bindFramebuffer(ee,ce),0===this._colorAttachments.size)if(pe===W.Lm.TEXTURE||pe===W.Lm.CUBEMAP)this._colorAttachments.set(W.VY.COLOR_ATTACHMENT0,function de(Y,ee,ie){return new H.x(Y,{target:ie,pixelFormat:W.VI.RGBA,dataType:W.Br.UNSIGNED_BYTE,samplingMode:W.cw.NEAREST,wrapMode:W.e8.CLAMP_TO_EDGE,width:ee.width,height:ee.height})}(J,ue,this.descriptor.colorTarget===W.Lm.CUBEMAP?W.No.TEXTURE_CUBE_MAP:W.No.TEXTURE_2D));else{const _e=new B.r(J,{internalFormat:W.lP.RGBA4,width:he,height:me});this._colorAttachments.set(W.VY.COLOR_ATTACHMENT0,_e)}this._colorAttachments.forEach((_e,Ee)=>{_e&&(ae(_e)?this._framebufferTexture2D(_e.glName,Ee,j(_e),ee):ie.framebufferRenderbuffer(ee,Ee,ie.RENDERBUFFER,_e.glName))});const ge=ue.depthStencilTarget??W.OU.NONE;switch(ge){case W.OU.DEPTH_RENDER_BUFFER:case W.OU.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new B.r(J,{internalFormat:ue.depthStencilTarget===W.OU.DEPTH_RENDER_BUFFER?W.Tg.DEPTH_COMPONENT16:W.Tg.DEPTH_STENCIL,width:he,height:me})),ie.framebufferRenderbuffer(ee,ge===W.OU.DEPTH_RENDER_BUFFER?ie.DEPTH_ATTACHMENT:ie.DEPTH_STENCIL_ATTACHMENT,ie.RENDERBUFFER,this._depthAttachment.glName);break;case W.OU.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new B.r(J,{internalFormat:W.Tg.STENCIL_INDEX8,width:he,height:me})),ie.framebufferRenderbuffer(ee,ie.STENCIL_ATTACHMENT,ie.RENDERBUFFER,this._stencilAttachment.glName);break;case W.OU.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(J.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new H.x(J,{target:W.No.TEXTURE_2D,pixelFormat:W.VI.DEPTH_STENCIL,dataType:W.Br.UNSIGNED_INT_24_8,samplingMode:W.cw.NEAREST,wrapMode:W.e8.CLAMP_TO_EDGE,width:he,height:me})),this._framebufferTexture2D(this._depthStencilTexture.glName,ie.DEPTH_STENCIL_ATTACHMENT,j(this._depthStencilTexture),ee)}(0,Q.hZ)()&&ie.checkFramebufferStatus(ee)!==ie.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=ce,this._initialized=!0}_framebufferTexture2D(ee,ie=W.VY.COLOR_ATTACHMENT0,J=W.No.TEXTURE_2D,ce=W.qi.FRAMEBUFFER,ue=0){this._context.gl.framebufferTexture2D(ce,ie,J,ee,ue)}_detachColorAttachment(ee){(0,Q.hZ)()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const ie=this._context.gl,J=this._colorAttachments.get(ee);return ae(J)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ee)):this._initialized&&(this._context.bindFramebuffer(this),ie.framebufferRenderbuffer(W.qi.FRAMEBUFFER,ee,ie.RENDERBUFFER,null)),this._colorAttachments.delete(ee),J}_disposeColorAttachments(){this._colorAttachments.forEach((ee,ie)=>{this._detachColorAttachment(ie),ee.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const ee=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),ee.framebufferRenderbuffer(W.qi.FRAMEBUFFER,this._desc.depthStencilTarget===W.OU.DEPTH_RENDER_BUFFER?ee.DEPTH_ATTACHMENT:ee.DEPTH_STENCIL_ATTACHMENT,ee.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null),this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),ee.framebufferRenderbuffer(W.qi.FRAMEBUFFER,ee.STENCIL_ATTACHMENT,ee.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ee.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(ee){if(-1===te._MAX_COLOR_ATTACHMENTS){const J=this._context.capabilities.drawBuffers;te._MAX_COLOR_ATTACHMENTS=J?this._context.gl.getParameter(J.MAX_COLOR_ATTACHMENTS):1}const ie=ee-W.VY.COLOR_ATTACHMENT0;ie+1>te._MAX_COLOR_ATTACHMENTS&&R.Z.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${ie+1}. Implementation supports up to ${te._MAX_COLOR_ATTACHMENTS} color attachments`)}}function ae(Y){return null!=Y&&"type"in Y&&"texture"===Y.type}function oe(Y){return null!=Y&&"type"in Y&&"renderbuffer"===Y.type}function le(Y){return ae(Y)||null!=Y&&"pixelFormat"in Y}function se(Y,ee){Y.target!==W.No.TEXTURE_2D&&Y.target!==W.No.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),void 0!==ee.width&&ee.width>=0&&void 0!==ee.height&&ee.height>=0?ee.width===Y.width&&ee.height===Y.height||console.error("Color attachment texture must match the framebuffer's!"):(ee.width=Y.width,ee.height=Y.height)}function re(Y,ee){void 0!==ee.width&&ee.width>=0&&void 0!==ee.height&&ee.height>=0?ee.width===Y.width&&ee.height===Y.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(ee.width=Y.width,ee.height=Y.height)}function j(Y){return Y.descriptor.target===W.No.TEXTURE_CUBE_MAP?W.No.TEXTURE_CUBE_MAP_POSITIVE_X:W.No.TEXTURE_2D}te._MAX_COLOR_ATTACHMENTS=-1},49266:(nt,Ae,v)=>{"use strict";v.d(Ae,{r:()=>Z});var D=v(62208),R=v(57596),G=v(67969);class Z{constructor($,W){this._context=$,this._desc=W,this.type="renderbuffer",this._context.instanceCounter.increment(G._g.Renderbuffer,this);const B=this._context.gl;this.glName=B.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:H,height:X,internalFormat:te,multisampled:ae}=W;if(ae){if(this._context.type!==R.zO.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");B.renderbufferStorageMultisample(B.RENDERBUFFER,this.samples,te,H,X)}else B.renderbufferStorage(B.RENDERBUFFER,te,H,X)}get descriptor(){return this._desc}get samples(){const $=this._desc.samples,W=this._context.parameters.maxSamples;return $?Math.min($,W):W}resize($,W){const B=this._desc;if(B.width===$&&B.height===W)return;B.width=$,B.height=W;const H=this._context.gl;this._context.bindRenderbuffer(this),B.multisampled?H.renderbufferStorageMultisample(H.RENDERBUFFER,this.samples,B.internalFormat,B.width,B.height):H.renderbufferStorage(H.RENDERBUFFER,B.internalFormat,B.width,B.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(G._g.Renderbuffer,this),this._context=(0,D.wN)(this._context))}}},55086:(nt,Ae,v)=>{"use strict";v.d(Ae,{x:()=>X}),v(8314);var R=v(21286),G=v(62208),Z=v(68598),Q=v(57596),$=v(67969),W=v(38210);const B={target:$.No.TEXTURE_2D,samplingMode:$.cw.LINEAR,wrapMode:$.e8.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1};class X{constructor(Y,ee,ie=null){this._context=Y,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,Y.instanceCounter.increment($._g.Texture,this),this._descriptor={...B,...ee};for(const J in B)void 0===this._descriptor[J]&&(this._descriptor[J]=B[J]);if(Y.type!==Q.zO.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),se(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===$.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(ie):this.setData(ie)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement($._g.Texture,this))}release(){this.dispose()}resize(Y,ee){const ie=this._descriptor;if(ie.width!==Y||ie.height!==ee){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");ie.width=Y,ie.height=ee,this._descriptor.target===$.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(Y=null){for(let ee=$.No.TEXTURE_CUBE_MAP_POSITIVE_X;ee<=$.No.TEXTURE_CUBE_MAP_NEGATIVE_Z;ee++)this._setData(Y,ee)}setData(Y){this._setData(Y)}_setData(Y,ee){if(!this._context||!this._context.gl)return;const ie=this._context.gl;this._glName||(this._glName=ie.createTexture()),void 0===Y&&(Y=null);const J=this._descriptor,ce=ee??J.target,ue=se(ce);null===Y&&(J.width=J.width||4,J.height=J.height||4,ue&&(J.depth=J.depth??1));const pe=this._context.bindTexture(this,X.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(X.TEXTURE_UNIT_FOR_UPDATES),X._validateTexture(this._context,J),this._configurePixelStorage(),(0,Z.zu)(ie);let me=J.internalFormat??this._deriveInternalFormat(J.pixelFormat,J.dataType);if(de(Y)){let ge=Y.width,_e=Y.height;const Ee=1;Y instanceof HTMLVideoElement&&(ge=Y.videoWidth,_e=Y.videoHeight),J.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(ce,me,J.hasMipmap,ge,_e,Ee),this._texImage(ce,0,me,ge,_e,Ee,Y),(0,Z.zu)(ie),J.hasMipmap&&this.generateMipmap(),void 0===J.width&&(J.width=ge),void 0===J.height&&(J.height=_e),ue&&void 0===J.depth&&(J.depth=Ee)}else{const{width:ge,height:_e,depth:Ee}=J;if(null==ge||null==_e)throw new Error("Width and height must be specified!");if(ue&&null==Ee)throw new Error("Depth must be specified!");if(J.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(ce,me,J.hasMipmap,ge,_e,Ee),ie.DEPTH24_STENCIL8&&me===ie.DEPTH_STENCIL&&(me=ie.DEPTH24_STENCIL8),oe(Y)){const De=Y.levels,be=re(ce,ge,_e,Ee),Se=Math.min(be-1,De.length-1);(0,W.Z)(ie)?ie.texParameteri(J.target,ie.TEXTURE_MAX_LEVEL,Se):J.hasMipmap=J.hasMipmap&&be===De.length;const ye=me;if(!function ae(j){return j in $.q_}(ye))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((ve,xe,ze,Ke)=>{const We=De[Math.min(ve,De.length-1)];this._compressedTexImage(ce,ve,ye,xe,ze,Ke,We)},Se)}else(0,G.pC)(Y)?(this._texImage(ce,0,me,ge,_e,Ee,Y),(0,Z.zu)(ie),J.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((De,be,Se,ye)=>{this._texImage(ce,De,me,be,Se,ye,null),(0,Z.zu)(ie)})}X._applySamplingMode(ie,this._descriptor),X._applyWrapMode(ie,this._descriptor),X._applyAnisotropicFilteringParameters(this._context,this._descriptor),(0,Z.zu)(ie),this._context.bindTexture(pe,X.TEXTURE_UNIT_FOR_UPDATES)}updateData(Y,ee,ie,J,ce,ue,pe=0){ue||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const he=this._context.gl,me=this._descriptor,{pixelFormat:ge,dataType:_e,target:Ee,isImmutable:De}=me,be=me.internalFormat??this._deriveInternalFormat(ge,_e);if(De&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const Se=this._context.bindTexture(this,X.TEXTURE_UNIT_FOR_UPDATES,!0);if((ee<0||ie<0||J>me.width||ce>me.height||ee+J>me.width||ie+ce>me.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),pe){if(!(0,W.Z)(he))return void console.error("Webgl2 must be enabled to use dataRowOffset!");he.pixelStorei(he.UNPACK_SKIP_ROWS,pe)}if(de(ue)?(0,W.Z)(he)?he.texSubImage2D(Ee,Y,ee,ie,J,ce,ge,_e,ue):he.texSubImage2D(Ee,Y,ee,ie,ge,_e,ue):oe(ue)?he.compressedTexSubImage2D(Ee,Y,ee,ie,J,ce,be,ue.levels[Y]):he.texSubImage2D(Ee,Y,ee,ie,J,ce,ge,_e,ue),pe){if(!(0,W.Z)(he))return void console.error("Webgl2 must be enabled to use dataRowOffset!");he.pixelStorei(he.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(Se,X.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(Y,ee,ie,J,ce,ue,pe,he){he||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const me=this._context.gl;if(!(0,W.Z)(me))throw new Error("3D textures are not supported in WebGL1");const ge=this._descriptor,{pixelFormat:_e,dataType:Ee,isImmutable:De,target:be}=ge,Se=ge.internalFormat??this._deriveInternalFormat(_e,Ee);if(De&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");se(be)||console.warn("Attempting to set 3D texture data on a non-3D texture");const ye=this._context.bindTexture(this,X.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(X.TEXTURE_UNIT_FOR_UPDATES),(ee<0||ie<0||J<0||ce>ge.width||ue>ge.height||pe>ge.depth||ee+ce>ge.width||ie+ue>ge.height||J+pe>ge.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),oe(he)?me.compressedTexSubImage3D(be,Y,ee,ie,J,ce,ue,pe,Se,he=he.levels[Y]):me.texSubImage3D(be,Y,ee,ie,J,ce,ue,pe,_e,Ee,he),this._context.bindTexture(ye,X.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const Y=this._descriptor;if(!Y.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");Y.hasMipmap=!0,this._samplingModeDirty=!0,X._validateTexture(this._context,Y)}Y.samplingMode===$.cw.LINEAR?(this._samplingModeDirty=!0,Y.samplingMode=$.cw.LINEAR_MIPMAP_NEAREST):Y.samplingMode===$.cw.NEAREST&&(this._samplingModeDirty=!0,Y.samplingMode=$.cw.NEAREST_MIPMAP_NEAREST);const ee=this._context.bindTexture(this,X.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(X.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(Y.target),this._context.bindTexture(ee,X.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(Y){Y!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=Y,this._samplingModeDirty=!0)}setWrapMode(Y){Y!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=Y,X._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const Y=this._context.gl,ee=this._descriptor;this._samplingModeDirty&&(X._applySamplingMode(Y,ee),this._samplingModeDirty=!1),this._wrapModeDirty&&(X._applyWrapMode(Y,ee),this._wrapModeDirty=!1)}_deriveInternalFormat(Y,ee){if(this._context.type===Q.zO.WEBGL1)return Y;switch(ee){case $.Br.FLOAT:switch(Y){case $.VI.RGBA:return $.lP.RGBA32F;case $.VI.RGB:return $.lP.RGB32F;default:throw new Error("Unable to derive format")}case $.Br.UNSIGNED_BYTE:switch(Y){case $.VI.RGBA:return $.lP.RGBA8;case $.VI.RGB:return $.lP.RGB8}default:return Y}}_configurePixelStorage(){const Y=this._context.gl,{unpackAlignment:ee,flipped:ie,preMultiplyAlpha:J}=this._descriptor;Y.pixelStorei(Y.UNPACK_ALIGNMENT,ee),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,ie?1:0),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J?1:0)}_texStorage(Y,ee,ie,J,ce,ue){const pe=this._context.gl;if(!(0,W.Z)(pe))throw new Error("Immutable textures are not supported in WebGL1");if(!function te(j){return j in $.lP}(ee))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const he=ie?re(Y,J,ce,ue):1;if(se(Y)){if(null==ue)throw new Error("Missing depth dimension for 3D texture upload");pe.texStorage3D(Y,he,ee,J,ce,ue)}else pe.texStorage2D(Y,he,ee,J,ce);this._wasImmutablyAllocated=!0}_texImage(Y,ee,ie,J,ce,ue,pe){const he=this._context.gl;let me=null;const ge=this._context.type===Q.zO.WEBGL2,_e=se(Y),{isImmutable:Ee,pixelFormat:De,dataType:be}=this._descriptor;if(ge&&(me=he),ge||!de(pe))if(Ee){if((0,G.pC)(pe)){const Se=pe;if(_e){if(null==ue)throw new Error("Missing depth dimension for 3D texture upload");me.texSubImage3D(Y,ee,0,0,0,J,ce,ue,De,be,Se)}else he.texSubImage2D(Y,ee,0,0,J,ce,De,be,Se)}}else{const Se=(0,G.Wg)(pe);if(_e){if(null==ue)throw new Error("Missing depth dimension for 3D texture upload");me.texImage3D(Y,ee,ie,J,ce,ue,0,De,be,Se)}else he.texImage2D(Y,ee,ie,J,ce,0,De,be,Se)}else he.texImage2D(Y,0,ie,De,be,pe)}_compressedTexImage(Y,ee,ie,J,ce,ue,pe){const he=this._context.gl;let me=null;const ge=se(Y),_e=this._descriptor.isImmutable;if(ge){if(this._context.type!==Q.zO.WEBGL2)throw new Error("3D textures are not supported in WebGL1");me=he}if(_e){if((0,G.pC)(pe))if(ge){if(null==ue)throw new Error("Missing depth dimension for 3D texture upload");me.compressedTexSubImage3D(Y,ee,0,0,0,J,ce,ue,ie,pe)}else he.compressedTexSubImage2D(Y,ee,0,0,J,ce,ie,pe)}else if(ge){if(null==ue)throw new Error("Missing depth dimension for 3D texture upload");me.compressedTexImage3D(Y,ee,ie,J,ce,ue,0,pe)}else he.compressedTexImage2D(Y,ee,ie,J,ce,0,pe)}_forEachMipmapLevel(Y,ee=1/0){let{width:ie,height:J,depth:ce,hasMipmap:ue,target:pe}=this._descriptor;const he=pe===$.No.TEXTURE_3D;if(null==ie||null==J||he&&null==ce)throw new Error("Missing texture dimensions for mipmap calculation");for(let me=0;Y(me,ie,J,ce),ue&&(1!==ie||1!==J||he&&1!==ce)&&!(me>=ee);++me)ie=Math.max(1,ie>>1),J=Math.max(1,J>>1),he&&(ce=Math.max(1,ce>>1))}static _validateTexture(Y,ee){(null!=ee.width&&ee.width<0||null!=ee.height&&ee.height<0||null!=ee.depth&&ee.depth<0)&&console.error("Negative dimension parameters are not allowed!");const ie=(0,W.Z)(Y.gl),J=null!=ee.width&&(0,R.wt)(ee.width)&&null!=ee.height&&(0,R.wt)(ee.height);ie||!ee.isImmutable&&!se(ee.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),ie||J||("number"==typeof ee.wrapMode?ee.wrapMode!==$.e8.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):ee.wrapMode.s===$.e8.CLAMP_TO_EDGE&&ee.wrapMode.t===$.e8.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),ee.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(Y,ee){let ie=ee.samplingMode,J=ee.samplingMode;ie===$.cw.LINEAR_MIPMAP_NEAREST||ie===$.cw.LINEAR_MIPMAP_LINEAR?(ie=$.cw.LINEAR,ee.hasMipmap||(J=$.cw.LINEAR)):ie!==$.cw.NEAREST_MIPMAP_NEAREST&&ie!==$.cw.NEAREST_MIPMAP_LINEAR||(ie=$.cw.NEAREST,ee.hasMipmap||(J=$.cw.NEAREST)),Y.texParameteri(ee.target,Y.TEXTURE_MAG_FILTER,ie),Y.texParameteri(ee.target,Y.TEXTURE_MIN_FILTER,J)}static _applyWrapMode(Y,ee){"number"==typeof ee.wrapMode?(Y.texParameteri(ee.target,Y.TEXTURE_WRAP_S,ee.wrapMode),Y.texParameteri(ee.target,Y.TEXTURE_WRAP_T,ee.wrapMode)):(Y.texParameteri(ee.target,Y.TEXTURE_WRAP_S,ee.wrapMode.s),Y.texParameteri(ee.target,Y.TEXTURE_WRAP_T,ee.wrapMode.t))}static _applyAnisotropicFilteringParameters(Y,ee){const ie=Y.capabilities.textureFilterAnisotropic;!ie||Y.gl.texParameterf(ee.target,ie.TEXTURE_MAX_ANISOTROPY,ee.maxAnisotropy??1)}}function oe(j){return(0,G.pC)(j)&&"type"in j&&"compressed"===j.type}function de(j){return(0,G.pC)(j)&&!oe(j)&&!function le(j){return(0,G.pC)(j)&&"byteLength"in j}(j)}function se(j){return j===$.No.TEXTURE_3D||j===$.No.TEXTURE_2D_ARRAY}function re(j,Y,ee,ie=1){let J=Math.max(Y,ee);return j===$.No.TEXTURE_3D&&(J=Math.max(J,ie)),Math.round(Math.log(J)/Math.LN2)+1}X.TEXTURE_UNIT_FOR_UPDATES=0},26906:(nt,Ae,v)=>{"use strict";v.d(Ae,{HH:()=>Z,RG:()=>H,UF:()=>B,XP:()=>W,_V:()=>Q,un:()=>X}),v(8314);var R=v(62208),G=v(67969);function Z(te){const ae=te.gl;switch(ae.getError()){case ae.NO_ERROR:return null;case ae.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case ae.INVALID_VALUE:return"A numeric argument is out of range";case ae.INVALID_OPERATION:return"The specified command is not allowed for the current state";case ae.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case ae.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case ae.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Q(te,ae){return te.vertexBuffers[ae].size/function $(te){return te[0].stride}(te.layout[ae])}function W(te,ae,oe,le,de=0){const se=te.gl,re=te.capabilities.instancing;te.bindBuffer(oe);for(const j of le){const Y=ae.get(j.name);void 0===Y&&console.error(`There is no location for vertex attribute '${j.name}' defined.`);const ee=de*j.stride;if(j.count<=4)se.vertexAttribPointer(Y,j.count,j.type,j.normalized,j.stride,j.offset+ee),se.enableVertexAttribArray(Y),j.divisor>0&&re&&re.vertexAttribDivisor(Y,j.divisor);else if(9===j.count)for(let ie=0;ie<3;ie++)se.vertexAttribPointer(Y+ie,3,j.type,j.normalized,j.stride,j.offset+12*ie+ee),se.enableVertexAttribArray(Y+ie),j.divisor>0&&re&&re.vertexAttribDivisor(Y+ie,j.divisor);else if(16===j.count)for(let ie=0;ie<4;ie++)se.vertexAttribPointer(Y+ie,4,j.type,j.normalized,j.stride,j.offset+16*ie+ee),se.enableVertexAttribArray(Y+ie),j.divisor>0&&re&&re.vertexAttribDivisor(Y+ie,j.divisor);else console.error("Unsupported vertex attribute element count: "+j.count)}}function B(te,ae,oe,le){const de=te.gl,se=te.capabilities.instancing;te.bindBuffer(oe);for(const re of le){const j=ae.get(re.name);if(re.count<=4)de.disableVertexAttribArray(j),re.divisor&&re.divisor>0&&se&&se.vertexAttribDivisor(j,0);else if(9===re.count)for(let Y=0;Y<3;Y++)de.disableVertexAttribArray(j+Y),re.divisor&&re.divisor>0&&se&&se.vertexAttribDivisor(j+Y,0);else if(16===re.count)for(let Y=0;Y<4;Y++)de.disableVertexAttribArray(j+Y),re.divisor&&re.divisor>0&&se&&se.vertexAttribDivisor(j+Y,0);else console.error("Unsupported vertex attribute element count: "+re.count)}te.unbindBuffer(G.w0.ARRAY_BUFFER)}function H(te){switch(te){case G.VI.ALPHA:case G.VI.LUMINANCE:case G.VI.RED:case G.VI.RED_INTEGER:case G.lP.R8:case G.lP.R8I:case G.lP.R8UI:case G.lP.R8_SNORM:case G.Tg.STENCIL_INDEX8:return 1;case G.VI.LUMINANCE_ALPHA:case G.VI.RG:case G.VI.RG_INTEGER:case G.lP.RGBA4:case G.lP.R16F:case G.lP.R16I:case G.lP.R16UI:case G.lP.RG8:case G.lP.RG8I:case G.lP.RG8UI:case G.lP.RG8_SNORM:case G.lP.RGB565:case G.lP.RGB5_A1:case G.Tg.DEPTH_COMPONENT16:return 2;case G.VI.DEPTH_COMPONENT:case G.VI.RGB:case G.VI.RGB_INTEGER:case G.lP.RGB8:case G.lP.RGB8I:case G.lP.RGB8UI:case G.lP.RGB8_SNORM:case G.lP.SRGB8:case G.Tg.DEPTH_COMPONENT24:return 3;case G.VI.DEPTH_STENCIL:case G.VI.RGBA:case G.VI.RGBA_INTEGER:case G.lP.RGBA8:case G.lP.R32F:case G.lP.R11F_G11F_B10F:case G.lP.RG16F:case G.lP.R32I:case G.lP.R32UI:case G.lP.RG16I:case G.lP.RG16UI:case G.lP.RGBA8I:case G.lP.RGBA8UI:case G.lP.RGBA8_SNORM:case G.lP.SRGB8_ALPHA8:case G.lP.RGB9_E5:case G.lP.RGB10_A2UI:case G.lP.RGB10_A2:case G.Tg.DEPTH_STENCIL:case G.Tg.DEPTH_COMPONENT32F:case G.Tg.DEPTH24_STENCIL8:return 4;case G.Tg.DEPTH32F_STENCIL8:return 5;case G.lP.RGB16F:case G.lP.RGB16I:case G.lP.RGB16UI:return 6;case G.lP.RG32F:case G.lP.RG32I:case G.lP.RG32UI:case G.lP.RGBA16F:case G.lP.RGBA16I:case G.lP.RGBA16UI:return 8;case G.lP.RGB32F:case G.lP.RGB32I:case G.lP.RGB32UI:return 12;case G.lP.RGBA32F:case G.lP.RGBA32I:case G.lP.RGBA32UI:return 16;case G.q_.COMPRESSED_RGB_S3TC_DXT1_EXT:case G.q_.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case G.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT:case G.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case G.q_.COMPRESSED_R11_EAC:case G.q_.COMPRESSED_SIGNED_R11_EAC:case G.q_.COMPRESSED_RGB8_ETC2:case G.q_.COMPRESSED_SRGB8_ETC2:case G.q_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case G.q_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case G.q_.COMPRESSED_RG11_EAC:case G.q_.COMPRESSED_SIGNED_RG11_EAC:case G.q_.COMPRESSED_RGBA8_ETC2_EAC:case G.q_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function X(te){if((0,R.Wi)(te))return 0;if("descriptor"in te)return te.glName?X(te.descriptor):0;const ae=te.internalFormat||"pixelFormat"in te&&te.pixelFormat;if(!ae)return 0;const oe="hasMipmap"in te&&te.hasMipmap?1.3:1,le=te.width*te.height;return H(ae)*le*oe}},49353:(nt,Ae,v)=>{"use strict";v.d(Ae,{U:()=>$});var D=v(63290),R=v(62208),G=v(67969),Z=v(26906);const Q=D.Z.getLogger("esri.views.webgl.VertexArrayObject");class ${constructor(B,H,X,te,ae=null){this._context=B,this._locations=H,this._layout=X,this._buffers=te,this._indexBuffer=ae,this._glName=null,this._initialized=!1,B.instanceCounter.increment(G._g.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((B,H)=>B+this._buffers[H].size,(0,R.pC)(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(B=!0){if(this._context){if(this._glName){const H=this._context?.capabilities?.vao;H?(H.deleteVertexArray(this._glName),this._glName=null):Q.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),B){for(const H in this._buffers)this._buffers[H]?.dispose(),delete this._buffers[H];this._indexBuffer=(0,R.M2)(this._indexBuffer)}this._context.instanceCounter.decrement(G._g.VertexArrayObject,this),this._context=(0,R.wN)(this._context)}else(this._glName||B&&Object.getOwnPropertyNames(this._buffers).length>0)&&Q.warn("Leaked WebGL VAO")}initialize(){if(this._initialized)return;const B=this._context.capabilities.vao;if(B){const H=B.createVertexArray();B.bindVertexArray(H),this._bindLayout(),B.bindVertexArray(null),this._glName=H}this._initialized=!0}bind(){this.initialize();const B=this._context.capabilities.vao;B?B.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:B,_layout:H,_indexBuffer:X}=this;B||Q.error("Vertex buffer dictionary is empty!");const te=this._context.gl;for(const ae in B){const oe=B[ae];oe||Q.error("Vertex buffer is uninitialized!");const le=H[ae];le||Q.error("Vertex element descriptor is empty!"),(0,Z.XP)(this._context,this._locations,oe,le)}(0,R.pC)(X)&&(this._context.capabilities.vao?te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,X.glName):this._context.bindBuffer(X))}unbind(){this.initialize();const B=this._context.capabilities.vao;B?B.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:B,_layout:H}=this;B||Q.error("Vertex buffer dictionary is empty!");for(const X in B){const te=B[X];te||Q.error("Vertex buffer is uninitialized!"),(0,Z.UF)(this._context,this._locations,te,H[X])}(0,R.pC)(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},40852:(nt,Ae,v)=>{"use strict";v.d(Ae,{G:()=>D});class D{constructor(G,Z,Q,$,W,B=!1,H=0){this.name=G,this.count=Z,this.type=Q,this.offset=$,this.stride=W,this.normalized=B,this.divisor=H}}},31637:(nt,Ae,v)=>{"use strict";v.d(Ae,{hc:()=>Q});var D=v(62208),R=v(57596);let G,Z;function Q(de){const se=(0,R.Sh)(de);for(;se.length>1;){const re=$(se.shift());if(re.available)return re}return $(se.shift())}function $(de){switch(de){case R.zO.WEBGL1:return function W(){return G||(G=function oe(){const de=new X,se=ae(R.zO.WEBGL1,de);return(0,D.Wi)(se)||(de.supportsElementIndexUint=null!==se.getExtension("OES_element_index_uint"),de.supportsStandardDerivatives=null!==se.getExtension("OES_standard_derivatives"),de.supportsInstancedArrays=null!==se.getExtension("ANGLE_instanced_arrays"),de.supportsTextureFloat=null!==se.getExtension("OES_texture_float"),de.supportsTextureHalfFloat=null!==se.getExtension("OES_texture_half_float"),de.supportsColorBufferFloat=null!==se.getExtension("WEBGL_color_buffer_float"),de.supportsColorBufferFloatBlend=null!==se.getExtension("EXT_float_blend"),de.supportsColorBufferHalfFloat=null!==se.getExtension("EXT_color_buffer_half_float")),de}()),G}();case R.zO.WEBGL2:return function B(){return Z||(Z=function le(){const de=new te,se=ae(R.zO.WEBGL2,de);return(0,D.Wi)(se)||(de.supportsColorBufferFloat=null!==se.getExtension("EXT_color_buffer_float"),de.supportsColorBufferFloatBlend=null!==se.getExtension("EXT_float_blend"),de.supportsColorBufferHalfFloat=de.supportsColorBufferFloat||null!==se.getExtension("EXT_color_buffer_half_float")),de}()),Z}()}}class H{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class X extends H{constructor(){super(...arguments),this.type=R.zO.WEBGL1}}class te extends H{constructor(){super(...arguments),this.type=R.zO.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function ae(de,se){if(de===R.zO.WEBGL1&&typeof WebGLRenderingContext>"u"||de===R.zO.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const re=document.createElement("canvas");if(!re)return null;let j=(0,R.kr)(re,de,{failIfMajorPerformanceCaveat:!0});if((0,D.Wi)(j)&&(j=(0,R.kr)(re,de),(0,D.pC)(j)&&(se.majorPerformanceCaveat=!0)),(0,D.Wi)(j))return j;if(de===R.zO.WEBGL1){const ee=j.getParameter(j.VERSION)?.match(/^WebGL\s+([\d.]*)/);if(ee){const ie=parseFloat(ee[1]);se.available=ie>=.94}}else se.available=!0;se.maxTextureSize=j.getParameter(j.MAX_TEXTURE_SIZE),se.supportsVertexShaderSamplers=j.getParameter(j.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const Y=j.getShaderPrecisionFormat(j.FRAGMENT_SHADER,j.HIGH_FLOAT);return Y&&(se.supportsHighPrecisionFragment=Y.precision>0),j}},38210:(nt,Ae,v)=>{"use strict";function D(R){return window.WebGL2RenderingContext&&R instanceof window.WebGL2RenderingContext}v.d(Ae,{Z:()=>D})},68598:(nt,Ae,v)=>{"use strict";v.d(Ae,{CG:()=>B,hZ:()=>W,zu:()=>H});var D=v(26584),R=v(8314);const Z=v(63290).Z.getLogger("esri.views.webgl.checkWebGLError"),$=!!(0,R.Z)("enable-feature:webgl-debug");function W(){return $}function B(){return $}function H(X){if(W()){const te=X.getError();if(te){const ae=function Q(X,te){switch(te){case X.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case X.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case X.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case X.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case X.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case X.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(X,te),oe=(new Error).stack;Z.error(new D.Z("webgl-error","WebGL error occured",{message:ae,stack:oe}))}}}},57596:(nt,Ae,v)=>{"use strict";v.d(Ae,{Sh:()=>Q,kr:()=>W,sj:()=>Z,zO:()=>G});var G,te,D=v(8314),R=v(62208);function Z(te,ae,oe={}){const le=Q(te);for(;le.length>1;){const de=W(ae,le.shift(),oe);if((0,R.pC)(de))return de}return function $(te,ae,oe={}){if(!window.WebGLRenderingContext)return B(te,H),null;const le=W(te,ae,oe);return(0,R.Wi)(le)&&B(te,X),le}(ae,le.shift(),oe)}function Q(te){const ae=(0,D.Z)("esri-force-webgl");if(ae===G.WEBGL1||ae===G.WEBGL2)return[ae];switch(te){case"2d":return(0,D.Z)("mac")&&(0,D.Z)("chrome")?[G.WEBGL1,G.WEBGL2]:[G.WEBGL2,G.WEBGL1];case"3d":return[G.WEBGL2,G.WEBGL1]}}function W(te,ae,oe={}){const le=ae===G.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let de=null;for(const se of le){try{de=te.getContext(se,oe)}catch{}if(de)break}return de}function B(te,ae){const oe=te.parentNode;oe&&(oe.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+ae+"</div></div></td></tr></table>")}(te=G||(G={}))[te.WEBGL1=1]="WEBGL1",te[te.WEBGL2=2]="WEBGL2";const H='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',X='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},2757:(nt,Ae,v)=>{"use strict";function D($,W,B){for(let H=0;H<B;++H)W[2*H]=$[H],W[2*H+1]=$[H]-W[2*H]}function G($,W){const B=$.length;for(let H=0;H<B;++H)Q[0]=$[H],W[H]=Q[0];return W}function Z($,W){const B=$.length;for(let H=0;H<B;++H)Q[0]=$[H],Q[1]=$[H]-Q[0],W[H]=Q[1];return W}v.d(Ae,{GB:()=>Z,LF:()=>D,U8:()=>G});const Q=new Float32Array(2)},67969:(nt,Ae,v)=>{"use strict";var D,R,G,Z,Q,$,W,B,H,X,te,ae,oe,le,de,se,re,j,Y,ee,ie,J,ye;v.d(Ae,{Br:()=>se,Ho:()=>Y,LR:()=>$,Ld:()=>ce,Lm:()=>ie,Lu:()=>he,MX:()=>R,No:()=>oe,OU:()=>J,Tg:()=>re,V7:()=>be,VI:()=>le,VY:()=>pe,Wf:()=>W,Y5:()=>De,_g:()=>ue,cw:()=>te,db:()=>Z,e8:()=>ae,g:()=>B,l1:()=>j,lP:()=>de,lk:()=>D,q_:()=>me,qi:()=>ee,w0:()=>Q,wb:()=>H,xS:()=>X,zi:()=>G}),(ye=D||(D={}))[ye.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",ye[ye.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",ye[ye.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",function(ye){ye[ye.POINTS=0]="POINTS",ye[ye.LINES=1]="LINES",ye[ye.LINE_LOOP=2]="LINE_LOOP",ye[ye.LINE_STRIP=3]="LINE_STRIP",ye[ye.TRIANGLES=4]="TRIANGLES",ye[ye.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",ye[ye.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(R||(R={})),function(ye){ye[ye.ZERO=0]="ZERO",ye[ye.ONE=1]="ONE",ye[ye.SRC_COLOR=768]="SRC_COLOR",ye[ye.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",ye[ye.SRC_ALPHA=770]="SRC_ALPHA",ye[ye.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",ye[ye.DST_ALPHA=772]="DST_ALPHA",ye[ye.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",ye[ye.DST_COLOR=774]="DST_COLOR",ye[ye.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",ye[ye.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",ye[ye.CONSTANT_COLOR=32769]="CONSTANT_COLOR",ye[ye.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",ye[ye.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",ye[ye.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(G||(G={})),function(ye){ye[ye.ADD=32774]="ADD",ye[ye.SUBTRACT=32778]="SUBTRACT",ye[ye.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Z||(Z={})),function(ye){ye[ye.ARRAY_BUFFER=34962]="ARRAY_BUFFER",ye[ye.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",ye[ye.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",ye[ye.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",ye[ye.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",ye[ye.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",ye[ye.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Q||(Q={})),function(ye){ye[ye.FRONT=1028]="FRONT",ye[ye.BACK=1029]="BACK",ye[ye.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}($||($={})),function(ye){ye[ye.CW=2304]="CW",ye[ye.CCW=2305]="CCW"}(W||(W={})),function(ye){ye[ye.BYTE=5120]="BYTE",ye[ye.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",ye[ye.SHORT=5122]="SHORT",ye[ye.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",ye[ye.INT=5124]="INT",ye[ye.UNSIGNED_INT=5125]="UNSIGNED_INT",ye[ye.FLOAT=5126]="FLOAT"}(B||(B={})),function(ye){ye[ye.NEVER=512]="NEVER",ye[ye.LESS=513]="LESS",ye[ye.EQUAL=514]="EQUAL",ye[ye.LEQUAL=515]="LEQUAL",ye[ye.GREATER=516]="GREATER",ye[ye.NOTEQUAL=517]="NOTEQUAL",ye[ye.GEQUAL=518]="GEQUAL",ye[ye.ALWAYS=519]="ALWAYS"}(H||(H={})),function(ye){ye[ye.ZERO=0]="ZERO",ye[ye.KEEP=7680]="KEEP",ye[ye.REPLACE=7681]="REPLACE",ye[ye.INCR=7682]="INCR",ye[ye.DECR=7683]="DECR",ye[ye.INVERT=5386]="INVERT",ye[ye.INCR_WRAP=34055]="INCR_WRAP",ye[ye.DECR_WRAP=34056]="DECR_WRAP"}(X||(X={})),function(ye){ye[ye.NEAREST=9728]="NEAREST",ye[ye.LINEAR=9729]="LINEAR",ye[ye.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",ye[ye.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",ye[ye.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",ye[ye.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(te||(te={})),function(ye){ye[ye.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",ye[ye.REPEAT=10497]="REPEAT",ye[ye.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ae||(ae={})),function(ye){ye[ye.TEXTURE_2D=3553]="TEXTURE_2D",ye[ye.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",ye[ye.TEXTURE_3D=32879]="TEXTURE_3D",ye[ye.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",ye[ye.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",ye[ye.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",ye[ye.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",ye[ye.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",ye[ye.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",ye[ye.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(oe||(oe={})),function(ye){ye[ye.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",ye[ye.DEPTH_STENCIL=34041]="DEPTH_STENCIL",ye[ye.ALPHA=6406]="ALPHA",ye[ye.RGB=6407]="RGB",ye[ye.RGBA=6408]="RGBA",ye[ye.LUMINANCE=6409]="LUMINANCE",ye[ye.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",ye[ye.RED=6403]="RED",ye[ye.RG=33319]="RG",ye[ye.RED_INTEGER=36244]="RED_INTEGER",ye[ye.RG_INTEGER=33320]="RG_INTEGER",ye[ye.RGB_INTEGER=36248]="RGB_INTEGER",ye[ye.RGBA_INTEGER=36249]="RGBA_INTEGER"}(le||(le={})),function(ye){ye[ye.RGBA4=32854]="RGBA4",ye[ye.R16F=33325]="R16F",ye[ye.RG16F=33327]="RG16F",ye[ye.RGB32F=34837]="RGB32F",ye[ye.RGBA16F=34842]="RGBA16F",ye[ye.R32F=33326]="R32F",ye[ye.RG32F=33328]="RG32F",ye[ye.RGBA32F=34836]="RGBA32F",ye[ye.R11F_G11F_B10F=35898]="R11F_G11F_B10F",ye[ye.RGB8=32849]="RGB8",ye[ye.RGBA8=32856]="RGBA8",ye[ye.RGB5_A1=32855]="RGB5_A1",ye[ye.R8=33321]="R8",ye[ye.RG8=33323]="RG8",ye[ye.R8I=33329]="R8I",ye[ye.R8UI=33330]="R8UI",ye[ye.R16I=33331]="R16I",ye[ye.R16UI=33332]="R16UI",ye[ye.R32I=33333]="R32I",ye[ye.R32UI=33334]="R32UI",ye[ye.RG8I=33335]="RG8I",ye[ye.RG8UI=33336]="RG8UI",ye[ye.RG16I=33337]="RG16I",ye[ye.RG16UI=33338]="RG16UI",ye[ye.RG32I=33339]="RG32I",ye[ye.RG32UI=33340]="RG32UI",ye[ye.RGB16F=34843]="RGB16F",ye[ye.RGB9_E5=35901]="RGB9_E5",ye[ye.SRGB8=35905]="SRGB8",ye[ye.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",ye[ye.RGB565=36194]="RGB565",ye[ye.RGBA32UI=36208]="RGBA32UI",ye[ye.RGB32UI=36209]="RGB32UI",ye[ye.RGBA16UI=36214]="RGBA16UI",ye[ye.RGB16UI=36215]="RGB16UI",ye[ye.RGBA8UI=36220]="RGBA8UI",ye[ye.RGB8UI=36221]="RGB8UI",ye[ye.RGBA32I=36226]="RGBA32I",ye[ye.RGB32I=36227]="RGB32I",ye[ye.RGBA16I=36232]="RGBA16I",ye[ye.RGB16I=36233]="RGB16I",ye[ye.RGBA8I=36238]="RGBA8I",ye[ye.RGB8I=36239]="RGB8I",ye[ye.R8_SNORM=36756]="R8_SNORM",ye[ye.RG8_SNORM=36757]="RG8_SNORM",ye[ye.RGB8_SNORM=36758]="RGB8_SNORM",ye[ye.RGBA8_SNORM=36759]="RGBA8_SNORM",ye[ye.RGB10_A2=32857]="RGB10_A2",ye[ye.RGB10_A2UI=36975]="RGB10_A2UI"}(de||(de={})),function(ye){ye[ye.FLOAT=5126]="FLOAT",ye[ye.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",ye[ye.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",ye[ye.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",ye[ye.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",ye[ye.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",ye[ye.BYTE=5120]="BYTE",ye[ye.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",ye[ye.SHORT=5122]="SHORT",ye[ye.UNSIGNED_INT=5125]="UNSIGNED_INT",ye[ye.INT=5124]="INT",ye[ye.HALF_FLOAT=5131]="HALF_FLOAT",ye[ye.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",ye[ye.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",ye[ye.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",ye[ye.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(se||(se={})),function(ye){ye[ye.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",ye[ye.STENCIL_INDEX8=36168]="STENCIL_INDEX8",ye[ye.DEPTH_STENCIL=34041]="DEPTH_STENCIL",ye[ye.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",ye[ye.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",ye[ye.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",ye[ye.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(re||(re={})),function(ye){ye[ye.STATIC_DRAW=35044]="STATIC_DRAW",ye[ye.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",ye[ye.STREAM_DRAW=35040]="STREAM_DRAW",ye[ye.STATIC_READ=35045]="STATIC_READ",ye[ye.DYNAMIC_READ=35049]="DYNAMIC_READ",ye[ye.STREAM_READ=35041]="STREAM_READ",ye[ye.STATIC_COPY=35046]="STATIC_COPY",ye[ye.DYNAMIC_COPY=35050]="DYNAMIC_COPY",ye[ye.STREAM_COPY=35042]="STREAM_COPY"}(j||(j={})),function(ye){ye[ye.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",ye[ye.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Y||(Y={})),function(ye){ye[ye.FRAMEBUFFER=36160]="FRAMEBUFFER",ye[ye.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",ye[ye.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(ee||(ee={})),function(ye){ye[ye.TEXTURE=0]="TEXTURE",ye[ye.RENDER_BUFFER=1]="RENDER_BUFFER",ye[ye.CUBEMAP=2]="CUBEMAP"}(ie||(ie={})),function(ye){ye[ye.NONE=0]="NONE",ye[ye.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",ye[ye.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",ye[ye.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",ye[ye.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(J||(J={}));const ce=33984;var ue,pe;(function(ye){ye[ye.Texture=0]="Texture",ye[ye.BufferObject=1]="BufferObject",ye[ye.VertexArrayObject=2]="VertexArrayObject",ye[ye.Shader=3]="Shader",ye[ye.Program=4]="Program",ye[ye.FramebufferObject=5]="FramebufferObject",ye[ye.Renderbuffer=6]="Renderbuffer",ye[ye.Sync=7]="Sync",ye[ye.COUNT=8]="COUNT"})(ue||(ue={})),function(ye){ye[ye.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",ye[ye.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",ye[ye.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",ye[ye.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",ye[ye.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",ye[ye.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",ye[ye.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",ye[ye.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",ye[ye.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",ye[ye.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",ye[ye.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",ye[ye.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",ye[ye.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",ye[ye.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",ye[ye.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",ye[ye.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(pe||(pe={}));const he=33306;var me,ge,_e,Ee,De,be,Se;(function(ye){ye[ye.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",ye[ye.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",ye[ye.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",ye[ye.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",ye[ye.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",ye[ye.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",ye[ye.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",ye[ye.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",ye[ye.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",ye[ye.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",ye[ye.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",ye[ye.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",ye[ye.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",ye[ye.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(me||(me={})),function(ye){ye[ye.FLOAT=5126]="FLOAT",ye[ye.FLOAT_VEC2=35664]="FLOAT_VEC2",ye[ye.FLOAT_VEC3=35665]="FLOAT_VEC3",ye[ye.FLOAT_VEC4=35666]="FLOAT_VEC4",ye[ye.INT=5124]="INT",ye[ye.INT_VEC2=35667]="INT_VEC2",ye[ye.INT_VEC3=35668]="INT_VEC3",ye[ye.INT_VEC4=35669]="INT_VEC4",ye[ye.BOOL=35670]="BOOL",ye[ye.BOOL_VEC2=35671]="BOOL_VEC2",ye[ye.BOOL_VEC3=35672]="BOOL_VEC3",ye[ye.BOOL_VEC4=35673]="BOOL_VEC4",ye[ye.FLOAT_MAT2=35674]="FLOAT_MAT2",ye[ye.FLOAT_MAT3=35675]="FLOAT_MAT3",ye[ye.FLOAT_MAT4=35676]="FLOAT_MAT4",ye[ye.SAMPLER_2D=35678]="SAMPLER_2D",ye[ye.SAMPLER_CUBE=35680]="SAMPLER_CUBE",ye[ye.UNSIGNED_INT=5125]="UNSIGNED_INT",ye[ye.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",ye[ye.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",ye[ye.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",ye[ye.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",ye[ye.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",ye[ye.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",ye[ye.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",ye[ye.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",ye[ye.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",ye[ye.SAMPLER_3D=35679]="SAMPLER_3D",ye[ye.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",ye[ye.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",ye[ye.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",ye[ye.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",ye[ye.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",ye[ye.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",ye[ye.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",ye[ye.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",ye[ye.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",ye[ye.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",ye[ye.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",ye[ye.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ge||(ge={})),function(ye){ye[ye.OBJECT_TYPE=37138]="OBJECT_TYPE",ye[ye.SYNC_CONDITION=37139]="SYNC_CONDITION",ye[ye.SYNC_STATUS=37140]="SYNC_STATUS",ye[ye.SYNC_FLAGS=37141]="SYNC_FLAGS"}(_e||(_e={})),function(ye){ye[ye.UNSIGNALED=37144]="UNSIGNALED",ye[ye.SIGNALED=37145]="SIGNALED"}(Ee||(Ee={})),function(ye){ye[ye.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",ye[ye.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",ye[ye.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",ye[ye.WAIT_FAILED=37149]="WAIT_FAILED"}(De||(De={})),function(ye){ye[ye.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(be||(be={})),function(ye){ye[ye.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Se||(Se={}))},2078:(nt,Ae,v)=>{"use strict";v.d(Ae,{BK:()=>H,LZ:()=>B,Rd:()=>Q,if:()=>G,jp:()=>We,sg:()=>$,sm:()=>j,wK:()=>Z,zp:()=>W});var D=v(42743),R=v(67969);function G(Ce,Be,Fe=R.db.ADD,je=[0,0,0,0]){return{srcRgb:Ce,srcAlpha:Ce,dstRgb:Be,dstAlpha:Be,opRgb:Fe,opAlpha:Fe,color:{r:je[0],g:je[1],b:je[2],a:je[3]}}}function Z(Ce,Be,Fe,je,Re=R.db.ADD,He=R.db.ADD,Ie=[0,0,0,0]){return{srcRgb:Ce,srcAlpha:Be,dstRgb:Fe,dstAlpha:je,opRgb:Re,opAlpha:He,color:{r:Ie[0],g:Ie[1],b:Ie[2],a:Ie[3]}}}const Q={face:R.LR.BACK,mode:R.Wf.CCW},$={face:R.LR.FRONT,mode:R.Wf.CCW},W=Ce=>Ce===D.Vr.Back?Q:Ce===D.Vr.Front?$:null,B={zNear:0,zFar:1},H={r:!0,g:!0,b:!0,a:!0};function X(Ce){return ie.intern(Ce)}function te(Ce){return ce.intern(Ce)}function ae(Ce){return pe.intern(Ce)}function oe(Ce){return me.intern(Ce)}function le(Ce){return _e.intern(Ce)}function de(Ce){return De.intern(Ce)}function se(Ce){return Se.intern(Ce)}function re(Ce){return ve.intern(Ce)}function j(Ce){return ze.intern(Ce)}class Y{constructor(Be,Fe){this._makeKey=Be,this._makeRef=Fe,this._interns=new Map}intern(Be){if(!Be)return null;const Fe=this._makeKey(Be),je=this._interns;return je.has(Fe)||je.set(Fe,this._makeRef(Be)),je.get(Fe)??null}}function ee(Ce){return"["+Ce.join(",")+"]"}const ie=new Y(J,Ce=>({__tag:"Blending",...Ce}));function J(Ce){return Ce?ee([Ce.srcRgb,Ce.srcAlpha,Ce.dstRgb,Ce.dstAlpha,Ce.opRgb,Ce.opAlpha,Ce.color.r,Ce.color.g,Ce.color.b,Ce.color.a]):null}const ce=new Y(ue,Ce=>({__tag:"Culling",...Ce}));function ue(Ce){return Ce?ee([Ce.face,Ce.mode]):null}const pe=new Y(he,Ce=>({__tag:"PolygonOffset",...Ce}));function he(Ce){return Ce?ee([Ce.factor,Ce.units]):null}const me=new Y(ge,Ce=>({__tag:"DepthTest",...Ce}));function ge(Ce){return Ce?ee([Ce.func]):null}const _e=new Y(Ee,Ce=>({__tag:"StencilTest",...Ce}));function Ee(Ce){return Ce?ee([Ce.function.func,Ce.function.ref,Ce.function.mask,Ce.operation.fail,Ce.operation.zFail,Ce.operation.zPass]):null}const De=new Y(be,Ce=>({__tag:"DepthWrite",...Ce}));function be(Ce){return Ce?ee([Ce.zNear,Ce.zFar]):null}const Se=new Y(ye,Ce=>({__tag:"ColorWrite",...Ce}));function ye(Ce){return Ce?ee([Ce.r,Ce.g,Ce.b,Ce.a]):null}const ve=new Y(xe,Ce=>({__tag:"StencilWrite",...Ce}));function xe(Ce){return Ce?ee([Ce.mask]):null}const ze=new Y(function Ke(Ce){return Ce?ee([J(Ce.blending),ue(Ce.culling),he(Ce.polygonOffset),ge(Ce.depthTest),Ee(Ce.stencilTest),be(Ce.depthWrite),ye(Ce.colorWrite),xe(Ce.stencilWrite)]):null},Ce=>({blending:X(Ce.blending),culling:te(Ce.culling),polygonOffset:ae(Ce.polygonOffset),depthTest:oe(Ce.depthTest),stencilTest:le(Ce.stencilTest),depthWrite:de(Ce.depthWrite),colorWrite:se(Ce.colorWrite),stencilWrite:re(Ce.stencilWrite)}));class We{constructor(Be){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=Be}setPipeline(Be){(this._pipelineInvalid||Be!==this._pipeline)&&(this._setBlending(Be.blending),this._setCulling(Be.culling),this._setPolygonOffset(Be.polygonOffset),this._setDepthTest(Be.depthTest),this._setStencilTest(Be.stencilTest),this._setDepthWrite(Be.depthWrite),this._setColorWrite(Be.colorWrite),this._setStencilWrite(Be.stencilWrite),this._pipeline=Be),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(Be){this._blending=this._setSubState(Be,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(Be){this._culling=this._setSubState(Be,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(Be){this._polygonOffset=this._setSubState(Be,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(Be){this._depthTest=this._setSubState(Be,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(Be){this._stencilTest=this._setSubState(Be,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(Be){this._depthWrite=this._setSubState(Be,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(Be){this._colorWrite=this._setSubState(Be,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(Be){this._stencilWrite=this._setSubState(Be,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(Be,Fe,je,Re){return(je||Be!==Fe)&&(Re(Be),this._pipelineInvalid=!0),Be}}},92236:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>R,b:()=>G});var D=v(90912);function R(Z){const Q=(0,D.vU)(100*(1-Z));return Math.max(0,Math.min(Q,100))}function G(Z){return Math.max(0,Math.min(1-Z/100,1))}},32584:(nt,Ae,v)=>{"use strict";v.d(Ae,{Nw:()=>se});var D=v(26584),R=v(58817),G=v(62208),Z=v(94113),Q=v(23025),$=v(72469);const W=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),B=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function le(re,j){"maxScale"in re&&(j.maxScale=(0,Q.k)(re.maxScale)),"minScale"in re&&(j.minScale=(0,Q.k)(re.minScale))}function se(re,j,Y){if(!("write"in re)||!re.write)return Y&&Y.messages&&Y.messages.push(new D.Z("layer:unsupported",`Layers (${re.title}, ${re.id}) of type '${re.declaredClass}' cannot be persisted`,{layer:re})),null;if(function ae(re,j){if(j.restrictedWebMapWriting){const Y=function te(re){return"basemap"===re.layerContainerType?W:"operational-layers"===re.layerContainerType?B:null}(j);return!(0,G.pC)(Y)||Y.has(re.type)&&!(0,$.rQ)(re)}return!0}(re,Y)){const ee={};return re.write(ee,Y)?ee:null}return(0,G.pC)(j)&&function de(re,j){if(function oe(re,j){if((0,$.rQ)(re)){const Y=(0,Z.hS)("featureCollection.layers",j),ee=Y&&Y[0]&&Y[0].layerDefinition;ee&&le(re,ee)}else"stream"===re.type?le(re,j.layerDefinition=j.layerDefinition||{}):"group"!==re.type&&le(re,j)}(re,j),"blendMode"in re&&(j.blendMode=re.blendMode,"normal"===j.blendMode&&delete j.blendMode),j.opacity=(0,Q.k)(re.opacity),j.title=re.title||"Layer",j.visibility=re.visible,"legendEnabled"in re&&"wmts"!==re.type)if((0,$.rQ)(re)){const Y=j.featureCollection;Y&&(Y.showLegend=re.legendEnabled)}else j.showLegend=re.legendEnabled}(re,j=(0,R.d9)(j)),j}},40915:(nt,Ae,v)=>{"use strict";v.d(Ae,{Z:()=>Je});var D=v(15861),R=v(17626),Z=(v(52515),v(40764)),Q=v(61885),$=v(17770),W=v(72392),H=(v(8314),v(58817)),X=v(63290),te=v(62208),ae=v(60330),oe=v(10699),le=v(32917),de=v(35948),se=v(77712),re=v(66656),j=v(76898),Y=v(36082),ee=v(819),ie=v(39605);v(62996);const ce={handleInterceptedEvent:(rt,tt,et,qe)=>(rt.scheduleRender(),tt.properties[`on${qe.type}`].apply(tt.properties.bind||et,[qe]))},ue={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(rt,tt,et)=>{rt.style[tt]=et}},ge=(rt,tt,et=!1)=>{let qe=rt;return tt.forEach((ot,ut)=>{const _t=qe?.children?((rt,tt)=>rt.find(Ct=>Ct.domNode===ot))(qe.children):void 0;et&&!_t&&ut!==tt.length-1||(qe=_t)}),qe};var Ee=v(76210),De=v(46203);function be(){const{classList:rt}=document.body,tt=window.matchMedia("(prefers-color-scheme: dark)").matches,et=()=>rt.contains(De.d)||rt.contains(De.a)&&tt?"dark":"light",qe=_t=>document.body.dispatchEvent(new CustomEvent("calciteThemeChange",{bubbles:!0,detail:{theme:_t}})),ot=_t=>{ut!==_t&&qe(_t),ut=_t};let ut=et();qe(ut),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",_t=>ot(_t.matches?"dark":"light")),new MutationObserver(()=>ot(et())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}!function Se(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&("interactive"===document.readyState?be():document.addEventListener("DOMContentLoaded",()=>be(),{once:!0}))}();var ve=v(54346),xe=v(21726);let ze;ze="components/assets";var We=v(81431);const Ce=new Set;var je=v(66950),Re=v(38570),He=v(56683),Ie=v(41840);let Pe=0;function Me(rt,tt){for(const et in tt)null!=rt[et]&&("object"==typeof rt[et]&&"object"==typeof tt[et]?Me(rt[et],tt?.[et]):rt[et]=tt[et]);return rt}const Ne=(rt=>{let tt;const et={...ce,...rt},qe=(rt=>({...ue,...rt}))(et),ot=qe.performanceLogger;let ut,_t=!0,Ct=!1;const vt=[],Lt=[],jt=(Wt,pr,gr)=>{let ar;qe.eventHandlerInterceptor=(mr,wt,or,sr)=>function(rr){let Et;ot("domEvent",rr);const St=((rt,tt)=>{const et=[];for(;rt&&rt!==tt;)et.push(rt),rt=rt.parentNode;return et})(rr.currentTarget,ar.domNode),Ft=St.some(dr=>customElements.get(dr?.tagName?.toLowerCase()));if(rr.eventPhase!==Event.CAPTURING_PHASE&&Ft){const dr=rr.composedPath(),hr=dr.slice(dr.indexOf(rr.currentTarget),dr.indexOf(ar.domNode)).filter(Tr=>Tr.getRootNode()===Tr.ownerDocument).reverse();Et=ge(ar.getLastRender(),hr,!0)}else St.reverse(),Et=ge(ar.getLastRender(),St);let zt;return Et&&(zt=et.handleInterceptedEvent(tt,Et,this,rr)),ot("domEventProcessed",rr),zt},et.postProcessProjectionOptions?.(qe);const Fr=gr();ar=Wt(pr,Fr,qe),vt.push(ar),Lt.push(gr),et.afterFirstVNodeRendered&&et.afterFirstVNodeRendered(ar,Fr)};let $t=()=>{if(ut=void 0,_t){_t=!1,ot("renderStart",void 0);for(let Wt=0;Wt<vt.length;Wt++){const pr=Lt[Wt]();ot("rendered",void 0),vt[Wt].update(pr),ot("patched",void 0)}ot("renderDone",void 0),_t=!0}};return et.modifyDoRenderImplementation&&($t=et.modifyDoRenderImplementation($t,vt,Lt)),tt={renderNow:$t,scheduleRender:()=>{ut||Ct||(ut=requestAnimationFrame($t))},stop:()=>{ut&&(cancelAnimationFrame(ut),ut=void 0),Ct=!0},resume:()=>{Ct=!1,_t=!0,tt.scheduleRender()},append:(Wt,pr)=>{jt(ie.v.append,Wt,pr)},insertBefore:(Wt,pr)=>{jt(ie.v.insertBefore,Wt,pr)},merge:(Wt,pr)=>{jt(ie.v.merge,Wt,pr)},replace:(Wt,pr)=>{jt(ie.v.replace,Wt,pr)},detach:Wt=>{for(let pr=0;pr<Lt.length;pr++)if(Lt[pr]===Wt)return Lt.splice(pr,1),vt.splice(pr,1)[0];throw new Error("renderFunction was not found")}},tt})({postProcessProjectionOptions(rt){const tt=rt.eventHandlerInterceptor,et=/capture$/i;rt.eventHandlerInterceptor=(qe,ot,ut,_t)=>{const Ct=tt?.(qe,ot,ut,_t),vt=et.test(qe);if(!((qe=qe.replace(et,"")).toLowerCase()in ut)||vt){const Lt=qe[2].toLowerCase()+qe.slice(3),jt=pr=>Ct?.call(ut,pr);ut.addEventListener(Lt,jt,vt);const $t=()=>ut.removeEventListener(Lt,jt,vt),Wt=_t.afterRemoved;_t.afterRemoved=pr=>{Wt?.(pr),$t()}}return Ct}},handleInterceptedEvent(rt,tt,et,qe){const{eventPhase:ot,type:ut}=qe,_t=ot===Event.CAPTURING_PHASE;let Ct=`on${ut}${_t?"capture":""}`;const vt=tt.properties;(vt&&Ct in vt||(Ct=`on${ut[0].toUpperCase()}${ut.slice(1)}${_t?"Capture":""}`,vt&&Ct in vt))&&((0,je.Uy)(),rt.scheduleRender(),vt[Ct].call(vt.bind||et,qe))}});let Xe=!1,Ye=class extends((0,ae.v)(Q.Z.EventedAccessor)){constructor(rt,tt){var et;super(rt,tt),et=this,this._attached=!1,this._internalHandles=new W.Z,this._projector=Ne,this._readyForTrueRender=!1,this.iconClass="esri-icon-checkbox-unchecked",this.key=this,this._loadLocale=(0,oe.Ds)((0,D.Z)(function*(){if(et._messageBundleProps&&et._messageBundleProps.length){const _t=yield(0,oe.as)(et._messageBundleProps.map(function(){var Ct=(0,D.Z)(function*({bundlePath:vt,propertyName:Lt}){let jt=yield(0,Ie.ME)(vt);et.uiStrings&&Object.keys(et.uiStrings)&&(jt=Me((0,H.d9)(jt),et.uiStrings)),et[Lt]=jt});return function(vt){return Ct.apply(this,arguments)}}()));for(const Ct of _t)Ct.error&&X.Z.getLogger(et.declaredClass).error("widget-intl:locale-error",et.declaredClass,Ct.error)}yield et.loadLocale()})),function Ke(){(0,Ee.YY)((0,xe.hF)((0,ve.V)("components/assets")))}();const qe="esri-widget-uid-"+(0,de.D)(),ot=this.render.bind(this);this._trackingTarget=new ee.M(()=>this.scheduleRender());const ut=()=>{if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:qe,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const _t=ot();let{properties:Ct}=_t;Ct||(_t.properties=Ct={});let{key:vt,styles:Lt}=Ct;vt||(Ct.key=qe),Lt||(Ct.styles=Lt={}),Lt.display||(Lt.display="");let jt=0;return _t.children?.forEach($t=>{if((0,We.ZJ)($t.vnodeSelector))return;let{properties:Wt}=$t;Wt||($t.properties=Wt={}),Wt.key||(Wt.key=`${this.id}--${jt++}`)}),(0,We.dh)(this,_t)};this.render=()=>{if(Xe)return ut();let _t=(0,je.O9)(this)??null;if(_t)return _t;this._trackingTarget.clear(),Xe=!0;try{_t=(0,Y.LJ)(this._trackingTarget,ut)}catch(Ct){throw console.error(Ct),Ct}finally{Xe=!1}return _t&&(0,je.KF)(this,_t),_t},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),function Be(rt){Ce.add(rt),rt.finally(()=>Ce.delete(rt))}(this._resourcesFetch)}normalizeCtorArgs(rt,tt){const et={...rt};return tt&&(et.container=tt),et}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(oe.H9)}loadDependencies(){return(0,D.Z)(function*(){})()}loadLocale(){return(0,D.Z)(function*(){})()}destroy(){this.destroyed||((0,te.SC)(this._trackingTarget),(0,te.SC)(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,je.w7)(this))}set container(rt){this._get("container")||this._set("container",rt)}castContainer(rt){return(0,Z.L7)(rt)}get domNode(){return this.container}set domNode(rt){this.container=rt}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Pe++}set id(rt){rt&&this._set("id",rt)}get label(){return this.declaredClass.split(".").pop()}set label(rt){this._overrideIfSome("label",rt)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(rt){this._set("visible",rt)}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,je.w7)(this),this._projector.scheduleRender())}classes(...rt){return Re.Sh.apply(this,rt)}renderNow(){(0,je.w7)(this),this._projector.renderNow()}_postInitialize(){var rt=this;if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add((0,le.YP)(()=>this.viewModel,(et,qe)=>{qe&&this._internalHandles.remove("delegated-events"),et&&(0,$.vT)(et)&&this._internalHandles.add(this._delegatedEventNames.map(ot=>(0,$.on)(et,ot,ut=>{this.emit(ot,ut)})),"delegated-events")},le.nn)),this.postInitialize();const tt=function(){var et=(0,D.Z)(function*(){yield rt._loadLocale().catch(oe.H9),rt.scheduleRender()});return function(){return et.apply(this,arguments)}}();this._internalHandles.add([(0,He.qe)(tt),(0,le.YP)(()=>this.uiStrings,tt),(0,le.gx)(()=>this.container,et=>{this.destroyed||this._attach(et)},{initial:!0,once:!0})])}_attach(rt){rt&&(this._projector.merge(rt,this.render),this._attached=!0)}_detach(rt){this._attached&&(this._projector.detach(this.render),this._attached=!1),rt?.parentNode?.removeChild(rt)}};Ye[We.$X]=!0,(0,R._)([(0,se.Cb)()],Ye.prototype,"_readyForTrueRender",void 0),(0,R._)([(0,se.Cb)({value:null})],Ye.prototype,"container",null),(0,R._)([(0,re.p)("container")],Ye.prototype,"castContainer",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"domNode",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"iconClass",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"id",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"label",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"renderable",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"uiStrings",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"viewModel",void 0),(0,R._)([(0,se.Cb)({value:!0})],Ye.prototype,"visible",null),(0,R._)([(0,se.Cb)()],Ye.prototype,"key",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"children",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"afterCreate",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"afterUpdate",void 0),(0,R._)([(0,se.Cb)()],Ye.prototype,"afterRemoved",void 0),Ye=(0,R._)([(0,j.j)("esri.widgets.Widget")],Ye);const Je=Ye},24940:(nt,Ae,v)=>{"use strict";v.d(Ae,{h:()=>R});var D=v(38570);function R(){return function(Q,$){if(!Q[$])throw new TypeError(`Cannot auto bind undefined function '${$}'`);return{value:Z(Q[$])}}}function Z(Q){return function($,...W){!function G(Q){const{type:$}=Q;return Q instanceof KeyboardEvent||"keyup"===$||"keydown"===$||"keypress"===$}($)?Q.call(this,$,...W):(0,D.pf)($.key)&&($.preventDefault(),$.stopPropagation(),$.target.click())}}},25552:(nt,Ae,v)=>{"use strict";function D(R){return(G,Z)=>{G.hasOwnProperty("_messageBundleProps")||(G._messageBundleProps=G._messageBundleProps?G._messageBundleProps.slice():[]),G._messageBundleProps.push({bundlePath:R,propertyName:Z})}}v.d(Ae,{H:()=>D})},94450:(nt,Ae,v)=>{"use strict";v.d(Ae,{u:()=>Q});var D=v(81431),R=function(W){return{vnodeSelector:"",properties:void 0,children:void 0,text:W.toString(),domNode:null}},G=function(W,B){for(var H=0,X=W.length;H<X;H++){var te=W[H];Array.isArray(te)?G(te,B):null!=te&&!1!==te&&(te.hasOwnProperty("vnodeSelector")||(te=R(te)),B.push(te))}};function Q(W,B,...H){return"function"!=typeof W||(0,D.ZJ)(W)?function(W,B){for(var H=[],X=2;X<arguments.length;X++)H[X-2]=arguments[X];if(1===H.length&&"string"==typeof H[0])return{vnodeSelector:W,properties:B||void 0,children:void 0,text:H[0],domNode:null};var te=[];return G(H,te),{vnodeSelector:W,properties:B||void 0,children:te,text:void 0,domNode:null}}(W,B,...H):W(B,...H)}},81431:(nt,Ae,v)=>{"use strict";v.d(Ae,{$X:()=>R,ZJ:()=>X,dh:()=>$});var D=v(54024);const R=Symbol("widget"),G=[],Z={},Q=new WeakMap;function $(te,ae){let oe=ae.children;if(oe&&oe.length)for(let de=0;de<oe.length;++de)oe[de]=$(te,oe[de]);else oe=G;const le=ae.vnodeSelector;if(X(le)){const de=ae.properties||Z,se=de.key||le;return{vnodeSelector:"div",properties:{key:se,afterCreate:W,afterUpdate:B,afterRemoved:H,parentWidget:te,widgetConstructor:le,widgetProperties:{...de,key:se,children:oe}},children:void 0,text:void 0,domNode:null}}return ae}function W(te,ae,oe,{parentWidget:le,widgetConstructor:de,widgetProperties:se}){const re=new de(se);re.container=te,Q.set(te,re),re.afterCreate?.(re,te),le._internalHandles.add((0,D.kB)(()=>H(te)))}function B(te,ae,oe,{widgetProperties:le}){const de=Q.get(te);de&&(de.set(le),de.afterUpdate?.(de,te))}function H(te){const ae=Q.get(te);ae&&(ae.destroy(),Q.delete(te))}function X(te){return"function"==typeof te&&te[R]}},66950:(nt,Ae,v)=>{"use strict";v.d(Ae,{KF:()=>Z,O9:()=>G,Uy:()=>R,w7:()=>Q});const D=new Map;function R(){D.clear()}function G($){return D.get($)}function Z($,W){D.set($,W)}function Q($){D.delete($)}},25469:(nt,Ae,v)=>{"use strict";function Z($){return $&&"function"==typeof $.render}function Q($){return $&&"function"==typeof $.postMixInProperties&&"function"==typeof $.buildRendering&&"function"==typeof $.postCreate&&"function"==typeof $.startup}v.d(Ae,{Qd:()=>Z,o:()=>Q}),v(24940),v(94450),v(38570)},38570:(nt,Ae,v)=>{"use strict";v.d(Ae,{Sh:()=>Dt,vU:()=>Or,pV:()=>tr,pf:()=>fs,dZ:()=>At,w3:()=>Ir,Yo:()=>_r});var R={exports:{}},G={},Z={exports:{}},Q={};function $(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var H=/javascript\s*\:/gim;Q.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},Q.getDefaultWhiteList=$,Q.onAttr=function W(at,bt,gt){},Q.onIgnoreAttr=function B(at,bt,gt){},Q.safeAttrValue=function X(at,bt){return H.test(bt)?"":bt};var ae_trim=function(at){return String.prototype.trim?at.trim():at.replace(/(^\s*)|(\s*$)/g,"")},ae_trimRight=function(at){return String.prototype.trimRight?at.trimRight():at.replace(/(\s*$)/g,"")},de=Q;function re(at){return null==at}function Y(at){(at=function j(at){var bt={};for(var gt in at)bt[gt]=at[gt];return bt}(at||{})).whiteList=at.whiteList||de.whiteList,at.onAttr=at.onAttr||de.onAttr,at.onIgnoreAttr=at.onIgnoreAttr||de.onIgnoreAttr,at.safeAttrValue=at.safeAttrValue||de.safeAttrValue,this.options=at}Y.prototype.process=function(at){if(!(at=(at=at||"").toString()))return"";var gt=this.options,Gt=gt.whiteList,fr=gt.onAttr,Ar=gt.onIgnoreAttr,us=gt.safeAttrValue;return function oe(at,bt){";"!==(at=ae_trimRight(at))[at.length-1]&&(at+=";");var gt=at.length,Gt=!1,fr=0,Ar=0,us="";function as(){if(!Gt){var xs=ae_trim(at.slice(fr,Ar)),Ws=xs.indexOf(":");if(-1!==Ws){var yi=ae_trim(xs.slice(0,Ws)),hn=ae_trim(xs.slice(Ws+1));if(yi){var oi=bt(fr,us.length,yi,hn,xs);oi&&(us+=oi+"; ")}}}fr=Ar+1}for(;Ar<gt;Ar++){var Ps=at[Ar];if("/"===Ps&&"*"===at[Ar+1]){var Fs=at.indexOf("*/",Ar+2);if(-1===Fs)break;fr=(Ar=Fs+1)+1,Gt=!1}else"("===Ps?Gt=!0:")"===Ps?Gt=!1:";"===Ps?Gt||as():"\n"===Ps&&as()}return ae_trim(us)}(at,function(Ps,Fs,xs,Ws,yi){var hn=Gt[xs],oi=!1;if(!0===hn?oi=hn:"function"==typeof hn?oi=hn(Ws):hn instanceof RegExp&&(oi=hn.test(Ws)),!0!==oi&&(oi=!1),Ws=us(xs,Ws)){var pn,kn={position:Fs,sourcePosition:Ps,source:yi,isWhite:oi};if(oi)return re(pn=fr(xs,Ws,kn))?xs+":"+Ws:pn;if(!re(pn=Ar(xs,Ws,kn)))return pn}})};var ee=Y;!function(at,bt){var gt=Q,Gt=ee;for(var Ar in(bt=at.exports=function fr(us,as){return new Gt(as).process(us)}).FilterCSS=Gt,gt)bt[Ar]=gt[Ar]}(Z,Z.exports);var ie={indexOf:function(at,bt){var gt,Gt;if(Array.prototype.indexOf)return at.indexOf(bt);for(gt=0,Gt=at.length;gt<Gt;gt++)if(at[gt]===bt)return gt;return-1},forEach:function(at,bt,gt){var Gt,fr;if(Array.prototype.forEach)return at.forEach(bt,gt);for(Gt=0,fr=at.length;Gt<fr;Gt++)bt.call(gt,at[Gt],Gt,at)},trim:function(at){return String.prototype.trim?at.trim():at.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(at){var gt=/\s|\n|\t/.exec(at);return gt?gt.index:-1}},ce=Z.exports.getDefaultWhiteList,ue=ie;var he=new(0,Z.exports.FilterCSS);function De(at){return at.replace(Se,"&lt;").replace(ye,"&gt;")}var Se=/</g,ye=/>/g,ve=/"/g,xe=/&quot;/g,ze=/&#([a-zA-Z0-9]*);?/gim,Ke=/&colon;?/gim,We=/&newline;?/gim,Ce=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Be=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Fe=/u\s*r\s*l\s*\(.*/gi;function je(at){return at.replace(ve,"&quot;")}function Re(at){return at.replace(xe,'"')}function He(at){return at.replace(ze,function(gt,Gt){return String.fromCharCode("x"===Gt[0]||"X"===Gt[0]?parseInt(Gt.substr(1),16):parseInt(Gt,10))})}function Ie(at){return at.replace(Ke,":").replace(We," ")}function Ge(at){for(var bt="",gt=0,Gt=at.length;gt<Gt;gt++)bt+=at.charCodeAt(gt)<32?" ":at.charAt(gt);return ue.trim(bt)}function Pe(at){return Ge(at=Ie(at=He(at=Re(at))))}function Le(at){return De(at=je(at))}G.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},G.getDefaultWhiteList=function pe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},G.onTag=function me(at,bt,gt){},G.onIgnoreTag=function ge(at,bt,gt){},G.onTagAttr=function _e(at,bt,gt){},G.onIgnoreTagAttr=function Ee(at,bt,gt){},G.safeAttrValue=function be(at,bt,gt,Gt){if(gt=Pe(gt),"href"===bt||"src"===bt){if("#"===(gt=ue.trim(gt)))return"#";if("http://"!==gt.substr(0,7)&&"https://"!==gt.substr(0,8)&&"mailto:"!==gt.substr(0,7)&&"tel:"!==gt.substr(0,4)&&"data:image/"!==gt.substr(0,11)&&"ftp://"!==gt.substr(0,6)&&"./"!==gt.substr(0,2)&&"../"!==gt.substr(0,3)&&"#"!==gt[0]&&"/"!==gt[0])return""}else if("background"===bt){if(Ce.lastIndex=0,Ce.test(gt))return""}else if("style"===bt){if(Be.lastIndex=0,Be.test(gt)||(Fe.lastIndex=0,Fe.test(gt)&&(Ce.lastIndex=0,Ce.test(gt))))return"";!1!==Gt&&(gt=(Gt=Gt||he).process(gt))}return Le(gt)},G.escapeHtml=De,G.escapeQuote=je,G.unescapeQuote=Re,G.escapeHtmlEntities=He,G.escapeDangerHtml5Entities=Ie,G.clearNonPrintableCharacter=Ge,G.friendlyAttrValue=Pe,G.escapeAttrValue=Le,G.onIgnoreTagStripAll=function Me(){return""},G.StripTagBody=function Ne(at,bt){"function"!=typeof bt&&(bt=function(){});var gt=!Array.isArray(at),fr=[],Ar=!1;return{onIgnoreTag:function(us,as,Ps){if(function Gt(us){return!!gt||-1!==ue.indexOf(at,us)}(us)){if(Ps.isClosing){var Fs="[/removed]";return fr.push([!1!==Ar?Ar:Ps.position,Ps.position+Fs.length]),Ar=!1,Fs}return Ar||(Ar=Ps.position),"[removed]"}return bt(us,as,Ps)},remove:function(us){var as="",Ps=0;return ue.forEach(fr,function(Fs){as+=us.slice(Ps,Fs[0]),Ps=Fs[1]}),as+=us.slice(Ps)}}},G.stripCommentTag=function Xe(at){for(var bt="",gt=0;gt<at.length;){var Gt=at.indexOf("\x3c!--",gt);if(-1===Gt){bt+=at.slice(gt);break}bt+=at.slice(gt,Gt);var fr=at.indexOf("--\x3e",Gt);if(-1===fr)break;gt=fr+3}return bt},G.stripBlankChar=function Ye(at){var bt=at.split("");return(bt=bt.filter(function(gt){var Gt=gt.charCodeAt(0);return!(127===Gt||Gt<=31&&10!==Gt&&13!==Gt)})).join("")},G.cssFilter=he,G.getDefaultCSSWhiteList=ce;var Je={},rt=ie;function tt(at){var gt,bt=rt.spaceIndex(at);return gt=at.slice(1,-1===bt?-1:bt+1),"/"===(gt=rt.trim(gt).toLowerCase()).slice(0,1)&&(gt=gt.slice(1)),"/"===gt.slice(-1)&&(gt=gt.slice(0,-1)),gt}function et(at){return"</"===at.slice(0,2)}var ot=/[^a-zA-Z0-9\\_:.-]/gim;function _t(at,bt){for(;bt<at.length;bt++){var gt=at[bt];if(" "!==gt)return"="===gt?bt:-1}}function Ct(at,bt){for(;bt<at.length;bt++){var gt=at[bt];if(" "!==gt)return"'"===gt||'"'===gt?bt:-1}}function vt(at,bt){for(;bt>0;bt--){var gt=at[bt];if(" "!==gt)return"="===gt?bt:-1}}function jt(at){return function Lt(at){return'"'===at[0]&&'"'===at[at.length-1]||"'"===at[0]&&"'"===at[at.length-1]}(at)?at.substr(1,at.length-2):at}Je.parseTag=function qe(at,bt,gt){var Gt="",fr=0,Ar=!1,us=!1,as=0,Ps=at.length,Fs="",xs="";e:for(as=0;as<Ps;as++){var Ws=at.charAt(as);if(!1===Ar){if("<"===Ws){Ar=as;continue}}else if(!1===us){if("<"===Ws){Gt+=gt(at.slice(fr,as)),Ar=as,fr=as;continue}if(">"===Ws){Gt+=gt(at.slice(fr,Ar)),Fs=tt(xs=at.slice(Ar,as+1)),Gt+=bt(Ar,Gt.length,Fs,xs,et(xs)),fr=as+1,Ar=!1;continue}if('"'===Ws||"'"===Ws)for(var yi=1,hn=at.charAt(as-yi);""===hn.trim()||"="===hn;){if("="===hn){us=Ws;continue e}hn=at.charAt(as-++yi)}}else if(Ws===us){us=!1;continue}}return fr<at.length&&(Gt+=gt(at.substr(fr))),Gt},Je.parseAttr=function ut(at,bt){var gt=0,Gt=0,fr=[],Ar=!1,us=at.length;function as(yi,hn){if(!((yi=(yi=rt.trim(yi)).replace(ot,"").toLowerCase()).length<1)){var oi=bt(yi,hn||"");oi&&fr.push(oi)}}for(var Ps=0;Ps<us;Ps++){var Ws,Fs=at.charAt(Ps);if(!1!==Ar||"="!==Fs)if(!1===Ar||Ps!==Gt){if(/\s|\n|\t/.test(Fs)){if(at=at.replace(/\s|\n|\t/g," "),!1===Ar){if(-1===(Ws=_t(at,Ps))){as(rt.trim(at.slice(gt,Ps))),Ar=!1,gt=Ps+1;continue}Ps=Ws-1;continue}if(-1===(Ws=vt(at,Ps-1))){as(Ar,jt(rt.trim(at.slice(gt,Ps)))),Ar=!1,gt=Ps+1;continue}}}else{if(-1===(Ws=at.indexOf(Fs,Ps+1)))break;as(Ar,rt.trim(at.slice(Gt+1,Ws))),Ar=!1,gt=(Ps=Ws)+1}else Ar=at.slice(gt,Ps),Gt='"'===at.charAt(gt=Ps+1)||"'"===at.charAt(gt)?gt:Ct(at,Ps+1)}return gt<at.length&&(!1===Ar?as(at.slice(gt)):as(Ar,jt(rt.trim(at.slice(gt))))),rt.trim(fr.join(" "))};var $t=Z.exports.FilterCSS,Wt=G,gr=Je.parseTag,ar=Je.parseAttr,Fr=ie;function mr(at){return null==at}function rr(at){(at=function or(at){var bt={};for(var gt in at)bt[gt]=at[gt];return bt}(at||{})).stripIgnoreTag&&(at.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),at.onIgnoreTag=Wt.onIgnoreTagStripAll),at.whiteList=at.whiteList||at.allowList?function sr(at){var bt={};for(var gt in at)Array.isArray(at[gt])?bt[gt.toLowerCase()]=at[gt].map(function(Gt){return Gt.toLowerCase()}):bt[gt.toLowerCase()]=at[gt];return bt}(at.whiteList||at.allowList):Wt.whiteList,at.onTag=at.onTag||Wt.onTag,at.onTagAttr=at.onTagAttr||Wt.onTagAttr,at.onIgnoreTag=at.onIgnoreTag||Wt.onIgnoreTag,at.onIgnoreTagAttr=at.onIgnoreTagAttr||Wt.onIgnoreTagAttr,at.safeAttrValue=at.safeAttrValue||Wt.safeAttrValue,at.escapeHtml=at.escapeHtml||Wt.escapeHtml,this.options=at,!1===at.css?this.cssFilter=!1:(at.css=at.css||{},this.cssFilter=new $t(at.css))}rr.prototype.process=function(at){if(!(at=(at=at||"").toString()))return"";var gt=this.options,Gt=gt.whiteList,fr=gt.onTag,Ar=gt.onIgnoreTag,us=gt.onTagAttr,as=gt.onIgnoreTagAttr,Ps=gt.safeAttrValue,Fs=gt.escapeHtml,xs=this.cssFilter;gt.stripBlankChar&&(at=Wt.stripBlankChar(at)),gt.allowCommentTag||(at=Wt.stripCommentTag(at));var Ws=!1;gt.stripIgnoreTagBody&&(Ws=Wt.StripTagBody(gt.stripIgnoreTagBody,Ar),Ar=Ws.onIgnoreTag);var yi=gr(at,function(hn,oi,kn,pn,Bl){var yo={sourcePosition:hn,position:oi,isClosing:Bl,isWhite:Object.prototype.hasOwnProperty.call(Gt,kn)},Yo=fr(kn,pn,yo);if(!mr(Yo))return Yo;if(yo.isWhite){if(yo.isClosing)return"</"+kn+">";var qi=function wt(at){var bt=Fr.spaceIndex(at);if(-1===bt)return{html:"",closing:"/"===at[at.length-2]};var gt="/"===(at=Fr.trim(at.slice(bt+1,-1)))[at.length-1];return gt&&(at=Fr.trim(at.slice(0,-1))),{html:at,closing:gt}}(pn),jr=Gt[kn],Gi=ar(qi.html,function(ui,zn){var kt=-1!==Fr.indexOf(jr,ui),Qt=us(kn,ui,zn,kt);return mr(Qt)?kt?(zn=Ps(kn,ui,zn,xs))?ui+'="'+zn+'"':ui:mr(Qt=as(kn,ui,zn,kt))?void 0:Qt:Qt});return pn="<"+kn,Gi&&(pn+=" "+Gi),qi.closing&&(pn+=" /"),pn+">"}return mr(Yo=Ar(kn,pn,yo))?Fs(pn):Yo},Fs);return Ws&&(yi=Ws.remove(yi)),yi};var Et=rr;!function(at,bt){var gt=G,Gt=Je,fr=Et;function Ar(as,Ps){return new fr(Ps).process(as)}(bt=at.exports=Ar).filterXSS=Ar,bt.FilterXSS=fr,function(){for(var as in gt)bt[as]=gt[as];for(var Ps in Gt)bt[Ps]=Gt[Ps]}(),function us(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}()&&(self.filterXSS=at.exports)}(R,R.exports);var Dr,Lr,St=function(){function at(bt,gt){var fr,Gt=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(Ar,us,as,Ps){return"a"===Ar&&"href"===us||("img"===Ar||"source"===Ar)&&"src"===us?Gt.sanitizeUrl(as):R.exports.safeAttrValue(Ar,us,as,Ps)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},bt&&!gt?fr=bt:bt&&gt?(fr=Object.create(this.arcgisFilterOptions),Object.keys(bt).forEach(function(Ar){"whiteList"===Ar?fr.whiteList=Gt._extendObjectOfArrays([Gt.arcgisWhiteList,bt.whiteList||{}]):fr[Ar]=bt[Ar]})):(fr=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=fr,this._xssFilter=new R.exports.FilterXSS(fr)}return at.prototype.sanitize=function(bt,gt){switch(void 0===gt&&(gt={}),typeof bt){case"number":return isNaN(bt)||!isFinite(bt)?null:bt;case"boolean":return bt;case"string":return this._xssFilter.process(bt);case"object":return this._iterateOverObject(bt,gt);default:return gt.allowUndefined&&typeof bt>"u"?void 0:null}},at.prototype.sanitizeUrl=function(bt,gt){var Gt=(gt??{}).isProtocolRequired,fr=void 0===Gt||Gt,Ar=this._trim(bt.substring(0,bt.indexOf(":"))),us="/"===bt,as=/^#/.test(bt),Ps=Ar&&this.allowedProtocols.indexOf(Ar.toLowerCase())>-1;return us||as||Ps?R.exports.escapeAttrValue(bt):Ar||fr?"":R.exports.escapeAttrValue("https://".concat(bt))},at.prototype.sanitizeHTMLAttribute=function(bt,gt,Gt,fr){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(bt,gt,Gt,fr):R.exports.safeAttrValue(bt,gt,Gt,fr)},at.prototype.validate=function(bt,gt){void 0===gt&&(gt={});var Gt=this.sanitize(bt,gt);return{isValid:bt===Gt,sanitized:Gt}},at.prototype.encodeHTML=function(bt){var gt=this;return String(bt).replace(/[&<>"'\/]/g,function(Gt){return gt._entityMap[Gt]})},at.prototype.encodeAttrValue=function(bt){var gt=/^[a-zA-Z0-9]$/;return String(bt).replace(/[\x00-\xFF]/g,function(Gt,fr){return gt.test(Gt)?Gt:"&#x".concat(Number(bt.charCodeAt(fr)).toString(16),";")})},at.prototype._extendObjectOfArrays=function(bt){var gt={};return bt.forEach(function(Gt){Object.keys(Gt).forEach(function(fr){gt[fr]=Array.isArray(Gt[fr])&&Array.isArray(gt[fr])?gt[fr].concat(Gt[fr]):Gt[fr]})}),gt},at.prototype._iterateOverObject=function(bt,gt){var Gt=this;void 0===gt&&(gt={});try{var fr=!1,Ar=void 0;if(Array.isArray(bt))Ar=bt.reduce(function(as,Ps){var Fs=Gt.validate(Ps,gt);return Fs.isValid?as.concat([Ps]):(fr=!0,as.concat([Fs.sanitized]))},[]);else{if(!function(at){if("object"!=typeof at||null===at||"[object Object]"!==Object.prototype.toString.call(at))return!1;var bt=Object.getPrototypeOf(at);if(null===bt)return!0;for(;null!==Object.getPrototypeOf(bt);)bt=Object.getPrototypeOf(bt);return Object.getPrototypeOf(at)===bt}(bt))return gt.allowUndefined&&typeof bt>"u"?void 0:null;Ar=Object.keys(bt).reduce(function(as,Ps){var Fs=bt[Ps],xs=Gt.validate(Fs,gt);return xs.isValid?as[Ps]=Fs:(fr=!0,as[Ps]=xs.sanitized),as},{})}return fr?Ar:bt}catch{return null}},at.prototype._trim=function(bt){return String.prototype.trim?bt.trim():bt.replace(/(^\s*)|(\s*$)/g,"")},at}(),Ft=v(35575),hr=(v(54024),v(8314),v(63290)),Tr=v(66950),Qr=function(at){Dr||function(at){if("WebkitTransition"in at.style)Dr="webkitTransitionEnd",Lr="webkitAnimationEnd";else{if(!("transition"in at.style))throw new Error("Your browser is not supported!");Dr="transitionend",Lr="animationend"}}(at)},Jr=function(at,bt){return void 0===bt&&(bt=at+"-active"),function(gt){Qr(gt);var Gt=!1,fr=function(Ar){Gt||(Gt=!0,gt.removeEventListener(Dr,fr),gt.removeEventListener(Lr,fr),gt.classList.remove(at),gt.classList.remove(bt))};gt.classList.add(at),gt.addEventListener(Dr,fr),gt.addEventListener(Lr,fr),requestAnimationFrame(function(){gt.classList.add(bt)})}},Ss=function(at,bt){return void 0===bt&&(bt=at+"-active"),function(gt,Gt){Qr(gt);var fr=!1,Ar=function(us){fr||(fr=!0,gt.removeEventListener(Dr,Ar),gt.removeEventListener(Lr,Ar),Gt())};gt.classList.add(at),gt.addEventListener(Dr,Ar),gt.addEventListener(Lr,Ar),requestAnimationFrame(function(){gt.classList.add(bt)})}};hr.Z.getLogger("esri.widgets.support.widgetUtils");function Dt(at){const bt=Ft.Z.acquire();for(let Gt=0;Gt<arguments.length;Gt++){const fr=arguments[Gt],Ar=typeof fr;if("string"===Ar)bt.push(fr);else if(Array.isArray(fr))bt.push.apply(bt,fr);else if("object"===Ar)for(const us in fr)fr[us]&&bt.push(us)}const gt=bt.join(" ");return Ft.Z.release(bt),gt}function At(at){const bt=at?.closest("[dir]");return null!==bt&&bt instanceof HTMLElement&&"rtl"===bt.dir||"rtl"===document.dir}function tr(at){this[at.getAttribute("data-node-ref")]=null}function _r(at){this[at.getAttribute("data-node-ref")]=at}function Or(at,bt){return("enter"===at?Jr:Ss)(bt)}(()=>{const at=new Map;new ResizeObserver(gt=>{(0,Tr.Uy)();for(const Gt of gt)at.get(Gt.target)?.(Gt)})})();const Kr=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce((at,bt)=>(at[bt]=[],at),{}),qt=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Ir=new St({whiteList:Kr,onTagAttr:(at,bt,gt)=>{const Gt=`${bt}="${gt}"`;if(qt.includes(bt))return Gt},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function fs(at){return"Enter"===at||" "===at}},46203:(nt,Ae,v)=>{"use strict";v.d(Ae,{a:()=>R,b:()=>ce,c:()=>X,d:()=>G,f:()=>ee,i:()=>De,o:()=>de,q:()=>le,s:()=>ge,t:()=>Ee});var D=v(15861);const R="calcite-theme-auto",G="calcite-theme-dark";function X(be){const ve=de(be,"[dir]");return ve?ve.getAttribute("dir"):"ltr"}function ae(be){return be.getRootNode()}function oe(be){return be.host||null}function le(be,{selector:Se,id:ye}){return function ve(xe){if(!xe)return null;xe.assignedSlot&&(xe=xe.assignedSlot);const ze=ae(xe),Ke=ye?"getElementById"in ze?ze.getElementById(ye):null:Se?ze.querySelector(Se):null,We=oe(ze);return Ke||(We?ve(We):null)}(be)}function de(be,Se){return function ye(ve){return ve?ve.closest(Se)||ye(oe(ae(ve))):null}(be)}function Y(be){return"function"==typeof be?.setFocus}function ee(be){return ie.apply(this,arguments)}function ie(){return(ie=(0,D.Z)(function*(be){if(be)return Y(be)?be.setFocus():be.focus()})).apply(this,arguments)}const J=":not([slot])";function ce(be,Se,ye){Se&&!Array.isArray(Se)&&"string"!=typeof Se&&(ye=Se,Se=null);const ve=Se?Array.isArray(Se)?Se.map(xe=>`[slot="${xe}"]`).join(","):`[slot="${Se}"]`:J;return ye?.all?function pe(be,Se,ye){let ve=Se===J?ue(be,J):Array.from(be.querySelectorAll(Se));ve=ye&&!1===ye.direct?ve:ve.filter(ze=>ze.parentElement===be),ve=ye?.matches?ve.filter(ze=>ze?.matches(ye.matches)):ve;const xe=ye?.selector;return xe?ve.map(ze=>Array.from(ze.querySelectorAll(xe))).reduce((ze,Ke)=>[...ze,...Ke],[]).filter(ze=>!!ze):ve}(be,ve,ye):function he(be,Se,ye){let ve=Se===J?ue(be,J)[0]||null:be.querySelector(Se);ve=ye&&!1===ye.direct||ve?.parentElement===be?ve:null,ve=ye?.matches?ve?.matches(ye.matches)?ve:null:ve;const xe=ye?.selector;return xe?ve?.querySelector(xe):ve}(be,ve,ye)}function ue(be,Se){return be?Array.from(be.children||[]).filter(ye=>ye?.matches(Se)):[]}function ge(be,Se,ye){return"string"==typeof Se&&""!==Se?Se:""===Se?be[ye]:void 0}function Ee(be){return Boolean(be).toString()}function De(be){return!(!be.isPrimary||0!==be.button)}}}]);