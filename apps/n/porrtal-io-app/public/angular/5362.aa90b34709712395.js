/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[5362],{95362:(j,Z,p)=>{p.r(Z),p.d(Z,{applyEdits:()=>C});var m,e,y=p(15861),x=p(88879),f=p(46160),i=p(26584),O=p(58817),h=p(62208),U=p(21726),G=p(35948),L=p(93555),E=p(6733);function T(e){return e&&null!=e.applyEdits}function C(e,t,r){return g.apply(this,arguments)}function g(){return g=(0,y.Z)(function*(e,t,r,n={}){let s,o;const d={edits:r,result:new Promise((a,u)=>{s=a,o=u})};e.emit("apply-edits",d);try{const{results:a,edits:u}=yield B(e,t,r,n),l=M=>M.filter(Y=>!Y.error).map(O.d9),c={edits:u,addedFeatures:l(a.addFeatureResults),updatedFeatures:l(a.updateFeatureResults),deletedFeatures:l(a.deleteFeatureResults),addedAttachments:l(a.addAttachmentResults),updatedAttachments:l(a.updateAttachmentResults),deletedAttachments:l(a.deleteAttachmentResults)};return a.editedFeatureResults?.length&&(c.editedFeatures=a.editedFeatureResults),(c.addedFeatures.length||c.updatedFeatures.length||c.deletedFeatures.length||c.addedAttachments.length||c.updatedAttachments.length||c.deletedAttachments.length)&&(e.emit("edits",c),(0,E.lQ)(e)&&E.dU.emit("edits",{layer:e,event:c})),s(c),a}catch(a){throw o(a),a}}),g.apply(this,arguments)}function B(e,t,r,n){return b.apply(this,arguments)}function b(){return b=(0,y.Z)(function*(e,t,r,n){if(yield e.load(),!T(t))throw new i.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!e.editingEnabled)throw new i.Z(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:s,options:o}=yield D(e,r,n);return s.addFeatures.length||s.updateFeatures.length||s.deleteFeatures.length||s.addAttachments.length||s.updateAttachments.length||s.deleteAttachments.length?{edits:s,results:yield t.applyEdits(s,o)}:{edits:s,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),b.apply(this,arguments)}function D(e,t,r){return F.apply(this,arguments)}function F(){return F=(0,y.Z)(function*(e,t,r){const n=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),s=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments),o=(0,h.pC)(e.infoFor3D);if(!t||!n&&!s)throw new i.Z(`${e.type}-layer:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!e.capabilities.data.isVersioned&&r&&r.gdbVersion)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!e.capabilities.editing.supportsRollbackOnFailure&&r&&r.rollbackOnFailureEnabled)throw new i.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");if(!e.capabilities.editing.supportsGlobalId&&r&&r.globalIdUsed)throw new i.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!e.capabilities.editing.supportsGlobalId&&s)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((!r||!r.globalIdUsed)&&s)throw new i.Z(`${e.type}-layer:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true");const d={...r};if(null!=d.rollbackOnFailureEnabled||e.capabilities.editing.supportsRollbackOnFailure||(d.rollbackOnFailureEnabled=!0),!1===d.rollbackOnFailureEnabled&&"original-and-current-features"===d.returnServiceEditsOption)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true.");if(!e.capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference&&d.returnServiceEditsInSourceSR)throw new i.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(d.returnServiceEditsInSourceSR&&"original-and-current-features"!==d.returnServiceEditsOption)throw new i.Z(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsOption' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const a={...t};if(a.addFeatures=t&&f.Z.isCollection(t.addFeatures)?t.addFeatures.toArray():a.addFeatures||[],a.updateFeatures=t&&f.Z.isCollection(t.updateFeatures)?t.updateFeatures.toArray():a.updateFeatures||[],a.deleteFeatures=t&&f.Z.isCollection(t.deleteFeatures)?t.deleteFeatures.toArray():a.deleteFeatures||[],a.addFeatures.length&&!e.capabilities.operations.supportsAdd)throw new i.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support adding features.");if(a.updateFeatures.length&&!e.capabilities.operations.supportsUpdate)throw new i.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support updating features.");if(a.deleteFeatures.length&&!e.capabilities.operations.supportsDelete)throw new i.Z(`${e.type}-layer:unsupported-operation`,"Layer does not support deleting features.");a.addAttachments=a.addAttachments||[],a.updateAttachments=a.updateAttachments||[],a.deleteAttachments=a.deleteAttachments||[],a.addFeatures=a.addFeatures.map(S),a.updateFeatures=a.updateFeatures.map(S),a.addAssets=[];const u=r&&r.globalIdUsed||o;return a.addFeatures.forEach(l=>W(l,e,u)),a.updateFeatures.forEach(l=>k(l,e,u)),a.deleteFeatures.forEach(l=>N(l,e,u)),a.addAttachments.forEach(l=>$(l,e)),a.updateAttachments.forEach(l=>$(l,e)),o&&(yield V(a,e)),{edits:yield z(a),options:d}}),F.apply(this,arguments)}function w(e,t,r){if(r){if("attributes"in e&&!e.attributes[t.globalIdField])throw new i.Z(`${t.type}-layer:invalid-parameter`,"Feature should have 'globalId' when 'globalIdUsed' is true");if(!("attributes"in e)&&!e.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"'globalId' of the feature should be passed when 'globalIdUsed' is true")}if("geometry"in e&&(0,h.pC)(e.geometry)){if(e.geometry.hasZ&&!1===t.capabilities.data.supportsZ)throw new i.Z(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities.data.supportsM)throw new i.Z(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function W(e,t,r){w(e,t,r)}function N(e,t,r){w(e,t,r)}function k(e,t,r){if(w(e,t,r),"geometry"in e&&(0,h.pC)(e.geometry)&&!t.capabilities.editing.supportsGeometryUpdate)throw new i.Z(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}function $(e,t){const{feature:r,attachment:n}=e;if(!r||"attributes"in r&&!r.attributes[t.globalIdField])throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in r)&&!r.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!n.globalId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!n.data&&!n.uploadId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(n.data instanceof File&&n.data.name||n.name))throw new i.Z(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities.editing.supportsUploadWithItemId&&n.uploadId)throw new i.Z(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof n.data){const s=(0,U.sJ)(n.data);if(s&&!s.isBase64)throw new i.Z(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function z(e){return A.apply(this,arguments)}function A(){return A=(0,y.Z)(function*(e){const t=e.addFeatures,r=e.updateFeatures,n=t.concat(r).map(a=>a.geometry),s=yield(0,L.aX)(n),o=t.length,d=r.length;return s.slice(0,o).forEach((a,u)=>e.addFeatures[u].geometry=a),s.slice(o,o+d).forEach((a,u)=>e.updateFeatures[u].geometry=a),e}),A.apply(this,arguments)}function S(e){const t=new x.Z;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function V(e,t){return v.apply(this,arguments)}function v(){return v=(0,y.Z)(function*(e,t){if((0,h.Wi)(t.infoFor3D))return;const{infoFor3D:r}=t;let n=!1;for(const d of r.editFormats)if(d===m.GLTF_BINARY){n=!0;break}const s=[];for(const d of e.addFeatures)s.push(R(d,e,t,n));for(const d of e.updateFeatures)s.push(R(d,e,t,n));const o=yield Promise.allSettled(s);for(const d of o)if("rejected"===d.status)throw d.reason}),v.apply(this,arguments)}function R(e,t,r,n){return I.apply(this,arguments)}function I(){return I=(0,y.Z)(function*(e,t,r,n){if((0,h.Wi)(e.geometry)||"mesh"!==e.geometry.type)return;const s=e.geometry,o=r.globalIdField;if((0,h.pC)(r.parsedUrl)&&(0,h.pC)(s.external)&&Array.isArray(s.external.source)&&1===s.external.source.length&&"source"in s.external.source[0]&&"string"==typeof s.external.source[0].source&&s.external.source[0].source.startsWith(r.parsedUrl.path))return;if(!n)throw new i.Z(`${r.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");const d=yield s.toBinaryGLTF(),a=yield d.buffer(),u=`{${(0,G.D)()}}`,l=`${u}.glb`;t.addAssets.push({featureGlobalId:e.getAttribute(o),assetMapGlobalId:u,assetName:l,flags:0,data:a.data,mimeType:a.type,assetType:m.GLTF_BINARY,feature:e})}),I.apply(this,arguments)}(e=m||(m={})).GLTF_BINARY="3D_glb",e.GLTF_JSON="3D_gltf"}}]);