"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[114],{87757:(N,_,u)=>{u.d(_,{g:()=>c});const c={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},30114:(N,_,u)=>{u.r(_),u.d(_,{default:()=>le});var c=u(15861),m=u(17626),I=(u(29132),u(88879)),F=u(84792),x=u(97478),R=u(26584),O=u(8314),b=u(2076),Z=u(47996),y=u(62208),S=u(94113),A=u(10699),j=u(21726),g=u(77712),L=(u(85931),u(90912),u(76898)),z=u(2004),pt=u(91179),Ot=u(56554),yt=u(15283),St=u(2865),E=u(2618),_t=u(94573),vt=u(33696),ht=u(82054);function It(r,t){return t}function V(r,t,e,s){switch(e){case 0:return Q(r,t+s,0);case 1:return"lowerLeft"===r.originPosition?Q(r,t+s,1):function Ct({translate:r,scale:t},e,s){return r[s]-e*t[s]}(r,t+s,1)}}function ft(r,t,e,s){return 2===e?Q(r,t,2):V(r,t,e,s)}function bt(r,t,e,s){return 2===e?Q(r,t,3):V(r,t,e,s)}function Et(r,t,e,s){return 3===e?Q(r,t,3):ft(r,t,e,s)}function Q({translate:r,scale:t},e,s){return r[s]+e*t[s]}class Tt{constructor(t){this.options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=It,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=()=>{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(t){if(this.options.applyTransform&&(t.transform=null),this._attributesConstructor=()=>{},this.coordinateBuffer=null,this.lengths.length=0,!t.hasZ)return;const e=(0,vt.k)(t.geometryType,this.options.sourceSpatialReference,t.spatialReference);if(!(0,y.Wi)(e))for(const s of t.features)e(s.geometry)}createSpatialReference(){return{}}addField(t,e){t.fields.push(e);const s=t.fields.map(n=>n.name);this._attributesConstructor=function(){for(const n of s)this[n]=null}}addFeature(t,e){t.features.push(e)}prepareFeatures(t){switch(this.transform=t.transform,this.options.applyTransform&&t.transform&&(this.applyTransform=this._deriveApplyTransform(t)),this.vertexDimension=2,t.hasZ&&this.vertexDimension++,t.hasM&&this.vertexDimension++,t.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,s,n)=>this.addCoordinatePoint(e,s,n),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,s,n)=>this._addCoordinatePolygon(e,s,n),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,s,n)=>this._addCoordinatePolyline(e,s,n),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,s,n)=>this._addCoordinateMultipoint(e,s,n),this.createGeometry=e=>this._createMultipointGeometry(e);break;default:(0,_t.Bg)(t.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(t,e,s){0===this.lengths.length&&(this.toAddInCurrentPath=e),this.lengths.push(e)}addQueryGeometry(t,e){const{queryGeometry:s,queryGeometryType:n}=e,i=(0,ht.$g)(s.clone(),s,!1,!1,this.transform),l=(0,ht.di)(i,n,!1,!1);t.queryGeometryType=n,t.queryGeometry={...l}}createPointGeometry(t){const e={x:0,y:0,spatialReference:t.spatialReference};return t.hasZ&&(e.z=0),t.hasM&&(e.m=0),e}addCoordinatePoint(t,e,s){switch(e=this.applyTransform(this.transform,e,s,0),s){case 0:t.x=e;break;case 1:t.y=e;break;case 2:"z"in t?t.z=e:t.m=e;break;case 3:t.m=e}}_transformPathLikeValue(t,e){let s=0;return e<=1&&(s=this.previousCoordinate[e],this.previousCoordinate[e]+=t),this.applyTransform(this.transform,t,e,s)}_addCoordinatePolyline(t,e,s){this._dehydratedAddPointsCoordinate(t.paths,e,s)}_addCoordinatePolygon(t,e,s){this._dehydratedAddPointsCoordinate(t.rings,e,s)}_addCoordinateMultipoint(t,e,s){0===s&&t.points.push([]);const n=this._transformPathLikeValue(e,s);t.points[t.points.length-1].push(n)}_createPolygonGeometry(t){return{rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,e,s){0===s&&0==this.toAddInCurrentPath--&&(t.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const n=this._transformPathLikeValue(e,s),i=t[t.length-1];0===s&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),i.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=n}_deriveApplyTransform(t){const{hasZ:e,hasM:s}=t;return e&&s?Et:e?ft:s?bt:V}}var mt=u(20477),W=u(17253),$=u(84952);function H(){return(H=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r),n={...e},i=$.Z.from(t),l=!i.quantizationParameters,{data:d}=yield(0,mt.executeQueryPBF)(s,i,new Tt({sourceSpatialReference:i.sourceSpatialReference,applyTransform:l}),n);return d})).apply(this,arguments)}var Dt=u(24263),X=u(76391),jt=u(87183);function Zt(r){const t=r.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function Ft(r,t){const e={};for(const s of r){const{parentObjectId:n,parentGlobalId:i,attachmentInfos:l}=s;for(const d of l){const{id:p}=d,h=(0,j.qg)((0,Dt.Dp)(`${t}/${n}/attachments/${p}`)),f=jt.Z.fromJSON(d);f.set({url:h,parentObjectId:n,parentGlobalId:i}),e[n]?e[n].push(f):e[n]=[f]}}return e}function Pt(r,t,e){let s={query:(0,X.A)({...r.query,f:"json",...Zt(t)})};return e&&(s={...e,...s,query:{...e.query,...s.query}}),(0,F.default)(r.path+"/queryAttachments",s)}var At=u(67736);function Y(){return(Y=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r);return Pt(s,At.Z.from(t),{...e}).then(n=>Ft(n.data.attachmentGroups,s.path))})).apply(this,arguments)}var Mt=u(90463);function k(){return(k=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r);return(0,mt.executeQueryForExtent)(s,$.Z.from(t),{...e}).then(n=>({count:n.data.count,extent:z.Z.fromJSON(n.data.extent)}))})).apply(this,arguments)}var Gt=u(24865);function Nt(r,t){const e=r.toJSON();return e.objectIds&&(e.objectIds=e.objectIds.join(",")),e.orderByFields&&(e.orderByFields=e.orderByFields.join(",")),e.outFields&&!t?.returnCountOnly?e.outFields=e.outFields.includes("*")?"*":e.outFields.join(","):delete e.outFields,e.outSpatialReference&&(e.outSR=e.outSR.wkid||JSON.stringify(e.outSR.toJSON()),delete e.outSpatialReference),e.dynamicDataSource&&(e.layer=JSON.stringify({source:e.dynamicDataSource}),delete e.dynamicDataSource),e}function Ut(r,t,e){return w.apply(this,arguments)}function w(){return(w=(0,c.Z)(function*(r,t,e){const s=yield Rt(r,t,e),n=s.data,i=n.geometryType,l=n.spatialReference,d={};for(const p of n.relatedRecordGroups){const h={fields:void 0,objectIdFieldName:void 0,geometryType:i,spatialReference:l,hasZ:!!n.hasZ,hasM:!!n.hasM,features:p.relatedRecords};if(null!=p.objectId)d[p.objectId]=h;else for(const f in p)p.hasOwnProperty(f)&&"relatedRecords"!==f&&(d[p[f]]=h)}return{...s,data:d}})).apply(this,arguments)}function Jt(r,t,e){return tt.apply(this,arguments)}function tt(){return(tt=(0,c.Z)(function*(r,t,e){const s=yield Rt(r,t,e,{returnCountOnly:!0}),n=s.data,i={};for(const l of n.relatedRecordGroups)null!=l.objectId&&(i[l.objectId]=l.count);return{...s,data:i}})).apply(this,arguments)}function Rt(r,t){return et.apply(this,arguments)}function et(){return(et=(0,c.Z)(function*(r,t,e={},s){const n=(0,X.A)({...r.query,f:"json",...s,...Nt(t,s)});return(0,F.default)(r.path+"/queryRelatedRecords",{...e,query:{...e.query,...n}})})).apply(this,arguments)}var U=u(67010);function rt(){return(rt=(0,c.Z)(function*(r,t,e){return t=U.Z.from(t),Ut((0,E.en)(r),t,e).then(n=>{const i=n.data,l={};return Object.keys(i).forEach(d=>l[d]=W.default.fromJSON(i[d])),l})})).apply(this,arguments)}function st(){return(st=(0,c.Z)(function*(r,t,e){return t=U.Z.from(t),Jt((0,E.en)(r),t,{...e}).then(n=>n.data)})).apply(this,arguments)}var zt=u(13924),Vt=u(61515);const xt="Layer does not support extent calculation.";function Wt(r,t){const e=r.geometry,s=r.toJSON(),n=s;if((0,y.pC)(e)&&(n.geometry=JSON.stringify(e),n.geometryType=(0,pt.Ji)(e),n.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference)),s.topFilter?.groupByFields&&(n.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),s.topFilter?.orderByFields&&(n.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(n.topFilter=JSON.stringify(n.topFilter)),s.objectIds&&(n.objectIds=s.objectIds.join(",")),s.orderByFields&&(n.orderByFields=s.orderByFields.join(",")),s.outFields&&!(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?n.outFields=s.outFields.includes("*")?"*":s.outFields.join(","):delete n.outFields,s.outSR?n.outSR=s.outSR.wkid||JSON.stringify(s.outSR):e&&s.returnGeometry&&(n.outSR=n.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){const i=s.timeExtent,{start:l,end:d}=i;null==l&&null==d||(n.time=l===d?l:`${l??"null"},${d??"null"}`),delete s.timeExtent}return n}function $t(r,t,e,s){return nt.apply(this,arguments)}function nt(){return(nt=(0,c.Z)(function*(r,t,e,s){const n=yield J(r,t,"json",s);return(0,Vt.p)(t,e,n.data),n})).apply(this,arguments)}function Kt(r,t,e){return ot.apply(this,arguments)}function ot(){return(ot=(0,c.Z)(function*(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:J(r,t,"json",e,{returnIdsOnly:!0})})).apply(this,arguments)}function Ht(r,t,e){return at.apply(this,arguments)}function at(){return(at=(0,c.Z)(function*(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:J(r,t,"json",e,{returnExtentOnly:!0,returnCountOnly:!0}).then(s=>{const n=s.data;if(n.hasOwnProperty("extent"))return s;if(n.features)throw new Error(xt);if(n.hasOwnProperty("count"))throw new Error(xt);return s})})).apply(this,arguments)}function Xt(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):J(r,t,"json",e,{returnIdsOnly:!0,returnCountOnly:!0})}function J(r,t,e,s={},n={}){const i="string"==typeof r?(0,j.mN)(r):r,l=t.geometry?[t.geometry]:[];return s.responseType="pbf"===e?"array-buffer":"json",(0,zt.aX)(l,null,s).then(d=>{const p=d&&d[0];(0,y.pC)(p)&&((t=t.clone()).geometry=p);const h=(0,X.A)({...i.query,f:e,...n,...Wt(t,n)});return(0,F.default)((0,j.v_)(i.path,"queryTopFeatures"),{...s,query:{...h,...s.query}})})}var B=u(6871);function it(){return(it=(0,c.Z)(function*(r,t,e,s){const n=(0,E.en)(r),i={...s},{data:l}=yield $t(n,B.Z.from(t),e,i);return W.default.fromJSON(l)})).apply(this,arguments)}function ut(){return(ut=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r);return(yield Kt(s,B.Z.from(t),{...e})).data.objectIds})).apply(this,arguments)}function lt(){return(lt=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r),n=yield Ht(s,B.Z.from(t),{...e});return{count:n.data.count,extent:z.Z.fromJSON(n.data.extent)}})).apply(this,arguments)}function dt(){return(dt=(0,c.Z)(function*(r,t,e){const s=(0,E.en)(r);return(yield Xt(s,B.Z.from(t),{...e})).data.count})).apply(this,arguments)}var ee=u(14517);let q=class extends ee.Z{constructor(...r){super(...r),this.requestOptions=null,this.url=null}normalizeCtorArgs(r,t){return"string"!=typeof r?r:{url:r,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(r){return r?(0,j.mN)(r):null}_encode(r,t,e){const s={};for(const n in r){if("declaredClass"===n)continue;const i=r[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){s[n]=[];for(let l=0;l<i.length;l++)s[n][l]=this._encode(i[l])}else if("object"==typeof i)if(i.toJSON){const l=i.toJSON(e&&e[n]);s[n]=t?l:JSON.stringify(l)}else s[n]=t?i:JSON.stringify(i);else s[n]=i}return s}};(0,m._)([(0,g.Cb)({readOnly:!0})],q.prototype,"parsedUrl",null),(0,m._)([(0,g.Cb)()],q.prototype,"requestOptions",void 0),(0,m._)([(0,g.Cb)({type:String})],q.prototype,"url",void 0),q=(0,m._)([(0,L.j)("esri.tasks.Task")],q);const re=q;let C=class extends re{constructor(r){super(r),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(r,t){return this.executeJSON(r,t).then(e=>this.featureSetFromJSON(r,e,t))}executeJSON(r,t){var e=this;return(0,c.Z)(function*(){const s={...e.requestOptions,...t},n=e._normalizeQuery(r),i=null!=r.outStatistics?.[0],l=(0,O.Z)("featurelayer-pbf-statistics"),d=!i||l;let p;if("pbf"===e.format&&d)try{p=yield function gt(r,t,e){return H.apply(this,arguments)}(e.url,n,s)}catch(h){if("query:parsing-pbf"!==h.name)throw h;e.format="json"}return"json"!==e.format&&d||(p=yield(0,St.F)(e.url,n,s)),e._normalizeFields(p.fields),p})()}featureSetFromJSON(r,t,e){var s=this;return(0,c.Z)(function*(){if(!s._queryIs3DObjectFormat(r)||(0,y.Wi)(s.infoFor3D)||!t.features||!t.features.length)return W.default.fromJSON(t);const{meshFeatureSetFromJSON:n}=yield(0,A.Hl)(Promise.all([u.e(8592),u.e(2579)]).then(u.bind(u,42579)),e);return n(r,s.infoFor3D,t)})()}executeForCount(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return(0,Mt.P)(this.url,s,e)}executeForExtent(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return function Qt(r,t,e){return k.apply(this,arguments)}(this.url,s,e)}executeForIds(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return(0,Gt.G)(this.url,s,e)}executeRelationshipQuery(r,t){r=U.Z.from(r);const e={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function Bt(r,t,e){return rt.apply(this,arguments)}(this.url,r,e)}executeRelationshipQueryForCount(r,t){r=U.Z.from(r);const e={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function Lt(r,t,e){return st.apply(this,arguments)}(this.url,r,e)}executeAttachmentQuery(r,t){const e={...this.requestOptions,...t};return function qt(r,t,e){return Y.apply(this,arguments)}(this.url,r,e)}executeTopFeaturesQuery(r,t){const e={...this.requestOptions,...t};return function Yt(r,t,e,s){return it.apply(this,arguments)}(this.parsedUrl,r,this.sourceSpatialReference,e)}executeForTopIds(r,t){const e={...this.requestOptions,...t};return function kt(r,t,e){return ut.apply(this,arguments)}(this.parsedUrl,r,e)}executeForTopExtents(r,t){const e={...this.requestOptions,...t};return function wt(r,t,e){return lt.apply(this,arguments)}(this.parsedUrl,r,e)}executeForTopCount(r,t){const e={...this.requestOptions,...t};return function te(r,t,e){return dt.apply(this,arguments)}(this.parsedUrl,r,e)}_normalizeQuery(r){let t=$.Z.from(r);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===r?t.clone():t,t.gdbVersion=r.gdbVersion||this.gdbVersion,t.dynamicDataSource=r.dynamicDataSource?yt.n.from(r.dynamicDataSource):this.dynamicDataSource),(0,y.pC)(this.infoFor3D)&&this._queryIs3DObjectFormat(r)){t=t===r?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e.id){t.formatOf3DObjects=e.id;break}"3D_gltf"!==e.id||t.formatOf3DObjects||(t.formatOf3DObjects=e.id)}if(!t.formatOf3DObjects)throw new R.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,y.Wi)(t.outFields)||!t.outFields.includes("*")){t=t===r?t.clone():t,(0,y.Wi)(t.outFields)&&(t.outFields=[]);const{originX:e,originY:s,originZ:n,translationX:i,translationY:l,translationZ:d,scaleX:p,scaleY:h,scaleZ:f,rotationX:T,rotationY:D,rotationZ:v,rotationDeg:G}=this.infoFor3D.transformFieldRoles;t.outFields.push(e,s,n,i,l,d,p,h,f,T,D,v,G)}}return t}_normalizeFields(r){if((0,y.pC)(this.fieldsIndex)&&(0,y.pC)(r))for(const t of r){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(r){return(0,y.pC)(this.infoFor3D)&&r.returnGeometry&&"xyFootprint"!==r.multipatchOption&&!r.outStatistics}};(0,m._)([(0,g.Cb)({type:yt.n})],C.prototype,"dynamicDataSource",void 0),(0,m._)([(0,g.Cb)()],C.prototype,"fieldsIndex",void 0),(0,m._)([(0,g.Cb)()],C.prototype,"format",void 0),(0,m._)([(0,g.Cb)()],C.prototype,"gdbVersion",void 0),(0,m._)([(0,g.Cb)()],C.prototype,"infoFor3D",void 0),(0,m._)([(0,g.Cb)()],C.prototype,"sourceSpatialReference",void 0),C=(0,m._)([(0,L.j)("esri.tasks.QueryTask")],C);const se=C;var ne=u(20514),oe=u(65234);const ae=new b.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function ct(){return(ct=(0,c.Z)(function*(r){return"string"==typeof r?(0,j.sJ)(r)||{data:r}:new Promise((t,e)=>{const s=new FileReader;s.readAsDataURL(r),s.onload=()=>t((0,j.sJ)(s.result)),s.onerror=n=>e(n)})})).apply(this,arguments)}const ue=new Set(["Feature Layer","Table"]);let M=class extends Z.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,A.Ds)((0,c.Z)(function*(){yield r.load();const t=r.sourceJSON.editingInfo?.lastEditDate;if(null==t)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const e=t!==r.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:e,updates:e?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}}))}load(r){const t=(0,y.pC)(r)?r.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:r}},parsedUrl:t,dynamicDataSource:e,infoFor3D:s,gdbVersion:n,spatialReference:i,fieldsIndex:l}=this.layer,d=(0,O.Z)("featurelayer-pbf")&&r&&(0,y.Wi)(s)?"pbf":"json";return new se({url:t.path,format:d,fieldsIndex:l,infoFor3D:s,dynamicDataSource:e,gdbVersion:n,sourceSpatialReference:i})}addAttachment(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/addAttachment",i=e._getLayerRequestOptions(),l=e._getFormDataForAttachment(t,i.query);try{const d=yield(0,F.default)(n,{body:l});return e._createFeatureEditResult(d.data.addAttachmentResult)}catch(d){throw e._createAttachmentErrorResult(s,d)}})()}updateAttachment(r,t,e){var s=this;return(0,c.Z)(function*(){yield s.load();const n=r.attributes[s.layer.objectIdField],i=s.layer.parsedUrl.path+"/"+n+"/updateAttachment",l=s._getLayerRequestOptions({query:{attachmentId:t}}),d=s._getFormDataForAttachment(e,l.query);try{const p=yield(0,F.default)(i,{body:d});return s._createFeatureEditResult(p.data.updateAttachmentResult)}catch(p){throw s._createAttachmentErrorResult(n,p)}})()}applyEdits(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=r.addFeatures.map(e._serializeFeature,e),n=r.updateFeatures.map(e._serializeFeature,e),i=e._getFeatureIds(r.deleteFeatures,t?.globalIdUsed);(0,ne.P)(s,n,e.layer.spatialReference);const l=[],d=[],p=[...r.deleteAttachments];for(const G of r.addAttachments)l.push(yield e._serializeAttachment(G));for(const G of r.updateAttachments)d.push(yield e._serializeAttachment(G));const h=l.length||d.length||p.length?{adds:l,updates:d,deletes:p}:null,f={gdbVersion:t?.gdbVersion||e.layer.gdbVersion,rollbackOnFailure:t?.rollbackOnFailureEnabled,useGlobalIds:t?.globalIdUsed,returnEditMoment:t?.returnEditMoment,usePreviousEditMoment:t?.usePreviousEditMoment,sessionId:t?.sessionId};t?.returnServiceEditsOption?(f.edits=JSON.stringify([{id:e.layer.layerId,adds:s,updates:n,deletes:i,attachments:h}]),f.returnServiceEditsOption=ae.toJSON(t?.returnServiceEditsOption),f.returnServiceEditsInSourceSR=t?.returnServiceEditsInSourceSR):(f.adds=s.length?JSON.stringify(s):null,f.updates=n.length?JSON.stringify(n):null,f.deletes=i.length?t?.globalIdUsed?JSON.stringify(i):i.join(","):null,f.attachments=h&&JSON.stringify(h));const T=e._getLayerRequestOptions({method:"post",query:f}),D=t?.returnServiceEditsOption?e.layer.url:e.layer.parsedUrl.path,v=yield(0,F.default)(D+"/applyEdits",T);return e._createEditsResult(v)})()}deleteAttachments(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(yield(0,F.default)(n,e._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(e._createFeatureEditResult)}catch(i){throw e._createAttachmentErrorResult(s,i)}})()}fetchRecomputedExtents(r={}){var t=this;return this.load({signal:r.signal}).then((0,c.Z)(function*(){const s=t._getLayerRequestOptions({...r,query:{returnUpdates:!0}}),{layerId:n,url:i}=t.layer,{data:l}=yield(0,F.default)(`${i}/${n}`,s),{id:d,extent:p,fullExtent:h,timeExtent:f}=l,T=p||h;return{id:d,fullExtent:T&&z.Z.fromJSON(T),timeExtent:f&&x.Z.fromJSON({start:f[0],end:f[1]})}}))}queryAttachments(r,t={}){var e=this;return(0,c.Z)(function*(){const{parsedUrl:s}=e.layer,n=s.path;yield e.load();const i=e._getLayerRequestOptions(t);if(!e.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:l}=r,d=[];for(const p of l)d.push((0,F.default)(n+"/"+p+"/attachments",i));return Promise.all(d).then(p=>l.map((h,f)=>({parentObjectId:h,attachmentInfos:p[f].data.attachmentInfos}))).then(p=>Ft(p,n))}return e.queryTask.executeAttachmentQuery(r,i)})()}queryFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.execute(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryFeaturesJSON(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryObjectIds(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryFeatureCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryExtent(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryRelatedFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryRelatedFeaturesCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopObjectIds(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopExtents(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}_createRequestQueryOptions(r){const t={...this.layer.customParameters,token:this.layer.apiKey,...r?.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}_fetchService(r,t){var e=this;return(0,c.Z)(function*(){if(!r){const{data:n}=yield(0,F.default)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:(0,O.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));r=n}e.sourceJSON=e._patchServiceJSON(r);const s=r.type;if(!ue.has(s))throw new R.Z("feature-layer-source:unsupported-type",`Source type "${s}" is not supported`)})()}_patchServiceJSON(r){if("Table"!==r.type&&r.geometryType&&!r?.drawingInfo?.renderer&&!r.defaultSymbol){const t=(0,Ot.bU)(r.geometryType).renderer;(0,S.RB)("drawingInfo.renderer",t,r)}return"esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),r}_serializeFeature(r){const{geometry:t,attributes:e}=r;return(0,y.Wi)(t)?{attributes:e}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:e}}_serializeAttachment(r){var t=this;return(0,c.Z)(function*(){const{feature:e,attachment:s}=r,{globalId:n,name:i,contentType:l,data:d,uploadId:p}=s,h={globalId:n,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(e&&(h.parentGlobalId="attributes"in e?e.attributes&&e.attributes[t.layer.globalIdField]:e.globalId),p)h.uploadId=p;else if(d){const f=yield function ie(r){return ct.apply(this,arguments)}(d);h.contentType=f.mediaType,h.data=f.data,d instanceof File&&(h.name=d.name)}return i&&(h.name=i),l&&(h.contentType=l),h})()}_getFeatureIds(r,t){const e=r[0];return e?this._canUseGlobalIds(t,r)?this._getGlobalIdsFromFeatureIdentifier(r):"objectId"in e?this._getObjectIdsFromFeatureIdentifier(r):this._getIdsFromFeatures(r):[]}_getIdsFromFeatures(r){const t=this.layer.objectIdField;return r.map(e=>e.attributes&&e.attributes[t])}_canUseGlobalIds(r,t){return r&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(r){return r.map(t=>t.objectId)}_getGlobalIdsFromFeatureIdentifier(r){return r.map(t=>t.globalId)}_createEditsResult(r){const t=r.data,{layerId:e}=this.layer,s=[];let n=null;if(Array.isArray(t))for(const d of t)s.push({id:d.id,editedFeatures:d.editedFeatures}),d.id===e&&(n={addResults:d.addResults,updateResults:d.updateResults,deleteResults:d.deleteResults,attachments:d.attachments,editMoment:d.editMoment});else n=t;const i=n?.attachments,l={addFeatureResults:n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:i&&i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:i&&i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:i&&i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[]};if(n.editMoment&&(l.editMoment=n.editMoment),s.length>0){l.editedFeatureResults=[];for(const d of s){const{adds:p,updates:h,deletes:f,spatialReference:T}=d.editedFeatures,D=T?new oe.Z(T):null;l.editedFeatureResults.push({layerId:d.id,editedFeatures:{adds:p?.map(v=>this._createEditedFeature(v,D))||[],updates:h?.map(v=>({original:this._createEditedFeature(v[0],D),current:this._createEditedFeature(v[1],D)}))||[],deletes:f?.map(v=>this._createEditedFeature(v,D))||[],spatialReference:D}})}}return l}_createEditedFeature(r,t){return new I.Z({attributes:r.attributes,geometry:(0,pt.im)({...r.geometry,spatialReference:t})})}_createFeatureEditResult(r){const t=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:t?new R.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(r,t){return{objectId:r,globalId:null,error:new R.Z("feature-layer-source:attachment-failure",t.details.messages&&t.details.messages[0]||t.message,{code:t.details.httpStatus||t.details.messageCode})}}_getFormDataForAttachment(r,t){const e=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(e)for(const s in t){const n=t[s];null!=n&&(e.set?e.set(s,n):e.append(s,n))}return e}_getLayerRequestOptions(r={}){const{parsedUrl:t,gdbVersion:e,dynamicDataSource:s}=this.layer;return{...r,query:{gdbVersion:e,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(r)},responseType:"json"}}};(0,m._)([(0,g.Cb)()],M.prototype,"type",void 0),(0,m._)([(0,g.Cb)({constructOnly:!0})],M.prototype,"layer",void 0),(0,m._)([(0,g.Cb)({readOnly:!0})],M.prototype,"queryTask",null),M=(0,m._)([(0,L.j)("esri.layers.graphics.sources.FeatureLayerSource")],M);const le=M},56554:(N,_,u)=>{u.d(_,{Dm:()=>O,Hq:()=>b,MS:()=>Z,bU:()=>F});var c=u(8314),m=u(58817),P=u(87757),I=u(24837);function F(y){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===y||"esriGeometryMultipoint"===y?I.I4:"esriGeometryPolyline"===y?I.ET:I.lF}}}const x=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let R=1;function O(y,S){if((0,c.Z)("esri-csp-restrictions"))return()=>({[S]:null,...y});try{let A=`this.${S} = null;`;for(const g in y)A+=`this${x.test(g)?`.${g}`:`["${g}"]`} = ${JSON.stringify(y[g])};`;const j=new Function(`\n      return class AttributesClass$${R++} {\n        constructor() {\n          ${A};\n        }\n      }\n    `)();return()=>new j}catch{return()=>({[S]:null,...y})}}function b(y={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,m.d9)(y)}}]}function Z(y,S){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:y},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:S,supportsDelete:S,supportsEditing:S,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:S,supportsExceedsLimitStatistics:!0},query:P.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:S,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},90463:(N,_,u)=>{u.d(_,{P:()=>F});var c=u(15861),m=u(2618),P=u(20477),I=u(84952);function F(R,O,b){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(R,O,b){const Z=(0,m.en)(R);return(0,P.executeQueryForCount)(Z,I.Z.from(O),{...b}).then(y=>y.data.count)})).apply(this,arguments)}},24865:(N,_,u)=>{u.d(_,{G:()=>F});var c=u(15861),m=u(2618),P=u(20477),I=u(84952);function F(R,O,b){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(R,O,b){const Z=(0,m.en)(R);return(0,P.executeQueryForIds)(Z,I.Z.from(O),{...b}).then(y=>y.data.objectIds)})).apply(this,arguments)}}}]);