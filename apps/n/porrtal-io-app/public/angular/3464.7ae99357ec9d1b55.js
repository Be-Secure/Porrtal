"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[3464],{14259:(re,H,f)=>{f.d(H,{q:()=>E});var S,Z,V={exports:{}};S=V,void 0!==(Z=function(){function D(s,n,o,d,x){for(;d>o;){if(d-o>600){var y=d-o+1,_=n-o+1,O=Math.log(y),h=.5*Math.exp(2*O/3),M=.5*Math.sqrt(O*h*(y-h)/y)*(_-y/2<0?-1:1);D(s,n,Math.max(o,Math.floor(n-_*h/y+M)),Math.min(d,Math.floor(n+(y-_)*h/y+M)),x)}var G=s[n],A=o,j=d;for(I(s,o,n),x(s[d],G)>0&&I(s,o,d);A<j;){for(I(s,A,j),A++,j--;x(s[A],G)<0;)A++;for(;x(s[j],G)>0;)j--}0===x(s[o],G)?I(s,o,j):I(s,++j,d),j<=n&&(o=j+1),n<=j&&(d=j-1)}}function I(s,n,o){var d=s[n];s[n]=s[o],s[o]=d}function P(s,n){return s<n?-1:s>n?1:0}return function F(s,n,o,d,x){D(s,n,o||0,d||s.length-1,x||P)}}())&&(S.exports=Z);const E=V.exports},77044:(re,H,f)=>{f.d(H,{Y:()=>Z});var S=f(62208);function z(s,n){return s?n?4:3:n?3:2}function Z(s,n,o,d,x){if((0,S.Wi)(n)||!n.lengths.length)return null;const y="upperLeft"===x?.originPosition?-1:1;s.lengths.length&&(s.lengths.length=0),s.coords.length&&(s.coords.length=0);const _=s.coords,O=[],h=o?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:M,coords:G}=n,A=z(o,d);let j=0;for(const T of M){const W=V(h,G,j,T,o,d,y);W&&O.push(W),j+=T*A}if(O.sort((T,W)=>{let L=y*T[2]-y*W[2];return 0===L&&o&&(L=T[4]-W[4]),L}),O.length){let T=6*O[0][2];_[0]=O[0][0]/T,_[1]=O[0][1]/T,o&&(T=6*O[0][4],_[2]=0!==T?O[0][3]/T:0),(_[0]<h[0]||_[0]>h[1]||_[1]<h[2]||_[1]>h[3]||o&&(_[2]<h[4]||_[2]>h[5]))&&(_.length=0)}if(!_.length){const T=n.lengths[0]?function E(s,n,o,d,x){const y=z(d,x);let _=n,O=n+y,h=0,M=0,G=0,A=0;for(let j=0,T=o-1;j<T;j++,_+=y,O+=y){const W=s[_],L=s[_+1],w=s[_+2],ee=s[O],u=s[O+1],l=s[O+2],g=d?D(W,L,w,ee,u,l):F(W,L,ee,u);if(g)if(h+=g,d){const v=P(W,L,w,ee,u,l);M+=g*v[0],G+=g*v[1],A+=g*v[2]}else{const v=I(W,L,ee,u);M+=g*v[0],G+=g*v[1]}}return h>0?d?[M/h,G/h,A/h]:[M/h,G/h]:o>0?d?[s[n],s[n+1],s[n+2]]:[s[n],s[n+1]]:null}(G,0,M[0],o,d):null;if(!T)return null;_[0]=T[0],_[1]=T[1],o&&T.length>2&&(_[2]=T[2])}return s}function V(s,n,o,d,x,y,_=1){const O=z(x,y);let h=o,M=o+O,G=0,A=0,j=0,T=0,W=0;for(let w=0,ee=d-1;w<ee;w++,h+=O,M+=O){const u=n[h],l=n[h+1],g=n[h+2],v=n[M],C=n[M+1],N=n[M+2];let Q=u*C-v*l;T+=Q,G+=(u+v)*Q,A+=(l+C)*Q,x&&(Q=u*N-v*g,j+=(g+N)*Q,W+=Q),u<s[0]&&(s[0]=u),u>s[1]&&(s[1]=u),l<s[2]&&(s[2]=l),l>s[3]&&(s[3]=l),x&&(g<s[4]&&(s[4]=g),g>s[5]&&(s[5]=g))}if(T*_>0&&(T*=-1),W*_>0&&(W*=-1),!T)return null;const L=[G,A,.5*T];return x&&(L[3]=j,L[4]=.5*W),L}function F(s,n,o,d){const x=o-s,y=d-n;return Math.sqrt(x*x+y*y)}function D(s,n,o,d,x,y){const _=d-s,O=x-n,h=y-o;return Math.sqrt(_*_+O*O+h*h)}function I(s,n,o,d){return[s+.5*(o-s),n+.5*(d-n)]}function P(s,n,o,d,x,y){return[s+.5*(d-s),n+.5*(x-n),o+.5*(y-o)]}},58175:(re,H,f)=>{f.d(H,{q:()=>g});var S=f(15861),z=f(85931),Z=f(26584),V=f(58817),E=f(62208),F=f(1036),D=f(16730),I=f(5548),P=f(65401),s=f(32442),n=f(91179),o=f(13924),d=f(37053),x=f(82054),y=f(50736),_=f(82959),O=f(87757),h=f(83308),M=f(53023),G=f(76530),A=f(6185),j=f(60466),T=f(46679),W=f(87091);const w="feature-store:unsupported-query",u=new F.WJ(2e6);let l=0;class g{constructor(e){this.capabilities={query:O.g},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new F.Xq(l+++"$$",u)),this.fieldsIndex=new j.Z(e.fields),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,E.hw)(this._frameTask),this.clearCache(),(0,E.SC)(this._geometryQueryCache),this._changeHandle=(0,E.hw)(this._changeHandle),(0,E.SC)(this.fieldsIndex)}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const e=this.featureStore.fullBounds;return(0,E.Wi)(e)?null:{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,A.S2)(this.spatialReference)}}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,G.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache?.clear(),this._allItems=null,this._timeExtent=null}executeQuery(e,i){var t=this;return(0,S.Z)(function*(){try{return(yield t._executeQuery(e,{},i)).createQueryResponse()}catch(r){if(r!==A.vF)throw r;return new h.y([],e,t).createQueryResponse()}})()}executeQueryForCount(e={},i){var t=this;return(0,S.Z)(function*(){try{return(yield t._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},i)).createQueryResponseForCount()}catch(r){if(r!==A.vF)throw r;return 0}})()}executeQueryForExtent(e,i){var t=this;return(0,S.Z)(function*(){const r=e.outSR;try{const a=yield t._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},i),c=a.size;if(!c)return{count:0,extent:null};(0,I.t8)(C,I.Gv),t.featureStore.forEachBounds(a.items,R=>(0,I.TC)(C,R),v);const m={xmin:C[0],ymin:C[1],xmax:C[3],ymax:C[4],spatialReference:(0,A.S2)(t.spatialReference)};t.hasZ&&isFinite(C[2])&&isFinite(C[5])&&(m.zmin=C[2],m.zmax=C[5]);const p=(0,_.iV)(m,a.spatialReference,r);if(p.spatialReference=(0,A.S2)(r||t.spatialReference),p.xmax-p.xmin==0){const R=(0,D.c9)(p.spatialReference);p.xmin-=R,p.xmax+=R}if(p.ymax-p.ymin==0){const R=(0,D.c9)(p.spatialReference);p.ymin-=R,p.ymax+=R}if(t.hasZ&&null!=p.zmin&&null!=p.zmax&&p.zmax-p.zmin==0){const R=(0,D.c9)(p.spatialReference);p.zmin-=R,p.zmax+=R}return{count:c,extent:p}}catch(a){if(a===A.vF)return{count:0,extent:null};throw a}})()}executeQueryForIds(e,i){var t=this;return(0,S.Z)(function*(){return t.executeQueryForIdSet(e,i).then(r=>Array.from(r))})()}executeQueryForIdSet(e,i){var t=this;return(0,S.Z)(function*(){try{const r=yield t._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},i),a=r.items,c=new Set;return yield t._reschedule(()=>{for(const m of a)c.add(r.featureAdapter.getObjectId(m))},i),c}catch(r){if(r===A.vF)return new Set;throw r}})()}executeQueryForSnapping(e,i){var t=this;return(0,S.Z)(function*(){const{point:r,distance:a,types:c}=e;if(c===h.r.NONE)return{candidates:[]};const m=yield t._reschedule(()=>t._checkQuerySupport(e.query),i),p=!(0,d.fS)(r.spatialReference,t.spatialReference);p&&(yield(0,_._W)(r.spatialReference,t.spatialReference));const R="number"==typeof a?a:a.x,U="number"==typeof a?a:a.y,B={xmin:r.x-R,xmax:r.x+R,ymin:r.y-U,ymax:r.y+U,spatialReference:r.spatialReference},K=p?(0,_.iV)(B,t.spatialReference):B;if(!K)return{candidates:[]};const X=(yield(0,o.aX)((0,n.im)(r),null,{signal:i}))[0],$=(yield(0,o.aX)((0,n.im)(K),null,{signal:i}))[0];if((0,E.Wi)(X)||(0,E.Wi)($))return{candidates:[]};const te=new h.y(t._searchFeatures(t._getQueryBBoxes($.toJSON())),m,t);yield t._reschedule(()=>t._executeObjectIdsQuery(te),i),yield t._reschedule(()=>t._executeTimeQuery(te),i),yield t._reschedule(()=>t._executeAttributesQuery(te),i);const b=X.toJSON(),k=p?(0,_.iV)(b,t.spatialReference):b,q=p?Math.max(K.xmax-K.xmin,K.ymax-K.ymin)/2:a;return te.createSnappingResponse({...e,point:k,distance:q},r.spatialReference)})()}executeQueryForLatestObservations(e,i){var t=this;return(0,S.Z)(function*(){if(!t.timeInfo||!t.timeInfo.trackIdField)throw new Z.Z(w,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:t.timeInfo});try{const r=yield t._executeQuery(e,{},i);return yield t._reschedule(()=>t._filterLatest(r),i),r.createQueryResponse()}catch(r){if(r!==A.vF)throw r;return new h.y([],e,t).createQueryResponse()}})()}executeQueryForSummaryStatistics(e={},i,t){var r=this;return(0,S.Z)(function*(){const{field:a,normalizationField:c,valueExpression:m}=i;return(yield r._getQueryEngineResultForStats(e,{field:a,normalizationField:c,valueExpression:m},t)).createSummaryStatisticsResponse(i)})()}executeQueryForUniqueValues(e={},i,t){var r=this;return(0,S.Z)(function*(){const{field:a,valueExpression:c}=i;return(yield r._getQueryEngineResultForStats(e,{field:a,valueExpression:c},t)).createUniqueValuesResponse(i)})()}executeQueryForClassBreaks(e={},i,t){var r=this;return(0,S.Z)(function*(){const{field:a,normalizationField:c,valueExpression:m}=i;return(yield r._getQueryEngineResultForStats(e,{field:a,normalizationField:c,valueExpression:m},t)).createClassBreaksResponse(i)})()}executeQueryForHistogram(e={},i,t){var r=this;return(0,S.Z)(function*(){const{field:a,normalizationField:c,valueExpression:m}=i;return(yield r._getQueryEngineResultForStats(e,{field:a,normalizationField:c,valueExpression:m},t)).createHistogramResponse(i)})()}_schedule(e,i){var t=this;return(0,S.Z)(function*(){return(0,E.pC)(t._frameTask)?t._frameTask.schedule(e,i):e(W.G5)})()}_reschedule(e,i){var t=this;return(0,S.Z)(function*(){return(0,E.pC)(t._frameTask)?t._frameTask.reschedule(e,i):e(W.G5)})()}_getAll(e){return(0,E.Wi)(this._allItems)&&(this._allItems=this.featureStore.toArray()),new h.y(this._allItems,e,this)}_executeQuery(e,i,t){var r=this;return(0,S.Z)(function*(){e=(0,V.d9)(e),e=yield r._schedule(()=>(0,A.Up)(e,r.definitionExpression,r.spatialReference),t),e=yield r._reschedule(()=>r._checkQuerySupport(e),t),e={...e,...i};const a=yield r._reschedule(()=>r._executeSceneFilterQuery(e,t),t),c=yield r._reschedule(()=>r._executeGeometryQuery(e,a,t),t);return yield r._reschedule(()=>r._executeAggregateIdsQuery(c),t),yield r._reschedule(()=>r._executeObjectIdsQuery(c),t),yield r._reschedule(()=>r._executeTimeQuery(c),t),yield r._reschedule(()=>r._executeAttributesQuery(c),t),c})()}_executeSceneFilterQuery(e,i){var t=this;return(0,S.Z)(function*(){if((0,E.Wi)(e.sceneFilter))return null;const{outSR:r,returnGeometry:a,returnCentroid:c}=e,m=t.featureStore.featureSpatialReference,p=e.sceneFilter.geometry,R=(0,E.Wi)(m)||(0,d.fS)(m,p.spatialReference)?p:(0,_.iV)(p,m);if(!R)return null;const U=a||c,B=(0,d.JY)(r)&&!(0,d.fS)(t.spatialReference,r)&&U?function(){var b=(0,S.Z)(function*(k){return t._project(k,r)});return function(k){return b.apply(this,arguments)}}():b=>b,K=t.featureAdapter,X=t._searchFeatures(t._getQueryBBoxes(R));if("disjoint"===e.sceneFilter.spatialRelationship){if(!X.length)return null;const b=new Set;for(const ie of X)b.add(K.getObjectId(ie));const k=yield t._reschedule(()=>t.featureStore.toArray(),i);return B(yield t._reschedule((0,S.Z)(function*(){const ie=yield(0,M.cW)("esriSpatialRelDisjoint",R,t.geometryType,t.hasZ,t.hasM),Y=yield t._runSpatialFilter(k,J=>!b.has(K.getObjectId(J))||ie(K.getGeometry(J)),i);return new h.y(Y,e,t)}),i))}if(!X.length)return new h.y([],e,t);if(t._canExecuteSinglePass(R,e))return B(new h.y(X,e,t));const $=yield(0,M.cW)("esriSpatialRelContains",R,t.geometryType,t.hasZ,t.hasM),te=yield t._runSpatialFilter(X,b=>$(K.getGeometry(b)),i);return B(new h.y(te,e,t))})()}_executeGeometryQuery(e,i,t){var r=this;return(0,S.Z)(function*(){if((0,E.pC)(i)&&0===i.items.length)return i;e=(0,E.pC)(i)?i.query:e;const{geometry:a,outSR:c,spatialRel:m,returnGeometry:p,returnCentroid:R}=e,U=r.featureStore.featureSpatialReference,B=!a||(0,E.Wi)(U)||(0,d.fS)(U,a.spatialReference)?a:(0,_.iV)(a,U),K=p||R,X=(0,d.JY)(c)&&!(0,d.fS)(r.spatialReference,c),$=r._geometryQueryCache&&(0,E.Wi)(i)?X&&K?JSON.stringify({originalFilterGeometry:a,spatialRelationship:m,outSpatialReference:c}):JSON.stringify({originalFilterGeometry:a,spatialRelationship:m}):null,te=$?r._geometryQueryCache.get($):null;if((0,E.pC)(te))return new h.y(te,e,r);const b=function(){var Y=(0,S.Z)(function*(J){return X&&K&&(yield r._project(J,c)),$&&r._geometryQueryCache.put($,J.items,J.items.length+1),J});return function(oe){return Y.apply(this,arguments)}}();if(!B)return b((0,E.pC)(i)?i:r._getAll(e));const k=r.featureAdapter;let q=r._searchFeatures(r._getQueryBBoxes(a));if("esriSpatialRelDisjoint"===m){if(!q.length)return b((0,E.pC)(i)?i:r._getAll(e));const Y=new Set;for(const ne of q)Y.add(k.getObjectId(ne));const J=(0,E.pC)(i)?i.items:yield r._reschedule(()=>r.featureStore.toArray(),t);return b(yield r._reschedule((0,S.Z)(function*(){const ne=yield(0,M.cW)(m,B,r.geometryType,r.hasZ,r.hasM),le=yield r._runSpatialFilter(J,ae=>!Y.has(k.getObjectId(ae))||ne(k.getGeometry(ae)),t);return new h.y(le,e,r)}),t))}if((0,E.pC)(i)){const Y=new z.SO;q=q.filter(J=>(0,z.cq)(i.items,J,i.items.length,Y)>=0)}if(!q.length){const Y=new h.y([],e,r);return $&&r._geometryQueryCache.put($,Y.items,1),Y}if(r._canExecuteSinglePass(B,e))return b(new h.y(q,e,r));const ie=yield(0,M.cW)(m,B,r.geometryType,r.hasZ,r.hasM),se=yield r._runSpatialFilter(q,Y=>ie(k.getGeometry(Y)),t);return b(new h.y(se,e,r))})()}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds||!e.query.aggregateIds.length||(0,E.Wi)(this.aggregateAdapter))return;const i=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(a=>i.add(a));const t=this.featureAdapter.getObjectId;e.items=e.items.filter(r=>i.has(t(r)))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds||!e.query.objectIds.length)return;const i=new Set(e.query.objectIds),t=this.featureAdapter.getObjectId;e.items=e.items.filter(r=>i.has(t(r)))}_executeTimeQuery(e){if(0===e.items.length)return;const i=(0,G.y)(this.timeInfo,e.query.timeExtent,this.featureAdapter);(0,E.Wi)(i)||(e.items=e.items.filter(i))}_executeAttributesQuery(e){if(0===e.items.length)return;const i=(0,y.Jc)(e.query.where,this.fieldsIndex);if(i){if(!i.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(t=>i.testFeature(t,this.featureAdapter))}}_runSpatialFilter(e,i,t){var r=this;return(0,S.Z)(function*(){if(!i)return e;if((0,E.Wi)(r._frameTask))return e.filter(p=>i(p));let a=0;const c=new Array,m=function(){var p=(0,S.Z)(function*(R){for(;a<e.length;){const U=e[a++];i(U)&&(c.push(U),R.madeProgress()),R.done&&(yield r._reschedule(B=>m(B),t))}});return function(U){return p.apply(this,arguments)}}();return r._reschedule(p=>m(p),t).then(()=>c)})()}_filterLatest(e){const{trackIdField:i,startTimeField:t,endTimeField:r}=this.timeInfo,a=r||t,c=new Map,m=this.featureAdapter.getAttribute;for(const p of e.items){const R=m(p,i),U=m(p,a),B=c.get(R);(!B||U>m(B,a))&&c.set(R,p)}e.items=Array.from(c.values())}_canExecuteSinglePass(e,i){const{spatialRel:t}=i;return(0,M.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===t||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t||"esriSpatialRelWithin"===t))}_project(e,i){var t=this;return(0,S.Z)(function*(){if(!i||(0,d.fS)(t.spatialReference,i))return e;const r=t.featureAdapter,a=yield(0,_.oj)(e.items.map(c=>(0,A.Op)(t.geometryType,t.hasZ,t.hasM,r.getGeometry(c))),t.spatialReference,i);return e.items=a.map((c,m)=>r.cloneWithGeometry(e.items[m],(0,x.GH)(c,t.hasZ,t.hasM))),e})()}_getQueryBBoxes(e){if((0,M.hN)(e)){if((0,n.YX)(e))return[(0,P.al)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,n.oU)(e))return e.rings.map(i=>(0,P.al)(Math.min(i[0][0],i[2][0]),Math.min(i[0][1],i[2][1]),Math.max(i[0][0],i[2][0]),Math.max(i[0][1],i[2][1])))}return[(0,s.$P)((0,P.Ue)(),e)]}_searchFeatures(e){for(const t of e)this.featureStore.forEachInBounds(t,r=>N.add(r));const i=Array.from(N.values());return N.clear(),i}_checkStatisticsSupport(e,i){var t=this;return(0,S.Z)(function*(){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new Z.Z(w,"Unsupported query options",{query:e});return t._checkAttributesQuerySupport(e),Promise.all([t._checkStatisticsParamsSupport(i),(0,M.P0)(e,t.geometryType,t.spatialReference),(0,_._W)(t.spatialReference,e.outSR)]).then(()=>e)})()}_checkStatisticsParamsSupport(e){var i=this;return(0,S.Z)(function*(){let t=[];if(e.valueExpression){const{arcadeUtils:r}=yield(0,T.LC)();t=r.extractFieldNames(e.valueExpression)}if(e.field&&t.push(e.field),e.normalizationField&&t.push(e.normalizationField),!t.length)throw new Z.Z(w,"params should have at least a field or valueExpression",{params:e});(0,y.Of)(i.fieldsIndex,t,"params contains missing fields")})()}_checkQuerySupport(e){var i=this;return(0,S.Z)(function*(){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new Z.Z(w,"Unsupported query options",{query:e});return i._checkAttributesQuerySupport(e),i._checkStatisticsQuerySupport(e),Promise.all([(0,M.P0)(e,i.geometryType,i.spatialReference),(0,_._W)(i.spatialReference,e.outSR)]).then(()=>e)})()}_checkAttributesQuerySupport(e){const{outFields:i,orderByFields:t,returnDistinctValues:r,outStatistics:a}=e,c=a?a.map(m=>m.outStatisticFieldName&&m.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(t&&t.length>0){const m=" asc",p=" desc",R=t.map(U=>{const B=U.toLowerCase();return B.includes(m)?B.split(m)[0]:B.includes(p)?B.split(p)[0]:U}).filter(U=>!c.includes(U));(0,y.Of)(this.fieldsIndex,R,"orderByFields contains missing fields")}if(i&&i.length>0)(0,y.Of)(this.fieldsIndex,i,"outFields contains missing fields");else if(r)throw new Z.Z(w,"outFields should be specified for returnDistinctValues",{query:e});(0,y.hO)(this.fieldsIndex,e.where)}_checkStatisticsQuerySupport(e){const{outStatistics:i,groupByFieldsForStatistics:t,having:r}=e,a=t&&t.length,c=i&&i.length;if(r){if(!a||!c)throw new Z.Z(w,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});(0,y.z4)(this.fieldsIndex,r,i)}if(c){if(!function L(Q){return Q.every(e=>"exceedslimit"!==e.statisticType)}(i))return;const m=i.map(p=>p.onStatisticField).filter(Boolean);(0,y.Of)(this.fieldsIndex,m,"onStatisticFields contains missing fields"),a&&(0,y.Of)(this.fieldsIndex,t,"groupByFieldsForStatistics contains missing fields");for(const p of i){const{onStatisticField:R,statisticType:U}=p;if("percentile_disc"!==U&&"percentile_cont"!==U||!("statisticParameters"in p)){if("count"!==U&&R&&(0,y.G3)(R,this.fieldsIndex))throw new Z.Z(w,"outStatistics contains non-numeric fields",{definition:p,query:e})}else{const{statisticParameters:B}=p;if(!B)throw new Z.Z(w,"statisticParamters should be set for percentile type",{definition:p,query:e})}}}}_getQueryEngineResultForStats(e,i,t){var r=this;return(0,S.Z)(function*(){e=(0,V.d9)(e);try{e=yield r._schedule(()=>(0,A.Up)(e,r.definitionExpression,r.spatialReference),t),e=yield r._reschedule(()=>r._checkStatisticsSupport(e,i),t);const a=yield r._reschedule(()=>r._executeSceneFilterQuery(e,t),t),c=yield r._reschedule(()=>r._executeGeometryQuery(e,a,t),t);return yield r._reschedule(()=>r._executeAggregateIdsQuery(c),t),yield r._reschedule(()=>r._executeObjectIdsQuery(c),t),yield r._reschedule(()=>r._executeTimeQuery(c),t),yield r._reschedule(()=>r._executeAttributesQuery(c),t),c}catch(a){if(a!==A.vF)throw a;return new h.y([],e,r)}})()}}const v=(0,I.Ue)(),C=(0,I.Ue)(),N=new Set},87757:(re,H,f)=>{f.d(H,{g:()=>S});const S={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},53023:(re,H,f)=>{f.d(H,{hN:()=>ee,P0:()=>L,cW:()=>W});var S=f(15861),z=f(26584),Z=f(33190),V=f(11519),F=f(91179),D=f(37053);function I(u,l){return u?l?4:3:l?3:2}function n(u,l,g,v,C){if(!u)return!1;const N=I(l,g),{coords:Q,lengths:e}=u;let i=!1,t=0;for(const r of e)i=o(i,Q,N,t,r,v,C),t+=r*N;return i}function o(u,l,g,v,C,N,Q){let e=u,i=v;for(let t=v,r=v+C*g;t<r;t+=g){i=t+g,i===r&&(i=v);const a=l[t],c=l[t+1],m=l[i],p=l[i+1];(c<Q&&p>=Q||p<Q&&c>=Q)&&a+(Q-c)/(p-c)*(m-a)<N&&(e=!e)}return e}var d=f(82054),x=f(88071),y=f(82959),_=f(6185);const O="feature-store:unsupported-query",h={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},M_spatialRelationship={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},M_queryGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},M_layerGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function G(u){return!0===M_spatialRelationship[u]}function A(u){return!0===M_queryGeometry[(0,F.Ji)(u)]}function j(u){return!0===M_layerGeometry[u]}function W(u,l,g,v,C){if((0,F.oU)(l)&&"esriGeometryPoint"===g&&("esriSpatialRelIntersects"===u||"esriSpatialRelContains"===u)){const N=(0,d.Uy)(new x.Z,l,!1,!1);return Promise.resolve(Q=>function P(u,l,g,v){return n(u,l,g,v.coords[0],v.coords[1])}(N,!1,!1,Q))}if((0,F.oU)(l)&&"esriGeometryMultipoint"===g){const N=(0,d.Uy)(new x.Z,l,!1,!1);if("esriSpatialRelContains"===u)return Promise.resolve(Q=>function s(u,l,g,v,C,N){const Q=I(C,N),{coords:e,lengths:i}=v;if(!i)return!1;for(let t=0,r=0;t<i.length;t++,r+=Q)if(!n(u,l,g,e[r],e[r+1]))return!1;return!0}(N,!1,!1,Q,v,C))}if((0,F.YX)(l)&&"esriGeometryPoint"===g&&("esriSpatialRelIntersects"===u||"esriSpatialRelContains"===u))return Promise.resolve(N=>(0,Z.aV)(l,(0,_.Op)(g,v,C,N)));if((0,F.YX)(l)&&"esriGeometryMultipoint"===g&&"esriSpatialRelContains"===u)return Promise.resolve(N=>(0,Z.lQ)(l,(0,_.Op)(g,v,C,N)));if((0,F.YX)(l)&&"esriSpatialRelIntersects"===u){const N=function E(u){return"mesh"===u?V.h_:(0,V.IY)(u)}(g);return Promise.resolve(Q=>N(l,(0,_.Op)(g,v,C,Q)))}return function T(){return Promise.all([f.e(4918),f.e(8592)]).then(f.bind(f,32825))}().then(N=>{const Q=N[h[u]].bind(null,l.spatialReference,l);return e=>Q((0,_.Op)(g,v,C,e))})}function L(u,l,g){return w.apply(this,arguments)}function w(){return(w=(0,S.Z)(function*(u,l,g){const{spatialRel:v,geometry:C}=u;if(C){if(!G(v))throw new z.Z(O,"Unsupported query spatial relationship",{query:u});if((0,D.JY)(C.spatialReference)&&(0,D.JY)(g)){if(!A(C))throw new z.Z(O,"Unsupported query geometry type",{query:u});if(!j(l))throw new z.Z(O,"Unsupported layer geometry type",{query:u});if(u.outSR)return(0,y._W)(u.geometry&&u.geometry.spatialReference,u.outSR)}}})).apply(this,arguments)}function ee(u){if((0,F.YX)(u))return!0;if((0,F.oU)(u)){for(const l of u.rings)if(5!==l.length||l[0][0]!==l[1][0]||l[0][0]!==l[4][0]||l[2][0]!==l[3][0]||l[0][1]!==l[3][1]||l[0][1]!==l[4][1]||l[1][1]!==l[2][1])return!1;return!0}return!1}},76530:(re,H,f)=>{function S(F,D){if(!F)return null;const I=D.featureAdapter,{startTimeField:P,endTimeField:s}=F;let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(P&&s)D.forEach(d=>{const x=I.getAttribute(d,P),y=I.getAttribute(d,s);null==x||isNaN(x)||(n=Math.min(n,x)),null==y||isNaN(y)||(o=Math.max(o,y))});else{const d=P||s;D.forEach(x=>{const y=I.getAttribute(x,d);null==y||isNaN(y)||(n=Math.min(n,y),o=Math.max(o,y))})}return{start:n,end:o}}function z(F,D,I){if(!D||!F)return null;const{startTimeField:P,endTimeField:s}=F;if(!P&&!s)return null;const{start:n,end:o}=D;return null===n&&null===o?null:void 0===n&&void 0===o?()=>!1:P&&s?function Z(F,D,I,P,s){return null!=P&&null!=s?n=>{const o=F.getAttribute(n,D),d=F.getAttribute(n,I);return(null==o||o<=s)&&(null==d||d>=P)}:null!=P?n=>{const o=F.getAttribute(n,I);return null==o||o>=P}:null!=s?n=>{const o=F.getAttribute(n,D);return null==o||o<=s}:void 0}(I,P,s,n,o):function V(F,D,I,P){return null!=I&&null!=P&&I===P?s=>F.getAttribute(s,D)===I:null!=I&&null!=P?s=>{const n=F.getAttribute(s,D);return n>=I&&n<=P}:null!=I?s=>F.getAttribute(s,D)>=I:null!=P?s=>F.getAttribute(s,D)<=P:void 0}(I,P||s,n,o)}f.d(H,{R:()=>S,y:()=>z})}}]);