"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[8460],{97938:(li,zt,L)=>{L.d(zt,{E:()=>F,V:()=>J});class F{constructor(E,k){this.x=E,this.y=k}clone(){return new F(this.x,this.y)}equals(E,k){return E===this.x&&k===this.y}isEqual(E){return E.x===this.x&&E.y===this.y}setCoords(E,k){this.x=E,this.y=k}normalize(){const E=this.x,k=this.y,H=Math.sqrt(E*E+k*k);this.x/=H,this.y/=H}rightPerpendicular(){const E=this.x;this.x=this.y,this.y=-E}move(E,k){this.x+=E,this.y+=k}assign(E){this.x=E.x,this.y=E.y}assignAdd(E,k){this.x=E.x+k.x,this.y=E.y+k.y}assignSub(E,k){this.x=E.x-k.x,this.y=E.y-k.y}rotate(E,k){const H=this.x,W=this.y;this.x=H*E-W*k,this.y=H*k+W*E}scale(E){this.x*=E,this.y*=E}length(){const E=this.x,k=this.y;return Math.sqrt(E*E+k*k)}static distance(E,k){const H=k.x-E.x,W=k.y-E.y;return Math.sqrt(H*H+W*W)}static add(E,k){return new F(E.x+k.x,E.y+k.y)}static sub(E,k){return new F(E.x-k.x,E.y-k.y)}}var J,z;(z=J||(J={}))[z.Unknown=0]="Unknown",z[z.Point=1]="Point",z[z.LineString=2]="LineString",z[z.Polygon=3]="Polygon"},18716:(li,zt,L)=>{L.d(zt,{CA:()=>hi,Gq:()=>gt,Xp:()=>ot,a:()=>Ut,dk:()=>q,hF:()=>ce,jj:()=>ci,jy:()=>At,m2:()=>rt,mE:()=>Rt,qr:()=>Bt});var F=L(26584),J=L(40028),z=L(39406);const Vt=Object.keys(z.mD).filter(U=>"number"==typeof z.mD[U]).reduce((U,M)=>({...U,[M]:z.mD[M]}),{});function At(U){return U===z.mD.OUTLINE_FILL||U===z.mD.OUTLINE_FILL_SIMPLE}function ot(U){return function xt(U){return U===z.mD.SIMPLE||U===z.mD.OUTLINE_FILL_SIMPLE}(U.symbologyType)}function hi(U){return At(U.symbologyType)}function ci(U,M){switch(U){case z.LW.FILL:return q.from(M);case z.LW.LINE:return Ut.from(M);case z.LW.MARKER:return Rt.from(M);case z.LW.TEXT:return Bt.from(M);case z.LW.LABEL:return gt.from(M);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${U}`)}}function ce(U){switch(rt.load(U).geometryType){case z.LW.MARKER:return new Rt(U);case z.LW.FILL:return new q(U);case z.LW.LINE:return new Ut(U);case z.LW.TEXT:return new Bt(U);case z.LW.LABEL:return new gt(U)}}class rt{constructor(M){this._data=0,this._data=M}static load(M){const b=this.shared;return b.data=M,b}set data(M){this._data=M}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(M){this.setBits(M,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(M){this.setBit(20,M)}get sdf(){return!!this.bit(11)}set sdf(M){this.setBit(11,M)}get pattern(){return!!this.bit(12)}set pattern(M){this.setBit(12,M)}get textureBinding(){return this.bits(0,8)}set textureBinding(M){this.setBits(M,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(M){this.setBits(M,21,26)}get geometryTypeString(){switch(this.geometryType){case z.LW.FILL:return"fill";case z.LW.MARKER:return"marker";case z.LW.LINE:return"line";case z.LW.TEXT:return"text";case z.LW.LABEL:return"label";default:throw new F.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(M,b){const G=1<<M;b?this._data|=G:this._data&=~G}bit(M){return(this._data&1<<M)>>M}setBits(M,b,G){for(let K=b,Ot=0;K<G;K++,Ot++)this.setBit(K,0!=(M&1<<Ot))}bits(M,b){let G=0;for(let K=M,Ot=0;K<b;K++,Ot++)G|=this.bit(K)<<Ot;return G}hasVV(){return!1}setVV(M,b){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:z.mD[this.symbologyType],options:Vt,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}}rt.shared=new rt(0);const ft=U=>class extends U{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(M){this.setBit(16,M)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(M){this.setBit(17,M)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(M){this.setBit(18,M)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(M){this.setBit(19,M)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(M,b){super.setVV(M,b);const G=function E(U,M,b){const G=z.X.SIZE_FIELD_STOPS|z.X.SIZE_MINMAX_VALUE|z.X.SIZE_SCALE_STOPS|z.X.SIZE_UNIT_VALUE,K=(M&(z.mf.FIELD_TARGETS_OUTLINE|z.mf.MINMAX_TARGETS_OUTLINE|z.mf.SCALE_TARGETS_OUTLINE|z.mf.UNIT_TARGETS_OUTLINE))>>>4;return U===z.LW.LINE&&b.isOutline||U===z.LW.FILL&&At(b.symbologyType)?G&K:G&~K}(this.geometryType,M,b)&M;this.vvSizeMinMaxValue=!!(G&z.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(G&z.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(G&z.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(G&z.X.SIZE_SCALE_STOPS)}},Lt=U=>class extends U{get vvRotation(){return 0!==this.bit(15)}set vvRotation(M){this.setBit(15,M)}hasVV(){return super.hasVV()||this.vvRotation}setVV(M,b){super.setVV(M,b),this.vvRotation=!b.isOutline&&!!(M&z.X.ROTATION)}},nt=U=>class extends U{get vvColor(){return 0!==this.bit(13)}set vvColor(M){this.setBit(13,M)}hasVV(){return super.hasVV()||this.vvColor}setVV(M,b){super.setVV(M,b),this.vvColor=!b.isOutline&&!!(M&z.X.COLOR)}},bt=U=>class extends U{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(M){this.setBit(14,M)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(M,b){super.setVV(M,b),this.vvOpacity=!b.isOutline&&!!(M&z.X.OPACITY)}};class q extends(nt(bt(ft(rt)))){static load(M){const b=this.shared;return b.data=M,b}static from(M){const{symbologyType:b,vvFlags:G}=M,K=this.load(0);return K.geometryType=z.LW.FILL,K.symbologyType=b,b!==z.mD.DOT_DENSITY&&K.setVV(G,M),K.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}q.shared=new q(0);class Rt extends(nt(bt(Lt(ft(rt))))){static load(M){const b=this.shared;return b.data=M,b}static from(M){const{symbologyType:b,vvFlags:G}=M,K=this.load(0);return K.geometryType=z.LW.MARKER,K.symbologyType=b,b!==z.mD.HEATMAP&&K.setVV(G,M),K.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}Rt.shared=new Rt(0);class Ut extends(nt(bt(ft(rt)))){static load(M){const b=this.shared;return b.data=M,b}static from(M){const b=this.load(0);return b.geometryType=z.LW.LINE,b.symbologyType=M.symbologyType,b.setVV(M.vvFlags,M),b.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}Ut.shared=new Ut(0);class Bt extends(nt(bt(Lt(ft(rt))))){static load(M){const b=this.shared;return b.data=M,b}static from(M){const b=this.load(0);return b.geometryType=z.LW.TEXT,b.symbologyType=M.symbologyType,b.setVV(M.vvFlags,M),b.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}Bt.shared=new Bt(0);class gt extends(ft(rt)){static load(M){const b=this.shared;return b.data=M,b}static from(M){const b=this.load(0);return b.geometryType=z.LW.LABEL,b.symbologyType=M.symbologyType,b.setVV(M.vvFlags,M),b.mapAligned=(0,J.NS)(M.placement),b.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}gt.shared=new gt(0)},28460:(li,zt,L)=>{L.r(zt),L.d(zt,{default:()=>Sr});var F=L(15861),J=L(17626),z=L(986),E=L(26584),H=(L(8314),L(63290)),W=L(62208),Y=L(10699),Wt=(L(90912),L(85931),L(76898)),Ct=L(84682),le=L(65234),Et=L(99666),O=L(39406),Qt=L(14517),$=L(77712),it=L(67831),$t=L(71251);const Ft=new Set,Vt=[],xt=new Map,At=[0,0];let ot=class extends Qt.Z{constructor(l){super(l),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:l,process:r}=this;this._queue=new $t.e({concurrency:l,process:(n,o)=>{const a=this._keyToItem.get(n);return r(a,{signal:o})},peeker:n=>n.values().next().value})}destroy(){this.clear(),this._queue=(0,W.SC)(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(l){this._queue.abort("string"==typeof l?l:l.id)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(l){return this._keyToItem.has("string"==typeof l?l:l.id)}isOngoing(l){const r="string"==typeof l?l:l.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(l,r){const n=l.key.id+"-"+r;if(this.has(n))return this.get(n);const o=this._queue.push(n),a=()=>{this._keyToItem.delete(n),this.notifyChange("updating")};return this._keyToItem.set(n,l),o.then(a,a),this.notifyChange("updating"),o}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(l){if(!this.state)return l.values().next().value;const r=this.tileInfoView;let n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;l.forEach(d=>{const m=this._keyToItem.get(d),_=this.tileInfoView.getTileScale(m.key);xt.has(_)||(xt.set(_,[]),n=Math.max(_,n),o=Math.min(_,o)),xt.get(_).push(m.key),Ft.add(_)});let a=this.state.scale;xt.has(a)||(function he(l,r){l.length=0,r.forEach(n=>l.push(n))}(Vt,Ft),Vt.sort((d,m)=>d-m),a=Vt.reduce((d,m)=>Math.abs(m-a)<Math.abs(d-a)?m:d,Vt[0])),a=Math.min(a,n),a=Math.max(a,o);const h=xt.get(a),c=r.getClosestInfoForScale(a),u=c.getColumnForX(this.state.center[0]),f=c.getRowForY(this.state.center[1]);return h.sort((d,m)=>{const _=c.denormalizeCol(d.col,d.world),p=c.denormalizeCol(m.col,m.world);return Math.sqrt((u-_)*(u-_)+(f-d.row)*(f-d.row))-Math.sqrt((u-p)*(u-p)+(f-m.row)*(f-m.row))}),Ft.clear(),xt.clear(),h[0].id}_peekByCenterFirst(l){if(!this.state)return l.values().next().value;const r=this.tileInfoView,n=this.state.center;let o,a=Number.POSITIVE_INFINITY;return l.forEach(h=>{const c=this._keyToItem.get(h);r.getTileCoords(At,c.key);const u=(0,it.d)(At,n);u<a&&(a=u,o=c.key)}),o.id}};(0,J._)([(0,$.Cb)({constructOnly:!0})],ot.prototype,"concurrency",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],ot.prototype,"process",void 0),(0,J._)([(0,$.Cb)()],ot.prototype,"state",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],ot.prototype,"strategy",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],ot.prototype,"tileInfoView",void 0),(0,J._)([(0,$.Cb)({readOnly:!0})],ot.prototype,"updating",null),ot=(0,J._)([(0,Wt.j)("esri.views.2d.tiling.PagedTileQueue")],ot),L(9598);var ce=L(58098);const ft=new Set,Lt=[],nt=new Map,bt=[0,0];let q=class extends Qt.Z{constructor(l){super(l),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:l,process:r,strategy:n}=this;this._queue=new $t.e({concurrency:l,process:(o,a)=>{const h=this._keyToItem.get(o);return r(h,{signal:a})},peeker:"scale-first"===n?o=>this._peekByScaleFirst(o):o=>this._peekByCenterFirst(o)})}destroy(){this.clear(),this._queue=(0,W.SC)(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(l){this._queue.abort("string"==typeof l?l:l.id)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(l){return this._keyToItem.has("string"==typeof l?l:l.id)}isOngoing(l){const r="string"==typeof l?l:l.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(l){const r=l.key.id;if(this._queue.has(r))return this._queue.get(r);const n=this._queue.push(r),o=()=>{this._keyToItem.delete(r),this.notifyChange("updating")};return this._keyToItem.set(r,l),n.then(o,o),this.notifyChange("updating"),n}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(l){if(!this.state)return l.values().next().value;const r=this.tileInfoView;let n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;l.forEach(d=>{const m=this._keyToItem.get(d),_=this.tileInfoView.getTileScale(m.key);nt.has(_)||(nt.set(_,[]),n=Math.max(_,n),o=Math.min(_,o)),nt.get(_).push(m.key),ft.add(_)});let a=this.state.scale;nt.has(a)||(function rt(l,r){l.length=0,r.forEach(n=>l.push(n))}(Lt,ft),Lt.sort((d,m)=>d-m),a=Lt.reduce((d,m)=>Math.abs(m-a)<Math.abs(d-a)?m:d,Lt[0])),a=Math.min(a,n),a=Math.max(a,o);const h=nt.get(a),c=r.getClosestInfoForScale(a),u=c.getColumnForX(this.state.center[0]),f=c.getRowForY(this.state.center[1]);return h.sort((d,m)=>{const _=c.denormalizeCol(d.col,d.world),p=c.denormalizeCol(m.col,m.world);return Math.sqrt((u-_)*(u-_)+(f-d.row)*(f-d.row))-Math.sqrt((u-p)*(u-p)+(f-m.row)*(f-m.row))}),ft.clear(),nt.clear(),h[0].id}_peekByCenterFirst(l){if(!this.state)return l.values().next().value;const r=this.tileInfoView,n=this.state.center;let o,a=Number.POSITIVE_INFINITY;return l.forEach(h=>{const c=this._keyToItem.get(h);r.getTileCoords(bt,c.key);const u=(0,it.d)(bt,n);u<a&&(a=u,o=c.key)}),o.id}};(0,J._)([(0,$.Cb)({constructOnly:!0})],q.prototype,"concurrency",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],q.prototype,"process",void 0),(0,J._)([(0,$.Cb)()],q.prototype,"state",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],q.prototype,"strategy",void 0),(0,J._)([(0,$.Cb)({constructOnly:!0})],q.prototype,"tileInfoView",void 0),(0,J._)([(0,$.Cb)({readOnly:!0})],q.prototype,"updating",null),q=(0,J._)([(0,Wt.j)("esri.views.2d.tiling.TileQueue")],q),L(65401),L(84378),new ce.Z(0,0,0,0);var I=L(39351),qt=L(64288);const kt=new Map;kt.set(O.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),kt.set(O.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),kt.set(O.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),kt.set(O.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),kt.set(O.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});class ue{constructor(r,n){this._pos=0;const o=n?this._roundToNearest(n,r.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(o),this._buffer=new r(this._array),this._ctor=r,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(r,n){const o=Math.round(r);return o+(n-o%n)}_ensureSize(r){if(this._pos+r>=this._buffer.length){const n=this._roundToNearest(1.25*(this._array.byteLength+r*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),o=new ArrayBuffer(n),a=new this._ctor(o);a.set(this._buffer,0),this._array=o,this._buffer=a,this._i16View=new Int16Array(this._array)}}ensureSize(r){this._ensureSize(r)}writeF32(r){this._ensureSize(1);const n=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=r,this._pos++,n}push(r){this._ensureSize(1);const n=this._pos;return this._buffer[this._pos++]=r,n}writeFixed(r){this._buffer[this._pos++]=r}setValue(r,n){this._buffer[r]=n}i1616Add(r,n,o){this._i16View[2*r]+=n,this._i16View[2*r+1]+=o}getValue(r){return this._buffer[r]}incr(r){if(this._buffer.length<r)throw new Error("Increment index overflows the target buffer");this._buffer[r]++}decr(r){this._buffer[r]--}writeRegion(r){this._ensureSize(r.length);const n=this._pos;return this._buffer.set(r,this._pos),this._pos+=r.length,n}writeManyFrom(r,n,o){this._ensureSize(o-n);for(let a=n;a!==o;a++)this.writeFixed(r._buffer[a])}buffer(){const r=this._array.slice(0,4*this._pos);return this.destroy(),r}toArray(){const r=this._array,n=[];for(let o=0;o<r.byteLength/4;o++)n.push(r[o]);return n}seek(r){this._pos=r}destroy(){this._array=null,this._buffer=null}}class ui{constructor(r,n,o){this._start={index:0,vertex:0};const a=function $i(l,r,n){const{indicesPerRecord:o,multiplier:a,verticesPerRecord:h}=kt.get(l);return{recordBytes:n*I.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*o*n*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*h*n*r}}(r,n,o),h=n/4;this.geometryType=r,this._records=new ue(Int32Array,a.recordBytes),this._indices=new ue(Uint32Array,a.indexBytes),this._vertices=new ue(Uint32Array,a.vertexBytes),this._metrics=new ue(Float32Array,0),this._strideInt=h}serialize(r){const n=this._records.buffer(),o=this._indices.buffer(),a=this._vertices.buffer(),h=this._metrics.length?this._metrics.buffer():null,c=4*this._strideInt;return r.push(n,o,a),{stride:c,records:n,indices:o,vertices:a,metrics:h}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/I.XJ}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(r){this._vertices.ensureSize(r)}indexEnsureSize(r){this._indices.ensureSize(r)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(r,n,o,a,h,c,u,f){this._records.push(r),this._records.push(n),this._records.push(o),this._records.push(a),this._records.push(h),this._records.push(c),this._records.push(u),this._records.writeF32(f)}writeIndex(r){this._indices.push(r)}writeVertex(r){this._vertices.push(r)}writeVertexF32(r){this._vertices.writeF32(r)}copyLastFrom(r,n,o){const a=r._records.length-I.XJ,h=r._records.getValue(a),c=r._records.getValue(a+1),u=r._records.getValue(a+2),f=r._records.getValue(a+4),d=r._records.getValue(a+6),m=r._records.getValue(a+7),_=this._vertices.length,p=(r._start.vertex-this._vertices.length)/this._strideInt,y=this._indices.length,x=this.vertexCount;for(let g=r._start.index;g!==r._indices.length;g++){const S=r._indices.getValue(g);this._indices.push(S-p)}for(let g=r._start.vertex;g!==r._vertices.length;g++){const S=r._vertices.getValue(g);this._vertices.push(S)}for(let g=_;g<=this._vertices.length;g+=this._strideInt)this._vertices.i1616Add(g,n,o);this._records.push(h),this._records.push(c),this._records.push(u),this._records.push(y),this._records.push(f),this._records.push(x),this._records.push(d),this._records.push(m)}}var ts=L(55376);function fi(l){switch(l){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function di(l){switch(l){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class es{constructor(r,n,o,a,h,c=0){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=n,this.tileKey=r,this._hasAggregate=a,this._pixelBufferEnabled=h,this._version=c,this._symbologyType=o}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(r){const n=[];return n.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((o,a)=>{const h=1<<a,c=fi(h),u=di(h),f=(0,ts.M)(new ce.Z(this.tileKey),c,u,r),d=this._serializeTileVertexData(this.tileKey,f.id,o.vertexData);d.message.bufferIds=o.displayIds,n.push(d)}),n}_serializeTileVertexData(r,n,o){const a=new Array;return{message:{tileKeyOrigin:r,tileKey:n,data:{[O.LW.MARKER]:o.get(O.LW.MARKER)?.serialize(a),[O.LW.FILL]:o.get(O.LW.FILL)?.serialize(a),[O.LW.LINE]:o.get(O.LW.LINE)?.serialize(a),[O.LW.TEXT]:o.get(O.LW.TEXT)?.serialize(a),[O.LW.LABEL]:o.get(O.LW.LABEL)?.serialize(a)},version:this._version},transferList:a}}featureStart(r,n){this._current.insertAfter=r,this._current.sortKey=n}featureEnd(){}recordStart(r,n,o,a){this._current.writer=this._getVertexWriter(o),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=a,this._current.id=r,this._current.materialKey=n,this._current.geometryType=o,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(r){this._current.writer.vertexEnsureSize(r)}indexEnsureSize(r){this._current.writer.indexEnsureSize(r)}vertexBounds(r,n,o,a){this._current.bufferingEnabled&&this._addOverlap(r,n,o,a)}vertexWrite(r){this._current.writer.writeVertex(r)}vertexWriteF32(r){this._current.writer.writeVertexF32(r)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(r){this._current.writer.writeIndex(r)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(r,n,o,a,h,c,u,f){this._current.writer=this._getVertexWriter(O.LW.LABEL);const d=this._current.writer.metricWriter;d.push((0,Et.jL)(r)),d.push(n),d.push(o),d.push(a),d.push(h),d.push(c),d.push(u),d.push(f),d.push(255),this._current.metricBoxLenPointer=d.push(0)}metricEnd(){const r=this._current.writer.metricWriter;0===r.getValue(this._current.metricBoxLenPointer)&&r.seek(r.length-10)}metricBoxWrite(r,n,o,a){const h=this._current.writer.metricWriter;h.incr(this._current.metricBoxLenPointer),h.push(0),h.push(0),h.push(r),h.push(n),h.push(o),h.push(a)}recordEnd(){const r=this._current.vertStart,n=this._current.writer.vertexCount-r;if(!n)return!1;this.hasRecords=!0;const o=this._current.indexStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,o,this._current.writer.indexCount-o,r,n,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===O.LW.LABEL)return!0;const h=this._current.writer;for(let c=0;c<8;c++){const u=1<<c;if(this._current.overlaps&u){this._data.neighbors[c]||(this._data.neighbors[c]={vertexData:new Map,displayIds:new Set});const f=this._data.neighbors[c],d=this._current.geometryType;if(!f.vertexData.has(d)){const x=(0,qt.$_)(d,this._symbologyType).geometry,g=new ui(d,x,I.Ip);f.vertexData.set(d,g)}const m=f.vertexData.get(this._current.geometryType),_=8,p=512*-fi(u)*_,y=512*-di(u)*_;m.copyLastFrom(h,p,y),f.displayIds.add(this._current.id)}}return!0}_addOverlap(r,n,o,a){this._current.overlaps|=255^((r<0+o?148:r>=I.I_-o?41:189)|(n<0+a?224:n>=I.I_-a?7:231))}_getVertexWriter(r){if(!this._data.self.has(r)){const n=this._data.self,o=(0,qt.$_)(r,this._symbologyType).geometry;n.set(r,new ui(r,o,this.hint.records))}return this._data.self.get(r)}}var xi=L(58774),gi=L(21286),P=L(23841),j=L(7547),dt=L(40028),Z=L(81295),w=L(5254),D=L(18716);const lt=100;function vi(l,r,n){return l[0]=r[0]-n[0],l[1]=r[1]-n[1],l}function Mi(l,r){return Math.sqrt(l*l+r*r)}function Si(l){const r=Mi(l[0],l[1]);l[0]/=r,l[1]/=r}function is(l,r){return Mi(l[0]-r[0],l[1]-r[1])}function B(l){return"function"==typeof l}function Ee(l=2){return 1/Math.max(l,1)}function vt(l,r){return[!!l.minScale&&r.scaleToZoom(l.minScale)||0,!!l.maxScale&&r.scaleToZoom(l.maxScale)||lt]}function Ti(l){return l.length-1}function rs(l,r,n=1){const[o,a]=function ss(l,r){return l[r+1]}(l,r);return Math.sqrt(o*o+a*a)*n}class te{constructor(r,n,o,a,h){this._segments=r,this._index=n,this._distance=o,this._xStart=a,this._yStart=h,this._done=!1}static create(r){return new te(r,0,0,r[0][0],r[0][1])}clone(){return new te(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(r){return this._index===r._index||r._index===this._index-1&&(0===this._distance||1===r._distance)||r._index===this._index+1&&(1===this._distance||0===r._distance)}leq(r){return this._index<r._index||this._index===r._index&&this._distance<=r._distance}geq(r){return this._index>r._index||this._index===r._index&&this._distance>=r._distance}get _segment(){return this._segments[this._index+1]}get angle(){const r=this.dy;let o=Math.acos((0*r+-1*-this.dx)/(1*this.length));return r>0&&(o=2*Math.PI-o),o}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:r,dy:n}=this;return Math.sqrt(r*r+n*n)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<Ti(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(r,n){const o=this.backwardLength;if(r<=o)return this._distance=(o-r)/this.length,this;let a=this.backwardLength;for(;this.prev();){if(a+this.length>r)return this._seekBackwards(r-a);a+=this.length}return this._distance=0,n?this:null}seek(r,n=!1){if(r<0)return this._seekBackwards(Math.abs(r),n);if(r<=this.remainingLength)return this._distance=(this.backwardLength+r)/this.length,this;let o=this.remainingLength;for(;this.next();){if(o+this.length>r)return this.seek(r-o,n);o+=this.length}return this._distance=1,n?this:null}}function ns(l,r,n,o=!0){const a=function Li(l){let r=0;for(let n=0;n<Ti(l);n++)r+=rs(l,n);return r}(l),h=te.create(l),c=a/2;if(!o)return h.seek(c),void n(h.clone(),0,c+0*r,a);const u=Math.max((a-r)/2,0),f=Math.floor(u/r);h.seek(c-f*r);for(let m=-f;m<=f;m++)h.x<512&&h.x>=0&&h.y<512&&h.y>=0&&n(h.clone(),m,c+m*r,a),h.seek(r)}function as(l,r){if(r<=0)return;const o=l.length;if(o<3)return;const a=[];let h=0;a.push(0);for(let _=1;_<o;_++)h+=is(l[_],l[_-1]),a.push(h);r=Math.min(r,.2*h);const c=[];c.push(l[0][0]),c.push(l[0][1]);const u=l[o-1][0],f=l[o-1][1],d=vi([0,0],l[0],l[1]);Si(d),l[0][0]+=r*d[0],l[0][1]+=r*d[1],vi(d,l[o-1],l[o-2]),Si(d),l[o-1][0]+=r*d[0],l[o-1][1]+=r*d[1];for(let _=1;_<o;_++)a[_]+=r;a[o-1]+=r;const m=.5*r;for(let _=1;_<o-1;_++){let p=0,y=0,x=0;for(let g=_-1;g>=0&&!(a[g+1]<a[_]-m);g--){const S=m+a[g+1]-a[_],v=a[g+1]-a[g],T=a[_]-a[g]<m?1:S/v;if(Math.abs(T)<1e-6)break;const C=T*T,V=T*S-.5*C*v,A=T*v/r,R=l[g+1],N=l[g][0]-R[0],X=l[g][1]-R[1];p+=A/V*(R[0]*T*S+.5*C*(S*N-v*R[0])-C*T*v*N/3),y+=A/V*(R[1]*T*S+.5*C*(S*X-v*R[1])-C*T*v*X/3),x+=A}for(let g=_+1;g<o&&!(a[g-1]>a[_]+m);g++){const S=m-a[g-1]+a[_],v=a[g]-a[g-1],T=a[g]-a[_]<m?1:S/v;if(Math.abs(T)<1e-6)break;const C=T*T,V=T*S-.5*C*v,A=T*v/r,R=l[g-1],N=l[g][0]-R[0],X=l[g][1]-R[1];p+=A/V*(R[0]*T*S+.5*C*(S*N-v*R[0])-C*T*v*N/3),y+=A/V*(R[1]*T*S+.5*C*(S*X-v*R[1])-C*T*v*X/3),x+=A}c.push(p/x),c.push(y/x)}c.push(u),c.push(f);for(let _=0,p=0;_<o;_++)l[_][0]=c[p++],l[_][1]=c[p++]}var Dt=L(82054),ls=L(72283),hs=L(95727);class bi{static getPlacement(r,n,o,a){const h=(0,hs.W)(n);if(!h)return null;const c=(0,ls.GP)(r);return h.execute(c,n,o,a)}}var cs=L(25797);const Ii=l=>class extends l{constructor(...r){super(...r),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=O.LW.TEXT,this._aux=(0,w.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(r,n){this._shapingInfo=r&&r.length?(0,W.yw)(r,o=>(0,cs.Nr)(o,n,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:I.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):null}_write(r,n,o,a){const h=n.getDisplayId();this._writeGeometry(r,n,h,o,a)}_writeGeometry(r,n,o,a,h){const c=this._shapingInfo;if((0,W.Wi)(c))return;if((0,W.pC)(this._textPlacement)){const f=h??n.readLegacyGeometryForDisplay();return this._writePlacedText(r,o,f,c,a)}const u=h?(0,Dt.oB)((0,Dt.GH)(h),2):"esriGeometryPolygon"===n.geometryType?n.readCentroid():n.readGeometryForDisplay();if(!(0,W.Wi)(u)){if(u.isPoint){const[f,d]=u.coords;return!r.hasAggregates&&r.hasPixelBufferEnabled&&(f<0||f>=512||d<0||d>=512)?void 0:this._writeGlyphs(r,o,{x:f,y:d},c)}u.forEachVertex((f,d)=>this._writeGlyphs(r,o,{x:f,y:d},c))}}_writePlacedText(r,n,o,a,h){const c=(0,W.Wg)(this._textPlacement),u=bi.getPlacement(o,c,(0,P.F2)(1),h.geometryEngine);if(!u)return;let f=u.next();for(;null!=f;){const d=-f.getAngle();a.setRotation(d);const m=f.tx,_=-f.ty;m<0||m>=512||_<0||_>=512||(this._writeGlyphs(r,n,{x:m,y:_},a),a.setRotation(-d)),f=u.next()}}_writeGlyphs(r,n,o,a){const h=D.m2.load(this._materialKey),c=(0,w.UJ)(Math.round(8*o.x),Math.round(8*o.y)),u=this._vertexBoundsScale,f=a.bounds,d=2*Math.max(f.width,f.height);for(const m of a.glyphs)h.textureBinding=m.textureBinding,r.recordStart(n,h.data,this.geometryType,!0),r.vertexBounds(o.x+f.x+this._xOffset,o.y+f.y-this._yOffset,d*u,d*u),this._writeVertices(r,n,c,m),r.recordEnd()}_writeGlyph(r,n,o,a,h){const c=D.m2.load(this._materialKey),u=(0,w.UJ)(Math.round(8*o),Math.round(8*a));c.textureBinding=h.textureBinding,r.recordStart(n,c.data,this.geometryType,!0);const f=h.bounds,d=this._vertexBoundsScale;r.vertexBounds(o+f.x*d,a+f.y*d,f.width*d,f.height*d),this._writeVertices(r,n,u,h),r.recordEnd()}_writeVertices(r,n,o,a){const h=r.vertexCount();this._writeVertexCommon(r,n,o,a),r.vertexWrite(a.offsets.upperLeft),r.vertexWrite(a.texcoords.upperLeft),r.vertexEnd(),this._writeVertexCommon(r,n,o,a),r.vertexWrite(a.offsets.upperRight),r.vertexWrite(a.texcoords.upperRight),r.vertexEnd(),this._writeVertexCommon(r,n,o,a),r.vertexWrite(a.offsets.lowerLeft),r.vertexWrite(a.texcoords.lowerLeft),r.vertexEnd(),this._writeVertexCommon(r,n,o,a),r.vertexWrite(a.offsets.lowerRight),r.vertexWrite(a.texcoords.lowerRight),r.vertexEnd(),r.indexWrite(h+0),r.indexWrite(h+1),r.indexWrite(h+2),r.indexWrite(h+1),r.indexWrite(h+3),r.indexWrite(h+2)}_writeVertexCommon(r,n,o,a){const h=this._color,c=this._haloColor,u=(0,w.Jz)(0,0,this._referenceSize,this._bitset),f=(0,w.Jz)(0,0,this._size,this._haloSize);r.vertexWrite(o),r.vertexWrite(n),r.vertexWrite(h),r.vertexWrite(c),r.vertexWrite(f),r.vertexWrite(u),r.vertexWrite(this._minMaxZoom)}};var Ve=L(73608);class ee{bindFeature(r,n,o){}write(r,n,o,a){if((0,W.Wi)(this._effects)||0===this._effects?.length)return this._write(r,n,a);const h=Ve.j.executeEffects(this._effects,n.readLegacyGeometryForDisplay(),a.geometryEngine);let c=Ve.j.next(h);for(;c;)this._write(r,n,a,c),c=Ve.j.next(h)}_write(r,n,o,a){}}class Zt extends(Ii(ee)){constructor(r,n,o,a,h,c,u,f,d,m,_,p,y,x,g,S,v,T,C=!1,V,A){super(),this._xOffset=(0,P.F2)(y),this._yOffset=(0,P.F2)(x),this._decoration=m||"none",this._color=h,this._haloColor=c,this._haloSize=Math.min(Math.floor(5*(0,P.F2)((0,P.t_)(o))),127),this._size=Math.min(Math.round((0,P.F2)(n)),127);const R=Math.min(Math.round((0,P.F2)(a||n)),127);this._referenceSize=Math.round(Math.sqrt(256*R)),this._scale=this._size/I.Ex,this._angle=p,this._justify=(0,dt.Hd)(u||"center"),this._xAlignD=(0,dt.kH)(u||"center"),this._yAlignD=(0,dt.b7)(f||"baseline"),this._baseline="baseline"===(f||"baseline"),this._bitset=(d===j.v2.MAP?1:0)|(_?1:0)<<1;const N=D.m2.load(r);N.sdf=!0,this._materialKey=N.data,this._lineWidth=(0,P.F2)(g)||512,this._lineHeight=S||1,this._textPlacement=v,this._effects=T,this._isCIM=C,this._minMaxZoom=(0,w.UJ)(Math.round(V*I.MI),Math.round(A*I.MI))}static fromText(r,n){const o=new Zt(r.materialKey,r.font.size,r.haloSize||0,r.font.size,r.color&&(0,Z.aH)(r.color)||0,r.haloColor&&(0,Z.aH)(r.haloColor)||0,r.horizontalAlignment,r.verticalAlignment,j.v2.SCREEN,r.font.decoration,!1,r.angle||0,r.xoffset,r.yoffset,r.lineWidth,r.lineHeight,null,null,!1,0,lt),[,a]=(0,z.E)(r.text);return o.bindTextInfo(n,a),o._vertexBoundsScale=r.maxVVSize?r.maxVVSize/r.font.size:1,o}static fromCIMText(r,n,o){const a=r.scaleFactor||1,h=r.size*r.sizeRatio*a,[c,u]=vt(r.scaleInfo,o),f=new Zt(r.materialKey,h,r.outlineSize*r.sizeRatio,r.referenceSize,(0,Z.t2)(r.color),(0,Z.t2)(r.outlineColor),r.horizontalAlignment,r.verticalAlignment,r.alignment,r.decoration,r.colorLocked,r.angle,r.offsetX*r.sizeRatio*a,r.offsetY*r.sizeRatio*a,512,1,r.markerPlacement,r.effects,!0,c,u),[,d]=(0,z.E)(r.text);return f.bindTextInfo(n,d),f._vertexBoundsScale=r.maxVVSize?r.maxVVSize/h:1,f}}const fs=H.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),xs=function ps(l){const r=new Map;return n=>(r.has(n)||r.set(n,l(n)),r.get(n))}(l=>{let r=0;if(0===l)return 1/0;for(;!(l%2);)r++,l/=2;return r}),xe=l=>Math.floor(127*l+127),ie=l=>Math.floor(10*l),Kt=l=>Math.round(l*(254/360));class ge extends Zt{constructor(r,n,o,a){super(r,o.font.size,o.haloSize||0,o.font.size,o.color&&(0,Z.aH)(o.color)||0,o.haloColor&&(0,Z.aH)(o.haloColor)||0,o.horizontalAlignment,o.verticalAlignment,(0,dt.NS)(n.labelPlacement)?j.v2.MAP:j.v2.SCREEN,o.font.decoration,!1,o.angle||0,o.xoffset,o.yoffset,o.lineWidth,o.lineHeight,null,null,null,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=O.LW.LABEL,this._allowOverrun=n.allowOverrun??!1,this._repeatLabel=n.repeatLabel??!0,this._labelPosition=n.labelPosition??"curved";const h=function _s(l,r){const n=!!l.minScale&&r.scaleToZoom(l.minScale)||0;return(0,gi.uZ)(n,0,25.5)}(n,a),c=function ys(l,r){const n=!!l.maxScale&&r.scaleToZoom(l.maxScale)||255;return(0,gi.uZ)(n,0,25.5)}(n,a),u=n.labelPlacement,[f,d]=(0,dt.qv)(u);this._xAlignD=f,this._yAlignD=d,this._minZoom=h,this._maxZoom=c,this._refPlacementPadding=(0,P.F2)(o.haloSize)+I.Iw,this._repeatLabelDistance=n.repeatLabelDistance?(0,P.F2)(n.repeatLabelDistance):128;const m=D.Gq.load(r);m.sdf=!0,this._materialKey=m.data}static fromLabelClass(r,n){if("esriServerLinePlacementCenterAlong"===r.labelPlacement){const o=r.symbol;o.xoffset=0,o.yoffset=0,o.angle=0,o.font.decoration="none"}return new ge(r.materialKey,r,r.symbol,n)}get _shapedBox(){return(0,W.Wg)(this._shapingInfo).bounds}setZoomLevel(r){this._zoomLevel=r}bindReferenceTemplate(r){let n=(0,dt.g)(this._xAlignD),o=(0,dt.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,W.Wi)(r))return void(this._refSymbolAndPlacementOffset=(0,w.Jz)(0,0,xe(n),xe(o)));if("circle"===r.boundsType&&(n||o)){const c=Math.sqrt(n*n+o*o);n/=c,o/=c}const a=Math.max(r.height,r.width);this._refSymbolAndPlacementOffset=(0,w.Jz)(4*this._refPlacementPadding,a,xe(n),xe(o)),this._referenceSize=a,this._refPlacementDirX=n,this._refPlacementDirY=o,this._refOffsetX=r.xOffset,this._refOffsetY=r.yOffset}_write(r,n){if((0,W.Wi)(this._shapingInfo))return;const o=this._shapingInfo,a=n.getDisplayId(),h="esriGeometryPolygon"===n.geometryType?n.readLegacyCentroid():n.readLegacyGeometry();if(h)switch(this._current={out:r,inId:a,inShaping:o,zoomLevel:this._zoomLevel},n.geometryType){case"esriGeometryPolyline":this._placeLineLabels(h);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(h);break;default:((l,r="mapview-labeling")=>{fs.error(new E.Z(r,"mapview-labeling"))})(0,`Geometry of type ${n.geometryType} is not supported`)}}_isVisible(r,n){const o=ie(this._current.zoomLevel);return ie(r)<=o&&o<=ie(n)}_placePointLabels(r){const{out:n,inId:o,inShaping:a}=this._current;this._writeGlyphs(n,o,r,a)}_placeLineLabels(r){const n=function os(l,r){const n=r;for(let o=0;o<l.length;o++){let a=l[o];const h=[];h.push(a[0]);for(let u=1;u<a.length;u++){let[f,d]=h[u-1];f+=a[u][0],d+=a[u][1],h.push([f,d])}as(h,n);const c=[];c.push(h[0]);for(let u=1;u<h.length;u++){const[f,d]=h[u-1],[m,_]=h[u],p=Math.round(m-f),y=Math.round(_-d);c.push([p,y])}l[o]=c,a=c}return l}(r.paths,this._current.inShaping.bounds.width),o=this._placeSubdivGlyphs.bind(this),a=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const h of n)ns(h,a,o,this._repeatLabel)}_placeSubdivGlyphs(r,n,o,a){const h=xs(n),c=this._shapedBox.width/2,u=Math.sqrt(this._repeatLabelDistance)/2,f=Math.min(o,a-o),d=this._current.inShaping.isMultiline?25:Math.log2(f/(u+c/2)),m=0===n?d:Math.min(h,d),_=Math.max(this._minZoom,this._current.zoomLevel+1-m),p=this._current.zoomLevel-_,y=this._shapedBox.width/2*2**p;this._current.inShaping.isMultiline?0===n&&this._placeStraight(r,_):this._allowOverrun&&p<0?this._placeStraightAlong(r,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(r,_):"curved"===this._labelPosition&&this._placeCurved(r,_,y)}_placeStraight(r,n){const{out:o,inId:a,inShaping:h}=this._current,c=Math.ceil(r.angle*(180/Math.PI)%360),u=Math.ceil((r.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=Kt(c),this._writeGlyphs(o,a,r,h,n),this._outLineLabelAngle=Kt(u),this._writeGlyphs(o,a,r,h,n)}_placeCurved(r,n,o){const{out:a,inId:h}=this._current;a.metricStart(h,n,r.x,r.y,0,0,0,0);const c=r.clone(),u=r.angle*(180/Math.PI)%360,f=(r.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Kt(u),this._placeFirst(c,n,1),this._placeBack(r,c,n,o,1),this._placeForward(r,c,n,o,1),this._outLineLabelAngle=Kt(f),this._placeFirst(c,n,0),this._placeBack(r,c,n,o,0),this._placeForward(r,c,n,o,0),a.metricEnd()}_placeStraightAlong(r,n){const{out:o,inId:a}=this._current;o.metricStart(a,n,r.x,r.y,0,0,0,0);const h=r.clone(),c=r.angle*(180/Math.PI)%360,u=(r.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Kt(c),this._placeFirst(h,n,1,!0),this._outLineLabelAngle=Kt(u),this._placeFirst(h,n,0,!0),o.metricEnd()}_placeBack(r,n,o,a,h){const c=r.clone();let u=r.backwardLength+0;for(;c.prev()&&!(u>=a);)this._placeOnSegment(c,n,u,o,-1,h),u+=c.length+0}_placeForward(r,n,o,a,h){const c=r.clone();let u=r.remainingLength+0;for(;c.next()&&!(u>=a);)this._placeOnSegment(c,n,u,o,1,h),u+=c.length+0}_placeFirst(r,n,o,a=!1){const h=r,c=this._current.inShaping,u=c.glyphs,f=this._current.zoomLevel,{out:d,inId:m}=this._current;for(const _ of u){const p=_.x>c.bounds.x?o:1-o,y=p*r.remainingLength+(1-p)*r.backwardLength,x=Math.abs(_.x+_.width/2-c.bounds.x),g=Math.max(0,f+Math.log2(x/(y+0))),S=Math.max(n,a?0:g);if(_.maxZoom=25,_.angle=r.angle+(1-o)*Math.PI,_.minZoom=S,this._writeGlyph(d,m,h.x,h.y,_),o&&this._isVisible(_.minZoom,_.maxZoom)){const v=_.bounds;d.metricBoxWrite(v.center[0],v.center[1],v.width,v.height)}}}_placeOnSegment(r,n,o,a,h,c){const u=this._current.inShaping.glyphs,{out:f,inId:d}=this._current,m=this._current.inShaping,_=this._current.zoomLevel,x={x:r.x+o*-h*(r.dx/r.length),y:r.y+o*-h*(r.dy/r.length)};for(const g of u){const S=g.x>m.bounds.x?c:1-c;if(!(S&&1===h||!S&&-1===h))continue;const v=Math.abs(g.x+g.width/2-m.bounds.x),T=Math.max(0,_+Math.log2(v/o)-.1),C=Math.max(a,_+Math.log2(v/(o+r.length+0)));if(0!==T&&(g.angle=r.angle+(1-c)*Math.PI,g.minZoom=C,g.maxZoom=T,this._writeGlyph(f,d,x.x,x.y,g),c&&this._isVisible(g.minZoom,g.maxZoom))){const V=g.bounds;f.metricBoxWrite(V.center[0]+(r.x-n.x),V.center[1]+(r.y-n.y),V.width,V.height)}}}_writeGlyphs(r,n,o,a,h=this._minZoom){if(o.x<0||o.x>=512||o.y<0||o.y>=512)return;const c=o.x+this._refOffsetX,u=o.y-this._refOffsetY;for(const _ of a.glyphs)_.minZoom=h,_.maxZoom=this._maxZoom,this._writeGlyph(r,n,c,u,_);const m=a.boundsT;r.metricStart(n,h,c,u,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),r.metricBoxWrite(m.center[0],m.center[1],m.width,m.height),r.metricEnd()}_writeVertexCommon(r,n,o,a){const h=this._color,c=this._haloColor,u=(0,w.Jz)(0,0,this._size,this._haloSize),f=Math.max(a.minZoom,this._minZoom),d=Math.min(a.maxZoom,this._maxZoom),m=(0,w.Jz)(ie(f),ie(d),this._outLineLabelAngle,0);r.vertexWrite(o),r.vertexWrite(n),r.vertexWrite(h),r.vertexWrite(c),r.vertexWrite(u),r.vertexWrite(this._refSymbolAndPlacementOffset),r.vertexWrite(m)}}var Ae=L(12225),ve=L(9545),Pi=L(31478);const zi=3.14159265359/180,Ci=l=>class extends l{constructor(...r){super(...r),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=O.LW.MARKER}_write(r,n,o,a){const h=n.getDisplayId();r.recordStart(h,this._materialKey,this.geometryType,!0),this._writeGeometry(r,n,h,o,a),r.recordEnd()}_writeGeometry(r,n,o,a,h){if((0,W.pC)(this._markerPlacement))return this._writePlacedMarkers(r,n,a,h);if(!h&&"esriGeometryPoint"===n.geometryType){const u=n.getX(),f=n.getY();return!r.hasAggregates&&r.hasPixelBufferEnabled&&(u<0||u>=513||f<0||f>=513)?void 0:this._writeVertices(r,o,this._getPos(u,f),u,f)}const c=h?(0,Dt.oB)((0,Dt.GH)(h),2):"esriGeometryPolygon"===n.geometryType?n.readCentroid():n.readGeometryForDisplay();if(!(0,W.Wi)(c)){if(c.isPoint){const[u,f]=c.coords;return!r.hasAggregates&&r.hasPixelBufferEnabled&&(u<0||u>=512||f<0||f>=512)?void 0:this._writeVertices(r,o,this._getPos(u,f),u,f)}c.forEachVertex((u,f)=>{const d=2*I.I_;u<-d||u>=d||f<-d||f>=d||this._writeVertices(r,o,this._getPos(u,f),u,f)})}}_writePlacedMarkers(r,n,o,a){const h=a??n.readLegacyGeometryForDisplay(),c=bi.getPlacement(h,(0,W.Wg)(this._markerPlacement),(0,P.F2)(1),o.geometryEngine);if(!c)return;const u=n.getDisplayId(),f=(0,ve.c)(),d=(0,Ae.c)();let p=c.next();for(;null!=p;){const y=p.tx,x=-p.ty;y>=-128&&y<=640&&x>=-128&&x<=640&&(this._applyTransformation(d,f,-p.getAngle()/zi),this._writeVertices(r,u,this._getPos(y,x),y,x)),p=c.next()}}_writeVertices(r,n,o,a,h){const c=D.mE.load(this._materialKey);return c.symbologyType===O.mD.HEATMAP?this._writeHeatmapVertices(r,n,o):this._writeMarkerVertices(r,n,c,o,a,h)}_writeMarkerVertices(r,n,o,a,h,c){const u=o.vvRotation,f=r.vertexCount();let d=this._computedWidth*this._vertexBoundsScaleX,m=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){const _=Math.max(d,m);d=_,m=_}if(u){const _=Math.max(this.xOffset,this.yOffset);d+=_,m+=_}r.vertexBounds(h+this.xOffset,c-this.yOffset,d,m),r.vertexWrite(a),r.vertexWrite(this._offsetUpperLeft),r.vertexWrite(this._texUpperLeft),r.vertexWrite(this._bitestAndDistRatio),r.vertexWrite(n),r.vertexWrite(this._fillColor),r.vertexWrite(this._outlineColor),r.vertexWrite(this._sizeOutlineWidth),r.vertexWrite(this._minMaxZoom),r.vertexEnd(),r.vertexWrite(a),r.vertexWrite(this._offsetUpperRight),r.vertexWrite(this._texUpperRight),r.vertexWrite(this._bitestAndDistRatio),r.vertexWrite(n),r.vertexWrite(this._fillColor),r.vertexWrite(this._outlineColor),r.vertexWrite(this._sizeOutlineWidth),r.vertexWrite(this._minMaxZoom),r.vertexEnd(),r.vertexWrite(a),r.vertexWrite(this._offsetBottomLeft),r.vertexWrite(this._texBottomLeft),r.vertexWrite(this._bitestAndDistRatio),r.vertexWrite(n),r.vertexWrite(this._fillColor),r.vertexWrite(this._outlineColor),r.vertexWrite(this._sizeOutlineWidth),r.vertexWrite(this._minMaxZoom),r.vertexEnd(),r.vertexWrite(a),r.vertexWrite(this._offsetBottomRight),r.vertexWrite(this._texBottomRight),r.vertexWrite(this._bitestAndDistRatio),r.vertexWrite(n),r.vertexWrite(this._fillColor),r.vertexWrite(this._outlineColor),r.vertexWrite(this._sizeOutlineWidth),r.vertexWrite(this._minMaxZoom),r.vertexEnd(),this._writeIndices(r,f)}_writeHeatmapVertices(r,n,o){const a=r.vertexCount();r.vertexWrite(o),r.vertexWrite(this._offsetUpperLeft),r.vertexWrite(n),r.vertexEnd(),r.vertexWrite(o),r.vertexWrite(this._offsetUpperRight),r.vertexWrite(n),r.vertexEnd(),r.vertexWrite(o),r.vertexWrite(this._offsetBottomLeft),r.vertexWrite(n),r.vertexEnd(),r.vertexWrite(o),r.vertexWrite(this._offsetBottomRight),r.vertexWrite(n),r.vertexEnd(),this._writeIndices(r,a)}_writeIndices(r,n){r.indexWrite(n+0),r.indexWrite(n+1),r.indexWrite(n+2),r.indexWrite(n+1),r.indexWrite(n+3),r.indexWrite(n+2)}_applyTransformation(r,n,o=0){(0,Pi.a)(r,(0,ve.f)(this.xOffset,-this.yOffset)),this.angle+o!==0&&(0,Pi.r)(r,r,zi*(this.angle+o));const a=this._computedWidth,h=this._computedHeight,c=-(.5+this._anchorX)*a,u=-(.5-this._anchorY)*h;(0,it.s)(n,c,u),(0,it.t)(n,n,r),this._offsetUpperLeft=(0,w.UJ)(16*n[0],16*n[1]),this._offsets.xUpperLeft=n[0],this._offsets.yUpperLeft=n[1],(0,it.s)(n,c+a,u),(0,it.t)(n,n,r),this._offsetUpperRight=(0,w.UJ)(16*n[0],16*n[1]),this._offsets.xUpperRight=n[0],this._offsets.yUpperRight=n[1],(0,it.s)(n,c,u+h),(0,it.t)(n,n,r),this._offsetBottomLeft=(0,w.UJ)(16*n[0],16*n[1]),this._offsets.xBottomLeft=n[0],this._offsets.yBottomLeft=n[1],(0,it.s)(n,c+a,u+h),(0,it.t)(n,n,r),this._offsetBottomRight=(0,w.UJ)(16*n[0],16*n[1]),this._offsets.xBottomRight=n[0],this._offsets.yBottomRight=n[1]}_getPos(r,n){return(0,w.UJ)(Math.round(8*r),Math.round(8*n))}};class ht extends(Ci(ee)){constructor(r,n,o,a,h,c,u,f,d,m,_,p,y,x,g,S,v,T,C,V,A,R,N){super(),this.angle=a,this.height=u,this.width=c,this.xOffset=n*C,this.yOffset=o*C,this._markerPlacement=V,this._effects=A,this._anchorX=S,this._anchorY=v,this._minMaxZoom=(0,w.UJ)(Math.round(R*I.MI),Math.round(N*I.MI));const X=(x===j.v2.MAP?I.Tz:I.CQ)|(_?I.Uh:0)|(y?I.oK:0)|(p?I.e0:0),pt=g&&g.sdf,St=D.mE.load(r);St.sdf=pt,St.pattern=!0,St.textureBinding=g.textureBinding,this._materialKey=St.data,this._fillColor=h,this._outlineColor=d,this._sizeOutlineWidth=(0,w.Jz)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const Tt=g.rect.x+I.fL,ut=g.rect.y+I.fL,Yt=Tt+g.width,jt=ut+g.height;this._offsets.xUpperLeft=Tt,this._offsets.yUpperLeft=ut,this._offsets.xUpperRight=Yt,this._offsets.yUpperRight=ut,this._offsets.xBottomLeft=Tt,this._offsets.yBottomLeft=jt,this._offsets.xBottomRight=Yt,this._offsets.yBottomRight=jt,St.symbologyType===O.mD.PIE_CHART?(this._texUpperLeft=(0,w.UJ)(0,1),this._texUpperRight=(0,w.UJ)(1,1),this._texBottomLeft=(0,w.UJ)(0,0),this._texBottomRight=(0,w.UJ)(1,0)):(this._texUpperLeft=(0,w.UJ)(Tt,ut),this._texUpperRight=(0,w.UJ)(Yt,ut),this._texBottomLeft=(0,w.UJ)(Tt,jt),this._texBottomRight=(0,w.UJ)(Yt,jt)),c*=T,u*=T,c*=C,u*=C;const Tr=Math.round(64*T);this._bitestAndDistRatio=(0,w.UJ)(X,Tr),this._computedWidth=c,this._computedHeight=u;const Lr=(0,ve.c)(),br=(0,Ae.c)();this._applyTransformation(br,Lr)}static fromCIMMarker(r,n,o){const c=r.size,u=(n&&n.width||1)/(n&&n.height||1)*r.scaleX,f=r.scaleSymbolsProportionally&&r.frameHeight?c/r.frameHeight:1;let d=(0,Z.t2)(r.color);const m=(0,Z.t2)(r.outlineColor),_=(0,P.F2)(c),p=_*u,y=(0,P.F2)(r.offsetX||0),x=(0,P.F2)(r.offsetY||0),g=(0,P.F2)(r.outlineWidth||0)*f,S=r.alignment||j.v2.SCREEN,v=(0,P.F2)(r.referenceSize),[T,C]=vt(r.scaleInfo,o);n.sdf||0!==d||(d=-1);let V=r.rotation||0;r.rotateClockwise||(V=-V);let A=0,R=0;const N=r.anchorPoint;N&&(r.isAbsoluteAnchorPoint?c&&(A=N.x/(c*u),R=N.y/c):(A=N.x,R=N.y));const X=new ht(r.materialKey,y,x,V,d,p,_,v,m,g,r.colorLocked,r.scaleSymbolsProportionally,!1,S,n,A,R,r.sizeRatio,(0,W.Pt)(r.scaleFactor,1),r.markerPlacement,r.effects,T,C);return X._vertexBoundsScaleX=r.maxVVSize?r.maxVVSize/p:1,X._vertexBoundsScaleY=r.maxVVSize?r.maxVVSize/_:1,X}static fromPictureMarker(r,n){const o=Math.round((0,P.F2)(r.width)),a=Math.round((0,P.F2)(r.height)),h=I.ru,c=Math.round((0,P.F2)(r.xoffset||0)),u=Math.round((0,P.F2)(r.yoffset||0)),f=new ht(r.materialKey,c,u,r.angle,h,o,a,a,0,0,!1,!1,!1,j.v2.SCREEN,n,0,0,1,1,null,null,0,lt);return f._vertexBoundsScaleX=r.maxVVSize?r.maxVVSize/r.width:1,f._vertexBoundsScaleY=r.maxVVSize?r.maxVVSize/r.height:1,f}static fromSimpleMarker(r,n){const o=(0,Z.aH)(r.color),a=Math.round((0,P.F2)(r.size)),h=a,c=Math.round((0,P.F2)(r.xoffset||0)),u=Math.round((0,P.F2)(r.yoffset||0)),f=r.style,d=r.outline,m=0|(d&&d.color&&(0,Z.aH)(d.color)),_=0|(d&&d.width&&Math.round((0,P.F2)(d.width))),p=new ht(r.materialKey,c,u,r.angle,o,a,h,h,m,_,!1,!1,"esriSMSCross"===f||"esriSMSX"===f,j.v2.SCREEN,n,0,0,126/64,1,null,null,0,lt);return p.boundsType="esriSMSCircle"===f?"circle":"square",p._vertexBoundsScaleX=r.maxVVSize?r.maxVVSize/r.size:1,p._vertexBoundsScaleY=r.maxVVSize?r.maxVVSize/r.size:1,p}static fromLineSymbolMarker(r,n){const o=(0,Z.aH)(r.color),h=Math.round((0,P.F2)(6*r.lineWidth)),c=h,u="cross"===r.style||"x"===r.style;let f;switch(r.placement){case"begin-end":f=j.Tx.Both;break;case"begin":f=j.Tx.JustBegin;break;case"end":f=j.Tx.JustEnd;break;default:f=j.Tx.None}const d={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:f,offsetAlongLine:0},m=new ht(r.materialKey,0,0,0,o,h,c,c/6,o,u?Math.round((0,P.F2)(r.lineWidth)):0,!1,!1,u,j.v2.MAP,n,0,0,126/64,1,d,null,0,lt);return m.boundsType="circle"===r.style?"circle":"square",m}}var Nt=L(24837),Re=L(43289),gs=(L(11915),L(88071)),Ei=L(97938),Fi=L(47018);function vs(l,r,n,o,a,h,c){Oe=0;const u=(o-n)*h,f=a&&a.length,d=f?(a[0]-n)*h:u;let m,_,p,y,x,g=Vi(r,n,0,0,d,h,!0);if(g&&g.next!==g.prev){if(f&&(g=function Ls(l,r,n,o,a,h){const c=new Array;for(let u=0,f=o.length;u<f;u++){const d=Vi(l,r,0,o[u]*h,u<f-1?o[u+1]*h:n*h,h,!1);d===d.next&&(d.steiner=!0),c.push(Ts(d))}c.sort(Ws);for(const u of c)a=bs(u,a);return a}(r,n,o,a,g,h)),u>80*h){m=p=r[0+n*h],_=y=r[1+n*h];for(let S=h;S<d;S+=h){const v=r[S+n*h],T=r[S+1+n*h];m=Math.min(m,v),_=Math.min(_,T),p=Math.max(p,v),y=Math.max(y,T)}x=Math.max(p-m,y-_),x=0!==x?1/x:0}re(g,l,h,m,_,x,c,0)}}function Vi(l,r,n,o,a,h,c){let u;if(c===function zs(l,r,n,o,a,h){let c=0;for(let u=o,f=a-h;u<a;u+=h)c+=(l[f+r*h]-l[u+r*h])*(l[u+1+r*h]+l[f+1+r*h]),f=u;return c}(l,r,0,o,a,h)>0)for(let f=o;f<a;f+=h)u=Ai(f+r*h,l[f+r*h],l[f+1+r*h],u);else for(let f=a-h;f>=o;f-=h)u=Ai(f+r*h,l[f+r*h],l[f+1+r*h],u);return u&&It(u,u.next)&&(ne(u),u=u.next),u}function se(l,r=l){if(!l)return l;let n,o=l;do{if(n=!1,o.steiner||!It(o,o.next)&&0!==Q(o.prev,o,o.next))o=o.next;else{if(ne(o),o=r=o.prev,o===o.next)break;n=!0}}while(n||o!==r);return r}function re(l,r,n,o,a,h,c,u){if(!l)return;!u&&h&&(l=Ri(l,o,a,h));let f=l;for(;l.prev!==l.next;){const d=l.prev,m=l.next;if(h?Ss(l,o,a,h):Ms(l))r.push(d.index/n+c),r.push(l.index/n+c),r.push(m.index/n+c),ne(l),l=m.next,f=m.next;else if((l=m)===f){u?1===u?re(l=Cs(l,r,n,c),r,n,o,a,h,c,2):2===u&&Es(l,r,n,o,a,h,c):re(se(l),r,n,o,a,h,c,1);break}}}function Ms(l){const r=l.prev,n=l,o=l.next;if(Q(r,n,o)>=0)return!1;let a=l.next.next;const h=a;let c=0;for(;a!==l.prev&&(0===c||a!==h);){if(c++,Jt(r.x,r.y,n.x,n.y,o.x,o.y,a.x,a.y)&&Q(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function Ss(l,r,n,o){const a=l.prev,h=l,c=l.next;if(Q(a,h,c)>=0)return!1;const d=a.x>h.x?a.x>c.x?a.x:c.x:h.x>c.x?h.x:c.x,m=a.y>h.y?a.y>c.y?a.y:c.y:h.y>c.y?h.y:c.y,_=Ue(a.x<h.x?a.x<c.x?a.x:c.x:h.x<c.x?h.x:c.x,a.y<h.y?a.y<c.y?a.y:c.y:h.y<c.y?h.y:c.y,r,n,o),p=Ue(d,m,r,n,o);let y=l.prevZ,x=l.nextZ;for(;y&&y.z>=_&&x&&x.z<=p;){if(y!==l.prev&&y!==l.next&&Jt(a.x,a.y,h.x,h.y,c.x,c.y,y.x,y.y)&&Q(y.prev,y,y.next)>=0||(y=y.prevZ,x!==l.prev&&x!==l.next&&Jt(a.x,a.y,h.x,h.y,c.x,c.y,x.x,x.y)&&Q(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=_;){if(y!==l.prev&&y!==l.next&&Jt(a.x,a.y,h.x,h.y,c.x,c.y,y.x,y.y)&&Q(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=p;){if(x!==l.prev&&x!==l.next&&Jt(a.x,a.y,h.x,h.y,c.x,c.y,x.x,x.y)&&Q(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ai(l,r,n,o){const a=Xt.create(l,r,n);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function ne(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Ts(l){let r=l,n=l;do{(r.x<n.x||r.x===n.x&&r.y<n.y)&&(n=r),r=r.next}while(r!==l);return n}function bs(l,r){const n=function Is(l,r){let n=r;const o=l.x,a=l.y;let h,c=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){const p=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(p<=o&&p>c){if(c=p,p===o){if(a===n.y)return n;if(a===n.next.y)return n.next}h=n.x<n.next.x?n:n.next}}n=n.next}while(n!==r);if(!h)return null;if(o===c)return h.prev;const u=h,f=h.x,d=h.y;let m,_=1/0;for(n=h.next;n!==u;)o>=n.x&&n.x>=f&&o!==n.x&&Jt(a<d?o:c,a,f,d,a<d?c:o,a,n.x,n.y)&&(m=Math.abs(a-n.y)/(o-n.x),(m<_||m===_&&n.x>h.x)&&oe(n,l)&&(h=n,_=m)),n=n.next;return h}(l,r);if(!n)return r;const o=Bi(n,l);return se(o,o.next),se(n,n.next)}function Ri(l,r,n,o){for(let a;a!==l;a=a.next){if(a=a||l,null===a.z&&(a.z=Ue(a.x,a.y,r,n,o)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,Ri(l,r,n,o);a.prevZ=a.prev,a.nextZ=a.next}return l.prevZ.nextZ=null,l.prevZ=null,function ws(l){let r,n=1;for(;;){let o,a=l;l=null,r=null;let h=0;for(;a;){h++,o=a;let c=0;for(;c<n&&o;c++)o=o.nextZ;let u=n;for(;c>0||u>0&&o;){let f;0===c?(f=o,o=o.nextZ,u--):0!==u&&o?a.z<=o.z?(f=a,a=a.nextZ,c--):(f=o,o=o.nextZ,u--):(f=a,a=a.nextZ,c--),r?r.nextZ=f:l=f,f.prevZ=r,r=f}a=o}if(r.nextZ=null,n*=2,h<2)return l}}(l)}function Q(l,r,n){return(r.y-l.y)*(n.x-r.x)-(r.x-l.x)*(n.y-r.y)}function Ui(l,r,n,o){return!!(It(l,r)&&It(n,o)||It(l,o)&&It(n,r))||Q(l,r,n)>0!=Q(l,r,o)>0&&Q(n,o,l)>0!=Q(n,o,r)>0}function Jt(l,r,n,o,a,h,c,u){return(a-c)*(r-u)-(l-c)*(h-u)>=0&&(l-c)*(o-u)-(n-c)*(r-u)>=0&&(n-c)*(h-u)-(a-c)*(o-u)>=0}function oe(l,r){return Q(l.prev,l,l.next)<0?Q(l,r,l.next)>=0&&Q(l,l.prev,r)>=0:Q(l,r,l.prev)<0||Q(l,l.next,r)<0}function Ue(l,r,n,o,a){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-n)*a)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)*a)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function It(l,r){return l.x===r.x&&l.y===r.y}function Ws(l,r){return l.x-r.x}function Cs(l,r,n,o){let a=l;do{const h=a.prev,c=a.next.next;!It(h,c)&&Ui(h,a,a.next,c)&&oe(h,c)&&oe(c,h)&&(r.push(h.index/n+o),r.push(a.index/n+o),r.push(c.index/n+o),ne(a),ne(a.next),a=l=c),a=a.next}while(a!==l);return a}function Es(l,r,n,o,a,h,c){let u=l;do{let f=u.next.next;for(;f!==u.prev;){if(u.index!==f.index&&Fs(u,f)){let d=Bi(u,f);return u=se(u,u.next),d=se(d,d.next),re(u,r,n,o,a,h,c,0),void re(d,r,n,o,a,h,c,0)}f=f.next}u=u.next}while(u!==l)}function Fs(l,r){return l.next.index!==r.index&&l.prev.index!==r.index&&!function Ps(l,r){let n=l;do{if(n.index!==l.index&&n.next.index!==l.index&&n.index!==r.index&&n.next.index!==r.index&&Ui(n,n.next,l,r))return!0;n=n.next}while(n!==l);return!1}(l,r)&&oe(l,r)&&oe(r,l)&&function Vs(l,r){let n=l,o=!1;const a=(l.x+r.x)/2,h=(l.y+r.y)/2;do{n.y>h!=n.next.y>h&&n.next.y!==n.y&&a<(n.next.x-n.x)*(h-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next}while(n!==l);return o}(l,r)}function Bi(l,r){const n=Xt.create(l.index,l.x,l.y),o=Xt.create(r.index,r.x,r.y),a=l.next,h=r.prev;return l.next=r,r.prev=l,n.next=a,a.prev=n,o.next=n,n.prev=o,h.next=o,o.prev=h,o}class Xt{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(r,n,o){const a=Oe<Be.length?Be[Oe++]:new Xt;return a.index=r,a.x=n,a.y=o,a.prev=null,a.next=null,a.z=null,a.prevZ=null,a.nextZ=null,a.steiner=!1,a}}const Be=new Array;let Oe=0;for(let l=0;l<8096;l++)Be.push(new Xt);const wt=new Fi.b(0,0,0,1,0),ke=new Fi.b(0,0,0,1,0);function De(l,r,n){let o=0;for(let a=1;a<n;a++)o+=(l[2*(r+a)]-l[2*(r+a-1)])*(l[2*(r+a)+1]+l[2*(r+a-1)+1]);return o}function Us(l,r,n,o,a){let h=0;for(let u=n;u<o;u+=3){const f=2*(l[u]-a),d=2*(l[u+1]-a),m=2*(l[u+2]-a);h+=Math.abs((r[f]-r[m])*(r[d+1]-r[f+1])-(r[f]-r[d])*(r[m+1]-r[f+1]))}return h}wt.setExtent(I.I_),ke.setExtent(I.I_);var Gs=L(46519);const ki=l=>class extends l{constructor(...r){super(...r),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=O.LW.LINE}writeGeometry(r,n,o,a){this._writeGeometry(r,n,o,a)}_initializeTessellator(r){const n=D.a.load(this._materialKey),o=D.dk.load(this._materialKey),a=this._tessellationOptions,c=this.tessellationProperties._halfWidth<I.tQ&&!r&&!(n.vvSizeFieldStops||n.vvSizeMinMaxValue||n.vvSizeScaleStops||n.vvSizeUnitValue);this.tessellationProperties.minMaxZoom=this._minMaxZoom,a.wrapDistance=65535,a.textured=this._isDashed||this._hasPattern,a.offset=this.tessellationProperties.offset,a.halfWidth=this.tessellationProperties._halfWidth;const u=c?0:1,f=(0,D.CA)(o)?Ns:Ks;this._lineTessellator=new Gs.z(f(this.tessellationProperties,u,u),Js(this.tessellationProperties),c)}_write(r,n,o,a){const h="esriGeometryPoint"===n.geometryType;r.recordStart(n.getDisplayId(),this._materialKey,this.geometryType,h),this._writeGeometry(r,n,a,h),r.recordEnd()}_writeGeometry(r,n,o,a){const h=o??n.readLegacyGeometryForDisplay(),c=this._getLines(h,a);(0,W.Wi)(c)||this._writeVertices(r,n,c)}_getLines(r,n){if((0,W.Wi)(r))return null;const o=r.paths||r.rings;return(0,W.Wi)(o)?null:function Zs(l,r){ke.setPixelMargin(r);const n=ke,o=-r,a=I.I_+r;let h=[],c=!1,u=0;for(;u<l.length;){const f=[],d=l[u];if(!d)return null;n.reset(Ei.V.LineString);let[m,_]=d[0];if(c)n.moveTo(m,_);else{if(m<o||m>a||_<o||_>a){c=!0;continue}f.push({x:m,y:_})}let p=!1;const y=d.length;for(let x=1;x<y;++x)if(m+=d[x][0],_+=d[x][1],c)n.lineTo(m,_);else{if(m<o||m>a||_<o||_>a){p=!0;break}f.push({x:m,y:_})}if(p)c=!0;else{if(c){const x=n.resultWithStarts();if(x)for(const g of x)h.push(g)}else h.push({line:f,start:0});u++,c=!1}}return h=h.filter(f=>f.line.length>1),0===h.length?null:h}(o,n?256:16)}_writeVertices(r,n,o){const a=n.getDisplayId(),h=r.vertexCount(),c=this.tessellationProperties,u=this._tessellationOptions;c.out=r,c.id=a,c.indexCount=0,c.vertexCount=0,c.offset=h,u.capType=this._capType,u.joinType=this._joinType;const f=D.dk.load(this._materialKey);this.tessellationProperties.key=(0,D.CA)(f)?f:D.a.load(this._materialKey);for(const{line:d,start:m}of o)u.initialDistance=m%65535,this._lineTessellator.tessellate(d,u)}},Ks=(l,r,n)=>(o,a,h,c,u,f,d,m,_,p,y)=>{const x=(0,w.UJ)(y,Math.ceil(16*l._halfWidth)),g=(0,w.Jz)(Math.round(16*d),Math.round(16*m),Math.round(16*_),Math.round(16*p)),S=(0,w.Jz)(16*u,16*f,0,l._bitset),v=l.out;return v.vertexBounds(o,a,r,n),v.vertexWrite((0,w.UJ)(8*o,8*a)),v.vertexWrite(l.id),v.vertexWrite(l._fillColor),v.vertexWrite(g),v.vertexWrite(x),v.vertexWrite(l._tl),v.vertexWrite(l._br),v.vertexWrite(S),v.vertexWrite((0,w.UJ)(Math.ceil(16*l._halfReferenceWidth),0)),v.vertexWrite(l.minMaxZoom),v.vertexEnd(),l.offset+l.vertexCount++},Ns=(l,r,n)=>(o,a,h,c,u,f,d,m,_,p,y)=>{const x=(0,w.UJ)(16*l._halfWidth,16*l._halfReferenceWidth),g=(0,w.Jz)(16*d+128,16*m+128,16*_+128,16*p+128),S=l.out,v=l._bitset<<24|l.id;S.vertexBounds(o,a,r,n),S.vertexWrite((0,w.UJ)(8*o,8*a)),S.vertexWrite(v),S.vertexWrite(l._fillColor);const T=(0,D.Xp)(l.key);return T||(S.vertexWrite(0),S.vertexWrite(0)),S.vertexWrite(0),S.vertexWrite(x),S.vertexWrite(g),T||S.vertexWrite(l.minMaxZoom),S.vertexEnd(),l.offset+l.vertexCount++},Js=l=>(r,n,o)=>{const a=l.out;a.indexWrite(r),a.indexWrite(n),a.indexWrite(o),l.indexCount+=3};class mt extends(ki(ee)){constructor(r,n,o,a,h,c,u,f,d,m,_,p,y,x,g,S,v,T,C,V){super();const A=D.a.load(r);n&&(A.sdf=n.sdf,A.pattern=!0,A.textureBinding=n.textureBinding),this._capType=a,this._joinType=h,this._miterLimitCosine=Ee(c),this.tessellationProperties._fillColor=u,this.tessellationProperties._tl=f,this.tessellationProperties._br=d,this._hasPattern=m,this._isDashed=_,this._zOrder=v,this._effects=T,this._minMaxZoom=(0,w.UJ)(Math.round(C*I.MI),Math.round(V*I.MI)),this._materialKey=A.data,this.tessellationProperties._bitset=(y?I.Uh:0)|(x?I.SD:0)|(p?I._6:0)|(g?I.Iv:0),this.tessellationProperties._halfWidth=.5*o,this.tessellationProperties._halfReferenceWidth=.5*S,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(r,n,o){const a=r.color,h=r.scaleFactor||1,c=!!r.dashTemplate;let u=r.cap;c&&u===j.RL.ROUND&&(u=j.RL.SQUARE);const f=r.join,d=(0,P.F2)(r.width)*h,m=(0,P.F2)(r.referenceWidth),_=(0,P.F2)(r.miterLimit),p=a&&(0,Z.t2)(a)||0,[y,x]=vt(r.scaleInfo,o);if(!n)return new mt(r.materialKey,n,d,u,f,_,p,0,0,!1,c,r.scaleDash,r.colorLocked,!1,r.sampleAlphaOnly,m,r.zOrder,r.effects,y,x);const{rect:S,width:v,height:T}=n,C=S.x+I.fL,V=S.y+I.fL,A=C+v,R=V+T,N=(0,w.UJ)(C,V),X=(0,w.UJ)(A,R);return new mt(r.materialKey,n,d,u,f,_,p,N,X,!0,c,r.scaleDash,r.colorLocked,!1,r.sampleAlphaOnly,m,r.zOrder,r.effects,y,x)}static fromFillOutline(r){const n=D.dk.load(r.materialKey);return(0,D.CA)(n)&&r.outline&&"esriSLSSolid"===r.outline?.style?mt.fromSimpleLine({hash:"",materialKey:r.materialKey,...r.outline},null,!0):null}static fromSimpleLine(r,n,o=!1){const{color:a}=r,h="esriSLSSolid"!==r.style&&"esriSLSNull"!==r.style,c=(0,qt.ws)(r.cap||"round"),u=(0,qt.xV)(r.join||"round");let f=a&&"esriSLSNull"!==r.style&&(0,Z.aH)(a)||0;"esriSLSNull"===r.style&&(f=0);const d=(0,P.F2)(r.width),m=r.miterLimit;if(!n)return new mt(r.materialKey,n,d,c,u,m,f,0,0,!1,h,!0,!1,o,!1,d,0,null,0,lt);const{rect:_,width:p,height:y}=n,x=_.x+I.fL,g=_.y+I.fL,S=x+p,v=g+y,T=(0,w.UJ)(x,g),C=(0,w.UJ)(S,v);return new mt(r.materialKey,n,d,c,u,m,f,T,C,!0,h,!0,!1,o,!1,d,0,null,0,lt)}static fromPictureLineSymbol(r,n,o,a){return H.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!"),null}}const Zi=l=>class extends l{constructor(...r){super(...r),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=O.LW.FILL}_maybeAddLineTemplate(r){this._lineTemplate=mt.fromFillOutline(r)}_write(r,n,o,a){const h="esriGeometryPoint"===n.geometryType,c=D.dk.load(this._materialKey);r.recordStart(n.getDisplayId(),this._materialKey,this.geometryType,h),this._writeGeometry(r,n,c,a,h),(0,D.CA)(c)&&(0,W.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(r,n,a,h),r.recordEnd()}_writeGeometry(r,n,o,a,h){const c=this._getGeometry(n,a,h);if((0,W.Wi)(c))return;const u=[];if(!(c.maxLength>100)&&!this.forceLibtess&&function Bs(l,r){const{coords:n,lengths:o,hasIndeterminateRingOrder:a}=r,c=l;if(a)return!1;let u=0;for(let f=0;f<o.length;){let d=f,m=o[f],_=De(n,u,m);const p=[];for(;++d<o.length;){const S=o[d],v=De(n,u+m,S);if(!(v>0))break;_+=v,p.push(u+m),m+=S}const y=c.length;vs(c,n,u,u+m,p,2,0);const x=Us(c,n,y,c.length,0),g=Math.abs(_);if(Math.abs((x-g)/Math.max(1e-7,g))>1e-5)return c.length=0,!1;f=d,u+=m}return!0}(u,c))return void(u.length&&this._writeVertices(r,n,c.coords,c.lengths,o,u));const f=function Os(l){const{coords:r,lengths:n}=l,{buffer:o}=(0,xi.b)(r,n);return o}(c);this._writeVertices(r,n,f,[f.length/2],o)}_writeVertex(r,n,o,a,h,c){const u=(0,w.UJ)(1*a,1*h);if(r.vertexBounds(a,h,0,0),r.vertexWrite(u),r.vertexWrite(n),o.symbologyType===O.mD.DOT_DENSITY)r.vertexWriteF32(1/Math.abs(c.readGeometryArea()));else{r.vertexWrite(this.fillColor);const f=(0,D.Xp)(o);f||(r.vertexWrite(this.tl),r.vertexWrite(this.br)),r.vertexWrite(this.aux21),r.vertexWrite(this.aux22),r.vertexWrite(this.aux3),f||r.vertexWrite(this._minMaxZoom)}}_writeVertices(r,n,o,a,h,c){const u=n.getDisplayId(),f=this._bitset<<24|u,d=a.reduce((y,x)=>y+x),m=(0,qt.$_)(h.geometryType,h.symbologyType).geometry/4,_=r.vertexCount();r.vertexEnsureSize(m*d);let p=0;if(c)for(const y of c)this._writeVertex(r,f,h,o[2*y],o[2*y+1],n),p++;else for(let y=0;y<o.length;y+=2){const x=Math.round(o[y]),g=Math.round(o[y+1]);this._writeVertex(r,f,h,x,g,n),p++}r.indexEnsureSize(p);for(let y=0;y<p;y++)r.indexWrite(y+_)}_getGeometry(r,n,o){const a=n?(0,Dt.oB)((0,Dt.GH)(n),2):r.readGeometryForDisplay();return a?function Ds(l,r){if((0,W.Wi)(l))return null;if(!function ks(l,r,n){let o=0;for(let a=0;a<l.lengths.length;a++){const h=l.lengths[a];for(let c=0;c<h;c++){const u=l.coords[2*(c+o)],f=l.coords[2*(c+o)+1];if(u<r||u>n||f<r||f>n)return!0}o+=h}return!1}(l,-128,I.I_+128))return l;wt.setPixelMargin(r),wt.reset(Ei.V.Polygon);let n=0;for(let c=0;c<l.lengths.length;c++){const u=l.lengths[c];let f=l.coords[2*(0+n)],d=l.coords[2*(0+n)+1];wt.moveTo(f,d);for(let m=1;m<u;m++)f=l.coords[2*(m+n)],d=l.coords[2*(m+n)+1],wt.lineTo(f,d);wt.close(),n+=u}const o=wt.result(!1);if(!o)return null;const a=[],h=[];for(const c of o){let u=0;for(const f of c)h.push(f.x),h.push(f.y),u++;a.push(u)}return new gs.Z(a,h)}(a,o?256:8):null}};var Gi=L(93678),Se=L(80991);const Ki=H.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class Te extends ee{constructor(r){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=r}analyze(r,n,o,a,h){if(h&&0===h.length)return null;const c=h&&h.length>0,u=n.readLegacyFeature(),f=n.getObjectId(),d=this._materialCache,m=this._cimLayer.materialHash;if(!m)return Ki.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const _="function"==typeof m?m(u,o,a,f):m;if(d.has(_)){const C=d.get(_);return Promise.resolve(C)}const p=this._ongoingMaterialRequestMap.get(_);if(p)return p;const y=this._cimLayer,x=(0,Gi.S)(y.cim,this._cimLayer.materialOverrides);x.mosaicHash=_;const{type:g,url:S}=y,v={cim:x,type:g,mosaicHash:_,url:S,size:null,dashTemplate:null,text:null,fontName:null,objectId:f,animatedSymbolProperties:null};switch(g){case"marker":v.size=(0,Se.hf)(y.size,u,o,a),v.animatedSymbolProperties=(0,Se.hf)(y.animatedSymbolProperties,u,o,a);break;case"line":v.dashTemplate=y.dashTemplate;break;case"text":v.text=(0,Se.hf)(y.text,u,o,a),v.fontName=(0,Se.hf)(y.fontName,u,o,a)}const T=r.getMosaicItem(v,h).then(C=>(c||(this._ongoingMaterialRequestMap.delete(_),d.set(_,C)),C)).catch(C=>(this._ongoingMaterialRequestMap.delete(_),Ki.error(".analyze()",C.message),null));return c||this._ongoingMaterialRequestMap.set(_,T),T}}function st(l,r){if(l&&"name"in l){const n=l;return r&&r.error(new E.Z(n.name,n.message,n.details)),!1}return!0}class Ze extends(Zi(Te)){constructor(r,n,o){if(super(r),this._minMaxZoom=(0,w.UJ)(Math.round(n*I.MI),Math.round(o*I.MI)),B(r.color))this._dynamicPropertyMap.set("fillColor",(_,p,y)=>{const x=r.color(_,p,y);return x&&(0,Z.t2)(x)||0});else{const m=r.color;this.fillColor=m&&(0,Z.t2)(m)||0}const a="CIMMarkerPlacementInsidePolygon"===r.cim.placement?.type&&r.cim.placement.shiftOddRows?2:1,h=r.height;B(h)?this._dynamicPropertyMap.set("_height",(_,p,y)=>h(_,p,y)*a):this._height=(h||0)*a;const c=r.offsetX;B(c)?this._dynamicPropertyMap.set("_offsetX",(_,p,y)=>(0,P.F2)(c(_,p,y))):this._offsetX=(0,P.F2)(c||0);const u=r.offsetY;B(u)?this._dynamicPropertyMap.set("_offsetY",(_,p,y)=>(0,P.F2)(-u(_,p,y))):this._offsetY=(0,P.F2)(-u||0);const f=r.scaleX;B(f)?this._dynamicPropertyMap.set("_scaleX",f):this._scaleX=f||1;const d=r.angle;if(B(d)?this._dynamicPropertyMap.set("_angle",(_,p,y)=>(0,Re.s5)(d(_,p,y))):this._angle=(0,Re.s5)(d)||0,(0,W.pC)(r.effects)){const m=r.effects;B(m)?this._dynamicPropertyMap.set("_effects",m):this._effects=m}this._cimFillLayer=r,this._bitset=(r.colorLocked?I.Uh:0)|(r.applyRandomOffset?I.jk:0)|(r.sampleAlphaOnly?I.Iv:0),this._fillMaterialKey=r.materialKey}static fromCIMFill(r,n){const[o,a]=vt(r.scaleInfo,n);return new Ze(r,o,a)}bindFeature(r,n,o){const a=r.readLegacyFeature();this._dynamicPropertyMap.forEach((m,_)=>{this[_]=m(a,n,o)});const h=D.dk.load(this._fillMaterialKey),c=this._materialCache,u=(0,this._cimFillLayer.materialHash)(a,n,o),f=c.get(u);let d=null;if(f&&st(f.spriteMosaicItem)&&(d=f.spriteMosaicItem),d){const{rect:m,width:_,height:p}=d,y=m.x+I.fL,x=m.y+I.fL,g=y+_,S=x+p;let v=Math.round((0,P.F2)(this._height));v<=0&&(v=S-x);let T=Math.round((0,P.F2)(this._height/p*_||0));T<=0&&(T=g-y);const C=this._scaleX,V=1;this.tl=(0,w.UJ)(y,x),this.br=(0,w.UJ)(g,S),this.aux21=(0,w.UJ)(T,v),this.aux22=(0,w.UJ)(this._offsetX,this._offsetY),this.aux3=(0,w.Jz)(128*C,128*V,this._angle,0),h.sdf=d.sdf,h.pattern=!0,h.textureBinding=d.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,h.sdf=!1,h.pattern=!1,h.textureBinding=0;this._materialKey=h.data}}class Ge extends(ki(Te)){constructor(r,n,o){super(r),this._minMaxZoom=(0,w.UJ)(Math.round(n*I.MI),Math.round(o*I.MI)),this._cimLineLayer=r;let a=0;B(r.width)||(a=.5*(0,P.F2)(r.width)),this._dynamicPropertyMap.set("_halfWidth",(_,p,y)=>B(r.width)?.5*(0,P.F2)(r.width(_,p,y)):a),B(r.cap)?this._dynamicPropertyMap.set("_capType",r.cap):this._capType=r.cap,B(r.join)?this._dynamicPropertyMap.set("_joinType",r.join):this._joinType=r.join;const c=r.color;B(c)?this._dynamicPropertyMap.set("_fillColor",(p,y,x)=>(0,Z.t2)(c(p,y,x))):this._fillColor=c&&(0,Z.t2)(c)||0;const u=r.miterLimit;if(B(u)?this._dynamicPropertyMap.set("_miterLimitCosine",(p,y,x)=>Ee(u(p,y,x))):this._miterLimitCosine=Ee(u),(0,W.pC)(r.effects)){const _=r.effects;B(_)?this._dynamicPropertyMap.set("_effects",_):this._effects=_}this._scaleFactor=r.scaleFactor||1,this._isDashed=null!=r.dashTemplate,this.tessellationProperties._bitset=(r.colorLocked?I.Uh:0)|(r.scaleDash?I._6:0)|(r.sampleAlphaOnly?I.Iv:0),this._materialKey=r.materialKey,this._initializeTessellator(!0)}static fromCIMLine(r,n){const[o,a]=vt(r.scaleInfo,n);return new Ge(r,o,a)}bindFeature(r,n,o){const a=r.readLegacyFeature();this._dynamicPropertyMap.forEach((m,_)=>{this[_]=m(a,n,o)}),this._halfWidth*=this._scaleFactor;const h=this._materialCache,c=(0,this._cimLineLayer.materialHash)(a,n,o),u=h.get(c);let f=null;if(u&&st(u.spriteMosaicItem)&&(f=u.spriteMosaicItem),f){this._hasPattern=!0;const{rect:m,width:_,height:p}=f,y=m.x+I.fL,x=m.y+I.fL,g=y+_,S=x+p;this.tessellationProperties._tl=(0,w.UJ)(y,x),this.tessellationProperties._br=(0,w.UJ)(g,S)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const d=D.a.load(this._materialKey);f&&(d.sdf=f.sdf,d.pattern=!0,d.textureBinding=f.textureBinding),this._materialKey=d.data}}const Hs=(0,ve.c)(),Ys=(0,Ae.c)();class Ke extends(Ci(Te)){constructor(r,n,o){super(r),this._cimMarkerLayer=r,this._minMaxZoom=(0,w.UJ)(Math.round(n*I.MI),Math.round(o*I.MI));const a=r.color;B(a)?this._dynamicPropertyMap.set("_fillColor",(y,x,g)=>(0,Z.t2)(a(y,x,g))):this._fillColor=(0,Z.t2)(a);const h=r.outlineColor;B(h)?this._dynamicPropertyMap.set("_outlineColor",(y,x,g)=>(0,Z.t2)(h(y,x,g))):this._outlineColor=(0,Z.t2)(h);const c=r.size;B(c)?this._dynamicPropertyMap.set("_size",(y,x,g)=>(0,P.F2)(c(y,x,g))):this._size=(0,P.F2)(c)||0;const u=r.scaleX;B(u)?this._dynamicPropertyMap.set("_scaleX",u):this._scaleX=u;const f=r.offsetX;B(f)?this._dynamicPropertyMap.set("xOffset",(y,x,g)=>(0,P.F2)(f(y,x,g))):this.xOffset=(0,P.F2)(f)||0;const d=r.offsetY;B(d)?this._dynamicPropertyMap.set("yOffset",(y,x,g)=>(0,P.F2)(d(y,x,g))):this.yOffset=(0,P.F2)(d)||0;const m=r.outlineWidth;B(m)?this._dynamicPropertyMap.set("_outlineWidth",(y,x,g)=>(0,P.F2)(m(y,x,g))):this._outlineWidth=(0,P.F2)(m)||0;const _=r.rotation;if(B(_)?this._dynamicPropertyMap.set("_angle",_):this._angle=_||0,(0,W.pC)(r.effects)){const p=r.effects;B(p)?this._dynamicPropertyMap.set("_effects",p):this._effects=p}if((0,W.pC)(r.markerPlacement)){const p=r.markerPlacement;B(p)?this._dynamicPropertyMap.set("_markerPlacement",p):this._markerPlacement=p}this._scaleFactor=(0,W.Pt)(r.scaleFactor,1),this._bitSet=(r.alignment===j.v2.MAP?1:0)|(r.colorLocked?1:0)<<1|(r.scaleSymbolsProportionally?1:0)<<3,this._materialKey=r.materialKey}static fromCIMMarker(r,n){const[o,a]=vt(r.scaleInfo,n);return new Ke(r,o,a)}bindFeature(r,n,o){const a=r.readLegacyFeature(),h=r.getObjectId();this._dynamicPropertyMap.forEach((Yt,jt)=>{this[jt]=Yt(a,n,o)});const c=this._cimMarkerLayer.materialHash,u="function"==typeof c?c(a,n,o,h):c,f=this._materialCache.get(u);if(!f||!st(f.spriteMosaicItem)||!f.spriteMosaicItem)return void H.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new E.Z("mapview-cim","Encountered an error when binding feature"));const d=f.spriteMosaicItem,m=this._cimMarkerLayer.sizeRatio,_=d.width/d.height*this._scaleX,p=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let y=this._size,x=y*_;const g=this.xOffset,S=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const v=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,P.F2)(this._cimMarkerLayer.frameHeight):1,T=this._outlineWidth*v,C=(0,P.F2)(this._cimMarkerLayer.referenceSize);let V=0,A=0;const R=this._cimMarkerLayer.anchorPoint;R&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(V=(0,P.F2)(R.x)/(this._size*_),A=(0,P.F2)(R.y)/this._size):(V=R.x,A=R.y)),this._anchorX=V,this._anchorY=A,this._sizeOutlineWidth=(0,w.Jz)(Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*T),255)),Math.round(Math.min(Math.sqrt(128*C),255))),this.angle=p;const N=Math.round(64*m);this._bitestAndDistRatio=(0,w.UJ)(this._bitSet,N);const X=d.rect.x+I.fL,pt=d.rect.y+I.fL,St=X+d.width,Tt=pt+d.height;this._texUpperLeft=(0,w.UJ)(X,pt),this._texUpperRight=(0,w.UJ)(St,pt),this._texBottomLeft=(0,w.UJ)(X,Tt),this._texBottomRight=(0,w.UJ)(St,Tt);const ut=D.mE.load(this._materialKey);ut.sdf=d.sdf,ut.pattern=!0,ut.textureBinding=d.textureBinding,this._materialKey=ut.data,x*=m,y*=m,x*=this._scaleFactor,y*=this._scaleFactor,x*=d.rect.width/d.width,y*=d.rect.height/d.height,this._computedWidth=x,this._computedHeight=y,this._applyTransformation(Ys,Hs),this.xOffset=g,this.yOffset=S}}function Ne(l){const r=new Array(l.length);for(let n=0;n<l.length;n++)r[n]=l.charCodeAt(n);return r}class Je extends(Ii(Te)){constructor(r,n,o){super(r),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,w.UJ)(Math.round(n*I.MI),Math.round(o*I.MI));const a=r.scaleFactor||1;this._cimTextLayer=r;const h=r.color;B(h)?this._dynamicPropertyMap.set("_color",(S,v,T)=>(0,Z.t2)(h(S,v,T))):this._color=(0,Z.t2)(h);const c=r.outlineColor;let u,d,_;if(B(c)?this._dynamicPropertyMap.set("_haloColor",(S,v,T)=>(0,Z.t2)(c(S,v,T))):this._haloColor=(0,Z.t2)(c),B(r.size)||(u=Math.min(Math.round((0,P.F2)(r.size*r.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(g,S,v)=>B(r.size)?Math.min(Math.round((0,P.F2)(r.size(g,S,v)*r.sizeRatio)),127):u),B(r.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(S,v,T)=>Math.min(Math.floor(5*(0,P.F2)(r.outlineSize(S,v,T)*r.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,P.F2)(r.outlineSize*r.sizeRatio)),127),B(r.offsetX)||(d=Math.round((0,P.F2)(r.offsetX*r.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(g,S,v)=>B(r.offsetX)?Math.round((0,P.F2)(r.offsetX(g,S,v)*r.sizeRatio)):d),B(r.offsetY)||(_=Math.round((0,P.F2)(r.offsetY*r.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(g,S,v)=>B(r.offsetY)?Math.round((0,P.F2)(r.offsetY(g,S,v)*r.sizeRatio)):_),B(r.angle)?this._dynamicPropertyMap.set("_angle",r.angle):this._angle=r.angle,B(r.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",r.horizontalAlignment):this._horizontalAlignment=r.horizontalAlignment,B(r.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",r.verticalAlignment):this._verticalAlignment=r.verticalAlignment,(0,W.pC)(r.effects)){const g=r.effects;B(g)?this._dynamicPropertyMap.set("_effects",g):this._effects=g}if((0,W.pC)(r.markerPlacement)){const g=r.markerPlacement;B(g)?this._dynamicPropertyMap.set("_markerPlacement",g):this._textPlacement=g}B(r.text)?this._dynamicPropertyMap.set("_text",r.text):this._text=r.text,this._scaleFactor=a;const y=Math.min(Math.round((0,P.F2)(r.referenceSize*r.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*y)),this._materialKey=r.materialKey;const x=D.qr.load(this._materialKey);x.sdf=!0,this._bitset=(r.alignment===j.v2.MAP?1:0)|(r.colorLocked?1:0)<<1,this._materialKey=x.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(r,n){const[o,a]=vt(r.scaleInfo,n);return new Je(r,o,a)}analyze(r,n,o,a){var h=()=>super.analyze,c=this;return(0,F.Z)(function*(){const u=n.readLegacyFeature(),f=function js(l,r,n,o){return"string"==typeof l.text?l.text:"function"==typeof l.text?l.text(r,n,o):""}(c._cimTextLayer,u,o,a),d=yield h().call(c,r,n,o,a,Ne(f));return d&&d.glyphMosaicItems&&c._textToGlyphs.set(f,d.glyphMosaicItems),d})()}bindFeature(r,n,o){const a=r.readLegacyFeature();if(this._dynamicPropertyMap.forEach((c,u)=>{this[u]=c(a,n,o)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/I.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,dt.kH)((0,W.Pt)(this._horizontalAlignment,"center")),this._yAlignD=(0,dt.b7)((0,W.Pt)(this._verticalAlignment,"baseline"));const h=this._textToGlyphs.get(this._text);this.bindTextInfo(h,!1)}}class _t extends(Zi(ee)){constructor(r,n,o,a,h,c,u,f,d,m,_,p,y,x,g,S){super(),this._effects=x;const v=D.dk.load(r);n&&(v.sdf=n.sdf,v.pattern=!0,v.textureBinding=n.textureBinding),this.fillColor=o,this.tl=a,this.br=h,this.aux21=(0,w.UJ)(c,u),this.aux22=(0,w.UJ)(f,d),this.aux3=(0,w.Jz)(m,_,p,0),this._bitset=y,this._minMaxZoom=(0,w.UJ)(Math.round(g*I.MI),Math.round(S*I.MI)),this._materialKey=v.data}static fromCIMFill(r,n,o){const a=r.color,h=a&&(0,Z.t2)(a)||0,c=r.materialKey,[u,f]=vt(r.scaleInfo,o),d=(r.colorLocked?I.Uh:0)|(r.applyRandomOffset?I.jk:0)|(r.sampleAlphaOnly?I.Iv:0);if(!n)return new _t(c,null,h,0,0,0,0,0,0,0,0,0,d,r.effects,u,f);const{rect:m,width:_,height:p}=n,y=r.scaleX||1,x=m.x+I.fL,g=m.y+I.fL,S=x+_,v=g+p,T=(0,P.F2)(r.height),C=y*T;let V=Math.round(T);V<=0&&(V=v-g);let A=Math.round(C);A<=0&&(A=S-x);const R=(0,P.F2)(r.offsetX||0),N=(0,P.F2)(-r.offsetY||0),X=(0,w.UJ)(x,g),pt=(0,w.UJ)(S,v);return new _t(c,n,h,X,pt,A,V,R,N,128,128,(0,Re.s5)(r.angle),d,r.effects,u,f)}static fromSimpleFill(r,n,o=!1){const{color:a}=r,h=a&&"esriSFSNull"!==r.style&&(0,Z.aH)(a)||0,c=o?I.Uh:0,u=r.materialKey;let f;if(n){const{rect:d,width:m,height:_,pixelRatio:p}=n,y=d.x+I.fL,x=d.y+I.fL,g=y+m,S=x+_,v=(0,w.UJ)(y,x),T=(0,w.UJ)(g,S);f=new _t(u,n,h,v,T,m/p,_/p,0,0,128,128,0,c,null,0,lt)}else f=new _t(u,null,h,0,0,0,0,0,0,0,0,0,c,null,0,lt);return f._maybeAddLineTemplate(r),f}static fromPictureFill(r,n,o=!1){const a=I.ru,{rect:h,width:c,height:u}=n,f=h.x+I.fL,d=h.y+I.fL,m=f+c,_=d+u,p=(0,w.UJ)(f,d),y=(0,w.UJ)(m,_),x=Math.round((0,P.F2)(r.width)),g=Math.round((0,P.F2)(r.height)),S=(0,P.F2)(r.xoffset),v=(0,P.F2)(-r.yoffset),V=new _t(r.materialKey,n,a,p,y,x,g,S,v,128*r.xscale,128*r.yscale,0,o?I.Uh:0,null,0,lt);return V._maybeAddLineTemplate(r),V}}class Qs{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var r=this;return(0,F.Z)(function*(){r._resolver?(yield r._resolver.promise,yield r.acquire()):r._resolver=(0,Y.hh)()})()}release(){const r=this._resolver;this._resolver=null,r?.resolve()}}function Xe(){return(Xe=(0,F.Z)(function*(l,r,n){try{yield l.acquire(),yield r(n),l.release()}catch(o){throw l.release(),o}})).apply(this,arguments)}const qs={marker:O.LW.MARKER,fill:O.LW.FILL,line:O.LW.LINE,text:O.LW.TEXT};class tr{constructor(r,n,o,a){const h={minScale:n?.minScale,maxScale:n?.maxScale},c=function er(l){return l.minScale||l.maxScale?l.minScale+"-"+l.maxScale:""}(h);this.layers=r,this.data=n,this.hash=this._createHash()+c,this.rendererKey=o;const u={isOutline:!1,placement:null,symbologyType:O.mD.DEFAULT,vvFlags:o};for(const f of r){const d=qs[f.type];u.isOutline="line"===f.type&&f.isOutline,f.materialKey=(0,D.jj)(d,u),f.maxVVSize=a,f.scaleInfo=h,f.templateHash+=c}}get type(){return"expanded-cim"}_createHash(){let r="";for(const n of this.layers)r+=n.templateHash;return r}}var Xi=L(83100),ir=L(21726),sr=L(84687),rr=L(29840),Pt=L(71937);function nr(l,r,n){return He.apply(this,arguments)}function He(){return(He=(0,F.Z)(function*(l,r,n){if(!l.name)throw new E.Z("style-symbol-reference-name-missing","Missing name in style symbol reference");if(l.styleName&&"Esri2DPointSymbolsStyle"===l.styleName)return or(l,n);try{return ar(yield(0,Pt.n2)(l,r,n),l.name,r,n)}catch(o){return(0,Y.k_)(o),null}})).apply(this,arguments)}function or(l,r){return Ye.apply(this,arguments)}function Ye(){return(Ye=(0,F.Z)(function*(l,r){const n=Pt.wm.replace(/\{SymbolName\}/gi,l.name);try{const o=yield(0,Pt.EJ)(n,r);return(0,Pt.KV)(o.data)}catch(o){return(0,Y.k_)(o),null}})).apply(this,arguments)}function ar(l,r,n,o){return je.apply(this,arguments)}function je(){return(je=(0,F.Z)(function*(l,r,n,o){const a=l.data,h={portal:n&&(0,W.pC)(n.portal)?n.portal:sr.Z.getDefault(),url:(0,ir.mN)(l.baseUrl),origin:"portal-item"},c=a.items.find(f=>f.name===r);if(!c)throw new E.Z("symbolstyleutils:symbol-name-not-found",`The symbol name '${r}' could not be found`,{symbolName:r});let u=(0,rr.f)((0,Pt.v9)(c,"cimRef"),h);(0,Xi.XO)()&&(u=(0,Xi.pJ)(u));try{const f=yield(0,Pt.EJ)(u,o);return(0,Pt.KV)(f.data)}catch(f){return(0,Y.k_)(f),null}})).apply(this,arguments)}const Hi=function(){var l=(0,F.Z)(function*(r,n,o){return new tr(yield(0,Gi.c)(r.data,n,o),r.data,r.rendererKey,r.maxVVSize)});return function(n,o,a){return l.apply(this,arguments)}}(),ct=function(){var l=(0,F.Z)(function*(r,n,o,a){if(!r)return null;if("cim"===r.type)return Hi(r,n,o);if("web-style"===r.type){const h={type:"cim",data:yield nr(r,null,a),rendererKey:r.rendererKey,maxVVSize:r.maxVVSize};return Hi(h,n,o)}return r});return function(n,o,a,h){return l.apply(this,arguments)}}();function Le(l){if(!l)return null;const{type:r,cim:n,url:o,materialHash:a}=l,h={cim:n,type:r,mosaicHash:a,url:o,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null};switch(r){case"marker":h.size=l.size,h.path=l.path,h.animatedSymbolProperties=l.animatedSymbolProperties;break;case"line":h.dashTemplate=l.dashTemplate;break;case"text":h.text=l.text,h.fontName=l.fontName}return h}const et=H.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Yi=new Array,Qe={isOutline:!1,placement:null,symbologyType:O.mD.DEFAULT,vvFlags:0},lr={...Nt.eG,hash:JSON.stringify(Nt.eG),materialKey:(0,D.jj)(O.LW.MARKER,Qe)},hr={...Nt.wW,hash:JSON.stringify(Nt.wW),materialKey:(0,D.jj)(O.LW.LINE,Qe)},cr={...Nt.lj,hash:JSON.stringify(Nt.lj),materialKey:(0,D.jj)(O.LW.FILL,Qe)};function yt(l,r){const n=l.length;return l.push(null),r.then(o=>l[n]=o),l}function ae(l){return!!(1&l)}class fr{constructor(r,n){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Qs,this._fetchResource=r,this._tileInfo=n}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(r,n){this._initErrorTemplates();const o=r.hash;if(this._symbolToTemplate.has(o))return this._symbolToTemplate.get(o);const a=new Array;n&&this._createMeshTemplates(a,n,!0),this._createMeshTemplates(a,r,!1);const h=this._createGroupId("expanded-cim"===r.type&&dr(r));return this._idToTemplateGroup.set(h,a),this._symbolToTemplate.set(o,h),h}getTemplateGroup(r){return this._idToTemplateGroup.has(r)?this._idToTemplateGroup.get(r):Yi}getDynamicTemplateGroup(r){return this._idToTemplateGroup.has(r)?(ae(r)||et.error("mapview-template-store",`Id ${r} does not refer to a dynamic template`),this._idToTemplateGroup.get(r)):Yi}getMosaicItem(r,n){const o=this._createTemplateId(),a=new Promise(h=>this._idToResolver.set(o,h));return this._fetchQueue.push({symbol:r,id:o,glyphIds:n}),a}finalize(r){return this._fetchQueue.length||this._lock.isHeld()?function $s(l,r,n){return Xe.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),r):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],cr,!1),marker:this._createMeshTemplates([],lr,!1),line:this._createMeshTemplates([],hr,!1)})}_fetchAllQueuedResources(r){if(!this._fetchQueue.length)return Promise.resolve();const n=this._fetchQueue,o=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(o).then(()=>this._fetchResource(n,r).then(a=>{for(const{id:h,mosaicItem:c}of a)this._idToResolver.get(h)(c),this._idToResolver.delete(h)})).catch(a=>{(0,Y.D_)(a)?this._fetchQueue=this._fetchQueue.concat(n):function ur(l){return"worker:port-closed"===l.name}(a)||et.error(new E.Z("mapview-template-store","Unable to fetch requested texture resources",a))})}_createGroupId(r){return this._idCounter++<<1|(r?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(r);return st(o,et)?ht.fromSimpleMarker(r,o):n._markerError})()}_createPMS(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(r);return st(o,et)?ht.fromPictureMarker(r,o):n._markerError})()}_createSFS(r,n){var o=this;return(0,F.Z)(function*(){const{spriteMosaicItem:a}=yield o.getMosaicItem(r);return st(a,et)?_t.fromSimpleFill(r,a,n):o._fillError})()}_createPFS(r,n){var o=this;return(0,F.Z)(function*(){const{spriteMosaicItem:a}=yield o.getMosaicItem(r);return st(a,et)?_t.fromPictureFill(r,a,n):o._fillError})()}_createSLS(r,n){var o=this;return(0,F.Z)(function*(){const{spriteMosaicItem:a}=yield o.getMosaicItem(r);return st(a,et)?mt.fromSimpleLine(r,a):o._lineError})()}_createLMS(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(r);return st(o,et)?ht.fromLineSymbolMarker(r,o):n._markerError})()}_createTS(r){var n=this;return(0,F.Z)(function*(){const{glyphMosaicItems:o}=yield n.getMosaicItem(r);return Zt.fromText(r,o)})()}_createCIMText(r){var n=this;return(0,F.Z)(function*(){const{glyphMosaicItems:o}=yield n.getMosaicItem(Le(r),Ne(r.text));return st(o,et)?Zt.fromCIMText(r,o,n._tileInfo):n._textError})()}_createCIMFill(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(Le(r));return st(o,et)?_t.fromCIMFill(r,o,n._tileInfo):n._fillError})()}_createCIMLine(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(Le(r));return st(o,et)?mt.fromCIMLine(r,o,n._tileInfo):n._lineError})()}_createCIMMarker(r){var n=this;return(0,F.Z)(function*(){const{spriteMosaicItem:o}=yield n.getMosaicItem(Le(r));return st(o,et)?ht.fromCIMMarker(r,o,n._tileInfo):n._markerError})()}_createCIM(r){var n=this;return(0,F.Z)(function*(){const o=r.templateHash;if(n._cimTemplateCache.has(o))return n._cimTemplateCache.get(o);let a;switch(r.type){case"marker":a=yield n._createCIMMarker(r);break;case"line":a=yield n._createCIMLine(r);break;case"fill":a=yield n._createCIMFill(r);break;case"text":a=yield n._createCIMText(r)}return n._cimTemplateCache.set(o,a),a})()}_createDynamicCIM(r){var n=this;return(0,F.Z)(function*(){const o=r.templateHash;if(n._cimTemplateCache.has(o))return n._cimTemplateCache.get(o);let a;switch(r.type){case"marker":a=Ke.fromCIMMarker(r,n._tileInfo);break;case"line":a=Ge.fromCIMLine(r,n._tileInfo);break;case"fill":a=Ze.fromCIMFill(r,n._tileInfo);break;case"text":a=Je.fromCIMText(r,n._tileInfo)}return n._cimTemplateCache.set(o,a),a})()}_createPrimitiveMeshTemplates(r,n,o){switch(n.type){case"esriSMS":return yt(r,this._createSMS(n));case"esriPMS":return yt(r,this._createPMS(n));case"esriSFS":return yt(r,this._createSFS(n,o));case"line-marker":return yt(r,this._createLMS(n));case"esriPFS":return yt(r,this._createPFS(n,o));case"esriSLS":return yt(r,this._createSLS(n,!1));case"esriTS":return yt(r,this._createTS(n));default:return et.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),r}}_createMeshTemplates(r,n,o){if(n.type.includes("3d"))return et.error("3D symbols are not supported with MapView"),r;if("expanded-cim"===n.type){for(const a of n.layers)yt(r,"function"==typeof a.materialHash?this._createDynamicCIM(a):this._createCIM(a));return r}if("composite-symbol"===n.type){for(const a of n.layers)this._createPrimitiveMeshTemplates(r,a,o);return r}return"cim"===n.type||"label"===n.type||"web-style"===n.type?r:this._createPrimitiveMeshTemplates(r,n,o)}}const dr=l=>{if(!l.layers)return!1;for(const r of l.layers)if("function"==typeof r.materialHash)return!0;return!1};class mr{constructor(r,n,o){this._loadPromise=(0,xi.j)(),this._geometryType=r,this._idField=n,this._templateStore=o}update(r,n){(0,W.pC)(r.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(r.mesh.labels,n)),this._schema=r}_createLabelTemplates(r,n){const o=new Map;if("simple"===r.type){for(const a of r.classes){const h=ge.fromLabelClass(a,n);o.set(a.index,h)}return o}for(const a in r.classes){const h=r.classes[a];for(const c of h){const u=ge.fromLabelClass(c,n);o.set(c.index,u)}}return o}get templates(){return this._templateStore}analyze(r,n,o,a,h,c,u){var f=this;return(0,F.Z)(function*(){if((0,Y.Hc)(u))return;let d;"dictionary"===o.type&&(d=yield o.analyze(f._idField,r.copy(),n,h,c,u));let m=0;for(;r.next();){let _;if(_=d?d[m++]:(0,W.pC)(a)&&(0,Et.nE)(r.getDisplayId())&&1!==r.readAttribute("cluster_count")?a.match(f._idField,r,f._geometryType,h,c):o.match(f._idField,r,f._geometryType,h,c),r.setGroupId(_),ae(_)){const p=f._templateStore.getDynamicTemplateGroup(_);for(const y of p)y&&y.analyze&&y.analyze(f._templateStore,r,h,c)}}return yield f._loadPromise,f._templateStore.finalize(u)})()}analyzeGraphics(r,n,o,a,h,c){var u=this;return(0,F.Z)(function*(){if((0,Y.Hc)(c))return;const f=r.getCursor();for(o&&(yield o.analyze(u._idField,f.copy(),n,a,h,c));f.next();){let d=f.getGroupId();if(null!=d&&-1!==d||(d=o.match(u._idField,f,f.geometryType,a,h),f.setGroupId(d)),ae(d)){const m=u._templateStore.getDynamicTemplateGroup(d);for(const _ of m)_&&_.analyze&&_.analyze(u._templateStore,f,a,h)}f.setGroupId(d)}return yield u._loadPromise,u._templateStore.finalize(c)})()}writeGraphic(r,n,o,a){const h=n.getGroupId(),c=n.getDisplayId(),u=this._templateStore.getTemplateGroup(h);if(r.featureStart(n.insertAfter,0),null!=c){if(ae(h))for(const f of u)f&&f.bindFeature(n,null,null);if(u){for(const f of u)f&&f.write(r,n,o,a);r.featureEnd()}}}writeCursor(r,n,o,a,h,c,u){const f=n.getGroupId(),d=n.getDisplayId(),m=this._templateStore.getTemplateGroup(f),_=this._schema.mesh.sortKey;let p=0;if((0,W.pC)(_)&&(p=null!=_.fieldIndex?n.getComputedNumericAtIndex(_.fieldIndex):n.readAttribute(null!=_.field?_.field:this._idField),p*="asc"===_.order?1:-1),r.featureStart(0,null==p||isNaN(p)?0:p),null!=d&&m){if(ae(f))for(const y of m)y.bindFeature(n,o,a);for(const y of m)y.write(r,n,h,u);if((0,W.pC)(c)&&r.hasRecords){const y=c&&this._findLabelRef(m);this._writeLabels(r,n,c,y,h,u)}r.featureEnd()}}_findLabelRef(r){for(const n of r)if(n instanceof ht)return n;return null}_writeLabels(r,n,o,a,h,c){for(const u of o)if((0,W.pC)(u)&&u){const{glyphs:f,rtl:d,index:m}=u,_=this._labelTemplates.get(m);_.setZoomLevel(h),_.bindReferenceTemplate(a),_.bindTextInfo(f,d),_.write(r,n,null,c)}}}var _r=L(93961),yr=L(46679),pr=L(39236);const $e=H.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function qe(l,r,n,o){return ti.apply(this,arguments)}function ti(){return(ti=(0,F.Z)(function*(l,r,n,o){switch(l.type){case"simple":case"heatmap":return Mt.fromBasicRenderer(l,r,n,o);case"map":return ii.fromUVRenderer(l,r,n,o);case"interval":return ei.fromCBRenderer(l,r,n,o);case"dictionary":return oi.fromDictionaryRenderer(l,r,n,o);case"pie-chart":return be.fromPieChartRenderer(l,r,n,o);case"subtype":return be.fromSubtypes(l,r,n,o)}})).apply(this,arguments)}class Mt{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(r,n,o,a){return(0,F.Z)(function*(){const h=new Mt;if(r.symbol){const c=yield ct(r.symbol,o,a),u=n.createTemplateGroup(c,null);h.setDefault(u)}return h})()}static fromPieChartRenderer(r,n,o,a){return(0,F.Z)(function*(){const h=new Mt;if(r.markerSymbol){const c=yield ct(r.markerSymbol,o,a);let u;r.fillSymbol&&(u=yield ct(r.fillSymbol,o,a));const f=n.createTemplateGroup(c,u);h.setDefault(f)}return h})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(r){this._defaultResult=r}match(r,n,o,a,h){return this.getDefault()}analyze(r,n,o,a,h,c){return(0,F.Z)(function*(){return null})()}}class be extends Mt{constructor(r,n){super(),this._subMatchers=r,this._subtypeField=n}static fromSubtypes(r,n,o,a){return(0,F.Z)(function*(){const h=new Map,c=[];for(const u in r.renderers){const f=parseInt(u,10),d=qe(r.renderers[u],n,o,a).then(m=>h.set(f,m));c.push(d)}return yield Promise.all(c),new be(h,r.subtypeField)})()}match(r,n,o,a,h){const c=n.readAttribute(this._subtypeField),u=this._subMatchers.get(c);return u?u.match(r,n,o,a,h):null}}class ei extends Mt{constructor(r,n,o,a){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=n,this._fieldIndex=a,this._field=r,this._normalizationInfo=o}static fromCBRenderer(r,n,o,a){return(0,F.Z)(function*(){const{isMaxInclusive:h,normalizationField:c,normalizationTotal:u,normalizationType:f}=r,m=new ei(r.field,h,{normalizationField:c,normalizationTotal:u,normalizationType:f},r.fieldIndex),_=yield ct(r.backgroundFillSymbol,o,a);yield Promise.all(r.intervals.map(function(){var y=(0,F.Z)(function*(x){const g=yield ct(x.symbol,o,a),S=yield n.createTemplateGroup(g,_);m.add({min:x.min,max:x.max},S)});return function(x){return y.apply(this,arguments)}}()));const p=yield ct(r.defaultSymbol,o,a);if(p){const y=yield n.createTemplateGroup(p,_);m.setDefault(y)}return m})()}add(r,n){this._intervals.push({interval:r,result:n}),this._intervals.sort((o,a)=>o.interval.min-a.interval.min)}size(){return super.size()+this._intervals.length}match(r,n,o,a,h){if(null==this._fieldIndex&&!this._field)return this.getDefault();const c=null!=this._fieldIndex?n.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(n);if(null==c||isNaN(c)||c===1/0||c===-1/0)return this.getDefault();for(let u=0;u<this._intervals.length;u++){const{interval:f,result:d}=this._intervals[u],_=this._isMaxInclusive?c<=f.max:c<f.max;if(c>=f.min&&_)return d}return this.getDefault()}_needsNormalization(){const r=this._normalizationInfo;return r&&(r.normalizationField||r.normalizationTotal||r.normalizationType)}_getValueFromField(r){const n=r.readAttribute(this._field);if(!this._needsNormalization()||null==n)return n;const{normalizationField:o,normalizationTotal:a,normalizationType:h}=this._normalizationInfo,c=!!o&&r.readAttribute(o);if(h)switch(h){case"esriNormalizeByField":return c?n/c:void 0;case"esriNormalizeByLog":return Math.log(n)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return n/a*100;default:return void $e.error(`Found unknown normalization type: ${h}`)}else $e.error("Normalization is required, but no type was set!")}}class ii extends Mt{constructor(r,n,o){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=o,this._fields=r,this._seperator=n||""}static fromUVRenderer(r,n,o,a){return(0,F.Z)(function*(){const h=r.fieldDelimiter,c=[r.field];r.field2&&c.push(r.field2),r.field3&&c.push(r.field3);const u=yield ct(r.backgroundFillSymbol,o,a),f=new ii(c,h,r.fieldIndex);yield Promise.all(r.map.map(function(){var m=(0,F.Z)(function*(_){const p=yield ct(_.symbol,o,a),y=yield n.createTemplateGroup(p,u);"<Null>"===_.value?f.setNullResult(y):f.add(_.value,y)});return function(_){return m.apply(this,arguments)}}()));const d=yield ct(r.defaultSymbol,o,a);if(d){const m=yield n.createTemplateGroup(d,u);f.setDefault(m)}return f})()}setNullResult(r){this._nullResult=r}add(r,n){this._resultsMap.set(r.toString(),n)}size(){return super.size()+this._resultsMap.size}match(r,n,o,a,h){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const c=null!=this._fieldsIndex?n.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(n);if(null!==this._nullResult&&(null==c||""===c||"<Null>"===c))return this._nullResult;if(null==c)return this.getDefault();const u=c.toString();return this._resultsMap.has(u)?this._resultsMap.get(u):this.getDefault()}_getValueFromFields(r){const n=[];for(const o of this._fields){const a=r.readAttribute(o);n.push(null==a||""===a?"<Null>":a)}return n.join(this._seperator)}}function si(){return(si=(0,F.Z)(function*(l,r){const n=l||1;if("number"==typeof n)return(a,h,c)=>n;const o=yield(0,yr.Yi)(n,r.spatialReference,r.fields);return(a,h,c)=>(0,pr.Z)(o,a,{$view:c},r.geometryType,h)||1})).apply(this,arguments)}let ri;function gr(){return ni.apply(this,arguments)}function ni(){return(ni=(0,F.Z)(function*(){return ri||(ri=L.e(3250).then(L.bind(L,3250))),ri})).apply(this,arguments)}class oi extends Mt{constructor(r,n,o,a,h,c){super(),this.type="dictionary",this._groupIdCache=new _r.Z(100),this._loader=r,this._fieldMap=r.fieldMap,this._symbolFields=r.getSymbolFields(),this._templates=n,this._info=o,this._scaleFn=a,this._schemaUtilsModule=h,this._symbolOptions=c}static fromDictionaryRenderer(r,n,o,a){return(0,F.Z)(function*(){const[{DictionaryLoader:h},c]=yield Promise.all([Promise.resolve().then(L.bind(L,29996)),gr()]),u=new h(r.url,r.config,r.fieldMap);yield u.fetchResources({spatialReference:o.spatialReference,fields:o.fields});const f=yield function xr(l,r){return si.apply(this,arguments)}(r.scaleExpression,o);return new oi(u,n,o,f,c,r.symbolOptions)})()}_analyzeFeature(r,n,o,a,h){var c=this;return(0,F.Z)(function*(){const u=r.readLegacyFeature(),f=c._scaleFn(u,o,a),d=c._attributeHash(u)+"-"+f,m=c._groupIdCache.get(d);if(m)return m;const _={...a,spatialReference:c._info.spatialReference,abortOptions:h,fields:c._info.fields},p=yield c._loader.getSymbolAsync(u,_),y=c._schemaUtilsModule.createSymbolSchema(p,c._symbolOptions),x=ct(y,c._info,n,h).then(g=>{if("expanded-cim"!==g.type)return $e.error(new E.Z("mapview-bad-type",`Found unexpected type ${g.type} in dictionary response`)),null;g.hash+="-"+f;for(const S of g.layers)S.scaleFactor=f,S.templateHash+="-"+f;return c._templates.createTemplateGroup(g,null)});return c._groupIdCache.put(d,x,1),x})()}analyze(r,n,o,a,h,c){var u=this;return(0,F.Z)(function*(){const f=n.getCursor(),d=[];for(;f.next();)d.push(u._analyzeFeature(f,o,a,h,c));return Promise.all(d)})()}match(r,n,o,a,h){return null}_attributeHash(r){let n="";for(const o of this._symbolFields){const a=this._fieldMap[o];a&&(n+=r.attributes[a]+"-")}return n}}var vr=L(13112);class Mr{constructor(r){this._remoteClient=r,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null}destroy(){}fetchResource(r,n){var o=this;return(0,F.Z)(function*(){const a=o._resourceMap,h=a.get(r);if(h)return h;let c=o._inFlightResourceMap.get(r);if(c)return c;try{c=o._remoteClient.invoke("tileRenderer.fetchResource",{url:r},{...n}),o._inFlightResourceMap.set(r,c),c.then(u=>(o._inFlightResourceMap.delete(r),a.set(r,u),u))}catch(u){return(0,Y.D_)(u)?null:{width:0,height:0}}return c})()}getResource(r){return this._resourceMap.get(r)??null}}function ji(l,r){return(!l.minScale||l.minScale>=r)&&(!l.maxScale||l.maxScale<=r)}function Qi(l){const r=l.message,n={message:{data:{},tileKey:r.tileKey,tileKeyOrigin:r.tileKeyOrigin,version:r.version},transferList:new Array};for(const o in r.data){const a=r.data[o];if(n.message.data[o]=null,(0,W.pC)(a)){const h=a.stride,c=a.indices.slice(0),u=a.vertices.slice(0),f=a.records.slice(0),d={stride:h,indices:c,vertices:u,records:f,metrics:(0,W.yw)(a.metrics,m=>m.slice(0))};n.transferList.push(c,u,f),n.message.data[o]=d}}return n}let ai=class extends vr.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new Mr(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(l){this._bufferIds.forEach(r=>{r.forEach(l)})}update(l,r){var n=this;return(0,F.Z)(function*(){const o=r.schema.processors[0];if("symbol"!==o.type)return;const a=(0,Ct.Hg)(n._schema,o);((0,Ct.uD)(a,"mesh")||(0,Ct.uD)(a,"target"))&&(l.mesh=!0,l.why.mesh.push("Symbology changed"),n._schema=o,n._factory=n._createFactory(o),n._factory.update(o,n.tileStore.tileScheme.tileInfo))})()}onTileMessage(l,r,n,o){return(0,Y.k_)(o),this._onTileData(l,r,n,o)}onTileClear(l){return this._bufferData.delete(l.key.id),this._bufferIds.delete(l.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{clear:!0}})}onTileError(l,r,n){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:l.id,error:r},{signal:n.signal})}onTileUpdate(l){for(const r of l.removed)this._bufferData.has(r.key.id)&&this._bufferData.delete(r.key.id),this._bufferIds.has(r.key.id)&&this._bufferIds.delete(r.key.id);for(const r of l.added)this._bufferData.forEach(n=>{for(const o of n)o.message.tileKey===r.id&&this._updateTileMesh("append",r,Qi(o),[],!1,!1,null)})}_addBufferData(l,r){this._bufferData.has(l)||this._bufferData.set(l,[]),this._bufferData.get(l).push(Qi(r))}_createFactory(l){const{geometryType:r,objectIdField:n,fields:o}=this.service,h={geometryType:r,fields:o,spatialReference:le.Z.fromJSON(this.spatialReference)},c=new fr((d,m)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",d,m),this.tileStore.tileScheme.tileInfo),{matcher:u,aggregateMatcher:f}=l.mesh;return this._store=c,this._matchers.feature=qe(u,c,h,this._resourceManagerProxy),this._matchers.aggregate=(0,W.yw)(f,d=>qe(d,c,h,this._resourceManagerProxy)),new mr(r,n,c)}_onTileData(l,r,n,o){var a=this;return(0,F.Z)(function*(){(0,Y.k_)(o);const{type:h,addOrUpdate:c,remove:u,clear:f,end:d}=r,m=!!a._schema.mesh.sortKey;if(!c)return a.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{type:h,addOrUpdate:null,remove:u,clear:f,end:d,sort:m}},o);const _=a._processFeatures(l,c,n,o,r.status.version);try{const p=yield _;if((0,W.Wi)(p))return a.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{type:h,addOrUpdate:null,remove:u,clear:f,end:d,sort:m}},o);const y=[];for(const x of p){let g=!1;const S=x.message.bufferIds,v=l.key.id,T=x.message.tileKey;if(v!==T&&(0,W.pC)(S)){if(!a.tileStore.get(T)){a._addBufferData(v,x),y.push(x);continue}let C=a._bufferIds.get(T);C||(C=new Set,a._bufferIds.set(T,C));const V=Array.from(S);for(const A of V){if(C.has(A)){g=!0;break}C.add(A)}}g||(a._addBufferData(v,x),y.push(x))}yield Promise.all(y.map(x=>{const g=l.key.id===x.message.tileKey;return a._updateTileMesh(h,l,x,g?r.remove:[],g&&r.end,r.clear,o.signal)}))}catch(p){a._handleError(l,p,o)}})()}_updateTileMesh(l,r,n,o,a,h,c){var u=this;return(0,F.Z)(function*(){const f=l,d=n.message.tileKey,m=!!u._schema.mesh.sortKey;d!==r.key.id&&(a=!1);const _=(0,W.yw)(n,g=>g.message),p=(0,W.yw)(n,g=>g.transferList)||[],y={type:f,addOrUpdate:_,remove:o,clear:h,end:a,sort:m},x={transferList:(0,W.Wg)(p)||[],signal:c};return(0,Y.k_)(x),u.remoteClient.invoke("tileRenderer.onTileData",{tileKey:d,data:y},x)})()}_processFeatures(l,r,n,o,a){var h=this;return(0,F.Z)(function*(){if((0,W.Wi)(r)||!r.hasFeatures)return null;const c={transform:l.transform,hasZ:!1,hasM:!1},u=h._factory,f={viewingMode:"",scale:l.scale},d=yield h._matchers.feature,m=yield h._matchers.aggregate;(0,Y.k_)(o);const _=h._getLabelInfos(l,r);return yield u.analyze(r.getCursor(),h._resourceManagerProxy,d,m,c,f),(0,Y.k_)(o),h._writeFeatureSet(l,r,c,_,u,n,a)})()}_writeFeatureSet(l,r,n,o,a,h,c){const u=r.getSize(),f=this._schema.mesh.matcher.symbologyType,d=new es(l.key.id,{features:u,records:u,metrics:0},f,h,f!==O.mD.HEATMAP,c),m={viewingMode:"",scale:l.scale},_=r.getCursor();for(;_.next();)try{const y=_.getDisplayId(),x=(0,W.pC)(o)?o.get(y):null;a.writeCursor(d,_,n,m,l.level,x,this._resourceManagerProxy)}catch{}return d.serialize(l.tileInfoView.tileInfo.isWrappable)}_handleError(l,r,n){if(!(0,Y.D_)(r))return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:l.id,error:r.message},{signal:n.signal})}_getLabelingSchemaForScale(l){const r=this._schema.mesh.labels;if((0,W.Wi)(r))return null;if("subtype"===r.type){const o={type:"subtype",classes:{}};let a=!1;for(const h in r.classes){const c=r.classes[h].filter(u=>ji(u,l.scale));a=a||!!c.length,o.classes[h]=c}return a?o:null}const n=r.classes.filter(o=>ji(o,l.scale));return n.length?{type:"simple",classes:n}:null}_getLabels(l,r){if("subtype"===r.type){const o=(0,W.s3)(this.service.subtypeField,"Expected to find subtype Field"),a=l.readAttribute(o);return null==a?[]:r.classes[a]??[]}return r.classes}_getLabelInfos(l,r){const n=this._getLabelingSchemaForScale(l);if((0,W.Wi)(n))return null;const o=new Map,a=r.getCursor();for(;a.next();){const h=a.getDisplayId(),c=[],u=(0,Et.nE)(h),f=u&&1!==a.readAttribute("cluster_count")?"aggregate":"feature",d=this._getLabels(a,n);for(const m of d){if(m.target!==f)continue;const p=a.getStorage().getComputedStringAtIndex(u&&"feature"===f?a.readAttribute("referenceId"):h,m.fieldIndex);if(!p)continue;const y=(0,z.E)(p.toString()),g=y[1];this._store.getMosaicItem(m.symbol,Ne(y[0])).then(S=>{c[m.index]={glyphs:S.glyphMosaicItems,rtl:g,index:m.index}})}o.set(h,c)}return o}};ai=(0,J._)([(0,Wt.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],ai);const Sr=ai}}]);