"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[4516],{87757:(L,E,u)=>{u.d(E,{g:()=>c});const c={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},14516:(L,E,u)=>{u.r(E),u.d(E,{default:()=>Oe});var k,r,c=u(15861),m=u(17626),j=(u(29132),u(88879)),g=u(84792),I=u(97478),_=u(26584),v=u(8314),C=u(2076),P=u(47996),y=u(62208),b=u(94113),N=u(10699),T=u(21726),F=u(77712),w=(u(85931),u(90912),u(76898)),Y=u(2004),xt=u(91179);(r=k||(k={}))[r.PROJECT_VERTICES=1]="PROJECT_VERTICES";var At=u(56554),St=u(15283),Pt=u(2865),D=u(2618),qt=u(33696),It=u(82054);function Mt(r,t){return t}function tt(r,t,e,s){switch(e){case 0:return U(r,t+s,0);case 1:return"lowerLeft"===r.originPosition?U(r,t+s,1):function Gt({translate:r,scale:t},e,s){return r[s]-e*t[s]}(r,t+s,1)}}function vt(r,t,e,s){return 2===e?U(r,t,2):tt(r,t,e,s)}function Nt(r,t,e,s){return 2===e?U(r,t,3):tt(r,t,e,s)}function Jt(r,t,e,s){return 3===e?U(r,t,3):vt(r,t,e,s)}function U({translate:r,scale:t},e,s){return r[s]+e*t[s]}class Qt{constructor(t){this._options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=Mt,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(t){if(this._options.applyTransform&&(t.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!t.hasZ)return;const e=(0,qt.k)(t.geometryType,this._options.sourceSpatialReference,t.spatialReference);if(!(0,y.Wi)(e))for(const s of t.features)e(s.geometry)}createSpatialReference(){return{}}addField(t,e){const s=t.fields;(0,y.O3)(s),s.push(e);const n=s.map(i=>i.name);this._attributesConstructor=function(){for(const i of n)this[i]=null}}addFeature(t,e){t.features.push(e)}prepareFeatures(t){switch(this._transform=t.transform,this._options.applyTransform&&t.transform&&(this._applyTransform=this._deriveApplyTransform(t)),this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++,t.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,s,n)=>this.addCoordinatePoint(e,s,n),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,s,n)=>this._addCoordinatePolygon(e,s,n),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,s,n)=>this._addCoordinatePolyline(e,s,n),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,s,n)=>this._addCoordinateMultipoint(e,s,n),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(t,e,s){0===this._lengths.length&&(this._toAddInCurrentPath=e),this._lengths.push(e)}addQueryGeometry(t,e){const{queryGeometry:s,queryGeometryType:n}=e,i=(0,It.$g)(s.clone(),s,!1,!1,this._transform),l=(0,It.di)(i,n,!1,!1);t.queryGeometryType=n,t.queryGeometry={...l}}createPointGeometry(t){const e={x:0,y:0,spatialReference:t.spatialReference};return t.hasZ&&(e.z=0),t.hasM&&(e.m=0),e}addCoordinatePoint(t,e,s){const n=(0,y.s3)(this._transform,"transform");switch(e=this._applyTransform(n,e,s,0),s){case 0:t.x=e;break;case 1:t.y=e;break;case 2:"z"in t?t.z=e:t.m=e;break;case 3:t.m=e}}_transformPathLikeValue(t,e){let s=0;e<=1&&(s=this._previousCoordinate[e],this._previousCoordinate[e]+=t);const n=(0,y.s3)(this._transform,"transform");return this._applyTransform(n,t,e,s)}_addCoordinatePolyline(t,e,s){this._dehydratedAddPointsCoordinate(t.paths,e,s)}_addCoordinatePolygon(t,e,s){this._dehydratedAddPointsCoordinate(t.rings,e,s)}_addCoordinateMultipoint(t,e,s){0===s&&t.points.push([]);const n=this._transformPathLikeValue(e,s);t.points[t.points.length-1].push(n)}_createPolygonGeometry(t){return{rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,e,s){0===s&&0==this._toAddInCurrentPath--&&(t.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const n=this._transformPathLikeValue(e,s),i=t[t.length-1];0===s&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),i.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=n}_deriveApplyTransform(t){const{hasZ:e,hasM:s}=t;return e&&s?Jt:e?vt:s?Nt:tt}}var bt=u(20477),et=u(17253),rt=u(96854);function nt(){return nt=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r),n={...e},i=rt.Z.from(t),l=!i.quantizationParameters,{data:d}=yield(0,bt.executeQueryPBF)(s,i,new Qt({sourceSpatialReference:i.sourceSpatialReference,applyTransform:l}),n);return d}),nt.apply(this,arguments)}var Ut=u(24263),ot=u(76391),Bt=u(87183);function Lt(r){const t=r.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function Ct(r,t){const e={};for(const s of r){const{parentObjectId:n,parentGlobalId:i,attachmentInfos:l}=s;for(const d of l){const{id:p}=d,h=(0,T.qg)((0,Ut.Dp)(`${t}/${n}/attachments/${p}`)),f=Bt.Z.fromJSON(d);f.set({url:h,parentObjectId:n,parentGlobalId:i}),e[n]?e[n].push(f):e[n]=[f]}}return e}function zt(r,t,e){let s={query:(0,ot.A)({...r.query,f:"json",...Lt(t)})};return e&&(s={...e,...s,query:{...e.query,...s.query}}),(0,g.default)(r.path+"/queryAttachments",s)}var Vt=u(67736);function at(){return at=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r);return zt(s,Vt.Z.from(t),{...e}).then(n=>Ct(n.data.attachmentGroups,s.path))}),at.apply(this,arguments)}var Wt=u(90463);function it(){return it=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r);return(0,bt.executeQueryForExtent)(s,rt.Z.from(t),{...e}).then(n=>({count:n.data.count,extent:Y.Z.fromJSON(n.data.extent)}))}),it.apply(this,arguments)}var Ht=u(24865);function Xt(r,t){const e=r.toJSON();return e.objectIds&&(e.objectIds=e.objectIds.join(",")),e.orderByFields&&(e.orderByFields=e.orderByFields.join(",")),e.outFields&&!t?.returnCountOnly?e.outFields=e.outFields.includes("*")?"*":e.outFields.join(","):delete e.outFields,e.outSpatialReference&&(e.outSR=e.outSR.wkid||JSON.stringify(e.outSR.toJSON()),delete e.outSpatialReference),e.dynamicDataSource&&(e.layer=JSON.stringify({source:e.dynamicDataSource}),delete e.dynamicDataSource),e}function wt(r,t,e){return ut.apply(this,arguments)}function ut(){return ut=(0,c.Z)(function*(r,t,e){const s=yield Tt(r,t,e),n=s.data,i=n.geometryType,l=n.spatialReference,d={};for(const p of n.relatedRecordGroups){const h={fields:void 0,objectIdFieldName:void 0,geometryType:i,spatialReference:l,hasZ:!!n.hasZ,hasM:!!n.hasM,features:p.relatedRecords};if(null!=p.objectId)d[p.objectId]=h;else for(const f in p)p.hasOwnProperty(f)&&"relatedRecords"!==f&&(d[p[f]]=h)}return{...s,data:d}}),ut.apply(this,arguments)}function Yt(r,t,e){return lt.apply(this,arguments)}function lt(){return lt=(0,c.Z)(function*(r,t,e){const s=yield Tt(r,t,e,{returnCountOnly:!0}),n=s.data,i={};for(const l of n.relatedRecordGroups)null!=l.objectId&&(i[l.objectId]=l.count);return{...s,data:i}}),lt.apply(this,arguments)}function Tt(r,t){return dt.apply(this,arguments)}function dt(){return dt=(0,c.Z)(function*(r,t,e={},s){const n=(0,ot.A)({...r.query,f:"json",...s,...Xt(t,s)});return(0,g.default)(r.path+"/queryRelatedRecords",{...e,query:{...e.query,...n}})}),dt.apply(this,arguments)}var z=u(67010);function ct(){return ct=(0,c.Z)(function*(r,t,e){return t=z.Z.from(t),wt((0,D.en)(r),t,e).then(n=>{const i=n.data,l={};return Object.keys(i).forEach(d=>l[d]=et.default.fromJSON(i[d])),l})}),ct.apply(this,arguments)}function pt(){return pt=(0,c.Z)(function*(r,t,e){return t=z.Z.from(t),Yt((0,D.en)(r),t,{...e}).then(n=>n.data)}),pt.apply(this,arguments)}var ee=u(93555),re=u(61515);const jt="Layer does not support extent calculation.";function se(r,t){const e=r.geometry,s=r.toJSON(),n=s;if((0,y.pC)(e)&&(n.geometry=JSON.stringify(e),n.geometryType=(0,xt.Ji)(e),n.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference)),s.topFilter?.groupByFields&&(n.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),s.topFilter?.orderByFields&&(n.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(n.topFilter=JSON.stringify(n.topFilter)),s.objectIds&&(n.objectIds=s.objectIds.join(",")),s.orderByFields&&(n.orderByFields=s.orderByFields.join(",")),s.outFields&&!(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?n.outFields=s.outFields.includes("*")?"*":s.outFields.join(","):delete n.outFields,s.outSR?n.outSR=s.outSR.wkid||JSON.stringify(s.outSR):e&&s.returnGeometry&&(n.outSR=n.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){const i=s.timeExtent,{start:l,end:d}=i;null==l&&null==d||(n.time=l===d?l:`${l??"null"},${d??"null"}`),delete s.timeExtent}return n}function ne(r,t,e,s){return yt.apply(this,arguments)}function yt(){return yt=(0,c.Z)(function*(r,t,e,s){const n=yield V(r,t,"json",s);return(0,re.p)(t,e,n.data),n}),yt.apply(this,arguments)}function oe(r,t,e){return ht.apply(this,arguments)}function ht(){return ht=(0,c.Z)(function*(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:V(r,t,"json",e,{returnIdsOnly:!0})}),ht.apply(this,arguments)}function ae(r,t,e){return ft.apply(this,arguments)}function ft(){return ft=(0,c.Z)(function*(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:V(r,t,"json",e,{returnExtentOnly:!0,returnCountOnly:!0}).then(s=>{const n=s.data;if(n.hasOwnProperty("extent"))return s;if(n.features)throw new Error(jt);if(n.hasOwnProperty("count"))throw new Error(jt);return s})}),ft.apply(this,arguments)}function ie(r,t,e){return(0,y.pC)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):V(r,t,"json",e,{returnIdsOnly:!0,returnCountOnly:!0})}function V(r,t,e,s={},n={}){const i="string"==typeof r?(0,T.mN)(r):r,l=t.geometry?[t.geometry]:[];return s.responseType="pbf"===e?"array-buffer":"json",(0,ee.aX)(l,null,s).then(d=>{const p=d&&d[0];(0,y.pC)(p)&&((t=t.clone()).geometry=p);const h=(0,ot.A)({...i.query,f:e,...n,...se(t,n)});return(0,g.default)((0,T.v_)(i.path,"queryTopFeatures"),{...s,query:{...h,...s.query}})})}var $=u(6871);function mt(){return mt=(0,c.Z)(function*(r,t,e,s){const n=(0,D.en)(r),i={...s},{data:l}=yield ne(n,$.Z.from(t),e,i);return et.default.fromJSON(l)}),mt.apply(this,arguments)}function gt(){return gt=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r);return(yield oe(s,$.Z.from(t),{...e})).data.objectIds}),gt.apply(this,arguments)}function Ft(){return Ft=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r),n=yield ae(s,$.Z.from(t),{...e});return{count:n.data.count,extent:Y.Z.fromJSON(n.data.extent)}}),Ft.apply(this,arguments)}function _t(){return _t=(0,c.Z)(function*(r,t,e){const s=(0,D.en)(r);return(yield ie(s,$.Z.from(t),{...e})).data.count}),_t.apply(this,arguments)}var pe=u(14517);let J=class extends pe.Z{constructor(...r){super(...r),this.requestOptions=null,this.url=null}normalizeCtorArgs(r,t){return"string"!=typeof r?r:{url:r,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(r){return(0,T.mN)(r)}_encode(r,t,e){const s={};for(const n in r){if("declaredClass"===n)continue;const i=r[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){s[n]=[];for(let l=0;l<i.length;l++)s[n][l]=this._encode(i[l])}else if("object"==typeof i)if(i.toJSON){const l=i.toJSON(e&&e[n]);s[n]=t?l:JSON.stringify(l)}else s[n]=t?i:JSON.stringify(i);else s[n]=i}return s}};(0,m._)([(0,F.Cb)({readOnly:!0})],J.prototype,"parsedUrl",null),(0,m._)([(0,F.Cb)()],J.prototype,"requestOptions",void 0),(0,m._)([(0,F.Cb)({type:String})],J.prototype,"url",void 0),J=(0,m._)([(0,w.j)("esri.tasks.Task")],J);const ye=J;let Z=class extends ye{constructor(r){super(r),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(r,t){var e=this;return(0,c.Z)(function*(){const s=yield e.executeJSON(r,t);return e.featureSetFromJSON(r,s,t)})()}executeJSON(r,t){var e=this;return(0,c.Z)(function*(){const s={...e.requestOptions,...t},n=e._normalizeQuery(r),i=null!=r.outStatistics?.[0],l=(0,v.Z)("featurelayer-pbf-statistics"),d=!i||l;let p;if("pbf"===e.format&&d)try{p=yield function Et(r,t,e){return nt.apply(this,arguments)}(e.url,n,s)}catch(h){if("query:parsing-pbf"!==h.name)throw h;e.format="json"}return"json"!==e.format&&d||(p=yield(0,Pt.F)(e.url,n,s)),e._normalizeFields(p.fields),p})()}featureSetFromJSON(r,t,e){var s=this;return(0,c.Z)(function*(){if(!s._queryIs3DObjectFormat(r)||(0,y.Wi)(s.infoFor3D)||!t.assetMaps||!t.features||!t.features.length)return et.default.fromJSON(t);const{meshFeatureSetFromJSON:n}=yield(0,N.Hl)(Promise.all([u.e(8592),u.e(2435)]).then(u.bind(u,12435)),e);return n(r,s.infoFor3D,t)})()}executeForCount(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return(0,Wt.P)(this.url,s,e)}executeForExtent(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return function Kt(r,t,e){return it.apply(this,arguments)}(this.url,s,e)}executeForIds(r,t){const e={...this.requestOptions,...t},s=this._normalizeQuery(r);return(0,Ht.G)(this.url,s,e)}executeRelationshipQuery(r,t){r=z.Z.from(r);const e={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function kt(r,t,e){return ct.apply(this,arguments)}(this.url,r,e)}executeRelationshipQueryForCount(r,t){r=z.Z.from(r);const e={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),function te(r,t,e){return pt.apply(this,arguments)}(this.url,r,e)}executeAttachmentQuery(r,t){const e={...this.requestOptions,...t};return function $t(r,t,e){return at.apply(this,arguments)}(this.url,r,e)}executeTopFeaturesQuery(r,t){const e={...this.requestOptions,...t};return function ue(r,t,e,s){return mt.apply(this,arguments)}(this.parsedUrl,r,this.sourceSpatialReference,e)}executeForTopIds(r,t){const e={...this.requestOptions,...t};return function le(r,t,e){return gt.apply(this,arguments)}(this.parsedUrl,r,e)}executeForTopExtents(r,t){const e={...this.requestOptions,...t};return function de(r,t,e){return Ft.apply(this,arguments)}(this.parsedUrl,r,e)}executeForTopCount(r,t){const e={...this.requestOptions,...t};return function ce(r,t,e){return _t.apply(this,arguments)}(this.parsedUrl,r,e)}_normalizeQuery(r){let t=rt.Z.from(r);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===r?t.clone():t,t.gdbVersion=r.gdbVersion||this.gdbVersion,t.dynamicDataSource=r.dynamicDataSource?St.n.from(r.dynamicDataSource):this.dynamicDataSource),(0,y.pC)(this.infoFor3D)&&this._queryIs3DObjectFormat(r)){t=t===r?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e){t.formatOf3DObjects=e;break}"3D_gltf"!==e||t.formatOf3DObjects||(t.formatOf3DObjects=e)}if(!t.formatOf3DObjects)throw new _.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,y.Wi)(t.outFields)||!t.outFields.includes("*")){t=t===r?t.clone():t,(0,y.Wi)(t.outFields)&&(t.outFields=[]);const{originX:e,originY:s,originZ:n,translationX:i,translationY:l,translationZ:d,scaleX:p,scaleY:h,scaleZ:f,rotationX:O,rotationY:x,rotationZ:R,rotationDeg:Q}=this.infoFor3D.transformFieldRoles;t.outFields.push(e,s,n,i,l,d,p,h,f,O,x,R,Q)}}return t}_normalizeFields(r){if((0,y.pC)(this.fieldsIndex)&&(0,y.pC)(r))for(const t of r){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(r){return(0,y.pC)(this.infoFor3D)&&r.returnGeometry&&"xyFootprint"!==r.multipatchOption&&!r.outStatistics}};(0,m._)([(0,F.Cb)({type:St.n})],Z.prototype,"dynamicDataSource",void 0),(0,m._)([(0,F.Cb)()],Z.prototype,"fieldsIndex",void 0),(0,m._)([(0,F.Cb)()],Z.prototype,"format",void 0),(0,m._)([(0,F.Cb)()],Z.prototype,"gdbVersion",void 0),(0,m._)([(0,F.Cb)()],Z.prototype,"infoFor3D",void 0),(0,m._)([(0,F.Cb)()],Z.prototype,"sourceSpatialReference",void 0),Z=(0,m._)([(0,w.j)("esri.tasks.QueryTask")],Z);const he=Z;var fe=u(38305),me=u(20514),ge=u(65234);const Fe=new C.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function Dt(r){return Rt.apply(this,arguments)}function Rt(){return Rt=(0,c.Z)(function*(r){return"string"==typeof r?(0,T.sJ)(r)||{data:r}:new Promise((t,e)=>{const s=new FileReader;s.readAsDataURL(r),s.onload=()=>t((0,T.sJ)(s.result)),s.onerror=n=>e(n)})}),Rt.apply(this,arguments)}const _e=new Set(["Feature Layer","Table"]),Re=new C.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let G=class extends P.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,N.Ds)((0,c.Z)(function*(){yield r.load();const t=r.sourceJSON.editingInfo?.lastEditDate;if(null==t)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const e=t!==r.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:e,updates:e?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}}))}load(r){const t=(0,y.pC)(r)?r.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:r}},parsedUrl:t,dynamicDataSource:e,infoFor3D:s,gdbVersion:n,spatialReference:i,fieldsIndex:l}=this.layer,d=(0,v.Z)("featurelayer-pbf")&&r&&(0,y.Wi)(s)?"pbf":"json";return new he({url:t.path,format:d,fieldsIndex:l,infoFor3D:s,dynamicDataSource:e,gdbVersion:n,sourceSpatialReference:i})}addAttachment(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/addAttachment",i=e._getLayerRequestOptions(),l=e._getFormDataForAttachment(t,i.query);try{const d=yield(0,g.default)(n,{body:l});return e._createFeatureEditResult(d.data.addAttachmentResult)}catch(d){throw e._createAttachmentErrorResult(s,d)}})()}updateAttachment(r,t,e){var s=this;return(0,c.Z)(function*(){yield s.load();const n=r.attributes[s.layer.objectIdField],i=s.layer.parsedUrl.path+"/"+n+"/updateAttachment",l=s._getLayerRequestOptions({query:{attachmentId:t}}),d=s._getFormDataForAttachment(e,l.query);try{const p=yield(0,g.default)(i,{body:d});return s._createFeatureEditResult(p.data.updateAttachmentResult)}catch(p){throw s._createAttachmentErrorResult(n,p)}})()}applyEdits(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=e.layer.infoFor3D,n=(0,y.pC)(s),i=n||t?.globalIdUsed,l=r.addFeatures.map(S=>e._serializeFeature(S,s)),d=r.updateFeatures.map(S=>e._serializeFeature(S,s)),p=e._getFeatureIds(r.deleteFeatures,i);(0,me.P)(l,d,e.layer.spatialReference);const h=[],f=[],O=[...r.deleteAttachments];for(const S of r.addAttachments)h.push(yield e._serializeAttachment(S));for(const S of r.updateAttachments)f.push(yield e._serializeAttachment(S));const x=h.length||f.length||O.length?{adds:h,updates:f,deletes:O}:null;let R,Q=null;if(n){Q=new Map;const S=[];for(const B of r.addAssets)S.push(e._serializeAssetMapEditAndUploadAssets(B,Q));const K=yield Promise.all(S);R=K.length?{adds:K,updates:[],deletes:[]}:void 0}const A={gdbVersion:t?.gdbVersion||e.layer.gdbVersion,rollbackOnFailure:t?.rollbackOnFailureEnabled,useGlobalIds:i,returnEditMoment:t?.returnEditMoment,usePreviousEditMoment:t?.usePreviousEditMoment,sessionId:t?.sessionId};t?.returnServiceEditsOption?(A.edits=JSON.stringify([{id:e.layer.layerId,adds:l,updates:d,deletes:p,attachments:x,assetMaps:(0,y.Wg)(R)}]),A.returnServiceEditsOption=Fe.toJSON(t?.returnServiceEditsOption),A.returnServiceEditsInSourceSR=t?.returnServiceEditsInSourceSR):(A.adds=l.length?JSON.stringify(l):null,A.updates=d.length?JSON.stringify(d):null,A.deletes=p.length?i?JSON.stringify(p):p.join(","):null,A.attachments=x&&JSON.stringify(x),A.assetMaps=(0,y.pC)(R)?JSON.stringify(R):void 0);const xe=e._getLayerRequestOptions({method:"post",query:A}),Zt=t?.returnServiceEditsOption?e.layer.url:e.layer.parsedUrl.path,W=yield(0,g.default)(Zt+"/applyEdits",xe);if(n&&null!=W.data&&null!=W.data.assetMaps){const S=W.data,K=e.layer.objectIdField,B=[];for(const q of S.addResults)q.success&&B.push(q.objectId);for(const q of S.updateResults)q.success&&B.push(q.objectId);const Se=e._createRequestQueryOptions(),H=yield(0,g.default)(Zt+"/query",{...Se,query:{f:"json",formatOf3DObjects:"3D_glb",where:`OBJECTID IN (${B.join(",")})`,outFields:`${K}`}});if(H&&H.data&&H.data.assetMaps&&(0,y.pC)(Q)){const q=H.data.assetMaps;for(const Ot of q){const X=Q.get(Ot.parentGlobalId).geometry;(0,y.pC)(X)&&"mesh"===X.type&&X.updateExternalSource({source:[{name:Ot.assetName,source:Ot.assetName}],extent:X.extent})}}}return e._createEditsResult(W)})()}deleteAttachments(r,t){var e=this;return(0,c.Z)(function*(){yield e.load();const s=r.attributes[e.layer.objectIdField],n=e.layer.parsedUrl.path+"/"+s+"/deleteAttachments";try{return(yield(0,g.default)(n,e._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(e._createFeatureEditResult)}catch(i){throw e._createAttachmentErrorResult(s,i)}})()}fetchRecomputedExtents(r={}){var t=this;return this.load({signal:r.signal}).then((0,c.Z)(function*(){const s=t._getLayerRequestOptions({...r,query:{returnUpdates:!0}}),{layerId:n,url:i}=t.layer,{data:l}=yield(0,g.default)(`${i}/${n}`,s),{id:d,extent:p,fullExtent:h,timeExtent:f}=l,O=p||h;return{id:d,fullExtent:O&&Y.Z.fromJSON(O),timeExtent:f&&I.Z.fromJSON({start:f[0],end:f[1]})}}))}queryAttachments(r,t={}){var e=this;return(0,c.Z)(function*(){const{parsedUrl:s}=e.layer,n=s.path;yield e.load();const i=e._getLayerRequestOptions(t);if(!e.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:l}=r,d=[];for(const p of l)d.push((0,g.default)(n+"/"+p+"/attachments",i));return Promise.all(d).then(p=>l.map((h,f)=>({parentObjectId:h,attachmentInfos:p[f].data.attachmentInfos}))).then(p=>Ct(p,n))}return e.queryTask.executeAttachmentQuery(r,i)})()}queryFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.execute(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryFeaturesJSON(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryObjectIds(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryFeatureCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryExtent(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryRelatedFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryRelatedFeaturesCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopFeatures(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopObjectIds(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopExtents(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(r,{...t,query:e._createRequestQueryOptions(t)})})()}queryTopCount(r,t){var e=this;return(0,c.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(r,{...t,query:e._createRequestQueryOptions(t)})})()}fetchPublishingStatus(){var r=this;return(0,c.Z)(function*(){if(!(0,fe.M8)(r.layer.url))return"unavailable";const t=(0,T.v_)(r.layer.url,"status"),e=yield(0,g.default)(t,{query:{f:"json"}});return Re.fromJSON(e.data.status)})()}_createRequestQueryOptions(r){const t={...this.layer.customParameters,token:this.layer.apiKey,...r?.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}_fetchService(r,t){var e=this;return(0,c.Z)(function*(){if(!r){const{data:n}=yield(0,g.default)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:(0,v.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));r=n}e.sourceJSON=e._patchServiceJSON(r);const s=r.type;if(!_e.has(s))throw new _.Z("feature-layer-source:unsupported-type",`Source type "${s}" is not supported`)})()}_patchServiceJSON(r){if("Table"!==r.type&&r.geometryType&&!r?.drawingInfo?.renderer&&!r.defaultSymbol){const t=(0,At.bU)(r.geometryType).renderer;(0,b.RB)("drawingInfo.renderer",t,r)}return"esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),r}_serializeFeature(r,t){const{geometry:e,attributes:s}=r;if((0,y.pC)(t)&&(0,y.pC)(r.geometry)&&"mesh"===r.geometry.type){const n={...s},i=r.geometry,l=i.origin,d=i.transform;if(n[t.transformFieldRoles.originX]=l.x,n[t.transformFieldRoles.originY]=l.y,n[t.transformFieldRoles.originZ]=l.z,(0,y.pC)(d)){const p=d.translation,h=d.scale,f=d.rotation;n[t.transformFieldRoles.translationX]=p[0],n[t.transformFieldRoles.translationY]=p[1],n[t.transformFieldRoles.translationZ]=p[2],n[t.transformFieldRoles.scaleX]=h[0],n[t.transformFieldRoles.scaleY]=h[1],n[t.transformFieldRoles.scaleZ]=h[2],n[t.transformFieldRoles.rotationX]=f[0],n[t.transformFieldRoles.rotationY]=f[1],n[t.transformFieldRoles.rotationZ]=f[2],n[t.transformFieldRoles.rotationDeg]=f[3]}return{geometry:null,attributes:n}}return(0,y.Wi)(e)?{attributes:s}:"mesh"===e.type||"extent"===e.type?null:{geometry:e.toJSON(),attributes:s}}_serializeAttachment(r){var t=this;return(0,c.Z)(function*(){const{feature:e,attachment:s}=r,{globalId:n,name:i,contentType:l,data:d,uploadId:p}=s,h={globalId:n,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(e&&(h.parentGlobalId="attributes"in e?e.attributes&&e.attributes[t.layer.globalIdField]:e.globalId),p)h.uploadId=p;else if(d){const f=yield Dt(d);h.contentType=f.mediaType,h.data=f.data,d instanceof File&&(h.name=d.name)}return i&&(h.name=i),l&&(h.contentType=l),h})()}_serializeAssetMapEditAndUploadAssets(r,t){var e=this;return(0,c.Z)(function*(){const s=e.layer.url;let n=null;try{const f=new Blob([r.data],{type:r.mimeType}),O=new FormData;O.append("f","json"),O.append("file",f,`${r.assetName}`);const x={body:O,method:"post",responseType:"json"},{data:R}=yield(0,g.default)(`${s}/uploads/upload`,x);if(!R.success)throw new _.Z("feature-layer-source:upload-failure","Expected upload to be successfull.");n={assetType:r.assetType,assetUploadId:R.item.itemID}}catch{n=null}if((0,y.Wi)(n)){const f=yield Dt(new Blob([r.data]));if(!f.isBase64)throw new _.Z("feature-layer-source:uploadAssets-failure","Expected gltf data in base64 format after conversion.");n={assetType:r.assetType,assetData:f.data}}if((0,y.Wi)(n))throw new _.Z("feature-layer-source:uploadAssets-failure","Unable to prepare uploadAsset request options.");const i={method:"post",query:{f:"json",assets:JSON.stringify([n])},responseType:"json"},l=yield(0,g.default)((0,T.v_)(e.layer.parsedUrl.path,"uploadAssets"),i);if(1!==l.data.uploadResults.length||!l.data.uploadResults[0].success)throw new _.Z("feature-layer-source:uploadAssets-failure","Bad response.");const d=l.data.uploadResults[0].assetHash,p=[];r.flags&k.PROJECT_VERTICES&&p.push("PROJECT_VERTICES");const h={globalId:r.assetMapGlobalId,parentGlobalId:r.featureGlobalId,assetName:r.assetName,assetHash:d,flags:p};return t.set(r.featureGlobalId,r.feature),h})()}_getFeatureIds(r,t){const e=r[0];return e?this._canUseGlobalIds(t,r)?this._getGlobalIdsFromFeatureIdentifier(r):"objectId"in e?this._getObjectIdsFromFeatureIdentifier(r):this._getIdsFromFeatures(r):[]}_getIdsFromFeatures(r){const t=this.layer.objectIdField;return r.map(e=>e.attributes&&e.attributes[t])}_canUseGlobalIds(r,t){return r&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(r){return r.map(t=>t.objectId)}_getGlobalIdsFromFeatureIdentifier(r){return r.map(t=>t.globalId)}_createEditsResult(r){const t=r.data,{layerId:e}=this.layer,s=[];let n=null;if(Array.isArray(t))for(const d of t)s.push({id:d.id,editedFeatures:d.editedFeatures}),d.id===e&&(n={addResults:d.addResults,updateResults:d.updateResults,deleteResults:d.deleteResults,attachments:d.attachments,editMoment:d.editMoment});else n=t;const i=n?.attachments,l={addFeatureResults:n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:i&&i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:i&&i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:i&&i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[]};if(n.editMoment&&(l.editMoment=n.editMoment),s.length>0){l.editedFeatureResults=[];for(const d of s){const{adds:p,updates:h,deletes:f,spatialReference:O}=d.editedFeatures,x=O?new ge.Z(O):null;l.editedFeatureResults.push({layerId:d.id,editedFeatures:{adds:p?.map(R=>this._createEditedFeature(R,x))||[],updates:h?.map(R=>({original:this._createEditedFeature(R[0],x),current:this._createEditedFeature(R[1],x)}))||[],deletes:f?.map(R=>this._createEditedFeature(R,x))||[],spatialReference:x}})}}return l}_createEditedFeature(r,t){return new j.Z({attributes:r.attributes,geometry:(0,xt.im)({...r.geometry,spatialReference:t})})}_createFeatureEditResult(r){const t=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:t?new _.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(r,t){return{objectId:r,globalId:null,error:new _.Z("feature-layer-source:attachment-failure",t.details.messages&&t.details.messages[0]||t.message,{code:t.details.httpStatus||t.details.messageCode})}}_getFormDataForAttachment(r,t){const e=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(e)for(const s in t){const n=t[s];null!=n&&(e.set?e.set(s,n):e.append(s,n))}return e}_getLayerRequestOptions(r={}){const{parsedUrl:t,gdbVersion:e,dynamicDataSource:s}=this.layer;return{...r,query:{gdbVersion:e,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(r)},responseType:"json"}}};(0,m._)([(0,F.Cb)()],G.prototype,"type",void 0),(0,m._)([(0,F.Cb)({constructOnly:!0})],G.prototype,"layer",void 0),(0,m._)([(0,F.Cb)({readOnly:!0})],G.prototype,"queryTask",null),G=(0,m._)([(0,w.j)("esri.layers.graphics.sources.FeatureLayerSource")],G);const Oe=G},56554:(L,E,u)=>{u.d(E,{Dm:()=>v,Hq:()=>C,MS:()=>P,bU:()=>g});var c=u(8314),m=u(58817),M=u(87757),j=u(24837);function g(y){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===y||"esriGeometryMultipoint"===y?j.I4:"esriGeometryPolyline"===y?j.ET:j.lF}}}const I=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let _=1;function v(y,b){if((0,c.Z)("esri-csp-restrictions"))return()=>({[b]:null,...y});try{let N=`this.${b} = null;`;for(const F in y)N+=`this${I.test(F)?`.${F}`:`["${F}"]`} = ${JSON.stringify(y[F])};`;const T=new Function(`\n      return class AttributesClass$${_++} {\n        constructor() {\n          ${N};\n        }\n      }\n    `)();return()=>new T}catch{return()=>({[b]:null,...y})}}function C(y={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,m.d9)(y)}}]}function P(y,b){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:y},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:b,supportsDelete:b,supportsEditing:b,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:b,supportsExceedsLimitStatistics:!0},query:M.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:b,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},90463:(L,E,u)=>{u.d(E,{P:()=>g});var c=u(15861),m=u(2618),M=u(20477),j=u(96854);function g(_,v,C){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)(function*(_,v,C){const P=(0,m.en)(_);return(0,M.executeQueryForCount)(P,j.Z.from(v),{...C}).then(y=>y.data.count)})).apply(this,arguments)}},24865:(L,E,u)=>{u.d(E,{G:()=>g});var c=u(15861),m=u(2618),M=u(20477),j=u(96854);function g(_,v,C){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)(function*(_,v,C){const P=(0,m.en)(_);return(0,M.executeQueryForIds)(P,j.Z.from(v),{...C}).then(y=>y.data.objectIds)})).apply(this,arguments)}}}]);