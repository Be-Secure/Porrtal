"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[2785],{93310:(Et,at,_)=>{_.d(at,{S:()=>R,b:()=>P});var I=_(4794),tt=_(81801),q=_(6945),z=_(78925),K=_(24255),et=_(10109),rt=_(67022),st=_(33726),ct=_(2166),U=_(97139),$=_(69960),N=_(17625),Y=_(63123),ot=_(22355),O=_(42743),M=_(16396);function P(E){const W=new ot.kG,Z=E.hasMultipassTerrain&&(E.output===q.H.Color||E.output===q.H.Alpha);W.include(K.w),W.include(tt.A,E),W.include(z.f5,E);const{vertex:V,fragment:lt}=W;return lt.include(st.Y),(0,ct.S)(W,E),lt.uniforms.add(new $.N("uColor",ut=>ut.color)),W.attributes.add(M.T.POSITION,"vec3"),W.varyings.add("vWorldPosition","vec3"),Z&&W.varyings.add("depth","float"),E.screenSizeEnabled&&W.attributes.add(M.T.OFFSET,"vec3"),E.shadingEnabled&&(V.uniforms.add(new Y.g("viewNormal",(ut,dt)=>dt.camera.viewInverseTransposeMatrix)),W.attributes.add(M.T.NORMAL,"vec3"),W.varyings.add("vViewNormal","vec3")),V.code.add(N.H`
    void main(void) {
      vWorldPosition = ${E.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),E.shadingEnabled&&V.code.add(N.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),V.code.add(N.H`
    ${Z?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),Z&&W.include(et.l,E),lt.code.add(N.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${Z?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),E.shadingEnabled?(lt.uniforms.add(new U.J("shadingDirection",ut=>ut.shadingDirection)),lt.uniforms.add(new $.N("shadedColor",ut=>function D(E,W){const Z=1-E[3],V=E[3]+W[3]*Z;return 0===V?(w[3]=V,w):(w[0]=(E[0]*E[3]+W[0]*W[3]*Z)/V,w[1]=(E[1]*E[3]+W[1]*W[3]*Z)/V,w[2]=(E[2]*E[3]+W[2]*W[3]*Z)/V,w[3]=W[3],w)}(ut.shadingTint,ut.color))),lt.code.add(N.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):lt.code.add(N.H`vec4 finalColor = uColor;`),lt.code.add(N.H`
      if (finalColor.a < ${N.H.float(rt.b)}) {
        discard;
      }
      ${E.output===q.H.Alpha?N.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${E.output===q.H.Color?N.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${E.transparencyPassType===O.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),W}const w=(0,I.c)(),R=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}))},60507:(Et,at,_)=>{_.d(at,{RL:()=>et,VW:()=>z,jG:()=>O,tq:()=>Y,vQ:()=>U,zx:()=>$});var I=_(62208),tt=_(29505);function z(M,P){return function q(M,P){return(0,I.Wi)(P)||!P.mode?M?"absolute-height":"on-the-ground":P.mode}(!!(0,I.pC)(M)&&M.hasZ,P)}function et(M){const P=function st(M){return M.layer&&"elevationInfo"in M.layer?M.layer.elevationInfo:null}(M),D=z(M.geometry,P);return{mode:D,offset:(0,I.pC)(P)&&"on-the-ground"!==D?(0,I.Pt)(P.offset,0)*(0,tt.Z7)((0,I.Pt)(P.unit,"meters")):0}}function U(M,P,D,w=null){return N(M,P.x,P.y,P.hasZ?P.z:0,P.spatialReference,D,w)}function $(M,P,D,w,R=null){return N(M,P[0],P[1],P.length>2?P[2]:0,D,w,R)}function N(M,P,D,w,R,E,W=null){if((0,I.Wi)(E))return;const Z=(0,I.pC)(W)?W.mode:"absolute-height";if("on-the-ground"===Z)return 0;const{absoluteZ:V}=Y(P,D,w,R,M,E);return function ot(M,P,D,w,R,E,W,Z){const V=(0,I.pC)(W)&&(0,I.pC)(W.offset)?W.offset:0;switch(Z){case"absolute-height":return M-V;case"relative-to-ground":return M-((0,I.Pt)(E.elevationProvider.getElevation(P,D,w,R,"ground"),0)+V);case"relative-to-scene":return M-((0,I.Pt)(E.elevationProvider.getElevation(P,D,w,R,"scene"),0)+V)}}(V,P,D,w,R,M,W,Z)}function Y(M,P,D,w,R,E){const W=(0,I.pC)(E.offset)?E.offset:0;switch(E.mode){case"absolute-height":return{absoluteZ:D+W,elevation:0};case"on-the-ground":{const Z=(0,I.Pt)(R.elevationProvider.getElevation(M,P,0,w,"ground"),0);return{absoluteZ:Z,elevation:Z}}case"relative-to-ground":{const Z=(0,I.Pt)(R.elevationProvider.getElevation(M,P,D,w,"ground"),0);return{absoluteZ:D+Z+W,elevation:Z}}case"relative-to-scene":{const Z=(0,I.Pt)(R.elevationProvider.getElevation(M,P,D,w,"scene"),0);return{absoluteZ:D+Z+W,elevation:Z}}}}const O={mode:"absolute-height",offset:0}},1437:(Et,at,_)=>{_.d(at,{p:()=>U});var I=_(17626),tt=_(54024),q=_(62208),z=_(60330),K=_(77712),ct=(_(85931),_(8314),_(90912),_(76898));const U=$=>{let N=class extends((0,z.v)($)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(Y){this._userInteractive=Y}get updating(){return!1}get visible(){return!(0,q.pC)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(Y){void 0!==Y?this._override("visible",Y):this._clearOverride("visible")}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,tt.kB)(()=>this._interactiveViewModelCount--)}};return(0,I._)([(0,K.Cb)({readOnly:!0})],N.prototype,"type",void 0),(0,I._)([(0,K.Cb)({constructOnly:!0})],N.prototype,"analysis",void 0),(0,I._)([(0,K.Cb)({constructOnly:!0})],N.prototype,"parent",void 0),(0,I._)([(0,K.Cb)({constructOnly:!0})],N.prototype,"view",void 0),(0,I._)([(0,K.Cb)({type:Boolean})],N.prototype,"interactive",null),(0,I._)([(0,K.Cb)()],N.prototype,"_userInteractive",void 0),(0,I._)([(0,K.Cb)({readOnly:!0})],N.prototype,"updating",null),(0,I._)([(0,K.Cb)()],N.prototype,"visible",null),(0,I._)([(0,K.Cb)()],N.prototype,"_interactiveViewModelCount",void 0),N=(0,I._)([(0,ct.j)("esri.views.3d.analysis.AnalysisView3D")],N),N}},45403:(Et,at,_)=>{_.d(at,{Z:()=>Rt}),_(29132);var tt=_(94573),q=_(61885),z=_(21286),K=_(62208),et=_(23841),rt=_(52323),st=_(30217),ct=_(550),U=_(28347),$=_(43703),N=_(67831),Y=_(84161),ot=_(28093),O=_(55915),M=_(12080),P=_(65401),D=_(13777),w=_(90014),R=_(70562),E=_(26242),W=_(84786),Z=_(53929),V=_(26046),lt=_(42743),ut=_(59856),dt=_(96867),yt=_(34103),gt=_(33786),Mt=_(49672);class Rt{constructor(f){this.camera=new ut.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,$.c)(),this._worldFrame=null,this._renderLocation=(0,ot.c)(),this._renderLocationDirty=!0,this._location=new Mt.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new Mt.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=gt.jg.None,this._focused=!1,this.events=new q.Z.EventEmitter,this._screenLocation={screenPointArray:(0,et.s1)(),renderScreenPointArray:(0,et.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=f.view.spatialReference;for(const L in f)this[L]=f[L];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(f){this._elevationInfo=f,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(f){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=f.slice(),this._updateEngineObject()}set available(f){f!==this._available&&(this._available=f,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,rt.IH)(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(f){f!==this._radius&&(this._radius=f,this._updateEngineObject())}get radius(){return this._radius}set worldSized(f){f!==this._worldSized&&(this._worldSized=f,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(f){Ct(f)&&(this._screenLocationDirty=!0),(0,U.c)(this._modelTransform,f),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,$.c)()),function bt(X,f,L){switch(X.viewingMode){case"local":return(0,U.i)(L),!0;case"global":{const A=(0,M.Iu)(X.renderCoordsHelper.spatialReference);(0,O.PR)(f,0,y,0,A.radius),(0,O.yH)((0,z.Vl)(y[0]),(0,z.Vl)(y[1]),L)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(f){this.view.renderCoordsHelper.fromRenderCoords(f,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(f){(0,W.WG)(f,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(f){(0,W.WG)(f,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const f=(0,K.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=f+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(f){f!==this._grabbing&&(this._grabbing=f,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(f){f!==this._hovering&&(this._hovering=f,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(f){f!==this._selected&&(this._selected=f,this._updateEngineObject(),this.events.emit("select-changed",{action:f?"select":"deselect"}))}get state(){return this._state}set state(f){f!==this._state&&(this._state=f,this._updateEngineObject())}updateStateEnabled(f,L){L?this.state|=f:this.state&=~f}_setFocused(f){f!==this._focused&&(this._focused=f,this.events.emit("focus-changed",{action:!0===f?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let f;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Ct(this._modelTransform)){const L=this._calculateModelTransformOffset(B);f=(0,Y.a)(L,L,this.renderLocation)}else f=this.renderLocation;this.camera.projectToRenderScreen(f,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(f){this._applyObjectTransform=f,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(f,L){if(!this.available)return null;const A=(0,et.md)(f,Dt),b=this._getCollisionRadius(L),T=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,N.s)(this.screenLocation.screenPointArray,A)<b*b)return this.screenLocation.renderScreenPointArray[2]+T;break;case"line":{const j=this.collisionType.paths,F=this._getWorldToScreenObjectScale(),k=this._calculateObjectTransform(F,v),Q=b*this.screenLocation.pixelSize,it=(0,V.u4)(this.camera,A,Tt);if((0,K.Wi)(it))return null;for(const J of j){if(0===J.length)continue;const nt=(0,Y.m)(y,J[0],k);for(let ht=1;ht<J.length;ht++){const _t=(0,Y.m)(p,J[ht],k),vt=(0,D.Gr)((0,D.zk)(nt,_t,pt),it);if(null!=vt&&vt<Q*Q){const ft=(0,Y.a)(E.WM.get(),nt,_t);(0,Y.g)(ft,ft,.5);const mt=(0,et.So)(E.WM.get());return this.camera.projectToRenderScreen(ft,mt),mt[2]+T}(0,Y.c)(nt,_t)}}break}case"disc":{const j=this.collisionType.direction,F=this.collisionType.offset??ot.Z,k=this._getWorldToScreenObjectScale(),Q=this._calculateObjectTransform(k,v),it=b*this.screenLocation.pixelSize,J=(0,V.u4)(this.camera,A,Tt);if((0,K.Wi)(J))return null;const nt=(0,st.f)(At,Q),ht=(0,Y.t)(S,j,nt),_t=(0,Y.m)(H,F,Q);(0,w.Yq)(_t,ht,C);const vt=x;if((0,w.BR)(C,J,vt)&&(0,Y.d)(vt,_t)<it*it)return this.screenLocation.renderScreenPointArray[2]+T;break}case"ribbon":{const{paths:j,direction:F}=this.collisionType,k=this._getWorldToScreenObjectScale(),Q=this._calculateObjectTransform(k,v),it=b*this.camera.computeScreenPixelSizeAt(this.renderLocation),J=(0,V.u4)(this.camera,A,Tt);if((0,K.Wi)(J))return null;const nt=(0,st.f)(At,Q),ht=(0,Y.t)(S,F,nt),_t=this._calculateModelTransformPosition(H);(0,w.Yq)(_t,ht,C);const vt=x;if(!(0,w.BR)(C,J,vt))break;for(const ft of j){if(0===ft.length)continue;const mt=(0,Y.m)(y,ft[0],Q);for(let Ot=1;Ot<ft.length;Ot++){const St=(0,Y.m)(p,ft[Ot],Q),Lt=(0,D.Jk)((0,D.zk)(mt,St,pt),vt);if(null!=Lt&&Lt<it*it){const jt=(0,Y.a)(E.WM.get(),mt,St);(0,Y.g)(jt,jt,.5);const Wt=(0,et.So)(E.WM.get());return this.camera.projectToRenderScreen(jt,Wt),Wt[2]+T}(0,Y.c)(mt,St)}}break}default:(0,tt.Bg)(this.collisionType)}return null}attach(f={manipulator3D:{}}){if(!this.view._stage)return;const L=f.manipulator3D;if((0,K.Wi)(L.engineLayerId)){const A=new yt.F({isPickable:!1,updatePolicy:lt.jq.SYNC});this.view._stage.add(A),L.engineLayerId=A.id,this._engineLayer=A}else this.view._stage?.getObject&&(this._engineLayer=this.view._stage.getObject(L.engineLayerId));L.engineLayerReferences=(L.engineLayerReferences||0)+1,this._materialIdReferences=L.materialIdReferences,(0,K.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,L.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,O.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Mt.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(f={manipulator3D:{}}){const L=f.manipulator3D;L.engineLayerReferences--;const A=0===L.engineLayerReferences;A&&(L.engineLayerId=null),this._removeResourcesFromStage(A),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(f){(0,O.nF)(this.location,G,f.spatialReference),(0,P.Qn)(f.extent,G)&&(this.location=this._location)}_evaluateElevationAlignment(f=this.location){if((0,K.Wi)(this.elevationInfo))return!1;let L=null,A=0;const b=(0,K.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":L=(0,K.Pt)((0,Z.KO)(this.view.elevationProvider,f,"ground"),0);break;case"relative-to-ground":A=(0,K.Pt)((0,Z.KO)(this.view.elevationProvider,f,"ground"),0)+b;break;case"relative-to-scene":A=(0,K.Pt)((0,Z.KO)(this.view.elevationProvider,f,"scene"),0)+b;break;case"absolute-height":A=b}return(A!==this._elevation.offset||L!==this._elevation.override)&&(this._elevation.offset=A,this._elevation.override=L,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const f=this._getWorldToScreenObjectScale(),L=v;if(!0===this.autoScaleRenderObjects){const j=this._getFocusedSize(this._radius,this.focused)*f;this._calculateObjectTransform(j,L)}else this._calculateObjectTransform(f,L);const{objectsByState:A}=this._ensureEngineResources(),b=(this.focused?gt.Q9.Focused:gt.Q9.Unfocused)|(this.selected?gt.Q9.Selected:gt.Q9.Unselected),T=this._noDisplayCount>0;for(const{stateMask:j,objects:F}of A){if(T){for(const nt of F)nt.setVisible(!1);continue}const J=!((j&gt.jg.All)!==gt.jg.None)||(this.state&j)==(j&gt.jg.All);if((j&gt.Q9.All)!==gt.Q9.None&&(b&j)!=(j&gt.Q9.All)||!J)for(const nt of F)nt.setVisible(!1);else for(const nt of F)nt.setVisible(!0),nt.transformation=L}}_ensureEngineResources(){if((0,K.Wi)(this._engineResources)){const f=(0,K.Wg)(this._engineLayer),L=[],A=new Set;this.renderObjects.forEach(({material:F})=>{A.has(F)||(L.push(F),A.add(F))});const b=(F,k)=>{const{geometry:Q,material:it,transform:J}=k;Array.isArray(Q)?Q.forEach(nt=>F.addGeometry(nt,it,J)):F.addGeometry(Q,it,J)},T=new Map;this._renderObjects.forEach(F=>{const k=new dt.T({castShadow:!1});b(k,F);const Q=F.stateMask||0,it=T.get(Q)||[];it.push(k),T.set(Q,it)});const j=[];T.forEach((F,k)=>j.push({stateMask:k,objects:F})),this._engineResources={objectsByState:j,layer:f,materials:L}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||(0,K.Wi)(this._engineResources))return;const{objectsByState:f,layer:L,materials:A}=this._engineResources;A.forEach(b=>{const T=(0,K.Wg)(this._materialIdReferences),j=T.get(b.id)||0;0===j&&this.view._stage.add(b),T.set(b.id,j+1)}),f.forEach(({objects:b})=>{L.addMany(b),this.view._stage.addMany(b)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(f=!1){if(!this._engineResourcesAddedToStage||(0,K.Wi)(this._engineResources)||!this.view._stage)return;const{objectsByState:L,layer:A,materials:b}=this._engineResources;L.forEach(({objects:T})=>{A.removeMany(T),this.view._stage.removeMany(T)}),b.forEach(T=>{const j=(0,K.Wg)(this._materialIdReferences),F=j.get(T.id);1===F?(this.view._stage.remove(T),j.delete(T.id)):j.set(T.id,F-1)}),f&&this.view._stage.remove(A),this._engineResourcesAddedToStage=!1}_getCollisionRadius(f){return this._getFocusedSize(this.radius,!0)*("touch"===f?this.touchMultiplier:1)}_getFocusedSize(f,L){return f*(L?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(f){const L=this._getWorldToScreenObjectScale(),A=this._calculateObjectTransform(L,Pt);return(0,Y.s)(f,A[12],A[13],A[14])}_calculateModelTransformOffset(f){const L=this._calculateModelTransformPosition(f);return(0,Y.b)(f,L,this.renderLocation)}_calculateObjectTransform(f,L){return(0,U.s)(L,f,0,0,0,0,f,0,0,0,0,f,0,0,0,0,1),this._worldFrame&&(0,U.m)(L,L,this._worldFrame),(0,U.m)(L,L,this._modelTransform),L[12]+=this.renderLocation[0],L[13]+=this.renderLocation[1],L[14]+=this.renderLocation[2],L[15]=1,(0,K.pC)(this._applyObjectTransform)&&this._applyObjectTransform(L),L}get test(){let f=!1;if((0,K.pC)(this._engineResources))for(const L in this._engineResources.objectsByState){const A=this._engineResources.objectsByState[L];for(const b of A.objects)if(b.isVisible){f=!0;break}if(f)break}return{areAnyResourcesVisible:f}}}function Ct(X){return 0!==X[12]||0!==X[13]||0!==X[14]}const Dt=(0,et.s1)(),pt=(0,D.Ue)(),Tt=(0,R.Ue)(),At=(0,ct.c)(),Pt=(0,$.c)(),v=(0,$.c)(),C=(0,w.Ue)(),y=(0,ot.c)(),p=(0,ot.c)(),x=(0,ot.c)(),S=(0,ot.c)(),H=(0,ot.c)(),B=(0,ot.c)(),G=new Mt.Z({x:0,y:0,z:0,spatialReference:null})},35754:(Et,at,_)=>{_.d(at,{Gd:()=>B,Aq:()=>G,EA:()=>x,aD:()=>H});var I=_(28347),tt=_(84161),q=_(4794),z=_(26242),et=(_(84786),_(45403)),st=(_(67225),_(42743)),ct=_(57521),U=_(40723),$=_(92972),N=_(28093),Y=_(5548),ot=_(60479),O=_(19625),M=_(6945),P=_(60881),D=_(32393),w=_(5894),R=_(2282),E=_(16396),W=_(42037),Z=_(57623),V=_(17626),lt=_(651),ut=_(91056),dt=_(87601),yt=_(88569),gt=_(12407),Mt=_(41528),Rt=_(93310),Ct=_(67969),bt=_(2078);class Dt extends ut.A{initializeProgram(b){const T=Dt.shader.get().build(this.configuration);return new gt.$(b.rctx,T,Tt)}_setPipelineState(b){const T=this.configuration,j=b===st.Am.NONE,F=b===st.Am.FrontFace;return(0,bt.sm)({blending:T.output!==M.H.Color&&T.output!==M.H.Alpha||!T.transparent?null:j?yt.wu:(0,yt.j7)(b),culling:(0,bt.zp)(T.cullFace),depthTest:{func:F?Ct.wb.LESS:T.shadingEnabled?Ct.wb.LEQUAL:Ct.wb.LESS},depthWrite:j?T.writeDepth&&bt.LZ:(0,yt.K5)(b),colorWrite:bt.BK,polygonOffset:j||F?null:yt.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Dt.shader=new lt.J(Rt.S,()=>_.e(8271).then(_.bind(_,88271)));class pt extends Mt.W{constructor(){super(...arguments),this.output=M.H.Color,this.cullFace=st.Vr.None,this.transparencyPassType=st.Am.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,V._)([(0,dt.o)({count:M.H.COUNT})],pt.prototype,"output",void 0),(0,V._)([(0,dt.o)({count:st.Vr.COUNT})],pt.prototype,"cullFace",void 0),(0,V._)([(0,dt.o)({count:st.Am.COUNT})],pt.prototype,"transparencyPassType",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"hasSlicePlane",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"transparent",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"writeDepth",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"screenSizeEnabled",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"shadingEnabled",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"hasMultipassTerrain",void 0),(0,V._)([(0,dt.o)()],pt.prototype,"cullAboveGround",void 0);const Tt=new Map([[E.T.POSITION,0],[E.T.NORMAL,1],[E.T.OFFSET,2]]);class At extends U.F5{constructor(b){super(b,new v),this.supportsEdges=!0,this.techniqueConfig=new pt,this._vertexAttributeLocations=Tt}getConfiguration(b,T){return this.techniqueConfig.output=b,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=T.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=T.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=T.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(b,T,j,F,k,Q,it){if(this.parameters.screenSizeEnabled){const J=b.vertexAttributes.get(E.T.OFFSET),nt={applyToVertex:(ht,_t,vt,ft)=>{const mt=(0,tt.s)(y,J.data[3*ft+0],J.data[3*ft+1],J.data[3*ft+2]),Ot=(0,tt.s)(p,ht,_t,vt);return(0,tt.g)(mt,mt,this.parameters.screenSizeScale*F.camera.computeRenderPixelSizeAt(mt)),(0,tt.a)(Ot,Ot,mt),[Ot[0],Ot[1],Ot[2]]},applyToAabb:ht=>{const _t=(0,Y.be)(ht,y);return(0,Y.bA)(ht,this.parameters.screenSizeScale*F.camera.computeRenderPixelSizeAt(_t))}};(0,Z.Bw)(b,T,F,k,Q,nt,it)}else(0,Z.Bw)(b,T,F,k,Q,void 0,it)}requiresSlot(b,T){if((0,D.S)(T)===M.H.Highlight)return b===w.r.OPAQUE_MATERIAL;let j=w.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(j=this.parameters.writeDepth?w.r.TRANSPARENT_MATERIAL:w.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),b===j||b===w.r.DRAPED_MATERIAL}createGLMaterial(b){return b.output===M.H.Color||b.output===M.H.Alpha||b.output===M.H.Highlight?new Pt(b):null}createBufferWriter(){return new C(this.parameters.screenSizeEnabled)}}class Pt extends P.Z{beginSlot(b){return this.ensureTechnique(Dt,b)}}class v extends U.Mt{constructor(){super(...arguments),this.color=(0,q.f)(1,1,1,1),this.shadingTint=(0,q.f)(0,0,0,.25),this.shadingDirection=(0,tt.n)((0,N.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=st.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class C{constructor(b){this.screenSizeEnabled=b;const T=(0,O.U$)().vec3f(E.T.POSITION).vec3f(E.T.NORMAL);this.screenSizeEnabled&&T.vec3f(E.T.OFFSET),this.vertexBufferLayout=T}allocate(b){return this.vertexBufferLayout.createBuffer(b)}elementCount(b){return b.indices.get(E.T.POSITION).length}write(b,T,j,F){if((0,W.NK)(T,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,j,F),this.screenSizeEnabled){if(!T.vertexAttributes.has(E.T.OFFSET))throw new Error(`${E.T.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const k=T.vertexAttributes.get(E.T.OFFSET),Q=T.indices.get(E.T.OFFSET);(0,R.hu)(3===k.size);const it=j.getField(E.T.OFFSET,ot.ct);if(!it)throw new Error("unable to acquire view for "+E.T.OFFSET);(0,W.ho)(Q,k.data,b.invTranspTransformation,it,F)}}}}const y=(0,N.c)(),p=(0,N.c)();function x(A,b=U.yD.OccludeAndTransparent,T=!0){const j=(0,q.f)(A[0],A[1],A[2],A.length>3?A[3]:1),F=A[3]<1;return T?new At({color:j,transparent:F,writeDepth:!0,cullFace:st.Vr.Back,renderOccluded:b}):new $.E({color:j,transparent:F,writeDepth:!0,cullFace:st.Vr.Back,renderOccluded:b})}function H(A,b,T){return new et.Z({view:A,renderObjects:[{geometry:ct.Z.createSphereGeometry(1,32,32),material:x((0,q.f)(b[0],b[1],b[2],T??1))}]})}function B(A,b,T,j){const F=(0,tt.b)(z.WM.get(),A,T),k=G(F,(0,tt.f)(z.WM.get(),j,F),T,z.MP.get());(0,I.a)(k,k);const Q=(0,tt.m)(z.WM.get(),b,k);return Math.atan2(Q[1],Q[0])}function G(A,b,T,j){const F=(0,tt.n)(z.WM.get(),A),k=(0,tt.n)(z.WM.get(),b),Q=(0,tt.f)(z.WM.get(),F,k);return j[0]=F[0],j[1]=F[1],j[2]=F[2],j[3]=0,j[4]=k[0],j[5]=k[1],j[6]=k[2],j[7]=0,j[8]=Q[0],j[9]=Q[1],j[10]=Q[2],j[11]=0,j[12]=T[0],j[13]=T[1],j[14]=T[2],j[15]=1,j}},87469:(Et,at,_)=>{_.d(at,{r:()=>N});var I=_(62208),tt=_(28347),q=_(43703),z=_(84161),K=_(28093),et=_(993),rt=_(67709),st=_(53928),ct=_(44014),U=_(40723),$=_(92222);class N extends st._{constructor(O){super(O),this._renderOccluded=U.yD.OccludeAndTransparent,this._width=1,this._color=(0,rt.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(O)}setGeometryFromRenderSpacePoint(O,M=1e3){const P=[];P.push([[O[0]-M,O[1]+0,O[2]+0],[O[0]+M,O[1]+0,O[2]+0]]),P.push([[O[0]-0,O[1]-M,O[2]+0],[O[0]+0,O[1]+M,O[2]+0]]),P.push([[O[0]-0,O[1]+0,O[2]-M],[O[0]+0,O[1]+0,O[2]+M]]),this.geometry=P}setGeometryFromExtent(O){const M=this.view.spatialReference,P=(0,K.c)(),D=(0,K.c)(),w=100,R=[];(0,z.s)(P,O[0],O[1],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),(0,z.s)(P,O[2],O[1],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),(0,z.s)(P,O[2],O[3],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),(0,z.s)(P,O[0],O[3],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),(0,z.s)(P,O[0],O[1],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),(0,z.s)(P,O[0],O[1],w),this.view.renderCoordsHelper.toRenderCoords(P,M,D),R.push([D[0],D[1],D[2]]),this.geometry=[R]}setGeometryFromFrustum(O){const M=[];O.lines.forEach(P=>{M.push([P.origin[0],P.origin[1],P.origin[2]]),M.push([P.endpoint[0],P.endpoint[1],P.endpoint[2]])}),this.geometry=[M]}setGeometryFromBoundedPlane(O){const M=[],P=O.origin,D=O.basis1,w=O.basis2,R=.5,E=(0,K.c)(),W=(0,K.c)(),Z=(0,K.c)(),V=(0,K.c)();E[0]=P[0]-D[0]*R-w[0]*R,E[1]=P[1]-D[1]*R-w[1]*R,E[2]=P[2]-D[2]*R-w[2]*R,W[0]=P[0]-D[0]*R+w[0]*R,W[1]=P[1]-D[1]*R+w[1]*R,W[2]=P[2]-D[2]*R+w[2]*R,Z[0]=P[0]+D[0]*R+w[0]*R,Z[1]=P[1]+D[1]*R+w[1]*R,Z[2]=P[2]+D[2]*R+w[2]*R,V[0]=P[0]+D[0]*R-w[0]*R,V[1]=P[1]+D[1]*R-w[1]*R,V[2]=P[2]+D[2]*R-w[2]*R,M.push([E[0],E[1],E[2]]),M.push([W[0],W[1],W[2]]),M.push([Z[0],Z[1],Z[2]]),M.push([V[0],V[1],V[2]]),M.push([E[0],E[1],E[2]]),this.geometry=[M]}setGeometryFromSegment(O){const M=O.endRenderSpace;this.transform=(0,tt.f)(Y,M);const{points:P}=O.createRenderGeometry(M,this.view.renderCoordsHelper);this.geometry=[P]}setGeometryFromSegments(O,M=K.Z){this.transform=(0,tt.f)(Y,M),this.geometry=O.map(P=>P.createRenderGeometry(M,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return(0,I.Wi)(this._geometry)?null:this._geometry.map(O=>O.map(M=>(0,z.m)((0,K.c)(),M,this.transform)))}get renderOccluded(){return this._renderOccluded}set renderOccluded(O){O!==this._renderOccluded&&(this._renderOccluded=O,this._updateMaterial())}get geometry(){return this._geometry}set geometry(O){this._geometry=O,this.recreateGeometry()}get width(){return this._width}set width(O){O!==this._width&&(this._width=O,this._updateMaterial())}get color(){return this._color}set color(O){(0,et.g)(O,this._color)||((0,et.c)(this._color,O),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(O){O!==this._innerWidth&&(this._innerWidth=O,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(O){(0,I.pC)(O)?!(0,I.Wi)(this._innerColor)&&(0,et.g)(O,this._innerColor)||(this._innerColor=(0,et.c)((0,rt.c)(),O),this._updateMaterial()):(0,I.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(O){const M=(0,I.pC)(O)!==(0,I.pC)(this._stipplePattern);this._stipplePattern=O,M?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(O){((0,I.Wi)(O)||(0,I.Wi)(this._stippleOffColor)||!(0,et.g)(O,this._stippleOffColor))&&(this._stippleOffColor=(0,I.pC)(O)?(0,rt.a)(O):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(O){this._stipplePreferContinuous!==O&&(this._stipplePreferContinuous=O,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(O){this._writeDepthEnabled!==O&&(this._writeDepthEnabled=O,this._updateMaterial())}get falloff(){return this._falloff}set falloff(O){O!==this._falloff&&(this._falloff=O,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(O){O!==this._polygonOffset&&(this._polygonOffset=O,this._updateMaterial())}createExternalResources(){this._material=new $.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(O){const M=this._createLineGeometries();if(0!==M.length)for(let P=0;P<M.length;++P){const D=(0,ct.YU)(M[P]);O.addGeometry(D,this._material)}}forEachExternalMaterial(O){O(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const O=this.geometry;if((0,I.Wi)(O)||0===O.length)return[];const M=[];return O.forEach(P=>{const w=new Float64Array(3*P.length);P.forEach((E,W)=>{w[3*W+0]=E[0],w[3*W+1]=E[1],w[3*W+2]=E[2]}),M.push({overlayInfo:null,attributeData:{position:w},removeDuplicateStartEnd:ct.NW.KEEP})}),M}}const Y=(0,q.c)()},53928:(Et,at,_)=>{_.d(at,{_:()=>st});var I=_(62208),tt=_(28347),q=_(43703),z=_(68604),K=_(42743),et=_(96867),rt=_(34103);class st extends z.l{constructor(U){super(U.view),this._resources=null,this._transform=(0,q.c)()}get object(){return(0,I.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(U){(0,tt.c)(this._transform,U),(0,I.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,I.Wi)(this._resources))return;const U=this._resources.object,$=this.view._stage;$.removeMany(U.geometries),U.removeAllGeometries(),this.createGeometries(U),this.visible||U.setVisible(this.visible),$.addMany(U.geometries)}createResources(){this.destroyResources();const U=this.view._stage;if(!U)return;const $=new rt.F({isPickable:!1,updatePolicy:K.jq.SYNC});U.add($);const N=new et.T({castShadow:!1});N.transformation=this._transform,this.createExternalResources(),this.createGeometries(N),U.addMany(N.geometries),this.forEachExternalMaterial(Y=>U.add(Y)),U.add(N),$.add(N),this.visible||N.setVisible(!1),this._resources={layer:$,object:N}}destroyResources(){const U=this.view._stage;!(0,I.Wi)(this._resources)&&U&&(U.remove(this._resources.object),U.remove(this._resources.layer),this.forEachExternalMaterial($=>{U.remove($),$.dispose()}),U.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(U){(0,I.Wi)(this._resources)||this._resources.object.setVisible(U)}}},68604:(Et,at,_)=>{_.d(at,{l:()=>tt});var I=_(32917);class tt{constructor(z){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=z,this._handle=(0,I.YP)(()=>this.view.ready,K=>{this._resourcesCreated&&(K?this._createResources():this._destroyResources())})}applyProps(z){let K=!1;for(const et in z)et in this?"attached"===et?K=z[et]:this[et]=z[et]:console.error("Cannot set unknown property",et);this.attached=K}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(z){z!==this._attached&&this.view._stage&&(this._attached=z,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(z){z!==this._visible&&(this._visible=z,this.attached&&this.updateVisibility(z))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},81801:(Et,at,_)=>{_.d(at,{A:()=>z});var I=_(2166),tt=_(65787),q=_(17625);function z(K,et){if(!et.screenSizeEnabled)return;const rt=K.vertex;(0,I.h)(rt,et),rt.uniforms.add(new tt.p("perScreenPixelRatio",(st,ct)=>ct.camera.perScreenPixelRatio)),rt.uniforms.add(new tt.p("screenSizeScale",st=>st.screenSizeScale)),rt.code.add(q.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},95925:(Et,at,_)=>{_.d(at,{Lp:()=>et,P9:()=>K,Yq:()=>ct});var I=_(15861),tt=_(62208),q=_(10699),z=_(32917);function K(U,$,N){const Y=st(U,$);U.view.activeTool=Y;let ot=(0,q.fu)(N,()=>rt(U,$));return(0,q.vr)(function(){var O=(0,I.Z)(function*(M){yield(0,z.N1)(()=>!Y.active,M),ot=(0,tt.hw)(ot),rt(U,$)});return function(M){return O.apply(this,arguments)}}(),N)}function et(U,$){return(0,z.YP)(()=>U.interactive,()=>rt(U,$),z.tX)}function rt(U,$){U.interactive?st(U,$):ct(U)}function st(U,$){ct(U);const{view:N,analysis:Y}=U,ot=new $({view:N,analysis:Y,analysisViewData:U});return U.tool=ot,N.tools.add(ot),ot}function ct(U){const{view:$,tool:N}=U;(0,tt.Wi)(N)||($.tools.remove(N),U.tool=null)}},58997:(Et,at,_)=>{_.d(at,{f:()=>w});var O,R,I=_(17626),tt=_(32917),q=_(77712),rt=(_(85931),_(8314),_(90912),_(76898)),st=_(14517),ct=_(63290),U=_(62208),$=_(10699),N=_(79599),Y=_(33786),ot=_(46160);(R=O||(O={}))[R.WhenToolEditable=0]="WhenToolEditable",R[R.WhenToolNotEditable=1]="WhenToolNotEditable",R[R.Always=2]="Always";class M{constructor(){this._isToolEditable=!0,this._manipulators=new ot.Z,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(E){this._isToolEditable=E}get length(){return this._manipulators.length}add(E,W=O.WhenToolEditable){return this.addMany([E],W)[0]}addMany(E,W=O.WhenToolEditable){return E.map(Z=>{const V=this._nextManipulatorId++,lt={id:V,manipulator:Z,visibilityPredicate:W,attached:!1};return this._manipulators.add(lt),this._attached&&this._updateManipulatorAttachment(lt),V})}remove(E){if("number"==typeof E){const Z=E;for(let V=0;V<this._manipulators.length;V++)if(this._manipulators.getItemAt(V).id===Z){const lt=this._manipulators.splice(V,1)[0];return this._detachManipulator(lt),lt.id}return null}const W=E;for(let Z=0;Z<this._manipulators.length;Z++)if(this._manipulators.getItemAt(Z).manipulator===W){const V=this._manipulators.splice(Z,1)[0];return this._detachManipulator(V),V.id}return null}removeAll(){this._manipulators.forEach(E=>{this._detachManipulator(E)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(E=>{this._updateManipulatorAttachment(E)}),this._attached=!0}detach(){this._manipulators.forEach(E=>{this._detachManipulator(E)}),this._attached=!1}destroy(){this._manipulators.forEach(({manipulator:E})=>{E.destroy&&E.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(E,W){return this._manipulators.on(E,Z=>{W(Z)})}forEach(E){for(const W of this._manipulators.items)E(W)}some(E){return this._manipulators.items.some(E)}toArray(){const E=[];return this.forEach(W=>E.push(W.manipulator)),E}intersect(E,W){let Z=null,V=Number.MAX_VALUE;return this._manipulators.forEach(({id:lt,manipulator:ut,attached:dt})=>{if(!dt||!ut.interactive)return;const yt=ut.intersectionDistance(E,W);(0,U.pC)(yt)&&yt<V&&(V=yt,Z={id:lt,manipulator:ut})}),Z}findById(E){if((0,U.Wi)(E))return null;for(const W of this._manipulators.items)if(E===W.id)return W.manipulator;return null}_updateManipulatorAttachment(E){this._isManipulatorItemVisible(E)?this._attachManipulator(E):this._detachManipulator(E)}_attachManipulator(E){E.attached||(E.manipulator.attach&&E.manipulator.attach(this._resourceContexts),E.attached=!0)}_detachManipulator(E){if(!E.attached)return;const W=E.manipulator;W.grabbing=!1,W.dragging=!1,W.hovering=!1,W.selected=!1,W.detach&&W.detach(this._resourceContexts),E.attached=!1}_isManipulatorItemVisible(E){return E.visibilityPredicate===O.Always||(this._isToolEditable?E.visibilityPredicate===O.WhenToolEditable:E.visibilityPredicate===O.WhenToolNotEditable)}}const P=ct.Z.getLogger("esri.views.interactive.InteractiveToolBase");let D=class extends st.Z{constructor(R){super(R),this.manipulators=new M,this.preferManipulatorCursor=!1,this.automaticManipulatorSelection=!0,this.hasFocusedManipulators=!1,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Y.bH.MANAGER,!0],[Y.bH.USER,!0]]),this._creationFinishedResolver=(0,$.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(R){this._get("visible")!==R&&(this._set("visible",R),this._syncVisible())}get editable(){return this.getEditableFlag(Y.bH.USER)}set editable(R){this.setEditableFlag(Y.bH.USER,R)}get updating(){return!1}get cursor(){return null}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){(0,U.Wi)(this.view)?P.error("Can't activate tool if view is not defined."):((0,N.t)(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(R){this.onInputEvent(R)}handleInputEventAfter(R){this.onInputEventAfter(R)}setEditableFlag(R,E){this._editableFlags.set(R,E),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),R===Y.bH.USER&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(R){return this._editableFlags.get(R)}whenCreated(){return this._creationFinishedResolver.promise}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(R){}onInputEventAfter(R){}get internallyEditable(){return this.getEditableFlag(Y.bH.USER)&&this.getEditableFlag(Y.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.constructed)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,I._)([(0,q.Cb)({constructOnly:!0})],D.prototype,"view",void 0),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"active",null),(0,I._)([(0,q.Cb)({value:!0})],D.prototype,"visible",null),(0,I._)([(0,q.Cb)({value:!0})],D.prototype,"editable",null),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"manipulators",void 0),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"updating",null),(0,I._)([(0,q.Cb)()],D.prototype,"cursor",null),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"preferManipulatorCursor",void 0),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"automaticManipulatorSelection",void 0),(0,I._)([(0,q.Cb)()],D.prototype,"hasFocusedManipulators",void 0),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"created",void 0),(0,I._)([(0,q.Cb)({readOnly:!0})],D.prototype,"removeIncompleteOnCancel",void 0),D=(0,I._)([(0,rt.j)("esri.views.interactive.InteractiveToolBase")],D);let w=class extends D{constructor(R){super(R)}initialize(){this.own((0,tt.YP)(()=>this.analysisViewData.visible,R=>this.visible=R,tt.tX))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};(0,I._)([(0,q.Cb)({constructOnly:!0})],w.prototype,"analysis",void 0),(0,I._)([(0,q.Cb)()],w.prototype,"analysisViewData",void 0),w=(0,I._)([(0,rt.j)("esri.views.interactive.AnalysisToolBase")],w)},30260:(Et,at,_)=>{_.d(at,{hM:()=>Pt,Xd:()=>R,di:()=>Mt}),_(29132);var tt=_(58817),z=(_(21286),_(62208));function R(v,C){return v.events.on("drag",function w(v,C){let y=null,p=null;return x=>{if("cancel"===x.action)return void((0,z.pC)(p)&&(p.execute({action:"cancel"}),y=null,p=null));const S={action:x.action,screenStart:x.start,screenEnd:x.screenPoint};"start"===x.action&&(0,z.Wi)(y)&&(y=new Pt,p=new Pt,C(v,y,p,x.pointerType,S)),(0,z.pC)(y)&&y.execute(S),"end"===x.action&&(0,z.pC)(y)&&(y=null,p=null)}}(v,C))}function Mt(v,C){const y=new Map;for(const p of C)y.set(p,(0,tt.d9)(v[p]));return p=>(y.forEach((x,S)=>{v[S]=x}),p)}_(28093),_(55915),_(59617),_(65401),_(32442),_(25748),_(49672);class Pt{constructor(){this.execute=()=>{}}next(C,y=new Pt){return(0,z.pC)(C)&&(this.execute=p=>{const x=C(p);(0,z.pC)(x)&&y.execute(x)}),y}}}}]);