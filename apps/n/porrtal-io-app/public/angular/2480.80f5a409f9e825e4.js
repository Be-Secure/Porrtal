"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[2480],{82480:(ge,z,I)=>{I.r(z),I.d(z,{registerFunctions:()=>pe});var O=I(15861),j=I(37780),N=I(6729),u=I(25919),ae=I(42275),J=I(90512),w=I(85171),ie=I(98362),r=I(47562),g=I(52724),k=I(53997),se=I(95896),le=I(79429),oe=I(62074),ue=I(16776),fe=I(57366),W=I(77132),Q=I(83947),$=I(50818),ce=I(10699),F=I(10410),H=I(80415),S=I(36255);function V(s,t,i){return Z.apply(this,arguments)}function Z(){return(Z=(0,O.Z)(function*(s,t,i){const y=s.getVariables();if(y.length>0){const h=[];for(let e=0;e<y.length;e++){const a={name:y[e]};h.push(yield t.evaluateIdentifier(i,a))}const c={};for(let e=0;e<y.length;e++)c[y[e]]=h[e];return s.parameters=c,s}return s})).apply(this,arguments)}function m(s,t,i=null){for(const y in s)if(y.toLowerCase()===t.toLowerCase())return s[y];return i}function Y(s){if(null===s)return null;const t={type:m(s,"type",""),name:m(s,"name","")};if("range"===t.type)t.range=m(s,"range",[]);else{t.codedValues=[];for(const i of m(s,"codedValues",[]))t.codedValues.push({name:m(i,"name",""),code:m(i,"code",null)})}return t}function U(s){if(null===s)return null;const t={},i=m(s,"wkt",null);null!==i&&(t.wkt=i);const y=m(s,"wkid",null);return null!==y&&(t.wkid=y),t}function q(s){if(null===s)return null;const t={hasZ:m(s,"hasz",!1),hasM:m(s,"hasm",!1)},i=m(s,"spatialreference",null);i&&(t.spatialReference=U(i));const y=m(s,"x",null);if(null!==y)return t.x=y,t.y=m(s,"y",null),t;const h=m(s,"rings",null);if(null!==h)return t.rings=h,t;const c=m(s,"paths",null);if(null!==c)return t.paths=c,t;const e=m(s,"points",null);if(null!==e)return t.points=e,t;for(const a of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const f=m(s,a,null);null!==f&&(t[a]=f)}return t}function pe(s){"async"===s.mode&&(s.functions.getuser=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){(0,r.y)(e,0,2,t,i);let a=(0,r.A)(e[1],""),f=!0===a;if(a=!0===a||!1===a?"":(0,r.j)(a),0===e.length||e[0]instanceof j.Z){let _=null;t.services&&t.services.portal&&(_=t.services.portal),e.length>0&&(_=(0,w.getPortal)(e[0],_));const l=yield(0,w.lookupUser)(_,a,f);if(l){const n=JSON.parse(JSON.stringify(l));for(const o of["lastLogin","created","modified"])null!=n[o]&&(n[o]=new Date(n[o]));return N.Z.convertObjectToArcadeDictionary(n)}return null}let p=null;if((0,r.T)(e[0])&&(p=e[0]),p){if(f=!1,a)return null;yield p.load();const _=yield p.getOwningSystemUrl();if(!_){if(!a){const o=yield p.getIdentityUser();return o?N.Z.convertObjectToArcadeDictionary({username:o}):null}return null}let l=null;t.services&&t.services.portal&&(l=t.services.portal),l=(0,w.getPortal)(new j.Z(_),l);const n=yield(0,w.lookupUser)(l,a,f);if(n){const o=JSON.parse(JSON.stringify(n));for(const d of["lastLogin","created","modified"])null!=o[d]&&(o[d]=new Date(o[d]));return N.Z.convertObjectToArcadeDictionary(o)}return null}throw new u.aV(t,u.rH.InvalidParameter,i)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"getuser",min:1,max:2}),s.functions.featuresetbyid=function(t,i){return s.standardFunctionAsync(t,i,(y,h,c)=>{if((0,r.y)(c,2,4,t,i),c[0]instanceof J.Z){const e=(0,r.j)(c[1]);let a=(0,r.A)(c[2],null);const f=(0,r.h)((0,r.A)(c[3],!0));if(null===a&&(a=["*"]),!1===(0,r.m)(a))throw new u.aV(t,u.rH.InvalidParameter,i);return c[0].featureSetById(e,f,a)}throw new u.aV(t,u.rH.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyid",min:2,max:4}),s.functions.getfeatureset=function(t,i){return s.standardFunctionAsync(t,i,(y,h,c)=>{if((0,r.y)(c,1,2,t,i),(0,r.w)(c[0])){let e=(0,r.A)(c[1],"datasource");return null===e&&(e="datasource"),e=(0,r.j)(e).toLowerCase(),(0,w.convertToFeatureSet)(c[0].fullSchema(),e,t.lrucache,t.interceptor,t.spatialReference)}throw new u.aV(t,u.rH.InvalidParameter,i)})},s.signatures.push({name:"getfeatureset",min:1,max:2}),s.functions.featuresetbyportalitem=function(t,i){return s.standardFunctionAsync(t,i,(y,h,c)=>{if((0,r.y)(c,2,5,t,i),null===c[0])throw new u.aV(t,u.rH.PortalRequired,i);if(c[0]instanceof j.Z){const _=(0,r.j)(c[1]),l=(0,r.j)(c[2]);let n=(0,r.A)(c[3],null);const o=(0,r.h)((0,r.A)(c[4],!0));if(null===n&&(n=["*"]),!1===(0,r.m)(n))throw new u.aV(t,u.rH.InvalidParameter,i);let d=null;return t.services&&t.services.portal&&(d=t.services.portal),d=(0,w.getPortal)(c[0],d),(0,w.constructFeatureSetFromPortalItem)(_,l,t.spatialReference,n,o,d,t.lrucache,t.interceptor)}if(!1===(0,r.c)(c[0]))throw new u.aV(t,u.rH.PortalRequired,i);const e=(0,r.j)(c[0]),a=(0,r.j)(c[1]);let f=(0,r.A)(c[2],null);const p=(0,r.h)((0,r.A)(c[3],!0));if(null===f&&(f=["*"]),!1===(0,r.m)(f))throw new u.aV(t,u.rH.InvalidParameter,i);if(t.services&&t.services.portal)return(0,w.constructFeatureSetFromPortalItem)(e,a,t.spatialReference,f,p,t.services.portal,t.lrucache,t.interceptor);throw new u.aV(t,u.rH.PortalRequired,i)})},s.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),s.functions.featuresetbyname=function(t,i){return s.standardFunctionAsync(t,i,(y,h,c)=>{if((0,r.y)(c,2,4,t,i),c[0]instanceof J.Z){const e=(0,r.j)(c[1]);let a=(0,r.A)(c[2],null);const f=(0,r.h)((0,r.A)(c[3],!0));if(null===a&&(a=["*"]),!1===(0,r.m)(a))throw new u.aV(t,u.rH.InvalidParameter,i);return c[0].featureSetByName(e,f,a)}throw new u.aV(t,u.rH.InvalidParameter,i)})},s.signatures.push({name:"featuresetbyname",min:2,max:4}),s.functions.featureset=function(t,i){return s.standardFunction(t,i,(y,h,c)=>{(0,r.y)(c,1,1,t,i);let e=c[0];const a={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,r.c)(e))e=JSON.parse(e),void 0!==e.layerDefinition?(a.layerDefinition=e.layerDefinition,a.featureSet=e.featureSet,e.layerDefinition.spatialReference&&(a.layerDefinition.spatialReference=e.layerDefinition.spatialReference)):(a.featureSet.features=e.features,a.featureSet.geometryType=e.geometryType,a.layerDefinition.geometryType=a.featureSet.geometryType,a.layerDefinition.objectIdField=e.objectIdFieldName,a.layerDefinition.typeIdField=e.typeIdFieldName,a.layerDefinition.globalIdField=e.globalIdFieldName,a.layerDefinition.fields=e.fields,e.spatialReference&&(a.layerDefinition.spatialReference=e.spatialReference));else{if(!(c[0]instanceof N.Z))throw new u.aV(t,u.rH.InvalidParameter,i);{e=JSON.parse(c[0].castToText(!0));const f=m(e,"layerdefinition");if(null!==f){a.layerDefinition.geometryType=m(f,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.globalIdField=m(f,"globalidfield",""),a.layerDefinition.objectIdField=m(f,"objectidfield",""),a.layerDefinition.typeIdField=m(f,"typeidfield","");const p=m(f,"spatialreference",null);p&&(a.layerDefinition.spatialReference=U(p));for(const l of m(f,"fields",[])){const n={name:m(l,"name",""),alias:m(l,"alias",""),type:m(l,"type",""),nullable:m(l,"nullable",!0),editable:m(l,"editable",!0),length:m(l,"length",null),domain:Y(m(l,"domain"))};a.layerDefinition.fields.push(n)}const _=m(e,"featureset",null);if(_){const l={};for(const n of a.layerDefinition.fields)l[n.name.toLowerCase()]=n.name;for(const n of m(_,"features",[])){const o={},d=m(n,"attributes",{});for(const P in d)o[l[P.toLowerCase()]]=d[P];a.featureSet.features.push({attributes:o,geometry:q(m(n,"geometry",null))})}}}else{a.layerDefinition.geometryType=m(e,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.objectIdField=m(e,"objectidfieldname",""),a.layerDefinition.typeIdField=m(e,"typeidfieldname","");const p=m(e,"spatialreference",null);p&&(a.layerDefinition.spatialReference=U(p));for(const l of m(e,"fields",[])){const n={name:m(l,"name",""),alias:m(l,"alias",""),type:m(l,"type",""),nullable:m(l,"nullable",!0),editable:m(l,"editable",!0),length:m(l,"length",null),domain:Y(m(l,"domain"))};a.layerDefinition.fields.push(n)}const _={};for(const l of a.layerDefinition.fields)_[l.name.toLowerCase()]=l.name;for(const l of m(e,"features",[])){const n={},o=m(l,"attributes",{});for(const d in o)n[_[d.toLowerCase()]]=o[d];a.featureSet.features.push({attributes:n,geometry:q(m(l,"geometry",null))})}}}}if(!1===function ye(s){return!!s.layerDefinition&&!!s.featureSet&&!1!==function me(s,t){for(const i of t)if(i===s)return!0;return!1}(s.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==s.layerDefinition.objectIdField&&""!==s.layerDefinition.objectIdField&&!1!==(0,r.m)(s.layerDefinition.fields)&&!1!==(0,r.m)(s.featureSet.features)}(a))throw new u.aV(t,u.rH.InvalidParameter,i);return ue.Z.create(a,t.spatialReference)})},s.signatures.push({name:"featureset",min:1,max:1}),s.functions.filter=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.y)(e,2,2,t,i),(0,r.m)(e[0])||(0,r.x)(e[0])){const a=[];let f=e[0];f instanceof ie.Z&&(f=f.toArray());let p=null;if(!(0,r.i)(e[1]))throw new u.aV(t,u.rH.InvalidParameter,i);p=e[1].createFunction(t);for(const _ of f){const l=p(_);(0,ce.y8)(l)?!0===(yield l)&&a.push(_):!0===l&&a.push(_)}return a}if((0,r.T)(e[0])){const a=yield e[0].load(),f=F.WhereClause.create(e[1],a.getFieldsIndex()),p=f.getVariables();if(p.length>0){const _=[];for(let n=0;n<p.length;n++){const o={name:p[n]};_.push(yield s.evaluateIdentifier(t,o))}const l={};for(let n=0;n<p.length;n++)l[p[n]]=_[n];return f.parameters=l,new k.Z({parentfeatureset:e[0],whereclause:f})}return new k.Z({parentfeatureset:e[0],whereclause:f})}throw new u.aV(t,u.rH.InvalidParameter,i)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"filter",min:2,max:2}),s.functions.orderby=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.y)(e,2,2,t,i),(0,r.T)(e[0])){const a=new fe.Z(e[1]);return new se.Z({parentfeatureset:e[0],orderbyclause:a})}throw new u.aV(t,u.rH.InvalidParameter,i)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"orderby",min:2,max:2}),s.functions.top=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.y)(e,2,2,t,i),(0,r.T)(e[0]))return new le.Z({parentfeatureset:e[0],topnum:e[1]});if((0,r.m)(e[0]))return(0,r.g)(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,(0,r.g)(e[1]));if((0,r.x)(e[0]))return(0,r.g)(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,(0,r.g)(e[1]));throw new u.aV(t,u.rH.InvalidParameter,i)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"top",min:2,max:2}),s.functions.first=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.y)(e,1,1,t,i),(0,r.T)(e[0])){const a=yield e[0].first(h.abortSignal);if(null!==a){const f=ae.Z.createFromGraphicLikeObject(a.geometry,a.attributes,e[0]);return f._underlyingGraphic=a,f}return a}return(0,r.m)(e[0])?0===e[0].length?null:e[0][0]:(0,r.x)(e[0])?0===e[0].length()?null:e[0].get(0):null});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"first",min:1,max:1}),s.functions.attachments=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){(0,r.y)(e,1,2,t,i);const a={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1)if(e[1]instanceof N.Z){if(e[1].hasField("minsize")&&(a.minsize=(0,r.g)(e[1].field("minsize"))),e[1].hasField("metadata")&&(a.returnMetadata=(0,r.h)(e[1].field("metadata"))),e[1].hasField("maxsize")&&(a.maxsize=(0,r.g)(e[1].field("maxsize"))),e[1].hasField("types")){const f=(0,r.X)(e[1].field("types"),!1);f.length>0&&(a.types=f)}}else if(null!==e[1])throw new u.aV(t,u.rH.InvalidParameter,i);if((0,r.w)(e[0])){let f=e[0]._layer;return f instanceof H.default&&(f=(0,w.constructFeatureSet)(f,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===f||!1===(0,r.T)(f)?[]:(yield f.load(),f.queryAttachments(e[0].field(f.objectIdField),a.minsize,a.maxsize,a.types,a.returnMetadata))}if(null===e[0])return[];throw new u.aV(t,u.rH.InvalidParameter,i)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"attachments",min:1,max:2}),s.functions.featuresetbyrelationshipname=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){(0,r.y)(e,2,4,t,i);const a=e[0],f=(0,r.j)(e[1]);let p=(0,r.A)(e[2],null);const _=(0,r.h)((0,r.A)(e[3],!0));if(null===p&&(p=["*"]),!1===(0,r.m)(p))throw new u.aV(t,u.rH.InvalidParameter,i);if(null===e[0])return null;if(!(0,r.w)(e[0]))throw new u.aV(t,u.rH.InvalidParameter,i);let l=a._layer;if(l instanceof H.default&&(l=(0,w.constructFeatureSet)(l,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===l||!1===(0,r.T)(l))return null;l=yield l.load();const n=l.relationshipMetaData().filter(x=>x.name===f);if(0===n.length)return null;if(null!=n[0].relationshipTableId&&n[0].relationshipTableId>-1)return(0,w.constructFeatureSetFromRelationship)(l,n[0],a.field(l.objectIdField),l.spatialReference,p,_,t.lrucache,t.interceptor);let o=l.serviceUrl();if(!o)return null;o="/"===o.charAt(o.length-1)?o+n[0].relatedTableId.toString():o+"/"+n[0].relatedTableId.toString();const d=yield(0,w.constructFeatureSetFromUrl)(o,l.spatialReference,p,_,t.lrucache,t.interceptor);yield d.load();let P=d.relationshipMetaData();if(P=P.filter(x=>x.id===n[0].id),!1===a.hasField(n[0].keyField)||null===a.field(n[0].keyField)){const x=yield l.getFeatureByObjectId(a.field(l.objectIdField),[n[0].keyField]);if(x){const A=F.WhereClause.create(P[0].keyField+"= @id",d.getFieldsIndex());return A.parameters={id:x.attributes[n[0].keyField]},d.filter(A)}return new oe.Z({parentfeatureset:d})}const v=F.WhereClause.create(P[0].keyField+"= @id",d.getFieldsIndex());return v.parameters={id:a.field(n[0].keyField)},d.filter(v)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),s.functions.featuresetbyassociation=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){(0,r.y)(e,2,3,t,i);const a=e[0],f=(0,r.j)((0,r.A)(e[1],"")).toLowerCase(),p=(0,r.c)(e[2])?(0,r.j)(e[2]):null;if(null===e[0])return null;if(!(0,r.w)(e[0]))throw new u.aV(t,u.rH.InvalidParameter,i);let _=a._layer;if(_ instanceof H.default&&(_=(0,w.constructFeatureSet)(_,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===_||!1===(0,r.T)(_))return null;yield _.load();const l=_.serviceUrl(),n=yield(0,w.constructAssociationMetaDataFeatureSetFromUrl)(l,t.spatialReference);let o=null,d=null,P=!1;if(null!==p&&""!==p&&void 0!==p){for(const D of n.terminals)D.terminalName===p&&(d=D.terminalId);null===d&&(P=!0)}const v=n.associations.getFieldsIndex(),x=v.get("TOGLOBALID").name,A=v.get("FROMGLOBALID").name,B=v.get("TOTERMINALID").name,K=v.get("FROMTERMINALID").name,R=v.get("FROMNETWORKSOURCEID").name,b=v.get("TONETWORKSOURCEID").name,M=v.get("ASSOCIATIONTYPE").name,_e=v.get("ISCONTENTVISIBLE").name,he=v.get("OBJECTID").name;for(const D of _.fields)if("global-id"===D.type){o=a.field(D.name);break}let L=null,G=new g.yN(new S.Z({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",n.associations.getFieldsIndex())),ee=new g.yN(new S.Z({name:"side",alias:"side",type:"string"}),F.WhereClause.create("''",n.associations.getFieldsIndex()));const T="globalid",te="globalId",ne={};for(const D in n.lkp)ne[D]=n.lkp[D].sourceId;const C=new g.TO(new S.Z({name:"classname",alias:"classname",type:"string"}),null,ne);let E="";switch(f){case"midspan":{E=`((${x}='${o}') OR ( ${A}='${o}')) AND (${M} IN (5))`,C.codefield=F.WhereClause.create(`CASE WHEN (${x}='${o}') THEN ${R} ELSE ${b} END`,n.associations.getFieldsIndex());const D=(0,W.JW)(g.Xx.findField(n.associations.fields,A));D.name=T,D.alias=T,L=new g.yN(D,F.WhereClause.create(`CASE WHEN (${A}='${o}') THEN ${x} ELSE ${A} END`,n.associations.getFieldsIndex())),G=n.unVersion>=4?new g.$X(g.Xx.findField(n.associations.fields,v.get("PERCENTALONG").name)):new g.yN(new S.Z({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",n.associations.getFieldsIndex()));break}case"junctionedge":{E=`((${x}='${o}') OR ( ${A}='${o}')) AND (${M} IN (4,6))`,C.codefield=F.WhereClause.create(`CASE WHEN (${x}='${o}') THEN ${R} ELSE ${b} END`,n.associations.getFieldsIndex());const D=(0,W.JW)(g.Xx.findField(n.associations.fields,A));D.name=T,D.alias=T,L=new g.yN(D,F.WhereClause.create(`CASE WHEN (${A}='${o}') THEN ${x} ELSE ${A} END`,n.associations.getFieldsIndex())),ee=new g.yN(new S.Z({name:"side",alias:"side",type:"string"}),F.WhereClause.create(`CASE WHEN (${M}=4) THEN 'from' ELSE 'to' END`,n.associations.getFieldsIndex()));break}case"connected":{let D=`${x}='@T'`,re=`${A}='@T'`;null!==d&&(D+=` AND ${B}=@A`,re+=` AND ${K}=@A`),E="(("+D+") OR ("+re+"))",E=(0,r.L)(E,"@T",o??""),D=(0,r.L)(D,"@T",o??""),null!==d&&(D=(0,r.L)(D,"@A",d.toString()),E=(0,r.L)(E,"@A",d.toString())),C.codefield=F.WhereClause.create("CASE WHEN "+D+` THEN ${R} ELSE ${b} END`,n.associations.getFieldsIndex());const X=(0,W.JW)(g.Xx.findField(n.associations.fields,A));X.name=T,X.alias=T,L=new g.yN(X,F.WhereClause.create("CASE WHEN "+D+` THEN ${A} ELSE ${x} END`,n.associations.getFieldsIndex()));break}case"container":E=`${x}='${o}' AND ${M} = 2`,null!==d&&(E+=` AND ${B} = `+d.toString()),C.codefield=R,E="( "+E+" )",L=new g.QP(g.Xx.findField(n.associations.fields,A),T,T);case"content":E=`(${A}='${o}' AND ${M} = 2)`,null!==d&&(E+=` AND ${K} = `+d.toString()),C.codefield=b,E="( "+E+" )",L=new g.QP(g.Xx.findField(n.associations.fields,x),T,T);break;case"structure":E=`(${x}='${o}' AND ${M} = 3)`,null!==d&&(E+=` AND ${B} = `+d.toString()),C.codefield=R,E="( "+E+" )",L=new g.QP(g.Xx.findField(n.associations.fields,A),T,te);break;case"attached":E=`(${A}='${o}' AND ${M} = 3)`,null!==d&&(E+=` AND ${K} = `+d.toString()),C.codefield=b,E="( "+E+" )",L=new g.QP(g.Xx.findField(n.associations.fields,x),T,te);break;default:throw new u.aV(t,u.rH.InvalidParameter,i)}return P&&(E="1 <> 1"),new g.Xx({parentfeatureset:n.associations,adaptedFields:[new g.$X(g.Xx.findField(n.associations.fields,he)),new g.$X(g.Xx.findField(n.associations.fields,_e)),L,ee,C,G],extraFilter:E?F.WhereClause.create(E,n.associations.getFieldsIndex()):null})});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"featuresetbyassociation",min:2,max:6}),s.functions.groupby=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.y)(e,3,3,t,i),!(0,r.T)(e[0]))throw new u.aV(t,u.rH.InvalidParameter,i);const a=yield e[0].load(),f=[],p=[];let _=!1,l=[];if((0,r.c)(e[1]))l.push(e[1]);else if(e[1]instanceof N.Z)l.push(e[1]);else if((0,r.m)(e[1]))l=e[1];else{if(!(0,r.x)(e[1]))throw new u.aV(t,u.rH.InvalidParameter,i);l=e[1].toArray()}for(const n of l)if((0,r.c)(n)){const o=F.WhereClause.create((0,r.j)(n),a.getFieldsIndex()),d=!0===(0,Q.y5)(o)?(0,r.j)(n):"%%%%FIELDNAME";f.push({name:d,expression:o}),"%%%%FIELDNAME"===d&&(_=!0)}else{if(!(n instanceof N.Z))throw new u.aV(t,u.rH.InvalidParameter,i);{const o=n.hasField("name")?n.field("name"):"%%%%FIELDNAME",d=n.hasField("expression")?n.field("expression"):"";if("%%%%FIELDNAME"===o&&(_=!0),!o)throw new u.aV(t,u.rH.InvalidParameter,i);f.push({name:o,expression:F.WhereClause.create(d||o,a.getFieldsIndex())})}}if(l=[],(0,r.c)(e[2]))l.push(e[2]);else if((0,r.m)(e[2]))l=e[2];else if((0,r.x)(e[2]))l=e[2].toArray();else{if(!(e[2]instanceof N.Z))throw new u.aV(t,u.rH.InvalidParameter,i);l.push(e[2])}for(const n of l){if(!(n instanceof N.Z))throw new u.aV(t,u.rH.InvalidParameter,i);{const o=n.hasField("name")?n.field("name"):"",d=n.hasField("statistic")?n.field("statistic"):"",P=n.hasField("expression")?n.field("expression"):"";if(!o||!d||!P)throw new u.aV(t,u.rH.InvalidParameter,i);p.push({name:o,statistic:d.toLowerCase(),expression:F.WhereClause.create(P,a.getFieldsIndex())})}}if(_){const n={};for(const d of a.fields)n[d.name.toLowerCase()]=1;for(const d of f)"%%%%FIELDNAME"!==d.name&&(n[d.name.toLowerCase()]=1);for(const d of p)"%%%%FIELDNAME"!==d.name&&(n[d.name.toLowerCase()]=1);let o=0;for(const d of f)if("%%%%FIELDNAME"===d.name){for(;1===n["field_"+o.toString()];)o++;n["field_"+o.toString()]=1,d.name="FIELD_"+o.toString()}}for(const n of f)yield V(n.expression,s,t);for(const n of p)yield V(n.expression,s,t);return e[0].groupby(f,p)});return function(h,c,e){return y.apply(this,arguments)}}())},s.signatures.push({name:"groupby",min:3,max:3}),s.functions.distinct=function(t,i){return s.standardFunctionAsync(t,i,function(){var y=(0,O.Z)(function*(h,c,e){if((0,r.T)(e[0])){(0,r.y)(e,2,2,t,i);const a=yield e[0].load(),f=[];let p=[];if((0,r.c)(e[1]))p.push(e[1]);else if(e[1]instanceof N.Z)p.push(e[1]);else if((0,r.m)(e[1]))p=e[1];else{if(!(0,r.x)(e[1]))throw new u.aV(t,u.rH.InvalidParameter,i);p=e[1].toArray()}let _=!1;for(const l of p)if((0,r.c)(l)){const n=F.WhereClause.create((0,r.j)(l),a.getFieldsIndex()),o=!0===(0,Q.y5)(n)?(0,r.j)(l):"%%%%FIELDNAME";f.push({name:o,expression:n}),"%%%%FIELDNAME"===o&&(_=!0)}else{if(!(l instanceof N.Z))throw new u.aV(t,u.rH.InvalidParameter,i);{const n=l.hasField("name")?l.field("name"):"%%%%FIELDNAME",o=l.hasField("expression")?l.field("expression"):"";if("%%%%FIELDNAME"===n&&(_=!0),!n)throw new u.aV(t,u.rH.InvalidParameter,i);f.push({name:n,expression:F.WhereClause.create(o||n,a.getFieldsIndex())})}}if(_){const l={};for(const o of a.fields)l[o.name.toLowerCase()]=1;for(const o of f)"%%%%FIELDNAME"!==o.name&&(l[o.name.toLowerCase()]=1);let n=0;for(const o of f)if("%%%%FIELDNAME"===o.name){for(;1===l["field_"+n.toString()];)n++;l["field_"+n.toString()]=1,o.name="FIELD_"+n.toString()}}for(const l of f)yield V(l.expression,s,t);return e[0].groupby(f,[])}return function de(s,t,i,y){if(1===y.length){if((0,r.m)(y[0]))return(0,$.t)(s,y[0],-1);if((0,r.x)(y[0]))return(0,$.t)(s,y[0].toArray(),-1)}return(0,$.t)(s,y,-1)}("distinct",0,0,e)});return function(h,c,e){return y.apply(this,arguments)}}())})}}}]);